
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import e from"../components/mjIncantation.77cca251.js";import a from"../components/mjDetail.65a6eb81.js";import{A as t}from"../mj/mj.899eed7a.js";import{u as l}from"../utcformatTime/utcformatTime.f6db2c52.js";import{d as o,u as i,r as n,G as s,x as r,j as p,V as d,o as u,c,f as m,b as f,g as y,W as g,X as v,h as x,w as b,J as h,t as w,e as _,P as j,p as k,k as z,_ as F,q as C}from"../main-4d5ea9bc.js";import"../system/system.9aa95def.js";const A=e=>(k("data-v-769cfa16"),e=e(),z(),e),V={class:"search_add_card"},M={style:{display:"flex","align-items":"center"}},U=A((()=>f("div",{class:"condition_name"},"关键字",-1))),I={style:{"margin-left":"10px"}},E=A((()=>f("div",{class:"condition_name"},"所属分类",-1))),R={style:{"margin-top":"22px","margin-left":"12px"}},S={key:1},q=o({__name:"incantation",setup(o){const k=i(),z=n(),F=n(),C=n(!1),A=n([]),q=n(0),B=s({page:1,size:20,keyword:"",pid:""});n();const P=async()=>{try{C.value=!0;const e=await t.queryMjIncantation(B),{rows:a,count:l}=e.data;C.value=!1,q.value=l,A.value=a.map((e=>{const a=G.get(e.pid);return e.type="text"===a.type?"普通":"style"===a.type?"风格":"",e.category=a.classifyName,e}))}catch(e){C.value=!1}},T=async()=>{F.value.open()},D=e=>{Object.assign(B,{keyword:"",pid:"",page:1,size:20}),P()},N=n([]),G=new Map;return r((async()=>{await(async()=>{const e=await t.queryAllMjIncantClassify({level:2}).then((e=>e.data));N.value=e,e.length&&e.forEach((e=>{G.set(e.id,e)}))})(),P()})),(o,i)=>{const n=p("el-input"),s=p("el-option"),r=p("el-select"),G=p("el-button"),J=p("RefreshRight"),O=p("el-icon"),W=p("el-image"),X=p("el-table-column"),H=p("el-popconfirm"),K=p("el-table"),L=p("el-pagination"),Q=p("el-row"),Y=d("loading");return u(),c("div",null,[m(e,{ref_key:"mjManagerRef",ref:F,list:N.value,onFresh:P},null,8,["list"]),m(a,{ref_key:"mjDetailRef",ref:z},null,512),f("div",V,[f("div",M,[f("div",null,[U,m(n,{modelValue:B.keyword,"onUpdate:modelValue":i[0]||(i[0]=e=>B.keyword=e),style:{width:"192px"},placeholder:"分类关键字[模糊搜索]",clearable:""},null,8,["modelValue"])]),f("div",I,[E,m(r,{modelValue:B.pid,"onUpdate:modelValue":i[1]||(i[1]=e=>B.pid=e)},{default:y((()=>[(u(!0),c(g,null,v(N.value,(e=>(u(),h(s,{key:e.id,value:e.id,label:e.classifyName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])]),f("div",R,[m(G,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:P},{default:y((()=>[x("查询 ")])),_:1})]),f("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:D},[m(O,{color:"#3B82F6",size:"20"},{default:y((()=>[m(J)])),_:1})])]),f("div",null,[m(G,{style:{"border-radius":"8px",border:"1px solid #3B82F6",color:"#3B82F6","font-size":"15px",height:"32px","margin-top":"25px"},onClick:T},{default:y((()=>[x(" 添加字典 ")])),_:1})])]),f("div",null,[b((u(),h(K,{border:"",data:A.value,height:"64vh",width:"100%"},{default:y((()=>[m(X,{prop:"img",label:"图片"},{default:y((e=>[e.row.img?(u(),h(W,{key:0,style:{width:"60px",height:"60px","border-radius":"8px"},src:e.row.img,fit:"fill"},null,8,["src"])):(u(),c("span",S,"--"))])),_:1}),m(X,{prop:"incantationCn",label:"名称"}),m(X,{prop:"incantationEn",label:"英文翻译"}),m(X,{prop:"type",label:"类型"}),m(X,{prop:"category",label:"分类"}),m(X,{prop:"createdAt",label:"创建时间"},{default:y((e=>[f("p",null,w(_(l)(e.row.createdAt)),1)])),_:1}),m(X,{prop:"updatedAt",label:"更新时间"},{default:y((e=>[f("p",null,w(_(l)(e.row.updatedAt)),1)])),_:1}),m(X,{fixed:"right",label:"操作",width:"280",align:"center"},{default:y((e=>[m(G,{link:"",type:"primary",size:"small",onClick:a=>(async e=>{F.value.open(e.id)})(e.row)},{default:y((()=>[x(" 编辑 ")])),_:2},1032,["onClick"]),m(H,{width:"300px",title:"删除后不可找回，确定删除?","confirm-button-text":"确认",onConfirm:a=>(async e=>{if(0==k.isUserModifyPermissions())return j.error("非超级管理员无权限操作！");await t.removeMjIncantation({id:e.id}),j.success("删除字典成功！"),await P()})(e.row)},{reference:y((()=>[m(G,{link:"",type:"danger",size:"small"},{default:y((()=>[x(" 删除 ")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[Y,C.value]]),m(Q,{class:"flex justify-end mt-5 pb-5"},{default:y((()=>[m(L,{"current-page":B.page,"onUpdate:currentPage":i[2]||(i[2]=e=>B.page=e),"page-size":B.size,"onUpdate:pageSize":i[3]||(i[3]=e=>B.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:q.value,onSizeChange:P,onCurrentChange:P},null,8,["current-page","page-size","total"])])),_:1})])])}}});"function"==typeof C&&C(q);const B=F(q,[["__scopeId","data-v-769cfa16"]]);export{B as default};
