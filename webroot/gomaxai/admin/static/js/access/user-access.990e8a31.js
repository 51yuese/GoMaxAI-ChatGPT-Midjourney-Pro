
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,u as a,r as s,F as t,o as l,l as n,V as i,b as r,e as o,h as d,f as u,i as c,Y as p,X as m,g as f,j as g,w as y,J as b,t as v,P as x,x as _,_ as w,q as h}from"../main-fe71c3b2.js";import{a as z}from"./access.c835832a.js";import{A as k,M as C}from"../index/index.1baeddf5.js";import F from"../components/manager.1eac6529.js";const j={class:"search_add_card"},U={style:{display:"flex","align-items":"center"}},S={style:{"margin-left":"10px"}},V={style:{"margin-left":"10px"}},P={style:{"margin-top":"12px"}},A={style:{display:"flex","align-items":"center"}},M=e({__name:"user-access",setup(e){const w=a();s();const h=s(0);s(!1);const M=s(!1);t({status:0,id:0});const B=t({username:"",name:"",status:0,page:1,size:20}),I=s(),L=s([]);async function R(){try{M.value=!0;const e=await z.queryAccessList(B),{rows:a,count:s}=e.data;M.value=!1,h.value=s,L.value=a}catch(e){M.value=!1}}function q(e){Object.assign(B,{username:"",name:"",status:0,page:1,size:20}),R()}function E(){I.value.open()}const J=e=>{if(!e)return"全部";return(e&&JSON.parse(e)||[]).map((e=>C.map().get(e))).join("，")},O=e=>["super","admin"].includes(e);return l((()=>R())),(e,a)=>{const s=n("el-input"),t=n("el-option"),l=n("el-select"),C=n("el-button"),$=n("RefreshRight"),D=n("el-icon"),N=n("el-table-column"),X=n("el-tag"),Y=n("el-popconfirm"),G=_,H=n("el-popover"),K=n("el-table"),Q=n("el-pagination"),T=n("el-row"),W=i("loading");return r(),o("div",null,[d(F,{ref_key:"managerRef",ref:I,onFresh:R},null,512),u("div",j,[u("div",U,[u("div",null,[a[4]||(a[4]=u("div",{class:"condition_name"},"管理员账号",-1)),d(s,{modelValue:B.username,"onUpdate:modelValue":a[0]||(a[0]=e=>B.username=e),placeholder:"用户账号[模糊搜索]",clearable:""},null,8,["modelValue"])]),u("div",S,[a[5]||(a[5]=u("div",{class:"condition_name"},"管理员状态",-1)),d(l,{modelValue:B.status,"onUpdate:modelValue":a[1]||(a[1]=e=>B.status=e),style:{width:"192px"}},{default:c((()=>[(r(!0),o(p,null,m(f(k),(e=>(r(),b(t,{label:e.label,value:e.value},null,8,["label","value"])))),256))])),_:1},8,["modelValue"])]),u("div",V,[d(C,{bg:"",text:"",type:"primary",size:"large",style:{"font-size":"15px",height:"32px",background:"#EFF6FF",color:"#60A5FA","border-radius":"8px","margin-top":"25px"},onClick:R},{default:c((()=>a[6]||(a[6]=[g(" 查询 ")]))),_:1})]),u("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:q},[d(D,{color:"#3B82F6",size:"20"},{default:c((()=>[d($)])),_:1})])]),u("div",null,[d(C,{style:{"border-radius":"8px",border:"1px solid #3B82F6",color:"#3B82F6","font-size":"15px",height:"32px","margin-top":"25px"},onClick:E},{default:c((()=>a[7]||(a[7]=[g(" 添加管理员 ")]))),_:1})])]),u("div",P,[y((r(),b(K,{border:"",data:L.value,height:"66vh",width:"100%"},{default:c((()=>[d(N,{prop:"id",label:"管理员ID",width:"100"}),d(N,{prop:"username",label:"登录账号",width:"150"}),d(N,{label:"管理员状态",width:"100",align:"center"},{default:c((e=>[1==e.row.managerStatus?(r(),b(X,{key:0,type:"primary"},{default:c((()=>a[8]||(a[8]=[g("启用")]))),_:1})):(r(),b(X,{key:1,type:"danger"},{default:c((()=>a[9]||(a[9]=[g("停用")]))),_:1}))])),_:1}),d(N,{prop:"accessLabel",label:"权限",align:"center"},{default:c((({row:e})=>[u("p",null,v(J(e.accessLabel)),1)])),_:1}),d(N,{fixed:"right",label:"操作",width:"150",align:"center"},{default:c((e=>[u("div",A,[d(C,{link:"",type:"primary",size:"small",disabled:O(e.row.role),onClick:a=>async function(e){I.value.open(e.userId)}(e.row)},{default:c((()=>a[10]||(a[10]=[g(" 编辑 ")]))),_:2},1032,["disabled","onClick"]),d(Y,{title:"删除后不可找回，确定删除?","confirm-button-text":"确认",onConfirm:a=>(async e=>{if(0==w.isUserModifyPermissions())return x.error("非超级管理员无权限操作！");await z.deleteAccess({id:e.id}),x.success("删除管理员成功！"),await R()})(e.row)},{reference:c((()=>[d(C,{link:"",type:"danger",disabled:O(e.row.role),size:"small"},{default:c((()=>a[11]||(a[11]=[g(" 删除 ")]))),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"]),d(H,{placement:"bottom",trigger:"click",content:"this is content, this is content, this is content","popper-class":"el-popover-self"},{reference:c((()=>[u("div",null,[d(D,{size:24,style:{"margin-left":"10px"}},{default:c((()=>[d(G,{name:"more"})])),_:1})])])),default:c((()=>[u("div",null,[d(C,{link:"",type:"primary",size:"small",disabled:O(e.row.role),onClick:a=>async function(e){if(0==w.isUserModifyPermissions())return x.error("非超级管理员无权限操作！");const a={id:e.id,status:1===e.managerStatus?2:1};(await z.updateManagerStatus(a)).success&&x({type:"success",message:`管理员${1===e.managerStatus?"停用":"启用"}成功！`}),await R()}(e.row)},{default:c((()=>[g(v(1===e.row.managerStatus?"停用":"启用"),1)])),_:2},1032,["disabled","onClick"]),d(Y,{title:"确认重置此用户密码为【123456】?","confirm-button-text":"确认重置",onConfirm:a=>async function(e){if(0==w.isUserModifyPermissions())return x.error("非超级管理员无权限操作！");const{id:a}=e;(await z.resetUserPassword({id:a})).success&&x({type:"success",message:`重置管理员[ ${e.username} ]密码为初始密码为[123456]完成！`}),await R()}(e.row)},{reference:c((()=>[d(C,{link:"",type:"danger",disabled:O(e.row.role)},{default:c((()=>a[12]||(a[12]=[g(" 重置密码 ")]))),_:2},1032,["disabled"])])),_:2},1032,["onConfirm"])])])),_:2},1024)])])),_:1})])),_:1},8,["data"])),[[W,M.value]]),d(T,{class:"flex justify-end mt-5 pb-5"},{default:c((()=>[d(Q,{"current-page":B.page,"onUpdate:currentPage":a[2]||(a[2]=e=>B.page=e),"page-size":B.size,"onUpdate:pageSize":a[3]||(a[3]=e=>B.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:h.value,onSizeChange:R,onCurrentChange:R},null,8,["current-page","page-size","total"])])),_:1})])])}}});"function"==typeof h&&h(M);const B=w(M,[["__scopeId","data-v-cf85a507"]]);export{B as default};
