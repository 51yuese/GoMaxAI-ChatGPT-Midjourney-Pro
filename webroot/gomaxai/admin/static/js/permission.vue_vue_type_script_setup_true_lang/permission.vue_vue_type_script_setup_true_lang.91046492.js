
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,A as l,m as a,r as n,B as u,C as t,o as i,l as s,b as o,J as d,i as c,f as v,t as r,g as m,h as p,j as h,O as g,e as f,X as x,Y as b,x as y}from"../main-46c178e9.js";import{a as V}from"../access/access.8e3eb471.js";const j={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},k={style:{padding:"0 20px 20px"}},C={style:{display:"flex","justify-content":"space-between"}},_={style:{"padding-left":"40px"}},w=e({__name:"permission",setup(e,{expose:w}){const F=l(),M=a(),U=n(!1),O=n({}),A=n([]),I=n([]),R=n(!1),S=u((()=>I.value.length>0&&I.value.length<A.value.length));function z(){R.value?I.value=A.value:I.value=[]}function B(e){var l;["UserManage","FundManage","OperateManagement","SystemSettings"].includes(e.name)||A.value.push(e.name),null==(l=null==e?void 0:e.children)||l.map((e=>B(e)))}function E(e){var l,a;const n=null==(l=null==e?void 0:e.children)?void 0:l.filter((e=>I.value.includes(e.name))).length;return n>0&&n!==(null==(a=null==e?void 0:e.children)?void 0:a.length)}async function J(){const e=M.getRoutes().filter((e=>I.value.includes(null==e?void 0:e.name))).map((e=>e.path));await V.saveRole(Object.assign(O.value,{access:I.value.join(","),accessLabel:e.join(",")})),U.value=!1}return t((()=>I.value.length),(e=>{R.value=e===A.value.length})),i((()=>{F.allMenus[0].children.map((e=>{B(e)}))})),w({open:function(e){U.value=!0,O.value=e,I.value=O.value.access?O.value.access.split(","):[]}}),(e,l)=>{const a=y,n=s("el-icon"),u=s("el-checkbox"),t=s("el-button"),i=s("el-checkbox-group"),V=s("el-dialog");return o(),d(V,{modelValue:m(U),"onUpdate:modelValue":l[3]||(l[3]=e=>g(U)?U.value=e:null),width:"1200","show-close":!1,"destroy-on-close":""},{header:c((()=>[v("div",j,[v("div",null,r(m(O).name)+"权限管理 ",1),v("div",{style:{cursor:"pointer"},onClick:l[0]||(l[0]=e=>U.value=!1)},[p(n,null,{default:c((()=>[p(a,{name:"close"})])),_:1})])])])),default:c((()=>[v("div",k,[v("div",C,[p(u,{modelValue:m(R),"onUpdate:modelValue":l[1]||(l[1]=e=>g(R)?R.value=e:null),indeterminate:m(S),onChange:z},{default:c((()=>l[4]||(l[4]=[h(" 全选 ")]))),_:1},8,["modelValue","indeterminate"]),p(t,{bg:"",text:"",type:"danger",onClick:J},{default:c((()=>l[5]||(l[5]=[h(" 更新权限 ")]))),_:1})]),(o(!0),f(b,null,x(m(F).allMenus[0].children,(e=>(o(),f("div",{key:e.name},[(o(!0),f(b,null,x(e.children,(e=>(o(),d(i,{key:e.name,modelValue:m(I),"onUpdate:modelValue":l[2]||(l[2]=e=>g(I)?I.value=e:null)},{default:c((()=>{var l;return[p(u,{indeterminate:E(e),label:null==(l=e.meta)?void 0:l.title,value:e.name,onChange:l=>function(e,l){var a,n;e?null==(a=null==l?void 0:l.children)||a.map((e=>I.value.push(e.name))):null==(n=null==l?void 0:l.children)||n.map((e=>{const l=I.value.findIndex((l=>l===e.name));I.value.splice(l,1)}))}(l,e)},null,8,["indeterminate","label","value","onChange"]),v("div",_,[(o(!0),f(b,null,x(e.children,(l=>{var a;return o(),d(u,{key:l.name,label:null==(a=l.meta)?void 0:a.title,value:l.name,onChange:l=>function(e,l){var a;const n=I.value.includes(l.name),u=null==(a=null==l?void 0:l.children)?void 0:a.filter((e=>I.value.includes(e.name))).length;if(e&&!n)I.value.push(l.name);else if(0===u){const e=I.value.findIndex((e=>e===l.name));I.value.splice(e,1)}}(l,e)},null,8,["label","value","onChange"])})),128))])]})),_:2},1032,["modelValue"])))),128))])))),128))])])),_:1},8,["modelValue"])}}});export{w as _};
