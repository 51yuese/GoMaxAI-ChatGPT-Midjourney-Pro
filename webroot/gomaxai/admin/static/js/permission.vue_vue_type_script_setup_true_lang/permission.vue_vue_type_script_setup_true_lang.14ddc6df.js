
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,a7 as l,T as a,r as n,c as u,w as t,V as s,e as i,o,j as d,h as c,m as v,t as r,i as m,g as p,q as h,s as g,f,J as x,F as b,a4 as y}from"../main-9d6c7d62.js";import{a as V}from"../access/access.f248c1bf.js";const j={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},k={style:{padding:"0 20px 20px"}},_={style:{display:"flex","justify-content":"space-between"}},w={style:{"padding-left":"40px"}},C=e({__name:"permission",setup(e,{expose:C}){const F=l(),M=a(),U=n(!1),I=n({}),O=n([]),R=n([]),S=n(!1),q=u((()=>R.value.length>0&&R.value.length<O.value.length));function z(){S.value?R.value=O.value:R.value=[]}function A(e){var l;["UserManage","FundManage","OperateManagement","SystemSettings"].includes(e.name)||O.value.push(e.name),null==(l=null==e?void 0:e.children)||l.map((e=>A(e)))}function E(e){var l,a;const n=null==(l=null==e?void 0:e.children)?void 0:l.filter((e=>R.value.includes(e.name))).length;return n>0&&n!==(null==(a=null==e?void 0:e.children)?void 0:a.length)}async function J(){const e=M.getRoutes().filter((e=>R.value.includes(null==e?void 0:e.name))).map((e=>e.path));await V.saveRole(Object.assign(I.value,{access:R.value.join(","),accessLabel:e.join(",")})),U.value=!1}return t((()=>R.value.length),(e=>{S.value=e===O.value.length})),s((()=>{F.allMenus[0].children.map((e=>{A(e)}))})),C({open:function(e){U.value=!0,I.value=e,R.value=I.value.access?I.value.access.split(","):[]}}),(e,l)=>{const a=y,n=i("el-icon"),u=i("el-checkbox"),t=i("el-button"),s=i("el-checkbox-group"),V=i("el-dialog");return o(),d(V,{modelValue:m(U),"onUpdate:modelValue":l[3]||(l[3]=e=>g(U)?U.value=e:null),width:"1200","show-close":!1,"destroy-on-close":""},{header:c((()=>[v("div",j,[v("div",null,r(m(I).name)+"权限管理 ",1),v("div",{style:{cursor:"pointer"},onClick:l[0]||(l[0]=e=>U.value=!1)},[p(n,null,{default:c((()=>[p(a,{name:"close"})])),_:1})])])])),default:c((()=>[v("div",k,[v("div",_,[p(u,{modelValue:m(S),"onUpdate:modelValue":l[1]||(l[1]=e=>g(S)?S.value=e:null),indeterminate:m(q),onChange:z},{default:c((()=>l[4]||(l[4]=[h(" 全选 ")]))),_:1},8,["modelValue","indeterminate"]),p(t,{bg:"",text:"",type:"danger",onClick:J},{default:c((()=>l[5]||(l[5]=[h(" 更新权限 ")]))),_:1})]),(o(!0),f(b,null,x(m(F).allMenus[0].children,(e=>(o(),f("div",{key:e.name},[(o(!0),f(b,null,x(e.children,(e=>(o(),d(s,{key:e.name,modelValue:m(R),"onUpdate:modelValue":l[2]||(l[2]=e=>g(R)?R.value=e:null)},{default:c((()=>{var l;return[p(u,{indeterminate:E(e),label:null==(l=e.meta)?void 0:l.title,value:e.name,onChange:l=>function(e,l){var a,n;e?null==(a=null==l?void 0:l.children)||a.map((e=>R.value.push(e.name))):null==(n=null==l?void 0:l.children)||n.map((e=>{const l=R.value.findIndex((l=>l===e.name));R.value.splice(l,1)}))}(l,e)},null,8,["indeterminate","label","value","onChange"]),v("div",w,[(o(!0),f(b,null,x(e.children,(l=>{var a;return o(),d(u,{key:l.name,label:null==(a=l.meta)?void 0:a.title,value:l.name,onChange:l=>function(e,l){var a;const n=R.value.includes(l.name),u=null==(a=null==l?void 0:l.children)?void 0:a.filter((e=>R.value.includes(e.name))).length;if(e&&!n)R.value.push(l.name);else if(0===u){const e=R.value.findIndex((e=>e===l.name));R.value.splice(e,1)}}(l,e)},null,8,["label","value","onChange"])})),128))])]})),_:2},1032,["modelValue"])))),128))])))),128))])])),_:1},8,["modelValue"])}}});export{C as _};
