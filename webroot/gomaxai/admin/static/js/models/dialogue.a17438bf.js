
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,U as l,r as a,c as t,C as d,V as o,e as i,ah as r,o as u,f as s,m as p,g as n,h as m,F as c,J as y,j as g,i as v,k as f,q as k,Y as b,t as h,s as x,ae as V,A as w,b6 as _,a4 as U,a1 as F}from"../main-98fa617f.js";import{h as T,i as z,B as A,b as N,Q as q,k as C,j}from"../index/index.cfc6c5fc.js";import{A as B}from"./models.b1c5c1d8.js";const I={class:"dialogue_model_box"},S={style:{"margin-bottom":"32px"}},W={class:"search_condition"},Q={style:{display:"flex","align-items":"center"}},M={style:{"margin-left":"12px"}},P={style:{"margin-left":"12px"}},E={style:{"margin-left":"12px"}},K={style:{"margin-top":"22px","margin-left":"12px"}},R={style:{"margin-top":"22px"}},J={style:{"margin-top":"12px"}},O={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},Y={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},D={style:{display:"flex","align-items":"center","justify-content":"space-between"}},G={style:{display:"flex","align-items":"center","justify-content":"space-between"}},H={style:{display:"flex","align-items":"center","justify-content":"space-between"}},L={style:{display:"flex","align-items":"center","justify-content":"space-between"}},X={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Z={style:{"margin-left":"61px",width:"100%",display:"flex","align-items":"center"}},$={style:{display:"flex","align-items":"center"}},ee={style:{display:"flex","align-items":"center","margin-left":"20px"}},le={style:{display:"flex","align-items":"center","margin-left":"20px"}},ae={style:{display:"flex","align-items":"center","margin-left":"20px"}},te={style:{display:"flex","align-items":"center","margin-left":"20px"}},de={style:{display:"flex","align-items":"center","margin-left":"20px"}},oe={style:{"margin-left":"61px",width:"100%",display:"flex","align-items":"center"}},ie={style:{display:"flex","align-items":"center"}},re={key:0,style:{display:"flex","align-items":"center","margin-left":"20px","flex-grow":"1"}},ue={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},se=F(e({__name:"dialogue",setup(e){const F=l(),se=a(),pe=a([]),ne=a(0),me=a(!1),ce=a(!1),ye=a(!1),ge=a(0),ve=t((()=>ge.value?"更新秘钥":"新增秘钥")),fe=t((()=>ge.value?"确认更新":"确认新增")),ke=d({keyType:"",model:"",status:null,modelType:T[0].value,page:1,size:10,deepthink:-1,online:-1}),be=d({proxyUrl:"",key:"",secret:"",appid:"",model:"",modelName:"",keyType:1,vipFreeNum:0,displaySort:0,deduct:1,keyWeight:0,description:"",status:!0,canUpload:!1,sug:!1,canAudio:!1,front:!0,modelType:"chat",cover:"",deepthink:0,online:0,isQuick:0,quickIds:"",userType:""}),he=d({keyType:[{required:!0,message:"请选择您的调用模型类型",trigger:"blur"}],secret:[{required:!0,message:"请输入调用模型的secret",trigger:"blur"}],appid:[{required:!0,message:"请输入调用模型的appid",trigger:"blur"}],vipFreeNum:[{required:!0,message:"请填写会员每日可用的最大次数",trigger:"blur"}],model:[{required:!0,message:"请选择您需要使用的模型",trigger:"blur"}],modelName:[{required:!0,message:"为您的模型取一个名字吧",trigger:"blur"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],keyWeight:[{required:!0,message:"请填写key的权重值",trigger:"blur"}],key:[{required:!0,message:"请填写您的调用模型key",trigger:"blur"}],description:[{required:!0,message:"请填写模型的描述",trigger:"blur"}]});async function xe(){try{me.value=!0;const e=await B.queryModels(ke);me.value=!1;const{rows:l,count:a}=e.data;ne.value=a,pe.value=l}catch(e){me.value=!1}}function Ve(){ke.page=1,ke.size=10,ke.keyType="",ke.model="",ke.status=null,xe()}function we(){ge.value=0,be.proxyUrl="",be.key="",be.secret="",be.appid="",be.model="",be.modelName="",be.status=!0,be.canUpload=!1,be.canAudio=!1,be.front=!0,be.keyType=1,be.vipFreeNum=0,be.displaySort=0,be.deduct=1,be.keyWeight=0,be.modelType="chat",be.description="",be.cover="",be.deepthink=0,be.online=0,be.quickIds="",be.isQuick=0,be.userType="",ce.value=!0}function _e(e){be.vipFreeNum=1==e?-1:0}function Ue(){se.value.validate((async e=>{if(!e)return;if(0==F.isUserModifyPermissions())return V.error("非超级管理员无权限操作！");if(0==ye.value&&be.vipFreeNum<0)return void V({type:"error",message:"会员每日可用次数不能小于零"});const l=_(be);delete l.id,ge.value&&(l.id=ge.value);const a=await B.setModels(l);200==a.code?(V({type:"success",message:"操作成功"}),ce.value=!1,xe()):V({type:"error",message:a.data})}))}function Fe(){be.model=""}return o((()=>{xe()})),(e,l)=>{const a=i("el-alert"),t=i("el-option"),d=i("el-select"),o=i("el-input"),_=i("el-button"),T=i("RefreshRight"),Te=i("el-icon"),ze=i("el-table-column"),Ae=i("ElsColumnImage"),Ne=i("el-tag"),qe=i("el-popconfirm"),Ce=i("el-table"),je=i("el-pagination"),Be=i("el-row"),Ie=U,Se=i("el-form-item"),We=i("els-upload"),Qe=i("els-select"),Me=i("el-switch"),Pe=i("els-switch"),Ee=i("el-form"),Ke=i("el-dialog"),Re=r("loading");return u(),s("div",I,[p("div",S,[n(a,{closable:!1,"show-icon":"",title:"说明",description:"key启动就会调用，未启动则不会调用，同一个key支持添加到多个模型",type:"warning"})]),p("div",W,[p("div",Q,[p("div",null,[l[33]||(l[33]=p("div",{class:"search_title"}," 模型类型 ",-1)),p("div",null,[n(d,{modelValue:ke.keyType,"onUpdate:modelValue":l[0]||(l[0]=e=>ke.keyType=e),placeholder:"请选择模型类型",style:{width:"150px"}},{default:m((()=>[(u(!0),s(c,null,y(v(z),(e=>(u(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",M,[l[34]||(l[34]=p("div",{class:"search_title"}," 使用模型 ",-1)),p("div",null,[n(o,{modelValue:ke.model,"onUpdate:modelValue":l[2]||(l[2]=e=>ke.model=e),style:{"max-width":"600px",width:"150px"},placeholder:"请选择使用模型",class:"input-with-select"},{suffix:m((()=>[n(d,{modelValue:ke.model,"onUpdate:modelValue":l[1]||(l[1]=e=>ke.model=e),placeholder:"Select",style:{width:"30px",border:"none"}},{default:m((()=>[2===ke.keyType?(u(!0),s(c,{key:0},y(v(A),(e=>(u(),g(t,{key:e,label:e,value:e},null,8,["label","value"])))),128)):f("",!0),(u(!0),s(c,null,y(v(N),(e=>(u(),g(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])]),p("div",P,[l[35]||(l[35]=p("div",{class:"search_title"}," 启用状态 ",-1)),p("div",null,[n(d,{modelValue:ke.status,"onUpdate:modelValue":l[3]||(l[3]=e=>ke.status=e),placeholder:"请选择启用状态",style:{width:"120px"}},{default:m((()=>[(u(!0),s(c,null,y(v(q),(e=>(u(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",E,[l[36]||(l[36]=p("div",{class:"search_title"}," 深度思考 ",-1)),p("div",null,[n(d,{modelValue:ke.deepthink,"onUpdate:modelValue":l[4]||(l[4]=e=>ke.deepthink=e),placeholder:"请选择启用状态",style:{width:"120px"}},{default:m((()=>[(u(!0),s(c,null,y(v(C),(e=>(u(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",K,[n(_,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:xe},{default:m((()=>l[37]||(l[37]=[k(" 查询 ")]))),_:1})]),p("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:Ve},[n(Te,{color:"#3B82F6",size:"20"},{default:m((()=>[n(T)])),_:1})])]),p("div",R,[n(_,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:we},{default:m((()=>l[38]||(l[38]=[k(" 添加key ")]))),_:1})])]),p("div",J,[b((u(),g(Ce,{border:"",data:v(pe),style:{"font-size":"13px",width:"100%"},"max-height":"60vh"},{default:m((()=>[n(ze,{prop:"displaySort",label:"排序id"}),n(ze,{label:"模型类型"},{default:m((e=>[k(h(v(j)[e.row.keyType]),1)])),_:1}),n(Ae,{prop:"cover",label:"图标"}),n(ze,{prop:"modelName",label:"自定义模型名称"}),n(ze,{prop:"model",label:"绑定模型"}),n(ze,{prop:"status",label:"是否启用"},{default:m((e=>[1==e.row.status?(u(),g(Ne,{key:0,type:"primary"},{default:m((()=>l[39]||(l[39]=[k(" 启用 ")]))),_:1})):(u(),g(Ne,{key:1,type:"info"},{default:m((()=>l[40]||(l[40]=[k(" 禁用 ")]))),_:1}))])),_:1}),n(ze,{prop:"key",label:"模型key"}),n(ze,{prop:"proxyUrl",label:"代理地址"},{default:m((e=>[k(h(""==e.row.proxyUrl?"——":e.row.proxyUrl),1)])),_:1}),n(ze,{prop:"keyWeight",label:"模型权重"}),n(ze,{label:"操作",fixed:"right",width:"160"},{default:m((e=>[n(_,{style:{border:"none",color:"#3B82F6","font-size":"13px","background-color":"transparent"},onClick:l=>{return a=e.row,ge.value=a.id,a.vipFreeNum,ye.value,w((()=>{const{proxyUrl:e,key:l,secret:t,appid:d,userType:o,model:i,modelName:r,online:u,sug:s,status:p,canUpload:n,canAudio:m,front:c,keyType:y,vipFreeNum:g,displaySort:v,deduct:f,keyWeight:k,modelType:b,description:h,cover:x,deepthink:V,quickIds:w,isQuick:_}=a;Object.assign(be,{proxyUrl:e,key:l,userType:o,secret:t,appid:d,sug:s,online:u,model:i,cover:x,modelName:r,status:p,canUpload:n,canAudio:m,front:c,keyType:y,vipFreeNum:g,displaySort:v,deduct:f,keyWeight:k,modelType:b,description:h,deepthink:V,quickIds:w,isQuick:_})})),void(ce.value=!0);var a}},{default:m((()=>l[41]||(l[41]=[k(" 编辑 ")]))),_:2},1032,["onClick"]),n(qe,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:l=>async function(e){if(0==F.isUserModifyPermissions())return V.error("非超级管理员无权限操作！");const{id:l}=e;await B.delModels({id:l}),V({type:"success",message:"操作完成！"}),xe()}(e.row)},{reference:m((()=>[n(_,{style:{border:"none",color:"#FF3B30","font-size":"13px","background-color":"transparent"}},{default:m((()=>l[42]||(l[42]=[k(" 删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[Re,v(me)]]),n(Be,{class:"flex justify-end mt-5"},{default:m((()=>[n(je,{"current-page":ke.page,"onUpdate:currentPage":l[5]||(l[5]=e=>ke.page=e),"page-size":ke.size,"onUpdate:pageSize":l[6]||(l[6]=e=>ke.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:v(ne),onSizeChange:xe,onCurrentChange:xe},null,8,["current-page","page-size","total"])])),_:1})]),n(Ke,{modelValue:v(ce),"onUpdate:modelValue":l[32]||(l[32]=e=>x(ce)?ce.value=e:null),width:"900","show-close":!1,"destroy-on-close":""},{header:m((({close:e,titleId:a,titleClass:t})=>[p("div",O,[p("div",null,h(ve.value),1),p("div",{style:{cursor:"pointer"},onClick:l[7]||(l[7]=e=>ce.value=!1)},[n(Te,null,{default:m((()=>[n(Ie,{name:"close"})])),_:1})])])])),default:m((()=>[p("div",Y,[n(Ee,{ref_key:"addModelKeyFormRef",ref:se,rules:he,model:be,"label-width":"auto",style:{"max-width":"850px"}},{default:m((()=>[p("div",D,[n(Se,{label:"自定义模型名称",prop:"modelName"},{default:m((()=>[n(o,{modelValue:be.modelName,"onUpdate:modelValue":l[8]||(l[8]=e=>be.modelName=e),size:"large",style:{width:"250px"},placeholder:"请填写模型名称"},null,8,["modelValue"])])),_:1}),n(Se,{label:"单次消耗积分",prop:"deduct"},{default:m((()=>[n(o,{modelValue:be.deduct,"onUpdate:modelValue":l[9]||(l[9]=e=>be.deduct=e),size:"large",style:{width:"250px"},placeholder:"请填写单次消耗的积分量",type:"number"},null,8,["modelValue"])])),_:1})]),p("div",G,[n(Se,{label:"模型图标",prop:"cover"},{default:m((()=>[n(We,{type:"Pic",modelValue:be.cover,"onUpdate:modelValue":l[10]||(l[10]=e=>be.cover=e)},null,8,["modelValue"])])),_:1}),n(Se,{label:"会员类型",prop:"deduct"},{default:m((()=>[n(Qe,{url:"dict/list?dictType=vip-leavel",width:"250",size:"large",multiple:"","collapse-tags":!0,modelValue:be.userType,"onUpdate:modelValue":l[11]||(l[11]=e=>be.userType=e),"label-field":"dictName","value-field":"id"},null,8,["modelValue"])])),_:1})]),p("div",H,[n(Se,{label:"模型类型选择",prop:"keyType"},{default:m((()=>[n(d,{modelValue:be.keyType,"onUpdate:modelValue":l[12]||(l[12]=e=>be.keyType=e),size:"large",style:{width:"250px"},placeholder:"请选择模型的类型",onChange:Fe},{default:m((()=>[(u(!0),s(c,null,y(v(z),(e=>(u(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(Se,{label:"模型显示排序"},{default:m((()=>[n(o,{modelValue:be.displaySort,"onUpdate:modelValue":l[13]||(l[13]=e=>be.displaySort=e),size:"large",style:{width:"250px"},type:"number",placeholder:"请填写模型的排序"},null,8,["modelValue"])])),_:1})]),p("div",L,[n(Se,{label:"调用轮询权重",prop:"keyWeight"},{default:m((()=>[n(o,{modelValue:be.keyWeight,"onUpdate:modelValue":l[14]||(l[14]=e=>be.keyWeight=e),size:"large",style:{width:"250px"},placeholder:"请填写轮询权重",type:"number"},null,8,["modelValue"])])),_:1}),1!=v(ye)?(u(),g(Se,{key:0,label:"会员每日可用次数",prop:"vipFreeNum"},{default:m((()=>[n(o,{modelValue:be.vipFreeNum,"onUpdate:modelValue":l[15]||(l[15]=e=>be.vipFreeNum=e),size:"large",style:{width:"250px"},placeholder:"请填写会员单日可用的次数",type:"number"},null,8,["modelValue"])])),_:1})):f("",!0)]),p("div",X,[n(Se,{label:"使用模型",prop:"model"},{default:m((()=>[n(o,{modelValue:be.model,"onUpdate:modelValue":l[17]||(l[17]=e=>be.model=e),size:"large",style:{width:"250px"},placeholder:"请选择使用模型",class:"input-with-select_dialog"},{suffix:m((()=>[8!==be.keyType?(u(),g(d,{key:0,modelValue:be.model,"onUpdate:modelValue":l[16]||(l[16]=e=>be.model=e),style:{width:"30px",border:"none"}},{default:m((()=>[2===be.keyType?(u(!0),s(c,{key:0},y(v(A),(e=>(u(),g(t,{key:e,label:e,value:e},null,8,["label","value"])))),128)):(u(!0),s(c,{key:1},y(v(N),(e=>(u(),g(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):f("",!0)])),_:1},8,["modelValue"])])),_:1}),be.keyType==v(z)[0].value||be.keyType==v(z)[4].value?(u(),g(Se,{key:0,label:"指定代理地址"},{default:m((()=>[n(o,{modelValue:be.proxyUrl,"onUpdate:modelValue":l[18]||(l[18]=e=>be.proxyUrl=e),size:"large",style:{width:"200px"},placeholder:"请填写模型代理地址"},null,8,["modelValue"])])),_:1})):f("",!0)]),n(Se,{label:be.keyType==z[0].value||be.keyType==z[3].value||be.keyType==z[4].value?"API Key":be.keyType==z[1].value?"ClientId":be.keyType==z[2].value?"AppKey":void 0,prop:"key"},{default:m((()=>[n(o,{modelValue:be.key,"onUpdate:modelValue":l[19]||(l[19]=e=>be.key=e),size:"large",placeholder:"请填写模型Key l clientld l Appld"},null,8,["modelValue"])])),_:1},8,["label"]),be.keyType==v(z)[1].value||be.keyType==v(z)[3].value?(u(),g(Se,{key:0,label:"SecretKey",prop:"secret"},{default:m((()=>[n(o,{modelValue:be.secret,"onUpdate:modelValue":l[20]||(l[20]=e=>be.secret=e),size:"large",placeholder:"请添加模型调用所需的secret"},null,8,["modelValue"])])),_:1})):f("",!0),be.keyType==v(z)[3].value?(u(),g(Se,{key:1,label:"AppId",prop:"appid"},{default:m((()=>[n(o,{modelValue:be.appid,"onUpdate:modelValue":l[21]||(l[21]=e=>be.appid=e),size:"large",placeholder:"请添加模型调用所需的AppId"},null,8,["modelValue"])])),_:1})):f("",!0),n(Se,{label:"模型描述",prop:"description"},{default:m((()=>[n(o,{modelValue:be.description,"onUpdate:modelValue":l[22]||(l[22]=e=>be.description=e),size:"large",placeholder:"请填写模型的描述"},null,8,["modelValue"])])),_:1}),n(Se,null,{default:m((()=>[p("div",Z,[p("div",$,[l[43]||(l[43]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}}," 启用状态 ",-1)),p("div",null,[n(Me,{modelValue:be.status,"onUpdate:modelValue":l[23]||(l[23]=e=>be.status=e)},null,8,["modelValue"])])]),p("div",ee,[l[44]||(l[44]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}}," 会员免费 ",-1)),p("div",null,[n(Me,{modelValue:v(ye),"onUpdate:modelValue":l[24]||(l[24]=e=>x(ye)?ye.value=e:null),onChange:_e},null,8,["modelValue"])])]),p("div",le,[l[45]||(l[45]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}}," 上传文档 ",-1)),p("div",null,[n(Me,{modelValue:be.canUpload,"onUpdate:modelValue":l[25]||(l[25]=e=>be.canUpload=e)},null,8,["modelValue"])])]),p("div",ae,[l[46]||(l[46]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}}," 联网搜索 ",-1)),p("div",null,[n(Pe,{modelValue:be.online,"onUpdate:modelValue":l[26]||(l[26]=e=>be.online=e)},null,8,["modelValue"])])]),p("div",te,[l[47]||(l[47]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}}," 深度思考 ",-1)),p("div",null,[n(Pe,{modelValue:be.deepthink,"onUpdate:modelValue":l[27]||(l[27]=e=>be.deepthink=e)},null,8,["modelValue"])])]),p("div",de,[l[48]||(l[48]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}}," 推荐问题 ",-1)),p("div",null,[n(Me,{modelValue:be.sug,"onUpdate:modelValue":l[28]||(l[28]=e=>be.sug=e)},null,8,["modelValue"])])])])])),_:1}),n(Se,null,{default:m((()=>[p("div",oe,[p("div",ie,[l[49]||(l[49]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}}," 启用快捷工具 ",-1)),p("div",null,[n(Pe,{modelValue:be.isQuick,"onUpdate:modelValue":l[29]||(l[29]=e=>be.isQuick=e)},null,8,["modelValue"])])]),1==be.isQuick?(u(),s("div",re,[n(Qe,{url:"/admin/model/quick/alllist","label-field":"name","value-field":"id",placeholder:"选择快捷工具",modelValue:be.quickIds,"onUpdate:modelValue":l[30]||(l[30]=e=>be.quickIds=e),multiple:""},null,8,["modelValue"])])):f("",!0)])])),_:1})])),_:1},8,["rules","model"])]),p("div",ue,[n(_,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[31]||(l[31]=e=>ce.value=!1)},{default:m((()=>l[50]||(l[50]=[k(" 取消 ")]))),_:1}),n(_,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:Ue},{default:m((()=>[k(h(fe.value),1)])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f9052fd9"]]);export{se as default};
