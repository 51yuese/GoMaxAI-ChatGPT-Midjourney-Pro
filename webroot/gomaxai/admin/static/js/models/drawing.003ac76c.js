
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,U as l,r as a,c as t,C as o,V as r,e as d,ah as i,o as s,f as u,m as p,g as n,h as m,F as c,J as y,j as g,i as f,q as b,Y as v,t as h,k,s as x,ae as _,A as w,b6 as V,b as F,a4 as T,a1 as U}from"../main-98fa617f.js";import{h as z,b as N,Q as C}from"../index/index.cfc6c5fc.js";import{A}from"./models.b1c5c1d8.js";import{u as j}from"../utcformatTime/utcformatTime.f6db2c52.js";const S={class:"dialogue_model_box"},q={style:{"margin-bottom":"32px"}},P={class:"search_condition"},W={style:{display:"flex","align-items":"center"}},B={style:{"margin-top":"22px","margin-left":"12px"}},M={style:{"margin-top":"22px"}},E={style:{"margin-top":"12px"}},K={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},Y={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)",height:"calc(100vh - 300px)",overflow:"scroll"}},I={style:{"margin-left":"61px",width:"100%",display:"flex","align-items":"center"}},R={style:{display:"flex","align-items":"center"}},D={style:{display:"flex","align-items":"center","margin-left":"20px"}},L={style:{"margin-top":"10px","margin-bottom":"20px"}},G={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},J=U(e({__name:"drawing",setup(e){const U=l(),J=a(),O=a([]),Q=a(0),H=a(!1),X=a(!1),Z=a(!1),$=a(0),ee=t((()=>$.value?"更新秘钥":"新增秘钥")),le=t((()=>$.value?"确认更新":"确认新增")),ae=o({keyType:"",model:"",status:null,modelType:z[2].value,page:1,size:10}),te=o({modelName:"",keyType:1,model:"",deduct:1,displaySort:0,keyWeight:0,vipFreeNum:0,proxyUrl:"",key:"",status:!1,modelType:"draw",secret:"",remark:"",tags:"",userType:"",children:[]});o([[],N,["kling-v1","kling-v1-5","kling-v2"],["jimeng_high_aes_general_v21_L"]]);const oe=o({keyType:[{required:!0,message:"请选择您的调用模型类型",trigger:"blur"}],vipFreeNum:[{required:!0,message:"请填写会员每日可用的最大次数",trigger:"blur"}],model:[{required:!0,message:"请选择您需要使用的模型",trigger:"blur"}],modelName:[{required:!0,message:"为您的模型取一个名字吧",trigger:"blur"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],keyWeight:[{required:!0,message:"请填写key的权重值",trigger:"blur"}],key:[{required:!0,message:"请填写您的调用模型key",trigger:"blur"}]});async function re(){try{H.value=!0;const e=await A.queryModels(ae);H.value=!1;const{rows:l,count:a}=e.data;Q.value=a,O.value=l}catch(e){H.value=!1}}function de(){ae.page=1,ae.size=10,ae.keyType="",ae.model="",ae.status=null,re()}function ie(){$.value=0,te.modelName="",te.model="",te.keyType=1,te.secret="",te.deduct=1,te.keyWeight=0,te.vipFreeNum=0,te.displaySort=0,te.proxyUrl="",te.key="",te.status=!1,te.modelType="draw",te.tags="",te.remark="",te.children=[],X.value=!0}function se(e){te.vipFreeNum=1==e?-1:0}function ue(){J.value.validate((async e=>{if(!e)return;if(0==U.isUserModifyPermissions())return _.error("非超级管理员无权限操作！");if(0==Z.value&&te.vipFreeNum<0)return void _({type:"error",message:"会员每日可用次数不能小于零"});const l=V(te);if(delete l.id,$.value&&(l.id=$.value),1===Number(te.keyType)){const e=V(te.key);l.key=e.split("\n")}const a=await A.setModels(l);200==a.code?(_({type:"success",message:"操作成功"}),X.value=!1,re()):_({type:"error",message:a.data})}))}const pe=a([{label:"GPT",value:1},{label:"可灵",value:2},{label:"即梦",value:3},{label:"Nano",value:4},{label:"Flux",value:5}]);function ne(){te.children.push({id:F.shortid(),label:"",value:"",desc:"",new:!1,deduct:0,vipFreeNum:0})}return r((()=>{re()})),(e,l)=>{const a=d("el-alert"),t=d("el-option"),o=d("el-select"),r=d("el-button"),V=d("RefreshRight"),F=d("el-icon"),z=d("el-table-column"),N=d("el-tag"),me=d("el-popconfirm"),ce=d("el-table"),ye=d("el-pagination"),ge=d("el-row"),fe=T,be=d("ElsCaption"),ve=d("el-input"),he=d("el-form-item"),ke=d("el-col"),xe=d("els-select"),_e=d("el-switch"),we=d("els-input"),Ve=d("ElsColumn"),Fe=d("ElsTable"),Te=d("el-form"),Ue=d("el-dialog"),ze=i("loading");return s(),u("div",S,[p("div",q,[n(a,{closable:!1,"show-icon":"",title:"说明",description:"这里配置的DALL绘画模型，Key启动就会调用，未启动则不会调用",type:"warning"})]),p("div",P,[p("div",W,[p("div",null,[l[18]||(l[18]=p("div",{class:"search_title"},"启用状态",-1)),p("div",null,[n(o,{modelValue:ae.status,"onUpdate:modelValue":l[0]||(l[0]=e=>ae.status=e),placeholder:"请选择启用状态",style:{width:"120px"}},{default:m((()=>[(s(!0),u(c,null,y(f(C),(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",B,[n(r,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:re},{default:m((()=>l[19]||(l[19]=[b("查询 ")]))),_:1})]),p("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:de},[n(F,{color:"#3B82F6",size:"20"},{default:m((()=>[n(V)])),_:1})])]),p("div",M,[n(r,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:ie},{default:m((()=>l[20]||(l[20]=[b("添加key ")]))),_:1})])]),p("div",E,[v((s(),g(ce,{border:"",data:f(O),style:{"font-size":"13px",width:"100%"},"max-height":"65vh"},{default:m((()=>[n(z,{prop:"displaySort",label:"排序id",width:"100"}),n(z,{prop:"modelName",label:"自定义模型名称"}),n(z,{prop:"status",label:"是否启用",width:"100"},{default:m((e=>[1==e.row.status?(s(),g(N,{key:0,type:"primary"},{default:m((()=>l[21]||(l[21]=[b("启用")]))),_:1})):(s(),g(N,{key:1,type:"info"},{default:m((()=>l[22]||(l[22]=[b("禁用")]))),_:1}))])),_:1}),n(z,{prop:"model",label:"使用模型"}),n(z,{prop:"key",label:"模型key",width:"300"}),n(z,{prop:"proxyUrl",label:"代理地址",width:"200"},{default:m((e=>[b(h(""==e.row.proxyUrl?"——":e.row.proxyUrl),1)])),_:1}),n(z,{prop:"keyWeight",label:"模型权重",width:"100"}),n(z,{prop:"deduct",label:"单次扣除",width:"100"}),n(z,{prop:"useCount",label:"调用次数"}),n(z,{prop:"useToken",label:"已使用token"}),n(z,{prop:"createdAt",label:"添加时间",width:"200"},{default:m((e=>[b(h(f(j)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),n(z,{label:"操作",fixed:"right",width:"160"},{default:m((e=>[n(r,{style:{border:"none",color:"#3B82F6","font-size":"13px","background-color":"transparent"},onClick:l=>{return a=e.row,$.value=a.id,a.vipFreeNum,Z.value,w((()=>{const{modelName:e,model:l,keyType:t,children:o,deduct:r,userType:d,keyWeight:i,vipFreeNum:s,displaySort:u,proxyUrl:p,key:n,status:m,modelType:c,secret:y,tags:g,remark:f}=a;Object.assign(te,{modelName:e,model:l,children:o,userType:d,keyType:t,deduct:r,keyWeight:i,vipFreeNum:s,displaySort:u,proxyUrl:p,key:n,status:m,modelType:c,secret:y,tags:g,remark:f}),te.children||(te.children=[])})),void(X.value=!0);var a}},{default:m((()=>l[23]||(l[23]=[b("编辑 ")]))),_:2},1032,["onClick"]),n(me,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:l=>async function(e){if(0==U.isUserModifyPermissions())return _.error("非超级管理员无权限操作！");const{id:l}=e;await A.delModels({id:l}),_({type:"success",message:"操作完成！"}),re()}(e.row)},{reference:m((()=>[n(r,{style:{border:"none",color:"#FF3B30","font-size":"13px","background-color":"transparent"}},{default:m((()=>l[24]||(l[24]=[b("删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[ze,f(H)]]),n(ge,{class:"flex justify-end mt-5"},{default:m((()=>[n(ye,{"current-page":ae.page,"onUpdate:currentPage":l[1]||(l[1]=e=>ae.page=e),"page-size":ae.size,"onUpdate:pageSize":l[2]||(l[2]=e=>ae.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:f(Q),onSizeChange:re,onCurrentChange:re},null,8,["current-page","page-size","total"])])),_:1})]),n(Ue,{modelValue:f(X),"onUpdate:modelValue":l[17]||(l[17]=e=>x(X)?X.value=e:null),width:"60%","show-close":!1,"destroy-on-close":"",top:"80px"},{header:m((({close:e,titleId:a,titleClass:t})=>[p("div",K,[p("div",null,h(ee.value),1),p("div",{onClick:l[3]||(l[3]=e=>X.value=!1),style:{cursor:"pointer"}},[n(F,null,{default:m((()=>[n(fe,{name:"close"})])),_:1})])])])),default:m((()=>[p("div",Y,[n(be,{type:"left"},{default:m((()=>l[25]||(l[25]=[b("基础信息")]))),_:1}),n(Te,{ref_key:"addModelKeyFormRef",ref:J,rules:oe,model:te,"label-width":"auto"},{default:m((()=>[n(ge,null,{default:m((()=>[n(ke,{span:12},{default:m((()=>[n(he,{label:"自定义模型名称",prop:"modelName"},{default:m((()=>[n(ve,{modelValue:te.modelName,"onUpdate:modelValue":l[4]||(l[4]=e=>te.modelName=e),size:"large"},null,8,["modelValue"])])),_:1})])),_:1}),n(ke,{span:12},{default:m((()=>[n(he,{label:"模型类型选择",prop:"keyType"},{default:m((()=>[n(o,{modelValue:te.keyType,"onUpdate:modelValue":l[5]||(l[5]=e=>te.keyType=e),size:"large",placeholder:"请选择模型的类型"},{default:m((()=>[(s(!0),u(c,null,y(f(pe),(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),n(he,{label:"会员类型",prop:"deduct"},{default:m((()=>[n(xe,{url:"dict/list?dictType=vip-leavel",size:"large",multiple:"",modelValue:te.userType,"onUpdate:modelValue":l[6]||(l[6]=e=>te.userType=e),"label-field":"dictName","value-field":"id"},null,8,["modelValue"])])),_:1}),n(ge,null,{default:m((()=>[n(ke,{span:12},{default:m((()=>[n(he,{label:"模型显示排序"},{default:m((()=>[n(ve,{modelValue:te.displaySort,"onUpdate:modelValue":l[7]||(l[7]=e=>te.displaySort=e),size:"large",type:"number",placeholder:"请填写模型的排序"},null,8,["modelValue"])])),_:1})])),_:1}),n(ke,{span:12},{default:m((()=>[1!=f(Z)?(s(),g(he,{key:0,label:"调用轮询权重",prop:"keyWeight"},{default:m((()=>[n(ve,{modelValue:te.keyWeight,"onUpdate:modelValue":l[8]||(l[8]=e=>te.keyWeight=e),size:"large",placeholder:"请填写轮询权重",type:"number"},null,8,["modelValue"])])),_:1})):k("",!0)])),_:1})])),_:1}),n(he,{label:"指定代理地址"},{default:m((()=>[n(ve,{modelValue:te.proxyUrl,"onUpdate:modelValue":l[9]||(l[9]=e=>te.proxyUrl=e),size:"large",placeholder:"请填写模型代理地址"},null,8,["modelValue"])])),_:1}),n(he,{label:"API Key",prop:"key"},{default:m((()=>[n(ve,{modelValue:te.key,"onUpdate:modelValue":l[10]||(l[10]=e=>te.key=e),size:"large",placeholder:"请填写模型Key l clientld l Appld"},null,8,["modelValue"])])),_:1}),3==te.keyType?(s(),g(he,{key:0,label:"API Secret",prop:"secret"},{default:m((()=>[n(ve,{modelValue:te.secret,"onUpdate:modelValue":l[11]||(l[11]=e=>te.secret=e),size:"large",placeholder:"请填写模型secret"},null,8,["modelValue"])])),_:1})):k("",!0),n(he,null,{default:m((()=>[p("div",I,[p("div",R,[l[26]||(l[26]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"启用状态",-1)),p("div",null,[n(_e,{modelValue:te.status,"onUpdate:modelValue":l[12]||(l[12]=e=>te.status=e)},null,8,["modelValue"])])]),p("div",D,[l[27]||(l[27]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"会员免费",-1)),p("div",null,[n(_e,{modelValue:f(Z),"onUpdate:modelValue":l[13]||(l[13]=e=>x(Z)?Z.value=e:null),onChange:se},null,8,["modelValue"])])])])])),_:1}),n(he,{label:"模型描述"},{default:m((()=>[n(we,{type:"textarea",modelValue:te.remark,"onUpdate:modelValue":l[14]||(l[14]=e=>te.remark=e)},null,8,["modelValue"])])),_:1}),n(be,{type:"left"},{default:m((()=>l[28]||(l[28]=[b("模型列表")]))),_:1}),n(Fe,{modelValue:te.children,"onUpdate:modelValue":l[15]||(l[15]=e=>te.children=e),"is-edit":"","drag-row":"",ref:"tableRef",rowKey:"id"},{default:m((()=>[n(Ve,{label:"模型名称",prop:"label",width:"150"}),n(Ve,{label:"模型值",prop:"value",width:"150"}),n(Ve,{label:"单次消耗",prop:"deduct",width:"150","edit-component":{name:"els-input-number",props:{min:0,step:.01,precision:2,controlsPosition:"right"}}}),n(Ve,{label:"免费次数",prop:"vipFreeNum",width:"150","edit-component":{name:"els-input-number",props:{min:0,controlsPosition:"right"}}}),n(Ve,{label:"描述",prop:"desc"}),n(Ve,{label:"New",prop:"new",width:"60","edit-component":{name:"els-switch",props:{activeValue:!0,inactiveValue:!1}}})])),_:1},8,["modelValue"]),p("div",L,[n(r,{text:"",bg:"",onClick:ne},{default:m((()=>l[29]||(l[29]=[b("添加模型")]))),_:1})])])),_:1},8,["rules","model"])]),p("div",G,[n(r,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[16]||(l[16]=e=>X.value=!1)},{default:m((()=>l[30]||(l[30]=[b("取消 ")]))),_:1}),n(r,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:ue},{default:m((()=>[b(h(le.value),1)])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-8b168cdd"]]);export{J as default};
