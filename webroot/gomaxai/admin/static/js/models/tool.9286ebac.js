
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,U as l,r as a,c as t,C as o,V as d,e as r,ah as i,o as s,f as u,m as p,g as n,h as m,F as y,J as c,j as g,i as f,q as v,Y as b,t as x,k as h,s as k,ae as V,A as w,b6 as _,a4 as F,a1 as U}from"../main-a14f6586.js";import{h as z,i as T,b as A,Q as N,j as C}from"../index/index.82d04ab0.js";import{A as j}from"./models.0f756ce2.js";const q={class:"dialogue_model_box"},B={style:{"margin-bottom":"32px"}},S={class:"search_condition"},W={style:{display:"flex","align-items":"center"}},I={style:{"margin-left":"12px"}},M={style:{"margin-left":"12px"}},K={style:{"margin-top":"22px","margin-left":"12px"}},P={style:{"margin-top":"22px"}},E={style:{"margin-top":"12px"}},R={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},J={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},O={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Q={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Y={style:{display:"flex","align-items":"center","justify-content":"space-between"}},D={style:{"margin-left":"61px",width:"100%",display:"flex","align-items":"center"}},G={style:{display:"flex","align-items":"center"}},H={style:{display:"flex","align-items":"center","margin-left":"20px"}},L={style:{display:"flex","align-items":"center","margin-left":"20px"}},X={style:{display:"flex","align-items":"center","margin-left":"20px"}},Z={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},$=U(e({__name:"tool",setup(e){const U=l(),$=a(),ee=a([]),le=a(0),ae=a(!1),te=a(!1),oe=a(!1),de=a(0),re=t((()=>de.value?"更新秘钥":"新增秘钥")),ie=t((()=>de.value?"确认更新":"确认新增")),se=o({keyType:"",model:"",status:null,modelType:z[5].value,page:1,size:10}),ue=o({proxyUrl:"",key:"",model:"",modelName:"",keyType:1,vipFreeNum:0,displaySort:0,deduct:1,keyWeight:0,status:!1,canUpload:!1,canAudio:!1,front:!1,modelType:"other"}),pe=o({keyType:[{required:!0,message:"请选择您的调用模型类型",trigger:"blur"}],secret:[{required:!0,message:"请输入调用模型的secret",trigger:"blur"}],appid:[{required:!0,message:"请输入调用模型的appid",trigger:"blur"}],vipFreeNum:[{required:!0,message:"请填写会员每日可用的最大次数",trigger:"blur"}],model:[{required:!0,message:"请选择您需要使用的模型",trigger:"blur"}],modelName:[{required:!0,message:"为您的模型取一个名字吧",trigger:"blur"}],deduct:[{required:!0,message:"请填写当前模型扣费金额（需要是正整数）",trigger:"blur"}],keyWeight:[{required:!0,message:"请填写key的权重值",trigger:"blur"}],key:[{required:!0,message:"请填写您的调用模型key",trigger:"blur"}]});async function ne(){try{ae.value=!0;const e=await j.queryModels(se);ae.value=!1;const{rows:l,count:a}=e.data;le.value=a,ee.value=l}catch(e){ae.value=!1}}function me(){se.page=1,se.size=10,se.keyType="",se.model="",se.status=null,ne()}function ye(){de.value=0,ue.proxyUrl="",ue.key="",ue.model="",ue.modelName="",ue.status=!1,ue.canUpload=!1,ue.canAudio=!1,ue.front=!1,ue.keyType=1,ue.vipFreeNum=0,ue.displaySort=0,ue.deduct=1,ue.keyWeight=0,ue.modelType="other",te.value=!0}function ce(e){ue.vipFreeNum=1==e?-1:0}function ge(){$.value.validate((async e=>{if(!e)return;if(0==U.isUserModifyPermissions())return V.error("非超级管理员无权限操作！");if(0==oe.value&&ue.vipFreeNum<0)return void V({type:"error",message:"会员每日可用次数不能小于零"});const l=_(ue);delete l.id,de.value&&(l.id=de.value);const a=await j.setModels(l);200==a.code?(V({type:"success",message:"操作成功"}),te.value=!1,ne()):V({type:"error",message:a.data})}))}return d((()=>{ne()})),(e,l)=>{const a=r("el-alert"),t=r("el-option"),o=r("el-select"),d=r("el-input"),_=r("el-button"),z=r("RefreshRight"),fe=r("el-icon"),ve=r("el-table-column"),be=r("el-tag"),xe=r("el-popconfirm"),he=r("el-table"),ke=r("el-pagination"),Ve=r("el-row"),we=F,_e=r("el-form-item"),Fe=r("el-switch"),Ue=r("el-form"),ze=r("el-dialog"),Te=i("loading");return s(),u("div",q,[p("div",B,[n(a,{closable:!1,"show-icon":"",title:"说明",description:"工具模型用于翻译、联想、思维导图等特殊场景需要使用此模型处理内置操作、建议设置一个模型使用即可！",type:"warning"})]),p("div",S,[p("div",W,[p("div",null,[l[25]||(l[25]=p("div",{class:"search_title"},"模型类型",-1)),p("div",null,[n(o,{modelValue:se.keyType,"onUpdate:modelValue":l[0]||(l[0]=e=>se.keyType=e),placeholder:"请选择模型类型",style:{width:"150px"}},{default:m((()=>[(s(!0),u(y,null,c(f(T),(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",I,[l[26]||(l[26]=p("div",{class:"search_title"},"使用模型",-1)),p("div",null,[n(d,{modelValue:se.model,"onUpdate:modelValue":l[2]||(l[2]=e=>se.model=e),style:{width:"150px"},placeholder:"请选择使用模型",class:"input-with-select"},{suffix:m((()=>[n(o,{modelValue:se.model,"onUpdate:modelValue":l[1]||(l[1]=e=>se.model=e),style:{width:"30px",border:"none"}},{default:m((()=>[(s(!0),u(y,null,c(f(A),(e=>(s(),g(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])]),p("div",M,[l[27]||(l[27]=p("div",{class:"search_title"},"启用状态",-1)),p("div",null,[n(o,{modelValue:se.status,"onUpdate:modelValue":l[3]||(l[3]=e=>se.status=e),placeholder:"请选择启用状态",style:{width:"120px"}},{default:m((()=>[(s(!0),u(y,null,c(f(N),(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",K,[n(_,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:ne},{default:m((()=>l[28]||(l[28]=[v("查询 ")]))),_:1})]),p("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:me},[n(fe,{color:"#3B82F6",size:"20"},{default:m((()=>[n(z)])),_:1})])]),p("div",P,[n(_,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:ye},{default:m((()=>l[29]||(l[29]=[v("添加key ")]))),_:1})])]),p("div",E,[b((s(),g(he,{border:"",data:f(ee),style:{"font-size":"13px",width:"100%"},"max-height":"65vh"},{default:m((()=>[n(ve,{prop:"displaySort",label:"排序id"}),n(ve,{label:"模型类型"},{default:m((e=>[v(x(f(C)[e.row.keyType]),1)])),_:1}),n(ve,{prop:"modelName",label:"自定义模型名称"}),n(ve,{prop:"model",label:"绑定模型"}),n(ve,{prop:"status",label:"是否启用"},{default:m((e=>[1==e.row.status?(s(),g(be,{key:0,type:"primary"},{default:m((()=>l[30]||(l[30]=[v("启用")]))),_:1})):(s(),g(be,{key:1,type:"info"},{default:m((()=>l[31]||(l[31]=[v("禁用")]))),_:1}))])),_:1}),n(ve,{prop:"key",label:"模型key"}),n(ve,{prop:"proxyUrl",label:"代理地址"},{default:m((e=>[v(x(""==e.row.proxyUrl?"——":e.row.proxyUrl),1)])),_:1}),n(ve,{prop:"keyWeight",label:"模型权重"}),n(ve,{label:"操作",fixed:"right",width:"160"},{default:m((e=>[n(_,{style:{border:"none",color:"#3B82F6","font-size":"13px","background-color":"transparent"},onClick:l=>{return a=e.row,de.value=a.id,a.vipFreeNum,oe.value,w((()=>{const{proxyUrl:e,model:l,modelName:t,status:o,canUpload:d,canAudio:r,front:i,keyType:s,vipFreeNum:u,displaySort:p,deduct:n,keyWeight:m,modelType:y}=a;Object.assign(ue,{proxyUrl:e,model:l,modelName:t,status:o,canUpload:d,canAudio:r,front:i,keyType:s,vipFreeNum:u,displaySort:p,deduct:n,keyWeight:m,modelType:y})})),void(te.value=!0);var a}},{default:m((()=>l[32]||(l[32]=[v("编辑")]))),_:2},1032,["onClick"]),n(xe,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:l=>async function(e){if(0==U.isUserModifyPermissions())return V.error("非超级管理员无权限操作！");const{id:l}=e;await j.delModels({id:l}),V({type:"success",message:"操作完成！"}),ne()}(e.row)},{reference:m((()=>[n(_,{style:{border:"none",color:"#FF3B30","font-size":"13px","background-color":"transparent"}},{default:m((()=>l[33]||(l[33]=[v("删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[Te,f(ae)]]),n(Ve,{class:"flex justify-end mt-5"},{default:m((()=>[n(ke,{"current-page":se.page,"onUpdate:currentPage":l[4]||(l[4]=e=>se.page=e),"page-size":se.size,"onUpdate:pageSize":l[5]||(l[5]=e=>se.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:f(le),onSizeChange:ne,onCurrentChange:ne},null,8,["current-page","page-size","total"])])),_:1})]),n(ze,{modelValue:f(te),"onUpdate:modelValue":l[24]||(l[24]=e=>k(te)?te.value=e:null),width:"750","show-close":!1,"destroy-on-close":""},{header:m((({close:e,titleId:a,titleClass:t})=>[p("div",R,[p("div",null,x(re.value),1),p("div",{onClick:l[6]||(l[6]=e=>te.value=!1),style:{cursor:"pointer"}},[n(fe,null,{default:m((()=>[n(we,{name:"close"})])),_:1})])])])),default:m((()=>[p("div",J,[n(Ue,{ref_key:"addModelKeyFormRef",ref:$,rules:pe,model:ue,"label-width":"auto",style:{"max-width":"750px"}},{default:m((()=>[p("div",O,[n(_e,{label:"自定义模型名称",prop:"modelName"},{default:m((()=>[n(d,{modelValue:ue.modelName,"onUpdate:modelValue":l[7]||(l[7]=e=>ue.modelName=e),size:"large",style:{width:"200px"},placeholder:"请填写模型名称"},null,8,["modelValue"])])),_:1}),n(_e,{label:"模型类型选择",prop:"keyType"},{default:m((()=>[n(o,{modelValue:ue.keyType,"onUpdate:modelValue":l[8]||(l[8]=e=>ue.keyType=e),size:"large",style:{width:"200px"},placeholder:"请选择模型的类型"},{default:m((()=>[(s(!0),u(y,null,c(f(T),(e=>(s(),g(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})]),p("div",Q,[n(_e,{label:"单次消耗积分",prop:"deduct"},{default:m((()=>[n(d,{modelValue:ue.deduct,"onUpdate:modelValue":l[9]||(l[9]=e=>ue.deduct=e),size:"large",style:{width:"200px"},placeholder:"请填写单次消耗的积分量",type:"number"},null,8,["modelValue"])])),_:1}),n(_e,{label:"使用模型",prop:"model"},{default:m((()=>[n(d,{size:"large",modelValue:ue.model,"onUpdate:modelValue":l[11]||(l[11]=e=>ue.model=e),style:{width:"200px"},placeholder:"请选择使用模型",class:"input-with-select_dialog"},{suffix:m((()=>[n(o,{modelValue:ue.model,"onUpdate:modelValue":l[10]||(l[10]=e=>ue.model=e),style:{width:"30px",border:"none"}},{default:m((()=>[(s(!0),u(y,null,c(f(A),(e=>(s(),g(t,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})]),p("div",Y,[n(_e,{label:"模型显示排序"},{default:m((()=>[n(d,{modelValue:ue.displaySort,"onUpdate:modelValue":l[12]||(l[12]=e=>ue.displaySort=e),size:"large",style:{width:"200px"},type:"number",placeholder:"请填写模型的排序"},null,8,["modelValue"])])),_:1}),n(_e,{label:"调用轮询权重",prop:"keyWeight"},{default:m((()=>[n(d,{modelValue:ue.keyWeight,"onUpdate:modelValue":l[13]||(l[13]=e=>ue.keyWeight=e),size:"large",style:{width:"200px"},placeholder:"请填写轮询权重",type:"number"},null,8,["modelValue"])])),_:1})]),1!=f(oe)?(s(),g(_e,{key:0,label:"会员每日可用次数",prop:"vipFreeNum"},{default:m((()=>[n(d,{modelValue:ue.vipFreeNum,"onUpdate:modelValue":l[14]||(l[14]=e=>ue.vipFreeNum=e),size:"large",style:{width:"200px"},placeholder:"请填写会员单日可用的次数",type:"number"},null,8,["modelValue"])])),_:1})):h("",!0),n(_e,{label:"指定代理地址"},{default:m((()=>[n(d,{modelValue:ue.proxyUrl,"onUpdate:modelValue":l[15]||(l[15]=e=>ue.proxyUrl=e),size:"large",placeholder:"请填写模型代理地址"},null,8,["modelValue"])])),_:1}),n(_e,{label:ue.keyType==T[0].value||ue.keyType==T[3].value?"API Key":ue.keyType==T[1].value?"ClientId":ue.keyType==T[2].value?"AppKey":void 0,prop:"key"},{default:m((()=>[n(d,{modelValue:ue.key,"onUpdate:modelValue":l[16]||(l[16]=e=>ue.key=e),size:"large",placeholder:"请填写模型Key l clientld l Appld"},null,8,["modelValue"])])),_:1},8,["label"]),ue.keyType==f(T)[1].value||ue.keyType==f(T)[3].value?(s(),g(_e,{key:1,label:"SecretKey",prop:"secret"},{default:m((()=>[n(d,{modelValue:ue.secret,"onUpdate:modelValue":l[17]||(l[17]=e=>ue.secret=e),size:"large",placeholder:"请添加模型调用所需的secret"},null,8,["modelValue"])])),_:1})):h("",!0),ue.keyType==f(T)[3].value?(s(),g(_e,{key:2,label:"AppId",prop:"appid"},{default:m((()=>[n(d,{modelValue:ue.appid,"onUpdate:modelValue":l[18]||(l[18]=e=>ue.appid=e),size:"large",placeholder:"请添加模型调用所需的AppId"},null,8,["modelValue"])])),_:1})):h("",!0),n(_e,null,{default:m((()=>[p("div",D,[p("div",G,[l[34]||(l[34]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"启用状态",-1)),p("div",null,[n(Fe,{modelValue:ue.status,"onUpdate:modelValue":l[19]||(l[19]=e=>ue.status=e)},null,8,["modelValue"])])]),p("div",H,[l[35]||(l[35]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"会员免费",-1)),p("div",null,[n(Fe,{modelValue:f(oe),"onUpdate:modelValue":l[20]||(l[20]=e=>k(oe)?oe.value=e:null),onClick:ce},null,8,["modelValue"])])]),p("div",L,[l[36]||(l[36]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"上传文档",-1)),p("div",null,[n(Fe,{modelValue:ue.canUpload,"onUpdate:modelValue":l[21]||(l[21]=e=>ue.canUpload=e)},null,8,["modelValue"])])]),p("div",X,[l[37]||(l[37]=p("div",{style:{"white-space":"nowrap","margin-right":"10px",color:"#9FA3B8"}},"语音通话",-1)),p("div",null,[n(Fe,{modelValue:ue.canAudio,"onUpdate:modelValue":l[22]||(l[22]=e=>ue.canAudio=e)},null,8,["modelValue"])])])])])),_:1})])),_:1},8,["rules","model"])]),p("div",Z,[n(_,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[23]||(l[23]=e=>te.value=!1)},{default:m((()=>l[38]||(l[38]=[v("取消 ")]))),_:1}),n(_,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:ge},{default:m((()=>[v(x(ie.value),1)])),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b0160ebc"]]);export{$ as default};
