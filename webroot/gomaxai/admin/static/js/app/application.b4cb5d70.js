
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,u as l,r as a,G as t,C as o,x as d,j as s,V as r,o as p,c as u,b as i,f as n,m as c,n as m,g,W as f,X as y,e as b,h as v,w as x,J as h,t as w,K as V,O as _,Z as I,$ as k,P as A,y as C,p as U,k as F,_ as z,q as D}from"../main-043c96ab.js";import{u as N}from"../utcformatTime/utcformatTime.f6db2c52.js";import{b as j}from"../index/index.21f4f4e7.js";const M=e=>(U("data-v-0fd59281"),e=e(),F(),e),P={class:"search_condition"},q={style:{display:"flex","align-items":"center"}},G=M((()=>i("div",{class:"search_title"},"应用名称",-1))),S={style:{"margin-left":"12px"}},T=M((()=>i("div",{class:"search_title"},"应用分类",-1))),B={style:{"margin-left":"12px"}},E=M((()=>i("div",{class:"search_title"},"启用状态",-1))),K={style:{"margin-top":"22px","margin-left":"12px"}},O={style:{"margin-top":"22px"}},Y={key:0},R={key:1},W={style:{maxWidth:"350px"}},J={style:{maxHeight:"50px",cursor:"pointer"}},H={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},X={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},Z={style:{display:"flex","align-items":"center","justify-content":"space-between"}},$={style:{display:"flex","align-items":"center","justify-content":"space-between"}},L=["src"],Q={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ee={style:{display:"flex","align-items":"center","justify-content":"space-between"}},le={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ae={style:{display:"flex","align-items":"center"}},te={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},oe=e({__name:"application",setup(e){const U=l();a();const F=a(0),z=a(!1),D=a(!1),M=t({modelName:"",groupId:"",status:"",page:1,size:10}),oe=a("/api/file/upload"),de=a(),se=a(0),re=a(!1),pe=a(0),ue=t({id:"",groupId:"",modelName:"",modelId:"",sortId:"",desc:"",logo:"",status:0,preset:"",demoData:"",canUpload:!1,gptsApp:!1,recommend:!1,useCount:0,collectCount:0,relModel:""}),ie=t({groupId:[{required:!0,message:"请选择App分类",trigger:"change"}],modelName:[{required:!0,message:"请填写App名称",trigger:"blur"}],desc:[{required:!0,message:"请填写App描述",trigger:"blur"}],logo:[{required:!0,message:"请填写App封面图片地址",trigger:"blur"}],demoData:[{required:!0,message:"请填写App演示数据",trigger:"blur"}],sortId:[{required:!0,message:"请填写排序ID",trigger:"blur"}]}),ne=a([]),ce=a([]),me=o((()=>se.value?"更新应用":"新增应用"));async function ge(){try{D.value=!0;const e=await I.queryApp(M),{rows:l,count:a}=e.data;D.value=!1,F.value=a,ne.value=l.sort(((e,l)=>l.order-e.order))}catch(e){D.value=!1}}function fe(){se.value=0,ue.id="",ue.groupId="",ue.modelName="",ue.modelId="",ue.sortId="",ue.desc="",ue.logo="",ue.status=0,ue.preset="",ue.demoData="",ue.canUpload=!1,ue.gptsApp=!1,ue.recommend=!1,ue.useCount=0,ue.collectCount=0,ue.relModel="",z.value=!0}function ye(e){se.value=0,z.value=!1,null==e||e.resetFields()}function be(){M.modelName="",M.groupId="",M.status="",M.page=1,M.size=10,ge()}o((()=>se.value?"确认更新":"确认新增"));const ve=(e,l)=>{ue.logo=e.data},xe=e=>["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)?e.size/1024>300?(A.error("当前限制文件最大不超过 300KB!"),!1):void 0:(A.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1);return d((()=>{ge(),async function(){const e=await I.queryCats({size:100}),{rows:l}=e.data;ce.value=l}()})),(e,l)=>{const a=s("el-alert"),t=s("el-input"),o=s("el-option"),d=s("el-select"),he=s("el-button"),we=s("RefreshRight"),Ve=s("el-icon"),_e=s("el-table-column"),Ie=s("el-image"),ke=s("el-tag"),Ae=s("el-tooltip"),Ce=s("el-popconfirm"),Ue=s("el-table"),Fe=s("el-pagination"),ze=s("el-row"),De=C,Ne=s("el-form-item"),je=s("Plus"),Me=s("el-upload"),Pe=s("el-switch"),qe=s("el-form"),Ge=s("el-dialog"),Se=r("loading");return p(),u("div",null,[i("div",null,[n(a,{closable:!1,"show-icon":"",title:"应用说明",description:"[由于各模型的使用不同、暂时关闭其他模型的应用使用、仅仅支持使用OpenAi的key使用、请配置了openAi的key之后再进行使用、如果没有配置将不能使用此功能、但用户可以自定义选择模型]  ====     应用一旦创建、可能会被多处使用后续将限制删除、请保持良好习惯、规范命名分类、后续尽量变更而不是删除。用户创建的应用我们不允许删除、但是可以做一定的变更和修改、审核通过的应用也将限制用户更改、一旦通过或者拒绝、将不允许再次对其状态进行变更、请知悉！",type:"warning"})]),i("div",P,[i("div",q,[i("div",null,[G,i("div",null,[n(t,{modelValue:M.modelName,"onUpdate:modelValue":l[0]||(l[0]=e=>M.modelName=e),placeholder:"App名称[模糊搜索]",clearable:"",onKeydown:c(m(ge,["prevent"]),["enter"]),style:{width:"200px"}},null,8,["modelValue","onKeydown"])])]),i("div",S,[T,i("div",null,[n(d,{modelValue:M.groupId,"onUpdate:modelValue":l[1]||(l[1]=e=>M.groupId=e),placeholder:"请选择App分类",clearable:"",style:{width:"150px"}},{default:g((()=>[(p(!0),u(f,null,y(b(ce),(e=>(p(),h(o,{key:e.id,label:e.groupName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),i("div",B,[E,i("div",null,[n(d,{modelValue:M.status,"onUpdate:modelValue":l[2]||(l[2]=e=>M.status=e),placeholder:"请选择App状态",clearable:"",style:{width:"150px"}},{default:g((()=>[n(o,{label:"启用",value:1}),n(o,{label:"禁用",value:0})])),_:1},8,["modelValue"])])]),i("div",K,[n(he,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:ge},{default:g((()=>[v("查询 ")])),_:1})]),i("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:be},[n(Ve,{color:"#3B82F6",size:"20"},{default:g((()=>[n(we)])),_:1})])]),i("div",O,[n(he,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:fe},{default:g((()=>[v("添加应用 ")])),_:1})])]),i("div",null,[x((p(),h(Ue,{border:"",data:b(ne),height:"60vh",style:{width:"100%"}},{default:g((()=>[n(_e,{prop:"sortId",label:"排序ID",width:"100"}),n(_e,{prop:"logo",label:"图标",width:"100"},{default:g((e=>[n(Ie,{style:{height:"50px"},src:e.row.logo,fit:"fill"},null,8,["src"])])),_:1}),n(_e,{prop:"modelName",label:"名称",width:"150"}),n(_e,{prop:"groupName",label:"分类",width:"100"}),n(_e,{prop:"",label:"GPTS应用ID/使用模型",width:"200"},{default:g((e=>[1==e.row.gptsApp?(p(),u("div",Y,w(null==e.row.modelId?"--":e.row.modelId),1)):(p(),u("div",R,w(null==e.row.relModel?"--":e.row.relModel),1))])),_:1}),n(_e,{prop:"status",label:"应用状态",width:"100"},{default:g((e=>[n(ke,{type:1===e.row.status?"primary":"danger"},{default:g((()=>[v(w(1===e.row.status?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),n(_e,{prop:"desc",label:"应用描述"},{default:g((e=>[n(Ae,{class:"box-item",effect:"dark",placement:"top-start"},{content:g((()=>[i("div",W,w(e.row.desc),1)])),default:g((()=>[i("div",J,w(e.row.desc),1)])),_:2},1024)])),_:1}),n(_e,{prop:"createdAt",label:"创建时间",width:"120"},{default:g((e=>[v(w(b(N)(e.row.createdAt,"YYYY-MM-DD")),1)])),_:1}),n(_e,{label:"操作",width:"120",fixed:"right"},{default:g((e=>[n(he,{link:"",type:"primary",size:"small",onClick:l=>function(e){se.value=e.id,re.value="user"===e.role,pe.value=e.status;const{id:l,groupId:a,modelName:t,modelId:o,sortId:d,desc:s,logo:r,status:p,preset:u,demoData:i,canUpload:n,gptsApp:c,recommend:m,useCount:g,collectCount:f,relModel:y}=e;k((()=>{Object.assign(ue,{id:l,groupId:a,modelName:t,modelId:o,sortId:d,desc:s,logo:r,status:p,preset:u,demoData:i,canUpload:n,gptsApp:c,recommend:m,useCount:g,collectCount:f,relModel:y})})),z.value=!0}(e.row)},{default:g((()=>[v(" 编辑 ")])),_:2},1032,["onClick"]),n(Ce,{title:"确认删除此应用么?",width:"200","icon-color":"red",onConfirm:l=>async function(e){if(0==U.isUserModifyPermissions())return A.error("非超级管理员无权限操作！");await I.deleteApp({id:e.id}),A.success("删除应用成功"),ge()}(e.row)},{reference:g((()=>[n(he,{link:"",type:"danger",size:"small"},{default:g((()=>[v(" 删除 ")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[Se,b(D)]]),n(ze,{class:"flex justify-end mt-5"},{default:g((()=>[n(Fe,{"current-page":M.page,"onUpdate:currentPage":l[3]||(l[3]=e=>M.page=e),"page-size":M.size,"onUpdate:pageSize":l[4]||(l[4]=e=>M.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:b(F),onSizeChange:ge,onCurrentChange:ge},null,8,["current-page","page-size","total"])])),_:1})]),n(Ge,{modelValue:b(z),"onUpdate:modelValue":l[23]||(l[23]=e=>_(z)?z.value=e:null),width:"800","show-close":!1,"destroy-on-close":""},{header:g((({close:e,titleId:a,titleClass:t})=>[i("div",H,[i("div",null,w(b(me)),1),i("div",{onClick:l[5]||(l[5]=e=>ye(b(de))),style:{cursor:"pointer"}},[n(Ve,null,{default:g((()=>[n(De,{name:"close"})])),_:1})])])])),default:g((()=>[i("div",X,[n(qe,{ref_key:"formPackageRef",ref:de,"label-position":"right","label-width":"110px",model:ue,rules:ie},{default:g((()=>[i("div",Z,[n(Ne,{label:"所属分类",prop:"groupId"},{default:g((()=>[n(d,{size:"large",modelValue:ue.groupId,"onUpdate:modelValue":l[6]||(l[6]=e=>ue.groupId=e),placeholder:"请选择应用分类",clearable:"",style:{width:"240px"}},{default:g((()=>[(p(!0),u(f,null,y(b(ce),(e=>(p(),h(o,{key:e.id,label:e.groupName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(Ne,{label:"应用名称",prop:"modelName"},{default:g((()=>[n(t,{size:"large",modelValue:ue.modelName,"onUpdate:modelValue":l[7]||(l[7]=e=>ue.modelName=e),placeholder:"请填写应用名称",style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",$,[n(Ne,{label:"应用图标",prop:"logo"},{default:g((()=>[n(Me,{class:"avatar-uploader",action:b(oe),"show-file-list":!1,"on-success":ve,"before-upload":xe},{default:g((()=>[ue.logo?(p(),u("img",{key:0,src:ue.logo,style:{width:"100px"},class:"avatar"},null,8,L)):(p(),h(Ve,{key:1,class:"avatar-uploader-icon"},{default:g((()=>[n(je)])),_:1}))])),_:1},8,["action"])])),_:1}),n(Ne,{label:"应用描述",prop:"desc"},{default:g((()=>[n(t,{modelValue:ue.desc,"onUpdate:modelValue":l[8]||(l[8]=e=>ue.desc=e),type:"textarea",placeholder:"请填写App介绍信息、用于场景内置信息...",rows:4,style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",Q,[n(Ne,{label:"排序ID",prop:"sortId"},{default:g((()=>[n(t,{size:"large",modelValue:ue.sortId,"onUpdate:modelValue":l[9]||(l[9]=e=>ue.sortId=e),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]",style:{width:"240px"}},null,8,["modelValue"])])),_:1}),n(Ne,{label:"示例提问",prop:"demoData"},{default:g((()=>[n(t,{modelValue:ue.demoData,"onUpdate:modelValue":l[10]||(l[10]=e=>ue.demoData=e),type:"textarea",placeholder:"请填写App的demo示例数据、每换行一次表示一个新的示例...",rows:4,style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",ee,[n(Ne,{label:"预设热度",prop:"useCount"},{default:g((()=>[n(t,{size:"large",modelValue:ue.useCount,"onUpdate:modelValue":l[11]||(l[11]=e=>ue.useCount=e),modelModifiers:{number:!0},placeholder:"请填写预设热度",style:{width:"240px"}},null,8,["modelValue"])])),_:1}),n(Ne,{label:"预设收藏",prop:"collectCount"},{default:g((()=>[n(t,{size:"large",modelValue:ue.collectCount,"onUpdate:modelValue":l[12]||(l[12]=e=>ue.collectCount=e),placeholder:"请填写预设收藏",style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",le,[n(Ne,{label:"是否GPTS应用",prop:"gptsApp"},{default:g((()=>[n(Pe,{modelValue:ue.gptsApp,"onUpdate:modelValue":l[13]||(l[13]=e=>ue.gptsApp=e)},null,8,["modelValue"])])),_:1}),1!=ue.gptsApp?(p(),h(Ne,{key:0,label:"使用模型"},{default:g((()=>[n(t,{size:"large",modelValue:ue.relModel,"onUpdate:modelValue":l[15]||(l[15]=e=>ue.relModel=e),style:{"max-width":"600px",width:"240px"},placeholder:"请选择/输入你要使用的模型",class:"input-with-select"},{suffix:g((()=>[n(d,{modelValue:ue.relModel,"onUpdate:modelValue":l[14]||(l[14]=e=>ue.relModel=e),placeholder:"Select",style:{width:"30px",border:"none"}},{default:g((()=>[(p(!0),u(f,null,y(b(j),(e=>(p(),h(o,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})):(p(),h(Ne,{key:1,label:"GPTS应用ID",prop:"modelId"},{default:g((()=>[n(t,{modelValue:ue.modelId,"onUpdate:modelValue":l[16]||(l[16]=e=>ue.modelId=e),placeholder:"请填写GPTS应用ID",style:{width:"240px"}},null,8,["modelValue"])])),_:1}))]),1!=ue.gptsApp?(p(),h(Ne,{key:0,label:"应用预设",prop:"preset"},{default:g((()=>[n(t,{size:"large",type:"textarea",modelValue:ue.preset,"onUpdate:modelValue":l[17]||(l[17]=e=>ue.preset=e),placeholder:"请填写应用预设信息"},null,8,["modelValue"])])),_:1})):V("",!0),i("div",ae,[n(Ne,{label:"启用状态",prop:"status"},{default:g((()=>[n(Pe,{modelValue:ue.status,"onUpdate:modelValue":l[18]||(l[18]=e=>ue.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),n(Ne,{label:"启用上传",prop:"canUpload"},{default:g((()=>[n(Pe,{modelValue:ue.canUpload,"onUpdate:modelValue":l[19]||(l[19]=e=>ue.canUpload=e)},null,8,["modelValue"])])),_:1}),n(Ne,{label:"推荐应用",prop:"recommend"},{default:g((()=>[n(Pe,{modelValue:ue.recommend,"onUpdate:modelValue":l[20]||(l[20]=e=>ue.recommend=e)},null,8,["modelValue"])])),_:1})])])),_:1},8,["model","rules"])]),i("div",te,[n(he,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[21]||(l[21]=e=>ye(b(de)))},{default:g((()=>[v("取消 ")])),_:1}),n(he,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:l[22]||(l[22]=e=>{var l;null==(l=b(de))||l.validate((async e=>{if(e){if(0==U.isUserModifyPermissions())return A.error("非超级管理员无权限操作！");if(se.value){const e={id:se.value,...ue};re.value&&Object.assign(e,{status:pe.value}),await I.updateApp(e),A({type:"success",message:"更新应用成功！"})}else delete ue.id,await I.createApp(ue),A({type:"success",message:"创建应用成功！"});z.value=!1,ge()}}))})},{default:g((()=>[v(" 确定 ")])),_:1})])])),_:1},8,["modelValue"])])}}});"function"==typeof D&&D(oe);const de=z(oe,[["__scopeId","data-v-0fd59281"]]);export{de as default};
