
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,U as l,r as a,C as t,c as o,V as d,e as s,ah as r,o as u,f as p,m as i,g as n,$ as c,a0 as m,h as g,F as f,J as y,j as b,i as h,q as v,Y as V,t as x,k as w,s as _,am as I,A as U,ae as k,a4 as A,a1 as C,a2 as F}from"../main-9d6c7d62.js";import{u as z}from"../utcformatTime/utcformatTime.f6db2c52.js";import{b as P}from"../index/index.82d04ab0.js";const j={class:"search_condition"},D={style:{display:"flex","align-items":"center"}},M={style:{"margin-left":"12px"}},N={style:{"margin-left":"12px"}},E={style:{"margin-top":"22px","margin-left":"12px"}},q={style:{"margin-top":"22px"}},S={key:0},G={key:1},T={style:{maxWidth:"350px"}},B={style:{maxHeight:"50px",cursor:"pointer"}},O={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},Y={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},K={style:{display:"flex","align-items":"center","justify-content":"space-between"}},R={style:{display:"flex","align-items":"center","justify-content":"space-between"}},H=["src"],J={style:{display:"flex","align-items":"center","justify-content":"space-between"}},W={style:{display:"flex","align-items":"center","justify-content":"space-between"}},L={style:{display:"flex","align-items":"center","justify-content":"space-between"}},$={style:{display:"flex","align-items":"center"}},Q={style:{"flex-grow":"1"}},X={style:{display:"ruby-text",width:"100%"}},Z={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},ee=e({__name:"application",setup(e){const C=l();a();const F=a(0),ee=a(!1),le=a(!1),ae=t({modelName:"",groupId:"",status:null,page:1,size:10}),te=a("/api/file/upload"),oe=a(),de=a(0),se=a(!1),re=a(0),ue=t({id:"",groupId:"",modelName:"",modelId:"",sortId:"",desc:"",logo:"",status:0,preset:"",demoData:"",canUpload:!1,gptsApp:!1,recommend:!1,customParams:!1,useCount:0,collectCount:0,relModel:"",config:{placeholder:"",format:"",tags:[]}}),pe=t({groupId:[{required:!0,message:"请选择App分类",trigger:"change"}],modelName:[{required:!0,message:"请填写App名称",trigger:"blur"}],desc:[{required:!0,message:"请填写App描述",trigger:"blur"}],logo:[{required:!0,message:"请填写App封面图片地址",trigger:"blur"}],demoData:[{required:!0,message:"请填写App演示数据",trigger:"blur"}],sortId:[{required:!0,message:"请填写排序ID",trigger:"blur"}]}),ie=a([]),ne=a([]),ce=o((()=>de.value?"更新应用":"新增应用"));async function me(){try{le.value=!0;const e=await I.queryApp(ae),{rows:l,count:a}=e.data;le.value=!1,F.value=a,ie.value=l.sort(((e,l)=>l.order-e.order))}catch(e){le.value=!1}}function ge(){const e=function(e){if(!e)return[];const l=/{{([^}]+)}}/g,a=[];let t;for(;null!==(t=l.exec(e));){const e=t[1].trim();if("输入内容"!==e){let l=[],t=0;const o={key:e,tag:"input"};l.length>0&&(o.options=l),o.required=t,a.push(o)}}return a}(ue.config.format);e.forEach((e=>{const l=ue.config.tags.find((l=>l.key==e.key));l&&Object.assign(e,l)})),ue.config.tags=e}function fe(){de.value=0,ue.id="",ue.groupId="",ue.modelName="",ue.modelId="",ue.sortId="",ue.desc="",ue.logo="",ue.status=0,ue.preset="",ue.demoData="",ue.canUpload=!1,ue.gptsApp=!1,ue.recommend=!1,ue.customParams=!1,ue.useCount=0,ue.collectCount=0,ue.relModel="",ue.config={placeholder:"",format:"",tags:[]},ee.value=!0}function ye(e){de.value=0,ee.value=!1,null==e||e.resetFields()}function be(){ae.modelName="",ae.groupId="",ae.status=null,ae.page=1,ae.size=10,me()}o((()=>de.value?"确认更新":"确认新增"));const he=(e,l)=>{ue.logo=e.data},ve=e=>["image/png","image/jpeg","image/gif","image/webp"].includes(e.type)?e.size/1024>300?(k.error("当前限制文件最大不超过 300KB!"),!1):void 0:(k.error("当前系统仅支持 PNG、JPEG、GIF、和 WebP 格式的图片!"),!1);return d((()=>{me(),async function(){const e=await I.queryCats({size:100}),{rows:l}=e.data;ne.value=l}()})),(e,l)=>{const a=s("el-alert"),t=s("el-input"),o=s("el-option"),d=s("el-select"),Ve=s("el-button"),xe=s("RefreshRight"),we=s("el-icon"),_e=s("el-table-column"),Ie=s("el-image"),Ue=s("el-tag"),ke=s("el-tooltip"),Ae=s("el-popconfirm"),Ce=s("el-table"),Fe=s("el-pagination"),ze=s("el-row"),Pe=A,je=s("el-form-item"),De=s("Plus"),Me=s("el-upload"),Ne=s("el-switch"),Ee=s("ElsCaption"),qe=s("ElsInput"),Se=s("ElsFormItem"),Ge=s("ElInput"),Te=s("ElsOption"),Be=s("ElsSelect"),Oe=s("ElsSwitch"),Ye=s("ElsForm"),Ke=s("el-form"),Re=s("el-dialog"),He=r("loading");return u(),p("div",null,[i("div",null,[n(a,{closable:!1,"show-icon":"",title:"应用说明",description:"[由于各模型的使用不同、暂时关闭其他模型的应用使用、仅仅支持使用OpenAi的key使用、请配置了openAi的key之后再进行使用、如果没有配置将不能使用此功能、但用户可以自定义选择模型]  ====     应用一旦创建、可能会被多处使用后续将限制删除、请保持良好习惯、规范命名分类、后续尽量变更而不是删除。用户创建的应用我们不允许删除、但是可以做一定的变更和修改、审核通过的应用也将限制用户更改、一旦通过或者拒绝、将不允许再次对其状态进行变更、请知悉！",type:"warning"})]),i("div",j,[i("div",D,[i("div",null,[l[27]||(l[27]=i("div",{class:"search_title"},"应用名称",-1)),i("div",null,[n(t,{modelValue:ae.modelName,"onUpdate:modelValue":l[0]||(l[0]=e=>ae.modelName=e),placeholder:"App名称[模糊搜索]",clearable:"",onKeydown:c(m(me,["prevent"]),["enter"]),style:{width:"200px"}},null,8,["modelValue","onKeydown"])])]),i("div",M,[l[28]||(l[28]=i("div",{class:"search_title"},"应用分类",-1)),i("div",null,[n(d,{modelValue:ae.groupId,"onUpdate:modelValue":l[1]||(l[1]=e=>ae.groupId=e),placeholder:"请选择App分类",clearable:"",style:{width:"150px"}},{default:g((()=>[(u(!0),p(f,null,y(h(ne),(e=>(u(),b(o,{key:e.id,label:e.groupName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),i("div",N,[l[29]||(l[29]=i("div",{class:"search_title"},"启用状态",-1)),i("div",null,[n(d,{modelValue:ae.status,"onUpdate:modelValue":l[2]||(l[2]=e=>ae.status=e),placeholder:"请选择App状态",clearable:"",style:{width:"150px"}},{default:g((()=>[n(o,{label:"启用",value:1}),n(o,{label:"禁用",value:0})])),_:1},8,["modelValue"])])]),i("div",E,[n(Ve,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:me},{default:g((()=>l[30]||(l[30]=[v("查询 ")]))),_:1})]),i("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:be},[n(we,{color:"#3B82F6",size:"20"},{default:g((()=>[n(xe)])),_:1})])]),i("div",q,[n(Ve,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:fe},{default:g((()=>l[31]||(l[31]=[v("添加应用 ")]))),_:1})])]),i("div",null,[V((u(),b(Ce,{border:"",data:h(ie),height:"60vh",style:{width:"100%"}},{default:g((()=>[n(_e,{prop:"sortId",label:"排序ID",width:"100"}),n(_e,{prop:"logo",label:"图标",width:"100"},{default:g((e=>[n(Ie,{style:{height:"50px"},src:e.row.logo,fit:"fill"},null,8,["src"])])),_:1}),n(_e,{prop:"modelName",label:"名称",width:"150"}),n(_e,{prop:"groupName",label:"分类",width:"100"}),n(_e,{prop:"",label:"GPTS应用ID/使用模型",width:"200"},{default:g((e=>[1==e.row.gptsApp?(u(),p("div",S,x(null==e.row.modelId?"--":e.row.modelId),1)):(u(),p("div",G,x(null==e.row.relModel?"--":e.row.relModel),1))])),_:1}),n(_e,{prop:"status",label:"应用状态",width:"100"},{default:g((e=>[n(Ue,{type:1===e.row.status?"primary":"danger"},{default:g((()=>[v(x(1===e.row.status?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),n(_e,{prop:"desc",label:"应用描述"},{default:g((e=>[n(ke,{class:"box-item",effect:"dark",placement:"top-start"},{content:g((()=>[i("div",T,x(e.row.desc),1)])),default:g((()=>[i("div",B,x(e.row.desc),1)])),_:2},1024)])),_:1}),n(_e,{prop:"createdAt",label:"创建时间",width:"120"},{default:g((e=>[v(x(h(z)(e.row.createdAt,"YYYY-MM-DD")),1)])),_:1}),n(_e,{label:"操作",width:"120",fixed:"right"},{default:g((e=>[n(Ve,{link:"",type:"primary",size:"small",onClick:l=>function(e){de.value=e.id,se.value="user"===e.role,re.value=e.status;const{id:l,groupId:a,modelName:t,modelId:o,sortId:d,desc:s,logo:r,status:u,preset:p,demoData:i,canUpload:n,gptsApp:c,recommend:m,customParams:g,useCount:f,collectCount:y,relModel:b,config:h}=e;U((()=>{Object.assign(ue,{id:l,groupId:a,modelName:t,modelId:o,sortId:d,desc:s,logo:r,status:u,preset:p,demoData:i,canUpload:n,gptsApp:c,recommend:m,customParams:g,useCount:f,collectCount:y,relModel:b,config:h}),ue.config||(ue.config={placeholder:"",format:"",tags:[]})})),ee.value=!0}(e.row)},{default:g((()=>l[32]||(l[32]=[v(" 编辑 ")]))),_:2},1032,["onClick"]),n(Ae,{title:"确认删除此应用么?",width:"200","icon-color":"red",onConfirm:l=>async function(e){if(0==C.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");await I.deleteApp({id:e.id}),k.success("删除应用成功"),me()}(e.row)},{reference:g((()=>[n(Ve,{link:"",type:"danger",size:"small"},{default:g((()=>l[33]||(l[33]=[v(" 删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[He,h(le)]]),n(ze,{class:"flex justify-end mt-5"},{default:g((()=>[n(Fe,{"current-page":ae.page,"onUpdate:currentPage":l[3]||(l[3]=e=>ae.page=e),"page-size":ae.size,"onUpdate:pageSize":l[4]||(l[4]=e=>ae.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:h(F),onSizeChange:me,onCurrentChange:me},null,8,["current-page","page-size","total"])])),_:1})]),n(Re,{modelValue:h(ee),"onUpdate:modelValue":l[26]||(l[26]=e=>_(ee)?ee.value=e:null),width:"800","show-close":!1,"destroy-on-close":""},{header:g((({close:e,titleId:a,titleClass:t})=>[i("div",O,[i("div",null,x(h(ce)),1),i("div",{onClick:l[5]||(l[5]=e=>ye(h(oe))),style:{cursor:"pointer"}},[n(we,null,{default:g((()=>[n(Pe,{name:"close"})])),_:1})])])])),default:g((()=>[i("div",Y,[n(Ke,{ref_key:"formPackageRef",ref:oe,"label-position":"right","label-width":"110px",model:ue,rules:pe},{default:g((()=>[i("div",K,[n(je,{label:"所属分类",prop:"groupId"},{default:g((()=>[n(d,{size:"large",modelValue:ue.groupId,"onUpdate:modelValue":l[6]||(l[6]=e=>ue.groupId=e),placeholder:"请选择应用分类",clearable:"",style:{width:"240px"}},{default:g((()=>[(u(!0),p(f,null,y(h(ne),(e=>(u(),b(o,{key:e.id,label:e.groupName,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),n(je,{label:"应用名称",prop:"modelName"},{default:g((()=>[n(t,{size:"large",modelValue:ue.modelName,"onUpdate:modelValue":l[7]||(l[7]=e=>ue.modelName=e),placeholder:"请填写应用名称",style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",R,[n(je,{label:"应用图标",prop:"logo"},{default:g((()=>[n(Me,{class:"avatar-uploader",action:h(te),"show-file-list":!1,"on-success":he,"before-upload":ve},{default:g((()=>[ue.logo?(u(),p("img",{key:0,src:ue.logo,style:{width:"100px"},class:"avatar"},null,8,H)):(u(),b(we,{key:1,class:"avatar-uploader-icon"},{default:g((()=>[n(De)])),_:1}))])),_:1},8,["action"])])),_:1}),n(je,{label:"应用描述",prop:"desc"},{default:g((()=>[n(t,{modelValue:ue.desc,"onUpdate:modelValue":l[8]||(l[8]=e=>ue.desc=e),type:"textarea",placeholder:"请填写App介绍信息、用于场景内置信息...",rows:4,style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",J,[n(je,{label:"排序ID",prop:"sortId"},{default:g((()=>[n(t,{size:"large",modelValue:ue.sortId,"onUpdate:modelValue":l[9]||(l[9]=e=>ue.sortId=e),modelModifiers:{number:!0},placeholder:"请填写排序ID[数字越大越靠前]",style:{width:"240px"}},null,8,["modelValue"])])),_:1}),n(je,{label:"示例提问",prop:"demoData"},{default:g((()=>[n(t,{modelValue:ue.demoData,"onUpdate:modelValue":l[10]||(l[10]=e=>ue.demoData=e),type:"textarea",placeholder:"请填写App的demo示例数据、每换行一次表示一个新的示例...",rows:4,style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",W,[n(je,{label:"预设热度",prop:"useCount"},{default:g((()=>[n(t,{size:"large",modelValue:ue.useCount,"onUpdate:modelValue":l[11]||(l[11]=e=>ue.useCount=e),modelModifiers:{number:!0},placeholder:"请填写预设热度",style:{width:"240px"}},null,8,["modelValue"])])),_:1}),n(je,{label:"预设收藏",prop:"collectCount"},{default:g((()=>[n(t,{size:"large",modelValue:ue.collectCount,"onUpdate:modelValue":l[12]||(l[12]=e=>ue.collectCount=e),placeholder:"请填写预设收藏",style:{width:"240px"}},null,8,["modelValue"])])),_:1})]),i("div",L,[n(je,{label:"是否GPTS应用",prop:"gptsApp"},{default:g((()=>[n(Ne,{modelValue:ue.gptsApp,"onUpdate:modelValue":l[13]||(l[13]=e=>ue.gptsApp=e)},null,8,["modelValue"])])),_:1}),1!=ue.gptsApp?(u(),b(je,{key:0,label:"使用模型"},{default:g((()=>[n(t,{size:"large",modelValue:ue.relModel,"onUpdate:modelValue":l[15]||(l[15]=e=>ue.relModel=e),style:{"max-width":"600px",width:"240px"},placeholder:"请选择/输入你要使用的模型",class:"input-with-select"},{suffix:g((()=>[n(d,{modelValue:ue.relModel,"onUpdate:modelValue":l[14]||(l[14]=e=>ue.relModel=e),placeholder:"Select",style:{width:"30px",border:"none"}},{default:g((()=>[(u(!0),p(f,null,y(h(P),(e=>(u(),b(o,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1})):(u(),b(je,{key:1,label:"GPTS应用ID",prop:"modelId"},{default:g((()=>[n(t,{modelValue:ue.modelId,"onUpdate:modelValue":l[16]||(l[16]=e=>ue.modelId=e),placeholder:"请填写GPTS应用ID",style:{width:"240px"}},null,8,["modelValue"])])),_:1}))]),1!=ue.gptsApp?(u(),b(je,{key:0,label:"应用预设",prop:"preset"},{default:g((()=>[n(t,{size:"large",type:"textarea",modelValue:ue.preset,"onUpdate:modelValue":l[17]||(l[17]=e=>ue.preset=e),placeholder:"请填写应用预设信息"},null,8,["modelValue"])])),_:1})):w("",!0),i("div",$,[n(je,{label:"启用状态",prop:"status"},{default:g((()=>[n(Ne,{modelValue:ue.status,"onUpdate:modelValue":l[18]||(l[18]=e=>ue.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),n(je,{label:"启用上传",prop:"canUpload"},{default:g((()=>[n(Ne,{modelValue:ue.canUpload,"onUpdate:modelValue":l[19]||(l[19]=e=>ue.canUpload=e)},null,8,["modelValue"])])),_:1}),n(je,{label:"推荐应用",prop:"recommend"},{default:g((()=>[n(Ne,{modelValue:ue.recommend,"onUpdate:modelValue":l[20]||(l[20]=e=>ue.recommend=e)},null,8,["modelValue"])])),_:1}),n(je,{label:"自定义参数",prop:"customParams"},{default:g((()=>[n(Ne,{modelValue:ue.customParams,"onUpdate:modelValue":l[21]||(l[21]=e=>ue.customParams=e)},null,8,["modelValue"])])),_:1})]),ue.customParams&&ue.config?(u(),p(f,{key:1},[n(Ee,{type:"left"},{default:g((()=>l[34]||(l[34]=[v("高级配置")]))),_:1}),n(Ye,{modelValue:ue.config,"onUpdate:modelValue":l[23]||(l[23]=e=>ue.config=e)},{default:g((()=>[n(Se,{label:"输入提示"},{default:g((()=>[i("div",Q,[n(qe,{prop:"placeholder"}),l[35]||(l[35]=v(" (输入提示指的是对话输入框中的提示) "))])])),_:1}),n(Se,{label:"格式化内容",prop:"format"},{default:g((()=>[n(Ge,{type:"textarea",modelValue:ue.config.format,"onUpdate:modelValue":l[22]||(l[22]=e=>ue.config.format=e),label:"输入提示",prop:"placeholder",onInput:ge,rows:5},null,8,["modelValue"]),l[36]||(l[36]=i("div",null,"格式化内容指的是用户在使用工具时候会提前预设好内容，根据选择的配置将内容填充完成",-1)),l[37]||(l[37]=i("div",{style:{"font-size":"12px",color:"#b1b1b1"},innerHTML:" 比如:请根据我提供的健身需求：“{{输入内容}}”，我的个人情况是：性别{{性别}}、{{健身历史}}，希望频次为{{频次}}，制定合适的健身计划，并推荐合适的健身动作，并附带动作指导和注意事项，并提醒量力而行"},null,-1))])),_:1}),(u(!0),p(f,null,y(ue.config.tags,(e=>(u(),p("div",null,[n(Ee,{type:"left"},{default:g((()=>[v(x(e.key),1)])),_:2},1024),i("div",X,[n(Be,{label:"显示组件",modelValue:e.tag,"onUpdate:modelValue":l=>e.tag=l,width:"100"},{default:g((()=>[n(Te,{value:"input"},{default:g((()=>l[38]||(l[38]=[v("输入框")]))),_:1}),n(Te,{value:"select"},{default:g((()=>l[39]||(l[39]=[v("下拉框")]))),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"]),"select"==e.tag?(u(),b(Oe,{key:0,label:"多选",modelValue:e.mutiple,"onUpdate:modelValue":l=>e.mutiple=l},null,8,["modelValue","onUpdate:modelValue"])):w("",!0),"select"==e.tag?(u(),b(qe,{key:1,label:"组件配置",modelValue:e.options,"onUpdate:modelValue":l=>e.options=l,tip:"多选逗号分隔",width:"200"},null,8,["modelValue","onUpdate:modelValue"])):w("",!0),n(Oe,{label:"必填",modelValue:e.required,"onUpdate:modelValue":l=>e.required=l},null,8,["modelValue","onUpdate:modelValue"])])])))),256))])),_:1},8,["modelValue"])],64)):w("",!0)])),_:1},8,["model","rules"])]),i("div",Z,[n(Ve,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[24]||(l[24]=e=>ye(h(oe)))},{default:g((()=>l[40]||(l[40]=[v("取消 ")]))),_:1}),n(Ve,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:l[25]||(l[25]=e=>{var l;null==(l=h(oe))||l.validate((async e=>{if(e){if(0==C.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");if(de.value){const e={id:de.value,...ue};se.value&&Object.assign(e,{status:re.value}),await I.updateApp(e),k({type:"success",message:"更新应用成功！"})}else delete ue.id,await I.createApp(ue),k({type:"success",message:"创建应用成功！"});ee.value=!1,me()}}))})},{default:g((()=>l[41]||(l[41]=[v(" 确定 ")]))),_:1})])])),_:1},8,["modelValue"])])}}});"function"==typeof F&&F(ee);const le=C(ee,[["__scopeId","data-v-01cda072"]]);export{le as default};
