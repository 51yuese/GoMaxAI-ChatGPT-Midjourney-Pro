
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{m as e}from"../marked.esm/marked.esm.3c8fbedb.js";import{A as a}from"../badWords/badWords.49f4bd04.js";import{d as l,U as t,r,C as n,V as o,e as s,ah as i,o as u,f as d,m as p,g as f,h as c,F as m,J as g,j as w,i as v,q as h,Y as y,t as b,ag as _,ae as x,a1 as I,a2 as C}from"../main-9d6c7d62.js";import{u as z}from"../utcformatTime/utcformatTime.f6db2c52.js";import{T as k,U as F,q as j}from"../index/index.82d04ab0.js";const O={class:"search_condition"},V={style:{display:"flex","align-items":"center"}},U={style:{"margin-left":"12px"}},A={style:{"margin-top":"22px","margin-left":"12px"}},M=["src"],T={class:"answer"},Y=["innerHTML"],q=l({__name:"violation",setup(l){const I=t(),C=new e.Renderer;e.setOptions({renderer:C,gfm:!0,pedantic:!1,sanitize:!1});const q=r(!1),L=r([]);r();const S=r(0),J=n({userId:"",typeOriginCn:"",page:1,size:10}),R=r([]);async function D(){q.value=!0;try{const e=await a.queryViolation(J);q.value=!1;const{rows:l,count:t}=e.data;S.value=t,R.value=l}catch(e){q.value=!1}}async function E(e){const a=await _.queryAllUser({size:30,username:e});L.value=a.data.rows}function H(){J.userId="",J.typeOriginCn="",J.page=1,J.size=10,D()}return r(!1),n({status:0,id:0}),o((()=>{D()})),(l,t)=>{const r=s("el-option"),n=s("el-select"),o=s("el-button"),_=s("RefreshRight"),C=s("el-icon"),N=s("el-table-column"),P=s("el-tag"),W=s("el-popover"),B=s("el-popconfirm"),G=s("el-table"),K=s("el-pagination"),Q=s("el-row"),X=i("loading");return u(),d("div",null,[p("div",O,[p("div",V,[p("div",null,[t[4]||(t[4]=p("div",{class:"search_title"},"用户信息",-1)),p("div",null,[f(n,{modelValue:J.userId,"onUpdate:modelValue":t[0]||(t[0]=e=>J.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":E,style:{width:"192px"}},{default:c((()=>[(u(!0),d(m,null,g(v(L),(e=>(u(),w(r,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",U,[t[5]||(t[5]=p("div",{class:"search_title"},"检测平台",-1)),p("div",null,[f(n,{modelValue:J.typeOriginCn,"onUpdate:modelValue":t[1]||(t[1]=e=>J.typeOriginCn=e),placeholder:"请选择检测平台",clearable:"",style:{width:"192px"}},{default:c((()=>[(u(!0),d(m,null,g(v(k),(e=>(u(),w(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),p("div",A,[f(o,{text:"",bg:"",style:{"font-size":"15px",color:"#60A5FA","background-color":"#EFF6FF","border-radius":"8px"},onClick:D},{default:c((()=>t[6]||(t[6]=[h("查询 ")]))),_:1})]),p("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:H},[f(C,{color:"#3B82F6",size:"20"},{default:c((()=>[f(_)])),_:1})])])]),p("div",null,[y((u(),w(G,{border:"",data:v(R),height:"67vh",style:{width:"100%"},"tooltip-options":{}},{default:c((()=>[f(N,{fixed:"",prop:"userInfo.username",label:"用户名",width:"150"},{default:c((e=>[h(b(null==e.row.userInfo.username?"--":e.row.userInfo.username),1)])),_:1}),f(N,{prop:"userInfo.avatar",label:"头像",width:"120"},{default:c((e=>{var a,l;return[p("img",{src:null==(l=null==(a=e.row)?void 0:a.userInfo)?void 0:l.avatar,style:{height:"50px"}},null,8,M)]})),_:1}),f(N,{fixed:"",prop:"userInfo.nickname",label:"昵称",width:"150"},{default:c((e=>[h(b(null==e.row.userInfo.nickname?"--":e.row.userInfo.nickname),1)])),_:1}),f(N,{fixed:"",prop:"userInfo.phone",label:"手机号",width:"150"},{default:c((e=>[h(b(""==e.row.userInfo.phone?"--":e.row.userInfo.phone),1)])),_:1}),f(N,{prop:"userInfo.email",label:"邮箱",width:"200"},{default:c((e=>[h(b(""==e.row.userInfo.email?"--":e.row.userInfo.email),1)])),_:1}),f(N,{prop:"status",label:"用户状态",width:"120",align:"center"},{default:c((({row:e})=>[f(P,{type:v(F)[e.userInfo.status]},{default:c((()=>[h(b(v(j)[e.userInfo.status]),1)])),_:2},1032,["type"])])),_:1}),f(N,{prop:"userInfo.violationCount",label:"累计次数",width:"90",align:"center"}),f(N,{label:"违规类型"},{default:c((e=>[f(P,{type:"danger"},{default:c((()=>{var a,l;return[h(b((null==(a=e.row)?void 0:a.typeCn)?JSON.parse(null==(l=e.row)?void 0:l.typeCn).join("  |  "):""),1)]})),_:2},1024)])),_:1}),f(N,{label:"违规关键词"},{default:c((e=>{var a,l;return[h(b((null==(a=e.row)?void 0:a.words)?JSON.parse(null==(l=e.row)?void 0:l.words).join("  |  "):""),1)]})),_:1}),f(N,{prop:"typeOriginCn",label:"违规检测来源",width:"120"},{default:c((e=>[f(P,{type:"success"},{default:c((()=>[h(b(e.row.typeOriginCn),1)])),_:2},1024)])),_:1}),f(N,{prop:"answer",label:"违规内容",width:"200"},{default:c((a=>[f(W,{placement:"top",width:400,trigger:"click"},{reference:c((()=>[p("div",T,b(a.row.content),1)])),default:c((()=>[p("div",{class:"answer_container",innerHTML:v(e)(a.row.content||"")},null,8,Y)])),_:2},1024)])),_:1}),f(N,{prop:"createdAt",label:"违规时间",width:"200"},{default:c((e=>[h(b(v(z)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),f(N,{fixed:"right",label:"操作",width:"120",align:"center"},{default:c((e=>[f(B,{title:"是否删除此违规记录？",onConfirm:l=>async function(e){if(0==I.isUserModifyPermissions())return x.error("非超级管理员无权限操作！");await a.delViolationsLog({ids:[e.id]}),x.success("删除违规记录成功！"),D()}(e.row)},{reference:c((()=>[f(o,{link:"",type:"danger",size:"small"},{default:c((()=>t[7]||(t[7]=[h(" 删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[X,v(q)]]),f(Q,{class:"flex justify-end mt-5"},{default:c((()=>[f(K,{"current-page":J.page,"onUpdate:currentPage":t[2]||(t[2]=e=>J.page=e),"page-size":J.size,"onUpdate:pageSize":t[3]||(t[3]=e=>J.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:v(S),onSizeChange:D,onCurrentChange:D},null,8,["current-page","page-size","total"])])),_:1})])])}}});"function"==typeof C&&C(q);const L=I(q,[["__scopeId","data-v-8aea8d5f"]]);export{L as default};
