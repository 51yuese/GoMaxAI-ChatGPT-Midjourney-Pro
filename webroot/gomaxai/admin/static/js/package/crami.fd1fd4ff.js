
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,u as a,r as l,G as t,C as o,x as r,j as s,V as d,o as i,c as n,b as u,f as p,g as c,W as m,X as g,e as f,h as y,w as b,J as v,t as x,O as h,K as w,U as _,P as k,y as F,p as V,k as z,_ as C,q as U}from"../main-7fe883cc.js";import{A as I}from"./package.12d38bf0.js";import{u as A}from"../utcformatTime/utcformatTime.f6db2c52.js";import{C as j}from"../index/index.21f4f4e7.js";const q=e=>(V("data-v-349d5418"),e=e(),z(),e),M={class:"search_add_card"},P={style:{display:"flex","align-items":"center"}},B=q((()=>u("div",{class:"condition_name"},"用户信息",-1))),Y={style:{"margin-left":"10px"}},E=q((()=>u("div",{class:"condition_name"},"卡密状态",-1))),N={style:{"margin-left":"10px"}},R={style:{"margin-top":"22px"}},S={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},D=q((()=>u("div",null," 生成卡密 ",-1))),T={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},G={key:1},J={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},K=e({__name:"crami",setup(e){const V=a();l();const z=l(0),C=l(!1);l(!1);const U=l(),q=l(0),K=l([]),O=l([]),W=l(!1),X=l([]);l([]);const $=t({packageId:null,count:1,score:1}),H=t({useId:"",status:"",page:1,size:15}),L=t({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],score:[{required:!0,message:"卡密携带积分数量",trigger:"blur"}]}),Q=l([]);async function Z(){try{W.value=!0;const e=await I.queryAllCrami(H),{rows:a,count:l}=e.data;W.value=!1,z.value=l,Q.value=a}catch(e){W.value=!1}}async function ee(e){const a=await _.queryAllUser({size:30,username:e});O.value=a.data.rows}function ae(){$.packageId=null,$.count=1,$.score=1,async function(){const e=await I.queryAllPackage({size:100});K.value=e.data.rows}(),C.value=!0}function le(e){null==e||e.resetFields(),Z()}async function te(e){X.value=e}return o((()=>Q.value.some((e=>e.email)))),r((()=>{Z()})),(e,a)=>{const l=s("el-option"),t=s("el-select"),o=s("el-button"),r=s("RefreshRight"),_=s("el-icon"),X=s("el-table-column"),oe=s("el-tag"),re=s("el-popconfirm"),se=s("el-table"),de=s("el-pagination"),ie=s("el-row"),ne=F,ue=s("el-switch"),pe=s("el-form-item"),ce=s("el-input"),me=s("el-form"),ge=s("el-dialog"),fe=d("loading");return i(),n("div",null,[u("div",M,[u("div",P,[u("div",null,[B,p(t,{modelValue:H.useId,"onUpdate:modelValue":a[0]||(a[0]=e=>H.useId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":ee,style:{width:"192px"}},{default:c((()=>[(i(!0),n(m,null,g(f(O),(e=>(i(),v(l,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",Y,[E,p(t,{modelValue:H.status,"onUpdate:modelValue":a[1]||(a[1]=e=>H.status=e),placeholder:"请选择卡密状态",clearable:"",style:{width:"192px"}},{default:c((()=>[(i(!0),n(m,null,g(f(j),(e=>(i(),v(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",N,[p(o,{bg:"",text:"",type:"primary",size:"large",style:{"font-size":"15px",height:"32px",background:"#EFF6FF",color:"#60A5FA","border-radius":"8px","margin-top":"25px"},onClick:Z},{default:c((()=>[y(" 查询 ")])),_:1})]),u("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:le},[p(_,{color:"#3B82F6",size:"20"},{default:c((()=>[p(r)])),_:1})])]),u("div",R,[p(o,{style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:ae},{default:c((()=>[y("批量生成 ")])),_:1})])]),u("div",null,[b((i(),v(se,{border:"",data:f(Q),height:"calc(100vh - 310px)",style:{width:"100%"},size:"large",onSelectionChange:te},{default:c((()=>[p(X,{type:"selection",width:"55"}),p(X,{prop:"code",label:"卡密账号"}),p(X,{prop:"packageName",label:"套餐类型"},{default:c((e=>[p(oe,{type:e.row.packageName?"primary":"danger"},{default:c((()=>[y(x(e.row.packageName||"自定义卡密"),1)])),_:2},1032,["type"])])),_:1}),p(X,{prop:"code",label:"卡密状态"},{default:c((e=>[p(oe,{type:e.row.status?"danger":"primary"},{default:c((()=>[y(x(e.row.status?"已使用":"未使用"),1)])),_:2},1032,["type"])])),_:1}),p(X,{prop:"username",label:"用户名"},{default:c((e=>[y(x(null==e.row.username?"--":e.row.username),1)])),_:1}),p(X,{prop:"phone",label:"手机号"},{default:c((e=>[y(x(""==e.row.phone?"--":e.row.phone),1)])),_:1}),p(X,{prop:"email",label:"邮箱"},{default:c((e=>[y(x(""==e.row.email?"--":e.row.email),1)])),_:1}),p(X,{prop:"createdAt",label:"生成时间"},{default:c((e=>[y(x(f(A)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),p(X,{label:"操作"},{default:c((e=>[p(re,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:a=>async function(e){if(0==V.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");await I.delCrami({id:e.id}),k({type:"success",message:"删除卡密成功！"}),Z()}(e.row)},{reference:c((()=>[p(o,{link:"",type:"danger",size:"small"},{default:c((()=>[y(" 删除卡密 ")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[fe,f(W)]]),p(ie,{class:"flex justify-end mt-5"},{default:c((()=>[p(de,{"current-page":H.page,"onUpdate:currentPage":a[2]||(a[2]=e=>H.page=e),"page-size":H.size,"onUpdate:pageSize":a[3]||(a[3]=e=>H.size=e),class:"mr-5","page-sizes":[15,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:f(z),onSizeChange:Z,onCurrentChange:Z},null,8,["current-page","page-size","total"])])),_:1})]),p(ge,{modelValue:f(C),"onUpdate:modelValue":a[11]||(a[11]=e=>h(C)?C.value=e:null),width:"500","show-close":!1,"destroy-on-close":""},{header:c((({close:e,titleId:l,titleClass:t})=>[u("div",S,[D,u("div",{onClick:a[4]||(a[4]=e=>C.value=!1),style:{cursor:"pointer"}},[p(_,null,{default:c((()=>[p(ne,{name:"close"})])),_:1})])])])),default:c((()=>[u("div",T,[p(me,{ref_key:"formCramiRef",ref:U,"label-position":"right","label-width":"100px",model:$,rules:L},{default:c((()=>[p(ie,null,{default:c((()=>[p(pe,{label:"是否生成自定义卡密","label-width":"170px"},{default:c((()=>[p(ue,{modelValue:f(q),"onUpdate:modelValue":a[5]||(a[5]=e=>h(q)?q.value=e:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1}),f(q)?w("",!0):(i(),v(pe,{key:0,label:"套餐类型",prop:"packageId"},{default:c((()=>[p(t,{size:"large",modelValue:$.packageId,"onUpdate:modelValue":a[6]||(a[6]=e=>$.packageId=e),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:c((()=>[(i(!0),n(m,null,g(f(K),(e=>(i(),v(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})),f(q)?(i(),n("div",G,[p(pe,{label:"积分额度",prop:"score"},{default:c((()=>[p(ce,{size:"large",modelValue:$.score,"onUpdate:modelValue":a[7]||(a[7]=e=>$.score=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带积分额度额度"},null,8,["modelValue"])])),_:1})])):w("",!0),p(pe,{label:"生成数量",prop:"count"},{default:c((()=>[p(ce,{size:"large",modelValue:$.count,"onUpdate:modelValue":a[8]||(a[8]=e=>$.count=e),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])]),u("div",J,[p(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:a[9]||(a[9]=e=>C.value=!1)},{default:c((()=>[y("取消 ")])),_:1}),p(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:a[10]||(a[10]=e=>async function(e){null==e||e.validate((async e=>{if(e){if(0==V.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");await I.createCrami($),k({type:"success",message:"生成卡密成功！"}),C.value=!1,Z()}}))}(f(U)))},{default:c((()=>[y(" 确认 ")])),_:1})])])),_:1},8,["modelValue"])])}}});"function"==typeof U&&U(K);const O=C(K,[["__scopeId","data-v-349d5418"]]);export{O as default};
