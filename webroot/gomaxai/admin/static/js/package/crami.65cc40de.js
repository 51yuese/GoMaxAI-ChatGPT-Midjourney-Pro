
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,u as a,r as l,F as o,B as t,o as r,l as d,V as s,b as i,e as n,f as u,h as p,i as c,Y as m,X as g,g as f,j as b,w as y,J as v,K as x,t as h,O as w,U as _,P as k,x as F,_ as V,q as z}from"../main-46c178e9.js";import{A as C}from"./package.be70657c.js";import{u as A}from"../utcformatTime/utcformatTime.f6db2c52.js";import{C as U}from"../index/index.1baeddf5.js";import{a as I}from"../access/access.8e3eb471.js";const j={class:"search_add_card"},q={style:{display:"flex","align-items":"center"}},M={style:{"margin-left":"10px"}},S={style:{"margin-left":"10px"}},B={style:{"margin-top":"22px"}},P={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},Y={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},E={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},N={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},D={key:1},R={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},T=e({__name:"crami",setup(e){const V=a();l();const z=l(0),T=l(!1);l(!1);const J=l(),K=l(0),O=l([]),X=l([]),G=l(!1),H=l([]);l([]);const L=o({packageId:null,count:1,score:1}),Q=o({useId:"",status:"",page:1,size:15}),W=o({packageId:[{required:!0,message:"请选择套餐类型",trigger:"change"}],days:[{required:!0,message:"请填写有效期天数",trigger:"blur"}],count:[{required:!0,message:"请填写想要生成的数量",trigger:"blur"}],score:[{required:!0,message:"卡密携带积分数量",trigger:"blur"}]}),Z=l([]);async function $(){try{G.value=!0;const e=await C.queryAllCrami(Q),{rows:a,count:l}=e.data;G.value=!1,z.value=l,Z.value=a}catch(e){G.value=!1}}async function ee(e){const a=await _.queryAllUser({size:30,username:e});X.value=a.data.rows}function ae(){L.packageId=null,L.count=1,L.score=1,async function(){const e=await C.queryAllPackage({size:100});O.value=e.data.rows}(),T.value=!0}function le(){Q.useId="",Q.status="",$()}async function oe(e){H.value=e}const te=l(null),re=l(!1),de=l([]);async function se(){if(0===H.value.map((e=>e.id)).length)return void k.error("请选择要赠送的卡密");const{data:e}=await I.getSaasPage({size:1e3,page:1});de.value=e.rows,re.value=!0}async function ie(){const e=H.value.map((e=>e.id));0!==e.length?(await C.batchDistribute({ids:e,saasId:te.value}),re.value=!1,H.value=[],$()):k.error("请选择要赠送的卡密")}return t((()=>Z.value.some((e=>e.email)))),r((()=>{$()})),(e,a)=>{const l=d("el-option"),o=d("el-select"),t=d("el-button"),r=d("RefreshRight"),_=d("el-icon"),I=d("el-table-column"),H=d("el-tag"),ne=d("el-popconfirm"),ue=d("el-table"),pe=d("el-pagination"),ce=d("el-row"),me=d("el-dialog"),ge=F,fe=d("el-switch"),be=d("el-form-item"),ye=d("el-input"),ve=d("el-form"),xe=s("platform"),he=s("loading");return i(),n("div",null,[u("div",j,[u("div",q,[u("div",null,[a[15]||(a[15]=u("div",{class:"condition_name"},"用户信息",-1)),p(o,{modelValue:Q.useId,"onUpdate:modelValue":a[0]||(a[0]=e=>Q.useId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":ee,style:{width:"192px"}},{default:c((()=>[(i(!0),n(m,null,g(f(X),(e=>(i(),v(l,{key:e.id,label:e.username,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",M,[a[16]||(a[16]=u("div",{class:"condition_name"},"卡密状态",-1)),p(o,{modelValue:Q.status,"onUpdate:modelValue":a[1]||(a[1]=e=>Q.status=e),placeholder:"请选择卡密状态",clearable:"",style:{width:"192px"}},{default:c((()=>[(i(!0),n(m,null,g(f(U),(e=>(i(),v(l,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",S,[p(t,{bg:"",text:"",type:"primary",size:"large",style:{"font-size":"15px",height:"32px",background:"#EFF6FF",color:"#60A5FA","border-radius":"8px","margin-top":"25px"},onClick:$},{default:c((()=>a[17]||(a[17]=[b(" 查询 ")]))),_:1})]),u("div",{style:{"margin-left":"12px","background-color":"#EFF6FF",padding:"4px 16px","border-radius":"8px","margin-top":"22px",cursor:"pointer"},onClick:le},[p(_,{color:"#3B82F6",size:"20"},{default:c((()=>[p(r)])),_:1})])]),u("div",B,[f(V).isSuperAdmin?y((i(),v(t,{key:0,style:{"background-color":"transparent",border:"1px solid #15d3a4","border-radius":"8px",color:"#15d3a4"},onClick:se},{default:c((()=>a[18]||(a[18]=[b("批量赠送 ")]))),_:1})),[[xe,["saas"]]]):x("",!0),f(V).isSuperAdmin?(i(),v(t,{key:1,style:{"background-color":"transparent",border:"1px solid #3B82F6","border-radius":"8px",color:"#3B82F6"},onClick:ae},{default:c((()=>a[19]||(a[19]=[b("批量生成 ")]))),_:1})):x("",!0)])]),u("div",null,[y((i(),v(ue,{border:"",data:f(Z),height:"calc(100vh - 310px)",style:{width:"100%"},size:"large",onSelectionChange:oe},{default:c((()=>[p(I,{type:"selection",width:"55"}),f(V).isSuperAdmin||f(V).isAdmin?y((i(),v(I,{key:0,prop:"saasName",label:"所属代理"},null,512)),[[xe,["saas"]]]):x("",!0),p(I,{prop:"code",label:"卡密账号"}),p(I,{prop:"packageName",label:"套餐类型"},{default:c((e=>[p(H,{type:e.row.packageName?"primary":"danger"},{default:c((()=>[b(h(e.row.packageName||"自定义卡密"),1)])),_:2},1032,["type"])])),_:1}),p(I,{prop:"code",label:"卡密状态"},{default:c((e=>[p(H,{type:e.row.status?"danger":"primary"},{default:c((()=>[b(h(e.row.status?"已使用":"未使用"),1)])),_:2},1032,["type"])])),_:1}),p(I,{prop:"username",label:"用户名"},{default:c((e=>[b(h(null==e.row.username?"--":e.row.username),1)])),_:1}),p(I,{prop:"phone",label:"手机号"},{default:c((e=>[b(h(""==e.row.phone?"--":e.row.phone),1)])),_:1}),p(I,{prop:"email",label:"邮箱"},{default:c((e=>[b(h(""==e.row.email?"--":e.row.email),1)])),_:1}),p(I,{prop:"createdAt",label:"生成时间"},{default:c((e=>[b(h(f(A)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),p(I,{label:"操作"},{default:c((e=>[p(ne,{title:"确认删除此卡密么?",width:"200","icon-color":"red",onConfirm:a=>async function(e){if(0==V.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");await C.delCrami({id:e.id}),k({type:"success",message:"删除卡密成功！"}),$()}(e.row)},{reference:c((()=>[p(t,{link:"",type:"danger",size:"small"},{default:c((()=>a[20]||(a[20]=[b(" 删除卡密 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[he,f(G)]]),p(ce,{class:"flex justify-end mt-5"},{default:c((()=>[p(pe,{"current-page":Q.page,"onUpdate:currentPage":a[2]||(a[2]=e=>Q.page=e),"page-size":Q.size,"onUpdate:pageSize":a[3]||(a[3]=e=>Q.size=e),class:"mr-5","page-sizes":[15,50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:f(z),onSizeChange:$,onCurrentChange:$},null,8,["current-page","page-size","total"])])),_:1})]),p(me,{modelValue:f(re),"onUpdate:modelValue":a[6]||(a[6]=e=>w(re)?re.value=e:null),width:"500","show-close":!1,"destroy-on-close":""},{header:c((()=>a[21]||(a[21]=[u("div",{style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}}," 请选择要赠送的代理商 ",-1)]))),default:c((()=>[u("div",P,[p(o,{modelValue:f(te),"onUpdate:modelValue":a[4]||(a[4]=e=>w(te)?te.value=e:null)},{default:c((()=>[(i(!0),n(m,null,g(f(de),(e=>(i(),v(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),u("div",Y,[p(t,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:a[5]||(a[5]=e=>re.value=!1)},{default:c((()=>a[22]||(a[22]=[b("取消 ")]))),_:1}),p(t,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:ie},{default:c((()=>a[23]||(a[23]=[b(" 确认 ")]))),_:1})])])),_:1},8,["modelValue"]),p(me,{modelValue:f(T),"onUpdate:modelValue":a[14]||(a[14]=e=>w(T)?T.value=e:null),width:"500","show-close":!1,"destroy-on-close":""},{header:c((({close:e,titleId:l,titleClass:o})=>[u("div",E,[a[24]||(a[24]=u("div",null," 生成卡密 ",-1)),u("div",{onClick:a[7]||(a[7]=e=>T.value=!1),style:{cursor:"pointer"}},[p(_,null,{default:c((()=>[p(ge,{name:"close"})])),_:1})])])])),default:c((()=>[u("div",N,[p(ve,{ref_key:"formCramiRef",ref:J,"label-position":"right","label-width":"100px",model:L,rules:W},{default:c((()=>[p(ce,null,{default:c((()=>[p(be,{label:"是否生成自定义卡密","label-width":"170px"},{default:c((()=>[p(fe,{modelValue:f(K),"onUpdate:modelValue":a[8]||(a[8]=e=>w(K)?K.value=e:null),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1})])),_:1}),f(K)?x("",!0):(i(),v(be,{key:0,label:"套餐类型",prop:"packageId"},{default:c((()=>[p(o,{size:"large",modelValue:L.packageId,"onUpdate:modelValue":a[9]||(a[9]=e=>L.packageId=e),modelModifiers:{number:!0},placeholder:"请选择套餐类型",clearable:"",style:{width:"100%"}},{default:c((()=>[(i(!0),n(m,null,g(f(O),(e=>(i(),v(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})),f(K)?(i(),n("div",D,[p(be,{label:"积分额度",prop:"score"},{default:c((()=>[p(ye,{size:"large",modelValue:L.score,"onUpdate:modelValue":a[10]||(a[10]=e=>L.score=e),modelModifiers:{number:!0},type:"number",placeholder:"卡密携带积分额度额度"},null,8,["modelValue"])])),_:1})])):x("",!0),p(be,{label:"生成数量",prop:"count"},{default:c((()=>[p(ye,{size:"large",modelValue:L.count,"onUpdate:modelValue":a[11]||(a[11]=e=>L.count=e),modelModifiers:{number:!0},type:"number",placeholder:"本次生成的张数"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])]),u("div",R,[p(t,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:a[12]||(a[12]=e=>T.value=!1)},{default:c((()=>a[25]||(a[25]=[b("取消 ")]))),_:1}),p(t,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:a[13]||(a[13]=e=>async function(e){null==e||e.validate((async e=>{if(e){if(0==V.isUserModifyPermissions())return k.error("非超级管理员无权限操作！");await C.createCrami(L),k({type:"success",message:"生成卡密成功！"}),T.value=!1,$()}}))}(f(J)))},{default:c((()=>a[26]||(a[26]=[b(" 确认 ")]))),_:1})])])),_:1},8,["modelValue"])])}}});"function"==typeof z&&z(T);const J=V(T,[["__scopeId","data-v-d2640998"]]);export{J as default};
