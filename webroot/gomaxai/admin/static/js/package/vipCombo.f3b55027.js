
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{d as e,U as l,r as a,c as o,C as t,aa as r,V as s,e as d,ah as i,o as u,f as n,m as p,g as c,i as m,j as g,h as f,q as b,k as v,Y as y,t as _,F as h,J as x,A as k,ae as V,a4 as w,a1 as F}from"../main-98fa617f.js";import{A as z}from"./package.3e4bf626.js";import{u as C}from"../utcformatTime/utcformatTime.f6db2c52.js";const U={style:{"text-align":"right","margin-top":"32px","margin-bottom":"12px"}},P={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},A={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},j={key:0,style:{"margin-bottom":"20px"}},q={style:{color:"#999999"}},T={style:{display:"flex","justify-content":"space-between","align-items":"center"}},M={class:"form_item_div"},I={class:"form_item_div"},B={class:"form_item_div"},S={class:"form_item_div"},Y={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},D={style:{color:"#20295A","font-size":"15px","font-weight":"bold","background-color":"#EFF6FF",padding:"15px 20px","border-top":"15px",display:"flex","align-items":"center","justify-content":"space-between","border-top-right-radius":"15px","border-top-left-radius":"15px"}},E={style:{padding:"0 20px","border-bottom":"1px solid var(--el-border-color-lighter)"}},R={style:{color:"#999999","font-size":"14px"}},J={style:{padding:"20px",display:"flex","align-items":"center","justify-content":"space-between"}},N=F(e({__name:"vipCombo",setup(e){const F=l(),N=a(0),O=a([]),G=a(!1),H=a(!1),K=a(),L=a(0),Q=o((()=>L.value?"更新套餐":"新增套餐")),W=o((()=>L.value?"确认更新":"确认新增")),X=t({page:1,seze:15,type:2});let Z=t({id:0,name:"",type:2,order:10,originPrice:0,costs:0,days:"",score:1,des:"",scope:"",status:0,markup:0,tags:"",userType:""});const $=t({name:[{required:!0,message:"请输入套餐名称",trigger:"blur"}],order:[{required:!0,message:"请输入套餐排序",trigger:"blur"}],originPrice:[{required:!0,message:"请输入套餐原价",trigger:"blur"}],costs:[{required:!0,message:"请输入套餐折扣价",trigger:"blur"}],markup:[{required:!0,message:"请输入套餐加价",trigger:"blur"}],days:[{required:!0,message:"请输入/选择套餐时长（天）",trigger:"blur"}],score:[{required:!0,message:"请输入赠送积分的额度",trigger:"blur"}],des:[{required:!0,message:"请输入套餐描述",trigger:"blur"}],scope:[{required:!0,message:"请输入权益描述",trigger:"blur"}],status:[{required:!0,message:"",trigger:"blur"}]});async function ee(){try{G.value=!0;const e=await z.queryAllPackage(X);G.value=!1;const{rows:l,count:a}=e.data;N.value=a,O.value=l}catch(e){G.value=!1}}function le(){L.value=0,Z.id=0,Z.name="",Z.type=2,Z.order=10,Z.originPrice=0,Z.costs=0,Z.markup=0,Z.days="",Z.score=1,Z.des="",Z.scope="",Z.status=0,Z.userType="",Z.tags="",H.value=!0}function ae(e){L.value=e.id;const{id:l,name:a,type:o,order:t,userType:r,tags:s,originPrice:d,costs:i,markup:u,days:n,score:p,des:c,scope:m,status:g}=e;k((()=>{Object.assign(Z,{id:l,name:a,userType:r,tags:s,type:o,order:t,originPrice:d,costs:i,markup:u,days:n,score:p,des:c,scope:m,status:g})})),H.value=!0}function oe(){K.value.validate((async e=>{if(e){if(0==F.isUserModifyPermissions())return V.error("非超级管理员无权限操作！");if(0==L.value){delete Z.id;if(200!=(await z.createPackage(Z)).code)return void V({type:"warning",message:res.data});V({type:"success",message:"套餐新增成功！"}),H.value=!1,ee()}else{Z.id=L.value;const e=await z.updatePackage(Z);if(200!=e.code)return void V({type:"warning",message:e.data});V({type:"success",message:"套餐修改成功！"}),H.value=!1,ee()}}}))}const te=r(!1),re=a(!1),se=a([]),de=a(null),ie=a({});function ue(){H.value=!1,ce()}function ne(){le(),de.value=null,te.value=!0,re.value=!1,Z.costs=ie.value.costs,Z.originId=ie.value.id,Z.days=ie.value.days,Z.score=ie.value.score}function pe(e){ie.value=se.value.find((l=>l.id===e))}async function ce(){re.value=!0,me()}async function me(){const{data:e}=await z.package4Select({type:2});se.value=e}return s((()=>{ee()})),(e,l)=>{const a=d("el-alert"),o=d("el-button"),t=d("el-table-column"),r=d("el-tag"),s=d("el-popconfirm"),k=d("el-table"),L=d("el-pagination"),ge=d("el-row"),fe=w,be=d("el-icon"),ve=d("el-input"),ye=d("el-form-item"),_e=d("el-input-number"),he=d("els-input-tag"),xe=d("els-form-item"),ke=d("els-select"),Ve=d("el-switch"),we=d("el-form"),Fe=d("el-dialog"),ze=d("el-option"),Ce=d("el-select"),Ue=i("loading");return u(),n("div",null,[p("div",null,[p("div",null,[c(a,{closable:!1,"show-icon":"",title:"说明",description:"模型池里面可以配置该模型会员是否免费，以及会员每日可用次数",type:"warning"})]),p("div",U,[m(F).isSuperAdmin?(u(),g(o,{key:0,class:"add-btn",onClick:le},{default:f((()=>l[22]||(l[22]=[b(" 新增会员套餐 ")]))),_:1})):v("",!0),m(F).isAgent?(u(),g(o,{key:1,class:"add-btn",onClick:ce},{default:f((()=>l[23]||(l[23]=[b(" 新增会员套餐 ")]))),_:1})):v("",!0)]),p("div",null,[y((u(),g(k,{border:"","highlight-current-row":"",data:O.value,style:{width:"100%"},"max-height":"70vh"},{default:f((()=>[c(t,{prop:"order",label:"排序ID"}),c(t,{prop:"name",label:"套餐名称"}),c(t,{prop:"costs",label:"套餐成本价"}),c(t,{prop:"markup",label:"套餐加价"}),c(t,{prop:"originPrice",label:"套餐原价"}),c(t,{prop:"days",label:"套餐有效期"}),c(t,{prop:"score",label:"赠送积分额度"}),c(t,{prop:"status",label:"套餐状态"},{default:f((e=>[p("div",null,[1==e.row.status?(u(),g(r,{key:0,type:"primary"},{default:f((()=>l[24]||(l[24]=[b("启用")]))),_:1})):(u(),g(r,{key:1,type:"danger"},{default:f((()=>l[25]||(l[25]=[b("禁用")]))),_:1}))])])),_:1}),c(t,{prop:"createdAt",label:"创建时间",width:"190"},{default:f((e=>[p("div",null,_(m(C)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)])),_:1}),c(t,{fixed:"right",label:"操作",width:"160"},{default:f((e=>[m(F).isSuperAdmin?(u(),g(o,{key:0,style:{border:"none",color:"#3B82F6","font-size":"13px","background-color":"transparent"},onClick:l=>ae(e.row)},{default:f((()=>l[26]||(l[26]=[b("编辑 ")]))),_:2},1032,["onClick"])):v("",!0),m(F).isAgent?(u(),g(o,{key:1,style:{border:"none",color:"#3B82F6","font-size":"13px","background-color":"transparent"},onClick:l=>async function(e){ae(e),await me(),de.value=e.originId,pe(e.originId),te.value=!0}(e.row)},{default:f((()=>l[27]||(l[27]=[b("编辑 ")]))),_:2},1032,["onClick"])):v("",!0),c(s,{title:"确认删除此套餐么?",width:"180","icon-color":"red",onConfirm:l=>async function(e){if(0==F.isUserModifyPermissions())return V.error("非超级管理员无权限操作！");const l=await z.delPackage({ids:[e.id]});200==l.code?(V({type:"success",message:"套餐删除成功！"}),ee()):V({type:"warning",message:l.data})}(e.row)},{reference:f((()=>[c(o,{style:{border:"none",color:"#FF3B30","font-size":"13px","background-color":"transparent"}},{default:f((()=>l[28]||(l[28]=[b("删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[Ue,G.value]])]),c(ge,{class:"flex justify-end mt-3"},{default:f((()=>[c(L,{"current-page":X.page,"onUpdate:currentPage":l[0]||(l[0]=e=>X.page=e),"page-size":X.size,"onUpdate:pageSize":l[1]||(l[1]=e=>X.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:ee,onCurrentChange:ee},null,8,["current-page","page-size","total"])])),_:1})]),c(Fe,{modelValue:H.value,"onUpdate:modelValue":l[16]||(l[16]=e=>H.value=e),width:"750","show-close":!1,"destroy-on-close":"",onClose:l[17]||(l[17]=e=>te.value=!1)},{header:f((({close:e,titleId:a,titleClass:o})=>[p("div",P,[p("div",null,_(Q.value),1),p("div",{onClick:l[2]||(l[2]=e=>H.value=!1),style:{cursor:"pointer"}},[c(be,null,{default:f((()=>[c(fe,{name:"close"})])),_:1})])])])),default:f((()=>[p("div",A,[m(te)?(u(),n("div",j,[c(a,{type:"info","show-icon":""},{default:f((()=>[p("span",q,_(ie.value.des),1)])),title:f((()=>[p("div",T,[p("div",null,_(ie.value.name),1),p("div",null,[c(o,{onClick:ue},{default:f((()=>l[29]||(l[29]=[b("重新选择")]))),_:1})])])])),_:1})])):v("",!0),c(we,{"label-width":"110px",model:m(Z),rules:$,ref_key:"formRef",ref:K},{default:f((()=>[p("div",M,[c(ye,{label:"套餐名称",prop:"name"},{default:f((()=>[c(ve,{modelValue:m(Z).name,"onUpdate:modelValue":l[3]||(l[3]=e=>m(Z).name=e),class:"form_input",size:"large",placeholder:"请输入套餐名称"},null,8,["modelValue"])])),_:1}),c(ye,{label:"套餐排序",prop:"order"},{default:f((()=>[c(ve,{modelValue:m(Z).order,"onUpdate:modelValue":l[4]||(l[4]=e=>m(Z).order=e),modelModifiers:{number:!0},class:"form_input",size:"large",placeholder:"请输入套餐排序"},null,8,["modelValue"])])),_:1})]),p("div",I,[c(ye,{label:"套餐成本价",prop:"costs"},{default:f((()=>[c(_e,{modelValue:m(Z).costs,"onUpdate:modelValue":l[5]||(l[5]=e=>m(Z).costs=e),min:0,step:.01,precision:2,"controls-position":"right",class:"form_input",size:"large",placeholder:"请输入套餐折扣价",disabled:m(te)},null,8,["modelValue","disabled"])])),_:1}),c(ye,{label:"套餐原价",prop:"originPrice"},{default:f((()=>[c(_e,{modelValue:m(Z).originPrice,"onUpdate:modelValue":l[6]||(l[6]=e=>m(Z).originPrice=e),min:0,step:.01,precision:2,"controls-position":"right",class:"form_input",size:"large",placeholder:"请输入套餐原价"},null,8,["modelValue"])])),_:1})]),p("div",B,[c(ye,{label:"套餐时长(天)",prop:"days"},{default:f((()=>[c(ve,{modelValue:m(Z).days,"onUpdate:modelValue":l[7]||(l[7]=e=>m(Z).days=e),modelModifiers:{number:!0},size:"large",class:"form_input",placeholder:"请输入套餐时长(天)",disabled:m(te)},null,8,["modelValue","disabled"])])),_:1}),c(ye,{label:"赠送积分额度",prop:"score"},{default:f((()=>[c(ve,{modelValue:m(Z).score,"onUpdate:modelValue":l[8]||(l[8]=e=>m(Z).score=e),modelModifiers:{number:!0},class:"form_input",size:"large",placeholder:"请输入所赠送积分额度",disabled:m(te)},null,8,["modelValue","disabled"])])),_:1})]),c(ye,{label:"套餐描述",prop:"des"},{default:f((()=>[c(ve,{modelValue:m(Z).des,"onUpdate:modelValue":l[9]||(l[9]=e=>m(Z).des=e),size:"large",placeholder:"请输入套餐描述"},null,8,["modelValue"])])),_:1}),c(ye,{label:"权益描述",prop:"scope"},{default:f((()=>[c(ve,{modelValue:m(Z).scope,"onUpdate:modelValue":l[10]||(l[10]=e=>m(Z).scope=e),size:"large",placeholder:"请输入权益描述"},null,8,["modelValue"])])),_:1}),c(xe,{label:"标签",prop:"tags"},{default:f((()=>[c(he,{label:"标签",modelValue:m(Z).tags,"onUpdate:modelValue":l[11]||(l[11]=e=>m(Z).tags=e)},null,8,["modelValue"])])),_:1}),c(xe,{label:"会员类型",prop:"userType","suffix-content":"(*购买后升级的用户类型)"},{default:f((()=>[c(ke,{label:"会员类型",modelValue:m(Z).userType,"onUpdate:modelValue":l[12]||(l[12]=e=>m(Z).userType=e),clearable:"",size:"large",width:"200",url:"dict/list?dictType=vip-leavel","label-field":"dictName","value-field":"id"},null,8,["modelValue"])])),_:1}),p("div",S,[c(ye,{label:"套餐状态",prop:"status"},{default:f((()=>[c(Ve,{modelValue:m(Z).status,"onUpdate:modelValue":l[13]||(l[13]=e=>m(Z).status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),c(ye,{label:"套餐加价",prop:"markup"},{default:f((()=>[c(_e,{modelValue:m(Z).markup,"onUpdate:modelValue":l[14]||(l[14]=e=>m(Z).markup=e),min:0,step:.01,precision:2,"controls-position":"right",class:"form_input",size:"large",placeholder:"请输入套餐折扣价",disabled:m(te)},null,8,["modelValue","disabled"])])),_:1}),l[30]||(l[30]=p("div",{style:{"margin-bottom":"18px","font-size":"12px",color:"#999999"}},"* 实际销售价格 = 套餐成本价 + 套餐加价",-1))])])),_:1},8,["model","rules"])]),p("div",Y,[c(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[15]||(l[15]=e=>H.value=!1)},{default:f((()=>l[31]||(l[31]=[b("取消 ")]))),_:1}),c(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:oe},{default:f((()=>[b(_(W.value),1)])),_:1})])])),_:1},8,["modelValue"]),c(Fe,{modelValue:re.value,"onUpdate:modelValue":l[21]||(l[21]=e=>re.value=e),width:"750","show-close":!1,"destroy-on-close":""},{header:f((()=>[p("div",D,[l[32]||(l[32]=p("div",null," 请选择要创建的套餐类型 ",-1)),p("div",{onClick:l[18]||(l[18]=e=>re.value=!1),style:{cursor:"pointer"}},[c(be,null,{default:f((()=>[c(fe,{name:"close"})])),_:1})])])])),default:f((()=>[p("div",E,[c(we,{"label-width":"110px"},{default:f((()=>[c(ye,{label:"套餐选择",prop:"des",style:{margin:"20px 0"}},{default:f((()=>[c(Ce,{modelValue:de.value,"onUpdate:modelValue":l[19]||(l[19]=e=>de.value=e),placeholder:"请选择要创建的套餐类型",onChange:pe},{default:f((()=>[(u(!0),n(h,null,x(se.value,(e=>(u(),g(ze,{key:e.id,label:e.name,value:e.id},{default:f((()=>[b(_(e.name),1),p("span",R," - "+_(e.des),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})]),p("div",J,[c(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#F4F4F5",color:"#20295A","border-radius":"8px"},onClick:l[20]||(l[20]=e=>re.value=!1)},{default:f((()=>l[33]||(l[33]=[b("取消 ")]))),_:1}),c(o,{bg:"",text:"",style:{width:"40%",padding:"20px 0","background-color":"#3B82F6",color:"#FFF","border-radius":"8px"},type:"primary",onClick:ne},{default:f((()=>l[34]||(l[34]=[b(" 确定选择 ")]))),_:1})])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-62e62605"]]);export{N as default};
