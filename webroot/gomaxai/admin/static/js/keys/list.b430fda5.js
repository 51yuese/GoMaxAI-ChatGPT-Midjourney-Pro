
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.fa4ac1f2.js";import{ay as l,d as a,r as t,C as o,c as u,V as s,e as d,ah as n,o as r,f as i,g as p,h as m,F as y,J as c,j as f,i as k,q as g,m as b,Y as _,t as h,s as w,ae as x,A as v,a2 as V}from"../main-537e5929.js";import{u as T}from"../utcformatTime/utcformatTime.f6db2c52.js";import{b as U,Q as M,E as C,d as D}from"../index/index.55773171.js";const K={queryKeyList:e=>l.get("chatgpt/keyList",{params:e}),addGptKey:e=>l.post("chatgpt/addKey",e),updateGptKey:e=>l.post("chatgpt/updateKey",e),deleteGptKey:e=>l.post("chatgpt/deleteKey",e)},P={style:{float:"right"}},z={class:"flex justify-end mr-5"},R={class:"flex justify-end mr-5"},j=a({__name:"list",setup(l){const a=t(),V=t(),j=t(0),q=t(!1),L=t(!1),A=t(!1),G=t(!1),Y=t(["gpt-4-all","gpt-4-dalle","gpt-4-v","gpt-4-1106-preview","gpt-4-vision-preview","gpt-4","gpt-4-0613","gpt-4-32k","gpt-4-32k-0613","gpt-3.5-turbo","gpt-3.5-turbo-0613","gpt-3.5-turbo-16k-0613","gpt-3.5-turbo-16k","code-davinci-002","ada","davinci"]),F=o({keyList:""}),S=o({key:"",model:"",status:"",page:1,size:10}),B=t(),E=t(0),J=o({key:"",model:"",maxModelTokens:null,maxResponseTokens:null,openaiProxyUrl:"",openaiTimeoutMs:null,weight:1,status:1}),O=o({key:[{required:!0,message:"请填写您的chatgpt key",trigger:"blur"}],model:[{required:!0,message:"请选择当前key需要绑定的模型",trigger:"change"}],weight:[{required:!1,message:"请填写key的权重值",trigger:"blur"}],status:[{required:!0,message:"请选择key的启用状态",trigger:"change"}],maxModelTokens:[{required:!1,message:"请填写模型最大token数",trigger:"blur"}],maxResponseTokens:[{required:!1,message:"请填写最大回复token数",trigger:"blur"}],openaiProxyUrl:[{required:!1,message:"请填写指定代理地址",trigger:"blur"}]});function Q(e){E.value=0,null==e||e.resetFields()}const H=u((()=>E.value?"更新秘钥":"新增秘钥")),I=u((()=>E.value?"确认更新":"确认新增")),N=t([]);async function W(){}async function X(){try{L.value=!0;const e=await K.queryKeyList(S);L.value=!1;const{rows:l,count:a}=e.data;j.value=a,N.value=l}catch(e){L.value=!1}}return s((()=>{X()})),(l,t)=>{const o=d("el-input"),u=d("el-form-item"),s=d("el-option"),Z=d("el-select"),$=d("el-button"),ee=d("Plus"),le=d("el-icon"),ae=d("el-form"),te=e,oe=d("el-alert"),ue=d("el-table-column"),se=d("el-tag"),de=d("el-popconfirm"),ne=d("el-table"),re=d("el-pagination"),ie=d("el-row"),pe=d("el-switch"),me=d("el-dialog"),ye=n("loading");return r(),i("div",null,[p(te,null,{default:m((()=>[p(ae,{ref_key:"formRef",ref:V,inline:!0,model:S},{default:m((()=>[p(u,{label:"key",prop:"key"},{default:m((()=>[p(o,{modelValue:S.key,"onUpdate:modelValue":t[0]||(t[0]=e=>S.key=e),placeholder:"sk-*** [模糊搜索]"},null,8,["modelValue"])])),_:1}),p(u,{label:"使用模型",prop:"model"},{default:m((()=>[p(Z,{modelValue:S.model,"onUpdate:modelValue":t[1]||(t[1]=e=>S.model=e),placeholder:"请选择绑定的模型",clearable:""},{default:m((()=>[(r(!0),i(y,null,c(k(U),(e=>(r(),f(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(u,{label:"启用状态",prop:"status"},{default:m((()=>[p(Z,{modelValue:S.status,"onUpdate:modelValue":t[2]||(t[2]=e=>S.status=e),placeholder:"请选择key启用状态",clearable:""},{default:m((()=>[(r(!0),i(y,null,c(k(M),(e=>(r(),f(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(u,null,{default:m((()=>[p($,{type:"primary",onClick:X},{default:m((()=>t[25]||(t[25]=[g(" 查询 ")]))),_:1}),p($,{onClick:t[3]||(t[3]=e=>{return null==(l=k(V))||l.resetFields(),void X();var l})},{default:m((()=>t[26]||(t[26]=[g(" 重置 ")]))),_:1})])),_:1}),b("span",P,[p($,{type:"success",onClick:t[4]||(t[4]=e=>G.value=!0)},{default:m((()=>[t[27]||(t[27]=g(" 批量添加Key ")),p(le,{class:"ml-3"},{default:m((()=>[p(ee)])),_:1})])),_:1}),p($,{type:"success",onClick:t[5]||(t[5]=e=>q.value=!0)},{default:m((()=>[t[28]||(t[28]=g(" 添加Key ")),p(le,{class:"ml-3"},{default:m((()=>[p(ee)])),_:1})])),_:1})])])),_:1},8,["model"])])),_:1}),p(te,{bottomPadding:"20px"},{default:m((()=>[p(oe,{"show-icon":"",title:"模块已废弃",description:"当前版本会在2.0之后废弃、本次保留是为了让你查询历史key、后续此模块会直接移除、新的key池在下方『模型池设置』中、详细配置可以查看提示或参考官方文档！",type:"error"})])),_:1}),p(te,{bottomPadding:"20px",bottomMargin:"0px"},{default:m((()=>[_((r(),f(ne,{border:"",height:"54vh",data:k(N),style:{width:"100%"},size:"large"},{default:m((()=>[p(ue,{prop:"key",label:"key秘钥",width:"470"}),p(ue,{prop:"model",align:"center",label:"绑定模型",width:"160"},{default:m((e=>[p(se,{type:e.row.model.includes("gpt-4")?"success":""},{default:m((()=>[g(h(e.row.model),1)])),_:2},1032,["type"])])),_:1}),p(ue,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:m((e=>[p(se,{type:k(C)[e.row.status]},{default:m((()=>[g(h(k(D)[e.row.status]),1)])),_:2},1032,["type"])])),_:1}),p(ue,{prop:"keyDetail.totalAmount",align:"center",label:"账户总额",width:"90"},{default:m((e=>[p($,{type:"info",text:""},{default:m((()=>[g(h(e.row.keyDetail.totalAmount||"-"),1)])),_:2},1024)])),_:1}),p(ue,{prop:"keyDetail.useAmount",align:"center",label:"已用额度",width:"90"},{default:m((e=>[p($,{type:"danger",text:""},{default:m((()=>[g(h(e.row.keyDetail.useAmount||"-"),1)])),_:2},1024)])),_:1}),p(ue,{prop:"keyDetail.balance",align:"center",label:"剩余额度",width:"90"},{default:m((e=>[p($,{type:"success",text:""},{default:m((()=>[g(h(e.row.keyDetail.balance||"-"),1)])),_:2},1024)])),_:1}),p(ue,{prop:"keyDetail.expirDate",align:"center",label:"过期时间",width:"130"},{default:m((e=>[p($,{type:"danger",text:""},{default:m((()=>[g(h(e.row.keyDetail.expirDate||"-"),1)])),_:2},1024)])),_:1}),p(ue,{prop:"weight",align:"center",label:"秘钥权重",width:"90"}),p(ue,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),p(ue,{prop:"keyStatus",align:"center",label:"key状态",width:"90"},{default:m((e=>[p(se,{type:1===e.row.keyDetail.status?"success":"danger"},{default:m((()=>[g(h(1===e.row.keyDetail.status?"正常工作":-1===e.row.keyDetail.status?"查询失败":"已被封禁"),1)])),_:2},1032,["type"])])),_:1}),p(ue,{prop:"maxModelTokens",align:"center",label:"模型最大上下文",width:"140"},{default:m((e=>[p($,{type:"info",text:""},{default:m((()=>[g(h(e.row.maxModelTokens||"-"),1)])),_:2},1024)])),_:1}),p(ue,{prop:"maxResponseTokens",align:"center",label:"最大回复支持Token",width:"160"},{default:m((e=>[p($,{type:"info",text:""},{default:m((()=>[g(h(e.row.maxResponseTokens||"-"),1)])),_:2},1024)])),_:1}),p(ue,{prop:"openaiProxyUrl",align:"center",label:"绑定的代理地址",width:"230"},{default:m((e=>[p($,{type:"info",text:""},{default:m((()=>[g(h(e.row.openaiProxyUrl||"-"),1)])),_:2},1024)])),_:1}),p(ue,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:m((e=>[g(h(k(T)(e.row.createdAt,"YYYY-MM-DD")),1)])),_:1}),p(ue,{fixed:"right",label:"操作",width:"200"},{default:m((e=>[p($,{link:"",type:"primary",size:"small",onClick:l=>function(e){E.value=e.id;const{key:l,model:a,weight:t,status:o,type:u,maxModelTokens:s,maxResponseTokens:d,openaiProxyUrl:n,openaiTimeoutMs:r}=e;v((()=>{Object.assign(J,{key:l,model:a,weight:t,status:o,type:u,maxModelTokens:s,maxResponseTokens:d,openaiProxyUrl:n,openaiTimeoutMs:r})})),q.value=!0}(e.row)},{default:m((()=>t[29]||(t[29]=[g(" 变更 ")]))),_:2},1032,["onClick"]),p(de,{title:"确认删除此秘钥么?",width:"180","icon-color":"red",onConfirm:l=>async function(e){const{id:l}=e;await K.deleteGptKey({id:l}),x({type:"success",message:"删除秘钥成功！"}),X()}(e.row)},{reference:m((()=>[p($,{link:"",type:"danger",size:"small"},{default:m((()=>t[30]||(t[30]=[g(" 删除秘钥 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[ye,k(L)]]),p(ie,{class:"flex justify-end mt-5"},{default:m((()=>[p(re,{"current-page":S.page,"onUpdate:currentPage":t[6]||(t[6]=e=>S.page=e),"page-size":S.size,"onUpdate:pageSize":t[7]||(t[7]=e=>S.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:k(j),onSizeChange:X,onCurrentChange:X},null,8,["current-page","page-size","total"])])),_:1})])),_:1}),p(me,{modelValue:k(q),"onUpdate:modelValue":t[18]||(t[18]=e=>w(q)?q.value=e:null),"close-on-click-modal":!1,title:"批量添加秘钥",width:"670",onClose:t[19]||(t[19]=e=>Q(k(B)))},{footer:m((()=>[b("span",z,[p($,{onClick:t[16]||(t[16]=e=>q.value=!1)},{default:m((()=>t[32]||(t[32]=[g("取消")]))),_:1}),p($,{type:"primary",onClick:t[17]||(t[17]=e=>async function(e){null==e||e.validate((async e=>{e&&(E.value?(await K.updateGptKey({id:E.value,...J}),x({type:"success",message:"更新秘钥成功！"})):(await K.addGptKey(J),x({type:"success",message:"添加秘钥成功！"})),q.value=!1,X())}))}(k(B)))},{default:m((()=>[g(h(I.value),1)])),_:1})])])),default:m((()=>[_((r(),f(ae,{ref_key:"formPackageRef",ref:B,"label-position":"right","label-width":"120px",model:J,rules:O},{default:m((()=>[p(u,{label:"key卡账号",prop:"key"},{default:m((()=>[p(o,{modelValue:J.key,"onUpdate:modelValue":t[8]||(t[8]=e=>J.key=e),placeholder:"请填写chatgpt key",onBlur:W},null,8,["modelValue"])])),_:1}),p(u,{label:"启用状态",prop:"status"},{default:m((()=>[p(pe,{modelValue:J.status,"onUpdate:modelValue":t[9]||(t[9]=e=>J.status=e),"active-value":1,"inactive-value":0},null,8,["modelValue"])])),_:1}),p(u,{label:"绑定模型",prop:"model"},{default:m((()=>[p(Z,{modelValue:J.model,"onUpdate:modelValue":t[10]||(t[10]=e=>J.model=e),filterable:"",clearable:"",placeholder:"请选用当前key绑定的模型"},{default:m((()=>[(r(!0),i(y,null,c(k(Y),(e=>(r(),f(s,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),p($,{type:"primary",class:"ml-5",onClick:W},{default:m((()=>t[31]||(t[31]=[g(" 请指定当前key调用的模型 ")]))),_:1})])),_:1}),p(u,{label:"轮询权重",prop:"weight"},{default:m((()=>[p(o,{modelValue:J.weight,"onUpdate:modelValue":t[11]||(t[11]=e=>J.weight=e),modelModifiers:{number:!0},placeholder:"请填写key的权重、数字越大使用评率越高！"},null,8,["modelValue"])])),_:1}),p(u,{label:"模型最大Token",prop:"maxModelTokens"},{default:m((()=>[p(o,{modelValue:J.maxModelTokens,"onUpdate:modelValue":t[12]||(t[12]=e=>J.maxModelTokens=e),modelModifiers:{number:!0},placeholder:"请填写模型最大Token、不填写默认使用默认！"},null,8,["modelValue"])])),_:1}),p(u,{label:"最大回复Token",prop:"maxResponseTokens"},{default:m((()=>[p(o,{modelValue:J.maxResponseTokens,"onUpdate:modelValue":t[13]||(t[13]=e=>J.maxResponseTokens=e),modelModifiers:{number:!0},placeholder:"请填写最大回复Token、不填写使用默认！"},null,8,["modelValue"])])),_:1}),p(u,{label:"指定代理",prop:"openaiProxyUrl"},{default:m((()=>[p(o,{modelValue:J.openaiProxyUrl,"onUpdate:modelValue":t[14]||(t[14]=e=>J.openaiProxyUrl=e),modelModifiers:{number:!0},placeholder:"请填写key的指定代理、不填写默认使用全局配置！"},null,8,["modelValue"])])),_:1}),p(u,{label:"超时时间",prop:"openaiTimeoutMs"},{default:m((()=>[p(o,{modelValue:J.openaiTimeoutMs,"onUpdate:modelValue":t[15]||(t[15]=e=>J.openaiTimeoutMs=e),modelModifiers:{number:!0},placeholder:"请填写key的超时时间单位（ms）、不填写默认使用全局配置！"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])),[[ye,k(A)]])])),_:1},8,["modelValue"]),p(me,{modelValue:k(G),"onUpdate:modelValue":t[23]||(t[23]=e=>w(G)?G.value=e:null),"close-on-click-modal":!1,title:H.value,width:"670",onClose:t[24]||(t[24]=e=>Q(k(B)))},{footer:m((()=>[b("span",R,[p($,{onClick:t[21]||(t[21]=e=>G.value=!1)},{default:m((()=>t[33]||(t[33]=[g("取消")]))),_:1}),p($,{type:"primary",onClick:t[22]||(t[22]=e=>{var l;null==(l=k(a))||l.validate((async e=>{if(e){const{keyList:e}=F,l=e.split("\n");if(l.length>100)return x.error("批量添加key不能超过100个");if(!l.length)return x.error("请按要求填写您的key秘钥");const a=await K.builCreateGptKey({keyList:l});F.keyList="",x({type:"success",message:a.data}),G.value=!1,X()}}))})},{default:m((()=>[g(h(I.value),1)])),_:1})])])),default:m((()=>[_((r(),f(ae,{ref_key:"formBlukRef",ref:a,"label-position":"right","label-width":"120px",model:J},{default:m((()=>[p(u,{label:"key卡账号列表",prop:"keyList"},{default:m((()=>[p(o,{modelValue:F.keyList,"onUpdate:modelValue":t[20]||(t[20]=e=>F.keyList=e),type:"textarea",rows:8,placeholder:"请粘贴您的key秘钥列表、一行一个、批量添加的情况下我们将默认为您使用gpt-3.5-turbo模型、并且不会检测秘钥的有效期、请您自行校验！"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])),[[ye,k(A)]])])),_:1},8,["modelValue","title"])])}}});"function"==typeof V&&V(j);export{j as default};
