
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.a3be0458.js";import{A as l}from"./gpts.ac376b2d.js";import{u as a}from"../utcformatTime/utcformatTime.f6db2c52.js";import{Q as t}from"../index/index.cfc6c5fc.js";import{a as o}from"../system/system.f03b59ba.js";import{d as s,r as u,C as r,c as d,V as p,e as n,ah as i,o as c,f as g,g as m,h as f,F as y,J as w,j as _,i as h,q as v,m as b,Y as k,t as V,s as x,ae as C,A as L,b6 as j,a1 as z,a2 as N}from"../main-98fa617f.js";const G={style:{float:"right"}},T=["src"],U={class:"overflow-y-scroll w-full whitespace-nowrap"},F=["src"],P={class:"flex justify-end mr-5"},Y=s({__name:"group",setup(s){const z=u(),N=u(0),Y=u(!1),A=u(!1),q=u(!1),M=r({groupName:"",status:void 0,page:1,size:10}),D=u(),O=u(0),S=r({groupName:"",groupLogo:"",status:1,sort:0}),E=r({groupName:[{required:!0,message:"分类名称不能为空",trigger:"blur"}],groupLogo:[{required:!0,message:"分类LOGO不能为空",trigger:"blur"}]});const K=d((()=>O.value?"更新分类":"新增分类")),Q=d((()=>O.value?"确认更新":"确认新增")),R=u([]);async function I(){try{A.value=!0;const e=await l.queryGptsGroup(M);A.value=!1;const{rows:a,count:t}=e.data;N.value=t,R.value=a}catch(e){A.value=!1}}const J=e=>"image/jpeg"!==e.type&&"image/png"!==e.type?(C.error("只支持jpg和png格式"),!1):!(e.size/1024/1024>2)||(C.error("图片不能大于2M!"),!1);return p((()=>{I()})),(s,u)=>{const r=n("el-input"),d=n("el-form-item"),p=n("el-option"),$=n("el-select"),B=n("el-button"),H=n("Plus"),W=n("el-icon"),X=n("el-form"),Z=e,ee=n("el-alert"),le=n("el-table-column"),ae=n("el-tag"),te=n("el-popconfirm"),oe=n("el-table"),se=n("el-pagination"),ue=n("el-row"),re=n("el-upload"),de=n("QuestionFilled"),pe=n("el-tooltip"),ne=n("el-switch"),ie=n("el-col"),ce=n("el-dialog"),ge=i("loading");return c(),g("div",null,[m(Z,null,{default:f((()=>[m(X,{ref_key:"formRef",ref:z,inline:!0,model:M},{default:f((()=>[m(d,{label:"分类名称",prop:"groupName"},{default:f((()=>[m(r,{modelValue:M.groupName,"onUpdate:modelValue":u[0]||(u[0]=e=>M.groupName=e),placeholder:"分类名称",clearable:""},null,8,["modelValue"])])),_:1}),m(d,{label:"启用状态",prop:"status"},{default:f((()=>[m($,{modelValue:M.status,"onUpdate:modelValue":u[1]||(u[1]=e=>M.status=e),placeholder:"请选择启用状态",clearable:"",style:{width:"192px"}},{default:f((()=>[(c(!0),g(y,null,w(h(t),(e=>(c(),_(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(d,null,{default:f((()=>[m(B,{type:"primary",onClick:I},{default:f((()=>u[15]||(u[15]=[v(" 查询 ")]))),_:1}),m(B,{onClick:u[2]||(u[2]=e=>{return null==(l=h(z))||l.resetFields(),void I();var l})},{default:f((()=>u[16]||(u[16]=[v(" 重置 ")]))),_:1})])),_:1}),b("span",G,[m(B,{type:"success",onClick:u[3]||(u[3]=e=>Y.value=!0)},{default:f((()=>[u[17]||(u[17]=v(" 添加分类 ")),m(W,{class:"ml-3"},{default:f((()=>[m(H)])),_:1})])),_:1})])])),_:1},8,["model"])])),_:1}),m(Z,{bottomPadding:"20px"},{default:f((()=>[m(ee,{"show-icon":"",closable:!1,title:"分类说明",type:"success"},{default:f((()=>u[18]||(u[18]=[v(" 用于对应用归类，分为普通应用和GPTS应用。 "),b("span",{style:{color:"red"}},"当前版本已停用分类key，请将分类key迁移至模型池设置-应用模型中，下个版本将不再显示相关属性！",-1)]))),_:1})])),_:1}),m(Z,{bottomPadding:"20px",bottomMargin:"0px"},{default:f((()=>[k((c(),_(oe,{height:"52vh",border:"",data:h(R),style:{width:"100%"},size:"large"},{default:f((()=>[m(le,{prop:"groupName",label:"分类名称",width:"180"}),m(le,{prop:"groupLogo",align:"center",label:"启用状态",width:"80"},{default:f((e=>[b("img",{src:e.row.groupLogo,alt:"",srcset:"",style:{width:"24px"}},null,8,T)])),_:1}),m(le,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:f((e=>[m(ae,{type:e.row.status?"success":"danger"},{default:f((()=>[v(V(e.row.status?"使用中":"已暂停"),1)])),_:2},1032,["type"])])),_:1}),m(le,{prop:"key",label:"分类绑定KEY",width:"460"},{default:f((e=>[b("div",U,V(e.row.key),1)])),_:1}),m(le,{prop:"weight",label:"权重",width:"90",align:"center"}),m(le,{prop:"deductType",align:"center",label:"扣费类型",width:"90"},{default:f((e=>[m(ae,{type:1===e.row.deductType?"success":"warning"},{default:f((()=>[v(V(1===e.row.deductType?"普通余额":"高级余额"),1)])),_:2},1032,["type"])])),_:1}),m(le,{prop:"deduct",align:"center",label:"单次扣除",width:"90"},{default:f((e=>[m(ae,{type:1===e.row.deductType?"success":"warning"},{default:f((()=>[v(V(`${e.row.deduct} 余额`),1)])),_:2},1032,["type"])])),_:1}),m(le,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),m(le,{prop:"useToken",align:"center",label:"已使用Token",width:"120"}),m(le,{prop:"status",align:"center",label:"组状态",width:"110"},{default:f((e=>[m(ae,{type:1===e.row.status?"success":"danger"},{default:f((()=>[v(V(1===e.row.status?"正常工作":-1===e.row.status?"已被封禁":"余额耗尽 "),1)])),_:2},1032,["type"])])),_:1}),m(le,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:f((e=>[v(V(h(a)(e.row.createdAt,"YYYY-MM-DD")),1)])),_:1}),m(le,{fixed:"right",label:"操作",width:"200"},{default:f((e=>[m(B,{link:"",type:"primary",size:"small",onClick:l=>function(e){O.value=e.id;const{groupName:l,groupLogo:a,status:t,sort:o}=e;L((()=>{Object.assign(S,{groupName:l,groupLogo:a,status:t,sort:o})})),Y.value=!0}(e.row)},{default:f((()=>u[19]||(u[19]=[v(" 变更 ")]))),_:2},1032,["onClick"]),m(te,{title:"确认删除此分类么?",width:"180","icon-color":"red",onConfirm:a=>async function(e){const{id:a}=e;await l.removeGptsGroup({id:a}),C({type:"success",message:"操作完成！"}),I()}(e.row)},{reference:f((()=>[m(B,{link:"",type:"danger",size:"small"},{default:f((()=>u[20]||(u[20]=[v(" 删除 ")]))),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[ge,h(A)]]),m(ue,{class:"flex justify-end mt-5"},{default:f((()=>[m(se,{"current-page":M.page,"onUpdate:currentPage":u[4]||(u[4]=e=>M.page=e),"page-size":M.size,"onUpdate:pageSize":u[5]||(u[5]=e=>M.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:h(N),onSizeChange:I,onCurrentChange:I},null,8,["current-page","page-size","total"])])),_:1})])),_:1}),m(ce,{modelValue:h(Y),"onUpdate:modelValue":u[13]||(u[13]=e=>x(Y)?Y.value=e:null),"close-on-click-modal":!1,title:K.value,width:"1000",onClose:u[14]||(u[14]=e=>{return l=h(D),O.value=0,void(null==l||l.resetFields());var l})},{footer:f((()=>[b("span",P,[m(B,{onClick:u[11]||(u[11]=e=>Y.value=!1)},{default:f((()=>u[23]||(u[23]=[v("取消")]))),_:1}),m(B,{type:"primary",onClick:u[12]||(u[12]=e=>async function(e){null==e||e.validate((async e=>{if(e){const e=j(S);delete e.id,O.value?await l.modifyGptsGroup({id:O.value,...e}):await l.addGptsGroup(e),C({type:"success",message:"操作成功！"}),O.value=0,Y.value=!1,I()}}))}(h(D)))},{default:f((()=>[v(V(Q.value),1)])),_:1})])])),default:f((()=>[k((c(),_(X,{ref_key:"formPackageRef",ref:D,"label-position":"right","label-width":"120px",model:S,rules:E},{default:f((()=>[m(ue,null,{default:f((()=>[m(ie,{span:12},{default:f((()=>[m(d,{label:"分类名称",prop:"groupName"},{default:f((()=>[m(r,{modelValue:S.groupName,"onUpdate:modelValue":u[6]||(u[6]=e=>S.groupName=e),placeholder:"请填写分类中文名称"},null,8,["modelValue"])])),_:1}),m(d,{label:"应用Logo",prop:"groupLogo"},{default:f((()=>[m(re,{class:"logo-uploader",action:"","auto-upload":!1,"show-file-list":!1,onChange:u[7]||(u[7]=e=>(e=>{const l=e.name.split(".")[1],a=new FormData;a.append("filename",e.raw.uid+"."+l),a.append("file",e.raw),a.append("dir","gpts-logo"),o.uploadFile(a).then((e=>{S.groupLogo=e.data}))})(e)),"before-upload":J},{default:f((()=>[S.groupLogo?(c(),g("img",{key:0,src:S.groupLogo,class:"avatar"},null,8,F)):(c(),_(W,{key:1,class:"logo-uploader-icon"},{default:f((()=>[m(H)])),_:1}))])),_:1}),m(r,{style:{"margin-top":"10px"},modelValue:S.groupLogo,"onUpdate:modelValue":u[8]||(u[8]=e=>S.groupLogo=e),placeholder:"分类网络地址"},null,8,["modelValue"])])),_:1}),m(d,{label:"显示排序",prop:"sort"},{default:f((()=>[m(r,{modelValue:S.sort,"onUpdate:modelValue":u[9]||(u[9]=e=>S.sort=e),type:"number"},null,8,["modelValue"]),m(pe,{class:"box-item",effect:"dark",placement:"right"},{content:f((()=>u[21]||(u[21]=[b("div",{style:{width:"250px"}}," 显示排序，序号越大越靠后 ",-1)]))),default:f((()=>[m(W,{class:"ml-3 cursor-pointer"},{default:f((()=>[m(de)])),_:1})])),_:1})])),_:1}),m(d,{label:"启用状态",prop:"status"},{default:f((()=>[m(ne,{"active-value":1,"inactive-value":0,modelValue:S.status,"onUpdate:modelValue":u[10]||(u[10]=e=>S.status=e)},null,8,["modelValue"]),m(pe,{class:"box-item",effect:"dark",placement:"right"},{content:f((()=>u[22]||(u[22]=[b("div",{style:{width:"250px"}}," 账号启用状态、一旦锁定当前key将停止工作！ ",-1)]))),default:f((()=>[m(W,{class:"ml-3 cursor-pointer"},{default:f((()=>[m(de)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])),[[ge,h(q)]])])),_:1},8,["modelValue","title"])])}}});"function"==typeof N&&N(Y);const A=z(Y,[["__scopeId","data-v-9919f079"]]);export{A as default};
