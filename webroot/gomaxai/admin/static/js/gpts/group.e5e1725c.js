
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * Gitee  https://gitee.com/hooray/fantastic-admin
 * Github https://github.com/hooray/fantastic-admin
 */
  
import{_ as e}from"../index/index.ba4efddb.js";import{A as a}from"./gpts.b39cc526.js";import{u as l}from"../utcformatTime/utcformatTime.f6db2c52.js";import{Q as t}from"../index/index.21f4f4e7.js";import{a as o}from"../system/system.d7e90e9b.js";import{d as s,r as u,G as r,C as d,x as p,j as n,V as i,o as c,c as g,f as m,g as f,W as y,X as w,e as _,h as v,b as h,w as b,J as k,t as V,O as x,P as C,$ as L,ab as j,p as z,k as N,_ as G,q as T}from"../main-043c96ab.js";const U=e=>(z("data-v-d5e45d36"),e=e(),N(),e),P={style:{float:"right"}},F=U((()=>h("span",{style:{color:"red"}},"当前版本已停用分类key，请将分类key迁移至模型池设置-应用模型中，下个版本将不再显示相关属性！",-1))),Y=["src"],q={class:"overflow-y-scroll w-full whitespace-nowrap"},M=["src"],O=U((()=>h("div",{style:{width:"250px"}}," 显示排序，序号越大越靠后 ",-1))),S=U((()=>h("div",{style:{width:"250px"}}," 账号启用状态、一旦锁定当前key将停止工作！ ",-1))),A={class:"flex justify-end mr-5"},D=s({__name:"group",setup(s){const z=u(),N=u(0),G=u(!1),T=u(!1),U=u(!1),D=r({groupName:"",status:void 0,page:1,size:10}),$=u(),Q=u(0),R=r({groupName:"",groupLogo:"",status:1,sort:0}),E=r({groupName:[{required:!0,message:"分类名称不能为空",trigger:"blur"}],groupLogo:[{required:!0,message:"分类LOGO不能为空",trigger:"blur"}]});const I=d((()=>Q.value?"更新分类":"新增分类")),J=d((()=>Q.value?"确认更新":"确认新增")),K=u([]);async function W(){try{T.value=!0;const e=await a.queryGptsGroup(D);T.value=!1;const{rows:l,count:t}=e.data;N.value=t,K.value=l}catch(e){T.value=!1}}const X=e=>"image/jpeg"!==e.type&&"image/png"!==e.type?(C.error("只支持jpg和png格式"),!1):!(e.size/1024/1024>2)||(C.error("图片不能大于2M!"),!1);return p((()=>{W()})),(s,u)=>{const r=n("el-input"),d=n("el-form-item"),p=n("el-option"),B=n("el-select"),H=n("el-button"),Z=n("Plus"),ee=n("el-icon"),ae=n("el-form"),le=e,te=n("el-alert"),oe=n("el-table-column"),se=n("el-tag"),ue=n("el-popconfirm"),re=n("el-table"),de=n("el-pagination"),pe=n("el-row"),ne=n("el-upload"),ie=n("QuestionFilled"),ce=n("el-tooltip"),ge=n("el-switch"),me=n("el-col"),fe=n("el-dialog"),ye=i("loading");return c(),g("div",null,[m(le,null,{default:f((()=>[m(ae,{ref_key:"formRef",ref:z,inline:!0,model:D},{default:f((()=>[m(d,{label:"分类名称",prop:"groupName"},{default:f((()=>[m(r,{modelValue:D.groupName,"onUpdate:modelValue":u[0]||(u[0]=e=>D.groupName=e),placeholder:"分类名称",clearable:""},null,8,["modelValue"])])),_:1}),m(d,{label:"启用状态",prop:"status"},{default:f((()=>[m(B,{modelValue:D.status,"onUpdate:modelValue":u[1]||(u[1]=e=>D.status=e),placeholder:"请选择启用状态",clearable:"",style:{width:"192px"}},{default:f((()=>[(c(!0),g(y,null,w(_(t),(e=>(c(),k(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),m(d,null,{default:f((()=>[m(H,{type:"primary",onClick:W},{default:f((()=>[v(" 查询 ")])),_:1}),m(H,{onClick:u[2]||(u[2]=e=>{return null==(a=_(z))||a.resetFields(),void W();var a})},{default:f((()=>[v(" 重置 ")])),_:1})])),_:1}),h("span",P,[m(H,{type:"success",onClick:u[3]||(u[3]=e=>G.value=!0)},{default:f((()=>[v(" 添加分类 "),m(ee,{class:"ml-3"},{default:f((()=>[m(Z)])),_:1})])),_:1})])])),_:1},8,["model"])])),_:1}),m(le,{bottomPadding:"20px"},{default:f((()=>[m(te,{"show-icon":"",closable:!1,title:"分类说明",type:"success"},{default:f((()=>[v(" 用于对应用归类，分为普通应用和GPTS应用。 "),F])),_:1})])),_:1}),m(le,{bottomPadding:"20px",bottomMargin:"0px"},{default:f((()=>[b((c(),k(re,{height:"52vh",border:"",data:_(K),style:{width:"100%"},size:"large"},{default:f((()=>[m(oe,{prop:"groupName",label:"分类名称",width:"180"}),m(oe,{prop:"groupLogo",align:"center",label:"启用状态",width:"80"},{default:f((e=>[h("img",{src:e.row.groupLogo,alt:"",srcset:"",style:{width:"24px"}},null,8,Y)])),_:1}),m(oe,{prop:"status",align:"center",label:"启用状态",width:"90"},{default:f((e=>[m(se,{type:e.row.status?"success":"danger"},{default:f((()=>[v(V(e.row.status?"使用中":"已暂停"),1)])),_:2},1032,["type"])])),_:1}),m(oe,{prop:"key",label:"分类绑定KEY",width:"460"},{default:f((e=>[h("div",q,V(e.row.key),1)])),_:1}),m(oe,{prop:"weight",label:"权重",width:"90",align:"center"}),m(oe,{prop:"deductType",align:"center",label:"扣费类型",width:"90"},{default:f((e=>[m(se,{type:1===e.row.deductType?"success":"warning"},{default:f((()=>[v(V(1===e.row.deductType?"普通余额":"高级余额"),1)])),_:2},1032,["type"])])),_:1}),m(oe,{prop:"deduct",align:"center",label:"单次扣除",width:"90"},{default:f((e=>[m(se,{type:1===e.row.deductType?"success":"warning"},{default:f((()=>[v(V(`${e.row.deduct} 余额`),1)])),_:2},1032,["type"])])),_:1}),m(oe,{prop:"useCount",align:"center",label:"调用次数",width:"90"}),m(oe,{prop:"useToken",align:"center",label:"已使用Token",width:"120"}),m(oe,{prop:"status",align:"center",label:"组状态",width:"110"},{default:f((e=>[m(se,{type:1===e.row.status?"success":"danger"},{default:f((()=>[v(V(1===e.row.status?"正常工作":-1===e.row.status?"已被封禁":"余额耗尽 "),1)])),_:2},1032,["type"])])),_:1}),m(oe,{prop:"createdAt",align:"center",label:"添加时间",width:"120"},{default:f((e=>[v(V(_(l)(e.row.createdAt,"YYYY-MM-DD")),1)])),_:1}),m(oe,{fixed:"right",label:"操作",width:"200"},{default:f((e=>[m(H,{link:"",type:"primary",size:"small",onClick:a=>function(e){Q.value=e.id;const{groupName:a,groupLogo:l,status:t,sort:o}=e;L((()=>{Object.assign(R,{groupName:a,groupLogo:l,status:t,sort:o})})),G.value=!0}(e.row)},{default:f((()=>[v(" 变更 ")])),_:2},1032,["onClick"]),m(ue,{title:"确认删除此分类么?",width:"180","icon-color":"red",onConfirm:l=>async function(e){const{id:l}=e;await a.removeGptsGroup({id:l}),C({type:"success",message:"操作完成！"}),W()}(e.row)},{reference:f((()=>[m(H,{link:"",type:"danger",size:"small"},{default:f((()=>[v(" 删除 ")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["data"])),[[ye,_(T)]]),m(pe,{class:"flex justify-end mt-5"},{default:f((()=>[m(de,{"current-page":D.page,"onUpdate:currentPage":u[4]||(u[4]=e=>D.page=e),"page-size":D.size,"onUpdate:pageSize":u[5]||(u[5]=e=>D.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:_(N),onSizeChange:W,onCurrentChange:W},null,8,["current-page","page-size","total"])])),_:1})])),_:1}),m(fe,{modelValue:_(G),"onUpdate:modelValue":u[13]||(u[13]=e=>x(G)?G.value=e:null),"close-on-click-modal":!1,title:I.value,width:"1000",onClose:u[14]||(u[14]=e=>{return a=_($),Q.value=0,void(null==a||a.resetFields());var a})},{footer:f((()=>[h("span",A,[m(H,{onClick:u[11]||(u[11]=e=>G.value=!1)},{default:f((()=>[v("取消")])),_:1}),m(H,{type:"primary",onClick:u[12]||(u[12]=e=>async function(e){null==e||e.validate((async e=>{if(e){const e=j(R);delete e.id,Q.value?await a.modifyGptsGroup({id:Q.value,...e}):await a.addGptsGroup(e),C({type:"success",message:"操作成功！"}),Q.value=0,G.value=!1,W()}}))}(_($)))},{default:f((()=>[v(V(J.value),1)])),_:1})])])),default:f((()=>[b((c(),k(ae,{ref_key:"formPackageRef",ref:$,"label-position":"right","label-width":"120px",model:R,rules:E},{default:f((()=>[m(pe,null,{default:f((()=>[m(me,{span:12},{default:f((()=>[m(d,{label:"分类名称",prop:"groupName"},{default:f((()=>[m(r,{modelValue:R.groupName,"onUpdate:modelValue":u[6]||(u[6]=e=>R.groupName=e),placeholder:"请填写分类中文名称"},null,8,["modelValue"])])),_:1}),m(d,{label:"应用Logo",prop:"groupLogo"},{default:f((()=>[m(ne,{class:"logo-uploader",action:"","auto-upload":!1,"show-file-list":!1,onChange:u[7]||(u[7]=e=>(e=>{const a=e.name.split(".")[1],l=new FormData;l.append("filename",e.raw.uid+"."+a),l.append("file",e.raw),l.append("dir","gpts-logo"),o.uploadFile(l).then((e=>{R.groupLogo=e.data}))})(e)),"before-upload":X},{default:f((()=>[R.groupLogo?(c(),g("img",{key:0,src:R.groupLogo,class:"avatar"},null,8,M)):(c(),k(ee,{key:1,class:"logo-uploader-icon"},{default:f((()=>[m(Z)])),_:1}))])),_:1}),m(r,{style:{"margin-top":"10px"},modelValue:R.groupLogo,"onUpdate:modelValue":u[8]||(u[8]=e=>R.groupLogo=e),placeholder:"分类网络地址"},null,8,["modelValue"])])),_:1}),m(d,{label:"显示排序",prop:"sort"},{default:f((()=>[m(r,{modelValue:R.sort,"onUpdate:modelValue":u[9]||(u[9]=e=>R.sort=e),type:"number"},null,8,["modelValue"]),m(ce,{class:"box-item",effect:"dark",placement:"right"},{content:f((()=>[O])),default:f((()=>[m(ee,{class:"ml-3 cursor-pointer"},{default:f((()=>[m(ie)])),_:1})])),_:1})])),_:1}),m(d,{label:"启用状态",prop:"status"},{default:f((()=>[m(ge,{"active-value":1,"inactive-value":0,modelValue:R.status,"onUpdate:modelValue":u[10]||(u[10]=e=>R.status=e)},null,8,["modelValue"]),m(ce,{class:"box-item",effect:"dark",placement:"right"},{content:f((()=>[S])),default:f((()=>[m(ee,{class:"ml-3 cursor-pointer"},{default:f((()=>[m(ie)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])),[[ye,_(U)]])])),_:1},8,["modelValue","title"])])}}});"function"==typeof T&&T(D);const $=G(D,[["__scopeId","data-v-d5e45d36"]]);export{$ as default};
