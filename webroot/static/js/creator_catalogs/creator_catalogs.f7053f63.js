import{e as a,l,k as e,p as t,r as s,g as o,q as u,K as n,w as i,O as c,D as v,B as r,bL as p,C as g,a4 as d,z as f,y as m,bI as b,aJ as h,x as _,E as x,F as w,a1 as y,ak as $,$ as k,_ as C}from"../main-4156cf5e.js";import{a as I,p as E,s as U}from"../ppt/ppt.22762407.js";const j={class:"dialog dark:bg-[#383838] bg-[#fff]"},D={class:"dialog_title_card border-[#E8E8E8] dark:border-[#292A2E]"},O={class:"input-main",style:{"padding-left":"15px"}},T={class:"item"},G={class:"tag title"},L={class:"w-[calc(100% - 35px)] ml-[35px]"},A={class:"item"},J={class:"tag"},q={class:"w-[calc(100% - 35px)] ml-[35px] item-sub"},z={class:"tag"},B={class:"dialog-group"},F=C(a({__name:"creator_catalogs",emits:"created",setup(a,{expose:C,emit:F}){const K=F,P=l(),V=e(),H=t(),M=s([]);o((()=>M.value.find((a=>"pptOutline"===a.type))));const N=o((()=>M.value.find((a=>"pptCreate"===a.type)))),Q=s(!1),R=s("");s(""),u((()=>{sa()}));const S=s(),W=n({title:"",subTitle:"",text:"",catalogs:[],contents:[],complex:2,author:"",originTaskId:0}),X=o((()=>1===V.userInfo.lifetimeVip||V.userInfo.vipExpire&&new Date(V.userInfo.vipExpire)>new Date));async function Y(){la.value=!0,S.value=new AbortController;const{data:a}=await U({theme:R.value,title:W.title,text:W.text},S.value.signal).catch((a=>{ta(!0),H.error(a.message||k("ppt.genTimeOut"))}));Z.value=a.catalogs,sa(),W.contents=a.contents,W.title=a.title,R.value||(R.value=a.title),la.value=!1,function(){for(let a=0;a<Z.value.length;a++){const l=Z.value[a];aa.value.push({catalog:l.catalog});for(let a=0;a<l.sub_catalog.length;a++){const e=l.sub_catalog[a];aa.value.push({catalog:l.catalog,sub_catalog:e})}}!function(){let a=0;ea.value=setInterval((()=>{var l,e;if(null==(l=aa.value[a])?void 0:l.sub_catalog){const l=W.catalogs.findIndex((l=>l.catalog===aa.value[a].catalog));W.catalogs[l].sub_catalog.push(aa.value[a].sub_catalog)}else(null==(e=aa.value[a])?void 0:e.catalog)?W.catalogs.push(Object.assign({catalog:"",sub_catalog:[]},aa.value[a])):(clearInterval(ea.value),ea.value=!1,la.value=!1);a++}),100)}()}()}const Z=s([]),aa=s([]),la=s(!1),ea=s(null);function ta(a){var l;Q.value=a,null==(l=S.value)||l.abort(),clearInterval(ea.value),ea.value=!1,la.value=!1}async function sa(){const{data:a}=await I();M.value=a,V.getUserInfo()}function oa(){W.catalogs=[],aa.value=[],Y()}const ua=o((()=>0!==W.catalogs.length&&!la.value));async function na(){if(!V.isLogin)return V.setLoginDialog(!0);if(la.value)return H.error(k("ppt.gening"));if(!ua.value)return H.error(k("ppt.pGenPrecis"));la.value=!0;const a=await E(W).catch((()=>{ta(!0),H.error(a.message||k("ppt.genErro"))}));sa(),200===a.code?(Q.value=!1,K("created"),P.push("/ppt/my")):H.error(a.message)}return C({open:function(a="",l=""){R.value=a,W.text=l,Z.value=[],W.catalogs=[],aa.value=[],la.value=!1,Q.value=!0,Y()}}),(a,l)=>(i(),c(m($),{show:Q.value,"onUpdate:show":l[3]||(l[3]=a=>Q.value=a),"mask-closable":!1},{default:v((()=>{var e,t,s,o;return[r("div",j,[r("div",D,[l[5]||(l[5]=r("div",null,null,-1)),r("div",{class:"close_btn",onClick:l[0]||(l[0]=a=>Q.value=!1)},l[4]||(l[4]=[r("img",{src:p},null,-1)]))]),g(m(y),{show:la.value},{description:v((()=>[d(f(a.$t("ppt.Generating")),1)])),default:v((()=>[g(m(b),{style:{height:"500px",padding:"0 57px","margin-bottom":"50px"}},{default:v((()=>[r("div",O,[r("div",T,[l[6]||(l[6]=r("div",{class:"dot"},null,-1)),r("div",G,f(a.$t("setting.theme")),1),g(m(h),{value:R.value,"onUpdate:value":l[1]||(l[1]=a=>R.value=a)},null,8,["value"])]),r("div",L,[(i(!0),_(w,null,x(W.catalogs,((e,t)=>(i(),_("div",{key:t},[r("div",A,[l[7]||(l[7]=r("div",{class:"dot"},null,-1)),r("div",J,f(a.$t("store.title")),1),g(m(h),{value:e.catalog,"onUpdate:value":a=>e.catalog=a},null,8,["value","onUpdate:value"])]),r("div",q,[(i(!0),_(w,null,x(e.sub_catalog,((t,s)=>(i(),_("div",{key:s,class:"item"},[l[8]||(l[8]=r("div",{class:"dot"},null,-1)),r("div",z,f(a.$t("ppt.nodeJs")),1),g(m(h),{value:e.sub_catalog[s],"onUpdate:value":a=>e.sub_catalog[s]=a},null,8,["value","onUpdate:value"])])))),128))])])))),128))])])])),_:1})])),_:1},8,["show"]),r("div",B,[r("div",{class:"dialog-group-btn",style:{width:"20%"},onClick:l[2]||(l[2]=a=>ta(!1))},f(a.$t("common.cancel")),1),r("div",{class:"dialog-group-btn",style:{width:"30%"},onClick:oa},f(a.$t("ppt.ChangeToutline")),1),r("div",{class:"dialog-group-btn primary",style:{width:"50%"},onClick:na},f(a.$t("gpt.lijiGen"))+"("+f((null==(e=N.value)?void 0:e.remainCount)>0&&X.value?a.$t("ppt.free")+` ${null==(t=N.value)?void 0:t.remainCount}/${null==(s=N.value)?void 0:s.freeCount}`:a.$t("ppt.need")+`${null==(o=N.value)?void 0:o.useIntegrate}`+a.$t("ppt.points"))+") ",1)])])]})),_:1},8,["show"]))}}),[["__scopeId","data-v-849b066c"]]);export{F as C};
