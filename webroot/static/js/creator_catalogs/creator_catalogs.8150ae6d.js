import{e as a,l,k as e,p as t,r as s,g as u,q as o,L as n,w as i,P as c,C as v,D as r,A as d,bD as g,B as p,a3 as f,bA as m,aM as b,x as h,E as _,F as x,a1 as w,y,an as k,_ as C}from"../main-23bab8dd.js";import{p as I,s as E,a as U}from"../ppt/ppt.e06b6928.js";const D={class:"dialog dark:bg-[#383838] bg-[#fff]"},A={class:"dialog_title_card border-[#E8E8E8] dark:border-[#292A2E]"},j={class:"input-main",style:{"padding-left":"15px"}},L={class:"item"},$={class:"w-[calc(100% - 35px)] ml-[35px]"},O={class:"item"},T={class:"w-[calc(100% - 35px)] ml-[35px] item-sub"},q={class:"dialog-group"},B=C(a({__name:"creator_catalogs",emits:"created",setup(a,{expose:C,emit:B}){const F=B,M=l(),P=e(),V=t(),z=s([]);u((()=>z.value.find((a=>"pptOutline"===a.type))));const G=u((()=>z.value.find((a=>"pptCreate"===a.type)))),H=s(!1),J=s("");s(""),o((()=>{aa()}));const K=s(),N=n({title:"",subTitle:"",text:"",catalogs:[],contents:[],complex:2,author:"",originTaskId:0}),Q=u((()=>1===P.userInfo.lifetimeVip||P.userInfo.vipExpire&&new Date(P.userInfo.vipExpire)>new Date));async function R(){X.value=!0,K.value=new AbortController;const{data:a}=await E({theme:J.value,title:N.title,text:N.text},K.value.signal).catch((a=>{Z(!0),V.error(a.message||"生成超时")}));S.value=a.catalogs,aa(),N.contents=a.contents,N.title=a.title,J.value||(J.value=a.title),X.value=!1,function(){for(let a=0;a<S.value.length;a++){const l=S.value[a];W.value.push({catalog:l.catalog});for(let a=0;a<l.sub_catalog.length;a++){const e=l.sub_catalog[a];W.value.push({catalog:l.catalog,sub_catalog:e})}}!function(){let a=0;Y.value=setInterval((()=>{var l,e;if(null==(l=W.value[a])?void 0:l.sub_catalog){const l=N.catalogs.findIndex((l=>l.catalog===W.value[a].catalog));N.catalogs[l].sub_catalog.push(W.value[a].sub_catalog)}else(null==(e=W.value[a])?void 0:e.catalog)?N.catalogs.push(Object.assign({catalog:"",sub_catalog:[]},W.value[a])):(clearInterval(Y.value),Y.value=!1,X.value=!1);a++}),100)}()}()}const S=s([]),W=s([]),X=s(!1),Y=s(null);function Z(a){var l;H.value=a,null==(l=K.value)||l.abort(),clearInterval(Y.value),Y.value=!1,X.value=!1}async function aa(){const{data:a}=await I();z.value=a,P.getUserInfo()}function la(){N.catalogs=[],W.value=[],R()}const ea=u((()=>0!==N.catalogs.length&&!X.value));async function ta(){if(!P.isLogin)return P.setLoginDialog(!0);if(X.value)return V.error("正在生成大纲，请稍后");if(!ea.value)return V.error("请先生成大纲");X.value=!0;const a=await U(N).catch((()=>{Z(!0),V.error(a.message||"生成失败")}));aa(),200===a.code?(H.value=!1,F("created"),M.push("/ppt/my")):V.error(a.message)}return C({open:function(a="",l=""){J.value=a,N.text=l,S.value=[],N.catalogs=[],W.value=[],X.value=!1,H.value=!0,R()}}),(a,l)=>(i(),c(r(k),{show:H.value,"onUpdate:show":l[3]||(l[3]=a=>H.value=a),"mask-closable":!1},{default:v((()=>{var a,e,t,s;return[d("div",D,[d("div",A,[l[5]||(l[5]=d("div",null,null,-1)),d("div",{class:"close_btn",onClick:l[0]||(l[0]=a=>H.value=!1)},l[4]||(l[4]=[d("img",{src:g},null,-1)]))]),p(r(w),{show:X.value},{description:v((()=>l[6]||(l[6]=[f(" 正在生成中 ")]))),default:v((()=>[p(r(m),{style:{height:"500px",padding:"0 57px","margin-bottom":"50px"}},{default:v((()=>[d("div",j,[d("div",L,[l[7]||(l[7]=d("div",{class:"dot"},null,-1)),l[8]||(l[8]=d("div",{class:"tag title"}," 主题 ",-1)),p(r(b),{value:J.value,"onUpdate:value":l[1]||(l[1]=a=>J.value=a)},null,8,["value"])]),d("div",$,[(i(!0),h(x,null,_(N.catalogs,((a,e)=>(i(),h("div",{key:e},[d("div",O,[l[9]||(l[9]=d("div",{class:"dot"},null,-1)),l[10]||(l[10]=d("div",{class:"tag"}," 标题 ",-1)),p(r(b),{value:a.catalog,"onUpdate:value":l=>a.catalog=l},null,8,["value","onUpdate:value"])]),d("div",T,[(i(!0),h(x,null,_(a.sub_catalog,((e,t)=>(i(),h("div",{key:t,class:"item"},[l[11]||(l[11]=d("div",{class:"dot"},null,-1)),l[12]||(l[12]=d("div",{class:"tag"}," 节点 ",-1)),p(r(b),{value:a.sub_catalog[t],"onUpdate:value":l=>a.sub_catalog[t]=l},null,8,["value","onUpdate:value"])])))),128))])])))),128))])])])),_:1})])),_:1},8,["show"]),d("div",q,[d("div",{class:"dialog-group-btn",style:{width:"20%"},onClick:l[2]||(l[2]=a=>Z(!1))}," 取消 "),d("div",{class:"dialog-group-btn",style:{width:"30%"},onClick:la}," 换个大纲 "),d("div",{class:"dialog-group-btn primary",style:{width:"50%"},onClick:ta}," 立即生成("+y((null==(a=G.value)?void 0:a.remainCount)>0&&Q.value?`免费 ${null==(e=G.value)?void 0:e.remainCount}/${null==(t=G.value)?void 0:t.freeCount}`:`需${null==(s=G.value)?void 0:s.useIntegrate}积分`)+") ",1)])])]})),_:1},8,["show"]))}}),[["__scopeId","data-v-76190771"]]);export{B as C};
