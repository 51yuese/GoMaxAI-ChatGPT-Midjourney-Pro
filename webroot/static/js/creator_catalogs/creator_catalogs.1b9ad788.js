import{e as a,S as l,R as e,W as t,r as s,j as u,k as o,ae as n,N as i,ag as c,a2 as v,P as r,bi as d,a1 as g,a6 as p,a5 as f,bc as m,bd as b,O as h,a4 as _,a3 as x,aq as w,$ as y,ar as k,ad as I}from"../main-79c61161.js";import{a as C,p as U,s as E}from"../ppt/ppt.4ecfe3f1.js";const j={class:"dialog dark:bg-[#383838] bg-[#fff]"},$={class:"dialog_title_card border-[#E8E8E8] dark:border-[#292A2E]"},D={class:"input-main",style:{"padding-left":"15px"}},O={class:"item"},A={class:"w-[calc(100% - 35px)] ml-[35px]"},L={class:"item"},T={class:"w-[calc(100% - 35px)] ml-[35px] item-sub"},q={class:"dialog-group"},N=I(a({__name:"creator_catalogs",emits:"created",setup(a,{expose:I,emit:N}){const P=N,R=l(),S=e(),V=t(),W=s([]);u((()=>W.value.find((a=>"pptOutline"===a.type))));const z=u((()=>W.value.find((a=>"pptCreate"===a.type)))),B=s(!1),F=s("");s(""),o((()=>{aa()}));const G=s(),H=n({title:"",subTitle:"",text:"",catalogs:[],contents:[],complex:2,author:"",originTaskId:0}),J=u((()=>1===S.userInfo.lifetimeVip||S.userInfo.vipExpire&&new Date(S.userInfo.vipExpire)>new Date));async function K(){X.value=!0,G.value=new AbortController;const{data:a}=await E({theme:F.value,title:H.title,text:H.text},G.value.signal).catch((a=>{Z(!0),V.error(a.message||"生成超时")}));M.value=a.catalogs,aa(),H.contents=a.contents,H.title=a.title,F.value||(F.value=a.title),X.value=!1,function(){for(let a=0;a<M.value.length;a++){const l=M.value[a];Q.value.push({catalog:l.catalog});for(let a=0;a<l.sub_catalog.length;a++){const e=l.sub_catalog[a];Q.value.push({catalog:l.catalog,sub_catalog:e})}}!function(){let a=0;Y.value=setInterval((()=>{var l,e;if(null==(l=Q.value[a])?void 0:l.sub_catalog){const l=H.catalogs.findIndex((l=>l.catalog===Q.value[a].catalog));H.catalogs[l].sub_catalog.push(Q.value[a].sub_catalog)}else(null==(e=Q.value[a])?void 0:e.catalog)?H.catalogs.push(Object.assign({catalog:"",sub_catalog:[]},Q.value[a])):(clearInterval(Y.value),Y.value=!1,X.value=!1);a++}),100)}()}()}const M=s([]),Q=s([]),X=s(!1),Y=s(null);function Z(a){var l;B.value=a,null==(l=G.value)||l.abort(),clearInterval(Y.value),Y.value=!1,X.value=!1}async function aa(){const{data:a}=await C();W.value=a,S.getUserInfo()}function la(){H.catalogs=[],Q.value=[],K()}const ea=u((()=>0!==H.catalogs.length&&!X.value));async function ta(){if(!S.isLogin)return S.setLoginDialog(!0);if(X.value)return V.error("正在生成大纲，请稍后");if(!ea.value)return V.error("请先生成大纲");X.value=!0;const a=await U(H).catch((()=>{Z(!0),V.error(a.message||"生成失败")}));aa(),200===a.code?(B.value=!1,P("created"),R.push("/ppt/my")):V.error(a.message)}return I({open:function(a="",l=""){F.value=a,H.text=l,M.value=[],H.catalogs=[],Q.value=[],X.value=!1,B.value=!0,K()}}),(a,l)=>(i(),c(f(k),{show:B.value,"onUpdate:show":l[3]||(l[3]=a=>B.value=a),"mask-closable":!1},{default:v((()=>{var a,e,t,s;return[r("div",j,[r("div",$,[l[5]||(l[5]=r("div",null,null,-1)),r("div",{class:"close_btn",onClick:l[0]||(l[0]=a=>B.value=!1)},l[4]||(l[4]=[r("img",{src:d},null,-1)]))]),g(f(w),{show:X.value},{description:v((()=>l[6]||(l[6]=[p(" 正在生成中 ")]))),default:v((()=>[g(f(m),{style:{height:"500px",padding:"0 57px","margin-bottom":"50px"}},{default:v((()=>[r("div",D,[r("div",O,[l[7]||(l[7]=r("div",{class:"dot"},null,-1)),l[8]||(l[8]=r("div",{class:"tag title"}," 主题 ",-1)),g(f(b),{value:F.value,"onUpdate:value":l[1]||(l[1]=a=>F.value=a)},null,8,["value"])]),r("div",A,[(i(!0),h(x,null,_(H.catalogs,((a,e)=>(i(),h("div",{key:e},[r("div",L,[l[9]||(l[9]=r("div",{class:"dot"},null,-1)),l[10]||(l[10]=r("div",{class:"tag"}," 标题 ",-1)),g(f(b),{value:a.catalog,"onUpdate:value":l=>a.catalog=l},null,8,["value","onUpdate:value"])]),r("div",T,[(i(!0),h(x,null,_(a.sub_catalog,((e,t)=>(i(),h("div",{key:t,class:"item"},[l[11]||(l[11]=r("div",{class:"dot"},null,-1)),l[12]||(l[12]=r("div",{class:"tag"}," 节点 ",-1)),g(f(b),{value:a.sub_catalog[t],"onUpdate:value":l=>a.sub_catalog[t]=l},null,8,["value","onUpdate:value"])])))),128))])])))),128))])])])),_:1})])),_:1},8,["show"]),r("div",q,[r("div",{class:"dialog-group-btn",style:{width:"20%"},onClick:l[2]||(l[2]=a=>Z(!1))}," 取消 "),r("div",{class:"dialog-group-btn",style:{width:"30%"},onClick:la}," 换个大纲 "),r("div",{class:"dialog-group-btn primary",style:{width:"50%"},onClick:ta}," 立即生成("+y((null==(a=z.value)?void 0:a.remainCount)>0&&J.value?`免费 ${null==(e=z.value)?void 0:e.remainCount}/${null==(t=z.value)?void 0:t.freeCount}`:`需${null==(s=z.value)?void 0:s.useIntegrate}积分`)+") ",1)])])]})),_:1},8,["show"]))}}),[["__scopeId","data-v-76190771"]]);export{N as C};
