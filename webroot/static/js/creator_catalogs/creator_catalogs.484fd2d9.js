import{e as a,k as l,j as e,o as t,r as s,g as o,p as u,ba as n,v as i,Z as c,C as v,x as r,A as d,bt as g,B as p,Y as f,bq as b,b2 as m,w as h,D as _,F as x,$ as w,y,a0 as k,_ as C}from"../main-da83e417.js";import{p as I,s as U,a as E}from"../ppt/ppt.68f8a116.js";const j={class:"dialog dark:bg-[#383838] bg-[#fff]"},D={class:"dialog_title_card border-[#E8E8E8] dark:border-[#292A2E]"},$={class:"input-main",style:{"padding-left":"15px"}},A={class:"item"},L={class:"w-[calc(100% - 35px)] ml-[35px]"},O={class:"item"},T={class:"w-[calc(100% - 35px)] ml-[35px] item-sub"},q={class:"dialog-group"},B=C(a({__name:"creator_catalogs",emits:"created",setup(a,{expose:C,emit:B}){const F=B,V=l(),Y=e(),Z=t(),z=s([]);o((()=>z.value.find((a=>"pptOutline"===a.type))));const G=o((()=>z.value.find((a=>"pptCreate"===a.type)))),H=s(!1),J=s("");s(""),u((()=>{aa()}));const K=s(),M=n({title:"",subTitle:"",text:"",catalogs:[],contents:[],complex:2,author:"",originTaskId:0}),N=o((()=>1===Y.userInfo.lifetimeVip||Y.userInfo.vipExpire&&new Date(Y.userInfo.vipExpire)>new Date));async function P(){S.value=!0,K.value=new AbortController;const{data:a}=await U({theme:J.value,title:M.title,text:M.text},K.value.signal).catch((a=>{X(!0),Z.error(a.message||"生成超时")}));Q.value=a.catalogs,aa(),M.contents=a.contents,M.title=a.title,J.value||(J.value=a.title),S.value=!1,function(){for(let a=0;a<Q.value.length;a++){const l=Q.value[a];R.value.push({catalog:l.catalog});for(let a=0;a<l.sub_catalog.length;a++){const e=l.sub_catalog[a];R.value.push({catalog:l.catalog,sub_catalog:e})}}!function(){let a=0;W.value=setInterval((()=>{var l,e;if(null==(l=R.value[a])?void 0:l.sub_catalog){const l=M.catalogs.findIndex((l=>l.catalog===R.value[a].catalog));M.catalogs[l].sub_catalog.push(R.value[a].sub_catalog)}else(null==(e=R.value[a])?void 0:e.catalog)?M.catalogs.push(Object.assign({catalog:"",sub_catalog:[]},R.value[a])):(clearInterval(W.value),W.value=!1,S.value=!1);a++}),100)}()}()}const Q=s([]),R=s([]),S=s(!1),W=s(null);function X(a){var l;H.value=a,null==(l=K.value)||l.abort(),clearInterval(W.value),W.value=!1,S.value=!1}async function aa(){const{data:a}=await I();z.value=a,Y.getUserInfo()}function la(){M.catalogs=[],R.value=[],P()}const ea=o((()=>0!==M.catalogs.length&&!S.value));async function ta(){if(!Y.isLogin)return Y.setLoginDialog(!0);if(S.value)return Z.error("正在生成大纲，请稍后");if(!ea.value)return Z.error("请先生成大纲");S.value=!0;const a=await E(M).catch((()=>{X(!0),Z.error(a.message||"生成失败")}));aa(),200===a.code?(H.value=!1,F("created"),V.push("/ppt/my")):Z.error(a.message)}return C({open:function(a="",l=""){J.value=a,M.text=l,Q.value=[],M.catalogs=[],R.value=[],S.value=!1,H.value=!0,P()}}),(a,l)=>(i(),c(r(k),{show:H.value,"onUpdate:show":l[3]||(l[3]=a=>H.value=a),"mask-closable":!1},{default:v((()=>{var a,e,t,s;return[d("div",j,[d("div",D,[l[5]||(l[5]=d("div",null,null,-1)),d("div",{class:"close_btn",onClick:l[0]||(l[0]=a=>H.value=!1)},l[4]||(l[4]=[d("img",{src:g},null,-1)]))]),p(r(w),{show:S.value},{description:v((()=>l[6]||(l[6]=[f(" 正在生成中 ")]))),default:v((()=>[p(r(b),{style:{height:"500px",padding:"0 57px","margin-bottom":"50px"}},{default:v((()=>[d("div",$,[d("div",A,[l[7]||(l[7]=d("div",{class:"dot"},null,-1)),l[8]||(l[8]=d("div",{class:"tag title"}," 主题 ",-1)),p(r(m),{value:J.value,"onUpdate:value":l[1]||(l[1]=a=>J.value=a)},null,8,["value"])]),d("div",L,[(i(!0),h(x,null,_(M.catalogs,((a,e)=>(i(),h("div",{key:e},[d("div",O,[l[9]||(l[9]=d("div",{class:"dot"},null,-1)),l[10]||(l[10]=d("div",{class:"tag"}," 标题 ",-1)),p(r(m),{value:a.catalog,"onUpdate:value":l=>a.catalog=l},null,8,["value","onUpdate:value"])]),d("div",T,[(i(!0),h(x,null,_(a.sub_catalog,((e,t)=>(i(),h("div",{key:t,class:"item"},[l[11]||(l[11]=d("div",{class:"dot"},null,-1)),l[12]||(l[12]=d("div",{class:"tag"}," 节点 ",-1)),p(r(m),{value:a.sub_catalog[t],"onUpdate:value":l=>a.sub_catalog[t]=l},null,8,["value","onUpdate:value"])])))),128))])])))),128))])])])),_:1})])),_:1},8,["show"]),d("div",q,[d("div",{class:"dialog-group-btn",style:{width:"20%"},onClick:l[2]||(l[2]=a=>X(!1))}," 取消 "),d("div",{class:"dialog-group-btn",style:{width:"30%"},onClick:la}," 换个大纲 "),d("div",{class:"dialog-group-btn primary",style:{width:"50%"},onClick:ta}," 立即生成("+y((null==(a=G.value)?void 0:a.remainCount)>0&&N.value?`免费 ${null==(e=G.value)?void 0:e.remainCount}/${null==(t=G.value)?void 0:t.freeCount}`:`需${null==(s=G.value)?void 0:s.useIntegrate}积分`)+") ",1)])])]})),_:1},8,["show"]))}}),[["__scopeId","data-v-76190771"]]);export{B as C};
