import{e as a,l,k as e,p as t,r as s,g as u,q as o,K as n,w as i,O as c,D as v,y as r,B as d,bI as g,C as p,a3 as f,bF as m,aI as b,x as h,E as _,F as x,a0 as w,z as y,aj as I,_ as k}from"../main-bf8e7d49.js";import{p as C,s as E,a as U}from"../ppt/ppt.d221cd1f.js";const j={class:"dialog dark:bg-[#383838] bg-[#fff]"},D={class:"dialog_title_card border-[#E8E8E8] dark:border-[#292A2E]"},O={class:"input-main",style:{"padding-left":"15px"}},$={class:"item"},A={class:"w-[calc(100% - 35px)] ml-[35px]"},F={class:"item"},L={class:"w-[calc(100% - 35px)] ml-[35px] item-sub"},T={class:"dialog-group"},q=k(a({__name:"creator_catalogs",emits:"created",setup(a,{expose:k,emit:q}){const z=q,B=l(),K=e(),V=t(),G=s([]);u((()=>G.value.find((a=>"pptOutline"===a.type))));const H=u((()=>G.value.find((a=>"pptCreate"===a.type)))),J=s(!1),M=s("");s(""),o((()=>{aa()}));const N=s(),P=n({title:"",subTitle:"",text:"",catalogs:[],contents:[],complex:2,author:"",originTaskId:0}),Q=u((()=>1===K.userInfo.lifetimeVip||K.userInfo.vipExpire&&new Date(K.userInfo.vipExpire)>new Date));async function R(){X.value=!0,N.value=new AbortController;const{data:a}=await E({theme:M.value,title:P.title,text:P.text},N.value.signal).catch((a=>{Z(!0),V.error(a.message||"生成超时")}));S.value=a.catalogs,aa(),P.contents=a.contents,P.title=a.title,M.value||(M.value=a.title),X.value=!1,function(){for(let a=0;a<S.value.length;a++){const l=S.value[a];W.value.push({catalog:l.catalog});for(let a=0;a<l.sub_catalog.length;a++){const e=l.sub_catalog[a];W.value.push({catalog:l.catalog,sub_catalog:e})}}!function(){let a=0;Y.value=setInterval((()=>{var l,e;if(null==(l=W.value[a])?void 0:l.sub_catalog){const l=P.catalogs.findIndex((l=>l.catalog===W.value[a].catalog));P.catalogs[l].sub_catalog.push(W.value[a].sub_catalog)}else(null==(e=W.value[a])?void 0:e.catalog)?P.catalogs.push(Object.assign({catalog:"",sub_catalog:[]},W.value[a])):(clearInterval(Y.value),Y.value=!1,X.value=!1);a++}),100)}()}()}const S=s([]),W=s([]),X=s(!1),Y=s(null);function Z(a){var l;J.value=a,null==(l=N.value)||l.abort(),clearInterval(Y.value),Y.value=!1,X.value=!1}async function aa(){const{data:a}=await C();G.value=a,K.getUserInfo()}function la(){P.catalogs=[],W.value=[],R()}const ea=u((()=>0!==P.catalogs.length&&!X.value));async function ta(){if(!K.isLogin)return K.setLoginDialog(!0);if(X.value)return V.error("正在生成大纲，请稍后");if(!ea.value)return V.error("请先生成大纲");X.value=!0;const a=await U(P).catch((()=>{Z(!0),V.error(a.message||"生成失败")}));aa(),200===a.code?(J.value=!1,z("created"),B.push("/ppt/my")):V.error(a.message)}return k({open:function(a="",l=""){M.value=a,P.text=l,S.value=[],P.catalogs=[],W.value=[],X.value=!1,J.value=!0,R()}}),(a,l)=>(i(),c(r(I),{show:J.value,"onUpdate:show":l[3]||(l[3]=a=>J.value=a),"mask-closable":!1},{default:v((()=>{var a,e,t,s;return[d("div",j,[d("div",D,[l[5]||(l[5]=d("div",null,null,-1)),d("div",{class:"close_btn",onClick:l[0]||(l[0]=a=>J.value=!1)},l[4]||(l[4]=[d("img",{src:g},null,-1)]))]),p(r(w),{show:X.value},{description:v((()=>l[6]||(l[6]=[f(" 正在生成中 ")]))),default:v((()=>[p(r(m),{style:{height:"500px",padding:"0 57px","margin-bottom":"50px"}},{default:v((()=>[d("div",O,[d("div",$,[l[7]||(l[7]=d("div",{class:"dot"},null,-1)),l[8]||(l[8]=d("div",{class:"tag title"}," 主题 ",-1)),p(r(b),{value:M.value,"onUpdate:value":l[1]||(l[1]=a=>M.value=a)},null,8,["value"])]),d("div",A,[(i(!0),h(x,null,_(P.catalogs,((a,e)=>(i(),h("div",{key:e},[d("div",F,[l[9]||(l[9]=d("div",{class:"dot"},null,-1)),l[10]||(l[10]=d("div",{class:"tag"}," 标题 ",-1)),p(r(b),{value:a.catalog,"onUpdate:value":l=>a.catalog=l},null,8,["value","onUpdate:value"])]),d("div",L,[(i(!0),h(x,null,_(a.sub_catalog,((e,t)=>(i(),h("div",{key:t,class:"item"},[l[11]||(l[11]=d("div",{class:"dot"},null,-1)),l[12]||(l[12]=d("div",{class:"tag"}," 节点 ",-1)),p(r(b),{value:a.sub_catalog[t],"onUpdate:value":l=>a.sub_catalog[t]=l},null,8,["value","onUpdate:value"])])))),128))])])))),128))])])])),_:1})])),_:1},8,["show"]),d("div",T,[d("div",{class:"dialog-group-btn",style:{width:"20%"},onClick:l[2]||(l[2]=a=>Z(!1))}," 取消 "),d("div",{class:"dialog-group-btn",style:{width:"30%"},onClick:la}," 换个大纲 "),d("div",{class:"dialog-group-btn primary",style:{width:"50%"},onClick:ta}," 立即生成("+y((null==(a=H.value)?void 0:a.remainCount)>0&&Q.value?`免费 ${null==(e=H.value)?void 0:e.remainCount}/${null==(t=H.value)?void 0:t.freeCount}`:`需${null==(s=H.value)?void 0:s.useIntegrate}积分`)+") ",1)])])]})),_:1},8,["show"]))}}),[["__scopeId","data-v-76190771"]]);export{q as C};
