import{e,ac as l,l as t,J as a,r as i,p as s,k as n,a6 as o,aa as u,Z as d,g as c,L as v,q as r,I as p,a_ as h,a$ as m,ah as g,w as f,x as y,B as k,C as x,D as b,z as w,y as S,a1 as I,A as C,F as L,E as A,a2 as _,aH as B,P as $,a0 as H,am as M,aj as V,O as z,a4 as T,b0 as E,$ as D,b1 as R,_ as O}from"../main-a0b53047.js";import{_ as N,a as Z}from"../chatZhiDing/chatZhiDing.c3bef636.js";import{N as j}from"../InfiniteScroll/InfiniteScroll.c574e632.js";const F={key:0,class:"y-sidebar siderBarBox dark:bg-[#24252b] bg-[#F9F9FB]",id:"chatRight"},G={class:"chatBox"},J={class:"btn-line"},U={key:1,class:"btn"},P={key:0,class:"today"},q={class:"chatList"},K=["onMouseenter","onClick"],Q={style:{display:"flex","align-items":"center"}},W=["onInput","onBlur","onUpdate:modelValue"],X={key:1,style:{"font-size":"14px"}},Y={key:2,src:Z,style:{"margin-left":"10px"},alt:""},ee={class:"buttonBox"},le={style:{display:"flex","align-items":"center",gap:"10px"}},te={class:"y-pop"},ae=["onClick"],ie={class:"t t1"},se=["onClick"],ne={class:"t t1"},oe=["onClick"],ue={class:"t t2"},de={key:1,class:"history"},ce={key:2,class:"chatList"},ve=["onMouseenter","onClick"],re={style:{display:"flex","align-items":"center"}},pe=["onInput","onBlur","onUpdate:modelValue"],he={key:1,style:{"font-size":"14px"}},me={key:2,src:Z,style:{"margin-left":"10px"},alt:""},ge={class:"buttonBox"},fe={style:{display:"flex","align-items":"center",gap:"10px"}},ye={class:"y-pop"},ke=["onClick"],xe={class:"t t1"},be=["onClick"],we={class:"t t1"},Se=["onClick"],Ie={class:"t t2"},Ce=O(e({__name:"index",emits:["modelType"],setup(e,{expose:O,emit:Z}){const Ce=l(),Le=t(),Ae=a().appContext.config.globalProperties,_e=i(!0);Ae.$mitt.on("expand",(e=>{_e.value=!!e}));const Be=s(),$e=n();o();const He=u(),Me=d(),Ve=c((()=>$e.isLogin)),ze=i([]),Te=c((()=>$e.userInfo));!Te.value||!Te.value.lifetimeVip||Te.value.lifetimeVip;const Ee=i([]),De=i([]),Re=i([]),Oe=i([]);var Ne=!1;const Ze=Z;i(null),c((()=>"dark"==Me.theme?"#36373E":"rgba(142, 145, 166, 0.15)")),c((()=>"dark"==Me.theme?"darkItem item":"item")),c((()=>"dark"==Me.theme?"darkItemSelect itemSelect":"itemSelect !bg-[#3e6ae7] !border-transparent !text-white"));const je=i(-1),Fe=i(-1);async function Ge(){console.log("handleAppStarthandleAppStart"),await qe();let e=localStorage.getItem("chatLogId"),l=JSON.parse(e);console.log(l,"locaData"),l&&"chat"==l.modelType?(Xe.value=l.id,el(l)):0!=Ee.value.length?(Xe.value=Ee.value[0].id,el(Ee.value[0])):0!=De.value.length&&(Xe.value=De.value[0].id,el(De.value[0])),ze.value&&ze.value.length||Qe()}v((()=>{var e;return null==(e=Te.value)?void 0:e.id}),(e=>{e&&Ge()})),r((async()=>{Ge()})),p.off("updateConversationList"),p.on("updateConversationList",(()=>{console.log("newValnewValnewValnewValnewVal"),qe()}));let Je=i(10),Ue=i(!1),Pe=i(!1);async function qe(){if(!Ve.value)return;if(Pe.value)return;if(Ue.value)return;Ue.value=!0;let e=ze.value.length;await h({modelType:"chat",size:Je.value,page:1}).then((l=>{ze.value=[],Ee.value=[],De.value=[],0!=l.data.length?(e==l.data.length&&Je.value>10&&(Pe.value=!0),function(e){let l=(new Date).getDate();l<10&&(l="0"+l);const{data:t}=e;ze.value=t,console.log(ze.value),t.forEach((e=>{if(e.title=e.title.slice(0,7),null!=e.lastTime){let t=e.lastTime.split(" ")[0].split("-")[2];l==t?Ee.value=[...Ee.value,e]:De.value=[...De.value,e]}if(null===e.lastTime){let t=e.createdAt.split(" ")[0].split("-")[2];l==t?Ee.value=[...Ee.value,e]:De.value=[...De.value,e]}})),Ue.value=!1}(l)):Ue.value=!1}))}const Ke=i(!1);async function Qe(){console.log("handleAddhandleAdd"),"/chat"!=Ce.path&&Le.push("/chat"),p.emit("chatLogHandleStop"),p.emit("chatLogList",[]),p.emit("setIsreallyHandleAdd",!0),p.emit("isreallyHandleAdd",!0),p.emit("sendSuccess"),p.emit("choseDeafulMode"),We.value=!0,Xe.value=!1}let We=i(!1);p.off("isreallyHandleAdd"),p.on("isreallyHandleAdd",(async e=>{We.value=e})),p.off("reallyHandleAdd"),p.on("reallyHandleAdd",(async e=>{console.log("reallyHandleAddreallyHandleAdd",e),await He.addNewChatGroup(e),Pe.value=!1,await qe();let l=ze.value[0];ze.value.some((e=>{if(0==e.isSticky)return l=e,!0})),el(l)}));const Xe=i(),Ye=i();function el(e,l){let t;t=l?{groupId:e.uuid,logType:1}:{groupId:e.id,logType:1},p.emit("create",!1),p.emit("exploreApp",!1),p.emit("uuid",e),m(t).then((async t=>{console.log(e,"itemitemitem",We.value),localStorage.setItem("chatLogId",JSON.stringify(e)),await He.setActiveGroup(e.id),Xe.value=l?e.uuid:e.id,Ye.value&&(Ye.value=null),Ze("modelType",e.config),p.emit("setModel",JSON.parse(e.config).modelInfo);let a=t.data.filter((e=>null!=e.conversationOptions));0==a.length?We.value?(p.emit("isreallyHandleAdd",!1),p.emit("haveLog",!0),p.emit("reallyOnConversation"),p.emit("setIsreallyHandleAdd",!1),We.value=!1):(p.emit("chatLogList",a),p.emit("haveLog",!1)):p.emit("chatLogList",t.data)}))}const ll=s();async function tl(e,l){if((0==Ee.value.length&&1==De.value.length||1==Ee.value.length&&0==De.value.length)&&localStorage.removeItem("chatLogId"),await He.deleteGroup(e,Je.value),await qe(),0==l){if(Ee.value=Ee.value.filter((l=>l.id!=e.id)),e.id==Xe.value){if(0==Ee.value.length&&De.value.length>0)return void el(De.value[0]);Ee.value.length>0?el(Ee.value[0]):Qe()}}else if(1==l&&(De.value=De.value.filter((l=>l.id!=e.id)),e.id==Xe.value)){if(Ee.value.length>0&&0==De.value.length)return void el(Ee.value[0]);De.value.length>0?el(De.value[0]):Qe()}ll.success(D("common.deleteSuccess"))}const al=i(null);function il(e){e.inputIsShow=!0,setTimeout((()=>{al.value[0].focus()}),100)}function sl(e,l){e.inputIsShow=!1;let t={groupId:e.id,title:e.title};E(t).then((t=>{200===t.code&&(0==l?Ee.value.forEach((l=>{l.id==e.id&&(l.title=e.title)})):1==l&&De.value.forEach((l=>{l.id==e.id&&(l.title=e.title)})))}))}function nl(e){7==e.title.length&&ll.warning(D("chat.max7text"))}O({hideRight:function(){document.getElementById("chatRight").style.width="0px"},showRight:function(){document.getElementById("chatRight").style.width="298px"}});let ol=(e,l)=>{R({id:e.id,isSticky:l}).then((e=>{l?Be.success(D("common.zhidinSucc")):Be.success(D("common.nozhidinSucc")),Ge()}))};return(e,l)=>{const t=g("EmptyBlo");return _e.value?(f(),y("div",F,[l[18]||(l[18]=k("div",{class:"topMenu"},null,-1)),k("div",G,[x(S(j),{style:{height:"100%"},distance:60,onLoad:l[4]||(l[4]=e=>{B(Je)?Je.value+=10:Je+=10,qe()})},{default:b((()=>[k("div",J,[Ke.value?(f(),y("div",U,[k("span",null,w(e.$t("chat.newChatGenloading")),1),x(S(I),{"content-style":{fontSize:"20px !important",marginLeft:"6px"}})])):(f(),y("div",{key:0,onClick:Qe,class:"btn"},[l[5]||(l[5]=k("span",{class:"plus"},"+",-1)),k("span",null,w(e.$t("chat.newChat")),1)]))]),!S(Ne)&&Ee.value&&Ee.value.length>0||S(Ne)&&Re.value&&Re.value.length>0?(f(),y("div",P," 今天 ")):C("",!0),k("div",q,[Ve.value?(f(!0),y(L,{key:0},A(S(Ne)?Re.value:Ee.value,((t,a)=>(f(),y("div",{onMouseenter:e=>je.value=a,onMouseleave:l[1]||(l[1]=e=>je.value=-1),class:_(["itemBox bg-white dark:bg-[#f6f6f8]",Xe.value==t.id||je.value==a?"cell active-cell":"cell unactive-cell"]),key:t.id,onClick:e=>{B(We)?We.value=!1:We=!1,"/chat"!=S(Ce).path&&S(Le).push("/chat"),el(t)}},[k("div",Q,[l[6]||(l[6]=k("img",{src:N,style:{"margin-right":"10px"},alt:""},null,-1)),t.inputIsShow?$((f(),y("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:al,onInput:e=>nl(t),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:e=>sl(t,0),onClick:l[0]||(l[0]=M((()=>{}),["stop"])),"onUpdate:modelValue":e=>t.title=e},null,40,W)),[[H,t.title]]):(f(),y("p",X,w(t.title),1)),1==t.isSticky?(f(),y("img",Y)):C("",!0)]),k("div",ee,[k("div",le,[x(S(V),{style:{"border-radius":"8px",width:"126px",padding:"8px !important"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:b((()=>l[7]||(l[7]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:b((()=>[k("div",te,[k("div",{class:"blo",onClick:M((e=>il(t)),["stop"])},[l[8]||(l[8]=k("div",{class:"edit"},null,-1)),k("div",ie,w(e.$t("digitalMan.rename")),1)],8,ae),k("div",{class:"blo",onClick:M((e=>S(ol)(t,1==t.isSticky?0:1)),["stop"])},[l[9]||(l[9]=k("div",{class:"ding"},null,-1)),k("div",ne,w(1==t.isSticky?e.$t("common.noZhidin"):e.$t("common.zhidin")),1)],8,se),k("div",{class:"blo",onClick:M((e=>tl(t,0)),["stop"])},[l[10]||(l[10]=k("div",{class:"dele"},null,-1)),k("div",ue,w(e.$t("common.delete")),1)],8,oe)])])),_:2},1024)])])],42,K)))),128)):0==Re.value.length&&0==Ee.value.length?(f(),z(t,{key:1})):C("",!0)]),!S(Ne)&&De.value&&De.value.length>0||S(Ne)&&Oe.value&&Oe.value.length>0?(f(),y("div",de,w(e.$t("common.history")),1)):C("",!0),Ve.value?(f(),y("div",ce,[(f(!0),y(L,null,A(S(Ne)?Oe.value:De.value,((t,a)=>(f(),y("div",{onMouseenter:e=>Fe.value=a,onMouseleave:l[3]||(l[3]=e=>Fe.value=-1),class:_(["itemBox bg-white dark:bg-[#f6f6f8]",Xe.value==t.id||Fe.value==a?"cell active-cell":"cell unactive-cell"]),key:t.id,onClick:e=>{B(We)?We.value=!1:We=!1,"/chat"!=S(Ce).path&&S(Le).push("/chat"),el(t)}},[k("div",re,[l[11]||(l[11]=k("img",{src:N,style:{"margin-right":"10px"},alt:""},null,-1)),t.inputIsShow?$((f(),y("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:al,onInput:e=>nl(t),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:e=>sl(t,1),onClick:l[2]||(l[2]=M((()=>{}),["stop"])),"onUpdate:modelValue":e=>t.title=e},null,40,pe)),[[H,t.title]]):(f(),y("p",he,w(t.title),1)),1==t.isSticky?(f(),y("img",me)):C("",!0)]),k("div",ge,[k("div",fe,[x(S(V),{style:{"border-radius":"8px",width:"126px",padding:"8px !important"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:b((()=>l[12]||(l[12]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:b((()=>[k("div",ye,[k("div",{class:"blo",onClick:M((e=>il(t)),["stop"])},[l[13]||(l[13]=k("div",{class:"edit"},null,-1)),k("div",xe,w(e.$t("digitalMan.rename")),1)],8,ke),k("div",{class:"blo",onClick:M((e=>S(ol)(t,1==t.isSticky?0:1)),["stop"])},[l[14]||(l[14]=k("div",{class:"ding"},null,-1)),k("div",we,w(1==t.isSticky?e.$t("common.noZhidin"):e.$t("common.zhidin")),1)],8,be),k("div",{class:"blo",onClick:M((e=>tl(t,1)),["stop"])},[l[15]||(l[15]=k("div",{class:"dele"},null,-1)),k("div",Ie,w(e.$t("common.delete")),1)],8,Se)])])),_:2},1024)])])],42,ve)))),128))])):C("",!0),x(S(I),{show:S(Ue)&&(Re.value.length>0||Ee.value.length>0)&&!S(Pe),size:"small"},{description:b((()=>l[16]||(l[16]=[T(" 加载中 ")]))),default:b((()=>[l[17]||(l[17]=k("div",{style:{width:"100%"}},null,-1))])),_:1,__:[17]},8,["show"])])),_:1})])])):C("",!0)}}}),[["__scopeId","data-v-2f745d0e"]]);export{Ce as s};
