import{e,ac as t,l,J as a,r as i,p as s,k as n,a6 as o,aa as c,Z as u,g as d,L as v,q as r,I as p,b5 as h,b2 as m,ah as g,w as y,x as f,B as k,z as x,C as b,y as w,a1 as C,A as S,F as I,E as B,a2 as L,P as M,a0 as $,am as _,D as V,aj as T,O as z,aR as E,$ as R,b6 as D,_ as G}from"../main-4156cf5e.js";import{_ as O,a as Z}from"../chatZhiDing/chatZhiDing.c3bef636.js";const A={key:0,class:"y-sidebar siderBarBox dark:bg-[#24252b] bg-[#F9F9FB]",id:"chatRight"},F={class:"chatBox"},J={class:"btn-line"},N={key:1,class:"btn"},U={key:0,class:"today"},j={class:"chatList"},q=["onMouseenter","onClick"],P={style:{display:"flex","align-items":"center"}},H=["onInput","onBlur","onUpdate:modelValue"],K={key:1,style:{"font-size":"14px"}},Q={key:2,src:Z,style:{"margin-left":"10px"},alt:""},W={class:"buttonBox"},X={style:{display:"flex","align-items":"center",gap:"10px"}},Y={class:"y-pop"},ee=["onClick"],te={class:"t t1"},le=["onClick"],ae={class:"t t1"},ie=["onClick"],se={class:"t t2"},ne={key:1,class:"history"},oe={key:2,class:"chatList"},ce=["onMouseenter","onClick"],ue={style:{display:"flex","align-items":"center"}},de=["onInput","onBlur","onUpdate:modelValue"],ve={key:1,style:{"font-size":"14px"}},re={key:2,src:Z,style:{"margin-left":"10px"},alt:""},pe={class:"buttonBox"},he={style:{display:"flex","align-items":"center",gap:"10px"}},me={class:"y-pop"},ge=["onClick"],ye={class:"t t1"},fe=["onClick"],ke={class:"t t1"},xe=["onClick"],be={class:"t t2"},we=G(e({__name:"index",emits:["modelType"],setup(e,{expose:G,emit:Z}){const we=t(),Ce=l(),Se=a().appContext.config.globalProperties,Ie=i(!0);Se.$mitt.on("expand",(e=>{Ie.value=!!e}));const Be=s(),Le=n(),{isMobile:Me}=o(),$e=c(),_e=u(),Ve=d((()=>Le.isLogin)),Te=i([]),ze=d((()=>Le.userInfo));!ze.value||!ze.value.lifetimeVip||ze.value.lifetimeVip;const Ee=i([]),Re=i([]),De=i([]),Ge=i([]);var Oe=!1;const Ze=Z;i(null),d((()=>"dark"==_e.theme?"#36373E":"rgba(142, 145, 166, 0.15)")),d((()=>"dark"==_e.theme?"darkItem item":"item")),d((()=>"dark"==_e.theme?"darkItemSelect itemSelect":"itemSelect !bg-[#3e6ae7] !border-transparent !text-white"));const Ae=i(-1),Fe=i(-1);async function Je(){await Ne();let e=localStorage.getItem("chatLogId"),t=JSON.parse(e);console.log(t,"locaData"),t?(qe.value=t.id,He(t)):0!=Ee.value.length?(qe.value=Ee.value[0].id,He(Ee.value[0])):(qe.value=Re.value[0].id,He(Re.value[0])),Te.value&&Te.value.length||je()}async function Ne(){await h({modelType:"chat",size:100,page:1}).then((e=>{Te.value=[],Ee.value=[],Re.value=[],0!=e.data.length?function(e){let t=(new Date).getDate();t<10&&(t="0"+t);const{data:l}=e;Te.value=l,console.log(Te.value),l.forEach((e=>{if(e.title=e.title.slice(0,7),null!=e.lastTime){let l=e.lastTime.split(" ")[0].split("-")[2];t==l?Ee.value=[...Ee.value,e]:Re.value=[...Re.value,e]}if(null===e.lastTime){let l=e.createdAt.split(" ")[0].split("-")[2];t==l?Ee.value=[...Ee.value,e]:Re.value=[...Re.value,e]}}))}(e):je()}))}v((()=>{var e;return null==(e=ze.value)?void 0:e.id}),(e=>{e&&Je()})),r((async()=>{Je()})),p.on("updateConversationList",(()=>{console.log("newValnewValnewValnewValnewVal"),Ne()}));const Ue=i(!1);async function je(){"/chat"!=we.path&&Ce.push("/chat");try{if(!Ve.value)return void Le.setLoginDialog(!0);Ue.value=!0,await $e.updateChatTab("history"),await $e.addNewChatGroup(),await $e.queryMyGroup(),await Ne();let e=Te.value[0];Te.value.some((t=>{if(0==t.isSticky)return e=t,!0})),He(e),Ue.value=!1,Me.value&&_e.setSiderCollapsed(!0)}catch(e){Ue.value=!1}}const qe=i(),Pe=i();function He(e,t){let l;l=t?{groupId:e.uuid,logType:1}:{groupId:e.id,logType:1},p.emit("create",!1),p.emit("exploreApp",!1),p.emit("uuid",e),m(l).then((async l=>{console.log(e,"itemitemitem"),localStorage.setItem("chatLogId",JSON.stringify(e)),await $e.setActiveGroup(e.id),qe.value=t?e.uuid:e.id,Pe.value&&(Pe.value=null),Ze("modelType",e.config),p.emit("setModel",JSON.parse(e.config).modelInfo);let a=l.data.filter((e=>null!=e.conversationOptions));0==a.length?(p.emit("chatLogList",a),p.emit("haveLog",!1)):p.emit("chatLogList",l.data)}))}const Ke=s();async function Qe(e,t){if(0==Ee.value.length&&1==Re.value.length||1==Ee.value.length&&0==Re.value.length)Ke.error(R("chat.liuOneChat"));else{if(await $e.deleteGroup(e),await $e.queryMyGroup(),0==t){if(Ee.value=Ee.value.filter((t=>t.id!=e.id)),e.id==qe.value){if(0==Ee.value.length)return void He(Re.value[0]);He(Ee.value[0])}}else if(1==t&&(Re.value=Re.value.filter((t=>t.id!=e.id)),e.id==qe.value)){if(0==Re.value.length)return void He(Ee.value[0]);He(Re.value[0])}Ke.success(R("common.deleteSuccess"))}}const We=i(null);function Xe(e){e.inputIsShow=!0,setTimeout((()=>{We.value[0].focus()}),100)}function Ye(e,t){e.inputIsShow=!1;let l={groupId:e.id,title:e.title};E(l).then((l=>{200===l.code&&(0==t?Ee.value.forEach((t=>{t.id==e.id&&(t.title=e.title)})):1==t&&Re.value.forEach((t=>{t.id==e.id&&(t.title=e.title)})))}))}function et(e){7==e.title.length&&Ke.warning(R("chat.max7text"))}G({hideRight:function(){document.getElementById("chatRight").style.width="0px"},showRight:function(){document.getElementById("chatRight").style.width="298px"}});let tt=(e,t)=>{D({id:e.id,isSticky:t}).then((e=>{t?Be.success(R("common.zhidinSucc")):Be.success(R("common.nozhidinSucc")),Je()}))};return(e,t)=>{const l=g("EmptyBlo");return Ie.value?(y(),f("div",A,[t[15]||(t[15]=k("div",{class:"topMenu"},null,-1)),k("div",F,[k("div",J,[Ue.value?(y(),f("div",N,[k("span",null,x(e.$t("chat.newChatGenloading")),1),b(w(C),{"content-style":{fontSize:"20px !important",marginLeft:"6px"}})])):(y(),f("div",{key:0,onClick:je,class:"btn"},[t[4]||(t[4]=k("span",{class:"plus"},"+",-1)),k("span",null,x(e.$t("chat.newChat")),1)]))]),!w(Oe)&&Ee.value&&Ee.value.length>0||w(Oe)&&De.value&&De.value.length>0?(y(),f("div",U," 今天 ")):S("",!0),k("div",j,[Ve.value?(y(!0),f(I,{key:0},B(w(Oe)?De.value:Ee.value,((l,a)=>(y(),f("div",{onMouseenter:e=>Ae.value=a,onMouseleave:t[1]||(t[1]=e=>Ae.value=-1),class:L(["itemBox bg-white dark:bg-[#f6f6f8]",qe.value==l.id||Ae.value==a?"cell active-cell":"cell unactive-cell"]),key:l.id,onClick:e=>{"/chat"!=w(we).path&&w(Ce).push("/chat"),He(l)}},[k("div",P,[t[5]||(t[5]=k("img",{src:O,style:{"margin-right":"10px"},alt:""},null,-1)),l.inputIsShow?M((y(),f("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:We,onInput:e=>et(l),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:e=>Ye(l,0),onClick:t[0]||(t[0]=_((()=>{}),["stop"])),"onUpdate:modelValue":e=>l.title=e},null,40,H)),[[$,l.title]]):(y(),f("p",K,x(l.title),1)),1==l.isSticky?(y(),f("img",Q)):S("",!0)]),k("div",W,[k("div",X,[b(w(T),{style:{"border-radius":"8px",width:"126px",padding:"8px !important"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:V((()=>t[6]||(t[6]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:V((()=>[k("div",Y,[k("div",{class:"blo",onClick:_((e=>Xe(l)),["stop"])},[t[7]||(t[7]=k("div",{class:"edit"},null,-1)),k("div",te,x(e.$t("digitalMan.rename")),1)],8,ee),k("div",{class:"blo",onClick:_((e=>w(tt)(l,1==l.isSticky?0:1)),["stop"])},[t[8]||(t[8]=k("div",{class:"ding"},null,-1)),k("div",ae,x(1==l.isSticky?e.$t("common.noZhidin"):e.$t("common.zhidin")),1)],8,le),k("div",{class:"blo",onClick:_((e=>Qe(l,0)),["stop"])},[t[9]||(t[9]=k("div",{class:"dele"},null,-1)),k("div",se,x(e.$t("common.delete")),1)],8,ie)])])),_:2},1024)])])],42,q)))),128)):0==De.value.length&&0==Ee.value.length?(y(),z(l,{key:1})):S("",!0)]),!w(Oe)&&Re.value&&Re.value.length>0||w(Oe)&&Ge.value&&Ge.value.length>0?(y(),f("div",ne,x(e.$t("common.history")),1)):S("",!0),Ve.value?(y(),f("div",oe,[(y(!0),f(I,null,B(w(Oe)?Ge.value:Re.value,((l,a)=>(y(),f("div",{onMouseenter:e=>Fe.value=a,onMouseleave:t[3]||(t[3]=e=>Fe.value=-1),class:L(["itemBox bg-white dark:bg-[#f6f6f8]",qe.value==l.id||Fe.value==a?"cell active-cell":"cell unactive-cell"]),key:l.id,onClick:e=>{"/chat"!=w(we).path&&w(Ce).push("/chat"),He(l)}},[k("div",ue,[t[10]||(t[10]=k("img",{src:O,style:{"margin-right":"10px"},alt:""},null,-1)),l.inputIsShow?M((y(),f("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:We,onInput:e=>et(l),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:e=>Ye(l,1),onClick:t[2]||(t[2]=_((()=>{}),["stop"])),"onUpdate:modelValue":e=>l.title=e},null,40,de)),[[$,l.title]]):(y(),f("p",ve,x(l.title),1)),1==l.isSticky?(y(),f("img",re)):S("",!0)]),k("div",pe,[k("div",he,[b(w(T),{style:{"border-radius":"8px",width:"126px",padding:"8px !important"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:V((()=>t[11]||(t[11]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:V((()=>[k("div",me,[k("div",{class:"blo",onClick:_((e=>Xe(l)),["stop"])},[t[12]||(t[12]=k("div",{class:"edit"},null,-1)),k("div",ye,x(e.$t("digitalMan.rename")),1)],8,ge),k("div",{class:"blo",onClick:_((e=>w(tt)(l,1==l.isSticky?0:1)),["stop"])},[t[13]||(t[13]=k("div",{class:"ding"},null,-1)),k("div",ke,x(1==l.isSticky?e.$t("common.noZhidin"):e.$t("common.zhidin")),1)],8,fe),k("div",{class:"blo",onClick:_((e=>Qe(l,1)),["stop"])},[t[14]||(t[14]=k("div",{class:"dele"},null,-1)),k("div",be,x(e.$t("common.delete")),1)],8,xe)])])),_:2},1024)])])],42,ce)))),128))])):S("",!0)])])):S("",!0)}}}),[["__scopeId","data-v-165635f6"]]);export{we as s};
