import{e,a9 as l,l as t,K as a,r as i,p as s,k as n,a5 as o,af as u,$ as c,g as d,M as v,q as r,J as p,b4 as g,a$ as h,ak as m,w as y,x as f,A as k,D as b,z as x,F as w,E as C,I,Q as S,a0 as B,ap as L,y as M,B as _,C as V,P as T,aS as E,am as R,b5 as D,_ as G}from"../main-23bab8dd.js";import{_ as A,a as F,b as J}from"../empty/empty.e8b55919.js";const N={key:0,class:"y-sidebar siderBarBox dark:bg-[#24252b] bg-[#F9F9FB]",id:"chatRight"},O={class:"chatBox"},U={key:0,class:"today"},q={class:"chatList"},z=["onMouseenter","onClick"],$={style:{display:"flex","align-items":"center"}},j=["onInput","onBlur","onUpdate:modelValue"],P={key:1,style:{"font-size":"14px"}},K={key:2,src:F,style:{"margin-left":"10px"},alt:""},Q={class:"buttonBox"},H={style:{display:"flex","align-items":"center",gap:"10px"}},W={class:"y-pop"},X=["onClick"],Y=["onClick"],Z={class:"t t1"},ee=["onClick"],le={key:1,class:"history"},te={key:2,class:"chatList"},ae=["onMouseenter","onClick"],ie={style:{display:"flex","align-items":"center"}},se=["onInput","onBlur","onUpdate:modelValue"],ne={key:1,style:{"font-size":"14px"}},oe={key:2,src:F,style:{"margin-left":"10px"},alt:""},ue={class:"buttonBox"},ce={style:{display:"flex","align-items":"center",gap:"10px"}},de={class:"y-pop"},ve=["onClick"],re=["onClick"],pe={class:"t t1"},ge=["onClick"],he={key:3,src:J,style:{margin:"120px auto 0"},alt:""},me=G(e({__name:"index",emits:["modelType"],setup(e,{expose:G,emit:F}){const J=l(),me=t(),ye=a().appContext.config.globalProperties,fe=i(!0);ye.$mitt.on("expand",(e=>{fe.value=!!e}));const ke=s(),be=n(),{isMobile:xe}=o(),we=u(),Ce=c(),Ie=d((()=>be.isLogin)),Se=i([]),Be=d((()=>be.userInfo));!Be.value||!Be.value.lifetimeVip||Be.value.lifetimeVip;const Le=i([]),Me=i([]),_e=i([]),Ve=i([]);var Te=!1;const Ee=F;i(null),d((()=>"dark"==Ce.theme?"#36373E":"rgba(142, 145, 166, 0.15)")),d((()=>"dark"==Ce.theme?"darkItem item":"item")),d((()=>"dark"==Ce.theme?"darkItemSelect itemSelect":"itemSelect !bg-[#3e6ae7] !border-transparent !text-white"));const Re=i(-1),De=i(-1);async function Ge(){await Ae();let e=localStorage.getItem("chatLogId"),l=JSON.parse(e);console.log(l,"locaData"),l?(Ne.value=l.id,Ue(l)):0!=Le.value.length?(Ne.value=Le.value[0].id,Ue(Le.value[0])):(Ne.value=Me.value[0].id,Ue(Me.value[0])),Se.value&&Se.value.length||Je()}async function Ae(){Se.value=[],Le.value=[],Me.value=[],await g({modelType:"chat"}).then((e=>{0!=e.data.length?function(e){let l=(new Date).getDate();l<10&&(l="0"+l);const{data:t}=e;Se.value=t,console.log(Se.value),t.forEach((e=>{if(e.title=e.title.slice(0,7),null!=e.lastTime){let t=e.lastTime.split(" ")[0].split("-")[2];l==t?Le.value=[...Le.value,e]:Me.value=[...Me.value,e]}if(null===e.lastTime){let t=e.createdAt.split(" ")[0].split("-")[2];l==t?Le.value=[...Le.value,e]:Me.value=[...Me.value,e]}}))}(e):Je()}))}v((()=>{var e;return null==(e=Be.value)?void 0:e.id}),(e=>{e&&Ge()})),r((async()=>{Ge()})),p.on("updateConversationList",(()=>{console.log("newValnewValnewValnewValnewVal"),Ae()}));const Fe=i(!1);async function Je(){"/chat"!=J.path&&me.push("/chat");try{if(!Ie.value)return void be.setLoginDialog(!0);Fe.value=!0,await we.updateChatTab("history"),await we.addNewChatGroup(),await we.queryMyGroup(),await Ae();let e=Se.value[0];Se.value.some((l=>{if(0==l.isSticky)return e=l,!0})),Ue(e),Fe.value=!1,xe.value&&Ce.setSiderCollapsed(!0)}catch(e){Fe.value=!1}}const Ne=i(),Oe=i();function Ue(e,l){let t;t=l?{groupId:e.uuid,logType:1}:{groupId:e.id,logType:1},p.emit("create",!1),p.emit("exploreApp",!1),p.emit("uuid",e),h(t).then((async t=>{console.log(e,"itemitemitem"),localStorage.setItem("chatLogId",JSON.stringify(e)),await we.setActiveGroup(e.id),Ne.value=l?e.uuid:e.id,Oe.value&&(Oe.value=null),Ee("modelType",e.config),p.emit("setModel",JSON.parse(e.config).modelInfo);let a=t.data.filter((e=>null!=e.conversationOptions));0==a.length?(p.emit("chatLogList",a),p.emit("haveLog",!1)):p.emit("chatLogList",t.data)}))}const qe=s();async function ze(e,l){if(0==Le.value.length&&1==Me.value.length||1==Le.value.length&&0==Me.value.length)qe.error("至少保留一个对话");else{if(await we.deleteGroup(e),await we.queryMyGroup(),0==l){if(Le.value=Le.value.filter((l=>l.id!=e.id)),e.id==Ne.value){if(0==Le.value.length)return void Ue(Me.value[0]);Ue(Le.value[0])}}else if(1==l&&(Me.value=Me.value.filter((l=>l.id!=e.id)),e.id==Ne.value)){if(0==Me.value.length)return void Ue(Le.value[0]);Ue(Me.value[0])}qe.success("删除成功")}}const $e=i(null);function je(e){e.inputIsShow=!0,setTimeout((()=>{$e.value[0].focus()}),100)}function Pe(e,l){e.inputIsShow=!1;let t={groupId:e.id,title:e.title};E(t).then((t=>{200===t.code&&(0==l?Le.value.forEach((l=>{l.id==e.id&&(l.title=e.title)})):1==l&&Me.value.forEach((l=>{l.id==e.id&&(l.title=e.title)})))}))}function Ke(e){7==e.title.length&&qe.warning("最大不能超过七个字")}G({hideRight:function(){document.getElementById("chatRight").style.width="0px"},showRight:function(){document.getElementById("chatRight").style.width="298px"}});let Qe=(e,l)=>{D({id:e.id,isSticky:l}).then((e=>{l?ke.success("置顶成功"):ke.success("取消置顶成功"),Ge()}))};return(e,l)=>{const t=m("EmptyBlo");return fe.value?(y(),f("div",N,[l[15]||(l[15]=k("div",{class:"topMenu"},null,-1)),k("div",O,[k("div",{class:"btn-line"},[k("div",{onClick:Je,class:"btn"},l[4]||(l[4]=[k("span",{class:"plus"},"+",-1),k("span",null,"新对话",-1)]))]),!b(Te)&&Le.value&&Le.value.length>0||b(Te)&&_e.value&&_e.value.length>0?(y(),f("div",U," 今天 ")):x("",!0),k("div",q,[Ie.value?(y(!0),f(w,{key:0},C(b(Te)?_e.value:Le.value,((e,t)=>(y(),f("div",{onMouseenter:e=>Re.value=t,onMouseleave:l[1]||(l[1]=e=>Re.value=-1),class:I(["itemBox bg-white dark:bg-[#f6f6f8]",Ne.value==e.id||Re.value==t?"cell active-cell":"cell unactive-cell"]),key:e.id,onClick:l=>{"/chat"!=b(J).path&&b(me).push("/chat"),Ue(e)}},[k("div",$,[l[5]||(l[5]=k("img",{src:A,style:{"margin-right":"10px"},alt:""},null,-1)),e.inputIsShow?S((y(),f("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:$e,onInput:l=>Ke(e),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:l=>Pe(e,0),onClick:l[0]||(l[0]=L((()=>{}),["stop"])),"onUpdate:modelValue":l=>e.title=l},null,40,j)),[[B,e.title]]):(y(),f("p",P,M(e.title),1)),1==e.isSticky?(y(),f("img",K)):x("",!0)]),k("div",Q,[k("div",H,[_(b(R),{style:{"border-radius":"8px",width:"126px"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:V((()=>l[6]||(l[6]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:V((()=>[k("div",W,[k("div",{class:"blo",onClick:L((l=>je(e)),["stop"])},l[7]||(l[7]=[k("div",{class:"edit"},null,-1),k("div",{class:"t t1"},"重命名",-1)]),8,X),k("div",{class:"blo",onClick:L((l=>b(Qe)(e,1==e.isSticky?0:1)),["stop"])},[l[8]||(l[8]=k("div",{class:"ding"},null,-1)),k("div",Z,M(1==e.isSticky?"取消置顶":"置顶"),1)],8,Y),k("div",{class:"blo",onClick:L((l=>ze(e,0)),["stop"])},l[9]||(l[9]=[k("div",{class:"dele"},null,-1),k("div",{class:"t t2"},"删除",-1)]),8,ee)])])),_:2},1024)])])],42,z)))),128)):0==_e.value.length&&0==Le.value.length?(y(),T(t,{key:1})):x("",!0)]),!b(Te)&&Me.value&&Me.value.length>0||b(Te)&&Ve.value&&Ve.value.length>0?(y(),f("div",le," 历史 ")):x("",!0),Ie.value?(y(),f("div",te,[(y(!0),f(w,null,C(b(Te)?Ve.value:Me.value,((e,t)=>(y(),f("div",{onMouseenter:e=>De.value=t,onMouseleave:l[3]||(l[3]=e=>De.value=-1),class:I(["itemBox bg-white dark:bg-[#f6f6f8]",Ne.value==e.id||De.value==t?"cell active-cell":"cell unactive-cell"]),key:e.id,onClick:l=>{"/chat"!=b(J).path&&b(me).push("/chat"),Ue(e)}},[k("div",ie,[l[10]||(l[10]=k("img",{src:A,style:{"margin-right":"10px"},alt:""},null,-1)),e.inputIsShow?S((y(),f("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:$e,onInput:l=>Ke(e),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:l=>Pe(e,1),onClick:l[2]||(l[2]=L((()=>{}),["stop"])),"onUpdate:modelValue":l=>e.title=l},null,40,se)),[[B,e.title]]):(y(),f("p",ne,M(e.title),1)),1==e.isSticky?(y(),f("img",oe)):x("",!0)]),k("div",ue,[k("div",ce,[_(b(R),{style:{"border-radius":"8px",width:"126px"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:V((()=>l[11]||(l[11]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:V((()=>[k("div",de,[k("div",{class:"blo",onClick:L((l=>je(e)),["stop"])},l[12]||(l[12]=[k("div",{class:"edit"},null,-1),k("div",{class:"t t1"},"重命名",-1)]),8,ve),k("div",{class:"blo",onClick:L((l=>b(Qe)(e,1==e.isSticky?0:1)),["stop"])},[l[13]||(l[13]=k("div",{class:"ding"},null,-1)),k("div",pe,M(1==e.isSticky?"取消置顶":"置顶"),1)],8,re),k("div",{class:"blo",onClick:L((l=>ze(e,1)),["stop"])},l[14]||(l[14]=[k("div",{class:"dele"},null,-1),k("div",{class:"t t2"},"删除",-1)]),8,ge)])])),_:2},1024)])])],42,ae)))),128))])):x("",!0),0==_e.value.length&&0==Le.value.length&&0==Ve.value.length&&0==Me.value.length?(y(),f("img",he)):x("",!0)])])):x("",!0)}}}),[["__scopeId","data-v-7fb8dfa5"]]);export{me as s};
