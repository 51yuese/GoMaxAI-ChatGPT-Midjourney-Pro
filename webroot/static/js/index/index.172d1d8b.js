import{e,ab as l,l as t,J as a,r as i,p as s,k as n,a5 as o,a9 as u,Z as c,g as d,L as v,q as r,I as p,b1 as g,aY as h,ag as m,w as y,x as f,B as k,y as b,A as x,F as w,E as C,a1 as I,P as S,$ as B,al as L,z as _,C as M,D as V,O as T,aN as E,ai as R,b2 as D,_ as G}from"../main-bf8e7d49.js";import{_ as N,a as O,b as A}from"../empty/empty.e8b55919.js";const F={key:0,class:"y-sidebar siderBarBox dark:bg-[#24252b] bg-[#F9F9FB]",id:"chatRight"},J={class:"chatBox"},U={key:0,class:"today"},q={class:"chatList"},z=["onMouseenter","onClick"],j={style:{display:"flex","align-items":"center"}},P=["onInput","onBlur","onUpdate:modelValue"],$={key:1,style:{"font-size":"14px"}},Y={key:2,src:O,style:{"margin-left":"10px"},alt:""},Z={class:"buttonBox"},H={style:{display:"flex","align-items":"center",gap:"10px"}},K={class:"y-pop"},Q=["onClick"],W=["onClick"],X={class:"t t1"},ee=["onClick"],le={key:1,class:"history"},te={key:2,class:"chatList"},ae=["onMouseenter","onClick"],ie={style:{display:"flex","align-items":"center"}},se=["onInput","onBlur","onUpdate:modelValue"],ne={key:1,style:{"font-size":"14px"}},oe={key:2,src:O,style:{"margin-left":"10px"},alt:""},ue={class:"buttonBox"},ce={style:{display:"flex","align-items":"center",gap:"10px"}},de={class:"y-pop"},ve=["onClick"],re=["onClick"],pe={class:"t t1"},ge=["onClick"],he={key:3,src:A,style:{margin:"120px auto 0"},alt:""},me=G(e({__name:"index",emits:["modelType"],setup(e,{expose:G,emit:O}){const A=l(),me=t(),ye=a().appContext.config.globalProperties,fe=i(!0);ye.$mitt.on("expand",(e=>{fe.value=!!e}));const ke=s(),be=n(),{isMobile:xe}=o(),we=u(),Ce=c(),Ie=d((()=>be.isLogin)),Se=i([]),Be=d((()=>be.userInfo));!Be.value||!Be.value.lifetimeVip||Be.value.lifetimeVip;const Le=i([]),_e=i([]),Me=i([]),Ve=i([]);var Te=!1;const Ee=O;i(null),d((()=>"dark"==Ce.theme?"#36373E":"rgba(142, 145, 166, 0.15)")),d((()=>"dark"==Ce.theme?"darkItem item":"item")),d((()=>"dark"==Ce.theme?"darkItemSelect itemSelect":"itemSelect !bg-[#3e6ae7] !border-transparent !text-white"));const Re=i(-1),De=i(-1);async function Ge(){await Ne();let e=localStorage.getItem("chatLogId"),l=JSON.parse(e);console.log(l,"locaData"),l?(Fe.value=l.id,Ue(l)):0!=Le.value.length?(Fe.value=Le.value[0].id,Ue(Le.value[0])):(Fe.value=_e.value[0].id,Ue(_e.value[0])),Se.value&&Se.value.length||Ae()}async function Ne(){Se.value=[],Le.value=[],_e.value=[],await g({modelType:"chat"}).then((e=>{0!=e.data.length?function(e){let l=(new Date).getDate();l<10&&(l="0"+l);const{data:t}=e;Se.value=t,console.log(Se.value),t.forEach((e=>{if(e.title=e.title.slice(0,7),null!=e.lastTime){let t=e.lastTime.split(" ")[0].split("-")[2];l==t?Le.value=[...Le.value,e]:_e.value=[..._e.value,e]}if(null===e.lastTime){let t=e.createdAt.split(" ")[0].split("-")[2];l==t?Le.value=[...Le.value,e]:_e.value=[..._e.value,e]}}))}(e):Ae()}))}v((()=>{var e;return null==(e=Be.value)?void 0:e.id}),(e=>{e&&Ge()})),r((async()=>{Ge()})),p.on("updateConversationList",(()=>{console.log("newValnewValnewValnewValnewVal"),Ne()}));const Oe=i(!1);async function Ae(){"/chat"!=A.path&&me.push("/chat");try{if(!Ie.value)return void be.setLoginDialog(!0);Oe.value=!0,await we.updateChatTab("history"),await we.addNewChatGroup(),await we.queryMyGroup(),await Ne();let e=Se.value[0];Se.value.some((l=>{if(0==l.isSticky)return e=l,!0})),Ue(e),Oe.value=!1,xe.value&&Ce.setSiderCollapsed(!0)}catch(e){Oe.value=!1}}const Fe=i(),Je=i();function Ue(e,l){let t;t=l?{groupId:e.uuid,logType:1}:{groupId:e.id,logType:1},p.emit("create",!1),p.emit("exploreApp",!1),p.emit("uuid",e),h(t).then((async t=>{console.log(e,"itemitemitem"),localStorage.setItem("chatLogId",JSON.stringify(e)),await we.setActiveGroup(e.id),Fe.value=l?e.uuid:e.id,Je.value&&(Je.value=null),Ee("modelType",e.config),p.emit("setModel",JSON.parse(e.config).modelInfo);let a=t.data.filter((e=>null!=e.conversationOptions));0==a.length?(p.emit("chatLogList",a),p.emit("haveLog",!1)):p.emit("chatLogList",t.data)}))}const qe=s();async function ze(e,l){if(0==Le.value.length&&1==_e.value.length||1==Le.value.length&&0==_e.value.length)qe.error("至少保留一个对话");else{if(await we.deleteGroup(e),await we.queryMyGroup(),0==l){if(Le.value=Le.value.filter((l=>l.id!=e.id)),e.id==Fe.value){if(0==Le.value.length)return void Ue(_e.value[0]);Ue(Le.value[0])}}else if(1==l&&(_e.value=_e.value.filter((l=>l.id!=e.id)),e.id==Fe.value)){if(0==_e.value.length)return void Ue(Le.value[0]);Ue(_e.value[0])}qe.success("删除成功")}}const je=i(null);function Pe(e){e.inputIsShow=!0,setTimeout((()=>{je.value[0].focus()}),100)}function $e(e,l){e.inputIsShow=!1;let t={groupId:e.id,title:e.title};E(t).then((t=>{200===t.code&&(0==l?Le.value.forEach((l=>{l.id==e.id&&(l.title=e.title)})):1==l&&_e.value.forEach((l=>{l.id==e.id&&(l.title=e.title)})))}))}function Ye(e){7==e.title.length&&qe.warning("最大不能超过七个字")}G({hideRight:function(){document.getElementById("chatRight").style.width="0px"},showRight:function(){document.getElementById("chatRight").style.width="298px"}});let Ze=(e,l)=>{D({id:e.id,isSticky:l}).then((e=>{l?ke.success("置顶成功"):ke.success("取消置顶成功"),Ge()}))};return(e,l)=>{const t=m("EmptyBlo");return fe.value?(y(),f("div",F,[l[15]||(l[15]=k("div",{class:"topMenu"},null,-1)),k("div",J,[k("div",{class:"btn-line"},[k("div",{onClick:Ae,class:"btn"},l[4]||(l[4]=[k("span",{class:"plus"},"+",-1),k("span",null,"新对话",-1)]))]),!b(Te)&&Le.value&&Le.value.length>0||b(Te)&&Me.value&&Me.value.length>0?(y(),f("div",U," 今天 ")):x("",!0),k("div",q,[Ie.value?(y(!0),f(w,{key:0},C(b(Te)?Me.value:Le.value,((e,t)=>(y(),f("div",{onMouseenter:e=>Re.value=t,onMouseleave:l[1]||(l[1]=e=>Re.value=-1),class:I(["itemBox bg-white dark:bg-[#f6f6f8]",Fe.value==e.id||Re.value==t?"cell active-cell":"cell unactive-cell"]),key:e.id,onClick:l=>{"/chat"!=b(A).path&&b(me).push("/chat"),Ue(e)}},[k("div",j,[l[5]||(l[5]=k("img",{src:N,style:{"margin-right":"10px"},alt:""},null,-1)),e.inputIsShow?S((y(),f("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:je,onInput:l=>Ye(e),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:l=>$e(e,0),onClick:l[0]||(l[0]=L((()=>{}),["stop"])),"onUpdate:modelValue":l=>e.title=l},null,40,P)),[[B,e.title]]):(y(),f("p",$,_(e.title),1)),1==e.isSticky?(y(),f("img",Y)):x("",!0)]),k("div",Z,[k("div",H,[M(b(R),{style:{"border-radius":"8px",width:"126px"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:V((()=>l[6]||(l[6]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:V((()=>[k("div",K,[k("div",{class:"blo",onClick:L((l=>Pe(e)),["stop"])},l[7]||(l[7]=[k("div",{class:"edit"},null,-1),k("div",{class:"t t1"},"重命名",-1)]),8,Q),k("div",{class:"blo",onClick:L((l=>b(Ze)(e,1==e.isSticky?0:1)),["stop"])},[l[8]||(l[8]=k("div",{class:"ding"},null,-1)),k("div",X,_(1==e.isSticky?"取消置顶":"置顶"),1)],8,W),k("div",{class:"blo",onClick:L((l=>ze(e,0)),["stop"])},l[9]||(l[9]=[k("div",{class:"dele"},null,-1),k("div",{class:"t t2"},"删除",-1)]),8,ee)])])),_:2},1024)])])],42,z)))),128)):0==Me.value.length&&0==Le.value.length?(y(),T(t,{key:1})):x("",!0)]),!b(Te)&&_e.value&&_e.value.length>0||b(Te)&&Ve.value&&Ve.value.length>0?(y(),f("div",le," 历史 ")):x("",!0),Ie.value?(y(),f("div",te,[(y(!0),f(w,null,C(b(Te)?Ve.value:_e.value,((e,t)=>(y(),f("div",{onMouseenter:e=>De.value=t,onMouseleave:l[3]||(l[3]=e=>De.value=-1),class:I(["itemBox bg-white dark:bg-[#f6f6f8]",Fe.value==e.id||De.value==t?"cell active-cell":"cell unactive-cell"]),key:e.id,onClick:l=>{"/chat"!=b(A).path&&b(me).push("/chat"),Ue(e)}},[k("div",ie,[l[10]||(l[10]=k("img",{src:N,style:{"margin-right":"10px"},alt:""},null,-1)),e.inputIsShow?S((y(),f("input",{key:0,ref_for:!0,ref_key:"inputRef",ref:je,onInput:l=>Ye(e),class:"bg-[#f2f2f5] dark:text-white text-black dark:bg-[#24252b]",type:"text",onBlur:l=>$e(e,1),onClick:l[2]||(l[2]=L((()=>{}),["stop"])),"onUpdate:modelValue":l=>e.title=l},null,40,se)),[[B,e.title]]):(y(),f("p",ne,_(e.title),1)),1==e.isSticky?(y(),f("img",oe)):x("",!0)]),k("div",ue,[k("div",ce,[M(b(R),{style:{"border-radius":"8px",width:"126px"},placement:"bottom-start",overlap:!1,trigger:"hover","show-arrow":!1},{trigger:V((()=>l[11]||(l[11]=[k("div",{class:"more-blo"},[k("div",{class:"more"})],-1)]))),default:V((()=>[k("div",de,[k("div",{class:"blo",onClick:L((l=>Pe(e)),["stop"])},l[12]||(l[12]=[k("div",{class:"edit"},null,-1),k("div",{class:"t t1"},"重命名",-1)]),8,ve),k("div",{class:"blo",onClick:L((l=>b(Ze)(e,1==e.isSticky?0:1)),["stop"])},[l[13]||(l[13]=k("div",{class:"ding"},null,-1)),k("div",pe,_(1==e.isSticky?"取消置顶":"置顶"),1)],8,re),k("div",{class:"blo",onClick:L((l=>ze(e,1)),["stop"])},l[14]||(l[14]=[k("div",{class:"dele"},null,-1),k("div",{class:"t t2"},"删除",-1)]),8,ge)])])),_:2},1024)])])],42,ae)))),128))])):x("",!0),0==Me.value.length&&0==Le.value.length&&0==Ve.value.length&&0==_e.value.length?(y(),f("img",he)):x("",!0)])])):x("",!0)}}}),[["__scopeId","data-v-59a16c23"]]);export{me as s};
