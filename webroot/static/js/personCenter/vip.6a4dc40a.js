import{e,p as a,bN as t,k as s,ar as l,g as i,ac as n,a6 as u,r,Z as o,L as c,q as v,dw as p,$ as d,ah as g,w as y,x as f,B as m,C as x,D as h,y as b,bB as k,z as w,Y as I,a4 as $,bs as T,A as C,aH as B,H as S,N as j,F as E,E as _,O as N,a7 as z,a8 as D,P as L,a2 as P,di as F,a1 as M,aD as W,e5 as J,am as R,ak as Y,c6 as A,e4 as U,Q as q,v as V,_ as H}from"../main-b114ff11.js";import{f as O,a as Q}from"../order/order.c965b9eb.js";import{Q as K}from"../index/index.0417341f.js";const X="/static/svg/dian-2d4ea44b.svg",Z="/static/svg/huo-dc38f8d3.svg",G="/static/svg/line-25bcb91a.svg",ee="/static/png/wxpay-2d8f84af.png",ae="/static/png/alipay-eab94eb8.png",te={class:"personCenterVip"},se={class:"topInfoBox"},le=["src"],ie={class:"userInfoBox"},ne={class:"nickName"},ue={key:0},re={key:0},oe={key:1},ce={class:"r"},ve={class:"d"},pe={class:"num"},de={class:"duihuan"},ge={class:"bigTitle"},ye={class:"introText"},fe={class:"tabsBar"},me={class:"itemBox"},xe=["onClick"],he={class:"typeName"},be={key:0,class:"tags"},ke={class:"priceBox"},we={class:"newPrice"},Ie={class:"oldPrice"},$e={key:0},Te={class:"jifen"},Ce={class:"neiBox"},Be={class:"neirongLi"},Se={class:"paydialog dark:bg-[#19191B] bg-[#fff]"},je={class:"title"},Ee={class:"payBigBox"},_e={class:"l"},Ne={class:"flex items-center justify-center relative"},ze=["src"],De=["src"],Le={class:"mb-10 mt-5 text-base"},Pe=["src"],Fe={class:"text-[#767676] dark:text-[#EEEEF0] text-[14px]",style:{"text-align":"center","margin-top":"10px"}},Me={class:"w-[60px] inline-block text-[#767676] dark:text-[#FF8D7C] text-left"},We={class:"r"},Je={class:"t"},Re={class:"span"},Ye={class:"sText"},Ae={class:"sText"},Ue={class:"JFpaydialog dark:bg-[#19191B] bg-[#fff]"},qe={class:"tBox"},Ve=["src"],He={class:"userInfoBox"},Oe={class:"nickName"},Qe={class:"text-[#767676] text-[14px]"},Ke={class:"jBox"},Xe={class:"bInfoBox"},Ze={class:"lineTitle"},Ge={class:"bBox"},ea={class:"l"},aa=["onClick"],ta={class:"jfHuo"},sa={style:{transform:"translateY(1px)"}},la={class:"text-[#767676] dark:text-[#6C6E79] text-[12px]"},ia={class:"r"},na={class:"flex items-center justify-center relative"},ua=["src"],ra=["src"],oa={class:"mb-10 mt-5 text-base"},ca=["src"],va={class:"text-[#767676] dark:text-[#EEEEF0] text-[14px]",style:{"text-align":"center","margin-top":"10px"}},pa={class:"w-[60px] inline-block text-[#767676] dark:text-[#FF8D7C] text-left"},da={class:"sText"},ga=H(e({__name:"vip",setup(e){const H=a(),ga=a(),ya=t(),fa=s(),ma=l(),xa=i((()=>fa.userInfo)),ha=n(),{isMobile:ba}=u();let ka=r(!1),wa=r(!1);const Ia=i((()=>fa.userInfo.vipLeavelId)),$a=i((()=>fa.vipLeavel)),Ta=i((()=>fa.userInfo));console.log("user",Ta.value);const Ca=r(!1);r(""),r("");const Ba=r("");o(),i((()=>fa.userInfo.avatar));const Sa=i((()=>1===fa.userInfo.lifetimeVip||fa.userInfo.vipExpire&&new Date(fa.userInfo.vipExpire)>new Date)),ja=i((()=>fa.isLogin));function Ea(e){const a=new FormData,t=e.file.type.split("/")[1];a.append("filename",e.file.id+"."+t),a.append("file",e.file.file),a.append("dir","user-avatar-upload"),A(a).then((async e=>{if(200!=e.code)return ga.error(e.data);Ba.value=e.data,await async function(e){const a=await U(e);if(200!=a.code)return ga.error(a.data);ga.success(a.data),await fa.getUserInfo(),Ca.value=!1}({avatar:e.data})}))}c(ja,(e=>{})),v((()=>{Ra(),p({type:1}).then((e=>{if(Ya.value=e.data.rows,1==ha.query.openJF){wa.value=!0;const e=new URL(window.location.origin+window.location.pathname);window.history.pushState({},"",e)}}))}));const _a=r(!0),Na=r(null),za=r("wxpay"),Da=r("0"),La=r({type:2});function Pa(){H.error(d("setting.payTimeOutText1")),Za.value&&clearInterval(Za.value)}const Fa=i((()=>{const{payEpayChannel:e,payMpayChannel:a}=fa.globalConfig;return"wechat"===Oa.value?["wxpay"]:"epay"===Oa.value?e?JSON.parse(e):[]:"mpay"===Oa.value?a?JSON.parse(a):[]:"hupi"===Oa.value?["wxpay"]:[]}));function Ma(e){Da.value=e}let Wa=r([{id:"0",name:d("setting.baoyue"),info:d("setting.meiyue"),type:"yue"},{id:"1",name:d("setting.baoji"),info:d("setting.meiji"),type:"ji"},{id:"2",name:d("setting.baoyear"),info:d("setting.meiyear"),type:"year"},{id:"3",name:d("setting.yongjiu"),info:d("setting.yongjiu"),type:"yongjiu"}]);const Ja=r([]),Ra=async()=>{var e;let a=(await p({type:null==(e=La.value)?void 0:e.type})).data.rows;a.forEach((e=>{e.decList=e.scope.split("/")}));let t={yue:[],ji:[],year:[],yongjiu:[]};a.forEach((e=>{switch(e.days){case 30:t.yue.push(e);break;case 90:t.ji.push(e);break;case 365:t.year.push(e);break;case-1:t.yongjiu.push(e)}})),Ja.value=t};let Ya=r([]);function Aa(){window.open(tt.value)}c(wa,(e=>{e&&(Va(Ya.value[0]),Ua.value=Ya.value[0].id)}));let Ua=r(null),qa=()=>{V({keys:["memberAgreement"]}).then((e=>{ya.info({title:d("setting.userCommit1"),content:e.data,positiveText:d("common.Iknow"),negativeText:d("common.cancel"),draggable:!0})}))};const Va=e=>{wa.value?Ua.value=e.id:ka.value=!0,Na.value=e,async function(e){Fa.value.length||ga.warning(d("setting.glyNoPay"));await async function(e){if(Ha.value&&"wechat"===Oa.value&&1===Number(fa.globalConfig.payWechatStatus)){if("undefined"==typeof WeixinJSBridge)document.addEventListener?document.addEventListener("WeixinJSBridgeReady",Qa,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",Qa),document.attachEvent("onWeixinJSBridgeReady",Qa));else{const a=await O({goodsId:e.id,payType:"jsapi"}),{success:t,data:s}=a;t&&Qa(s)}return}ma.updateOrderInfo({pkgInfo:e}),async function(){var e;await async function(){!it.value&&(et.value=!0),it.value&&(at.value=!0);let e=null;e=za.value,"wechat"===Oa.value&&(e=Ha.value?"jsapi":"native");try{const a=await O({goodsId:lt.value.pkgInfo.id,payType:e}),{data:t,success:s,message:l}=a;if(!s)return H.error(l);const{url_qrcode:i,orderId:n,redirectUrl:u}=t;tt.value=u,Xa.value=n,st.value=i,et.value=!1,at.value=!1}catch(a){et.value=!1,at.value=!1}}(),Za.value&&clearInterval(Za.value),null==(e=Ka.value)||e.reset(),Za.value=setInterval((()=>{Ga()}),1e3)}()}(e)}(e)};const Ha=i((()=>{var e;const a=window.navigator.userAgent.toLowerCase();return a.match(/MicroMessenger/i)&&"micromessenger"===(null==(e=null==a?void 0:a.match(/MicroMessenger/i))?void 0:e[0])})),Oa=i((()=>{const{payHupiStatus:e,payEpayStatus:a,payMpayStatus:t,payWechatStatus:s}=fa.globalConfig;return 1===Number(s)?"wechat":1===Number(t)?"mpay":1===Number(e)?"hupi":1===Number(a)?"epay":null}));function Qa(e){const{appId:a,timeStamp:t,nonceStr:s,package:l,signType:i,paySign:n}=e;a?WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a,timeStamp:t,nonceStr:s,package:l,signType:i,paySign:n},(e=>{"get_brand_wcpay_request:ok"===e.err_msg?(ga.success(d("setting.paySuccText1")),setTimeout((()=>{fa.getUserInfo(),ka.value=!1}),500)):ga.warning(d("setting.payErroText1"))})):ga.warning("appId不能为空")}const Ka=r(),Xa=r(""),Za=r();const Ga=async()=>{if(!Xa.value)return;const e=await Q({orderId:Xa.value}),{success:a,data:t}=e;if(a){const{status:e}=t;1===e&&(Za.value&&clearInterval(Za.value),H.success(d("setting.paySuccText1")),_a.value=!1,fa.getUserInfo(),setTimeout((()=>{ka.value=!1}),1500))}},et=r(!0),at=r(!0),tt=r(""),st=r(""),lt=i((()=>ma.orderInfo)),it=i((()=>{const{payEpayApiPayUrl:e}=fa.globalConfig;return"epay"===Oa.value&&e.includes("submit")||"mpay"===Oa.value}));const nt=e=>{e=Number(e);return Number.isInteger(e)||e.toString().endsWith(".0")&&!/\.0+$/.test(e.toString())?e.toLocaleString():e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})};return(e,a)=>{const t=g("NSkeleton");return y(),f("div",te,[m("div",se,[x(b(k),{accept:".jpg,.jpeg,.png",action:"","on-change":Ea,"default-upload":!1,"show-file-list":!0,style:{width:"50px","margin-right":"20px",cursor:"pointer",height:"50px"}},{default:h((()=>[m("img",{width:"50px",height:"50px",src:""==Ba.value?Ta.value.avatar:Ba.value,style:{"border-radius":"50%",width:"50px",height:"50px"}},null,8,le)])),_:1}),m("div",ie,[m("div",ne,w(b(fa).userInfo.nickname),1),m("div",{class:"timeInfo",style:{cursor:"pointer"},onClick:a[0]||(a[0]=e=>b(I).push("/personCenter/vip"))},[Sa.value?(y(),f("div",ue,[$(w(1==xa.value.lifetimeVip?e.$t("setting.yongjiu"):b(T)(xa.value.vipExpire,"YYYY-MM-DD")+e.$t("setting.daoqi"))+" ",1),Ia.value?(y(),f("span",re,w($a.value.filter((e=>e.id==Ia.value))[0].dictName),1)):C("",!0)])):(y(),f("div",oe,w(e.$t("setting.openVip2")),1))])]),a[10]||(a[10]=m("div",{style:{flex:"1"}},null,-1)),m("div",ce,[m("div",ve,[m("span",{onClick:a[1]||(a[1]=e=>B(wa)?wa.value=!0:wa=!0)},[$(w(e.$t("setting.points"))+" ",1),x(b(j),{size:"14",style:{transform:"translateY(-1px)"},color:"#767676"},{default:h((()=>[x(b(S))])),_:1})]),m("div",pe,w(xa.value.score),1)]),a[9]||(a[9]=m("div",{class:"shu"},null,-1)),m("div",{class:"d",onClick:a[2]||(a[2]=e=>b(fa).updateKamilDialog(!0))},[m("span",null,[$(w(e.$t("setting.duihuanma"))+" ",1),x(b(j),{size:"14",style:{transform:"translateY(-1px)"},color:"#767676"},{default:h((()=>[x(b(S))])),_:1})]),m("div",de,w(e.$t("setting.useDHM")),1)])])]),m("div",ge,w(e.$t("setting.payVipBtitle")),1),m("div",ye,[$(w(e.$t("setting.payVipBtitle"))+" ",1),m("span",{onClick:a[3]||(a[3]=e=>B(wa)?wa.value=!0:wa=!0)},w(e.$t("setting.payPoints")),1),a[11]||(a[11]=$(" | ")),m("span",{onClick:a[4]||(a[4]=e=>b(fa).updateKamilDialog(!0))},w(e.$t("setting.vipDuihuan")),1)]),m("div",fe,[x(b(D),{class:"card-tabs",type:"bar","default-value":Da.value,value:Da.value,animated:"","onUpdate:value":Ma},{default:h((()=>[(y(!0),f(E,null,_(b(Wa),(a=>(y(),N(b(z),{name:a.id,tab:a.name+e.$t("setting.jihua")},null,8,["name","tab"])))),256))])),_:1},8,["default-value","value"])]),m("div",me,[(y(!0),f(E,null,_(Ja.value[b(Wa)[Da.value].type],((t,s)=>L((y(),f("div",{class:"itemLi",onClick:e=>Va(t)},[m("div",he,w(t.name),1),t.tags?(y(),f("div",be,w(t.tags),1)):C("",!0),m("div",ke,[m("div",we,[$(w(nt(t.price)),1),m("span",null,w(e.$t("setting.yuan"))+"/"+w(b(Wa)[Da.value].info),1)]),m("div",Ie," ￥"+w(nt(t.originPrice)),1)]),m("div",{class:P(["typeBtn","active"+t.userType])},[$(w(e.$t("setting.dinyue")+t.userType?b(Wa)[Da.value].name:t.name),1),t.userType?(y(),f("span",$e,w($a.value.filter((e=>e.id==t.userType))[0].dictName),1)):C("",!0)],2),m("div",Te,w(t.des),1),a[13]||(a[13]=m("div",{class:"line"},null,-1)),m("div",Ce,[(y(!0),f(E,null,_(t.decList,(e=>(y(),f("div",Be,[a[12]||(a[12]=m("img",{src:"/static/svg/gou-eb4311a9.svg",alt:""},null,-1)),m("span",null,w(e),1)])))),256))])],8,xe)),[[q,s<4]]))),256))]),x(b(Y),{show:b(ka),"mask-closable":!0},{default:h((()=>{var s;return[m("div",Se,[m("div",{class:"absolute top-3 right-3 cursor-pointer z-30",onClick:a[5]||(a[5]=e=>B(ka)?ka.value=!1:ka=!1)},[x(b(j),{size:"26",color:"#333"},{default:h((()=>[x(b(F))])),_:1})]),m("div",je,w(e.$t("setting.dinyue")+Na.value.name)+"-"+w(b(Wa)[Da.value].name+e.$t("setting.jihua")),1),m("div",Ee,[m("div",_e,[m("div",Ne,[et.value&&!it.value?(y(),N(b(M),{key:0,size:"large",class:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2"})):C("",!0),et.value?(y(),N(t,{key:1,width:120,height:120,sharp:!1,size:"medium"})):C("",!0),"epay"!==Oa.value||et.value||at.value||it.value?C("",!0):(y(),N(K,{key:2,value:st.value,size:230},null,8,["value"])),"wxpay"!==za.value||et.value||it.value?C("",!0):(y(),f("img",{key:3,style:{position:"absolute",left:"50%",top:"50%"},src:b(ee),class:"absolute transform -translate-x-1/2 -translate-y-1/2 w-10 bg-[#fff]"},null,8,ze)),"alipay"!==za.value||et.value||it.value?C("",!0):(y(),f("img",{key:4,style:{position:"absolute",left:"50%",top:"50%"},src:b(ae),class:"absolute transform -translate-x-1/2 -translate-y-1/2 w-10 bg-[#fff]"},null,8,De)),"wechat"!==Oa.value||et.value?C("",!0):(y(),N(K,{key:5,value:st.value,size:230},null,8,["value"])),it.value?(y(),f("div",{key:6,class:P(["flex flex-col",[it.value&&b(ba)?"ml-0":"ml-20"]])},[m("span",Le,w(e.$t("setting.jumpPayText1")),1),it.value?(y(),N(b(W),{key:0,type:"primary",ghost:"",disabled:at.value,loading:at.value,onClick:Aa},{default:h((()=>[$(w(e.$t("setting.goPayText1")),1)])),_:1},8,["disabled","loading"])):C("",!0)],2)):C("",!0),"hupi"!==Oa.value||at.value?C("",!0):(y(),f("img",{key:7,src:st.value,class:"w-[230px] h-[230px] scale-90",frameborder:"0"},null,8,Pe))]),m("div",Fe,[m("span",Me,[x(b(J),{ref_key:"countdownRef",ref:Ka,active:_a.value,duration:3e5,"on-finish":Pa},null,8,["active"])]),$(" "+w(e.$t("setting.houQRed")),1)])]),m("div",We,[m("div",Je,[a[14]||(a[14]=m("img",{src:"/static/svg/weixin-20fc5f05.svg",alt:""},null,-1)),m("div",Re,[$(w(e.$t("setting.WXpayText1"))+"：￥",1),m("span",null,w(nt(null==(s=lt.value.pkgInfo)?void 0:s.price)),1),$(w(e.$t("setting.yuan")),1)])]),m("div",Ye,[a[15]||(a[15]=m("img",{src:X,alt:""},null,-1)),m("span",null,w(e.$t("setting.nopayText1")),1)]),m("div",Ae,[a[16]||(a[16]=m("img",{src:X,alt:""},null,-1)),m("span",null,[$(w(e.$t("setting.payagreeText1")),1),m("span",{style:{color:"#726AFB",cursor:"pointer"},onClick:a[6]||(a[6]=R((e=>b(qa)()),["stop"]))},w(e.$t("setting.vipServiceAgree")),1)])])])])])]})),_:1},8,["show"]),x(b(Y),{show:b(wa),"mask-closable":!0},{default:h((()=>[m("div",Ue,[m("div",{class:"absolute top-8 right-3 cursor-pointer z-30",onClick:a[7]||(a[7]=e=>B(wa)?wa.value=!1:wa=!1)},[x(b(j),{size:"26",color:"#333"},{default:h((()=>[x(b(F))])),_:1})]),m("div",qe,[m("img",{width:"50px",height:"50px",src:""==Ba.value?Ta.value.avatar:Ba.value,style:{"border-radius":"50%",width:"50px",height:"50px"}},null,8,Ve),m("div",He,[m("div",Oe,w(b(fa).userInfo.nickname),1)]),m("div",Qe,w(e.$t("setting.myPoints")),1),m("div",Ke,[a[17]||(a[17]=m("img",{src:Z,alt:""},null,-1)),m("span",null,w(xa.value.score),1)]),a[18]||(a[18]=m("div",{class:"shu"},null,-1))]),m("div",Xe,[m("div",Ze,[a[19]||(a[19]=m("img",{src:G,alt:""},null,-1)),m("span",null,w(e.$t("setting.pointsPay")),1),a[20]||(a[20]=m("img",{src:G,alt:"",style:{transform:"rotate(180deg)"}},null,-1))]),m("div",Ge,[m("div",ea,[(y(!0),f(E,null,_(b(Ya),(t=>(y(),f("div",{class:P(["lItem",b(Ua)==t.id?"active":""]),onClick:e=>Va(t)},[m("div",ta,[a[21]||(a[21]=m("img",{style:{transform:"translateY(-1px)"},src:Z,alt:""},null,-1)),m("span",sa,w(t.score),1)]),m("div",la," ￥"+w((null===t.price?t.originPrice:t.price)+e.$t("setting.yuan")),1)],10,aa)))),256)),m("span",null,w(e.$t("setting.payTips1")),1)]),a[22]||(a[22]=m("img",{src:"/static/svg/shuLine-f65932cb.svg",alt:""},null,-1)),m("div",ia,[m("div",na,[et.value&&!it.value?(y(),N(b(M),{key:0,size:"large",class:"absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2"})):C("",!0),et.value?(y(),N(t,{key:1,width:120,height:120,sharp:!1,size:"medium"})):C("",!0),"epay"!==Oa.value||et.value||at.value||it.value?C("",!0):(y(),N(K,{key:2,value:st.value,size:150},null,8,["value"])),"wxpay"!==za.value||et.value||it.value?C("",!0):(y(),f("img",{key:3,style:{position:"absolute",left:"50%",top:"50%"},src:b(ee),class:"absolute transform -translate-x-1/2 -translate-y-1/2 w-10 bg-[#fff]"},null,8,ua)),"alipay"!==za.value||et.value||it.value?C("",!0):(y(),f("img",{key:4,style:{position:"absolute",left:"50%",top:"50%"},src:b(ae),class:"absolute transform -translate-x-1/2 -translate-y-1/2 w-10 bg-[#fff]"},null,8,ra)),"wechat"!==Oa.value||et.value?C("",!0):(y(),N(K,{key:5,value:st.value,size:150},null,8,["value"])),it.value?(y(),f("div",{key:6,class:P(["flex flex-col",[it.value&&b(ba)?"ml-0":"ml-20"]])},[m("span",oa,w(e.$t("setting.jumpPayText1")),1),it.value?(y(),N(b(W),{key:0,type:"primary",ghost:"",disabled:at.value,loading:at.value,onClick:Aa},{default:h((()=>[$(w(e.$t("setting.goPayText1")),1)])),_:1},8,["disabled","loading"])):C("",!0)],2)):C("",!0),"hupi"!==Oa.value||at.value?C("",!0):(y(),f("img",{key:7,src:st.value,class:"w-[150px] h-[150px] scale-90",frameborder:"0"},null,8,ca))]),m("div",va,[m("span",pa,[x(b(J),{ref_key:"countdownRef",ref:Ka,active:_a.value,duration:3e5,"on-finish":Pa},null,8,["active"])]),$(" "+w(e.$t("setting.houQRed")),1)]),m("div",da,[m("span",null,[$(w(e.$t("setting.payagreeText1")),1),m("span",{style:{color:"#726AFB",cursor:"pointer"},onClick:a[8]||(a[8]=R((e=>b(qa)()),["stop"]))},w(e.$t("setting.vipServiceAgree")),1)])])])])])])])),_:1},8,["show"])])}}}),[["__scopeId","data-v-13c73d39"]]);export{ga as default};
