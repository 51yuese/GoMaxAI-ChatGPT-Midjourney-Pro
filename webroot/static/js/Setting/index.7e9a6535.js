import{e,Z as a,k as s,a6 as l,p as t,g as n,r as i,w as c,x as o,B as r,z as u,C as p,y as d,aJ as m,D as f,a4 as v,aD as x,a2 as g,a3 as h,F as y,E as k,aI as w,e4 as b,$ as _,q as $,O as C,a1 as I,a8 as S,a7 as U,ak as z}from"../main-b114ff11.js";import{N as T}from"../Popconfirm/Popconfirm.5446b9cc.js";const L={class:"p-4 space-y-5 min-h-[200px]"},N={class:"space-y-6"},O={class:"flex items-center space-x-4"},J={class:"flex-shrink-0 w-[100px]"},j={class:"flex-1"},B={class:"flex items-center space-x-4"},D={class:"flex-shrink-0 w-[100px]"},F={class:"w-[200px]"},E={class:"flex-shrink-0 w-[100px]"},P={class:"flex flex-wrap items-center gap-4"},G={class:"flex items-center space-x-4"},M={class:"flex-shrink-0 w-[100px]"},R={class:"flex flex-wrap items-center gap-4"},A={class:"flex items-center space-x-4"},H={class:"flex-shrink-0 w-[100px]"},W={class:"flex flex-wrap items-center gap-4"},q=e({__name:"General",setup(e){const $=a(),C=s(),{isMobile:I}=l(),S=t(),U=n((()=>$.theme)),z=n((()=>C.userInfo)),q=i(z.value.avatar??""),V=i(z.value.username??""),Y=i(!1),Z=n({get:()=>$.language,set(e){$.setLanguage(e)}}),K=[{label:"Auto",key:"auto",icon:"ri:contrast-line"},{label:"Light",key:"light",icon:"ri:sun-foggy-line"},{label:"Dark",key:"dark",icon:"ri:moon-foggy-line"}],Q=[{label:"简体中文",key:"zh-CN",value:"zh-CN"},{label:"繁體中文",key:"zh-TW",value:"zh-TW"},{label:"English",key:"en-US",value:"en-US"}];async function X(e){try{Y.value=!0;const a=await b(e);if(Y.value=!1,!a.success)return S.error(a.message);S.success(_("common.updateUserSuccess")),C.getUserInfo()}catch(a){Y.value=!1}}function ee(){const e=function(){const e=new Date,a=e.getDate(),s=e.getMonth()+1;return`${e.getFullYear()}-${s}-${a}`}(),a=localStorage.getItem("chatStorage")||"{}",s=JSON.stringify(JSON.parse(a),null,2),l=new Blob([s],{type:"application/json"}),t=URL.createObjectURL(l),n=document.createElement("a");n.href=t,n.download=`chat-store_${e}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}function ae(e){const a=e.target;if(!a||!a.files)return;const s=a.files[0];if(!s)return;const l=new FileReader;l.onload=()=>{try{const e=JSON.parse(l.result);localStorage.setItem("chatStorage",JSON.stringify(e)),S.success(_("common.success")),location.reload()}catch(e){S.error(_("common.invalidFileFormat"))}},l.readAsText(s)}function se(){localStorage.removeItem("chatStorage"),location.reload()}function le(){const e=document.getElementById("fileInput");e&&e.click()}return(e,a)=>(c(),o("div",L,[r("div",N,[r("div",O,[r("span",J,u(e.$t("setting.avatarLink")),1),r("div",j,[p(d(m),{value:q.value,"onUpdate:value":a[0]||(a[0]=e=>q.value=e),placeholder:"请填写头像地址"},null,8,["value"])]),p(d(x),{size:"tiny",disabled:Y.value,text:"",type:"primary",onClick:a[1]||(a[1]=e=>X({avatar:q.value}))},{default:f((()=>[v(u(e.$t("common.update")),1)])),_:1},8,["disabled"])]),r("div",B,[r("span",D,u(e.$t("setting.name")),1),r("div",F,[p(d(m),{value:V.value,"onUpdate:value":a[2]||(a[2]=e=>V.value=e),placeholder:"请填写用户名"},null,8,["value"])]),p(d(x),{size:"tiny",disabled:Y.value,text:"",type:"primary",onClick:a[3]||(a[3]=e=>X({username:V.value}))},{default:f((()=>[v(u(e.$t("common.update")),1)])),_:1},8,["disabled"])]),r("div",{class:g(["flex items-center space-x-4",d(I)&&"items-start"])},[r("span",E,u(e.$t("setting.chatHistory")),1),r("div",P,[p(d(x),{size:"small",onClick:ee},{icon:f((()=>[p(d(h),{icon:"ri:download-2-fill"})])),default:f((()=>[v(" "+u(e.$t("common.export")),1)])),_:1}),r("input",{id:"fileInput",type:"file",style:{display:"none"},onChange:ae},null,32),p(d(x),{size:"small",onClick:le},{icon:f((()=>[p(d(h),{icon:"ri:upload-2-fill"})])),default:f((()=>[v(" "+u(e.$t("common.import")),1)])),_:1}),p(d(T),{placement:"bottom",onPositiveClick:se},{trigger:f((()=>[p(d(x),{size:"small"},{icon:f((()=>[p(d(h),{icon:"ri:close-circle-line"})])),default:f((()=>[v(" "+u(e.$t("common.clear")),1)])),_:1})])),default:f((()=>[v(" "+u(e.$t("chat.clearHistoryConfirm")),1)])),_:1})])],2),r("div",G,[r("span",M,u(e.$t("setting.theme")),1),r("div",R,[(c(),o(y,null,k(K,(e=>p(d(x),{key:e.key,size:"small",type:e.key===U.value?"primary":void 0,onClick:a=>d($).setTheme(e.key)},{icon:f((()=>[p(d(h),{icon:e.icon},null,8,["icon"])])),_:2},1032,["type","onClick"]))),64))])]),r("div",A,[r("span",H,u(e.$t("setting.language")),1),r("div",W,[p(d(w),{style:{width:"140px"},value:Z.value,options:Q,onUpdateValue:a[4]||(a[4]=e=>d($).setLanguage(e))},null,8,["value"])])])])]))}}),V={class:"p-4 space-y-5 min-h-[200px]"},Y={class:"flex items-center space-x-4"},Z={class:"w-[200px]"},K={class:"flex items-center space-x-4"},Q={class:"w-[200px]"},X={class:"flex items-center space-x-4"},ee={class:"w-[200px]"},ae={class:"flex items-center space-x-4"},se={class:"w-[200px]"},le={class:"flex items-center space-x-4"},te={class:"w-[200px]"},ne={class:"flex items-center space-x-4"},ie={class:"w-[200px]"},ce=e({__name:"Personal",setup(e){const a=s(),{userInfo:l,userBalance:t}=a,n=i(!1);return $((async()=>{!async function(){try{n.value=!0,await a.getUserInfo(),n.value=!1}catch(e){n.value=!1}}()})),(e,a)=>(c(),C(d(I),{show:n.value},{default:f((()=>[r("div",V,[r("div",Y,[a[0]||(a[0]=r("span",{class:"flex-shrink-0 w-[100px]"},"用户邮箱",-1)),r("div",Z,u(d(l).email||"--"),1)]),r("div",K,[a[1]||(a[1]=r("span",{class:"flex-shrink-0 w-[100px]"},"用户姓名",-1)),r("div",Q,u(d(l).username||"--"),1)]),r("div",X,[a[2]||(a[2]=r("span",{class:"flex-shrink-0 w-[100px]"},"问答余额",-1)),r("div",ee,u(d(t).usesLeft||"0")+" 积分 ",1)]),r("div",ae,[a[3]||(a[3]=r("span",{class:"flex-shrink-0 w-[100px]"},"绘画余额",-1)),r("div",se,u(d(t).paintCount||"0")+" 积分 ",1)]),r("div",le,[a[4]||(a[4]=r("span",{class:"flex-shrink-0 w-[100px]"},"MJToken",-1)),r("div",te,u(d(t).balance||"0")+" Token ",1)]),r("div",ne,[a[5]||(a[5]=r("span",{class:"flex-shrink-0 w-[100px]"},"使用金额",-1)),r("div",ie,u(d(t).useTokens||"0")+" Token ",1)])])])),_:1},8,["show"]))}}),oe={class:"ml-2"},re={class:"ml-2"},ue={class:"min-h-[100px]"},pe=e({__name:"index",props:{visible:{type:Boolean}},emits:["update:visible"],setup(e,{emit:a}){const s=e,l=a,t=i("personalInfo"),o=n({get:()=>s.visible,set(e){l("update:visible",e)}});return(e,a)=>(c(),C(d(z),{show:o.value,"onUpdate:show":a[1]||(a[1]=e=>o.value=e),title:"个人中心","auto-focus":!1,preset:"card",style:{width:"95%","max-width":"640px"}},{default:f((()=>[r("div",null,[p(d(S),{value:t.value,"onUpdate:value":a[0]||(a[0]=e=>t.value=e),type:"line",animated:""},{default:f((()=>[p(d(U),{name:"personalInfo",tab:"personalInfo"},{tab:f((()=>[p(d(h),{class:"text-lg",icon:"ri:file-user-line"}),r("span",oe,u(e.$t("setting.personalInfo")),1)])),default:f((()=>[p(ce)])),_:1}),p(d(U),{name:"General",tab:"General"},{tab:f((()=>[p(d(h),{class:"text-lg",icon:"ri:list-settings-line"}),r("span",re,u(e.$t("setting.general")),1)])),default:f((()=>[r("div",ue,[p(q)])])),_:1})])),_:1},8,["value"])])])),_:1},8,["show"]))}});export{pe as default};
