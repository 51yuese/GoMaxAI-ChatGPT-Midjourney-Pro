import{_ as e}from"../error/error.01789b3e.js";import{_ as l,a as t,b as a,c as i,d as s,e as r}from"../light_del_music/light_del_music.529f66c9.js";import{_ as n,a as o,b as c,c as u,d,e as v}from"../light_music_author/light_music_author.620a5e30.js";import{_ as p,a as m,b as g,c as x,d as y}from"../end/end.da3716db.js";import{e as f,r as h,k,g as b,p as E,a9 as w,a5 as C,$ as F,q as I,aa as T,w as _,x as j,z as A,A as B,I as z,F as L,E as R,P as V,D,y as U,B as M,C as O,a3 as S,ac as H,ad as q,a2 as P,a1 as Z,ab as $,a4 as G,_ as J}from"../main-23bab8dd.js";import{f as K,h as N,g as Q,p as W,i as X,j as Y}from"./music.67ae0f67.js";import{C as ee}from"../index1/index1.2e853d1a.js";import"../police/police.deef576c.js";const le={class:"bg-[#2B2D31] dark:bg-[#2B2D31] musicBody"},te={class:"createCenterBox"},ae={class:"createInfo"},ie=["onClick","src"],se={key:3,style:{width:"100px",height:"100px"},src:e,alt:""},re={class:"itemInfo"},ne={class:"info",style:{flex:"1","margin-right":"10px"}},oe={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ce={style:{display:"flex","align-items":"center"}},ue={class:"text-[17px] dark:text-[#9A9EB5] text-[#1E1F1F]",style:{"font-weight":"550"}},de={class:"model"},ve={class:"operation"},pe=["onClick"],me={key:0,class:"operationBox bg-[#fff] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},ge=["onClick"],xe={key:0,src:l,style:{"margin-right":"5px"}},ye={key:1,src:t,style:{"margin-right":"5px"}},fe=["onClick"],he={key:0,src:a,style:{"margin-right":"5px"}},ke={key:1,src:i,style:{"margin-right":"5px"}},be=["onClick"],Ee={key:0,src:s,style:{"margin-right":"5px"}},we={key:1,src:r,style:{"margin-right":"5px"}},Ce={style:{display:"flex","align-items":"center",margin:"12px 0"}},Fe={key:0,src:d,style:{"margin-right":"4px"}},Ie={key:1,src:v,style:{"margin-right":"4px"}},Te={class:"text-[12px] text-[#8B8C8C] dark:text-[#595C6E]",style:{width:"90%",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden"}},_e={style:{width:"108px",height:"108px","border-radius":"8px",position:"relative",display:"flex","justify-content":"center","align-items":"center"}},je={class:"itemInfo"},Ae={class:"info",style:{width:"100%"}},Be={style:{width:"100%",display:"flex","align-items":"center","justify-content":"space-between"}},ze={style:{display:"flex","align-items":"center"}},Le={class:"text-[17px] dark:text-[#EEEEF0] text-[#1E1F1F]",style:{"font-weight":"550"}},Re={class:"text-[12px] text-[#1E1F1F] dark:text-[#EEEEF0] bg-[#F0F0F0] dark:bg-[#222325]",style:{padding:"1px 6px","border-radius":"6px","margin-left":"12px"}},Ve={style:{display:"flex","align-items":"center"}},De={style:{display:"flex","align-items":"center",margin:"12px 0"}},Ue={key:0,src:d,style:{"margin-right":"4px"}},Me={key:1,src:v,style:{"margin-right":"4px"}},Oe={class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]",style:{"word-break":"keep-all","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Se={key:0,class:"mainRight"},He={style:{width:"100%"}},qe=["src"],Pe={class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[17px]",style:{"margin-top":"12px","font-weight":"550"}},Ze={style:{display:"flex","align-items":"center",margin:"12px 0"}},$e={key:0,src:d,style:{"margin-right":"4px"}},Ge={key:1,src:v,style:{"margin-right":"4px"}},Je={class:"introList"},Ke={class:""},Ne={style:{position:"absolute",width:"100%",bottom:"0","z-index":"1"}},Qe={key:0,class:"control dark:bg-[#303137] bg-[#FFF] text-[#8B8C8C] dark:text-[#6C6E79] border-[#E8E8E8] dark:border-[#292A2E]"},We={style:{display:"flex","align-items":"center"}},Xe={style:{display:"flex","align-items":"center",gap:"5px","margin-right":"20px"}},Ye=["src"],el={class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[14px]"},ll={style:{color:"#727586","font-size":"12px","margin-top":"10px",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"1",overflow:"hidden","text-overflow":"ellipsis",width:"180px"}},tl={style:{display:"flex","align-items":"center",flex:"1","padding-right":"20px","margin-left":"20px"}},al={style:{width:"100%"}},il={style:{"margin-top":"4px",display:"flex","align-items":"center",gap:"10px"}},sl=["src"],rl=J(f({__name:"myCenter",setup(e){const l=h(null),t=k();b((()=>t.isLogin));const a=h([]);let i=null;const s=E();w(),C(),h(!0),h(!1);const r=h(1),d=h(0),v=F(),f=b((()=>"dark"===v.theme)),J=h([{name:"V3（一次生成两首歌）",value:"chirp-v3-0",title:"V3"},{name:"V3.5（一次生成两首歌）",value:"chirp-v3-5",title:"V3.5"}]);h("").value=J.value[0].name;const rl=h(!1),nl=h([]),ol=h([]),cl=h(!1),ul=h(1),dl=h("00:00"),vl=h("00:00"),pl=h(""),ml=h(""),gl=h(0);function xl(){N({size:20,page:r.value,modelType:"music",modelSubType:"create",order:"createAt"}).then((e=>{const{records:l}=e.data;0!=l.length&&l.forEach((e=>{if(""==e.answer&&null==e.errMsg&&0==e.children.length){let l={intro:""},i={intro:""};l.id=e.id,i.id=e.id;e.prompt.split(",").forEach((e=>{let t=e.split(" ");if(""==t[0]&&t.shift(),"prompt"==t[0])for(var a=1;a<=t.length-1;a++)l.intro=l.intro+t[a],i.intro=l.intro+t[a];"mv"==t[0]&&(l.modetitle=t[1],i.modetitle=t[1]),"title"==t[0]&&(l.name=t[1],i.name=t[1])})),nl.value.push(l),nl.value.push(i),setTimeout((()=>zl()),300),a.value.push(e.id),1==a.value.length&&function(e,l,i){try{var r=setInterval((()=>{if(0==a.value.length)return yl.value=!0,void clearTimeout(r);Q({ids:a.value.join()}).then((e=>{e.data.forEach((e=>{if(console.log(nl.value),null!=e.errMsg){t.getUserInfo(),a.value.splice(a.value.indexOf(e.id),1),s.error(e.errMsg);for(var r=0;r<=nl.value.length-1;r++)e.id==nl.value[r].id&&nl.value.splice(r,2);ol.value.push(l),ol.value.push(i)}else if(null!=e.answer&&0!=e.children.length){a.value.splice(a.value.indexOf(e.id),1),t.getUserInfo();for(r=0;r<=nl.value.length-1;r++)e.id==nl.value[r].id&&(console.log(nl.value[r]),nl.value.splice(r,2));e.children.forEach((l=>{l.model=e.model,ol.value.push(l)})),W({ids:[e.children[0].id,e.children[1].id]})}}))}))}),3e3)}catch(n){s.error(n.message),console.log(n);const[e,l]=H("Request failed");nl.value=[],e.modetitle=hl.value,l.modetitle=hl.value,ol.value=[...ol.value,e,l],yl.value=!0,function(e){let l;Al.value=0,Bl.value=0,1==e?l=setInterval((()=>{Al.value+=10,Bl.value=Al.value/100*200,Al.value>=99&&(clearTimeout(l),Al.value=99,Bl.value=Al.value/100*200)}),5e3):clearTimeout(l)}(!1)}}(0,l,i)}else 0!=e.children.length&&e.children.forEach((l=>{l.model=e.model,ol.value.unshift(l)}))}))}))}K({modelType:"music"}).then((e=>{})),h(""),h(0),h(""),h("chirp-v3"),h("");const yl=h(!0);h(),h();const fl=h(null);I((()=>{!async function(){var e;try{const l=await T({modelType:"music",page:1,size:10}),t=(l.data||{}).rows||[];d.value=(null==(e=t[0])?void 0:e.deduct)||0}catch(l){s.error(l.message)}}(),xl(),setTimeout((()=>zl()),300)}));const hl=h("V3");const kl=h(),bl=h(0),El=h(!1);function wl(e,l){if(kl.value&&kl.value.id==e.id)return void Cl();kl.value={...e},kl.value.introList=e.intro.split("\n"),bl.value=l;const t=setTimeout((()=>{El.value=!1,Cl(),clearTimeout(t)}))}function Cl(){const e=fl.value;El.value?(El.value=!1,e.pause()):(El.value=!0,e.play())}function Fl(){bl.value-1<0?(bl.value=ol.value.length-1,kl.value=ol.value[bl.value]):(bl.value=bl.value-1,kl.value=ol.value[bl.value]);const e=setTimeout((()=>{El.value=!1,Cl(),clearTimeout(e)}))}function Il(){bl.value+1>ol.value.length-1?(bl.value=0,kl.value=ol.value[bl.value]):(bl.value=bl.value+1,kl.value=ol.value[bl.value]);const e=setTimeout((()=>{El.value=!1,Cl(),clearTimeout(e)}))}function Tl(){kl.value&&(kl.value.operation=!1),rl.value=!1,cl.value=!1,ol.value.forEach((e=>{e.operation=!1}))}function _l(){i&&(i.destroy(),i=null)}function jl(e,l){let t="/api";if(i||(i=s.loading("下载中，请稍等",{duration:0})),"mp4"==l){let l=e.mp4.split("/").pop();Tl(),q.get(t+"/file/down",{responseType:"blob",params:{url:e.mp4}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),_l(),s.success("下载成功")})).catch((e=>{s.error("下载失败"),_l()}))}else if("mp3"==l){let l=e.mp3.split("/").pop();Tl(),q.get(t+"/file/down",{responseType:"blob",params:{url:e.mp3}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),_l(),s.success("下载成功")})).catch((e=>{s.error("下载失败"),_l()}))}}const Al=h(0),Bl=h(0);function zl(){let e=l.value;e.scrollTo({top:e.scrollHeight+7e3,behavior:"smooth"})}function Ll(){pl.value=fl.value.duration,ml.value=fl.value.currentTime,vl.value=Vl(parseInt(fl.value.currentTime)),dl.value=Vl(parseInt(fl.value.duration))}function Rl(e){vl.value=Vl(parseInt(e.target.currentTime)),ml.value=e.target.currentTime,function(){let e=ml.value/pl.value*100;gl.value=e}();const l=fl.value;ml.value>=pl.value&&(El.value=!1,l.pause(),ml.value=0,gl.value=0,vl.value="00:00")}function Vl(e){let l=parseInt(e/60),t=parseInt(e%60);return l=l>=10?l:"0"+l,t=t>=10?t:"0"+t,l+":"+t}function Dl(){fl.value.pause()}function Ul(){fl.value.currentTime=ml.value,fl.value.play()}return(e,t)=>(_(),j("div",le,[rl.value||cl.value?(_(),j("div",{key:0,class:"mask",onClick:Tl})):A("",!0),B("div",te,[B("div",{class:z(["createCenterMain",{hasMusic:kl.value}])},[B("div",ae,[B("div",{class:"mainLeft",ref_key:"createCenterRef",ref:l,onScroll:t[0]||(t[0]=e=>{var l;(l=e).target.scrollTop+l.target.clientHeight==l.target.scrollHeight&&(r.value+=1,xl())})},[(_(!0),j(L,null,R(ol.value,((e,l)=>(_(),j("div",{class:"mainItem dark:bg-[#2b2d31] bg-[#2b2d31]",key:l},[kl.value&&kl.value.id!=e.id||!El.value?(_(),V(D(P),{key:0,onClick:t=>wl(e,l),style:{"font-size":"30px"},icon:"gridicons:play",class:"playImg"},null,8,["onClick"])):(_(),V(D(P),{key:1,onClick:Cl,style:{"font-size":"30px"},icon:"gridicons:pause",class:"playImg"})),e.cover?(_(),j("img",{key:2,onClick:t=>wl(e,l),style:{width:"100px",height:"100px","max-width":"108px"},src:e.cover,alt:""},null,8,ie)):A("",!0),e.cover?A("",!0):(_(),j("img",se)),B("div",re,[B("div",ne,[B("div",oe,[B("div",ce,[B("div",ue,U(" "==e.title||null==e.title?"匿名":e.title),1),B("div",de,U(e.model.indexOf("v4")>-1?"V4":e.model.indexOf("v3-5")>-1?"V3.5":"V3.0"),1)]),B("div",ve,[B("div",{class:z(["collect",{collected:e.agree}]),onClick:l=>function(e){console.log(e);let l={relateId:e.id,action:"agree",relateType:"music"};0!=ul.value&&(ul.value=0,Y(l).then((l=>{null!=e.agree?ol.value.forEach((l=>{l.id==e.id&&(l.agree=null)})):ol.value.forEach((l=>{l.id==e.id&&(l.agree="agree")})),ul.value=1})))}(e)},null,10,pe),M(D(P),{icon:"ri:more-line",class:"icon text-xl text-center",onClick:l=>function(e,l){3==l&&(e.operation=!0,cl.value=!0)}(e,3)},null,8,["onClick"]),e.operation?(_(),j("div",me,[B("div",{class:"operationItem",onClick:l=>jl(e,"mp4"),style:{display:"flex"}},[f.value?(_(),j("img",xe)):(_(),j("img",ye)),t[11]||(t[11]=B("div",null,"下载视频",-1))],8,ge),B("div",{class:"operationItem",onClick:l=>jl(e,"mp3"),style:{display:"flex"}},[f.value?(_(),j("img",he)):(_(),j("img",ke)),t[12]||(t[12]=B("div",null,"下载音频",-1))],8,fe),B("div",{class:"operationItem",style:{display:"flex",color:"#ff5e55"},onClick:t=>async function(e,l){try{await X({ids:[e]}),s.success("创作记录删除成功"),r.value=1,ol.value.splice(l,1)}catch(t){s.error(t.message)}}(e.id,l)},[f.value?(_(),j("img",Ee)):(_(),j("img",we)),t[13]||(t[13]=B("div",null,"删除",-1))],8,be)])):A("",!0)])]),B("div",Ce,[f.value?(_(),j("img",Fe)):(_(),j("img",Ie)),t[14]||(t[14]=B("span",{class:"text-[#1E1F1F] dark:text-[#9A9EB5] text-[14px]",style:{"font-weight":"550"}},"Suno",-1))]),B("div",Te,U(e.intro),1)])])])))),128)),nl.value?(_(!0),j(L,{key:0},R(nl.value,((e,l)=>(_(),j("div",{class:"mainItem dark:bg-[#2b2d31] bg-[#FFF]",key:l},[B("div",_e,[M(D($),null,{default:O((()=>[M(D(Z),{stroke:"#76777A",size:"large"})])),_:1})]),B("div",je,[B("div",Ae,[B("div",Be,[B("div",ze,[B("div",Le,U(null==e.name?"匿名":e.name),1),B("div",Re,U(e.modetitle),1)]),B("div",Ve,[M(D($),null,{default:O((()=>[M(D(Z),{stroke:"#10A37F",size:10})])),_:1}),t[15]||(t[15]=B("div",{style:{"margin-left":"10px","font-size":"13px",color:"#10a37f"}}," 创作中，请耐心等待 ",-1))])]),t[17]||(t[17]=B("div",null,null,-1)),B("div",De,[f.value?(_(),j("img",Ue)):(_(),j("img",Me)),t[16]||(t[16]=B("span",{class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[12px]",style:{"font-weight":"550"}},"Suno",-1))]),B("div",Oe,U(e.intro),1)])])])))),128)):A("",!0)],544),kl.value?(_(),j("div",Se,[B("div",He,[B("img",{src:p,style:{background:"#D8D8D8",position:"absolute",right:"10px",top:"10px",cursor:"pointer","border-radius":"5px"},onClick:t[1]||(t[1]=e=>kl.value="")}),B("img",{src:kl.value.cover,style:{width:"100%"}},null,8,qe)]),B("div",null,[B("div",{class:z(["musicInfoDialog",{hasMusic:kl.value}]),style:{height:"calc(100vh - 225px)",display:"flex","flex-direction":"column","align-items":"center",overflow:"scroll","border-radius":"10px"}},[B("div",Pe,U(" "==kl.value.title?"匿名":kl.value.title),1),B("div",Ze,[f.value?(_(),j("img",$e)):(_(),j("img",Ge)),t[18]||(t[18]=B("span",{class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[12px]",style:{"font-weight":"550"}},"Suno",-1))]),B("div",Je,[(_(!0),j(L,null,R(kl.value.introList,(e=>(_(),j("div",{key:e,style:{"margin-bottom":"10px"}},U(e),1)))),128))])],2)])])):A("",!0)]),B("div",Ke,[B("div",Ne,[kl.value?(_(),j("div",Qe,[B("div",We,[B("div",Xe,[B("img",{src:kl.value.cover,style:{"border-radius":"5px",width:"60px",height:"60px"}},null,8,Ye),B("div",el,[B("div",null,U(" "==kl.value.title||null==kl.value.title?"匿名":kl.value.title),1),B("div",ll,U(kl.value.intro),1)])]),B("div",null,[f.value?(_(),j("img",{key:0,class:"controlItem",style:{cursor:"pointer",width:"25px",height:"25px"},src:m,alt:"",onClick:Fl})):(_(),j("img",{key:1,class:"controlItem",style:{cursor:"pointer"},src:n,alt:"",onClick:Fl}))]),B("div",null,[El.value&&f.value?(_(),j("img",{key:0,class:"controlItem",src:g,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl})):A("",!0),El.value&&0==f.value?(_(),j("img",{key:1,class:"controlItem",src:o,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl})):A("",!0)]),B("div",null,[!El.value&&f.value?(_(),j("img",{key:0,class:"controlItem",src:x,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl})):A("",!0),El.value||0!=f.value?A("",!0):(_(),j("img",{key:1,class:"controlItem",src:c,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl}))]),B("div",null,[f.value?(_(),j("img",{key:0,class:"controlItem",style:{cursor:"pointer",width:"25px",height:"25px"},src:y,alt:"",onClick:Il})):(_(),j("img",{key:1,class:"controlItem",style:{cursor:"pointer"},src:u,alt:"",onClick:Il}))])]),B("div",tl,[B("div",al,[B("div",il,[B("audio",{id:"audio",src:kl.value.mp3,onCanplay:Ll,ref_key:"audioRef",ref:fl,onTimeupdate:Rl},null,40,sl),S(" "+U(vl.value)+" ",1),M(D(G),{value:ml.value,"onUpdate:value":t[2]||(t[2]=e=>ml.value=e),tooltip:!1,"on-dragstart":Dl,"on-dragend":Ul,max:pl.value,min:0},null,8,["value","max"]),S(" "+U(dl.value),1)])])])])):A("",!0)]),M(ee,{class:"end text-[#A3A5A6] dark:text-[#76777A]"})])],2)]),A("",!0)]))}}),[["__scopeId","data-v-027a166c"]]);export{rl as default};
