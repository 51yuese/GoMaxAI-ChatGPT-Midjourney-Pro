import{_ as e,a as l,b as t,c as a,d as i,e as s,f as r}from"../light_del_music/light_del_music.b0a93278.js";import{_ as n,a as o,b as c,c as u,d as v,e as d,f as p,g as m,h as g,i as x,j as y}from"../light_music_end/light_music_end.9b3b0af2.js";import{e as f,r as h,R as k,j as b,W as E,aM as w,aJ as C,av as F,k as I,aQ as T,O as _,a0 as B,P as j,a8 as A,a3 as R,a4 as z,$ as L,a6 as V,a1 as M,a5 as O,bR as U,N as S,ag as D,aK as H,a2 as q,aq as N,bs as P,bx as J,as as K,ad as Q}from"../main-79c61161.js";import{e as W,h as $,g as G,p as X,n as Y,o as Z}from"./music.212db6aa.js";import{C as ee}from"../index/index.e2a0cd6a.js";const le={class:"bg-[#F8F9F9] dark:bg-[#1B1C22] musicBody"},te={class:"createCenterBox"},ae={class:"createInfo"},ie=["onClick","src"],se={key:3,style:{width:"100px",height:"100px"},src:e,alt:""},re={class:"itemInfo"},ne={class:"info",style:{flex:"1","margin-right":"10px"}},oe={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ce={style:{display:"flex","align-items":"center"}},ue={class:"text-[17px] dark:text-[#9A9EB5] text-[#1E1F1F]",style:{"font-weight":"550"}},ve={class:"model"},de={class:"operation"},pe=["onClick"],me={key:0,class:"operationBox bg-[#fff] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},ge=["onClick"],xe={key:0,src:l,style:{"margin-right":"5px"}},ye={key:1,src:t,style:{"margin-right":"5px"}},fe=["onClick"],he={key:0,src:a,style:{"margin-right":"5px"}},ke={key:1,src:i,style:{"margin-right":"5px"}},be=["onClick"],Ee={key:0,src:s,style:{"margin-right":"5px"}},we={key:1,src:r,style:{"margin-right":"5px"}},Ce={style:{display:"flex","align-items":"center",margin:"12px 0"}},Fe={key:0,src:x,style:{"margin-right":"4px"}},Ie={key:1,src:y,style:{"margin-right":"4px"}},Te={class:"text-[12px] text-[#8B8C8C] dark:text-[#595C6E]",style:{width:"90%",display:"-webkit-box","-webkit-line-clamp":"2","-webkit-box-orient":"vertical",overflow:"hidden"}},_e={style:{width:"108px",height:"108px","border-radius":"8px",position:"relative",display:"flex","justify-content":"center","align-items":"center"}},Be={class:"itemInfo"},je={class:"info",style:{width:"100%"}},Ae={style:{width:"100%",display:"flex","align-items":"center","justify-content":"space-between"}},Re={style:{display:"flex","align-items":"center"}},ze={class:"text-[17px] dark:text-[#EEEEF0] text-[#1E1F1F]",style:{"font-weight":"550"}},Le={class:"text-[12px] text-[#1E1F1F] dark:text-[#EEEEF0] bg-[#F0F0F0] dark:bg-[#222325]",style:{padding:"1px 6px","border-radius":"6px","margin-left":"12px"}},Ve={style:{display:"flex","align-items":"center"}},Me={style:{display:"flex","align-items":"center",margin:"12px 0"}},Oe={key:0,src:x,style:{"margin-right":"4px"}},Ue={key:1,src:y,style:{"margin-right":"4px"}},Se={class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]",style:{"word-break":"keep-all","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},De={key:0,class:"mainRight"},He={style:{width:"100%"}},qe=["src"],Ne={class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[17px]",style:{"margin-top":"12px","font-weight":"550"}},Pe={style:{display:"flex","align-items":"center",margin:"12px 0"}},Je={key:0,src:x,style:{"margin-right":"4px"}},Ke={key:1,src:y,style:{"margin-right":"4px"}},Qe={class:"introList"},We={class:"controlBox"},$e={class:"controlBox",style:{position:"absolute",width:"100%",bottom:"0","z-index":"1"}},Ge={key:0,class:"control dark:bg-[#303137] bg-[#FFF] text-[#8B8C8C] dark:text-[#6C6E79] border-[#E8E8E8] dark:border-[#292A2E]"},Xe={style:{display:"flex","align-items":"center"}},Ye={style:{display:"flex","align-items":"center",gap:"5px","margin-right":"20px"}},Ze=["src"],el={class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[14px]"},ll={style:{color:"#727586","font-size":"12px","margin-top":"10px",display:"-webkit-box","-webkit-box-orient":"vertical","-webkit-line-clamp":"1",overflow:"hidden","text-overflow":"ellipsis",width:"180px"}},tl={style:{display:"flex","align-items":"center",flex:"1","padding-right":"20px","margin-left":"20px"}},al={style:{width:"100%"}},il={style:{"margin-top":"4px",display:"flex","align-items":"center",gap:"10px"}},sl=["src"],rl=Q(f({__name:"myCenter",setup(e){const l=h(null),t=k();b((()=>t.isLogin));const a=h([]);let i=null;const s=E();w(),C(),h(!0),h(!1);const r=h(1),x=h(0),y=F(),f=b((()=>"dark"===y.theme)),Q=h([{name:"V3（一次生成两首歌）",value:"chirp-v3-0",title:"V3"},{name:"V3.5（一次生成两首歌）",value:"chirp-v3-5",title:"V3.5"}]);h("").value=Q.value[0].name;const rl=h(!1),nl=h([]),ol=h([]),cl=h(!1),ul=h(1),vl=h("00:00"),dl=h("00:00"),pl=h(""),ml=h(""),gl=h(0);function xl(){$({size:20,page:r.value,modelType:"music",modelSubType:"create",order:"createAt"}).then((e=>{const{records:l}=e.data;0!=l.length&&l.forEach((e=>{if(""==e.answer&&null==e.errMsg&&0==e.children.length){let l={intro:""},i={intro:""};l.id=e.id,i.id=e.id;e.prompt.split(",").forEach((e=>{let t=e.split(" ");if(""==t[0]&&t.shift(),"prompt"==t[0])for(var a=1;a<=t.length-1;a++)l.intro=l.intro+t[a],i.intro=l.intro+t[a];"mv"==t[0]&&(l.modetitle=t[1],i.modetitle=t[1]),"title"==t[0]&&(l.name=t[1],i.name=t[1])})),nl.value.push(l),nl.value.push(i),setTimeout((()=>Rl()),300),a.value.push(e.id),1==a.value.length&&function(e,l,i){try{var r=setInterval((()=>{if(0==a.value.length)return yl.value=!0,void clearTimeout(r);G({ids:a.value.join()}).then((e=>{e.data.forEach((e=>{if(console.log(nl.value),null!=e.errMsg){t.getUserInfo(),a.value.splice(a.value.indexOf(e.id),1),s.error(e.errMsg);for(var r=0;r<=nl.value.length-1;r++)e.id==nl.value[r].id&&nl.value.splice(r,2);ol.value.push(l),ol.value.push(i)}else if(null!=e.answer&&0!=e.children.length){a.value.splice(a.value.indexOf(e.id),1),t.getUserInfo();for(r=0;r<=nl.value.length-1;r++)e.id==nl.value[r].id&&(console.log(nl.value[r]),nl.value.splice(r,2));e.children.forEach((l=>{l.model=e.model,ol.value.push(l)})),X({ids:[e.children[0].id,e.children[1].id]})}}))}))}),3e3)}catch(n){s.error(n.message),console.log(n);const[e,l]=U("Request failed");nl.value=[],e.modetitle=hl.value,l.modetitle=hl.value,ol.value=[...ol.value,e,l],yl.value=!0,function(e){let l;jl.value=0,Al.value=0,1==e?l=setInterval((()=>{jl.value+=10,Al.value=jl.value/100*200,jl.value>=99&&(clearTimeout(l),jl.value=99,Al.value=jl.value/100*200)}),5e3):clearTimeout(l)}(!1)}}(0,l,i)}else 0!=e.children.length&&e.children.forEach((l=>{l.model=e.model,ol.value.unshift(l)}))}))}))}W({modelType:"music"}).then((e=>{})),h(""),h(0),h(""),h("chirp-v3"),h("");const yl=h(!0);h(),h();const fl=h(null);I((()=>{!async function(){var e;try{const l=await T({modelType:"music",page:1,size:10}),t=(l.data||{}).rows||[];x.value=(null==(e=t[0])?void 0:e.deduct)||0}catch(l){s.error(l.message)}}(),xl(),setTimeout((()=>Rl()),300)}));const hl=h("V3");const kl=h(),bl=h(0),El=h(!1);function wl(e,l){if(kl.value&&kl.value.id==e.id)return void Cl();kl.value={...e},kl.value.introList=e.intro.split("\n"),bl.value=l;const t=setTimeout((()=>{El.value=!1,Cl(),clearTimeout(t)}))}function Cl(){const e=fl.value;El.value?(El.value=!1,e.pause()):(El.value=!0,e.play())}function Fl(){bl.value-1<0?(bl.value=ol.value.length-1,kl.value=ol.value[bl.value]):(bl.value=bl.value-1,kl.value=ol.value[bl.value]);const e=setTimeout((()=>{El.value=!1,Cl(),clearTimeout(e)}))}function Il(){bl.value+1>ol.value.length-1?(bl.value=0,kl.value=ol.value[bl.value]):(bl.value=bl.value+1,kl.value=ol.value[bl.value]);const e=setTimeout((()=>{El.value=!1,Cl(),clearTimeout(e)}))}function Tl(){kl.value&&(kl.value.operation=!1),rl.value=!1,cl.value=!1,ol.value.forEach((e=>{e.operation=!1}))}function _l(){i&&(i.destroy(),i=null)}function Bl(e,l){let t="/api";if(i||(i=s.loading("下载中，请稍等",{duration:0})),"mp4"==l){let l=e.mp4.split("/").pop();Tl(),K.get(t+"/file/down",{responseType:"blob",params:{url:e.mp4}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),_l(),s.success("下载成功")})).catch((e=>{s.error("下载失败"),_l()}))}else if("mp3"==l){let l=e.mp3.split("/").pop();Tl(),K.get(t+"/file/down",{responseType:"blob",params:{url:e.mp3}}).then((e=>{const t=window.URL.createObjectURL(new Blob([e.data])),a=document.createElement("a");a.href=t,a.setAttribute("download",l),a.click(),_l(),s.success("下载成功")})).catch((e=>{s.error("下载失败"),_l()}))}}const jl=h(0),Al=h(0);function Rl(){let e=l.value;e.scrollTo({top:e.scrollHeight+7e3,behavior:"smooth"})}function zl(){pl.value=fl.value.duration,ml.value=fl.value.currentTime,dl.value=Vl(parseInt(fl.value.currentTime)),vl.value=Vl(parseInt(fl.value.duration))}function Ll(e){dl.value=Vl(parseInt(e.target.currentTime)),ml.value=e.target.currentTime,function(){let e=ml.value/pl.value*100;gl.value=e}();const l=fl.value;ml.value>=pl.value&&(El.value=!1,l.pause(),ml.value=0,gl.value=0,dl.value="00:00")}function Vl(e){let l=parseInt(e/60),t=parseInt(e%60);return l=l>=10?l:"0"+l,t=t>=10?t:"0"+t,l+":"+t}function Ml(){fl.value.pause()}function Ol(){fl.value.currentTime=ml.value,fl.value.play()}return(e,t)=>(S(),_("div",le,[rl.value||cl.value?(S(),_("div",{key:0,class:"mask",onClick:Tl})):B("",!0),j("div",te,[j("div",{class:A(["createCenterMain",{hasMusic:kl.value}])},[j("div",ae,[j("div",{class:"mainLeft",ref_key:"createCenterRef",ref:l,onScroll:t[0]||(t[0]=e=>{var l;(l=e).target.scrollTop+l.target.clientHeight==l.target.scrollHeight&&(r.value+=1,xl())})},[(S(!0),_(R,null,z(ol.value,((e,l)=>(S(),_("div",{class:"mainItem dark:bg-[#222325] bg-[#FFF]",key:l},[kl.value&&kl.value.id!=e.id||!El.value?(S(),D(O(H),{key:0,onClick:t=>wl(e,l),style:{"font-size":"30px"},icon:"gridicons:play",class:"playImg"},null,8,["onClick"])):(S(),D(O(H),{key:1,onClick:Cl,style:{"font-size":"30px"},icon:"gridicons:pause",class:"playImg"})),e.cover?(S(),_("img",{key:2,onClick:t=>wl(e,l),style:{width:"100px",height:"100px","max-width":"108px"},src:e.cover,alt:""},null,8,ie)):B("",!0),e.cover?B("",!0):(S(),_("img",se)),j("div",re,[j("div",ne,[j("div",oe,[j("div",ce,[j("div",ue,L(" "==e.title||null==e.title?"匿名":e.title),1),j("div",ve,L(e.model.indexOf("v4")>-1?"V4":e.model.indexOf("v3-5")>-1?"V3.5":"V3.0"),1)]),j("div",de,[j("div",{class:A(["collect",{collected:e.agree}]),onClick:l=>function(e){console.log(e);let l={relateId:e.id,action:"agree",relateType:"music"};0!=ul.value&&(ul.value=0,Z(l).then((l=>{null!=e.agree?ol.value.forEach((l=>{l.id==e.id&&(l.agree=null)})):ol.value.forEach((l=>{l.id==e.id&&(l.agree="agree")})),ul.value=1})))}(e)},null,10,pe),M(O(H),{icon:"ri:more-line",class:"icon text-xl text-center",onClick:l=>function(e,l){3==l&&(e.operation=!0,cl.value=!0)}(e,3)},null,8,["onClick"]),e.operation?(S(),_("div",me,[j("div",{class:"operationItem",onClick:l=>Bl(e,"mp4"),style:{display:"flex"}},[f.value?(S(),_("img",xe)):(S(),_("img",ye)),t[11]||(t[11]=j("div",null,"下载视频",-1))],8,ge),j("div",{class:"operationItem",onClick:l=>Bl(e,"mp3"),style:{display:"flex"}},[f.value?(S(),_("img",he)):(S(),_("img",ke)),t[12]||(t[12]=j("div",null,"下载音频",-1))],8,fe),j("div",{class:"operationItem",style:{display:"flex",color:"#ff5e55"},onClick:t=>async function(e,l){try{await Y({ids:[e]}),s.success("创作记录删除成功"),r.value=1,ol.value.splice(l,1)}catch(t){s.error(t.message)}}(e.id,l)},[f.value?(S(),_("img",Ee)):(S(),_("img",we)),t[13]||(t[13]=j("div",null,"删除",-1))],8,be)])):B("",!0)])]),j("div",Ce,[f.value?(S(),_("img",Fe)):(S(),_("img",Ie)),t[14]||(t[14]=j("span",{class:"text-[#1E1F1F] dark:text-[#9A9EB5] text-[14px]",style:{"font-weight":"550"}},"Suno",-1))]),j("div",Te,L(e.intro),1)])])])))),128)),nl.value?(S(!0),_(R,{key:0},z(nl.value,((e,l)=>(S(),_("div",{class:"mainItem dark:bg-[#222325] bg-[#FFF]",key:l},[j("div",_e,[M(O(P),null,{default:q((()=>[M(O(N),{stroke:"#76777A",size:"large"})])),_:1})]),j("div",Be,[j("div",je,[j("div",Ae,[j("div",Re,[j("div",ze,L(null==e.name?"匿名":e.name),1),j("div",Le,L(e.modetitle),1)]),j("div",Ve,[M(O(P),null,{default:q((()=>[M(O(N),{stroke:"#10A37F",size:10})])),_:1}),t[15]||(t[15]=j("div",{style:{"margin-left":"10px","font-size":"13px",color:"#10a37f"}}," 创作中，请耐心等待 ",-1))])]),t[17]||(t[17]=j("div",null,null,-1)),j("div",Me,[f.value?(S(),_("img",Oe)):(S(),_("img",Ue)),t[16]||(t[16]=j("span",{class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[12px]",style:{"font-weight":"550"}},"Suno",-1))]),j("div",Se,L(e.intro),1)])])])))),128)):B("",!0)],544),kl.value?(S(),_("div",De,[j("div",He,[j("img",{src:n,style:{background:"#D8D8D8",position:"absolute",right:"10px",top:"10px",cursor:"pointer","border-radius":"5px"},onClick:t[1]||(t[1]=e=>kl.value="")}),j("img",{src:kl.value.cover,style:{width:"100%"}},null,8,qe)]),j("div",null,[j("div",{class:A(["musicInfoDialog",{hasMusic:kl.value}]),style:{height:"calc(100vh - 225px)",display:"flex","flex-direction":"column","align-items":"center",overflow:"scroll","border-radius":"10px"}},[j("div",Ne,L(" "==kl.value.title?"匿名":kl.value.title),1),j("div",Pe,[f.value?(S(),_("img",Je)):(S(),_("img",Ke)),t[18]||(t[18]=j("span",{class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[12px]",style:{"font-weight":"550"}},"Suno",-1))]),j("div",Qe,[(S(!0),_(R,null,z(kl.value.introList,(e=>(S(),_("div",{key:e,style:{"margin-bottom":"10px"}},L(e),1)))),128))])],2)])])):B("",!0)]),j("div",We,[j("div",$e,[kl.value?(S(),_("div",Ge,[j("div",Xe,[j("div",Ye,[j("img",{src:kl.value.cover,style:{"border-radius":"5px",width:"60px",height:"60px"}},null,8,Ze),j("div",el,[j("div",null,L(" "==kl.value.title||null==kl.value.title?"匿名":kl.value.title),1),j("div",ll,L(kl.value.intro),1)])]),j("div",null,[f.value?(S(),_("img",{key:0,class:"controlItem",style:{cursor:"pointer",width:"25px",height:"25px"},src:o,alt:"",onClick:Fl})):(S(),_("img",{key:1,class:"controlItem",style:{cursor:"pointer"},src:c,alt:"",onClick:Fl}))]),j("div",null,[El.value&&f.value?(S(),_("img",{key:0,class:"controlItem",src:u,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl})):B("",!0),El.value&&0==f.value?(S(),_("img",{key:1,class:"controlItem",src:v,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl})):B("",!0)]),j("div",null,[!El.value&&f.value?(S(),_("img",{key:0,class:"controlItem",src:d,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl})):B("",!0),El.value||0!=f.value?B("",!0):(S(),_("img",{key:1,class:"controlItem",src:p,style:{margin:"0 10px",cursor:"pointer"},alt:"",onClick:Cl}))]),j("div",null,[f.value?(S(),_("img",{key:0,class:"controlItem",style:{cursor:"pointer",width:"25px",height:"25px"},src:m,alt:"",onClick:Il})):(S(),_("img",{key:1,class:"controlItem",style:{cursor:"pointer"},src:g,alt:"",onClick:Il}))])]),j("div",tl,[j("div",al,[j("div",il,[j("audio",{id:"audio",src:kl.value.mp3,onCanplay:zl,ref_key:"audioRef",ref:fl,onTimeupdate:Ll},null,40,sl),V(" "+L(dl.value)+" ",1),M(O(J),{value:ml.value,"onUpdate:value":t[2]||(t[2]=e=>ml.value=e),tooltip:!1,"on-dragstart":Ml,"on-dragend":Ol,max:pl.value,min:0},null,8,["value","max"]),V(" "+L(vl.value),1)])])])])):B("",!0)]),M(ee,{class:"end dark:bg-[#1B1C22] bg-[#F8F9F9] text-[#A3A5A6] dark:text-[#76777A]"})])],2)]),B("",!0)]))}}),[["__scopeId","data-v-0ef28c54"]]);export{rl as default};
