import{a as e}from"../index/index.fa6dd815.js";import{T as a}from"../index/index.fe332a69.js";import{j as t,aN as s,e as r,r as o,p as i,k as n,g as d,W as l,w as p,x as u,B as c,C as m,ao as g,a4 as v,b7 as f}from"../main-be2ae0f3.js";import{g as h,b as y,h as b}from"../music/music.b5626e8e.js";import{u as w}from"../useUpload/useUpload.a3134ee8.js";import"../aboutUs copy/aboutUs copy.d0a1c112.js";const x={style:{display:"flex",height:"100%"}},T={style:{width:"100%"},class:"bg-[#fff] dark:bg-[#24252B]"},j=r({__name:"index",setup(r){const{selectFileByImageAndVideo:j}=w(),P=o("/api/file/upload"),A=i(),I=["succeeded","completed","succeed"],O=n(),S=d((()=>O.isLogin)),L={page:1,size:20},q=o(0),D=o({data:[],styleData:[],hasMore:!1,loading:!1,generate:!1});return async function(){try{const a=await(e={dictType:"video-style",dictName:"",page:1,size:30},t({url:"/dict/page",data:e}));D.value.styleData=a.data.rows}catch(a){A.error(a.message)}var e}(),function(){try{setInterval((()=>{if(1===q.value){const e=D.value.data.filter((e=>"error"!==e.status&&(!I.includes(e.status)||"usesLeft"===e.type||null===e.cover))).map((e=>e.id));e.length&&(O.getUserInfo(),h({ids:e.join()}).then((e=>{1===q.value&&e.data.forEach((e=>{if(null!=e.errMsg){A.error(e.errMsg);const a=D.value.data.findIndex((a=>a.id==e.id));a>-1&&D.value.splice(a,1)}else if(I.includes(e.answer)){const a=D.value.data.findIndex((a=>a.id==e.id));a>-1&&(D.value.data[a]={...e.children[0],modelSubType:e.modelSubType,conversationOptions:e.conversationOptions,id:e.id,requestParams:e.requestParams,generateLoading:!1,model:e.model,prompt:e.prompt,status:e.answer})}}))})))}}),3e3)}catch(e){console.log(e),A.error(e.message)}}(),g("videoBase",{list:async function(e,a,t){return t>0?L.page=t:L.page++,q.value=e,new Promise((async(t,s)=>{var r;let o={};o=0==e?await y({...L,modelType:"video",modelSubType:a}):await b({...L,modelType:"video",order:"createAt",modelSubType:a});let i=(null==(r=null==o?void 0:o.data)?void 0:r.records)||[],n=[];i.reverse(),i.forEach((async e=>{if(e.errMsg)n.push({conversationOptions:e.conversationOptions,id:e.id,modelSubType:e.modelSubType,requestParams:e.requestParams,model:e.model,prompt:e.prompt,generateLoading:!1,intro:e.prompt.indexOf("prompt ")>-1?e.prompt.split("--")[0].split("prompt ")[1]:e.prompt,createdAt:e.createdAt,status:"error"});else if(e.children&&e.children.length>0){const a=e.children.find((e=>e.mp4));a&&(e.prompt.indexOf("prompt ")>-1?a.intro=e.prompt.split("--")[0].split("prompt ")[1]:a.intro=e.prompt);const t={...a||e.children[0],conversationOptions:e.conversationOptions,modelSubType:e.modelSubType,model:e.model,prompt:e.prompt,status:e.answer,requestParams:e.requestParams};n.push(t)}else n.push({...e})})),n.sort(((e,a)=>new Date(e.createdAt)-new Date(a.createdAt))),1===L.page?D.value.data=n:D.value.data.unshift(...n),i.length<L.size&&(D.value.noMore=!0),D.value.loading=!1,t(o)}))},remove:function(e){f({id:e}).then((a=>{A.success("删除成功");const t=D.value.data.findIndex((a=>a.id===e));D.value.data.splice(t,1)})).catch((e=>{e.message&&A.error(e.message)}))},create:function(e,a){return D.value.generate=!0,new Promise((t=>{if(S.value){const r=e();(function(e,a=""){return s({url:"/chatgpt/chat-video"+(a?"-"+a:""),data:e})})(r,a).then((e=>{r.id=e.data.id,r.createdAt=e.data.createdAt,r.intro=e.data.prompt.split("--")[0].split("prompt ")[1],r.status="pedding",1===q.value&&D.value.data.push(r),D.value.generate=!1,t(e)})).catch((e=>{D.value.generate=!1,A.error(e.message),t(!1)}))}else O.setLoginDialog(!0),D.value.generate=!1,t(!1)}))},uploadFile:async function(e){return new Promise((async(e,a)=>{try{const a=await j();await v.post(P.value,{file:a},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{console.log(a),200==a.data.code?e(a.data.data):A.error(null==a.data.message?a.data.data:a.data.message)}))}catch(t){A.error(t.message),e(!1)}}))},videoData:D,getIsLogin:()=>O.isLogin}),(t,s)=>{const r=l("RouterView");return p(),u("div",x,[c("div",T,[m(r,{style:{height:"100vh"},class:"bg-[#F8F9F9] dark:bg-[#19191B]"})]),m(e),m(a)])}}});export{j as default};
