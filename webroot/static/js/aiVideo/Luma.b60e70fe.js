import{e,N as t,O as a,P as l,a1 as r,an as i,a7 as d,R as s,j as n,r as o,aj as p,k as u,a8 as v,U as c,a4 as x,F as g,ab as m,Z as E,_ as h,$ as b,H as y,X as f,bk as F,ag as k,bp as _,W as C,ai as w,aP as A,ap as I,A as B,a$ as D,Y as M,ak as j,al as V,d9 as T,am as U,K as z,be as O}from"../main-6c725c30.js";import{u as P}from"../useUpload/useUpload.94c17c32.js";import{g as N,f as S}from"../video/video.ed708fe0.js";import{h as G,g as L,m as H}from"../music/music.7f933b9b.js";import{C as $}from"../index/index.ef85808c.js";import{u as R}from"../index/index.5b75f753.js";import{N as J}from"../Popconfirm/Popconfirm.534000dc.js";const K={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},W=[l("path",{d:"M400 148l-21.12-24.57A191.43 191.43 0 0 0 240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 0 0 181.07-128",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-miterlimit":"10","stroke-width":"32"},null,-1),l("path",{d:"M464 97.42V208a16 16 0 0 1-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z",fill:"currentColor"},null,-1)],X=e({name:"ReloadOutline",render:function(e,l){return t(),a("svg",K,W)}}),Y={class:"dark:bg-[#111113] bg-[#FFF]",style:{"border-radius":"12px",padding:"12px","text-align":"center"}};const Z=r({name:"TypeInfoCard"},[["render",function(e,l,r,d,s,n){return t(),a("div",Y,l[0]||(l[0]=[i('<div class="bg-gradient-to-b from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent dark:bg-[#10A37F]" style="width:80px;height:80px;border-radius:50%;margin-left:50%;transform:translate(-50%);text-align:center;line-height:80px;font-size:22px;color:#FFFFFF;font-weight:550;"> Luma </div><div style="display:flex;align-items:center;justify-content:center;margin:12px 0 8px 0;"><div class="dark:text-[#EEEEF0] text-[#1E1F1F] text-[15px]" style="font-weight:550;margin-right:4px;">Luma </div><div class="bg-[#d8e1fa] dark:bg-[#101C18] border border-transparent dark:border-[#1E6953] text-[#3E6AE7] dark:text-[#10A37F] text-[13px]" style="height:18px;line-height:18px;padding:0 8px;text-align:center;border-radius:4px;">AI </div></div><div class="dark:text-[#6C6E79] text-[#8B8C8C] text-[12px]"> 接入全球热门的AI视频，为用户提供一系列强大的视频编辑与生成功能。 </div>',3)]))}]]),q={class:"video_sub_sidebar border-[#E8E8E8] dark:border-[#24252b] bg-[#f2f2f5] dark:bg-transparent"},Q={class:"scroll_card",style:{height:"100%","overflow-y":"scroll"}},ee={style:{display:"flex","align-items":"center",padding:"0 12px"}},te={style:{"margin-top":"12px",padding:"0 12px"}},ae={key:0},le={key:0,style:{width:"calc(300px - 24px)",height:"134px",padding:"8px","border-radius":"8px","text-align":"center",display:"table-cell","vertical-align":"middle"},class:"bg-[#FFF] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},re={key:1,style:{width:"calc(300px - 24px)",height:"134px",padding:"8px","border-radius":"8px","text-align":"center",display:"table-cell","vertical-align":"middle"},class:"bg-[#FFF] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},ie=["src"],de={key:0,style:{width:"calc(300px - 24px)",height:"134px",padding:"8px","border-radius":"8px","text-align":"center",display:"table-cell","vertical-align":"middle"},class:"bg-[#FFF] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},se={key:1,style:{width:"calc(300px - 24px)",height:"134px",padding:"8px","border-radius":"8px","text-align":"center",display:"table-cell","vertical-align":"middle"},class:"bg-[#FFF] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},ne=["src"],oe={style:{"margin-top":"20px"}},pe={style:{width:"100%",height:"94px",padding:"8px","border-radius":"8px"},class:"bg-[#FFF] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},ue={style:{"margin-top":"20px"}},ve={class:"style_card"},ce=["onClick"],xe=["src"],ge={style:{"margin-top":"20px"}},me={class:"size_card"},Ee=["onClick"],he={style:{"margin-top":"20px"}},be={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"10px"}},ye={style:{width:"34px",height:"20px","border-radius":"6px","text-align":"center","line-height":"20px"},class:"bg-[#F0F0F0] dark:bg-[#222325] text-[10px] dark:text-[#EEEEF0] text-[#1E1F1F]"},fe={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"10px"}},Fe={style:{width:"34px",height:"20px","border-radius":"6px","text-align":"center","line-height":"20px"},class:"bg-[#F0F0F0] dark:bg-[#222325] text-[10px] dark:text-[#EEEEF0] text-[#1E1F1F]"},ke={style:{display:"flex","align-items":"center","justify-content":"space-between","padding-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},_e={style:{width:"34px",height:"20px","border-radius":"6px","text-align":"center","line-height":"20px"},class:"bg-[#F0F0F0] dark:bg-[#222325] text-[10px] dark:text-[#EEEEF0] text-[#1E1F1F]"},Ce={style:{"margin-top":"10px","padding-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},we={style:{display:"flex","align-items":"center"}},Ae={style:{"margin-top":"10px"}},Ie={style:{width:"100%",height:"94px",padding:"8px","border-radius":"8px"},class:"bg-[#FFF] dark:bg-[#111113] border border-[#E8E8E8] dark:border-[#292A2E]"},Be={style:{"margin-top":"20px"}},De={style:{padding:"0 30px",position:"absolute",bottom:"12px",width:"100%"},class:"bg-[#F8F9F9] dark:bg-[#19191B] border-t border-[#E8E8E8] dark:border-[#292A2E]"},Me=r(e({__name:"SubSidebar",emits:["generateInfo"],setup(e,{emit:r}){const{selectFileByImageAndVideo:i,upload:B}=P(),D=d(),M=s();n((()=>"dark"===D.theme));const j=o("/api/file/upload"),V=p(),T=o(""),U=o(0),z=o(0),O=o(0),H=o(""),$=o(0),R=o(999),J=o(1),K=o([]),W=o([]),X=r,Y=o(!1),Me=o([]),je=o([]),Ve=o([{id:1,width:"16px",height:"16px",value:"1:1"},{id:2,width:"20px",height:"12px",value:"16:9"},{id:3,width:"12px",height:"20px",value:"9:16"},{id:4,width:"17px",height:"22px",value:"5:2"},{id:5,width:"22px",height:"17px",value:"4:5"},{id:6,width:"23px",height:"16px",value:"4:3"}]),Te=o({prompt:"",options:{parentMessageId:0},systemMessage:"",cusromPrompt:!0,model:"luma-video",expand_prompt:!0,aspect_ratio:"16:9",image_url:"",image_end_url:""}),Ue=[{label:"luma-video",value:"luma-video"},{label:"luma-vip-video",value:"luma-vip-video"}];function ze(e){$.value=e}async function Oe(e){try{const t=await i();console.log(t),await I.post(j.value,{file:t},{headers:{"Content-Type":"multipart/form-data"}}).then((t=>{console.log(t),200==t.data.code?"start"==e?Te.value.image_url=t.data.data:Te.value.image_end_url=t.data.data:V.error(null==t.data.message?t.data.data:t.data.message)}))}catch(t){V.error(t.message)}}function Pe(e){R.value=e}function Ne(){T.value=""}function Se(){H.value=""}function Ge(){!function(){let e="";if(1==$.value){if(""==Te.value.image_url)return V.error("开始帧图片不能为空");if(""==Te.value.image_end_url)return V.error("结束帧图片不能为空")}if(null==T.value||""==T.value)return V.error("视频场景不能为空");e+=T.value,999!=R.value&&(e+=" ,风格："+je.value[R.value].dictName);e+=" ,每秒帧数："+U.value,e+=" ,运动幅度："+z.value,e+=" ,文案一致性："+O.value,""!=H.value&&(e+=" ,视频中不能出现："+H.value+" 等词汇");Te.value.prompt=e}();let e={id:0,title:"匿名",img:"",intro:Te.value.prompt,createdAt:(new Date).getTime()};S(Te.value).then((t=>{e.id=t.data.id,W.value.push(e),X("generateInfo",W.value),K.value.push(t.data.id),Te.value.prompt="",Te.value.model="luma-video",Te.value.image_url="",Te.value.image_end_url="",T.value="",U.value=0,z.value=0,O.value=0,H.value="",M.updateVideoTabIndex(1),1==K.value.length&&Le(e)})).catch((e=>{V.error(e.message)}))}function Le(e){try{var t=setInterval((()=>{if(0==K.value.length)return Y.value=!0,void clearTimeout(t);L({ids:K.value.join()}).then((t=>{t.data.forEach((t=>{if(null!=t.errMsg){V.error(t.errMsg),M.getUserInfo(),K.value.splice(K.value.indexOf(t.id),1);for(var a=0;a<=W.value.length-1;a++)W.value[a].id==t.id&&W.value.splice(a,1);Me.value.push(e),console.log(e),X("generateInfo",W.value,Me.value)}else if(null!=t.answer&&0!=t.children.length){M.getUserInfo(),K.value.splice(K.value.indexOf(t.id),1),t.children[0].intro=t.prompt.split("--")[0].split("prompt ")[1],Me.value.push(t.children[0]);for(a=0;a<=W.value.length-1;a++)W.value[a].id==t.id&&W.value.splice(a,1);X("generateInfo",W.value,Me.value)}}))}))}),3e3)}catch(a){console.log(a),V.error(a.message),Me.value.push(e),W.value=[]}}u((()=>{!async function(){try{const e=await N({dictType:"video-style",dictName:"",page:1,size:30});je.value=e.data.rows}catch(e){V.error(e.message)}}(),async function(){const e=await G({page:1,size:50,modelType:"video",order:"createAt"});let t={id:0,title:"匿名",img:"",intro:Te.value.prompt,createdAt:(new Date).getTime()};e.data.records.forEach((e=>{""==e.answer&&null==e.errMsg&&0==e.children.length&&(t.id=e.id,t.intro=e.prompt.split("--")[0].split("prompt ")[1],t.createdAt=e.createdAt,K.value.push(e.id),W.value.push(t))})),X("generateInfo",W.value,Me.value),1==K.value.length&&Le(t)}()}));const He=({focused:e,checked:t})=>{const a={};return t&&(a.background="linear-gradient(124deg, #957DF4 7%, #3C69E7 88%)"),e&&(a.boxShadow="0 0 0 2px #957df480"),a};return(e,r)=>(t(),a("div",q,[l("div",Q,[l("div",ee,[l("div",{class:v([0==$.value?"selected_type_tab bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent dark:bg-[#10A37F]":"type_tab","dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"]),onClick:r[0]||(r[0]=e=>ze(0))},"文生视频 ",2),l("div",{class:v([1==$.value?"selected_type_tab bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent dark:bg-[#10A37F]":"type_tab","dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"]),onClick:r[1]||(r[1]=e=>ze(1))},"图生视频 ",2)]),l("div",te,[c(Z),1==$.value?(t(),a("div",ae,[l("div",{style:{"margin-top":"20px",cursor:"pointer"},onClick:r[2]||(r[2]=e=>Oe("start"))},[r[13]||(r[13]=l("div",{style:{display:"flex","margin-bottom":"6px"}},[l("div",{style:{width:"4px",height:"8px","border-radius":"4px","margin-right":"4px","margin-top":"5px"},class:"bg-[#1E1F1F] dark:bg-[#EEEEF0]"}),l("div",null,[l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},"上传开始帧图片"),l("div",{class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},"(上传jpg/png/mp4文件，且不超过10MB)")])],-1)),""==Te.value.image_url?(t(),a("div",le,r[12]||(r[12]=[l("div",{class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]"},"将参考图拖到此处",-1),l("div",{class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]"},"或",-1),l("div",{class:"text-[12px] text-[#3e6ae7] dark:text-[#10A37F]"},"点击上传",-1)]))):(t(),a("div",re,[l("img",{src:Te.value.image_url,style:{width:"100%",height:"100%"}},null,8,ie)]))]),l("div",{style:{"margin-top":"20px",cursor:"pointer"},onClick:r[3]||(r[3]=e=>Oe("end"))},[r[15]||(r[15]=l("div",{style:{display:"flex","margin-bottom":"6px"}},[l("div",{style:{width:"4px",height:"8px","border-radius":"4px","margin-right":"4px","margin-top":"5px"},class:"bg-[#1E1F1F] dark:bg-[#EEEEF0]"}),l("div",null,[l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},"上传结束帧图片"),l("div",{class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},"(上传jpg/png/mp4文件，且不超过10MB)")])],-1)),""==Te.value.image_end_url?(t(),a("div",de,r[14]||(r[14]=[l("div",{class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]"},"将参考图拖到此处",-1),l("div",{class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]"},"或",-1),l("div",{class:"text-[12px] text-[#3e6ae7] dark:text-[#10A37F]"},"点击上传",-1)]))):(t(),a("div",se,[l("img",{src:Te.value.image_end_url,style:{width:"100%",height:"100%"}},null,8,ne)]))])])):x("",!0),l("div",oe,[r[16]||(r[16]=l("div",{style:{display:"flex","align-items":"center","margin-bottom":"6px"}},[l("div",{style:{width:"4px",height:"8px","border-radius":"4px","margin-right":"4px"},class:"bg-[#1E1F1F] dark:bg-[#EEEEF0]"}),l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},"描述你的视频场景")],-1)),l("div",pe,[g(l("textarea",{"onUpdate:modelValue":r[4]||(r[4]=e=>T.value=e),style:{width:"100%",height:"55px",resize:"none","background-color":"transparent"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:"请输入创意描述，包含内容主体+动作/场景，一键生成视频"},null,512),[[m,T.value]]),l("div",{style:{width:"100%","text-align":"right",cursor:"pointer"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",onClick:Ne}," 清空 ")])]),l("div",ue,[r[18]||(r[18]=l("div",{style:{display:"flex","align-items":"center","margin-bottom":"6px"}},[l("div",{style:{width:"4px",height:"8px","border-radius":"4px","margin-right":"4px"},class:"bg-[#1E1F1F] dark:bg-[#EEEEF0]"}),l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},"风格选择")],-1)),l("div",ve,[l("div",{class:v(999==R.value?"style_item dark:!border-[#10A37F]":"def_style_item"),onClick:r[5]||(r[5]=e=>Pe(999))},[r[17]||(r[17]=l("img",{class:"style_img",src:"/static/png/noStyle-fc3e20db.png"},null,-1)),l("div",{class:v(999==R.value?"style_name bg-gradient-to-b from-transparent to-[#3C69E7]":"def_style_name")},"未指定",2)],2),(t(!0),a(E,null,h(je.value,((e,r)=>(t(),a("div",{class:v(R.value==r?"style_item dark:!border-[#10A37F]":"def_style_item"),key:r,onClick:e=>Pe(r)},[l("img",{class:"style_img",src:e.dictValue},null,8,xe),l("div",{class:v(R.value==r?"style_name bg-gradient-to-b from-transparent to-[#3C69E7]":"def_style_name")},b(e.dictName),3)],10,ce)))),128))])]),l("div",ge,[r[19]||(r[19]=l("div",{style:{display:"flex","align-items":"center","margin-bottom":"6px"}},[l("div",{style:{width:"4px",height:"8px","border-radius":"4px","margin-right":"4px"},class:"bg-[#1E1F1F] dark:bg-[#EEEEF0]"}),l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},"尺寸选择")],-1)),l("div",me,[(t(!0),a(E,null,h(Ve.value,((e,r)=>(t(),a("div",{class:v(J.value==r?"size_item dark:bg-[#101C18] bg-gradient-to-b from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent border dark:border-[#1E6953] border-transparent":"size_item dark:bg-[#111113] bg-[#FFF] border dark:border-[#292A2E] border-transparent"),key:e.id,onClick:e=>V.info("目前仅支持16:9画面比例, 暂时不支持更改其他尺寸")},[l("div",{style:y([{width:e.width,height:e.height},{"border-radius":"2px","margin-bottom":"4px"}]),class:v(J.value==r?"bg-[#FFFFFF] dark:bg-[#111113] border border-transparent dark:border-transparent":"bg-[#8188B8] dark:bg-[#19191B] border border-transparent dark:border-[#46484F]")},null,6),l("div",{class:v(["text-[12px] dark:text-[#EEEEF0] text-[#333333]",J.value==r?"text-white":""])},b(e.value),3)],10,Ee)))),128))])]),l("div",he,[r[23]||(r[23]=l("div",{style:{display:"flex","align-items":"center","margin-bottom":"6px"}},[l("div",{style:{width:"4px",height:"8px","border-radius":"4px","margin-right":"4px"},class:"bg-[#1E1F1F] dark:bg-[#EEEEF0]"}),l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},"高级参数")],-1)),l("div",null,[l("div",be,[r[20]||(r[20]=l("div",{class:"text-[10px] text-[#1E1F1F] dark:text-[#EEEEF0]"},"每秒帧数",-1)),l("div",null,[c(f(F),{value:U.value,"onUpdate:value":r[6]||(r[6]=e=>U.value=e),step:10,style:{margin:"0 12px",width:"calc(300px - 148px)"}},null,8,["value"])]),l("div",ye,b(U.value),1)]),l("div",fe,[r[21]||(r[21]=l("div",{class:"text-[10px] text-[#1E1F1F] dark:text-[#EEEEF0]"},"运动幅度",-1)),l("div",null,[c(f(F),{value:z.value,"onUpdate:value":r[7]||(r[7]=e=>z.value=e),step:10,style:{margin:"0 12px",width:"calc(300px - 148px)"}},null,8,["value"])]),l("div",Fe,b(z.value),1)]),l("div",ke,[r[22]||(r[22]=l("div",{class:"text-[10px] text-[#1E1F1F] dark:text-[#EEEEF0]"},"文案一致性",-1)),l("div",null,[c(f(F),{value:O.value,"onUpdate:value":r[8]||(r[8]=e=>O.value=e),step:10,style:{width:"calc(300px - 148px)","margin-right":"10px"}},null,8,["value"])]),l("div",_e,b(O.value),1)])])]),l("div",Ce,[l("div",we,[r[24]||(r[24]=l("div",{class:"text-[#1E1F1F] dark:text-[#EEEEF0] text-[12px]",style:{"margin-right":"10px"}}," 优化扩展提示词 ",-1)),l("div",null,[c(f(k),{modelValue:Te.value.expand_prompt,"onUpdate:modelValue":r[9]||(r[9]=e=>Te.value.expand_prompt=e),size:"small","rail-style":He},null,8,["modelValue"])])])]),l("div",Ae,[r[25]||(r[25]=l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]",style:{"margin-bottom":"6px"}},"负向提示词",-1)),l("div",Ie,[g(l("textarea",{"onUpdate:modelValue":r[10]||(r[10]=e=>H.value=e),style:{width:"100%",height:"55px",resize:"none","background-color":"transparent"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:"请输入不想出现的元素"},null,512),[[m,H.value]]),l("div",{style:{width:"100%","text-align":"right",cursor:"pointer"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",onClick:Se}," 清空 ")])]),l("div",Be,[r[26]||(r[26]=l("div",{style:{display:"flex","align-items":"center","margin-bottom":"6px"}},[l("div",{style:{width:"4px",height:"8px","border-radius":"4px","margin-right":"4px"},class:"bg-[#1E1F1F] dark:bg-[#EEEEF0]"}),l("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},"视频模型")],-1)),l("div",null,[c(f(_),{value:Te.value.model,"onUpdate:value":r[11]||(r[11]=e=>Te.value.model=e),options:Ue},null,8,["value"])])])])]),l("div",De,[c(f(A),{tertiary:"",class:"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent dark:bg-[#10A37F] !text-white",style:{width:"100%",height:"40px","font-size":"15px","border-radius":"10px",padding:"12px 0","margin-top":"12px"},onClick:Ge},{default:C((()=>r[27]||(r[27]=[w(" 立即生成 2积分 ")]))),_:1})])]))}}),[["__scopeId","data-v-0e26dbb6"]]),je={class:"video_list_box"},Ve=["src","poster"],Te=["onClick"],Ue={style:{"margin-top":"12px",padding:"0 4px"}},ze={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Oe={class:"text-[12px]"},Pe=["onClick"],Ne={class:"text-[#10A37F] dark:text-[#10A37F]"},Se={class:"text-[#8B8C8C] dark:text-[#6C6E79] text-[12px]"},Ge={style:{height:"38px"},class:"video_desc text-[#8B8C8C] dark:text-[#6C6E79] text-[12px]"},Le={class:"task-delete"},He={style:{"margin-top":"12px","margin-bottom":"8px"}},$e={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Re={class:"text-[#10A37F] dark:text-[#10A37F] text-[12px]"},Je={class:"text-[#8B8C8C] dark:text-[#6C6E79] text-[12px]"},Ke={style:{height:"38px"},class:"video_desc text-[#8B8C8C] dark:text-[#6C6E79] text-[12px]"},We={class:"dialog dark:bg-[#1E1F1F] bg-[#EEEEF0]"},Xe={style:{display:"flex","align-items":"center","justify-content":"space-between","margin-bottom":"10px"}},Ye={class:"text-[17px] dark:text-[#EEEEF0] text-[#1E1F1F]",style:{"font-weight":"bold"}},Ze={class:"input_card"},qe=["src"],Qe=r(e({__name:"VideoList",props:{generateInfo:Array,videoDate:Array,videoNum:{type:Number,default:0},noMore:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},title:{type:String,default:"匿名"}},emits:["updatePage","setGenerateInfo","updateMyVideoDate"],setup(e,{emit:r}){const i=e;B((()=>i.videoNum),(e=>{e>0&&W()})),B((()=>i.generateInfo),((e=[])=>{e.length>0&&W()}));const g=p(),m=s(),F=d(),k=o(!1),_=o(""),A=o(""),I=n((()=>m.videoTabIndex||0)),O=n((()=>"dark"===F.theme)),P=o([]),N=o([]),G=o(!1),H=r,$=o(),K=()=>{A.value&&A.value.play()},W=()=>{0!=I.value&&z((()=>{var e;null==(e=$.value)||e.scrollTo({top:$.value.scrollHeight,behavior:"smooth"})}))};const Y=function(e){const t=e.target,{scrollTop:a,offsetHeight:l,scrollHeight:r}=t;r-l-a<=30&&(i.noMore||i.loading||H("updatePage"))},Z=(e={})=>{let t=e.conversationOptions||{};t&&"string"==typeof t&&(t=JSON.parse(t));let a={id:e.id,prompt:e.prompt||"",options:{parentMessageId:t.parentMessageId||0},systemMessage:"",cusromPrompt:!0,model:e.model||"luma-video",expand_prompt:!0,aspect_ratio:"16:9",image_url:"",image_end_url:"",thirdId:e.sunoId||""},l={id:0,title:i.title||"匿名",img:"",intro:a.prompt,createdAt:(new Date).getTime()};S(a).then((e=>{l.id=e.data.id,N.value.push(l),H("setGenerateInfo",N.value),P.value.push(e.data.id),m.updateVideoTabIndex(1),1==P.value.length&&function(){try{var e=setInterval((()=>{if(0==P.value.length)return G.value=!0,void clearTimeout(e);L({ids:P.value.join()}).then((e=>{e.data.forEach((e=>{if(null!=e.errMsg){g.error(e.errMsg),m.getUserInfo(),P.value.splice(P.value.indexOf(e.id),1);for(var t=0;t<=N.value.length-1;t++)N.value[t].id==e.id&&N.value.splice(t,1);H("setGenerateInfo",N.value)}else if(null!=e.answer&&0!=e.children.length){m.getUserInfo(),P.value.splice(P.value.indexOf(e.id),1);const a=e.prompt.split("--")[0].split("prompt ")[1];for(t=0;t<=N.value.length-1;t++)N.value[t].id==e.id&&N.value.splice(t,1);if(H("setGenerateInfo",N.value),e.children[0].mp4){g.success("视频生成成功！");const t={...e.children[0],conversationOptions:e.conversationOptions,model:e.model,prompt:e.prompt,intro:a};H("updateMyVideoDate",t,"add")}else g.error("生成视频地址连接不存在！")}}))}))}),3e3)}catch(t){console.log(t),g.error(t.message),N.value=[]}}()})).catch((e=>{g.error(e.message)}))};return u((()=>{var e;null==(e=$.value)||e.addEventListener("scroll",Y)})),D((()=>{var e;null==(e=$.value)||e.removeEventListener("scroll",Y)})),(r,i)=>(t(),a("div",je,[l("div",{ref_key:"scrollView",ref:$,class:v(["video_card",{works_video_card:0==I.value,my_video_card:1==I.value}])},[(t(!0),a(E,null,h(e.videoDate,((r,d)=>(t(),a("div",{class:"video_item bg-white dark:bg-[#222325]",key:r.id},[l("div",null,[l("video",{src:r.mp4,poster:r.cover||f("/static/png/videoBg-fde5e17c.png"),preload:"none",style:{width:"100%","object-fit":"fill"}},null,8,Ve),l("div",{class:"play bg-[#0003037D] bg-[#0010107E] border border-[#fff] dark:border-[#111113]",onClick:e=>function(e){k.value=!0,_.value=e}(r)},i[1]||(i[1]=[l("img",{src:"/static/svg/play-d7949893.svg",style:{margin:"12px 32px"}},null,-1)]),8,Te)]),l("div",Ue,[l("div",ze,[l("div",Oe,[1==I.value?(t(),a("span",{key:0,style:{"margin-right":"20px"},class:"delay",onClick:e=>Z(r)},[c(f(M),{size:"12"},{default:C((()=>[c(f(X))])),_:1}),i[2]||(i[2]=w(" 延时5秒 "))],8,Pe)):x("",!0),l("span",Ne,b(null==r.title?e.title:r.title),1)]),l("div",Se,b(f(R)(r.createdAt)),1)]),l("div",Ge,b(r.intro),1)]),1==I.value?(t(),j(f(J),{key:0,onPositiveClick:e=>{return t={...r,index:d},void H("updateMyVideoDate",t,"remove");var t},style:y(O.value?"background:#19191B":"background:#F8F9F9")},{trigger:C((()=>[l("div",Le,[l("div",{class:v(["delete-icon",O.value?"icon-delete-copy":"delete-icon"])},null,2),i[3]||(i[3]=l("span",null,"删除",-1))])])),default:C((()=>[i[4]||(i[4]=w(" 您确认要删除任务吗？ "))])),_:2},1032,["onPositiveClick","style"])):x("",!0)])))),128)),e.videoDate&&1==I.value?(t(!0),a(E,{key:0},h(e.generateInfo,(r=>(t(),a("div",{class:"video_item bg-[#F0F0F0] dark:bg-[#222325]",key:r.id},[c(f(V),{style:{width:"100%",height:"230px","padding-top":"0 !important"}},{description:C((()=>i[5]||(i[5]=[w(" 视频生成中 ")]))),_:1}),l("div",He,[l("div",$e,[l("div",Re,b(""==r.title?e.title:r.title),1),l("div",Je,b(f(R)(r.createdAt)),1)]),l("div",Ke,b(r.intro),1)])])))),128)):x("",!0)],2),c(f(U),{show:k.value,"mask-closable":!1},{default:C((()=>[l("div",We,[l("div",Xe,[l("div",Ye,b(null==_.value.title?e.title:_.value.title),1),l("div",{class:"close_btn",onClick:i[0]||(i[0]=e=>k.value=!1)},i[6]||(i[6]=[l("img",{src:T},null,-1)]))]),l("div",Ze,[l("video",{controls:"",src:_.value.mp4,preload:"auto",ref_key:"videoPlayer",ref:A,onLoadeddata:K,autoplay:"",style:{width:"100%",height:"350px"}},null,40,qe)])])])),_:1},8,["show"])]))}}),[["__scopeId","data-v-2ecf5029"]]),et={class:"video_content"},tt={style:{display:"flex","align-items":"center",padding:"0 12px"}},at=r(e({__name:"VideoContentMain",props:{generateInfo:Array,succeedVideo:Array,title:{type:String,default:"匿名"}},emits:["setGenerateInfo"],setup(e,{emit:r}){const i=s(),d=p(),x=o([]),g=o([]),m=n((()=>i.videoTabIndex||0)),E=o(!1),h=o(!1),b={page:1,size:20},y=r;B((()=>m.value),(e=>{f()}));const f=()=>{x.value=[],g.value=[],b.page=1,E.value=!1,0==m.value?_():C()};function F(e){i.updateVideoTabIndex(e)}const k=()=>{b.page=b.page+1,0==m.value?_():C()};async function _(){var e;try{h.value=!0;const t=await H({...b,modelType:"video"});let a=(null==(e=null==t?void 0:t.data)?void 0:e.records)||[],l=[];a.forEach((async e=>{e.intro=e.prompt.split("--")[0].split("prompt ")[1],e.mp4&&l.push(e)})),1===b.page?x.value=l:x.value=x.value.concat(l),a.length<b.size&&(E.value=!0),h.value=!1}catch(t){h.value=!1,1!==b.page&&(b.page=b.page-1)}}async function C(){var e;try{h.value=!0;const t=await G({...b,modelType:"video",order:"createAt"});let a=(null==(e=null==t?void 0:t.data)?void 0:e.records)||[],l=[];a.reverse(),a.forEach((async e=>{if(0!=e.children.length&&(e.children[0].intro=e.prompt.split("--")[0].split("prompt ")[1],e.children[0].mp4)){const t={...e.children[0],conversationOptions:e.conversationOptions,model:e.model,prompt:e.prompt};l.push(t)}})),l.sort(((e,t)=>new Date(e.createdAt)-new Date(t.createdAt))),1===b.page?g.value=l:g.value.unshift(...l),a.length<b.size&&(E.value=!0),h.value=!1}catch(t){h.value=!1,1!==b.page&&(b.page=b.page-1)}}const w=(e,t="")=>{e&&("add"==t?g.value.push(e):"remove"==t&&O({id:e.id}).then((t=>{d.success("删除成功"),b.page=1,g.value.splice(e.index,1)})).catch((e=>{e.message&&d.error(e.message)})))},A=e=>{y("setGenerateInfo",e)};return u((()=>{f()})),(r,i)=>(t(),a("div",et,[l("div",tt,[l("div",{class:v([0==m.value?"selected_type_tab bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent":"type_tab","dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"]),onClick:i[0]||(i[0]=e=>F(0))},"作品广场 ",2),l("div",{class:v([1==m.value?"selected_type_tab bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent":"type_tab","dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"]),onClick:i[1]||(i[1]=e=>F(1))},"我的作品 ",2)]),c(Qe,{videoDate:0==m.value?x.value:g.value,videoNum:0==m.value?x.value.length:g.value.length,generateInfo:e.generateInfo,title:e.title,noMore:E.value,loading:h.value,onUpdatePage:k,onUpdateMyVideoDate:w,onSetGenerateInfo:A},null,8,["videoDate","videoNum","generateInfo","title","noMore","loading"]),c($,{class:"end bg-[#F8F9F9] dark:bg-[#19191B] text-[#A3A5A6] dark:text-[#76777A]"})]))}}),[["__scopeId","data-v-a82fb1c5"]]),lt={style:{display:"flex"}},rt=e({__name:"Luma",setup(e){u((()=>{l("326px","36px")}));const l=(e="20px",t="25")=>{const a=document.getElementById("toolbar-box");a.style.right=e,a.style.bottom=t},r=o([]);function i(e,t){r.value=e}return(e,l)=>(t(),a("div",lt,[c(at,{title:"Luma",generateInfo:r.value,onSetGenerateInfo:i},null,8,["generateInfo"]),c(Me,{onGenerateInfo:i})]))}});export{rt as default};
