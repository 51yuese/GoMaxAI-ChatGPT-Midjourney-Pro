import{A as e}from"../aboutUs copy/aboutUs copy.00e842a0.js";import{T as a}from"../index/index.10bfe8ee.js";import{g as t,f as s}from"../video/video.4470e7ea.js";import{g as o,m as r,h as i}from"../music/music.8ead5ca7.js";import{e as n,r as d,W as l,R as p,j as u,O as c,P as m,a1 as g,p as v,_ as f,N as h,as as y,b9 as w}from"../main-33bcbc1f.js";import{u as b}from"../useUpload/useUpload.b031f059.js";const T={style:{display:"flex",height:"100%"}},x={style:{width:"100%"},class:"bg-[#fff] dark:bg-[#24252B]"},O=n({__name:"index",setup(n){const{selectFileByImageAndVideo:O}=b(),P=d("/api/file/upload"),j=l(),A=["succeeded","completed","succeed"],D=p(),S=u((()=>D.isLogin)),I={page:1,size:20},L=d(0),q=d({data:[],styleData:[],hasMore:!1,loading:!1,generate:!1});return D.getVideoData(),async function(){try{const e=await t({dictType:"video-style",dictName:"",page:1,size:30});q.value.styleData=e.data.rows}catch(e){j.error(e.message)}}(),function(){try{setInterval((()=>{if(1===L.value){const e=q.value.data.filter((e=>"error"!==e.status&&(!A.includes(e.status)||"usesLeft"===e.type||null===e.cover))).map((e=>e.id));e.length&&(D.getUserInfo(),o({ids:e.join()}).then((e=>{1===L.value&&e.data.forEach((e=>{if(null!=e.errMsg){j.error(e.errMsg);const a=q.value.data.findIndex((a=>a.id==e.id));a>-1&&q.value.splice(a,1)}else if(A.includes(e.answer)){const a=q.value.data.findIndex((a=>a.id==e.id));a>-1&&(q.value.data[a]={...e.children[0],modelSubType:e.modelSubType,conversationOptions:e.conversationOptions,id:e.id,requestParams:e.requestParams,generateLoading:!1,model:e.model,prompt:e.prompt,status:e.answer})}}))})))}}),3e3)}catch(e){console.log(e),j.error(e.message)}}(),v("videoBase",{list:async function(e,a,t){return t>0?I.page=t:I.page++,L.value=e,new Promise((async(t,s)=>{var o;let n={};n=0==e?await r({...I,modelType:"video",modelSubType:a}):await i({...I,modelType:"video",order:"createAt",modelSubType:a});let d=(null==(o=null==n?void 0:n.data)?void 0:o.records)||[],l=[];d.reverse(),d.forEach((async e=>{if(e.errMsg)l.push({conversationOptions:e.conversationOptions,id:e.id,modelSubType:e.modelSubType,requestParams:e.requestParams,model:e.model,prompt:e.prompt,generateLoading:!1,intro:e.prompt.indexOf("prompt ")>-1?e.prompt.split("--")[0].split("prompt ")[1]:e.prompt,createdAt:e.createdAt,status:"error"});else if(e.children&&e.children.length>0){const a=e.children.find((e=>e.mp4));a&&(e.prompt.indexOf("prompt ")>-1?a.intro=e.prompt.split("--")[0].split("prompt ")[1]:a.intro=e.prompt);const t={...a||e.children[0],conversationOptions:e.conversationOptions,modelSubType:e.modelSubType,model:e.model,prompt:e.prompt,status:e.answer,requestParams:e.requestParams};l.push(t)}else l.push({...e})})),l.sort(((e,a)=>new Date(e.createdAt)-new Date(a.createdAt))),1===I.page?q.value.data=l:q.value.data.unshift(...l),d.length<I.size&&(q.value.noMore=!0),q.value.loading=!1,t(n)}))},remove:function(e){w({id:e}).then((a=>{j.success("删除成功");const t=q.value.data.findIndex((a=>a.id===e));q.value.data.splice(t,1)})).catch((e=>{e.message&&j.error(e.message)}))},create:function(e,a){return q.value.generate=!0,new Promise((t=>{if(S.value){const o=e();s(o,a).then((e=>{o.id=e.data.id,o.createdAt=e.data.createdAt,o.intro=e.data.prompt.split("--")[0].split("prompt ")[1],o.status="pedding",1===L.value&&q.value.data.push(o),q.value.generate=!1,D.getVideoData(),t(e)})).catch((e=>{q.value.generate=!1,j.error(e.message),t(!1)}))}else D.setLoginDialog(!0),q.value.generate=!1,t(!1)}))},uploadFile:async function(e){return new Promise((async(e,a)=>{try{const a=await O();await y.post(P.value,{file:a},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{console.log(a),200==a.data.code?e(a.data.data):j.error(null==a.data.message?a.data.data:a.data.message)}))}catch(t){j.error(t.message),e(!1)}}))},videoData:q,getIsLogin:()=>D.isLogin}),(t,s)=>{const o=f("RouterView");return h(),c("div",T,[m("div",x,[g(o,{style:{height:"calc(100vh - 68px)"},class:"bg-[#F8F9F9] dark:bg-[#19191B]"})]),g(e),g(a)])}}});export{O as default};
