import{e,R as a,bh as t,aj as l,r,j as s,S as n,a0 as o,a2 as i,A as u,k as d,a3 as v,O as c,P as f,H as p,Z as h,_ as m,a5 as y,N as g,U as w,W as k,T as x,a6 as b,a7 as _,X as C,a4 as E,F,ab as j,a9 as I,aa as D,a8 as S,$,a1 as q}from"../main-6c725c30.js";import{t as z}from"../throttle/throttle.33f09de3.js";const L={class:"overflow-hidden pr-0 h-full flex flex-col"},T={class:"market overflow-y-auto flex-1 min-h-screen h-[100vh] relative itemContent"},A=["id"],M=["id","src","onLoad","onError"],W=["onClick"],B=e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:b}){var _;const C=a();null==(_=t())||_.appContext.config.globalProperties.$viewerApi,l();const E=r([]),F=r({}),j=r(0),I=r(160),D=r(0),S=r(10),$=r(10),q=r([]),B=r(null),R=r(0);s((()=>C.isLogin));const Q=r(30),U=r(""),N=s((()=>Q.value+S.value+150));n();const O=e,P=r();o.on("newData",(e=>{P.value=e}));const V=i({page:1,size:999,rec:1,squareType:O.type,keyword:""});function H(){!function(){const{showName:e=0,showOther:a=0}={};j.value=15*[e,a].filter((e=>e)).length}(),function(){if(!B.value)return;const e=B.value.clientWidth;D.value=Math.floor(e/N.value);const a=e-D.value*N.value,t=(D.value-1)*S.value;a-t<0&&(D.value-=1);I.value=Math.floor((e-t)/D.value)}();const e=D.value,a=I.value,t=[];K.value.forEach(((l,r)=>{let s=200,n=300;l.fileInfo&&(s=l.fileInfo.width||s,n=l.fileInfo.height||n);const o=n*(a/s)+$.value+j.value,i=F.value[l.id];if(t.length<e)i.style.top="0px",i.style.left=(a+S.value)*r+"px",t.push(o);else{const e=Math.min.apply(null,t),a=t.findIndex((a=>a===e));i.style.top=`${e+0}px`,i.style.left=a*(I.value+S.value)+"px",t[a]+=o}})),R.value=Math.max(...t)+130}const K=s((()=>P.value?P.value.rows:U.value?E.value.filter((e=>{const{prompt:a}=e;return a.includes(U.value)})):E.value));u(Q,(()=>{H()}));let X=null;async function Z(){let e=(await y(V)).data.rows;e.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),E.value=e}u(K,(()=>{K.value.length&&(clearTimeout(X),X=setTimeout((()=>{H()}),300))}));const G=s((()=>e=>{let a=200,t=300;return e.fileInfo&&(a=e.fileInfo.width,t=e.fileInfo.height),t/(a/I.value)})),J=z((function(){H()}),200);return d((async()=>{await Z(),H(),window.addEventListener("resize",J)})),b({handleQuery:e=>{V.keyword="",V.squareType=e,Z(),H()},handleSearch:e=>{V.squareType="",V.keyword=e,Z(),H()}}),v((()=>{window.removeEventListener("resize",J)})),(e,a)=>(g(),c("div",L,[f("div",T,[f("div",{id:"wapper",ref_key:"wapperRef",ref:B,class:"wapper",style:p({height:`${R.value}px`})},[(g(!0),c(h,null,m(K.value,((e,t)=>(g(),c("div",{id:e.id,key:t,ref_for:!0,ref:a=>function(e,a){e&&a&&(F.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${I.value}px`})},[w(x,{name:"img",css:!0},{default:k((()=>[f("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${I.value}px`,height:`${G.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){q.value.push(a.id)}(0,e),onError:a=>function(e,a){q.value.push(a.id)}(0,e)},null,44,M)])),_:2},1024),f("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},a[0]||(a[0]=[f("div",null,"查看详情",-1)]),8,W)],12,A)))),128))],4)])]))}}),R={style:{padding:"15px 24px 0 24px"},class:"bg-[#F8F9F9] dark:bg-[#111113]"},Q={class:"topBox"},U={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},N={class:"relative z-40 transition-300 ease"},O={class:"flex justify-start items-center",ref:"tabListRef"},P=["onClick"],V={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},H={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},K={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},X={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},Z={class:"flex-1 marketBox"},G=q(e({__name:"square",setup(e){const{isMobile:a}=b(),t=r(""),l=r(),n=_(),i=s((()=>"dark"===n.theme)),u=r([]);(async()=>{const e=await I({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""}].concat(e)||D,l.value.handleQuery(t.value)})();r("");const d=r("");function v(e){13==e.keyCode&&l.value.handleSearch(d.value)}return(e,r)=>(g(),c("div",R,[f("div",Q,[C(a)?E("",!0):(g(),c("div",U,[f("div",N,[f("ul",O,[(g(!0),c(h,null,m(u.value,(e=>(g(),c("li",{onClick:a=>{return r=e,t.value=r.value,l.value.handleQuery(r.value),void o.emit("newData","");var r},class:S(["mr-1 ml-1 w-auto select-none cursor-pointer bg-white hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-r hover:from-[#957DF4] hover:to-[#3C69E7] dark:hover:from-transparent dark:hover:to-transparent dark:border dark:border-[transparent] dark:hover:border-[#23A559] duration-300 flex rounded-lg",[e.value===t.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"bg-white dark:bg-transparent"]])},[f("div",V,$(e.name),1)],10,P)))),256))],512)])])),f("div",H,[i.value?(g(),c("img",K)):(g(),c("img",X)),F(f("input",{type:"text",onKeydown:v,name:"","onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),id:"",placeholder:"请输入关键词"},null,544),[[j,d.value]])])]),f("div",Z,[w(B,{ref_key:"marketRef",ref:l,type:t.value,keyWord:d.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-d61bc6fe"]]);export{G as default};
