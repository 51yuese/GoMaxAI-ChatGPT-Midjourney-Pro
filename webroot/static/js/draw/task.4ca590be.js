import{M as a}from"../index/index.172d9535.js";import{e,r as t,k as r,aV as o,O as s,P as d,a8 as n,a3 as i,a4 as l,aA as u,N as c,ag as b,aB as v,aE as k,aD as g,aC as p,K as m,ad as f}from"../main-33bcbc1f.js";import{a as w}from"../index/index.27c727e8.js";import"../draw-fail/draw-fail.ad8fd01b.js";import"../index/index.5b75f753.js";import"../index/index.9bea5fab.js";import"./draw.be7c76b3.js";import"../HeartOutline/HeartOutline.864ab73b.js";import"../Popconfirm/Popconfirm.372e0cee.js";const F={class:"mj-task-view bg-[#F8F9F9] dark:bg-[#111113]"},x={class:"view-title"},A=f(e({__name:"task",setup(e){let f=[];const A=t(!1),h=t(!1),j=t([]);let E=null;const I=async function(){E&&window.clearTimeout(E);try{(await v({jobIds:f.join()})).data.forEach((a=>{const e=j.value.findIndex((e=>e.id===a.id));-1!==e&&j.value.splice(e,1,a),a.status>=3&&(f=f.filter((e=>e!==a.jobId)))})),f.length?E=setTimeout((()=>I()),3e3):E&&window.clearTimeout(E)}catch(a){E=setTimeout((()=>I()),3e3)}},T={page:1,size:20},_=async function(){try{h.value=!0;const a=await u({...T,status:C.value>=0?C.value:0,favorite:1==C.value?C.value:0});1===T.page?j.value=a.data.rows:j.value=j.value.concat(a.data.rows),f=j.value.filter((a=>[1,2].includes(a.status))).map((a=>a.jobId)),f.length&&I(),a.data.rows.length<T.size&&(A.value=!0),h.value=!1}catch(a){h.value=!1,1!==T.page&&(T.page=T.page-1)}},C=t(0),y=function(a){C.value=a,A.value=!1,T.page=1,_()},M=async function(a){let e=null;switch(a.type){case w.TEXT_TO_IMAGE:case w.IMAGE_ACTION:e=await p(a);break;case w.IMAGE_MIX_IMAGE:case w.IMAGE_TO_TEXT:e=await g(a);break;case w.INSIGHT_FACE:e=await k(a)}if(e){const a=e.data;j.value.find((e=>e.id===a.id))||(j.value.push(a),m((()=>{var a;null==(a=B.value)||a.scrollTo({top:0,behavior:"smooth"})}))),a.status<3&&!f.includes(a.jobId)&&(f.push(a.jobId),I())}},B=t(),D=function(a){const e=a.target,{scrollTop:t,offsetHeight:r,scrollHeight:o}=e;o-r-t<=40&&(A.value||h.value||(T.page=T.page+1,_()))};return r((()=>{var a;_(),null==(a=B.value)||a.addEventListener("scroll",D)})),o((()=>{var a;null==(a=B.value)||a.removeEventListener("scroll",D)})),(e,t)=>(c(),s("div",F,[d("div",x,[d("div",{class:n(["title-btn",0===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[0]||(t[0]=a=>y(0))},"全部",2),d("div",{class:n(["title-btn",2===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[1]||(t[1]=a=>y(2))},"执行中",2),d("div",{class:n(["title-btn",3===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[2]||(t[2]=a=>y(3))},"已完成",2),d("div",{class:n(["title-btn",4===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[3]||(t[3]=a=>y(4))},"已失效",2),d("div",{class:n(["title-btn",1===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[4]||(t[4]=a=>y(1))},"我的收藏",2)]),d("div",{class:"main-view",ref_key:"scrollView",ref:B},[(c(!0),s(i,null,l(j.value,((e,t)=>(c(),b(a,{key:e.jobId,task:e,onRemove:()=>function(a){j.value.splice(a,1)}(t),onAddTask:M,type:"task"},null,8,["task","onRemove"])))),128))],512)]))}}),[["__scopeId","data-v-a8b84a64"]]);export{A as default};
