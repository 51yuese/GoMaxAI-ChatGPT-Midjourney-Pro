import{e,O as a,bh as l,an as t,r as s,j as n,P as r,Y as o,a0 as i,A as u,k as v,a1 as d,R as c,S as f,H as p,U as h,W as m,a5 as y,Q as g,a2 as w,a3 as x,T as k,a6 as b,a7 as F,a8 as _,a4 as I,F as j,af as C,aa as S,ab as $,a9 as q,X as z,$ as A}from"../main-f2e6132a.js";import{t as D}from"../throttle/throttle.33f09de3.js";const E={class:"overflow-hidden pr-0 h-full flex flex-col"},L={class:"market overflow-y-auto flex-1 min-h-screen h-[100vh] relative itemContent"},T=["id"],M=["id","src","onLoad","onError"],W=["onClick"],B=[f("div",null,"查看详情",-1)],Q=e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:b}){var F;const _=a();null==(F=l())||F.appContext.config.globalProperties.$viewerApi,t();const I=s([]),j=s({}),C=s(0),S=s(160),$=s(0),q=s(10),z=s(10),A=s([]),Q=s(null),R=s(0);n((()=>_.isLogin));const U=s(30),O=s(""),P=n((()=>U.value+q.value+150));r();const V=e,H=s();o.on("newData",(e=>{H.value=e}));const K=i({page:1,size:999,rec:1,squareType:V.type,keyword:""});function N(){!function(){const{showName:e=0,showOther:a=0}={};C.value=15*[e,a].filter((e=>e)).length}(),function(){if(!Q.value)return;const e=Q.value.clientWidth;$.value=Math.floor(e/P.value);const a=e-$.value*P.value,l=($.value-1)*q.value;a-l<0&&($.value-=1);S.value=Math.floor((e-l)/$.value)}();const e=$.value,a=S.value,l=[];X.value.forEach(((t,s)=>{let n=200,r=300;t.fileInfo&&(n=t.fileInfo.width||n,r=t.fileInfo.height||r);const o=r*(a/n)+z.value+C.value,i=j.value[t.id];if(l.length<e)i.style.top="0px",i.style.left=(a+q.value)*s+"px",l.push(o);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));i.style.top=`${e+0}px`,i.style.left=a*(S.value+q.value)+"px",l[a]+=o}})),R.value=Math.max(...l)+130}const X=n((()=>H.value?H.value.rows:O.value?I.value.filter((e=>{const{prompt:a}=e;return a.includes(O.value)})):I.value));u(U,(()=>{N()}));let Y=null;async function G(){let e=(await y(K)).data.rows;e.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),I.value=e}u(X,(()=>{X.value.length&&(clearTimeout(Y),Y=setTimeout((()=>{N()}),300))}));const J=n((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/S.value)})),Z=D((function(){N()}),200);return v((async()=>{await G(),N(),window.addEventListener("resize",Z)})),b({handleQuery:e=>{K.keyword="",K.squareType=e,G(),N()},handleSearch:e=>{K.squareType="",K.keyword=e,G(),N()}}),d((()=>{window.removeEventListener("resize",Z)})),(e,a)=>(g(),c("div",E,[f("div",L,[f("div",{id:"wapper",ref_key:"wapperRef",ref:Q,class:"wapper",style:p({height:`${R.value}px`})},[(g(!0),c(h,null,m(X.value,((e,a)=>(g(),c("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(j.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${S.value}px`})},[w(k,{name:"img",css:!0},{default:x((()=>[f("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${S.value}px`,height:`${J.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){A.value.push(a.id)}(0,e),onError:a=>function(e,a){A.value.push(a.id)}(0,e)},null,44,M)])),_:2},1024),f("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},B,8,W)],12,T)))),128))],4)])]))}}),R={style:{padding:"15px 24px 0 24px"},class:"bg-[#F8F9F9] dark:bg-[#111113]"},U={class:"topBox"},O={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},P={class:"relative z-40 transition-300 ease"},V={class:"flex justify-start items-center",ref:"tabListRef"},H=["onClick"],K={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},N={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},X={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},Y={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},G={class:"flex-1 marketBox"},J=A(e({__name:"square",setup(e){const{isMobile:a}=b(),l=s(""),t=s(),r=F(),i=n((()=>"dark"===r.theme)),u=s([]);(async()=>{const e=await S({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""}].concat(e)||$,t.value.handleQuery(l.value)})();s("");const v=s("");function d(e){13==e.keyCode&&t.value.handleSearch(v.value)}return(e,s)=>(g(),c("div",R,[f("div",U,[_(a)?I("",!0):(g(),c("div",O,[f("div",P,[f("ul",V,[(g(!0),c(h,null,m(u.value,(e=>(g(),c("li",{onClick:a=>{return s=e,l.value=s.value,t.value.handleQuery(s.value),void o.emit("newData","");var s},class:q(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#10A37F] to-[#10A37F] duration-300 flex rounded-3xl",[e.value===l.value?"text-[#fff] bg-gradient-to-l from-[#10A37F] to-[#10A37F]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[f("div",K,z(e.name),1)],10,H)))),256))],512)])])),f("div",N,[i.value?(g(),c("img",X)):(g(),c("img",Y)),j(f("input",{type:"text",onKeydown:d,name:"","onUpdate:modelValue":s[0]||(s[0]=e=>v.value=e),id:"",placeholder:"请输入关键词"},null,544),[[C,v.value]])])]),f("div",G,[w(Q,{ref_key:"marketRef",ref:t,type:l.value,keyWord:v.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-9431ea1d"]]);export{J as default};
