import{e,k as a,J as l,p as t,r,g as s,l as o,I as i,K as n,L as u,q as d,M as v,w as c,x as f,B as p,G as h,y as m,O as g,D as w,F as y,E as k,A as x,P as b,Q as C,C as I,T as E,z as _,R as j,S as z,U as $,W as q,_ as D,a6 as S,Z as M,a2 as L,a0 as T,a9 as B,$ as F}from"../main-4156cf5e.js";import{I as U}from"../mj-menu/mj-menu.41e6da46.js";import{_ as W,a as A}from"../dianzan/dianzan.4417d952.js";import{f as R}from"../ppt/ppt.22762407.js";import{t as P}from"../throttle/throttle.33f09de3.js";import{N as Q}from"../Carousel/Carousel.c774b3cc.js";const K={class:"overflow-hidden pr-0 h-full flex flex-col"},N={class:"market overflow-y-auto flex-1 relative itemContent"},O=["onClick","src"],V=["id"],G=["id","src","onLoad","onError"],H=["onClick"],J={class:"bottomInfoBox"},Z={class:"userInfo"},X=["src"],Y=["onClick"],ee={key:0,src:W,class:"dianzan",alt:""},ae={key:1,src:A,class:"dianzan",alt:""},le=D(e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:D}){var S;const M=a();null==(S=l())||S.appContext.config.globalProperties.$viewerApi,t();const L=r([]),T=r({}),B=r(0),F=r(160),U=r(0),W=r(10),A=r(10),le=r([]),te=r(null),re=r(0),se=s((()=>M.isLogin)),oe=r(30),ie=r(""),ne=s((()=>oe.value+W.value+250)),ue=o(),de=e,ve=r();i.on("newData",(e=>{ve.value=e}));const ce=n({page:1,size:999,rec:1,squareType:de.type,keyword:""});function fe(){!function(){const{showName:e=0,showOther:a=0}={};B.value=15*[e,a].filter((e=>e)).length}(),function(){if(!te.value)return;const e=te.value.clientWidth;U.value=Math.floor(e/ne.value);const a=e-U.value*ne.value,l=(U.value-1)*W.value;a-l<0&&(U.value-=1);F.value=Math.floor((e-l)/U.value),console.log(F.value,"realWidth.value")}();const e=U.value,a=F.value,l=[];he.value.forEach(((t,r)=>{let s=200,o=300;t.fileInfo&&(s=t.fileInfo.width||s,o=t.fileInfo.height||o);const i=o*(a/s)+A.value+B.value,n=T.value[t.id];if(l.length<e)n.style.top="0px",n.style.left=(a+W.value)*r+"px",l.push(i);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));n.style.top=`${e+0}px`,n.style.left=a*(F.value+W.value)+"px",l[a]+=i}})),re.value=Math.max(...l)+130}function pe(e,a){e&&a&&(T.value[a.id]=e)}const he=s((()=>ve.value?ve.value.rows:ie.value?L.value.filter((e=>{const{prompt:a}=e;return a.includes(ie.value)})):L.value));u(oe,(()=>{fe()}));let me=null;async function ge(){let e;e="fav"===ce.squareType?await z({page:ce.page,size:ce.size}):await $(ce);let a=[{id:"wapper-carousel",noShow:!0,fileInfo:{width:1024,height:1024}},{id:"wapper-carousel2",noShow:!0,fileInfo:{width:1024,height:1024}},...e.data.rows];a.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),L.value=a}u(he,(()=>{he.value.length&&(clearTimeout(me),me=setTimeout((()=>{fe()}),300))}));const we=s((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/F.value)})),ye=P((function(){fe()}),200);let ke=r([]);d((async()=>{await ge(),fe(),window.addEventListener("resize",ye),R({code:"MjRcMarquee"}).then((e=>{var a;ke.value=null==(a=e.data)?void 0:a.recMarquee,ke.value.forEach((e=>{e.fileInfo={width:1024,height:1024}}))}))})),D({handleQuery:e=>{ce.keyword="",ce.squareType=e,ge(),fe()},handleSearch:e=>{ce.squareType="",ce.keyword=e,ge(),fe()}}),v((()=>{window.removeEventListener("resize",ye)}));const xe=r(0);return(e,a)=>(c(),f("div",K,[p("div",N,[p("div",{id:"wapper",ref_key:"wapperRef",ref:te,class:"wapper",style:h({height:`${re.value}px`})},[m(ke).length>0?(c(),g(m(Q),{key:0,class:"wapper-item",id:"wapper-carousel",ref:e=>pe(e,{id:"wapper-carousel"}),style:h([{width:2*F.value+10+"px",height:`${we.value(m(ke)[0])}px`},{"border-radius":"8px",overflow:"hidden"}]),draggable:""},{default:w((()=>[(c(!0),f(y,null,k(m(ke),((e,a)=>(c(),f("img",{class:"carousel-img",onClick:a=>(e=>{if(!(e.targetUrl.indexOf("http")>-1))return se.value?void ue.push(e.targetUrl):(M.setLoginDialog(!0),void i.emit("register",0));window.open(e.targetUrl)})(e),style:h({width:2*F.value+10+"px",height:`${we.value(e)}px`}),src:e.url},null,12,O)))),256))])),_:1},8,["style"])):x("",!0),(c(!0),f(y,null,k(he.value,((a,l)=>{var t,r;return b((c(),f("div",{id:a.id,key:l,ref_for:!0,ref:e=>pe(e,a),class:"wapper-item",style:h({width:`${F.value}px`})},[I(E,{name:"img",css:!0},{default:w((()=>[p("img",{id:a.id,class:"item-file rounded-sm",style:h({width:`${F.value}px`,height:`${we.value(a)}px`}),src:a.src,loading:"lazy",onLoad:e=>function(e,a){le.value.push(a.id)}(0,a),onError:e=>function(e,a){le.value.push(a.id)}(0,a)},null,44,G)])),_:2},1024),p("div",{class:"menu",onClick:e=>function(e){i.emit("Details",!0),i.emit("DetailsData",e)}(a)},[p("div",null,_(e.$t("homePage.lookDetail")),1)],8,H),p("div",J,[p("div",Z,[p("img",{src:(null==(t=a.userInfo)?void 0:t.avatar)||m(j),class:"smallHead",alt:""},null,8,X),p("span",null,_((null==(r=a.userInfo)?void 0:r.nickname)||e.$t("homePage.official")),1)]),p("div",{class:"userInfo",onClick:e=>function(e){let a={id:e.id,favorite:e.isCollect?0:1};1!=xe.value&&(xe.value=1,q(a).then((e=>{ge(),fe(),xe.value=0})))}(a)},[a.isCollect?(c(),f("img",ee)):(c(),f("img",ae)),p("span",null,_(a.collectNum||0),1)],8,Y)])],12,V)),[[C,!a.noShow]])})),128))],4)])]))}}),[["__scopeId","data-v-2133830c"]]),te={style:{padding:"15px 24px 0 24px",height:"100%"},class:"bg-[#F8F9F9] dark:bg-[#181818]"},re={class:"topBox"},se={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},oe={class:"relative z-40 transition-300 ease"},ie={class:"flex justify-start items-center",ref:"tabListRef"},ne=["onClick"],ue={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},de={class:"searchBox bg-[#fff] dark:bg-[#19191B]"},ve={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},ce={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},fe=["placeholder"],pe={class:"flex-1 marketBox"},he=D(e({__name:"square",setup(e){const{isMobile:a}=S(),l=r(""),t=r(),o=M(),n=s((()=>"dark"===o.theme)),u=r([]);(async()=>{const e=await B({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:F("common.all"),value:""},{name:F("common.myCollection"),value:"fav"}].concat(e)||U,t.value.handleQuery(l.value)})();r("");const d=r("");function v(e){13==e.keyCode&&t.value.handleSearch(d.value)}return(e,r)=>(c(),f("div",te,[p("div",re,[m(a)?x("",!0):(c(),f("div",se,[p("div",oe,[p("ul",ie,[(c(!0),f(y,null,k(u.value,(e=>(c(),f("li",{onClick:a=>{return r=e,l.value=r.value,t.value.handleQuery(r.value),void i.emit("newData","");var r},class:L(["mr-1 ml-1 w-auto select-none cursor-pointer bg-white hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-r hover:from-[#957DF4] hover:to-[#3C69E7] dark:hover:from-transparent dark:hover:to-transparent dark:border dark:border-[transparent] dark:hover:border-[#3E6AE7] duration-300 flex rounded-lg",[e.value===l.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#3E6AE7] bg-[#dae7e6] border-0 dark:border dark:border-[#3E6AE7]":"bg-white dark:bg-transparent"]])},[p("div",ue,_(e.name),1)],10,ne)))),256))],512)])])),p("div",de,[n.value?(c(),f("img",ve)):(c(),f("img",ce)),b(p("input",{type:"text",onKeydown:v,name:"","onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),id:"",placeholder:e.$t("draw.inputKeywords")},null,40,fe),[[T,d.value]])])]),p("div",pe,[I(le,{ref_key:"marketRef",ref:t,type:l.value,keyWord:d.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-c8cdda53"]]);export{he as default};
