import{M as a}from"../index/index.e3065903.js";import{e,r as t,k as r,a$ as o,O as s,P as d,a8 as n,Z as i,_ as l,ax as u,N as c,ak as b,ay as v,aB as k,aA as g,az as p,K as m,a1 as f}from"../main-6c725c30.js";import{a as w}from"../index/index.27c727e8.js";import"../draw-fail/draw-fail.ad8fd01b.js";import"../index/index.5b75f753.js";import"../index/index.c5596e0e.js";import"./draw.3889f162.js";import"../Popconfirm/Popconfirm.534000dc.js";const F={class:"mj-task-view bg-[#F8F9F9] dark:bg-[#111113]"},x={class:"view-title"},A=f(e({__name:"task",setup(e){let f=[];const A=t(!1),h=t(!1),I=t([]);let j=null;const E=async function(){j&&window.clearTimeout(j);try{(await v({jobIds:f.join()})).data.forEach((a=>{const e=I.value.findIndex((e=>e.id===a.id));-1!==e&&I.value.splice(e,1,a),a.status>=3&&(f=f.filter((e=>e!==a.jobId)))})),f.length?j=setTimeout((()=>E()),3e3):j&&window.clearTimeout(j)}catch(a){j=setTimeout((()=>E()),3e3)}},T={page:1,size:20},_=async function(){try{h.value=!0;const a=await u({...T,status:C.value>=0?C.value:0,favorite:1==C.value?C.value:0});1===T.page?I.value=a.data.rows:I.value=I.value.concat(a.data.rows),f=I.value.filter((a=>[1,2].includes(a.status))).map((a=>a.jobId)),f.length&&E(),a.data.rows.length<T.size&&(A.value=!0),h.value=!1}catch(a){h.value=!1,1!==T.page&&(T.page=T.page-1)}},C=t(0),y=function(a){C.value=a,A.value=!1,T.page=1,_()},G=async function(a){let e=null;switch(a.type){case w.TEXT_TO_IMAGE:case w.IMAGE_ACTION:e=await p(a);break;case w.IMAGE_MIX_IMAGE:case w.IMAGE_TO_TEXT:e=await g(a);break;case w.INSIGHT_FACE:e=await k(a)}if(e){const a=e.data;I.value.find((e=>e.id===a.id))||(I.value.push(a),m((()=>{var a;null==(a=M.value)||a.scrollTo({top:0,behavior:"smooth"})}))),a.status<3&&!f.includes(a.jobId)&&(f.push(a.jobId),E())}},M=t(),B=function(a){const e=a.target,{scrollTop:t,offsetHeight:r,scrollHeight:o}=e;o-r-t<=40&&(A.value||h.value||(T.page=T.page+1,_()))};return r((()=>{var a;_(),null==(a=M.value)||a.addEventListener("scroll",B)})),o((()=>{var a;null==(a=M.value)||a.removeEventListener("scroll",B)})),(e,t)=>(c(),s("div",F,[d("div",x,[d("div",{class:n(["title-btn",0===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[0]||(t[0]=a=>y(0))},"全部",2),d("div",{class:n(["title-btn",2===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[1]||(t[1]=a=>y(2))},"执行中",2),d("div",{class:n(["title-btn",3===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[2]||(t[2]=a=>y(3))},"已完成",2),d("div",{class:n(["title-btn",4===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[3]||(t[3]=a=>y(4))},"已失效",2),d("div",{class:n(["title-btn",1===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[4]||(t[4]=a=>y(1))},"我的收藏",2)]),d("div",{class:"main-view",ref_key:"scrollView",ref:M},[(c(!0),s(i,null,l(I.value,((e,t)=>(c(),b(a,{key:e.jobId,task:e,onRemove:()=>function(a){I.value.splice(a,1)}(t),onAddTask:G,type:"task"},null,8,["task","onRemove"])))),128))],512)]))}}),[["__scopeId","data-v-a8b84a64"]]);export{A as default};
