import{e,R as a,bo as t,W as l,r,j as s,S as n,ac as o,ae as i,A as u,k as d,af as v,O as c,P as f,H as p,a3 as h,a4 as m,bp as y,ai as g,N as w,a1 as k,a2 as x,T as b,aJ as E,av as j,a5 as _,a0 as C,F,an as I,bq as q,a8 as z,$ as D,ad as S}from"../main-79c61161.js";import{I as T}from"../mj-menu/mj-menu.41e6da46.js";import{t as $}from"../throttle/throttle.33f09de3.js";const L={class:"overflow-hidden pr-0 h-full flex flex-col"},M={class:"market overflow-y-auto flex-1 min-h-screen h-[100vh] relative itemContent"},A=["id"],W=["id","src","onLoad","onError"],B=["onClick"],R=e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:E}){var j;const _=a();null==(j=t())||j.appContext.config.globalProperties.$viewerApi,l();const C=r([]),F=r({}),I=r(0),q=r(160),z=r(0),D=r(10),S=r(10),T=r([]),R=r(null),Q=r(0);s((()=>_.isLogin));const N=r(30),O=r(""),P=s((()=>N.value+D.value+250));n();const U=e,V=r();o.on("newData",(e=>{V.value=e}));const H=i({page:1,size:999,rec:1,squareType:U.type,keyword:""});function J(){!function(){const{showName:e=0,showOther:a=0}={};I.value=15*[e,a].filter((e=>e)).length}(),function(){if(!R.value)return;const e=R.value.clientWidth;z.value=Math.floor(e/P.value);const a=e-z.value*P.value,t=(z.value-1)*D.value;a-t<0&&(z.value-=1);q.value=Math.floor((e-t)/z.value)}();const e=z.value,a=q.value,t=[];K.value.forEach(((l,r)=>{let s=200,n=300;l.fileInfo&&(s=l.fileInfo.width||s,n=l.fileInfo.height||n);const o=n*(a/s)+S.value+I.value,i=F.value[l.id];if(t.length<e)i.style.top="0px",i.style.left=(a+D.value)*r+"px",t.push(o);else{const e=Math.min.apply(null,t),a=t.findIndex((a=>a===e));i.style.top=`${e+0}px`,i.style.left=a*(q.value+D.value)+"px",t[a]+=o}})),Q.value=Math.max(...t)+130}const K=s((()=>V.value?V.value.rows:O.value?C.value.filter((e=>{const{prompt:a}=e;return a.includes(O.value)})):C.value));u(N,(()=>{J()}));let G=null;async function X(){let e;e="fav"===H.squareType?await y({page:H.page,size:H.size}):await g(H);let a=e.data.rows;a.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),C.value=a}u(K,(()=>{K.value.length&&(clearTimeout(G),G=setTimeout((()=>{J()}),300))}));const Y=s((()=>e=>{let a=200,t=300;return e.fileInfo&&(a=e.fileInfo.width,t=e.fileInfo.height),t/(a/q.value)})),Z=$((function(){J()}),200);return d((async()=>{await X(),J(),window.addEventListener("resize",Z)})),E({handleQuery:e=>{H.keyword="",H.squareType=e,X(),J()},handleSearch:e=>{H.squareType="",H.keyword=e,X(),J()}}),v((()=>{window.removeEventListener("resize",Z)})),(e,a)=>(w(),c("div",L,[f("div",M,[f("div",{id:"wapper",ref_key:"wapperRef",ref:R,class:"wapper",style:p({height:`${Q.value}px`})},[(w(!0),c(h,null,m(K.value,((e,t)=>(w(),c("div",{id:e.id,key:t,ref_for:!0,ref:a=>function(e,a){e&&a&&(F.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${q.value}px`})},[k(b,{name:"img",css:!0},{default:x((()=>[f("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${q.value}px`,height:`${Y.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){T.value.push(a.id)}(0,e),onError:a=>function(e,a){T.value.push(a.id)}(0,e)},null,44,W)])),_:2},1024),f("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},a[0]||(a[0]=[f("div",null,"查看详情",-1)]),8,B)],12,A)))),128))],4)])]))}}),Q={style:{padding:"15px 24px 0 24px"},class:"bg-[#F8F9F9] dark:bg-[#181818]"},N={class:"topBox"},O={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},P={class:"relative z-40 transition-300 ease"},U={class:"flex justify-start items-center",ref:"tabListRef"},V=["onClick"],H={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},J={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},K={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},G={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},X={class:"flex-1 marketBox"},Y=S(e({__name:"square",setup(e){const{isMobile:a}=E(),t=r(""),l=r(),n=j(),i=s((()=>"dark"===n.theme)),u=r([]);(async()=>{const e=await q({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""},{name:"我的收藏",value:"fav"}].concat(e)||T,l.value.handleQuery(t.value)})();r("");const d=r("");function v(e){13==e.keyCode&&l.value.handleSearch(d.value)}return(e,r)=>(w(),c("div",Q,[f("div",N,[_(a)?C("",!0):(w(),c("div",O,[f("div",P,[f("ul",U,[(w(!0),c(h,null,m(u.value,(e=>(w(),c("li",{onClick:a=>{return r=e,t.value=r.value,l.value.handleQuery(r.value),void o.emit("newData","");var r},class:z(["mr-1 ml-1 w-auto select-none cursor-pointer bg-white hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-r hover:from-[#957DF4] hover:to-[#3C69E7] dark:hover:from-transparent dark:hover:to-transparent dark:border dark:border-[transparent] dark:hover:border-[#3E6AE7] duration-300 flex rounded-lg",[e.value===t.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#3E6AE7] bg-[#dae7e6] border-0 dark:border dark:border-[#3E6AE7]":"bg-white dark:bg-transparent"]])},[f("div",H,D(e.name),1)],10,V)))),256))],512)])])),f("div",J,[i.value?(w(),c("img",K)):(w(),c("img",G)),F(f("input",{type:"text",onKeydown:v,name:"","onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),id:"",placeholder:"请输入关键词"},null,544),[[I,d.value]])])]),f("div",X,[k(R,{ref_key:"marketRef",ref:l,type:t.value,keyWord:d.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-b7b9e883"]]);export{Y as default};
