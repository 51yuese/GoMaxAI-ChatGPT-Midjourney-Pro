import{M as a}from"../index/index.e940c092.js";import{e,r as t,q as r,aT as o,w as s,x as d,B as n,a2 as i,z as l,F as u,E as c,O as v,at as b,ax as k,aw as g,av as m,n as p,au as f,_ as w}from"../main-a0b53047.js";import{a as F}from"../index/index.27c727e8.js";import"../draw-fail/draw-fail.ad8fd01b.js";import"../index/index.5b75f753.js";import"../index/index.bfff7796.js";import"./draw.edc6e061.js";import"../HeartOutline/HeartOutline.c4deac56.js";import"../Popconfirm/Popconfirm.a6d67891.js";const x={class:"mj-task-view bg-[#F8F9F9] dark:bg-[#111113]"},h={class:"view-title"},A=w(e({__name:"task",setup(e){let w=[];const A=t(!1),E=t(!1),j=t([]);let I=null;const T=async function(){I&&window.clearTimeout(I);try{(await f({jobIds:w.join()})).data.forEach((a=>{const e=j.value.findIndex((e=>e.id===a.id));-1!==e&&j.value.splice(e,1,a),a.status>=3&&(w=w.filter((e=>e!==a.jobId)))})),w.length?I=setTimeout((()=>T()),3e3):I&&window.clearTimeout(I)}catch(a){I=setTimeout((()=>T()),3e3)}},_={page:1,size:20},C=async function(){try{E.value=!0;const a=await b({..._,status:y.value>=0?y.value:0,favorite:1==y.value?y.value:0});1===_.page?j.value=a.data.rows:j.value=j.value.concat(a.data.rows),w=j.value.filter((a=>[1,2].includes(a.status))).map((a=>a.jobId)),w.length&&T(),a.data.rows.length<_.size&&(A.value=!0),E.value=!1}catch(a){E.value=!1,1!==_.page&&(_.page=_.page-1)}},y=t(0),M=function(a){y.value=a,A.value=!1,_.page=1,C()},O=async function(a){let e=null;switch(a.type){case F.TEXT_TO_IMAGE:case F.IMAGE_ACTION:e=await m(a);break;case F.IMAGE_MIX_IMAGE:case F.IMAGE_TO_TEXT:e=await g(a);break;case F.INSIGHT_FACE:e=await k(a)}if(e){const a=e.data;j.value.find((e=>e.id===a.id))||(j.value.push(a),p((()=>{var a;null==(a=B.value)||a.scrollTo({top:0,behavior:"smooth"})}))),a.status<3&&!w.includes(a.jobId)&&(w.push(a.jobId),T())}},B=t(),G=function(a){const e=a.target,{scrollTop:t,offsetHeight:r,scrollHeight:o}=e;o-r-t<=40&&(A.value||E.value||(_.page=_.page+1,C()))};return r((()=>{var a;C(),null==(a=B.value)||a.addEventListener("scroll",G)})),o((()=>{var a;null==(a=B.value)||a.removeEventListener("scroll",G)})),(e,t)=>(s(),d("div",x,[n("div",h,[n("div",{class:i(["title-btn",0===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[0]||(t[0]=a=>M(0))},l(e.$t("common.all")),3),n("div",{class:i(["title-btn",2===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[1]||(t[1]=a=>M(2))},l(e.$t("draw.useLoading")),3),n("div",{class:i(["title-btn",3===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[2]||(t[2]=a=>M(3))},l(e.$t("draw.finished")),3),n("div",{class:i(["title-btn",4===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[3]||(t[3]=a=>M(4))},l(e.$t("draw.failed")),3),n("div",{class:i(["title-btn",1===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[4]||(t[4]=a=>M(1))},l(e.$t("common.myCollection")),3)]),n("div",{class:"main-view",ref_key:"scrollView",ref:B},[(s(!0),d(u,null,c(j.value,((e,t)=>(s(),v(a,{key:e.jobId,task:e,onRemove:()=>function(a){j.value.splice(a,1)}(t),onAddTask:O,type:"task"},null,8,["task","onRemove"])))),128))],512)]))}}),[["__scopeId","data-v-7f2755ae"]]);export{A as default};
