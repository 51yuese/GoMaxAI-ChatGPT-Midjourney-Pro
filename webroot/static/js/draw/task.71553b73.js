import{M as a}from"../index/index.d180808b.js";import{e,r as t,q as r,aY as o,w as s,x as d,A as n,I as i,F as l,E as u,P as c,ae as v,ay as b,ax as k,aw as g,n as p,av as m,_ as f}from"../main-23bab8dd.js";import{a as w}from"../index/index.27c727e8.js";import"../draw-fail/draw-fail.ad8fd01b.js";import"../index/index.5b75f753.js";import"../index/index.d3ec721c.js";import"./draw.8228db44.js";import"../HeartOutline/HeartOutline.fa43a712.js";import"../Popconfirm/Popconfirm.6ca3ead0.js";const F={class:"mj-task-view bg-[#F8F9F9] dark:bg-[#111113]"},x={class:"view-title"},A=f(e({__name:"task",setup(e){let f=[];const A=t(!1),h=t(!1),I=t([]);let j=null;const E=async function(){j&&window.clearTimeout(j);try{(await m({jobIds:f.join()})).data.forEach((a=>{const e=I.value.findIndex((e=>e.id===a.id));-1!==e&&I.value.splice(e,1,a),a.status>=3&&(f=f.filter((e=>e!==a.jobId)))})),f.length?j=setTimeout((()=>E()),3e3):j&&window.clearTimeout(j)}catch(a){j=setTimeout((()=>E()),3e3)}},T={page:1,size:20},_=async function(){try{h.value=!0;const a=await v({...T,status:C.value>=0?C.value:0,favorite:1==C.value?C.value:0});1===T.page?I.value=a.data.rows:I.value=I.value.concat(a.data.rows),f=I.value.filter((a=>[1,2].includes(a.status))).map((a=>a.jobId)),f.length&&E(),a.data.rows.length<T.size&&(A.value=!0),h.value=!1}catch(a){h.value=!1,1!==T.page&&(T.page=T.page-1)}},C=t(0),y=function(a){C.value=a,A.value=!1,T.page=1,_()},M=async function(a){let e=null;switch(a.type){case w.TEXT_TO_IMAGE:case w.IMAGE_ACTION:e=await g(a);break;case w.IMAGE_MIX_IMAGE:case w.IMAGE_TO_TEXT:e=await k(a);break;case w.INSIGHT_FACE:e=await b(a)}if(e){const a=e.data;I.value.find((e=>e.id===a.id))||(I.value.push(a),p((()=>{var a;null==(a=B.value)||a.scrollTo({top:0,behavior:"smooth"})}))),a.status<3&&!f.includes(a.jobId)&&(f.push(a.jobId),E())}},B=t(),G=function(a){const e=a.target,{scrollTop:t,offsetHeight:r,scrollHeight:o}=e;o-r-t<=40&&(A.value||h.value||(T.page=T.page+1,_()))};return r((()=>{var a;_(),null==(a=B.value)||a.addEventListener("scroll",G)})),o((()=>{var a;null==(a=B.value)||a.removeEventListener("scroll",G)})),(e,t)=>(s(),d("div",F,[n("div",x,[n("div",{class:i(["title-btn",0===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[0]||(t[0]=a=>y(0))},"全部",2),n("div",{class:i(["title-btn",2===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[1]||(t[1]=a=>y(2))},"执行中",2),n("div",{class:i(["title-btn",3===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[2]||(t[2]=a=>y(3))},"已完成",2),n("div",{class:i(["title-btn",4===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[3]||(t[3]=a=>y(4))},"已失效",2),n("div",{class:i(["title-btn",1===C.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[4]||(t[4]=a=>y(1))},"我的收藏",2)]),n("div",{class:"main-view",ref_key:"scrollView",ref:B},[(s(!0),d(l,null,u(I.value,((e,t)=>(s(),c(a,{key:e.jobId,task:e,onRemove:()=>function(a){I.value.splice(a,1)}(t),onAddTask:M,type:"task"},null,8,["task","onRemove"])))),128))],512)]))}}),[["__scopeId","data-v-a8b84a64"]]);export{A as default};
