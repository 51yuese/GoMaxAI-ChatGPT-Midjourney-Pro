import{e,Z as a,k as l,p as t,g as s,r as i,w as o,x as r,C as n,D as d,B as u,am as v,A as c,z as p,F as m,E as g,y as f,I as h,aj as x,G as b,a4 as y,a1 as k,ao as w,bs as I,_ as E,aP as C,L as _,v as M,aQ as D,$ as P,bS as T,aH as $,N as j,P as B,Q as F,a2 as L,a0 as A,aI as q,aD as J,bT as S,bU as V,bd as z,q as U,bV as N,bW as R,ad as G,O,bY as W}from"../main-a0b53047.js";import{a as H}from"../draw-fail/draw-fail.ad8fd01b.js";import{_ as Q,a as K,b as Y}from"../KLingIcon3/KLingIcon3.6acffd30.js";import{N as Z}from"../Popconfirm/Popconfirm.a6d67891.js";import{C as X,_ as ee,n as ae}from"../isVIP2/isVIP2.6b2eb435.js";import{_ as le}from"../aiVideoGou/aiVideoGou.56a8a6eb.js";import{_ as te,a as se,C as ie,T as oe,S as re}from"../AI2/AI2.27a6c867.js";import{_ as ne,b as de}from"../baiduThink/baiduThink.3d2826cf.js";import{u as ue}from"../useUpload/useUpload.78be6f1d.js";const ve={class:"dallTaskBox"},ce=["src"],pe={class:"dallTaskItem bg-[#fff] dark:bg-[#313338]",style:{padding:"12px 12px 12px 0","border-radius":"12px",display:"flex","margin-top":"12px"}},me={class:"content",style:{"margin-left":"12px",width:"100%"}},ge={style:{display:"flex","justify-content":"space-between"}},fe={style:{display:"flex","align-items":"center"}},he={class:"discord-en"},xe={class:"discord-time"},be={key:0,class:"flexLabel"},ye={key:0,class:"itemLabel"},ke={key:1,class:"itemLabel"},we={key:0,class:"answerImgBox"},Ie=["onClick","src"],Ee={key:1,style:{display:"flex","align-items":"center"}},Ce={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},_e={style:{"margin-top":"8px",color:"#D4237A"}},Me={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},De={class:"btnBox"},Pe={class:"btnItem"},Te={style:{display:"flex","align-items":"center"}},$e={class:"btnItem"},je={class:"btnItem"},Be=E(e({__name:"index",props:{task:{type:Object}},setup(e){const E=a(),C=l(),_=t(),M=s((()=>"dark"===E.theme)),D=e,P=i(!1),T=i("");let $=()=>{h.emit("copyJMData",D.task)},j=()=>{var e;(null==(e=null==C?void 0:C.userInfo)?void 0:e.score)>0?h.emit("generateJMDraw",D.task):_.error("积分不足")},B=i(!1),F=()=>{B.value=!0,I({id:D.task.id}).then((e=>{h.emit("dallJMList"),B.value=!1}))};return(e,a)=>(o(),r("div",ve,[n(f(k),{show:f(B)},{default:d((()=>{var l,t;return[P.value?(o(),r("div",{key:0,onClick:a[1]||(a[1]=e=>{P.value=!1,T.value=""}),class:"mask"},[u("img",{src:T.value,style:{width:"auto",height:"90%"},alt:"",onClick:a[0]||(a[0]=v((()=>{}),["stop"]))},null,8,ce)])):c("",!0),u("div",pe,[a[9]||(a[9]=u("div",{class:"avator"},[u("div",{class:"discord-avatar"},[u("img",{src:"/static/svg/Discord-JM-3a0647e7.svg",alt:""})])],-1)),u("div",me,[u("div",ge,[u("div",fe,[u("span",he,"即梦-"+p(e.$t("draw.imgGen")),1),u("div",xe,p(D.task.createdAt),1)])]),u("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>{var a;(a=D.task.prompt)?(w({text:a}),_.success("复制成功")):_.error("无内容可复制")})},p(D.task.prompt),1),D.task.requestParams?(o(),r("div",be,[(null==(l=D.task)?void 0:l.modelInfo)?(o(),r("div",ye,p(D.task.modelInfo.label),1)):c("",!0),(null==(t=D.task.requestParams)?void 0:t.width)?(o(),r("div",ke,p(D.task.requestParams.width+"×"+D.task.requestParams.height),1)):c("",!0)])):c("",!0),u("div",null,[10==D.task.status&&D.task.responseResult&&D.task.responseResult.length>0?(o(),r("div",we,[(o(!0),r(m,null,g(D.task.responseResult,(e=>(o(),r("img",{onClick:a=>function(e){P.value=!0,T.value=e}(e.url),src:e.thumb,onLoad:a[3]||(a[3]=e=>f(h).emit("drawtoBottom")),alt:""},null,40,Ie)))),256))])):(o(),r("div",Ee,[4==D.task.status?(o(),r("div",Ce,[a[6]||(a[6]=u("img",{src:H,alt:""},null,-1)),u("p",_e,p(e.$t("draw.drawErro")),1)])):(o(),r("div",Me,a[7]||(a[7]=[u("div",{class:"loader"},null,-1)])))]))]),u("div",De,[u("div",Pe,[n(f(x),{trigger:"hover"},{trigger:d((()=>[u("img",{src:Q,onClick:a[4]||(a[4]=(...e)=>f($)&&f($)(...e)),alt:""})])),default:d((()=>[u("div",Te,[u("span",null,p(e.$t("draw.useImgParams")),1)])])),_:1})]),u("div",$e,[u("img",{src:K,onClick:a[5]||(a[5]=(...e)=>f(j)&&f(j)(...e)),alt:""})]),u("div",je,[n(f(Z),{onPositiveClick:f(F),style:b(M.value?"background:#19191B":"background:#F8F9F9")},{trigger:d((()=>a[8]||(a[8]=[u("img",{src:Y,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:d((()=>[y(" "+p(e.$t("draw.confirmDelWork")),1)])),_:1},8,["onPositiveClick","style"])])])])])]})),_:1},8,["show"])]))}}),[["__scopeId","data-v-4f0d8b0b"]]),Fe={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#F9F9FB] dark:bg-[#222325]"},Le={class:"dallBox"},Ae={style:{display:"flex","align-items":"center",height:"60px"}},qe={class:"dark:text-[#EEEEF0] text-[#000] text-[18px]",style:{"margin-right":"12px"}},Je={style:{width:"auto",position:"relative"},class:"customBox"},Se={key:0,class:"newModel"},Ve={class:"custerSelect"},ze=["onClick"],Ue={class:"name"},Ne={key:0,class:"newModel"},Re={class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},Ge={class:"dark:text-[#EEEEF0] text-[#767676] text-[14px]"},Oe={class:"labeBox",style:{flex:"none"}},We={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},He=["placeholder"],Qe={style:{width:"100%","text-align":"right","padding-right":"12px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},Ke={class:"recomBox"},Ye={class:"labeBox"},Ze=["onClick"],Xe={class:"flexSelect"},ea={style:{width:"116px","margin-right":"10px"}},aa={style:{position:"absolute",bottom:"0",left:"0px",width:"100%"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},la={key:0,class:"vipIcon",src:ee,alt:""},ta={key:0,style:{color:"#fff"}},sa={key:1,style:{color:"#fff"}},ia={key:2,style:{color:"#fff"}},oa={key:3,style:{color:"#fff"}},ra={key:4,style:{display:"flex","align-items":"center",color:"#fff"}},na={key:5,style:{color:"#fff"}},da=E(e({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){ue(),i("/api/file/upload");const v=t(),x=l(),b=s((()=>x.isLogin));s((()=>x.userInfo));const k=s((()=>1===x.userInfo.lifetimeVip||x.userInfo.vipExpire&&new Date(x.userInfo.vipExpire)>new Date)),I=s((()=>x.userInfo.vipLeavelId));let E=i([]);C().then((e=>{E.value=e.data})),h.on("copyJMData",(e=>{xe.value=e.requestParams.prompt,W.value=e.requestParams.model_name,ve.value=e.requestParams.aspect_ratio,ke.value=e.requestParams.image}));const z=e;_(z,(e=>{0==e.isLoading&&(xe.value="")}));const U=a,N=i(""),R=i("");M({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{R.value=e.data.mjModel,N.value=e.data.robotAvatar}));const G=i(!1);i(50),i(50),i(""),i([{label:"通用垫图",value:""},{label:"人物长相",value:"face"},{label:"角色特征",value:"subject"}]);let O=i(!1),W=i("");const H=i([]);D({modelType:"draw",keyType:3}).then((e=>{H.value=e.data.rows[0].children,console.log(H.value,"fetchQueryModelsListAPIMaps"),W.value=H.value[0].value,h.emit("dallJMModel",W.value)}));let Q=e=>{h.emit("dallJMModel",e)},K=i([]),Y=i([]),Z=()=>{const e=[...Y.value].sort((()=>Math.random()-.5));K.value=e.slice(0,e.length>3?3:e.length)};function ee(e=""){xe.value=e}function ae(){xe.value?(w({text:xe.value}),v.success(P("chat.copied"))):v.error(P("draw.noDataCopy"))}S().then((e=>{var a,l;Y.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,Z()})),i(""),i([{label:"标准质量",value:""},{label:"高品质模式",value:"hd"}]),i(4),i([{label:"1张",value:1},{label:"2张",value:2},{label:"3张",value:3},{label:"4张",value:4},{label:"5张",value:5},{label:"6张",value:6},{label:"7张",value:7},{label:"8张",value:8},{label:"9张",value:9}]);let ve=i("9:16");const ce=i([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"}]),pe={"1:1":{width:512,height:512},"16:9":{width:512,height:288},"9:16":{width:288,height:512},"4:3":{width:512,height:384},"3:4":{width:384,height:512},"2:3":{width:341,height:512},"3:2":{width:512,height:341}},me=i(),ge=i(),fe=()=>{me.value.open()},he=()=>{ge.value.open()},xe=i("");function be(e){xe.value=e}function ye(){if(!b.value)return void x.setLoginDialog(!0);if(_e.value.isVipUsed&&-1===_e.value.userType.indexOf(I.value)){let e=_e.value.userType.split(","),a="";return e.forEach(((l,t)=>{a+=E.value.filter((e=>e.id==l))[0].dictName,t<e.length-1&&(a+=",")})),void v.error(P("digitalMan.vipUse1")+a+P("digitalMan.vipUse1"))}if(!xe.value)return void v.error(P("draw.inputImgDesc"));G.value=!0;let e={n:1,prompt:xe.value,model_name:W.value,width:pe[ve.value].width,height:pe[ve.value].height,image:ke.value};U("dallprompt",e),setTimeout((()=>{Ce()}),1e3)}_(z,(e=>{xe.value=e.makePrompt})),h.on("generateJMDraw",(e=>{xe.value=e.prompt,ye()}));let ke=i(""),we=i([]),Ie=i([]),Ee=()=>{const e=[...Ie.value].sort((()=>Math.random()-.5));we.value=e.slice(0,e.length>5?5:e.length)};function Ce(){let e={n:1,prompt:xe.value,model_name:W.value,width:pe[ve.value].width,height:pe[ve.value].height,image:ke.value};T(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?(_e.value=e.data,Me.value=!1):Me.value=!0})).catch((e=>{Me.value=!0}))}V().then((e=>{Ie.value=e.data,Ee()})),h.off("fetchModelFree"),h.on("fetchModelFree",(e=>{Ce()}));const _e=i({remainCount:0,freeCount:0,useIntegrate:0}),Me=i(!1);return _((()=>W.value),((e,a)=>{W.value&&Ce()}),{deep:!0,immediate:!0}),_((()=>ve.value),((e,a)=>{W.value&&Ce()}),{deep:!0,immediate:!0}),_(b,(e=>{e&&Ce()})),(e,a)=>(o(),r("div",Fe,[n(ne,{ref_key:"inspirationRef",ref:me,onDall:be,type:"dall"},null,512),n(de,{onDall:be,type:"dall",ref_key:"thinkRef",ref:ge},null,512),u("div",Le,[u("div",Ae,[u("div",qe,p(e.$t("draw.genImgModel")),1),u("div",Je,[u("div",{class:"cSelectBox",onClick:a[0]||(a[0]=e=>$(O)?O.value=!f(O):O=!f(O))},[u("span",null,p(f(W)&&H.value.filter((e=>e.value==f(W)))[0].label),1),H.value.length>0&&f(W)&&H.value.filter((e=>e.value==f(W)))[0].new?(o(),r("div",Se,"NEW")):c("",!0),n(f(j),{size:"14"},{default:d((()=>[n(f(X))])),_:1})]),B(u("div",Ve,[u("p",null,p(e.$t("draw.drawModelChose"))+":",1),(o(!0),r(m,null,g(H.value,(e=>(o(),r("div",{class:L(["selectItem",f(W)==e.value?"active":""]),onClick:a=>{$(W)?W.value=e.value:W=e.value,$(O)?O.value=!1:O=!1,f(Q)(e.value)}},[u("div",Ue,[y(p(e.label)+" ",1),e.new?(o(),r("div",Ne,"NEW")):c("",!0)]),u("span",null,p(e.desc),1),a[4]||(a[4]=u("img",{src:le,alt:""},null,-1))],10,ze)))),256))],512),[[F,f(O)]])])]),u("div",Re,[u("div",Ge,p(e.$t("draw.chuangyiDesc")),1),u("div",Oe,[u("div",{class:"labeItem",onClick:he},[a[5]||(a[5]=u("img",{src:te,alt:""},null,-1)),u("span",null,p(e.$t("draw.AIgenDesc")),1)]),u("div",{class:"labeItem",onClick:fe},[a[6]||(a[6]=u("img",{src:se,alt:""},null,-1)),u("span",null,p(e.$t("homePage.tips")),1)])])]),u("div",We,[B(u("textarea",{"onUpdate:modelValue":a[1]||(a[1]=e=>xe.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:e.$t("draw.textToImgExp")},"\t\t\t\t",8,He),[[A,xe.value]]),u("div",Qe,[n(f(j),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:ae},{default:d((()=>[n(f(ie))])),_:1}),n(f(j),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>ee())},{default:d((()=>[n(f(oe))])),_:1})]),a[7]||(a[7]=u("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),u("div",Ke,[u("span",null,p(e.$t("knowledge.recom"))+"：",1),u("div",Ye,[(o(!0),r(m,null,g(f(K),(e=>(o(),r("div",{class:"labeItem",onClick:a=>ee(e.descript)},p(e.name),9,Ze)))),256))]),n(f(j),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:f(Z)},{default:d((()=>[n(f(re))])),_:1},8,["onClick"])])]),u("div",Xe,[u("div",ea,[n(f(q),{value:f(ve),"onUpdate:value":a[3]||(a[3]=e=>$(ve)?ve.value=e:ve=e),options:ce.value},null,8,["value","options"])])]),u("div",aa,[_e.value&&_e.value.isVipUsed?(o(),r("img",la)):c("",!0),n(f(J),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"64px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:ye},{default:d((()=>[Me.value?(o(),r("span",ta,p(e.$t("draw.modelNotSet")),1)):f(x).isLogin?_e.value&&_e.value.isVipFree&&k.value?(o(),r("span",ia,p(e.$t("chat.vipFree")),1)):_e.value&&_e.value.remainCount&&k.value?(o(),r("span",oa,p(e.$t("draw.shenyu")+_e.value.remainCount+e.$t("draw.chiFree")),1)):_e.value?(o(),r("div",ra,[u("span",null,p(e.$t("gpt.lijiGen")),1),u("span",null,p(_e.value.useIntegrate),1),u("span",null,p(e.$t("chat.pointsChi")),1)])):(o(),r("span",na,p(e.$t("draw.gen")),1)):(o(),r("span",sa,p(e.$t("draw.beginGen")),1))])),_:1})])])]))}}),[["__scopeId","data-v-9ffaf20f"]]),ua={class:"bg-[#fff] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},va={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px 0 0"},class:"contentBox bg-[#fff] dark:bg-[#313338]"},ca={style:{width:"calc( 100% + 24px )",margin:"0",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},pa={class:"borTitel"},ma={style:{color:"#8C441A","font-size":"18px","font-weight":"500"}},ga={style:{"margin-left":"13px",color:"#8C441A","font-size":"14px"}},fa=E(e({__name:"JMengDraw",setup(e){let d;const v=t(),c=l();z();const x=a();s((()=>c.userInfo.avatar)),s((()=>1===c.userInfo.lifetimeVip||c.userInfo.vipExpire&&new Date(c.userInfo.vipExpire)>new Date));const b=s((()=>c.isLogin));s((()=>"dark"===x.theme));const y=i(null);function k(){let e=y.value;e&&(e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight))}h.on("drawtoBottom",(e=>{setTimeout((()=>k()),300)})),_(b,(e=>{e&&E()})),U((()=>{setTimeout((()=>k()),300)}));const w=i([]);U((()=>{}));let I={page:1,size:999,keyType:3};h.on("dallJMModel",(e=>{I.model=e,E()})),h.on("dallJMList",(()=>{E()}));const E=async function(){d&&clearInterval(d),w.value=[];let e=(await N(I)).data.reverse(),a=!0;e.forEach((e=>{!1===e.isDelete&&(e.imgList=JSON.parse(e.fileInfo),w.value.push(e))})),d=setInterval((()=>{e.forEach(((e,l)=>{!1===e.isDelete&&(4!=e.status&&10!=e.status?(a=!1,R({id:e.id}).then((e=>{10==e.data.status&&(w.value.forEach(((a,l)=>{a.id==e.data.id&&(w.value[l]=e.data)})),C.value=!1,h.emit("getUserInfo",!0),setTimeout((()=>k()),300))}))):w.value[l]=e)})),a&&clearInterval(d)}),3e3),console.log(w.value,"taskList.value"),T.value=!0,setTimeout((()=>k()),300)};G((()=>{d&&clearInterval(d)}));const C=i(!1);async function M(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[],errMsg:!1};e.isSync=!0,C.value=!0,w.value.push(a),setTimeout((()=>k()),300),await W(e).then((e=>{w.value[w.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>k()),300);let a=setInterval((()=>{R({id:e.data.id}).then((e=>{10!=e.data.status&&4!=e.data.status||(w.value[w.value.length-1]=e.data,e.data.failReason&&v.error(e.data.failReason),clearInterval(a),C.value=!1,h.emit("getUserInfo",!0),setTimeout((()=>k()),300),h.emit("fetchModelFree"))}))}),3e3)})).catch((e=>{C.value=!1,w.value[w.value.length-1].errMsg=!0}))}const D=i("");function P(e){D.value=e}let T=i(!1);return(e,a)=>(o(),r("div",ua,[n(da,{type:"dall",makePrompt:D.value,isLoading:C.value,onDallprompt:M},null,8,["makePrompt","isLoading"]),u("div",va,[u("div",ca,[u("div",pa,[u("span",ma,"# "+p(e.$t("draw.creationCenter")),1),u("p",ga,p(e.$t("draw.SafetyWarning")),1)])]),u("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px 0 0"},ref_key:"taskBox",ref:y},[b.value&&0!=w.value.length||!f(T)?(o(!0),r(m,{key:0},g(w.value,(e=>(o(),O(Be,{key:e.id,task:e},null,8,["task"])))),128)):(o(),O(ae,{key:1,onHandleprompt:P}))],512)])]))}}),[["__scopeId","data-v-7cdfacba"]]);export{fa as default};
