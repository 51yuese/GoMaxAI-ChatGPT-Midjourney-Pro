import{e,Z as a,k as l,p as t,g as s,r as i,w as o,x as r,C as n,D as d,B as u,am as v,A as c,z as p,F as m,E as g,y as f,I as h,aj as x,G as y,a4 as b,a1 as k,ao as w,bt as I,_ as E,aP as _,L as C,v as M,aQ as D,$ as L,bT as P,aH as T,N as B,P as j,Q as $,a2 as A,a0 as F,aI as J,aD as U,bU as S,bV as V,be as q,q as z,bW as N,b_ as O,aV as R,O as G,bX as H,b$ as W}from"../main-b114ff11.js";import{a as Q}from"../draw-fail/draw-fail.ad8fd01b.js";import{_ as K,a as X,b as Z}from"../KLingIcon3/KLingIcon3.6acffd30.js";import{N as Y}from"../Popconfirm/Popconfirm.5446b9cc.js";import{C as ee,_ as ae,n as le}from"../isVIP2/isVIP2.1f3c489e.js";import{_ as te}from"../aiVideoGou/aiVideoGou.56a8a6eb.js";import{_ as se,a as ie,C as oe,T as re,S as ne}from"../AI2/AI2.618bccbb.js";import{_ as de,b as ue}from"../baiduThink/baiduThink.f40970a8.js";import{u as ve}from"../useUpload/useUpload.c4974038.js";const ce={class:"dallTaskBox"},pe=["src"],me={class:"dallTaskItem bg-[#fff] dark:bg-[#313338]",style:{padding:"12px 12px 12px 0","border-radius":"12px",display:"flex","margin-top":"12px"}},ge={class:"content",style:{"margin-left":"12px",width:"100%"}},fe={style:{display:"flex","justify-content":"space-between"}},he={style:{display:"flex","align-items":"center"}},xe={class:"discord-time"},ye={key:0,class:"flexLabel"},be={key:0,class:"itemLabel"},ke={key:1,class:"itemLabel"},we={key:0,class:"answerImgBox"},Ie=["onClick","src"],Ee={key:1,style:{display:"flex","align-items":"center"}},_e={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},Ce={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},Me={class:"btnBox"},De={class:"btnItem"},Le={class:"btnItem"},Pe={class:"btnItem"},Te=E(e({__name:"index",props:{task:{type:Object}},setup(e){const E=a(),_=l(),C=t(),M=s((()=>"dark"===E.theme)),D=e,L=i(!1),P=i("");let T=()=>{h.emit("copyJMData",D.task)},B=()=>{var e;(null==(e=null==_?void 0:_.userInfo)?void 0:e.score)>0?h.emit("generateJMDraw",D.task):C.error("积分不足")},j=i(!1),$=()=>{j.value=!0,I({id:D.task.id}).then((e=>{h.emit("dallJMList"),j.value=!1}))};return(e,a)=>(o(),r("div",ce,[n(f(k),{show:f(j)},{default:d((()=>{var e;return[L.value?(o(),r("div",{key:0,onClick:a[1]||(a[1]=e=>{L.value=!1,P.value=""}),class:"mask"},[u("img",{src:P.value,style:{width:"auto",height:"90%"},alt:"",onClick:a[0]||(a[0]=v((()=>{}),["stop"]))},null,8,pe)])):c("",!0),u("div",me,[a[12]||(a[12]=u("div",{class:"avator"},[u("div",{class:"discord-avatar"},[u("img",{src:"/static/svg/Discord-JM-3a0647e7.svg",alt:""})])],-1)),u("div",ge,[u("div",fe,[u("div",he,[a[6]||(a[6]=u("span",{class:"discord-en"},"即梦-图片生成",-1)),u("div",xe,p(D.task.createdAt),1)])]),u("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>{var a;(a=D.task.prompt)?(w({text:a}),C.success("复制成功")):C.error("无内容可复制")})},p(D.task.prompt),1),D.task.requestParams?(o(),r("div",ye,[D.task.model?(o(),r("div",be,p(D.task.model),1)):c("",!0),(null==(e=D.task.requestParams)?void 0:e.width)?(o(),r("div",ke,p(D.task.requestParams.width+"×"+D.task.requestParams.height),1)):c("",!0)])):c("",!0),u("div",null,[D.task.imgList&&D.task.imgList.length>0?(o(),r("div",we,[(o(!0),r(m,null,g(D.task.imgList,(e=>(o(),r("img",{onClick:a=>function(e){L.value=!0,P.value=e}(e),onLoad:a[3]||(a[3]=e=>f(h).emit("drawtoBottom")),src:e,alt:""},null,40,Ie)))),256))])):(o(),r("div",Ee,[D.task.errMsg?(o(),r("div",_e,a[7]||(a[7]=[u("img",{src:Q,alt:""},null,-1),u("p",{style:{"margin-top":"8px",color:"#D4237A"}},"绘画失败",-1)]))):(o(),r("div",Ce,a[8]||(a[8]=[u("div",{class:"loader"},null,-1)])))]))]),u("div",Me,[u("div",De,[n(f(x),{trigger:"hover"},{trigger:d((()=>[u("img",{src:K,onClick:a[4]||(a[4]=(...e)=>f(T)&&f(T)(...e)),alt:""})])),default:d((()=>[a[9]||(a[9]=u("div",{style:{display:"flex","align-items":"center"}},[u("span",null,"使用本图片的参数")],-1))])),_:1,__:[9]})]),u("div",Le,[u("img",{src:X,onClick:a[5]||(a[5]=(...e)=>f(B)&&f(B)(...e)),alt:""})]),u("div",Pe,[n(f(Y),{onPositiveClick:f($),style:y(M.value?"background:#19191B":"background:#F8F9F9")},{trigger:d((()=>a[10]||(a[10]=[u("img",{src:Z,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:d((()=>[a[11]||(a[11]=b(" 您确认要删除任务吗？ "))])),_:1,__:[11]},8,["onPositiveClick","style"])])])])])]})),_:1},8,["show"])]))}}),[["__scopeId","data-v-9dcb67c6"]]),Be={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#F9F9FB] dark:bg-[#222325]"},je={class:"dallBox"},$e={style:{display:"flex","align-items":"center",height:"60px"}},Ae={class:"dark:text-[#EEEEF0] text-[#000] text-[18px]",style:{"margin-right":"12px"}},Fe={style:{width:"auto",position:"relative"},class:"customBox"},Je={key:0,class:"newModel"},Ue={class:"custerSelect"},Se=["onClick"],Ve={class:"name"},qe={key:0,class:"newModel"},ze={class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},Ne={class:"dark:text-[#EEEEF0] text-[#767676] text-[14px]"},Oe={class:"labeBox",style:{flex:"none"}},Re={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},Ge=["placeholder"],He={style:{width:"100%","text-align":"right","padding-right":"12px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},We={class:"recomBox"},Qe={class:"labeBox"},Ke=["onClick"],Xe={class:"flexSelect"},Ze={style:{width:"116px","margin-right":"10px"}},Ye={style:{position:"absolute",bottom:"0",left:"0px",width:"100%"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},ea={key:0,class:"vipIcon",src:ae,alt:""},aa={key:0,style:{color:"#fff"}},la={key:1,style:{color:"#fff"}},ta={key:2,style:{color:"#fff"}},sa={key:3,style:{color:"#fff"}},ia={key:4,style:{display:"flex","align-items":"center",color:"#fff"}},oa={key:5,style:{color:"#fff"}},ra=E(e({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){ve(),i("/api/file/upload");const v=t(),x=l(),y=s((()=>x.isLogin));s((()=>x.userInfo));const k=s((()=>1===x.userInfo.lifetimeVip||x.userInfo.vipExpire&&new Date(x.userInfo.vipExpire)>new Date)),I=s((()=>x.userInfo.vipLeavelId));let E=i([]);_().then((e=>{E.value=e.data})),h.on("copyJMData",(e=>{xe.value=e.requestParams.prompt,H.value=e.requestParams.model_name,le.value=e.requestParams.aspect_ratio,ke.value=e.requestParams.image}));const q=e;C(q,(e=>{0==e.isLoading&&(xe.value="")}));const z=a,N=i(""),O=i("");M({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{O.value=e.data.mjModel,N.value=e.data.robotAvatar}));const R=i(!1);i(50),i(50),i(""),i([{label:"通用垫图",value:""},{label:"人物长相",value:"face"},{label:"角色特征",value:"subject"}]);let G=i(!1),H=i("");const W=i([]);D({modelType:"draw",keyType:3}).then((e=>{W.value=e.data.rows[0].children,console.log(W.value,"fetchQueryModelsListAPIMaps"),H.value=W.value[0].value,h.emit("dallJMModel",H.value)}));let Q=e=>{h.emit("dallJMModel",e)},K=i([]),X=i([]),Z=()=>{const e=[...X.value].sort((()=>Math.random()-.5));K.value=e.slice(0,e.length>3?3:e.length)};function Y(e=""){xe.value=e}function ae(){xe.value?(w({text:xe.value}),v.success(L("chat.copied"))):v.error(L("draw.noDataCopy"))}S().then((e=>{var a,l;X.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,Z()})),i(""),i([{label:"标准质量",value:""},{label:"高品质模式",value:"hd"}]),i(4),i([{label:"1张",value:1},{label:"2张",value:2},{label:"3张",value:3},{label:"4张",value:4},{label:"5张",value:5},{label:"6张",value:6},{label:"7张",value:7},{label:"8张",value:8},{label:"9张",value:9}]);let le=i("9:16");const ce=i([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"}]),pe={"1:1":{width:512,height:512},"16:9":{width:512,height:288},"9:16":{width:288,height:512},"4:3":{width:512,height:384},"3:4":{width:384,height:512},"2:3":{width:341,height:512},"3:2":{width:512,height:341}},me=i(),ge=i(),fe=()=>{me.value.open()},he=()=>{ge.value.open()},xe=i("");function ye(e){xe.value=e}function be(){if(!y.value)return void x.setLoginDialog(!0);if(Ce.value.isVipUsed&&-1===Ce.value.userType.indexOf(I.value)){let e=Ce.value.userType.split(","),a="";return e.forEach(((l,t)=>{a+=E.value.filter((e=>e.id==l))[0].dictName,t<e.length-1&&(a+=",")})),void v.error(L("digitalMan.vipUse1")+a+L("digitalMan.vipUse1"))}if(!xe.value)return void v.error(L("draw.inputImgDesc"));R.value=!0;let e={n:1,prompt:xe.value,model_name:H.value,width:pe[le.value].width,height:pe[le.value].height,image:ke.value};z("dallprompt",e),setTimeout((()=>{_e()}),1e3)}C(q,(e=>{xe.value=e.makePrompt})),h.on("generateJMDraw",(e=>{xe.value=e.prompt,be()}));let ke=i(""),we=i([]),Ie=i([]),Ee=()=>{const e=[...Ie.value].sort((()=>Math.random()-.5));we.value=e.slice(0,e.length>5?5:e.length)};function _e(){let e={n:1,prompt:xe.value,model_name:H.value,width:pe[le.value].width,height:pe[le.value].height,image:ke.value};P(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?(Ce.value=e.data,Me.value=!1):Me.value=!0})).catch((e=>{Me.value=!0}))}V().then((e=>{Ie.value=e.data,Ee()}));const Ce=i({remainCount:0,freeCount:0,useIntegrate:0}),Me=i(!1);return C((()=>H.value),((e,a)=>{H.value&&_e()}),{deep:!0,immediate:!0}),C((()=>le.value),((e,a)=>{H.value&&_e()}),{deep:!0,immediate:!0}),(e,a)=>(o(),r("div",Be,[n(de,{ref_key:"inspirationRef",ref:me,onDall:ye,type:"dall"},null,512),n(ue,{onDall:ye,type:"dall",ref_key:"thinkRef",ref:ge},null,512),u("div",je,[u("div",$e,[u("div",Ae,p(e.$t("draw.genImgModel")),1),u("div",Fe,[u("div",{class:"cSelectBox",onClick:a[0]||(a[0]=e=>T(G)?G.value=!f(G):G=!f(G))},[u("span",null,p(f(H)&&W.value.filter((e=>e.value==f(H)))[0].label),1),W.value.length>0&&f(H)&&W.value.filter((e=>e.value==f(H)))[0].new?(o(),r("div",Je,"NEW")):c("",!0),n(f(B),{size:"14"},{default:d((()=>[n(f(ee))])),_:1})]),j(u("div",Ue,[u("p",null,p(e.$t("draw.videoModelChose"))+":",1),(o(!0),r(m,null,g(W.value,(e=>(o(),r("div",{class:A(["selectItem",f(H)==e.value?"active":""]),onClick:a=>{T(H)?H.value=e.value:H=e.value,T(G)?G.value=!1:G=!1,f(Q)(e.value)}},[u("div",Ve,[b(p(e.label)+" ",1),e.new?(o(),r("div",qe,"NEW")):c("",!0)]),u("span",null,p(e.desc),1),a[4]||(a[4]=u("img",{src:te,alt:""},null,-1))],10,Se)))),256))],512),[[$,f(G)]])])]),u("div",ze,[u("div",Ne,p(e.$t("draw.chuangyiDesc")),1),u("div",Oe,[u("div",{class:"labeItem",onClick:he},[a[5]||(a[5]=u("img",{src:se,alt:""},null,-1)),u("span",null,p(e.$t("draw.AIgenDesc")),1)]),u("div",{class:"labeItem",onClick:fe},[a[6]||(a[6]=u("img",{src:ie,alt:""},null,-1)),u("span",null,p(e.$t("homePage.tips")),1)])])]),u("div",Re,[j(u("textarea",{"onUpdate:modelValue":a[1]||(a[1]=e=>xe.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:e.$t("draw.textToImgExp")},"\t\t\t\t",8,Ge),[[F,xe.value]]),u("div",He,[n(f(B),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:ae},{default:d((()=>[n(f(oe))])),_:1}),n(f(B),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>Y())},{default:d((()=>[n(f(re))])),_:1})]),a[7]||(a[7]=u("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),u("div",We,[u("span",null,p(e.$t("knowledge.recom"))+"：",1),u("div",Qe,[(o(!0),r(m,null,g(f(K),(e=>(o(),r("div",{class:"labeItem",onClick:a=>Y(e.descript)},p(e.name),9,Ke)))),256))]),n(f(B),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:f(Z)},{default:d((()=>[n(f(ne))])),_:1},8,["onClick"])])]),u("div",Xe,[u("div",Ze,[n(f(J),{value:f(le),"onUpdate:value":a[3]||(a[3]=e=>T(le)?le.value=e:le=e),options:ce.value},null,8,["value","options"])])]),u("div",Ye,[Ce.value&&Ce.value.isVipUsed?(o(),r("img",ea)):c("",!0),n(f(U),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"64px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:be},{default:d((()=>[Me.value?(o(),r("span",aa,p(e.$t("draw.modelNotSet")),1)):f(x).isLogin?Ce.value&&Ce.value.isVipFree&&k.value?(o(),r("span",ta,p(e.$t("chat.vipFree")),1)):Ce.value&&Ce.value.remainCount&&k.value?(o(),r("span",sa,p(e.$t("draw.shenyu")+Ce.value.remainCount+e.$t("draw.chiFree")),1)):Ce.value?(o(),r("div",ia,[u("span",null,p(e.$t("gpt.lijiGen")),1),u("span",null,p(Ce.value.useIntegrate),1),u("span",null,p(e.$t("chat.pointsChi")),1)])):(o(),r("span",oa,p(e.$t("draw.gen")),1)):(o(),r("span",la,p(e.$t("draw.beginGen")),1))])),_:1})])])]))}}),[["__scopeId","data-v-2a5577f1"]]),na={class:"bg-[#fff] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},da={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px 0 0"},class:"contentBox bg-[#fff] dark:bg-[#313338]"},ua={style:{width:"calc( 100% + 24px )",margin:"0",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},va={class:"borTitel"},ca={style:{color:"#8C441A","font-size":"18px","font-weight":"500"}},pa={style:{"margin-left":"13px",color:"#8C441A","font-size":"14px"}},ma=E(e({__name:"JMengDraw",setup(e){let d;const v=t(),c=l();q();const f=a();s((()=>c.userInfo.avatar)),s((()=>1===c.userInfo.lifetimeVip||c.userInfo.vipExpire&&new Date(c.userInfo.vipExpire)>new Date));const x=s((()=>c.isLogin));s((()=>"dark"===f.theme));const y=i(null);function b(){let e=y.value;e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight)}h.on("drawtoBottom",(e=>{setTimeout((()=>b()),300)})),C(x,(e=>{e&&I()})),z((()=>{setTimeout((()=>b()),300)}));const k=i([]);z((()=>{}));let w={page:1,size:999,keyType:3};h.on("dallJMModel",(e=>{w.model=e,I()})),h.on("dallJMList",(()=>{I()}));const I=async function(){d&&clearInterval(d),k.value=[];let e=(await N(w)).data.reverse(),a=!0;e.forEach((e=>{!1===e.isDelete&&(e.imgList=JSON.parse(e.fileInfo),k.value.push(e))})),d=setInterval((()=>{e.forEach(((e,l)=>{!1===e.isDelete&&("succeed"==e.answer||e.fileInfo||e.errMsg?(e.imgList=JSON.parse(e.fileInfo),k.value[l]=e):(a=!1,O({id:e.id}).then((e=>{e.data.imageUrl&&(e.data.imgList=JSON.parse(e.data.imageUrl),k.value.forEach(((a,l)=>{a.id==e.data.id&&(k.value[l]=e.data)})),clearInterval([interName]),E.value=!1,h.emit("getUserInfo",!0),setTimeout((()=>b()),300))}))))})),a&&clearInterval(d)}),3e3),console.log(k.value,"taskList.value"),setTimeout((()=>b()),300)};R((()=>{d&&clearInterval(d)}));const E=i(!1);async function _(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[],errMsg:!1};E.value=!0,k.value.push(a),setTimeout((()=>b()),300),await W(e).then((e=>{k.value[k.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>b()),300);let a=setInterval((()=>{O({id:e.data.id}).then((e=>{(e.data.imageUrl||e.data.failReason)&&(e.data.errMsg=e.data.failReason,e.data.failReason&&v.error(e.data.failReason),e.data.imgList=JSON.parse(e.data.imageUrl),k.value[k.value.length-1]=e.data,clearInterval(a),E.value=!1,h.emit("getUserInfo",!0),setTimeout((()=>b()),300))}))}),3e3)})).catch((e=>{E.value=!1,k.value[k.value.length-1].errMsg=!0}))}const M=i("");function D(e){M.value=e}i(!1);const L=i();return(e,a)=>(o(),r("div",na,[n(ra,{type:"dall",makePrompt:M.value,isLoading:E.value,onDallprompt:_},null,8,["makePrompt","isLoading"]),u("div",da,[u("div",ua,[u("div",va,[u("span",ca,"# "+p(e.$t("draw.creationCenter")),1),u("p",pa,p(e.$t("draw.SafetyWarning")),1)])]),u("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px 0 0"},ref_key:"taskBox",ref:y},[x.value&&0!=k.value.length?(o(!0),r(m,{key:0},g(k.value,(e=>(o(),G(Te,{key:e.id,task:e},null,8,["task"])))),128)):(o(),G(le,{key:1,onHandleprompt:D}))],512)]),n(H,{style:{right:"20px",left:"auto",bottom:"auto",top:"60px",border:"1px solid #EAEBEC"},ref_key:"userDialogRef",ref:L},null,512)]))}}),[["__scopeId","data-v-94186954"]]);export{ma as default};
