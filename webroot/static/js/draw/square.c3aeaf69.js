import{e,j as a,aq as t,o as l,r,g as s,k as n,I as o,ba as i,P as u,p as v,aF as d,v as c,w as f,A as p,E as h,F as m,D as y,B as g,C as w,bv as k,bw as x,bx as b,L as E,a6 as _,x as j,H as C,y as D,z as I,S as z,T as q,by as B,_ as F}from"../main-da83e417.js";import{I as L}from"../mj-menu/mj-menu.41e6da46.js";import{t as S}from"../throttle/throttle.33f09de3.js";const T={class:"overflow-hidden pr-0 h-full flex flex-col"},$={class:"market overflow-y-auto flex-1 min-h-screen h-[100vh] relative itemContent"},A=["id"],M=["id","src","onLoad","onError"],W=["onClick"],Q=e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:E}){var _;const j=a();null==(_=t())||_.appContext.config.globalProperties.$viewerApi,l();const C=r([]),D=r({}),I=r(0),z=r(160),q=r(0),B=r(10),F=r(10),L=r([]),Q=r(null),R=r(0);s((()=>j.isLogin));const P=r(30),U=r(""),V=s((()=>P.value+B.value+250));n();const H=e,K=r();o.on("newData",(e=>{K.value=e}));const N=i({page:1,size:999,rec:1,squareType:H.type,keyword:""});function O(){!function(){const{showName:e=0,showOther:a=0}={};I.value=15*[e,a].filter((e=>e)).length}(),function(){if(!Q.value)return;const e=Q.value.clientWidth;q.value=Math.floor(e/V.value);const a=e-q.value*V.value,t=(q.value-1)*B.value;a-t<0&&(q.value-=1);z.value=Math.floor((e-t)/q.value)}();const e=q.value,a=z.value,t=[];G.value.forEach(((l,r)=>{let s=200,n=300;l.fileInfo&&(s=l.fileInfo.width||s,n=l.fileInfo.height||n);const o=n*(a/s)+F.value+I.value,i=D.value[l.id];if(t.length<e)i.style.top="0px",i.style.left=(a+B.value)*r+"px",t.push(o);else{const e=Math.min.apply(null,t),a=t.findIndex((a=>a===e));i.style.top=`${e+0}px`,i.style.left=a*(z.value+B.value)+"px",t[a]+=o}})),R.value=Math.max(...t)+130}const G=s((()=>K.value?K.value.rows:U.value?C.value.filter((e=>{const{prompt:a}=e;return a.includes(U.value)})):C.value));u(P,(()=>{O()}));let J=null;async function X(){let e;e="fav"===N.squareType?await x({page:N.page,size:N.size}):await b(N);let a=e.data.rows;a.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),C.value=a}u(G,(()=>{G.value.length&&(clearTimeout(J),J=setTimeout((()=>{O()}),300))}));const Y=s((()=>e=>{let a=200,t=300;return e.fileInfo&&(a=e.fileInfo.width,t=e.fileInfo.height),t/(a/z.value)})),Z=S((function(){O()}),200);return v((async()=>{await X(),O(),window.addEventListener("resize",Z)})),E({handleQuery:e=>{N.keyword="",N.squareType=e,X(),O()},handleSearch:e=>{N.squareType="",N.keyword=e,X(),O()}}),d((()=>{window.removeEventListener("resize",Z)})),(e,a)=>(c(),f("div",T,[p("div",$,[p("div",{id:"wapper",ref_key:"wapperRef",ref:Q,class:"wapper",style:h({height:`${R.value}px`})},[(c(!0),f(m,null,y(G.value,((e,t)=>(c(),f("div",{id:e.id,key:t,ref_for:!0,ref:a=>function(e,a){e&&a&&(D.value[a.id]=e)}(a,e),class:"wapper-item",style:h({width:`${z.value}px`})},[g(k,{name:"img",css:!0},{default:w((()=>[p("img",{id:e.id,class:"item-file rounded-sm",style:h({width:`${z.value}px`,height:`${Y.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){L.value.push(a.id)}(0,e),onError:a=>function(e,a){L.value.push(a.id)}(0,e)},null,44,M)])),_:2},1024),p("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},a[0]||(a[0]=[p("div",null,"查看详情",-1)]),8,W)],12,A)))),128))],4)])]))}}),R={style:{padding:"15px 24px 0 24px"},class:"bg-[#2B2D31] dark:bg-[#2B2D31]"},P={class:"topBox"},U={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},V={class:"relative z-40 transition-300 ease"},H={class:"flex justify-start items-center",ref:"tabListRef"},K=["onClick"],N={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},O={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},G={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},J={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},X={class:"flex-1 marketBox"},Y=F(e({__name:"square",setup(e){const{isMobile:a}=E(),t=r(""),l=r(),n=_(),i=s((()=>"dark"===n.theme)),u=r([]);(async()=>{const e=await B({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""},{name:"我的收藏",value:"fav"}].concat(e)||L,l.value.handleQuery(t.value)})();r("");const v=r("");function d(e){13==e.keyCode&&l.value.handleSearch(v.value)}return(e,r)=>(c(),f("div",R,[p("div",P,[j(a)?I("",!0):(c(),f("div",U,[p("div",V,[p("ul",H,[(c(!0),f(m,null,y(u.value,(e=>(c(),f("li",{onClick:a=>{return r=e,t.value=r.value,l.value.handleQuery(r.value),void o.emit("newData","");var r},class:C(["mr-1 ml-1 w-auto select-none cursor-pointer bg-white hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-r hover:from-[#957DF4] hover:to-[#3C69E7] dark:hover:from-transparent dark:hover:to-transparent dark:border dark:border-[transparent] dark:hover:border-[#3E6AE7] duration-300 flex rounded-lg",[e.value===t.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#3E6AE7] bg-[#dae7e6] border-0 dark:border dark:border-[#3E6AE7]":"bg-white dark:bg-transparent"]])},[p("div",N,D(e.name),1)],10,K)))),256))],512)])])),p("div",O,[i.value?(c(),f("img",G)):(c(),f("img",J)),z(p("input",{type:"text",onKeydown:d,name:"","onUpdate:modelValue":r[0]||(r[0]=e=>v.value=e),id:"",placeholder:"请输入关键词"},null,544),[[q,v.value]])])]),p("div",X,[g(Q,{ref_key:"marketRef",ref:l,type:t.value,keyWord:v.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-507fe2ed"]]);export{Y as default};
