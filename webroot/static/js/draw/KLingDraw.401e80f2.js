import{_ as e,a,b as l,c as t}from"../KLingIcon3/KLingIcon3.528c15f9.js";import{_ as s,a as i,b as r,c as o,d as n,e as u,f as d,g as c,h as p,i as v,j as m,k as g}from"../tuichu copy/tuichu copy.25d53ff0.js";import{e as f,Z as x,k,p as y,g as b,r as h,w as I,x as C,C as E,D as _,y as w,B as F,al as L,A as D,z as B,F as P,E as j,ai as A,G as T,a3 as U,a0 as M,an as q,I as z,bp as K,_ as S,L as V,v as N,aM as R,bX as O,aG as G,P as J,Q as Y,a1 as H,$ as Z,bY as Q,b$ as W,am as X,aH as $,N as ee,a4 as ae,aC as le,ba as te,q as se,bZ as ie,c0 as re,aV as oe,O as ne,bB as ue,c2 as de,bC as ce,bo as pe,W as ve,bx as me}from"../main-bf8e7d49.js";import{a as ge}from"../draw-fail/draw-fail.ad8fd01b.js";import{N as fe}from"../Popconfirm/Popconfirm.2a2fe636.js";import{n as xe}from"../index/index.9023fe76.js";import{_ as ke,C as ye,T as be}from"../aiVideoGou/aiVideoGou.62aded3f.js";import{_ as he,a as Ie,S as Ce}from"../AI2/AI2.5b310847.js";import{_ as Ee}from"../uploadImg/uploadImg.66d9b869.js";import{_ as _e,b as we}from"../baiduThink/baiduThink.c7603e58.js";import{u as Fe}from"../useUpload/useUpload.c9debee5.js";const Le={class:"dallTaskBox"},De=["src"],Be={class:"dallTaskItem bg-[#313338] dark:bg-[#313338]",style:{padding:"12px","border-radius":"12px",display:"flex","margin-top":"12px"}},Pe={class:"content",style:{"margin-left":"12px",width:"100%"}},je={style:{display:"flex","justify-content":"space-between"}},Ae={style:{display:"flex","align-items":"center"}},Te={class:"discord-time"},Ue={key:0,class:"flexLabel"},Me={class:"itemLabel"},qe={class:"itemLabel"},ze={key:0,class:"answerImgBox"},Ke=["onClick","src"],Se={key:1,style:{display:"flex","align-items":"center"}},Ve={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},Ne={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},Re={class:"loader"},Oe={class:"btnBox"},Ge={class:"btnItem"},Je={class:"btnItem"},Ye={class:"btnItem"},He=S(f({__name:"index",props:{task:{type:Object}},setup(t){const s=x(),i=k(),r=y(),o=b((()=>"dark"===s.theme)),n=t,u=h(!1),d=h("");let c=()=>{z.emit("copyKLData",n.task)},p=()=>{var e;(null==(e=null==i?void 0:i.userInfo)?void 0:e.score)>0?z.emit("generateKLDraw",n.task):r.error("积分不足")},v=h(!1),m=()=>{v.value=!0,K({id:n.task.id}).then((e=>{z.emit("dallKLList"),v.value=!1}))};return(t,s)=>(I(),C("div",Le,[E(w(M),{show:w(v)},{default:_((()=>[u.value?(I(),C("div",{key:0,onClick:s[1]||(s[1]=e=>{u.value=!1,d.value=""}),class:"mask"},[F("img",{src:d.value,style:{width:"auto",height:"90%"},alt:"",onClick:s[0]||(s[0]=L((()=>{}),["stop"]))},null,8,De)])):D("",!0),F("div",Be,[s[10]||(s[10]=F("div",{class:"avator"},[F("div",{class:"discord-avatar"},[F("img",{src:"/static/svg/Discord-KL-0b25b73f.svg",alt:""})])],-1)),F("div",Pe,[F("div",je,[F("div",Ae,[s[5]||(s[5]=F("span",{class:"discord-en"},"可灵-图片生成",-1)),F("div",Te,B(n.task.createdAt),1)])]),F("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:s[2]||(s[2]=e=>{var a;(a=n.task.prompt)?(q({text:a}),r.success("复制成功")):r.error("无内容可复制")})},B(n.task.prompt),1),n.task.requestParams?(I(),C("div",Ue,[F("div",Me,B(n.task.requestParams.model_name),1),F("div",qe,B(n.task.requestParams.aspect_ratio),1)])):D("",!0),F("div",null,[n.task.imgList&&n.task.imgList.length>0?(I(),C("div",ze,[(I(!0),C(P,null,j(n.task.imgList,(e=>(I(),C("img",{onClick:a=>function(e){u.value=!0,d.value=e}(e),src:e,alt:""},null,8,Ke)))),256))])):(I(),C("div",Se,[n.task.errMsg?(I(),C("div",Ve,s[6]||(s[6]=[F("img",{src:ge,alt:""},null,-1),F("p",{style:{"margin-top":"8px",color:"#D4237A"}},"绘画失败",-1)]))):(I(),C("div",Ne,[(I(!0),C(P,null,j(n.task.requestParams.n,(e=>(I(),C("div",Re)))),256))]))]))]),F("div",Oe,[F("div",Ge,[E(w(A),{trigger:"hover"},{trigger:_((()=>[F("img",{src:e,onClick:s[3]||(s[3]=(...e)=>w(c)&&w(c)(...e)),alt:""})])),default:_((()=>[s[7]||(s[7]=F("div",{style:{display:"flex","align-items":"center"}},[F("span",null,"使用本图片的参数")],-1))])),_:1,__:[7]})]),F("div",Je,[F("img",{src:a,onClick:s[4]||(s[4]=(...e)=>w(p)&&w(p)(...e)),alt:""})]),F("div",Ye,[E(w(fe),{onPositiveClick:w(m),style:T(o.value?"background:#19191B":"background:#F8F9F9")},{trigger:_((()=>s[8]||(s[8]=[F("img",{src:l,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:_((()=>[s[9]||(s[9]=U(" 您确认要删除任务吗？ "))])),_:1,__:[9]},8,["onPositiveClick","style"])])])])])])),_:1},8,["show"])]))}}),[["__scopeId","data-v-a867e718"]]),Ze={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#2b2d31] dark:bg-[#222325]"},Qe={class:"dallBox"},We={style:{display:"flex","align-items":"center",height:"60px"}},Xe={style:{width:"140px",position:"relative"},class:"customBox"},$e={key:0,class:"newModel"},ea={class:"custerSelect"},aa=["onClick"],la={class:"name"},ta={key:0,class:"newModel"},sa={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},ia={style:{width:"100%","text-align":"right","padding-right":"12px","padding-bottom":"14.5px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},ra={class:"recomBox"},oa={class:"labeBox"},na=["onClick"],ua={key:0,style:{display:"flex",margin:"16px 0 6px","justify-content":"space-between"}},da={key:1,class:"lityFlex"},ca=["onClick"],pa={key:2,style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},va=["src"],ma={class:"recomBox"},ga={class:"labeBox"},fa=["onClick","src"],xa={key:3,class:"sliderBox"},ka={key:4,class:"sliderBox"},ya={class:"flexSelect"},ba={style:{width:"116px","margin-right":"10px"}},ha={style:{width:"74px","margin-right":"10px"}},Ia={style:{position:"absolute",bottom:"12px",left:"0px",width:"100%"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},Ca={key:0},Ea={key:1},_a={key:2},wa={key:3},Fa={key:4,style:{display:"flex","align-items":"center"}},La={key:5},Da=S(f({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){const{selectFileByImageAndVideo:l}=Fe(),t=h("/api/file/upload"),s=y(),i=k(),r=b((()=>i.isLogin));b((()=>i.userInfo));const o=b((()=>1===i.userInfo.lifetimeVip||i.userInfo.vipExpire&&new Date(i.userInfo.vipExpire)>new Date));z.on("copyKLData",(e=>{me.value=e.requestParams.prompt,A.value=e.requestParams.model_name,ne.value=e.requestParams.aspect_ratio,v.value=e.requestParams.image_fidelity,m.value=e.requestParams.human_fidelity,g.value=e.requestParams.image_reference,xe.value=e.requestParams.image,re.value=e.requestParams.n}));const n=e;V(n,(e=>{0==e.isLoading&&(me.value="")}));const u=a,d=h(""),c=h("");N({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{c.value=e.data.mjModel,d.value=e.data.robotAvatar}));const p=h(!1);let v=h(.5),m=h(.45),g=h("face"),f=h([{label:"人物长相",value:"face"},{label:"角色特征",value:"subject"}]),x=h(!1),A=h("");const T=h([]);R({modelType:"draw",keyType:2}).then((e=>{console.log(e.data,"fetchQueryModelsListAPIMaps"),e.data.rows.forEach((e=>{T.value.push({label:e.modelName,info:e.remark,value:e.model,tags:e.tags})})),A.value=T.value[0].value}));let M=e=>{z.emit("dallKLModel",e)},K=h([]),S=h([]),te=()=>{const e=[...S.value].sort((()=>Math.random()-.5));K.value=e.slice(0,e.length>3?3:e.length)};function se(e=""){me.value=e}function ie(){me.value?(q({text:me.value}),s.success("复制成功")):s.error("无内容可复制")}Q().then((e=>{var a,l;S.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,te()})),h("std"),h([{label:"标准质量",value:"std"},{label:"高品质模式",value:"pro"}]);let re=h(4);const oe=h([{label:"1张",value:1},{label:"2张",value:2},{label:"3张",value:3},{label:"4张",value:4},{label:"5张",value:5},{label:"6张",value:6},{label:"7张",value:7},{label:"8张",value:8},{label:"9张",value:9}]);let ne=h("9:16");const ue=h([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"},{label:"21:9",value:"21:9"}]),de=h(),ce=h(),pe=()=>{de.value.open()},ve=()=>{ce.value.open()},me=h("");function ge(e){me.value=e}function fe(){if(!r.value)return void i.setLoginDialog(!0);if(!me.value)return void s.error("请输入画面描述");p.value=!0;let e={n:re.value,prompt:me.value,model_name:A.value,aspect_ratio:ne.value,human_fidelity:m.value,image_fidelity:v.value};"kling-v1-5"==A.value&&(e.image_reference=g.value,e.image=xe.value),"kling-v1"==A.value&&(e.image=xe.value),u("dallprompt",e),xe.value="",setTimeout((()=>{je()}),1e3)}V(n,(e=>{me.value=e.makePrompt})),z.on("generateKLDraw",(e=>{me.value=e.prompt,fe()}));let xe=h("");let Le=h([]),De=h([]),Be=()=>{const e=[...De.value].sort((()=>Math.random()-.5));Le.value=e.slice(0,e.length>5?5:e.length)};async function Pe(){try{(async function(){return new Promise((async(e,a)=>{try{const a=await l();await X.post(t.value,{file:a},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{console.log(a),200==a.data.code?e(a.data.data):s.error(null==a.data.message?a.data.data:a.data.message)}))}catch(i){s.error(i.message),e(!1)}}))})().then((e=>{xe.value=e}))}catch(e){s.error(e.message)}}function je(){let e={n:re.value,prompt:me.value,model_name:A.value,aspect_ratio:ne.value,image_fidelity:v.value,human_fidelity:m.value,image_reference:g.value,image:xe.value};O(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?(Ae.value=e.data,Te.value=!1):Te.value=!0})).catch((e=>{Te.value=!0}))}W().then((e=>{De.value=e.data,Be()}));const Ae=h({remainCount:0,freeCount:0,useIntegrate:0}),Te=h(!1);return V((()=>A.value),((e,a)=>{A.value&&je()}),{deep:!0,immediate:!0}),V((()=>ne.value),((e,a)=>{A.value&&je()}),{deep:!0,immediate:!0}),V((()=>re.value),((e,a)=>{A.value&&je()}),{deep:!0,immediate:!0}),(e,a)=>(I(),C("div",Ze,[E(_e,{ref_key:"inspirationRef",ref:de,onDall:ge,type:"dall"},null,512),E(we,{onDall:ge,type:"dall",ref_key:"thinkRef",ref:ce},null,512),F("div",Qe,[F("div",We,[a[13]||(a[13]=F("div",{class:"dark:text-[#EEEEF0] text-[#fff] text-[18px]",style:{"margin-right":"12px"}},"生图模型",-1)),F("div",Xe,[E(w($),{value:w(A),"onUpdate:value":[a[0]||(a[0]=e=>G(A)?A.value=e:A=e),w(M)],options:T.value,onClick:a[1]||(a[1]=e=>G(x)?x.value=!w(x):x=!w(x)),show:!1},null,8,["value","options","onUpdate:value"]),T.value.length>0&&w(A)&&T.value.filter((e=>e.value==w(A)))[0].tags?(I(),C("div",$e,B(T.value.filter((e=>e.value==w(A)))[0].tags),1)):D("",!0),J(F("div",ea,[a[12]||(a[12]=F("p",null,"视频模型选择:",-1)),(I(!0),C(P,null,j(T.value,(e=>(I(),C("div",{class:H(["selectItem",w(A)==e.value?"active":""]),onClick:a=>{G(A)?A.value=e.value:A=e.value,G(x)?x.value=!1:x=!1}},[F("div",la,[U(B(e.label)+" ",1),e.tags?(I(),C("div",ta,B(e.tags),1)):D("",!0)]),F("span",null,B(e.info),1),a[11]||(a[11]=F("img",{src:ke,alt:""},null,-1))],10,aa)))),256))],512),[[Y,w(x)]])])]),a[26]||(a[26]=F("div",{class:"border-b border-[#1d2027] dark:border-[#292A2E]",style:{width:"calc( 100% + 40px )",margin:"0 -20px"}},null,-1)),F("div",{class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},[a[16]||(a[16]=F("div",{class:"dark:text-[#EEEEF0] text-[#fff] text-[14px]"},"创意描述",-1)),F("div",{class:"labeBox",style:{flex:"none"}},[F("div",{class:"labeItem",onClick:ve},a[14]||(a[14]=[F("img",{src:he,alt:""},null,-1),F("span",null,"AI生成描述",-1)])),F("div",{class:"labeItem",onClick:pe},a[15]||(a[15]=[F("img",{src:Ie,alt:""},null,-1),F("span",null,"提示词",-1)]))])]),F("div",sa,[J(F("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>me.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:"描述你想生成的画面和动作。例如：美丽的油画少女，柔光落在她的脸上"},"\t\t\t\t",512),[[Z,me.value]]),F("div",ia,[E(w(ee),{size:"18px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:ie},{default:_((()=>[E(w(ye))])),_:1}),E(w(ee),{size:"18px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[3]||(a[3]=e=>se())},{default:_((()=>[E(w(be))])),_:1})]),a[18]||(a[18]=F("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),F("div",ra,[a[17]||(a[17]=F("span",null,"推荐：",-1)),F("div",oa,[(I(!0),C(P,null,j(w(K),(e=>(I(),C("div",{class:"labeItem",onClick:a=>se(e.descript)},B(e.name),9,na)))),256))]),E(w(ee),{size:"20px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:w(te)},{default:_((()=>[E(w(Ce))])),_:1},8,["onClick"])])]),"kling-v2"!=w(A)?(I(),C("div",ua,a[19]||(a[19]=[F("div",null,[F("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},[U("上传参考图 "),F("span",{class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},"（非必填）")])],-1)]))):D("",!0),"kling-v1-5"==w(A)?(I(),C("div",da,[(I(!0),C(P,null,j(w(f),(e=>(I(),C("div",{class:H(["lityItem",w(g)==e.value?"active":""]),onClick:a=>G(g)?g.value=e.value:g=e.value},B(e.label),11,ca)))),256))])):D("",!0),"kling-v2"!=w(A)?(I(),C("div",pa,[""!=w(xe)&&w(xe)?(I(),C("div",{key:1,onClick:a[6]||(a[6]=e=>Pe()),style:{height:"134px","border-radius":"8px",display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#393936] resultImg"},[F("img",{src:w(xe),style:{width:"auto",height:"100%"}},null,8,va),E(w(ee),{size:"18px",color:"#fff",style:{cursor:"pointer","z-index":"9"},onClick:a[5]||(a[5]=L((e=>G(xe)?xe.value="":xe=""),["stop"]))},{default:_((()=>[E(w(be))])),_:1})])):(I(),C("div",{key:0,onClick:a[4]||(a[4]=e=>Pe()),style:{height:"134px",padding:"8px","border-radius":"8px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#17181a]"},a[20]||(a[20]=[F("img",{src:Ee,alt:""},null,-1),F("div",{class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]",style:{"margin-top":"12px"}},"上传参考图",-1),F("div",{class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},"支持JPG/PNG格式",-1)]))),a[22]||(a[22]=F("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),F("div",ma,[a[21]||(a[21]=F("span",null,"推荐：",-1)),F("div",ga,[(I(!0),C(P,null,j(w(Le),(e=>(I(),C("img",{class:"labeImg",onClick:a=>{return l=e,void(xe.value=l.imageUrl);var l},src:e.imageUrl,alt:""},null,8,fa)))),256))]),E(w(ee),{size:"20px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:w(Be)},{default:_((()=>[E(w(Ce))])),_:1},8,["onClick"])])])):D("",!0),"kling-v2"!=w(A)?(I(),C("div",xa,[F("span",null,B("kling-v1-5"==w(A)?"脸部参考":"图片参考")+":",1),E(w(ae),{style:{flex:"1",margin:"0 10px"},value:w(v),"onUpdate:value":a[7]||(a[7]=e=>G(v)?v.value=e:v=e),step:.05,max:1,min:.1},null,8,["value"]),F("span",null,B(w(v)),1)])):D("",!0),"kling-v2"!=w(A)?(I(),C("div",ka,[a[23]||(a[23]=F("span",null,"主体参考:",-1)),E(w(ae),{style:{flex:"1",margin:"0 10px"},value:w(m),"onUpdate:value":a[8]||(a[8]=e=>G(m)?m.value=e:m=e),step:.05,max:1,min:.1},null,8,["value"]),F("span",null,B(w(m)),1)])):D("",!0),F("div",ya,[F("div",ba,[E(w($),{value:w(ne),"onUpdate:value":a[9]||(a[9]=e=>G(ne)?ne.value=e:ne=e),options:ue.value},null,8,["value","options"])]),F("div",ha,[E(w($),{value:w(re),"onUpdate:value":a[10]||(a[10]=e=>G(re)?re.value=e:re=e),options:oe.value},null,8,["value","options"])])]),F("div",Ia,[E(w(le),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"55px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:fe},{default:_((()=>[Te.value?(I(),C("span",Ca,"模型未配置")):w(i).isLogin?Ae.value&&Ae.value.isVipFree&&o.value?(I(),C("span",_a,"会员免费")):Ae.value&&Ae.value.remainCount&&o.value?(I(),C("span",wa,"剩余"+B(Ae.value.remainCount)+"次免费",1)):Ae.value?(I(),C("div",Fa,[a[24]||(a[24]=F("span",null,"立即生成（",-1)),F("span",null,B(Ae.value.useIntegrate),1),a[25]||(a[25]=F("span",null,"积分/次）",-1))])):(I(),C("span",La,"生成")):(I(),C("span",Ea,"开始生成"))])),_:1})])])]))}}),[["__scopeId","data-v-4beaa578"]]),Ba={class:"bg-[#f2f2f5] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},Pa={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px"},class:"contentBox bg-[#313338] dark:bg-[#313338]"},ja={style:{width:"calc( 100% + 24px )",margin:"0 -12px",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},Aa={class:"rightBox"},Ta={key:0,class:"popupBox dark:bg-[#111113] bg-[#FFFFFF] border border-[2px] dark:border-[#25252A] border-[#F9F9F9]"},Ua={key:0,class:"popupIcon",src:s,alt:""},Ma={key:1,class:"popupIcon",src:i,alt:""},qa={key:0,class:"popupIcon",src:r,alt:""},za={key:1,class:"popupIcon",src:o,alt:""},Ka={key:0,class:"popupIcon",src:n,alt:""},Sa={key:1,class:"popupIcon",src:u,alt:""},Va={key:0,class:"popupIcon",src:d,alt:""},Na={key:1,class:"popupIcon",src:c,alt:""},Ra={key:0,class:"popupIcon",src:p,alt:""},Oa={key:1,class:"popupIcon",src:v,alt:""},Ga={key:0,class:"popupIcon",src:m,alt:""},Ja={key:1,class:"popupIcon",src:g,alt:""},Ya=S(f({__name:"KLingDraw",setup(e){let a;const l=y(),s=k(),i=te(),r=x(),o=b((()=>s.userInfo.avatar)),n=b((()=>1===s.userInfo.lifetimeVip||s.userInfo.vipExpire&&new Date(s.userInfo.vipExpire)>new Date)),u=b((()=>s.isLogin)),d=b((()=>"dark"===r.theme)),c=h(null);function p(){let e=c.value;e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight)}V(u,(e=>{e&&g()})),se((()=>{setTimeout((()=>p()),300)}));const v=h([]);se((()=>{g()}));let m={page:1,size:999,keyType:2};z.on("dallKLModel",(e=>{})),z.on("dallKLList",(()=>{g()}));const g=async function(){a&&clearInterval(a),v.value=[];let e=(await ie(m)).data.reverse(),l=!0;e.forEach((e=>{!1===e.isDelete&&(e.imgList=JSON.parse(e.fileInfo),v.value.push(e))})),a=setInterval((()=>{e.forEach(((e,a)=>{!1===e.isDelete&&("succeed"==e.answer||e.fileInfo||e.errMsg?(e.imgList=JSON.parse(e.fileInfo),v.value[a]=e):(l=!1,re({id:e.id}).then((e=>{"succeed"==e.data.answer&&e.data.imageUrl&&(e.data.imgList=JSON.parse(e.data.imageUrl),v.value.forEach(((a,l)=>{a.id==e.data.id&&(v.value[l]=e.data)})),clearInterval([interName]),f.value=!1,z.emit("getUserInfo",!0),setTimeout((()=>p()),300))}))))})),l&&clearInterval(a)}),3e3),console.log(v.value,"taskList.value"),setTimeout((()=>p()),300)};oe((()=>{a&&clearInterval(a)}));const f=h(!1);async function _(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[],errMsg:!1};f.value=!0,v.value.push(a),setTimeout((()=>p()),300),await de(e).then((e=>{v.value[v.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>p()),300);let a=setInterval((()=>{re({id:e.data.id}).then((e=>{("succeed"==e.data.answer&&e.data.imageUrl||e.data.failReason)&&(e.data.errMsg=e.data.failReason,e.data.failReason&&l.error(e.data.failReason),e.data.imgList=JSON.parse(e.data.imageUrl),v.value[v.value.length-1]=e.data,clearInterval(a),f.value=!1,z.emit("getUserInfo",!0),setTimeout((()=>p()),300))}))}),3e3)})).catch((e=>{f.value=!1,v.value[v.value.length-1].fail=!0,l.error(e.message)}))}const L=h("");function A(e){L.value=e}const T=h(!1),U=()=>{M()},M=async()=>{s.checkAuth()&&i.updateVipDialog(!0)};async function q(){try{const e=await ce();if(200!=e.code)return l.error("签到失败！🎉  \n "+e.data);l.success("恭喜您，签到成功！🎉  \n  🎁 您已获得"+e.data+"积分奖励！"),s.getUserInfo()}catch(e){console.log(e),l.error("签到失败！ \n "+e.message)}}function K(){u.value?(s.logOut(),localStorage.removeItem("chatLogId")):(s.setLoginDialog(!0),z.emit("register",0))}const S=h();function N(){S.value.open()}return(e,a)=>(I(),C("div",Ba,[E(Da,{type:"dall",makePrompt:L.value,isLoading:f.value,onDallprompt:_},null,8,["makePrompt","isLoading"]),F("div",Pa,[F("div",ja,[a[15]||(a[15]=F("div",{class:"borTitel"},[F("span",{style:{color:"#ffffff","font-size":"18px"}},"# 创作中心"),F("p",{style:{"margin-left":"13px",color:"#F0B132","font-size":"14px"}}," 请遵守中华人民共和国网络安全法，严禁生成涉及政治人物、色情、恐怖等不良内容，如有则违规封号处理。 ")],-1)),F("div",Aa,[a[5]||(a[5]=F("img",{src:t,alt:""},null,-1)),F("span",null,B(w(s).userInfo.score),1),a[6]||(a[6]=F("div",{class:"shu"},null,-1)),n.value?(I(),C("div",{key:0,onClick:a[0]||(a[0]=e=>w(i).updateVipDialog(!0))},B(1==w(s).userInfo.lifetimeVip?"永久会员":"会员到期: "+w(pe)(w(s).userInfo.vipExpire,"YYYY-MM-DD")),1)):(I(),C("div",{key:1,onClick:a[1]||(a[1]=e=>w(i).updateVipDialog(!0))}," 开通会员，得积分 "))]),u.value?(I(),C("div",{key:0,class:"flex justify-between items-center px-2 py-1 text-white",style:{position:"relative"},onClick:N},[E(w(me),{size:36,src:o.value,round:"",bordered:"","fallback-src":w(ve),class:"cursor-pointer"},null,8,["src","fallback-src"]),T.value?(I(),C("div",Ta,[F("div",{class:H(["popupItem",d.value?"darkItem":"lightItem"]),onClick:U},[d.value?(I(),C("img",Ua)):(I(),C("img",Ma)),a[7]||(a[7]=F("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"我的积分",-1))],2),F("div",{class:H(["popupItem",d.value?"darkItem":"lightItem"]),onClick:q},[d.value?(I(),C("img",qa)):(I(),C("img",za)),a[8]||(a[8]=F("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"签到奖励",-1))],2),F("div",{class:H(["popupItem",d.value?"darkItem":"lightItem"]),onClick:a[2]||(a[2]=e=>w(s).updateInviteRecordDialog(!0))},[d.value?(I(),C("img",Ka)):(I(),C("img",Sa)),a[9]||(a[9]=F("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"邀请好友",-1))],2),F("div",{class:H(["popupItem",d.value?"darkItem":"lightItem"]),onClick:a[3]||(a[3]=e=>w(s).updateKamilDialog(!0))},[d.value?(I(),C("img",Va)):(I(),C("img",Na)),a[10]||(a[10]=F("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"权益兑换",-1))],2),F("div",{class:H(["popupItem",d.value?"darkItem":"lightItem"]),onClick:a[4]||(a[4]=e=>w(s).updateSettingDialog(!0))},[d.value?(I(),C("img",Ra)):(I(),C("img",Oa)),a[11]||(a[11]=F("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"设置",-1))],2),a[13]||(a[13]=F("div",{class:"line bg-[#E8E8E8] dark:bg-[#2C2D31]"},null,-1)),F("div",{class:H(["popupItem",d.value?"darkItem":"lightItem"]),onClick:K},[d.value?(I(),C("img",Ga)):(I(),C("img",Ja)),a[12]||(a[12]=F("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"退出",-1))],2)])):D("",!0)])):D("",!0),u.value?D("",!0):(I(),C("div",{key:1,class:"flex items-center flex-start",onClick:K},[E(w(me),{size:36,src:"http://localhost:9100/src/assets/avatar.png",round:"",bordered:"","fallback-src":w(ve),class:"cursor-pointer"},null,8,["fallback-src"]),a[14]||(a[14]=F("p",{class:"text-xl ml-2"},null,-1))]))]),F("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px"},ref_key:"taskBox",ref:c},[u.value&&0!=v.value.length?(I(!0),C(P,{key:0},j(v.value,(e=>(I(),ne(He,{key:e.id,task:e},null,8,["task"])))),128)):(I(),ne(xe,{key:1,onHandleprompt:A}))],512)]),E(ue,{style:{right:"20px",left:"auto",bottom:"auto",top:"60px",border:"1px solid #EAEBEC"},ref_key:"userDialogRef",ref:S},null,512)]))}}),[["__scopeId","data-v-157e32d8"]]);export{Ya as default};
