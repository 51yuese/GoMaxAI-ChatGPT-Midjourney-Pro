import{_ as e,a,b as l,c as t}from"../KLingIcon3/KLingIcon3.528c15f9.js";import{e as s,$ as i,k as r,p as o,g as n,r as u,w as d,x as c,B as p,C as v,D as m,A as g,ap as f,z as x,y as k,F as b,E as y,am as h,G as I,a3 as C,a1 as E,aq as _,J as w,bs as F,_ as L,M as D,v as B,aa as P,aK as j,Q as A,R as T,I as U,a0 as M,bR as q,c8 as z,ad as S,aL as K,N as V,a4 as N,aF as R,bS as O,bd as J,q as Y,bT as G,c9 as H,aY as Q,P as $,bU as W,bV as X,bW as Z,bX as ee,bY as ae,bZ as le,b_ as te,b$ as se,c0 as ie,c1 as re,c2 as oe,c3 as ne,c4 as ue,cb as de,c6 as ce,br as pe,S as ve,c7 as me}from"../main-23bab8dd.js";import{a as ge}from"../draw-fail/draw-fail.ad8fd01b.js";import{N as fe}from"../Popconfirm/Popconfirm.6ca3ead0.js";import{n as xe}from"../index/index.f36d8aa8.js";import{_ as ke,C as be,T as ye}from"../aiVideoGou/aiVideoGou.7740b7b2.js";import{_ as he,a as Ie,S as Ce}from"../AI2/AI2.a669895b.js";import{_ as Ee}from"../uploadImg/uploadImg.66d9b869.js";import{_ as _e,b as we}from"../baiduThink/baiduThink.2b87cc66.js";import{u as Fe}from"../useUpload/useUpload.7fa4e6f3.js";const Le={class:"dallTaskBox"},De=["src"],Be={class:"dallTaskItem bg-[#313338] dark:bg-[#313338]",style:{padding:"12px","border-radius":"12px",display:"flex","margin-top":"12px"}},Pe={class:"content",style:{"margin-left":"12px",width:"100%"}},je={style:{display:"flex","justify-content":"space-between"}},Ae={style:{display:"flex","align-items":"center"}},Te={class:"discord-time"},Ue={key:0,class:"flexLabel"},Me={class:"itemLabel"},qe={class:"itemLabel"},ze={key:0,class:"answerImgBox"},Se=["onClick","src"],Ke={key:1,style:{display:"flex","align-items":"center"}},Ve={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},Ne={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},Re={class:"loader"},Oe={class:"btnBox"},Je={class:"btnItem"},Ye={class:"btnItem"},Ge={class:"btnItem"},He=L(s({__name:"index",props:{task:{type:Object}},setup(t){const s=i(),L=r(),D=o(),B=n((()=>"dark"===s.theme)),P=t,j=u(!1),A=u("");let T=()=>{w.emit("copyKLData",P.task)},U=()=>{var e;(null==(e=null==L?void 0:L.userInfo)?void 0:e.score)>0?w.emit("generateKLDraw",P.task):D.error("积分不足")},M=u(!1),q=()=>{M.value=!0,F({id:P.task.id}).then((e=>{w.emit("dallKLList"),M.value=!1}))};return(t,s)=>(d(),c("div",Le,[p(m(E),{show:m(M)},{default:v((()=>[j.value?(d(),c("div",{key:0,onClick:s[1]||(s[1]=e=>{j.value=!1,A.value=""}),class:"mask"},[g("img",{src:A.value,style:{width:"auto",height:"90%"},alt:"",onClick:s[0]||(s[0]=f((()=>{}),["stop"]))},null,8,De)])):x("",!0),g("div",Be,[s[10]||(s[10]=g("div",{class:"avator"},[g("div",{class:"discord-avatar"},[g("img",{src:"/static/svg/Discord-KL-0b25b73f.svg",alt:""})])],-1)),g("div",Pe,[g("div",je,[g("div",Ae,[s[5]||(s[5]=g("span",{class:"discord-en"},"可灵-图片生成",-1)),g("div",Te,k(P.task.createdAt),1)])]),g("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:s[2]||(s[2]=e=>{var a;(a=P.task.prompt)?(_({text:a}),D.success("复制成功")):D.error("无内容可复制")})},k(P.task.prompt),1),P.task.requestParams?(d(),c("div",Ue,[g("div",Me,k(P.task.requestParams.model_name),1),g("div",qe,k(P.task.requestParams.aspect_ratio),1)])):x("",!0),g("div",null,[P.task.imgList&&P.task.imgList.length>0?(d(),c("div",ze,[(d(!0),c(b,null,y(P.task.imgList,(e=>(d(),c("img",{onClick:a=>function(e){j.value=!0,A.value=e}(e),src:e,alt:""},null,8,Se)))),256))])):(d(),c("div",Ke,[P.task.errMsg?(d(),c("div",Ve,s[6]||(s[6]=[g("img",{src:ge,alt:""},null,-1),g("p",{style:{"margin-top":"8px",color:"#D4237A"}},"绘画失败",-1)]))):(d(),c("div",Ne,[(d(!0),c(b,null,y(P.task.requestParams.n,(e=>(d(),c("div",Re)))),256))]))]))]),g("div",Oe,[g("div",Je,[p(m(h),{trigger:"hover"},{trigger:v((()=>[g("img",{src:e,onClick:s[3]||(s[3]=(...e)=>m(T)&&m(T)(...e)),alt:""})])),default:v((()=>[s[7]||(s[7]=g("div",{style:{display:"flex","align-items":"center"}},[g("span",null,"使用本图片的参数")],-1))])),_:1})]),g("div",Ye,[g("img",{src:a,onClick:s[4]||(s[4]=(...e)=>m(U)&&m(U)(...e)),alt:""})]),g("div",Ge,[p(m(fe),{onPositiveClick:m(q),style:I(B.value?"background:#19191B":"background:#F8F9F9")},{trigger:v((()=>s[8]||(s[8]=[g("img",{src:l,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:v((()=>[s[9]||(s[9]=C(" 您确认要删除任务吗？ "))])),_:1},8,["onPositiveClick","style"])])])])])])),_:1},8,["show"])]))}}),[["__scopeId","data-v-a867e718"]]),Qe={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#2b2d31] dark:bg-[#222325]"},$e={class:"dallBox"},We={style:{display:"flex","align-items":"center",height:"60px"}},Xe={style:{width:"140px",position:"relative"},class:"customBox"},Ze={key:0,class:"newModel"},ea={class:"custerSelect"},aa=["onClick"],la={class:"name"},ta={key:0,class:"newModel"},sa={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},ia={style:{width:"100%","text-align":"right","padding-right":"12px","padding-bottom":"14.5px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},ra={class:"recomBox"},oa={class:"labeBox"},na=["onClick"],ua={key:0,class:"lityFlex"},da=["onClick"],ca={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},pa=["src"],va={class:"recomBox"},ma={class:"labeBox"},ga=["onClick","src"],fa={class:"sliderBox"},xa={class:"sliderBox"},ka={class:"flexSelect"},ba={style:{width:"116px","margin-right":"10px"}},ya={style:{width:"74px","margin-right":"10px"}},ha={style:{position:"absolute",bottom:"12px",left:"0px",width:"100%"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},Ia={key:0},Ca={key:1},Ea={key:2},_a={key:3},wa={key:4,style:{display:"flex","align-items":"center"}},Fa={key:5},La=L(s({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){const{selectFileByImageAndVideo:l}=Fe(),t=u("/api/file/upload"),s=o(),i=r(),h=n((()=>i.isLogin));n((()=>i.userInfo)),w.on("copyKLData",(e=>{ve.value=e.requestParams.prompt,W.value=e.requestParams.model_name,oe.value=e.requestParams.aspect_ratio,Y.value=e.requestParams.image_fidelity,G.value=e.requestParams.human_fidelity,H.value=e.requestParams.image_reference,fe.value=e.requestParams.image,ie.value=e.requestParams.n}));const I=e;D(I,(e=>{0==e.isLoading&&(ve.value="")}));const E=a,F=u(""),L=u("");B({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{L.value=e.data.mjModel,F.value=e.data.robotAvatar}));const J=u(!1);let Y=u(.5),G=u(.45),H=u("face"),Q=u([{label:"人物长相",value:"face"},{label:"角色特征",value:"subject"}]),$=u(!1),W=u("");const X=u([]);P({modelType:"draw",keyType:2}).then((e=>{console.log(e.data,"fetchQueryModelsListAPIMaps"),e.data.rows.forEach((e=>{X.value.push({label:e.modelName,info:e.remark,value:e.model,tags:e.tags})})),W.value=X.value[0].value}));let Z=e=>{w.emit("dallKLModel",e)},ee=u([]),ae=u([]),le=()=>{const e=[...ae.value].sort((()=>Math.random()-.5));ee.value=e.slice(0,e.length>3?3:e.length)};function te(e=""){ve.value=e}function se(){ve.value?(_({text:ve.value}),s.success("复制成功")):s.error("无内容可复制")}q().then((e=>{var a,l;ae.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,le()})),u("std"),u([{label:"标准质量",value:"std"},{label:"高品质模式",value:"pro"}]);let ie=u(4);const re=u([{label:"1张",value:1},{label:"2张",value:2},{label:"3张",value:3},{label:"4张",value:4},{label:"5张",value:5},{label:"6张",value:6},{label:"7张",value:7},{label:"8张",value:8},{label:"9张",value:9}]);let oe=u("9:16");const ne=u([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"},{label:"21:9",value:"21:9"}]),ue=u(),de=u(),ce=()=>{ue.value.open()},pe=()=>{de.value.open()},ve=u("");function me(e){ve.value=e}function ge(){if(!h.value)return void i.setLoginDialog(!0);if(!ve.value)return void s.error("请输入画面描述");J.value=!0;let e={n:ie.value,prompt:ve.value,model_name:W.value,aspect_ratio:oe.value,human_fidelity:G.value,image_fidelity:Y.value,image:fe.value};"kling-v1-5"==W.value&&(e.image_reference=H.value),E("dallprompt",e),fe.value=""}D(I,(e=>{ve.value=e.makePrompt})),w.on("generateKLDraw",(e=>{ve.value=e.prompt,ge()}));let fe=u("");let xe=u([]),Le=u([]),De=()=>{const e=[...Le.value].sort((()=>Math.random()-.5));xe.value=e.slice(0,e.length>5?5:e.length)};async function Be(){try{(async function(){return new Promise((async(e,a)=>{try{const a=await l();await S.post(t.value,{file:a},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{console.log(a),200==a.data.code?e(a.data.data):s.error(null==a.data.message?a.data.data:a.data.message)}))}catch(i){s.error(i.message),e(!1)}}))})().then((e=>{fe.value=e}))}catch(e){s.error(e.message)}}function Pe(){let e={n:ie.value,prompt:ve.value,model_name:W.value,aspect_ratio:oe.value,image_fidelity:Y.value,human_fidelity:G.value,image_reference:H.value,image:fe.value};O(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?(je.value=e.data,Ae.value=!1):Ae.value=!0})).catch((e=>{Ae.value=!0}))}z().then((e=>{Le.value=e.data,De()}));const je=u({remainCount:0,freeCount:0,useIntegrate:0}),Ae=u(!1);return D((()=>W.value),((e,a)=>{W.value&&Pe()}),{deep:!0,immediate:!0}),D((()=>oe.value),((e,a)=>{W.value&&Pe()}),{deep:!0,immediate:!0}),D((()=>ie.value),((e,a)=>{W.value&&Pe()}),{deep:!0,immediate:!0}),(e,a)=>(d(),c("div",Qe,[p(_e,{ref_key:"inspirationRef",ref:ue,onDall:me,type:"dall"},null,512),p(we,{onDall:me,type:"dall",ref_key:"thinkRef",ref:de},null,512),g("div",$e,[g("div",We,[a[13]||(a[13]=g("div",{class:"dark:text-[#EEEEF0] text-[#fff] text-[18px]",style:{"margin-right":"12px"}},"生图模型",-1)),g("div",Xe,[p(m(K),{value:m(W),"onUpdate:value":[a[0]||(a[0]=e=>j(W)?W.value=e:W=e),m(Z)],options:X.value,onClick:a[1]||(a[1]=e=>j($)?$.value=!m($):$=!m($)),show:!1},null,8,["value","options","onUpdate:value"]),X.value.length>0&&m(W)&&X.value.filter((e=>e.value==m(W)))[0].tags?(d(),c("div",Ze,k(X.value.filter((e=>e.value==m(W)))[0].tags),1)):x("",!0),A(g("div",ea,[a[12]||(a[12]=g("p",null,"视频模型选择:",-1)),(d(!0),c(b,null,y(X.value,(e=>(d(),c("div",{class:U(["selectItem",m(W)==e.value?"active":""]),onClick:a=>{j(W)?W.value=e.value:W=e.value,j($)?$.value=!1:$=!1}},[g("div",la,[C(k(e.label)+" ",1),e.tags?(d(),c("div",ta,k(e.tags),1)):x("",!0)]),g("span",null,k(e.info),1),a[11]||(a[11]=g("img",{src:ke,alt:""},null,-1))],10,aa)))),256))],512),[[T,m($)]])])]),a[25]||(a[25]=g("div",{class:"border-b border-[#1d2027] dark:border-[#292A2E]",style:{width:"calc( 100% + 40px )",margin:"0 -20px"}},null,-1)),g("div",{class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},[a[16]||(a[16]=g("div",{class:"dark:text-[#EEEEF0] text-[#fff] text-[14px]"},"创意描述",-1)),g("div",{class:"labeBox",style:{flex:"none"}},[g("div",{class:"labeItem",onClick:pe},a[14]||(a[14]=[g("img",{src:he,alt:""},null,-1),g("span",null,"AI生成描述",-1)])),g("div",{class:"labeItem",onClick:ce},a[15]||(a[15]=[g("img",{src:Ie,alt:""},null,-1),g("span",null,"提示词",-1)]))])]),g("div",sa,[A(g("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>ve.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:"描述你想生成的画面和动作。例如：美丽的油画少女，柔光落在她的脸上"},"\t\t\t\t",512),[[M,ve.value]]),g("div",ia,[p(m(V),{size:"18px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:se},{default:v((()=>[p(m(be))])),_:1}),p(m(V),{size:"18px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[3]||(a[3]=e=>te())},{default:v((()=>[p(m(ye))])),_:1})]),a[18]||(a[18]=g("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),g("div",ra,[a[17]||(a[17]=g("span",null,"推荐：",-1)),g("div",oa,[(d(!0),c(b,null,y(m(ee),(e=>(d(),c("div",{class:"labeItem",onClick:a=>te(e.descript)},k(e.name),9,na)))),256))]),p(m(V),{size:"20px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:m(le)},{default:v((()=>[p(m(Ce))])),_:1},8,["onClick"])])]),a[26]||(a[26]=g("div",{style:{display:"flex",margin:"16px 0 6px","justify-content":"space-between"}},[g("div",null,[g("div",{class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},[C("上传参考图 "),g("span",{class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},"（非必填）")])])],-1)),"kling-v1-5"==m(W)?(d(),c("div",ua,[(d(!0),c(b,null,y(m(Q),(e=>(d(),c("div",{class:U(["lityItem",m(H)==e.value?"active":""]),onClick:a=>j(H)?H.value=e.value:H=e.value},k(e.label),11,da)))),256))])):x("",!0),g("div",ca,[""!=m(fe)&&m(fe)?(d(),c("div",{key:1,onClick:a[6]||(a[6]=e=>Be()),style:{height:"134px","border-radius":"8px",display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#393936] resultImg"},[g("img",{src:m(fe),style:{width:"auto",height:"100%"}},null,8,pa),p(m(V),{size:"18px",color:"#fff",style:{cursor:"pointer","z-index":"9"},onClick:a[5]||(a[5]=f((e=>j(fe)?fe.value="":fe=""),["stop"]))},{default:v((()=>[p(m(ye))])),_:1})])):(d(),c("div",{key:0,onClick:a[4]||(a[4]=e=>Be()),style:{height:"134px",padding:"8px","border-radius":"8px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#17181a]"},a[19]||(a[19]=[g("img",{src:Ee,alt:""},null,-1),g("div",{class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]",style:{"margin-top":"12px"}},"上传参考图",-1),g("div",{class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},"支持JPG/PNG格式",-1)]))),a[21]||(a[21]=g("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),g("div",va,[a[20]||(a[20]=g("span",null,"推荐：",-1)),g("div",ma,[(d(!0),c(b,null,y(m(xe),(e=>(d(),c("img",{class:"labeImg",onClick:a=>{return l=e,void(fe.value=l.imageUrl);var l},src:e.imageUrl,alt:""},null,8,ga)))),256))]),p(m(V),{size:"20px",color:"#fff",style:{"margin-left":"10px",cursor:"pointer"},onClick:m(De)},{default:v((()=>[p(m(Ce))])),_:1},8,["onClick"])])]),g("div",fa,[g("span",null,k("kling-v1-5"==m(W)?"脸部参考":"图片参考")+":",1),p(m(N),{style:{flex:"1",margin:"0 10px"},value:m(Y),"onUpdate:value":a[7]||(a[7]=e=>j(Y)?Y.value=e:Y=e),step:.05,max:1,min:.1},null,8,["value"]),g("span",null,k(m(Y)),1)]),g("div",xa,[a[22]||(a[22]=g("span",null,"主体参考:",-1)),p(m(N),{style:{flex:"1",margin:"0 10px"},value:m(G),"onUpdate:value":a[8]||(a[8]=e=>j(G)?G.value=e:G=e),step:.05,max:1,min:.1},null,8,["value"]),g("span",null,k(m(G)),1)]),g("div",ka,[g("div",ba,[p(m(K),{value:m(oe),"onUpdate:value":a[9]||(a[9]=e=>j(oe)?oe.value=e:oe=e),options:ne.value},null,8,["value","options"])]),g("div",ya,[p(m(K),{value:m(ie),"onUpdate:value":a[10]||(a[10]=e=>j(ie)?ie.value=e:ie=e),options:re.value},null,8,["value","options"])])]),g("div",ha,[p(m(R),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"55px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:ge},{default:v((()=>[Ae.value?(d(),c("span",Ia,"模型未配置")):m(i).isLogin?je.value&&je.value.isVipFree?(d(),c("span",Ea,"会员免费")):je.value&&je.value.remainCount?(d(),c("span",_a,"剩余"+k(je.value.remainCount)+"次免费",1)):je.value?(d(),c("div",wa,[a[23]||(a[23]=g("span",null,"立即生成（",-1)),g("span",null,k(je.value.useIntegrate),1),a[24]||(a[24]=g("span",null,"积分/次）",-1))])):(d(),c("span",Fa,"生成")):(d(),c("span",Ca,"开始生成"))])),_:1})])])]))}}),[["__scopeId","data-v-65a45a8a"]]),Da={class:"bg-[#f2f2f5] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},Ba={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px"},class:"contentBox bg-[#313338] dark:bg-[#313338]"},Pa={style:{width:"calc( 100% + 24px )",margin:"0 -12px",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},ja={class:"rightBox"},Aa={key:0,class:"popupBox dark:bg-[#111113] bg-[#FFFFFF] border border-[2px] dark:border-[#25252A] border-[#F9F9F9]"},Ta={key:0,class:"popupIcon",src:X,alt:""},Ua={key:1,class:"popupIcon",src:Z,alt:""},Ma={key:0,class:"popupIcon",src:ee,alt:""},qa={key:1,class:"popupIcon",src:ae,alt:""},za={key:0,class:"popupIcon",src:le,alt:""},Sa={key:1,class:"popupIcon",src:te,alt:""},Ka={key:0,class:"popupIcon",src:se,alt:""},Va={key:1,class:"popupIcon",src:ie,alt:""},Na={key:0,class:"popupIcon",src:re,alt:""},Ra={key:1,class:"popupIcon",src:oe,alt:""},Oa={key:0,class:"popupIcon",src:ne,alt:""},Ja={key:1,class:"popupIcon",src:ue,alt:""},Ya=L(s({__name:"KLingDraw",setup(e){let a;const l=o(),s=r(),v=J(),f=i(),h=n((()=>s.userInfo.avatar)),I=n((()=>1===s.userInfo.lifetimeVip||s.userInfo.vipExpire&&new Date(s.userInfo.vipExpire)>new Date)),C=n((()=>s.isLogin)),E=n((()=>"dark"===f.theme)),_=u(null);function F(){let e=_.value;e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight)}D(C,(e=>{e&&P()})),Y((()=>{setTimeout((()=>F()),300)}));const L=u([]);Y((()=>{P()}));let B={page:1,size:999,model:"kling-v2",keyType:2};w.on("dallKLModel",(e=>{B.model=e})),w.on("dallKLList",(()=>{P()}));const P=async function(){a&&clearInterval(a),L.value=[];let e=(await G(B)).data.reverse(),l=!0;e.forEach((e=>{!1===e.isDelete&&(e.imgList=JSON.parse(e.fileInfo),L.value.push(e))})),a=setInterval((()=>{e.forEach(((e,a)=>{!1===e.isDelete&&("succeed"==e.answer||e.fileInfo||e.errMsg?(e.imgList=JSON.parse(e.fileInfo),L.value[a]=e):(l=!1,setTimeout((()=>F()),300),H({id:e.id}).then((e=>{"succeed"==e.data.answer&&e.data.imageUrl&&(e.data.imgList=JSON.parse(e.data.imageUrl),L.value.forEach(((a,l)=>{a.id==e.data.id&&(L.value[l]=e.data)})),clearInterval([interName]),j.value=!1,w.emit("getUserInfo",!0),setTimeout((()=>F()),300))}))))})),l&&clearInterval(a)}),3e3),console.log(L.value,"taskList.value"),setTimeout((()=>F()),300)};Q((()=>{a&&clearInterval(a)}));const j=u(!1);async function A(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[],errMsg:!1};j.value=!0,L.value.push(a),setTimeout((()=>F()),300),await de(e).then((e=>{L.value[L.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>F()),300);let a=setInterval((()=>{H({id:e.data.id}).then((e=>{("succeed"==e.data.answer&&e.data.imageUrl||e.data.failReason)&&(e.data.errMsg=e.data.failReason,e.data.failReason&&l.error(e.data.failReason),e.data.imgList=JSON.parse(e.data.imageUrl),L.value[L.value.length-1]=e.data,clearInterval(a),j.value=!1,w.emit("getUserInfo",!0),setTimeout((()=>F()),300))}))}),3e3)})).catch((e=>{j.value=!1,L.value[L.value.length-1].fail=!0,l.error(e.message)}))}const T=u("");function M(e){T.value=e}const q=u(!1),z=()=>{S()},S=async()=>{s.checkAuth()&&v.updateVipDialog(!0)};async function K(){try{const e=await ce();if(200!=e.code)return l.error("签到失败！🎉  \n "+e.data);l.success("恭喜您，签到成功！🎉  \n  🎁 您已获得"+e.data+"积分奖励！"),s.getUserInfo()}catch(e){console.log(e),l.error("签到失败！ \n "+e.message)}}function V(){C.value?(s.logOut(),localStorage.removeItem("chatLogId")):(s.setLoginDialog(!0),w.emit("register",0))}const N=u();function R(){N.value.open()}return(e,a)=>(d(),c("div",Da,[p(La,{type:"dall",makePrompt:T.value,isLoading:j.value,onDallprompt:A},null,8,["makePrompt","isLoading"]),g("div",Ba,[g("div",Pa,[a[15]||(a[15]=g("div",{class:"borTitel"},[g("span",{style:{color:"#ffffff","font-size":"18px"}},"# 创作中心"),g("p",{style:{"margin-left":"13px",color:"#F0B132","font-size":"14px"}}," 请遵守中华人民共和国网络安全法，严禁生成涉及政治人物、色情、恐怖等不良内容，如有则违规封号处理。 ")],-1)),g("div",ja,[a[5]||(a[5]=g("img",{src:t,alt:""},null,-1)),g("span",null,k(m(s).userInfo.score),1),a[6]||(a[6]=g("div",{class:"shu"},null,-1)),I.value?(d(),c("div",{key:0,onClick:a[0]||(a[0]=e=>m(v).updateVipDialog(!0))},k(1==m(s).userInfo.lifetimeVip?"永久会员":"会员到期: "+m(pe)(m(s).userInfo.vipExpire,"YYYY-MM-DD")),1)):(d(),c("div",{key:1,onClick:a[1]||(a[1]=e=>m(v).updateVipDialog(!0))}," 开通会员，得积分 "))]),C.value?(d(),c("div",{key:0,class:"flex justify-between items-center px-2 py-1 text-white",style:{position:"relative"},onClick:R},[p(m(me),{size:36,src:h.value,round:"",bordered:"","fallback-src":m(ve),class:"cursor-pointer"},null,8,["src","fallback-src"]),q.value?(d(),c("div",Aa,[g("div",{class:U(["popupItem",E.value?"darkItem":"lightItem"]),onClick:z},[E.value?(d(),c("img",Ta)):(d(),c("img",Ua)),a[7]||(a[7]=g("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"我的积分",-1))],2),g("div",{class:U(["popupItem",E.value?"darkItem":"lightItem"]),onClick:K},[E.value?(d(),c("img",Ma)):(d(),c("img",qa)),a[8]||(a[8]=g("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"签到奖励",-1))],2),g("div",{class:U(["popupItem",E.value?"darkItem":"lightItem"]),onClick:a[2]||(a[2]=e=>m(s).updateInviteRecordDialog(!0))},[E.value?(d(),c("img",za)):(d(),c("img",Sa)),a[9]||(a[9]=g("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"邀请好友",-1))],2),g("div",{class:U(["popupItem",E.value?"darkItem":"lightItem"]),onClick:a[3]||(a[3]=e=>m(s).updateKamilDialog(!0))},[E.value?(d(),c("img",Ka)):(d(),c("img",Va)),a[10]||(a[10]=g("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"权益兑换",-1))],2),g("div",{class:U(["popupItem",E.value?"darkItem":"lightItem"]),onClick:a[4]||(a[4]=e=>m(s).updateSettingDialog(!0))},[E.value?(d(),c("img",Na)):(d(),c("img",Ra)),a[11]||(a[11]=g("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"设置",-1))],2),a[13]||(a[13]=g("div",{class:"line bg-[#E8E8E8] dark:bg-[#2C2D31]"},null,-1)),g("div",{class:U(["popupItem",E.value?"darkItem":"lightItem"]),onClick:V},[E.value?(d(),c("img",Oa)):(d(),c("img",Ja)),a[12]||(a[12]=g("p",{class:"text-[#000000] dark:text-[#fff] cursor"},"退出",-1))],2)])):x("",!0)])):x("",!0),C.value?x("",!0):(d(),c("div",{key:1,class:"flex items-center flex-start",onClick:V},[p(m(me),{size:36,src:"http://localhost:9100/src/assets/avatar.png",round:"",bordered:"","fallback-src":m(ve),class:"cursor-pointer"},null,8,["fallback-src"]),a[14]||(a[14]=g("p",{class:"text-xl ml-2"},null,-1))]))]),g("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px"},ref_key:"taskBox",ref:_},[C.value&&0!=L.value.length?(d(!0),c(b,{key:0},y(L.value,(e=>(d(),$(He,{key:e.id,task:e},null,8,["task"])))),128)):(d(),$(xe,{key:1,onHandleprompt:M}))],512)]),p(W,{style:{right:"20px",left:"auto",bottom:"auto",top:"60px",border:"1px solid #EAEBEC"},ref_key:"userDialogRef",ref:N},null,512)]))}}),[["__scopeId","data-v-0f4178e3"]]);export{Ya as default};
