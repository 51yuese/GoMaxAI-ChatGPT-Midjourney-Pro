import{e,Z as a,k as l,p as s,g as i,r,w as o,x as n,C as d,D as u,B as c,am as v,A as p,z as m,F as g,E as f,y as x,I as y,aj as k,G as h,a4 as b,a1 as w,ao as C,bt as E,_ as I,aP as _,L,v as P,$ as F,aQ as D,b$ as $,aH as B,aI as j,P as T,Q as z,a2 as A,a0 as M,N as U,a5 as q,aD as K,c0 as S,c1 as V,an as N,be as G,q as O,c2 as R,c4 as J,aZ as H,O as Q,bE as Z,c6 as W}from"../main-4156cf5e.js";import{a as X}from"../draw-fail/draw-fail.ad8fd01b.js";import{_ as Y,a as ee,b as ae}from"../KLingIcon3/KLingIcon3.6acffd30.js";import{N as le}from"../Popconfirm/Popconfirm.c9db7ff9.js";import{_ as te,n as se}from"../isVIP2/isVIP2.4aa495db.js";import{_ as ie}from"../aiVideoGou/aiVideoGou.56a8a6eb.js";import{_ as re,a as oe,C as ne,T as de,S as ue}from"../AI2/AI2.ab791222.js";import{_ as ce}from"../uploadImg/uploadImg.66d9b869.js";import{_ as ve,b as pe}from"../baiduThink/baiduThink.8f246fbd.js";import{u as me}from"../useUpload/useUpload.c9de36e7.js";const ge={class:"dallTaskBox"},fe=["src"],xe={class:"dallTaskItem bg-[#fff] dark:bg-[#313338]",style:{padding:"12px 12px 12px 0","border-radius":"12px",display:"flex","margin-top":"12px"}},ye={class:"content",style:{"margin-left":"12px",width:"100%"}},ke={style:{display:"flex","justify-content":"space-between"}},he={style:{display:"flex","align-items":"center"}},be={class:"discord-en"},we={class:"discord-time"},Ce={key:0,class:"flexLabel"},Ee={class:"itemLabel"},Ie={class:"itemLabel"},_e={key:0,class:"answerImgBox"},Le=["onClick","src"],Pe={key:1,style:{display:"flex","align-items":"center"}},Fe={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},De={style:{"margin-top":"8px",color:"#D4237A"}},$e={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},Be={class:"loader"},je={class:"btnBox"},Te={class:"btnItem"},ze={style:{display:"flex","align-items":"center"}},Ae={class:"btnItem"},Me={class:"btnItem"},Ue=I(e({__name:"index",props:{task:{type:Object}},setup(e){const I=a(),_=l(),L=s(),P=i((()=>"dark"===I.theme)),F=e,D=r(!1),$=r("");let B=()=>{y.emit("copyKLData",F.task)},j=()=>{var e;(null==(e=null==_?void 0:_.userInfo)?void 0:e.score)>0?y.emit("generateKLDraw",F.task):L.error(t("common.noPoint"))},T=r(!1),z=()=>{T.value=!0,E({id:F.task.id}).then((e=>{y.emit("dallKLList"),T.value=!1}))};return(e,a)=>(o(),n("div",ge,[d(x(w),{show:x(T)},{default:u((()=>[D.value?(o(),n("div",{key:0,onClick:a[1]||(a[1]=e=>{D.value=!1,$.value=""}),class:"mask"},[c("img",{src:$.value,style:{width:"auto",height:"90%"},alt:"",onClick:a[0]||(a[0]=v((()=>{}),["stop"]))},null,8,fe)])):p("",!0),c("div",xe,[a[8]||(a[8]=c("div",{class:"avator"},[c("div",{class:"discord-avatar"},[c("img",{src:"/static/svg/Discord-KL-0bef4b87.svg",alt:""})])],-1)),c("div",ye,[c("div",ke,[c("div",he,[c("span",be,"可灵-"+m(e.$t("draw.imgGen")),1),c("div",we,m(F.task.createdAt),1)])]),c("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>{var a;(a=F.task.prompt)?(C({text:a}),L.success(t("chat.copied"))):L.error(t("draw.noDataCopy"))})},m(F.task.prompt),1),F.task.requestParams?(o(),n("div",Ce,[c("div",Ee,m(F.task.requestParams.model_name),1),c("div",Ie,m(F.task.requestParams.aspect_ratio),1)])):p("",!0),c("div",null,[F.task.imgList&&F.task.imgList.length>0?(o(),n("div",_e,[(o(!0),n(g,null,f(F.task.imgList,(e=>(o(),n("img",{onClick:a=>function(e){D.value=!0,$.value=e}(e),src:e,onLoad:a[3]||(a[3]=e=>x(y).emit("drawtoBottom")),alt:""},null,40,Le)))),256))])):(o(),n("div",Pe,[F.task.errMsg?(o(),n("div",Fe,[a[6]||(a[6]=c("img",{src:X,alt:""},null,-1)),c("p",De,m(e.$t("draw.drawErro")),1)])):(o(),n("div",$e,[(o(!0),n(g,null,f(F.task.requestParams.n,(e=>(o(),n("div",Be)))),256))]))]))]),c("div",je,[c("div",Te,[d(x(k),{trigger:"hover"},{trigger:u((()=>[c("img",{src:Y,onClick:a[4]||(a[4]=(...e)=>x(B)&&x(B)(...e)),alt:""})])),default:u((()=>[c("div",ze,[c("span",null,m(e.$t("draw.useImgParams")),1)])])),_:1})]),c("div",Ae,[c("img",{src:ee,onClick:a[5]||(a[5]=(...e)=>x(j)&&x(j)(...e)),alt:""})]),c("div",Me,[d(x(le),{onPositiveClick:x(z),style:h(P.value?"background:#19191B":"background:#F8F9F9")},{trigger:u((()=>a[7]||(a[7]=[c("img",{src:ae,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:u((()=>[b(" "+m(e.$t("draw.confirmDelWork")),1)])),_:1},8,["onPositiveClick","style"])])])])])])),_:1},8,["show"])]))}}),[["__scopeId","data-v-d0cbb145"]]),qe={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#F9F9FB] dark:bg-[#222325]"},Ke={class:"dallBox"},Se={class:"dallContent"},Ve={style:{display:"flex","align-items":"center",height:"60px"}},Ne={class:"dark:text-[#EEEEF0] text-[#000] text-[18px]",style:{"margin-right":"12px"}},Ge={style:{width:"140px",position:"relative"},class:"customBox"},Oe={key:0,class:"newModel"},Re={class:"custerSelect"},Je=["onClick"],He={class:"name"},Qe={key:0,class:"newModel"},Ze={class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},We={class:"dark:text-[#EEEEF0] text-[#767676] text-[14px]"},Xe={class:"labeBox",style:{flex:"none"}},Ye={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},ea=["placeholder"],aa={style:{width:"100%","text-align":"right","padding-right":"12px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},la={class:"recomBox"},ta={class:"labeBox"},sa=["onClick"],ia={key:0,style:{display:"flex",margin:"16px 0 6px","justify-content":"space-between"}},ra={class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},oa={class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},na={key:1,class:"lityFlex"},da=["onClick"],ua={key:2,style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},ca={class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]",style:{"margin-top":"12px"}},va={class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},pa=["src"],ma={class:"recomBox"},ga={class:"labeBox"},fa=["onClick","src"],xa={key:3,class:"sliderBox"},ya={key:4,class:"sliderBox"},ka={class:"flexSelect"},ha={style:{width:"116px","margin-right":"10px"}},ba={style:{width:"74px","margin-right":"10px"}},wa={style:{position:"absolute",bottom:"0",left:"0px",width:"462px"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},Ca={key:0,class:"vipIcon",src:te,alt:""},Ea={key:0,style:{color:"#fff"}},Ia={key:1,style:{color:"#fff"}},_a={key:2,style:{color:"#fff"}},La={key:3,style:{color:"#fff"}},Pa={key:4,style:{display:"flex","align-items":"center",color:"#fff"}},Fa={key:5,style:{color:"#fff"}},Da=I(e({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){const{selectFileByImageAndVideo:t}=me(),k=r("/api/file/upload"),h=s(),E=l(),I=i((()=>E.isLogin));i((()=>E.userInfo));const G=i((()=>1===E.userInfo.lifetimeVip||E.userInfo.vipExpire&&new Date(E.userInfo.vipExpire)>new Date)),O=i((()=>E.userInfo.vipLeavelId));let R=r([]);_().then((e=>{R.value=e.data})),y.on("copyKLData",(e=>{Fe.value=e.requestParams.prompt,te.value=e.requestParams.model_name,Ce.value=e.requestParams.aspect_ratio,X.value=e.requestParams.image_fidelity,Y.value=e.requestParams.human_fidelity,ee.value=e.requestParams.image_reference,Be.value=e.requestParams.image,be.value=e.requestParams.n}));const J=e;L(J,(e=>{0==e.isLoading&&(Fe.value="")}));const H=a,Q=r(""),Z=r("");P({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{Z.value=e.data.mjModel,Q.value=e.data.robotAvatar}));const W=r(!1);let X=r(.5),Y=r(.45),ee=r("face"),ae=r([{label:F("draw.personZx"),value:"face"},{label:F("draw.subject"),value:"subject"}]),le=r(!1),te=r("");const se=r([]);D({modelType:"draw",keyType:2}).then((e=>{console.log(e.data,"fetchQueryModelsListAPIMaps"),e.data.rows.forEach((e=>{se.value.push({label:e.modelName,info:e.remark,value:e.model,tags:e.tags})})),te.value=se.value[0].value}));let ge=e=>{y.emit("dallKLModel",e)},fe=r([]),xe=r([]),ye=()=>{const e=[...xe.value].sort((()=>Math.random()-.5));fe.value=e.slice(0,e.length>3?3:e.length)};function ke(e=""){Fe.value=e}function he(){Fe.value?(C({text:Fe.value}),h.success(F("chat.copied"))):h.error(F("draw.noDataCopy"))}S().then((e=>{var a,l;xe.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,ye()})),r("std"),r([{label:"标准质量",value:"std"},{label:"高品质模式",value:"pro"}]);let be=r(1);const we=r([{label:"1"+F("draw.zhang"),value:1},{label:"2"+F("draw.zhang"),value:2},{label:"3"+F("draw.zhang"),value:3},{label:"4"+F("draw.zhang"),value:4},{label:"5"+F("draw.zhang"),value:5},{label:"6"+F("draw.zhang"),value:6},{label:"7"+F("draw.zhang"),value:7},{label:"8"+F("draw.zhang"),value:8},{label:"9"+F("draw.zhang"),value:9}]);let Ce=r("9:16");const Ee=r([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"},{label:"21:9",value:"21:9"}]),Ie=r(),_e=r(),Le=()=>{Ie.value.open()},Pe=()=>{_e.value.open()},Fe=r("");function De(e){Fe.value=e}function $e(){if(!I.value)return void E.setLoginDialog(!0);if(Da.value.isVipUsed&&-1===Da.value.userType.indexOf(O.value)){let e=Da.value.userType.split(","),a="";return e.forEach(((l,t)=>{a+=R.value.filter((e=>e.id==l))[0].dictName,t<e.length-1&&(a+=",")})),void h.error(F("digitalMan.vipUse1")+a+F("digitalMan.vipUse1"))}if(!Fe.value)return void h.error(F("draw.inputImgDesc"));W.value=!0;let e={n:be.value,prompt:Fe.value,model_name:te.value,aspect_ratio:Ce.value,human_fidelity:Y.value,image_fidelity:X.value};"kling-v1-5"==te.value&&(e.image_reference=ee.value,e.image=Be.value),"kling-v1"==te.value&&(e.image=Be.value),H("dallprompt",e),Be.value="",setTimeout((()=>{Ue()}),1e3)}L(J,(e=>{Fe.value=e.makePrompt})),y.on("generateKLDraw",(e=>{Fe.value=e.prompt,$e()}));let Be=r("");let je=r([]),Te=r([]),ze=()=>{const e=[...Te.value].sort((()=>Math.random()-.5));je.value=e.slice(0,e.length>5?5:e.length)};async function Ae(){try{(async function(){return new Promise((async(e,a)=>{try{const a=await t();Me.value=!0,await N.post(k.value,{file:a},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{Me.value=!1,console.log(a),200==a.data.code?e(a.data.data):h.error(null==a.data.message?a.data.data:a.data.message)}))}catch(l){Me.value=!1,h.error(l.message),e(!1)}}))})().then((e=>{Be.value=e}))}catch(e){h.error(e.message)}}V().then((e=>{Te.value=e.data,ze()}));let Me=r(!1);function Ue(){let e={n:be.value,prompt:Fe.value,model_name:te.value,aspect_ratio:Ce.value,image_fidelity:X.value,human_fidelity:Y.value,image_reference:ee.value,image:Be.value};$(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?(Da.value=e.data,$a.value=!1):$a.value=!0})).catch((e=>{$a.value=!0}))}const Da=r({remainCount:0,freeCount:0,useIntegrate:0}),$a=r(!1);return L((()=>te.value),((e,a)=>{te.value&&Ue()}),{deep:!0,immediate:!0}),L((()=>Ce.value),((e,a)=>{te.value&&Ue()}),{deep:!0,immediate:!0}),L((()=>be.value),((e,a)=>{te.value&&Ue()}),{deep:!0,immediate:!0}),(e,a)=>(o(),n("div",qe,[d(ve,{ref_key:"inspirationRef",ref:Ie,onDall:De,type:"dall"},null,512),d(pe,{onDall:De,type:"dall",ref_key:"thinkRef",ref:_e},null,512),c("div",Ke,[c("div",Se,[c("div",Ve,[c("div",Ne,m(e.$t("draw.genImgModel")),1),c("div",Ge,[d(x(j),{value:x(te),"onUpdate:value":[a[0]||(a[0]=e=>B(te)?te.value=e:te=e),x(ge)],options:se.value,onClick:a[1]||(a[1]=e=>B(le)?le.value=!x(le):le=!x(le)),show:!1},null,8,["value","options","onUpdate:value"]),se.value.length>0&&x(te)&&se.value.filter((e=>e.value==x(te)))[0].tags?(o(),n("div",Oe,m(se.value.filter((e=>e.value==x(te)))[0].tags),1)):p("",!0),T(c("div",Re,[c("p",null,m(e.$t("draw.videoModelChose"))+":",1),(o(!0),n(g,null,f(se.value,(e=>(o(),n("div",{class:A(["selectItem",x(te)==e.value?"active":""]),onClick:a=>{B(te)?te.value=e.value:te=e.value,B(le)?le.value=!1:le=!1}},[c("div",He,[b(m(e.label)+" ",1),e.tags?(o(),n("div",Qe,m(e.tags),1)):p("",!0)]),c("span",null,m(e.info),1),a[11]||(a[11]=c("img",{src:ie,alt:""},null,-1))],10,Je)))),256))],512),[[z,x(le)]])])]),c("div",Ze,[c("div",We,m(e.$t("draw.chuangyiDesc")),1),c("div",Xe,[c("div",{class:"labeItem",onClick:Pe},[a[12]||(a[12]=c("img",{src:re,alt:""},null,-1)),c("span",null,m(e.$t("draw.AIgenDesc")),1)]),c("div",{class:"labeItem",onClick:Le},[a[13]||(a[13]=c("img",{src:oe,alt:""},null,-1)),c("span",null,m(e.$t("homePage.tips")),1)])])]),c("div",Ye,[T(c("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>Fe.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:e.$t("draw.textToImgExp")},"\t\t\t\t",8,ea),[[M,Fe.value]]),c("div",aa,[d(x(U),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:he},{default:u((()=>[d(x(ne))])),_:1}),d(x(U),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[3]||(a[3]=e=>ke())},{default:u((()=>[d(x(de))])),_:1})]),a[14]||(a[14]=c("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),c("div",la,[c("span",null,m(e.$t("knowledge.recom"))+"：",1),c("div",ta,[(o(!0),n(g,null,f(x(fe),(e=>(o(),n("div",{class:"labeItem",onClick:a=>ke(e.descript)},m(e.name),9,sa)))),256))]),d(x(U),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:x(ye)},{default:u((()=>[d(x(ue))])),_:1},8,["onClick"])])]),"kling-v2"!=x(te)?(o(),n("div",ia,[c("div",null,[c("div",ra,[b(m(e.$t("draw.uploadCankaoImg")),1),c("span",oa,m(e.$t("draw.notMust")),1)])])])):p("",!0),"kling-v1-5"==x(te)?(o(),n("div",na,[(o(!0),n(g,null,f(x(ae),(e=>(o(),n("div",{class:A(["lityItem",x(ee)==e.value?"active":""]),onClick:a=>B(ee)?ee.value=e.value:ee=e.value},m(e.label),11,da)))),256))])):p("",!0),"kling-v2"!=x(te)?(o(),n("div",ua,[d(x(w),{show:x(Me)},{default:u((()=>[""!=x(Be)&&x(Be)?(o(),n("div",{key:1,onClick:a[6]||(a[6]=e=>Ae()),style:{height:"134px","border-radius":"8px",display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#393936] resultImg"},[c("img",{src:x(Be),style:{width:"auto",height:"100%"}},null,8,pa),d(x(U),{size:"18px",color:"#767676",style:{cursor:"pointer","z-index":"9"},onClick:a[5]||(a[5]=v((e=>B(Be)?Be.value="":Be=""),["stop"]))},{default:u((()=>[d(x(de))])),_:1})])):(o(),n("div",{key:0,onClick:a[4]||(a[4]=e=>Ae()),style:{height:"134px",padding:"8px","border-radius":"8px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#17181a]"},[a[15]||(a[15]=c("img",{src:ce,alt:""},null,-1)),c("div",ca,m(e.$t("draw.uploadCankaoImg")),1),c("div",va,m(e.$t("draw.canJPGPNG")),1)]))])),_:1},8,["show"]),a[16]||(a[16]=c("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),c("div",ma,[c("span",null,m(e.$t("knowledge.recom"))+"：",1),c("div",ga,[(o(!0),n(g,null,f(x(je),(e=>(o(),n("img",{class:"labeImg",onClick:a=>{return l=e,void(Be.value=l.imageUrl);var l},src:e.imageUrl,alt:""},null,8,fa)))),256))]),d(x(U),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:x(ze)},{default:u((()=>[d(x(ue))])),_:1},8,["onClick"])])])):p("",!0),"kling-v2"!=x(te)?(o(),n("div",xa,[c("span",null,m("kling-v1-5"==x(te)?e.$t("draw.faceCanKao"):e.$t("draw.imgCanKao"))+":",1),d(x(q),{style:{flex:"1",margin:"0 10px"},value:x(X),"onUpdate:value":a[7]||(a[7]=e=>B(X)?X.value=e:X=e),step:.05,max:1,min:.1},null,8,["value"]),c("span",null,m(x(X)),1)])):p("",!0),"kling-v2"!=x(te)?(o(),n("div",ya,[c("span",null,m(e.$t("draw.mainCanKao"))+":",1),d(x(q),{style:{flex:"1",margin:"0 10px"},value:x(Y),"onUpdate:value":a[8]||(a[8]=e=>B(Y)?Y.value=e:Y=e),step:.05,max:1,min:.1},null,8,["value"]),c("span",null,m(x(Y)),1)])):p("",!0)]),c("div",ka,[c("div",ha,[d(x(j),{value:x(Ce),"onUpdate:value":a[9]||(a[9]=e=>B(Ce)?Ce.value=e:Ce=e),options:Ee.value},null,8,["value","options"])]),c("div",ba,[d(x(j),{value:x(be),"onUpdate:value":a[10]||(a[10]=e=>B(be)?be.value=e:be=e),options:we.value},null,8,["value","options"])])]),c("div",wa,[Da.value&&Da.value.isVipUsed?(o(),n("img",Ca)):p("",!0),d(x(K),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"64px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:$e},{default:u((()=>[$a.value?(o(),n("span",Ea,m(e.$t("draw.modelNotSet")),1)):x(E).isLogin?Da.value&&Da.value.isVipFree&&G.value?(o(),n("span",_a,m(e.$t("chat.vipFree")),1)):Da.value&&Da.value.remainCount&&G.value?(o(),n("span",La,m(e.$t("draw.shenyu")+Da.value.remainCount+e.$t("draw.chiFree")),1)):Da.value?(o(),n("div",Pa,[c("span",null,m(e.$t("gpt.lijiGen")),1),c("span",null,m(Da.value.useIntegrate),1),c("span",null,m(e.$t("chat.pointsChi")),1)])):(o(),n("span",Fa,m(e.$t("draw.gen")),1)):(o(),n("span",Ia,m(e.$t("draw.beginGen")),1))])),_:1})])])]))}}),[["__scopeId","data-v-2fafa1d2"]]),$a={class:"bg-[#fff] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},Ba={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px 0 0"},class:"contentBox bg-[#fff] dark:bg-[#313338]"},ja={style:{width:"calc( 100% + 24px )",margin:"0",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},Ta={class:"borTitel"},za={style:{color:"#8C441A","font-size":"18px","font-weight":"500"}},Aa={style:{"margin-left":"13px",color:"#8C441A","font-size":"14px"}},Ma=I(e({__name:"KLingDraw",setup(e){let t;const u=s(),v=l();G();const p=a();i((()=>v.userInfo.avatar)),i((()=>1===v.userInfo.lifetimeVip||v.userInfo.vipExpire&&new Date(v.userInfo.vipExpire)>new Date));const x=i((()=>v.isLogin));i((()=>"dark"===p.theme));const k=r(null);function h(){let e=k.value;e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight)}y.on("drawtoBottom",(e=>{setTimeout((()=>h()),300)})),L(x,(e=>{e&&C()})),O((()=>{setTimeout((()=>h()),300)}));const b=r([]);O((()=>{C()}));let w={page:1,size:999,keyType:2};y.on("dallKLModel",(e=>{})),y.on("dallKLList",(()=>{C()}));const C=async function(){t&&clearInterval(t),b.value=[];let e=(await R(w)).data.reverse(),a=!0;e.forEach((e=>{!1===e.isDelete&&(e.imgList=JSON.parse(e.fileInfo),b.value.push(e))})),t=setInterval((()=>{e.forEach(((e,l)=>{!1===e.isDelete&&("succeed"==e.answer||e.fileInfo||e.errMsg?(e.imgList=JSON.parse(e.fileInfo),b.value[l]=e):(a=!1,J({id:e.id}).then((e=>{"succeed"==e.data.answer&&e.data.imageUrl&&(e.data.imgList=JSON.parse(e.data.imageUrl),b.value.forEach(((a,l)=>{a.id==e.data.id&&(b.value[l]=e.data)})),clearInterval([interName]),E.value=!1,y.emit("getUserInfo",!0),setTimeout((()=>h()),300))}))))})),a&&clearInterval(t)}),3e3),console.log(b.value,"taskList.value"),setTimeout((()=>h()),300)};H((()=>{t&&clearInterval(t)}));const E=r(!1);async function I(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[],errMsg:!1};E.value=!0,b.value.push(a),setTimeout((()=>h()),300),await W(e).then((e=>{b.value[b.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>h()),300);let a=setInterval((()=>{J({id:e.data.id}).then((e=>{("succeed"==e.data.answer&&e.data.imageUrl||e.data.failReason)&&(e.data.errMsg=e.data.failReason,e.data.failReason&&u.error(e.data.failReason),e.data.imgList=JSON.parse(e.data.imageUrl),b.value[b.value.length-1]=e.data,clearInterval(a),E.value=!1,y.emit("getUserInfo",!0),setTimeout((()=>h()),300))}))}),3e3)})).catch((e=>{E.value=!1,b.value[b.value.length-1].errMsg=!0}))}const _=r("");function P(e){_.value=e}r(!1);const F=r();return(e,a)=>(o(),n("div",$a,[d(Da,{type:"dall",makePrompt:_.value,isLoading:E.value,onDallprompt:I},null,8,["makePrompt","isLoading"]),c("div",Ba,[c("div",ja,[c("div",Ta,[c("span",za,"# "+m(e.$t("draw.creationCenter")),1),c("p",Aa,m(e.$t("draw.SafetyWarning")),1)])]),c("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px 0 0"},ref_key:"taskBox",ref:k},[x.value&&0!=b.value.length?(o(!0),n(g,{key:0},f(b.value,(e=>(o(),Q(Ue,{key:e.id,task:e},null,8,["task"])))),128)):(o(),Q(se,{key:1,onHandleprompt:P}))],512)]),d(Z,{style:{right:"20px",left:"auto",bottom:"auto",top:"60px",border:"1px solid #EAEBEC"},ref_key:"userDialogRef",ref:F},null,512)]))}}),[["__scopeId","data-v-3c4c12bc"]]);export{Ma as default};
