import{e,Z as a,k as l,p as s,g as i,r,w as o,x as n,C as d,D as u,B as c,am as v,A as p,z as m,F as g,E as f,y as x,I as y,aj as k,G as h,a4 as b,a1 as w,ao as C,bs as E,_ as I,aP as _,L as P,v as F,$ as L,aQ as B,bS as D,aH as $,N as j,P as T,Q as z,a2 as A,a0 as M,a5 as q,aI as U,aD as K,bT as V,bU as S,an as G,bd as N,q as R,bV as W,bW as H,ad as O,O as Q,bZ as Z}from"../main-a0b53047.js";import{a as J}from"../draw-fail/draw-fail.ad8fd01b.js";import{_ as X,a as Y,b as ee}from"../KLingIcon3/KLingIcon3.6acffd30.js";import{N as ae}from"../Popconfirm/Popconfirm.a6d67891.js";import{C as le,_ as te,n as se}from"../isVIP2/isVIP2.6b2eb435.js";import{_ as ie}from"../aiVideoGou/aiVideoGou.56a8a6eb.js";import{_ as re,a as oe,C as ne,T as de,S as ue}from"../AI2/AI2.27a6c867.js";import{_ as ce}from"../uploadImg/uploadImg.66d9b869.js";import{_ as ve,b as pe}from"../baiduThink/baiduThink.3d2826cf.js";import{u as me}from"../useUpload/useUpload.78be6f1d.js";const ge={class:"dallTaskBox"},fe=["src"],xe={class:"dallTaskItem bg-[#fff] dark:bg-[#313338]",style:{padding:"12px 12px 12px 0","border-radius":"12px",display:"flex","margin-top":"12px"}},ye={class:"content",style:{"margin-left":"12px",width:"100%"}},ke={style:{display:"flex","justify-content":"space-between"}},he={style:{display:"flex","align-items":"center"}},be={class:"discord-en"},we={class:"discord-time"},Ce={key:0,class:"flexLabel"},Ee={key:0,class:"itemLabel"},Ie={class:"itemLabel"},_e={key:0,class:"answerImgBox"},Pe=["onClick","src"],Fe={key:1,style:{display:"flex","align-items":"center"}},Le={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},Be={style:{"margin-top":"8px",color:"#D4237A"}},De={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},$e={class:"loader"},je={class:"btnBox"},Te={class:"btnItem"},ze={style:{display:"flex","align-items":"center"}},Ae={class:"btnItem"},Me={class:"btnItem"},qe=I(e({__name:"index",props:{task:{type:Object}},setup(e){const I=a(),_=l(),P=s(),F=i((()=>"dark"===I.theme)),L=e,B=r(!1),D=r("");let $=()=>{y.emit("copyKLData",L.task)},j=()=>{var e;(null==(e=null==_?void 0:_.userInfo)?void 0:e.score)>0?y.emit("generateKLDraw",L.task):P.error(t("common.noPoint"))},T=r(!1),z=()=>{T.value=!0,E({id:L.task.id}).then((e=>{y.emit("dallKLList"),T.value=!1}))};return(e,a)=>(o(),n("div",ge,[d(x(w),{show:x(T)},{default:u((()=>{var l,s,i;return[B.value?(o(),n("div",{key:0,onClick:a[1]||(a[1]=e=>{B.value=!1,D.value=""}),class:"mask"},[c("img",{src:D.value,style:{width:"auto",height:"90%"},alt:"",onClick:a[0]||(a[0]=v((()=>{}),["stop"]))},null,8,fe)])):p("",!0),c("div",xe,[a[8]||(a[8]=c("div",{class:"avator"},[c("div",{class:"discord-avatar"},[c("img",{src:"/static/svg/Discord-KL-0bef4b87.svg",alt:""})])],-1)),c("div",ye,[c("div",ke,[c("div",he,[c("span",be,"可灵-"+m(e.$t("draw.imgGen")),1),c("div",we,m(L.task.createdAt),1)])]),c("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>{var a;(a=L.task.prompt)?(C({text:a}),P.success(t("chat.copied"))):P.error(t("draw.noDataCopy"))})},m(L.task.prompt),1),L.task.requestParams?(o(),n("div",Ce,[(null==(l=L.task)?void 0:l.modelInfo)?(o(),n("div",Ee,m(null==(i=null==(s=L.task)?void 0:s.modelInfo)?void 0:i.label),1)):p("",!0),c("div",Ie,m(L.task.requestParams.aspect_ratio),1)])):p("",!0),c("div",null,[10==L.task.status&&L.task.responseResult&&L.task.responseResult.length>0?(o(),n("div",_e,[(o(!0),n(g,null,f(L.task.responseResult,(e=>(o(),n("img",{onClick:a=>function(e){B.value=!0,D.value=e}(e.url),src:e.thumb,onLoad:a[3]||(a[3]=e=>x(y).emit("drawtoBottom")),alt:""},null,40,Pe)))),256))])):(o(),n("div",Fe,[4==L.task.status?(o(),n("div",Le,[a[6]||(a[6]=c("img",{src:J,alt:""},null,-1)),c("p",Be,m(e.$t("draw.drawErro")),1)])):(o(),n("div",De,[(o(!0),n(g,null,f(L.task.requestParams.n,(e=>(o(),n("div",$e)))),256))]))]))]),c("div",je,[c("div",Te,[d(x(k),{trigger:"hover"},{trigger:u((()=>[c("img",{src:X,onClick:a[4]||(a[4]=(...e)=>x($)&&x($)(...e)),alt:""})])),default:u((()=>[c("div",ze,[c("span",null,m(e.$t("draw.useImgParams")),1)])])),_:1})]),c("div",Ae,[c("img",{src:Y,onClick:a[5]||(a[5]=(...e)=>x(j)&&x(j)(...e)),alt:""})]),c("div",Me,[d(x(ae),{onPositiveClick:x(z),style:h(F.value?"background:#19191B":"background:#F8F9F9")},{trigger:u((()=>a[7]||(a[7]=[c("img",{src:ee,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:u((()=>[b(" "+m(e.$t("draw.confirmDelWork")),1)])),_:1},8,["onPositiveClick","style"])])])])])]})),_:1},8,["show"])]))}}),[["__scopeId","data-v-dbf903cb"]]),Ue={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#F9F9FB] dark:bg-[#222325]"},Ke={class:"dallBox"},Ve={class:"dallContent"},Se={style:{display:"flex","align-items":"center",height:"60px"}},Ge={class:"dark:text-[#EEEEF0] text-[#000] text-[18px]",style:{"margin-right":"12px"}},Ne={style:{width:"auto",position:"relative"},class:"customBox"},Re={key:0,class:"newModel"},We={class:"custerSelect"},He=["onClick"],Oe={class:"name"},Qe={key:0,class:"newModel"},Ze={class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},Je={class:"dark:text-[#EEEEF0] text-[#767676] text-[14px]"},Xe={class:"labeBox",style:{flex:"none"}},Ye={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},ea=["placeholder"],aa={style:{width:"100%","text-align":"right","padding-right":"12px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},la={class:"recomBox"},ta={class:"labeBox"},sa=["onClick"],ia={key:0,style:{display:"flex",margin:"16px 0 6px","justify-content":"space-between"}},ra={class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},oa={class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},na={key:1,class:"lityFlex"},da=["onClick"],ua={key:2,style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},ca={class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]",style:{"margin-top":"12px"}},va={class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},pa={class:"imgBox",style:{width:"auto",height:"134px"}},ma=["src"],ga={class:"recomBox"},fa={class:"labeBox"},xa=["onClick","src"],ya={key:3,class:"sliderBox"},ka={key:4,class:"sliderBox"},ha={class:"flexSelect"},ba={style:{width:"116px","margin-right":"10px"}},wa={style:{width:"74px","margin-right":"10px"}},Ca={style:{position:"absolute",bottom:"0",left:"0px",width:"462px"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},Ea={key:0,class:"vipIcon",src:te,alt:""},Ia={key:0,style:{color:"#fff"}},_a={key:1,style:{color:"#fff"}},Pa={key:2,style:{color:"#fff"}},Fa={key:3,style:{color:"#fff"}},La={key:4,style:{display:"flex","align-items":"center",color:"#fff"}},Ba={key:5,style:{color:"#fff"}},Da=I(e({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){const{selectFileByImageAndVideo:t}=me(),k=r("/api/file/upload"),h=s(),E=l(),I=i((()=>E.isLogin));i((()=>E.userInfo));const N=i((()=>1===E.userInfo.lifetimeVip||E.userInfo.vipExpire&&new Date(E.userInfo.vipExpire)>new Date)),R=i((()=>E.userInfo.vipLeavelId));let W=r([]);_().then((e=>{W.value=e.data})),y.on("copyKLData",(e=>{Be.value=e.requestParams.prompt,se.value=e.requestParams.model_name,Ee.value=e.requestParams.aspect_ratio,X.value=e.requestParams.image_fidelity,Y.value=e.requestParams.human_fidelity,ee.value=e.requestParams.image_reference,we.value=e.requestParams.n,e.requestParams&&e.requestParams.image&&"object"==typeof e.requestParams.image&&e.requestParams.image.length>0&&(je.value=e.requestParams.image)}));const H=e;P(H,(e=>{0==e.isLoading&&(Be.value="")}));const O=a,Q=r(""),Z=r("");F({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{Z.value=e.data.mjModel,Q.value=e.data.robotAvatar}));const J=r(!1);let X=r(.5),Y=r(.45),ee=r("face"),ae=r([{label:L("draw.personZx"),value:"face"},{label:L("draw.subject"),value:"subject"}]),te=r(!1),se=r("");const ge=r([]);B({modelType:"draw",keyType:2}).then((e=>{ge.value=e.data.rows[0].children,console.log(ge.value,"fetchQueryModelsListAPIMaps"),se.value=ge.value[0].value,y.emit("dallKLModel",se.value)}));let fe=e=>{console.log("handleUpdateModel"),y.emit("dallKLModel",e)},xe=r([]),ye=r([]),ke=()=>{const e=[...ye.value].sort((()=>Math.random()-.5));xe.value=e.slice(0,e.length>3?3:e.length)};function he(e=""){Be.value=e}function be(){Be.value?(C({text:Be.value}),h.success(L("chat.copied"))):h.error(L("draw.noDataCopy"))}V().then((e=>{var a,l;ye.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,ke()})),r("std"),r([{label:"标准质量",value:"std"},{label:"高品质模式",value:"pro"}]);let we=r(1);const Ce=r([{label:"1"+L("draw.zhang"),value:1},{label:"2"+L("draw.zhang"),value:2},{label:"3"+L("draw.zhang"),value:3},{label:"4"+L("draw.zhang"),value:4},{label:"5"+L("draw.zhang"),value:5},{label:"6"+L("draw.zhang"),value:6},{label:"7"+L("draw.zhang"),value:7},{label:"8"+L("draw.zhang"),value:8},{label:"9"+L("draw.zhang"),value:9}]);let Ee=r("9:16");const Ie=r([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"},{label:"21:9",value:"21:9"}]),_e=r(),Pe=r(),Fe=()=>{_e.value.open()},Le=()=>{Pe.value.open()},Be=r("");function De(e){Be.value=e}function $e(){if(!I.value)return void E.setLoginDialog(!0);if($a.value.isVipUsed&&-1===$a.value.userType.indexOf(R.value)){let e=$a.value.userType.split(","),a="";return e.forEach(((l,t)=>{a+=W.value.filter((e=>e.id==l))[0].dictName,t<e.length-1&&(a+=",")})),void h.error(L("digitalMan.vipUse1")+a+L("digitalMan.vipUse1"))}if(!Be.value)return void h.error(L("draw.inputImgDesc"));J.value=!0;let e={n:we.value,prompt:Be.value,model_name:se.value,aspect_ratio:Ee.value,human_fidelity:Y.value,image_fidelity:X.value};"kling-v1-5"==se.value&&(e.image_reference=ee.value,e.image=je.value[0]),"kling-v1"==se.value&&(e.image=je.value[0]),O("dallprompt",e),je.value=[],setTimeout((()=>{Da()}),1e3)}P(H,(e=>{Be.value=e.makePrompt})),y.on("generateKLDraw",(e=>{Be.value=e.prompt,$e()}));let je=r([]);let Te=r([]),ze=r([]),Ae=()=>{const e=[...ze.value].sort((()=>Math.random()-.5));Te.value=e.slice(0,e.length>5?5:e.length)};async function Me(){try{(async function(){return new Promise((async(e,a)=>{try{const a=await t();qe.value=!0,await G.post(k.value,{file:a},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{qe.value=!1,console.log(a),200==a.data.code?e(a.data.data):h.error(null==a.data.message?a.data.data:a.data.message)}))}catch(l){qe.value=!1,h.error(l.message),e(!1)}}))})().then((e=>{je.value=[e]}))}catch(e){h.error(e.message)}}S().then((e=>{ze.value=e.data,Ae()}));let qe=r(!1);function Da(){let e={n:we.value,prompt:Be.value,model_name:se.value,aspect_ratio:Ee.value,image_fidelity:X.value,human_fidelity:Y.value,image_reference:ee.value,image:je.value};D(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?($a.value=e.data,ja.value=!1):ja.value=!0})).catch((e=>{ja.value=!0}))}y.off("fetchModelFree"),y.on("fetchModelFree",(e=>{Da()}));const $a=r({remainCount:0,freeCount:0,useIntegrate:0}),ja=r(!1);return P((()=>se.value),((e,a)=>{se.value&&Da()}),{deep:!0,immediate:!0}),P((()=>Ee.value),((e,a)=>{se.value&&Da()}),{deep:!0,immediate:!0}),P((()=>we.value),((e,a)=>{se.value&&Da()}),{deep:!0,immediate:!0}),P(I,(e=>{e&&Da()})),(e,a)=>(o(),n("div",Ue,[d(ve,{ref_key:"inspirationRef",ref:_e,onDall:De,type:"dall"},null,512),d(pe,{onDall:De,type:"dall",ref_key:"thinkRef",ref:Pe},null,512),c("div",Ke,[c("div",Ve,[c("div",Se,[c("div",Ge,m(e.$t("draw.genImgModel")),1),c("div",Ne,[c("div",{class:"cSelectBox",onClick:a[0]||(a[0]=e=>$(te)?te.value=!x(te):te=!x(te))},[c("span",null,m(x(se)&&ge.value.filter((e=>e.value==x(se)))[0].label),1),ge.value.length>0&&x(se)&&ge.value.filter((e=>e.value==x(se)))[0].new?(o(),n("div",Re,"NEW")):p("",!0),d(x(j),{size:"14"},{default:u((()=>[d(x(le))])),_:1})]),T(c("div",We,[c("p",null,m(e.$t("draw.drawModelChose"))+":",1),(o(!0),n(g,null,f(ge.value,(e=>(o(),n("div",{class:A(["selectItem",x(se)==e.value?"active":""]),onClick:a=>{$(se)?se.value=e.value:se=e.value,$(te)?te.value=!1:te=!1,x(fe)(e.value)}},[c("div",Oe,[b(m(e.label)+" ",1),e.new?(o(),n("div",Qe,"NEW")):p("",!0)]),c("span",null,m(e.desc),1),a[9]||(a[9]=c("img",{src:ie,alt:""},null,-1))],10,He)))),256))],512),[[z,x(te)]])])]),c("div",Ze,[c("div",Je,m(e.$t("draw.chuangyiDesc")),1),c("div",Xe,[c("div",{class:"labeItem",onClick:Le},[a[10]||(a[10]=c("img",{src:re,alt:""},null,-1)),c("span",null,m(e.$t("draw.AIgenDesc")),1)]),c("div",{class:"labeItem",onClick:Fe},[a[11]||(a[11]=c("img",{src:oe,alt:""},null,-1)),c("span",null,m(e.$t("homePage.tips")),1)])])]),c("div",Ye,[T(c("textarea",{"onUpdate:modelValue":a[1]||(a[1]=e=>Be.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:e.$t("draw.textToImgExp")},"\t\t\t\t",8,ea),[[M,Be.value]]),c("div",aa,[d(x(j),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:be},{default:u((()=>[d(x(ne))])),_:1}),d(x(j),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>he())},{default:u((()=>[d(x(de))])),_:1})]),a[12]||(a[12]=c("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),c("div",la,[c("span",null,m(e.$t("knowledge.recom"))+"：",1),c("div",ta,[(o(!0),n(g,null,f(x(xe),(e=>(o(),n("div",{class:"labeItem",onClick:a=>he(e.descript)},m(e.name),9,sa)))),256))]),d(x(j),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:x(ke)},{default:u((()=>[d(x(ue))])),_:1},8,["onClick"])])]),"kling-v2"!=x(se)?(o(),n("div",ia,[c("div",null,[c("div",ra,[b(m(e.$t("draw.uploadCankaoImg")),1),c("span",oa,m(e.$t("draw.notMust")),1)])])])):p("",!0),"kling-v1-5"==x(se)?(o(),n("div",na,[(o(!0),n(g,null,f(x(ae),(e=>(o(),n("div",{class:A(["lityItem",x(ee)==e.value?"active":""]),onClick:a=>$(ee)?ee.value=e.value:ee=e.value},m(e.label),11,da)))),256))])):p("",!0),"kling-v2"!=x(se)?(o(),n("div",ua,[d(x(w),{show:x(qe)},{default:u((()=>[0==x(je).length?(o(),n("div",{key:0,onClick:a[3]||(a[3]=e=>Me()),style:{height:"134px",padding:"8px","border-radius":"8px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#17181a]"},[a[13]||(a[13]=c("img",{src:ce,alt:""},null,-1)),c("div",ca,m(e.$t("draw.uploadCankaoImg")),1),c("div",va,m(e.$t("draw.canJPGPNG")),1)])):(o(),n("div",{key:1,onClick:a[4]||(a[4]=e=>Me()),style:{"min-height":"134px","border-radius":"8px",display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"center",cursor:"pointer",gap:"4px"},class:"bg-[#FFF] dark:bg-[#393936] resultImg"},[(o(!0),n(g,null,f(x(je),((e,a)=>(o(),n("div",pa,[c("img",{src:e,style:{width:"100%",height:"100%"}},null,8,ma),d(x(j),{size:"18px",color:"#767676",style:{cursor:"pointer","z-index":"9"},onClick:v((e=>x(je).splice(a,1)),["stop"])},{default:u((()=>[d(x(de))])),_:2},1032,["onClick"])])))),256))]))])),_:1},8,["show"]),a[14]||(a[14]=c("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),c("div",ga,[c("span",null,m(e.$t("knowledge.recom"))+"：",1),c("div",fa,[(o(!0),n(g,null,f(x(Te),(e=>(o(),n("img",{class:"labeImg",onClick:a=>{return l=e,void(je.value=[l.imageUrl]);var l},src:e.imageUrl,alt:""},null,8,xa)))),256))]),d(x(j),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:x(Ae)},{default:u((()=>[d(x(ue))])),_:1},8,["onClick"])])])):p("",!0),"kling-v2"!=x(se)?(o(),n("div",ya,[c("span",null,m("kling-v1-5"==x(se)?e.$t("draw.faceCanKao"):e.$t("draw.imgCanKao"))+":",1),d(x(q),{style:{flex:"1",margin:"0 10px"},value:x(X),"onUpdate:value":a[5]||(a[5]=e=>$(X)?X.value=e:X=e),step:.05,max:1,min:.1},null,8,["value"]),c("span",null,m(x(X)),1)])):p("",!0),"kling-v2"!=x(se)?(o(),n("div",ka,[c("span",null,m(e.$t("draw.mainCanKao"))+":",1),d(x(q),{style:{flex:"1",margin:"0 10px"},value:x(Y),"onUpdate:value":a[6]||(a[6]=e=>$(Y)?Y.value=e:Y=e),step:.05,max:1,min:.1},null,8,["value"]),c("span",null,m(x(Y)),1)])):p("",!0)]),c("div",ha,[c("div",ba,[d(x(U),{value:x(Ee),"onUpdate:value":a[7]||(a[7]=e=>$(Ee)?Ee.value=e:Ee=e),options:Ie.value},null,8,["value","options"])]),c("div",wa,[d(x(U),{value:x(we),"onUpdate:value":a[8]||(a[8]=e=>$(we)?we.value=e:we=e),options:Ce.value},null,8,["value","options"])])]),c("div",Ca,[$a.value&&$a.value.isVipUsed?(o(),n("img",Ea)):p("",!0),d(x(K),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"64px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:$e},{default:u((()=>[ja.value?(o(),n("span",Ia,m(e.$t("draw.modelNotSet")),1)):x(E).isLogin?$a.value&&$a.value.isVipFree&&N.value?(o(),n("span",Pa,m(e.$t("chat.vipFree")),1)):$a.value&&$a.value.remainCount&&N.value?(o(),n("span",Fa,m(e.$t("draw.shenyu")+$a.value.remainCount+e.$t("draw.chiFree")),1)):$a.value?(o(),n("div",La,[c("span",null,m(e.$t("gpt.lijiGen")),1),c("span",null,m($a.value.useIntegrate),1),c("span",null,m(e.$t("chat.pointsChi")),1)])):(o(),n("span",Ba,m(e.$t("draw.gen")),1)):(o(),n("span",_a,m(e.$t("draw.beginGen")),1))])),_:1})])])]))}}),[["__scopeId","data-v-b8981afb"]]),$a={class:"bg-[#fff] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},ja={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px 0 0"},class:"contentBox bg-[#fff] dark:bg-[#313338]"},Ta={style:{width:"calc( 100% + 24px )",margin:"0",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},za={class:"borTitel"},Aa={style:{color:"#8C441A","font-size":"18px","font-weight":"500"}},Ma={style:{"margin-left":"13px",color:"#8C441A","font-size":"14px"}},qa=I(e({__name:"KLingDraw",setup(e){let t,u;const v=s(),p=l();N();const k=a();i((()=>p.userInfo.avatar)),i((()=>1===p.userInfo.lifetimeVip||p.userInfo.vipExpire&&new Date(p.userInfo.vipExpire)>new Date));const h=i((()=>p.isLogin));i((()=>"dark"===k.theme));const b=r(null);function w(){let e=b.value;e&&(e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight))}y.on("drawtoBottom",(e=>{setTimeout((()=>w()),300)})),P(h,(e=>{e&&I()})),R((()=>{setTimeout((()=>w()),300)}));const C=r([]);R((()=>{}));let E={page:1,size:999,keyType:2};y.on("dallKLModel",(e=>{E.model=e,I()})),y.on("dallKLList",(()=>{I()}));const I=async function(){t&&clearInterval(t),C.value=[];let e=(await W(E)).data.reverse(),a=!0;e.forEach((e=>{!1===e.isDelete&&C.value.push(e)})),t=setInterval((()=>{e.forEach(((e,l)=>{!1===e.isDelete&&(4!=e.status&&10!=e.status?(a=!1,H({id:e.id}).then((e=>{10==e.data.status&&(C.value.forEach(((a,l)=>{a.id==e.data.id&&(C.value[l]=e.data)})),_.value=!1,y.emit("getUserInfo",!0),setTimeout((()=>w()),300))}))):C.value[l]=e)})),a&&clearInterval(t)}),3e3),console.log(C.value,"taskList.value"),D.value=!0,setTimeout((()=>w()),300)};O((()=>{t&&clearInterval(t),u&&clearInterval(u)}));const _=r(!1);async function F(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[]};e.isSync=!0,_.value=!0,C.value.push(a),setTimeout((()=>w()),300),await Z(e).then((e=>{C.value[C.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>w()),300),u=setInterval((()=>{H({id:e.data.id}).then((e=>{10!=e.data.status&&4!=e.data.status||(C.value[C.value.length-1]=e.data,e.data.failReason&&v.error(e.data.failReason),clearInterval(u),_.value=!1,y.emit("getUserInfo",!0),setTimeout((()=>w()),300),y.emit("fetchModelFree"))}))}),3e3)})).catch((e=>{_.value=!1}))}const L=r("");function B(e){L.value=e}let D=r(!1);return(e,a)=>(o(),n("div",$a,[d(Da,{type:"dall",makePrompt:L.value,isLoading:_.value,onDallprompt:F},null,8,["makePrompt","isLoading"]),c("div",ja,[c("div",Ta,[c("div",za,[c("span",Aa,"# "+m(e.$t("draw.creationCenter")),1),c("p",Ma,m(e.$t("draw.SafetyWarning")),1)])]),c("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px 0 0"},ref_key:"taskBox",ref:b},[h.value&&0!=C.value.length||!x(D)?(o(!0),n(g,{key:0},f(C.value,(e=>(o(),Q(qe,{key:e.id,task:e},null,8,["task"])))),128)):(o(),Q(se,{key:1,onHandleprompt:B}))],512)])]))}}),[["__scopeId","data-v-c8e98b47"]]);export{qa as default};
