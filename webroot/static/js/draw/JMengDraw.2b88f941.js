import{e,Z as a,k as l,p as t,g as s,r as i,w as o,x as r,C as n,D as d,B as u,am as v,A as c,z as p,F as m,E as g,y as f,I as h,aj as x,G as y,a4 as k,a1 as b,ao as w,bt as I,_ as E,aP as _,L as C,v as D,aQ as M,$ as L,b$ as P,aH as T,aI as j,P as B,Q as $,a2 as F,a0 as A,N as U,aD as J,c0 as q,c1 as S,be as V,q as z,c2 as N,c4 as O,aZ as R,O as G,bE as H,c5 as Q}from"../main-4156cf5e.js";import{a as K}from"../draw-fail/draw-fail.ad8fd01b.js";import{_ as Z,a as W,b as X}from"../KLingIcon3/KLingIcon3.6acffd30.js";import{N as Y}from"../Popconfirm/Popconfirm.c9db7ff9.js";import{_ as ee,n as ae}from"../isVIP2/isVIP2.4aa495db.js";import{_ as le}from"../aiVideoGou/aiVideoGou.56a8a6eb.js";import{_ as te,a as se,C as ie,T as oe,S as re}from"../AI2/AI2.ab791222.js";import{_ as ne,b as de}from"../baiduThink/baiduThink.8f246fbd.js";import{u as ue}from"../useUpload/useUpload.c9de36e7.js";const ve={class:"dallTaskBox"},ce=["src"],pe={class:"dallTaskItem bg-[#fff] dark:bg-[#313338]",style:{padding:"12px 12px 12px 0","border-radius":"12px",display:"flex","margin-top":"12px"}},me={class:"content",style:{"margin-left":"12px",width:"100%"}},ge={style:{display:"flex","justify-content":"space-between"}},fe={style:{display:"flex","align-items":"center"}},he={class:"discord-time"},xe={key:0,class:"flexLabel"},ye={key:0,class:"itemLabel"},ke={key:1,class:"itemLabel"},be={key:0,class:"answerImgBox"},we=["onClick","src"],Ie={key:1,style:{display:"flex","align-items":"center"}},Ee={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},_e={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},Ce={class:"btnBox"},De={class:"btnItem"},Me={class:"btnItem"},Le={class:"btnItem"},Pe=E(e({__name:"index",props:{task:{type:Object}},setup(e){const E=a(),_=l(),C=t(),D=s((()=>"dark"===E.theme)),M=e,L=i(!1),P=i("");let T=()=>{h.emit("copyJMData",M.task)},j=()=>{var e;(null==(e=null==_?void 0:_.userInfo)?void 0:e.score)>0?h.emit("generateJMDraw",M.task):C.error("积分不足")},B=i(!1),$=()=>{B.value=!0,I({id:M.task.id}).then((e=>{h.emit("dallJMList"),B.value=!1}))};return(e,a)=>(o(),r("div",ve,[n(f(b),{show:f(B)},{default:d((()=>{var e;return[L.value?(o(),r("div",{key:0,onClick:a[1]||(a[1]=e=>{L.value=!1,P.value=""}),class:"mask"},[u("img",{src:P.value,style:{width:"auto",height:"90%"},alt:"",onClick:a[0]||(a[0]=v((()=>{}),["stop"]))},null,8,ce)])):c("",!0),u("div",pe,[a[12]||(a[12]=u("div",{class:"avator"},[u("div",{class:"discord-avatar"},[u("img",{src:"/static/svg/Discord-JM-3a0647e7.svg",alt:""})])],-1)),u("div",me,[u("div",ge,[u("div",fe,[a[6]||(a[6]=u("span",{class:"discord-en"},"即梦-图片生成",-1)),u("div",he,p(M.task.createdAt),1)])]),u("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>{var a;(a=M.task.prompt)?(w({text:a}),C.success("复制成功")):C.error("无内容可复制")})},p(M.task.prompt),1),M.task.requestParams?(o(),r("div",xe,[M.task.model?(o(),r("div",ye,p(M.task.model),1)):c("",!0),(null==(e=M.task.requestParams)?void 0:e.width)?(o(),r("div",ke,p(M.task.requestParams.width+"×"+M.task.requestParams.height),1)):c("",!0)])):c("",!0),u("div",null,[M.task.imgList&&M.task.imgList.length>0?(o(),r("div",be,[(o(!0),r(m,null,g(M.task.imgList,(e=>(o(),r("img",{onClick:a=>function(e){L.value=!0,P.value=e}(e),onLoad:a[3]||(a[3]=e=>f(h).emit("drawtoBottom")),src:e,alt:""},null,40,we)))),256))])):(o(),r("div",Ie,[M.task.errMsg?(o(),r("div",Ee,a[7]||(a[7]=[u("img",{src:K,alt:""},null,-1),u("p",{style:{"margin-top":"8px",color:"#D4237A"}},"绘画失败",-1)]))):(o(),r("div",_e,a[8]||(a[8]=[u("div",{class:"loader"},null,-1)])))]))]),u("div",Ce,[u("div",De,[n(f(x),{trigger:"hover"},{trigger:d((()=>[u("img",{src:Z,onClick:a[4]||(a[4]=(...e)=>f(T)&&f(T)(...e)),alt:""})])),default:d((()=>[a[9]||(a[9]=u("div",{style:{display:"flex","align-items":"center"}},[u("span",null,"使用本图片的参数")],-1))])),_:1,__:[9]})]),u("div",Me,[u("img",{src:W,onClick:a[5]||(a[5]=(...e)=>f(j)&&f(j)(...e)),alt:""})]),u("div",Le,[n(f(Y),{onPositiveClick:f($),style:y(D.value?"background:#19191B":"background:#F8F9F9")},{trigger:d((()=>a[10]||(a[10]=[u("img",{src:X,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:d((()=>[a[11]||(a[11]=k(" 您确认要删除任务吗？ "))])),_:1,__:[11]},8,["onPositiveClick","style"])])])])])]})),_:1},8,["show"])]))}}),[["__scopeId","data-v-9dcb67c6"]]),Te={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#F9F9FB] dark:bg-[#222325]"},je={class:"dallBox"},Be={style:{display:"flex","align-items":"center",height:"60px"}},$e={class:"dark:text-[#EEEEF0] text-[#000] text-[18px]",style:{"margin-right":"12px"}},Fe={style:{width:"140px",position:"relative"},class:"customBox"},Ae={key:0,class:"newModel"},Ue={class:"custerSelect"},Je=["onClick"],qe={class:"name"},Se={key:0,class:"newModel"},Ve={class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},ze={class:"dark:text-[#EEEEF0] text-[#767676] text-[14px]"},Ne={class:"labeBox",style:{flex:"none"}},Oe={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},Re=["placeholder"],Ge={style:{width:"100%","text-align":"right","padding-right":"12px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},He={class:"recomBox"},Qe={class:"labeBox"},Ke=["onClick"],Ze={class:"flexSelect"},We={style:{width:"116px","margin-right":"10px"}},Xe={style:{position:"absolute",bottom:"0",left:"0px",width:"100%"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},Ye={key:0,class:"vipIcon",src:ee,alt:""},ea={key:0,style:{color:"#fff"}},aa={key:1,style:{color:"#fff"}},la={key:2,style:{color:"#fff"}},ta={key:3,style:{color:"#fff"}},sa={key:4,style:{display:"flex","align-items":"center",color:"#fff"}},ia={key:5,style:{color:"#fff"}},oa=E(e({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){ue(),i("/api/file/upload");const v=t(),x=l(),y=s((()=>x.isLogin));s((()=>x.userInfo));const b=s((()=>1===x.userInfo.lifetimeVip||x.userInfo.vipExpire&&new Date(x.userInfo.vipExpire)>new Date)),I=s((()=>x.userInfo.vipLeavelId));let E=i([]);_().then((e=>{E.value=e.data})),h.on("copyJMData",(e=>{he.value=e.requestParams.prompt,H.value=e.requestParams.model_name,ae.value=e.requestParams.aspect_ratio,ke.value=e.requestParams.image}));const V=e;C(V,(e=>{0==e.isLoading&&(he.value="")}));const z=a,N=i(""),O=i("");D({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{O.value=e.data.mjModel,N.value=e.data.robotAvatar}));const R=i(!1);i(50),i(50),i(""),i([{label:"通用垫图",value:""},{label:"人物长相",value:"face"},{label:"角色特征",value:"subject"}]);let G=i(!1),H=i("");const Q=i([]);M({modelType:"draw",keyType:3}).then((e=>{console.log(e.data,"fetchQueryModelsListAPIMaps"),e.data.rows.forEach((e=>{Q.value.push({label:e.modelName,info:e.remark,value:e.model,tags:e.tags})})),H.value=Q.value[0].value}));let K=e=>{h.emit("dallJMModel",e)},Z=i([]),W=i([]),X=()=>{const e=[...W.value].sort((()=>Math.random()-.5));Z.value=e.slice(0,e.length>3?3:e.length)};function Y(e=""){he.value=e}function ee(){he.value?(w({text:he.value}),v.success(L("chat.copied"))):v.error(L("draw.noDataCopy"))}q().then((e=>{var a,l;W.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,X()})),i(""),i([{label:"标准质量",value:""},{label:"高品质模式",value:"hd"}]),i(4),i([{label:"1张",value:1},{label:"2张",value:2},{label:"3张",value:3},{label:"4张",value:4},{label:"5张",value:5},{label:"6张",value:6},{label:"7张",value:7},{label:"8张",value:8},{label:"9张",value:9}]);let ae=i("9:16");const ve=i([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"}]),ce={"1:1":{width:512,height:512},"16:9":{width:512,height:288},"9:16":{width:288,height:512},"4:3":{width:512,height:384},"3:4":{width:384,height:512},"2:3":{width:341,height:512},"3:2":{width:512,height:341}},pe=i(),me=i(),ge=()=>{pe.value.open()},fe=()=>{me.value.open()},he=i("");function xe(e){he.value=e}function ye(){if(!y.value)return void x.setLoginDialog(!0);if(_e.value.isVipUsed&&-1===_e.value.userType.indexOf(I.value)){let e=_e.value.userType.split(","),a="";return e.forEach(((l,t)=>{a+=E.value.filter((e=>e.id==l))[0].dictName,t<e.length-1&&(a+=",")})),void v.error(L("digitalMan.vipUse1")+a+L("digitalMan.vipUse1"))}if(!he.value)return void v.error(L("draw.inputImgDesc"));R.value=!0;let e={n:1,prompt:he.value,model_name:H.value,width:ce[ae.value].width,height:ce[ae.value].height,image:ke.value};z("dallprompt",e),setTimeout((()=>{Ee()}),1e3)}C(V,(e=>{he.value=e.makePrompt})),h.on("generateJMDraw",(e=>{he.value=e.prompt,ye()}));let ke=i(""),be=i([]),we=i([]),Ie=()=>{const e=[...we.value].sort((()=>Math.random()-.5));be.value=e.slice(0,e.length>5?5:e.length)};function Ee(){let e={n:1,prompt:he.value,model_name:H.value,width:ce[ae.value].width,height:ce[ae.value].height,image:ke.value};P(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?(_e.value=e.data,Ce.value=!1):Ce.value=!0})).catch((e=>{Ce.value=!0}))}S().then((e=>{we.value=e.data,Ie()}));const _e=i({remainCount:0,freeCount:0,useIntegrate:0}),Ce=i(!1);return C((()=>H.value),((e,a)=>{H.value&&Ee()}),{deep:!0,immediate:!0}),C((()=>ae.value),((e,a)=>{H.value&&Ee()}),{deep:!0,immediate:!0}),(e,a)=>(o(),r("div",Te,[n(ne,{ref_key:"inspirationRef",ref:pe,onDall:xe,type:"dall"},null,512),n(de,{onDall:xe,type:"dall",ref_key:"thinkRef",ref:me},null,512),u("div",je,[u("div",Be,[u("div",$e,p(e.$t("draw.genImgModel")),1),u("div",Fe,[n(f(j),{value:f(H),"onUpdate:value":[a[0]||(a[0]=e=>T(H)?H.value=e:H=e),f(K)],options:Q.value,onClick:a[1]||(a[1]=e=>T(G)?G.value=!f(G):G=!f(G)),show:!1},null,8,["value","options","onUpdate:value"]),Q.value.length>0&&f(H)&&Q.value.filter((e=>e.value==f(H)))[0].tags?(o(),r("div",Ae,p(Q.value.filter((e=>e.value==f(H)))[0].tags),1)):c("",!0),B(u("div",Ue,[u("p",null,p(e.$t("draw.videoModelChose"))+":",1),(o(!0),r(m,null,g(Q.value,(e=>(o(),r("div",{class:F(["selectItem",f(H)==e.value?"active":""]),onClick:a=>{T(H)?H.value=e.value:H=e.value,T(G)?G.value=!1:G=!1}},[u("div",qe,[k(p(e.label)+" ",1),e.tags?(o(),r("div",Se,p(e.tags),1)):c("",!0)]),u("span",null,p(e.info),1),a[5]||(a[5]=u("img",{src:le,alt:""},null,-1))],10,Je)))),256))],512),[[$,f(G)]])])]),u("div",Ve,[u("div",ze,p(e.$t("draw.chuangyiDesc")),1),u("div",Ne,[u("div",{class:"labeItem",onClick:fe},[a[6]||(a[6]=u("img",{src:te,alt:""},null,-1)),u("span",null,p(e.$t("draw.AIgenDesc")),1)]),u("div",{class:"labeItem",onClick:ge},[a[7]||(a[7]=u("img",{src:se,alt:""},null,-1)),u("span",null,p(e.$t("homePage.tips")),1)])])]),u("div",Oe,[B(u("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>he.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:e.$t("draw.textToImgExp")},"\t\t\t\t",8,Re),[[A,he.value]]),u("div",Ge,[n(f(U),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:ee},{default:d((()=>[n(f(ie))])),_:1}),n(f(U),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[3]||(a[3]=e=>Y())},{default:d((()=>[n(f(oe))])),_:1})]),a[8]||(a[8]=u("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),u("div",He,[u("span",null,p(e.$t("knowledge.recom"))+"：",1),u("div",Qe,[(o(!0),r(m,null,g(f(Z),(e=>(o(),r("div",{class:"labeItem",onClick:a=>Y(e.descript)},p(e.name),9,Ke)))),256))]),n(f(U),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:f(X)},{default:d((()=>[n(f(re))])),_:1},8,["onClick"])])]),u("div",Ze,[u("div",We,[n(f(j),{value:f(ae),"onUpdate:value":a[4]||(a[4]=e=>T(ae)?ae.value=e:ae=e),options:ve.value},null,8,["value","options"])])]),u("div",Xe,[_e.value&&_e.value.isVipUsed?(o(),r("img",Ye)):c("",!0),n(f(J),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"64px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:ye},{default:d((()=>[Ce.value?(o(),r("span",ea,p(e.$t("draw.modelNotSet")),1)):f(x).isLogin?_e.value&&_e.value.isVipFree&&b.value?(o(),r("span",la,p(e.$t("chat.vipFree")),1)):_e.value&&_e.value.remainCount&&b.value?(o(),r("span",ta,p(e.$t("draw.shenyu")+_e.value.remainCount+e.$t("draw.chiFree")),1)):_e.value?(o(),r("div",sa,[u("span",null,p(e.$t("gpt.lijiGen")),1),u("span",null,p(_e.value.useIntegrate),1),u("span",null,p(e.$t("chat.pointsChi")),1)])):(o(),r("span",ia,p(e.$t("draw.gen")),1)):(o(),r("span",aa,p(e.$t("draw.beginGen")),1))])),_:1})])])]))}}),[["__scopeId","data-v-e026f29a"]]),ra={class:"bg-[#fff] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},na={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px 0 0"},class:"contentBox bg-[#fff] dark:bg-[#313338]"},da={style:{width:"calc( 100% + 24px )",margin:"0",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},ua={class:"borTitel"},va={style:{color:"#8C441A","font-size":"18px","font-weight":"500"}},ca={style:{"margin-left":"13px",color:"#8C441A","font-size":"14px"}},pa=E(e({__name:"JMengDraw",setup(e){let d;const v=t(),c=l();V();const f=a();s((()=>c.userInfo.avatar)),s((()=>1===c.userInfo.lifetimeVip||c.userInfo.vipExpire&&new Date(c.userInfo.vipExpire)>new Date));const x=s((()=>c.isLogin));s((()=>"dark"===f.theme));const y=i(null);function k(){let e=y.value;e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight)}h.on("drawtoBottom",(e=>{setTimeout((()=>k()),300)})),C(x,(e=>{e&&I()})),z((()=>{setTimeout((()=>k()),300)}));const b=i([]);z((()=>{I()}));let w={page:1,size:999,keyType:3};h.on("dallJMModel",(e=>{})),h.on("dallJMList",(()=>{I()}));const I=async function(){d&&clearInterval(d),b.value=[];let e=(await N(w)).data.reverse(),a=!0;e.forEach((e=>{!1===e.isDelete&&(e.imgList=JSON.parse(e.fileInfo),b.value.push(e))})),d=setInterval((()=>{e.forEach(((e,l)=>{!1===e.isDelete&&("succeed"==e.answer||e.fileInfo||e.errMsg?(e.imgList=JSON.parse(e.fileInfo),b.value[l]=e):(a=!1,O({id:e.id}).then((e=>{e.data.imageUrl&&(e.data.imgList=JSON.parse(e.data.imageUrl),b.value.forEach(((a,l)=>{a.id==e.data.id&&(b.value[l]=e.data)})),clearInterval([interName]),E.value=!1,h.emit("getUserInfo",!0),setTimeout((()=>k()),300))}))))})),a&&clearInterval(d)}),3e3),console.log(b.value,"taskList.value"),setTimeout((()=>k()),300)};R((()=>{d&&clearInterval(d)}));const E=i(!1);async function _(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[],errMsg:!1};E.value=!0,b.value.push(a),setTimeout((()=>k()),300),await Q(e).then((e=>{b.value[b.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>k()),300);let a=setInterval((()=>{O({id:e.data.id}).then((e=>{(e.data.imageUrl||e.data.failReason)&&(e.data.errMsg=e.data.failReason,e.data.failReason&&v.error(e.data.failReason),e.data.imgList=JSON.parse(e.data.imageUrl),b.value[b.value.length-1]=e.data,clearInterval(a),E.value=!1,h.emit("getUserInfo",!0),setTimeout((()=>k()),300))}))}),3e3)})).catch((e=>{E.value=!1,b.value[b.value.length-1].errMsg=!0}))}const D=i("");function M(e){D.value=e}i(!1);const L=i();return(e,a)=>(o(),r("div",ra,[n(oa,{type:"dall",makePrompt:D.value,isLoading:E.value,onDallprompt:_},null,8,["makePrompt","isLoading"]),u("div",na,[u("div",da,[u("div",ua,[u("span",va,"# "+p(e.$t("draw.creationCenter")),1),u("p",ca,p(e.$t("draw.SafetyWarning")),1)])]),u("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px 0 0"},ref_key:"taskBox",ref:y},[x.value&&0!=b.value.length?(o(!0),r(m,{key:0},g(b.value,(e=>(o(),G(Pe,{key:e.id,task:e},null,8,["task"])))),128)):(o(),G(ae,{key:1,onHandleprompt:M}))],512)]),n(H,{style:{right:"20px",left:"auto",bottom:"auto",top:"60px",border:"1px solid #EAEBEC"},ref_key:"userDialogRef",ref:L},null,512)]))}}),[["__scopeId","data-v-f1730c88"]]);export{pa as default};
