import{e,k as a,J as l,p as t,r,g as s,l as o,I as i,K as n,L as u,q as d,M as v,w as c,x as p,B as f,G as h,y as m,O as g,D as w,A as y,F as k,E as x,P as b,Q as I,C,T as E,z as _,R as j,S as z,U as q,W as S,_ as D,a5 as F,Z as M,a1 as $,$ as L,a6 as T}from"../main-bf8e7d49.js";import{I as B}from"../mj-menu/mj-menu.41e6da46.js";import{_ as U,a as W}from"../dianzan/dianzan.4417d952.js";import{f as A}from"../ppt/ppt.d221cd1f.js";import{t as R}from"../throttle/throttle.33f09de3.js";import{N as Q}from"../Carousel/Carousel.33dcf2fc.js";const N={class:"overflow-hidden pr-0 h-full flex flex-col"},O={class:"market overflow-y-auto flex-1 relative itemContent"},K=["onClick","src"],P=["id"],V=["id","src","onLoad","onError"],G=["onClick"],H={class:"bottomInfoBox"},J={class:"userInfo"},Z=["src"],X=["onClick"],Y={key:0,src:U,class:"dianzan",alt:""},ee={key:1,src:W,class:"dianzan",alt:""},ae=D(e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:D}){var F;const M=a();null==(F=l())||F.appContext.config.globalProperties.$viewerApi,t();const $=r([]),L=r({}),T=r(0),B=r(160),U=r(0),W=r(10),ae=r(10),le=r([]),te=r(null),re=r(0),se=s((()=>M.isLogin)),oe=r(30),ie=r(""),ne=s((()=>oe.value+W.value+250)),ue=o(),de=e,ve=r();i.on("newData",(e=>{ve.value=e}));const ce=n({page:1,size:999,rec:1,squareType:de.type,keyword:""});function pe(){!function(){const{showName:e=0,showOther:a=0}={};T.value=15*[e,a].filter((e=>e)).length}(),function(){if(!te.value)return;const e=te.value.clientWidth;U.value=Math.floor(e/ne.value);const a=e-U.value*ne.value,l=(U.value-1)*W.value;a-l<0&&(U.value-=1);B.value=Math.floor((e-l)/U.value),console.log(B.value,"realWidth.value")}();const e=U.value,a=B.value,l=[];he.value.forEach(((t,r)=>{let s=200,o=300;t.fileInfo&&(s=t.fileInfo.width||s,o=t.fileInfo.height||o);const i=o*(a/s)+ae.value+T.value,n=L.value[t.id];if(l.length<e)n.style.top="0px",n.style.left=(a+W.value)*r+"px",l.push(i);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));n.style.top=`${e+0}px`,n.style.left=a*(B.value+W.value)+"px",l[a]+=i}})),re.value=Math.max(...l)+130}function fe(e,a){e&&a&&(L.value[a.id]=e)}const he=s((()=>ve.value?ve.value.rows:ie.value?$.value.filter((e=>{const{prompt:a}=e;return a.includes(ie.value)})):$.value));u(oe,(()=>{pe()}));let me=null;async function ge(){let e;e="fav"===ce.squareType?await j({page:ce.page,size:ce.size}):await z(ce);let a=[{id:"wapper-carousel",noShow:!0,fileInfo:{width:1024,height:1024}},{id:"wapper-carousel2",noShow:!0,fileInfo:{width:1024,height:1024}},...e.data.rows];a.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),$.value=a}u(he,(()=>{he.value.length&&(clearTimeout(me),me=setTimeout((()=>{pe()}),300))}));const we=s((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/B.value)})),ye=R((function(){pe()}),200);let ke=r([]);d((async()=>{await ge(),pe(),window.addEventListener("resize",ye),A({code:"MjRcMarquee"}).then((e=>{var a;ke.value=null==(a=e.data)?void 0:a.recMarquee,ke.value.forEach((e=>{e.fileInfo={width:1024,height:1024}}))}))})),D({handleQuery:e=>{ce.keyword="",ce.squareType=e,ge(),pe()},handleSearch:e=>{ce.squareType="",ce.keyword=e,ge(),pe()}}),v((()=>{window.removeEventListener("resize",ye)}));const xe=r(0);return(e,a)=>(c(),p("div",N,[f("div",O,[f("div",{id:"wapper",ref_key:"wapperRef",ref:te,class:"wapper",style:h({height:`${re.value}px`})},[m(ke).length>0?(c(),g(m(Q),{key:0,class:"wapper-item",id:"wapper-carousel",ref:e=>fe(e,{id:"wapper-carousel"}),style:h([{width:2*B.value+10+"px",height:`${we.value(m(ke)[0])}px`},{"border-radius":"8px",overflow:"hidden"}]),draggable:""},{default:w((()=>[(c(!0),p(k,null,x(m(ke),((e,a)=>(c(),p("img",{class:"carousel-img",onClick:a=>(e=>{if(!(e.targetUrl.indexOf("http")>-1))return se.value?void ue.push(e.targetUrl):(M.setLoginDialog(!0),void i.emit("register",0));window.open(e.targetUrl)})(e),style:h({width:2*B.value+10+"px",height:`${we.value(e)}px`}),src:e.url},null,12,K)))),256))])),_:1},8,["style"])):y("",!0),(c(!0),p(k,null,x(he.value,((e,l)=>{var t,r;return b((c(),p("div",{id:e.id,key:l,ref_for:!0,ref:a=>fe(a,e),class:"wapper-item",style:h({width:`${B.value}px`})},[C(E,{name:"img",css:!0},{default:w((()=>[f("img",{id:e.id,class:"item-file rounded-sm",style:h({width:`${B.value}px`,height:`${we.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){le.value.push(a.id)}(0,e),onError:a=>function(e,a){le.value.push(a.id)}(0,e)},null,44,V)])),_:2},1024),f("div",{class:"menu",onClick:a=>function(e){i.emit("Details",!0),i.emit("DetailsData",e)}(e)},a[0]||(a[0]=[f("div",null,"查看详情",-1)]),8,G),f("div",H,[f("div",J,[f("img",{src:(null==(t=e.userInfo)?void 0:t.avatar)||m(S),class:"smallHead",alt:""},null,8,Z),f("span",null,_((null==(r=e.userInfo)?void 0:r.nickname)||"官方"),1)]),f("div",{class:"userInfo",onClick:a=>function(e){let a={id:e.id,favorite:e.isCollect?0:1};1!=xe.value&&(xe.value=1,q(a).then((e=>{ge(),pe(),xe.value=0})))}(e)},[e.isCollect?(c(),p("img",Y)):(c(),p("img",ee)),f("span",null,_(e.collectNum||0),1)],8,X)])],12,P)),[[I,!e.noShow]])})),128))],4)])]))}}),[["__scopeId","data-v-0d13b600"]]),le={style:{padding:"15px 24px 0 24px",height:"100%"},class:"bg-[#F8F9F9] dark:bg-[#181818]"},te={class:"topBox"},re={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},se={class:"relative z-40 transition-300 ease"},oe={class:"flex justify-start items-center",ref:"tabListRef"},ie=["onClick"],ne={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},ue={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},de={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},ve={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},ce={class:"flex-1 marketBox"},pe=D(e({__name:"square",setup(e){const{isMobile:a}=F(),l=r(""),t=r(),o=M(),n=s((()=>"dark"===o.theme)),u=r([]);(async()=>{const e=await T({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""},{name:"我的收藏",value:"fav"}].concat(e)||B,t.value.handleQuery(l.value)})();r("");const d=r("");function v(e){13==e.keyCode&&t.value.handleSearch(d.value)}return(e,r)=>(c(),p("div",le,[f("div",te,[m(a)?y("",!0):(c(),p("div",re,[f("div",se,[f("ul",oe,[(c(!0),p(k,null,x(u.value,(e=>(c(),p("li",{onClick:a=>{return r=e,l.value=r.value,t.value.handleQuery(r.value),void i.emit("newData","");var r},class:$(["mr-1 ml-1 w-auto select-none cursor-pointer bg-white hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-r hover:from-[#957DF4] hover:to-[#3C69E7] dark:hover:from-transparent dark:hover:to-transparent dark:border dark:border-[transparent] dark:hover:border-[#3E6AE7] duration-300 flex rounded-lg",[e.value===l.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#3E6AE7] bg-[#dae7e6] border-0 dark:border dark:border-[#3E6AE7]":"bg-white dark:bg-transparent"]])},[f("div",ne,_(e.name),1)],10,ie)))),256))],512)])])),f("div",ue,[n.value?(c(),p("img",de)):(c(),p("img",ve)),b(f("input",{type:"text",onKeydown:v,name:"","onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),id:"",placeholder:"请输入关键词"},null,544),[[L,d.value]])])]),f("div",ce,[C(ae,{ref_key:"marketRef",ref:t,type:l.value,keyWord:d.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-fa34e73c"]]);export{pe as default};
