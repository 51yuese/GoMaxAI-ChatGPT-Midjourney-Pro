import{e,Z as a,k as l,p as s,g as i,r,w as o,x as n,C as d,D as u,B as c,am as v,A as p,z as m,F as g,E as f,y as x,I as y,aj as k,G as b,a4 as h,a1 as w,ao as C,bt as E,_ as I,aP as _,L,v as P,$ as F,aQ as B,bT as D,aH as $,N as j,P as T,Q as z,a2 as A,a0 as M,a5 as U,aI as q,aD as K,bU as V,bV as S,an as N,be as G,q as O,bW as R,b_ as J,aV as W,O as H,bX as Q,c0 as Z}from"../main-b114ff11.js";import{a as X}from"../draw-fail/draw-fail.ad8fd01b.js";import{_ as Y,a as ee,b as ae}from"../KLingIcon3/KLingIcon3.6acffd30.js";import{N as le}from"../Popconfirm/Popconfirm.5446b9cc.js";import{C as te,_ as se,n as ie}from"../isVIP2/isVIP2.1f3c489e.js";import{_ as re}from"../aiVideoGou/aiVideoGou.56a8a6eb.js";import{_ as oe,a as ne,C as de,T as ue,S as ce}from"../AI2/AI2.618bccbb.js";import{_ as ve}from"../uploadImg/uploadImg.66d9b869.js";import{_ as pe,b as me}from"../baiduThink/baiduThink.f40970a8.js";import{u as ge}from"../useUpload/useUpload.c4974038.js";const fe={class:"dallTaskBox"},xe=["src"],ye={class:"dallTaskItem bg-[#fff] dark:bg-[#313338]",style:{padding:"12px 12px 12px 0","border-radius":"12px",display:"flex","margin-top":"12px"}},ke={class:"content",style:{"margin-left":"12px",width:"100%"}},be={style:{display:"flex","justify-content":"space-between"}},he={style:{display:"flex","align-items":"center"}},we={class:"discord-en"},Ce={class:"discord-time"},Ee={key:0,class:"flexLabel"},Ie={class:"itemLabel"},_e={class:"itemLabel"},Le={key:0,class:"answerImgBox"},Pe=["onClick","src"],Fe={key:1,style:{display:"flex","align-items":"center"}},Be={key:0,style:{width:"20%",height:"246px",display:"flex","flex-direction":"column","align-items":"center"}},De={style:{"margin-top":"8px",color:"#D4237A"}},$e={key:1,style:{display:"flex","align-items":"center","flex-wrap":"wrap"}},je={class:"loader"},Te={class:"btnBox"},ze={class:"btnItem"},Ae={style:{display:"flex","align-items":"center"}},Me={class:"btnItem"},Ue={class:"btnItem"},qe=I(e({__name:"index",props:{task:{type:Object}},setup(e){const I=a(),_=l(),L=s(),P=i((()=>"dark"===I.theme)),F=e,B=r(!1),D=r("");let $=()=>{y.emit("copyKLData",F.task)},j=()=>{var e;(null==(e=null==_?void 0:_.userInfo)?void 0:e.score)>0?y.emit("generateKLDraw",F.task):L.error(t("common.noPoint"))},T=r(!1),z=()=>{T.value=!0,E({id:F.task.id}).then((e=>{y.emit("dallKLList"),T.value=!1}))};return(e,a)=>(o(),n("div",fe,[d(x(w),{show:x(T)},{default:u((()=>[B.value?(o(),n("div",{key:0,onClick:a[1]||(a[1]=e=>{B.value=!1,D.value=""}),class:"mask"},[c("img",{src:D.value,style:{width:"auto",height:"90%"},alt:"",onClick:a[0]||(a[0]=v((()=>{}),["stop"]))},null,8,xe)])):p("",!0),c("div",ye,[a[8]||(a[8]=c("div",{class:"avator"},[c("div",{class:"discord-avatar"},[c("img",{src:"/static/svg/Discord-KL-0bef4b87.svg",alt:""})])],-1)),c("div",ke,[c("div",be,[c("div",he,[c("span",we,"可灵-"+m(e.$t("draw.imgGen")),1),c("div",Ce,m(F.task.createdAt),1)])]),c("div",{class:"title",style:{"margin-top":"4px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>{var a;(a=F.task.prompt)?(C({text:a}),L.success(t("chat.copied"))):L.error(t("draw.noDataCopy"))})},m(F.task.prompt),1),F.task.requestParams?(o(),n("div",Ee,[c("div",Ie,m(F.task.requestParams.model_name),1),c("div",_e,m(F.task.requestParams.aspect_ratio),1)])):p("",!0),c("div",null,[F.task.imgList&&F.task.imgList.length>0?(o(),n("div",Le,[(o(!0),n(g,null,f(F.task.imgList,(e=>(o(),n("img",{onClick:a=>function(e){B.value=!0,D.value=e}(e),src:e,onLoad:a[3]||(a[3]=e=>x(y).emit("drawtoBottom")),alt:""},null,40,Pe)))),256))])):(o(),n("div",Fe,[F.task.errMsg?(o(),n("div",Be,[a[6]||(a[6]=c("img",{src:X,alt:""},null,-1)),c("p",De,m(e.$t("draw.drawErro")),1)])):(o(),n("div",$e,[(o(!0),n(g,null,f(F.task.requestParams.n,(e=>(o(),n("div",je)))),256))]))]))]),c("div",Te,[c("div",ze,[d(x(k),{trigger:"hover"},{trigger:u((()=>[c("img",{src:Y,onClick:a[4]||(a[4]=(...e)=>x($)&&x($)(...e)),alt:""})])),default:u((()=>[c("div",Ae,[c("span",null,m(e.$t("draw.useImgParams")),1)])])),_:1})]),c("div",Me,[c("img",{src:ee,onClick:a[5]||(a[5]=(...e)=>x(j)&&x(j)(...e)),alt:""})]),c("div",Ue,[d(x(le),{onPositiveClick:x(z),style:b(P.value?"background:#19191B":"background:#F8F9F9")},{trigger:u((()=>a[7]||(a[7]=[c("img",{src:ae,alt:"",style:{width:"16px",height:"16px"}},null,-1)]))),default:u((()=>[h(" "+m(e.$t("draw.confirmDelWork")),1)])),_:1},8,["onPositiveClick","style"])])])])])])),_:1},8,["show"])]))}}),[["__scopeId","data-v-d0cbb145"]]),Ke={class:"promptBox border-[#E8E8E8] dark:border-[#24252b] bg-[#F9F9FB] dark:bg-[#222325]"},Ve={class:"dallBox"},Se={class:"dallContent"},Ne={style:{display:"flex","align-items":"center",height:"60px"}},Ge={class:"dark:text-[#EEEEF0] text-[#000] text-[18px]",style:{"margin-right":"12px"}},Oe={style:{width:"auto",position:"relative"},class:"customBox"},Re={key:0,class:"newModel"},Je={class:"custerSelect"},We=["onClick"],He={class:"name"},Qe={key:0,class:"newModel"},Ze={class:"recomBox",style:{"margin-bottom":"6px",padding:"0"}},Xe={class:"dark:text-[#EEEEF0] text-[#767676] text-[14px]"},Ye={class:"labeBox",style:{flex:"none"}},ea={style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},aa=["placeholder"],la={style:{width:"100%","text-align":"right","padding-right":"12px"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]"},ta={class:"recomBox"},sa={class:"labeBox"},ia=["onClick"],ra={key:0,style:{display:"flex",margin:"16px 0 6px","justify-content":"space-between"}},oa={class:"dark:text-[#EEEEF0] text-[#1E1F1F] text-[12px]"},na={class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},da={key:1,class:"lityFlex"},ua=["onClick"],ca={key:2,style:{width:"100%","border-radius":"6px"},class:"bg-[#FFF] dark:bg-[#17181A] border border-[#E8E8E8] dark:border-[#292A2E]"},va={class:"text-[12px] text-[#8B8C8C] dark:text-[#6C6E79]",style:{"margin-top":"12px"}},pa={class:"dark:text-[#6C6E79] text-[#8B8C8C] text-[10px]"},ma={class:"imgBox",style:{width:"auto",height:"134px"}},ga=["src"],fa={class:"recomBox"},xa={class:"labeBox"},ya=["onClick","src"],ka={key:3,class:"sliderBox"},ba={key:4,class:"sliderBox"},ha={class:"flexSelect"},wa={style:{width:"116px","margin-right":"10px"}},Ca={style:{width:"74px","margin-right":"10px"}},Ea={style:{position:"absolute",bottom:"0",left:"0px",width:"462px"},class:"border-t border-[#E8E8E8] dark:border-[#292A2E]"},Ia={key:0,class:"vipIcon",src:se,alt:""},_a={key:0,style:{color:"#fff"}},La={key:1,style:{color:"#fff"}},Pa={key:2,style:{color:"#fff"}},Fa={key:3,style:{color:"#fff"}},Ba={key:4,style:{display:"flex","align-items":"center",color:"#fff"}},Da={key:5,style:{color:"#fff"}},$a=I(e({__name:"index_2",props:{type:String,drawType:String,isLoading:Boolean,makePrompt:String},emits:["submit","mjVersionChange","submitData","dallprompt"],setup(e,{emit:a}){const{selectFileByImageAndVideo:t}=ge(),k=r("/api/file/upload"),b=s(),E=l(),I=i((()=>E.isLogin));i((()=>E.userInfo));const G=i((()=>1===E.userInfo.lifetimeVip||E.userInfo.vipExpire&&new Date(E.userInfo.vipExpire)>new Date)),O=i((()=>E.userInfo.vipLeavelId));let R=r([]);_().then((e=>{R.value=e.data})),y.on("copyKLData",(e=>{Be.value=e.requestParams.prompt,se.value=e.requestParams.model_name,Ee.value=e.requestParams.aspect_ratio,X.value=e.requestParams.image_fidelity,Y.value=e.requestParams.human_fidelity,ee.value=e.requestParams.image_reference,we.value=e.requestParams.n,e.requestParams&&e.requestParams.image&&"object"==typeof e.requestParams.image&&e.requestParams.image.length>0&&(je.value=e.requestParams.image)}));const J=e;L(J,(e=>{0==e.isLoading&&(Be.value="")}));const W=a,H=r(""),Q=r("");P({keys:["dialogueTail","robotAvatar","mjModel","relax_mjDeduction1","relax_mjDeduction2","fast_mjDeduction1","fast_mjDeduction2"]}).then((e=>{Q.value=e.data.mjModel,H.value=e.data.robotAvatar}));const Z=r(!1);let X=r(.5),Y=r(.45),ee=r("face"),ae=r([{label:F("draw.personZx"),value:"face"},{label:F("draw.subject"),value:"subject"}]),le=r(!1),se=r("");const ie=r([]);B({modelType:"draw",keyType:2}).then((e=>{ie.value=e.data.rows[0].children,console.log(ie.value,"fetchQueryModelsListAPIMaps"),se.value=ie.value[0].value,y.emit("dallKLModel",se.value)}));let fe=e=>{console.log("handleUpdateModel"),y.emit("dallKLModel",e)},xe=r([]),ye=r([]),ke=()=>{const e=[...ye.value].sort((()=>Math.random()-.5));xe.value=e.slice(0,e.length>3?3:e.length)};function be(e=""){Be.value=e}function he(){Be.value?(C({text:Be.value}),b.success(F("chat.copied"))):b.error(F("draw.noDataCopy"))}V().then((e=>{var a,l;ye.value=null==(l=null==(a=e.data)?void 0:a.t2v)?void 0:l.recTags,ke()})),r("std"),r([{label:"标准质量",value:"std"},{label:"高品质模式",value:"pro"}]);let we=r(1);const Ce=r([{label:"1"+F("draw.zhang"),value:1},{label:"2"+F("draw.zhang"),value:2},{label:"3"+F("draw.zhang"),value:3},{label:"4"+F("draw.zhang"),value:4},{label:"5"+F("draw.zhang"),value:5},{label:"6"+F("draw.zhang"),value:6},{label:"7"+F("draw.zhang"),value:7},{label:"8"+F("draw.zhang"),value:8},{label:"9"+F("draw.zhang"),value:9}]);let Ee=r("9:16");const Ie=r([{label:"1:1",value:"1:1"},{label:"16:9",value:"16:9"},{label:"4:3",value:"4:3"},{label:"3:2",value:"3:2"},{label:"2:3",value:"2:3"},{label:"3:4",value:"3:4"},{label:"9:16",value:"9:16"},{label:"21:9",value:"21:9"}]),_e=r(),Le=r(),Pe=()=>{_e.value.open()},Fe=()=>{Le.value.open()},Be=r("");function De(e){Be.value=e}function $e(){if(!I.value)return void E.setLoginDialog(!0);if($a.value.isVipUsed&&-1===$a.value.userType.indexOf(O.value)){let e=$a.value.userType.split(","),a="";return e.forEach(((l,t)=>{a+=R.value.filter((e=>e.id==l))[0].dictName,t<e.length-1&&(a+=",")})),void b.error(F("digitalMan.vipUse1")+a+F("digitalMan.vipUse1"))}if(!Be.value)return void b.error(F("draw.inputImgDesc"));Z.value=!0;let e={n:we.value,prompt:Be.value,model_name:se.value,aspect_ratio:Ee.value,human_fidelity:Y.value,image_fidelity:X.value};"kling-v1-5"==se.value&&(e.image_reference=ee.value,e.image=je.value[0]),"kling-v1"==se.value&&(e.image=je.value[0]),W("dallprompt",e),je.value=[],setTimeout((()=>{qe()}),1e3)}L(J,(e=>{Be.value=e.makePrompt})),y.on("generateKLDraw",(e=>{Be.value=e.prompt,$e()}));let je=r([]);let Te=r([]),ze=r([]),Ae=()=>{const e=[...ze.value].sort((()=>Math.random()-.5));Te.value=e.slice(0,e.length>5?5:e.length)};async function Me(){try{(async function(){return new Promise((async(e,a)=>{try{const a=await t();Ue.value=!0,await N.post(k.value,{file:a},{headers:{"Content-Type":"multipart/form-data"}}).then((a=>{Ue.value=!1,console.log(a),200==a.data.code?e(a.data.data):b.error(null==a.data.message?a.data.data:a.data.message)}))}catch(l){Ue.value=!1,b.error(l.message),e(!1)}}))})().then((e=>{je.value=[e]}))}catch(e){b.error(e.message)}}S().then((e=>{ze.value=e.data,Ae()}));let Ue=r(!1);function qe(){let e={n:we.value,prompt:Be.value,model_name:se.value,aspect_ratio:Ee.value,image_fidelity:X.value,human_fidelity:Y.value,image_reference:ee.value,image:je.value};D(e).then((e=>{console.log(e.data,"fetchDrawModelFree"),200===e.code?($a.value=e.data,ja.value=!1):ja.value=!0})).catch((e=>{ja.value=!0}))}const $a=r({remainCount:0,freeCount:0,useIntegrate:0}),ja=r(!1);return L((()=>se.value),((e,a)=>{se.value&&qe()}),{deep:!0,immediate:!0}),L((()=>Ee.value),((e,a)=>{se.value&&qe()}),{deep:!0,immediate:!0}),L((()=>we.value),((e,a)=>{se.value&&qe()}),{deep:!0,immediate:!0}),(e,a)=>(o(),n("div",Ke,[d(pe,{ref_key:"inspirationRef",ref:_e,onDall:De,type:"dall"},null,512),d(me,{onDall:De,type:"dall",ref_key:"thinkRef",ref:Le},null,512),c("div",Ve,[c("div",Se,[c("div",Ne,[c("div",Ge,m(e.$t("draw.genImgModel")),1),c("div",Oe,[c("div",{class:"cSelectBox",onClick:a[0]||(a[0]=e=>$(le)?le.value=!x(le):le=!x(le))},[c("span",null,m(x(se)&&ie.value.filter((e=>e.value==x(se)))[0].label),1),ie.value.length>0&&x(se)&&ie.value.filter((e=>e.value==x(se)))[0].new?(o(),n("div",Re,"NEW")):p("",!0),d(x(j),{size:"14"},{default:u((()=>[d(x(te))])),_:1})]),T(c("div",Je,[c("p",null,m(e.$t("draw.videoModelChose"))+":",1),(o(!0),n(g,null,f(ie.value,(e=>(o(),n("div",{class:A(["selectItem",x(se)==e.value?"active":""]),onClick:a=>{$(se)?se.value=e.value:se=e.value,$(le)?le.value=!1:le=!1,x(fe)(e.value)}},[c("div",He,[h(m(e.label)+" ",1),e.new?(o(),n("div",Qe,"NEW")):p("",!0)]),c("span",null,m(e.desc),1),a[9]||(a[9]=c("img",{src:re,alt:""},null,-1))],10,We)))),256))],512),[[z,x(le)]])])]),c("div",Ze,[c("div",Xe,m(e.$t("draw.chuangyiDesc")),1),c("div",Ye,[c("div",{class:"labeItem",onClick:Fe},[a[10]||(a[10]=c("img",{src:oe,alt:""},null,-1)),c("span",null,m(e.$t("draw.AIgenDesc")),1)]),c("div",{class:"labeItem",onClick:Pe},[a[11]||(a[11]=c("img",{src:ne,alt:""},null,-1)),c("span",null,m(e.$t("homePage.tips")),1)])])]),c("div",ea,[T(c("textarea",{"onUpdate:modelValue":a[1]||(a[1]=e=>Be.value=e),style:{width:"100%",height:"112px",resize:"none","background-color":"transparent",padding:"24px 14px 0"},class:"text-[12px] text-[#8B8C8C] dark-[#6C6E79]",placeholder:e.$t("draw.textToImgExp")},"\t\t\t\t",8,aa),[[M,Be.value]]),c("div",la,[d(x(j),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:he},{default:u((()=>[d(x(de))])),_:1}),d(x(j),{size:"18px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:a[2]||(a[2]=e=>be())},{default:u((()=>[d(x(ue))])),_:1})]),a[12]||(a[12]=c("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),c("div",ta,[c("span",null,m(e.$t("knowledge.recom"))+"：",1),c("div",sa,[(o(!0),n(g,null,f(x(xe),(e=>(o(),n("div",{class:"labeItem",onClick:a=>be(e.descript)},m(e.name),9,ia)))),256))]),d(x(j),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:x(ke)},{default:u((()=>[d(x(ce))])),_:1},8,["onClick"])])]),"kling-v2"!=x(se)?(o(),n("div",ra,[c("div",null,[c("div",oa,[h(m(e.$t("draw.uploadCankaoImg")),1),c("span",na,m(e.$t("draw.notMust")),1)])])])):p("",!0),"kling-v1-5"==x(se)?(o(),n("div",da,[(o(!0),n(g,null,f(x(ae),(e=>(o(),n("div",{class:A(["lityItem",x(ee)==e.value?"active":""]),onClick:a=>$(ee)?ee.value=e.value:ee=e.value},m(e.label),11,ua)))),256))])):p("",!0),"kling-v2"!=x(se)?(o(),n("div",ca,[d(x(w),{show:x(Ue)},{default:u((()=>[0==x(je).length?(o(),n("div",{key:0,onClick:a[3]||(a[3]=e=>Me()),style:{height:"134px",padding:"8px","border-radius":"8px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",cursor:"pointer"},class:"bg-[#FFF] dark:bg-[#17181a]"},[a[13]||(a[13]=c("img",{src:ve,alt:""},null,-1)),c("div",va,m(e.$t("draw.uploadCankaoImg")),1),c("div",pa,m(e.$t("draw.canJPGPNG")),1)])):(o(),n("div",{key:1,onClick:a[4]||(a[4]=e=>Me()),style:{"min-height":"134px","border-radius":"8px",display:"flex","flex-wrap":"wrap","align-items":"center","justify-content":"center",cursor:"pointer",gap:"4px"},class:"bg-[#FFF] dark:bg-[#393936] resultImg"},[(o(!0),n(g,null,f(x(je),((e,a)=>(o(),n("div",ma,[c("img",{src:e,style:{width:"100%",height:"100%"}},null,8,ga),d(x(j),{size:"18px",color:"#767676",style:{cursor:"pointer","z-index":"9"},onClick:v((e=>x(je).splice(a,1)),["stop"])},{default:u((()=>[d(x(ue))])),_:2},1032,["onClick"])])))),256))]))])),_:1},8,["show"]),a[14]||(a[14]=c("div",{class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},null,-1)),c("div",fa,[c("span",null,m(e.$t("knowledge.recom"))+"：",1),c("div",xa,[(o(!0),n(g,null,f(x(Te),(e=>(o(),n("img",{class:"labeImg",onClick:a=>{return l=e,void(je.value=[l.imageUrl]);var l},src:e.imageUrl,alt:""},null,8,ya)))),256))]),d(x(j),{size:"20px",color:"#767676",style:{"margin-left":"10px",cursor:"pointer"},onClick:x(Ae)},{default:u((()=>[d(x(ce))])),_:1},8,["onClick"])])])):p("",!0),"kling-v2"!=x(se)?(o(),n("div",ka,[c("span",null,m("kling-v1-5"==x(se)?e.$t("draw.faceCanKao"):e.$t("draw.imgCanKao"))+":",1),d(x(U),{style:{flex:"1",margin:"0 10px"},value:x(X),"onUpdate:value":a[5]||(a[5]=e=>$(X)?X.value=e:X=e),step:.05,max:1,min:.1},null,8,["value"]),c("span",null,m(x(X)),1)])):p("",!0),"kling-v2"!=x(se)?(o(),n("div",ba,[c("span",null,m(e.$t("draw.mainCanKao"))+":",1),d(x(U),{style:{flex:"1",margin:"0 10px"},value:x(Y),"onUpdate:value":a[6]||(a[6]=e=>$(Y)?Y.value=e:Y=e),step:.05,max:1,min:.1},null,8,["value"]),c("span",null,m(x(Y)),1)])):p("",!0)]),c("div",ha,[c("div",wa,[d(x(q),{value:x(Ee),"onUpdate:value":a[7]||(a[7]=e=>$(Ee)?Ee.value=e:Ee=e),options:Ie.value},null,8,["value","options"])]),c("div",Ca,[d(x(q),{value:x(we),"onUpdate:value":a[8]||(a[8]=e=>$(we)?we.value=e:we=e),options:Ce.value},null,8,["value","options"])])]),c("div",Ea,[$a.value&&$a.value.isVipUsed?(o(),n("img",Ia)):p("",!0),d(x(K),{tertiary:"",class:"bg-gradient-to-r from-[#574FFE] to-[#726AFB]",style:{width:"100%",height:"64px","font-size":"15px","border-radius":"8px",padding:"12px 0","margin-top":"12px"},onClick:$e},{default:u((()=>[ja.value?(o(),n("span",_a,m(e.$t("draw.modelNotSet")),1)):x(E).isLogin?$a.value&&$a.value.isVipFree&&G.value?(o(),n("span",Pa,m(e.$t("chat.vipFree")),1)):$a.value&&$a.value.remainCount&&G.value?(o(),n("span",Fa,m(e.$t("draw.shenyu")+$a.value.remainCount+e.$t("draw.chiFree")),1)):$a.value?(o(),n("div",Ba,[c("span",null,m(e.$t("gpt.lijiGen")),1),c("span",null,m($a.value.useIntegrate),1),c("span",null,m(e.$t("chat.pointsChi")),1)])):(o(),n("span",Da,m(e.$t("draw.gen")),1)):(o(),n("span",La,m(e.$t("draw.beginGen")),1))])),_:1})])])]))}}),[["__scopeId","data-v-6bef27bc"]]),ja={class:"bg-[#fff] dark:bg-[#222325]",style:{display:"flex","box-sizing":"border-box",height:"100%",overflow:"hidden"}},Ta={style:{flex:"1",display:"flex","flex-direction":"column",padding:"0 12px 0 0"},class:"contentBox bg-[#fff] dark:bg-[#313338]"},za={style:{width:"calc( 100% + 24px )",margin:"0",padding:"0 12px",display:"flex","align-items":"center","justify-content":"space-between",height:"60px","margin-bottom":"10px"},class:"border-b border-[#E8E8E8] dark:border-[#292A2E]"},Aa={class:"borTitel"},Ma={style:{color:"#8C441A","font-size":"18px","font-weight":"500"}},Ua={style:{"margin-left":"13px",color:"#8C441A","font-size":"14px"}},qa=I(e({__name:"KLingDraw",setup(e){let t;const u=s(),v=l();G();const p=a();i((()=>v.userInfo.avatar)),i((()=>1===v.userInfo.lifetimeVip||v.userInfo.vipExpire&&new Date(v.userInfo.vipExpire)>new Date));const x=i((()=>v.isLogin));i((()=>"dark"===p.theme));const k=r(null);function b(){let e=k.value;e.scrollTo({top:e.scrollHeight+100,behavior:"smooth"}),console.log(e.scrollHeight)}y.on("drawtoBottom",(e=>{setTimeout((()=>b()),300)})),L(x,(e=>{e&&C()})),O((()=>{setTimeout((()=>b()),300)}));const h=r([]);O((()=>{}));let w={page:1,size:999,keyType:2};y.on("dallKLModel",(e=>{w.model=e,C()})),y.on("dallKLList",(()=>{C()}));const C=async function(){t&&clearInterval(t),h.value=[];let e=(await R(w)).data.reverse(),a=!0;e.forEach((e=>{!1===e.isDelete&&(e.imgList=JSON.parse(e.fileInfo),h.value.push(e))})),t=setInterval((()=>{e.forEach(((e,l)=>{!1===e.isDelete&&("succeed"==e.answer||e.fileInfo||e.errMsg?(e.imgList=JSON.parse(e.fileInfo),h.value[l]=e):(a=!1,J({id:e.id}).then((e=>{"succeed"==e.data.answer&&e.data.imageUrl&&(e.data.imgList=JSON.parse(e.data.imageUrl),h.value.forEach(((a,l)=>{a.id==e.data.id&&(h.value[l]=e.data)})),clearInterval([interName]),E.value=!1,y.emit("getUserInfo",!0),setTimeout((()=>b()),300))}))))})),a&&clearInterval(t)}),3e3),console.log(h.value,"taskList.value"),setTimeout((()=>b()),300)};W((()=>{t&&clearInterval(t)}));const E=r(!1);async function I(e){let a={id:0,prompt:e.prompt,requestParams:e,imgList:[],errMsg:!1};E.value=!0,h.value.push(a),setTimeout((()=>b()),300),await Z(e).then((e=>{h.value[h.value.length-1].requestParams=e.data.requestParams,setTimeout((()=>b()),300);let a=setInterval((()=>{J({id:e.data.id}).then((e=>{("succeed"==e.data.answer&&e.data.imageUrl||e.data.failReason)&&(e.data.errMsg=e.data.failReason,e.data.failReason&&u.error(e.data.failReason),e.data.imgList=JSON.parse(e.data.imageUrl),h.value[h.value.length-1]=e.data,clearInterval(a),E.value=!1,y.emit("getUserInfo",!0),setTimeout((()=>b()),300))}))}),3e3)})).catch((e=>{E.value=!1,h.value[h.value.length-1].errMsg=!0}))}const _=r("");function P(e){_.value=e}r(!1);const F=r();return(e,a)=>(o(),n("div",ja,[d($a,{type:"dall",makePrompt:_.value,isLoading:E.value,onDallprompt:I},null,8,["makePrompt","isLoading"]),c("div",Ta,[c("div",za,[c("div",Aa,[c("span",Ma,"# "+m(e.$t("draw.creationCenter")),1),c("p",Ua,m(e.$t("draw.SafetyWarning")),1)])]),c("div",{style:{flex:"1","overflow-y":"auto",padding:"0 12px 0 0"},ref_key:"taskBox",ref:k},[x.value&&0!=h.value.length?(o(!0),n(g,{key:0},f(h.value,(e=>(o(),H(qe,{key:e.id,task:e},null,8,["task"])))),128)):(o(),H(ie,{key:1,onHandleprompt:P}))],512)]),d(Q,{style:{right:"20px",left:"auto",bottom:"auto",top:"60px",border:"1px solid #EAEBEC"},ref_key:"userDialogRef",ref:F},null,512)]))}}),[["__scopeId","data-v-07f3735e"]]);export{qa as default};
