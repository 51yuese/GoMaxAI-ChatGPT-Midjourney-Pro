import{e,R as a,bj as l,ao as t,r as s,j as n,S as r,a0 as o,a4 as i,A as u,k as v,a5 as d,O as c,P as f,H as p,Z as h,_ as m,a7 as y,N as g,U as w,W as x,T as k,a8 as b,a9 as F,X as _,a6 as j,F as C,ag as I,ab as S,ac as $,aa as q,$ as z,a3 as A}from"../main-ddc3955a.js";import{t as E}from"../throttle/throttle.33f09de3.js";const L={class:"overflow-hidden pr-0 h-full flex flex-col"},T={class:"market overflow-y-auto flex-1 min-h-screen h-[100vh] relative itemContent"},D=["id"],M=["id","src","onLoad","onError"],W=["onClick"],B=[f("div",null,"查看详情",-1)],R=e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:b}){var F;const _=a();null==(F=l())||F.appContext.config.globalProperties.$viewerApi,t();const j=s([]),C=s({}),I=s(0),S=s(160),$=s(0),q=s(10),z=s(10),A=s([]),R=s(null),Q=s(0);n((()=>_.isLogin));const U=s(30),N=s(""),O=n((()=>U.value+q.value+150));r();const P=e,V=s();o.on("newData",(e=>{V.value=e}));const H=i({page:1,size:999,rec:1,squareType:P.type,keyword:""});function K(){!function(){const{showName:e=0,showOther:a=0}={};I.value=15*[e,a].filter((e=>e)).length}(),function(){if(!R.value)return;const e=R.value.clientWidth;$.value=Math.floor(e/O.value);const a=e-$.value*O.value,l=($.value-1)*q.value;a-l<0&&($.value-=1);S.value=Math.floor((e-l)/$.value)}();const e=$.value,a=S.value,l=[];X.value.forEach(((t,s)=>{let n=200,r=300;t.fileInfo&&(n=t.fileInfo.width||n,r=t.fileInfo.height||r);const o=r*(a/n)+z.value+I.value,i=C.value[t.id];if(l.length<e)i.style.top="0px",i.style.left=(a+q.value)*s+"px",l.push(o);else{const e=Math.min.apply(null,l),a=l.findIndex((a=>a===e));i.style.top=`${e+0}px`,i.style.left=a*(S.value+q.value)+"px",l[a]+=o}})),Q.value=Math.max(...l)+130}const X=n((()=>V.value?V.value.rows:N.value?j.value.filter((e=>{const{prompt:a}=e;return a.includes(N.value)})):j.value));u(U,(()=>{K()}));let Z=null;async function G(){let e=(await y(H)).data.rows;e.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),j.value=e}u(X,(()=>{X.value.length&&(clearTimeout(Z),Z=setTimeout((()=>{K()}),300))}));const J=n((()=>e=>{let a=200,l=300;return e.fileInfo&&(a=e.fileInfo.width,l=e.fileInfo.height),l/(a/S.value)})),Y=E((function(){K()}),200);return v((async()=>{await G(),K(),window.addEventListener("resize",Y)})),b({handleQuery:e=>{H.keyword="",H.squareType=e,G(),K()},handleSearch:e=>{H.squareType="",H.keyword=e,G(),K()}}),d((()=>{window.removeEventListener("resize",Y)})),(e,a)=>(g(),c("div",L,[f("div",T,[f("div",{id:"wapper",ref_key:"wapperRef",ref:R,class:"wapper",style:p({height:`${Q.value}px`})},[(g(!0),c(h,null,m(X.value,((e,a)=>(g(),c("div",{id:e.id,key:a,ref_for:!0,ref:a=>function(e,a){e&&a&&(C.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${S.value}px`})},[w(k,{name:"img",css:!0},{default:x((()=>[f("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${S.value}px`,height:`${J.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){A.value.push(a.id)}(0,e),onError:a=>function(e,a){A.value.push(a.id)}(0,e)},null,44,M)])),_:2},1024),f("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},B,8,W)],12,D)))),128))],4)])]))}}),Q={style:{padding:"15px 24px 0 24px"},class:"bg-[#F8F9F9] dark:bg-[#111113]"},U={class:"topBox"},N={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},O={class:"relative z-40 transition-300 ease"},P={class:"flex justify-start items-center",ref:"tabListRef"},V=["onClick"],H={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},K={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},X={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},Z={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},G={class:"flex-1 marketBox"},J=A(e({__name:"square",setup(e){const{isMobile:a}=b(),l=s(""),t=s(),r=F(),i=n((()=>"dark"===r.theme)),u=s([]);(async()=>{const e=await S({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""}].concat(e)||$,t.value.handleQuery(l.value)})();s("");const v=s("");function d(e){13==e.keyCode&&t.value.handleSearch(v.value)}return(e,s)=>(g(),c("div",Q,[f("div",U,[_(a)?j("",!0):(g(),c("div",N,[f("div",O,[f("ul",P,[(g(!0),c(h,null,m(u.value,(e=>(g(),c("li",{onClick:a=>{return s=e,l.value=s.value,t.value.handleQuery(s.value),void o.emit("newData","");var s},class:q(["mr-1 ml-1 w-auto select-none cursor-pointer hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-l from-[#10A37F] to-[#10A37F] duration-300 flex rounded-3xl",[e.value===l.value?"text-[#fff] bg-gradient-to-l from-[#10A37F] to-[#10A37F]  dark:text-[#fff]":"bg-[transparent] dark:bg-[transparent]"]])},[f("div",H,z(e.name),1)],10,V)))),256))],512)])])),f("div",K,[i.value?(g(),c("img",X)):(g(),c("img",Z)),C(f("input",{type:"text",onKeydown:d,name:"","onUpdate:modelValue":s[0]||(s[0]=e=>v.value=e),id:"",placeholder:"请输入关键词"},null,544),[[I,v.value]])])]),f("div",G,[w(R,{ref_key:"marketRef",ref:t,type:l.value,keyWord:v.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-9431ea1d"]]);export{J as default};
