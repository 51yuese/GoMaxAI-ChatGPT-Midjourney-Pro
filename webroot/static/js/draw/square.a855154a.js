import{e,R as a,bo as t,W as l,r,j as s,S as n,ac as o,ae as i,A as u,k as d,af as v,O as c,P as f,H as p,a3 as h,a4 as m,ai as y,N as g,a1 as w,a2 as k,T as x,aJ as b,av as E,a5 as j,a0 as _,F as C,an as F,bp as I,a8 as D,$ as S,ad as $}from"../main-33bcbc1f.js";import{I as q}from"../mj-menu/mj-menu.41e6da46.js";import{t as z}from"../throttle/throttle.33f09de3.js";const L={class:"overflow-hidden pr-0 h-full flex flex-col"},M={class:"market overflow-y-auto flex-1 min-h-screen h-[100vh] relative itemContent"},T=["id"],A=["id","src","onLoad","onError"],W=["onClick"],B=e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:b}){var E;const j=a();null==(E=t())||E.appContext.config.globalProperties.$viewerApi,l();const _=r([]),C=r({}),F=r(0),I=r(160),D=r(0),S=r(10),$=r(10),q=r([]),B=r(null),R=r(0);s((()=>j.isLogin));const Q=r(30),N=r(""),O=s((()=>Q.value+S.value+250));n();const P=e,U=r();o.on("newData",(e=>{U.value=e}));const V=i({page:1,size:999,rec:1,squareType:P.type,keyword:""});function H(){!function(){const{showName:e=0,showOther:a=0}={};F.value=15*[e,a].filter((e=>e)).length}(),function(){if(!B.value)return;const e=B.value.clientWidth;D.value=Math.floor(e/O.value);const a=e-D.value*O.value,t=(D.value-1)*S.value;a-t<0&&(D.value-=1);I.value=Math.floor((e-t)/D.value)}();const e=D.value,a=I.value,t=[];J.value.forEach(((l,r)=>{let s=200,n=300;l.fileInfo&&(s=l.fileInfo.width||s,n=l.fileInfo.height||n);const o=n*(a/s)+$.value+F.value,i=C.value[l.id];if(t.length<e)i.style.top="0px",i.style.left=(a+S.value)*r+"px",t.push(o);else{const e=Math.min.apply(null,t),a=t.findIndex((a=>a===e));i.style.top=`${e+0}px`,i.style.left=a*(I.value+S.value)+"px",t[a]+=o}})),R.value=Math.max(...t)+130}const J=s((()=>U.value?U.value.rows:N.value?_.value.filter((e=>{const{prompt:a}=e;return a.includes(N.value)})):_.value));u(Q,(()=>{H()}));let K=null;async function G(){let e=(await y(V)).data.rows;e.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),_.value=e}u(J,(()=>{J.value.length&&(clearTimeout(K),K=setTimeout((()=>{H()}),300))}));const X=s((()=>e=>{let a=200,t=300;return e.fileInfo&&(a=e.fileInfo.width,t=e.fileInfo.height),t/(a/I.value)})),Y=z((function(){H()}),200);return d((async()=>{await G(),H(),window.addEventListener("resize",Y)})),b({handleQuery:e=>{V.keyword="",V.squareType=e,G(),H()},handleSearch:e=>{V.squareType="",V.keyword=e,G(),H()}}),v((()=>{window.removeEventListener("resize",Y)})),(e,a)=>(g(),c("div",L,[f("div",M,[f("div",{id:"wapper",ref_key:"wapperRef",ref:B,class:"wapper",style:p({height:`${R.value}px`})},[(g(!0),c(h,null,m(J.value,((e,t)=>(g(),c("div",{id:e.id,key:t,ref_for:!0,ref:a=>function(e,a){e&&a&&(C.value[a.id]=e)}(a,e),class:"wapper-item",style:p({width:`${I.value}px`})},[w(x,{name:"img",css:!0},{default:k((()=>[f("img",{id:e.id,class:"item-file rounded-sm",style:p({width:`${I.value}px`,height:`${X.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){q.value.push(a.id)}(0,e),onError:a=>function(e,a){q.value.push(a.id)}(0,e)},null,44,A)])),_:2},1024),f("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},a[0]||(a[0]=[f("div",null,"查看详情",-1)]),8,W)],12,T)))),128))],4)])]))}}),R={style:{padding:"15px 24px 0 24px"},class:"bg-[#F8F9F9] dark:bg-[#181818]"},Q={class:"topBox"},N={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},O={class:"relative z-40 transition-300 ease"},P={class:"flex justify-start items-center",ref:"tabListRef"},U=["onClick"],V={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},H={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},J={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},K={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},G={class:"flex-1 marketBox"},X=$(e({__name:"square",setup(e){const{isMobile:a}=b(),t=r(""),l=r(),n=E(),i=s((()=>"dark"===n.theme)),u=r([]);(async()=>{const e=await I({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""},{name:"我的收藏",value:"fav"}].concat(e)||q,l.value.handleQuery(t.value)})();r("");const d=r("");function v(e){13==e.keyCode&&l.value.handleSearch(d.value)}return(e,r)=>(g(),c("div",R,[f("div",Q,[j(a)?_("",!0):(g(),c("div",N,[f("div",O,[f("ul",P,[(g(!0),c(h,null,m(u.value,(e=>(g(),c("li",{onClick:a=>{return r=e,t.value=r.value,l.value.handleQuery(r.value),void o.emit("newData","");var r},class:D(["mr-1 ml-1 w-auto select-none cursor-pointer bg-white hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-r hover:from-[#957DF4] hover:to-[#3C69E7] dark:hover:from-transparent dark:hover:to-transparent dark:border dark:border-[transparent] dark:hover:border-[#3E6AE7] duration-300 flex rounded-lg",[e.value===t.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#3E6AE7] bg-[#dae7e6] border-0 dark:border dark:border-[#3E6AE7]":"bg-white dark:bg-transparent"]])},[f("div",V,S(e.name),1)],10,U)))),256))],512)])])),f("div",H,[i.value?(g(),c("img",J)):(g(),c("img",K)),C(f("input",{type:"text",onKeydown:v,name:"","onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),id:"",placeholder:"请输入关键词"},null,544),[[F,d.value]])])]),f("div",G,[w(B,{ref_key:"marketRef",ref:l,type:t.value,keyWord:d.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-b7b9e883"]]);export{X as default};
