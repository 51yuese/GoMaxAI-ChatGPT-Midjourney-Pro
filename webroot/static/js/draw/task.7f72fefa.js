import{M as a}from"../index/index.4f774309.js";import{e,r as t,q as r,aZ as o,w as s,x as d,B as n,a2 as i,z as l,F as u,E as c,O as v,at as b,ax as k,aw as m,av as g,n as p,au as f,_ as w}from"../main-4156cf5e.js";import{a as F}from"../index/index.27c727e8.js";import"../draw-fail/draw-fail.ad8fd01b.js";import"../index/index.5b75f753.js";import"../index/index.745d5eac.js";import"./draw.a81c0f1a.js";import"../HeartOutline/HeartOutline.79c6c696.js";import"../Popconfirm/Popconfirm.c9db7ff9.js";const x={class:"mj-task-view bg-[#F8F9F9] dark:bg-[#111113]"},h={class:"view-title"},A=w(e({__name:"task",setup(e){let w=[];const A=t(!1),j=t(!1),E=t([]);let I=null;const T=async function(){I&&window.clearTimeout(I);try{(await f({jobIds:w.join()})).data.forEach((a=>{const e=E.value.findIndex((e=>e.id===a.id));-1!==e&&E.value.splice(e,1,a),a.status>=3&&(w=w.filter((e=>e!==a.jobId)))})),w.length?I=setTimeout((()=>T()),3e3):I&&window.clearTimeout(I)}catch(a){I=setTimeout((()=>T()),3e3)}},_={page:1,size:20},C=async function(){try{j.value=!0;const a=await b({..._,status:y.value>=0?y.value:0,favorite:1==y.value?y.value:0});1===_.page?E.value=a.data.rows:E.value=E.value.concat(a.data.rows),w=E.value.filter((a=>[1,2].includes(a.status))).map((a=>a.jobId)),w.length&&T(),a.data.rows.length<_.size&&(A.value=!0),j.value=!1}catch(a){j.value=!1,1!==_.page&&(_.page=_.page-1)}},y=t(0),B=function(a){y.value=a,A.value=!1,_.page=1,C()},M=async function(a){let e=null;switch(a.type){case F.TEXT_TO_IMAGE:case F.IMAGE_ACTION:e=await g(a);break;case F.IMAGE_MIX_IMAGE:case F.IMAGE_TO_TEXT:e=await m(a);break;case F.INSIGHT_FACE:e=await k(a)}if(e){const a=e.data;E.value.find((e=>e.id===a.id))||(E.value.push(a),p((()=>{var a;null==(a=G.value)||a.scrollTo({top:0,behavior:"smooth"})}))),a.status<3&&!w.includes(a.jobId)&&(w.push(a.jobId),T())}},G=t(),H=function(a){const e=a.target,{scrollTop:t,offsetHeight:r,scrollHeight:o}=e;o-r-t<=40&&(A.value||j.value||(_.page=_.page+1,C()))};return r((()=>{var a;C(),null==(a=G.value)||a.addEventListener("scroll",H)})),o((()=>{var a;null==(a=G.value)||a.removeEventListener("scroll",H)})),(e,t)=>(s(),d("div",x,[n("div",h,[n("div",{class:i(["title-btn",0===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[0]||(t[0]=a=>B(0))},l(e.$t("common.all")),3),n("div",{class:i(["title-btn",2===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[1]||(t[1]=a=>B(2))},l(e.$t("draw.useLoading")),3),n("div",{class:i(["title-btn",3===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[2]||(t[2]=a=>B(3))},l(e.$t("draw.finished")),3),n("div",{class:i(["title-btn",4===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[3]||(t[3]=a=>B(4))},l(e.$t("draw.failed")),3),n("div",{class:i(["title-btn",1===y.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#23A559] bg-[#dae7e6] border-0 dark:border dark:border-[#23A559]":"dark:bg-[#19191B] bg-[#F8F9F9]"]),onClick:t[4]||(t[4]=a=>B(1))},l(e.$t("common.myCollection")),3)]),n("div",{class:"main-view",ref_key:"scrollView",ref:G},[(s(!0),d(u,null,c(E.value,((e,t)=>(s(),v(a,{key:e.jobId,task:e,onRemove:()=>function(a){E.value.splice(a,1)}(t),onAddTask:M,type:"task"},null,8,["task","onRemove"])))),128))],512)]))}}),[["__scopeId","data-v-7f2755ae"]]);export{A as default};
