import{e,k as a,ar as t,p as l,r,g as s,l as n,J as o,a$ as i,Q as u,q as d,aG as v,w as c,x as f,B as p,G as h,F as m,E as y,C as g,D as w,bm as k,bn as x,bo as b,M as E,a7 as _,y as z,I as C,z as D,A as I,T as j,U as q,bp as B,_ as T}from"../main-be2ae0f3.js";import{I as $}from"../mj-menu/mj-menu.41e6da46.js";import{t as F}from"../throttle/throttle.33f09de3.js";const L={class:"overflow-hidden pr-0 h-full flex flex-col"},M={class:"market overflow-y-auto flex-1 min-h-screen h-[100vh] relative itemContent"},S=["id"],A=["id","src","onLoad","onError"],Q=["onClick"],W=e({__name:"market",props:{type:{type:String,required:!1,default:"all"},keyWord:{type:String,default:""}},setup(e,{expose:E}){var _;const z=a();null==(_=t())||_.appContext.config.globalProperties.$viewerApi,l();const C=r([]),D=r({}),I=r(0),j=r(160),q=r(0),B=r(10),T=r(10),$=r([]),W=r(null),R=r(0);s((()=>z.isLogin));const U=r(30),G=r(""),V=s((()=>U.value+B.value+250));n();const J=e,K=r();o.on("newData",(e=>{K.value=e}));const N=i({page:1,size:999,rec:1,squareType:J.type,keyword:""});function O(){!function(){const{showName:e=0,showOther:a=0}={};I.value=15*[e,a].filter((e=>e)).length}(),function(){if(!W.value)return;const e=W.value.clientWidth;q.value=Math.floor(e/V.value);const a=e-q.value*V.value,t=(q.value-1)*B.value;a-t<0&&(q.value-=1);j.value=Math.floor((e-t)/q.value)}();const e=q.value,a=j.value,t=[];P.value.forEach(((l,r)=>{let s=200,n=300;l.fileInfo&&(s=l.fileInfo.width||s,n=l.fileInfo.height||n);const o=n*(a/s)+T.value+I.value,i=D.value[l.id];if(t.length<e)i.style.top="0px",i.style.left=(a+B.value)*r+"px",t.push(o);else{const e=Math.min.apply(null,t),a=t.findIndex((a=>a===e));i.style.top=`${e+0}px`,i.style.left=a*(j.value+B.value)+"px",t[a]+=o}})),R.value=Math.max(...t)+130}const P=s((()=>K.value?K.value.rows:G.value?C.value.filter((e=>{const{prompt:a}=e;return a.includes(G.value)})):C.value));u(U,(()=>{O()}));let H=null;async function X(){let e;e="fav"===N.squareType?await x({page:N.page,size:N.size}):await b(N);let a=e.data.rows;a.forEach((e=>{e.src=e.imageUrl+"?imageView2/0/w/400/q/85"})),C.value=a}u(P,(()=>{P.value.length&&(clearTimeout(H),H=setTimeout((()=>{O()}),300))}));const Y=s((()=>e=>{let a=200,t=300;return e.fileInfo&&(a=e.fileInfo.width,t=e.fileInfo.height),t/(a/j.value)})),Z=F((function(){O()}),200);return d((async()=>{await X(),O(),window.addEventListener("resize",Z)})),E({handleQuery:e=>{N.keyword="",N.squareType=e,X(),O()},handleSearch:e=>{N.squareType="",N.keyword=e,X(),O()}}),v((()=>{window.removeEventListener("resize",Z)})),(e,a)=>(c(),f("div",L,[p("div",M,[p("div",{id:"wapper",ref_key:"wapperRef",ref:W,class:"wapper",style:h({height:`${R.value}px`})},[(c(!0),f(m,null,y(P.value,((e,t)=>(c(),f("div",{id:e.id,key:t,ref_for:!0,ref:a=>function(e,a){e&&a&&(D.value[a.id]=e)}(a,e),class:"wapper-item",style:h({width:`${j.value}px`})},[g(k,{name:"img",css:!0},{default:w((()=>[p("img",{id:e.id,class:"item-file rounded-sm",style:h({width:`${j.value}px`,height:`${Y.value(e)}px`}),src:e.src,loading:"lazy",onLoad:a=>function(e,a){$.value.push(a.id)}(0,e),onError:a=>function(e,a){$.value.push(a.id)}(0,e)},null,44,A)])),_:2},1024),p("div",{class:"menu",onClick:a=>function(e){o.emit("Details",!0),o.emit("DetailsData",e)}(e)},a[0]||(a[0]=[p("div",null,"查看详情",-1)]),8,Q)],12,S)))),128))],4)])]))}}),R={style:{padding:"15px 24px 0 24px"},class:"bg-[#2B2D31] dark:bg-[#2B2D31]"},U={class:"topBox"},G={key:0,class:"flex w-full flex-j mb-2 items-center overflow-x-hidden"},V={class:"relative z-40 transition-300 ease"},J={class:"flex justify-start items-center",ref:"tabListRef"},K=["onClick"],N={class:"pl-3 pr-3 pt-1 pb-1 whitespace-nowrap"},O={class:"searchBox bg-[#F8F9F9] dark:bg-[#19191B]"},P={key:0,src:"/static/svg/mjSearch-2135ed48.svg",alt:""},H={key:1,src:"/static/svg/mjSearch copy-4bcef775.svg",alt:""},X={class:"flex-1 marketBox"},Y=T(e({__name:"square",setup(e){const{isMobile:a}=E(),t=r(""),l=r(),n=_(),i=s((()=>"dark"===n.theme)),u=r([]);(async()=>{const e=await B({page:1,size:100}).then((e=>e.data.rows));u.value=[{name:"全部",value:""},{name:"我的收藏",value:"fav"}].concat(e)||$,l.value.handleQuery(t.value)})();r("");const d=r("");function v(e){13==e.keyCode&&l.value.handleSearch(d.value)}return(e,r)=>(c(),f("div",R,[p("div",U,[z(a)?I("",!0):(c(),f("div",G,[p("div",V,[p("ul",J,[(c(!0),f(m,null,y(u.value,(e=>(c(),f("li",{onClick:a=>{return r=e,t.value=r.value,l.value.handleQuery(r.value),void o.emit("newData","");var r},class:C(["mr-1 ml-1 w-auto select-none cursor-pointer bg-white hover:dark:text-[#fff] hover:text-[#fff] hover:bg-gradient-to-r hover:from-[#957DF4] hover:to-[#3C69E7] dark:hover:from-transparent dark:hover:to-transparent dark:border dark:border-[transparent] dark:hover:border-[#3E6AE7] duration-300 flex rounded-lg",[e.value===t.value?"bg-gradient-to-r from-[#957DF4] to-[#3C69E7] dark:from-transparent dark:to-transparent text-white dark:text-[#3E6AE7] bg-[#dae7e6] border-0 dark:border dark:border-[#3E6AE7]":"bg-white dark:bg-transparent"]])},[p("div",N,D(e.name),1)],10,K)))),256))],512)])])),p("div",O,[i.value?(c(),f("img",P)):(c(),f("img",H)),j(p("input",{type:"text",onKeydown:v,name:"","onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),id:"",placeholder:"请输入关键词"},null,544),[[q,d.value]])])]),p("div",X,[g(W,{ref_key:"marketRef",ref:l,type:t.value,keyWord:d.value},null,8,["type","keyWord"])])]))}}),[["__scopeId","data-v-507fe2ed"]]);export{Y as default};
