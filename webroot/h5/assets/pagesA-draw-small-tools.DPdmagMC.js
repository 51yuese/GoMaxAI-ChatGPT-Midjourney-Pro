import{_ as e,q as a,u as l,r as s,s as t,a7 as o,v as u,a0 as i,o as n,B as r,m as d,G as c,p as m,W as f,a as p,H as v,b as _,w as g,d as k,e as w,t as y,g as x,L as b,J as A,I as h,M as V,f as I,a9 as C,h as F,a5 as T,a6 as U,a1 as N,U as E,X as j,Y as B,c as D,a4 as S,Q as W,i as Y,j as R,aW as L,k as z,a8 as O,b6 as q,F as Q,K as X}from"./index-5HZnFt5a.js";import{_ as H}from"./uv-tabs.CxaWShil.js";import{d as P,_ as G}from"./draw.CUuw-SnE.js";import{a as J}from"./index.BIXFsUHK.js";import{_ as Z}from"./uv-number-box.SS3S8ft2.js";import{_ as K}from"./uv-picker.B_83EYu7.js";import{_ as M,a as $}from"./diamonds.2zSysToh.js";import{_ as ee}from"./is-vip.81A82wTA.js";import{_ as ae}from"./video-create-fail.379UvUbK.js";import"./uv-badge.vue_vue_type_style_index_0_scoped_d4ba6c2a_lang.C03jWKDg.js";import"./uv-loading-icon.D2OVaaMI.js";const le=e({__name:"tool-form",props:{taskId:{type:[Number,String],default:""}},emits:["change","pageChange"],setup(e,{emit:O}){const q=a(),Q=e,{t:X}=l(),H=s(null),G=s({}),J=O,ae=t((()=>!!q.token)),le=t((()=>{const e=o("userInfo")||{};return 1===e.lifetimeVip||e.vipExpire&&new Date(e.vipExpire)>new Date})),se=t((()=>le.value&&-1===G.value.vipFreeNum)),te=t((()=>{const e=G.value;return le.value&&e.vipFreeNum>0&&e.vipFreeNum>e.freeUsed}));u((()=>Q.taskId),(e=>{i(e)||ie()}));const oe=s(!1),ue=s({isVipFree:!1,vipFreeNum:0,freeUsed:0,modelNum:0,config:[]}),ie=async()=>{if(i(Q.taskId))return;const{data:e}=await P.getWorkFlowDetail(Q.taskId),a=C(e);G.value=a,J("pageChange",a),ue.value={isVipFree:-1===a.vipFreeNum,vipFreeNum:a.vipFreeNum,freeUsed:a.freeUsed,modelNum:a.deduct,config:a.config};const l=a.config||[];l.length>0&&(xe.value=l[0]),ce().then()},ne=s(),re=s(),de=s([]),ce=async()=>{const{workflowId:e}=G.value,{data:a}=await P.getWorkFlowForm(e);ne.value=null==a?void 0:a.consume,re.value=null==a?void 0:a.currentVersionId;const l=(null==a?void 0:a.fields)||[];for(let s=0;s<l.length;s++)3===l[s].type&&(l[s].exampleValue="");de.value=l},me=async e=>{if(5===e.type){const{data:a}=await P.getWorkFlowModel(e.exampleValue),l=a||[],s=l.length>0?l[0]:{};e.name=s.name}},fe=()=>{J("change",{id:"res",index:1})},pe=async e=>{e.exampleValue=await F.upload(1)},ve=s(null),_e=s([]),ge=s({}),ke=e=>{var a;try{const l=(null==(a=null==e?void 0:e.rule)?void 0:a.selectOptions)||[];let s="";for(let a=0;a<l.length;a++)l[a].value===e.exampleValue&&(s=l[a].label);return s}catch(l){return e.exampleValue}},we=({value:e})=>{const a=ge.value;a.exampleValue=e[0].value,a.name=e[0].label},ye=()=>{H.value.open()},xe=s({title:"",templateID:"",previewPic:""}),be=async()=>{var e;if(!ae.value)return void T();if(!(await U(G.value,Ae.value)))return;const a=null==(e=xe.value)?void 0:e.templateID,l=de.value;for(let t=0;t<l.length;t++)l[t].value=N(l[t].exampleValue);const s={workflowId:G.value.id,inputs:l};i(a)||(s.presetId=a);l.some((e=>e.required&&!e.exampleValue))?E({title:X("draw.smallTools.form.required"),icon:"none"}):(j({title:"加载中",mask:!0}),await P.workFlowTaskSubmit(s).then((e=>{B(),200===e.code&&(E({title:X("app.http.success"),icon:"success"}),fe())})).catch((e=>{B()})))},Ae=s([]);return n((()=>{ie()})),r((()=>{(async()=>{const{data:e}=await D.getVipLeavel();Ae.value=S(e)})()})),(e,a)=>{const l=W,s=Y,t=R,o=d(m("uv-icon"),c),u=L,i=d(m("uv-number-box"),Z),n=z,r=d(m("uv-popup"),f),C=d(m("uv-picker"),K);return p(),v(A,null,[ue.value.config&&ue.value.config.length>0?(p(),_(s,{key:0,class:"form-item",onClick:ye},{default:g((()=>[k(s,{class:"title-box"},{default:g((()=>[k(l,{class:"will"},{default:g((()=>[w("*")])),_:1}),k(l,{class:"title"},{default:g((()=>[w(y(x(X)("draw.smallTools.form.title1")),1)])),_:1})])),_:1}),k(s,{class:"form-li draw-temp"},{default:g((()=>[k(t,{src:xe.value.templateID?xe.value.previewPic:"/pagesA/static/draw-temp.png",class:"img"},null,8,["src"]),k(s,{class:"content"},{default:g((()=>[k(l,{class:"text"},{default:g((()=>[w(y(xe.value.templateID?xe.value.title:x(X)("draw.smallTools.form.text1")),1)])),_:1}),k(o,{name:"arrow-right",bold:"",size:"22",color:"rgba(51, 51, 51, 0.5)"})])),_:1})])),_:1})])),_:1})):b("",!0),xe.value.templateID?(p(!0),v(A,{key:1},h(de.value,((e,a)=>(p(),v(A,{key:a},[3===e.type?(p(),_(s,{key:0,class:"form-item"},{default:g((()=>[k(s,{class:"title-box"},{default:g((()=>[e.required?(p(),_(l,{key:0,class:"will"},{default:g((()=>[w("*")])),_:1})):b("",!0),k(l,{class:"title"},{default:g((()=>[w(y(e.inputName),1)])),_:2},1024)])),_:2},1024),k(s,{class:"form-li upload",onClick:a=>pe(e)},{default:g((()=>[k(s,{class:V(["upload-box",e.exampleValue?"is-img":""])},{default:g((()=>[e.exampleValue?(p(),_(t,{key:0,class:"image",src:e.exampleValue,mode:"aspectFill"},null,8,["src"])):(p(),v(A,{key:1},[k(t,{src:"/h5/assets/upload-YqtiS1fD.svg",class:"img"}),k(s,{class:"text"},{default:g((()=>[w(y(x(X)("draw.smallTools.form.upload")),1)])),_:1})],64))])),_:2},1032,["class"])])),_:2},1032,["onClick"])])),_:2},1024)):b("",!0)],64)))),128)):b("",!0),!ue.value.config||ue.value.config.length<=0?(p(!0),v(A,{key:2},h(de.value,((e,a)=>(p(),_(s,{class:"form-item",key:a},{default:g((()=>[k(s,{class:"title-box"},{default:g((()=>[e.required?(p(),_(l,{key:0,class:"will"},{default:g((()=>[w("*")])),_:1})):b("",!0),k(l,{class:"title"},{default:g((()=>[w(y(e.inputName),1)])),_:2},1024)])),_:2},1024),1===e.type&&246!=e.nodeId?(p(),_(s,{key:0,class:"form-li inputs"},{default:g((()=>[k(u,{class:"input",type:"text",placeholder:x(X)("draw.smallTools.form.please"),modelValue:e.exampleValue,"onUpdate:modelValue":a=>e.exampleValue=a},null,8,["placeholder","modelValue","onUpdate:modelValue"])])),_:2},1024)):b("",!0),1===e.type&&246==e.nodeId?(p(),_(s,{key:1,class:"form-li inputs",onClick:a=>(e=>{var a;ge.value=e;const l=(null==(a=null==e?void 0:e.rule)?void 0:a.selectOptions)||[];_e.value=[l],ve.value.open()})(e)},{default:g((()=>[k(s,{class:"content"},{default:g((()=>[e.exampleValue?(p(),_(l,{key:0,class:"name"},{default:g((()=>[w(y(e.name||ke(e)),1)])),_:2},1024)):(p(),_(l,{key:1,class:"text"},{default:g((()=>[w(y(x(X)("draw.smallTools.form.select"))+y(e.exampleValue),1)])),_:2},1024))])),_:2},1024),k(o,{name:"arrow-right",bold:"",size:"22",color:"rgba(51, 51, 51, 0.5)"})])),_:2},1032,["onClick"])):b("",!0),2===e.type?(p(),_(s,{key:2,class:"form-li number"},{default:g((()=>[k(i,{modelValue:e.exampleValue,"onUpdate:modelValue":a=>e.exampleValue=a,min:0,step:.01},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)):b("",!0),3===e.type?(p(),_(s,{key:3,class:"form-li upload",onClick:a=>pe(e)},{default:g((()=>[k(s,{class:V(["upload-box",e.exampleValue?"is-img":""])},{default:g((()=>[e.exampleValue?(p(),_(t,{key:0,class:"image",src:e.exampleValue,mode:"aspectFill"},null,8,["src"])):(p(),v(A,{key:1},[k(t,{src:"/h5/assets/upload-YqtiS1fD.svg",class:"img"}),k(s,{class:"text"},{default:g((()=>[w(y(x(X)("draw.smallTools.form.upload")),1)])),_:1})],64))])),_:2},1032,["class"])])),_:2},1032,["onClick"])):b("",!0),5===e.type?(p(),_(s,{key:4,class:"form-li inputs",onClick:e=>{}},{default:g((()=>[k(s,{class:"content","data-model":me(e)},{default:g((()=>[e.exampleValue?(p(),_(l,{key:0,class:"name"},{default:g((()=>[w(y(e.name||ke(e)),1)])),_:2},1024)):(p(),_(l,{key:1,class:"text"},{default:g((()=>[w(y(x(X)("draw.smallTools.form.select.model")),1)])),_:1}))])),_:2},1032,["data-model"]),k(o,{name:"arrow-right",bold:"",size:"22",color:"rgba(51, 51, 51, 0.5)"})])),_:2},1032,["onClick"])):b("",!0)])),_:2},1024)))),128)):b("",!0),k(s,{class:"ai-tips"},{default:g((()=>[k(l,{class:"text"},{default:g((()=>[w(y(x(X)("app.ai.tips.text")),1)])),_:1}),k(l,{class:"href"},{default:g((()=>[w(y(x(X)("app.ai.tips.href")),1)])),_:1})])),_:1}),k(s,{class:"footer"},{default:g((()=>[k(s,{class:"create-box"},{default:g((()=>[k(s,{class:"works-box",onClick:a[0]||(a[0]=e=>fe())},{default:g((()=>[k(t,{class:"image",src:M}),k(s,{class:"works"},{default:g((()=>[w(y(x(X)("video.index.params.works")),1)])),_:1})])),_:1}),k(n,{class:"btn-primary-creat",onClick:be},{default:g((()=>[G.value.isVipUsed?(p(),_(t,{key:0,class:"vip-icon",src:ee})):b("",!0),oe.value?(p(),_(l,{key:1},{default:g((()=>[w(y(x(X)("video.index.model.err")),1)])),_:1})):ae.value?se.value?(p(),v(A,{key:3},[I("span",null,y(x(X)("video.index.model.btn")),1),I("span",{class:"text-num"},y(x(X)("chat.index.model.vipFree")),1)],64)):te.value?(p(),v(A,{key:4},[I("span",null,y(x(X)("video.index.model.btn")),1),I("span",{class:"text-num"},y(x(X)("video.index.model.free"))+y(G.value.vipFreeNum-G.value.freeUsed)+y(x(X)("video.index.model.time")),1)],64)):G.value?(p(),v(A,{key:5},[k(t,{src:$,class:"diamonds"}),I("span",{style:{margin:"2rpx 18rpx 0 6rpx","font-size":"28rpx"}},y(G.value.deduct),1),I("span",null,y(x(X)("video.index.model.btn")),1)],64)):(p(),_(l,{key:6},{default:g((()=>[w(y(x(X)("video.index.model.create")),1)])),_:1})):(p(),_(l,{key:2},{default:g((()=>[w(y(x(X)("video.index.model.creat")),1)])),_:1}))])),_:1})])),_:1})])),_:1}),k(r,{ref_key:"popupRef",ref:H,mode:"bottom",round:"20",closeable:""},{default:g((()=>[k(s,{class:"popup-draw-temp-content"},{default:g((()=>[k(s,{class:"title"},{default:g((()=>[w(y(x(X)("draw.smallTools.popup.title")),1)])),_:1}),k(s,{class:"body-content"},{default:g((()=>[(p(!0),v(A,null,h(ue.value.config,(e=>(p(),_(s,{class:"item",onClick:a=>(e=>{xe.value=e,H.value.close()})(e)},{default:g((()=>[k(s,{class:"img"},{default:g((()=>[k(t,{class:"image",src:e.previewPic},null,8,["src"])])),_:2},1024),k(s,{class:"name"},{default:g((()=>[w(y(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])))),256))])),_:1})])),_:1})])),_:1},512),k(C,{ref_key:"pickerRef",ref:ve,"key-name":"label",columns:_e.value,onConfirm:we},null,8,["columns"])],64)}}},[["__scopeId","data-v-0e2a8efb"]]),se=e({__name:"tool-res",setup(e){const{t:a}=l(),t=s([]),o=s([]),u=s([]),r=async()=>{var e,a;const{data:l}=await P.getDrawList({page:1,size:80,botType:"WORKFLOW"}),s=l.rows||[];let i=s.filter((e=>1===e.status||2===e.status));for(let t=0;t<i.length;t++)i[t].workflowName=(null==(e=u.value.find((e=>e.id===i[t].workflowId)))?void 0:e.name)||"";t.value=i;let n=s.filter((e=>1!==e.status&&2!==e.status));for(let t=0;t<n.length;t++)n[t].workflowName=(null==(a=u.value.find((e=>e.id===n[t].workflowId)))?void 0:a.name)||"";o.value=n},d=s(null),c=async()=>{const e=t.value.map((e=>e.jobId)).join(",");if(i(e))return clearTimeout(d.value),void(d.value=null);const{data:a}=await P.getDetailByIds(e);let l=a||[],s=!1;for(let t=0;t<l.length;t++)1!==l[t].status&&2!==l[t].status&&(s=!0);s&&await r(),d.value=setTimeout((()=>{c()}),1e3)},m=async()=>{j(),await(async()=>{const{data:e}=await P.getWorkFlowPage();u.value=(null==e?void 0:e.rows)||[]})(),await r(),c().then(),B()};return n((()=>{m()})),O((()=>{clearTimeout(d.value),d.value=null})),(e,l)=>{const s=W,u=Y,i=R;return p(),v(A,null,[k(u,{class:"draw-generation"},{default:g((()=>[(p(!0),v(A,null,h(t.value,((e,l)=>(p(),_(u,{class:"item-li",key:l},{default:g((()=>[k(u,{class:"header"},{default:g((()=>[k(s,{class:"time"},{default:g((()=>[w(y(e.createdAt),1)])),_:2},1024),k(s,{class:"type"},{default:g((()=>[w("#"+y(x(a)("draw.smallTools.res.type")),1)])),_:1}),k(s,{class:"name"},{default:g((()=>[w(y(e.workflowName),1)])),_:2},1024)])),_:2},1024),k(u,{class:"content"},{default:g((()=>[k(i,{class:"bg",src:"/h5/assets/draw-generation-bg-DEThtgTl.png"}),k(u,{class:"box"},{default:g((()=>[k(u,{class:"loading-box"},{default:g((()=>[k(u,{class:"loading"})])),_:1}),k(u,{class:"text"},{default:g((()=>[w(y(1===e.status||2===e.status?x(a)("draw.smallTools.res.loading"):x(a)("draw.smallTools.res.exception")),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),k(u,{class:"draw-completed"},{default:g((()=>[k(u,{class:"title"},{default:g((()=>[w(y(x(a)("draw.smallTools.res.completed")),1)])),_:1}),k(u,{class:"item-ul"},{default:g((()=>[(p(!0),v(A,null,h(o.value,((e,l)=>(p(),_(u,{class:"item-li",key:l},{default:g((()=>[k(u,{class:"header"},{default:g((()=>[k(s,{class:"time"},{default:g((()=>[w(y(e.createdAt),1)])),_:2},1024),k(s,{class:"type"},{default:g((()=>[w("#"+y(x(a)("draw.smallTools.res.type")),1)])),_:1}),k(s,{class:"name"},{default:g((()=>[w(y(e.workflowName),1)])),_:2},1024)])),_:2},1024),k(u,{class:"content"},{default:g((()=>[3===e.status?(p(),_(i,{key:0,class:"image",src:e.imageUrl,mode:"aspectFill",onClick:a=>{return l=e.imageUrl,void q({current:0,urls:[l]});var l}},null,8,["src","onClick"])):b("",!0),4===e.status?(p(),_(u,{key:1,class:"body"},{default:g((()=>[k(u,{style:{"text-align":"center"}},{default:g((()=>[k(i,{class:"status-icon",src:ae}),k(u,{class:"fail"},{default:g((()=>[w(y(x(a)("music.index.task.fail")),1)])),_:1})])),_:1})])),_:1})):b("",!0),5===e.status?(p(),_(u,{key:2,class:"body"},{default:g((()=>[k(u,{style:{"text-align":"center"}},{default:g((()=>[k(i,{class:"status-icon",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAF6SURBVEiJ7ZbPUcJAFMa/9xLHI5QQOoAOLAEqEBsgyZEkapxAOC5agXaAFSAdpAPpQD0r+zwIMWEyQ1bx4uQ7Zff9+b3JbiYfwVCTVHkQvgYAMC2i8ejCpJ5NgQC7ILRBaENkGMeqbVJN8Uw5lsawdsEOmEvmIvJ2cEzwyzvrR9sWXoLgmEy5N4JHRAezBIAt7DFAi5/DTEWLfLQkUWdk8XK7HEaB+/AXSLtOUjxTzolYSrBZRYE/L8aSVPUZ1jlkcxOGflaMTdI7BWhEgefv9mrdUlvIFUgfYLV/KwmsBNIXslRxfzpVXUA8gLwkVX0jYOlWnqLWZ6D1dx6BW2bAI6oBNsAG2AAb4H8Fai2r7eM6HvvrYoxAGQCIbFalIqv6N1YJFEGnuL4K/XsS3YsCt7OfGwajAYnuXYZ+XG6CblXvak8jeAVRBuisjgUsNSRqEdj5cgi5co9U8neT9PYZ+I1lrNYH6c7uKEqvlEQPAHo6IisT6EHx3D8BdxmCv/fuS3UAAAAASUVORK5CYII="}),k(u,{class:"fail a"},{default:g((()=>[w(y(x(a)("draw.smallTools.res.cancelled")),1)])),_:1})])),_:1})])),_:1})):b("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})],64)}}},[["__scopeId","data-v-2d920963"]]),te=e({__name:"small-tools",setup(e){const{t:a}=l(),t=s("");r((({id:e})=>{t.value=N(e)}));const o=[{id:"form",name:a("draw.smallTools.tabs.name1")},{id:"res",name:a("draw.smallTools.tabs.name2")}],u=s(0),i=s("form"),n=({id:e,index:a})=>{i.value=e,u.value=a},f=s(""),v=e=>{f.value=N(e.name)};return(e,a)=>{const l=Q("ai-bindphone"),s=Q("ai-privacy"),r=d(m("uv-icon"),c),x=Y,A=d(m("uv-tabs"),H),h=d(m("uv-sticky"),G);return p(),_(x,{class:"page-draw-tool small"},{default:g((()=>[k(l,{ref:"aiPrivacyRef"},null,512),k(s,{ref:"aiPrivacyRef"},null,512),k(J,null,{left:g((()=>[k(r,{name:"arrow-left",bold:"",size:"22",color:"#000",onClick:a[0]||(a[0]=a=>e.$tools.back())})])),center:g((()=>[k(x,{class:"site-name"},{default:g((()=>[w(y(f.value),1)])),_:1})])),_:1}),k(h,null,{default:g((()=>[k(x,{class:"apps-tabs"},{default:g((()=>[k(A,{list:o,onChange:n,current:u.value,scrollable:!1,lineWidth:60,activeStyle:{color:"#726AFB",fontSize:"32rpx",fontWeight:500},inactiveStyle:{color:"#1C2023",fontSize:"28rpx"},lineColor:"linear-gradient(90deg, #574FFE 0%, #726AFB 100%)"},null,8,["current"])])),_:1})])),_:1}),k(x,{class:"scroll-inner",style:X({height:e.$tools.height().contentHeight-52+"px"})},{default:g((()=>["form"===i.value?(p(),_(le,{key:0,taskId:t.value,onChange:n,onPageChange:v},null,8,["taskId"])):b("",!0),"res"===i.value?(p(),_(se,{key:1})):b("",!0)])),_:1},8,["style"])])),_:1})}}},[["__scopeId","data-v-cbe2c96e"]]);export{te as default};
