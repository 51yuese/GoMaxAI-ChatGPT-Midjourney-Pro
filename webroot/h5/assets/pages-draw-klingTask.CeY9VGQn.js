import{_ as e,u as a,r as l,C as t,B as s,a8 as i,F as o,m as n,p as c,b as r,w as u,a0 as d,G as p,i as f,a as m,d as v,e as g,t as k,g as _,L as h,T as y,K as x,H as w,I as b,J as j,a9 as C,ay as $,U as T,av as z,V as F,j as R}from"./index-5HZnFt5a.js";import{_ as U}from"./uv-loading-icon.D2OVaaMI.js";import{_ as q}from"./uv-swiper.Ce5SlXA_.js";import{_ as B}from"./create-again-1.BJYmOOmv.js";import{a as D}from"./index.BIXFsUHK.js";import{u as I}from"./page.BP1yyV07.js";import{m as P}from"./mj.CpUrlHRv.js";const H=e({__name:"klingTask",setup(e){const{t:H}=a(),J=I(),A=l(!1),N=l(""),O=l({}),S=l(null),E=l(""),G=l(!0);l({});const K=l([]);async function L(){G.value=!0;const{data:e}=await P.getDrawDetail({id:N.value}),a=C(e);console.log(a,"infoinfo");let l="";if(a.model.includes("kling")?l="kling":a.model.includes("gpt")||a.model.includes("flux")||a.model.includes("nano")?l="dall":a.model.includes("jimeng")&&(l="jimeng"),E.value=l,O.value=a,"kling"===l||"jimeng"===l?JSON.parse(a.imageUrl||"[]"):"dall"===l&&JSON.parse(a.imageUrl||"{}"),10!=a.status&&4!=a.status)S.value=setTimeout((()=>{L()}),3e3);else{if(10==a.status&&a.responseResult&&a.responseResult.length>0){let e=[];a.responseResult.forEach((a=>{e.push(a.url)})),K.value=e}else K.value=[];M(),console.log(K.value,"imagesUrl.valueimagesUrl.value"),G.value=!1}}const M=()=>{d(S.value)||(clearTimeout(S.value),S.value=null)};function V(){$({title:H("app.tip.title"),content:H("video.creating.square.task.del.tip"),confirmText:H("video.creating.square.task.del.confirm"),confirmColor:"#FF3B30",cancelText:H("app.cancel"),cancelColor:"#10A37F",success:async e=>{if(e.confirm){const{code:e}=await P.del({id:O.value.id});200===e&&(T({title:H("app.del.success"),icon:"none"}),J.setBackData({isBack:!0}),z({delta:1}))}}})}const Q=function(e,a){return function(e){const a=/(https?:\/\/[^\s]+)/g,l=e.split(a),t=[];for(let s=0;s<l.length;s++)l[s]&&(a.test(l[s])?t.push({type:"link",value:l[s]}):t.push({type:"text",value:l[s].trim()}));return t}(e.replace(a,"").replace("--relax","").replace("--fast","").replace("--s 0","").replace("--c 0",""))};return t((async()=>{await L()})),s((e=>{N.value=null==e?void 0:e.jobId})),i((()=>{M()})),(e,a)=>{const l=o("ai-bindphone"),t=o("ai-privacy"),s=n(c("uv-icon"),p),i=f,d=n(c("uv-loading-icon"),U),C=n(c("uv-swiper"),q),$=F,T=R;return m(),r(i,{class:"draw-task-container kling container-bg",onClick:a[5]||(a[5]=e=>A.value=!1)},{default:u((()=>[v(l,{ref:"aiPrivacyRef"},null,512),v(t,{ref:"aiPrivacyRef"},null,512),v(D,{bg:!1},{left:u((()=>[v(s,{name:"arrow-left",color:"#000",size:"22",onClick:e.$tools.back},null,8,["onClick"])])),center:u((()=>[v(i,null,{default:u((()=>[g(k(_(H)("draw.creating.task.title")),1)])),_:1})])),right:u((()=>[A.value?(m(),r(i,{key:0,class:"operate"},{default:u((()=>[v(i,{class:"item",onClick:a[0]||(a[0]=a=>e.$tools.to("/pagesA/my/feedback/index"))},{default:u((()=>[v(s,{name:"file-text",size:"32rpx",color:"#000"}),v(i,{class:"action"},{default:u((()=>[g(k(_(H)("video.creating.square.task.feedback")),1)])),_:1})])),_:1}),v(i,{class:"item",onClick:V},{default:u((()=>[v(s,{name:"trash",size:"32rpx",color:"#000"}),v(i,{class:"action"},{default:u((()=>[g(k(_(H)("video.creating.square.task.del")),1)])),_:1})])),_:1})])),_:1})):h("",!0),v(i,{class:"icons"},{default:u((()=>[v(i,{onClick:a[1]||(a[1]=y((e=>A.value=!0),["stop","prevent"]))},{default:u((()=>[v(s,{name:"more-dot-fill",size:"22",color:"#000"})])),_:1})])),_:1})])),_:1}),v(i,{style:x(`height: calc(${e.$tools.height().contentHeight}px);display: flex;flex-direction: column;`)},{default:u((()=>[v($,{"scroll-y":!0,style:x(`height: calc(${e.$tools.height().contentHeight}px - 508rpx);`)},{default:u((()=>[G.value?(m(),r(i,{key:0,class:"card-loading"},{default:u((()=>[v(i,{class:"loading-box"},{default:u((()=>[v(i,{class:"loading"},{default:u((()=>[v(d,{color:"#000",size:"40"})])),_:1}),v(i,{class:"text"},{default:u((()=>[g(k(_(H)("app.generation.loading")),1)])),_:1})])),_:1})])),_:1})):4==O.value.status?(m(),r(i,{key:1,class:"card-reserve"},{default:u((()=>[v(i,{class:"card-mask"}),v(i,{class:"card-progress"},{default:u((()=>[v(i,{style:{"text-align":"center"}},{default:u((()=>[v(s,{name:"info-circle",color:"#ff0000",label:_(H)("music.index.task.fail"),"label-color":"#ff0000"},null,8,["label"])])),_:1})])),_:1})])),_:1})):(m(),r(i,{key:2,class:"picture-container"},{default:u((()=>{var l;return[v(C,{list:K.value,imgMode:"widthFix",height:"100%",bgColor:"none",style:"width: 100%;height: 100%;",indicator:(null==(l=K.value)?void 0:l.length)>1,onClick:a[2]||(a[2]=a=>e.$tools.previewImage(K.value[a]))},null,8,["list","indicator"])]})),_:1}))])),_:1},8,["style"]),v(i,{class:"draw-info"},{default:u((()=>[v($,{"scroll-y":!0,style:x("height: calc(100% - 160rpx);")},{default:u((()=>[v(i,{class:"info-title"},{default:u((()=>[g(k(_(H)("video.index.title")),1)])),_:1}),v(i,{class:"prompt",onClick:a[3]||(a[3]=a=>{return e.$tools.copy(O.value.prompt+" "+(l=O.value.fullPrompt||"",t=O.value.prompt,Q(l,t)));var l,t})},{default:u((()=>[(m(!0),w(j,null,b(Q(O.value.prompt+" "+O.value.fullPrompt||"",O.value.prompt),(e=>(m(),w("span",null,["link"===e.type?(m(),w("span",{key:0,class:"link"},k(_(H)("draw.creating.task.link")),1)):(m(),w("span",{key:1},k(e.value),1))])))),256))])),_:1}),v(i,{class:"version"},{default:u((()=>[g(k(O.value.model),1)])),_:1})])),_:1},8,["style"]),v(i,{class:"btn-container"},{default:u((()=>[v(i,{onClick:a[4]||(a[4]=a=>e.$tools.to("/pages/draw/index",!0))},{default:u((()=>[v(T,{src:B}),v(i,null,{default:u((()=>[g(k(_(H)("video.creating.btn.continue")),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1})}}},[["__scopeId","data-v-186e71f9"]]);export{H as default};
