var e,t,n,i;import{_ as a,q as s,r as l,s as o,m as u,G as r,p as d,a as c,b as h,w as p,d as m,ag as g,e as f,L as y,Q as v,i as b,k as x,O as _,P as S,H as k,J as N,I as C,K as T,t as $,aW as w,a7 as R,aK as I,bg as V,o as z,x as B,X as K,U as P,B as D,F,av as A}from"./index-5HZnFt5a.js";import{a as E}from"./index.BIXFsUHK.js";import{_ as L}from"./uv-input.DP28rKYF.js";const U=a({__name:"phone",props:{type:{type:String,default:"new"}},emits:["next"],setup(e,{emit:t}){const n={customStyle:{background:"#F5F5F5",borderRadius:"30rpx !important",width:"644rpx",height:"140rpx",boxSizing:"border-box",flex:"none !important"},fontSize:"36rpx",color:"#3D3D3D",placeholderStyle:"fontSize: 36rpx; font-weight: 300; lineHeight: 48rpx; color: #8A8A8A;"},i=e,a=s(),_=t,S=l(""),k=o((()=>/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/.test(S.value))),N=o((()=>a.userInfo.phone===S.value)),C=o((()=>{var e;return"old"===i.type?k.value&&!N.value:!k.value&&(null==(e=S.value)?void 0:e.length)>10})),T=o((()=>"old"===i.type?N.value:k.value));function $(){_("next",S.value)}return(e,t)=>{const i=u(d("uv-icon"),r),a=u(d("uv-input"),L),s=v,l=b,o=x;return c(),h(l,null,{default:p((()=>[m(a,g({placeholder:"输入手机号",modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=e=>S.value=e),type:"number",maxlength:11},n),{prefix:p((()=>[m(i,{name:"arrow-down",size:"30rpx",color:"#8a8a8a",label:"+86","label-size":"48rpx","label-color":"#3d3d3d",labelPos:"left"})])),_:1},16,["modelValue"]),m(l,{style:{color:"#ff0000",width:"100%","margin-left":"30rpx","margin-top":"20rpx",height:"20rpx"}},{default:p((()=>[C.value?(c(),h(s,{key:0},{default:p((()=>[f("* 手机号错误，请重新输入！")])),_:1})):y("",!0)])),_:1}),m(o,{class:"btn",disabled:!T.value,onClick:$},{default:p((()=>[f("下一步")])),_:1},8,["disabled"])])),_:1})}}},[["__scopeId","data-v-bb8d3bc8"]]);const j=a({name:"uv-code-input",mixins:[_,S,{props:{value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},adjustPosition:{type:Boolean,default:!0},maxlength:{type:[String,Number],default:6},dot:{type:Boolean,default:!1},mode:{type:String,default:"box"},hairline:{type:Boolean,default:!1},space:{type:[String,Number],default:10},focus:{type:Boolean,default:!1},bold:{type:Boolean,default:!1},color:{type:String,default:"#606266"},fontSize:{type:[String,Number],default:18},size:{type:[String,Number],default:35},disabledKeyboard:{type:Boolean,default:!1},borderColor:{type:String,default:"#c9cacc"},disabledDot:{type:Boolean,default:!0},...null==(t=null==(e=uni.$uv)?void 0:e.props)?void 0:t.codeInput}}],data(){return{inputValue:"",isFocus:this.focus}},created(){const e=String(this.value)||String(this.modelValue);this.inputValue=String(e).substring(0,this.maxlength)},watch:{value(e){this.inputValue=String(e).substring(0,this.maxlength),this.disabledKeyboard&&this.customInput()},modelValue(e){this.inputValue=String(e).substring(0,this.maxlength),this.disabledKeyboard&&this.customInput()}},computed:{codeLength(){return new Array(Number(this.maxlength))},itemStyle(){return e=>{const t=this.$uv.addUnit,n={width:t(this.size),height:t(this.size)};return"box"===this.mode&&(n.border=`${this.hairline?.5:1}px solid ${this.borderColor}`,0===this.$uv.getPx(this.space)&&(0===e&&(n.borderTopLeftRadius="3px",n.borderBottomLeftRadius="3px"),e===this.codeLength.length-1&&(n.borderTopRightRadius="3px",n.borderBottomRightRadius="3px"),e!==this.codeLength.length-1&&(n.borderRight="none"))),e!==this.codeLength.length-1?n.marginRight=t(this.space):n.marginRight=0,n}},codeArray(){return String(this.inputValue).split("")},lineStyle(){const e={};return e.height=this.hairline?"1px":"4px",e.width=this.$uv.addUnit(this.size),e.backgroundColor=this.borderColor,e}},methods:{inputHandler(e){const t=e.detail.value;this.inputValue=t,this.disabledDot&&this.$nextTick((()=>{this.inputValue=t.replace(".","")})),this.$emit("change",t),this.$emit("input",t),this.$emit("update:modelValue",t),String(t).length>=Number(this.maxlength)&&this.$emit("finish",t)},customInput(){const e=this.inputValue;this.disabledDot&&this.$nextTick((()=>{this.inputValue=e.replace(".","")})),this.$emit("change",e),String(e).length>=Number(this.maxlength)&&this.$emit("finish",e)}}},[["render",function(e,t,n,i,a,s){const l=b,o=v,u=w;return c(),h(l,{class:"uv-code-input"},{default:p((()=>[(c(!0),k(N,null,C(s.codeLength,((t,n)=>(c(),h(l,{class:"uv-code-input__item",style:T([s.itemStyle(n)]),key:n},{default:p((()=>[e.dot&&s.codeArray.length>n?(c(),h(l,{key:0,class:"uv-code-input__item__dot"})):(c(),h(o,{key:1,style:T({fontSize:e.$uv.addUnit(e.fontSize),fontWeight:e.bold?"bold":"normal",color:e.color})},{default:p((()=>[f($(s.codeArray[n]),1)])),_:2},1032,["style"])),"line"===e.mode?(c(),h(l,{key:2,class:"uv-code-input__item__line",style:T([s.lineStyle])},null,8,["style"])):y("",!0),a.isFocus&&s.codeArray.length===n?(c(),h(l,{key:3,style:T({backgroundColor:e.color}),class:"uv-code-input__item__cursor"},null,8,["style"])):y("",!0)])),_:2},1032,["style"])))),128)),m(u,{disabled:e.disabledKeyboard,type:"number",focus:e.focus,value:a.inputValue,maxlength:e.maxlength,adjustPosition:e.adjustPosition,class:"uv-code-input__input",onInput:s.inputHandler,style:T({height:e.$uv.addUnit(e.size)}),onFocus:t[0]||(t[0]=e=>a.isFocus=!0),onBlur:t[1]||(t[1]=e=>a.isFocus=!1)},null,8,["disabled","focus","value","maxlength","adjustPosition","onInput","style"])])),_:1})}],["__scopeId","data-v-c31fdde7"]]);const q=a({name:"uv-code",mixins:[_,S,{props:{seconds:{type:[String,Number],default:60},startText:{type:String,default:"获取验证码"},changeText:{type:String,default:"X秒重新获取"},endText:{type:String,default:"重新获取"},keepRunning:{type:Boolean,default:!1},uniqueKey:{type:String,default:""},...null==(i=null==(n=uni.$uv)?void 0:n.props)?void 0:i.code}}],data(){return{secNum:this.seconds,timer:null,canGetCode:!0}},mounted(){this.checkKeepRunning()},watch:{seconds:{immediate:!0,handler(e){this.secNum=e}}},methods:{checkKeepRunning(){let e=Number(R(this.uniqueKey+"_$uCountDownTimestamp"));if(!e)return this.changeEvent(this.startText);let t=Math.floor(+new Date/1e3);this.keepRunning&&e&&e>t?(this.secNum=e-t,I(this.uniqueKey+"_$uCountDownTimestamp"),this.start()):this.changeEvent(this.startText)},start(){this.timer&&(clearInterval(this.timer),this.timer=null),this.$emit("start"),this.canGetCode=!1,this.changeEvent(this.changeText.replace(/x|X/,this.secNum)),this.timer=setInterval((()=>{--this.secNum?this.changeEvent(this.changeText.replace(/x|X/,this.secNum)):(clearInterval(this.timer),this.timer=null,this.changeEvent(this.endText),this.secNum=this.seconds,this.$emit("end"),this.canGetCode=!0)}),1e3),this.setTimeToStorage()},reset(){this.canGetCode=!0,clearInterval(this.timer),this.secNum=this.seconds,this.changeEvent(this.endText)},changeEvent(e){this.$emit("change",e)},setTimeToStorage(){if(this.keepRunning&&this.timer&&this.secNum>0&&this.secNum<=this.seconds){let e=Math.floor(+new Date/1e3);V({key:this.uniqueKey+"_$uCountDownTimestamp",data:e+Number(this.secNum)})}}},unmounted(){this.setTimeToStorage(),clearTimeout(this.timer),this.timer=null}},[["render",function(e,t,n,i,a,s){const l=b;return c(),h(l,{class:"uv-code"})}]]),G=a({__name:"code",props:{phone:{type:String,required:!0},type:{type:String,default:"new"}},emits:["next"],setup(e,{emit:t}){const n=s(),i=t,a=e;z((()=>{S()}));const o=l(),r=l(""),g=l();function y(e){"new"===a.type&&async function(e){K({title:"验证中"}),await B.bindPhone({userId:n.userInfo.id,phone:a.phone,phoneCode:e}),P({title:"绑定成功",icon:"success"}),i("next")}(e),"old"===a.type&&async function(e){await B.checkUserOriginalPhone({phone:a.phone,code:e}),i("next")}(e)}function _(e){r.value=e}async function S(){await B.sendPhoneCode({phone:a.phone,captchaCode:"123456"}),o.value.start()}return(e,t)=>{const n=v,i=b,s=u(d("uv-code-input"),j),l=x,k=u(d("uv-code"),q);return c(),h(i,{style:{display:"flex","align-items":"center","flex-direction":"column"}},{default:p((()=>[m(i,{class:"code-number"},{default:p((()=>[m(n,null,{default:p((()=>[f("+86")])),_:1}),m(n,null,{default:p((()=>[f($(a.phone.substring(0,3)),1)])),_:1}),m(n,null,{default:p((()=>[f($(a.phone.substring(3,7)),1)])),_:1}),m(n,null,{default:p((()=>[f($(a.phone.substring(7,11)),1)])),_:1})])),_:1}),m(s,{maxlength:6,size:"100rpx",onFinish:y}),m(l,{class:"code-tips",disabled:g.value,onClick:S},{default:p((()=>[f($(r.value),1)])),_:1},8,["disabled"]),m(k,{ref_key:"codeRef",ref:o,changeText:"重新发送 Xs",endText:"重新发送",onStart:t[0]||(t[0]=e=>g.value=!0),onEnd:t[1]||(t[1]=e=>g.value=!1),onChange:_},null,512)])),_:1})}}},[["__scopeId","data-v-647b21c1"]]),X=a({__name:"bindphone",setup(e){const t=s(),n=l("bind");D((e=>{(null==e?void 0:e.type)&&(n.value=null==e?void 0:e.type)}));const i=l(""),a=l("");function o(){t.getUserInfo(),A()}function g(){n.value="bind"}function v(e){i.value=e,n.value="replaceCode"}function x(e){a.value=e,n.value="bindCode"}return(e,t)=>{const s=F("ai-bindphone"),l=F("ai-privacy"),_=u(d("uv-icon"),r),S=b;return c(),h(S,null,{default:p((()=>[m(s,{ref:"aiPrivacyRef"},null,512),m(l,{ref:"aiPrivacyRef"},null,512),m(E,{bg:!1},{left:p((()=>[m(_,{name:"arrow-left",size:"30rpx",onClick:e.$tools.back},null,8,["onClick"])])),_:1}),"replace"===n.value?(c(),h(S,{key:0,class:"container flex-column",style:{"margin-top":"40rpx","align-items":"center"}},{default:p((()=>[m(S,{class:"title"},{default:p((()=>[f("输入原手机号")])),_:1}),m(U,{type:"old",onNext:v})])),_:1})):y("",!0),"replaceCode"===n.value?(c(),h(S,{key:1,class:"container flex-column",style:{"margin-top":"40rpx","align-items":"center"}},{default:p((()=>[m(S,{class:"title-code"},{default:p((()=>[f("验证码已发送至")])),_:1}),m(G,{ref:"replaceCodeRef",type:"old",phone:i.value,onNext:g},null,8,["phone"])])),_:1})):y("",!0),"bind"===n.value?(c(),h(S,{key:2,class:"container flex-column",style:{"margin-top":"40rpx","align-items":"center"}},{default:p((()=>[m(S,{class:"title"},{default:p((()=>[f("输入新手机号")])),_:1}),m(U,{onNext:x})])),_:1})):y("",!0),"bindCode"===n.value?(c(),h(S,{key:3,class:"container flex-column",style:{"margin-top":"40rpx","align-items":"center"}},{default:p((()=>[m(S,{class:"title-code"},{default:p((()=>[f("验证码已发送至")])),_:1}),m(G,{ref:"bindCodeRef",phone:a.value,onNext:o},null,8,["phone"])])),_:1})):y("",!0)])),_:1})}}},[["__scopeId","data-v-3ca9fda9"]]);export{X as default};
