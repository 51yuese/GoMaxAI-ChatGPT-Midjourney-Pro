import{_ as e,u as a,q as l,r as s,s as t,B as i,F as o,m as n,p as u,H as c,d as r,w as d,J as p,c as m,a4 as v,G as f,i as x,W as _,a as b,T as y,e as g,t as h,b as k,I as w,L as C,g as V,K as z,f as j,a7 as I,U as S,X as $,aq as F,ar as T,Y as A,as as B,a5 as M,a6 as U,a0 as E,a2 as R,Q as W,V as H,j as P,k as L,M as q}from"./index-5HZnFt5a.js";import{_ as D}from"./uv-input.DP28rKYF.js";import{_ as G,a as J,b as K}from"./uv-switch.Nxgb3ERc.js";import{_ as Q,a as X}from"./diamonds.2zSysToh.js";import{_ as Y}from"./is-vip.81A82wTA.js";import{a as N}from"./index.BIXFsUHK.js";import{_ as O}from"./index.CqNThjil.js";import{d as Z}from"./dialog.CErO1ANM.js";import"./uv-loading-icon.D2OVaaMI.js";import"./props.CsYLBIgk.js";const ee=e({__name:"index",setup(e){const{t:ee}=a(),ae=l(),le=s(!1),se=s(1),te=s(""),ie=s(""),oe=s({}),ne=s(null),ue=s(!1),ce=s(null),re=s(""),de=s(""),pe=s(),me=s(),ve=s([]),fe=s({}),xe=s({}),_e=[{label:"V4"+ee("music.index.modal.label1"),model:"chirp-v4"},{label:"V3.5"+ee("music.index.modal.label2"),model:"chirp-v3-5"},{label:"V3"+ee("music.index.modal.label3"),model:"chirp-v3-0"}],be=[{label:ee("music.index.sub.label1"),value:1},{label:ee("music.index.sub.label2"),value:2}],ye=s({label:"V4"+ee("music.index.modal.label1"),model:"chirp-v4"}),ge=[{label:ee("music.index.sex.label1"),value:"",icon:"/static/sex_random.png"},{label:ee("music.index.sex.label2"),value:"man",icon:"/static/sex_man.png"},{label:ee("music.index.sex.label3"),value:"woman",icon:"/static/sex_women.png"}],he=t((()=>ve.value.find((e=>"musicCreate"===e.type))||{})),ke=t((()=>!!ae.token)),we=t((()=>{const e=I("userInfo")||{};return 1===e.lifetimeVip||e.vipExpire&&new Date(e.vipExpire)>new Date})),Ce=t((()=>he.value&&he.value.remainCount&&we.value));async function Ve(){if(!te.value)return void S({title:ee("music.index.toast"),icon:"error"});$({title:ee("app.generation.loading")});const{data:e}=await m.lyrics({prompt:te.value});oe.value=e,ne.value=setInterval((async()=>{const{data:e}=await m.byMusicLyrics(oe.value.id).catch((()=>{clearInterval(ne.value),ne.value=null,A(),S({title:ee("music.index.task.fail"),icon:"error"})}));e&&(clearInterval(ne.value),ne.value=null,ie.value=e,A(),S({title:ee("music.index.task.success"),icon:"success"}))}),1e3)}const ze=()=>{F({count:1,type:"file",extension:[".mp3",".wav",".m4a"],success:async e=>{const a=e.tempFiles[0];if(a.size>10485760)S({title:ee("music.index.file.size"),icon:"none"});else try{const e=await Se(a.path);if(e<6||e>160)return void S({title:ee("music.index.duration"),icon:"none"});$({title:ee("music.index.upload.in")});const l=await T.uploadMusic(a.url);pe.value=a,me.value=l.data.message_id,A()}catch(l){S({title:ee("music.index.upload.toast"),icon:"none"})}}})};function je(){Z.getChatGroup({modelType:"music"}).then((e=>{e.data.length>0?fe.value=e.data[0]:Z.create({appId:null,modelType:"music"}).then((e=>{fe.value=e.data}))}))}async function Ie(){$({title:ee("app.generation.loading")});const{data:e}=await m.random({dictType:"music-style"});re.value=e.dictValue,A()}const Se=e=>new Promise(((a,l)=>{const s=B();s.src=e,s.onCanplay((()=>{a(s.duration),s.destroy()})),s.onError((()=>{l(new Error(ee("music.index.task.error"))),s.destroy()}))}));async function $e(){if(!ke.value)return void M();if(!(await U(he.value,Fe.value)))return;$({title:ee("app.generation.loading")});const e={options:{parentMessageId:0},make_instrumental:ue.value?1:0,mv:ye.value.model,prompt:ie.value,cusromPrompt:!0,isCustom:1!==se.value,tags:"",title:"",task_id:""};2===se.value&&(e.tags=re.value,e.title=te.value,e.task_id=me.value);const{data:a}=await Z.music(e);A(),E(null==a?void 0:a.errMsg)?R({url:"/pagesA/my/task/index?tab=3"}):S({title:(null==a?void 0:a.errMsg)||ee("app.http.error")})}const Fe=s([]);return i((()=>{(async()=>{const{data:e}=await m.getVipLeavel();Fe.value=v(e)})(),async function(){const{data:e}=await Z.models({modelType:"music",page:1,size:10});xe.value=e.rows[0]}(),je(),async function(){const{data:e}=await Z.musicConfig();ve.value=e}()})),(e,a)=>{const l=o("ai-bindphone"),s=o("ai-privacy"),t=n(u("uv-icon"),f),i=x,m=n(u("uv-input"),D),v=W,I=n(u("uv-switch"),G),S=H,$=P,F=L,T=n(u("uv-popup"),_);return b(),c(p,null,[r(i,{class:"music-container container-bg",onClick:a[7]||(a[7]=e=>le.value=!1)},{default:d((()=>[r(l,{ref:"aiPrivacyRef"},null,512),r(s,{ref:"aiPrivacyRef"},null,512),r(N,{bg:!1},{left:d((()=>[r(i,{class:"left-container"},{default:d((()=>[r(t,{name:"arrow-left",bold:"",size:"22",color:"#000",onClick:a[0]||(a[0]=a=>e.$tools.back()),class:"arrow-left"}),r(i,{class:"modal-select",onClick:a[1]||(a[1]=y((e=>le.value=!le.value),["stop","prevent"]))},{default:d((()=>[r(i,null,{default:d((()=>[g(h(ye.value.model),1)])),_:1}),r(t,{name:"arrow-down-fill",size:"10",top:"1",color:"#000"})])),_:1}),le.value?(b(),k(i,{key:0,class:"modal-list"},{default:d((()=>[(b(),c(p,null,w(_e,((e,a)=>r(i,{class:"list-item",key:a,onClick:a=>function(e){ye.value=e,le.value=!1}(e)},{default:d((()=>[r(i,{class:"name-box"},{default:d((()=>[r(i,null,{default:d((()=>[g(h(e.model),1)])),_:2},1024)])),_:2},1024),r(i,{class:"desc"},{default:d((()=>[g(h(e.label),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})):C("",!0)])),_:1})])),center:d((()=>[r(i,{class:"music-title"},{default:d((()=>[g(h(V(ee)("music.index.title")),1)])),_:1})])),_:1}),r(i,{style:z(`height: ${e.$tools.height().contentHeight}px;display: flex; flex-direction: column;justify-content: space-between;`)},{default:d((()=>[r(i,{style:z(`height: calc(${e.$tools.height().contentHeight}px - ${2===se.value?"270rpx":"170rpx"});display: flex; flex-direction: column;padding: 0 30rpx;`)},{default:d((()=>[r(i,{style:{margin:"30rpx 0 32rpx"}},{default:d((()=>[r(i,{class:"subsection"},{default:d((()=>[(b(),c(p,null,w(be,((e,a)=>r(i,{key:a,class:q(e.value===se.value?"is_active":""),onClick:a=>async function(e){se.value=e.value}(e)},{default:d((()=>[g(h(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),r(S,{"scroll-y":!0,style:z(`height: calc(${e.$tools.height().contentHeight}px - ${2===se.value?"270rpx":"170rpx"}) - 160rpx - 20rpx)`)},{default:d((()=>[r(i,{class:"base-params-list"},{default:d((()=>[2===se.value?(b(),k(i,{key:0,class:"base-params-item"},{default:d((()=>[r(i,{class:"base-title-box"},{default:d((()=>[r(i,{class:"left"},{default:d((()=>[r(i,null,{default:d((()=>[g(h(V(ee)("music.index.params.title1")),1)])),_:1})])),_:1})])),_:1}),r(i,{class:"input-item"},{default:d((()=>[r(m,{placeholder:V(ee)("music.index.params.placeholder1"),color:"#9e9e9e",customStyle:{fontWeight:"400",marginBottom:"0rpx",marginTop:"0rpx",border:"none",boxShadow:"none",height:"100rpx",padding:"0 0 0 28rpx",backgroundColor:"#fff",borderRadius:"24rpx"},placeholderStyle:{color:"#767676",fontWeight:"400"},modelValue:te.value,"onUpdate:modelValue":a[2]||(a[2]=e=>te.value=e)},null,8,["placeholder","modelValue"])])),_:1})])),_:1})):C("",!0),r(i,{class:"base-params-item"},{default:d((()=>[r(i,{class:"base-title-box"},{default:d((()=>[r(i,{class:"left"},{default:d((()=>[r(i,null,{default:d((()=>[g(h(V(ee)("music.index.params.title2")),1)])),_:1})])),_:1})])),_:1}),r(O,{modelValue:ie.value,"onUpdate:modelValue":a[3]||(a[3]=e=>ie.value=e),height:96,placeholder:V(ee)("music.index.params.placeholder2"),customStyle:{background:"#fff",color:"#000000",fontSize:"28rpx"},placeholderStyle:{color:"#767676",fontSize:"28rpx"},countStyle:{color:"#6F7478"}},{operation:d((()=>[2===se.value?(b(),k(i,{key:0,class:"AI-create",onClick:Ve},{default:d((()=>[r(i,{style:{margin:"12rpx 0"}},{default:d((()=>[r(t,{name:"/static/icon-box-1.png",label:V(ee)("music.index.params.create"),"label-size":"24rpx","label-color":"#726AFB"},null,8,["label"])])),_:1})])),_:1})):C("",!0)])),_:1},8,["modelValue","placeholder"])])),_:1}),r(i,{class:"base-params-item"},{default:d((()=>[r(i,{class:"add-end"},{default:d((()=>[r(v,null,{default:d((()=>[g(h(V(ee)("music.index.params.title3")),1)])),_:1}),r(I,{modelValue:ue.value,"onUpdate:modelValue":a[4]||(a[4]=e=>ue.value=e),activeColor:"#574FFE",size:"30rpx"},null,8,["modelValue"])])),_:1}),r(i,{class:"tips"},{default:d((()=>[g(h(V(ee)("music.index.params.tips")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1},8,["style"]),r(i,{class:"footer"},{default:d((()=>[2===se.value?(b(),k(i,{key:0,class:"params-box",onClick:a[5]||(a[5]=e=>{var a;return null==(a=ce.value)?void 0:a.open()})},{default:d((()=>[r(i,{class:"params-list"},{default:d((()=>[re.value?(b(),k(i,{key:0,class:"list-item"},{default:d((()=>[g(h(re.value),1)])),_:1})):C("",!0),r(i,{class:"list-item"},{default:d((()=>{var e;return[g(h(null==(e=ge.find((e=>e.value===de.value)))?void 0:e.label),1)]})),_:1})])),_:1}),r($,{src:J})])),_:1})):C("",!0),r(i,{class:"create-box"},{default:d((()=>[r(i,{class:"works-box",onClick:a[6]||(a[6]=a=>e.$tools.to("/pagesA/my/task/index?tab=3",!0))},{default:d((()=>[r($,{src:Q}),r(i,{class:"works"},{default:d((()=>[g(h(V(ee)("video.index.params.works")),1)])),_:1})])),_:1}),r(F,{class:"btn-primary-creat",onClick:$e},{default:d((()=>[he.value.isVipUsed?(b(),k($,{key:0,class:"vip-icon",src:Y})):C("",!0),ke.value?Ce.value?(b(),c(p,{key:2},[j("span",null,h(V(ee)("video.index.model.btn")),1),j("span",{class:"text-num"},h(V(ee)("chat.index.model.vipFree"))+h(he.value.remainCount)+h(V(ee)("video.index.model.time")),1)],64)):he.value?(b(),c(p,{key:3},[r($,{src:X,class:"diamonds"}),j("span",{style:{margin:"2rpx 18rpx 0 6rpx","font-size":"28rpx"}},h(he.value.useIntegrate),1),j("span",null,h(V(ee)("video.index.model.btn")),1)],64)):(b(),c("span",{key:4},h(V(ee)("video.index.model.create")),1)):(b(),c("span",{key:1},h(V(ee)("video.index.model.creat")),1))])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1}),r(T,{ref_key:"popupRef",ref:ce,mode:"bottom","bg-color":"none","z-index":11,safeAreaInsetBottom:!1,"custom-style":"\n      height: fit-content;\n      padding: 24rpx 24rpx 170rpx;\n      overflow: scroll;\n      background: #fff;\n      border-radius: 30rpx 30rpx 0rpx 0rpx;\n    "},{default:d((()=>[r(i,{class:"params-container"},{default:d((()=>[r($,{class:"close",src:K,onClick:a[8]||(a[8]=e=>{var a;return null==(a=ce.value)?void 0:a.close()})}),r(i,{class:"params-item"},{default:d((()=>[r(i,{class:"title-box"},{default:d((()=>[r(i,null,{default:d((()=>[g(h(V(ee)("music.index.popup.title1")),1)])),_:1})])),_:1}),r(i,{class:"upload-file",onClick:ze},{default:d((()=>[r(i,{class:"tips"},{default:d((()=>[g(h(V(ee)("music.index.popup.tips")),1)])),_:1}),me.value?(b(),k(i,{key:0},{default:d((()=>{var e;return[g(h(null==(e=pe.value)?void 0:e.name),1)]})),_:1})):(b(),c(p,{key:1},[r(t,{name:"plus",size:"60rpx",color:"#979797"}),r(v,null,{default:d((()=>[g(h(V(ee)("music.index.popup.text")),1)])),_:1})],64))])),_:1})])),_:1}),r(i,{class:"params-item"},{default:d((()=>[r(i,{class:"title-box"},{default:d((()=>[r(i,null,{default:d((()=>[g(h(V(ee)("music.index.popup.title2")),1)])),_:1})])),_:1}),r(i,{class:"input-item"},{default:d((()=>[r(m,{placeholder:V(ee)("music.index.popup.placeholder"),color:"#9e9e9e",customStyle:{fontWeight:"400",marginBottom:"0rpx",marginTop:"0rpx",border:"none",boxShadow:"none",height:"100rpx",padding:"0 16rpx",backgroundColor:"#f6f6f6",borderRadius:"24rpx"},placeholderStyle:{color:"#767676",fontWeight:"400"},modelValue:re.value,"onUpdate:modelValue":a[9]||(a[9]=e=>re.value=e)},{suffix:d((()=>[r(i,{class:"style-create",onClick:Ie},{default:d((()=>[r(i,{style:{margin:"12rpx 0"}},{default:d((()=>[r(t,{name:"/static/icon-box-1.png",label:V(ee)("music.index.popup.random"),"label-size":"24rpx","label-color":"#726AFB"},null,8,["label"])])),_:1})])),_:1})])),_:1},8,["placeholder","modelValue"])])),_:1})])),_:1}),r(i,{class:"params-item"},{default:d((()=>[r(i,{class:"title-box"},{default:d((()=>[r(i,null,{default:d((()=>[g(h(V(ee)("music.index.popup.title3")),1)])),_:1})])),_:1}),r(i,{class:"create-modal"},{default:d((()=>[(b(),c(p,null,w(ge,(e=>r(i,{class:"create-modal-item",key:e.value,onClick:a=>{return l=e.value,void(de.value!==l&&(ie.value=ie.value.replace("[male vocals]\n","").replace("[female vocals]\n",""),de.value=l,"man"===l?ie.value="[male vocals]\n"+ie.value:"woman"===l&&(ie.value="[female vocals]\n"+ie.value)));var l}},{default:d((()=>[r($,{src:e.icon,class:q({is_active:de.value===e.value})},null,8,["src","class"]),r(v,null,{default:d((()=>[g(h(e.label),1)])),_:2},1024)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1})])),_:1})])),_:1},512)],64)}}},[["__scopeId","data-v-79e89a95"]]);export{ee as default};
