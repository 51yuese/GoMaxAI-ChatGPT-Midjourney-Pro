import{_ as a,u as e,r as t,s as l,o as s,B as r,a1 as n,C as i,a8 as c,F as u,m as o,p as d,b as m,w as p,ac as f,a4 as g,a9 as v,a0 as k,G as w,i as b,W as x,a as h,d as y,e as _,t as C,g as A,L as R,K as I,H as U,I as j,J as V,M,ad as D,au as F,U as z,av as P,X as G,Y as H,h as S,j as Z,V as E,Q as N}from"./index-5HZnFt5a.js";import{_ as J}from"./uv-line-progress.D7X4wFI6.js";import{_ as Q}from"./uv-loading-icon.D2OVaaMI.js";import{_ as B}from"./uv-picker.B_83EYu7.js";import{_ as T}from"./re-edit-1.DlF31W5H.js";import{_ as O}from"./create-again-1.BJYmOOmv.js";import{a as q}from"./index.BIXFsUHK.js";import{u as K}from"./page.BP1yyV07.js";import{m as L}from"./mj.CpUrlHRv.js";const Y=a({__name:"task",setup(a){const{t:Y}=e(),X=D(),W=K(),$=t(""),aa=t(!1),ea=t(220),ta=t(220),la=t([]),sa=[{label:"MJ 7.0",value:"7.0",models:"--v"},{label:"MJ 6.1",value:"6.1",models:"--v"},{label:"MJ 6.0",value:"6.0",models:"--v"},{label:"MJ 5.2",value:"5.2",models:"--v"},{label:"MJ 5.1",value:"5.1",models:"--v"},{label:"Nj 6.0",value:"6",models:"--niji"},{label:"NJ 5.1",value:"5",models:"--niji"}],ra=l((()=>{var a,e;const t=n(null==(a=na.value)?void 0:a.extraParam),l=null==t?void 0:t.split(" ")[0],s=null==t?void 0:t.split(" ")[1];return null==(e=sa.find((a=>a.value===s&&a.models===l)))?void 0:e.label})),na=t({}),ia=t(0),ca=t(null),ua=async()=>{const{data:a}=await L.getDetailByIds({jobIds:$.value}),e=g(a);if(e.length<=0)return void(na.value={});const t=v(e[0]);t.progress<100&&k(ca.value)&&k(t.failReason)&&(ca.value=setInterval((()=>{ua()}),1e3)),t.progress>=100&&Oa(),console.log(t),na.value=t,da()},oa=t([]),da=()=>{const a=na.value,e=/(https?:\/\/[^\s]+)/g,t=(a.prompt+" "+a.fullPrompt).replace(a.prompt,"").replace("--relax","").replace("--fast","").replace("--s 0","").replace("--c 0","").split(e),l=[];for(let s=0;s<t.length;s++)t[s]&&(e.test(t[s])?l.push({type:"link",value:t[s]}):l.push({type:"text",value:t[s].trim()}));oa.value=l},ma=async()=>{if(!(await F({content:Y("video.creating.square.task.del.tip"),confirmText:Y("video.creating.square.task.del.confirm"),confirmColor:"#FF3B30",cancelText:Y("app.cancel"),cancelColor:"#10A37F"})))return;const{code:a}=await L.delete({id:na.value.id});200===a&&(z({title:Y("app.del.success"),icon:"none"}),W.setBackData({isBack:!0}),P({delta:1}))},pa=t(!0),fa=t(100),ga=()=>{pa.value=!1,setTimeout((async()=>{const a=await f(X,".main-container"),e=await f(X,".picture-container");fa.value=a.height-e.height}),300)},va=t(!1),ka=()=>{va.value=!0},wa=l((()=>{const a=na.value;return a.progress>=100&&!a.failReason&&!pa.value&&!va.value})),ba=new Map([["U1",Y("draw.creating.task.map.name1")],["U2",Y("draw.creating.task.map.name2")],["U3",Y("draw.creating.task.map.name3")],["U4",Y("draw.creating.task.map.name4")],["V1",Y("draw.creating.task.map.name5")],["V2",Y("draw.creating.task.map.name6")],["V3",Y("draw.creating.task.map.name7")],["V4",Y("draw.creating.task.map.name8")],["Vary (Subtle)",Y("draw.creating.task.map.name9")],["Vary (Strong)",Y("draw.creating.task.map.name10")],["Vary (Region)",Y("draw.creating.task.map.name11")],["Zoom Out 2x",Y("draw.creating.task.map.name12")],["Zoom Out 1.5x",Y("draw.creating.task.map.name13")],["Upscale (Subtle)",Y("draw.creating.task.map.name14")],["Upscale (Creative)",Y("draw.creating.task.map.name15")],["Vary (Subtle)",Y("draw.creating.task.map.name16")],["Vary (Strong)",Y("draw.creating.task.map.name17")],["Redo Upscale (Subtle)",Y("draw.creating.task.map.name18")],["Redo Upscale (Creative)",Y("draw.creating.task.map.name19")],["Redo Upscale (2x)",Y("draw.creating.task.map.name20")],["Redo Upscale (4x)",Y("draw.creating.task.map.name21")]]),xa=[{text:Y("draw.creating.task.cate.text1"),reg:function(a){return/upsample:|reroll/.test(a.customId)},desc:Y("draw.creating.task.cate.desc1")},{text:Y("draw.creating.task.cate.text2"),reg:function(a){return/:variation:/.test(a.customId)},desc:Y("draw.creating.task.cate.desc2")},{text:Y("draw.creating.task.cate.text3"),reg:function(a){return/upsample_/.test(a.customId)},desc:Y("draw.creating.task.cate.desc3")},{text:Y("draw.creating.task.cate.text4"),reg:function(a){return/_variation|Inpaint:/.test(a.customId)},desc:Y("draw.creating.task.cate.desc4")},{text:Y("draw.creating.task.cate.text5"),reg:function(a){return/Outpaint:/.test(a.customId)},desc:Y("draw.creating.task.cate.desc5")},{text:Y("draw.creating.task.cate.text6"),reg:function(a){return/pan_/.test(a.customId)},desc:Y("draw.creating.task.cate.desc6")},{text:Y("draw.creating.task.cate.text7"),reg:function(a){return/PicReader|Picread:/.test(a.customId)},desc:""}],ha=0,ya=4,_a=5,Ca=6,Aa=7,Ra=8,Ia=9,Ua=10,ja=11,Va=12,Ma=13,Da=14,Fa=17,za=18,Pa=19,Ga=20,Ha=21,Sa=a=>{if(["U1","U2","U3","U4"].includes(a.label))return ya;if(["V1","V2","V3","V4"].includes(a.label))return _a;if(!a.label&&a.emoji){if("ðŸ”„"===a.emoji)return Ca;if(["â¬…ï¸","âž¡ï¸","â¬†ï¸","â¬‡ï¸"].includes(a.emoji))return Fa;if(["1ï¸âƒ£","2ï¸âƒ£","3ï¸âƒ£","4ï¸âƒ£"].includes(a.emoji))return Ha}return a.label.includes("Upscale (4x)")?Da:a.label.includes("Upscale (2x)")?Ma:a.label.includes("Vary (Subtle)")?Ra:a.label.includes("Vary (Strong)")?Aa:a.label.includes("Vary (Region)")?Ia:a.label.includes("Make Square")?Ua:a.label.includes("Zoom Out 2x")?ja:a.label.includes("Zoom Out 1.5x")?Va:a.label.includes("Custom Zoom")?za:a.label.includes("Redo Upscale (Subtle)")?Pa:a.label.includes("Redo Upscale (Creative)")?Ga:ha},Za=t(null),Ea=()=>{var a;null==(a=Za.value)||a.open()},Na=l((()=>{if(!na.value.buttons)return[];const a=[];return xa.forEach((e=>{const t=na.value.buttons.filter((a=>"string"==typeof e.reg?a.label.includes(e.reg):"function"==typeof e.reg?e.reg(a):void 0));t.forEach((a=>a.zhLabel=ba.get(a.label)||a.label)),t.length&&a.push({text:e.text,desc:e.desc,children:t})})),a})),Ja=t(null),Qa=()=>{var a;null==(a=Ja.value)||a.open()},Ba=async a=>{G({title:Y("draw.creating.task.publish"),mask:!0});const e=a.value[0];await L.publish({squareType:e.id,id:na.value.id}),H(),z({title:Y("video.creating.square.task.release"),icon:"success",duration:2e3})},Ta=()=>{const a=na.value,e=a.fullPrompt.replace(a.prompt,"").replace("--relax","").replace("--fast","").replace("--s 0","").replace("--c 0",""),t=a.prompt+" "+e;S.copy(t)},Oa=()=>{k(ca.value)||(clearInterval(ca.value),ca.value=null)};return s((()=>{(async()=>{const a=await f(X,"#ai-header"),e=await f(X,".btn-container");ea.value=a.height,ta.value=e.height})()})),r((a=>{$.value=n(null==a?void 0:a.jobId),(async()=>{const{data:a}=await L.inspireClassifyQuery({page:1,size:20}),e=g(null==a?void 0:a.rows);la.value=[e]})()})),i((()=>{ua()})),c((()=>{Oa()})),(a,e)=>{const t=u("ai-bindphone"),l=u("ai-privacy"),s=o(d("uv-icon"),w),r=b,n=Z,i=o(d("uv-line-progress"),J),c=o(d("uv-loading-icon"),Q),f=N,g=E,v=o(d("uv-picker"),B),k=o(d("uv-popup"),x);return h(),m(r,{class:"draw-task-container container-bg",onClickCapture:e[3]||(e[3]=a=>aa.value=!1)},{default:p((()=>[y(t,{ref:"aiPrivacyRef"},null,512),y(l,{ref:"aiPrivacyRef"},null,512),y(q,{id:"ai-header",bg:!1},{left:p((()=>[y(s,{name:"arrow-left",color:"#000",size:"22",onClick:a.$tools.back},null,8,["onClick"])])),center:p((()=>[y(r,null,{default:p((()=>[_(C(A(Y)("draw.creating.task.title")),1)])),_:1})])),right:p((()=>[y(r,{class:"icons"},{default:p((()=>[y(s,{name:"more-dot-fill",size:"22",color:"#000",onClick:e[0]||(e[0]=a=>aa.value=!0)})])),_:1}),aa.value?(h(),m(r,{key:0,class:"operate"},{default:p((()=>[y(r,{class:"item",onClick:e[1]||(e[1]=e=>a.$tools.to("/pagesA/my/feedback/index"))},{default:p((()=>[y(s,{name:"file-text",size:"22",color:"#000"}),y(r,{class:"action"},{default:p((()=>[_(C(A(Y)("video.creating.square.task.feedback")),1)])),_:1})])),_:1}),y(r,{class:"item",onClick:ma},{default:p((()=>[y(s,{name:"trash",size:"22",color:"#000"}),y(r,{class:"action"},{default:p((()=>[_(C(A(Y)("video.creating.square.task.del")),1)])),_:1})])),_:1})])),_:1})):R("",!0)])),_:1}),y(r,{class:"main-body",style:I({height:`calc(100% - ${ea.value}px)`})},{default:p((()=>[y(r,{class:"main-container",style:I({height:`calc(100% - ${ta.value}px)`})},{default:p((()=>[(h(!0),U(V,null,j(na.value.responseResult,(a=>(h(),m(n,{class:"preloading",src:a.thumb,onLoad:ga,onError:ka},null,8,["src"])))),256)),4!=na.value.status&&10!=na.value.status?(h(),m(r,{key:0,class:"reserve"},{default:p((()=>[y(r,{class:"progress"},{default:p((()=>[y(r,{class:"text"},{default:p((()=>[_(C(A(Y)("video.creating.task.progress"))+" "+C(parseInt(ia.value))+"%",1)])),_:1}),y(r,{class:"progress-box"},{default:p((()=>[y(i,{percentage:parseInt(ia.value),showText:!1,activeColor:"linear-gradient(94deg, #957DF4 4%, #486CE9 94%)",inactiveColor:"#fff"},null,8,["percentage"])])),_:1})])),_:1})])),_:1})):4==na.value.status?(h(),m(r,{key:1,class:"reserve"},{default:p((()=>[y(r,{class:"failure-box"},{default:p((()=>[y(r,{class:"failure"},{default:p((()=>[y(s,{name:"info-circle",color:"#ff0000",size:"40"})])),_:1}),y(r,{class:"text"},{default:p((()=>[_(C(A(Y)("music.index.task.fail")),1)])),_:1})])),_:1})])),_:1})):pa.value?(h(),m(r,{key:2,class:"reserve"},{default:p((()=>[y(r,{class:"loading-box"},{default:p((()=>[y(r,{class:"loading"},{default:p((()=>[y(c,{color:"#000",size:"40"})])),_:1}),y(r,{class:"text"},{default:p((()=>[_(C(A(Y)("app.loading")),1)])),_:1})])),_:1})])),_:1})):va.value?(h(),m(r,{key:3,class:"reserve"},{default:p((()=>[y(r,{class:"failure-box"},{default:p((()=>[y(r,{class:"failure"},{default:p((()=>[y(s,{name:"info-circle",color:"#ff0000",size:"40"})])),_:1}),y(r,{class:"text"},{default:p((()=>[_(C(A(Y)("app.loading.error")),1)])),_:1})])),_:1})])),_:1})):(h(),m(r,{key:4,class:"picture-container"},{default:p((()=>[(h(!0),U(V,null,j(na.value.responseResult,(e=>(h(),m(n,{src:e.thumb,mode:"widthFix",onClick:t=>a.$tools.previewImage(e.url)},null,8,["src","onClick"])))),256))])),_:1})),y(r,{class:M(["draw-info",[wa.value&&fa.value>20?"is-img":"",wa.value?"":"is-img"]]),style:I({height:wa.value?fa.value>100?fa.value+"px":"210rpx":"calc(100% - 430rpx)"})},{default:p((()=>[y(g,{"scroll-y":!0,style:{height:"100%"}},{default:p((()=>[y(r,{class:"info-title"},{default:p((()=>[_(C(A(Y)("video.index.title")),1)])),_:1}),y(r,{class:"prompt",onClick:Ta},{default:p((()=>[(h(!0),U(V,null,j(oa.value,(a=>(h(),U(V,null,["link"===a.type?(h(),m(f,{key:0,class:"item link"},{default:p((()=>[_(C(A(Y)("draw.creating.task.link")),1)])),_:1})):(h(),m(f,{key:1,class:"item"},{default:p((()=>[_(C(a.value),1)])),_:2},1024))],64)))),256))])),_:1}),ra.value?(h(),m(r,{key:0,class:"version"},{default:p((()=>[_(C(ra.value),1)])),_:1})):R("",!0)])),_:1})])),_:1},8,["class","style"])])),_:1},8,["style"]),y(r,{class:"btn-container"},{default:p((()=>[y(r,{class:"item",onClick:Ea},{default:p((()=>[y(n,{src:T}),y(r,{class:"text"},{default:p((()=>[_(C(A(Y)("draw.creating.task.btn.more")),1)])),_:1})])),_:1}),y(r,{class:"item",onClick:e[2]||(e[2]=e=>a.$tools.to("/pages/draw/index",!0))},{default:p((()=>[y(n,{src:O}),y(r,{class:"text"},{default:p((()=>[_(C(A(Y)("video.creating.btn.continue")),1)])),_:1})])),_:1}),y(r,{class:"item",onClick:Qa},{default:p((()=>[y(n,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAABYCAYAAABxlTA0AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAARiSURBVHic7ZvBceQ2EEVfrR2AMth2BFYIDGE3AzgDhTCOQM6Am8GGMJuB1hFwfPNtdPTNPnBQGmPZIECAIEHhVaFURQGN5h8S/OzBQKPRaDQajUaj8f74aesEKqMDHoG/gX+2TeVYGGAA/r21K6PYjUQM/xf2vg3bpVU/Bl3Y+ybbpFcvHfDCvLC2NQJ5BM6EC9uWiEAE6IkT1rav5dOtB2G5sLb1pZOuASFdWNueyqa+b4R8wtr2qeQJ7BUhv7DNojGe/InxjWsNcd+1RTsR9pKQ0oZSJ7MnDHHCDowPKt+LhXYHvCuLZogX1tzG+tbngfFumPrf88rntAsM8cKegIfb+JOn75Xx7U7rc2iLZogT9soolDgxfGPMrZ92hR/SohniH149P9qpR/zu4nTXV1uf3ZhV0xFfiJkSltsx34fUO/21D+IQCPmEhXHt9TmGF97WZ9tfW8urRoh/+/IJa/HFHCbGPyp9q7VowjrCQphjcDFK/+osmhAv7JlpUaYwM7GMMu45sv/uEOKFHYj7NjfGMbhoue3eognLhDUL5hk8MfuZ8dVZNCG+ELNEWIh3DFNMXfnXBbkU4UQZYS2+O2Rg/ioUz9hdYSgrLCxzDC67t2iG8sLaeX3zhM6hxdncohmWVbgkw9wpjsFldxbNEF+IOZHviSwz8/eR8b4qcUK9dzYMeSpcKeRwDC7aOUmWjAPoyFuISaH3zDksnHMziybsR1jI4xhcRIn3kpztzKS+K6W0sJDPMbh8UuLFruNRxFy1awsLeR2Dy9MKMb2IMqHbzpTZVi/kdQwuxS2aVtmfEljWSuIul9yOwWUTixaz/q65RPjyGDLNq90dqR+cFyHePTxnTurkmWupY5hCi1+Ejjih7Z6EVKHNzDwmMb5FlPirWrQpOuJ+LJIi9JqOwWUTi+bDsGyXTajQMhM/94kXt2ihPBG3FzfklivhGFx2V0W754G4Tc9mJl7vGTuwjlPZTRXNR6jQvuL1yTMup2Nw0ZajVS3aUuaENso4o/Rf+3atdqvUlNDaw6mkY3ARZc7iFm0pD4xXX+fpc6acY3DZnUXLja/msYZjcNEsWtJu9g/peWVDE/AV+Hz7uya/KscvKUH3JLDGdxJPMhDNmXxPCfpzyuCNEUZRXoFvGeL57qBDIEyvgeeJvu56eSbNvlVr0WIQwgT2PQwHlgm92lapGtZgF99bnDDaqlihtZjJy0ONAoc8dIQ3oZ+Yt3iiHP8zOCuFGgV+BX4P7CuMNY8Bf5n0o3L8EpHX7hHCH3KwbHeRVo+ubjf7EoQ4gS0d6UIf+geHFmGZwJaO5UIf3qJBusCWDr1wHtOy7Gav8SE3xzfG2sUvwJeEOJcMuRxSYMsF+I3lQv+VI4kjC2y58Cb0H4S/PFxWymczhDxr8Byh3xlK5nk3RygjsMUn9FpzbopQVmCLK3TPAa9e0Ktk/ZZJHY2eHwXe/a/ba+KB0eBfeauENRqNRqPRaDQajUbjnv8AARIircTY7tsAAAAASUVORK5CYII="}),y(r,{class:"text"},{default:p((()=>[_(C(A(Y)("draw.creating.task.btn.release")),1)])),_:1})])),_:1})])),_:1}),y(v,{ref_key:"pickerRef",ref:Ja,title:A(Y)("draw.creating.task.picker.title"),columns:la.value,keyName:"name",onConfirm:Ba},null,8,["title","columns"]),y(k,{ref_key:"popupRef",ref:Za,mode:"bottom",bgColor:"none"},{default:p((()=>[y(r,{class:"more-container"},{default:p((()=>[y(r,{class:"title"},{default:p((()=>[_(C(A(Y)("draw.creating.task.btn.more")),1)])),_:1}),(h(!0),U(V,null,j(Na.value,(a=>(h(),m(r,{class:"edit-container"},{default:p((()=>[y(r,{class:"name"},{default:p((()=>[_(C(a.text)+":",1)])),_:2},1024),y(r,{class:"items"},{default:p((()=>[(h(!0),U(V,null,j(a.children,(e=>(h(),m(r,{class:"item",onClick:t=>(async(a,e)=>{if(pa.value=!0,Sa(e)===Ia)return void z({title:Y("draw.creating.task.redraw")});G({title:Y("draw.creating.task.loading1")+a.text+Y("draw.creating.task.loading2")});const{data:t}=await L.task({type:4,params:{taskId:na.value.id,action:Sa(e),customId:e.customId}});H(),$.value=t.jobId,ua().then()})(a,e)},{default:p((()=>[_(C(e.zhLabel||e.emoji),1)])),_:2},1032,["onClick"])))),256))])),_:2},1024)])),_:2},1024)))),256)),y(r,{class:"creat-time"},{default:p((()=>[_(C(A(Y)("draw.creating.task.creat.time"))+"ï¼š"+C(na.value.createdAt),1)])),_:1})])),_:1})])),_:1},512)])),_:1},8,["style"])])),_:1})}}},[["__scopeId","data-v-74d1ab8c"]]);export{Y as default};
