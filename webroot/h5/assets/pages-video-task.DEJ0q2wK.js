import{_ as e,u as a,r as l,s as t,o as s,az as i,B as o,a1 as c,C as n,a8 as u,F as d,m as r,p as v,b as m,w as g,ac as p,a9 as A,a0 as k,a4 as h,G as I,i as y,a as f,d as j,e as M,t as b,g as N,L as R,K as W,M as G,ad as w,U as Y,h as Z,au as C,av as L,aA as D,j as E,V as z}from"./index-5HZnFt5a.js";import{_ as O}from"./uv-line-progress.D7X4wFI6.js";import{_ as x}from"./video-play.Msq2Y7fy.js";import{_ as T}from"./re-edit-1.DlF31W5H.js";import{_}from"./create-again-1.BJYmOOmv.js";import{a as S}from"./index.BIXFsUHK.js";import{u as B}from"./page.BP1yyV07.js";import{v as P}from"./video.HkJGK1YS.js";import{d as Q}from"./dialog.CErO1ANM.js";const F=e({__name:"task",setup(e){const{t:F}=a(),U=w(),V=B(),J=l(null),X=l(""),H=l(!1),q=l(220),K=l(220),$=l({}),ee=l(""),ae=l(0),le=l(null),te=async()=>{var e;const{data:a}=await P.getVideoTask({ids:[X.value]}),l=h(a);if(l.length<=0)return void($.value={});const t=A(l[0]),s=c(null==(e=null==t?void 0:t.requestParams)?void 0:e.model);if(null==s?void 0:s.includes("kling")){let e="",a="";try{e=s.match(/v(\d+)-(\d+)/)[1],a=s.match(/v(\d+)-(\d+)/)[2]}catch(n){}k(e)||k(a)?!k(e)&&k(a)?ee.value=F("video.creating.square.task.popup.kling")+`${e}`:ee.value=F("video.creating.square.task.popup.kling"):ee.value=F("video.creating.square.task.popup.kling")+`${e}.${a}`}else(null==s?void 0:s.includes("jimeng"))?ee.value=F("video.index.model.label1"):(null==s?void 0:s.includes("veo"))?ee.value="谷歌视频":ee.value="luma";const i=h(t.children),o=i.length>0?i[0]:{};(i.length<=0||k(o.mp4))&&k(le.value)&&k(t.errMsg)&&(le.value=setInterval((()=>{ae.value<100&&(ae.value=ae.value+.5),te()}),2e3)),(i.length>0&&!k(o.mp4)||!k(o.errMsg))&&Ae(),$.value=t},se=t((()=>{const e=$.value,a=h(null==e?void 0:e.children),l=a.length>0?a[0]:{};return(a.length<=0||k(l.mp4))&&k(e.errMsg)?"progress":(a.length<=0||k(l.mp4))&&!k(e.errMsg)?"errMsg":"video"})),ie=t((()=>{var e;const a=h(null==(e=$.value)?void 0:e.children),l=a.length>0?a[0]:{};return c(l.mp4)})),oe=t((()=>{var e;const a=h(null==(e=$.value)?void 0:e.children),l=a.length>0?a[0]:{};return c(l.cover)})),ce=t((()=>{var e;const a=A(null==(e=$.value)?void 0:e.requestParams),l=c(a.aspect_ratio);return k(l)?"16 / 9":l.replace(":","/")})),ne=t((()=>{var e;const a=A(null==(e=$.value)?void 0:e.requestParams);let l=c(a.prompt);return[/ ,每秒帧数：\d+/g,/ ,运动幅度：\d+/g,/ ,文案一致性：\d+/g].map((e=>l=null==l?void 0:l.replace(e,""))),l})),ue=t((()=>{var e;const a=A(null==(e=$.value)?void 0:e.requestParams);let l=c(a.mode);return F("std"===l?"video.index.quality.name1":"video.index.quality.name2")})),de=l(!1),re=()=>{de.value=!0},ve=()=>{de.value=!1},me=()=>{de.value?J.value.pause():J.value.play()},ge=()=>{var e;const a=h(null==(e=$.value)?void 0:e.children),l=a.length>0?a[0]:{};k(l.mp4)?Y({title:F("video.creating.square.task.toast"),icon:"none"}):Z.download(l.mp4,"MP4")},pe=async()=>{if(!(await C({content:F("video.creating.square.task.del.tip"),confirmText:F("video.creating.square.task.del.confirm"),confirmColor:"#FF3B30",cancelText:F("app.cancel"),cancelColor:"#10A37F"})))return;const{code:e}=await Q.delChatLog({id:$.value.id});200===e&&(Y({title:F("app.del.success"),icon:"none"}),V.setBackData({isBack:!0}),L())},Ae=()=>{k(le.value)||(clearInterval(le.value),le.value=null)};return s((()=>{(async()=>{const e=await p(U,"#ai-header"),a=await p(U,".btn-container");q.value=e.height,K.value=a.height})(),J.value=i("myVideo")})),o((({id:e})=>{X.value=c(e)})),n((()=>{te()})),u((()=>{Ae()})),(e,a)=>{const l=d("ai-bindphone"),t=d("ai-privacy"),s=r(v("uv-icon"),I),i=y,o=r(v("uv-line-progress"),O),c=D,n=E,u=z;return f(),m(i,{class:"draw-task-container container-bg",onClickCapture:a[5]||(a[5]=e=>H.value=!1)},{default:g((()=>[j(l,{ref:"aiPrivacyRef"},null,512),j(t,{ref:"aiPrivacyRef"},null,512),j(S,{id:"ai-header",bg:!1},{left:g((()=>[j(s,{name:"arrow-left",color:"#000",size:"22",onClick:e.$tools.back},null,8,["onClick"])])),center:g((()=>[j(i,null,{default:g((()=>[M(b(N(F)("video.creating.square.task.title")),1)])),_:1})])),right:g((()=>[j(i,{class:"icons"},{default:g((()=>[j(s,{name:"more-dot-fill",size:"22",color:"#000",onClick:a[0]||(a[0]=e=>H.value=!0)})])),_:1}),H.value?(f(),m(i,{key:0,class:"operate"},{default:g((()=>[j(i,{class:"item",onClick:a[1]||(a[1]=a=>e.$tools.to("/pagesA/my/feedback/index"))},{default:g((()=>[j(s,{name:"file-text",size:"22",color:"#000"}),j(i,{class:"action"},{default:g((()=>[M(b(N(F)("video.creating.square.task.feedback")),1)])),_:1})])),_:1}),j(i,{class:"item",onClick:pe},{default:g((()=>[j(s,{name:"trash",size:"22",color:"#000"}),j(i,{class:"action"},{default:g((()=>[M(b(N(F)("video.creating.square.task.del")),1)])),_:1})])),_:1})])),_:1})):R("",!0)])),_:1}),j(i,{class:"main-body",style:W({height:`calc(100% - ${q.value}px)`})},{default:g((()=>[j(i,{class:"main-container",style:W({height:`calc(100% - ${K.value}px)`})},{default:g((()=>["progress"===se.value?(f(),m(i,{key:0,class:"reserve"},{default:g((()=>[j(i,{class:"progress"},{default:g((()=>[j(i,{class:"text"},{default:g((()=>[M(b(N(F)("video.creating.task.progress"))+" "+b(parseInt(ae.value))+"%",1)])),_:1}),j(i,{class:"progress-box"},{default:g((()=>[j(o,{percentage:parseInt(ae.value),showText:!1,activeColor:"linear-gradient(94deg, #957DF4 4%, #486CE9 94%)",inactiveColor:"#fff"},null,8,["percentage"])])),_:1})])),_:1})])),_:1})):"errMsg"===se.value?(f(),m(i,{key:1,class:"reserve"},{default:g((()=>[j(i,{class:"failure-box"},{default:g((()=>[j(i,{class:"failure"},{default:g((()=>[j(s,{name:"info-circle",color:"#ff0000",size:"40"})])),_:1}),j(i,{class:"text"},{default:g((()=>[M(b(N(F)("music.index.task.fail")),1)])),_:1})])),_:1})])),_:1})):(f(),m(i,{key:2,class:"video-content"},{default:g((()=>[j(i,{class:"body",style:W({aspectRatio:ce.value})},{default:g((()=>[j(c,{controls:!1,id:"myVideo",autoplay:!0,loop:!0,"show-center-play-btn":!1,onPlay:re,onPause:ve,src:ie.value,poster:oe.value},null,8,["src","poster"])])),_:1},8,["style"]),j(i,{class:"video-play",onClick:me},{default:g((()=>[de.value?R("",!0):(f(),m(n,{key:0,src:x}))])),_:1})])),_:1})),j(i,{class:G(["video-info","9/16"===ce.value?"is-mask":""])},{default:g((()=>[j(u,{"scroll-y":!0,style:{height:"100%"}},{default:g((()=>[j(i,{class:"info-title"},{default:g((()=>[M(b(N(F)("video.index.title")),1)])),_:1}),j(i,{class:"prompt",onClick:a[2]||(a[2]=a=>e.$tools.copy(ne.value))},{default:g((()=>[M(b(ne.value),1)])),_:1}),j(i,{class:"create-params"},{default:g((()=>[j(i,{class:"item"},{default:g((()=>[M(b(ee.value),1)])),_:1}),j(i,{class:"item"},{default:g((()=>[M(b(ue.value),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1},8,["style"]),j(i,{class:"btn-container"},{default:g((()=>[j(i,{class:"item",onClick:a[3]||(a[3]=a=>e.$tools.to("/pages/video/index?jobId="+X.value,!0))},{default:g((()=>[j(n,{src:T}),j(i,{class:"text"},{default:g((()=>[M(b(N(F)("video.creating.btn.edit")),1)])),_:1})])),_:1}),j(i,{class:"item",onClick:a[4]||(a[4]=a=>e.$tools.to("/pages/video/index",!0))},{default:g((()=>[j(n,{src:_}),j(i,{class:"text"},{default:g((()=>[M(b(N(F)("video.creating.btn.continue")),1)])),_:1})])),_:1}),j(i,{class:"item",onClick:ge},{default:g((()=>[j(n,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAF0WlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgOS4xLWMwMDIgNzkuYjdjNjRjY2Y5LCAyMDI0LzA3LzE2LTEyOjM5OjA0ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgMjYuMCAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMjUtMDYtMDlUMTI6MTk6NDgrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI1LTA2LTExVDE2OjIyOjIyKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI1LTA2LTExVDE2OjIyOjIyKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDowZjUyYjYyMS0xNjg3LTRjNWYtODQ1NS1iMTE4NDJjOTc5ODkiIHhtcE1NOkRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDpiMGU4NGZkNi1hYjQyLWE4NDQtODQxMC1lOGE4N2Y2NzQxZDYiIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1YzRkYjNhMS1hNmRkLTQ3OWItOWYxZS1iYzNmZjNkNjc0MTkiPiA8eG1wTU06SGlzdG9yeT4gPHJkZjpTZXE+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJjcmVhdGVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjVjNGRiM2ExLWE2ZGQtNDc5Yi05ZjFlLWJjM2ZmM2Q2NzQxOSIgc3RFdnQ6d2hlbj0iMjAyNS0wNi0wOVQxMjoxOTo0OCswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI2LjAgKE1hY2ludG9zaCkiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjBmNTJiNjIxLTE2ODctNGM1Zi04NDU1LWIxMTg0MmM5Nzk4OSIgc3RFdnQ6d2hlbj0iMjAyNS0wNi0xMVQxNjoyMjoyMiswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIDI2LjAgKE1hY2ludG9zaCkiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPC9yZGY6U2VxPiA8L3htcE1NOkhpc3Rvcnk+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+BuquQAAAAR9JREFUWIXt1sENhCAQBVBL8MzJErYUO1g7WEuwA0qwBEuwBEugBEtgIcGEmAFmGHCTDYd/0+E5gNBprTtKhBCziTLRiRwmI7U+FTMgIH5Ok74m6OMNtpmsgWzec++aoMUbaEB2soEaqIEaqIH+G+SK2fNIATmvgRLw/nbAQrVW6KOgQpirhUR0c0PUsWP1MdDLe3gX8Ek+EaZ4CtTYQ1Mfa7WKrZPcuCWhUCD3wlwLBWAW1C677aYiKAwmCCqNwmKioFIoCiYJ4qKoGBQoF5WDQYOoqFwMCYRFcTBkUArFxWSBQqgSmGxQAMXGsEAAio1hgzzU6TJz67FBpfNzAAhyO8S2HrpMPRF5/T4ukAQW59ORPmgSuLt0rdgNMVrLF9z978uF/uPCAAAAAElFTkSuQmCC"}),j(i,{class:"text"},{default:g((()=>[M(b(N(F)("video.creating.task.download")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])])),_:1})}}},[["__scopeId","data-v-86e6eb59"]]);export{F as default};
