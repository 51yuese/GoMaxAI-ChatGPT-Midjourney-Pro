import{u as e,r as t,a,b as s,a0 as n,U as o,a4 as l,bj as c,bk as i,i as r,a9 as u,_ as p,s as v,m as d,p as f,w as m,d as g,e as h,t as w,a1 as x,h as y,Q as C,j as z,aL as _}from"./index-5HZnFt5a.js";import{a as M}from"./uni-icons.mAW8qLNS.js";const U="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1753522361386'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4411'%20width='128'%20height='128'%20xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cpath%20d='M512%2074.666667C270.933333%2074.666667%2074.666667%20270.933333%2074.666667%20512S270.933333%20949.333333%20512%20949.333333%20949.333333%20753.066667%20949.333333%20512%20753.066667%2074.666667%20512%2074.666667z%20m0%20810.666666c-204.8%200-373.333333-168.533333-373.333333-373.333333S307.2%20138.666667%20512%20138.666667%20885.333333%20307.2%20885.333333%20512%20716.8%20885.333333%20512%20885.333333z'%20fill='%232c2c2c'%20p-id='4412'%3e%3c/path%3e%3cpath%20d='M448%20437.333333c17.066667%200%2032-14.933333%2032-32v-42.666666c0-17.066667-14.933333-32-32-32s-32%2014.933333-32%2032v42.666666c0%2017.066667%2014.933333%2032%2032%2032zM576%20437.333333c17.066667%200%2032-14.933333%2032-32v-42.666666c0-17.066667-14.933333-32-32-32s-32%2014.933333-32%2032v42.666666c0%2017.066667%2014.933333%2032%2032%2032zM320%20437.333333c17.066667%200%2032-14.933333%2032-32v-42.666666c0-17.066667-14.933333-32-32-32s-32%2014.933333-32%2032v42.666666c0%2017.066667%2014.933333%2032%2032%2032zM704%20330.666667c-17.066667%200-32%2014.933333-32%2032v42.666666c0%2017.066667%2014.933333%2032%2032%2032s32-14.933333%2032-32v-42.666666c0-17.066667-14.933333-32-32-32zM448%20586.666667c17.066667%200%2032-14.933333%2032-32v-42.666667c0-17.066667-14.933333-32-32-32s-32%2014.933333-32%2032v42.666667c0%2017.066667%2014.933333%2032%2032%2032zM576%20586.666667c17.066667%200%2032-14.933333%2032-32v-42.666667c0-17.066667-14.933333-32-32-32s-32%2014.933333-32%2032v42.666667c0%2017.066667%2014.933333%2032%2032%2032zM352%20554.666667v-42.666667c0-17.066667-14.933333-32-32-32s-32%2014.933333-32%2032v42.666667c0%2017.066667%2014.933333%2032%2032%2032s32-14.933333%2032-32zM704%20480c-17.066667%200-32%2014.933333-32%2032v42.666667c0%2017.066667%2014.933333%2032%2032%2032s32-14.933333%2032-32v-42.666667c0-17.066667-14.933333-32-32-32zM682.666667%20650.666667H341.333333c-17.066667%200-32%2014.933333-32%2032s14.933333%2032%2032%2032h341.333334c17.066667%200%2032-14.933333%2032-32s-14.933333-32-32-32z'%20fill='%232c2c2c'%20p-id='4413'%3e%3c/path%3e%3c/svg%3e",k="/h5/assets/voice1-CyBZWkq0.gif",S={__name:"audio-to-string",emits:["send","stop"],setup(p,{expose:v,emit:d}){const{t:f}=e(),m=d,g=async()=>{n(x.value)||(x.value.stop(),x.value=null),n(k.value)||(k.value.close(),k.value=null),h.value||await w()},h=t(!1),w=async()=>{await j();const e=M.value;if(n(e))return A(f("chat.audio.to.string.toast1"));m("send",e),M.value=""};t(null);const x=t(null),y=async()=>{M.value="";const e=await b();if(!e)return void o({title:f("chat.index.input.microphone"),icon:"none"});const t=new AudioContext({sampleRate:16e3}),a=t.createMediaStreamSource(e),s=t.createScriptProcessor(4096,1,1);s.onaudioprocess=e=>{const t=e.inputBuffer.getChannelData(0),a=new Int16Array(t.length);for(let o=0;o<t.length;o++){const e=Math.max(-1,Math.min(1,t[o]));a[o]=e<0?32768*e:32767*e}const s=C(a,16e3),n=_(s);k.value.send({data:JSON.stringify({type:"audio",chunk:n,sampleRate:16e3})})},a.connect(s),s.connect(t.destination),x.value={stop:()=>{e.getTracks().forEach((e=>e.stop())),t.close(),a.disconnect(),s.disconnect()}},await U()},C=(e,t)=>{const a=new ArrayBuffer(44+2*e.length),s=new DataView(a);z(s,0,"RIFF"),s.setUint32(4,36+2*e.length,!0),z(s,8,"WAVE"),z(s,12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,1,!0),s.setUint32(24,t,!0),s.setUint32(28,2*t,!0),s.setUint16(32,2,!0),s.setUint16(34,16,!0),z(s,36,"data"),s.setUint32(40,2*e.length,!0);const n=new Int16Array(a,44);for(let o=0;o<e.length;o++)n[o]=e[o];return a},z=(e,t,a)=>{for(let s=0;s<a.length;s++)e.setUint8(t+s,a.charCodeAt(s))},_=e=>{const t=new Uint8Array(e),a=Array.from(t).map((e=>String.fromCharCode(e))).join("");return btoa(a)},M=t(""),U=async()=>{await S()&&(k.value.onOpen((()=>{k.value.send({data:JSON.stringify({type:"init",format:"wav",sampleRate:16e3,appid:"",language:"zh-CN"})})})),k.value.onMessage((e=>{var t,a;let s={};try{s=JSON.parse(e.data)}catch(i){}const{type:o,data:c}=u(s);if("error"===o)g();else if("result"===o){const e=l(null==(t=null==c?void 0:c.payloadMsg)?void 0:t.result);if(e.length<=0)return;const s=null==(a=e[0])?void 0:a.text;if(n(s))return;M.value+=s}})),k.value.onError((()=>{g()})),k.value.onClose((e=>{g()})))},k=t(null),S=async()=>new Promise((e=>{k.value=c({url:i,success:t=>{e(!0)},fail:t=>{e(!1)}})})),b=()=>new Promise((e=>{navigator.mediaDevices.getUserMedia({audio:{sampleRate:16e3,channelCount:1,echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}}).then((t=>{e(t)})).catch((()=>{o({title:f("chat.index.input.microphoneError"),icon:"none"}),e(!1)}))})),A=e=>(o({title:e,icon:"none"}),!1);let D;const j=async(e=600)=>new Promise((t=>{n(D)||(clearTimeout(D),D=null),D=setTimeout((()=>{D=null,t(!0)}),e)}));return v({start:async()=>{await y()},stop:g,state:e=>{h.value=e}}),(e,t)=>{const n=r;return a(),s(n)}}},b=p({__name:"my-item",props:{text:{type:[String,Number],default:""}},setup(e){const t=e;v((()=>/^(http|https|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(t.text)));const n=v((()=>{var e;const a=null==(e=t.text)?void 0:e.split(".").pop().toLowerCase();return["pdf","doc","docx","xls","xlsx","ppt","pptx","txt","zip","rar","7z"].includes(a)})),o=v((()=>{var e;const a=null==(e=t.text)?void 0:e.split(".").pop().toLowerCase();return["mp3","wav","ogg","wma","aac","flac"].includes(a)})),l=v((()=>{var e;const a=null==(e=t.text)?void 0:e.split(".").pop().toLowerCase();return["mp4","mov","m4v","3gp","avi","m3u8","webm"].includes(a)})),c=v((()=>{var e;const a=null==(e=t.text)?void 0:e.split(".").pop().toLowerCase();return["jpg","jpeg","png","gif","bmp","svg","webp"].includes(a)})),i=v((()=>t.text.split("/").pop())),u=v((()=>{const e=t.text;return e?e.replace(/\n/g,"<br/>"):""})),p=()=>{const e=x(t.text);y.copy(e)};return(e,v)=>{const x=d(f("uni-icons"),M),y=C,U=r,k=z,S=_;return a(),s(U,{class:"my-item-box"},{default:m((()=>[n.value?(a(),s(U,{key:0},{default:m((()=>[g(x,{type:"folder-add",color:"#ffffff",size:"20"}),g(y,null,{default:m((()=>[h(w(i.value),1)])),_:1})])),_:1})):o.value?(a(),s(U,{key:1},{default:m((()=>[g(x,{type:"headphones",color:"#ffffff",size:"20"}),g(y,null,{default:m((()=>[h(w(i.value),1)])),_:1})])),_:1})):l.value?(a(),s(U,{key:2},{default:m((()=>[g(x,{type:"videocam",color:"#ffffff",size:"20"}),g(y,null,{default:m((()=>[h(w(i.value),1)])),_:1})])),_:1})):c.value?(a(),s(U,{key:3,onClick:p},{default:m((()=>[g(k,{src:t.message.text,mode:"aspectFill"},null,8,["src"])])),_:1})):(a(),s(U,{key:4,class:"message-text",onClick:p},{default:m((()=>[g(S,{nodes:u.value},null,8,["nodes"])])),_:1}))])),_:1})}}},[["__scopeId","data-v-d0affac5"]]);export{U as _,k as a,S as b,b as m};
