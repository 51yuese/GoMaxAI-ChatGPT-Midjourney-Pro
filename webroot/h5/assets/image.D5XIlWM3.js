var e,t;import{_ as a,m as s,W as i,p as l,a as o,b as u,w as n,d,L as r,aA as c,i as p,aq as m,b9 as f,ba as h,O as y,P as v,bb as _,bc as g,bd as b,be as w,bf as k,b6 as x,G as C,H as S,J as I,I as z,K as j,e as $,t as F,T as D,ah as O,M as R,j as P,Q as B,R as T,S as V,ar as A}from"./index-5HZnFt5a.js";import{_ as L}from"./uv-loading-icon.D2OVaaMI.js";const M=a({props:{src:{type:String,default:""},autoplay:{type:Boolean,default:!0}},data:()=>({videoSrc:"",show:!1}),computed:{getSec(){return this.src||this.videoSrc}},methods:{open(e){this.videoSrc=e,this.$refs.popup.open()},close(){this.$refs.popup.close()},change(e){this.show=e.show}}},[["render",function(e,t,a,m,f,h){const y=c,v=p,_=s(l("uv-popup"),i);return o(),u(_,{ref:"popup",onChange:h.change},{default:n((()=>[f.show?(o(),u(v,{key:0,class:"video-view"},{default:n((()=>[d(y,{class:"video",src:h.getSec,autoplay:a.autoplay},null,8,["src","autoplay"])])),_:1})):r("",!0)])),_:1},8,["onChange"])}],["__scopeId","data-v-ca9595a3"]]);function N(e,t){return["[object Object]","[object File]"].includes(Object.prototype.toString.call(e))?Object.keys(e).reduce(((a,s)=>(t.includes(s)||(a[s]=e[s]),a)),{}):{}}function U(e){return e.tempFiles.map((e=>({...N(e,["path"]),url:e.path,size:e.size,name:e.name,type:e.type})))}function q({accept:e,multiple:t,capture:a,compressed:s,maxDuration:i,sizeType:l,camera:o,maxCount:u}){return new Promise(((n,d)=>{switch(e){case"image":h({count:t?Math.min(u,9):1,sourceType:a,sizeType:l,success:e=>n(function(e){return e.tempFiles.map((e=>({...N(e,["path"]),type:"image",url:e.path,thumb:e.path,size:e.size,name:e.name})))}(e)),fail:d});break;case"video":f({sourceType:a,compressed:s,maxDuration:i,camera:o,success:e=>n(function(e){return[{...N(e,["tempFilePath","thumbTempFilePath","errMsg"]),type:"video",url:e.tempFilePath,thumb:e.thumbTempFilePath,size:e.size,name:e.name}]}(e)),fail:d});break;case"file":m({count:t?u:1,type:e,success:e=>n(U(e)),fail:d});break;default:m({count:t?u:1,type:"all",success:e=>n(U(e)),fail:d})}}))}const E=a({name:"uv-upload",emits:["error","beforeRead","oversize","afterRead","delete","clickPreview"],mixins:[y,v,{watch:{accept:{immediate:!0,handler(e){}}}},{props:{accept:{type:String,default:"image"},capture:{type:[String,Array],default:()=>["album","camera"]},compressed:{type:Boolean,default:!0},camera:{type:String,default:"back"},maxDuration:{type:Number,default:60},uploadIcon:{type:String,default:"camera-fill"},uploadIconColor:{type:String,default:"#D3D4D6"},useBeforeRead:{type:Boolean,default:!1},afterRead:{type:Function,default:null},beforeRead:{type:Function,default:null},previewFullImage:{type:Boolean,default:!0},previewFullVideo:{type:Boolean,default:!0},maxCount:{type:[String,Number],default:52},disabled:{type:Boolean,default:!1},imageMode:{type:String,default:"aspectFill"},name:{type:String,default:""},sizeType:{type:Array,default:()=>["original","compressed"]},multiple:{type:Boolean,default:!1},deletable:{type:Boolean,default:!0},maxSize:{type:[String,Number],default:Number.MAX_VALUE},fileList:{type:Array,default:()=>[]},uploadText:{type:String,default:""},width:{type:[String,Number],default:80},height:{type:[String,Number],default:80},previewImage:{type:Boolean,default:!0},...null==(t=null==(e=uni.$uv)?void 0:e.props)?void 0:t.upload}}],data:()=>({lists:[],isInCount:!0}),watch:{fileList:{deep:!0,immediate:!0,handler(){this.formatFileList()}},deletable(e){e||this.lists.map((e=>{e.deletable=this.deletable}))}},methods:{formatFileList(){const{fileList:e=[],maxCount:t}=this,a=e.map((e=>Object.assign(Object.assign({},e),{isImage:"image"===this.accept||_(e.url||e.thumb),isVideo:"video"===this.accept||g(e.url||e.thumb),deletable:"boolean"==typeof e.deletable?e.deletable:this.deletable})));this.lists=a,this.isInCount=a.length<t},chooseFile(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{const{maxCount:e,multiple:t,lists:a,disabled:s}=this;if(s)return;let i;try{i=b(this.capture)?this.capture:this.capture.split(",")}catch(l){i=[]}q(Object.assign({accept:this.accept,multiple:this.multiple,capture:i,compressed:this.compressed,maxDuration:this.maxDuration,sizeType:this.sizeType,camera:this.camera},{maxCount:e-a.length})).then((e=>{this.onBeforeRead(t?e:e[0])})).catch((e=>{this.$emit("error",e)}))}),100)},onBeforeRead(e){const{beforeRead:t,useBeforeRead:a}=this;let s=!0;w(t)&&(s=t(e,this.getDetail())),a&&(s=new Promise(((t,a)=>{this.$emit("beforeRead",Object.assign(Object.assign({file:e},this.getDetail()),{callback:e=>{e?t():a()}}))}))),s&&(k(s)?s.then((t=>this.onAfterRead(t||e))):this.onAfterRead(e))},getDetail(e){return{name:this.name,index:null==e?this.fileList.length:e}},onAfterRead(e){const{maxSize:t,afterRead:a}=this;(Array.isArray(e)?e.some((e=>e.size>t)):e.size>t)?this.$emit("oversize",Object.assign({file:e},this.getDetail())):("function"==typeof a&&a(e,this.getDetail()),this.$emit("afterRead",Object.assign({file:e},this.getDetail())))},deleteItem(e){this.$emit("delete",Object.assign(Object.assign({},this.getDetail(e)),{file:this.fileList[e]}))},onPreviewImage(e,t){const a=this.$uv.deepClone(this.lists);a.map(((e,a)=>{a==t&&(e.current=!0)}));const s=a.filter((e=>e.isImage)).findIndex((e=>e.current));this.onClickPreview(e,t),e.isImage&&this.previewFullImage&&x({urls:this.lists.filter((e=>"image"===this.accept||_(e.url||e.thumb))).map((e=>e.url||e.thumb)),current:s,fail(){this.$uv.toast("预览图片失败")}})},onPreviewVideo(e,t){this.onClickPreview(e,t),this.previewFullVideo&&e.isVideo&&this.$refs.previewVideo.open(e.url)},onClickPreview(e,t){this.$emit("clickPreview",Object.assign(Object.assign({},e),this.getDetail(t)))}}},[["render",function(e,t,a,i,c,m){const f=P,h=s(l("uv-icon"),C),y=B,v=p,_=s(l("uv-loading-icon"),L),g=s(l("uv-preview-video"),M);return o(),u(v,{class:"uv-upload",style:j([e.$uv.addStyle(e.customStyle)])},{default:n((()=>[d(v,{class:"uv-upload__wrap"},{default:n((()=>[e.previewImage?(o(!0),S(I,{key:0},z(c.lists,((t,a)=>(o(),u(v,{class:"uv-upload__wrap__preview",key:a},{default:n((()=>[t.isImage||t.type&&"image"===t.type?(o(),u(f,{key:0,src:t.thumb||t.url,mode:e.imageMode,class:"uv-upload__wrap__preview__image",onClick:e=>m.onPreviewImage(t,a),style:j([{width:e.$uv.addUnit(e.width),height:e.$uv.addUnit(e.height)}])},null,8,["src","mode","onClick","style"])):(o(),u(v,{key:1,class:"uv-upload__wrap__preview__other",onClick:e=>m.onPreviewVideo(t,a),style:j([{width:e.$uv.addUnit(e.width),height:e.$uv.addUnit(e.height)}])},{default:n((()=>[d(h,{color:"#80CBF9",size:"26",name:t.isVideo||t.type&&"video"===t.type?"movie":"folder"},null,8,["name"]),d(y,{class:"uv-upload__wrap__preview__other__text"},{default:n((()=>[$(F(t.isVideo||t.type&&"video"===t.type?"视频":"文件"),1)])),_:2},1024)])),_:2},1032,["onClick","style"])),"uploading"===t.status||"failed"===t.status?(o(),u(v,{key:2,class:"uv-upload__status"},{default:n((()=>[d(v,{class:"uv-upload__status__icon"},{default:n((()=>["failed"===t.status?(o(),u(h,{key:0,name:"close-circle",color:"#ffffff",size:"25"})):(o(),u(_,{key:1,size:"22",mode:"circle"}))])),_:2},1024),t.message?(o(),u(y,{key:0,class:"uv-upload__status__message"},{default:n((()=>[$(F(t.message),1)])),_:2},1024)):r("",!0)])),_:2},1024)):r("",!0),"uploading"!==t.status&&(e.deletable||t.deletable)?(o(),u(v,{key:3,class:"uv-upload__deletable",onClick:D((e=>m.deleteItem(a)),["stop"])},{default:n((()=>[d(v,{class:"uv-upload__deletable__icon"},{default:n((()=>[d(h,{name:"close",color:"#ffffff",size:"10"})])),_:1})])),_:2},1032,["onClick"])):r("",!0),"success"===t.status?(o(),u(v,{key:4,class:"uv-upload__success"},{default:n((()=>[d(v,{class:"uv-upload__success__icon"},{default:n((()=>[d(h,{name:"checkmark",color:"#ffffff",size:"12"})])),_:1})])),_:1})):r("",!0)])),_:2},1024)))),128)):r("",!0),c.isInCount?(o(),u(v,{key:1,onClick:m.chooseFile},{default:n((()=>[O(e.$slots,"default",{},(()=>[d(v,{class:R(["uv-upload__button",[e.disabled&&"uv-upload__button--disabled"]]),"hover-class":e.disabled?"":"uv-upload__button--hover","hover-stay-time":"150",onClick:D(m.chooseFile,["stop"]),style:j([{width:e.$uv.addUnit(e.width),height:e.$uv.addUnit(e.height)}])},{default:n((()=>[d(h,{name:e.uploadIcon,size:"26",color:e.uploadIconColor},null,8,["name","color"]),e.uploadText?(o(),u(y,{key:0,class:"uv-upload__button__text"},{default:n((()=>[$(F(e.uploadText),1)])),_:1})):r("",!0)])),_:1},8,["hover-class","onClick","class","style"])]),!0)])),_:3},8,["onClick"])):r("",!0)])),_:3}),d(g,{ref:"previewVideo"},null,512)])),_:3},8,["style"])}],["__scopeId","data-v-245558e8"]]),G=a({__name:"image",props:T({title:{type:String,default:"上传"},titleStyle:{type:Object,default:()=>({})},multiple:{type:Boolean,default:!1},max:{type:Number,default:9}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,a=V(e,"modelValue");async function i(e){let t=[].concat(e.file),s=a.value.length;t.map((e=>{a.value.push({...e,status:"uploading",message:"上传中"})}));for(let i=0;i<t.length;i++){const e=await A.upload(t[i].url);let l=a.value[s];a.value.splice(s,1,Object.assign(l,{status:"success",message:"",url:e.data})),s++}}function r(e){a.value.splice(e.index,1)}return(e,c)=>{const m=s(l("uv-icon"),C),f=B,h=p,y=s(l("uv-upload"),E);return o(),u(y,{fileList:a.value,multiple:t.multiple,maxCount:t.max,onAfterRead:i,onDelete:r},{default:n((()=>[d(h,{class:"upload-box"},{default:n((()=>[d(m,{name:"plus"}),d(f,{style:j([{"margin-top":"15rpx"},[e.$uv.addStyle(t.titleStyle)]])},{default:n((()=>[$(F(t.title),1)])),_:1},8,["style"])])),_:1})])),_:1},8,["fileList","multiple","maxCount"])}}},[["__scopeId","data-v-10b82ee7"]]);export{G as a};
