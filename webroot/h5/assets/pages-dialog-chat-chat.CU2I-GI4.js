import{_ as e,r as l,s as a,C as o,a7 as t,m as n,W as s,p as u,a as i,b as r,w as c,d,e as p,H as v,J as f,I as g,t as m,L as h,X as y,Y as _,U as x,ab as k,N as w,i as b,j as C,V as T,l as I,o as R,G as O,ah as N,M as z,K as S,g as j,h as q,ay as A,k as B,Q as K,q as H,aJ as U,T as E,ad as M,c as G,ak as P,a1 as $,a8 as D,aK as F,B as L,F as J}from"./index-5HZnFt5a.js";import{_ as V}from"./uv-input.DP28rKYF.js";import{_ as W}from"./uv-modal.Clrzaq6u.js";import{E as Y,m as Q,_ as X}from"./MyChatItem.CWl-ZwNN.js";import{C as Z,c as ee}from"./chatItem.B7d2C8sU.js";import{_ as le}from"./uni-icons.mAW8qLNS.js";import{_ as ae}from"./air.BsGE5UBU.js";import{d as oe}from"./dialog.CErO1ANM.js";import{_ as te}from"./checkmark-circle.BQbyG57L.js";import{a as ne}from"./index.BIXFsUHK.js";import"./uv-line.rnRAS3LR.js";import"./uv-loading-icon.D2OVaaMI.js";import"./zero-markdown-view.36PbCcI6.js";const se=e({__name:"SwitchModal",props:{showTabBar:{type:Boolean,default:!0},think:{type:Boolean,default:!1}},emits:["change"],setup(e,{expose:I,emit:R}){const O=l(),N=l([]),z=l({}),S=R,j=l([]),q=a((()=>{var e;return JSON.parse((null==(e=z.value)?void 0:e.config)||"{}")})),A=e;async function B(e){return await async function(){const{data:e}=await oe.getChatGroup({modelType:"chat"});j.value=e}(),j.value.find((l=>l.id===e))}async function K(e){y({title:"模型切换中"}),await oe.update({groupId:z.value.id,config:JSON.stringify({modelTypeInfo:"",modelInfo:e})});const l=await B(z.value.id);var a;a=l,k((()=>{w("CHAT_CHAT_GROUP",a),z.value=a})),_(),x({title:"模型切换成功",icon:"success"}),O.value.close(),S("change",l)}return o((()=>{z.value=t("CHAT_CHAT_GROUP"),async function(){const{data:e}=await oe.models({modelType:"chat",page:1,size:20});if(console.log(A.think,"props.think.value"),A.think){let l=[];e.rows.forEach((e=>{1===e.deepthink&&l.push(e)})),N.value=l}else N.value=e.rows;console.log(A.think,N.value)}()})),I({open:function(){var e;null==(e=O.value)||e.open()}}),(l,a)=>{const o=b,t=C,y=T,_=n(u("uv-popup"),s);return i(),r(_,{ref_key:"popupRef",ref:O,round:"48rpx",duration:0,mode:"bottom","z-index":999,customStyle:{backgroundColor:"#f4f7ff",marginBottom:e.showTabBar?"40px":0}},{default:c((()=>[d(o,{class:"container"},{default:c((()=>[d(o,{style:{color:"#666666","font-size":"24rpx",padding:"24rpx 0"}},{default:c((()=>[p("选择以下适合你的模型")])),_:1}),d(y,{"scroll-y":"true",style:{overflow:"auto","max-height":"730rpx"}},{default:c((()=>[d(o,{class:"scroll-info"},{default:c((()=>[(i(!0),v(f,null,g(N.value,(e=>(i(),r(o,{key:e.id,onClick:l=>K(e),class:"model-box model-bg flex-between"},{default:c((()=>[d(o,{class:"items-center",style:{flex:"1"}},{default:c((()=>[d(o,{class:"model-cover"},{default:c((()=>[d(t,{src:e.cover,style:{width:"70rpx",height:"70rpx"}},null,8,["src"])])),_:2},1024),d(o,{style:{flex:"1",display:"flex","flex-direction":"column",gap:"4rpx"}},{default:c((()=>[d(o,{class:"items-center"},{default:c((()=>[d(o,{class:"model-name",style:{"margin-right":"12rpx"}},{default:c((()=>[p(m(e.modelName),1)])),_:2},1024),-1===e.vipFreeNum?(i(),r(o,{key:0,class:"model-vip"},{default:c((()=>[p("会员免费")])),_:1})):e.vipFreeNum>0&&e.vipFreeNum>e.used?(i(),r(o,{key:1,class:"model-default"},{default:c((()=>[p(" 今日免费剩余:"+m(e.vipFreeNum-e.used)+"/"+m(e.vipFreeNum),1)])),_:2},1024)):(i(),r(o,{key:2,class:"model-default"},{default:c((()=>[p(m(e.deduct)+"积分/次",1)])),_:2},1024))])),_:2},1024),d(o,{class:"uv-line-1 model-desc"},{default:c((()=>[p(m(e.description),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),d(o,null,{default:c((()=>{var l,a;return[(null==e?void 0:e.modelName)===(null==(a=null==(l=q.value)?void 0:l.modelInfo)?void 0:a.modelName)?(i(),r(t,{key:0,src:te,style:{height:"50rpx",width:"50rpx"}})):h("",!0)]})),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1},8,["customStyle"])}}},[["__scopeId","data-v-dfa45284"]]),ue=e({__name:"ChatInput",props:{count:{type:Number,default:0},group:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},inputStatus:{type:Boolean,default:!1},showClear:{type:Boolean,default:!0},blurTo:{type:Boolean,default:!1},from:{type:String,default:""},groupKey:{type:String,default:""}},emits:["change","input","height","clear","cancel"],setup(e,{emit:o}){I();const t=l(!1),s=o,w=e;R((()=>{!async function(){const{data:e}=await oe.gptsQuery({page:1,size:20,status:1});D.value=e.rows,k((()=>{s("height")}))}()}));let H=e=>{Y.emit("changeDeepThink",e)},U=()=>{Y.emit("inputCreateGroup")};const E=l(),M=a((()=>{var e,l,a;return(null==(l=null==(e=w.config)?void 0:e.modelInfo)?void 0:l.deepthink)||(null==(a=D.value.filter((e=>{var l,a;return e.id==(null==(a=null==(l=w.config)?void 0:l.modelInfo)?void 0:a.id)}))[0])?void 0:a.deepthink)||0})),G=a((()=>{var e,l,a,o,t,n;return console.log((null==(l=null==(e=w.config)?void 0:e.modelInfo)?void 0:l.quickList)||(null==(a=D.value.filter((e=>{var l,a;return e.id==(null==(a=null==(l=w.config)?void 0:l.modelInfo)?void 0:a.id)}))[0])?void 0:a.quickList)||[],"props.config?.modelInfo?.quickList || (gpts.value.filter(ele=>ele.id==props.config?.modelInfo?.id))[0]?.quickList||[]"),(null==(t=null==(o=w.config)?void 0:o.modelInfo)?void 0:t.quickList)||(null==(n=D.value.filter((e=>{var l,a;return e.id==(null==(a=null==(l=w.config)?void 0:l.modelInfo)?void 0:a.id)}))[0])?void 0:n.quickList)||[]})),P=l(""),$=l(!1),D=l([]),F=l({}),L=a((()=>{var e;return(null==(e=F.value.demoData)?void 0:e.split("\n"))||[]})),J=l(""),W=l({});const Q=()=>{"dialog"===w.from&&q.to("/pages/dialog/chat/chat",!0)};function X(){var e,l;let a=P.value,o="";if(J.value&&(a=J.value+" "+a),a){if(Object.keys(W.value).length&&(null==(l=null==(e=W.value.config)?void 0:e.tags)?void 0:l.length)){let e={},l=!1;if(W.value.config.tags.some((a=>{var o;if(!(null==(o=a.value)?void 0:o.trim())&&1==a.required)return x({title:"请选择或填写"+a.key,icon:"none"}),l=!0,!0;e[a.key]=a.value})),l)return;e["输入内容"]=a,a=Z(W.value.config.format,e),o=W.value.prompt}s("input",a,o),P.value="",J.value="",ue()}else x({title:"请输入你的问题",icon:"none"})}const Z=(e,l)=>e.replace(/\{\{([\u4e00-\u9fa5\w.]+)\}\}/g,((e,a)=>{try{let e=a.split(".").reduce(((e,l)=>null==e?void 0:e[l]),l);return void 0!==e?e:`[未定义：${a}]`}catch(o){return console.error(`解析失败: ${a} => ${o.message}`),"[错误]"}}));function ee(){$.value=!$.value,k((()=>{s("height")}))}async function te(){A({title:"提示",content:"确定清空该应用对话吗？",confirmColor:"#10A37F",success:async e=>{var l;e.confirm&&(await oe.clear({groupId:w.group.id,type:(null==(l=w.group)?void 0:l.modelName)?"gpts":"chat"}),$.value=!1,s("clear"))}})}function ne(){s("cancel")}const ue=()=>{t.value=!1,W.value={}};async function ie(){J.value=await q.upload(),ee()}const re=e=>{console.log(22,e)},ce=e=>{console.log(22,e)};return(l,a)=>{const o=C,I=b,R=T,q=n(u("uv-icon"),O),A=B,D=n(u("uv-input"),V),Y=K;return i(),v(f,null,[d(I,null,{default:c((()=>{var n;return[d(I,{class:"extra-btn"},{default:c((()=>[N(l.$slots,"modal",{},void 0,!0),d(R,{"scroll-x":"",style:{"white-space":"nowrap",flex:"1","min-width":"0"},onClick:Q},{default:c((()=>["CHAT_CHAT_GROUP"===e.groupKey||"dialog"===e.from?(i(),r(I,{key:0,class:"btns"},{default:c((()=>[(i(!0),v(f,null,g(G.value,((e,l)=>(i(),r(I,{class:"btn-item",key:l,onClick:l=>{return a=e,W.value=a,void(t.value=!0);var a}},{default:c((()=>[d(o,{src:e.icon,mode:""},null,8,["src"]),d(I,null,{default:c((()=>[p(m(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):h("",!0)])),_:1}),t.value?(i(),r(I,{key:0,class:"select-container"},{default:c((()=>{var e,l;return[d(q,{name:"/static/close.png",size:"14",onClick:ue,style:{position:"absolute",top:"20rpx",right:"20rpx"}}),d(I,{class:"title"},{default:c((()=>[p(m(W.value.name),1)])),_:1}),(i(!0),v(f,null,g(null==(l=null==(e=W.value)?void 0:e.config)?void 0:l.tags,((e,l)=>(i(),r(I,{class:"select-group",key:l},{default:c((()=>[d(I,{class:"group-name"},{default:c((()=>[p(m(e.key),1)])),_:2},1024),d(R,{"scroll-x":"",style:{"white-space":"nowrap",width:"100%","min-width":"0","overflow-y":"hidden"}},{default:c((()=>[d(I,{class:"group-items"},{default:c((()=>{var l;return[(i(!0),v(f,null,g(null==(l=e.options)?void 0:l.split(","),((l,a)=>(i(),r(I,{class:z(["group-item",{active:Object.keys(W.value).length&&e.value===l}]),key:a,onClick:a=>e.value=l},{default:c((()=>[p(m(l),1)])),_:2},1032,["class","onClick"])))),128))]})),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))]})),_:1})):h("",!0)])),_:3}),void 0!==F.value.demoData&&(null==(n=F.value.demoData)?void 0:n.length)>0&&0===w.count&&!J.value?(i(),r(I,{key:0,class:"testimonials_List"},{default:c((()=>[(i(!0),v(f,null,g(L.value,((e,l)=>(i(),r(I,{class:"Testimonials_item",key:l,onClick:l=>{return a=e,y({title:"加载中.."}),s("change",F.value.id),void setTimeout((()=>{a?(s("input",a),_()):x({title:"请输入你的问题",icon:"none"})}),800);var a}},{default:c((()=>[d(I,{class:"Testimonials uv-line-2"},{default:c((()=>[p(m(e),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):h("",!0),J.value?(i(),r(I,{key:1,class:"file-box"},{default:c((()=>[d(I,{style:{position:"relative",display:"flex"}},{default:c((()=>[d(I,{style:{position:"relative",display:"flex"}},{default:c((()=>[d(o,{src:J.value,style:{width:"64rpx",height:"64rpx","border-radius":"12rpx"}},null,8,["src"]),d(I,{class:"close-image",onClick:a[0]||(a[0]=e=>(J.value="",void k((()=>{s("height")}))))},{default:c((()=>[d(q,{name:"close-circle-fill",size:"17"})])),_:1})])),_:1})])),_:1})])),_:1})):h("",!0),d(I,{style:S([{position:"relative"},t.value?"border-radius: 0 0 40rpx 40rpx;border-top: 1rpx solid #E0E2E9;":""]),onClick:Q,class:"newInputBox"},{default:c((()=>{var l,t;return[d(D,{placeholder:(null==(t=null==(l=W.value)?void 0:l.config)?void 0:t.placeholder)||"请输入你的问题",border:"surround",modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),focus:!e.blurTo&&"dialog"!==e.from,placeholderStyle:"color: #999999; font-size: 32rpx;",customStyle:{background:"#fff",borderRadius:J.value?"0 0 24rpx 24rpx":"40rpx",boxShadow:"none",border:"none",height:"88rpx"},disabledColor:"#ffffff",disabled:w.inputStatus,onFocus:ce,onKeyboardheightchange:re,safeAreaInsetBottom:"",adjustPosition:!1},{prefix:c((()=>{var e,l;return[(null==(l=null==(e=w.config)?void 0:e.modelInfo)?void 0:l.canAudio)?(i(),r(q,{key:0,name:"mic",size:"60rpx"})):h("",!0)]})),suffix:c((()=>[h("",!0)])),_:1},8,["placeholder","modelValue","focus","customStyle","disabled"]),d(I,{class:"flexInputBtn"},{default:c((()=>[d(I,{class:"left"},{default:c((()=>[w.inputStatus?h("",!0):(i(),v(f,{key:0},[$.value?(i(),r(o,{key:0,src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/closeIcon.svg",style:{width:"50rpx",height:"50rpx"},onClick:ee,mode:""})):(i(),r(o,{key:1,src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/addIcon.svg",style:{width:"50rpx",height:"50rpx"},onClick:ee,mode:""}))],64)),M.value&&"CHAT_CHAT_GROUP"===e.groupKey?(i(),r(I,{key:1,class:"deepThinkBox",onClick:a[2]||(a[2]=e=>E.value.open())},{default:c((()=>[d(o,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/deepThinkIcon.svg",mode:""}),d(I,null,{default:c((()=>[p("深度思考")])),_:1})])),_:1})):(i(),r(I,{key:2,class:"deepThinkBox noDeep",onClick:a[3]||(a[3]=e=>E.value.open())},{default:c((()=>[d(o,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/deepThinkIcon2.svg",mode:""}),d(I,null,{default:c((()=>[p("深度思考")])),_:1})])),_:1}))])),_:1}),d(I,{class:"right"},{default:c((()=>[w.inputStatus?(i(),r(o,{key:0,src:le,onClick:ne,style:{width:"60rpx",height:"60rpx"}})):(i(),r(A,{key:1,class:z(["btn-primary btn-send",P.value?"":"btn-disabled"]),onClick:X},{default:c((()=>[d(o,{src:ae,style:{width:"28rpx",height:"28rpx"}})])),_:1},8,["class"]))])),_:1})])),_:1}),"dialog"===e.from?(i(),r(I,{key:0,style:{position:"absolute",width:"100%",height:"100%",top:"0",left:"0"}})):h("",!0)]})),_:1},8,["style"]),d(I,{class:"flex-between",style:S([{overflow:"hidden","max-height":"0",transition:"all 0.3s ease-in-out",gap:"34rpx"},$.value&&!w.inputStatus?"max-height: 114rpx;margin-top: 20rpx;":""])},{default:c((()=>{var l,a;return[(null==(a=null==(l=w.config)?void 0:l.modelInfo)?void 0:a.canUpload)?(i(),r(I,{key:0,class:"dropdown-card",onClick:ie},{default:c((()=>[d(o,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/attach.svg",style:{width:"40rpx",height:"40rpx"}}),d(Y,null,{default:c((()=>[p("文件上传")])),_:1})])),_:1})):h("",!0),e.showClear?(i(),r(I,{key:1,class:"dropdown-card",onClick:te},{default:c((()=>[d(o,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/clear.svg",style:{width:"40rpx",height:"40rpx"}}),d(Y,null,{default:c((()=>[p("清除记录")])),_:1})])),_:1})):h("",!0),d(I,{class:"dropdown-card",onClick:j(U)},{default:c((()=>[d(o,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/addChat.svg",style:{width:"40rpx",height:"40rpx"}}),d(Y,null,{default:c((()=>[p("新建对话")])),_:1})])),_:1},8,["onClick"])]})),_:1},8,["style"])]})),_:3}),d(se,{ref_key:"modalPopupRef",ref:E,think:!0,"show-tab-bar":!1,onChange:j(H)},null,8,["onChange"])],64)}}},[["__scopeId","data-v-1b6acba5"]]),ie=e({__name:"ChatContent",props:{groupKey:{type:String,default:""},config:{type:Object,default:()=>({})},blurTo:{type:Boolean,default:!1}},emits:["change"],setup(e,{expose:o,emit:n}){const s=I(),u=H(),O=l({}),N=M(),z=l([]),q=n,B=e;let D=l(null);const F=l(),L=a((()=>{let e=N.ctx.$uv.sys().windowBottom;return ae.value>0&&(e=-20),e+V.value+ae.value})),J=l(),V=l(0),W=l(0),le=l(0),ae=l(0),te=l(null),ne=l([]),se=l(0),ie=l(null);function re(){U().in(N.proxy).select(".inputRef").boundingClientRect((e=>{V.value=e.height})).exec()}function ce(){k((()=>{U().in(N.proxy).select("#scroll-view-content").boundingClientRect((e=>{let l=e.height-L.value;l>0&&(W.value=l)})).exec()}))}function de(){setTimeout((()=>{re(),ce()}),200)}async function pe(e,l){var a,o,n,s,i;ve(),w("CURRENT_KEYWORD",e),ie.value=!0,z.value.push({text:e,conversationOptions:null}),de(),function(e){te.value=setInterval((()=>{var l,a,o;const t=ne.value[se.value];if(t&&(null==t?void 0:t.id)){const n=z.value.findIndex((e=>e.id===t.id));n>-1?z.value[n]={...t,systemMessage:e}:z.value.push(t),se.value++,ce(),((null==(o=null==(a=null==(l=null==t?void 0:t.detail)?void 0:l.choices)?void 0:a[0])?void 0:o.finish_reason)||(null==t?void 0:t.is_end))&&(console.log("结束"),ve(),u.getUserInfo())}}),100)}(l);const r=z.value.findIndex((e=>{var l;return(null==e?void 0:e.parentMessageId)||(null==(l=null==e?void 0:e.conversationOptions)?void 0:l.parentMessageId)})),c={appId:0,prompt:e,options:{parentMessageId:(null==(a=z.value[r])?void 0:a.parentMessageId)||(null==(n=null==(o=z.value[r])?void 0:o.conversationOptions)?void 0:n.parentMessageId)||"",groupId:null==(s=O.value)?void 0:s.id,type:(null==(i=O.value)?void 0:i.modelName)?"gpts":"",usingNetwork:!1},systemMessage:l},d={Authorization:`Bearer ${t("token")}`,"Content-Type":"application/json"};me.value.startChat({url:P+"/api/chatgpt/chat-process",headers:d,body:c})}function ve(){clearInterval(te.value),te.value=null,ie.value=null,se.value=0,ne.value=[],_e.value="",ie.value&&(me.value.stopChat(),de())}function fe(e){ve(),q("change",e)}async function ge(e){var l,a;y({title:"加载中"});const{data:o}=await oe.chatList({groupId:null==(l=O.value)?void 0:l.id,logType:(null==(a=O.value)?void 0:a.modelName)?2:1});if(z.value=o||[],e)return _();t("CURRENT_KEYWORD")&&pe(t("CURRENT_KEYWORD")),de(),_()}a((()=>{var e,l;return null==(l=null==(e=s.query)?void 0:e.guideAnswer)?void 0:l.split("/")})),Y.on("chatscrollToBottom",(()=>{console.log("chatscrollToBottom"),setTimeout((()=>{re(),ce()}),500)}));const me=l(null),he=()=>{console.log("open sse")},ye=e=>{x({title:e||"接口异常，请稍后重试",icon:"none"}),ve()},_e=l(""),xe=async e=>{console.log("message sse",e);const l=JSON.parse(e);"object"==typeof l&&(_e.value=_e.value+$(l.think),ne.value.push({...l,think:$(_e.value)}))},ke=()=>{console.log("finish sse"),4===B.config.modelInfo.keyType&&(ie.value=null)},we=()=>{z.value=[],de()};R((()=>{k((()=>{be(),(async e=>{const{data:l}=await G.query({keys:["chatGuide"]});console.log("data--",l),D.value=l})()})),setTimeout((()=>{ce()}),1e3)}));const be=()=>{ve(),O.value=t(B.groupKey),ge(!0),de()};return o({clearRecord:async()=>{A({title:"提示",content:"确定清空该应用对话吗？",confirmColor:"#10A37F",success:async e=>{var l,a;e.confirm&&(await oe.clear({groupId:null==(l=O.value)?void 0:l.id,type:(null==(a=O.value)?void 0:a.modelName)?"gpts":"chat"}),we())}})},cancelRequest:ve,init:be}),(l,a)=>{const o=K,t=C,n=b,s=T;return i(),r(n,{style:{height:"100%"}},{default:c((()=>[d(Z,{ref_key:"chatSSEClientRef",ref:me,onOnOpen:he,onOnError:ye,onOnMessage:xe,onOnFinish:ke},null,512),d(n,{ref_key:"chatRef",ref:F,class:"chatRef",style:S(`height: calc(100% - ${L.value}px); position: relative`)},{default:c((()=>[d(s,{"scroll-y":"true",style:{overflow:"auto",height:"100%","box-sizing":"border-box"},"scroll-top":W.value,onScroll:a[0]||(a[0]=e=>le.value=e.detail.scrollTop)},{default:c((()=>[d(n,{id:"scroll-view-content",style:{height:"auto","box-sizing":"border-box","padding-bottom":"80rpx"}},{default:c((()=>[d(n,{class:"demo-piece"},{default:c((()=>[d(ee,{group:O.value,config:e.config,"show-title":!0,"show-avatar":!0,"show-toolbar":!1},null,8,["group","config"]),0===z.value.length?(i(),r(n,{key:0,class:"tips-box"},{default:c((()=>[d(n,{class:"refreshFlex"},{default:c((()=>[d(o,null,{default:c((()=>[p("你可以试着问我：")])),_:1}),d(n,{class:"refreshRight"},{default:c((()=>[d(t,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/refreshIcon.svg",mode:""}),d(o,null,{default:c((()=>[p("换一批")])),_:1})])),_:1})])),_:1}),(i(!0),v(f,null,g(j(D),((e,l)=>(i(),r(n,{class:"tips-item",key:l,onClick:l=>pe(e.content)},{default:c((()=>[d(n,{class:"word uv-line-1",style:{"margin-right":"20rpx"}},{default:c((()=>[p(m(e.content),1)])),_:2},1024),d(t,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/tipSend.svg",mode:""})])),_:2},1032,["onClick"])))),128))])),_:1})):h("",!0)])),_:1}),(i(!0),v(f,null,g(z.value,((l,a)=>{return i(),v(f,{key:a},[null===l.conversationOptions&&(o=l.text,/^(http|https|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(o.split(" ")[0]))?(i(),v(f,{key:0},[d(n,null,{default:c((()=>[d(n,{class:"flex-end",style:{margin:"50rpx 0 20rpx"}},{default:c((()=>[d(n,{class:"myMessage",style:{"max-width":"570rpx","overflow-wrap":"break-word"}},{default:c((()=>[d(Q,{message:{text:l.text.split(" ")[0]}},null,8,["message"])])),_:2},1024)])),_:2},1024)])),_:2},1024),l.text.split(" ")[1]?(i(),r(n,{key:0},{default:c((()=>[d(n,{class:"flex-end",style:{margin:"50rpx 0 20rpx"}},{default:c((()=>[d(n,{class:"myMessage",style:{"max-width":"570rpx","overflow-wrap":"break-word"}},{default:c((()=>[d(Q,{message:{text:l.text.split(" ")[1]}},null,8,["message"])])),_:2},1024)])),_:2},1024)])),_:2},1024)):h("",!0)],64)):null===l.conversationOptions?(i(),r(n,{key:1},{default:c((()=>[d(n,{class:"flex-end",style:{margin:"50rpx 0 20rpx"}},{default:c((()=>[d(n,{class:"myMessage",style:{"max-width":"570rpx","overflow-wrap":"break-word"}},{default:c((()=>[d(Q,{message:l},null,8,["message"])])),_:2},1024)])),_:2},1024)])),_:2},1024)):(i(),r(ee,{key:2,message:l,group:O.value,config:e.config,"show-title":!1,"show-toolbar":!0,onDelete:ge,onInput:pe,"show-loading":!l.text,"input-status":!!ie.value,"group-key":e.groupKey},null,8,["message","group","config","show-loading","input-status","group-key"]))],64);var o})),128)),null!==ie.value&&0===se.value?(i(),r(ee,{key:0,group:O.value,config:e.config,"show-title":!1,"show-toolbar":!1,"show-loading":!0,groupKey:e.groupKey},null,8,["group","config","groupKey"])):h("",!0)])),_:1})])),_:1},8,["scroll-top"]),d(n,{ref_key:"inputRef",ref:J,class:"inputRef",style:S({bottom:ae.value+"px"})},{default:c((()=>[d(ue,{onHeight:de,onChange:fe,onInput:pe,onClear:we,onCancel:ve,group:O.value,config:e.config,count:z.value.length,"input-status":!!ie.value,blurTo:e.blurTo,groupKey:e.groupKey},null,8,["group","config","count","input-status","blurTo","groupKey"])])),_:1},8,["style"]),W.value-le.value>700&&le.value>0?(i(),r(t,{key:0,class:"glide",src:X,onClick:a[1]||(a[1]=E((e=>{W.value+=1,de()}),["stop"]))})):h("",!0)])),_:1},8,["style"])])),_:1})}}},[["__scopeId","data-v-1932e13e"]]),re=e({__name:"chat",setup(e){const s=l(),v=l(),f=l(""),g=l(),h=l(!1),x=l(!1);async function k(){var e;y({title:"修改中"}),await oe.update({groupId:null==(e=I.value)?void 0:e.id,title:f.value}),I.value.title=f.value,w("CHAT_CHAT_GROUP",I.value),_(),v.value.close()}Y.on("changeDeepThink",(e=>{var l;I.value=e,null==(l=s.value)||l.init()})),Y.on("inputCreateGroup",(()=>{T()}));const T=async()=>{const{data:e}=await oe.create({modelType:"chat"});w("CHAT_CHAT_GROUP",e),q.redirectTo("/pages/dialog/chat/chat?blurTo=1",!0)};const I=l({}),R=a((()=>{var e;return JSON.parse((null==(e=I.value)?void 0:e.config)||"{}")}));return o((()=>{I.value=t("CHAT_CHAT_GROUP")})),D((()=>{var e;F("CURRENT_KEYWORD"),null==(e=s.value)||e.cancelRequest()})),L((e=>{h.value=Boolean(null==e?void 0:e.blurTo)})),(e,l)=>{const a=J("ai-bindphone"),o=J("ai-privacy"),t=n(u("uv-icon"),O),y=C,_=K,w=b,T=n(u("uv-input"),V),N=n(u("uv-modal"),W);return i(),r(w,{class:"page-dialog-chat-chat",onClick:l[4]||(l[4]=e=>x.value=!1),style:{"background-color":"#f2f3f7"}},{default:c((()=>[d(a,{ref:"aiPrivacyRef"},null,512),d(o,{ref:"aiPrivacyRef"},null,512),d(ne,{bg:!1},{left:c((()=>[d(w,{class:"back"},{default:c((()=>[d(t,{name:"arrow-left",bold:"",size:"22",color:"#000",onClick:l[0]||(l[0]=l=>e.$tools.back())}),d(w,{class:"nav-info",onClick:l[1]||(l[1]=e=>g.value.open())},{default:c((()=>{var e,l,a;return[d(y,{src:(null==(l=null==(e=R.value)?void 0:e.modelInfo)?void 0:l.cover)||(null==(a=I.value)?void 0:a.logo)},null,8,["src"]),d(w,{class:"info"},{default:c((()=>[d(w,{class:"name"},{default:c((()=>[d(_,{class:"uv-line-1"},{default:c((()=>{var e,l;return[p(m(null==(l=null==(e=R.value)?void 0:e.modelInfo)?void 0:l.modelName),1)]})),_:1}),d(y,{src:"https://ziliao-1259214170-1259214170.cos.ap-shanghai.myqcloud.com/gomaxai111-uni/selectIcon.svg",style:{"margin-left":"10rpx",width:"16rpx",height:"16rpx"},mode:""})])),_:1}),d(w,{class:"desc uv-line-1"},{default:c((()=>{var e,l;return[p(m(null==(l=null==(e=R.value)?void 0:e.modelInfo)?void 0:l.description),1)]})),_:1})])),_:1})]})),_:1})])),_:1})])),_:1}),d(w,{style:{height:"20rpx"}}),d(w,{style:S({height:`calc(${e.$tools.height().contentHeight}px - 20rpx)`})},{default:c((()=>[d(ie,{ref_key:"chatContentRef",ref:s,"group-key":"CHAT_CHAT_GROUP",config:R.value,blurTo:h.value},null,8,["config","blurTo"])])),_:1},8,["style"]),d(N,{ref_key:"groupNameRef",ref:v,title:"修改对话名称",showCancelButton:!0,onConfirm:k},{default:c((()=>[d(T,{modelValue:f.value,"onUpdate:modelValue":l[2]||(l[2]=e=>f.value=e)},null,8,["modelValue"])])),_:1},512),d(se,{ref_key:"modalPopupRef",ref:g,"show-tab-bar":!1,onChange:l[3]||(l[3]=e=>{var l;I.value=e,null==(l=s.value)||l.init()})},null,512)])),_:1})}}},[["__scopeId","data-v-da110dc1"]]);export{re as default};
