import{_ as a,u as e,q as t,s as l,r as s,o as r,aK as o,C as i,B as u,a1 as n,F as c,m as d,p,H as m,d as v,w as f,J as h,a9 as g,G as y,i as x,a as b,e as w,t as _,K as k,g as S,I as j,a4 as C,a2 as I,a5 as $,a0 as N,U as z,X as V,Y as E,N as A,j as M,b as R,M as U,L as B}from"./index-5HZnFt5a.js";import{b as H}from"./edit.ClCNdCUx.js";import{a as K}from"./index.BIXFsUHK.js";import{_ as P}from"./index.CqNThjil.js";import{M as q}from"./rewrite-menu.DhZcv1A9.js";import{d as G}from"./dialog.CErO1ANM.js";import{a as F}from"./apply.Dlzismsu.js";import{c as J}from"./chat.Ba42RxGW.js";import"./props.CsYLBIgk.js";import"./uv-navbar.BqnHoo3Z.js";import"./uv-input.DP28rKYF.js";import"./uv-modal.Clrzaq6u.js";import"./uv-line.rnRAS3LR.js";import"./uv-loading-icon.D2OVaaMI.js";import"./dump.dPDEymx_.js";const L=a({__name:"rewrite",setup(a){const{t:L}=e(),X=t(),Y=l((()=>{var a;return!!(null==(a=X.userInfo)?void 0:a.id)})),D=s(""),O=s({}),Q=async()=>{const{data:a}=await F.getAppModelAsync({id:D.value});O.value=g(a)},T=s(""),W=l((()=>{var a,e;const t=null==(e=null==(a=O.value)?void 0:a.config)?void 0:e.tags;return C(t)})),Z=s(null),aa=()=>{var a;null==(a=Z.value)||a.show(D.value)},ea=()=>{o("pagesa-chat-params-data"),T.value="",Q()},ta=async a=>{o("pagesa-chat-params-data"),I({url:`/pagesA/chat/params?mid=${D.value}&cid=${a}`})},la=async()=>{var a,e;if(!Y.value)return void $();if(N(T.value))return void z({title:"请输入你的问题",icon:"none"});V({title:"请求中...",mask:!0});let t=W.value,l={},s=!1;if(t.some((a=>{var e;if(!(null==(e=a.value)?void 0:e.trim())&&"1"===String(a.required))return s=!0,!0;l[a.key]=a.value})),s)return E(),void z({title:"请选择或填写"+res.key,icon:"none"});l["输入内容"]=T.value;const r=n(null==(e=null==(a=O.value)?void 0:a.config)?void 0:e.format);let o=sa(r,l);const{data:i}=await G.gptsCreate({appId:D.value,hasHistory:!0});if(N(i.id))return void E();const u=O.value,c={appId:0,prompt:o,options:{parentMessageId:"",groupId:i.id,type:u.modelName?"gpts":"",usingNetwork:!1},systemMessage:""},{code:d,data:p,error:m}=await J.beforeChatProcessAsync(c);if(200!==d||!p)return E(),void z({title:m.message||"消息异常，请联系管理员处理~",icon:"none"});await G.updateNewChatGroup({groupId:i.id,title:u.modelName}),E(),A("pagesa-chat-params-data",c),I({url:`/pagesA/chat/params?mid=${D.value}`})},sa=(a,e)=>a.replace(/\{\{([\u4e00-\u9fa5\w.]+)\}\}/g,((a,t)=>{try{let a=t.split(".").reduce(((a,e)=>null==a?void 0:a[e]),e);return N(a)?`[未定义：${t}]`:a}catch(l){return"[错误]"}})),ra=s("");return r((()=>{const a=uni.$uv.addUnit(uni.$uv.sys().statusBarHeight+44,"px");ra.value=`calc(100vh - (${a} + 170rpx))`,o("pagesa-chat-params-data")})),i((()=>{o("pagesa-chat-params-data"),T.value="",Q()})),u((({id:a})=>{D.value=n(a)})),(a,e)=>{const t=c("ai-bindphone"),l=c("ai-privacy"),s=d(p("uv-icon"),y),r=M,o=x;return b(),m(h,null,[v(o,{class:"dialog-apps-rewrite"},{default:f((()=>[v(t,{ref:"aiPrivacyRef"},null,512),v(l,{ref:"aiPrivacyRef"},null,512),v(K,{bg:!1},{left:f((()=>[v(o,{class:"dialog-apps-rewrite-left"},{default:f((()=>[v(s,{name:"arrow-left",bold:"",size:"22",color:"#000",onClick:e[0]||(e[0]=e=>a.$tools.back())}),v(r,{class:"menu-right",src:H,onClick:aa})])),_:1})])),center:f((()=>[v(o,{class:"title"},{default:f((()=>[w(_(O.value.modelName),1)])),_:1})])),right:f((()=>[v(r,{class:"menu-right",src:H,onClick:aa})])),_:1}),v(o,{class:"main-box",style:k({height:ra.value})},{default:f((()=>[v(o,{class:"base-params-item"},{default:f((()=>[v(o,{class:"base-title-box"},{default:f((()=>[w(_(S(L)("chat.rewrite.title")),1)])),_:1}),v(o,{class:"base-content-box"},{default:f((()=>{var a;return[v(P,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=a=>T.value=a),height:96,maxlength:3e3,placeholder:(null==(a=O.value.config)?void 0:a.placeholder)||S(L)("chat.rewrite.placeholder"),theme:"light",customStyle:{background:"#fff",color:"#000000",fontSize:"28rpx",border:"1px solid #E0E2E9",borderRadius:"16rpx"},textStyle:{color:"#000000",fontSize:"28rpx"},placeholderStyle:{color:"#767676",fontSize:"28rpx"},countStyle:{color:"#767676"},clearIcon:"delete-12",clearIconStyle:{width:"24rpx",height:"24rpx"}},null,8,["modelValue","placeholder"])]})),_:1})])),_:1}),(b(!0),m(h,null,j(W.value,((a,e)=>(b(),R(o,{class:"base-params-item",key:e},{default:f((()=>[v(o,{class:"base-title-box a"},{default:f((()=>[w(_(a.key),1)])),_:2},1024),"select"===a.tag?(b(),R(o,{key:0,class:"base-select-box"},{default:f((()=>{var e;return[(b(!0),m(h,null,j(null==(e=a.options)?void 0:e.split(","),((e,t)=>(b(),R(o,{key:t,class:U(["select-item",[{active:a.value===e}]]),onClick:t=>a.value=e},{default:f((()=>[w(_(e),1)])),_:2},1032,["class","onClick"])))),128))]})),_:2},1024)):"input"===a.tag?(b(),R(o,{key:1,class:"base-input-box"},{default:f((()=>[v(P,{modelValue:a.value,"onUpdate:modelValue":e=>a.value=e,height:96,maxlength:3e3,placeholder:`${S(L)("chat.rewrite.textarea")}${a.key}`,theme:"light",count:!1,clearContent:!1,customStyle:{background:"#fff",color:"#000000",fontSize:"28rpx",border:"1px solid #E0E2E9",borderRadius:"16rpx"},textStyle:{color:"#000000",fontSize:"28rpx"},placeholderStyle:{color:"#767676",fontSize:"28rpx"},countStyle:{color:"#767676"},clearIcon:"delete-12",clearIconStyle:{width:"24rpx",height:"24rpx"}},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1024)):B("",!0)])),_:2},1024)))),128))])),_:1},8,["style"]),v(o,{class:"foot-box"},{default:f((()=>[v(o,{class:"create",onClick:la},{default:f((()=>[w(_(S(L)("chat.rewrite.create")),1)])),_:1})])),_:1})])),_:1}),v(q,{ref_key:"menuRef",ref:Z,groupKey:"params",onNew:ea,onChange:ta},null,512)],64)}}},[["__scopeId","data-v-dfc26b99"]]);export{L as default};
