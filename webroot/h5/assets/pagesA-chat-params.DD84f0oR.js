import{_ as a,u as e,r as t,o as s,B as l,a1 as o,F as n,m as i,p as r,H as u,d as c,w as p,J as v,a9 as d,a0 as m,a7 as f,ak as h,U as g,v as y,G as _,i as j,a as k,e as w,t as x,K as b,g as C,b as K,aK as $,a2 as A,h as O,j as B}from"./index-5HZnFt5a.js";import{b as P}from"./edit.ClCNdCUx.js";import{_ as R,c as M,d as z,j as H,a as N,s as S}from"./chat-item.Bfa0bW6i.js";import{a as U}from"./index.BIXFsUHK.js";import{M as E}from"./rewrite-menu.DhZcv1A9.js";import{d as F}from"./dialog.CErO1ANM.js";import{a as G}from"./apply.Dlzismsu.js";import"./zero-markdown-view.36PbCcI6.js";import"./uv-loading-icon.D2OVaaMI.js";import"./sound-pay.Vvxa2jSR.js";import"./digital-man.CbE7ZGLY.js";import"./uv-navbar.BqnHoo3Z.js";import"./uv-input.DP28rKYF.js";import"./uv-modal.Clrzaq6u.js";import"./uv-line.rnRAS3LR.js";import"./dump.dPDEymx_.js";const I=a({__name:"params",setup(a){const{t:I}=e(),T=t(""),Y=t(null),J=t("APPLY_CHAT_GROUP"),L=t({}),Z=t(""),q=async()=>{const a=Z.value;if(m(a))return;const{data:e}=await F.chatlog({groupId:a});X.value=(null==e?void 0:e.pop())||{}},D=t(!1),Q=async()=>{const a=f("pagesa-chat-params-data");if(m(a))return;D.value=!0;const e=f("token");Y.value.startChat({url:h+"/api/chatgpt/chat-process",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:a})},V=()=>{X.value={think:"",text:""}},W=a=>{const e=X.value.text;m(e)&&(X.value.text=I("chat.index.error")),g({title:a,icon:"none"}),ta()},X=t({}),aa=t([]),ea=a=>{aa.value.push(a),pa()},ta=()=>{var a;D.value=!1,null==(a=Y.value)||a.stopChat()},sa=t(null),la=()=>{var a;null==(a=sa.value)||a.show(T.value)},oa=()=>{$("pagesa-chat-params-data")},na=async a=>{$("pagesa-chat-params-data"),A({url:`/pagesA/chat/params?mid=${T.value}&cid=${a}`})},ia=()=>{Q().then()},ra=()=>{var a;const e=o(null==(a=X.value)?void 0:a.text);O.copy(e)},ua=async a=>{if(a.think)for(const e of a.think)X.value.think+=o(e),await S(10);if(a.delta)for(const e of a.delta)X.value.text+=o(e),await S(10);a.is_end&&ta()},ca=t(!1),pa=async()=>{const a=z((()=>{ca.value||(async()=>{if(!(ca.value||aa.value.length<=0))try{for(ca.value=!0;aa.value.length>0;){const{data:a,type:e}=aa.value[0];if("h5"===e){const e=H(a);await ua(e)}else if("mp"===e){const e=(await N(a)).trim().split("\n").filter((a=>""!==a.trim()));for(const a of e){const e=H(a);await ua(e)}}aa.value.shift()}}catch(a){g({title:I("app.tip.error"),icon:"none"})}finally{ca.value=!1}})()}),50);y((()=>aa.value.length),a)},va=t("");return s((()=>{const a=uni.$uv.addUnit(uni.$uv.sys().statusBarHeight+44,"px");va.value=`calc(100vh - (${a} + 170rpx))`,(async()=>{const{data:a}=await G.getAppModelAsync({id:T.value});L.value=d(a),m(Z.value)?Q().then():q().then()})()})),l((a=>{T.value=o(null==a?void 0:a.mid),Z.value=o(null==a?void 0:a.cid)})),(a,e)=>{const t=n("ai-bindphone"),s=n("ai-privacy"),l=i(r("uv-icon"),_),o=B,d=j;return k(),u(v,null,[c(d,{class:"dialog-apps-rewrite"},{default:p((()=>[c(t,{ref:"aiPrivacyRef"},null,512),c(s,{ref:"aiPrivacyRef"},null,512),c(U,{bg:!1},{left:p((()=>[c(d,{class:"dialog-apps-rewrite-left"},{default:p((()=>[c(l,{name:"arrow-left",bold:"",size:"22",color:"#000",onClick:e[0]||(e[0]=e=>a.$tools.back())}),c(o,{class:"menu-right",src:P,onClick:la})])),_:1})])),center:p((()=>[c(d,{class:"title"},{default:p((()=>[w(x(L.value.modelName),1)])),_:1})])),right:p((()=>[c(o,{class:"menu-right",src:P,onClick:la})])),_:1}),c(d,{class:"main-box",style:b({height:va.value})},{default:p((()=>[c(d,{class:"chat-item"},{default:p((()=>[c(M,{chatKey:J.value,data:L.value,message:X.value,text:X.value.text,loading:D.value,toolBar:!1},null,8,["chatKey","data","message","text","loading"])])),_:1})])),_:1},8,["style"]),c(d,{class:"foot-box"},{default:p((()=>[D.value?(k(),K(d,{key:1,class:"create"},{default:p((()=>[w(x(C(I)("app.generation.loading")),1)])),_:1})):(k(),u(v,{key:0},[c(d,{class:"recreate",onClick:ia},{default:p((()=>[w(x(C(I)("chat.item.refresh")),1)])),_:1}),c(d,{class:"copy",onClick:ra},{default:p((()=>[w(x(C(I)("app.text.copy")),1)])),_:1})],64))])),_:1})])),_:1}),c(R,{ref_key:"chatSSERef",ref:Y,groupKey:J.value,onOnOpen:V,onOnError:W,onOnMessage:ea,onOnFinish:ta},null,8,["groupKey"]),c(E,{ref_key:"menuRef",ref:sa,groupKey:"params",onNew:oa,onChange:na},null,512)],64)}}},[["__scopeId","data-v-04e2ee29"]]);export{I as default};
