'use strict';const _0x9ac90f=_0x5d51;function _0x5d51(_0x4d6154,_0x574e1a){const _0x3742d5=_0x3742();return _0x5d51=function(_0x5d5165,_0x41eab3){_0x5d5165=_0x5d5165-0x132;let _0x47dd02=_0x3742d5[_0x5d5165];return _0x47dd02;},_0x5d51(_0x4d6154,_0x574e1a);}(function(_0x568b0b,_0x3e04df){const _0x10b0b8=_0x5d51,_0x76a6dc=_0x568b0b();while(!![]){try{const _0x30ddd9=parseInt(_0x10b0b8(0x13e))/0x1*(-parseInt(_0x10b0b8(0x14c))/0x2)+parseInt(_0x10b0b8(0x13b))/0x3+parseInt(_0x10b0b8(0x147))/0x4*(-parseInt(_0x10b0b8(0x13a))/0x5)+parseInt(_0x10b0b8(0x132))/0x6+parseInt(_0x10b0b8(0x137))/0x7*(parseInt(_0x10b0b8(0x156))/0x8)+parseInt(_0x10b0b8(0x14e))/0x9+-parseInt(_0x10b0b8(0x13d))/0xa;if(_0x30ddd9===_0x3e04df)break;else _0x76a6dc['push'](_0x76a6dc['shift']());}catch(_0x8bd382){_0x76a6dc['push'](_0x76a6dc['shift']());}}}(_0x3742,0xb7b91));var __decorate=this&&this[_0x9ac90f(0x158)]||function(_0x1914e5,_0x12f02f,_0x1a2d15,_0xdb4d05){const _0x1db04a=_0x9ac90f;var _0x10342f=arguments[_0x1db04a(0x15c)],_0x34bb34=_0x10342f<0x3?_0x12f02f:_0xdb4d05===null?_0xdb4d05=Object['getOwnPropertyDescriptor'](_0x12f02f,_0x1a2d15):_0xdb4d05,_0x80fa35;if(typeof Reflect==='object'&&typeof Reflect[_0x1db04a(0x141)]===_0x1db04a(0x144))_0x34bb34=Reflect[_0x1db04a(0x141)](_0x1914e5,_0x12f02f,_0x1a2d15,_0xdb4d05);else{for(var _0x3b5a50=_0x1914e5[_0x1db04a(0x15c)]-0x1;_0x3b5a50>=0x0;_0x3b5a50--)if(_0x80fa35=_0x1914e5[_0x3b5a50])_0x34bb34=(_0x10342f<0x3?_0x80fa35(_0x34bb34):_0x10342f>0x3?_0x80fa35(_0x12f02f,_0x1a2d15,_0x34bb34):_0x80fa35(_0x12f02f,_0x1a2d15))||_0x34bb34;}return _0x10342f>0x3&&_0x34bb34&&Object[_0x1db04a(0x149)](_0x12f02f,_0x1a2d15,_0x34bb34),_0x34bb34;},__metadata=this&&this[_0x9ac90f(0x150)]||function(_0x4dd2cb,_0x3c6b26){const _0x40d530=_0x9ac90f;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x40d530(0x144))return Reflect[_0x40d530(0x142)](_0x4dd2cb,_0x3c6b26);},__param=this&&this['__param']||function(_0x2f9cc2,_0x183dd1){return function(_0x5ea0ad,_0x2cd20c){_0x183dd1(_0x5ea0ad,_0x2cd20c,_0x2f9cc2);};};function _0x3742(){const _0x41aa3e=['HttpStatus','__decorate','redisClient','design:paramtypes','tokens:','length','Inject','5074314QxsksF','fuzzy','SUPER','user','checkTokenAuth','4501qsyPfG','keys','@nestjs/common','2222315ZCVmLA','3724341apaTqY','expire','4713660CYAPdI','27128dpzyKk','HttpException','Injectable','decorate','metadata','../../common/constants/Role.constant','function','set','__esModule','12ruuJxr','get','defineProperty','RedisCacheService','token:','22ntvmBp','zRange','4353093RkZOyn','ttl','__metadata','visitor','saveToken','del','forEach','ERole','3544JEsIjq'];_0x3742=function(){return _0x41aa3e;};return _0x3742();}Object[_0x9ac90f(0x149)](exports,_0x9ac90f(0x146),{'value':!![]}),exports[_0x9ac90f(0x14a)]=void 0x0;const common_1=require(_0x9ac90f(0x139)),Role_constant_1=require(_0x9ac90f(0x143));let RedisCacheService=class RedisCacheService{constructor(_0x359949){this['redisClient']=_0x359949;}async['get'](_0x37d976){const _0x3beba6=_0x9ac90f,{key:_0x5d421c}=_0x37d976;return await this[_0x3beba6(0x159)][_0x3beba6(0x148)](_0x5d421c);}async[_0x9ac90f(0x145)](_0x3f6087,_0x57bd0e){const _0x4f499e=_0x9ac90f;try{const {key:_0x362286,val:_0x277e15}=_0x3f6087;await this['redisClient'][_0x4f499e(0x145)](_0x362286,_0x277e15),_0x57bd0e&&await this[_0x4f499e(0x159)][_0x4f499e(0x13c)](_0x362286,_0x57bd0e);return;}catch(_0x599df2){throw new common_1[(_0x4f499e(0x13f))](_0x599df2,common_1[_0x4f499e(0x157)]['BAD_REQUEST']);}}[_0x9ac90f(0x133)](_0x42b5b7){const _0x3389cd=_0x9ac90f;return this[_0x3389cd(0x159)][_0x3389cd(0x138)](_0x42b5b7+'*');}async['ttl'](_0x1c24fa){const _0x5ec297=_0x9ac90f;return await this[_0x5ec297(0x159)][_0x5ec297(0x14f)](_0x1c24fa);}async[_0x9ac90f(0x153)](_0x118878){const _0x2a5580=_0x9ac90f,{key:_0x53f90f}=_0x118878;return await this[_0x2a5580(0x159)]['del'](_0x53f90f);}async[_0x9ac90f(0x152)](_0x3dc717,_0x4c6a6b){const _0x318137=_0x9ac90f,_0x491b8d=await this['redisClient'][_0x318137(0x14d)](_0x318137(0x15b)+_0x3dc717,0x0,-0x1);await this['invalidateTokens'](_0x3dc717,_0x491b8d),await this[_0x318137(0x159)][_0x318137(0x145)](_0x318137(0x14b)+_0x3dc717,_0x4c6a6b);}async['invalidateTokens'](_0x31e866,_0x371485){const _0x2d5a91=_0x9ac90f;_0x371485[_0x2d5a91(0x154)](_0x1d2978=>{const _0x45554c=_0x2d5a91;this['redisClient']['del'](_0x45554c(0x14b)+_0x31e866+':'+_0x1d2978);});}async[_0x9ac90f(0x136)](_0x256495,_0x1fad9e){const _0x49999d=_0x9ac90f,{id:_0x4be5b7,role:_0x5f4d02}=_0x1fad9e[_0x49999d(0x135)];if(_0x5f4d02===_0x49999d(0x151))return!![];const _0x44d218=await this[_0x49999d(0x159)][_0x49999d(0x148)]('token:'+_0x4be5b7);if(_0x44d218===null)return await this[_0x49999d(0x159)][_0x49999d(0x145)]('token:'+_0x4be5b7,_0x256495),!![];if(_0x44d218!==_0x256495){if(_0x5f4d02===Role_constant_1[_0x49999d(0x155)][_0x49999d(0x134)])return!![];throw new common_1['HttpException']('您已在其他设备覆盖登录、请您重新登录！',common_1['HttpStatus']['UNAUTHORIZED']);}}};RedisCacheService=__decorate([(0x0,common_1[_0x9ac90f(0x140)])(),__param(0x0,(0x0,common_1[_0x9ac90f(0x15d)])('REDIS_CLIENT')),__metadata(_0x9ac90f(0x15a),[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;