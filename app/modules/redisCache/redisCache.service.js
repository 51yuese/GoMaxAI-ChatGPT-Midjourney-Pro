'use strict';const _0x33a07a=_0x1e47;(function(_0x14d246,_0x7f870e){const _0x166823=_0x1e47,_0x27bb12=_0x14d246();while(!![]){try{const _0x194d11=-parseInt(_0x166823(0x1da))/0x1*(parseInt(_0x166823(0x1d6))/0x2)+parseInt(_0x166823(0x1e5))/0x3*(parseInt(_0x166823(0x1eb))/0x4)+-parseInt(_0x166823(0x1df))/0x5+parseInt(_0x166823(0x1e4))/0x6+parseInt(_0x166823(0x1e6))/0x7+parseInt(_0x166823(0x1d2))/0x8+-parseInt(_0x166823(0x1f6))/0x9*(parseInt(_0x166823(0x1d9))/0xa);if(_0x194d11===_0x7f870e)break;else _0x27bb12['push'](_0x27bb12['shift']());}catch(_0x3d89ce){_0x27bb12['push'](_0x27bb12['shift']());}}}(_0x45b3,0x6c5cc));function _0x1e47(_0x1c871f,_0x1baf46){const _0x45b363=_0x45b3();return _0x1e47=function(_0x1e474f,_0x516924){_0x1e474f=_0x1e474f-0x1d2;let _0x75692e=_0x45b363[_0x1e474f];return _0x75692e;},_0x1e47(_0x1c871f,_0x1baf46);}function _0x45b3(){const _0x4a28f4=['user','token:','6539160kPCBpC','set','__esModule','__decorate','430bXPzlE','decorate','__param','13437390gGSFrR','16CRHkHA','design:paramtypes','zRange','BAD_REQUEST','HttpException','3360270lrfCHC','REDIS_CLIENT','__metadata','tokens:','get','3552864HXizUO','24EIkMDr','3336830IlEFdO','RedisCacheService','UNAUTHORIZED','del','getOwnPropertyDescriptor','288428pGnDrG','invalidateTokens','checkTokenAuth','ERole','object','expire','../../common/constants/Role.constant','redisClient','fuzzy','length','defineProperty','9eJIDWg','keys','function','SUPER'];_0x45b3=function(){return _0x4a28f4;};return _0x45b3();}var __decorate=this&&this[_0x33a07a(0x1d5)]||function(_0x334b1b,_0x366ef7,_0x2acde3,_0x5a3322){const _0x68f566=_0x33a07a;var _0x1689bc=arguments[_0x68f566(0x1f4)],_0x3eb8f9=_0x1689bc<0x3?_0x366ef7:_0x5a3322===null?_0x5a3322=Object[_0x68f566(0x1ea)](_0x366ef7,_0x2acde3):_0x5a3322,_0x4b042a;if(typeof Reflect===_0x68f566(0x1ef)&&typeof Reflect[_0x68f566(0x1d7)]==='function')_0x3eb8f9=Reflect[_0x68f566(0x1d7)](_0x334b1b,_0x366ef7,_0x2acde3,_0x5a3322);else{for(var _0x3e74c0=_0x334b1b[_0x68f566(0x1f4)]-0x1;_0x3e74c0>=0x0;_0x3e74c0--)if(_0x4b042a=_0x334b1b[_0x3e74c0])_0x3eb8f9=(_0x1689bc<0x3?_0x4b042a(_0x3eb8f9):_0x1689bc>0x3?_0x4b042a(_0x366ef7,_0x2acde3,_0x3eb8f9):_0x4b042a(_0x366ef7,_0x2acde3))||_0x3eb8f9;}return _0x1689bc>0x3&&_0x3eb8f9&&Object[_0x68f566(0x1f5)](_0x366ef7,_0x2acde3,_0x3eb8f9),_0x3eb8f9;},__metadata=this&&this[_0x33a07a(0x1e1)]||function(_0x477e32,_0x480fbc){const _0x8895f4=_0x33a07a;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x8895f4(0x1f8))return Reflect['metadata'](_0x477e32,_0x480fbc);},__param=this&&this[_0x33a07a(0x1d8)]||function(_0x1110b4,_0x568429){return function(_0x5d7fc3,_0x54ad8b){_0x568429(_0x5d7fc3,_0x54ad8b,_0x1110b4);};};Object[_0x33a07a(0x1f5)](exports,_0x33a07a(0x1d4),{'value':!![]}),exports[_0x33a07a(0x1e7)]=void 0x0;const common_1=require('@nestjs/common'),Role_constant_1=require(_0x33a07a(0x1f1));let RedisCacheService=class RedisCacheService{constructor(_0x291033){const _0x8095c9=_0x33a07a;this[_0x8095c9(0x1f2)]=_0x291033;}async[_0x33a07a(0x1e3)](_0x50b586){const _0xa977fa=_0x33a07a,{key:_0x220cb9}=_0x50b586;return await this[_0xa977fa(0x1f2)][_0xa977fa(0x1e3)](_0x220cb9);}async[_0x33a07a(0x1d3)](_0x57ac17,_0x427227){const _0x1d26b3=_0x33a07a;try{const {key:_0x2b6acb,val:_0x18c02f}=_0x57ac17;await this[_0x1d26b3(0x1f2)][_0x1d26b3(0x1d3)](_0x2b6acb,_0x18c02f),_0x427227&&await this['redisClient'][_0x1d26b3(0x1f0)](_0x2b6acb,_0x427227);return;}catch(_0x6de1c7){throw new common_1[(_0x1d26b3(0x1de))](_0x6de1c7,common_1['HttpStatus'][_0x1d26b3(0x1dd)]);}}[_0x33a07a(0x1f3)](_0xe6d56e){const _0x2f2a53=_0x33a07a;return this['redisClient'][_0x2f2a53(0x1f7)](_0xe6d56e+'*');}async['ttl'](_0xb6a8b9){const _0x13960a=_0x33a07a;return await this[_0x13960a(0x1f2)]['ttl'](_0xb6a8b9);}async[_0x33a07a(0x1e9)](_0x38ee00){const _0x437c57=_0x33a07a,{key:_0x5233e7}=_0x38ee00;return await this[_0x437c57(0x1f2)][_0x437c57(0x1e9)](_0x5233e7);}async['saveToken'](_0x429fd2,_0x59cc56){const _0x279685=_0x33a07a,_0x40f9a6=await this[_0x279685(0x1f2)][_0x279685(0x1dc)](_0x279685(0x1e2)+_0x429fd2,0x0,-0x1);await this['invalidateTokens'](_0x429fd2,_0x40f9a6),await this[_0x279685(0x1f2)][_0x279685(0x1d3)]('token:'+_0x429fd2,_0x59cc56);}async[_0x33a07a(0x1ec)](_0x193d24,_0x2e0347){_0x2e0347['forEach'](_0x1eb504=>{const _0x2a7a8e=_0x1e47;this[_0x2a7a8e(0x1f2)][_0x2a7a8e(0x1e9)](_0x2a7a8e(0x1fb)+_0x193d24+':'+_0x1eb504);});}async[_0x33a07a(0x1ed)](_0x1d08e2,_0x26a8db){const _0x54e073=_0x33a07a,{id:_0xd81297,role:_0x2bb166}=_0x26a8db[_0x54e073(0x1fa)];if(_0x2bb166==='visitor')return!![];const _0xac5b99=await this[_0x54e073(0x1f2)][_0x54e073(0x1e3)](_0x54e073(0x1fb)+_0xd81297);if(_0xac5b99===null)return await this[_0x54e073(0x1f2)][_0x54e073(0x1d3)](_0x54e073(0x1fb)+_0xd81297,_0x1d08e2),!![];if(_0xac5b99!==_0x1d08e2){if(_0x2bb166===Role_constant_1[_0x54e073(0x1ee)][_0x54e073(0x1f9)])return!![];throw new common_1[(_0x54e073(0x1de))]('您已在其他设备覆盖登录、请您重新登录！',common_1['HttpStatus'][_0x54e073(0x1e8)]);}}};RedisCacheService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1['Inject'])(_0x33a07a(0x1e0))),__metadata(_0x33a07a(0x1db),[Object])],RedisCacheService),exports[_0x33a07a(0x1e7)]=RedisCacheService;