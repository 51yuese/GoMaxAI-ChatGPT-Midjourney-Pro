'use strict';const _0x256e71=_0x3ba8;(function(_0x13b462,_0x270034){const _0xfafb66=_0x3ba8,_0x2680d2=_0x13b462();while(!![]){try{const _0x3ba508=parseInt(_0xfafb66(0x96))/0x1*(-parseInt(_0xfafb66(0x99))/0x2)+parseInt(_0xfafb66(0x9f))/0x3+parseInt(_0xfafb66(0xa2))/0x4*(parseInt(_0xfafb66(0x8d))/0x5)+-parseInt(_0xfafb66(0xb2))/0x6*(parseInt(_0xfafb66(0x91))/0x7)+-parseInt(_0xfafb66(0xb3))/0x8+parseInt(_0xfafb66(0xb5))/0x9*(-parseInt(_0xfafb66(0xa6))/0xa)+-parseInt(_0xfafb66(0xb6))/0xb*(-parseInt(_0xfafb66(0xb4))/0xc);if(_0x3ba508===_0x270034)break;else _0x2680d2['push'](_0x2680d2['shift']());}catch(_0x10109e){_0x2680d2['push'](_0x2680d2['shift']());}}}(_0x133f,0x1b1f3));function _0x133f(){const _0x546e07=['10503PUKfQb','16797ExAYzc','SUPER','__param','token:','1004405fYOKaY','tokens:','__metadata','saveToken','7ftaVmC','getOwnPropertyDescriptor','defineProperty','del','design:paramtypes','289Tdopgp','BAD_REQUEST','UNAUTHORIZED','1228vbNAKM','metadata','@nestjs/common','__decorate','invalidateTokens','object','99528zoYRdH','REDIS_CLIENT','checkTokenAuth','4xyaGUQ','HttpException','get','ttl','1510GJZZXg','decorate','redisClient','set','length','Inject','__esModule','RedisCacheService','zRange','keys','Injectable','HttpStatus','353778XOeXOT','981040QRYgeW','3240PQIeMd'];_0x133f=function(){return _0x546e07;};return _0x133f();}var __decorate=this&&this[_0x256e71(0x9c)]||function(_0x3b4dc2,_0x43b661,_0x2377fd,_0xe933e5){const _0x47a27a=_0x256e71;var _0x283ed0=arguments[_0x47a27a(0xaa)],_0xe3dac9=_0x283ed0<0x3?_0x43b661:_0xe933e5===null?_0xe933e5=Object[_0x47a27a(0x92)](_0x43b661,_0x2377fd):_0xe933e5,_0x1309e1;if(typeof Reflect==='object'&&typeof Reflect[_0x47a27a(0xa7)]==='function')_0xe3dac9=Reflect[_0x47a27a(0xa7)](_0x3b4dc2,_0x43b661,_0x2377fd,_0xe933e5);else{for(var _0x44ebf0=_0x3b4dc2['length']-0x1;_0x44ebf0>=0x0;_0x44ebf0--)if(_0x1309e1=_0x3b4dc2[_0x44ebf0])_0xe3dac9=(_0x283ed0<0x3?_0x1309e1(_0xe3dac9):_0x283ed0>0x3?_0x1309e1(_0x43b661,_0x2377fd,_0xe3dac9):_0x1309e1(_0x43b661,_0x2377fd))||_0xe3dac9;}return _0x283ed0>0x3&&_0xe3dac9&&Object['defineProperty'](_0x43b661,_0x2377fd,_0xe3dac9),_0xe3dac9;},__metadata=this&&this[_0x256e71(0x8f)]||function(_0x365848,_0xeb44bf){const _0x3de922=_0x256e71;if(typeof Reflect===_0x3de922(0x9e)&&typeof Reflect['metadata']==='function')return Reflect[_0x3de922(0x9a)](_0x365848,_0xeb44bf);},__param=this&&this[_0x256e71(0xb8)]||function(_0x2e4e88,_0x5a961c){return function(_0x26875e,_0x50e1f1){_0x5a961c(_0x26875e,_0x50e1f1,_0x2e4e88);};};Object[_0x256e71(0x93)](exports,_0x256e71(0xac),{'value':!![]}),exports[_0x256e71(0xad)]=void 0x0;function _0x3ba8(_0x3eff1f,_0x32689e){const _0x133f0e=_0x133f();return _0x3ba8=function(_0x3ba8b7,_0x27990d){_0x3ba8b7=_0x3ba8b7-0x8c;let _0x396fb6=_0x133f0e[_0x3ba8b7];return _0x396fb6;},_0x3ba8(_0x3eff1f,_0x32689e);}const common_1=require(_0x256e71(0x9b)),Role_constant_1=require('../../common/constants/Role.constant');let RedisCacheService=class RedisCacheService{constructor(_0x3193dd){this['redisClient']=_0x3193dd;}async['get'](_0x283cfa){const _0x221bce=_0x256e71,{key:_0x4ad8ae}=_0x283cfa;return await this[_0x221bce(0xa8)]['get'](_0x4ad8ae);}async[_0x256e71(0xa9)](_0x303c13,_0x40922d){const _0x167f37=_0x256e71;try{const {key:_0x2bea8f,val:_0x43a549}=_0x303c13;await this[_0x167f37(0xa8)][_0x167f37(0xa9)](_0x2bea8f,_0x43a549),_0x40922d&&await this[_0x167f37(0xa8)]['expire'](_0x2bea8f,_0x40922d);return;}catch(_0x13d7ef){throw new common_1[(_0x167f37(0xa3))](_0x13d7ef,common_1[_0x167f37(0xb1)][_0x167f37(0x97)]);}}['fuzzy'](_0x5c0a33){const _0x4cc0d3=_0x256e71;return this['redisClient'][_0x4cc0d3(0xaf)](_0x5c0a33+'*');}async[_0x256e71(0xa5)](_0x321e99){const _0xc601fd=_0x256e71;return await this[_0xc601fd(0xa8)][_0xc601fd(0xa5)](_0x321e99);}async[_0x256e71(0x94)](_0x524c2f){const _0x4eed2f=_0x256e71,{key:_0x12585f}=_0x524c2f;return await this['redisClient'][_0x4eed2f(0x94)](_0x12585f);}async[_0x256e71(0x90)](_0x1a43b6,_0xad9816){const _0x34e598=_0x256e71,_0x4175d1=await this['redisClient'][_0x34e598(0xae)](_0x34e598(0x8e)+_0x1a43b6,0x0,-0x1);await this[_0x34e598(0x9d)](_0x1a43b6,_0x4175d1),await this[_0x34e598(0xa8)][_0x34e598(0xa9)](_0x34e598(0x8c)+_0x1a43b6,_0xad9816);}async[_0x256e71(0x9d)](_0x4399a4,_0x346667){_0x346667['forEach'](_0x48c8ed=>{const _0x246275=_0x3ba8;this[_0x246275(0xa8)][_0x246275(0x94)](_0x246275(0x8c)+_0x4399a4+':'+_0x48c8ed);});}async[_0x256e71(0xa1)](_0x1068ec,_0x20b6fe){const _0x832363=_0x256e71,{id:_0x19a247,role:_0x749361}=_0x20b6fe['user'];if(_0x749361==='visitor')return!![];const _0x5e3148=await this['redisClient'][_0x832363(0xa4)]('token:'+_0x19a247);if(_0x5e3148===null)return await this['redisClient']['set'](_0x832363(0x8c)+_0x19a247,_0x1068ec),!![];if(_0x5e3148!==_0x1068ec){if(_0x749361===Role_constant_1['ERole'][_0x832363(0xb7)])return!![];throw new common_1[(_0x832363(0xa3))]('您已在其他设备覆盖登录、请您重新登录！',common_1['HttpStatus'][_0x832363(0x98)]);}}};RedisCacheService=__decorate([(0x0,common_1[_0x256e71(0xb0)])(),__param(0x0,(0x0,common_1[_0x256e71(0xab)])(_0x256e71(0xa0))),__metadata(_0x256e71(0x95),[Object])],RedisCacheService),exports[_0x256e71(0xad)]=RedisCacheService;