'use strict';const _0x2a385b=_0x48ed;(function(_0x135f3d,_0x31272b){const _0x479017=_0x48ed,_0x4a0bf9=_0x135f3d();while(!![]){try{const _0x500a3c=parseInt(_0x479017(0x14e))/0x1+-parseInt(_0x479017(0x154))/0x2*(-parseInt(_0x479017(0x172))/0x3)+parseInt(_0x479017(0x14a))/0x4*(parseInt(_0x479017(0x173))/0x5)+parseInt(_0x479017(0x15e))/0x6*(-parseInt(_0x479017(0x174))/0x7)+parseInt(_0x479017(0x157))/0x8*(parseInt(_0x479017(0x152))/0x9)+-parseInt(_0x479017(0x159))/0xa*(-parseInt(_0x479017(0x14d))/0xb)+-parseInt(_0x479017(0x16e))/0xc*(parseInt(_0x479017(0x169))/0xd);if(_0x500a3c===_0x31272b)break;else _0x4a0bf9['push'](_0x4a0bf9['shift']());}catch(_0x58cea7){_0x4a0bf9['push'](_0x4a0bf9['shift']());}}}(_0x4a04,0x77704));function _0x4a04(){const _0x28f2ec=['decorate','39VUHbuG','__param','redisClient','expire','length','7150656kyXdNP','del','zRange','checkTokenAuth','143601llxLcY','135rPcbHR','3703vTjNRl','metadata','tokens:','32236UvIPqQ','@nestjs/common','Injectable','11XyFycf','811307TJHgzN','HttpStatus','set','BAD_REQUEST','45zCuNPF','__decorate','22QDCDTq','REDIS_CLIENT','HttpException','1549816rQDMcV','fuzzy','4738390FxPPqZ','__esModule','invalidateTokens','defineProperty','object','8178cBTGlT','token:','get','forEach','getOwnPropertyDescriptor','saveToken','keys','visitor','function','Inject'];_0x4a04=function(){return _0x28f2ec;};return _0x4a04();}var __decorate=this&&this[_0x2a385b(0x153)]||function(_0x1c1a4d,_0x4cadeb,_0x151086,_0x4b2ae2){const _0x5f5648=_0x2a385b;var _0x1f642d=arguments[_0x5f5648(0x16d)],_0x26f3d7=_0x1f642d<0x3?_0x4cadeb:_0x4b2ae2===null?_0x4b2ae2=Object[_0x5f5648(0x162)](_0x4cadeb,_0x151086):_0x4b2ae2,_0xe0ee1e;if(typeof Reflect===_0x5f5648(0x15d)&&typeof Reflect['decorate']===_0x5f5648(0x166))_0x26f3d7=Reflect[_0x5f5648(0x168)](_0x1c1a4d,_0x4cadeb,_0x151086,_0x4b2ae2);else{for(var _0x67381d=_0x1c1a4d[_0x5f5648(0x16d)]-0x1;_0x67381d>=0x0;_0x67381d--)if(_0xe0ee1e=_0x1c1a4d[_0x67381d])_0x26f3d7=(_0x1f642d<0x3?_0xe0ee1e(_0x26f3d7):_0x1f642d>0x3?_0xe0ee1e(_0x4cadeb,_0x151086,_0x26f3d7):_0xe0ee1e(_0x4cadeb,_0x151086))||_0x26f3d7;}return _0x1f642d>0x3&&_0x26f3d7&&Object[_0x5f5648(0x15c)](_0x4cadeb,_0x151086,_0x26f3d7),_0x26f3d7;},__metadata=this&&this['__metadata']||function(_0x2bd72f,_0x2d964a){const _0x558f06=_0x2a385b;if(typeof Reflect===_0x558f06(0x15d)&&typeof Reflect[_0x558f06(0x148)]==='function')return Reflect[_0x558f06(0x148)](_0x2bd72f,_0x2d964a);},__param=this&&this[_0x2a385b(0x16a)]||function(_0x281058,_0x34dc5c){return function(_0xfa7b32,_0x2ddec0){_0x34dc5c(_0xfa7b32,_0x2ddec0,_0x281058);};};Object[_0x2a385b(0x15c)](exports,_0x2a385b(0x15a),{'value':!![]}),exports['RedisCacheService']=void 0x0;const common_1=require(_0x2a385b(0x14b)),Role_constant_1=require('../../common/constants/Role.constant');let RedisCacheService=class RedisCacheService{constructor(_0x35ab1f){this['redisClient']=_0x35ab1f;}async['get'](_0x5820ae){const _0x8860c6=_0x2a385b,{key:_0x4f7e58}=_0x5820ae;return await this[_0x8860c6(0x16b)][_0x8860c6(0x160)](_0x4f7e58);}async[_0x2a385b(0x150)](_0x1c3033,_0x43ea89){const _0x3b4252=_0x2a385b;try{const {key:_0x4cd988,val:_0x186767}=_0x1c3033;await this[_0x3b4252(0x16b)][_0x3b4252(0x150)](_0x4cd988,_0x186767),_0x43ea89&&await this['redisClient'][_0x3b4252(0x16c)](_0x4cd988,_0x43ea89);return;}catch(_0x23fa41){throw new common_1[(_0x3b4252(0x156))](_0x23fa41,common_1[_0x3b4252(0x14f)][_0x3b4252(0x151)]);}}[_0x2a385b(0x158)](_0x182856){const _0x3427d3=_0x2a385b;return this['redisClient'][_0x3427d3(0x164)](_0x182856+'*');}async['ttl'](_0x37d05d){const _0x4ecc79=_0x2a385b;return await this[_0x4ecc79(0x16b)]['ttl'](_0x37d05d);}async[_0x2a385b(0x16f)](_0x51323e){const _0x51b1b1=_0x2a385b,{key:_0x30c1f4}=_0x51323e;return await this['redisClient'][_0x51b1b1(0x16f)](_0x30c1f4);}async[_0x2a385b(0x163)](_0x3a3a38,_0x48ee40){const _0x2c3399=_0x2a385b,_0x218b05=await this[_0x2c3399(0x16b)][_0x2c3399(0x170)](_0x2c3399(0x149)+_0x3a3a38,0x0,-0x1);await this[_0x2c3399(0x15b)](_0x3a3a38,_0x218b05),await this['redisClient'][_0x2c3399(0x150)]('token:'+_0x3a3a38,_0x48ee40);}async['invalidateTokens'](_0x8442be,_0x2d8c85){const _0x5b36d8=_0x2a385b;_0x2d8c85[_0x5b36d8(0x161)](_0x5f6b1e=>{const _0xa31786=_0x5b36d8;this[_0xa31786(0x16b)]['del'](_0xa31786(0x15f)+_0x8442be+':'+_0x5f6b1e);});}async[_0x2a385b(0x171)](_0x502cda,_0x1a2ec3){const _0x30fcf9=_0x2a385b,{id:_0x28b6c0,role:_0x267039}=_0x1a2ec3['user'];if(_0x267039===_0x30fcf9(0x165))return!![];const _0x67257f=await this[_0x30fcf9(0x16b)][_0x30fcf9(0x160)](_0x30fcf9(0x15f)+_0x28b6c0);if(_0x67257f===null)return await this[_0x30fcf9(0x16b)][_0x30fcf9(0x150)](_0x30fcf9(0x15f)+_0x28b6c0,_0x502cda),!![];if(_0x67257f!==_0x502cda){if(_0x267039===Role_constant_1['ERole']['SUPER'])return!![];throw new common_1[(_0x30fcf9(0x156))]('您已在其他设备覆盖登录、请您重新登录！',common_1[_0x30fcf9(0x14f)]['UNAUTHORIZED']);}}};function _0x48ed(_0x357ad4,_0x99c55e){const _0x4a041b=_0x4a04();return _0x48ed=function(_0x48ed45,_0x3465d3){_0x48ed45=_0x48ed45-0x148;let _0x1551ec=_0x4a041b[_0x48ed45];return _0x1551ec;},_0x48ed(_0x357ad4,_0x99c55e);}RedisCacheService=__decorate([(0x0,common_1[_0x2a385b(0x14c)])(),__param(0x0,(0x0,common_1[_0x2a385b(0x167)])(_0x2a385b(0x155))),__metadata('design:paramtypes',[Object])],RedisCacheService),exports['RedisCacheService']=RedisCacheService;