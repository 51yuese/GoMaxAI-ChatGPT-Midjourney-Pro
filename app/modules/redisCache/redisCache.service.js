'use strict';const _0x43838d=_0x2aef;(function(_0x4add85,_0x18b7d1){const _0x31b91b=_0x2aef,_0x363ddf=_0x4add85();while(!![]){try{const _0x4e1778=-parseInt(_0x31b91b(0xae))/0x1+parseInt(_0x31b91b(0xbf))/0x2*(parseInt(_0x31b91b(0xa9))/0x3)+-parseInt(_0x31b91b(0xcd))/0x4*(parseInt(_0x31b91b(0xc4))/0x5)+parseInt(_0x31b91b(0xc1))/0x6+-parseInt(_0x31b91b(0xcf))/0x7*(-parseInt(_0x31b91b(0xbe))/0x8)+-parseInt(_0x31b91b(0xc9))/0x9*(parseInt(_0x31b91b(0xb1))/0xa)+parseInt(_0x31b91b(0xb8))/0xb*(parseInt(_0x31b91b(0xc5))/0xc);if(_0x4e1778===_0x18b7d1)break;else _0x363ddf['push'](_0x363ddf['shift']());}catch(_0x1fb763){_0x363ddf['push'](_0x363ddf['shift']());}}}(_0x37ee,0x6be9d));var __decorate=this&&this[_0x43838d(0xaa)]||function(_0x34ed7e,_0x46530b,_0x532254,_0xd769eb){const _0x1f616d=_0x43838d;var _0x54e633=arguments[_0x1f616d(0xb7)],_0x28e99c=_0x54e633<0x3?_0x46530b:_0xd769eb===null?_0xd769eb=Object['getOwnPropertyDescriptor'](_0x46530b,_0x532254):_0xd769eb,_0x29ce2b;if(typeof Reflect===_0x1f616d(0xd1)&&typeof Reflect[_0x1f616d(0xaf)]===_0x1f616d(0xbb))_0x28e99c=Reflect[_0x1f616d(0xaf)](_0x34ed7e,_0x46530b,_0x532254,_0xd769eb);else{for(var _0x12349=_0x34ed7e[_0x1f616d(0xb7)]-0x1;_0x12349>=0x0;_0x12349--)if(_0x29ce2b=_0x34ed7e[_0x12349])_0x28e99c=(_0x54e633<0x3?_0x29ce2b(_0x28e99c):_0x54e633>0x3?_0x29ce2b(_0x46530b,_0x532254,_0x28e99c):_0x29ce2b(_0x46530b,_0x532254))||_0x28e99c;}return _0x54e633>0x3&&_0x28e99c&&Object[_0x1f616d(0xb5)](_0x46530b,_0x532254,_0x28e99c),_0x28e99c;},__metadata=this&&this[_0x43838d(0xc6)]||function(_0x2f2062,_0x990830){const _0x32a463=_0x43838d;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x32a463(0xbb))return Reflect[_0x32a463(0xc0)](_0x2f2062,_0x990830);},__param=this&&this['__param']||function(_0x489184,_0x2f651b){return function(_0x88c2c4,_0x108142){_0x2f651b(_0x88c2c4,_0x108142,_0x489184);};};function _0x2aef(_0x3bd49d,_0x1e2b20){const _0x37ee1e=_0x37ee();return _0x2aef=function(_0x2aef79,_0x245e55){_0x2aef79=_0x2aef79-0xa9;let _0x570a4c=_0x37ee1e[_0x2aef79];return _0x570a4c;},_0x2aef(_0x3bd49d,_0x1e2b20);}Object[_0x43838d(0xb5)](exports,'__esModule',{'value':!![]}),exports[_0x43838d(0xca)]=void 0x0;function _0x37ee(){const _0x3b50b3=['UNAUTHORIZED','65891AjFMAp','redisClient','object','get','fuzzy','set','258nMienn','__decorate','user','您已在其他设备覆盖登录、请您重新登录！','ttl','294042ezxvpJ','decorate','Injectable','589210MelffV','checkTokenAuth','token:','ERole','defineProperty','saveToken','length','2214355uTDcFZ','BAD_REQUEST','tokens:','function','Inject','../../common/constants/Role.constant','248AERHHz','718NqgteV','metadata','5073516KYTiEM','HttpStatus','HttpException','198335geoScx','12Ergfip','__metadata','@nestjs/common','design:paramtypes','18ngCaiQ','RedisCacheService','del','invalidateTokens','52wzrSyZ'];_0x37ee=function(){return _0x3b50b3;};return _0x37ee();}const common_1=require(_0x43838d(0xc7)),Role_constant_1=require(_0x43838d(0xbd));let RedisCacheService=class RedisCacheService{constructor(_0x4fd031){const _0x47b3e5=_0x43838d;this[_0x47b3e5(0xd0)]=_0x4fd031;}async['get'](_0x19b124){const _0x4a5dca=_0x43838d,{key:_0x224107}=_0x19b124;return await this['redisClient'][_0x4a5dca(0xd2)](_0x224107);}async['set'](_0x3fcab3,_0x4b3dea){const _0x286c88=_0x43838d;try{const {key:_0x11d909,val:_0x13e0e8}=_0x3fcab3;await this['redisClient'][_0x286c88(0xd4)](_0x11d909,_0x13e0e8),_0x4b3dea&&await this['redisClient']['expire'](_0x11d909,_0x4b3dea);return;}catch(_0x2041e5){throw new common_1[(_0x286c88(0xc3))](_0x2041e5,common_1[_0x286c88(0xc2)][_0x286c88(0xb9)]);}}[_0x43838d(0xd3)](_0x318bda){return this['redisClient']['keys'](_0x318bda+'*');}async[_0x43838d(0xad)](_0x44d1c1){const _0xcba639=_0x43838d;return await this[_0xcba639(0xd0)][_0xcba639(0xad)](_0x44d1c1);}async[_0x43838d(0xcb)](_0x46bcc8){const {key:_0x77e81f}=_0x46bcc8;return await this['redisClient']['del'](_0x77e81f);}async[_0x43838d(0xb6)](_0x5ca03a,_0x1f7474){const _0x1f287c=_0x43838d,_0x32010d=await this['redisClient']['zRange'](_0x1f287c(0xba)+_0x5ca03a,0x0,-0x1);await this[_0x1f287c(0xcc)](_0x5ca03a,_0x32010d),await this[_0x1f287c(0xd0)][_0x1f287c(0xd4)](_0x1f287c(0xb3)+_0x5ca03a,_0x1f7474);}async['invalidateTokens'](_0x5d1ee5,_0x7908fa){_0x7908fa['forEach'](_0x344a96=>{const _0x5477a1=_0x2aef;this[_0x5477a1(0xd0)]['del'](_0x5477a1(0xb3)+_0x5d1ee5+':'+_0x344a96);});}async[_0x43838d(0xb2)](_0x818333,_0x50d08a){const _0x490d70=_0x43838d,{id:_0x24f77e,role:_0x1c1a29}=_0x50d08a[_0x490d70(0xab)];if(_0x1c1a29==='visitor')return!![];const _0x101a66=await this['redisClient']['get'](_0x490d70(0xb3)+_0x24f77e);if(_0x101a66===null)return await this[_0x490d70(0xd0)][_0x490d70(0xd4)]('token:'+_0x24f77e,_0x818333),!![];if(_0x101a66!==_0x818333){if(_0x1c1a29===Role_constant_1[_0x490d70(0xb4)]['SUPER'])return!![];throw new common_1['HttpException'](_0x490d70(0xac),common_1[_0x490d70(0xc2)][_0x490d70(0xce)]);}}};RedisCacheService=__decorate([(0x0,common_1[_0x43838d(0xb0)])(),__param(0x0,(0x0,common_1[_0x43838d(0xbc)])('REDIS_CLIENT')),__metadata(_0x43838d(0xc8),[Object])],RedisCacheService),exports[_0x43838d(0xca)]=RedisCacheService;