'use strict';function _0x2247(){const _0x3383ff=['Human','userCollectEntity','favoriteListByTypeAndIds','modelType','invitePage','saasId','createdAt','username','当前手机号已注册、请勿重复注册！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','VIEWER','不可将用户置为未激活状态！','userEntity','vipExpire','roleEntity','】使用扣减','CHAT','UserService','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','vipLeavelName','../cmConfig/cm.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','mj123456admin','duration','updateRole','歌词生成','密码重置为[','866308HDeAwp','../../common/constants/collectType.constant','deductBalance4SD','shouldAccess','\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','文件生成PPT','】失败退还','getValue','log','SD绘画【','SUPER','更换模板','Tool','小工具【','concat','pptCreate','dictEntity','\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL','OTHER','%\x27\x20OR\x20nickname\x20LIKE\x20\x27%','relax','uncollectByRelIds','genInviteCode','upscale|describe|picread::retry|faceswap|shorten','\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','用户名\x09密码\x0a','isPlatform','updateUserPsd','roleSave','修改用户角色失败！','getHumanConfig','refundBalance4Chat','updateSignDay','updateInfo','getReqSaasId','../../common/constants/dict.constant','substring','add','action','当前角色编码不可用，请使用其他角色编码','name','redisCacheService','violationCount','../../common/constants/midjourney.constant','模型【','save','saasSave','clsService','verifyUserCredentials','client','updateVipType','HttpException','createUserAndVerifycation','\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%','DrawSpeed','refundBalance4Video','AGENT','vipFreeNum','disabled','lodash','SaasEntity','pptThesis','mergeCollectCountData','该模型仅限','updateVipExpire2Redis','模板生成PPT','valueOf','czProxyPrice','savaLoginIp','mode','fetch|listbyids|modal|seed','PPT','LinxFox【【','deduct','verificationService','queryByPage','getClientIp','UserCollectEntity','validateBalanceLinxFox','增加PPT单页','getConfigByKeys','deductBalance4Video','生成邀请码失败，请重新试一次吧！','Draw','./../globalConfig/globalConfig.service','metadata','isVerifyEmail','FILE','inviterEmail','insertAccountVipLog','yes','desc','registerVerifyEmailDesc','insertAccountLog','saasId不能为空！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','userType','userBalanceService','mergeCollectData','length','isMobilePhone','@nestjs/typeorm','endOf','configService','MjLeavelRel','./role.entity','】会员永久免费','Chat','】生成失败退还','authorization','onModuleInit','UserInitVipEntity','invitedRewards','startsWith','重新生成封面任务','../../common/utils/date','您还未收藏过该内容','AdminGift','query','count','UserCollectType','price','\x20AND\x20role\x20=\x20\x27','VerificationEnum','用户名已存在！','getMjUserModelPrice','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','inviteRewardVip','isInteger','musicLyrics','startOf','管理员赠送','resetUserPass','用户余额不足，请充值','getVideoConfig','deductBalance4Human','inviteSendStatus','UserStatusEnum','用户名或者邮箱已被注册！','手机号已被使用！','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','GOMAXAI_HOST','increment','2080970vwUFJI','Not','HttpStatusCode','当前账户不存在！','get','getSaasById','HttpStatus','globalConfigService','hideString','changeScore4registe','miniOpenId','\x20AND\x20saasId\x20=\x20','collectPage','%\x27\x20OR\x20email\x20LIKE\x20\x27%','invitedRewardVip','headers','fast_mjDeduction','params','findAndCount','getMiniOpenIdByUserId','\x20AND\x20phone\x20LIKE\x20\x27%','该微信已绑定其他账号！','EDictType','registerSendStatus','filter','giftScore','SD绘画会员永久免费','giftVip','Registration','Registe','toLowerCase','avatar','getUserById','vipLeavelId','getDrawModelVipFree','VipFree','updateViolationCount','pptEditor','getHumanModelVipFree','jsonwebtoken','../dict/dict.entity','zh-CN','绑定微信失败、请联系管理员！','genUserName','registerIp','代理商','getUserInfoFromHeader','BadRequest','3ZJLqrQ','queryOneUserInfo','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','validateUserType','getVideoModelVipFree','mj-','EChangeType','qureyUserInfoByInviteCode','-LinkFox','code','用户不存在！','find','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','assign','\x20AND\x20(username\x20LIKE\x20\x27%','getOne','relateId','../redisCache/redisCache.service','registerBaseUrl','LinkFoxConfig','getMjPrice','恭喜您绑定成功、后续可直接扫码登录了！','validateBalance4Gpt','邮箱已被使用！','userInitVipEntity','defineProperty','deductBalance4Coze','MailerService','lifetimeVip','relId','inviteRewards','--------------当前绘画使用模型2-------------','MJ绘画【','受邀请注册赠送','updateUserStatus','音乐创作','compareSync','customId','isManage','Like','key','relax_mjDeduction','】会员每日限免','996471GFNiMA','queryOne','object','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','1\x20=\x201','VerificationService','random','modelName','type3','getInviteRecord','Tts','%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','collectNum','vipDays','toDate','WORKFLOW','checkUserStatus','register','\x20AND\x20username\x20LIKE\x20\x27%','CZConfig','uncollect','vipFreeKey','queryAll','getCozeModelVipFree','LessThanOrEqual','description','414856uTQHuI','musicUpload','UserFavoriteEntity','queryUserInfoById','updateUserPassword','czVipFree','@nestjs-modules/mailer','access','当前用户不存在！','__esModule','userId','registerVerifyEmailFrom','修改用户信息成功！','ERole','572394GfLAkS','超级管理员不可被操作！','nickname','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','roleDel','decorate','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','initSaasMap','体验会员','class-validator','registerVerifyExpir','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','favorite','\x09mj123456admin\x0a','maskEmail','phone','MjDraw','createBatch','AIVideoMutiConfig','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20AND\x20u.userId\x20=\x20','countByInviteCode','collectListForUserID','DESC','Music','connection','手机号格式错误！','lastLoginIp','getEntity','修改用户信息失败！','includes','saasDel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','formatCreateOrUpdateDate','Invited','type2','indexOf','%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','openId','create','DictEntity','封面任务','rolePage','day','Between','score','\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)','update','isSuper','MoreThan','deductBalanceLinxFox','getVipLeavelRelById','__decorate','ActionCN','GPTS','subscriber','-SD','\x20OFFSET\x20','function','VIP_EXPIRE','前台用户','%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%','DRAW','角色信息不存在！','LinxFox会员永久免费','4618884jlaVMr','saasMap','getLfVipFree','visitor','GlobalConfigService','__metadata','saasUpdate','mergeCollectDataForUserId','查询用户不存在！','__keyevent@0__:expired','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','relax_vip_free','forEach','增加PPT备注','UserEntity','Repository','\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27','exists','generateRandomString','ids','getUserStatus','turbo','registerRewards','model','论文生成PPT','inviteLink','上传音乐','maskIpAddress','%\x27\x20OR\x20id\x20=\x20\x27','refundBalance4Draw','affected','Price','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20AND\x20u.saasId\x20=\x20','pptOutline','EModelType','toString','status','updateUserOpenId','updateStatus','------------------------Price--------------','genUserNames','pptUserType','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','\x20AND\x20u.createdAt\x20>=\x20\x27','MUSIC','34209CDAnCR','split','VIDEO','PPT【','LinkFox','../../common/utils','num','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27','BLACKLISTED','../../common/constants/Role.constant','--------------当前绘画使用模型1-------------','vlrk','ACTIVE','无效的邀请码！','collectList','email','TTS','changeScore4Other','ListSaasByIds','FaceSwap','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','当前密码错误！','注册赠送','error:\x20','delete','replace','getUserListByIds','%\x27\x20)','Inject','turbo_mjDeduction','transaction','VIP_FREE','的账号激活','findBy','inviterPhone','hashSync','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','您已经收藏过该内容','validateBalance4Video','config','refundBalance4MJ','智能体【','PENDING','File','getModelVipFree','diff','isCollect','default','deductBalance4Draw','saasEntity','floor','validateBalance4Draw','deductBalance4MJ','musicUserType','\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','test','then','userInitVip','邀请新用户注册奖励','saasName','HumanApiConfig','user','push','findOne','saasPage','】调用失败退还','debuctBalance4Muisc','userDefautlAvatar','message','当前绑定用户不存在！','consumeConfig','axios','BAD_REQUEST','accessLabel','RedisCacheService','updateUserAppOpenId','30wfzwof','修改用户角色成功！','typeorm','deductBalance4WorkFlow','role','userFavoriteEntity','createVerification','非法访问','音乐【','InjectRepository','./entity/userCollect.entity','lfPrice','../../common/store','数字人【','createUser','../../common/constants/model.constant','__param','lfVipFree','type1','InvitationReward','./userFavorite.entity','修改用户状态成功！','validateBalance4MJ','getUserOpenId','\x20AND\x20`status`\x20=\x20','has','mjLeavelRel','set','collect','password','../../common/constants/verification.constant','CmConfigService','env','./saas.entity','validateBalance4Human','标题大纲任务','getUserByInviteCode','未激活用户不可手动变更状态！','../../common/constants/redisKey.constant','1000yuYdbs','VipLeavel','UserBalanceService','\x20AND\x20u.createdAt\x20<=\x20\x27','dictName','AND\x20email\x20LIKE\x20\x27%','ASC','fast_vip_free','map','mailerService','】使用失败退费','updateVipExpire','turbo_vip_free','APP'];_0x2247=function(){return _0x3383ff;};return _0x2247();}const _0x9167c=_0x77d9;(function(_0x2564e6,_0x8eaa83){const _0x48caae=_0x77d9,_0x37a39d=_0x2564e6();while(!![]){try{const _0x34924c=parseInt(_0x48caae(0x1f7))/0x1+parseInt(_0x48caae(0x1e9))/0x2+-parseInt(_0x48caae(0x1a2))/0x3*(-parseInt(_0x48caae(0x303))/0x4)+-parseInt(_0x48caae(0x392))/0x5+parseInt(_0x48caae(0x238))/0x6+-parseInt(_0x48caae(0x267))/0x7*(parseInt(_0x48caae(0x2da))/0x8)+parseInt(_0x48caae(0x1cf))/0x9*(-parseInt(_0x48caae(0x2b3))/0xa);if(_0x34924c===_0x8eaa83)break;else _0x37a39d['push'](_0x37a39d['shift']());}catch(_0x4ba173){_0x37a39d['push'](_0x37a39d['shift']());}}}(_0x2247,0x635cb));var __decorate=this&&this[_0x9167c(0x22b)]||function(_0x174d6a,_0x31ee3b,_0x54c044,_0x21272f){const _0x452b66=_0x9167c;var _0x50f7b7=arguments[_0x452b66(0x366)],_0x1c04b9=_0x50f7b7<0x3?_0x31ee3b:_0x21272f===null?_0x21272f=Object['getOwnPropertyDescriptor'](_0x31ee3b,_0x54c044):_0x21272f,_0xddf588;if(typeof Reflect===_0x452b66(0x1d1)&&typeof Reflect[_0x452b66(0x1fc)]==='function')_0x1c04b9=Reflect['decorate'](_0x174d6a,_0x31ee3b,_0x54c044,_0x21272f);else{for(var _0x28a24b=_0x174d6a['length']-0x1;_0x28a24b>=0x0;_0x28a24b--)if(_0xddf588=_0x174d6a[_0x28a24b])_0x1c04b9=(_0x50f7b7<0x3?_0xddf588(_0x1c04b9):_0x50f7b7>0x3?_0xddf588(_0x31ee3b,_0x54c044,_0x1c04b9):_0xddf588(_0x31ee3b,_0x54c044))||_0x1c04b9;}return _0x50f7b7>0x3&&_0x1c04b9&&Object[_0x452b66(0x1bd)](_0x31ee3b,_0x54c044,_0x1c04b9),_0x1c04b9;},__metadata=this&&this[_0x9167c(0x23d)]||function(_0xe047f8,_0x20112a){const _0x49dcce=_0x9167c;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x49dcce(0x231))return Reflect[_0x49dcce(0x358)](_0xe047f8,_0x20112a);},__param=this&&this[_0x9167c(0x2c3)]||function(_0x39ebe4,_0x3fcb80){return function(_0x1db455,_0x71b1a0){_0x3fcb80(_0x1db455,_0x71b1a0,_0x39ebe4);};};Object['defineProperty'](exports,_0x9167c(0x1f2),{'value':!![]}),exports[_0x9167c(0x2f9)]=void 0x0;const globalConfig_service_1=require(_0x9167c(0x357)),user_constant_1=require('../../common/constants/user.constant'),mailer_1=require(_0x9167c(0x1ef)),verification_service_1=require('./../verification/verification.service'),common_1=require('@nestjs/common'),typeorm_1=require(_0x9167c(0x368)),typeorm_2=require(_0x9167c(0x2b5)),user_entity_1=require('./user.entity'),bcrypt=require('bcryptjs'),_=require(_0x9167c(0x33e)),jwt=require(_0x9167c(0x199)),verification_constant_1=require(_0x9167c(0x2d1)),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x9167c(0x26c)),balance_constant_1=require('../../common/constants/balance.constant'),class_validator_1=require(_0x9167c(0x200)),redisKey_constant_1=require(_0x9167c(0x2d9)),redisCache_service_1=require(_0x9167c(0x1b5)),model_constant_1=require(_0x9167c(0x2c2)),midjourney_constant_1=require(_0x9167c(0x32e)),user_init_vip_entity_1=require('./user_init_vip.entity'),axios_1=require(_0x9167c(0x2ae)),date_1=require(_0x9167c(0x376)),saas_entity_1=require(_0x9167c(0x2d4)),role_entity_1=require(_0x9167c(0x36c)),store_1=require(_0x9167c(0x2bf)),nestjs_cls_1=require('nestjs-cls'),Role_constant_1=require(_0x9167c(0x270)),userFavorite_entity_1=require(_0x9167c(0x2c7)),userCollect_entity_1=require(_0x9167c(0x2bd)),collectType_constant_1=require(_0x9167c(0x304)),cm_service_1=require(_0x9167c(0x2fc)),dict_entity_1=require(_0x9167c(0x19a)),dict_constant_1=require(_0x9167c(0x326));function _0x77d9(_0x2d48f6,_0x22ddcb){const _0x2247b1=_0x2247();return _0x77d9=function(_0x77d9d7,_0x447674){_0x77d9d7=_0x77d9d7-0x196;let _0x409f32=_0x2247b1[_0x77d9d7];return _0x409f32;},_0x77d9(_0x2d48f6,_0x22ddcb);}let UserService=class UserService{constructor(_0xf33633,_0xfb140d,_0x1b7135,_0xebbfb2,_0x505dbf,_0x5535cd,_0x4cf679,_0x1309b9,_0x3b1e25,_0x19fe1f,_0x1e6030,_0x121ceb,_0x27c437,_0x5cd464,_0xc02cda,_0x54b4df){const _0x32b7ab=_0x9167c;this[_0x32b7ab(0x22e)]=_0xf33633,this['userEntity']=_0xfb140d,this['saasEntity']=_0x1b7135,this[_0x32b7ab(0x2f6)]=_0xebbfb2,this[_0x32b7ab(0x1bc)]=_0x505dbf,this[_0x32b7ab(0x2b8)]=_0x5535cd,this['userCollectEntity']=_0x4cf679,this[_0x32b7ab(0x313)]=_0x1309b9,this[_0x32b7ab(0x332)]=_0x3b1e25,this[_0x32b7ab(0x2e3)]=_0x19fe1f,this[_0x32b7ab(0x32c)]=_0x1e6030,this[_0x32b7ab(0x364)]=_0x121ceb,this[_0x32b7ab(0x399)]=_0x27c437,this[_0x32b7ab(0x34d)]=_0x5cd464,this['configService']=_0xc02cda,this[_0x32b7ab(0x210)]=_0x54b4df;}[_0x9167c(0x371)](){const _0x3a73e2=_0x9167c;console[_0x3a73e2(0x30b)]('UserService\x20Init'),this[_0x3a73e2(0x210)][_0x3a73e2(0x379)](_0x3a73e2(0x217)+Role_constant_1['ERole']['SUPER']+_0x3a73e2(0x26e)+Role_constant_1[_0x3a73e2(0x1f6)][_0x3a73e2(0x33b)]+_0x3a73e2(0x249)+Role_constant_1[_0x3a73e2(0x1f6)][_0x3a73e2(0x2f2)]+_0x3a73e2(0x307)),this[_0x3a73e2(0x1fe)](),this[_0x3a73e2(0x22e)]['pSubscribe'](_0x3a73e2(0x241),async _0x12d920=>{const _0x3cc48c=_0x3a73e2;if(_0x12d920[_0x3cc48c(0x374)](redisKey_constant_1[_0x3cc48c(0x232)])){const _0x32b97f=_0x12d920[_0x3cc48c(0x280)](redisKey_constant_1[_0x3cc48c(0x232)],'');this['userEntity'][_0x3cc48c(0x226)]({'id':Number(_0x32b97f)},{'vipExpire':null});}});}async['initSaasMap'](){const _0x11201f=_0x9167c,_0x14201c=await this[_0x11201f(0x298)]['find']({'where':{'deleteFlag':0x0}});store_1['saasMap']['clear'](),_0x14201c['forEach'](_0x2570cb=>store_1[_0x11201f(0x239)]['set'](_0x2570cb['domain'],_0x2570cb['id'])),store_1[_0x11201f(0x239)]['set'](process[_0x11201f(0x2d3)][_0x11201f(0x390)],0x0);}[_0x9167c(0x213)](){return this['userEntity'];}async[_0x9167c(0x279)](_0x1a7b48){const _0x8d7188=_0x9167c;if(!_0x1a7b48[_0x8d7188(0x366)])return[];return this[_0x8d7188(0x298)][_0x8d7188(0x1ad)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1a7b48)}});}async[_0x9167c(0x2a7)](_0x5b60dc){const _0x19f598=_0x9167c,{page:page=0x1,size:size=0x14,keyword:_0x7efa59}=_0x5b60dc;let _0x32b711;_0x7efa59?_0x32b711=[{'deleteFlag':0x0,'name':(0x0,typeorm_2['Like'])('%'+_0x7efa59+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2[_0x19f598(0x1cb)])('%'+_0x7efa59+'%')}]:_0x32b711={'deleteFlag':0x0};const [_0x114c01,_0x5bf1a1]=await this[_0x19f598(0x298)][_0x19f598(0x3a4)]({'where':_0x32b711,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'}});if(!_0x114c01[_0x19f598(0x366)])return{'rows':[],'count':_0x5bf1a1};const _0x63053b=_0x114c01[_0x19f598(0x2e2)](_0x2c260a=>_0x2c260a['id']),_0x274974=new Map(),_0x2bb07b=await this['userEntity']['find']({'where':{'saasId':(0x0,typeorm_2['In'])(_0x63053b),'role':Role_constant_1[_0x19f598(0x1f6)]['AGENT']}});_0x2bb07b[_0x19f598(0x244)](_0x79b401=>{const _0x4889c8=_0x19f598;_0x274974[_0x4889c8(0x2ce)](_0x79b401[_0x4889c8(0x2ed)],_0x79b401);});const _0x5bf50e=new Map(),_0x51deb9=await this[_0x19f598(0x210)][_0x19f598(0x379)](_0x19f598(0x1af));_0x51deb9[_0x19f598(0x244)](_0x3ea63e=>_0x5bf50e['set'](_0x3ea63e[_0x19f598(0x2ed)],_0x3ea63e[_0x19f598(0x37a)]));const _0x4d0f5b=_0x114c01[_0x19f598(0x2e2)](_0x14f95a=>{const _0x3be8d6=_0x19f598;let _0x7aa600=null,_0x36e5fe=null,_0x2a8349=null,_0x4a0cb4=null;const _0x417abe=_0x274974[_0x3be8d6(0x396)](_0x14f95a['id']);return _0x417abe&&(_0x7aa600=_0x417abe[_0x3be8d6(0x2ef)],_0x36e5fe=_0x417abe['nickname'],_0x2a8349=_0x417abe[_0x3be8d6(0x206)],_0x4a0cb4=_0x417abe[_0x3be8d6(0x276)]),{..._0x14f95a,'username':_0x7aa600,'nickname':_0x36e5fe,'phone':_0x2a8349,'email':_0x4a0cb4,'userCount':_0x5bf50e[_0x3be8d6(0x396)](_0x14f95a['id'])||0x0};});return{'rows':_0x4d0f5b,'count':_0x5bf1a1};}async[_0x9167c(0x397)](_0x2b16ec){const _0x2806d6=_0x9167c;return this[_0x2806d6(0x298)]['findOne']({'where':{'id':_0x2b16ec}});}async[_0x9167c(0x331)](_0x20905e){const _0xd7126c=_0x9167c,_0x4eea16=(0x0,utils_1['getReqSaasId'])(this[_0xd7126c(0x332)]);if(_0x4eea16!==0x0)throw new common_1['HttpException'](_0xd7126c(0x2ba),common_1[_0xd7126c(0x398)]['FORBIDDEN']);return await this[_0xd7126c(0x298)][_0xd7126c(0x330)](_0x20905e),this[_0xd7126c(0x1fe)](),!![];}async[_0x9167c(0x23e)](_0x4fd8d1){const _0x36a5fc=_0x9167c,_0x3bc0f7=(0x0,utils_1[_0x36a5fc(0x325)])(this[_0x36a5fc(0x332)]);return await this[_0x36a5fc(0x298)]['save']({..._0x4fd8d1,'id':_0x3bc0f7}),!![];}async[_0x9167c(0x216)](_0x3bb495){const _0x4f9411=_0x9167c;if(!_0x3bb495[_0x4f9411(0x24c)]||!_0x3bb495['ids'][_0x4f9411(0x366)])return!![];return await this[_0x4f9411(0x298)][_0x4f9411(0x226)]({'id':(0x0,typeorm_2['In'])(_0x3bb495['ids'])},{'deleteFlag':0x1}),!![];}async[_0x9167c(0x221)](_0x3bb4ab,_0x168895){const _0x16bafe=_0x9167c,_0x2703e1=await(0x0,utils_1['getReqSaasId'])(this[_0x16bafe(0x332)]),{page:page=0x1,size:size=0x14,keyword:_0x2b7a25}=_0x168895;let _0x1e0d96=_0x16bafe(0x202)+_0x2703e1+_0x16bafe(0x1d2)+Role_constant_1[_0x16bafe(0x1f6)][_0x16bafe(0x2f2)]+_0x16bafe(0x248);_0x2b7a25&&(_0x1e0d96=_0x16bafe(0x362)+_0x2703e1+_0x16bafe(0x29d)+_0x2b7a25+_0x16bafe(0x1ae)+_0x2b7a25+_0x16bafe(0x1da)+Role_constant_1[_0x16bafe(0x1f6)]['VIEWER']+_0x16bafe(0x242)+_0x2b7a25+_0x16bafe(0x1ae)+_0x2b7a25+_0x16bafe(0x21c));const _0xd5e407=await this['connection'][_0x16bafe(0x379)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1e0d96+_0x16bafe(0x20a)),_0x147e32=await this[_0x16bafe(0x210)][_0x16bafe(0x379)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1e0d96+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20'+size+_0x16bafe(0x230)+(page-0x1)*size+_0x16bafe(0x20a)),_0x582f4e=_0x147e32[_0x16bafe(0x2e2)](_0x4df8ce=>_0x4df8ce['id']);if(_0x582f4e[_0x16bafe(0x366)]){const _0x22c5e2=await this[_0x16bafe(0x298)][_0x16bafe(0x2a6)]({'where':{'id':_0x3bb4ab[_0x16bafe(0x2a4)][_0x16bafe(0x2ed)]}}),_0x71c762=new Map(),_0x397dad=await this[_0x16bafe(0x210)][_0x16bafe(0x379)](_0x16bafe(0x259));_0x397dad[_0x16bafe(0x244)](_0x2eee54=>_0x71c762['set'](_0x2eee54[_0x16bafe(0x2b7)],_0x2eee54[_0x16bafe(0x37a)])),_0x147e32['forEach'](_0x2dabe7=>{const _0x579ad5=_0x16bafe;_0x2dabe7[_0x579ad5(0x2a2)]=_0x22c5e2?.[_0x579ad5(0x32b)]||'平台',_0x2dabe7['userCount']=_0x71c762[_0x579ad5(0x396)](_0x2dabe7[_0x579ad5(0x1ab)])||0x0;});}return{'rows':_0x147e32,'count':Number(_0xd5e407[0x0]?.[_0x16bafe(0x37a)]||0x0)};}async[_0x9167c(0x31f)](_0x12502c,_0x3a1944){const _0x309ac9=_0x9167c,_0x40df02=await(0x0,utils_1['getReqSaasId'])(this[_0x309ac9(0x332)]);if([Role_constant_1[_0x309ac9(0x1f6)][_0x309ac9(0x30d)]['valueOf'](),Role_constant_1[_0x309ac9(0x1f6)][_0x309ac9(0x33b)]['valueOf'](),Role_constant_1['ERole'][_0x309ac9(0x2f2)][_0x309ac9(0x345)]()][_0x309ac9(0x215)](_0x3a1944[_0x309ac9(0x1ab)])&&_0x40df02!==0x0)throw new common_1[(_0x309ac9(0x336))](_0x309ac9(0x32a),common_1[_0x309ac9(0x398)][_0x309ac9(0x2af)]);return await this['roleEntity'][_0x309ac9(0x330)]({..._0x3a1944,'saasId':_0x40df02,'disabled':_0x3a1944[_0x309ac9(0x33d)]??0x0}),!![];}async[_0x9167c(0x1fb)](_0x46bfad,_0x1aeb90){const _0x1eecf7=_0x9167c,_0x5be12a=await(0x0,utils_1[_0x1eecf7(0x325)])(this['clsService']);if(!_0x1aeb90[_0x1eecf7(0x24c)]||!_0x1aeb90[_0x1eecf7(0x24c)][_0x1eecf7(0x366)])return!![];const _0x323b27=await this[_0x1eecf7(0x2f6)][_0x1eecf7(0x1ad)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1aeb90[_0x1eecf7(0x24c)]),'saasId':_0x5be12a}});if(!_0x323b27[_0x1eecf7(0x366)])return!![];const _0x15b2cd=_0x323b27['map'](_0x30c739=>_0x30c739[_0x1eecf7(0x1ab)]),_0x407513=await this[_0x1eecf7(0x2f4)][_0x1eecf7(0x37a)]({'where':{'role':(0x0,typeorm_2['In'])(_0x15b2cd),'saasId':_0x5be12a}});if(_0x407513>0x0)throw new common_1[(_0x1eecf7(0x336))]('还有用户使用相关角色，无法删除！',common_1[_0x1eecf7(0x398)][_0x1eecf7(0x2af)]);return await this['roleEntity'][_0x1eecf7(0x27f)]({'id':(0x0,typeorm_2['In'])(_0x1aeb90[_0x1eecf7(0x24c)])}),!![];}async['findByIds'](_0x2ad701){const _0x7826b5=_0x9167c;if(!_0x2ad701['length'])return[];const _0x7ef6b9=await this['userEntity'][_0x7826b5(0x1ad)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2ad701)}});return _0x7ef6b9;}async[_0x9167c(0x337)](_0x5dc849,_0x8c5ca2){const _0x10343b=_0x9167c,{username:_0x317bb1,email:_0x531342,password:_0x2b9b71,invitedBy:_0x30902b,client:client=0x0}=_0x5dc849;if(_0x30902b){const _0x40c8d9=await this['userEntity']['findOne']({'where':{'inviteCode':_0x30902b}});if(!_0x40c8d9)throw new common_1[(_0x10343b(0x336))](_0x10343b(0x274),common_1[_0x10343b(0x398)][_0x10343b(0x2af)]);}const _0x2ab1d1=[{'username':_0x317bb1},{'email':_0x531342}],_0xafa013=await this[_0x10343b(0x2f4)][_0x10343b(0x2a6)]({'where':_0x2ab1d1});if(_0xafa013&&_0xafa013['status']!==user_constant_1[_0x10343b(0x38c)]['PENDING'])throw new common_1[(_0x10343b(0x336))](_0x10343b(0x38d),common_1[_0x10343b(0x398)][_0x10343b(0x2af)]);try{const _0x2b4a55=_['cloneDeep'](_0x5dc849),_0x36805a=bcrypt['hashSync'](_0x2b9b71,0xa),_0x19d343=(0x0,utils_1[_0x10343b(0x34f)])(_0x8c5ca2);_0x2b4a55[_0x10343b(0x2d0)]=_0x36805a,_0x2b4a55[_0x10343b(0x19e)]=_0x19d343,_0x2b4a55[_0x10343b(0x334)]=client;let _0x46c5b9;if(!_0xafa013){const _0x224b8a=await this[_0x10343b(0x399)][_0x10343b(0x353)]([_0x10343b(0x2aa)]);_0x2b4a55[_0x10343b(0x3b1)]=_0x224b8a,_0x46c5b9=await this[_0x10343b(0x2f4)][_0x10343b(0x330)](_0x2b4a55);}else _0x46c5b9=_0xafa013;const _0x2adf35=await this['globalConfigService'][_0x10343b(0x353)]([_0x10343b(0x359),_0x10343b(0x1b6),'registerVerifyEmailTitle',_0x10343b(0x35f),_0x10343b(0x1f4),'registerVerifyExpir']),_0x4eaf49=_0x2adf35[_0x10343b(0x359)]?Number(_0x2adf35[_0x10343b(0x359)]):0x1;if(_0x4eaf49){const _0x4d5b6d=_0x2adf35[_0x10343b(0x201)]?Number(_0x2adf35['registerVerifyExpir']):0x1e*0x3c,_0x442b16=await this[_0x10343b(0x34d)][_0x10343b(0x2b9)](_0x46c5b9,verification_constant_1[_0x10343b(0x37e)][_0x10343b(0x3ae)],_0x4d5b6d),{code:_0x26dee0,email:_0x98f7af,id:_0x4369de}=_0x442b16,{registerVerifyEmailFrom:_0x288d62}=_0x2adf35;await this[_0x10343b(0x2e3)]['sendMail']({'to':_0x98f7af,'subject':'来自'+_0x288d62+_0x10343b(0x287),'template':_0x10343b(0x1e0),'context':{'baseUrl':_0x2adf35['registerBaseUrl'],'code':_0x26dee0,'id':_0x4369de,..._0x2adf35}});}else{const {id:_0x3f3d96,invitedBy:_0x205950}=_0x46c5b9;await this[_0x10343b(0x1c6)](_0x3f3d96,user_constant_1[_0x10343b(0x38c)]['ACTIVE']);let _0x42c8bb;_0x205950&&(_0x42c8bb=await this[_0x10343b(0x1a9)](_0x205950)),await this[_0x10343b(0x39b)](_0x46c5b9,_0x42c8bb);}return _0x46c5b9;}catch(_0x5e1cdc){console[_0x10343b(0x30b)](_0x10343b(0x27e),_0x5e1cdc);throw _0x5e1cdc;}}async[_0x9167c(0x333)](_0x2e6ac0){const _0x401992=_0x9167c,{username:_0x3ea183,password:_0x407064,uid:uid=0x0,phone:_0x5e9a66}=_0x2e6ac0;let _0x2e9bd6=null;if(uid>0x0){_0x2e9bd6=await this['userEntity'][_0x401992(0x2a6)]({'where':{'id':uid}});if(!_0x2e9bd6)throw new common_1[(_0x401992(0x336))]('当前账户不存在！',common_1[_0x401992(0x398)][_0x401992(0x2af)]);if(!bcrypt[_0x401992(0x1c8)](_0x407064,_0x2e9bd6[_0x401992(0x2d0)]))throw new common_1[(_0x401992(0x336))](_0x401992(0x27c),common_1['HttpStatus'][_0x401992(0x2af)]);}if(_0x3ea183&&_0x407064){const _0x5b3e9e=[{'username':_0x3ea183},{'email':_0x3ea183}];_0x2e9bd6=await this[_0x401992(0x2f4)][_0x401992(0x2a6)]({'where':_0x5b3e9e});if(!_0x2e9bd6)throw new common_1[(_0x401992(0x336))](_0x401992(0x395),common_1[_0x401992(0x398)][_0x401992(0x2af)]);if(!bcrypt[_0x401992(0x1c8)](_0x407064,_0x2e9bd6[_0x401992(0x2d0)]))throw new common_1[(_0x401992(0x336))](_0x401992(0x27c),common_1['HttpStatus'][_0x401992(0x2af)]);}if(_0x5e9a66&&_0x407064){const _0xf2d1e8=[{'phone':_0x5e9a66}];_0x2e9bd6=await this[_0x401992(0x2f4)][_0x401992(0x2a6)]({'where':_0xf2d1e8});if(!_0x2e9bd6)throw new common_1[(_0x401992(0x336))](_0x401992(0x395),common_1[_0x401992(0x398)]['BAD_REQUEST']);if(!bcrypt[_0x401992(0x1c8)](_0x407064,_0x2e9bd6['password']))throw new common_1[(_0x401992(0x336))](_0x401992(0x27c),common_1[_0x401992(0x398)][_0x401992(0x2af)]);}if(!_0x2e9bd6)throw new common_1['HttpException'](_0x401992(0x395),common_1[_0x401992(0x398)][_0x401992(0x2af)]);if(_0x2e9bd6['status']!==user_constant_1[_0x401992(0x38c)][_0x401992(0x273)])throw new common_1[(_0x401992(0x336))](user_constant_1['UserStatusErrMsg'][_0x2e9bd6[_0x401992(0x25e)]],common_1[_0x401992(0x398)][_0x401992(0x2af)]);if(_0x2e9bd6['username']&&!_0x2e9bd6['lastLoginIp']){const _0x5a2747=await this['userInitVipEntity'][_0x401992(0x2a6)]({'where':{'username':_0x2e9bd6[_0x401992(0x2ef)]}});_0x5a2747&&await this[_0x401992(0x210)][_0x401992(0x285)](async()=>{const _0x4d6e81=_0x401992;_0x5a2747['vipDays']===-0x1?_0x2e9bd6[_0x4d6e81(0x1c0)]=0x1:_0x2e9bd6[_0x4d6e81(0x2f5)]=(0x0,date_1[_0x4d6e81(0x296)])()[_0x4d6e81(0x328)](_0x5a2747['vipDays'],_0x4d6e81(0x222))[_0x4d6e81(0x1dd)](),_0x2e9bd6=await this[_0x4d6e81(0x2f4)]['save'](_0x2e9bd6),await this['userInitVipEntity'][_0x4d6e81(0x27f)]({'id':_0x5a2747['id']});});}return _0x2e9bd6;}async['verifyUserPassword'](_0x2cdf68,_0x4fab3d){const _0x1e1044=_0x9167c,_0x2e3f04=await this[_0x1e1044(0x2f4)][_0x1e1044(0x2a6)]({'where':{'id':_0x2cdf68}});return bcrypt[_0x1e1044(0x1c8)](_0x4fab3d,_0x2e3f04[_0x1e1044(0x2d0)]);}async[_0x9167c(0x1c6)](_0x9230fd,_0x1da341){const _0x4efcc8=await this['userEntity']['update']({'id':_0x9230fd},{'status':_0x1da341});return _0x4efcc8['affected']>0x0;}async[_0x9167c(0x24d)](_0x4cdaaa){const _0x452e99=_0x9167c,_0x35e468=await this[_0x452e99(0x2f4)][_0x452e99(0x2a6)]({'where':{'id':_0x4cdaaa}});return _0x35e468['status'];}async[_0x9167c(0x1ec)](_0x16b107){return await this['userEntity']['findOne']({'where':{'id':_0x16b107}});}async['queryUserInfoByIds'](_0x22683e){const _0x33f7d5=_0x9167c;return await this[_0x33f7d5(0x2f4)][_0x33f7d5(0x288)]({'id':(0x0,typeorm_2['In'])(_0x22683e)});}async['queryUserByUsername'](_0x5a80d0){const _0x5978c7=_0x9167c;return await this[_0x5978c7(0x2f4)][_0x5978c7(0x2a6)]({'where':{'username':_0x5a80d0}});}async[_0x9167c(0x25f)](_0x4d43fc,_0xd71377,_0x27acc4){const _0x28d6c8=_0x9167c;return await this[_0x28d6c8(0x2f4)][_0x28d6c8(0x226)](_0x4d43fc,{'openId':_0xd71377,'unionid':_0x27acc4});}async['updateUserMiniOpenId'](_0x517446,_0x4c19fd,_0x59871a){const _0x540d4e=_0x9167c;return await this[_0x540d4e(0x2f4)][_0x540d4e(0x226)](_0x517446,{'miniOpenId':_0x4c19fd,'unionid':_0x59871a});}async[_0x9167c(0x2b2)](_0x25bd64,_0x156e5f,_0x4efa9f){const _0x3d58c1=_0x9167c;return await this[_0x3d58c1(0x2f4)][_0x3d58c1(0x226)](_0x25bd64,{'weAppOpenId':_0x156e5f,'unionid':_0x4efa9f});}async[_0x9167c(0x31e)](_0x37a84a){const _0x425133=_0x9167c,{id:_0xc10b0b,username:_0x522228,password:_0x9617c1}=_0x37a84a;return await this[_0x425133(0x2f4)][_0x425133(0x226)](_0xc10b0b,{'username':_0x522228,'password':_0x9617c1});}async[_0x9167c(0x1a3)](_0x544c7a){const _0x258a57=_0x9167c;return await this[_0x258a57(0x2f4)][_0x258a57(0x2a6)]({'where':{'id':_0x544c7a}});}async[_0x9167c(0x1df)](_0x53b672){const _0x27b705=_0x9167c,{id:_0x2b4a96,role:_0x2cfbaa}=_0x53b672;if(_0x2cfbaa===_0x27b705(0x23b))return!![];const _0x4f71ee=await this[_0x27b705(0x2f4)][_0x27b705(0x2a6)]({'where':{'id':_0x2b4a96}});if(!_0x4f71ee)throw new common_1[(_0x27b705(0x336))]('当前用户信息失效、请重新登录！',common_1['HttpStatus']['UNAUTHORIZED']);if(_0x4f71ee[_0x27b705(0x25e)]===user_constant_1[_0x27b705(0x38c)][_0x27b705(0x26f)])throw new common_1[(_0x27b705(0x336))](_0x27b705(0x1fa),common_1[_0x27b705(0x398)][_0x27b705(0x2af)]);if(_0x4f71ee[_0x27b705(0x25e)]===user_constant_1['UserStatusEnum']['LOCKED'])throw new common_1['HttpException']('您的账户已被封禁、如有疑问、请联系管理员！',common_1[_0x27b705(0x398)]['BAD_REQUEST']);}async[_0x9167c(0x3b2)](_0x221283){const _0x4f6539=_0x9167c;return await this[_0x4f6539(0x2f4)][_0x4f6539(0x2a6)]({'where':{'id':_0x221283}});}[_0x9167c(0x281)](_0x5f171b){const _0x29e4b0=_0x9167c;return this[_0x29e4b0(0x2f4)][_0x29e4b0(0x1ad)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5f171b)}});}async[_0x9167c(0x2d7)](_0x3cf8b3){const _0x2775a9=_0x9167c;return this[_0x2775a9(0x2f4)][_0x2775a9(0x2a6)]({'where':{'inviteCode':_0x3cf8b3}});}async[_0x9167c(0x2ca)](_0xbaa558){const _0x5c3246=_0x9167c,_0x5b178e=(0x0,utils_1['getReqSaasId'])(this[_0x5c3246(0x332)]);return await this[_0x5c3246(0x2f4)][_0x5c3246(0x2a6)]({'where':{'openId':_0xbaa558,'saasId':_0x5b178e}});}async['getUserUnionId'](_0x8c3ecb){const _0x994a2d=_0x9167c,_0x4fc651=(0x0,utils_1[_0x994a2d(0x325)])(this[_0x994a2d(0x332)]);return await this[_0x994a2d(0x2f4)][_0x994a2d(0x2a6)]({'where':{'unionid':_0x8c3ecb,'saasId':_0x4fc651}});}async[_0x9167c(0x20c)](_0x410f6e){const _0x23fb98=_0x9167c;return this[_0x23fb98(0x2f4)][_0x23fb98(0x37a)]({'where':{'invitedBy':_0x410f6e}});}async[_0x9167c(0x324)](_0x516277,_0x4e4a99){const _0x829c74=_0x9167c,{id:_0x323b38}=_0x4e4a99[_0x829c74(0x2a4)],_0x266da7=await this[_0x829c74(0x2f4)][_0x829c74(0x2a6)]({'where':{'id':_0x323b38}});if(!_0x266da7)throw new common_1[(_0x829c74(0x336))](_0x829c74(0x1f1),common_1[_0x829c74(0x398)][_0x829c74(0x2af)]);if(_0x516277[_0x829c74(0x2ef)]&&_0x266da7[_0x829c74(0x2ef)]===_0x516277[_0x829c74(0x2ef)])throw new common_1[(_0x829c74(0x336))]('没有变更，无需更改！',common_1[_0x829c74(0x398)][_0x829c74(0x2af)]);if(_0x516277[_0x829c74(0x2ef)]){const _0x1e06ba=await this[_0x829c74(0x2f4)]['findOne']({'where':{'username':_0x516277[_0x829c74(0x2ef)],'id':(0x0,typeorm_2[_0x829c74(0x393)])(_0x323b38)}});if(_0x1e06ba)throw new common_1[(_0x829c74(0x336))](_0x829c74(0x37f),common_1[_0x829c74(0x398)]['BAD_REQUEST']);}const _0x38d07b=await this[_0x829c74(0x2f4)]['update']({'id':_0x323b38},_0x516277);if(_0x38d07b['affected']<=0x0)throw new common_1['HttpException'](_0x829c74(0x214),common_1[_0x829c74(0x398)][_0x829c74(0x2af)]);return _0x829c74(0x1f5);}async[_0x9167c(0x1ed)](_0x277a71,_0x4f11b1){const _0x4af8b1=_0x9167c,_0x4c83a9=bcrypt[_0x4af8b1(0x28a)](_0x4f11b1,0xa),_0x4b1a75=await this[_0x4af8b1(0x2f4)]['update']({'id':_0x277a71},{'password':_0x4c83a9});if(_0x4b1a75[_0x4af8b1(0x257)]<=0x0)throw new common_1[(_0x4af8b1(0x336))]('修改密码失败、请重新试试吧。',common_1['HttpStatus'][_0x4af8b1(0x2af)]);}async[_0x9167c(0x203)](_0x5a04fb,_0x420de1){const _0x3d28f9=_0x9167c;try{const _0x500994=await this['userFavoriteEntity'][_0x3d28f9(0x2a6)]({'where':{'userId':_0x5a04fb[_0x3d28f9(0x2a4)]['id'],'relateId':_0x420de1[_0x3d28f9(0x1b4)],'relateType':_0x420de1['relateType']}});return _0x500994?await this[_0x3d28f9(0x2b8)]['delete']({'id':_0x500994['id']}):await this['userFavoriteEntity'][_0x3d28f9(0x330)]({'userId':_0x5a04fb[_0x3d28f9(0x2a4)]['id'],'relateId':_0x420de1['relateId'],'relateType':_0x420de1['relateType']}),!![];}catch(_0x431654){throw new common_1[(_0x3d28f9(0x336))](_0x431654[_0x3d28f9(0x2ab)],common_1[_0x3d28f9(0x398)][_0x3d28f9(0x2af)]);}}async[_0x9167c(0x2ea)](_0x81d44b,_0x3435bd,_0x5e2bed){const _0x47e20b=_0x9167c;return this[_0x47e20b(0x2b8)][_0x47e20b(0x1ad)]({'where':{'userId':_0x81d44b,'relateType':_0x3435bd,'relateId':(0x0,typeorm_2['In'])(_0x5e2bed)}});}async[_0x9167c(0x319)](_0x5bc6cd){const _0x367069=_0x9167c,{id:_0x22a1cc}=_0x5bc6cd['user'],_0x7724e3=await this[_0x367069(0x2f4)][_0x367069(0x2a6)]({'where':{'id':_0x22a1cc}});if(!_0x7724e3||_0x7724e3['inviteCode'])throw new common_1[(_0x367069(0x336))]('已生成过邀请码、请勿重复生成',common_1[_0x367069(0x398)][_0x367069(0x2af)]);const _0x5bfc0c=(0x0,utils_1[_0x367069(0x24b)])(),_0x25831e=await this[_0x367069(0x2f4)][_0x367069(0x2a6)]({'where':{'inviteCode':_0x5bfc0c}});if(_0x25831e)throw new common_1[(_0x367069(0x336))](_0x367069(0x355),common_1['HttpStatus'][_0x367069(0x2af)]);const _0x165ee5=await this[_0x367069(0x2f4)]['update']({'id':_0x22a1cc},{'inviteCode':_0x5bfc0c});if(_0x165ee5[_0x367069(0x257)]<=0x0)throw new common_1[(_0x367069(0x336))](_0x367069(0x355),common_1[_0x367069(0x398)][_0x367069(0x2af)]);return _0x5bfc0c;}async[_0x9167c(0x1d8)](_0x5803dc,_0x1b5bdb){const _0x3294ef=_0x9167c;try{const {id:_0x104ae2}=_0x5803dc['user'],{page:page=0x1,size:size=0xa}=_0x1b5bdb,_0x59db91=await this['userEntity'][_0x3294ef(0x2a6)]({'where':{'id':_0x104ae2}}),{inviteCode:_0xb97868}=_0x59db91;if(!_0xb97868)return[];const [_0x2490d1,_0x226d17]=await this[_0x3294ef(0x2f4)][_0x3294ef(0x3a4)]({'where':{'inviteCode':_0xb97868},'order':{'id':'DESC'},'select':[_0x3294ef(0x2ef),_0x3294ef(0x276),_0x3294ef(0x2ee),'status','avatar'],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x3294ef(0x218)])(_0x2490d1)[_0x3294ef(0x2e2)](_0x480a0d=>{const _0xb51165=_0x3294ef;return _0x480a0d[_0xb51165(0x276)]=(0x0,utils_1[_0xb51165(0x205)])(_0x480a0d['email']),_0x480a0d;}),{'rows':_0x2490d1,'count':_0x226d17};}catch(_0x1d3d7c){console[_0x3294ef(0x30b)]('error:\x20',_0x1d3d7c);throw new common_1[(_0x3294ef(0x336))]('获取邀请记录失败！',common_1[_0x3294ef(0x398)][_0x3294ef(0x2af)]);}}async[_0x9167c(0x2ec)](_0x35eb41,_0x5c11a3,_0x14acd8){const _0x2609dd=_0x9167c,_0xd0ee21=(0x0,utils_1['getReqSaasId'])(this['clsService']),{page:page=0x1,size:size=0x14,startTime:_0xf8cf75,endTime:_0x2a8776,saasId:_0x725168,keyword:_0x248e27,inviterKeyword:_0x30799e}=_0x5c11a3,_0x42ef1c='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x14acd8?_0x2609dd(0x20b)+_0x14acd8:'')+_0x2609dd(0x2fd)+(_0x2a8776?_0x2609dd(0x2dd)+_0x2a8776+'\x27':'')+_0x2609dd(0x2fd)+(_0xf8cf75?_0x2609dd(0x265)+_0xf8cf75+'\x27':'')+_0x2609dd(0x2fd)+(_0xd0ee21!==0x0?'\x20AND\x20u.saasId\x20=\x20'+_0xd0ee21:(0x0,utils_1['isDefined'])(_0x725168)?_0x2609dd(0x25a)+_0x725168:'')+_0x2609dd(0x2fd)+(_0x248e27?_0x2609dd(0x31b)+_0x248e27+_0x2609dd(0x27b)+_0x248e27+_0x2609dd(0x234)+_0x248e27+'%\x27\x20OR\x20u.email\x20LIKE\x20\x27%'+_0x248e27+_0x2609dd(0x282):'')+_0x2609dd(0x2fd)+(_0x30799e?_0x2609dd(0x338)+_0x30799e+'%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%'+_0x30799e+'%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%'+_0x30799e+_0x2609dd(0x1fd)+_0x30799e+_0x2609dd(0x282):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x41da5f=_0x2609dd(0x381)+_0x42ef1c+_0x2609dd(0x20a),_0x5defc9=_0x2609dd(0x2f1)+_0x42ef1c+_0x2609dd(0x1a4)+size+_0x2609dd(0x230)+(page-0x1)*size+_0x2609dd(0x20a),_0x3f8653=await this[_0x2609dd(0x210)][_0x2609dd(0x379)](_0x41da5f),_0x7659f4=await this[_0x2609dd(0x210)][_0x2609dd(0x379)](_0x5defc9);return!(0x0,utils_1[_0x2609dd(0x227)])(this['clsService'])&&_0x7659f4[_0x2609dd(0x244)](_0x3e0adb=>{const _0x5dfaa4=_0x2609dd;_0x3e0adb['phone']=(0x0,utils_1['hideString'])(_0x3e0adb[_0x5dfaa4(0x206)]),_0x3e0adb[_0x5dfaa4(0x276)]=(0x0,utils_1['hideString'])(_0x3e0adb[_0x5dfaa4(0x276)]),_0x3e0adb['inviterPhone']=(0x0,utils_1['hideString'])(_0x3e0adb[_0x5dfaa4(0x289)]),_0x3e0adb[_0x5dfaa4(0x35b)]=(0x0,utils_1[_0x5dfaa4(0x39a)])(_0x3e0adb[_0x5dfaa4(0x35b)]);}),{'rows':_0x7659f4,'count':Number(_0x3f8653[0x0]?.[_0x2609dd(0x37a)]||0x0)};}async[_0x9167c(0x252)](_0x316297){const _0x1edb3e=_0x9167c,_0x5883f1=await this[_0x1edb3e(0x2f4)][_0x1edb3e(0x2a6)]({'where':{'inviteCode':_0x316297}});if(!_0x5883f1)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x5883f1,_0x4a81f2=await this[_0x1edb3e(0x2f4)]['update']({'inviteCode':_0x316297},{'inviteLinkCount':inviteLinkCount+0x1});return _0x4a81f2[_0x1edb3e(0x257)]?0x1:0x0;}async[_0x9167c(0x1a9)](_0x57664b){const _0x51683c=_0x9167c;return await this[_0x51683c(0x2f4)][_0x51683c(0x2a6)]({'where':{'inviteCode':_0x57664b}});}async[_0x9167c(0x1e5)](_0x4d9ba5,_0x2ba30d){const _0x18c0a5=_0x9167c,_0x298a8e=(0x0,utils_1[_0x18c0a5(0x325)])(this['clsService']);let {page:page=0x1,size:size=0xa,username:_0x225285,phone:_0x383d05,email:_0x558407,status:_0xd9149f,keyword:_0x1929fd,roleCode:_0x40d252,vip:_0x1abe7a,saasId:_0x517252}=_0x4d9ba5,_0x2adcd4=_0x18c0a5(0x1d3);_0xd9149f&&(_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x2cb)+_0xd9149f));_0x40d252&&(_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x37d)+_0x40d252+'\x27'));_0x1abe7a&&(_0x1abe7a=Number(_0x1abe7a));if(_0x1abe7a===0x1)_0x2adcd4=_0x2adcd4+_0x18c0a5(0x225);else _0x1abe7a===0x0&&(_0x2adcd4=_0x2adcd4+_0x18c0a5(0x314));_0x1929fd?_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x1b2)+_0x1929fd+_0x18c0a5(0x316)+_0x1929fd+_0x18c0a5(0x264)+_0x1929fd+_0x18c0a5(0x39f)+_0x1929fd+_0x18c0a5(0x255)+_0x1929fd+'\x27)'):(_0x225285&&(_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x1e1)+_0x225285+'%\x27')),_0x558407&&(_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x2df)+_0x558407+'%\x27')),_0x383d05&&(_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x3a6)+_0x383d05+'%\x27')));(0x0,utils_1[_0x18c0a5(0x31d)])(this[_0x18c0a5(0x332)])?(0x0,utils_1[_0x18c0a5(0x1ca)])(this[_0x18c0a5(0x332)])&&_0x517252&&(_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x39d)+_0x517252)):_0x2adcd4=_0x2adcd4+(_0x18c0a5(0x39d)+_0x298a8e);const _0x40282a=await this[_0x18c0a5(0x210)][_0x18c0a5(0x379)](_0x18c0a5(0x1b0)+_0x2adcd4+_0x18c0a5(0x38f)),_0x519415=await this['connection'][_0x18c0a5(0x379)](_0x18c0a5(0x28b)+_0x2adcd4+_0x18c0a5(0x2fa)+size+_0x18c0a5(0x230)+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x3a4dbb=[],_0x629403=(0x0,utils_1['isSuper'])(this['clsService']),_0x4ec477=new Map([[Role_constant_1['ERole'][_0x18c0a5(0x33b)],_0x18c0a5(0x19f)],[Role_constant_1[_0x18c0a5(0x1f6)]['SUPER'],'超级管理员'],[Role_constant_1[_0x18c0a5(0x1f6)]['VIEWER'],'前台用户']]);for(let _0x1e0074=0x0;_0x1e0074<_0x519415['length'];_0x1e0074++){const _0x599791=_0x519415[_0x1e0074];let _0xa7a052=_0x18c0a5(0x233);if(_0x4ec477[_0x18c0a5(0x2cc)](_0x599791[_0x18c0a5(0x2b7)]))_0xa7a052=_0x4ec477['get'](_0x599791[_0x18c0a5(0x2b7)]);else{const _0x2660fe=await this['roleEntity']['findOne']({'where':{'code':_0x599791[_0x18c0a5(0x2b7)],'saasId':_0x599791[_0x18c0a5(0x2ed)]}});_0xa7a052=_0x2660fe['name'];}_0x3a4dbb[_0x18c0a5(0x2a5)]({..._0x599791,'roleName':_0xa7a052,'isBindWx':!!_0x599791?.[_0x18c0a5(0x21d)],'password':_0x599791[_0x18c0a5(0x2d0)]?_0x18c0a5(0x35d):'no','email':_0x629403?_0x599791['email']:(0x0,utils_1['maskEmail'])(_0x599791[_0x18c0a5(0x276)]),'phone':_0x629403?_0x599791[_0x18c0a5(0x206)]:(0x0,utils_1['maskEmail'])(_0x599791[_0x18c0a5(0x206)]),'lastLoginIp':_0x629403?_0x599791[_0x18c0a5(0x212)]:(0x0,utils_1[_0x18c0a5(0x254)])(_0x599791[_0x18c0a5(0x212)])});}return{'rows':_0x3a4dbb,'count':Number(_0x40282a[0x0]?.[_0x18c0a5(0x37a)]||0x0)};}async[_0x9167c(0x34e)](_0x1658ba){const _0x5ea3a7=_0x9167c,{page:page=0x1,size:size=0xa,username:_0x569321,status:_0x11bf4b}=_0x1658ba;let _0x3b902c={};_0x569321&&Object[_0x5ea3a7(0x1b1)](_0x3b902c,{'username':(0x0,typeorm_2[_0x5ea3a7(0x1cb)])('%'+_0x569321+'%')}),_0x11bf4b&&Object['assign'](_0x3b902c,{'status':_0x11bf4b});const [_0x5bb763,_0x325c57]=await this['userEntity']['findAndCount']({'skip':(page-0x1)*size,'where':_0x3b902c,'take':size,'cache':!![],'order':{'createdAt':_0x5ea3a7(0x20e)},'select':['username',_0x5ea3a7(0x2d0),_0x5ea3a7(0x2b7),'status','id']});return{'rows':_0x5bb763,'count':_0x325c57};}async[_0x9167c(0x1d0)]({id:_0x328b14}){const _0x42b7de=_0x9167c;let _0x174de1,_0x5065be;const _0x145789=await this[_0x42b7de(0x2f4)][_0x42b7de(0x2a6)]({'where':{'id':_0x328b14}});if(!_0x145789)throw new common_1[(_0x42b7de(0x336))](_0x42b7de(0x240),common_1['HttpStatus']['UNAUTHORIZED']);if((0x0,utils_1[_0x42b7de(0x306)])(_0x145789[_0x42b7de(0x2b7)])){const _0x23974e=_0x145789[_0x42b7de(0x2b7)]===Role_constant_1['ERole']['AGENT']?0x0:_0x145789['saasId'],_0xd00908=await this['roleEntity'][_0x42b7de(0x2a6)]({'where':{'code':_0x145789[_0x42b7de(0x2b7)],'saasId':_0x23974e}});if(!_0xd00908)throw new common_1[(_0x42b7de(0x336))](_0x42b7de(0x236),common_1['HttpStatus']['BAD_REQUEST']);_0x174de1=_0xd00908[_0x42b7de(0x1f0)],_0x5065be=_0xd00908[_0x42b7de(0x2b0)];}return{..._0x145789,'access':_0x174de1,'accessLabel':_0x5065be,'isBindWx':!!_0x145789?.[_0x42b7de(0x21d)],'password':_0x145789[_0x42b7de(0x2d0)]?_0x42b7de(0x35d):'no'};}async[_0x9167c(0x1b3)](_0x1cb5f2){const _0x338ed5=_0x9167c;return await this[_0x338ed5(0x2f4)][_0x338ed5(0x2a6)]({'where':{'username':_0x1cb5f2}});}async[_0x9167c(0x260)](_0x13dbce){const _0x470fb1=_0x9167c,{id:_0x401781,status:_0x46f5a6}=_0x13dbce,_0x1e960b=await this[_0x470fb1(0x2f4)][_0x470fb1(0x2a6)]({'where':{'id':_0x401781}});if(!_0x1e960b)throw new common_1['HttpException']('用户不存在！',common_1[_0x470fb1(0x398)][_0x470fb1(0x2af)]);if(_0x1e960b['role']===Role_constant_1[_0x470fb1(0x1f6)]['SUPER'])throw new common_1['HttpException'](_0x470fb1(0x1f8),common_1['HttpStatus'][_0x470fb1(0x2af)]);if(_0x1e960b['status']===user_constant_1[_0x470fb1(0x38c)]['PENDING'])throw new common_1[(_0x470fb1(0x336))](_0x470fb1(0x2d8),common_1[_0x470fb1(0x398)]['BAD_REQUEST']);if(_0x46f5a6===user_constant_1[_0x470fb1(0x38c)][_0x470fb1(0x291)])throw new common_1['HttpException'](_0x470fb1(0x2f3),common_1['HttpStatus']['BAD_REQUEST']);const _0xfdb0d0=await this['userEntity']['update']({'id':_0x401781},{'status':_0x46f5a6});if(_0xfdb0d0['affected']<=0x0)throw new common_1[(_0x470fb1(0x336))]('修改用户状态失败！',common_1[_0x470fb1(0x398)]['BAD_REQUEST']);return _0x470fb1(0x2c8);}async['updateUser'](_0x369c37){const _0x25e2c3=_0x9167c,{id:_0x53a6c1}=_0x369c37,_0xc53f42=await this[_0x25e2c3(0x2f4)]['findOne']({'where':{'id':_0x53a6c1}});if(!_0xc53f42)throw new common_1['HttpException'](_0x25e2c3(0x1ac),common_1['HttpStatus'][_0x25e2c3(0x2af)]);if(_0xc53f42[_0x25e2c3(0x2b7)]===Role_constant_1[_0x25e2c3(0x1f6)][_0x25e2c3(0x30d)])throw new common_1['HttpException'](_0x25e2c3(0x1f8),common_1['HttpStatus']['BAD_REQUEST']);const _0xa17a0=await this[_0x25e2c3(0x2f4)][_0x25e2c3(0x330)](_0x369c37);return'修改用户状态成功！';}async[_0x9167c(0x300)](_0x2fd2fb){const _0x55b9f0=_0x9167c,{id:_0x5dce8e,role:_0x448206}=_0x2fd2fb,_0x1a478f=await this[_0x55b9f0(0x2f4)][_0x55b9f0(0x226)]({'id':_0x5dce8e},{'role':_0x448206});if(_0x1a478f[_0x55b9f0(0x257)]<=0x0)throw new common_1[(_0x55b9f0(0x336))](_0x55b9f0(0x320),common_1[_0x55b9f0(0x398)][_0x55b9f0(0x2af)]);return _0x55b9f0(0x2b4);}async[_0x9167c(0x387)](_0x5b72ce){const _0x76a8af=_0x9167c,{id:_0x2af4ec}=_0x5b72ce,_0x4af765=await this[_0x76a8af(0x2f4)][_0x76a8af(0x2a6)]({'where':{'id':_0x2af4ec}});if(!_0x4af765)throw new common_1['HttpException'](_0x76a8af(0x1ac),common_1['HttpStatus'][_0x76a8af(0x2af)]);const _0x2e372e='123456',_0x15b7d0=bcrypt['hashSync'](_0x2e372e,0xa),_0x21447d=await this[_0x76a8af(0x2f4)]['update']({'id':_0x2af4ec},{'password':_0x15b7d0});if(_0x21447d[_0x76a8af(0x257)]<=0x0)throw new common_1[(_0x76a8af(0x336))]('重置密码失败！',common_1[_0x76a8af(0x398)][_0x76a8af(0x2af)]);return _0x76a8af(0x302)+_0x2e372e+']成功!';}async[_0x9167c(0x347)](_0x2b1efa,_0x177398){const _0xc716aa=_0x9167c;return await this['userEntity'][_0xc716aa(0x226)]({'id':_0x2b1efa},{'lastLoginIp':_0x177398});}async['bindWx'](_0x5104a0,_0x820691,_0x342db7){const _0x2f895c=_0x9167c;try{const _0x4be8eb=await this['userEntity'][_0x2f895c(0x2a6)]({'where':{'id':_0x342db7}});if(!_0x4be8eb)return{'status':![],'msg':_0x2f895c(0x2ac)};if(_0x820691){const _0x3d1e2d=await this[_0x2f895c(0x2f4)][_0x2f895c(0x2a6)]({'where':{'unionid':_0x820691}});if(_0x3d1e2d)return{'status':![],'msg':_0x2f895c(0x3a7)};}const _0x5c549e=await this[_0x2f895c(0x2f4)]['findOne']({'where':{'openId':_0x5104a0}});if(_0x5c549e)return{'status':![],'msg':_0x2f895c(0x3a7)};const _0x3f11aa=await this['userEntity'][_0x2f895c(0x226)]({'id':_0x342db7},{'openId':_0x5104a0});if(_0x3f11aa[_0x2f895c(0x257)]<=0x0)return{'status':![],'msg':_0x2f895c(0x19c)};return{'status':!![],'msg':_0x2f895c(0x1b9)};}catch(_0x16d87a){return{'status':![],'msg':_0x2f895c(0x19c)};}}async['getOpenIdByUserId'](_0x1af460){const _0x3b11bc=_0x9167c,_0x412f77=await this['userEntity'][_0x3b11bc(0x2a6)]({'where':{'id':_0x1af460}});return _0x412f77?.[_0x3b11bc(0x21d)];}async[_0x9167c(0x3a5)](_0x417f1d){const _0x68ce19=_0x9167c,_0x27161e=await this[_0x68ce19(0x2f4)]['findOne']({'where':{'id':_0x417f1d}});return _0x27161e?.[_0x68ce19(0x39c)];}async['verifyUserRegisterByPhone'](_0x2dd37c){const _0x465553=_0x9167c,{username:_0x4bdc13,password:_0x531a68,phone:_0x5331cb,phoneCode:_0x1242e6}=_0x2dd37c,_0x196fc0=await this[_0x465553(0x2f4)]['findOne']({'where':[{'username':_0x4bdc13},{'phone':_0x5331cb}]});if(_0x196fc0&&_0x196fc0[_0x465553(0x2ef)]===_0x4bdc13)throw new common_1['HttpException']('用户名已存在、请更换用户名！',common_1[_0x465553(0x398)][_0x465553(0x2af)]);if(_0x196fc0&&_0x196fc0[_0x465553(0x206)]===_0x5331cb)throw new common_1[(_0x465553(0x336))](_0x465553(0x2f0),common_1[_0x465553(0x398)][_0x465553(0x2af)]);}async[_0x9167c(0x2c1)](_0x183b7b){const _0x56fd90=_0x9167c,_0x253dc5=(0x0,utils_1['getReqSaasId'])(this['clsService']);if(_0x183b7b[_0x56fd90(0x2b7)]!==Role_constant_1[_0x56fd90(0x1f6)][_0x56fd90(0x33b)])_0x183b7b[_0x56fd90(0x2ed)]=_0x253dc5;else{if(!_0x183b7b['saasId'])throw new common_1[(_0x56fd90(0x336))](_0x56fd90(0x361),common_1[_0x56fd90(0x398)][_0x56fd90(0x2af)]);}return await this[_0x56fd90(0x2f4)][_0x56fd90(0x330)](_0x183b7b);}async['delUser'](_0x1a00da){const _0x1d8cf8=_0x9167c,{id:_0x5d820a,moreId:_0x18c8dd}=_0x1a00da;if(_0x5d820a)return await this[_0x1d8cf8(0x2f4)]['delete']({'id':_0x5d820a});if(_0x18c8dd)return await this[_0x1d8cf8(0x2f4)]['delete']({'id':(0x0,typeorm_2[_0x1d8cf8(0x228)])(_0x18c8dd)});}async['destroyAccount'](_0x5852c3){const _0x212dee=_0x9167c,_0x2e1513=_0x5852c3[_0x212dee(0x2a4)]['id'];return await this[_0x212dee(0x2f4)]['delete']({'id':_0x2e1513})[_0x212dee(0x29f)](_0x1a52f9=>_0x1a52f9[_0x212dee(0x257)]>0x0);}async[_0x9167c(0x21e)](_0x3730ad,_0x41dbb6){const _0x45edc4=_0x9167c;try{if(!_0x3730ad[_0x45edc4(0x2ef)]&&!_0x3730ad['phone']&&!_0x3730ad[_0x45edc4(0x276)])throw new Error('账号、手机、邮箱必须存在一个');if(_0x3730ad['username']){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x45edc4(0x29e)](_0x3730ad[_0x45edc4(0x2ef)]))throw new Error('用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符');if(!_0x3730ad['password'])throw new Error('账号注册时密码不能为空！');}if(_0x3730ad[_0x45edc4(0x206)]){if(!(0x0,class_validator_1[_0x45edc4(0x367)])(_0x3730ad['phone'],_0x45edc4(0x19b)))throw new Error(_0x45edc4(0x211));}if(_0x3730ad['email']){if(!(0x0,class_validator_1['isEmail'])(_0x3730ad[_0x45edc4(0x276)]))throw new Error('邮箱格式错误！');}if(_0x3730ad[_0x45edc4(0x2ef)]){const _0x408c7c=await this[_0x45edc4(0x2f4)][_0x45edc4(0x24a)]({'where':{'username':_0x3730ad[_0x45edc4(0x2ef)]}});if(_0x408c7c)throw new Error('用户名已被使用！');}if(_0x3730ad[_0x45edc4(0x206)]){const _0x1a4379=await this['userEntity'][_0x45edc4(0x24a)]({'where':{'phone':_0x3730ad[_0x45edc4(0x206)]}});if(_0x1a4379)throw new Error(_0x45edc4(0x38e));}if(_0x3730ad[_0x45edc4(0x276)]){const _0x4f5388=await this['userEntity'][_0x45edc4(0x24a)]({'where':{'email':_0x3730ad[_0x45edc4(0x276)]}});if(_0x4f5388)throw new Error(_0x45edc4(0x1bb));}const _0x4137cb=new user_entity_1['UserEntity']();for(let _0x20e4f9 in _0x3730ad){_0x3730ad[_0x20e4f9]&&(_0x4137cb[_0x20e4f9]=_0x3730ad[_0x20e4f9]);}return _0x4137cb[_0x45edc4(0x2d0)]&&(_0x4137cb[_0x45edc4(0x2d0)]=bcrypt['hashSync'](_0x3730ad[_0x45edc4(0x2d0)],0xa)),_0x4137cb[_0x45edc4(0x25e)]=user_constant_1[_0x45edc4(0x38c)][_0x45edc4(0x273)],!_0x4137cb[_0x45edc4(0x1f9)]&&(_0x4137cb[_0x45edc4(0x1f9)]=_0x4137cb[_0x45edc4(0x1f9)]||'小智'),!_0x4137cb['avatar']&&(_0x4137cb[_0x45edc4(0x3b1)]=await this[_0x45edc4(0x399)][_0x45edc4(0x353)]([_0x45edc4(0x2aa)])),await this[_0x45edc4(0x2c1)](_0x4137cb),!![];}catch(_0x1ce0a7){throw new common_1[(_0x45edc4(0x336))](_0x1ce0a7[_0x45edc4(0x2ab)],common_1[_0x45edc4(0x398)][_0x45edc4(0x2af)]);}}[_0x9167c(0x19d)](){const _0x225ace=_0x9167c;let _0x5207d2=_0x225ace(0x1a7);const _0x43e80a=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x2349b6=0x0;_0x2349b6<0xa;_0x2349b6++){_0x5207d2=_0x5207d2+_0x43e80a[Math[_0x225ace(0x299)](Math[_0x225ace(0x1d5)]()*0x3f)];}return _0x5207d2;}async[_0x9167c(0x262)](_0x4db283){const _0x18f15f=_0x9167c;let _0x23aff1=[];for(let _0x462ca2=0x0;_0x462ca2<_0x4db283;_0x462ca2++){_0x23aff1[_0x18f15f(0x2a5)](this[_0x18f15f(0x19d)]());}const _0x3d1258=await this[_0x18f15f(0x2f4)][_0x18f15f(0x1ad)]({'where':{'username':(0x0,typeorm_2['In'])(_0x23aff1)}});if(!_0x3d1258[_0x18f15f(0x366)])return _0x23aff1;else{const _0x259393=new Set(_0x3d1258['map'](_0x154c69=>_0x154c69[_0x18f15f(0x2ef)]));_0x23aff1=_0x23aff1[_0x18f15f(0x3aa)](_0x378074=>!_0x259393[_0x18f15f(0x2cc)](_0x378074));const _0x1b0d0e=await this[_0x18f15f(0x262)](_0x259393['size']);return _0x23aff1=_0x23aff1[_0x18f15f(0x311)](_0x1b0d0e),_0x23aff1;}}async[_0x9167c(0x208)](_0x3a71d1,_0x4773ba){const _0x103d0b=_0x9167c;let _0x53a491='';_0x53a491=_0x103d0b(0x31c);const _0x37845c=await this[_0x103d0b(0x262)](_0x3a71d1['num']),_0x366a92=[],_0x122d9c=[],_0xdb36da=await this[_0x103d0b(0x399)][_0x103d0b(0x353)]([_0x103d0b(0x2aa)]);for(let _0x402ec4=0x0;_0x402ec4<_0x3a71d1[_0x103d0b(0x26d)];_0x402ec4++){const _0x89fd64=new user_entity_1[(_0x103d0b(0x246))]();_0x89fd64[_0x103d0b(0x25e)]=0x1,_0x89fd64[_0x103d0b(0x3b1)]=_0xdb36da,_0x89fd64[_0x103d0b(0x2ef)]=_0x37845c[_0x402ec4],_0x89fd64['nickname']=_0x37845c[_0x402ec4],_0x89fd64['password']=bcrypt['hashSync'](_0x103d0b(0x2fe),0xa),_0x53a491=_0x53a491+(_0x37845c[_0x402ec4]+_0x103d0b(0x204)),_0x3a71d1[_0x103d0b(0x3b3)]&&(_0x89fd64['vipLeavelId']=Number(_0x3a71d1['vipLeavelId'])),_0x3a71d1[_0x103d0b(0x2fb)]&&(_0x89fd64['vipLeavelName']=_0x3a71d1[_0x103d0b(0x2fb)]),_0x3a71d1['score']&&(_0x89fd64['score']=_0x3a71d1['score']),_0x3a71d1['vipDays']&&_0x122d9c['push']({'username':_0x37845c[_0x402ec4],'vipDays':_0x3a71d1['vipDays']}),_0x366a92[_0x103d0b(0x2a5)](_0x89fd64);}try{return await this[_0x103d0b(0x210)][_0x103d0b(0x285)](async()=>{const _0x35dc4f=_0x103d0b;await this[_0x35dc4f(0x2f4)][_0x35dc4f(0x330)](_0x366a92),await this[_0x35dc4f(0x1bc)][_0x35dc4f(0x330)](_0x122d9c);}),_0x53a491;}catch(_0x58fa25){throw new common_1[(_0x103d0b(0x336))](_0x58fa25['message'],axios_1[_0x103d0b(0x394)][_0x103d0b(0x1a1)]);}}async[_0x9167c(0x3ab)](_0x1c3040,_0x4b2fb1){const _0x3ab4ea=_0x9167c,_0x24036a=await this[_0x3ab4ea(0x2f4)][_0x3ab4ea(0x2a6)]({'where':{'id':_0x4b2fb1[_0x3ab4ea(0x1f3)]}});await this[_0x3ab4ea(0x2f4)][_0x3ab4ea(0x391)]({'id':_0x24036a['id']},_0x3ab4ea(0x224),_0x4b2fb1[_0x3ab4ea(0x224)]),await this[_0x3ab4ea(0x364)][_0x3ab4ea(0x360)]({'userId':_0x24036a['id'],'rawScore':_0x24036a[_0x3ab4ea(0x224)],'newScore':_0x24036a[_0x3ab4ea(0x224)]+_0x4b2fb1[_0x3ab4ea(0x224)],'changeScore':_0x4b2fb1[_0x3ab4ea(0x224)],'changeType':balance_constant_1['EChangeType'][_0x3ab4ea(0x378)],'rebateUserId':_0x1c3040['user']['id'],'description':_0x3ab4ea(0x386)});}async[_0x9167c(0x3ad)](_0x455fec,_0x54f2d8){const _0x3b6a41=_0x9167c,_0x56afb8=await this[_0x3b6a41(0x2f4)]['findOne']({'where':{'id':_0x54f2d8[_0x3b6a41(0x1f3)]}});return await this[_0x3b6a41(0x2e5)](_0x56afb8,balance_constant_1[_0x3b6a41(0x1a8)][_0x3b6a41(0x378)],_0x54f2d8['days'],_0x3b6a41(0x386),_0x455fec[_0x3b6a41(0x2a4)]['id']),!![];}async[_0x9167c(0x2a0)](_0x55f948){const _0x5dd30c=_0x9167c,_0x57f29b=await this[_0x5dd30c(0x1bc)][_0x5dd30c(0x2a6)]({'where':{'username':_0x55f948['username']}});_0x57f29b&&await this[_0x5dd30c(0x210)]['transaction'](async()=>{const _0x3ae5d7=_0x5dd30c;_0x57f29b[_0x3ae5d7(0x1dc)]===-0x1?_0x55f948['lifetimeVip']=0x1:_0x55f948[_0x3ae5d7(0x2f5)]=(0x0,date_1['default'])()['add'](_0x57f29b['vipDays'],_0x3ae5d7(0x222))[_0x3ae5d7(0x1dd)](),_0x55f948=await this['userEntity'][_0x3ae5d7(0x330)](_0x55f948),await this[_0x3ae5d7(0x1bc)]['delete']({'id':_0x57f29b['id']});});}async[_0x9167c(0x323)](_0xebb72,_0x49da6a){await this['userEntity']['update']({'id':_0xebb72},{'consecutiveDays':_0x49da6a});}async[_0x9167c(0x196)](_0x1fd39e){const _0xfed307=_0x9167c,_0x54d174=await this['getUserById'](_0x1fd39e);_0x54d174[_0xfed307(0x32d)]=_0x54d174[_0xfed307(0x32d)]+0x1,await this['userEntity'][_0xfed307(0x330)](_0x54d174);}async[_0x9167c(0x39b)](_0x32db60,_0x5288c8){const _0x568ed0=_0x9167c,_0x2945de=await this[_0x568ed0(0x399)][_0x568ed0(0x353)]([_0x568ed0(0x3a9),_0x568ed0(0x24f),_0x568ed0(0x38b),_0x568ed0(0x1c2),_0x568ed0(0x382),_0x568ed0(0x373),_0x568ed0(0x3a0)]),_0x2bd6c1={};for(let _0x347fa6 in _0x2945de){const _0x2206ee=Number(_0x2945de[_0x347fa6]),_0x3223ed=Number[_0x568ed0(0x383)](_0x2206ee)&&_0x2206ee>0x0?_0x2206ee:0x0;_0x2bd6c1[_0x347fa6]=_0x3223ed;}_0x2bd6c1[_0x568ed0(0x3a9)]&&(await this[_0x568ed0(0x2f4)]['update']({'id':_0x32db60['id']},{'score':_0x2bd6c1[_0x568ed0(0x24f)]}),await this[_0x568ed0(0x364)][_0x568ed0(0x360)]({'userId':_0x32db60['id'],'rawScore':0x0,'newScore':_0x2bd6c1[_0x568ed0(0x24f)],'changeScore':_0x2bd6c1[_0x568ed0(0x24f)],'changeType':balance_constant_1[_0x568ed0(0x1a8)][_0x568ed0(0x3af)],'description':_0x568ed0(0x27d)}));if(_0x5288c8&&_0x2bd6c1[_0x568ed0(0x38b)]){_0x2bd6c1[_0x568ed0(0x1c2)]&&(await this['userEntity'][_0x568ed0(0x391)]({'id':_0x5288c8['id']},_0x568ed0(0x224),_0x2bd6c1[_0x568ed0(0x1c2)]),await this['userBalanceService'][_0x568ed0(0x360)]({'userId':_0x5288c8['id'],'rawScore':_0x5288c8[_0x568ed0(0x224)],'newScore':_0x5288c8[_0x568ed0(0x224)]+_0x2bd6c1[_0x568ed0(0x1c2)],'changeScore':_0x2bd6c1[_0x568ed0(0x1c2)],'changeType':balance_constant_1[_0x568ed0(0x1a8)][_0x568ed0(0x2c6)],'rebateUserId':_0x32db60['id'],'description':_0x568ed0(0x2a1)}));_0x2bd6c1[_0x568ed0(0x382)]&&await this[_0x568ed0(0x2e5)](_0x5288c8,balance_constant_1['EChangeType'][_0x568ed0(0x2c6)],_0x2bd6c1[_0x568ed0(0x382)],_0x568ed0(0x2a1),_0x32db60['id']);const _0xee3335=await this[_0x568ed0(0x2f4)][_0x568ed0(0x2a6)]({'where':{'id':_0x32db60['id']}});_0x2bd6c1[_0x568ed0(0x373)]&&(await this[_0x568ed0(0x2f4)]['increment']({'id':_0xee3335['id']},'score',_0x2bd6c1[_0x568ed0(0x373)]),await this[_0x568ed0(0x364)][_0x568ed0(0x360)]({'userId':_0x32db60['id'],'rawScore':_0xee3335[_0x568ed0(0x224)],'newScore':_0xee3335[_0x568ed0(0x224)]+_0x2bd6c1['invitedRewards'],'changeScore':_0x2bd6c1['invitedRewards'],'changeType':balance_constant_1[_0x568ed0(0x1a8)][_0x568ed0(0x219)],'rebateUserId':_0x5288c8['id'],'description':_0x568ed0(0x1c5)})),_0x2bd6c1[_0x568ed0(0x3a0)]&&await this['updateVipExpire'](_0xee3335,balance_constant_1[_0x568ed0(0x1a8)]['Invited'],_0x2bd6c1[_0x568ed0(0x3a0)],_0x568ed0(0x1c5),_0x5288c8['id']);}}async[_0x9167c(0x278)](_0x11926b,_0x3864d3,_0x3f65d0,_0x4badd2,_0x5dbf5a){const _0x2a5287=_0x9167c;await this[_0x2a5287(0x2f4)][_0x2a5287(0x226)]({'id':_0x11926b['id']},{'score':_0x11926b[_0x2a5287(0x224)]+_0x3f65d0}),await this[_0x2a5287(0x364)][_0x2a5287(0x360)]({'userId':_0x11926b['id'],'rawScore':_0x11926b[_0x2a5287(0x224)],'newScore':_0x11926b[_0x2a5287(0x224)]+_0x3f65d0,'changeScore':_0x3f65d0,'changeType':_0x3864d3,'relateId':_0x5dbf5a?String(_0x5dbf5a):null,'description':_0x4badd2});}async['updateVipExpire'](_0x397d94,_0x695694,_0x134337,_0x5614fb,_0x5c7048){const _0x377af6=_0x9167c;if(_0x397d94['lifetimeVip'])return;_0x134337===-0x1?await this['userEntity'][_0x377af6(0x226)]({'id':_0x397d94['id']},{'lifetimeVip':0x1}):(_0x397d94[_0x377af6(0x2f5)]?_0x397d94['vipExpire']=(0x0,date_1['default'])(_0x397d94[_0x377af6(0x2f5)])[_0x377af6(0x328)](_0x134337,_0x377af6(0x222))[_0x377af6(0x1dd)]():_0x397d94[_0x377af6(0x2f5)]=(0x0,date_1[_0x377af6(0x296)])()[_0x377af6(0x328)](_0x134337,'day')[_0x377af6(0x1dd)](),await this[_0x377af6(0x2f4)][_0x377af6(0x226)]({'id':_0x397d94['id']},{'vipExpire':_0x397d94[_0x377af6(0x2f5)]})),_0x397d94=await this[_0x377af6(0x2f4)][_0x377af6(0x2a6)]({'where':{'id':_0x397d94['id']}}),await this[_0x377af6(0x364)][_0x377af6(0x35c)]({'userId':_0x397d94['id'],'vipDays':_0x134337,'vipExpire':_0x397d94[_0x377af6(0x2f5)],'relateType':_0x695694,'relateId':_0x5c7048?String(_0x5c7048):'','description':_0x5614fb});}async[_0x9167c(0x335)](_0x117827,_0x1fd231){const _0x351041=_0x9167c,_0xf9af31=await this[_0x351041(0x313)][_0x351041(0x2a6)]({'where':{'id':_0x1fd231}});await this[_0x351041(0x2f4)][_0x351041(0x226)]({'id':_0x117827['id']},{'vipLeavelId':_0x1fd231,'vipLeavelName':_0xf9af31[_0x351041(0x2de)]});}async['validateBalance4Chat'](_0x17369c,_0x5df650){const _0x30369e=_0x9167c;let _0x2c3705=!![];const _0x3b1e03=await this['getUserById'](_0x17369c);if(_0x3b1e03[_0x30369e(0x1c0)]||_0x3b1e03['vipExpire']){if(_0x5df650['vipFreeNum']<0x0)_0x2c3705=!![];else{if(_0x5df650[_0x30369e(0x33c)]>0x0){const _0x160c45=redisKey_constant_1[_0x30369e(0x286)]+'-'+_0x17369c+'-'+_0x5df650['id'];let _0x3f7172=await this[_0x30369e(0x32c)]['get']({'key':_0x160c45});console['log'](_0x3f7172);let _0x2f181d=Number(_0x3f7172||0x0);_0x2f181d<_0x5df650[_0x30369e(0x33c)]?_0x2c3705=!![]:_0x2c3705=_0x3b1e03['score']>=_0x5df650['deduct'];}else _0x2c3705=_0x3b1e03['score']>=_0x5df650[_0x30369e(0x34c)];}}else _0x2c3705=_0x3b1e03[_0x30369e(0x224)]>=_0x5df650['deduct'];if(!_0x2c3705)throw new common_1[(_0x30369e(0x336))]('用户余额不足，请充值',common_1[_0x30369e(0x398)][_0x30369e(0x2af)]);}async[_0x9167c(0x1ba)](_0x1bd175,_0x9f974c){const _0x538b28=_0x9167c;let _0x3a7967=!![];const _0x51f272=await this[_0x538b28(0x3b2)](_0x1bd175);if(_0x51f272['lifetimeVip']||_0x51f272[_0x538b28(0x2f5)]){if(_0x9f974c[_0x538b28(0x33c)]<0x0)_0x3a7967=!![];else{if(_0x9f974c[_0x538b28(0x33c)]>0x0){const _0x42a686=redisKey_constant_1[_0x538b28(0x286)]+'-'+_0x1bd175+'-'+_0x9f974c['id'];let _0x3b6017=await this[_0x538b28(0x32c)][_0x538b28(0x396)]({'key':_0x42a686});console['log'](_0x3b6017);let _0x59ecff=Number(_0x3b6017||0x0);_0x59ecff<_0x9f974c[_0x538b28(0x33c)]?_0x3a7967=!![]:_0x3a7967=_0x51f272[_0x538b28(0x224)]>=_0x9f974c[_0x538b28(0x34c)];}else _0x3a7967=_0x51f272[_0x538b28(0x224)]>=_0x9f974c[_0x538b28(0x34c)];}}else _0x3a7967=_0x51f272[_0x538b28(0x224)]>=_0x9f974c['deduct'];if(!_0x3a7967)throw new common_1[(_0x538b28(0x336))](_0x538b28(0x388),common_1[_0x538b28(0x398)][_0x538b28(0x2af)]);}async[_0x9167c(0x1a5)](_0x4140b3,_0x292cd9){const _0x3c3703=_0x9167c;let _0x29f600=!![];if(!_0x292cd9)return;const _0x3683b9=await this[_0x3c3703(0x3b2)](_0x4140b3);_0x292cd9&&(_0x29f600=_0x292cd9[_0x3c3703(0x268)](',')[_0x3c3703(0x21b)](_0x3683b9[_0x3c3703(0x3b3)]?.['toString']())>-0x1);if(!_0x29f600){const _0x458982=await this[_0x3c3703(0x313)][_0x3c3703(0x1ad)]({'where':{'dictType':dict_constant_1[_0x3c3703(0x3a8)][_0x3c3703(0x2db)]},'order':{'createdAt':_0x3c3703(0x2e0)}});throw new common_1['HttpException'](_0x3c3703(0x342)+_0x292cd9[_0x3c3703(0x268)](',')['map'](_0x1ed1d0=>_0x458982[_0x3c3703(0x1ad)](_0xd8de0a=>_0xd8de0a['id'][_0x3c3703(0x25d)]()===_0x1ed1d0)?.[_0x3c3703(0x2de)])[_0x3c3703(0x25d)]()+'可用',common_1[_0x3c3703(0x398)][_0x3c3703(0x2af)]);}}async['deductBalance4Chat'](_0xaaeab9,_0x334716,_0x17b2ae){const _0x1558d1=_0x9167c,_0x46b67e=await this[_0x1558d1(0x3b2)](_0xaaeab9);let _0x3a0e57;switch(_0x334716[_0x1558d1(0x2eb)]){case model_constant_1[_0x1558d1(0x25c)][_0x1558d1(0x34a)]:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x34a)];break;case model_constant_1['EModelType']['APP']:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x22d)];break;case model_constant_1['EModelType'][_0x1558d1(0x266)]:_0x3a0e57=balance_constant_1['EChangeType'][_0x1558d1(0x20f)];break;case model_constant_1[_0x1558d1(0x25c)][_0x1558d1(0x269)]:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x269)];break;case model_constant_1[_0x1558d1(0x25c)][_0x1558d1(0x235)]:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x356)];break;case model_constant_1['EModelType']['CHAT']:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x36e)];break;case model_constant_1['EModelType'][_0x1558d1(0x315)]:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)]['Tool'];break;case model_constant_1['EModelType'][_0x1558d1(0x35a)]:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x292)];break;case model_constant_1[_0x1558d1(0x25c)][_0x1558d1(0x277)]:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x1d9)];break;default:_0x3a0e57=balance_constant_1[_0x1558d1(0x1a8)][_0x1558d1(0x36e)];}if(_0x46b67e[_0x1558d1(0x1c0)]||_0x46b67e[_0x1558d1(0x2f5)]){if(_0x334716['vipFreeNum']<0x0){await this['changeScore4Other'](_0x46b67e,_0x3a0e57,0x0,'模型【'+_0x334716[_0x1558d1(0x1d6)]+_0x1558d1(0x36d),_0x17b2ae);return;}else{if(_0x334716['vipFreeNum']>0x0){const _0x4e6e3a=redisKey_constant_1[_0x1558d1(0x286)]+'-'+_0xaaeab9+'-'+_0x334716['id'];let _0x3f810a=await this[_0x1558d1(0x32c)][_0x1558d1(0x396)]({'key':_0x4e6e3a}),_0x44fbb0=Number(_0x3f810a||0x0);if(_0x44fbb0<_0x334716['vipFreeNum']){const _0x9c7850=(0x0,date_1[_0x1558d1(0x296)])()[_0x1558d1(0x369)]('d')['diff']((0x0,date_1[_0x1558d1(0x296)])(),'s');await this[_0x1558d1(0x32c)][_0x1558d1(0x2ce)]({'key':_0x4e6e3a,'val':_0x44fbb0+0x1},_0x9c7850),await this[_0x1558d1(0x278)](_0x46b67e,_0x3a0e57,0x0,_0x1558d1(0x32f)+_0x334716['modelName']+_0x1558d1(0x1ce),_0x17b2ae);return;}}}}await this[_0x1558d1(0x278)](_0x46b67e,_0x3a0e57,-_0x334716[_0x1558d1(0x34c)],'模型【'+_0x334716['modelName']+_0x1558d1(0x2f7),_0x17b2ae);}async[_0x9167c(0x297)](_0x2db193,_0x360938,_0x17a374,_0xc7b204,_0x4f9934=balance_constant_1[_0x9167c(0x1a8)][_0x9167c(0x356)]){const _0x586dbc=_0x9167c,_0x247a82=await this[_0x586dbc(0x3b2)](_0x2db193);if(_0x247a82['lifetimeVip']||_0x247a82['vipExpire']){if(_0x360938[_0x586dbc(0x33c)]<0x0){await this[_0x586dbc(0x278)](_0x247a82,_0x4f9934,0x0,_0x586dbc(0x32f)+_0x360938[_0x586dbc(0x1d6)]+_0x586dbc(0x36d),_0x17a374);return;}else{if(_0x360938[_0x586dbc(0x33c)]>0x0){const _0x34b0f1=redisKey_constant_1['VIP_FREE']+'-'+_0x2db193+'-'+_0x360938['model'];let _0x129203=await this['redisCacheService']['get']({'key':_0x34b0f1});console['log'](_0x586dbc(0x271),_0x360938),console[_0x586dbc(0x30b)](_0x586dbc(0x1c3),_0x34b0f1,_0x129203);let _0x3074e3=Number(_0x129203||0x0);if(_0x3074e3<_0x360938['vipFreeNum']){const _0x577d1f=(0x0,date_1[_0x586dbc(0x296)])()[_0x586dbc(0x369)]('d')['diff']((0x0,date_1[_0x586dbc(0x296)])(),'s');await this[_0x586dbc(0x32c)][_0x586dbc(0x2ce)]({'key':_0x34b0f1,'val':_0x3074e3+0x1},_0x577d1f),await this[_0x586dbc(0x278)](_0x247a82,_0x4f9934,0x0,_0x586dbc(0x32f)+_0x360938[_0x586dbc(0x1d6)]+_0x586dbc(0x1ce),_0x17a374);return;}}}}await this[_0x586dbc(0x278)](_0x247a82,_0x4f9934,-_0x360938['deduct']*(_0xc7b204||0x1),'模型【'+_0x360938['modelName']+'】使用扣减',_0x17a374);}async[_0x9167c(0x256)](_0x59908b,_0x207a0b,_0x20bd76,_0xbc7007=balance_constant_1[_0x9167c(0x1a8)][_0x9167c(0x356)]){const _0x4a4af3=_0x9167c,_0x477347=await this['getUserById'](_0x59908b);await this[_0x4a4af3(0x278)](_0x477347,_0xbc7007,_0x207a0b[_0x4a4af3(0x34c)],_0x4a4af3(0x32f)+_0x207a0b[_0x4a4af3(0x1d6)]+'】调用失败退还',_0x20bd76);}async[_0x9167c(0x29a)](_0x51063a,_0xda6c53,_0x3d2f60){const _0x2a198a=_0x9167c;let _0x40d032=!![];const _0x2215bf=await this[_0x2a198a(0x3b2)](_0x51063a);if(_0x2215bf['lifetimeVip']||_0x2215bf[_0x2a198a(0x2f5)]){if(_0xda6c53['vipFreeNum']<0x0){_0x40d032=!![];return;}else{if(_0xda6c53[_0x2a198a(0x33c)]>0x0){const _0x121feb=redisKey_constant_1[_0x2a198a(0x286)]+'-'+_0x51063a+'-'+_0xda6c53[_0x2a198a(0x250)];let _0x4cf4c2=await this[_0x2a198a(0x32c)][_0x2a198a(0x396)]({'key':_0x121feb}),_0x462435=Number(_0x4cf4c2||0x0);if(_0x462435<_0xda6c53[_0x2a198a(0x33c)]){_0x40d032=!![];return;}}}}_0x40d032=_0x2215bf[_0x2a198a(0x224)]>=_0xda6c53['deduct']*_0x3d2f60;if(!_0x40d032)throw new common_1[(_0x2a198a(0x336))]('用户余额不足，请充值',common_1[_0x2a198a(0x398)][_0x2a198a(0x2af)]);}async[_0x9167c(0x28d)](_0x15b976,_0x2f97cb,_0x243759){const _0x2b8d79=_0x9167c;let _0x411db0=!![],_0x5b8ca7=await this[_0x2b8d79(0x389)](_0x2f97cb,_0x243759);const _0x5e4626=await this['getUserById'](_0x15b976);if(_0x5e4626[_0x2b8d79(0x1c0)]||_0x5e4626[_0x2b8d79(0x2f5)]){if(_0x2f97cb['vipFreeNum']<0x0||_0x5b8ca7?.[_0x2b8d79(0x33c)]<0x0){_0x411db0=!![];return;}else{if(_0x5b8ca7?.[_0x2b8d79(0x33c)]>0x0){const _0x22b15a=redisKey_constant_1['VIP_FREE']+'-'+_0x15b976+'-'+_0x5b8ca7[_0x2b8d79(0x250)]+'-'+_0x5b8ca7[_0x2b8d79(0x348)]+'-'+_0x5b8ca7['duration'];let _0x4265dc=await this['redisCacheService'][_0x2b8d79(0x396)]({'key':_0x22b15a}),_0x12d7c2=Number(_0x4265dc||0x0);if(_0x12d7c2<_0x5b8ca7[_0x2b8d79(0x33c)]){_0x411db0=!![];return;}}else{if(_0x2f97cb['vipFreeNum']>0x0){const _0x2dcb76=redisKey_constant_1['VIP_FREE']+'-'+_0x15b976+'-'+_0x2f97cb['id'];let _0x17995c=await this[_0x2b8d79(0x32c)]['get']({'key':_0x2dcb76});console[_0x2b8d79(0x30b)](_0x17995c);let _0x55faa9=Number(_0x17995c||0x0);if(_0x55faa9<_0x2f97cb[_0x2b8d79(0x33c)]){_0x411db0=!![];return;}}}}}_0x411db0=_0x5e4626[_0x2b8d79(0x224)]>=(_0x5b8ca7?.[_0x2b8d79(0x37c)]>0x0?_0x5b8ca7?.[_0x2b8d79(0x37c)]:_0x2f97cb['deduct']);if(!_0x411db0)throw new common_1[(_0x2b8d79(0x336))](_0x2b8d79(0x388),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x9167c(0x2d5)](_0x1ac73c,_0x5cd0e8,_0x3a08f7=0x1){const _0x183347=_0x9167c;let _0x397861=!![],_0x5766da=await this[_0x183347(0x321)](_0x5cd0e8);await this[_0x183347(0x1a5)](_0x1ac73c,_0x5766da[_0x183347(0x363)]);const _0x677cc8=await this[_0x183347(0x3b2)](_0x1ac73c);if(_0x677cc8['lifetimeVip']||_0x677cc8[_0x183347(0x2f5)]){if(_0x5766da?.[_0x183347(0x33c)]<0x0){_0x397861=!![];return;}else{if(_0x5766da?.['vipFreeNum']>0x0){const _0x237af8=redisKey_constant_1['VIP_FREE']+'-'+_0x1ac73c+'-'+_0x5cd0e8;let _0x5304e4=await this[_0x183347(0x32c)][_0x183347(0x396)]({'key':_0x237af8}),_0x892183=Number(_0x5304e4||0x0);if(_0x892183<_0x5766da[_0x183347(0x33c)]){_0x397861=!![];return;}}}}_0x3a08f7?_0x397861=_0x677cc8[_0x183347(0x224)]>=_0x5766da?.[_0x183347(0x37c)]*parseInt(_0x3a08f7['toString']()):_0x397861=_0x677cc8[_0x183347(0x224)]>=_0x5766da?.['price'];if(!_0x397861)throw new common_1[(_0x183347(0x336))]('用户余额不足，请充值',common_1['HttpStatus'][_0x183347(0x2af)]);}async[_0x9167c(0x38a)](_0x4ade18,_0x2f7ae1,_0x59b8a4,_0x3ddc3d=0x1){const _0x191a92=_0x9167c,_0x25564e=await this[_0x191a92(0x3b2)](_0x4ade18);let _0x42ede1=await this[_0x191a92(0x321)](_0x2f7ae1);if(_0x25564e[_0x191a92(0x1c0)]||_0x25564e[_0x191a92(0x2f5)]){if(_0x42ede1?.[_0x191a92(0x33c)]<0x0){await this[_0x191a92(0x278)](_0x25564e,balance_constant_1[_0x191a92(0x1a8)]['Human'],0x0,_0x191a92(0x2c0)+_0x2f7ae1+_0x191a92(0x36d),_0x59b8a4);return;}else{if(_0x42ede1?.[_0x191a92(0x33c)]>0x0){const _0x31b195=redisKey_constant_1[_0x191a92(0x286)]+'-'+_0x4ade18+'-'+_0x2f7ae1;let _0x4d0c08=await this[_0x191a92(0x32c)]['get']({'key':_0x31b195}),_0x335007=Number(_0x4d0c08||0x0);if(_0x335007<_0x42ede1[_0x191a92(0x33c)]){const _0xac8ea4=(0x0,date_1[_0x191a92(0x296)])()['endOf']('d')['diff']((0x0,date_1[_0x191a92(0x296)])(),'s');await this['redisCacheService'][_0x191a92(0x2ce)]({'key':_0x31b195,'val':_0x335007+0x1},_0xac8ea4);return;}}}}_0x3ddc3d?await this[_0x191a92(0x278)](_0x25564e,balance_constant_1['EChangeType'][_0x191a92(0x2e8)],-_0x42ede1?.['price']*parseInt(_0x3ddc3d[_0x191a92(0x25d)]()),_0x191a92(0x2c0)+_0x2f7ae1+'消耗',_0x59b8a4):await this[_0x191a92(0x278)](_0x25564e,balance_constant_1['EChangeType']['Human'],-_0x42ede1?.[_0x191a92(0x37c)],'数字人【'+_0x2f7ae1+'消耗',_0x59b8a4);}async['refundBalance4Human'](_0x194fe4,_0x14dba0,_0x390db8,_0xfc3288=0x1){const _0x4ca9e1=_0x9167c,_0x2ffbb0=await this[_0x4ca9e1(0x3b2)](_0x194fe4);let _0x15df4f=await this[_0x4ca9e1(0x321)](_0x14dba0);if(_0x2ffbb0[_0x4ca9e1(0x1c0)]||_0x2ffbb0[_0x4ca9e1(0x2f5)]){if(_0x15df4f?.[_0x4ca9e1(0x33c)]<0x0)return;else{if(_0x15df4f?.['vipFreeNum']>0x0){const _0x4abbb4=redisKey_constant_1['VIP_FREE']+'-'+_0x194fe4+'-'+_0x14dba0;let _0x157498=await this[_0x4ca9e1(0x32c)][_0x4ca9e1(0x396)]({'key':_0x4abbb4}),_0x261297=Number(_0x157498||0x0);if(_0x261297>=_0x15df4f[_0x4ca9e1(0x33c)]){const _0x4e48de=(0x0,date_1[_0x4ca9e1(0x296)])()[_0x4ca9e1(0x369)]('d')[_0x4ca9e1(0x294)]((0x0,date_1[_0x4ca9e1(0x296)])(),'s');await this['redisCacheService'][_0x4ca9e1(0x2ce)]({'key':_0x4abbb4,'val':_0x261297-0x1},_0x4e48de);return;}}}}_0xfc3288?await this['changeScore4Other'](_0x2ffbb0,balance_constant_1[_0x4ca9e1(0x1a8)][_0x4ca9e1(0x2e8)],_0x15df4f?.['price']*parseInt(_0xfc3288[_0x4ca9e1(0x25d)]()),_0x4ca9e1(0x2c0)+_0x14dba0+_0x4ca9e1(0x309),_0x390db8):await this[_0x4ca9e1(0x278)](_0x2ffbb0,balance_constant_1['EChangeType'][_0x4ca9e1(0x2e8)],_0x15df4f?.[_0x4ca9e1(0x37c)],_0x4ca9e1(0x2c0)+_0x14dba0+_0x4ca9e1(0x309),_0x390db8);}async[_0x9167c(0x354)](_0x5daa64,_0x52cbf8,_0x4465c5,_0x4cafe3,_0x1819af=balance_constant_1[_0x9167c(0x1a8)]['VIDEO']){const _0x18a7bc=_0x9167c,_0x275923=await this[_0x18a7bc(0x3b2)](_0x5daa64);let _0x3f88b5=await this[_0x18a7bc(0x389)](_0x52cbf8,_0x4465c5);if(_0x275923[_0x18a7bc(0x1c0)]||_0x275923[_0x18a7bc(0x2f5)]){if(_0x52cbf8['vipFreeNum']<0x0||_0x3f88b5?.[_0x18a7bc(0x33c)]<0x0){await this[_0x18a7bc(0x278)](_0x275923,_0x1819af,0x0,_0x18a7bc(0x32f)+_0x52cbf8['modelName']+'】会员永久免费',_0x4cafe3);return;}else{if(_0x3f88b5?.[_0x18a7bc(0x33c)]>0x0){const _0x8042ae=redisKey_constant_1[_0x18a7bc(0x286)]+'-'+_0x5daa64+'-'+_0x3f88b5[_0x18a7bc(0x250)]+'-'+_0x3f88b5[_0x18a7bc(0x348)]+'-'+_0x3f88b5['duration'];let _0x3dc525=await this[_0x18a7bc(0x32c)][_0x18a7bc(0x396)]({'key':_0x8042ae}),_0x5055d3=Number(_0x3dc525||0x0);if(_0x5055d3<_0x3f88b5[_0x18a7bc(0x33c)]){const _0x5df007=(0x0,date_1[_0x18a7bc(0x296)])()[_0x18a7bc(0x369)]('d')[_0x18a7bc(0x294)]((0x0,date_1[_0x18a7bc(0x296)])(),'s');await this[_0x18a7bc(0x32c)]['set']({'key':_0x8042ae,'val':_0x5055d3+0x1},_0x5df007);return;}}else{if(_0x52cbf8[_0x18a7bc(0x33c)]>0x0){const _0x255ef6=redisKey_constant_1[_0x18a7bc(0x286)]+'-'+_0x5daa64+'-'+_0x52cbf8['id'];let _0x12ce33=await this[_0x18a7bc(0x32c)][_0x18a7bc(0x396)]({'key':_0x255ef6}),_0x32b7a8=Number(_0x12ce33||0x0);if(_0x32b7a8<_0x52cbf8[_0x18a7bc(0x33c)]){const _0x5e1e40=(0x0,date_1[_0x18a7bc(0x296)])()[_0x18a7bc(0x369)]('d')[_0x18a7bc(0x294)]((0x0,date_1[_0x18a7bc(0x296)])(),'s');await this[_0x18a7bc(0x32c)][_0x18a7bc(0x2ce)]({'key':_0x255ef6,'val':_0x32b7a8+0x1},_0x5e1e40);return;}}}}}await this[_0x18a7bc(0x278)](_0x275923,_0x1819af,_0x3f88b5?.['price']>0x0?-_0x3f88b5?.[_0x18a7bc(0x37c)]:-_0x52cbf8[_0x18a7bc(0x34c)],_0x18a7bc(0x32f)+_0x52cbf8[_0x18a7bc(0x1d6)]+_0x18a7bc(0x1ce),_0x4cafe3);}async[_0x9167c(0x33a)](_0x2af5b0,_0x7eaaef,_0xe02bb7,_0x2018b2,_0x23214a=balance_constant_1[_0x9167c(0x1a8)][_0x9167c(0x269)]){const _0x242f92=_0x9167c;let _0x4b1607=await this[_0x242f92(0x389)](_0x7eaaef,_0xe02bb7);const _0x3b77a5=await this[_0x242f92(0x3b2)](_0x2af5b0);if(_0x3b77a5[_0x242f92(0x1c0)]||_0x3b77a5['vipExpire']){if(_0x7eaaef['vipFreeNum']<0x0||_0x4b1607?.[_0x242f92(0x33c)]<0x0)return;else{if(_0x4b1607?.['vipFreeNum']>0x0){const _0x3e6e25=redisKey_constant_1[_0x242f92(0x286)]+'-'+_0x2af5b0+'-'+_0x4b1607[_0x242f92(0x250)]+'-'+_0x4b1607[_0x242f92(0x348)]+'-'+_0x4b1607[_0x242f92(0x2ff)];let _0x25a4fd=await this['redisCacheService']['get']({'key':_0x3e6e25}),_0x1423b1=Number(_0x25a4fd||0x0);if(_0x1423b1>=_0x4b1607[_0x242f92(0x33c)]){const _0x9de26c=(0x0,date_1[_0x242f92(0x296)])()['endOf']('d')['diff']((0x0,date_1[_0x242f92(0x296)])(),'s');await this[_0x242f92(0x32c)][_0x242f92(0x2ce)]({'key':_0x3e6e25,'val':_0x1423b1-0x1},_0x9de26c);return;}}else{if(_0x7eaaef['vipFreeNum']>0x0){const _0x6fe691=redisKey_constant_1[_0x242f92(0x286)]+'-'+_0x2af5b0+'-'+_0x7eaaef['id'];let _0x48297c=await this[_0x242f92(0x32c)][_0x242f92(0x396)]({'key':_0x6fe691}),_0x28ce43=Number(_0x48297c||0x0);if(_0x28ce43>=_0x7eaaef[_0x242f92(0x33c)]){const _0x32e1a4=(0x0,date_1['default'])()[_0x242f92(0x369)]('d')[_0x242f92(0x294)]((0x0,date_1[_0x242f92(0x296)])(),'s');await this['redisCacheService'][_0x242f92(0x2ce)]({'key':_0x6fe691,'val':_0x28ce43-0x1},_0x32e1a4);return;}}}}}await this['changeScore4Other'](_0x3b77a5,_0x23214a,_0x4b1607?.[_0x242f92(0x37c)]>0x0?_0x4b1607?.[_0x242f92(0x37c)]:_0x7eaaef['deduct'],_0x242f92(0x32f)+_0x7eaaef[_0x242f92(0x1d6)]+'】失败退还',_0x2018b2);}async[_0x9167c(0x322)](_0x6a70c9,_0x1bacda,_0x2a9bd1){const _0x46eceb=_0x9167c,_0x32cc64=await this['getUserById'](_0x6a70c9);let _0x5ec7d9;switch(_0x1bacda[_0x46eceb(0x2eb)]){case model_constant_1[_0x46eceb(0x25c)][_0x46eceb(0x2e7)]:_0x5ec7d9=balance_constant_1[_0x46eceb(0x1a8)][_0x46eceb(0x22d)];break;case model_constant_1['EModelType']['MUSIC']:_0x5ec7d9=balance_constant_1[_0x46eceb(0x1a8)][_0x46eceb(0x20f)];break;case model_constant_1['EModelType']['DRAW']:_0x5ec7d9=balance_constant_1['EChangeType'][_0x46eceb(0x356)];break;case model_constant_1['EModelType'][_0x46eceb(0x2f8)]:_0x5ec7d9=balance_constant_1[_0x46eceb(0x1a8)][_0x46eceb(0x36e)];break;case model_constant_1[_0x46eceb(0x25c)]['OTHER']:_0x5ec7d9=balance_constant_1[_0x46eceb(0x1a8)][_0x46eceb(0x30f)];break;case model_constant_1[_0x46eceb(0x25c)][_0x46eceb(0x269)]:_0x5ec7d9=balance_constant_1[_0x46eceb(0x1a8)][_0x46eceb(0x269)];break;default:_0x5ec7d9=balance_constant_1[_0x46eceb(0x1a8)][_0x46eceb(0x36e)];}await this['changeScore4Other'](_0x32cc64,_0x5ec7d9,_0x1bacda[_0x46eceb(0x34c)],_0x46eceb(0x32f)+_0x1bacda['modelName']+_0x46eceb(0x2a8),_0x2a9bd1);}async[_0x9167c(0x1be)](_0x181afa,_0x6c9662,_0x1a16da,_0x45f854,_0x59143f,_0xa71190,_0x5b5a98=balance_constant_1[_0x9167c(0x1a8)]['Coze']){const _0x291676=_0x9167c,_0x213265=await this['getUserById'](_0x181afa);if(_0x213265[_0x291676(0x1c0)]||_0x213265[_0x291676(0x2f5)]){if(_0x45f854<0x0){await this[_0x291676(0x278)](_0x213265,_0x5b5a98,0x0,_0x291676(0x290)+_0x1a16da+_0x291676(0x36d),_0xa71190);return;}else{if(_0x45f854>0x0){const _0x30581f=redisKey_constant_1[_0x291676(0x286)]+'-'+_0x181afa+'-'+_0x6c9662;let _0x5ab994=await this[_0x291676(0x32c)]['get']({'key':_0x30581f}),_0x8d1d5a=Number(_0x5ab994||0x0);if(_0x8d1d5a<_0x45f854){const _0x210b08=(0x0,date_1[_0x291676(0x296)])()[_0x291676(0x369)]('d')[_0x291676(0x294)]((0x0,date_1['default'])(),'s');await this[_0x291676(0x32c)][_0x291676(0x2ce)]({'key':_0x30581f,'val':_0x8d1d5a+0x1},_0x210b08),await this[_0x291676(0x278)](_0x213265,_0x5b5a98,0x0,_0x291676(0x290)+_0x1a16da+_0x291676(0x1ce),_0xa71190);return;}}}}await this[_0x291676(0x278)](_0x213265,_0x5b5a98,-_0x59143f,'智能体【'+_0x1a16da+_0x291676(0x2f7),_0xa71190);}async['getMjPrice'](_0x17a011,_0x4253b8,_0xdce9a9){const _0x5c4d81=_0x9167c;let _0x470887='',_0x177197='',_0x33131a='',_0x1f088b=_0x4253b8;const _0x3d1501=_0x4253b8[_0x5c4d81(0x3b0)](),_0x330ebe=new RegExp('imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll'),_0xe50d76=new RegExp(_0x5c4d81(0x31a)),_0x5e7056=new RegExp('fetch|listbyids|modal|seed');if(_0x17a011===midjourney_constant_1[_0x5c4d81(0x339)]['fast'])_0x177197=_0x5c4d81(0x2c5),_0x470887=_0x5c4d81(0x3a2),_0x33131a=_0x5c4d81(0x2e1);else{if(_0x17a011===midjourney_constant_1[_0x5c4d81(0x339)][_0x5c4d81(0x317)])_0x177197='type2',_0x470887=_0x5c4d81(0x1cd),_0x33131a=_0x5c4d81(0x243);else _0x17a011===midjourney_constant_1['DrawSpeed'][_0x5c4d81(0x24e)]&&(_0x177197=_0x5c4d81(0x1d7),_0x470887='turbo_mjDeduction',_0x33131a=_0x5c4d81(0x2e6));}if(_0x330ebe[_0x5c4d81(0x29e)](_0x3d1501))_0x470887=_0x470887+0x1;else{if(_0xe50d76['test'](_0x3d1501))_0x470887=_0x470887+0x2;else _0x5e7056[_0x5c4d81(0x29e)](_0x3d1501)&&(_0x470887=_0x470887+0x3);}const _0x5db0e9=await this[_0x5c4d81(0x36a)][_0x5c4d81(0x30a)](_0x5c4d81(0x36b));let _0x265991={};if(!_0x5db0e9){let _0x1b75f4=await this[_0x5c4d81(0x399)][_0x5c4d81(0x353)]([_0x470887,_0x33131a]);for(let _0x546463 in _0x1b75f4){_0x265991[_0x546463]=Number(_0x1b75f4[_0x546463])||0x0;}if(_0xdce9a9[_0x5c4d81(0x3b3)]){const _0xab982e=await this[_0x5c4d81(0x399)][_0x5c4d81(0x22a)](_0xdce9a9[_0x5c4d81(0x3b3)],'mj');_0xab982e&&(_0x265991[_0x33131a]=_0xab982e[_0x177197]||0x0);}}else{const _0x5ceb8d=_0xdce9a9[_0x5c4d81(0x2fb)]||'';_0x265991=_0x5db0e9['mjLeavelRel'][_0x5ceb8d],(!_0x265991||!_0x265991['fast_vip_free'])&&(_0x265991=_0x5db0e9[_0x5c4d81(0x2cd)][_0x5c4d81(0x1ff)]);}for(let _0x5f03de in midjourney_constant_1[_0x5c4d81(0x22c)]){if(_0x3d1501[_0x5c4d81(0x215)](midjourney_constant_1[_0x5c4d81(0x22c)][_0x5f03de][_0x5c4d81(0x329)])){_0x1f088b=midjourney_constant_1[_0x5c4d81(0x22c)][_0x5f03de]['cn'];break;}}return{'price':Number(_0x265991[_0x470887]),'vipFreeNum':Number(_0x265991[_0x33131a]),'vipFreeKey':_0x33131a,'description':_0x1f088b};}async[_0x9167c(0x380)](_0x10b286,_0x402c5a){const _0x517a21=_0x9167c;try{let _0x4d197f='Imagine';_0x402c5a['type']==0x5&&(_0x4d197f=_0x517a21(0x27a));const _0x36c751=_0x402c5a[_0x517a21(0x3a3)];_0x36c751[_0x517a21(0x1c9)]&&(_0x4d197f=_0x36c751[_0x517a21(0x1c9)]);const _0x807142=await this[_0x517a21(0x3b2)](_0x10b286);let _0x27bdc8='',_0x2a8190='',_0x56da6d='',_0x412353=_0x4d197f;const _0x48d6b8=_0x4d197f[_0x517a21(0x3b0)](),_0x5bb220=new RegExp('imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll'),_0x56ffca=new RegExp(_0x517a21(0x31a)),_0x35e8ce=new RegExp(_0x517a21(0x349));if(_0x36c751[_0x517a21(0x348)]===midjourney_constant_1[_0x517a21(0x339)]['fast'])_0x2a8190=_0x517a21(0x2c5),_0x27bdc8='fast_mjDeduction',_0x56da6d='fast_vip_free';else{if(_0x36c751[_0x517a21(0x348)]===midjourney_constant_1[_0x517a21(0x339)]['relax'])_0x2a8190=_0x517a21(0x21a),_0x27bdc8='relax_mjDeduction',_0x56da6d=_0x517a21(0x243);else _0x36c751[_0x517a21(0x348)]===midjourney_constant_1[_0x517a21(0x339)][_0x517a21(0x24e)]&&(_0x2a8190=_0x517a21(0x1d7),_0x27bdc8=_0x517a21(0x284),_0x56da6d=_0x517a21(0x2e6));}if(_0x5bb220[_0x517a21(0x29e)](_0x48d6b8))_0x27bdc8=_0x27bdc8+0x1;else{if(_0x56ffca[_0x517a21(0x29e)](_0x48d6b8))_0x27bdc8=_0x27bdc8+0x2;else _0x35e8ce[_0x517a21(0x29e)](_0x48d6b8)&&(_0x27bdc8=_0x27bdc8+0x3);}const _0xb57be5=await this['configService'][_0x517a21(0x30a)]('MjLeavelRel');let _0x18ac35={};if(!_0xb57be5){let _0x3485f8=await this[_0x517a21(0x399)][_0x517a21(0x353)]([_0x27bdc8,_0x56da6d]);for(let _0xa1dffa in _0x3485f8){_0x18ac35[_0xa1dffa]=Number(_0x3485f8[_0xa1dffa])||0x0;}if(_0x807142?.[_0x517a21(0x3b3)]){const _0x21361f=await this[_0x517a21(0x399)]['getVipLeavelRelById'](_0x807142?.['vipLeavelId'],'mj');_0x21361f&&(_0x18ac35[_0x56da6d]=_0x21361f[_0x2a8190]||0x0);}}else{const _0x57674b=_0x807142?.['vipLeavelName']||'';_0x18ac35=_0xb57be5['mjLeavelRel'][_0x57674b],(!_0x18ac35||!_0x18ac35[_0x517a21(0x2e1)])&&(_0x18ac35=_0xb57be5['mjLeavelRel'][_0x517a21(0x1ff)]);}for(let _0x1e2861 in midjourney_constant_1[_0x517a21(0x22c)]){if(_0x48d6b8[_0x517a21(0x215)](midjourney_constant_1[_0x517a21(0x22c)][_0x1e2861]['action'])){_0x412353=midjourney_constant_1['ActionCN'][_0x1e2861]['cn'];break;}}if(_0x10b286<=0x0)return{'remainCount':0x0,'freeCount':Number(_0x18ac35[_0x56da6d]),'isVipFree':Number(_0x18ac35[_0x56da6d])==-0x1,'useIntegrate':Number(_0x18ac35[_0x27bdc8])};const _0x1ec695=redisKey_constant_1[_0x517a21(0x286)]+'-'+_0x10b286+'-'+_0x56da6d;let _0x1b4a3a=await this[_0x517a21(0x32c)][_0x517a21(0x396)]({'key':_0x1ec695}),_0x376cc3=Number(_0x1b4a3a||0x0);return{'remainCount':Number(_0x18ac35[_0x56da6d])-_0x376cc3,'freeCount':Number(_0x18ac35[_0x56da6d]),'isVipFree':Number(_0x18ac35[_0x56da6d])==-0x1,'useIntegrate':Number(_0x18ac35[_0x27bdc8]),'isVipUsed':_0xb57be5['userType']?!![]:![],'userType':_0xb57be5[_0x517a21(0x363)]};}catch(_0x365c5a){return _0x365c5a;}}async['validateBalance4Coze'](_0x3b7b12,_0x116df2,_0x58242d,_0x5f348d){const _0x10ad81=_0x9167c;let _0x19d082=!![];const _0x3aca57=await this['getUserById'](_0x3b7b12);if(_0x3aca57['lifetimeVip']||_0x3aca57[_0x10ad81(0x2f5)]){if(_0x58242d<0x0)_0x19d082=!![];else{if(_0x58242d>0x0){const _0x609cbd=redisKey_constant_1[_0x10ad81(0x286)]+'-'+_0x3b7b12+'-'+_0x116df2;let _0x1a37ee=await this[_0x10ad81(0x32c)][_0x10ad81(0x396)]({'key':_0x609cbd}),_0x176fc5=Number(_0x1a37ee||0x0);_0x176fc5<_0x58242d?_0x19d082=!![]:_0x19d082=_0x3aca57['score']>=_0x5f348d;}else _0x19d082=_0x3aca57[_0x10ad81(0x224)]>=_0x5f348d;}}else _0x19d082=_0x3aca57[_0x10ad81(0x224)]>=_0x5f348d;if(!_0x19d082)throw new common_1[(_0x10ad81(0x336))]('用户余额不足，请充值',common_1[_0x10ad81(0x398)]['BAD_REQUEST']);}async[_0x9167c(0x2c9)](_0x3e0b12,_0x1c1d04=midjourney_constant_1[_0x9167c(0x339)][_0x9167c(0x317)],_0x3b4027){const _0x37e12c=_0x9167c;let _0x172ad8=!![];const _0x1c197f=await this[_0x37e12c(0x3b2)](_0x3e0b12),_0x391e34=await this[_0x37e12c(0x1b8)](_0x1c1d04,_0x3b4027,_0x1c197f);console[_0x37e12c(0x30b)](_0x37e12c(0x261),_0x391e34);if(_0x1c197f['lifetimeVip']||_0x1c197f[_0x37e12c(0x2f5)]){if(_0x391e34['vipFreeNum']<0x0)_0x172ad8=!![];else{if(_0x391e34[_0x37e12c(0x33c)]>0x0){const _0x339e0a=redisKey_constant_1[_0x37e12c(0x286)]+'-'+_0x3e0b12+'-'+_0x391e34[_0x37e12c(0x1e4)];let _0x46d4b0=await this['redisCacheService'][_0x37e12c(0x396)]({'key':_0x339e0a}),_0x5e5d9d=Number(_0x46d4b0||0x0);_0x5e5d9d<_0x391e34[_0x37e12c(0x33c)]?_0x172ad8=!![]:_0x172ad8=_0x1c197f[_0x37e12c(0x224)]>=_0x391e34[_0x37e12c(0x37c)];}else _0x172ad8=_0x1c197f[_0x37e12c(0x224)]>=_0x391e34[_0x37e12c(0x37c)];}}else _0x172ad8=_0x1c197f[_0x37e12c(0x224)]>=_0x391e34[_0x37e12c(0x37c)];if(_0x1c1d04===midjourney_constant_1[_0x37e12c(0x339)][_0x37e12c(0x317)]){if(!_0x172ad8)throw new common_1[(_0x37e12c(0x336))](_0x37e12c(0x388),common_1[_0x37e12c(0x398)][_0x37e12c(0x2af)]);}else{if(!_0x172ad8)return this['validateBalance4MJ'](_0x3e0b12,midjourney_constant_1['DrawSpeed'][_0x37e12c(0x317)],_0x3b4027);}return _0x1c1d04;}async[_0x9167c(0x29b)](_0x391571,_0x4d1043,_0x9ff7fd,_0x33a3e8){const _0x2cc59e=_0x9167c,_0x2fb3b4=await this[_0x2cc59e(0x3b2)](_0x391571),_0x8116b4=await this[_0x2cc59e(0x1b8)](_0x4d1043,_0x9ff7fd,_0x2fb3b4),_0x31d830=balance_constant_1[_0x2cc59e(0x1a8)][_0x2cc59e(0x207)];if(_0x2fb3b4[_0x2cc59e(0x1c0)]||_0x2fb3b4['vipExpire']){if(_0x8116b4[_0x2cc59e(0x33c)]<0x0)await this['changeScore4Other'](_0x2fb3b4,_0x31d830,0x0,_0x2cc59e(0x1c4)+_0x8116b4[_0x2cc59e(0x1e8)]+_0x2cc59e(0x36d),_0x33a3e8);else{if(_0x8116b4[_0x2cc59e(0x33c)]>0x0){const _0x16d653=redisKey_constant_1[_0x2cc59e(0x286)]+'-'+_0x391571+'-'+_0x8116b4[_0x2cc59e(0x1e4)];let _0x4e4da5=await this[_0x2cc59e(0x32c)][_0x2cc59e(0x396)]({'key':_0x16d653}),_0x5f588b=Number(_0x4e4da5||0x0);if(_0x5f588b<_0x8116b4[_0x2cc59e(0x33c)]){const _0x525dad=(0x0,date_1[_0x2cc59e(0x296)])()['endOf']('d')[_0x2cc59e(0x294)]((0x0,date_1[_0x2cc59e(0x296)])(),'s');await this[_0x2cc59e(0x32c)]['set']({'key':_0x16d653,'val':_0x5f588b+0x1},_0x525dad),await this[_0x2cc59e(0x278)](_0x2fb3b4,_0x31d830,0x0,_0x2cc59e(0x1c4)+_0x8116b4['description']+'】会员每日限免',_0x33a3e8);}else await this[_0x2cc59e(0x278)](_0x2fb3b4,_0x31d830,-_0x8116b4['price'],'MJ绘画【'+_0x8116b4[_0x2cc59e(0x1e8)]+_0x2cc59e(0x2f7),_0x33a3e8);}else await this[_0x2cc59e(0x278)](_0x2fb3b4,_0x31d830,-_0x8116b4[_0x2cc59e(0x37c)],'MJ绘画【'+_0x8116b4[_0x2cc59e(0x1e8)]+_0x2cc59e(0x2f7),_0x33a3e8);}}else await this[_0x2cc59e(0x278)](_0x2fb3b4,_0x31d830,-_0x8116b4['price'],_0x2cc59e(0x1c4)+_0x8116b4[_0x2cc59e(0x1e8)]+_0x2cc59e(0x2f7),_0x33a3e8);}async[_0x9167c(0x28f)](_0x52bc46,_0x3e3b50,_0x59f430,_0x42286c){const _0x36ba7a=_0x9167c,_0x528d87=await this[_0x36ba7a(0x3b2)](_0x52bc46),_0x3d63cc=await this[_0x36ba7a(0x1b8)](_0x3e3b50,_0x59f430,_0x528d87),_0x132542=balance_constant_1[_0x36ba7a(0x1a8)][_0x36ba7a(0x207)];if(_0x528d87[_0x36ba7a(0x1c0)]||_0x528d87[_0x36ba7a(0x2f5)]){if(_0x3d63cc['vipFreeNum']<0x0)return;else{if(_0x3d63cc[_0x36ba7a(0x33c)]>0x0){const _0x2bd33b=redisKey_constant_1[_0x36ba7a(0x286)]+'-'+_0x52bc46+'-'+_0x3d63cc[_0x36ba7a(0x1e4)];let _0x1496a0=await this[_0x36ba7a(0x32c)][_0x36ba7a(0x396)]({'key':_0x2bd33b}),_0x29d392=Number(_0x1496a0||0x0);if(_0x29d392<_0x3d63cc[_0x36ba7a(0x33c)]){const _0x37a19e=(0x0,date_1[_0x36ba7a(0x296)])()['endOf']('d')[_0x36ba7a(0x294)]((0x0,date_1['default'])(),'s');await this['redisCacheService']['set']({'key':_0x2bd33b,'val':_0x29d392-0x1},_0x37a19e);return;}}}}await this['changeScore4Other'](_0x528d87,_0x132542,_0x3d63cc[_0x36ba7a(0x37c)],_0x36ba7a(0x1c4)+_0x3d63cc[_0x36ba7a(0x1e8)]+_0x36ba7a(0x2e4),_0x42286c);}async[_0x9167c(0x2a9)](_0x365f25,_0x446190,_0xcca644,_0x5c4fed=![]){const _0x4b5cbb=_0x9167c,_0x47aa19={'create':{'key':'musicCreate','desc':_0x4b5cbb(0x1c7)},'lyrics':{'key':_0x4b5cbb(0x384),'desc':_0x4b5cbb(0x301)},'upload':{'key':_0x4b5cbb(0x1ea),'desc':_0x4b5cbb(0x253)}},_0x2edd46=_0x47aa19[_0xcca644][_0x4b5cbb(0x35e)],_0x34718f=_0x47aa19[_0xcca644]['key']+'Price',_0x300d23=_0x47aa19[_0xcca644]['key']+_0x4b5cbb(0x3b5),_0x32be16={},_0x3acf40=await this['globalConfigService'][_0x4b5cbb(0x353)]([_0x34718f,_0x300d23,_0x4b5cbb(0x29c)]);this[_0x4b5cbb(0x1a5)](_0x365f25,_0x3acf40['musicUserType']);for(let _0x342cef in _0x3acf40){_0x32be16[_0x342cef]=Number(_0x3acf40[_0x342cef])||0x0;}const _0x43b1ef=await this[_0x4b5cbb(0x3b2)](_0x365f25);if(_0x43b1ef['lifetimeVip']||_0x43b1ef[_0x4b5cbb(0x2f5)]){if(_0x32be16[_0x300d23]<0x0){!_0x5c4fed&&await this['changeScore4Other'](_0x43b1ef,balance_constant_1[_0x4b5cbb(0x1a8)]['Music'],0x0,'音乐【'+_0x2edd46+_0x4b5cbb(0x36d),_0x446190);return;}else{if(_0x32be16[_0x300d23]>0x0){const _0x1e2c25=redisKey_constant_1[_0x4b5cbb(0x286)]+'-'+_0x365f25+'-'+_0x300d23;let _0x1e4b1f=await this['redisCacheService'][_0x4b5cbb(0x396)]({'key':_0x1e2c25}),_0x737059=Number(_0x1e4b1f||0x0);if(!_0x5c4fed){if(_0x737059<_0x32be16[_0x300d23]){const _0x40f20d=(0x0,date_1[_0x4b5cbb(0x296)])()[_0x4b5cbb(0x369)]('d')['diff']((0x0,date_1[_0x4b5cbb(0x296)])(),'s');await this['redisCacheService'][_0x4b5cbb(0x2ce)]({'key':_0x1e2c25,'val':_0x737059+0x1},_0x40f20d),await this[_0x4b5cbb(0x278)](_0x43b1ef,balance_constant_1[_0x4b5cbb(0x1a8)][_0x4b5cbb(0x20f)],0x0,'音乐【'+_0x2edd46+_0x4b5cbb(0x1ce),_0x446190);return;}}else{const _0x1a5800=(0x0,date_1['default'])()[_0x4b5cbb(0x369)]('d')[_0x4b5cbb(0x294)]((0x0,date_1['default'])(),'s');await this[_0x4b5cbb(0x32c)][_0x4b5cbb(0x2ce)]({'key':_0x1e2c25,'val':_0x737059-0x1},_0x1a5800);return;}}}}if(!_0x5c4fed&&_0x43b1ef[_0x4b5cbb(0x224)]<_0x32be16[_0x34718f])throw new common_1[(_0x4b5cbb(0x336))]('用户余额不足，请充值',common_1['HttpStatus'][_0x4b5cbb(0x2af)]);if(!_0x5c4fed){await this[_0x4b5cbb(0x278)](_0x43b1ef,balance_constant_1['EChangeType']['Music'],-_0x32be16[_0x34718f],'音乐【'+_0x2edd46+_0x4b5cbb(0x2f7),_0x446190);return;}await this[_0x4b5cbb(0x278)](_0x43b1ef,balance_constant_1[_0x4b5cbb(0x1a8)][_0x4b5cbb(0x20f)],_0x32be16[_0x34718f],_0x4b5cbb(0x2bb)+_0x2edd46+_0x4b5cbb(0x36f),_0x446190);}async['debuctBalance4PPT'](_0x58929c,_0x3dd280,_0x260719,_0x43cbf7=![]){const _0x5bdfca=_0x9167c,_0x17d117={'structure':{'key':_0x5bdfca(0x25b),'vlrk':'type1','desc':_0x5bdfca(0x2d6)},'cover':{'key':_0x5bdfca(0x25b),'vlrk':_0x5bdfca(0x2c5),'desc':_0x5bdfca(0x220)},'recover':{'key':_0x5bdfca(0x25b),'vlrk':_0x5bdfca(0x2c5),'desc':_0x5bdfca(0x375)},'create':{'key':_0x5bdfca(0x312),'vlrk':_0x5bdfca(0x21a),'desc':_0x5bdfca(0x344)},'thesis':{'key':_0x5bdfca(0x340),'vlrk':_0x5bdfca(0x1d7),'desc':_0x5bdfca(0x251)},'file':{'key':_0x5bdfca(0x312),'vlrk':'type2','desc':_0x5bdfca(0x308)},'theme':{'key':_0x5bdfca(0x312),'vlrk':_0x5bdfca(0x21a),'desc':_0x5bdfca(0x30e)},'editor':{'key':_0x5bdfca(0x197),'vlrk':_0x5bdfca(0x2c5),'desc':'编辑PPT'},'addpage':{'key':_0x5bdfca(0x312),'vlrk':_0x5bdfca(0x21a),'desc':_0x5bdfca(0x352)},'addNotes':{'key':_0x5bdfca(0x312),'vlrk':_0x5bdfca(0x21a),'desc':_0x5bdfca(0x245)}},_0x14aca7=_0x17d117[_0x260719][_0x5bdfca(0x35e)],_0x2174e2=_0x17d117[_0x260719][_0x5bdfca(0x1cc)]+_0x5bdfca(0x258),_0x3bdd9e=_0x17d117[_0x260719][_0x5bdfca(0x1cc)]+'VipFree',_0x45e7fd={},_0x5d8132=await this['globalConfigService'][_0x5bdfca(0x353)]([_0x2174e2,_0x3bdd9e,_0x5bdfca(0x263)]);this[_0x5bdfca(0x1a5)](_0x58929c,_0x5d8132[_0x5bdfca(0x263)]);for(let _0x1b3125 in _0x5d8132){_0x45e7fd[_0x1b3125]=Number(_0x5d8132[_0x1b3125])||0x0;}const _0xf7b88b=await this[_0x5bdfca(0x3b2)](_0x58929c);if(_0xf7b88b[_0x5bdfca(0x3b3)]){const _0x2266c0=await this[_0x5bdfca(0x399)][_0x5bdfca(0x22a)](_0xf7b88b[_0x5bdfca(0x3b3)],model_constant_1[_0x5bdfca(0x25c)]['PPT']);_0x2266c0&&(_0x45e7fd[_0x3bdd9e]=_0x2266c0[_0x17d117[_0x260719][_0x5bdfca(0x272)]]||0x0);}if(_0xf7b88b[_0x5bdfca(0x1c0)]||_0xf7b88b[_0x5bdfca(0x2f5)]){if(_0x45e7fd[_0x3bdd9e]<0x0){!_0x43cbf7&&await this[_0x5bdfca(0x278)](_0xf7b88b,balance_constant_1['EChangeType'][_0x5bdfca(0x34a)],0x0,_0x5bdfca(0x26a)+_0x14aca7+_0x5bdfca(0x36d),_0x3dd280);return;}else{if(_0x45e7fd[_0x3bdd9e]>0x0){const _0x5fc3e2=redisKey_constant_1[_0x5bdfca(0x286)]+'-'+_0x58929c+'-'+_0x3bdd9e;let _0x3acb89=await this[_0x5bdfca(0x32c)][_0x5bdfca(0x396)]({'key':_0x5fc3e2}),_0xff342e=Number(_0x3acb89||0x0);if(!_0x43cbf7){if(_0xff342e<_0x45e7fd[_0x3bdd9e]){const _0x99d1b4=(0x0,date_1[_0x5bdfca(0x296)])()[_0x5bdfca(0x369)]('d')[_0x5bdfca(0x294)]((0x0,date_1[_0x5bdfca(0x296)])(),'s');await this[_0x5bdfca(0x32c)][_0x5bdfca(0x2ce)]({'key':_0x5fc3e2,'val':_0xff342e+0x1},_0x99d1b4),await this['changeScore4Other'](_0xf7b88b,balance_constant_1[_0x5bdfca(0x1a8)]['PPT'],0x0,_0x5bdfca(0x26a)+_0x14aca7+_0x5bdfca(0x1ce),_0x3dd280);return;}}else{const _0x49c9f0=(0x0,date_1['default'])()[_0x5bdfca(0x369)]('d')[_0x5bdfca(0x294)]((0x0,date_1[_0x5bdfca(0x296)])(),'s');await this[_0x5bdfca(0x32c)][_0x5bdfca(0x2ce)]({'key':_0x5fc3e2,'val':_0xff342e-0x1},_0x49c9f0);return;}}}}if(!_0x43cbf7&&_0xf7b88b[_0x5bdfca(0x224)]<_0x45e7fd[_0x2174e2])throw new common_1[(_0x5bdfca(0x336))](_0x5bdfca(0x388),common_1[_0x5bdfca(0x398)]['BAD_REQUEST']);if(!_0x43cbf7){await this[_0x5bdfca(0x278)](_0xf7b88b,balance_constant_1[_0x5bdfca(0x1a8)][_0x5bdfca(0x34a)],-_0x45e7fd[_0x2174e2],_0x5bdfca(0x26a)+_0x14aca7+'】使用扣减',_0x3dd280);return;}await this[_0x5bdfca(0x278)](_0xf7b88b,balance_constant_1[_0x5bdfca(0x1a8)][_0x5bdfca(0x34a)],_0x45e7fd[_0x2174e2],'PPT【'+_0x14aca7+'】生成失败退还',_0x3dd280);}async[_0x9167c(0x2b6)](_0x16b2e9,_0x21f5a6,_0x3854e2){const _0x5460e2=_0x9167c,_0x5cdd9b=await this[_0x5460e2(0x3b2)](_0x16b2e9);if(_0x5cdd9b[_0x5460e2(0x1c0)]||_0x5cdd9b['vipExpire']){if(_0x21f5a6[_0x5460e2(0x33c)]<0x0)await this[_0x5460e2(0x278)](_0x5cdd9b,balance_constant_1['EChangeType'][_0x5460e2(0x1de)],0x0,_0x5460e2(0x310)+_0x21f5a6[_0x5460e2(0x1d6)]+_0x5460e2(0x36d),_0x3854e2);else{if(_0x21f5a6[_0x5460e2(0x33c)]>0x0){const _0x2481f3=redisKey_constant_1[_0x5460e2(0x286)]+'-'+_0x16b2e9+'-'+_0x21f5a6['id'];let _0x4c8e1e=await this[_0x5460e2(0x32c)][_0x5460e2(0x396)]({'key':_0x2481f3}),_0x4611b1=Number(_0x4c8e1e||0x0);if(_0x4611b1<_0x21f5a6[_0x5460e2(0x33c)]){const _0x34b938=(0x0,date_1[_0x5460e2(0x296)])()[_0x5460e2(0x369)]('d')[_0x5460e2(0x294)]((0x0,date_1[_0x5460e2(0x296)])(),'s');await this['redisCacheService'][_0x5460e2(0x2ce)]({'key':_0x2481f3,'val':_0x4611b1+0x1},_0x34b938),await this[_0x5460e2(0x278)](_0x5cdd9b,balance_constant_1[_0x5460e2(0x1a8)][_0x5460e2(0x1de)],0x0,_0x5460e2(0x310)+_0x21f5a6[_0x5460e2(0x1d6)]+'】会员每日限免',_0x3854e2);}else{if(_0x5cdd9b['score']<_0x21f5a6['deduct'])throw new common_1['HttpException'](_0x5460e2(0x388),common_1[_0x5460e2(0x398)][_0x5460e2(0x2af)]);await this[_0x5460e2(0x278)](_0x5cdd9b,balance_constant_1['EChangeType'][_0x5460e2(0x1de)],-_0x21f5a6[_0x5460e2(0x34c)],_0x5460e2(0x310)+_0x21f5a6[_0x5460e2(0x1d6)]+_0x5460e2(0x2f7),_0x3854e2);}}else{if(_0x5cdd9b[_0x5460e2(0x224)]<_0x21f5a6[_0x5460e2(0x34c)])throw new common_1['HttpException'](_0x5460e2(0x388),common_1[_0x5460e2(0x398)]['BAD_REQUEST']);await this[_0x5460e2(0x278)](_0x5cdd9b,balance_constant_1[_0x5460e2(0x1a8)]['WORKFLOW'],-_0x21f5a6[_0x5460e2(0x34c)],_0x5460e2(0x310)+_0x21f5a6[_0x5460e2(0x1d6)]+_0x5460e2(0x2f7),_0x3854e2);}}}else{if(_0x5cdd9b['score']<_0x21f5a6[_0x5460e2(0x34c)])throw new common_1[(_0x5460e2(0x336))](_0x5460e2(0x388),common_1[_0x5460e2(0x398)][_0x5460e2(0x2af)]);await this['changeScore4Other'](_0x5cdd9b,balance_constant_1[_0x5460e2(0x1a8)][_0x5460e2(0x1de)],-_0x21f5a6[_0x5460e2(0x34c)],_0x5460e2(0x310)+_0x21f5a6[_0x5460e2(0x1d6)]+_0x5460e2(0x2f7),_0x3854e2);}}async[_0x9167c(0x305)](_0x3c52a5,_0xfc90ee){const _0x3573c0=_0x9167c,_0x5ebbb0=store_1['CZConfig'][_0x3573c0(0x346)],_0x3fa2de=await this[_0x3573c0(0x3b2)](_0x3c52a5),_0x196c88=balance_constant_1[_0x3573c0(0x1a8)]['SD'];if(_0x3fa2de[_0x3573c0(0x1c0)]||_0x3fa2de[_0x3573c0(0x2f5)]){if(store_1[_0x3573c0(0x1e2)]['czVipFree']<0x0)await this[_0x3573c0(0x278)](_0x3fa2de,_0x196c88,0x0,_0x3573c0(0x3ac),_0xfc90ee);else{if(store_1['CZConfig'][_0x3573c0(0x1ee)]>0x0){const _0x58ea4c=redisKey_constant_1[_0x3573c0(0x286)]+'-'+_0x3c52a5+_0x3573c0(0x22f);let _0x4dcae6=await this[_0x3573c0(0x32c)]['get']({'key':_0x58ea4c}),_0x192f10=Number(_0x4dcae6||0x0);if(_0x192f10<store_1[_0x3573c0(0x1e2)][_0x3573c0(0x1ee)]){const _0x153774=(0x0,date_1[_0x3573c0(0x296)])()[_0x3573c0(0x369)]('d')[_0x3573c0(0x294)]((0x0,date_1[_0x3573c0(0x296)])(),'s');await this[_0x3573c0(0x32c)][_0x3573c0(0x2ce)]({'key':_0x58ea4c,'val':_0x192f10+0x1},_0x153774),await this[_0x3573c0(0x278)](_0x3fa2de,_0x196c88,0x0,_0x3573c0(0x30c)+_0x5ebbb0+_0x3573c0(0x1ce),_0xfc90ee);}else await this[_0x3573c0(0x278)](_0x3fa2de,_0x196c88,-_0x5ebbb0,_0x3573c0(0x30c)+_0x5ebbb0+_0x3573c0(0x2f7),_0xfc90ee);}else await this[_0x3573c0(0x278)](_0x3fa2de,_0x196c88,-_0x5ebbb0,'SD绘画【'+_0x5ebbb0+_0x3573c0(0x2f7),_0xfc90ee);}}else await this['changeScore4Other'](_0x3fa2de,_0x196c88,-_0x5ebbb0,'SD绘画【'+_0x5ebbb0+_0x3573c0(0x2f7),_0xfc90ee);}async[_0x9167c(0x321)](_0x4d4b79){const _0x25b419=_0x9167c;let _0x5d5262;const _0x55d5ce=await this['configService'][_0x25b419(0x30a)](_0x25b419(0x2a3));if(_0x55d5ce)return _0x55d5ce[_0x25b419(0x2ad)][_0x4d4b79];return _0x5d5262;}async[_0x9167c(0x198)](_0x28aa93,_0x952e1){const _0x27de10=_0x9167c,_0x2740df=this[_0x27de10(0x321)](_0x952e1);if(!_0x2740df)return 0x0;const _0x1592ab=redisKey_constant_1['VIP_FREE']+'-'+_0x28aa93+'-'+_0x952e1;let _0x37ba03=await this[_0x27de10(0x32c)][_0x27de10(0x396)]({'key':_0x1592ab}),_0x120b80=Number(_0x37ba03||0x0);return _0x120b80;}async[_0x9167c(0x293)](_0x3e052a,_0x49547c){const _0x45da61=_0x9167c,_0x169777=redisKey_constant_1[_0x45da61(0x286)]+'-'+_0x3e052a+'-'+_0x49547c['id'];let _0x433786=await this[_0x45da61(0x32c)][_0x45da61(0x396)]({'key':_0x169777}),_0x4f78b7=Number(_0x433786||0x0);return _0x49547c['vipFreeNum']-_0x4f78b7;}async[_0x9167c(0x389)](_0x4a59a8,_0x5304f5){const _0x5c18cb=_0x9167c;let _0x46b840;const _0x32a5ab=await this['configService'][_0x5c18cb(0x30a)](_0x5c18cb(0x209));if(_0x32a5ab){const _0x170263=_0x32a5ab[_0x5c18cb(0x28e)][_0x4a59a8['keyType']['toString']()];let _0x31cd62=_0x5304f5[_0x5c18cb(0x348)],_0x2e4f16=_0x5304f5[_0x5c18cb(0x2ff)];_0x46b840=_0x170263['find'](_0x169287=>_0x169287['model']==_0x5304f5[_0x5c18cb(0x250)]&&_0x169287['mode']==_0x31cd62&&_0x169287[_0x5c18cb(0x2ff)]==_0x2e4f16);}return _0x46b840;}async[_0x9167c(0x1a6)](_0x547592,_0x3f0542,_0x4a5b06){const _0x24b04a=_0x9167c;let _0xb2f954=await this['getVideoConfig'](_0x3f0542,_0x4a5b06);if(!_0xb2f954)return await this[_0x24b04a(0x293)](_0x547592,_0x3f0542);const _0x5725a6=redisKey_constant_1[_0x24b04a(0x286)]+'-'+_0x547592+'-'+_0xb2f954[_0x24b04a(0x250)]+'-'+_0xb2f954['mode']+'-'+_0xb2f954['duration'];let _0x8c3100=await this[_0x24b04a(0x32c)][_0x24b04a(0x396)]({'key':_0x5725a6}),_0x3de8bb=Number(_0x8c3100||0x0);return _0xb2f954[_0x24b04a(0x33c)]-_0x3de8bb;}async[_0x9167c(0x3b4)](_0x359652,_0x4a3477){const _0x20d47b=_0x9167c,_0x540187=redisKey_constant_1[_0x20d47b(0x286)]+'-'+_0x359652+'-'+_0x4a3477['model'];let _0x4028ff=await this['redisCacheService']['get']({'key':_0x540187}),_0x474646=Number(_0x4028ff||0x0);return _0x4a3477[_0x20d47b(0x33c)]-_0x474646;}async[_0x9167c(0x1e6)](_0xe41879,_0x196e13,_0x604100){const _0x422c1b=_0x9167c,_0x3414d1=redisKey_constant_1['VIP_FREE']+'-'+_0xe41879+'-'+_0x196e13;let _0x56edd9=await this[_0x422c1b(0x32c)][_0x422c1b(0x396)]({'key':_0x3414d1}),_0x4f6978=Number(_0x56edd9||0x0);return _0x604100-_0x4f6978;}async[_0x9167c(0x23a)](_0x3a5695){const _0x421215=_0x9167c,_0x51930b=redisKey_constant_1[_0x421215(0x286)]+'-'+_0x3a5695+_0x421215(0x1aa);let _0x41471a=await this[_0x421215(0x32c)][_0x421215(0x396)]({'key':_0x51930b}),_0x156a23=Number(_0x41471a||0x0);return store_1[_0x421215(0x1b7)][_0x421215(0x2c4)]-_0x156a23;}async['getKeyFree'](_0x501cac,_0x40e1fb,_0x16b8af){const _0x56f8ac=_0x9167c;let _0x58f1d6=await this[_0x56f8ac(0x32c)]['get']({'key':_0x40e1fb}),_0x542bd4=Number(_0x58f1d6||0x0);return _0x16b8af-_0x542bd4;}async[_0x9167c(0x351)](_0x4c9971){const _0x185eb5=_0x9167c;let _0x2d2e5e=!![];const _0x25b2de=await this[_0x185eb5(0x3b2)](_0x4c9971);if(_0x25b2de[_0x185eb5(0x1c0)]||_0x25b2de[_0x185eb5(0x2f5)]){if(store_1['LinkFoxConfig']['lfVipFree']<0x0)_0x2d2e5e=!![];else{if(store_1['LinkFoxConfig'][_0x185eb5(0x2c4)]>0x0){const _0xa8f99=await this[_0x185eb5(0x23a)](_0x4c9971);_0xa8f99>0x0?_0x2d2e5e=!![]:_0x2d2e5e=_0x25b2de[_0x185eb5(0x224)]>=store_1[_0x185eb5(0x1b7)][_0x185eb5(0x2be)];}else _0x2d2e5e=_0x25b2de[_0x185eb5(0x224)]>=store_1[_0x185eb5(0x1b7)][_0x185eb5(0x2be)];}}else _0x2d2e5e=_0x25b2de[_0x185eb5(0x224)]>=store_1['LinkFoxConfig']['lfPrice'];if(!_0x2d2e5e)throw new common_1['HttpException']('用户余额不足，请充值',common_1['HttpStatus'][_0x185eb5(0x2af)]);}async[_0x9167c(0x229)](_0x18bb32,_0x2f2af6){const _0x4458c9=_0x9167c,_0x3b9ec3=store_1[_0x4458c9(0x1b7)]['lfPrice'],_0x413b82=await this[_0x4458c9(0x3b2)](_0x18bb32),_0x271894=balance_constant_1[_0x4458c9(0x1a8)][_0x4458c9(0x26b)];if(_0x413b82[_0x4458c9(0x1c0)]||_0x413b82[_0x4458c9(0x2f5)]){if(store_1[_0x4458c9(0x1b7)][_0x4458c9(0x2c4)]<0x0)await this['changeScore4Other'](_0x413b82,_0x271894,0x0,_0x4458c9(0x237),_0x2f2af6);else{if(store_1[_0x4458c9(0x1b7)]['lfVipFree']>0x0){const _0x1269fe=redisKey_constant_1['VIP_FREE']+'-'+_0x18bb32+_0x4458c9(0x1aa);let _0x3fe630=await this[_0x4458c9(0x32c)]['get']({'key':_0x1269fe}),_0x53a64f=Number(_0x3fe630||0x0);if(_0x53a64f<store_1['LinkFoxConfig'][_0x4458c9(0x2c4)]){const _0x590a2f=(0x0,date_1[_0x4458c9(0x296)])()[_0x4458c9(0x369)]('d')['diff']((0x0,date_1[_0x4458c9(0x296)])(),'s');await this[_0x4458c9(0x32c)][_0x4458c9(0x2ce)]({'key':_0x1269fe,'val':_0x53a64f+0x1},_0x590a2f),await this[_0x4458c9(0x278)](_0x413b82,_0x271894,0x0,'LinxFox【'+_0x3b9ec3+_0x4458c9(0x1ce),_0x2f2af6);}else await this[_0x4458c9(0x278)](_0x413b82,_0x271894,-_0x3b9ec3,'LinxFox【【'+_0x3b9ec3+_0x4458c9(0x2f7),_0x2f2af6);}else await this['changeScore4Other'](_0x413b82,_0x271894,-_0x3b9ec3,_0x4458c9(0x34b)+_0x3b9ec3+_0x4458c9(0x2f7),_0x2f2af6);}}else await this[_0x4458c9(0x278)](_0x413b82,_0x271894,-_0x3b9ec3,_0x4458c9(0x34b)+_0x3b9ec3+_0x4458c9(0x2f7),_0x2f2af6);}async[_0x9167c(0x343)](){const _0x997e8a=_0x9167c,_0x4bdfd5=await this['userEntity']['find']({'where':{'vipExpire':(0x0,typeorm_2[_0x997e8a(0x223)])((0x0,date_1[_0x997e8a(0x296)])()[_0x997e8a(0x385)]('d')[_0x997e8a(0x1dd)](),(0x0,date_1[_0x997e8a(0x296)])()[_0x997e8a(0x369)]('d')[_0x997e8a(0x1dd)]())}});if(_0x4bdfd5[_0x997e8a(0x366)])for(let _0x5952ba=0x0;_0x5952ba<_0x4bdfd5[_0x997e8a(0x366)];_0x5952ba++){const _0x1aa4ec=_0x4bdfd5[_0x5952ba];await this['redisCacheService'][_0x997e8a(0x2ce)]({'key':redisKey_constant_1[_0x997e8a(0x232)]+_0x1aa4ec['id'],'val':''},(0x0,date_1[_0x997e8a(0x296)])()['endOf']('d')['diff']((0x0,date_1[_0x997e8a(0x296)])(),'s'));}const _0x4a49f5=await this['userEntity'][_0x997e8a(0x1ad)]({'where':{'vipExpire':(0x0,typeorm_2[_0x997e8a(0x1e7)])((0x0,date_1['default'])()['toDate']())}});if(_0x4a49f5[_0x997e8a(0x366)]){const _0x528ae3=_0x4a49f5[_0x997e8a(0x2e2)](_0xa8330f=>_0xa8330f['id']);await this[_0x997e8a(0x2f4)][_0x997e8a(0x226)]({'id':(0x0,typeorm_2['In'])(_0x528ae3)},{'vipExpire':null,'vipLeavelId':0x0,'vipLeavelName':''});}}async[_0x9167c(0x2cf)](_0x1bddf0,_0x2da806,_0xb06dec){const _0x1da20d=_0x9167c,_0x24465a=(0x0,utils_1[_0x1da20d(0x325)])(this[_0x1da20d(0x332)]),_0x1a3a48=await this[_0x1da20d(0x2e9)][_0x1da20d(0x2a6)]({'where':{'userId':_0x1bddf0,'relId':_0x2da806,'relType':_0xb06dec,'saasId':_0x24465a}});if(_0x1a3a48)throw new common_1['HttpException'](_0x1da20d(0x28c),common_1[_0x1da20d(0x398)][_0x1da20d(0x2af)]);else await this[_0x1da20d(0x2e9)]['save']({'userId':_0x1bddf0,'relId':_0x2da806,'relType':_0xb06dec,'sassId':_0x24465a});}async[_0x9167c(0x1e3)](_0x190dbf,_0xa03160,_0x13fee1){const _0x4cbe0e=_0x9167c,_0x5b0f26=(0x0,utils_1['getReqSaasId'])(this[_0x4cbe0e(0x332)]),_0x35dc65=await this['userCollectEntity'][_0x4cbe0e(0x2a6)]({'where':{'userId':_0x190dbf,'relId':_0xa03160,'relType':_0x13fee1,'saasId':_0x5b0f26}});if(!_0x35dc65)throw new common_1[(_0x4cbe0e(0x336))](_0x4cbe0e(0x377),common_1['HttpStatus']['BAD_REQUEST']);else await this['userCollectEntity'][_0x4cbe0e(0x27f)]({'id':_0x35dc65['id']});}async[_0x9167c(0x318)](_0x53f2c2,_0x78b5f){const _0xe41a85=_0x9167c,_0x3a4ec0=(0x0,utils_1[_0xe41a85(0x325)])(this[_0xe41a85(0x332)]);_0x53f2c2['forEach'](_0x54a63f=>{const _0x2636b4=_0xe41a85,_0x19bdac=Number(_0x54a63f);this[_0x2636b4(0x2e9)][_0x2636b4(0x27f)]({'relId':_0x19bdac,'relType':_0x78b5f,'saasId':_0x3a4ec0});});}async[_0x9167c(0x39e)](_0x2c1e78,_0xc39e27,_0x175f4e,_0x36b15f){const _0x8a1e93=_0x9167c,_0x1f4248=(0x0,utils_1[_0x8a1e93(0x325)])(this[_0x8a1e93(0x332)]),[_0x4c0d31,_0x5e35df]=await this[_0x8a1e93(0x2e9)][_0x8a1e93(0x3a4)]({'where':{'userId':_0x175f4e,'relType':_0x36b15f,'saasId':_0x1f4248},'take':_0xc39e27,'skip':(_0x2c1e78-0x1)*_0xc39e27,'order':{'createdAt':_0x8a1e93(0x20e)}});return{'rows':_0x4c0d31,'count':_0x5e35df};}async[_0x9167c(0x20d)](_0x2bbd51,_0x1ff990,_0x1f5371){const _0x44821d=_0x9167c,_0x2c7cf6=(0x0,utils_1['getReqSaasId'])(this[_0x44821d(0x332)]);return await this['userCollectEntity']['find']({'where':{'userId':_0x1ff990,'relType':_0x1f5371,'saasId':_0x2c7cf6,'relId':(0x0,typeorm_2['In'])(_0x2bbd51)}});}async[_0x9167c(0x275)](_0x4ae794,_0x14c57a){const _0x428bc3=_0x9167c,_0x588b7e=(0x0,utils_1['getReqSaasId'])(this[_0x428bc3(0x332)]);return await this[_0x428bc3(0x2e9)][_0x428bc3(0x1ad)]({'where':{'relType':_0x14c57a,'saasId':_0x588b7e,'relId':(0x0,typeorm_2['In'])(_0x4ae794)}});}async[_0x9167c(0x23f)](_0x10e51f,_0x2183bc,_0x2cf69d=collectType_constant_1[_0x9167c(0x37b)][_0x9167c(0x34a)]){const _0xdcb950=_0x9167c;let _0x50c63f=Object[_0xdcb950(0x1b1)](_0x10e51f),_0x1f70d1=[];return _0x2183bc&&(_0x1f70d1=await this[_0xdcb950(0x20d)](_0x10e51f[_0xdcb950(0x2e2)](_0x3e406b=>_0x3e406b['id']),_0x2183bc,_0x2cf69d)),_0x50c63f['forEach'](_0x4787ec=>{const _0x145add=_0xdcb950;_0x1f70d1['find'](_0x2a6959=>_0x2a6959[_0x145add(0x1c1)]==_0x4787ec['id'])?_0x4787ec[_0x145add(0x295)]=!![]:_0x4787ec['isCollect']=![];}),_0x50c63f;}async[_0x9167c(0x365)](_0x17ef83,_0x2c5812,_0x3bd510=collectType_constant_1[_0x9167c(0x37b)][_0x9167c(0x34a)]){const _0x2ba302=_0x9167c;return this[_0x2ba302(0x23f)](_0x17ef83,_0x2c5812[_0x2ba302(0x2a4)]?.['id'],_0x3bd510);}async[_0x9167c(0x341)](_0x29b48b,_0x1570a7=collectType_constant_1[_0x9167c(0x37b)]['PPT']){const _0x514797=_0x9167c;let _0x22c024=Object[_0x514797(0x1b1)](_0x29b48b),_0x263e59=[];return _0x263e59=await this[_0x514797(0x275)](_0x29b48b[_0x514797(0x2e2)](_0x132778=>_0x132778['id']),_0x1570a7),_0x22c024[_0x514797(0x244)](_0x37b3a3=>{const _0x5dcc89=_0x514797;_0x37b3a3[_0x5dcc89(0x1db)]=_0x263e59[_0x5dcc89(0x3aa)](_0xb5e955=>_0xb5e955[_0x5dcc89(0x1c1)]==_0x37b3a3['id'])[_0x5dcc89(0x366)];}),_0x22c024;}[_0x9167c(0x1a0)](_0x3c45ce){const _0x3f42dc=_0x9167c;let _0x396db4=null;const _0x1c6ebd=_0x3c45ce[_0x3f42dc(0x3a1)][_0x3f42dc(0x370)];if(_0x1c6ebd&&_0x1c6ebd[_0x3f42dc(0x374)]('Bearer\x20')){const _0x4e4300=_0x1c6ebd[_0x3f42dc(0x327)](0x7);if(_0x4e4300)try{_0x396db4=jwt['verify'](_0x4e4300,process[_0x3f42dc(0x2d3)]['JWT_SECRET']);}catch(_0x286ebc){console[_0x3f42dc(0x30b)]('Failed\x20to\x20verify\x20JWT\x20token:',_0x3c45ce);}}return _0x396db4;}};UserService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x9167c(0x283)])('REDIS_SUBSCRIBER')),__param(0x1,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x9167c(0x246)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(saas_entity_1[_0x9167c(0x33f)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(role_entity_1['RoleEntity'])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(user_init_vip_entity_1[_0x9167c(0x372)])),__param(0x5,(0x0,typeorm_1[_0x9167c(0x2bc)])(userFavorite_entity_1[_0x9167c(0x1eb)])),__param(0x6,(0x0,typeorm_1[_0x9167c(0x2bc)])(userCollect_entity_1[_0x9167c(0x350)])),__param(0x7,(0x0,typeorm_1[_0x9167c(0x2bc)])(dict_entity_1[_0x9167c(0x21f)])),__metadata('design:paramtypes',[Object,typeorm_2[_0x9167c(0x247)],typeorm_2[_0x9167c(0x247)],typeorm_2[_0x9167c(0x247)],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x9167c(0x247)],typeorm_2['Repository'],nestjs_cls_1['ClsService'],mailer_1[_0x9167c(0x1bf)],redisCache_service_1[_0x9167c(0x2b1)],userBalance_service_1[_0x9167c(0x2dc)],globalConfig_service_1[_0x9167c(0x23c)],verification_service_1[_0x9167c(0x1d4)],cm_service_1[_0x9167c(0x2d2)],typeorm_2['Connection']])],UserService),exports[_0x9167c(0x2f9)]=UserService;