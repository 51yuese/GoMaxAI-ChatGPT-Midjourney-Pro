'use strict';const _0x912465=_0x5f4b;(function(_0x23f837,_0x498095){const _0x433f02=_0x5f4b,_0x4879d2=_0x23f837();while(!![]){try{const _0x6e0e66=-parseInt(_0x433f02(0x30d))/0x1+parseInt(_0x433f02(0x177))/0x2+parseInt(_0x433f02(0x151))/0x3*(parseInt(_0x433f02(0x24c))/0x4)+-parseInt(_0x433f02(0x2a0))/0x5+-parseInt(_0x433f02(0x19c))/0x6*(parseInt(_0x433f02(0x1a4))/0x7)+-parseInt(_0x433f02(0x18f))/0x8+-parseInt(_0x433f02(0x1de))/0x9*(-parseInt(_0x433f02(0x1e5))/0xa);if(_0x6e0e66===_0x498095)break;else _0x4879d2['push'](_0x4879d2['shift']());}catch(_0x48942d){_0x4879d2['push'](_0x4879d2['shift']());}}}(_0x5d40,0xdd70e));var __decorate=this&&this['__decorate']||function(_0x390bf8,_0x4ff2ce,_0x761ba,_0x47fc3){const _0x5bb9cc=_0x5f4b;var _0x361eb2=arguments['length'],_0x8d6867=_0x361eb2<0x3?_0x4ff2ce:_0x47fc3===null?_0x47fc3=Object['getOwnPropertyDescriptor'](_0x4ff2ce,_0x761ba):_0x47fc3,_0x29b49f;if(typeof Reflect==='object'&&typeof Reflect[_0x5bb9cc(0x1d9)]==='function')_0x8d6867=Reflect[_0x5bb9cc(0x1d9)](_0x390bf8,_0x4ff2ce,_0x761ba,_0x47fc3);else{for(var _0x4e1ec0=_0x390bf8['length']-0x1;_0x4e1ec0>=0x0;_0x4e1ec0--)if(_0x29b49f=_0x390bf8[_0x4e1ec0])_0x8d6867=(_0x361eb2<0x3?_0x29b49f(_0x8d6867):_0x361eb2>0x3?_0x29b49f(_0x4ff2ce,_0x761ba,_0x8d6867):_0x29b49f(_0x4ff2ce,_0x761ba))||_0x8d6867;}return _0x361eb2>0x3&&_0x8d6867&&Object['defineProperty'](_0x4ff2ce,_0x761ba,_0x8d6867),_0x8d6867;},__metadata=this&&this['__metadata']||function(_0xc495a7,_0x41c348){const _0x12de3e=_0x5f4b;if(typeof Reflect===_0x12de3e(0x2ed)&&typeof Reflect['metadata']==='function')return Reflect[_0x12de3e(0x1e1)](_0xc495a7,_0x41c348);},__param=this&&this[_0x912465(0x247)]||function(_0x4f8177,_0x24b80a){return function(_0x4e26a3,_0xf95bfc){_0x24b80a(_0x4e26a3,_0xf95bfc,_0x4f8177);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['UserService']=void 0x0;const globalConfig_service_1=require(_0x912465(0x29b)),user_constant_1=require(_0x912465(0x25d)),mailer_1=require('@nestjs-modules/mailer'),verification_service_1=require('./../verification/verification.service'),common_1=require(_0x912465(0x28a)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x912465(0x146)),user_entity_1=require(_0x912465(0x1ec)),bcrypt=require(_0x912465(0x28d)),_=require(_0x912465(0x330)),jwt=require(_0x912465(0x12f)),verification_constant_1=require(_0x912465(0x1a8)),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require(_0x912465(0x273)),balance_constant_1=require('../../common/constants/balance.constant'),class_validator_1=require(_0x912465(0x30e)),redisKey_constant_1=require('../../common/constants/redisKey.constant'),redisCache_service_1=require(_0x912465(0x13a)),model_constant_1=require(_0x912465(0x2e7)),midjourney_constant_1=require(_0x912465(0x2ce)),user_init_vip_entity_1=require('./user_init_vip.entity'),axios_1=require(_0x912465(0x192)),date_1=require(_0x912465(0x1a1)),saas_entity_1=require('./saas.entity'),role_entity_1=require(_0x912465(0x24b)),store_1=require('../../common/store'),nestjs_cls_1=require(_0x912465(0x165)),Role_constant_1=require(_0x912465(0x1b5)),userFavorite_entity_1=require('./userFavorite.entity'),userCollect_entity_1=require(_0x912465(0x1cb)),collectType_constant_1=require(_0x912465(0x224)),cm_service_1=require(_0x912465(0x2c8));function _0x5f4b(_0x4566a6,_0x38a0c3){const _0x5d40f=_0x5d40();return _0x5f4b=function(_0x5f4ba2,_0x33e0c7){_0x5f4ba2=_0x5f4ba2-0x12c;let _0x1eafc0=_0x5d40f[_0x5f4ba2];return _0x1eafc0;},_0x5f4b(_0x4566a6,_0x38a0c3);}let UserService=class UserService{constructor(_0x517749,_0x3f7bb1,_0x197be5,_0x5947d8,_0x2bee64,_0x3340d6,_0x393a8f,_0x34be2d,_0x17fef9,_0x835711,_0xdba675,_0x28f272,_0x43fc2a,_0x4aa1da,_0x4a6553){const _0x1eca0d=_0x912465;this[_0x1eca0d(0x18a)]=_0x517749,this['userEntity']=_0x3f7bb1,this[_0x1eca0d(0x1f8)]=_0x197be5,this[_0x1eca0d(0x306)]=_0x5947d8,this['userInitVipEntity']=_0x2bee64,this['userFavoriteEntity']=_0x3340d6,this[_0x1eca0d(0x282)]=_0x393a8f,this[_0x1eca0d(0x314)]=_0x34be2d,this[_0x1eca0d(0x32c)]=_0x17fef9,this['redisCacheService']=_0x835711,this['userBalanceService']=_0xdba675,this['globalConfigService']=_0x28f272,this[_0x1eca0d(0x1ce)]=_0x43fc2a,this['configService']=_0x4aa1da,this[_0x1eca0d(0x2b7)]=_0x4a6553;}[_0x912465(0x2a9)](){const _0x45557a=_0x912465;console[_0x45557a(0x1b1)](_0x45557a(0x322)),this[_0x45557a(0x2b7)][_0x45557a(0x176)](_0x45557a(0x1f7)+Role_constant_1[_0x45557a(0x2cd)][_0x45557a(0x13e)]+_0x45557a(0x2b8)+Role_constant_1[_0x45557a(0x2cd)]['AGENT']+'\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27'+Role_constant_1[_0x45557a(0x2cd)][_0x45557a(0x1ff)]+'\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),this[_0x45557a(0x167)](),this[_0x45557a(0x18a)][_0x45557a(0x231)](_0x45557a(0x2aa),async _0x5e55bc=>{const _0x478c8b=_0x45557a;if(_0x5e55bc[_0x478c8b(0x297)](redisKey_constant_1['VIP_EXPIRE'])){const _0x2ae8fb=_0x5e55bc[_0x478c8b(0x1c9)](redisKey_constant_1[_0x478c8b(0x256)],'');this[_0x478c8b(0x1ee)][_0x478c8b(0x173)]({'id':Number(_0x2ae8fb)},{'vipExpire':null});}});}async[_0x912465(0x167)](){const _0xcb890a=_0x912465,_0x3d808b=await this[_0xcb890a(0x1f8)][_0xcb890a(0x1eb)]({'where':{'deleteFlag':0x0}});store_1[_0xcb890a(0x239)][_0xcb890a(0x14f)](),_0x3d808b[_0xcb890a(0x15e)](_0x1d3a5f=>store_1[_0xcb890a(0x239)][_0xcb890a(0x20f)](_0x1d3a5f[_0xcb890a(0x18e)],_0x1d3a5f['id'])),store_1[_0xcb890a(0x239)]['set'](process['env'][_0xcb890a(0x1ba)],0x0);}[_0x912465(0x2f5)](){const _0x161532=_0x912465;return this[_0x161532(0x1ee)];}async[_0x912465(0x31a)](_0x3713f8){if(!_0x3713f8['length'])return[];return this['saasEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x3713f8)}});}async[_0x912465(0x142)](_0x582035){const _0xdf3e99=_0x912465,{page:page=0x1,size:size=0x14,keyword:_0x47baa9}=_0x582035;let _0x1540c9;_0x47baa9?_0x1540c9=[{'deleteFlag':0x0,'name':(0x0,typeorm_2[_0xdf3e99(0x294)])('%'+_0x47baa9+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2[_0xdf3e99(0x294)])('%'+_0x47baa9+'%')}]:_0x1540c9={'deleteFlag':0x0};const [_0x2ba8bd,_0x38b916]=await this['saasEntity'][_0xdf3e99(0x21c)]({'where':_0x1540c9,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0xdf3e99(0x1ab)}});if(!_0x2ba8bd['length'])return{'rows':[],'count':_0x38b916};const _0x3cc9dd=_0x2ba8bd[_0xdf3e99(0x272)](_0x352e4f=>_0x352e4f['id']),_0x5246aa=new Map(),_0x450841=await this[_0xdf3e99(0x1ee)][_0xdf3e99(0x1eb)]({'where':{'saasId':(0x0,typeorm_2['In'])(_0x3cc9dd),'role':Role_constant_1[_0xdf3e99(0x2cd)][_0xdf3e99(0x307)]}});_0x450841[_0xdf3e99(0x15e)](_0x50a319=>{const _0x67a350=_0xdf3e99;_0x5246aa[_0x67a350(0x20f)](_0x50a319[_0x67a350(0x164)],_0x50a319);});const _0x279e01=new Map(),_0x251c2b=await this[_0xdf3e99(0x2b7)]['query'](_0xdf3e99(0x220));_0x251c2b[_0xdf3e99(0x15e)](_0x486214=>_0x279e01[_0xdf3e99(0x20f)](_0x486214[_0xdf3e99(0x164)],_0x486214[_0xdf3e99(0x2bc)]));const _0x151ca2=_0x2ba8bd[_0xdf3e99(0x272)](_0x50b7d6=>{const _0x120713=_0xdf3e99;let _0x5a026b=null,_0x2dacb4=null,_0x4b1df0=null,_0xcfd1c9=null;const _0x271730=_0x5246aa[_0x120713(0x2fd)](_0x50b7d6['id']);return _0x271730&&(_0x5a026b=_0x271730[_0x120713(0x16a)],_0x2dacb4=_0x271730[_0x120713(0x2af)],_0x4b1df0=_0x271730[_0x120713(0x19a)],_0xcfd1c9=_0x271730[_0x120713(0x17e)]),{..._0x50b7d6,'username':_0x5a026b,'nickname':_0x2dacb4,'phone':_0x4b1df0,'email':_0xcfd1c9,'userCount':_0x279e01[_0x120713(0x2fd)](_0x50b7d6['id'])||0x0};});return{'rows':_0x151ca2,'count':_0x38b916};}async[_0x912465(0x2ea)](_0xd22bfc){const _0x26010e=_0x912465;return this[_0x26010e(0x1f8)][_0x26010e(0x2db)]({'where':{'id':_0xd22bfc}});}async[_0x912465(0x1e3)](_0x198f86){const _0x2867f9=_0x912465,_0x5634d5=(0x0,utils_1['getReqSaasId'])(this[_0x2867f9(0x314)]);if(_0x5634d5!==0x0)throw new common_1[(_0x2867f9(0x320))](_0x2867f9(0x219),common_1['HttpStatus']['FORBIDDEN']);return await this[_0x2867f9(0x1f8)]['save'](_0x198f86),this[_0x2867f9(0x167)](),!![];}async['saasUpdate'](_0x2f20aa){const _0x11f201=_0x912465,_0x55363f=(0x0,utils_1[_0x11f201(0x1e6)])(this[_0x11f201(0x314)]);return await this[_0x11f201(0x1f8)][_0x11f201(0x29a)]({..._0x2f20aa,'id':_0x55363f}),!![];}async['saasDel'](_0x14e17c){const _0x13413e=_0x912465;if(!_0x14e17c['ids']||!_0x14e17c[_0x13413e(0x262)][_0x13413e(0x304)])return!![];return await this[_0x13413e(0x1f8)][_0x13413e(0x173)]({'id':(0x0,typeorm_2['In'])(_0x14e17c[_0x13413e(0x262)])},{'deleteFlag':0x1}),!![];}async[_0x912465(0x24e)](_0x5c8805,_0x4df9db){const _0x3d55b8=_0x912465,_0x5e45f8=await(0x0,utils_1['getReqSaasId'])(this[_0x3d55b8(0x314)]),{page:page=0x1,size:size=0x14,keyword:_0x4d2576}=_0x4df9db;let _0x267a03=_0x3d55b8(0x2fc)+_0x5e45f8+_0x3d55b8(0x216)+Role_constant_1[_0x3d55b8(0x2cd)][_0x3d55b8(0x1ff)]+_0x3d55b8(0x12c);_0x4d2576&&(_0x267a03=_0x3d55b8(0x135)+_0x5e45f8+'\x20AND\x20(\x20`name`\x20LIKE\x20\x27%'+_0x4d2576+_0x3d55b8(0x16e)+_0x4d2576+'%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27'+Role_constant_1[_0x3d55b8(0x2cd)]['VIEWER']+_0x3d55b8(0x1bd)+_0x4d2576+_0x3d55b8(0x16e)+_0x4d2576+_0x3d55b8(0x1da));const _0x1e2fdd=await this[_0x3d55b8(0x2b7)][_0x3d55b8(0x176)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x267a03+_0x3d55b8(0x198)),_0x53574e=await this[_0x3d55b8(0x2b7)][_0x3d55b8(0x176)](_0x3d55b8(0x23d)+_0x267a03+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20'+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x3d55b8(0x198)),_0x2fbe66=_0x53574e[_0x3d55b8(0x272)](_0x5c09df=>_0x5c09df['id']);if(_0x2fbe66[_0x3d55b8(0x304)]){const _0x4afec9=await this[_0x3d55b8(0x1f8)][_0x3d55b8(0x2db)]({'where':{'id':_0x5c8805[_0x3d55b8(0x26e)][_0x3d55b8(0x164)]}}),_0x357539=new Map(),_0x9cb592=await this[_0x3d55b8(0x2b7)][_0x3d55b8(0x176)](_0x3d55b8(0x302));_0x9cb592[_0x3d55b8(0x15e)](_0x3b3eb3=>_0x357539[_0x3d55b8(0x20f)](_0x3b3eb3['role'],_0x3b3eb3['count'])),_0x53574e[_0x3d55b8(0x15e)](_0x14ac99=>{const _0x7044fc=_0x3d55b8;_0x14ac99[_0x7044fc(0x30c)]=_0x4afec9?.[_0x7044fc(0x2d0)]||'平台',_0x14ac99['userCount']=_0x357539[_0x7044fc(0x2fd)](_0x14ac99['code'])||0x0;});}return{'rows':_0x53574e,'count':Number(_0x1e2fdd[0x0]?.[_0x3d55b8(0x2bc)]||0x0)};}async[_0x912465(0x1d3)](_0x529499,_0x17cacc){const _0x418076=_0x912465,_0x50b3c2=await(0x0,utils_1['getReqSaasId'])(this[_0x418076(0x314)]);if([Role_constant_1[_0x418076(0x2cd)]['SUPER'][_0x418076(0x311)](),Role_constant_1[_0x418076(0x2cd)][_0x418076(0x307)][_0x418076(0x311)](),Role_constant_1[_0x418076(0x2cd)][_0x418076(0x1ff)][_0x418076(0x311)]()][_0x418076(0x28b)](_0x17cacc['code'])&&_0x50b3c2!==0x0)throw new common_1[(_0x418076(0x320))](_0x418076(0x144),common_1[_0x418076(0x22f)][_0x418076(0x1d7)]);return await this[_0x418076(0x306)][_0x418076(0x29a)]({..._0x17cacc,'saasId':_0x50b3c2,'disabled':_0x17cacc[_0x418076(0x1b3)]??0x0}),!![];}async[_0x912465(0x326)](_0x4fb2b6,_0x1fa68b){const _0x2d2a0a=_0x912465,_0x4904b8=await(0x0,utils_1[_0x2d2a0a(0x1e6)])(this[_0x2d2a0a(0x314)]);if(!_0x1fa68b[_0x2d2a0a(0x262)]||!_0x1fa68b[_0x2d2a0a(0x262)][_0x2d2a0a(0x304)])return!![];const _0x5167e2=await this[_0x2d2a0a(0x306)][_0x2d2a0a(0x1eb)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1fa68b[_0x2d2a0a(0x262)]),'saasId':_0x4904b8}});if(!_0x5167e2[_0x2d2a0a(0x304)])return!![];const _0xf97a1d=_0x5167e2[_0x2d2a0a(0x272)](_0x3d796d=>_0x3d796d[_0x2d2a0a(0x27a)]),_0x2f9fe4=await this[_0x2d2a0a(0x1ee)][_0x2d2a0a(0x2bc)]({'where':{'role':(0x0,typeorm_2['In'])(_0xf97a1d),'saasId':_0x4904b8}});if(_0x2f9fe4>0x0)throw new common_1[(_0x2d2a0a(0x320))](_0x2d2a0a(0x244),common_1[_0x2d2a0a(0x22f)][_0x2d2a0a(0x1d7)]);return await this[_0x2d2a0a(0x306)][_0x2d2a0a(0x252)]({'id':(0x0,typeorm_2['In'])(_0x1fa68b[_0x2d2a0a(0x262)])}),!![];}async[_0x912465(0x189)](_0x281606){const _0x7db06c=_0x912465;if(!_0x281606['length'])return[];const _0x40869f=await this['userEntity'][_0x7db06c(0x1eb)]({'where':{'id':(0x0,typeorm_2['In'])(_0x281606)}});return _0x40869f;}async[_0x912465(0x222)](_0x3da147,_0x3f601f){const _0x42afe3=_0x912465,{username:_0x3c7f90,email:_0x3ca8e9,password:_0x49044f,invitedBy:_0x2176b6,client:client=0x0}=_0x3da147;if(_0x2176b6){const _0x3288cd=await this[_0x42afe3(0x1ee)][_0x42afe3(0x2db)]({'where':{'inviteCode':_0x2176b6}});if(!_0x3288cd)throw new common_1[(_0x42afe3(0x320))](_0x42afe3(0x181),common_1[_0x42afe3(0x22f)][_0x42afe3(0x1d7)]);}const _0x51e567=[{'username':_0x3c7f90},{'email':_0x3ca8e9}],_0x577d7d=await this[_0x42afe3(0x1ee)][_0x42afe3(0x2db)]({'where':_0x51e567});if(_0x577d7d&&_0x577d7d[_0x42afe3(0x13c)]!==user_constant_1[_0x42afe3(0x303)][_0x42afe3(0x1c8)])throw new common_1[(_0x42afe3(0x320))](_0x42afe3(0x212),common_1[_0x42afe3(0x22f)][_0x42afe3(0x1d7)]);try{const _0xc66748=_[_0x42afe3(0x172)](_0x3da147),_0xd51852=bcrypt[_0x42afe3(0x2c6)](_0x49044f,0xa),_0x5b7547=(0x0,utils_1['getClientIp'])(_0x3f601f);_0xc66748[_0x42afe3(0x308)]=_0xd51852,_0xc66748[_0x42afe3(0x1e8)]=_0x5b7547,_0xc66748[_0x42afe3(0x1be)]=client;let _0x173dce;if(!_0x577d7d){const _0x590298=await this[_0x42afe3(0x1af)]['getConfigByKeys']([_0x42afe3(0x2ad)]);_0xc66748[_0x42afe3(0x131)]=_0x590298,_0x173dce=await this['userEntity']['save'](_0xc66748);}else _0x173dce=_0x577d7d;const _0x5817fe=await this[_0x42afe3(0x1af)][_0x42afe3(0x2f8)]([_0x42afe3(0x26b),_0x42afe3(0x2f2),'registerVerifyEmailTitle',_0x42afe3(0x18d),'registerVerifyEmailFrom',_0x42afe3(0x2c5)]),_0x541cd8=_0x5817fe[_0x42afe3(0x26b)]?Number(_0x5817fe['isVerifyEmail']):0x1;if(_0x541cd8){const _0xb57c74=_0x5817fe[_0x42afe3(0x2c5)]?Number(_0x5817fe[_0x42afe3(0x2c5)]):0x1e*0x3c,_0x1ae618=await this[_0x42afe3(0x1ce)][_0x42afe3(0x2dd)](_0x173dce,verification_constant_1['VerificationEnum'][_0x42afe3(0x1c3)],_0xb57c74),{code:_0x50673d,email:_0x285aad,id:_0x1a2b1c}=_0x1ae618,{registerVerifyEmailFrom:_0x966554}=_0x5817fe;await this[_0x42afe3(0x32c)]['sendMail']({'to':_0x285aad,'subject':'来自'+_0x966554+_0x42afe3(0x2ec),'template':'register','context':{'baseUrl':_0x5817fe[_0x42afe3(0x2f2)],'code':_0x50673d,'id':_0x1a2b1c,..._0x5817fe}});}else{const {id:_0x711a93,invitedBy:_0xb83842}=_0x173dce;await this[_0x42afe3(0x185)](_0x711a93,user_constant_1['UserStatusEnum']['ACTIVE']);let _0x4222a1;_0xb83842&&(_0x4222a1=await this['qureyUserInfoByInviteCode'](_0xb83842)),await this[_0x42afe3(0x234)](_0x173dce,_0x4222a1);}return _0x173dce;}catch(_0x149904){console[_0x42afe3(0x1b1)](_0x42afe3(0x26a),_0x149904);throw _0x149904;}}async['verifyUserCredentials'](_0x5f1bc7){const _0x599020=_0x912465,{username:_0x3d4a97,password:_0x2979cb,uid:uid=0x0,phone:_0x24bec0}=_0x5f1bc7;let _0x4b5ac6=null;if(uid>0x0){_0x4b5ac6=await this[_0x599020(0x1ee)][_0x599020(0x2db)]({'where':{'id':uid}});if(!_0x4b5ac6)throw new common_1[(_0x599020(0x320))](_0x599020(0x2f0),common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);if(!bcrypt[_0x599020(0x1fb)](_0x2979cb,_0x4b5ac6['password']))throw new common_1[(_0x599020(0x320))](_0x599020(0x171),common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);}if(_0x3d4a97&&_0x2979cb){const _0x5dae56=[{'username':_0x3d4a97},{'email':_0x3d4a97}];_0x4b5ac6=await this[_0x599020(0x1ee)]['findOne']({'where':_0x5dae56});if(!_0x4b5ac6)throw new common_1[(_0x599020(0x320))](_0x599020(0x2f0),common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);if(!bcrypt['compareSync'](_0x2979cb,_0x4b5ac6[_0x599020(0x308)]))throw new common_1['HttpException'](_0x599020(0x171),common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);}if(_0x24bec0&&_0x2979cb){const _0x4caa22=[{'phone':_0x24bec0}];_0x4b5ac6=await this[_0x599020(0x1ee)]['findOne']({'where':_0x4caa22});if(!_0x4b5ac6)throw new common_1[(_0x599020(0x320))](_0x599020(0x2f0),common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);if(!bcrypt[_0x599020(0x1fb)](_0x2979cb,_0x4b5ac6[_0x599020(0x308)]))throw new common_1['HttpException']('当前密码错误！',common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);}if(!_0x4b5ac6)throw new common_1[(_0x599020(0x320))]('当前账户不存在！',common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);if(_0x4b5ac6[_0x599020(0x13c)]!==user_constant_1[_0x599020(0x303)][_0x599020(0x1d0)])throw new common_1[(_0x599020(0x320))](user_constant_1[_0x599020(0x1ed)][_0x4b5ac6[_0x599020(0x13c)]],common_1[_0x599020(0x22f)][_0x599020(0x1d7)]);if(_0x4b5ac6[_0x599020(0x16a)]&&!_0x4b5ac6['lastLoginIp']){const _0x2eb832=await this[_0x599020(0x170)][_0x599020(0x2db)]({'where':{'username':_0x4b5ac6[_0x599020(0x16a)]}});_0x2eb832&&await this['connection']['transaction'](async()=>{const _0x5efe4d=_0x599020;_0x2eb832[_0x5efe4d(0x201)]===-0x1?_0x4b5ac6['lifetimeVip']=0x1:_0x4b5ac6[_0x5efe4d(0x184)]=(0x0,date_1[_0x5efe4d(0x1d1)])()[_0x5efe4d(0x229)](_0x2eb832[_0x5efe4d(0x201)],_0x5efe4d(0x2c1))[_0x5efe4d(0x2e8)](),_0x4b5ac6=await this[_0x5efe4d(0x1ee)][_0x5efe4d(0x29a)](_0x4b5ac6),await this[_0x5efe4d(0x170)][_0x5efe4d(0x252)]({'id':_0x2eb832['id']});});}return _0x4b5ac6;}async[_0x912465(0x1b2)](_0x570545,_0x584f82){const _0x13f722=_0x912465,_0x3587ef=await this[_0x13f722(0x1ee)][_0x13f722(0x2db)]({'where':{'id':_0x570545}});return bcrypt[_0x13f722(0x1fb)](_0x584f82,_0x3587ef[_0x13f722(0x308)]);}async[_0x912465(0x185)](_0xfedae0,_0x5bc6fa){const _0x45487b=_0x912465,_0x90fe5b=await this[_0x45487b(0x1ee)][_0x45487b(0x173)]({'id':_0xfedae0},{'status':_0x5bc6fa});return _0x90fe5b[_0x45487b(0x2ab)]>0x0;}async['getUserStatus'](_0x42e129){const _0xf358bb=_0x912465,_0x39491b=await this[_0xf358bb(0x1ee)][_0xf358bb(0x2db)]({'where':{'id':_0x42e129}});return _0x39491b[_0xf358bb(0x13c)];}async[_0x912465(0x251)](_0x346bec){const _0x3dfcf0=_0x912465;return await this['userEntity'][_0x3dfcf0(0x2db)]({'where':{'id':_0x346bec}});}async[_0x912465(0x194)](_0x4c5ffb){const _0x403f91=_0x912465;return await this[_0x403f91(0x1ee)][_0x403f91(0x324)]({'id':(0x0,typeorm_2['In'])(_0x4c5ffb)});}async[_0x912465(0x1b8)](_0xe9b164){const _0x5d61b7=_0x912465;return await this[_0x5d61b7(0x1ee)][_0x5d61b7(0x2db)]({'where':{'username':_0xe9b164}});}async[_0x912465(0x319)](_0x346d0c,_0x130442,_0x5a0e59){const _0x18abc4=_0x912465;return await this[_0x18abc4(0x1ee)][_0x18abc4(0x173)](_0x346d0c,{'openId':_0x130442,'unionid':_0x5a0e59});}async[_0x912465(0x22b)](_0x1d45d2,_0x257910,_0x114296){const _0x322be6=_0x912465;return await this[_0x322be6(0x1ee)][_0x322be6(0x173)](_0x1d45d2,{'miniOpenId':_0x257910,'unionid':_0x114296});}async['updateUserAppOpenId'](_0x1cc274,_0xb55de6,_0x4f7e75){const _0x486e1f=_0x912465;return await this[_0x486e1f(0x1ee)]['update'](_0x1cc274,{'weAppOpenId':_0xb55de6,'unionid':_0x4f7e75});}async[_0x912465(0x153)](_0x14b3c1){const _0x26fe60=_0x912465,{id:_0xf9660c,username:_0x1df631,password:_0x3e4d11}=_0x14b3c1;return await this[_0x26fe60(0x1ee)][_0x26fe60(0x173)](_0xf9660c,{'username':_0x1df631,'password':_0x3e4d11});}async['queryOneUserInfo'](_0x574518){const _0x38d295=_0x912465;return await this[_0x38d295(0x1ee)][_0x38d295(0x2db)]({'where':{'id':_0x574518}});}async[_0x912465(0x200)](_0x32373f){const _0x1fa0f7=_0x912465,{id:_0x232d3e,role:_0x28ee42}=_0x32373f;if(_0x28ee42===_0x1fa0f7(0x1ae))return!![];const _0x5babcd=await this[_0x1fa0f7(0x1ee)][_0x1fa0f7(0x2db)]({'where':{'id':_0x232d3e}});if(!_0x5babcd)throw new common_1[(_0x1fa0f7(0x320))](_0x1fa0f7(0x240),common_1[_0x1fa0f7(0x22f)][_0x1fa0f7(0x155)]);if(_0x5babcd[_0x1fa0f7(0x13c)]===user_constant_1['UserStatusEnum']['BLACKLISTED'])throw new common_1[(_0x1fa0f7(0x320))](_0x1fa0f7(0x20a),common_1[_0x1fa0f7(0x22f)][_0x1fa0f7(0x1d7)]);if(_0x5babcd[_0x1fa0f7(0x13c)]===user_constant_1[_0x1fa0f7(0x303)][_0x1fa0f7(0x1c4)])throw new common_1[(_0x1fa0f7(0x320))](_0x1fa0f7(0x20b),common_1[_0x1fa0f7(0x22f)]['BAD_REQUEST']);}async[_0x912465(0x2f6)](_0x3e695d){const _0x3f928a=_0x912465;return await this[_0x3f928a(0x1ee)]['findOne']({'where':{'id':_0x3e695d}});}[_0x912465(0x317)](_0x551362){const _0x24beae=_0x912465;return this[_0x24beae(0x1ee)][_0x24beae(0x1eb)]({'where':{'id':(0x0,typeorm_2['In'])(_0x551362)}});}async[_0x912465(0x249)](_0x3904af){const _0x6cda13=_0x912465;return this[_0x6cda13(0x1ee)]['findOne']({'where':{'inviteCode':_0x3904af}});}async['getUserOpenId'](_0x34897f){const _0x1724e5=_0x912465,_0x281ac9=(0x0,utils_1[_0x1724e5(0x1e6)])(this[_0x1724e5(0x314)]);return await this[_0x1724e5(0x1ee)][_0x1724e5(0x2db)]({'where':{'openId':_0x34897f,'saasId':_0x281ac9}});}async[_0x912465(0x29f)](_0x3bc157){const _0x14f1da=_0x912465,_0x5ad855=(0x0,utils_1[_0x14f1da(0x1e6)])(this[_0x14f1da(0x314)]);return await this['userEntity'][_0x14f1da(0x2db)]({'where':{'unionid':_0x3bc157,'saasId':_0x5ad855}});}async[_0x912465(0x25b)](_0x8c77c0){const _0x56ead6=_0x912465;return this[_0x56ead6(0x1ee)][_0x56ead6(0x2bc)]({'where':{'invitedBy':_0x8c77c0}});}async['updateInfo'](_0xee80f6,_0x246823){const _0x1be087=_0x912465,{id:_0x466743}=_0x246823['user'],_0x35dd14=await this[_0x1be087(0x1ee)][_0x1be087(0x2db)]({'where':{'id':_0x466743}});if(!_0x35dd14)throw new common_1[(_0x1be087(0x320))](_0x1be087(0x204),common_1[_0x1be087(0x22f)][_0x1be087(0x1d7)]);if(_0xee80f6[_0x1be087(0x16a)]&&_0x35dd14[_0x1be087(0x16a)]===_0xee80f6[_0x1be087(0x16a)])throw new common_1[(_0x1be087(0x320))]('没有变更，无需更改！',common_1[_0x1be087(0x22f)][_0x1be087(0x1d7)]);if(_0xee80f6[_0x1be087(0x16a)]){const _0x26e0c4=await this[_0x1be087(0x1ee)]['findOne']({'where':{'username':_0xee80f6[_0x1be087(0x16a)],'id':(0x0,typeorm_2[_0x1be087(0x268)])(_0x466743)}});if(_0x26e0c4)throw new common_1[(_0x1be087(0x320))]('用户名已存在！',common_1[_0x1be087(0x22f)][_0x1be087(0x1d7)]);}const _0x132a37=await this[_0x1be087(0x1ee)]['update']({'id':_0x466743},_0xee80f6);if(_0x132a37['affected']<=0x0)throw new common_1[(_0x1be087(0x320))](_0x1be087(0x130),common_1[_0x1be087(0x22f)][_0x1be087(0x1d7)]);return _0x1be087(0x2bb);}async[_0x912465(0x16c)](_0x56c353,_0x11bb4e){const _0x256109=_0x912465,_0x2fcb72=bcrypt['hashSync'](_0x11bb4e,0xa),_0x36951c=await this[_0x256109(0x1ee)][_0x256109(0x173)]({'id':_0x56c353},{'password':_0x2fcb72});if(_0x36951c[_0x256109(0x2ab)]<=0x0)throw new common_1[(_0x256109(0x320))](_0x256109(0x26c),common_1[_0x256109(0x22f)][_0x256109(0x1d7)]);}async[_0x912465(0x1ea)](_0x3f16f8,_0x5db9fb){const _0x273cf6=_0x912465;try{const _0x2c3c9e=await this['userFavoriteEntity'][_0x273cf6(0x2db)]({'where':{'userId':_0x3f16f8[_0x273cf6(0x26e)]['id'],'relateId':_0x5db9fb[_0x273cf6(0x1c6)],'relateType':_0x5db9fb[_0x273cf6(0x2ba)]}});return _0x2c3c9e?await this['userFavoriteEntity'][_0x273cf6(0x252)]({'id':_0x2c3c9e['id']}):await this[_0x273cf6(0x235)][_0x273cf6(0x29a)]({'userId':_0x3f16f8[_0x273cf6(0x26e)]['id'],'relateId':_0x5db9fb[_0x273cf6(0x1c6)],'relateType':_0x5db9fb['relateType']}),!![];}catch(_0x48dc71){throw new common_1['HttpException'](_0x48dc71['message'],common_1[_0x273cf6(0x22f)]['BAD_REQUEST']);}}async[_0x912465(0x2a3)](_0x2caeed,_0x4600dd,_0x11cd38){const _0x3c71b5=_0x912465;return this['userFavoriteEntity'][_0x3c71b5(0x1eb)]({'where':{'userId':_0x2caeed,'relateType':_0x4600dd,'relateId':(0x0,typeorm_2['In'])(_0x11cd38)}});}async[_0x912465(0x298)](_0x3caf97){const _0x218159=_0x912465,{id:_0x263b30}=_0x3caf97[_0x218159(0x26e)],_0x23b6a8=await this[_0x218159(0x1ee)]['findOne']({'where':{'id':_0x263b30}});if(!_0x23b6a8||_0x23b6a8[_0x218159(0x289)])throw new common_1[(_0x218159(0x320))](_0x218159(0x221),common_1[_0x218159(0x22f)][_0x218159(0x1d7)]);const _0x2cad6a=(0x0,utils_1['generateRandomString'])(),_0x5092e2=await this[_0x218159(0x1ee)][_0x218159(0x2db)]({'where':{'inviteCode':_0x2cad6a}});if(_0x5092e2)throw new common_1['HttpException'](_0x218159(0x160),common_1['HttpStatus'][_0x218159(0x1d7)]);const _0x1a56fd=await this[_0x218159(0x1ee)][_0x218159(0x173)]({'id':_0x263b30},{'inviteCode':_0x2cad6a});if(_0x1a56fd['affected']<=0x0)throw new common_1[(_0x218159(0x320))](_0x218159(0x160),common_1['HttpStatus'][_0x218159(0x1d7)]);return _0x2cad6a;}async[_0x912465(0x257)](_0x209540,_0x584be0){const _0x50734a=_0x912465;try{const {id:_0x3d25b9}=_0x209540[_0x50734a(0x26e)],{page:page=0x1,size:size=0xa}=_0x584be0,_0x4046b8=await this[_0x50734a(0x1ee)][_0x50734a(0x2db)]({'where':{'id':_0x3d25b9}}),{inviteCode:_0x3d2a25}=_0x4046b8;if(!_0x3d2a25)return[];const [_0x110ce4,_0x1d3139]=await this[_0x50734a(0x1ee)][_0x50734a(0x21c)]({'where':{'inviteCode':_0x3d2a25},'order':{'id':_0x50734a(0x1ab)},'select':[_0x50734a(0x16a),_0x50734a(0x17e),'createdAt','status','avatar'],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x50734a(0x329)])(_0x110ce4)[_0x50734a(0x272)](_0x64386e=>{const _0xd03e33=_0x50734a;return _0x64386e[_0xd03e33(0x17e)]=(0x0,utils_1['maskEmail'])(_0x64386e[_0xd03e33(0x17e)]),_0x64386e;}),{'rows':_0x110ce4,'count':_0x1d3139};}catch(_0x3d07e8){console[_0x50734a(0x1b1)](_0x50734a(0x26a),_0x3d07e8);throw new common_1[(_0x50734a(0x320))]('获取邀请记录失败！',common_1[_0x50734a(0x22f)][_0x50734a(0x1d7)]);}}async[_0x912465(0x15c)](_0xf4f6f4,_0x15e188,_0x42c206){const _0x1e607a=_0x912465,_0x30432e=(0x0,utils_1[_0x1e607a(0x1e6)])(this[_0x1e607a(0x314)]),{page:page=0x1,size:size=0x14,startTime:_0x4b4284,endTime:_0x328f36,saasId:_0x3bdb8d,keyword:_0x4dd412,inviterKeyword:_0x3dbf30}=_0x15e188,_0x5d791f=_0x1e607a(0x13b)+(_0x42c206?_0x1e607a(0x32a)+_0x42c206:'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x328f36?_0x1e607a(0x1f0)+_0x328f36+'\x27':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4b4284?_0x1e607a(0x211)+_0x4b4284+'\x27':'')+_0x1e607a(0x2e0)+(_0x30432e!==0x0?_0x1e607a(0x137)+_0x30432e:(0x0,utils_1[_0x1e607a(0x21e)])(_0x3bdb8d)?_0x1e607a(0x137)+_0x3bdb8d:'')+_0x1e607a(0x2e0)+(_0x4dd412?_0x1e607a(0x19b)+_0x4dd412+'%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%'+_0x4dd412+'%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%'+_0x4dd412+_0x1e607a(0x1fd)+_0x4dd412+_0x1e607a(0x277):'')+_0x1e607a(0x2e0)+(_0x3dbf30?_0x1e607a(0x25f)+_0x3dbf30+_0x1e607a(0x32b)+_0x3dbf30+_0x1e607a(0x20d)+_0x3dbf30+'%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%'+_0x3dbf30+_0x1e607a(0x277):'')+_0x1e607a(0x198),_0x117cc8=_0x1e607a(0x255)+_0x5d791f+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x4d33b2='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5d791f+_0x1e607a(0x2fb)+size+_0x1e607a(0x2b9)+(page-0x1)*size+_0x1e607a(0x198),_0x264ae4=await this[_0x1e607a(0x2b7)]['query'](_0x117cc8),_0x58ea66=await this[_0x1e607a(0x2b7)][_0x1e607a(0x176)](_0x4d33b2);return!(0x0,utils_1[_0x1e607a(0x2a2)])(this[_0x1e607a(0x314)])&&_0x58ea66['forEach'](_0xa75bc0=>{const _0x23c165=_0x1e607a;_0xa75bc0['phone']=(0x0,utils_1[_0x23c165(0x1ad)])(_0xa75bc0['phone']),_0xa75bc0[_0x23c165(0x17e)]=(0x0,utils_1['hideString'])(_0xa75bc0[_0x23c165(0x17e)]),_0xa75bc0[_0x23c165(0x230)]=(0x0,utils_1[_0x23c165(0x1ad)])(_0xa75bc0['inviterPhone']),_0xa75bc0['inviterEmail']=(0x0,utils_1[_0x23c165(0x1ad)])(_0xa75bc0[_0x23c165(0x258)]);}),{'rows':_0x58ea66,'count':Number(_0x264ae4[0x0]?.['count']||0x0)};}async[_0x912465(0x27b)](_0x34134c){const _0x2b8bb7=_0x912465,_0x9bbeed=await this[_0x2b8bb7(0x1ee)][_0x2b8bb7(0x2db)]({'where':{'inviteCode':_0x34134c}});if(!_0x9bbeed)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x9bbeed,_0x825642=await this[_0x2b8bb7(0x1ee)]['update']({'inviteCode':_0x34134c},{'inviteLinkCount':inviteLinkCount+0x1});return _0x825642[_0x2b8bb7(0x2ab)]?0x1:0x0;}async['qureyUserInfoByInviteCode'](_0x570d97){const _0x59ab28=_0x912465;return await this[_0x59ab28(0x1ee)][_0x59ab28(0x2db)]({'where':{'inviteCode':_0x570d97}});}async[_0x912465(0x2ee)](_0x1af215,_0x3787c3){const _0x15ad18=_0x912465,_0x332ee1=(0x0,utils_1[_0x15ad18(0x1e6)])(this[_0x15ad18(0x314)]);let {page:page=0x1,size:size=0xa,username:_0x5448a2,phone:_0x569214,email:_0x3e3690,status:_0x1f0968,keyword:_0x5d8864,roleCode:_0x13c9bf,vip:_0x3c97d0,saasId:_0x49b243}=_0x1af215,_0x8a34ee='1\x20=\x201';_0x1f0968&&(_0x8a34ee=_0x8a34ee+(_0x15ad18(0x2df)+_0x1f0968));_0x13c9bf&&(_0x8a34ee=_0x8a34ee+(_0x15ad18(0x22d)+_0x13c9bf+'\x27'));_0x3c97d0&&(_0x3c97d0=Number(_0x3c97d0));if(_0x3c97d0===0x1)_0x8a34ee=_0x8a34ee+_0x15ad18(0x278);else _0x3c97d0===0x0&&(_0x8a34ee=_0x8a34ee+_0x15ad18(0x2cb));_0x5d8864?_0x8a34ee=_0x8a34ee+(_0x15ad18(0x2a5)+_0x5d8864+_0x15ad18(0x2b0)+_0x5d8864+_0x15ad18(0x1a3)+_0x5d8864+'%\x27\x20OR\x20email\x20LIKE\x20\x27%'+_0x5d8864+_0x15ad18(0x22a)+_0x5d8864+'\x27)'):(_0x5448a2&&(_0x8a34ee=_0x8a34ee+('\x20AND\x20username\x20LIKE\x20\x27%'+_0x5448a2+'%\x27')),_0x3e3690&&(_0x8a34ee=_0x8a34ee+(_0x15ad18(0x161)+_0x3e3690+'%\x27')),_0x569214&&(_0x8a34ee=_0x8a34ee+(_0x15ad18(0x2a7)+_0x569214+'%\x27')));(0x0,utils_1[_0x15ad18(0x169)])(this[_0x15ad18(0x314)])?(0x0,utils_1[_0x15ad18(0x18c)])(this[_0x15ad18(0x314)])&&_0x49b243&&(_0x8a34ee=_0x8a34ee+(_0x15ad18(0x2a8)+_0x49b243)):_0x8a34ee=_0x8a34ee+('\x20AND\x20saasId\x20=\x20'+_0x332ee1);const _0x12b50f=await this[_0x15ad18(0x2b7)][_0x15ad18(0x176)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x8a34ee+_0x15ad18(0x274)),_0x55485b=await this[_0x15ad18(0x2b7)]['query'](_0x15ad18(0x208)+_0x8a34ee+_0x15ad18(0x260)+size+_0x15ad18(0x2b9)+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x27b620=[],_0x867609=(0x0,utils_1[_0x15ad18(0x2a2)])(this['clsService']),_0x453304=new Map([[Role_constant_1[_0x15ad18(0x2cd)]['AGENT'],_0x15ad18(0x17d)],[Role_constant_1[_0x15ad18(0x2cd)][_0x15ad18(0x13e)],_0x15ad18(0x1e2)],[Role_constant_1[_0x15ad18(0x2cd)][_0x15ad18(0x1ff)],_0x15ad18(0x2d7)]]);for(let _0x4975b3=0x0;_0x4975b3<_0x55485b[_0x15ad18(0x304)];_0x4975b3++){const _0x3f274e=_0x55485b[_0x4975b3];let _0x2f9ce7=_0x15ad18(0x2d7);if(_0x453304[_0x15ad18(0x14d)](_0x3f274e[_0x15ad18(0x332)]))_0x2f9ce7=_0x453304[_0x15ad18(0x2fd)](_0x3f274e[_0x15ad18(0x332)]);else{const _0x5d40fb=await this[_0x15ad18(0x306)][_0x15ad18(0x2db)]({'where':{'code':_0x3f274e[_0x15ad18(0x332)],'saasId':_0x3f274e[_0x15ad18(0x164)]}});_0x2f9ce7=_0x5d40fb[_0x15ad18(0x2d0)];}_0x27b620[_0x15ad18(0x321)]({..._0x3f274e,'roleName':_0x2f9ce7,'isBindWx':!!_0x3f274e?.[_0x15ad18(0x2c0)],'password':_0x3f274e[_0x15ad18(0x308)]?'yes':'no','email':_0x867609?_0x3f274e[_0x15ad18(0x17e)]:(0x0,utils_1[_0x15ad18(0x2d2)])(_0x3f274e[_0x15ad18(0x17e)]),'phone':_0x867609?_0x3f274e[_0x15ad18(0x19a)]:(0x0,utils_1[_0x15ad18(0x2d2)])(_0x3f274e[_0x15ad18(0x19a)]),'lastLoginIp':_0x867609?_0x3f274e[_0x15ad18(0x1b0)]:(0x0,utils_1[_0x15ad18(0x327)])(_0x3f274e[_0x15ad18(0x1b0)])});}return{'rows':_0x27b620,'count':Number(_0x12b50f[0x0]?.[_0x15ad18(0x2bc)]||0x0)};}async['queryByPage'](_0x53fe7d){const _0xf9d82f=_0x912465,{page:page=0x1,size:size=0xa,username:_0x499d01,status:_0x3d44ad}=_0x53fe7d;let _0x7d5708={};_0x499d01&&Object[_0xf9d82f(0x145)](_0x7d5708,{'username':(0x0,typeorm_2[_0xf9d82f(0x294)])('%'+_0x499d01+'%')}),_0x3d44ad&&Object[_0xf9d82f(0x145)](_0x7d5708,{'status':_0x3d44ad});const [_0x508e44,_0x196687]=await this[_0xf9d82f(0x1ee)][_0xf9d82f(0x21c)]({'skip':(page-0x1)*size,'where':_0x7d5708,'take':size,'cache':!![],'order':{'createdAt':_0xf9d82f(0x1ab)},'select':[_0xf9d82f(0x16a),_0xf9d82f(0x308),_0xf9d82f(0x332),_0xf9d82f(0x13c),'id']});return{'rows':_0x508e44,'count':_0x196687};}async[_0x912465(0x31c)]({id:_0x4bc84c}){const _0x5c2f14=_0x912465;let _0x32fdce,_0x32ee01;const _0x38c93b=await this['userEntity'][_0x5c2f14(0x2db)]({'where':{'id':_0x4bc84c}});if(!_0x38c93b)throw new common_1[(_0x5c2f14(0x320))](_0x5c2f14(0x166),common_1[_0x5c2f14(0x22f)][_0x5c2f14(0x155)]);if((0x0,utils_1['shouldAccess'])(_0x38c93b['role'])){const _0x287a1f=_0x38c93b[_0x5c2f14(0x332)]===Role_constant_1[_0x5c2f14(0x2cd)][_0x5c2f14(0x307)]?0x0:_0x38c93b[_0x5c2f14(0x164)],_0x528ba7=await this[_0x5c2f14(0x306)]['findOne']({'where':{'code':_0x38c93b[_0x5c2f14(0x332)],'saasId':_0x287a1f}});if(!_0x528ba7)throw new common_1[(_0x5c2f14(0x320))](_0x5c2f14(0x250),common_1[_0x5c2f14(0x22f)]['BAD_REQUEST']);_0x32fdce=_0x528ba7[_0x5c2f14(0x323)],_0x32ee01=_0x528ba7[_0x5c2f14(0x2cc)];}return{..._0x38c93b,'access':_0x32fdce,'accessLabel':_0x32ee01,'isBindWx':!!_0x38c93b?.[_0x5c2f14(0x2c0)],'password':_0x38c93b[_0x5c2f14(0x308)]?_0x5c2f14(0x183):'no'};}async[_0x912465(0x149)](_0x23d9bd){const _0x359caa=_0x912465;return await this[_0x359caa(0x1ee)][_0x359caa(0x2db)]({'where':{'username':_0x23d9bd}});}async['updateStatus'](_0x34bf31){const _0x442b07=_0x912465,{id:_0x1c0f5c,status:_0x445bf3}=_0x34bf31,_0x22b350=await this[_0x442b07(0x1ee)][_0x442b07(0x2db)]({'where':{'id':_0x1c0f5c}});if(!_0x22b350)throw new common_1[(_0x442b07(0x320))](_0x442b07(0x2ac),common_1['HttpStatus'][_0x442b07(0x1d7)]);if(_0x22b350[_0x442b07(0x332)]===Role_constant_1[_0x442b07(0x2cd)][_0x442b07(0x13e)])throw new common_1[(_0x442b07(0x320))](_0x442b07(0x150),common_1[_0x442b07(0x22f)][_0x442b07(0x1d7)]);if(_0x22b350['status']===user_constant_1['UserStatusEnum'][_0x442b07(0x1c8)])throw new common_1[(_0x442b07(0x320))](_0x442b07(0x261),common_1['HttpStatus'][_0x442b07(0x1d7)]);if(_0x445bf3===user_constant_1[_0x442b07(0x303)]['PENDING'])throw new common_1[(_0x442b07(0x320))](_0x442b07(0x1f9),common_1[_0x442b07(0x22f)][_0x442b07(0x1d7)]);const _0x326302=await this['userEntity'][_0x442b07(0x173)]({'id':_0x1c0f5c},{'status':_0x445bf3});if(_0x326302['affected']<=0x0)throw new common_1[(_0x442b07(0x320))]('修改用户状态失败！',common_1[_0x442b07(0x22f)]['BAD_REQUEST']);return _0x442b07(0x315);}async[_0x912465(0x1c2)](_0x62a855){const _0x403a90=_0x912465,{id:_0x3d6a93,role:_0x2a598f}=_0x62a855,_0x124b93=await this[_0x403a90(0x1ee)][_0x403a90(0x173)]({'id':_0x3d6a93},{'role':_0x2a598f});if(_0x124b93[_0x403a90(0x2ab)]<=0x0)throw new common_1['HttpException'](_0x403a90(0x1d5),common_1['HttpStatus']['BAD_REQUEST']);return _0x403a90(0x156);}async[_0x912465(0x29e)](_0x3c8026){const _0x34a2c5=_0x912465,{id:_0x4e3e2f}=_0x3c8026,_0x4b3a54=await this[_0x34a2c5(0x1ee)][_0x34a2c5(0x2db)]({'where':{'id':_0x4e3e2f}});if(!_0x4b3a54)throw new common_1[(_0x34a2c5(0x320))]('用户不存在！',common_1[_0x34a2c5(0x22f)][_0x34a2c5(0x1d7)]);const _0x4415d2=_0x34a2c5(0x29d),_0x2dcfb1=bcrypt[_0x34a2c5(0x2c6)](_0x4415d2,0xa),_0x434e4a=await this[_0x34a2c5(0x1ee)]['update']({'id':_0x4e3e2f},{'password':_0x2dcfb1});if(_0x434e4a['affected']<=0x0)throw new common_1[(_0x34a2c5(0x320))](_0x34a2c5(0x1f1),common_1[_0x34a2c5(0x22f)]['BAD_REQUEST']);return _0x34a2c5(0x22e)+_0x4415d2+_0x34a2c5(0x139);}async['savaLoginIp'](_0x39b8b4,_0x46f6ae){const _0xe39e8f=_0x912465;return await this[_0xe39e8f(0x1ee)]['update']({'id':_0x39b8b4},{'lastLoginIp':_0x46f6ae});}async[_0x912465(0x17c)](_0xe238c3,_0x5b6854){const _0x4bea5e=_0x912465;try{const _0x28eea1=await this[_0x4bea5e(0x1ee)][_0x4bea5e(0x2db)]({'where':{'id':_0x5b6854}});if(!_0x28eea1)return{'status':![],'msg':'当前绑定用户不存在！'};const _0x302934=await this[_0x4bea5e(0x1ee)][_0x4bea5e(0x2db)]({'where':{'openId':_0xe238c3}});if(_0x302934)return{'status':![],'msg':_0x4bea5e(0x209)};const _0xeb23f0=await this[_0x4bea5e(0x1ee)][_0x4bea5e(0x173)]({'id':_0x5b6854},{'openId':_0xe238c3});if(_0xeb23f0[_0x4bea5e(0x2ab)]<=0x0)return{'status':![],'msg':_0x4bea5e(0x310)};return{'status':!![],'msg':_0x4bea5e(0x23e)};}catch(_0x426b92){return{'status':![],'msg':_0x4bea5e(0x310)};}}async[_0x912465(0x30b)](_0x580147){const _0x5a5589=_0x912465,_0x500e4d=await this['userEntity'][_0x5a5589(0x2db)]({'where':{'id':_0x580147}});return _0x500e4d?.['openId'];}async[_0x912465(0x15d)](_0x282c1e){const _0x4ed8fe=_0x912465,_0x2863ba=await this[_0x4ed8fe(0x1ee)]['findOne']({'where':{'id':_0x282c1e}});return _0x2863ba?.[_0x4ed8fe(0x140)];}async[_0x912465(0x1fe)](_0x41ae11){const _0x3006d1=_0x912465,{username:_0x514304,password:_0x4839d0,phone:_0x545c77,phoneCode:_0x30f9c7}=_0x41ae11,_0x35794b=await this['userEntity'][_0x3006d1(0x2db)]({'where':[{'username':_0x514304},{'phone':_0x545c77}]});if(_0x35794b&&_0x35794b[_0x3006d1(0x16a)]===_0x514304)throw new common_1[(_0x3006d1(0x320))]('用户名已存在、请更换用户名！',common_1[_0x3006d1(0x22f)][_0x3006d1(0x1d7)]);if(_0x35794b&&_0x35794b['phone']===_0x545c77)throw new common_1[(_0x3006d1(0x320))](_0x3006d1(0x16b),common_1[_0x3006d1(0x22f)][_0x3006d1(0x1d7)]);}async[_0x912465(0x143)](_0x1444f1){const _0x518cc3=_0x912465,_0x5d5bfa=(0x0,utils_1[_0x518cc3(0x1e6)])(this[_0x518cc3(0x314)]);if(_0x1444f1[_0x518cc3(0x332)]!==Role_constant_1[_0x518cc3(0x2cd)]['AGENT'])_0x1444f1[_0x518cc3(0x164)]=_0x5d5bfa;else{if(!_0x1444f1['saasId'])throw new common_1[(_0x518cc3(0x320))](_0x518cc3(0x148),common_1[_0x518cc3(0x22f)][_0x518cc3(0x1d7)]);}return await this['userEntity'][_0x518cc3(0x29a)](_0x1444f1);}async[_0x912465(0x23f)](_0x9652b6){const _0x483f60=_0x912465,{id:_0x48317d,moreId:_0x5b8f2f}=_0x9652b6;if(_0x48317d)return await this['userEntity'][_0x483f60(0x252)]({'id':_0x48317d});if(_0x5b8f2f)return await this[_0x483f60(0x1ee)][_0x483f60(0x252)]({'id':(0x0,typeorm_2['MoreThan'])(_0x5b8f2f)});}async[_0x912465(0x1c5)](_0x2e466d){const _0x18d39b=_0x912465,_0x3dd149=_0x2e466d['user']['id'];return await this[_0x18d39b(0x1ee)][_0x18d39b(0x252)]({'id':_0x3dd149})[_0x18d39b(0x301)](_0x5d30f5=>_0x5d30f5['affected']>0x0);}async[_0x912465(0x15b)](_0x5d59e0,_0x5c1304){const _0x108ccf=_0x912465;try{if(!_0x5d59e0['username']&&!_0x5d59e0[_0x108ccf(0x19a)]&&!_0x5d59e0[_0x108ccf(0x17e)])throw new Error(_0x108ccf(0x217));if(_0x5d59e0['username']){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x108ccf(0x2da)](_0x5d59e0[_0x108ccf(0x16a)]))throw new Error(_0x108ccf(0x228));if(!_0x5d59e0[_0x108ccf(0x308)])throw new Error(_0x108ccf(0x1e7));}if(_0x5d59e0[_0x108ccf(0x19a)]){if(!(0x0,class_validator_1[_0x108ccf(0x2f1)])(_0x5d59e0[_0x108ccf(0x19a)],_0x108ccf(0x14a)))throw new Error('手机号格式错误！');}if(_0x5d59e0[_0x108ccf(0x17e)]){if(!(0x0,class_validator_1[_0x108ccf(0x193)])(_0x5d59e0['email']))throw new Error(_0x108ccf(0x2b5));}if(_0x5d59e0[_0x108ccf(0x16a)]){const _0x1a2b1f=await this[_0x108ccf(0x1ee)][_0x108ccf(0x210)]({'where':{'username':_0x5d59e0['username']}});if(_0x1a2b1f)throw new Error(_0x108ccf(0x30f));}if(_0x5d59e0[_0x108ccf(0x19a)]){const _0x5d6c5d=await this[_0x108ccf(0x1ee)][_0x108ccf(0x210)]({'where':{'phone':_0x5d59e0[_0x108ccf(0x19a)]}});if(_0x5d6c5d)throw new Error(_0x108ccf(0x2dc));}if(_0x5d59e0[_0x108ccf(0x17e)]){const _0x59396d=await this[_0x108ccf(0x1ee)][_0x108ccf(0x210)]({'where':{'email':_0x5d59e0[_0x108ccf(0x17e)]}});if(_0x59396d)throw new Error('邮箱已被使用！');}const _0x3dd539=new user_entity_1[(_0x108ccf(0x287))]();for(let _0x2e305c in _0x5d59e0){_0x5d59e0[_0x2e305c]&&(_0x3dd539[_0x2e305c]=_0x5d59e0[_0x2e305c]);}return _0x3dd539[_0x108ccf(0x308)]&&(_0x3dd539[_0x108ccf(0x308)]=bcrypt[_0x108ccf(0x2c6)](_0x5d59e0['password'],0xa)),_0x3dd539[_0x108ccf(0x13c)]=user_constant_1[_0x108ccf(0x303)][_0x108ccf(0x1d0)],!_0x3dd539[_0x108ccf(0x2af)]&&(_0x3dd539[_0x108ccf(0x2af)]=_0x3dd539['nickname']||'小智'),!_0x3dd539[_0x108ccf(0x131)]&&(_0x3dd539[_0x108ccf(0x131)]=await this[_0x108ccf(0x1af)]['getConfigByKeys']([_0x108ccf(0x2ad)])),await this[_0x108ccf(0x143)](_0x3dd539),!![];}catch(_0x75a643){throw new common_1[(_0x108ccf(0x320))](_0x75a643[_0x108ccf(0x2eb)],common_1[_0x108ccf(0x22f)]['BAD_REQUEST']);}}[_0x912465(0x2d1)](){const _0x389435=_0x912465;let _0x3d33e1=_0x389435(0x2e3);const _0xa5dff9=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x23d715=0x0;_0x23d715<0xa;_0x23d715++){_0x3d33e1=_0x3d33e1+_0xa5dff9[Math[_0x389435(0x14b)](Math['random']()*0x3f)];}return _0x3d33e1;}async['genUserNames'](_0x5b5059){const _0x49973d=_0x912465;let _0x4ce63c=[];for(let _0x2e7fce=0x0;_0x2e7fce<_0x5b5059;_0x2e7fce++){_0x4ce63c['push'](this[_0x49973d(0x2d1)]());}const _0x2aec1b=await this['userEntity'][_0x49973d(0x1eb)]({'where':{'username':(0x0,typeorm_2['In'])(_0x4ce63c)}});if(!_0x2aec1b[_0x49973d(0x304)])return _0x4ce63c;else{const _0x487b6b=new Set(_0x2aec1b['map'](_0x261586=>_0x261586['username']));_0x4ce63c=_0x4ce63c[_0x49973d(0x305)](_0x3b808a=>!_0x487b6b[_0x49973d(0x14d)](_0x3b808a));const _0x12a600=await this[_0x49973d(0x2c7)](_0x487b6b[_0x49973d(0x286)]);return _0x4ce63c=_0x4ce63c[_0x49973d(0x300)](_0x12a600),_0x4ce63c;}}async[_0x912465(0x213)](_0x2bb59f,_0x1ddc47){const _0xeb4844=_0x912465;let _0x3f0f16='';_0x3f0f16=_0xeb4844(0x2f3);const _0x1219f9=await this[_0xeb4844(0x2c7)](_0x2bb59f['num']),_0x39c48b=[],_0x347965=[],_0x52ace8=await this[_0xeb4844(0x1af)]['getConfigByKeys']([_0xeb4844(0x2ad)]);for(let _0x2cd3eb=0x0;_0x2cd3eb<_0x2bb59f[_0xeb4844(0x158)];_0x2cd3eb++){const _0x294317=new user_entity_1['UserEntity']();_0x294317[_0xeb4844(0x13c)]=0x1,_0x294317[_0xeb4844(0x131)]=_0x52ace8,_0x294317[_0xeb4844(0x16a)]=_0x1219f9[_0x2cd3eb],_0x294317[_0xeb4844(0x2af)]=_0x1219f9[_0x2cd3eb],_0x294317[_0xeb4844(0x308)]=bcrypt[_0xeb4844(0x2c6)](_0xeb4844(0x147),0xa),_0x3f0f16=_0x3f0f16+(_0x1219f9[_0x2cd3eb]+'\x09mj123456admin\x0a'),_0x2bb59f[_0xeb4844(0x12d)]&&(_0x294317[_0xeb4844(0x12d)]=Number(_0x2bb59f[_0xeb4844(0x12d)])),_0x2bb59f['vipLeavelName']&&(_0x294317[_0xeb4844(0x2ca)]=_0x2bb59f[_0xeb4844(0x2ca)]),_0x2bb59f[_0xeb4844(0x325)]&&(_0x294317['score']=_0x2bb59f[_0xeb4844(0x325)]),_0x2bb59f['vipDays']&&_0x347965['push']({'username':_0x1219f9[_0x2cd3eb],'vipDays':_0x2bb59f[_0xeb4844(0x201)]}),_0x39c48b[_0xeb4844(0x321)](_0x294317);}try{return await this[_0xeb4844(0x2b7)]['transaction'](async()=>{const _0x56105b=_0xeb4844;await this[_0x56105b(0x1ee)][_0x56105b(0x29a)](_0x39c48b),await this[_0x56105b(0x170)][_0x56105b(0x29a)](_0x347965);}),_0x3f0f16;}catch(_0x36eb71){throw new common_1['HttpException'](_0x36eb71[_0xeb4844(0x2eb)],axios_1[_0xeb4844(0x313)][_0xeb4844(0x186)]);}}async[_0x912465(0x1a0)](_0x33ef2b,_0x30fe27){const _0x56ee02=_0x912465,_0x8969e0=await this[_0x56ee02(0x1ee)]['findOne']({'where':{'id':_0x30fe27[_0x56ee02(0x265)]}});await this[_0x56ee02(0x1ee)]['increment']({'id':_0x8969e0['id']},_0x56ee02(0x325),_0x30fe27['score']),await this[_0x56ee02(0x1ef)]['insertAccountLog']({'userId':_0x8969e0['id'],'rawScore':_0x8969e0[_0x56ee02(0x325)],'newScore':_0x8969e0[_0x56ee02(0x325)]+_0x30fe27[_0x56ee02(0x325)],'changeScore':_0x30fe27['score'],'changeType':balance_constant_1[_0x56ee02(0x2ff)][_0x56ee02(0x1d6)],'rebateUserId':_0x33ef2b[_0x56ee02(0x26e)]['id'],'description':'管理员赠送'});}async['giftVip'](_0x373031,_0x2f3071){const _0x2e6454=_0x912465,_0x59b660=await this[_0x2e6454(0x1ee)][_0x2e6454(0x2db)]({'where':{'id':_0x2f3071[_0x2e6454(0x265)]}});return await this[_0x2e6454(0x2e9)](_0x59b660,balance_constant_1['EChangeType']['AdminGift'],_0x2f3071[_0x2e6454(0x1b7)],_0x2e6454(0x2b1),_0x373031[_0x2e6454(0x26e)]['id']),!![];}async[_0x912465(0x1ac)](_0x94b9a){const _0x1021d4=_0x912465,_0x14cc8a=await this['userInitVipEntity'][_0x1021d4(0x2db)]({'where':{'username':_0x94b9a[_0x1021d4(0x16a)]}});_0x14cc8a&&await this[_0x1021d4(0x2b7)][_0x1021d4(0x269)](async()=>{const _0x33fcbf=_0x1021d4;_0x14cc8a[_0x33fcbf(0x201)]===-0x1?_0x94b9a[_0x33fcbf(0x241)]=0x1:_0x94b9a['vipExpire']=(0x0,date_1[_0x33fcbf(0x1d1)])()[_0x33fcbf(0x229)](_0x14cc8a[_0x33fcbf(0x201)],_0x33fcbf(0x2c1))[_0x33fcbf(0x2e8)](),_0x94b9a=await this[_0x33fcbf(0x1ee)][_0x33fcbf(0x29a)](_0x94b9a),await this[_0x33fcbf(0x170)][_0x33fcbf(0x252)]({'id':_0x14cc8a['id']});});}async[_0x912465(0x25e)](_0x382c14,_0x4b084c){const _0x38c1f3=_0x912465;await this[_0x38c1f3(0x1ee)][_0x38c1f3(0x173)]({'id':_0x382c14},{'consecutiveDays':_0x4b084c});}async[_0x912465(0x271)](_0x1616d3){const _0x2210c7=_0x912465,_0x26e133=await this[_0x2210c7(0x2f6)](_0x1616d3);_0x26e133[_0x2210c7(0x14c)]=_0x26e133[_0x2210c7(0x14c)]+0x1,await this['userEntity'][_0x2210c7(0x29a)](_0x26e133);}async[_0x912465(0x234)](_0x5ef21a,_0x5377f5){const _0x3def3c=_0x912465,_0x30bef2=await this[_0x3def3c(0x1af)][_0x3def3c(0x2f8)](['registerSendStatus','registerRewards',_0x3def3c(0x17a),_0x3def3c(0x163),_0x3def3c(0x1f3),'invitedRewards',_0x3def3c(0x191)]),_0x269abb={};for(let _0xebe4ab in _0x30bef2){const _0x35f872=Number(_0x30bef2[_0xebe4ab]),_0x11bd0a=Number['isInteger'](_0x35f872)&&_0x35f872>0x0?_0x35f872:0x0;_0x269abb[_0xebe4ab]=_0x11bd0a;}_0x269abb['registerSendStatus']&&(await this['userEntity'][_0x3def3c(0x173)]({'id':_0x5ef21a['id']},{'score':_0x269abb['registerRewards']}),await this[_0x3def3c(0x1ef)][_0x3def3c(0x31f)]({'userId':_0x5ef21a['id'],'rawScore':0x0,'newScore':_0x269abb[_0x3def3c(0x14e)],'changeScore':_0x269abb['registerRewards'],'changeType':balance_constant_1[_0x3def3c(0x2ff)][_0x3def3c(0x281)],'description':_0x3def3c(0x203)}));if(_0x5377f5&&_0x269abb[_0x3def3c(0x17a)]){_0x269abb[_0x3def3c(0x163)]&&(await this[_0x3def3c(0x1ee)][_0x3def3c(0x2a4)]({'id':_0x5377f5['id']},_0x3def3c(0x325),_0x269abb[_0x3def3c(0x163)]),await this['userBalanceService'][_0x3def3c(0x31f)]({'userId':_0x5377f5['id'],'rawScore':_0x5377f5[_0x3def3c(0x325)],'newScore':_0x5377f5[_0x3def3c(0x325)]+_0x269abb[_0x3def3c(0x163)],'changeScore':_0x269abb['inviteRewards'],'changeType':balance_constant_1[_0x3def3c(0x2ff)][_0x3def3c(0x2e4)],'rebateUserId':_0x5ef21a['id'],'description':_0x3def3c(0x27c)}));_0x269abb[_0x3def3c(0x1f3)]&&await this[_0x3def3c(0x2e9)](_0x5377f5,balance_constant_1[_0x3def3c(0x2ff)][_0x3def3c(0x2e4)],_0x269abb['inviteRewardVip'],'邀请新用户注册奖励',_0x5ef21a['id']);const _0x269fe6=await this[_0x3def3c(0x1ee)][_0x3def3c(0x2db)]({'where':{'id':_0x5ef21a['id']}});_0x269abb[_0x3def3c(0x1cd)]&&(await this['userEntity'][_0x3def3c(0x2a4)]({'id':_0x269fe6['id']},'score',_0x269abb[_0x3def3c(0x1cd)]),await this['userBalanceService'][_0x3def3c(0x31f)]({'userId':_0x5ef21a['id'],'rawScore':_0x269fe6['score'],'newScore':_0x269fe6['score']+_0x269abb['invitedRewards'],'changeScore':_0x269abb[_0x3def3c(0x1cd)],'changeType':balance_constant_1[_0x3def3c(0x2ff)][_0x3def3c(0x179)],'rebateUserId':_0x5377f5['id'],'description':_0x3def3c(0x288)})),_0x269abb['invitedRewardVip']&&await this['updateVipExpire'](_0x269fe6,balance_constant_1[_0x3def3c(0x2ff)][_0x3def3c(0x179)],_0x269abb[_0x3def3c(0x191)],_0x3def3c(0x288),_0x5377f5['id']);}}async[_0x912465(0x29c)](_0x9e4965,_0x12e0a6,_0x3ee840,_0x2076ce,_0x4b9616){const _0x6db1ae=_0x912465;await this[_0x6db1ae(0x1ee)][_0x6db1ae(0x173)]({'id':_0x9e4965['id']},{'score':_0x9e4965[_0x6db1ae(0x325)]+_0x3ee840}),await this['userBalanceService']['insertAccountLog']({'userId':_0x9e4965['id'],'rawScore':_0x9e4965['score'],'newScore':_0x9e4965[_0x6db1ae(0x325)]+_0x3ee840,'changeScore':_0x3ee840,'changeType':_0x12e0a6,'relateId':_0x4b9616?String(_0x4b9616):null,'description':_0x2076ce});}async[_0x912465(0x2e9)](_0x1ac7d3,_0xe149f3,_0x595888,_0x1497a8,_0x4f2325){const _0x4be8fb=_0x912465;if(_0x1ac7d3[_0x4be8fb(0x241)])return;_0x595888===-0x1?await this[_0x4be8fb(0x1ee)][_0x4be8fb(0x173)]({'id':_0x1ac7d3['id']},{'lifetimeVip':0x1}):(_0x1ac7d3['vipExpire']?_0x1ac7d3['vipExpire']=(0x0,date_1[_0x4be8fb(0x1d1)])(_0x1ac7d3[_0x4be8fb(0x184)])[_0x4be8fb(0x229)](_0x595888,'day')[_0x4be8fb(0x2e8)]():_0x1ac7d3[_0x4be8fb(0x184)]=(0x0,date_1['default'])()[_0x4be8fb(0x229)](_0x595888,'day')[_0x4be8fb(0x2e8)](),await this[_0x4be8fb(0x1ee)][_0x4be8fb(0x173)]({'id':_0x1ac7d3['id']},{'vipExpire':_0x1ac7d3[_0x4be8fb(0x184)]})),_0x1ac7d3=await this[_0x4be8fb(0x1ee)][_0x4be8fb(0x2db)]({'where':{'id':_0x1ac7d3['id']}}),await this[_0x4be8fb(0x1ef)][_0x4be8fb(0x19f)]({'userId':_0x1ac7d3['id'],'vipDays':_0x595888,'vipExpire':_0x1ac7d3[_0x4be8fb(0x184)],'relateType':_0xe149f3,'relateId':_0x4f2325?String(_0x4f2325):'','description':_0x1497a8});}async[_0x912465(0x31b)](_0x21d7b6,_0x1e1b94){const _0x432637=_0x912465;let _0x3ea77e=!![];const _0x4df072=await this[_0x432637(0x2f6)](_0x21d7b6);if(_0x4df072[_0x432637(0x241)]||_0x4df072[_0x432637(0x184)]){if(_0x1e1b94['vipFreeNum']<0x0)_0x3ea77e=!![];else{if(_0x1e1b94[_0x432637(0x253)]>0x0){const _0x4b649a=redisKey_constant_1['VIP_FREE']+'-'+_0x21d7b6+'-'+_0x1e1b94['id'];let _0x37d9d2=await this[_0x432637(0x180)][_0x432637(0x2fd)]({'key':_0x4b649a});console[_0x432637(0x1b1)](_0x37d9d2);let _0x186294=Number(_0x37d9d2||0x0);_0x186294<_0x1e1b94[_0x432637(0x253)]?_0x3ea77e=!![]:_0x3ea77e=_0x4df072['score']>=_0x1e1b94['deduct'];}else _0x3ea77e=_0x4df072[_0x432637(0x325)]>=_0x1e1b94[_0x432637(0x2d3)];}}else _0x3ea77e=_0x4df072[_0x432637(0x325)]>=_0x1e1b94['deduct'];if(!_0x3ea77e)throw new common_1[(_0x432637(0x320))](_0x432637(0x15f),common_1[_0x432637(0x22f)][_0x432637(0x1d7)]);}async[_0x912465(0x264)](_0x4ee019,_0x5e0ab3,_0x3b20a4){const _0x16bebe=_0x912465,_0x4b1279=await this[_0x16bebe(0x2f6)](_0x4ee019);let _0xba7b6a;switch(_0x5e0ab3['modelType']){case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x22c)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x22c)];break;case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x242)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x291)];break;case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x215)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x1cf)];break;case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x248)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x248)];break;case model_constant_1[_0x16bebe(0x13d)]['DRAW']:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x187)];break;case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x2d8)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x292)];break;case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x32f)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x331)];break;case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x207)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x2c3)];break;case model_constant_1[_0x16bebe(0x13d)][_0x16bebe(0x28c)]:_0xba7b6a=balance_constant_1[_0x16bebe(0x2ff)][_0x16bebe(0x1c7)];break;default:_0xba7b6a=balance_constant_1['EChangeType'][_0x16bebe(0x292)];}if(_0x4b1279[_0x16bebe(0x241)]||_0x4b1279[_0x16bebe(0x184)]){if(_0x5e0ab3['vipFreeNum']<0x0){await this[_0x16bebe(0x29c)](_0x4b1279,_0xba7b6a,0x0,_0x16bebe(0x267)+_0x5e0ab3[_0x16bebe(0x238)]+_0x16bebe(0x20e),_0x3b20a4);return;}else{if(_0x5e0ab3[_0x16bebe(0x253)]>0x0){const _0x11c7d6=redisKey_constant_1[_0x16bebe(0x2f7)]+'-'+_0x4ee019+'-'+_0x5e0ab3['id'];let _0x17ae00=await this[_0x16bebe(0x180)][_0x16bebe(0x2fd)]({'key':_0x11c7d6}),_0x1998de=Number(_0x17ae00||0x0);if(_0x1998de<_0x5e0ab3[_0x16bebe(0x253)]){const _0xe61cac=(0x0,date_1[_0x16bebe(0x1d1)])()[_0x16bebe(0x318)]('d')[_0x16bebe(0x2e2)]((0x0,date_1[_0x16bebe(0x1d1)])(),'s');await this[_0x16bebe(0x180)][_0x16bebe(0x20f)]({'key':_0x11c7d6,'val':_0x1998de+0x1},_0xe61cac),await this[_0x16bebe(0x29c)](_0x4b1279,_0xba7b6a,0x0,_0x16bebe(0x267)+_0x5e0ab3[_0x16bebe(0x238)]+_0x16bebe(0x2d6),_0x3b20a4);return;}}}}await this[_0x16bebe(0x29c)](_0x4b1279,_0xba7b6a,-_0x5e0ab3['deduct'],_0x16bebe(0x267)+_0x5e0ab3['modelName']+'】使用扣减',_0x3b20a4);}async[_0x912465(0x1d2)](_0x42fd22,_0x229f37,_0x192def,_0x468bc2){const _0x525598=_0x912465,_0xee5877=await this[_0x525598(0x2f6)](_0x42fd22);let _0x1b2025=balance_constant_1[_0x525598(0x2ff)][_0x525598(0x187)];if(_0xee5877['lifetimeVip']||_0xee5877[_0x525598(0x184)]){if(_0x229f37[_0x525598(0x253)]<0x0){await this['changeScore4Other'](_0xee5877,_0x1b2025,0x0,'模型【'+_0x229f37['modelName']+_0x525598(0x20e),_0x192def);return;}else{if(_0x229f37['vipFreeNum']>0x0){const _0x34badd=redisKey_constant_1['VIP_FREE']+'-'+_0x42fd22+'-'+_0x229f37['model'];let _0x1cfc63=await this[_0x525598(0x180)][_0x525598(0x2fd)]({'key':_0x34badd}),_0x236491=Number(_0x1cfc63||0x0);if(_0x236491<_0x229f37[_0x525598(0x253)]){const _0x19571b=(0x0,date_1['default'])()[_0x525598(0x318)]('d')[_0x525598(0x2e2)]((0x0,date_1[_0x525598(0x1d1)])(),'s');await this[_0x525598(0x180)][_0x525598(0x20f)]({'key':_0x34badd,'val':_0x236491+0x1},_0x19571b),await this[_0x525598(0x29c)](_0xee5877,_0x1b2025,0x0,_0x525598(0x267)+_0x229f37[_0x525598(0x238)]+_0x525598(0x2d6),_0x192def);return;}}}}await this['changeScore4Other'](_0xee5877,_0x1b2025,-_0x229f37['deduct']*(_0x468bc2||0x1),_0x525598(0x267)+_0x229f37[_0x525598(0x238)]+_0x525598(0x2a6),_0x192def);}async['validateBalance4Draw'](_0x499f54,_0x4228dd,_0x186170){const _0x45aa80=_0x912465;let _0x6fe3f5=!![];const _0x7816bd=await this['getUserById'](_0x499f54);if(_0x7816bd[_0x45aa80(0x241)]||_0x7816bd[_0x45aa80(0x184)]){if(_0x4228dd[_0x45aa80(0x253)]<0x0){_0x6fe3f5=!![];return;}else{if(_0x4228dd[_0x45aa80(0x253)]>0x0){const _0x5dd66d=redisKey_constant_1[_0x45aa80(0x2f7)]+'-'+_0x499f54+'-'+_0x4228dd[_0x45aa80(0x232)];let _0x15165e=await this[_0x45aa80(0x180)][_0x45aa80(0x2fd)]({'key':_0x5dd66d}),_0x319a66=Number(_0x15165e||0x0);if(_0x319a66<_0x4228dd[_0x45aa80(0x253)]){_0x6fe3f5=!![];return;}}}}_0x6fe3f5=_0x7816bd[_0x45aa80(0x325)]>=_0x4228dd[_0x45aa80(0x2d3)]*_0x186170;if(!_0x6fe3f5)throw new common_1[(_0x45aa80(0x320))](_0x45aa80(0x15f),common_1[_0x45aa80(0x22f)]['BAD_REQUEST']);}async[_0x912465(0x1a7)](_0x50a4bb,_0x4dc790,_0x4d9f79){const _0x509efe=_0x912465;let _0x3f98b6=!![],_0xbe82ab=await this[_0x509efe(0x32d)](_0x4dc790,_0x4d9f79);const _0x34fa3f=await this[_0x509efe(0x2f6)](_0x50a4bb);if(_0x34fa3f[_0x509efe(0x241)]||_0x34fa3f[_0x509efe(0x184)]){if(_0x4dc790['vipFreeNum']<0x0||_0xbe82ab?.[_0x509efe(0x253)]<0x0){_0x3f98b6=!![];return;}else{if(_0xbe82ab?.['vipFreeNum']>0x0){const _0x32f753=redisKey_constant_1[_0x509efe(0x2f7)]+'-'+_0x50a4bb+'-'+_0xbe82ab[_0x509efe(0x232)]+'-'+_0xbe82ab[_0x509efe(0x1a9)]+'-'+_0xbe82ab[_0x509efe(0x1f6)];let _0x55e6f1=await this[_0x509efe(0x180)][_0x509efe(0x2fd)]({'key':_0x32f753}),_0x52d903=Number(_0x55e6f1||0x0);if(_0x52d903<_0xbe82ab[_0x509efe(0x253)]){_0x3f98b6=!![];return;}}else{if(_0x4dc790[_0x509efe(0x253)]>0x0){const _0x4a2958=redisKey_constant_1[_0x509efe(0x2f7)]+'-'+_0x50a4bb+'-'+_0x4dc790['id'];let _0x1d3906=await this[_0x509efe(0x180)][_0x509efe(0x2fd)]({'key':_0x4a2958});console[_0x509efe(0x1b1)](_0x1d3906);let _0x2bf16e=Number(_0x1d3906||0x0);if(_0x2bf16e<_0x4dc790[_0x509efe(0x253)]){_0x3f98b6=!![];return;}}}}}_0x3f98b6=_0x34fa3f[_0x509efe(0x325)]>=(_0xbe82ab?.['price']>0x0?_0xbe82ab?.['price']:_0x4dc790['deduct']);if(!_0x3f98b6)throw new common_1[(_0x509efe(0x320))]('用户余额不足，请充值',common_1[_0x509efe(0x22f)][_0x509efe(0x1d7)]);}async[_0x912465(0x1cc)](_0x34466d,_0xf21f6f,_0x2e109f=0x1){const _0x305f1b=_0x912465;let _0x553b80=!![],_0x3322a7=await this[_0x305f1b(0x243)](_0xf21f6f);const _0x54de1a=await this[_0x305f1b(0x2f6)](_0x34466d);if(_0x54de1a['lifetimeVip']||_0x54de1a[_0x305f1b(0x184)]){if(_0x3322a7?.[_0x305f1b(0x253)]<0x0){_0x553b80=!![];return;}else{if(_0x3322a7?.[_0x305f1b(0x253)]>0x0){const _0x12246b=redisKey_constant_1[_0x305f1b(0x2f7)]+'-'+_0x34466d+'-'+_0xf21f6f;let _0x477edd=await this[_0x305f1b(0x180)][_0x305f1b(0x2fd)]({'key':_0x12246b}),_0x40eca0=Number(_0x477edd||0x0);if(_0x40eca0<_0x3322a7[_0x305f1b(0x253)]){_0x553b80=!![];return;}}}}console['log']('----------------当前需要点数-----------',_0x54de1a[_0x305f1b(0x325)],_0x3322a7);_0x2e109f?_0x553b80=_0x54de1a['score']>=_0x3322a7?.[_0x305f1b(0x175)]*parseInt(_0x2e109f['toString']()):_0x553b80=_0x54de1a[_0x305f1b(0x325)]>=_0x3322a7?.[_0x305f1b(0x175)];if(!_0x553b80)throw new common_1[(_0x305f1b(0x320))](_0x305f1b(0x15f),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x912465(0x152)](_0x36055e,_0x594a69,_0x163c75,_0x428620=0x1){const _0x54a5e5=_0x912465,_0x34c682=await this[_0x54a5e5(0x2f6)](_0x36055e);let _0x45aeae=await this[_0x54a5e5(0x243)](_0x594a69);if(_0x34c682[_0x54a5e5(0x241)]||_0x34c682[_0x54a5e5(0x184)]){if(_0x45aeae?.['vipFreeNum']<0x0){await this[_0x54a5e5(0x29c)](_0x34c682,balance_constant_1[_0x54a5e5(0x2ff)][_0x54a5e5(0x270)],0x0,_0x54a5e5(0x214)+_0x594a69+_0x54a5e5(0x20e),_0x163c75);return;}else{if(_0x45aeae?.[_0x54a5e5(0x253)]>0x0){const _0x447f33=redisKey_constant_1[_0x54a5e5(0x2f7)]+'-'+_0x36055e+'-'+_0x594a69;let _0x5d26fa=await this[_0x54a5e5(0x180)][_0x54a5e5(0x2fd)]({'key':_0x447f33}),_0x54cbdc=Number(_0x5d26fa||0x0);if(_0x54cbdc<_0x45aeae['vipFreeNum']){const _0xcaa562=(0x0,date_1[_0x54a5e5(0x1d1)])()[_0x54a5e5(0x318)]('d')[_0x54a5e5(0x2e2)]((0x0,date_1[_0x54a5e5(0x1d1)])(),'s');await this[_0x54a5e5(0x180)][_0x54a5e5(0x20f)]({'key':_0x447f33,'val':_0x54cbdc+0x1},_0xcaa562);return;}}}}_0x428620?await this[_0x54a5e5(0x29c)](_0x34c682,balance_constant_1['EChangeType'][_0x54a5e5(0x270)],_0x45aeae?.[_0x54a5e5(0x175)]*parseInt(_0x428620[_0x54a5e5(0x27f)]()),_0x54a5e5(0x214)+_0x594a69+_0x54a5e5(0x2d6),_0x163c75):await this['changeScore4Other'](_0x34c682,balance_constant_1[_0x54a5e5(0x2ff)][_0x54a5e5(0x270)],_0x45aeae?.['price'],'数字人【'+_0x594a69+_0x54a5e5(0x2d6),_0x163c75);}async[_0x912465(0x233)](_0x195b05,_0xb3a320,_0x3eced6){const _0x31525e=_0x912465,_0x18b83e=await this['getUserById'](_0x195b05);let _0x391ff1=await this[_0x31525e(0x243)](_0xb3a320);if(_0x18b83e[_0x31525e(0x241)]||_0x18b83e[_0x31525e(0x184)]){if(_0x391ff1?.[_0x31525e(0x253)]<0x0)return;else{if(_0x391ff1?.[_0x31525e(0x253)]>0x0){const _0x568c33=redisKey_constant_1[_0x31525e(0x2f7)]+'-'+_0x195b05+'-'+_0xb3a320;let _0x49f5e5=await this[_0x31525e(0x180)][_0x31525e(0x2fd)]({'key':_0x568c33}),_0x344cb1=Number(_0x49f5e5||0x0);if(_0x344cb1>=_0x391ff1[_0x31525e(0x253)]){const _0x384a4b=(0x0,date_1[_0x31525e(0x1d1)])()['endOf']('d')[_0x31525e(0x2e2)]((0x0,date_1[_0x31525e(0x1d1)])(),'s');await this[_0x31525e(0x180)]['set']({'key':_0x568c33,'val':_0x344cb1-0x1},_0x384a4b);return;}}}}await this[_0x31525e(0x29c)](_0x18b83e,balance_constant_1['EChangeType'][_0x31525e(0x270)],_0x391ff1?.[_0x31525e(0x175)],_0x31525e(0x214)+_0xb3a320+_0x31525e(0x284),_0x3eced6);}async['deductBalance4Video'](_0x33220e,_0x1c3469,_0x52a25d,_0x3ef805){const _0x1da6a3=_0x912465,_0x5d0aa5=await this['getUserById'](_0x33220e);let _0x1b58a8=await this['getVideoConfig'](_0x1c3469,_0x52a25d);if(_0x5d0aa5[_0x1da6a3(0x241)]||_0x5d0aa5['vipExpire']){if(_0x1c3469['vipFreeNum']<0x0||_0x1b58a8?.[_0x1da6a3(0x253)]<0x0){await this[_0x1da6a3(0x29c)](_0x5d0aa5,balance_constant_1['EChangeType'][_0x1da6a3(0x248)],0x0,_0x1da6a3(0x267)+_0x1c3469[_0x1da6a3(0x238)]+_0x1da6a3(0x20e),_0x3ef805);return;}else{if(_0x1b58a8?.['vipFreeNum']>0x0){const _0x549ddf=redisKey_constant_1[_0x1da6a3(0x2f7)]+'-'+_0x33220e+'-'+_0x1b58a8[_0x1da6a3(0x232)]+'-'+_0x1b58a8[_0x1da6a3(0x1a9)]+'-'+_0x1b58a8['duration'];let _0x5bebb6=await this['redisCacheService'][_0x1da6a3(0x2fd)]({'key':_0x549ddf}),_0x3dc758=Number(_0x5bebb6||0x0);if(_0x3dc758<_0x1b58a8[_0x1da6a3(0x253)]){const _0x44c991=(0x0,date_1[_0x1da6a3(0x1d1)])()[_0x1da6a3(0x318)]('d')[_0x1da6a3(0x2e2)]((0x0,date_1[_0x1da6a3(0x1d1)])(),'s');await this[_0x1da6a3(0x180)][_0x1da6a3(0x20f)]({'key':_0x549ddf,'val':_0x3dc758+0x1},_0x44c991);return;}}else{if(_0x1c3469[_0x1da6a3(0x253)]>0x0){const _0xd6b891=redisKey_constant_1[_0x1da6a3(0x2f7)]+'-'+_0x33220e+'-'+_0x1c3469['id'];let _0x3e1fc3=await this[_0x1da6a3(0x180)][_0x1da6a3(0x2fd)]({'key':_0xd6b891}),_0x4e7b17=Number(_0x3e1fc3||0x0);if(_0x4e7b17<_0x1c3469[_0x1da6a3(0x253)]){const _0x356ecb=(0x0,date_1[_0x1da6a3(0x1d1)])()[_0x1da6a3(0x318)]('d')['diff']((0x0,date_1[_0x1da6a3(0x1d1)])(),'s');await this[_0x1da6a3(0x180)]['set']({'key':_0xd6b891,'val':_0x4e7b17+0x1},_0x356ecb);return;}}}}}await this[_0x1da6a3(0x29c)](_0x5d0aa5,balance_constant_1[_0x1da6a3(0x2ff)][_0x1da6a3(0x248)],_0x1b58a8?.['price']>0x0?-_0x1b58a8?.[_0x1da6a3(0x175)]:-_0x1c3469[_0x1da6a3(0x2d3)],_0x1da6a3(0x267)+_0x1c3469[_0x1da6a3(0x238)]+_0x1da6a3(0x2d6),_0x3ef805);}async[_0x912465(0x2bd)](_0x4befa5,_0x1486c9,_0x146182,_0x5a4bb){const _0x721a50=_0x912465;let _0x2a5323=await this[_0x721a50(0x32d)](_0x1486c9,_0x146182);const _0x1db4f6=await this[_0x721a50(0x2f6)](_0x4befa5);if(_0x1db4f6[_0x721a50(0x241)]||_0x1db4f6[_0x721a50(0x184)]){if(_0x1486c9['vipFreeNum']<0x0||_0x2a5323?.[_0x721a50(0x253)]<0x0)return;else{if(_0x2a5323?.[_0x721a50(0x253)]>0x0){const _0x440ab0=redisKey_constant_1[_0x721a50(0x2f7)]+'-'+_0x4befa5+'-'+_0x2a5323[_0x721a50(0x232)]+'-'+_0x2a5323['mode']+'-'+_0x2a5323[_0x721a50(0x1f6)];let _0x681a5e=await this[_0x721a50(0x180)][_0x721a50(0x2fd)]({'key':_0x440ab0}),_0x542907=Number(_0x681a5e||0x0);if(_0x542907>=_0x2a5323[_0x721a50(0x253)]){const _0x14a8f0=(0x0,date_1['default'])()[_0x721a50(0x318)]('d')['diff']((0x0,date_1[_0x721a50(0x1d1)])(),'s');await this['redisCacheService'][_0x721a50(0x20f)]({'key':_0x440ab0,'val':_0x542907-0x1},_0x14a8f0);return;}}else{if(_0x1486c9[_0x721a50(0x253)]>0x0){const _0x240c74=redisKey_constant_1[_0x721a50(0x2f7)]+'-'+_0x4befa5+'-'+_0x1486c9['id'];let _0x3f551e=await this['redisCacheService'][_0x721a50(0x2fd)]({'key':_0x240c74}),_0x3e7f19=Number(_0x3f551e||0x0);if(_0x3e7f19>=_0x1486c9[_0x721a50(0x253)]){const _0x5854a0=(0x0,date_1[_0x721a50(0x1d1)])()[_0x721a50(0x318)]('d')[_0x721a50(0x2e2)]((0x0,date_1['default'])(),'s');await this[_0x721a50(0x180)][_0x721a50(0x20f)]({'key':_0x240c74,'val':_0x3e7f19-0x1},_0x5854a0);return;}}}}}await this[_0x721a50(0x29c)](_0x1db4f6,balance_constant_1[_0x721a50(0x2ff)][_0x721a50(0x248)],_0x2a5323?.[_0x721a50(0x175)]>0x0?_0x2a5323?.['price']:_0x1486c9['deduct'],_0x721a50(0x267)+_0x1486c9['modelName']+_0x721a50(0x284),_0x5a4bb);}async[_0x912465(0x2de)](_0x27a58b,_0x266bc7,_0x39d538){const _0x21c362=_0x912465,_0x5cb432=await this[_0x21c362(0x2f6)](_0x27a58b);let _0x1f7c0d;switch(_0x266bc7[_0x21c362(0x225)]){case model_constant_1['EModelType']['APP']:_0x1f7c0d=balance_constant_1[_0x21c362(0x2ff)]['GPTS'];break;case model_constant_1['EModelType'][_0x21c362(0x215)]:_0x1f7c0d=balance_constant_1[_0x21c362(0x2ff)]['Music'];break;case model_constant_1[_0x21c362(0x13d)][_0x21c362(0x285)]:_0x1f7c0d=balance_constant_1[_0x21c362(0x2ff)][_0x21c362(0x187)];break;case model_constant_1[_0x21c362(0x13d)]['CHAT']:_0x1f7c0d=balance_constant_1['EChangeType'][_0x21c362(0x292)];break;case model_constant_1[_0x21c362(0x13d)][_0x21c362(0x32f)]:_0x1f7c0d=balance_constant_1['EChangeType'][_0x21c362(0x331)];break;case model_constant_1['EModelType']['VIDEO']:_0x1f7c0d=balance_constant_1[_0x21c362(0x2ff)][_0x21c362(0x248)];break;default:_0x1f7c0d=balance_constant_1[_0x21c362(0x2ff)]['Chat'];}await this[_0x21c362(0x29c)](_0x5cb432,_0x1f7c0d,_0x266bc7[_0x21c362(0x2d3)],_0x21c362(0x267)+_0x266bc7['modelName']+_0x21c362(0x23a),_0x39d538);}async[_0x912465(0x31d)](_0x2181b7,_0x4939ed,_0x1c10cd,_0x314410,_0x505940,_0x3c64d4){const _0x3015a7=_0x912465,_0x4e4e9e=await this[_0x3015a7(0x2f6)](_0x2181b7);if(_0x4e4e9e[_0x3015a7(0x241)]||_0x4e4e9e[_0x3015a7(0x184)]){if(_0x314410<0x0){await this['changeScore4Other'](_0x4e4e9e,balance_constant_1['EChangeType']['Coze'],0x0,_0x3015a7(0x267)+_0x1c10cd+_0x3015a7(0x20e),_0x3c64d4);return;}else{if(_0x314410>0x0){const _0x2311f2=redisKey_constant_1['VIP_FREE']+'-'+_0x2181b7+'-'+_0x4939ed;let _0xce73eb=await this['redisCacheService'][_0x3015a7(0x2fd)]({'key':_0x2311f2}),_0x51411c=Number(_0xce73eb||0x0);if(_0x51411c<_0x314410){const _0x5bbe04=(0x0,date_1['default'])()[_0x3015a7(0x318)]('d')['diff']((0x0,date_1[_0x3015a7(0x1d1)])(),'s');await this[_0x3015a7(0x180)][_0x3015a7(0x20f)]({'key':_0x2311f2,'val':_0x51411c+0x1},_0x5bbe04),await this['changeScore4Other'](_0x4e4e9e,balance_constant_1['EChangeType'][_0x3015a7(0x23b)],0x0,'模型【'+_0x1c10cd+_0x3015a7(0x2d6),_0x3c64d4);return;}}}}await this[_0x3015a7(0x29c)](_0x4e4e9e,balance_constant_1[_0x3015a7(0x2ff)]['Coze'],-_0x505940,_0x3015a7(0x267)+_0x1c10cd+_0x3015a7(0x2a6),_0x3c64d4);}async[_0x912465(0x202)](_0x102832,_0x573baf,_0x4ef5da){const _0x595257=_0x912465;let _0x5a7a04='',_0x20c06e='',_0x1734c8='',_0x2b39c5=_0x573baf;const _0x5bacbd=_0x573baf['toLowerCase'](),_0x58b545=new RegExp(_0x595257(0x2a1)),_0x587bb7=new RegExp(_0x595257(0x2b2)),_0x3d7e4a=new RegExp(_0x595257(0x168));if(_0x102832===midjourney_constant_1[_0x595257(0x283)]['fast'])_0x20c06e='type1',_0x5a7a04=_0x595257(0x2ae),_0x1734c8='fast_vip_free';else{if(_0x102832===midjourney_constant_1[_0x595257(0x283)]['relax'])_0x20c06e='type2',_0x5a7a04=_0x595257(0x296),_0x1734c8=_0x595257(0x188);else _0x102832===midjourney_constant_1[_0x595257(0x283)][_0x595257(0x136)]&&(_0x20c06e='type3',_0x5a7a04=_0x595257(0x2cf),_0x1734c8=_0x595257(0x1db));}if(_0x58b545[_0x595257(0x2da)](_0x5bacbd))_0x5a7a04=_0x5a7a04+0x1;else{if(_0x587bb7[_0x595257(0x2da)](_0x5bacbd))_0x5a7a04=_0x5a7a04+0x2;else _0x3d7e4a[_0x595257(0x2da)](_0x5bacbd)&&(_0x5a7a04=_0x5a7a04+0x3);}const _0x30cb8c=await this[_0x595257(0x24d)][_0x595257(0x26f)]('MjLeavelRel');let _0x14939b={};if(!_0x30cb8c){let _0x21a334=await this['globalConfigService'][_0x595257(0x2f8)]([_0x5a7a04,_0x1734c8]);for(let _0x48464f in _0x21a334){_0x14939b[_0x48464f]=Number(_0x21a334[_0x48464f])||0x0;}if(_0x4ef5da[_0x595257(0x12d)]){const _0x2ab916=await this[_0x595257(0x1af)][_0x595257(0x2d4)](_0x4ef5da['vipLeavelId'],'mj');_0x2ab916&&(_0x14939b[_0x1734c8]=_0x2ab916[_0x20c06e]||0x0);}}else{const _0x2847f7=_0x4ef5da['vipLeavelName']||'';_0x14939b=_0x30cb8c['mjLeavelRel'][_0x2847f7],(!_0x14939b||!_0x14939b[_0x595257(0x1e9)])&&(_0x14939b=_0x30cb8c[_0x595257(0x263)][_0x595257(0x236)]);}for(let _0x2069ea in midjourney_constant_1['ActionCN']){if(_0x5bacbd[_0x595257(0x28b)](midjourney_constant_1['ActionCN'][_0x2069ea][_0x595257(0x1f2)])){_0x2b39c5=midjourney_constant_1[_0x595257(0x1dd)][_0x2069ea]['cn'];break;}}return{'price':Number(_0x14939b[_0x5a7a04]),'vipFreeNum':Number(_0x14939b[_0x1734c8]),'vipFreeKey':_0x1734c8,'description':_0x2b39c5};}async['getMjUserModelPrice'](_0x562c08,_0x354bc8){const _0x245de2=_0x912465;try{let _0x26ba6d='Imagine';_0x354bc8[_0x245de2(0x259)]==0x5&&(_0x26ba6d=_0x245de2(0x13f));const _0x4da0f7=_0x354bc8[_0x245de2(0x1b6)];_0x4da0f7[_0x245de2(0x205)]&&(_0x26ba6d=_0x4da0f7[_0x245de2(0x205)]);const _0x129f45=await this[_0x245de2(0x2f6)](_0x562c08);let _0x489b00='',_0x2b7a0c='',_0x3634fc='',_0x33d019=_0x26ba6d;const _0x50c2db=_0x26ba6d[_0x245de2(0x1df)](),_0x332243=new RegExp(_0x245de2(0x2a1)),_0x504d78=new RegExp(_0x245de2(0x2b2)),_0x266048=new RegExp('fetch|listbyids|modal|seed');if(_0x4da0f7['mode']===midjourney_constant_1[_0x245de2(0x283)]['fast'])_0x2b7a0c=_0x245de2(0x159),_0x489b00=_0x245de2(0x2ae),_0x3634fc=_0x245de2(0x1e9);else{if(_0x4da0f7[_0x245de2(0x1a9)]===midjourney_constant_1[_0x245de2(0x283)]['relax'])_0x2b7a0c=_0x245de2(0x2b4),_0x489b00=_0x245de2(0x296),_0x3634fc=_0x245de2(0x188);else _0x4da0f7[_0x245de2(0x1a9)]===midjourney_constant_1['DrawSpeed'][_0x245de2(0x136)]&&(_0x2b7a0c='type3',_0x489b00=_0x245de2(0x2cf),_0x3634fc='turbo_vip_free');}if(_0x332243[_0x245de2(0x2da)](_0x50c2db))_0x489b00=_0x489b00+0x1;else{if(_0x504d78[_0x245de2(0x2da)](_0x50c2db))_0x489b00=_0x489b00+0x2;else _0x266048[_0x245de2(0x2da)](_0x50c2db)&&(_0x489b00=_0x489b00+0x3);}const _0x40559b=await this[_0x245de2(0x24d)][_0x245de2(0x26f)](_0x245de2(0x21b));let _0x5451c1={};if(!_0x40559b){let _0xe9264c=await this['globalConfigService']['getConfigByKeys']([_0x489b00,_0x3634fc]);for(let _0x2ce9e7 in _0xe9264c){_0x5451c1[_0x2ce9e7]=Number(_0xe9264c[_0x2ce9e7])||0x0;}if(_0x129f45?.['vipLeavelId']){const _0x1bd16d=await this['globalConfigService'][_0x245de2(0x2d4)](_0x129f45?.['vipLeavelId'],'mj');_0x1bd16d&&(_0x5451c1[_0x3634fc]=_0x1bd16d[_0x2b7a0c]||0x0);}}else{const _0x5ed595=_0x129f45?.[_0x245de2(0x2ca)]||'';_0x5451c1=_0x40559b[_0x245de2(0x263)][_0x5ed595],(!_0x5451c1||!_0x5451c1['fast_vip_free'])&&(_0x5451c1=_0x40559b['mjLeavelRel'][_0x245de2(0x236)]);}for(let _0x19edd5 in midjourney_constant_1[_0x245de2(0x1dd)]){if(_0x50c2db[_0x245de2(0x28b)](midjourney_constant_1[_0x245de2(0x1dd)][_0x19edd5][_0x245de2(0x1f2)])){_0x33d019=midjourney_constant_1[_0x245de2(0x1dd)][_0x19edd5]['cn'];break;}}console[_0x245de2(0x1b1)](_0x245de2(0x132),_0x5451c1[_0x3634fc]);if(_0x562c08<=0x0)return{'remainCount':0x0,'freeCount':Number(_0x5451c1[_0x3634fc]),'isVipFree':Number(_0x5451c1[_0x3634fc])==-0x1,'useIntegrate':Number(_0x5451c1[_0x489b00])};const _0x18005f=redisKey_constant_1[_0x245de2(0x2f7)]+'-'+_0x562c08+'-'+_0x3634fc;let _0x2f1f07=await this[_0x245de2(0x180)][_0x245de2(0x2fd)]({'key':_0x18005f}),_0x875c9b=Number(_0x2f1f07||0x0);return{'remainCount':Number(_0x5451c1[_0x3634fc])-_0x875c9b,'freeCount':Number(_0x5451c1[_0x3634fc]),'isVipFree':Number(_0x5451c1[_0x3634fc])==-0x1,'useIntegrate':Number(_0x5451c1[_0x489b00])};}catch(_0x3d67ac){return _0x3d67ac;}}async[_0x912465(0x309)](_0x224573,_0x9ccb8c,_0x1343d0,_0x41e6df){const _0x1c137f=_0x912465;let _0xdb50f9=!![];const _0x431113=await this[_0x1c137f(0x2f6)](_0x224573);if(_0x431113['lifetimeVip']||_0x431113['vipExpire']){if(_0x1343d0<0x0)_0xdb50f9=!![];else{if(_0x1343d0>0x0){const _0x25f572=redisKey_constant_1['VIP_FREE']+'-'+_0x224573+'-'+_0x9ccb8c;let _0x5dc6fc=await this[_0x1c137f(0x180)][_0x1c137f(0x2fd)]({'key':_0x25f572}),_0x3bfc6f=Number(_0x5dc6fc||0x0);_0x3bfc6f<_0x1343d0?_0xdb50f9=!![]:_0xdb50f9=_0x431113[_0x1c137f(0x325)]>=_0x41e6df;}else _0xdb50f9=_0x431113['score']>=_0x41e6df;}}else _0xdb50f9=_0x431113[_0x1c137f(0x325)]>=_0x41e6df;if(!_0xdb50f9)throw new common_1[(_0x1c137f(0x320))](_0x1c137f(0x15f),common_1[_0x1c137f(0x22f)][_0x1c137f(0x1d7)]);}async[_0x912465(0x141)](_0x35a806,_0x15a1ac=midjourney_constant_1['DrawSpeed'][_0x912465(0x1bb)],_0x590ee2){const _0x4bbefb=_0x912465;let _0x3c7633=!![];const _0x313579=await this[_0x4bbefb(0x2f6)](_0x35a806),_0x32f4fa=await this[_0x4bbefb(0x202)](_0x15a1ac,_0x590ee2,_0x313579);console['log'](_0x4bbefb(0x2f4),_0x32f4fa);if(_0x313579[_0x4bbefb(0x241)]||_0x313579[_0x4bbefb(0x184)]){if(_0x32f4fa[_0x4bbefb(0x253)]<0x0)_0x3c7633=!![];else{if(_0x32f4fa['vipFreeNum']>0x0){const _0x2928e8=redisKey_constant_1[_0x4bbefb(0x2f7)]+'-'+_0x35a806+'-'+_0x32f4fa[_0x4bbefb(0x157)];let _0x2e03e7=await this[_0x4bbefb(0x180)][_0x4bbefb(0x2fd)]({'key':_0x2928e8}),_0x2a44f6=Number(_0x2e03e7||0x0);_0x2a44f6<_0x32f4fa[_0x4bbefb(0x253)]?_0x3c7633=!![]:_0x3c7633=_0x313579['score']>=_0x32f4fa['price'];}else _0x3c7633=_0x313579[_0x4bbefb(0x325)]>=_0x32f4fa[_0x4bbefb(0x175)];}}else _0x3c7633=_0x313579[_0x4bbefb(0x325)]>=_0x32f4fa[_0x4bbefb(0x175)];if(_0x15a1ac===midjourney_constant_1['DrawSpeed'][_0x4bbefb(0x1bb)]){if(!_0x3c7633)throw new common_1['HttpException'](_0x4bbefb(0x15f),common_1['HttpStatus'][_0x4bbefb(0x1d7)]);}else{if(!_0x3c7633)return this[_0x4bbefb(0x141)](_0x35a806,midjourney_constant_1[_0x4bbefb(0x283)][_0x4bbefb(0x1bb)],_0x590ee2);}return _0x15a1ac;}async['deductBalance4MJ'](_0x202001,_0xc51cf9,_0x37a323,_0x8fbbca){const _0x3e5e6c=_0x912465,_0x1f19e9=await this[_0x3e5e6c(0x2f6)](_0x202001),_0x363af0=await this[_0x3e5e6c(0x202)](_0xc51cf9,_0x37a323,_0x1f19e9),_0x25649b=balance_constant_1[_0x3e5e6c(0x2ff)][_0x3e5e6c(0x2c2)];if(_0x1f19e9[_0x3e5e6c(0x241)]||_0x1f19e9[_0x3e5e6c(0x184)]){if(_0x363af0[_0x3e5e6c(0x253)]<0x0)await this[_0x3e5e6c(0x29c)](_0x1f19e9,_0x25649b,0x0,'MJ绘画【'+_0x363af0[_0x3e5e6c(0x195)]+_0x3e5e6c(0x20e),_0x8fbbca);else{if(_0x363af0['vipFreeNum']>0x0){const _0x3c9023=redisKey_constant_1[_0x3e5e6c(0x2f7)]+'-'+_0x202001+'-'+_0x363af0['vipFreeKey'];let _0x12e29c=await this[_0x3e5e6c(0x180)][_0x3e5e6c(0x2fd)]({'key':_0x3c9023}),_0x181aa4=Number(_0x12e29c||0x0);if(_0x181aa4<_0x363af0[_0x3e5e6c(0x253)]){const _0x210bdb=(0x0,date_1[_0x3e5e6c(0x1d1)])()[_0x3e5e6c(0x318)]('d')[_0x3e5e6c(0x2e2)]((0x0,date_1['default'])(),'s');await this[_0x3e5e6c(0x180)][_0x3e5e6c(0x20f)]({'key':_0x3c9023,'val':_0x181aa4+0x1},_0x210bdb),await this[_0x3e5e6c(0x29c)](_0x1f19e9,_0x25649b,0x0,_0x3e5e6c(0x1a5)+_0x363af0[_0x3e5e6c(0x195)]+_0x3e5e6c(0x2d6),_0x8fbbca);}else await this[_0x3e5e6c(0x29c)](_0x1f19e9,_0x25649b,-_0x363af0[_0x3e5e6c(0x175)],_0x3e5e6c(0x1a5)+_0x363af0[_0x3e5e6c(0x195)]+'】使用扣减',_0x8fbbca);}else await this[_0x3e5e6c(0x29c)](_0x1f19e9,_0x25649b,-_0x363af0[_0x3e5e6c(0x175)],_0x3e5e6c(0x1a5)+_0x363af0['description']+'】使用扣减',_0x8fbbca);}}else await this[_0x3e5e6c(0x29c)](_0x1f19e9,_0x25649b,-_0x363af0['price'],_0x3e5e6c(0x1a5)+_0x363af0[_0x3e5e6c(0x195)]+'】使用扣减',_0x8fbbca);}async[_0x912465(0x199)](_0x304f1f,_0xf657ea,_0x5a0a19,_0x1c29b3){const _0x3ac01f=_0x912465,_0x419703=await this[_0x3ac01f(0x2f6)](_0x304f1f),_0xede88=await this[_0x3ac01f(0x202)](_0xf657ea,_0x5a0a19,_0x419703),_0x4f844e=balance_constant_1['EChangeType'][_0x3ac01f(0x2c2)];if(_0x419703[_0x3ac01f(0x241)]||_0x419703['vipExpire']){if(_0xede88[_0x3ac01f(0x253)]<0x0)return;else{if(_0xede88[_0x3ac01f(0x253)]>0x0){const _0x49fa51=redisKey_constant_1[_0x3ac01f(0x2f7)]+'-'+_0x304f1f+'-'+_0xede88[_0x3ac01f(0x157)];let _0x2979d8=await this[_0x3ac01f(0x180)]['get']({'key':_0x49fa51}),_0x3a8e17=Number(_0x2979d8||0x0);if(_0x3a8e17<_0xede88['vipFreeNum']){const _0x41d7df=(0x0,date_1[_0x3ac01f(0x1d1)])()[_0x3ac01f(0x318)]('d')['diff']((0x0,date_1[_0x3ac01f(0x1d1)])(),'s');await this['redisCacheService'][_0x3ac01f(0x20f)]({'key':_0x49fa51,'val':_0x3a8e17-0x1},_0x41d7df);return;}}}}await this[_0x3ac01f(0x29c)](_0x419703,_0x4f844e,_0xede88[_0x3ac01f(0x175)],'MJ绘画【'+_0xede88[_0x3ac01f(0x195)]+_0x3ac01f(0x133),_0x1c29b3);}async[_0x912465(0x31e)](_0x441b0e,_0x410826,_0xe87ef4,_0x2f886c=![]){const _0x377e51=_0x912465,_0x2c886c={'create':{'key':'musicCreate','desc':'音乐创作'},'lyrics':{'key':_0x377e51(0x237),'desc':_0x377e51(0x2f9)},'upload':{'key':_0x377e51(0x23c),'desc':_0x377e51(0x15a)}},_0x5d6e44=_0x2c886c[_0xe87ef4][_0x377e51(0x328)],_0x3e7d84=_0x2c886c[_0xe87ef4][_0x377e51(0x28e)]+_0x377e51(0x162),_0x515e58=_0x2c886c[_0xe87ef4]['key']+_0x377e51(0x25c),_0x5e3bb6={},_0x222410=await this[_0x377e51(0x1af)][_0x377e51(0x2f8)]([_0x3e7d84,_0x515e58]);for(let _0x45a634 in _0x222410){_0x5e3bb6[_0x45a634]=Number(_0x222410[_0x45a634])||0x0;}const _0x2a4edf=await this[_0x377e51(0x2f6)](_0x441b0e);if(_0x2a4edf[_0x377e51(0x241)]||_0x2a4edf[_0x377e51(0x184)]){if(_0x5e3bb6[_0x515e58]<0x0){!_0x2f886c&&await this[_0x377e51(0x29c)](_0x2a4edf,balance_constant_1[_0x377e51(0x2ff)][_0x377e51(0x1cf)],0x0,'音乐【'+_0x5d6e44+_0x377e51(0x20e),_0x410826);return;}else{if(_0x5e3bb6[_0x515e58]>0x0){const _0x5966d4=redisKey_constant_1[_0x377e51(0x2f7)]+'-'+_0x441b0e+'-'+_0x515e58;let _0x2be1e4=await this['redisCacheService'][_0x377e51(0x2fd)]({'key':_0x5966d4}),_0x131855=Number(_0x2be1e4||0x0);if(!_0x2f886c){if(_0x131855<_0x5e3bb6[_0x515e58]){const _0x1e14e5=(0x0,date_1[_0x377e51(0x1d1)])()[_0x377e51(0x318)]('d')[_0x377e51(0x2e2)]((0x0,date_1[_0x377e51(0x1d1)])(),'s');await this['redisCacheService']['set']({'key':_0x5966d4,'val':_0x131855+0x1},_0x1e14e5),await this[_0x377e51(0x29c)](_0x2a4edf,balance_constant_1[_0x377e51(0x2ff)]['Music'],0x0,_0x377e51(0x1a2)+_0x5d6e44+_0x377e51(0x2d6),_0x410826);return;}}else{const _0x14d609=(0x0,date_1['default'])()[_0x377e51(0x318)]('d')[_0x377e51(0x2e2)]((0x0,date_1['default'])(),'s');await this[_0x377e51(0x180)][_0x377e51(0x20f)]({'key':_0x5966d4,'val':_0x131855-0x1},_0x14d609);return;}}}}if(!_0x2f886c&&_0x2a4edf[_0x377e51(0x325)]<_0x5e3bb6[_0x3e7d84])throw new common_1[(_0x377e51(0x320))](_0x377e51(0x15f),common_1[_0x377e51(0x22f)][_0x377e51(0x1d7)]);if(!_0x2f886c){await this['changeScore4Other'](_0x2a4edf,balance_constant_1[_0x377e51(0x2ff)][_0x377e51(0x1cf)],-_0x5e3bb6[_0x3e7d84],_0x377e51(0x1a2)+_0x5d6e44+'】使用扣减',_0x410826);return;}await this[_0x377e51(0x29c)](_0x2a4edf,balance_constant_1[_0x377e51(0x2ff)][_0x377e51(0x1cf)],_0x5e3bb6[_0x3e7d84],'音乐【'+_0x5d6e44+_0x377e51(0x245),_0x410826);}async[_0x912465(0x223)](_0x1d6dfe,_0x35b61e,_0x4b6887,_0xf5eaca=![]){const _0x176cfa=_0x912465,_0x15e1f8={'structure':{'key':_0x176cfa(0x17f),'vlrk':_0x176cfa(0x159),'desc':_0x176cfa(0x290)},'cover':{'key':_0x176cfa(0x17f),'vlrk':'type1','desc':_0x176cfa(0x21a)},'recover':{'key':'pptOutline','vlrk':_0x176cfa(0x159),'desc':_0x176cfa(0x295)},'create':{'key':_0x176cfa(0x293),'vlrk':_0x176cfa(0x2b4),'desc':'模板生成PPT'},'thesis':{'key':'pptThesis','vlrk':_0x176cfa(0x27d),'desc':_0x176cfa(0x2d5)},'file':{'key':_0x176cfa(0x293),'vlrk':'type2','desc':_0x176cfa(0x1e0)},'theme':{'key':_0x176cfa(0x293),'vlrk':_0x176cfa(0x2b4),'desc':'更换模板'},'editor':{'key':_0x176cfa(0x1aa),'vlrk':_0x176cfa(0x159),'desc':_0x176cfa(0x1d4)},'addpage':{'key':_0x176cfa(0x293),'vlrk':_0x176cfa(0x2b4),'desc':_0x176cfa(0x279)},'addNotes':{'key':'pptCreate','vlrk':_0x176cfa(0x2b4),'desc':_0x176cfa(0x218)}},_0x38f8f9=_0x15e1f8[_0x4b6887][_0x176cfa(0x328)],_0x50600b=_0x15e1f8[_0x4b6887][_0x176cfa(0x28e)]+_0x176cfa(0x162),_0x475560=_0x15e1f8[_0x4b6887][_0x176cfa(0x28e)]+_0x176cfa(0x25c),_0x54d2ae={},_0x3bc2fd=await this[_0x176cfa(0x1af)][_0x176cfa(0x2f8)]([_0x50600b,_0x475560]);for(let _0x4c0a0a in _0x3bc2fd){_0x54d2ae[_0x4c0a0a]=Number(_0x3bc2fd[_0x4c0a0a])||0x0;}const _0x7c6c6e=await this[_0x176cfa(0x2f6)](_0x1d6dfe);if(_0x7c6c6e[_0x176cfa(0x12d)]){const _0x2f9fd5=await this[_0x176cfa(0x1af)][_0x176cfa(0x2d4)](_0x7c6c6e[_0x176cfa(0x12d)],model_constant_1[_0x176cfa(0x13d)][_0x176cfa(0x22c)]);_0x2f9fd5&&(_0x54d2ae[_0x475560]=_0x2f9fd5[_0x15e1f8[_0x4b6887][_0x176cfa(0x1f5)]]||0x0);}if(_0x7c6c6e[_0x176cfa(0x241)]||_0x7c6c6e[_0x176cfa(0x184)]){if(_0x54d2ae[_0x475560]<0x0){!_0xf5eaca&&await this[_0x176cfa(0x29c)](_0x7c6c6e,balance_constant_1['EChangeType'][_0x176cfa(0x22c)],0x0,'PPT【'+_0x38f8f9+'】会员永久免费',_0x35b61e);return;}else{if(_0x54d2ae[_0x475560]>0x0){const _0x252ea4=redisKey_constant_1[_0x176cfa(0x2f7)]+'-'+_0x1d6dfe+'-'+_0x475560;let _0x514711=await this[_0x176cfa(0x180)][_0x176cfa(0x2fd)]({'key':_0x252ea4}),_0x2f096f=Number(_0x514711||0x0);if(!_0xf5eaca){if(_0x2f096f<_0x54d2ae[_0x475560]){const _0x6ad00c=(0x0,date_1[_0x176cfa(0x1d1)])()[_0x176cfa(0x318)]('d')['diff']((0x0,date_1[_0x176cfa(0x1d1)])(),'s');await this[_0x176cfa(0x180)]['set']({'key':_0x252ea4,'val':_0x2f096f+0x1},_0x6ad00c),await this[_0x176cfa(0x29c)](_0x7c6c6e,balance_constant_1[_0x176cfa(0x2ff)][_0x176cfa(0x22c)],0x0,_0x176cfa(0x2fa)+_0x38f8f9+'】会员每日限免',_0x35b61e);return;}}else{const _0x27d5f0=(0x0,date_1['default'])()[_0x176cfa(0x318)]('d')[_0x176cfa(0x2e2)]((0x0,date_1[_0x176cfa(0x1d1)])(),'s');await this[_0x176cfa(0x180)][_0x176cfa(0x20f)]({'key':_0x252ea4,'val':_0x2f096f-0x1},_0x27d5f0);return;}}}}if(!_0xf5eaca&&_0x7c6c6e[_0x176cfa(0x325)]<_0x54d2ae[_0x50600b])throw new common_1['HttpException'](_0x176cfa(0x15f),common_1[_0x176cfa(0x22f)][_0x176cfa(0x1d7)]);if(!_0xf5eaca){await this[_0x176cfa(0x29c)](_0x7c6c6e,balance_constant_1[_0x176cfa(0x2ff)][_0x176cfa(0x22c)],-_0x54d2ae[_0x50600b],'PPT【'+_0x38f8f9+'】使用扣减',_0x35b61e);return;}await this[_0x176cfa(0x29c)](_0x7c6c6e,balance_constant_1[_0x176cfa(0x2ff)][_0x176cfa(0x22c)],_0x54d2ae[_0x50600b],_0x176cfa(0x2fa)+_0x38f8f9+_0x176cfa(0x245),_0x35b61e);}async['deductBalance4WorkFlow'](_0x334f2c,_0x11d33c,_0x10b953){const _0x1c5d3c=_0x912465,_0x27548e=await this[_0x1c5d3c(0x2f6)](_0x334f2c);if(_0x27548e[_0x1c5d3c(0x241)]||_0x27548e[_0x1c5d3c(0x184)]){if(_0x11d33c[_0x1c5d3c(0x253)]<0x0)await this['changeScore4Other'](_0x27548e,balance_constant_1[_0x1c5d3c(0x2ff)][_0x1c5d3c(0x206)],0x0,_0x1c5d3c(0x1c0)+_0x11d33c[_0x1c5d3c(0x238)]+_0x1c5d3c(0x20e),_0x10b953);else{if(_0x11d33c[_0x1c5d3c(0x253)]>0x0){const _0x463859=redisKey_constant_1[_0x1c5d3c(0x2f7)]+'-'+_0x334f2c+'-'+_0x11d33c['id'];let _0x2397e4=await this[_0x1c5d3c(0x180)][_0x1c5d3c(0x2fd)]({'key':_0x463859}),_0x44e274=Number(_0x2397e4||0x0);if(_0x44e274<_0x11d33c[_0x1c5d3c(0x253)]){const _0x38cf09=(0x0,date_1[_0x1c5d3c(0x1d1)])()[_0x1c5d3c(0x318)]('d')[_0x1c5d3c(0x2e2)]((0x0,date_1['default'])(),'s');await this['redisCacheService'][_0x1c5d3c(0x20f)]({'key':_0x463859,'val':_0x44e274+0x1},_0x38cf09),await this[_0x1c5d3c(0x29c)](_0x27548e,balance_constant_1[_0x1c5d3c(0x2ff)][_0x1c5d3c(0x206)],0x0,_0x1c5d3c(0x1c0)+_0x11d33c['modelName']+'】会员每日限免',_0x10b953);}else{if(_0x27548e['score']<_0x11d33c['deduct'])throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0x1c5d3c(0x22f)][_0x1c5d3c(0x1d7)]);await this['changeScore4Other'](_0x27548e,balance_constant_1[_0x1c5d3c(0x2ff)][_0x1c5d3c(0x206)],-_0x11d33c[_0x1c5d3c(0x2d3)],_0x1c5d3c(0x1c0)+_0x11d33c[_0x1c5d3c(0x238)]+_0x1c5d3c(0x2a6),_0x10b953);}}else{if(_0x27548e['score']<_0x11d33c['deduct'])throw new common_1[(_0x1c5d3c(0x320))]('用户余额不足，请充值',common_1[_0x1c5d3c(0x22f)][_0x1c5d3c(0x1d7)]);await this[_0x1c5d3c(0x29c)](_0x27548e,balance_constant_1[_0x1c5d3c(0x2ff)][_0x1c5d3c(0x206)],-_0x11d33c[_0x1c5d3c(0x2d3)],'小工具【'+_0x11d33c[_0x1c5d3c(0x238)]+_0x1c5d3c(0x2a6),_0x10b953);}}}else{if(_0x27548e[_0x1c5d3c(0x325)]<_0x11d33c[_0x1c5d3c(0x2d3)])throw new common_1[(_0x1c5d3c(0x320))](_0x1c5d3c(0x15f),common_1[_0x1c5d3c(0x22f)][_0x1c5d3c(0x1d7)]);await this[_0x1c5d3c(0x29c)](_0x27548e,balance_constant_1['EChangeType'][_0x1c5d3c(0x206)],-_0x11d33c[_0x1c5d3c(0x2d3)],_0x1c5d3c(0x1c0)+_0x11d33c[_0x1c5d3c(0x238)]+_0x1c5d3c(0x2a6),_0x10b953);}}async['deductBalance4SD'](_0x31b420,_0x5b4146){const _0x39e720=_0x912465,_0x5d5ab3=store_1[_0x39e720(0x276)][_0x39e720(0x2b3)],_0xe0fc88=await this[_0x39e720(0x2f6)](_0x31b420),_0x51936b=balance_constant_1[_0x39e720(0x2ff)]['SD'];if(_0xe0fc88[_0x39e720(0x241)]||_0xe0fc88[_0x39e720(0x184)]){if(store_1[_0x39e720(0x276)][_0x39e720(0x1d8)]<0x0)await this[_0x39e720(0x29c)](_0xe0fc88,_0x51936b,0x0,_0x39e720(0x24a),_0x5b4146);else{if(store_1[_0x39e720(0x276)][_0x39e720(0x1d8)]>0x0){const _0x582181=redisKey_constant_1[_0x39e720(0x2f7)]+'-'+_0x31b420+_0x39e720(0x246);let _0x3654cb=await this[_0x39e720(0x180)]['get']({'key':_0x582181}),_0x27a35f=Number(_0x3654cb||0x0);if(_0x27a35f<store_1[_0x39e720(0x276)][_0x39e720(0x1d8)]){const _0x27989d=(0x0,date_1[_0x39e720(0x1d1)])()['endOf']('d')['diff']((0x0,date_1[_0x39e720(0x1d1)])(),'s');await this[_0x39e720(0x180)][_0x39e720(0x20f)]({'key':_0x582181,'val':_0x27a35f+0x1},_0x27989d),await this[_0x39e720(0x29c)](_0xe0fc88,_0x51936b,0x0,_0x39e720(0x2ef)+_0x5d5ab3+'】会员每日限免',_0x5b4146);}else await this[_0x39e720(0x29c)](_0xe0fc88,_0x51936b,-_0x5d5ab3,_0x39e720(0x2ef)+_0x5d5ab3+_0x39e720(0x2a6),_0x5b4146);}else await this['changeScore4Other'](_0xe0fc88,_0x51936b,-_0x5d5ab3,'SD绘画【'+_0x5d5ab3+_0x39e720(0x2a6),_0x5b4146);}}else await this[_0x39e720(0x29c)](_0xe0fc88,_0x51936b,-_0x5d5ab3,_0x39e720(0x2ef)+_0x5d5ab3+_0x39e720(0x2a6),_0x5b4146);}async[_0x912465(0x243)](_0x2fd561){const _0x33602d=_0x912465;let _0x174c59;const _0x56e173=await this['configService']['getValue'](_0x33602d(0x1fc));if(_0x56e173)return _0x56e173[_0x33602d(0x1c1)][_0x2fd561];return _0x174c59;}async[_0x912465(0x316)](_0x104880,_0x9a5c84){const _0xbc4135=_0x912465,_0x58841a=this[_0xbc4135(0x243)](_0x9a5c84);if(!_0x58841a)return 0x0;const _0x5134c1=redisKey_constant_1[_0xbc4135(0x2f7)]+'-'+_0x104880+'-'+_0x9a5c84;let _0x69ab3d=await this[_0xbc4135(0x180)][_0xbc4135(0x2fd)]({'key':_0x5134c1}),_0x53d117=Number(_0x69ab3d||0x0);return _0x53d117;}async[_0x912465(0x182)](_0x1aac72,_0x40255c){const _0x5a81a5=_0x912465,_0x280e97=redisKey_constant_1[_0x5a81a5(0x2f7)]+'-'+_0x1aac72+'-'+_0x40255c['id'];let _0x2a9bf4=await this[_0x5a81a5(0x180)][_0x5a81a5(0x2fd)]({'key':_0x280e97}),_0x545788=Number(_0x2a9bf4||0x0);return _0x40255c[_0x5a81a5(0x253)]-_0x545788;}async['getVideoConfig'](_0x4f8e80,_0xe8424c){const _0x3de49f=_0x912465;let _0x48bf19;const _0x18a30f=await this[_0x3de49f(0x24d)][_0x3de49f(0x26f)](_0x3de49f(0x312));if(_0x18a30f){const _0x5abc4c=_0x18a30f[_0x3de49f(0x24f)][_0x4f8e80[_0x3de49f(0x16f)][_0x3de49f(0x27f)]()];let _0xe77522=_0xe8424c[_0x3de49f(0x1a9)],_0x2051c0=_0xe8424c[_0x3de49f(0x1f6)];_0x48bf19=_0x5abc4c['find'](_0x4bda1f=>_0x4bda1f[_0x3de49f(0x232)]==_0xe8424c[_0x3de49f(0x232)]&&_0x4bda1f[_0x3de49f(0x1a9)]==_0xe77522&&_0x4bda1f[_0x3de49f(0x1f6)]==_0x2051c0);}return _0x48bf19;}async[_0x912465(0x2bf)](_0x45ec88,_0x3587c6,_0x2a28ed){const _0x5c5408=_0x912465;let _0x1fdd4c=await this[_0x5c5408(0x32d)](_0x3587c6,_0x2a28ed);if(!_0x1fdd4c)return await this[_0x5c5408(0x182)](_0x45ec88,_0x3587c6);const _0x3dc567=redisKey_constant_1[_0x5c5408(0x2f7)]+'-'+_0x45ec88+'-'+_0x1fdd4c[_0x5c5408(0x232)]+'-'+_0x1fdd4c['mode']+'-'+_0x1fdd4c[_0x5c5408(0x1f6)];let _0x33929a=await this['redisCacheService'][_0x5c5408(0x2fd)]({'key':_0x3dc567}),_0xe7114c=Number(_0x33929a||0x0);return _0x1fdd4c[_0x5c5408(0x253)]-_0xe7114c;}async[_0x912465(0x21f)](_0x48741e,_0x181dff){const _0x3a6ebb=_0x912465,_0x42b949=redisKey_constant_1[_0x3a6ebb(0x2f7)]+'-'+_0x48741e+'-'+_0x181dff['model'];let _0x58d5ed=await this[_0x3a6ebb(0x180)][_0x3a6ebb(0x2fd)]({'key':_0x42b949}),_0x583417=Number(_0x58d5ed||0x0);return _0x181dff[_0x3a6ebb(0x253)]-_0x583417;}async[_0x912465(0x134)](_0x305e10,_0x464bf7,_0xc0d75){const _0x213224=_0x912465,_0xfcd907=redisKey_constant_1[_0x213224(0x2f7)]+'-'+_0x305e10+'-'+_0x464bf7;let _0x4ae7b2=await this[_0x213224(0x180)][_0x213224(0x2fd)]({'key':_0xfcd907}),_0x93c48d=Number(_0x4ae7b2||0x0);return _0xc0d75-_0x93c48d;}async[_0x912465(0x226)](_0x326202){const _0x41edb7=_0x912465,_0x5211ce=redisKey_constant_1[_0x41edb7(0x2f7)]+'-'+_0x326202+_0x41edb7(0x18b);let _0xa3d3ac=await this[_0x41edb7(0x180)][_0x41edb7(0x2fd)]({'key':_0x5211ce}),_0x131c70=Number(_0xa3d3ac||0x0);return store_1[_0x41edb7(0x1a6)][_0x41edb7(0x32e)]-_0x131c70;}async[_0x912465(0x197)](_0x4e59d8,_0x2919be,_0x349a7a){const _0x539bd6=_0x912465;let _0x4e94e1=await this['redisCacheService'][_0x539bd6(0x2fd)]({'key':_0x2919be}),_0x42dbd6=Number(_0x4e94e1||0x0);return _0x349a7a-_0x42dbd6;}async['validateBalanceLinxFox'](_0x1b0920){const _0x2c8374=_0x912465;let _0x234147=!![];const _0x3b1362=await this[_0x2c8374(0x2f6)](_0x1b0920);if(_0x3b1362['lifetimeVip']||_0x3b1362[_0x2c8374(0x184)]){if(store_1[_0x2c8374(0x1a6)][_0x2c8374(0x32e)]<0x0)_0x234147=!![];else{if(store_1[_0x2c8374(0x1a6)][_0x2c8374(0x32e)]>0x0){const _0x3d9d32=await this['getLfVipFree'](_0x1b0920);_0x3d9d32>0x0?_0x234147=!![]:_0x234147=_0x3b1362[_0x2c8374(0x325)]>=store_1[_0x2c8374(0x1a6)][_0x2c8374(0x275)];}else _0x234147=_0x3b1362[_0x2c8374(0x325)]>=store_1['LinkFoxConfig'][_0x2c8374(0x275)];}}else _0x234147=_0x3b1362[_0x2c8374(0x325)]>=store_1['LinkFoxConfig']['lfPrice'];if(!_0x234147)throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0x2c8374(0x22f)][_0x2c8374(0x1d7)]);}async[_0x912465(0x1fa)](_0x253a4b,_0x19bf47){const _0x4eddc5=_0x912465,_0x55d105=store_1[_0x4eddc5(0x1a6)][_0x4eddc5(0x275)],_0x591148=await this['getUserById'](_0x253a4b),_0x310566=balance_constant_1[_0x4eddc5(0x2ff)][_0x4eddc5(0x1dc)];if(_0x591148[_0x4eddc5(0x241)]||_0x591148['vipExpire']){if(store_1[_0x4eddc5(0x1a6)][_0x4eddc5(0x32e)]<0x0)await this['changeScore4Other'](_0x591148,_0x310566,0x0,_0x4eddc5(0x2e5),_0x19bf47);else{if(store_1[_0x4eddc5(0x1a6)][_0x4eddc5(0x32e)]>0x0){const _0x495367=redisKey_constant_1['VIP_FREE']+'-'+_0x253a4b+_0x4eddc5(0x18b);let _0x58598a=await this[_0x4eddc5(0x180)]['get']({'key':_0x495367}),_0xc434a8=Number(_0x58598a||0x0);if(_0xc434a8<store_1[_0x4eddc5(0x1a6)][_0x4eddc5(0x32e)]){const _0xad5baa=(0x0,date_1[_0x4eddc5(0x1d1)])()['endOf']('d')['diff']((0x0,date_1[_0x4eddc5(0x1d1)])(),'s');await this[_0x4eddc5(0x180)]['set']({'key':_0x495367,'val':_0xc434a8+0x1},_0xad5baa),await this[_0x4eddc5(0x29c)](_0x591148,_0x310566,0x0,'LinxFox【'+_0x55d105+_0x4eddc5(0x2d6),_0x19bf47);}else await this[_0x4eddc5(0x29c)](_0x591148,_0x310566,-_0x55d105,_0x4eddc5(0x196)+_0x55d105+_0x4eddc5(0x2a6),_0x19bf47);}else await this[_0x4eddc5(0x29c)](_0x591148,_0x310566,-_0x55d105,_0x4eddc5(0x196)+_0x55d105+_0x4eddc5(0x2a6),_0x19bf47);}}else await this[_0x4eddc5(0x29c)](_0x591148,_0x310566,-_0x55d105,_0x4eddc5(0x196)+_0x55d105+_0x4eddc5(0x2a6),_0x19bf47);}async['updateVipExpire2Redis'](){const _0x1bd878=_0x912465,_0x808037=await this[_0x1bd878(0x1ee)][_0x1bd878(0x1eb)]({'where':{'vipExpire':(0x0,typeorm_2[_0x1bd878(0x2d9)])((0x0,date_1[_0x1bd878(0x1d1)])()[_0x1bd878(0x19e)]('d')[_0x1bd878(0x2e8)](),(0x0,date_1[_0x1bd878(0x1d1)])()[_0x1bd878(0x318)]('d')['toDate']())}});if(_0x808037['length'])for(let _0x45653b=0x0;_0x45653b<_0x808037[_0x1bd878(0x304)];_0x45653b++){const _0x3733e5=_0x808037[_0x45653b];await this['redisCacheService'][_0x1bd878(0x20f)]({'key':redisKey_constant_1[_0x1bd878(0x256)]+_0x3733e5['id'],'val':''},(0x0,date_1['default'])()[_0x1bd878(0x318)]('d')[_0x1bd878(0x2e2)]((0x0,date_1[_0x1bd878(0x1d1)])(),'s'));}const _0x2d1e82=await this[_0x1bd878(0x1ee)][_0x1bd878(0x1eb)]({'where':{'vipExpire':(0x0,typeorm_2[_0x1bd878(0x1e4)])((0x0,date_1[_0x1bd878(0x1d1)])()[_0x1bd878(0x2e8)]())}});if(_0x2d1e82['length']){const _0x3417c5=_0x2d1e82[_0x1bd878(0x272)](_0x1c90c0=>_0x1c90c0['id']);await this[_0x1bd878(0x1ee)][_0x1bd878(0x173)]({'id':(0x0,typeorm_2['In'])(_0x3417c5)},{'vipExpire':null});}}async[_0x912465(0x30a)](_0x4e9942,_0x423b2f,_0x91e9b9){const _0xf7b257=_0x912465,_0x46c878=(0x0,utils_1[_0xf7b257(0x1e6)])(this['clsService']),_0x13fbed=await this[_0xf7b257(0x282)][_0xf7b257(0x2db)]({'where':{'userId':_0x4e9942,'relId':_0x423b2f,'relType':_0x91e9b9,'saasId':_0x46c878}});if(_0x13fbed)throw new common_1['HttpException'](_0xf7b257(0x2be),common_1[_0xf7b257(0x22f)][_0xf7b257(0x1d7)]);else await this['userCollectEntity'][_0xf7b257(0x29a)]({'userId':_0x4e9942,'relId':_0x423b2f,'relType':_0x91e9b9,'sassId':_0x46c878});}async[_0x912465(0x154)](_0x18e942,_0x5c0a1d,_0x264675){const _0x148142=_0x912465,_0x2d4aee=(0x0,utils_1[_0x148142(0x1e6)])(this[_0x148142(0x314)]),_0xec0da9=await this[_0x148142(0x282)]['findOne']({'where':{'userId':_0x18e942,'relId':_0x5c0a1d,'relType':_0x264675,'saasId':_0x2d4aee}});if(!_0xec0da9)throw new common_1[(_0x148142(0x320))](_0x148142(0x2c9),common_1['HttpStatus']['BAD_REQUEST']);else await this[_0x148142(0x282)]['delete']({'id':_0xec0da9['id']});}async['uncollectByRelIds'](_0x139f07,_0x881ade){const _0x1c8b57=_0x912465,_0x188398=(0x0,utils_1[_0x1c8b57(0x1e6)])(this[_0x1c8b57(0x314)]);_0x139f07[_0x1c8b57(0x15e)](_0x494f1a=>{const _0x2c7b5b=_0x1c8b57,_0x7162bc=Number(_0x494f1a);this[_0x2c7b5b(0x282)]['delete']({'relId':_0x7162bc,'relType':_0x881ade,'saasId':_0x188398});});}async['collectPage'](_0x220661,_0x2074e4,_0x630217,_0x4d6126){const _0x4fea28=_0x912465,_0x56787f=(0x0,utils_1[_0x4fea28(0x1e6)])(this[_0x4fea28(0x314)]),[_0x1fcd76,_0x813135]=await this['userCollectEntity']['findAndCount']({'where':{'userId':_0x630217,'relType':_0x4d6126,'saasId':_0x56787f},'take':_0x2074e4,'skip':(_0x220661-0x1)*_0x2074e4,'order':{'createdAt':_0x4fea28(0x1ab)}});return{'rows':_0x1fcd76,'count':_0x813135};}async[_0x912465(0x2e6)](_0x41066d,_0x3901a8,_0x4bad04){const _0x454db1=_0x912465,_0x1abaec=(0x0,utils_1[_0x454db1(0x1e6)])(this[_0x454db1(0x314)]);return await this[_0x454db1(0x282)]['find']({'where':{'userId':_0x3901a8,'relType':_0x4bad04,'saasId':_0x1abaec,'relId':(0x0,typeorm_2['In'])(_0x41066d)}});}async['collectList'](_0x7ef8e1,_0x295bd6){const _0x2eca81=_0x912465,_0x1b4ab2=(0x0,utils_1[_0x2eca81(0x1e6)])(this[_0x2eca81(0x314)]);return await this[_0x2eca81(0x282)][_0x2eca81(0x1eb)]({'where':{'relType':_0x295bd6,'saasId':_0x1b4ab2,'relId':(0x0,typeorm_2['In'])(_0x7ef8e1)}});}async['mergeCollectDataForUserId'](_0xf77ed9,_0x13e5f2,_0x3cda7a=collectType_constant_1['UserCollectType'][_0x912465(0x22c)]){const _0x25c8d6=_0x912465;let _0x3796f2=Object['assign'](_0xf77ed9),_0x38d252=[];return _0x13e5f2&&(_0x38d252=await this['collectListForUserID'](_0xf77ed9['map'](_0x21616c=>_0x21616c['id']),_0x13e5f2,_0x3cda7a)),_0x3796f2[_0x25c8d6(0x15e)](_0x5dbb42=>{const _0x285c4f=_0x25c8d6;_0x38d252[_0x285c4f(0x1eb)](_0x116a38=>_0x116a38[_0x285c4f(0x1ca)]==_0x5dbb42['id'])?_0x5dbb42['isCollect']=!![]:_0x5dbb42['isCollect']=![];}),_0x3796f2;}async[_0x912465(0x254)](_0x2667cc,_0x1aa27f,_0x238906=collectType_constant_1[_0x912465(0x16d)]['PPT']){const _0x524cb2=_0x912465;return this[_0x524cb2(0x26d)](_0x2667cc,_0x1aa27f[_0x524cb2(0x26e)]?.['id'],_0x238906);}async[_0x912465(0x17b)](_0x3984c4,_0x1301bb=collectType_constant_1[_0x912465(0x16d)][_0x912465(0x22c)]){const _0x16ac19=_0x912465;let _0x5243d7=Object[_0x16ac19(0x145)](_0x3984c4),_0x4b051e=[];return _0x4b051e=await this[_0x16ac19(0x227)](_0x3984c4[_0x16ac19(0x272)](_0x2e48b7=>_0x2e48b7['id']),_0x1301bb),_0x5243d7[_0x16ac19(0x15e)](_0x1ba9ef=>{const _0x3ddf6b=_0x16ac19;_0x1ba9ef['collectNum']=_0x4b051e[_0x3ddf6b(0x305)](_0x38b270=>_0x38b270[_0x3ddf6b(0x1ca)]==_0x1ba9ef['id'])[_0x3ddf6b(0x304)];}),_0x5243d7;}['getUserInfoFromHeader'](_0x7c117e){const _0x2fefac=_0x912465;let _0x3bab54=null;const _0x183523=_0x7c117e[_0x2fefac(0x25a)][_0x2fefac(0x19d)];if(_0x183523&&_0x183523[_0x2fefac(0x297)]('Bearer\x20')){const _0x36ba8e=_0x183523[_0x2fefac(0x2c4)](0x7);if(_0x36ba8e)try{_0x3bab54=jwt[_0x2fefac(0x299)](_0x36ba8e,process['env'][_0x2fefac(0x27e)]);}catch(_0x480abe){console[_0x2fefac(0x1b1)](_0x2fefac(0x280),_0x7c117e);}}return _0x3bab54;}};UserService=__decorate([(0x0,common_1[_0x912465(0x28f)])(),__param(0x0,(0x0,common_1[_0x912465(0x266)])('REDIS_SUBSCRIBER')),__param(0x1,(0x0,typeorm_1[_0x912465(0x2fe)])(user_entity_1[_0x912465(0x287)])),__param(0x2,(0x0,typeorm_1[_0x912465(0x2fe)])(saas_entity_1[_0x912465(0x1f4)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(role_entity_1[_0x912465(0x1bc)])),__param(0x4,(0x0,typeorm_1[_0x912465(0x2fe)])(user_init_vip_entity_1[_0x912465(0x20c)])),__param(0x5,(0x0,typeorm_1[_0x912465(0x2fe)])(userFavorite_entity_1[_0x912465(0x138)])),__param(0x6,(0x0,typeorm_1[_0x912465(0x2fe)])(userCollect_entity_1[_0x912465(0x21d)])),__metadata(_0x912465(0x12e),[Object,typeorm_2[_0x912465(0x1b9)],typeorm_2[_0x912465(0x1b9)],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x912465(0x1b9)],typeorm_2[_0x912465(0x1b9)],nestjs_cls_1['ClsService'],mailer_1[_0x912465(0x178)],redisCache_service_1[_0x912465(0x1bf)],userBalance_service_1[_0x912465(0x190)],globalConfig_service_1['GlobalConfigService'],verification_service_1[_0x912465(0x2e1)],cm_service_1[_0x912465(0x2b6)],typeorm_2[_0x912465(0x1b4)]])],UserService),exports[_0x912465(0x174)]=UserService;function _0x5d40(){const _0x3155bb=['disabled','Connection','../../common/constants/Role.constant','params','days','queryUserByUsername','Repository','GOMAXAI_HOST','relax','RoleEntity','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','client','RedisCacheService','小工具【','consumeConfig','updateRole','Registration','LOCKED','destroyAccount','relateId','Tts','PENDING','replace','relId','./entity/userCollect.entity','validateBalance4Human','invitedRewards','verificationService','Music','ACTIVE','default','deductBalance4Draw','roleSave','编辑PPT','修改用户角色失败！','AdminGift','BAD_REQUEST','czVipFree','decorate','%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','turbo_vip_free','LinkFox','ActionCN','36oqIrUi','toLowerCase','文件生成PPT','metadata','超级管理员','saasSave','LessThanOrEqual','10763830nmzDLU','getReqSaasId','账号注册时密码不能为空！','registerIp','fast_vip_free','favorite','find','./user.entity','UserStatusErrMsg','userEntity','userBalanceService','\x20AND\x20u.createdAt\x20<=\x20\x27','重置密码失败！','action','inviteRewardVip','SaasEntity','vlrk','duration','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','saasEntity','不可将用户置为未激活状态！','deductBalanceLinxFox','compareSync','HumanApiConfig','%\x27\x20OR\x20u.email\x20LIKE\x20\x27%','verifyUserRegisterByPhone','VIEWER','checkUserStatus','vipDays','getMjPrice','注册赠送','当前用户不存在！','customId','WORKFLOW','FILE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','该微信已绑定其他账号！','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','您的账户已被封禁、如有疑问、请联系管理员！','UserInitVipEntity','%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%','】会员永久免费','set','exists','\x20AND\x20u.createdAt\x20>=\x20\x27','用户名或者邮箱已被注册！','createBatch','数字人【','MUSIC','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','账号、手机、邮箱必须存在一个','增加PPT备注','非法访问','封面任务','MjLeavelRel','findAndCount','UserCollectEntity','isDefined','getDrawModelVipFree','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','已生成过邀请码、请勿重复生成','createUserAndVerifycation','debuctBalance4PPT','../../common/constants/collectType.constant','modelType','getLfVipFree','collectList','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','add','%\x27\x20OR\x20id\x20=\x20\x27','updateUserMiniOpenId','PPT','\x20AND\x20role\x20=\x20\x27','密码重置为[','HttpStatus','inviterPhone','pSubscribe','model','refundBalance4Human','changeScore4registe','userFavoriteEntity','体验会员','musicLyrics','modelName','saasMap','】调用失败退还','Coze','musicUpload','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','恭喜您绑定成功、后续可直接扫码登录了！','delUser','当前用户信息失效、请重新登录！','lifetimeVip','APP','getHumanConfig','还有用户使用相关角色，无法删除！','】生成失败退还','-SD','__param','VIDEO','getUserByInviteCode','SD绘画会员永久免费','./role.entity','5299028gLXyRJ','configService','rolePage','config','角色信息不存在！','queryUserInfoById','delete','vipFreeNum','mergeCollectData','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','VIP_EXPIRE','getInviteRecord','inviterEmail','type','headers','countByInviteCode','VipFree','../../common/constants/user.constant','updateSignDay','\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','未激活用户不可手动变更状态！','ids','mjLeavelRel','deductBalance4Chat','userId','Inject','模型【','Not','transaction','error:\x20','isVerifyEmail','修改密码失败、请重新试试吧。','mergeCollectDataForUserId','user','getValue','Human','updateViolationCount','map','../../common/utils','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','lfPrice','CZConfig','%\x27\x20)','\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)','增加PPT单页','code','inviteLink','邀请新用户注册奖励','type3','JWT_SECRET','toString','Failed\x20to\x20verify\x20JWT\x20token:','Registe','userCollectEntity','DrawSpeed','】失败退还','DRAW','size','UserEntity','受邀请注册赠送','inviteCode','@nestjs/common','includes','TTS','bcryptjs','key','Injectable','标题大纲任务','GPTS','Chat','pptCreate','Like','重新生成封面任务','relax_mjDeduction','startsWith','genInviteCode','verify','save','./../globalConfig/globalConfig.service','changeScore4Other','123456','resetUserPass','getUserUnionId','5372335QAYHVn','imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll','isSuper','favoriteListByTypeAndIds','increment','\x20AND\x20(username\x20LIKE\x20\x27%','】使用扣减','\x20AND\x20phone\x20LIKE\x20\x27%','\x20AND\x20saasId\x20=\x20','onModuleInit','__keyevent@0__:expired','affected','用户不存在！','userDefautlAvatar','fast_mjDeduction','nickname','%\x27\x20OR\x20nickname\x20LIKE\x20\x27%','管理员赠送','upscale|describe|picread::retry|faceswap|shorten','czProxyPrice','type2','邮箱格式错误！','CmConfigService','connection','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27','\x20OFFSET\x20','relateType','修改用户信息成功！','count','refundBalance4Video','您已经收藏过该内容','getVideoModelVipFree','openId','day','MjDraw','File','substring','registerVerifyExpir','hashSync','genUserNames','../cmConfig/cm.service','您还未收藏过该内容','vipLeavelName','\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL','accessLabel','ERole','../../common/constants/midjourney.constant','turbo_mjDeduction','name','genUserName','maskEmail','deduct','getVipLeavelRelById','论文生成PPT','】会员每日限免','前台用户','CHAT','Between','test','findOne','手机号已被使用！','createVerification','refundBalance4Chat','\x20AND\x20`status`\x20=\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','VerificationService','diff','mj-','InvitationReward','LinxFox会员永久免费','collectListForUserID','../../common/constants/model.constant','toDate','updateVipExpire','getSaasById','message','的账号激活','object','queryAll','SD绘画【','当前账户不存在！','isMobilePhone','registerBaseUrl','用户名\x09密码\x0a','------------------------Price--------------','getEntity','getUserById','VIP_FREE','getConfigByKeys','歌词生成','PPT【','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','get','InjectRepository','EChangeType','concat','then','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','UserStatusEnum','length','filter','roleEntity','AGENT','password','validateBalance4Coze','collect','getOpenIdByUserId','saasName','1489561xCxrMp','class-validator','用户名已被使用！','绑定微信失败、请联系管理员！','valueOf','AIVideoMutiConfig','HttpStatusCode','clsService','修改用户状态成功！','getHumanModelVipFree','getUserListByIds','endOf','updateUserOpenId','ListSaasByIds','validateBalance4Chat','queryOne','deductBalance4Coze','debuctBalance4Muisc','insertAccountLog','HttpException','push','UserService\x20Init','access','findBy','score','roleDel','maskIpAddress','desc','formatCreateOrUpdateDate','\x20AND\x20u.userId\x20=\x20','%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%','mailerService','getVideoConfig','lfVipFree','OTHER','lodash','Tool','role','\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','vipLeavelId','design:paramtypes','jsonwebtoken','修改用户信息失败！','avatar','----------YYYYYYYYYYYY--------------','】使用失败退费','getCozeModelVipFree','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','turbo','\x20AND\x20u.saasId\x20=\x20','UserFavoriteEntity',']成功!','../redisCache/redisCache.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','status','EModelType','SUPER','FaceSwap','miniOpenId','validateBalance4MJ','saasPage','createUser','当前角色编码不可用，请使用其他角色编码','assign','typeorm','mj123456admin','saasId不能为空！','getOne','zh-CN','floor','violationCount','has','registerRewards','clear','超级管理员不可被操作！','3eDrbUM','deductBalance4Human','updateUserPsd','uncollect','UNAUTHORIZED','修改用户角色成功！','vipFreeKey','num','type1','上传音乐','create','invitePage','getMiniOpenIdByUserId','forEach','用户余额不足，请充值','生成邀请码失败，请重新试一次吧！','AND\x20email\x20LIKE\x20\x27%','Price','inviteRewards','saasId','nestjs-cls','查询用户不存在！','initSaasMap','fetch|listbyids|modal|seed','isPlatform','username','当前手机号已注册、请勿重复注册！','updateUserPassword','UserCollectType','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','keyType','userInitVipEntity','当前密码错误！','cloneDeep','update','UserService','price','query','1288414kGQOJX','MailerService','Invited','inviteSendStatus','mergeCollectCountData','bindWx','代理商','email','pptOutline','redisCacheService','无效的邀请码！','getModelVipFree','yes','vipExpire','updateUserStatus','BadRequest','Draw','relax_vip_free','findByIds','subscriber','-LinkFox','isManage','registerVerifyEmailDesc','domain','7986776xXcROM','UserBalanceService','invitedRewardVip','axios','isEmail','queryUserInfoByIds','description','LinxFox【【','getKeyFree','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','refundBalance4MJ','phone','\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','186sVozqG','authorization','startOf','insertAccountVipLog','giftScore','../../common/utils/date','音乐【','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','407603QnstAk','MJ绘画【','LinkFoxConfig','validateBalance4Video','../../common/constants/verification.constant','mode','pptEditor','DESC','userInitVip','hideString','visitor','globalConfigService','lastLoginIp','log','verifyUserPassword'];_0x5d40=function(){return _0x3155bb;};return _0x5d40();}