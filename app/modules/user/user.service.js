'use strict';const _0x56b5f7=_0x5035;function _0x4beb(){const _0x45f106=['该微信已绑定其他账号！','APP','./user_init_vip.entity','SD绘画会员永久免费','__metadata','collectList','LOCKED','inviteRewardVip','defineProperty','getUserOpenId','registerRewards','findOne','模板生成PPT','4720715jZUZsy','】使用扣减','assign','action','axios','VIDEO','queryUserByUsername','getUserByInviteCode','HttpException','../../common/constants/collectType.constant','Tool','findBy','design:paramtypes','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','\x09mj123456admin\x0a','saasMap','邮箱已被使用！','queryOne','registerVerifyEmailDesc','destroyAccount','Chat','\x20AND\x20u.createdAt\x20>=\x20\x27','shouldAccess','音乐创作','verifyUserCredentials','小工具【','Invited','query','vlrk','CZConfig','】生成失败退还','musicCreate','pptThesis','%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%','name','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','queryByPage','File','vipFreeKey','type3','hideString','论文生成PPT','save','./user.entity','verificationService','%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%','MJ绘画【','InjectRepository','model','rolePage','turbo_vip_free','AGENT','log','UserStatusErrMsg','增加PPT单页','vipLeavelId','keyType','length','绑定微信失败、请联系管理员！','__param','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','status','\x20AND\x20saasId\x20=\x20','getUserById','concat','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','生成邀请码失败，请重新试一次吧！','./../globalConfig/globalConfig.service','giftVip','genUserNames','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27','管理员赠送','SaasEntity','用户名\x09密码\x0a','您的账户已被封禁、如有疑问、请联系管理员！','BAD_REQUEST','前台用户','音乐【','pptOutline','Repository','getLfVipFree','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','registerSendStatus','__esModule','ids','password','changeScore4Other','set','vipFreeNum','registerVerifyEmailFrom','updateViolationCount','isDefined','savaLoginIp','getOne','VerificationService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','lodash','vipDays','accessLabel','deductBalance4WorkFlow','您已经收藏过该内容','updateUserPsd','FILE','includes','userCollectEntity','AdminGift','修改用户信息失败！','./../verification/verification.service','visitor','lifetimeVip','vipExpire','affected','LinxFox【【','config','createdAt','deduct','getClientIp','validateBalance4Chat','ListSaasByIds','mjLeavelRel','userInitVipEntity','isInteger','env','MoreThan','userFavoriteEntity','relId','InvitationReward','SUPER','updateInfo','LinxFox【','AND\x20email\x20LIKE\x20\x27%','getVideoConfig','createBatch','formatCreateOrUpdateDate','当前用户信息失效、请重新登录！','mode','__keyevent@0__:expired','debuctBalance4Muisc','updateVipExpire','userCount','compareSync','test','mj-','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','1016154EwsDCy','MUSIC','relateType','FORBIDDEN','当前密码错误！','32087MPWJcY','findByIds','access','violationCount','8KtLTPA','delete','UserBalanceService','duration','deductBalance4Video','verifyUserPassword','modelName','toDate','imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll','UserFavoriteEntity','MjDraw','update','用户余额不足，请充值','inviteSendStatus','当前账户不存在！','insertAccountLog','体验会员','Price','账号注册时密码不能为空！','用户名或者邮箱已被注册！','registerIp','vipLeavelName','relateId','lfPrice','deductBalance4SD','超级管理员不可被操作！','UNAUTHORIZED','genInviteCode','getMjPrice','fast_vip_free','email','6NoqwuD','ClsService','CHAT','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27','】调用失败退还','favoriteListByTypeAndIds','mailerService','validateBalance4MJ','CmConfigService','账号、手机、邮箱必须存在一个','score','lastLoginIp','invitePage','修改用户信息成功！','push','countByInviteCode','PENDING','邮箱格式错误！','queryUserInfoByIds','getVideoModelVipFree',']成功!','czVipFree','mergeCollectData','\x20AND\x20username\x20LIKE\x20\x27%','修改用户角色成功！','7155288ezJbqz','BadRequest','邀请新用户注册奖励','getUserStatus','maskEmail','getOwnPropertyDescriptor','../../common/constants/model.constant','4XeHRjD','openId','isPlatform','标题大纲任务','redisCacheService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','PPT【','VIP_EXPIRE','saasId','metadata','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','userId','user','../../common/store','username','%\x27\x20OR\x20nickname\x20LIKE\x20\x27%','@nestjs/typeorm','upscale|describe|picread::retry|faceswap|shorten','code','8044680JOierl','UserService\x20Init','文件生成PPT','invitedRewards','查询用户不存在！','inviteRewards','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','角色信息不存在！','Connection','updateUserStatus','\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','maskIpAddress','key','keys','WORKFLOW','updateUserAppOpenId','Inject','updateUserMiniOpenId','bindWx','Tts','getVipLeavelRelById','Music','修改密码失败、请重新试试吧。','userBalanceService','price','\x20AND\x20u.saasId\x20=\x20','globalConfigService','class-validator','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','修改用户角色失败！','inviterPhone','changeScore4registe','EChangeType','registerBaseUrl','DrawSpeed','】会员每日限免','saasEntity','getMiniOpenIdByUserId','HttpStatus','注册赠送','findAndCount','%\x27\x20OR\x20u.email\x20LIKE\x20\x27%','PPT','增加PPT备注','UserService','UserEntity','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','用户不存在！','../../common/constants/redisKey.constant','更换模板','registerVerifyEmailTitle','./userFavorite.entity','userEntity','__decorate','%\x27\x20OR\x20id\x20=\x20\x27','miniOpenId','decorate','updateUserPassword','\x20OFFSET\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','Registe','1\x20=\x201','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','用户名已存在、请更换用户名！','then','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','create','已生成过邀请码、请勿重复生成','queryUserInfoById','find','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','isManage','%\x27\x20OR\x20email\x20LIKE\x20\x27%','configService','VerificationEnum','giftScore','map','updateRole','musicLyrics','DESC','lfVipFree','EModelType','collectPage','../../common/constants/midjourney.constant','ACTIVE','歌词生成','hashSync','Registration','GPTS','的账号激活','saasDel','type2','replace','getUserUnionId','createUserAndVerifycation','createUser','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','./saas.entity','forEach','turbo_mjDeduction','\x20AND\x20role\x20=\x20\x27','受邀请注册赠送','Not','inviterEmail','initSaasMap','6IaPscI','endOf','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','subscriber','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','transaction','userDefautlAvatar','type1','startOf','getValue','RoleEntity','count','未激活用户不可手动变更状态！','num','nestjs-cls','\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL','roleSave','getModelVipFree','has','修改用户状态失败！','超级管理员','\x20AND\x20`status`\x20=\x20','resetUserPass','description','fetch|listbyids|modal|seed','saasSave','nickname','validateBalanceLinxFox','Like','获取邀请记录失败！','isSuper','OTHER','LessThanOrEqual','modelType','connection','LinxFox会员永久免费','还有用户使用相关角色，无法删除！','invitedRewardVip','\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)','avatar','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','isMobilePhone','BLACKLISTED','relax','UserStatusEnum','uncollectByRelIds','%\x27\x20)','6998PRLfkq','编辑PPT','2805507rjyRAJ','message','isEmail','fast','修改用户状态成功！','getReqSaasId','\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','uncollect','RedisCacheService','无效的邀请码！','\x20AND\x20u.userId\x20=\x20','default','add','模型【','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','debuctBalance4PPT','当前手机号已注册、请勿重复注册！','-LinkFox','refundBalance4Chat','genUserName','roleEntity','ERole','\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','function','】会员永久免费','SD绘画【','../../common/utils/date','diff','zh-CN','desc','updateStatus','pptCreate','%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%','qureyUserInfoByInviteCode','day','VipFree','registerVerifyExpir','clsService','insertAccountVipLog','startsWith','手机号格式错误！','用户名已存在！','object','3830UwvPHt','当前角色编码不可用，请使用其他角色编码','checkUserStatus','exists','\x20AND\x20(username\x20LIKE\x20\x27%','getOpenIdByUserId','REDIS_SUBSCRIBER','saasId不能为空！','bcryptjs','toLowerCase','Injectable','get','没有变更，无需更改！','role','yes','Draw','days','LinkFoxConfig','czProxyPrice','error:\x20','getConfigByKeys','valueOf','VIEWER','--------------------------------VVVVVVVVVVVVV----','VIP_FREE','当前用户不存在！','phone'];_0x4beb=function(){return _0x45f106;};return _0x4beb();}(function(_0x95cd3f,_0x3b307a){const _0x57421d=_0x5035,_0x252fba=_0x95cd3f();while(!![]){try{const _0x57ad55=-parseInt(_0x57421d(0x2d3))/0x1*(parseInt(_0x57421d(0x206))/0x2)+-parseInt(_0x57421d(0x2d5))/0x3*(-parseInt(_0x57421d(0x226))/0x4)+-parseInt(_0x57421d(0x328))/0x5*(parseInt(_0x57421d(0x2a3))/0x6)+-parseInt(_0x57421d(0x21f))/0x7+parseInt(_0x57421d(0x1e7))/0x8*(-parseInt(_0x57421d(0x1de))/0x9)+parseInt(_0x57421d(0x300))/0xa*(parseInt(_0x57421d(0x1e3))/0xb)+parseInt(_0x57421d(0x239))/0xc;if(_0x57ad55===_0x3b307a)break;else _0x252fba['push'](_0x252fba['shift']());}catch(_0x156f6c){_0x252fba['push'](_0x252fba['shift']());}}}(_0x4beb,0x97fcf));function _0x5035(_0x36c0b4,_0x386896){const _0x4bebbc=_0x4beb();return _0x5035=function(_0x503526,_0x3c84b7){_0x503526=_0x503526-0x1a9;let _0x164705=_0x4bebbc[_0x503526];return _0x164705;},_0x5035(_0x36c0b4,_0x386896);}var __decorate=this&&this[_0x56b5f7(0x26e)]||function(_0x2046eb,_0xc8e7e6,_0x1e913d,_0x173d63){const _0x42d46d=_0x56b5f7;var _0xa7b5e7=arguments['length'],_0x2a8fd4=_0xa7b5e7<0x3?_0xc8e7e6:_0x173d63===null?_0x173d63=Object[_0x42d46d(0x224)](_0xc8e7e6,_0x1e913d):_0x173d63,_0x132df8;if(typeof Reflect==='object'&&typeof Reflect[_0x42d46d(0x271)]==='function')_0x2a8fd4=Reflect['decorate'](_0x2046eb,_0xc8e7e6,_0x1e913d,_0x173d63);else{for(var _0x2b7a80=_0x2046eb[_0x42d46d(0x361)]-0x1;_0x2b7a80>=0x0;_0x2b7a80--)if(_0x132df8=_0x2046eb[_0x2b7a80])_0x2a8fd4=(_0xa7b5e7<0x3?_0x132df8(_0x2a8fd4):_0xa7b5e7>0x3?_0x132df8(_0xc8e7e6,_0x1e913d,_0x2a8fd4):_0x132df8(_0xc8e7e6,_0x1e913d))||_0x2a8fd4;}return _0xa7b5e7>0x3&&_0x2a8fd4&&Object[_0x42d46d(0x323)](_0xc8e7e6,_0x1e913d,_0x2a8fd4),_0x2a8fd4;},__metadata=this&&this[_0x56b5f7(0x31f)]||function(_0x2cfa70,_0x1c33ef){const _0x96b7eb=_0x56b5f7;if(typeof Reflect===_0x96b7eb(0x2ff)&&typeof Reflect[_0x96b7eb(0x22f)]===_0x96b7eb(0x2ec))return Reflect['metadata'](_0x2cfa70,_0x1c33ef);},__param=this&&this[_0x56b5f7(0x363)]||function(_0x19898b,_0x146978){return function(_0x4f9698,_0xf5ed36){_0x146978(_0x4f9698,_0xf5ed36,_0x19898b);};};Object['defineProperty'](exports,_0x56b5f7(0x37b),{'value':!![]}),exports['UserService']=void 0x0;const globalConfig_service_1=require(_0x56b5f7(0x36b)),user_constant_1=require('../../common/constants/user.constant'),mailer_1=require('@nestjs-modules/mailer'),verification_service_1=require(_0x56b5f7(0x1b9)),common_1=require('@nestjs/common'),typeorm_1=require(_0x56b5f7(0x236)),typeorm_2=require('typeorm'),user_entity_1=require(_0x56b5f7(0x353)),bcrypt=require(_0x56b5f7(0x308)),_=require(_0x56b5f7(0x1ae)),verification_constant_1=require('../../common/constants/verification.constant'),userBalance_service_1=require('../userBalance/userBalance.service'),utils_1=require('../../common/utils'),balance_constant_1=require('../../common/constants/balance.constant'),class_validator_1=require(_0x56b5f7(0x254)),redisKey_constant_1=require(_0x56b5f7(0x269)),redisCache_service_1=require('../redisCache/redisCache.service'),model_constant_1=require(_0x56b5f7(0x225)),midjourney_constant_1=require(_0x56b5f7(0x28c)),user_init_vip_entity_1=require(_0x56b5f7(0x31d)),axios_1=require(_0x56b5f7(0x32c)),date_1=require(_0x56b5f7(0x2ef)),saas_entity_1=require(_0x56b5f7(0x29b)),role_entity_1=require('./role.entity'),store_1=require(_0x56b5f7(0x233)),nestjs_cls_1=require(_0x56b5f7(0x2b2)),Role_constant_1=require('../../common/constants/Role.constant'),userFavorite_entity_1=require(_0x56b5f7(0x26c)),userCollect_entity_1=require('./entity/userCollect.entity'),collectType_constant_1=require(_0x56b5f7(0x331)),cm_service_1=require('../cmConfig/cm.service');let UserService=class UserService{constructor(_0x3a67fa,_0x520ff0,_0x4ce395,_0x5db87a,_0x48b708,_0xb9bb53,_0x48dcc2,_0x16f819,_0x3e0c8d,_0x193f9b,_0x585e5a,_0x24dc8b,_0x23a8e5,_0x330851,_0x9cf206){const _0x2a9da3=_0x56b5f7;this['subscriber']=_0x3a67fa,this[_0x2a9da3(0x26d)]=_0x520ff0,this[_0x2a9da3(0x25d)]=_0x4ce395,this[_0x2a9da3(0x2e9)]=_0x5db87a,this[_0x2a9da3(0x1c6)]=_0x48b708,this[_0x2a9da3(0x1ca)]=_0xb9bb53,this[_0x2a9da3(0x1b6)]=_0x48dcc2,this[_0x2a9da3(0x2fa)]=_0x16f819,this[_0x2a9da3(0x20c)]=_0x3e0c8d,this['redisCacheService']=_0x193f9b,this[_0x2a9da3(0x250)]=_0x585e5a,this[_0x2a9da3(0x253)]=_0x24dc8b,this['verificationService']=_0x23a8e5,this['configService']=_0x330851,this[_0x2a9da3(0x2c6)]=_0x9cf206;}['onModuleInit'](){const _0xafe221=_0x56b5f7;console[_0xafe221(0x35c)](_0xafe221(0x23a)),this[_0xafe221(0x2c6)][_0xafe221(0x343)](_0xafe221(0x23f)+Role_constant_1[_0xafe221(0x2ea)][_0xafe221(0x1cd)]+_0xafe221(0x209)+Role_constant_1[_0xafe221(0x2ea)][_0xafe221(0x35b)]+_0xafe221(0x36e)+Role_constant_1[_0xafe221(0x2ea)][_0xafe221(0x316)]+'\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),this[_0xafe221(0x2a2)](),this[_0xafe221(0x2a7)]['pSubscribe'](_0xafe221(0x1d6),async _0x1451b0=>{const _0x763584=_0xafe221;if(_0x1451b0[_0x763584(0x2fc)](redisKey_constant_1[_0x763584(0x22d)])){const _0x550479=_0x1451b0[_0x763584(0x295)](redisKey_constant_1[_0x763584(0x22d)],'');this[_0x763584(0x26d)][_0x763584(0x1f2)]({'id':Number(_0x550479)},{'vipExpire':null});}});}async[_0x56b5f7(0x2a2)](){const _0x23d4a5=_0x56b5f7,_0x1695ff=await this[_0x23d4a5(0x25d)][_0x23d4a5(0x27e)]({'where':{'deleteFlag':0x0}});store_1[_0x23d4a5(0x337)]['clear'](),_0x1695ff[_0x23d4a5(0x29c)](_0x4a36dd=>store_1[_0x23d4a5(0x337)][_0x23d4a5(0x37f)](_0x4a36dd['domain'],_0x4a36dd['id'])),store_1['saasMap'][_0x23d4a5(0x37f)](process[_0x23d4a5(0x1c8)]['GOMAXAI_HOST'],0x0);}['getEntity'](){return this['userEntity'];}async[_0x56b5f7(0x1c4)](_0x18dc95){const _0x4d0e17=_0x56b5f7;if(!_0x18dc95['length'])return[];return this['saasEntity'][_0x4d0e17(0x27e)]({'where':{'id':(0x0,typeorm_2['In'])(_0x18dc95)}});}async['saasPage'](_0x3b9a3c){const _0x970943=_0x56b5f7,{page:page=0x1,size:size=0x14,keyword:_0x28bca6}=_0x3b9a3c;let _0x8a4311;_0x28bca6?_0x8a4311=[{'deleteFlag':0x0,'name':(0x0,typeorm_2[_0x970943(0x2c0)])('%'+_0x28bca6+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2['Like'])('%'+_0x28bca6+'%')}]:_0x8a4311={'deleteFlag':0x0};const [_0x38ad34,_0x562236]=await this['saasEntity'][_0x970943(0x261)]({'where':_0x8a4311,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x970943(0x288)}});if(!_0x38ad34[_0x970943(0x361)])return{'rows':[],'count':_0x562236};const _0x407744=_0x38ad34['map'](_0x509097=>_0x509097['id']),_0x124bac=new Map(),_0x1fb45c=await this[_0x970943(0x26d)]['find']({'where':{'saasId':(0x0,typeorm_2['In'])(_0x407744),'role':Role_constant_1['ERole'][_0x970943(0x35b)]}});_0x1fb45c[_0x970943(0x29c)](_0x3a4367=>{const _0x4b82af=_0x970943;_0x124bac[_0x4b82af(0x37f)](_0x3a4367[_0x4b82af(0x22e)],_0x3a4367);});const _0x1e9694=new Map(),_0x2d085a=await this[_0x970943(0x2c6)][_0x970943(0x343)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20');_0x2d085a[_0x970943(0x29c)](_0xb5708a=>_0x1e9694['set'](_0xb5708a[_0x970943(0x22e)],_0xb5708a[_0x970943(0x2af)]));const _0x5d1f35=_0x38ad34[_0x970943(0x285)](_0x589ffb=>{const _0x58f995=_0x970943;let _0x4fe3cf=null,_0x124a53=null,_0x46f14f=null,_0x2e9f0c=null;const _0x1b81ff=_0x124bac[_0x58f995(0x30b)](_0x589ffb['id']);return _0x1b81ff&&(_0x4fe3cf=_0x1b81ff[_0x58f995(0x234)],_0x124a53=_0x1b81ff[_0x58f995(0x2be)],_0x46f14f=_0x1b81ff[_0x58f995(0x31a)],_0x2e9f0c=_0x1b81ff['email']),{..._0x589ffb,'username':_0x4fe3cf,'nickname':_0x124a53,'phone':_0x46f14f,'email':_0x2e9f0c,'userCount':_0x1e9694['get'](_0x589ffb['id'])||0x0};});return{'rows':_0x5d1f35,'count':_0x562236};}async['getSaasById'](_0xda14a){const _0x4ffef8=_0x56b5f7;return this[_0x4ffef8(0x25d)][_0x4ffef8(0x326)]({'where':{'id':_0xda14a}});}async[_0x56b5f7(0x2bd)](_0x1dd275){const _0x58efb2=_0x56b5f7,_0x115593=(0x0,utils_1[_0x58efb2(0x2da)])(this[_0x58efb2(0x2fa)]);if(_0x115593!==0x0)throw new common_1[(_0x58efb2(0x330))]('非法访问',common_1[_0x58efb2(0x25f)][_0x58efb2(0x1e1)]);return await this[_0x58efb2(0x25d)][_0x58efb2(0x352)](_0x1dd275),this['initSaasMap'](),!![];}async['saasUpdate'](_0x275409){const _0x489ca8=_0x56b5f7,_0x4b57b5=(0x0,utils_1['getReqSaasId'])(this['clsService']);return await this[_0x489ca8(0x25d)]['save']({..._0x275409,'id':_0x4b57b5}),!![];}async[_0x56b5f7(0x293)](_0x2a272c){const _0xa68d4=_0x56b5f7;if(!_0x2a272c[_0xa68d4(0x37c)]||!_0x2a272c[_0xa68d4(0x37c)][_0xa68d4(0x361)])return!![];return await this[_0xa68d4(0x25d)][_0xa68d4(0x1f2)]({'id':(0x0,typeorm_2['In'])(_0x2a272c['ids'])},{'deleteFlag':0x1}),!![];}async[_0x56b5f7(0x359)](_0x42e594,_0x215f69){const _0x5a3eb1=_0x56b5f7,_0x422061=await(0x0,utils_1['getReqSaasId'])(this[_0x5a3eb1(0x2fa)]),{page:page=0x1,size:size=0x14,keyword:_0x3cc6a4}=_0x215f69;let _0x1c13f1=_0x5a3eb1(0x230)+_0x422061+_0x5a3eb1(0x2a6)+Role_constant_1[_0x5a3eb1(0x2ea)]['VIEWER']+_0x5a3eb1(0x2eb);_0x3cc6a4&&(_0x1c13f1=_0x5a3eb1(0x335)+_0x422061+_0x5a3eb1(0x2db)+_0x3cc6a4+_0x5a3eb1(0x2e3)+_0x3cc6a4+'%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27'+Role_constant_1[_0x5a3eb1(0x2ea)][_0x5a3eb1(0x316)]+_0x5a3eb1(0x364)+_0x3cc6a4+_0x5a3eb1(0x2e3)+_0x3cc6a4+'%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');const _0x2b32e1=await this[_0x5a3eb1(0x2c6)][_0x5a3eb1(0x343)](_0x5a3eb1(0x274)+_0x1c13f1+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x13c2ff=await this[_0x5a3eb1(0x2c6)][_0x5a3eb1(0x343)](_0x5a3eb1(0x1ad)+_0x1c13f1+_0x5a3eb1(0x2cc)+size+_0x5a3eb1(0x273)+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x5f2d51=_0x13c2ff['map'](_0x7cfa7b=>_0x7cfa7b['id']);if(_0x5f2d51[_0x5a3eb1(0x361)]){const _0x12c637=await this[_0x5a3eb1(0x25d)][_0x5a3eb1(0x326)]({'where':{'id':_0x42e594[_0x5a3eb1(0x232)][_0x5a3eb1(0x22e)]}}),_0x15cf9b=new Map(),_0x22fc1d=await this['connection']['query'](_0x5a3eb1(0x29a));_0x22fc1d['forEach'](_0x2ca2f8=>_0x15cf9b['set'](_0x2ca2f8[_0x5a3eb1(0x30d)],_0x2ca2f8['count'])),_0x13c2ff[_0x5a3eb1(0x29c)](_0x1efb8c=>{const _0x2ebdb8=_0x5a3eb1;_0x1efb8c['saasName']=_0x12c637?.['name']||'平台',_0x1efb8c[_0x2ebdb8(0x1d9)]=_0x15cf9b[_0x2ebdb8(0x30b)](_0x1efb8c['code'])||0x0;});}return{'rows':_0x13c2ff,'count':Number(_0x2b32e1[0x0]?.[_0x5a3eb1(0x2af)]||0x0)};}async[_0x56b5f7(0x2b4)](_0x233e25,_0x58c11c){const _0x49f325=_0x56b5f7,_0xa9e952=await(0x0,utils_1[_0x49f325(0x2da)])(this[_0x49f325(0x2fa)]);if([Role_constant_1[_0x49f325(0x2ea)][_0x49f325(0x1cd)][_0x49f325(0x315)](),Role_constant_1['ERole'][_0x49f325(0x35b)][_0x49f325(0x315)](),Role_constant_1[_0x49f325(0x2ea)]['VIEWER'][_0x49f325(0x315)]()]['includes'](_0x58c11c[_0x49f325(0x238)])&&_0xa9e952!==0x0)throw new common_1[(_0x49f325(0x330))](_0x49f325(0x301),common_1[_0x49f325(0x25f)]['BAD_REQUEST']);return await this[_0x49f325(0x2e9)][_0x49f325(0x352)]({..._0x58c11c,'saasId':_0xa9e952,'disabled':_0x58c11c['disabled']??0x0}),!![];}async['roleDel'](_0x3c85df,_0x425f7c){const _0x2cc7ed=_0x56b5f7,_0x3b3a11=await(0x0,utils_1[_0x2cc7ed(0x2da)])(this[_0x2cc7ed(0x2fa)]);if(!_0x425f7c['ids']||!_0x425f7c[_0x2cc7ed(0x37c)][_0x2cc7ed(0x361)])return!![];const _0x1dcec1=await this[_0x2cc7ed(0x2e9)][_0x2cc7ed(0x27e)]({'where':{'id':(0x0,typeorm_2['In'])(_0x425f7c[_0x2cc7ed(0x37c)]),'saasId':_0x3b3a11}});if(!_0x1dcec1[_0x2cc7ed(0x361)])return!![];const _0x4b66d4=_0x1dcec1[_0x2cc7ed(0x285)](_0x42cb73=>_0x42cb73[_0x2cc7ed(0x238)]),_0x279f2f=await this[_0x2cc7ed(0x26d)][_0x2cc7ed(0x2af)]({'where':{'role':(0x0,typeorm_2['In'])(_0x4b66d4),'saasId':_0x3b3a11}});if(_0x279f2f>0x0)throw new common_1[(_0x2cc7ed(0x330))](_0x2cc7ed(0x2c8),common_1[_0x2cc7ed(0x25f)][_0x2cc7ed(0x373)]);return await this['roleEntity'][_0x2cc7ed(0x1e8)]({'id':(0x0,typeorm_2['In'])(_0x425f7c[_0x2cc7ed(0x37c)])}),!![];}async[_0x56b5f7(0x1e4)](_0x3de52d){const _0x5974e6=_0x56b5f7;if(!_0x3de52d['length'])return[];const _0x417f41=await this['userEntity'][_0x5974e6(0x27e)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3de52d)}});return _0x417f41;}async[_0x56b5f7(0x297)](_0x3537a4,_0x12def6){const _0x52cdfb=_0x56b5f7,{username:_0x57d5f4,email:_0x5e80eb,password:_0x57033c,invitedBy:_0x33de7f,client:client=0x0}=_0x3537a4;if(_0x33de7f){const _0x16f67c=await this[_0x52cdfb(0x26d)][_0x52cdfb(0x326)]({'where':{'inviteCode':_0x33de7f}});if(!_0x16f67c)throw new common_1[(_0x52cdfb(0x330))](_0x52cdfb(0x2de),common_1[_0x52cdfb(0x25f)][_0x52cdfb(0x373)]);}const _0x4dca19=[{'username':_0x57d5f4},{'email':_0x5e80eb}],_0x5817a8=await this[_0x52cdfb(0x26d)][_0x52cdfb(0x326)]({'where':_0x4dca19});if(_0x5817a8&&_0x5817a8[_0x52cdfb(0x365)]!==user_constant_1[_0x52cdfb(0x2d0)]['PENDING'])throw new common_1[(_0x52cdfb(0x330))](_0x52cdfb(0x1fa),common_1[_0x52cdfb(0x25f)][_0x52cdfb(0x373)]);try{const _0x2e2270=_['cloneDeep'](_0x3537a4),_0x145c1d=bcrypt[_0x52cdfb(0x28f)](_0x57033c,0xa),_0x6647fb=(0x0,utils_1[_0x52cdfb(0x1c2)])(_0x12def6);_0x2e2270[_0x52cdfb(0x37d)]=_0x145c1d,_0x2e2270[_0x52cdfb(0x1fb)]=_0x6647fb,_0x2e2270['client']=client;let _0x53c6e4;if(!_0x5817a8){const _0x55072f=await this[_0x52cdfb(0x253)][_0x52cdfb(0x314)]([_0x52cdfb(0x2aa)]);_0x2e2270['avatar']=_0x55072f,_0x53c6e4=await this[_0x52cdfb(0x26d)][_0x52cdfb(0x352)](_0x2e2270);}else _0x53c6e4=_0x5817a8;const _0x303483=await this[_0x52cdfb(0x253)][_0x52cdfb(0x314)](['isVerifyEmail','registerBaseUrl',_0x52cdfb(0x26b),_0x52cdfb(0x33a),_0x52cdfb(0x381),_0x52cdfb(0x2f9)]),_0x369a5f=_0x303483['isVerifyEmail']?Number(_0x303483['isVerifyEmail']):0x1;if(_0x369a5f){const _0x407d22=_0x303483[_0x52cdfb(0x2f9)]?Number(_0x303483[_0x52cdfb(0x2f9)]):0x1e*0x3c,_0x592981=await this[_0x52cdfb(0x354)]['createVerification'](_0x53c6e4,verification_constant_1[_0x52cdfb(0x283)][_0x52cdfb(0x290)],_0x407d22),{code:_0x2e7b71,email:_0x38998c,id:_0x42ec22}=_0x592981,{registerVerifyEmailFrom:_0x126e0f}=_0x303483;await this[_0x52cdfb(0x20c)]['sendMail']({'to':_0x38998c,'subject':'来自'+_0x126e0f+_0x52cdfb(0x292),'template':'register','context':{'baseUrl':_0x303483[_0x52cdfb(0x25a)],'code':_0x2e7b71,'id':_0x42ec22,..._0x303483}});}else{const {id:_0x2acd0e,invitedBy:_0x5eff2a}=_0x53c6e4;await this['updateUserStatus'](_0x2acd0e,user_constant_1[_0x52cdfb(0x2d0)]['ACTIVE']);let _0x453d3f;_0x5eff2a&&(_0x453d3f=await this[_0x52cdfb(0x2f6)](_0x5eff2a)),await this[_0x52cdfb(0x258)](_0x53c6e4,_0x453d3f);}return _0x53c6e4;}catch(_0x30f3ef){console[_0x52cdfb(0x35c)](_0x52cdfb(0x313),_0x30f3ef);throw _0x30f3ef;}}async[_0x56b5f7(0x340)](_0x30bb67){const _0x43f0d9=_0x56b5f7,{username:_0x55d833,password:_0x29d1e9,uid:uid=0x0,phone:_0x3cd3f0}=_0x30bb67;let _0x14ce2a=null;if(uid>0x0){_0x14ce2a=await this[_0x43f0d9(0x26d)][_0x43f0d9(0x326)]({'where':{'id':uid}});if(!_0x14ce2a)throw new common_1[(_0x43f0d9(0x330))](_0x43f0d9(0x1f5),common_1[_0x43f0d9(0x25f)][_0x43f0d9(0x373)]);if(!bcrypt[_0x43f0d9(0x1da)](_0x29d1e9,_0x14ce2a['password']))throw new common_1[(_0x43f0d9(0x330))](_0x43f0d9(0x1e2),common_1['HttpStatus'][_0x43f0d9(0x373)]);}if(_0x55d833&&_0x29d1e9){const _0x4c7b97=[{'username':_0x55d833},{'email':_0x55d833}];_0x14ce2a=await this[_0x43f0d9(0x26d)][_0x43f0d9(0x326)]({'where':_0x4c7b97});if(!_0x14ce2a)throw new common_1['HttpException'](_0x43f0d9(0x1f5),common_1['HttpStatus'][_0x43f0d9(0x373)]);if(!bcrypt[_0x43f0d9(0x1da)](_0x29d1e9,_0x14ce2a[_0x43f0d9(0x37d)]))throw new common_1[(_0x43f0d9(0x330))]('当前密码错误！',common_1[_0x43f0d9(0x25f)][_0x43f0d9(0x373)]);}if(_0x3cd3f0&&_0x29d1e9){const _0x3611bd=[{'phone':_0x3cd3f0}];_0x14ce2a=await this['userEntity'][_0x43f0d9(0x326)]({'where':_0x3611bd});if(!_0x14ce2a)throw new common_1[(_0x43f0d9(0x330))]('当前账户不存在！',common_1[_0x43f0d9(0x25f)]['BAD_REQUEST']);if(!bcrypt[_0x43f0d9(0x1da)](_0x29d1e9,_0x14ce2a[_0x43f0d9(0x37d)]))throw new common_1[(_0x43f0d9(0x330))](_0x43f0d9(0x1e2),common_1[_0x43f0d9(0x25f)]['BAD_REQUEST']);}if(!_0x14ce2a)throw new common_1['HttpException']('当前账户不存在！',common_1[_0x43f0d9(0x25f)][_0x43f0d9(0x373)]);if(_0x14ce2a[_0x43f0d9(0x365)]!==user_constant_1[_0x43f0d9(0x2d0)][_0x43f0d9(0x28d)])throw new common_1['HttpException'](user_constant_1[_0x43f0d9(0x35d)][_0x14ce2a[_0x43f0d9(0x365)]],common_1[_0x43f0d9(0x25f)][_0x43f0d9(0x373)]);if(_0x14ce2a[_0x43f0d9(0x234)]&&!_0x14ce2a['lastLoginIp']){const _0x2d74d6=await this['userInitVipEntity'][_0x43f0d9(0x326)]({'where':{'username':_0x14ce2a[_0x43f0d9(0x234)]}});_0x2d74d6&&await this[_0x43f0d9(0x2c6)][_0x43f0d9(0x2a9)](async()=>{const _0x46756c=_0x43f0d9;_0x2d74d6[_0x46756c(0x1af)]===-0x1?_0x14ce2a[_0x46756c(0x1bb)]=0x1:_0x14ce2a[_0x46756c(0x1bc)]=(0x0,date_1['default'])()['add'](_0x2d74d6[_0x46756c(0x1af)],_0x46756c(0x2f7))[_0x46756c(0x1ee)](),_0x14ce2a=await this[_0x46756c(0x26d)]['save'](_0x14ce2a),await this[_0x46756c(0x1c6)][_0x46756c(0x1e8)]({'id':_0x2d74d6['id']});});}return _0x14ce2a;}async[_0x56b5f7(0x1ec)](_0x4e7e46,_0x1dab67){const _0xaf32d7=_0x56b5f7,_0x488906=await this[_0xaf32d7(0x26d)]['findOne']({'where':{'id':_0x4e7e46}});return bcrypt[_0xaf32d7(0x1da)](_0x1dab67,_0x488906['password']);}async[_0x56b5f7(0x242)](_0x51b1d3,_0x42506b){const _0x3c9466=_0x56b5f7,_0x5df6cc=await this['userEntity'][_0x3c9466(0x1f2)]({'id':_0x51b1d3},{'status':_0x42506b});return _0x5df6cc['affected']>0x0;}async[_0x56b5f7(0x222)](_0x131176){const _0x1ecdb9=_0x56b5f7,_0x3cdcc3=await this[_0x1ecdb9(0x26d)]['findOne']({'where':{'id':_0x131176}});return _0x3cdcc3['status'];}async[_0x56b5f7(0x27d)](_0x593ab1){const _0x17e480=_0x56b5f7;return await this['userEntity'][_0x17e480(0x326)]({'where':{'id':_0x593ab1}});}async[_0x56b5f7(0x218)](_0x1b51ff){const _0x561a4c=_0x56b5f7;return await this[_0x561a4c(0x26d)][_0x561a4c(0x333)]({'id':(0x0,typeorm_2['In'])(_0x1b51ff)});}async[_0x56b5f7(0x32e)](_0x32dde4){const _0x5c6ca6=_0x56b5f7;return await this[_0x5c6ca6(0x26d)][_0x5c6ca6(0x326)]({'where':{'username':_0x32dde4}});}async['updateUserOpenId'](_0x167f46,_0x4d46d5,_0x309acf){const _0x54d2f6=_0x56b5f7;return await this[_0x54d2f6(0x26d)][_0x54d2f6(0x1f2)](_0x167f46,{'openId':_0x4d46d5,'unionid':_0x309acf});}async[_0x56b5f7(0x24a)](_0x3be066,_0x17b3fd,_0x5d0194){const _0x10f488=_0x56b5f7;return await this['userEntity'][_0x10f488(0x1f2)](_0x3be066,{'miniOpenId':_0x17b3fd,'unionid':_0x5d0194});}async[_0x56b5f7(0x248)](_0x1c1aec,_0x45186f,_0x5630ad){const _0x2b28af=_0x56b5f7;return await this[_0x2b28af(0x26d)][_0x2b28af(0x1f2)](_0x1c1aec,{'weAppOpenId':_0x45186f,'unionid':_0x5630ad});}async[_0x56b5f7(0x1b3)](_0x50fbab){const _0x16dac9=_0x56b5f7,{id:_0x1fc179,username:_0x247cc4,password:_0x381e24}=_0x50fbab;return await this[_0x16dac9(0x26d)][_0x16dac9(0x1f2)](_0x1fc179,{'username':_0x247cc4,'password':_0x381e24});}async['queryOneUserInfo'](_0x3adb0e){const _0x372fc5=_0x56b5f7;return await this[_0x372fc5(0x26d)]['findOne']({'where':{'id':_0x3adb0e}});}async[_0x56b5f7(0x302)](_0xcc828e){const _0x351be8=_0x56b5f7,{id:_0x36aa2c,role:_0x3268e2}=_0xcc828e;if(_0x3268e2===_0x351be8(0x1ba))return!![];const _0x746a68=await this[_0x351be8(0x26d)]['findOne']({'where':{'id':_0x36aa2c}});if(!_0x746a68)throw new common_1[(_0x351be8(0x330))](_0x351be8(0x1d4),common_1['HttpStatus'][_0x351be8(0x201)]);if(_0x746a68[_0x351be8(0x365)]===user_constant_1[_0x351be8(0x2d0)][_0x351be8(0x2ce)])throw new common_1[(_0x351be8(0x330))](_0x351be8(0x27a),common_1[_0x351be8(0x25f)][_0x351be8(0x373)]);if(_0x746a68['status']===user_constant_1[_0x351be8(0x2d0)][_0x351be8(0x321)])throw new common_1['HttpException'](_0x351be8(0x372),common_1['HttpStatus'][_0x351be8(0x373)]);}async['getUserById'](_0x2e5fbb){const _0x251650=_0x56b5f7;return await this[_0x251650(0x26d)][_0x251650(0x326)]({'where':{'id':_0x2e5fbb}});}['getUserListByIds'](_0x3a69c0){const _0x3eeaf1=_0x56b5f7;return this[_0x3eeaf1(0x26d)][_0x3eeaf1(0x27e)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3a69c0)}});}async[_0x56b5f7(0x32f)](_0x3b4f2b){const _0x10298d=_0x56b5f7;return this[_0x10298d(0x26d)][_0x10298d(0x326)]({'where':{'inviteCode':_0x3b4f2b}});}async[_0x56b5f7(0x324)](_0x1b61e2){const _0x4a000c=_0x56b5f7,_0x5e1f4f=(0x0,utils_1[_0x4a000c(0x2da)])(this[_0x4a000c(0x2fa)]);return await this[_0x4a000c(0x26d)][_0x4a000c(0x326)]({'where':{'openId':_0x1b61e2,'saasId':_0x5e1f4f}});}async[_0x56b5f7(0x296)](_0x23f09b){const _0x4bb124=_0x56b5f7,_0x3c778f=(0x0,utils_1[_0x4bb124(0x2da)])(this[_0x4bb124(0x2fa)]);return await this['userEntity'][_0x4bb124(0x326)]({'where':{'unionid':_0x23f09b,'saasId':_0x3c778f}});}async[_0x56b5f7(0x215)](_0x1f5869){const _0x3608cc=_0x56b5f7;return this[_0x3608cc(0x26d)][_0x3608cc(0x2af)]({'where':{'invitedBy':_0x1f5869}});}async[_0x56b5f7(0x1ce)](_0x3f0445,_0x5b698a){const _0x57da8c=_0x56b5f7,{id:_0x422e07}=_0x5b698a[_0x57da8c(0x232)],_0x1d17f8=await this[_0x57da8c(0x26d)][_0x57da8c(0x326)]({'where':{'id':_0x422e07}});if(!_0x1d17f8)throw new common_1[(_0x57da8c(0x330))](_0x57da8c(0x319),common_1[_0x57da8c(0x25f)]['BAD_REQUEST']);if(_0x3f0445['username']&&_0x1d17f8[_0x57da8c(0x234)]===_0x3f0445[_0x57da8c(0x234)])throw new common_1[(_0x57da8c(0x330))](_0x57da8c(0x30c),common_1[_0x57da8c(0x25f)]['BAD_REQUEST']);if(_0x3f0445[_0x57da8c(0x234)]){const _0x278bc5=await this[_0x57da8c(0x26d)][_0x57da8c(0x326)]({'where':{'username':_0x3f0445['username'],'id':(0x0,typeorm_2[_0x57da8c(0x2a0)])(_0x422e07)}});if(_0x278bc5)throw new common_1[(_0x57da8c(0x330))](_0x57da8c(0x2fe),common_1[_0x57da8c(0x25f)][_0x57da8c(0x373)]);}const _0xe06cf=await this[_0x57da8c(0x26d)][_0x57da8c(0x1f2)]({'id':_0x422e07},_0x3f0445);if(_0xe06cf[_0x57da8c(0x1bd)]<=0x0)throw new common_1[(_0x57da8c(0x330))](_0x57da8c(0x1b8),common_1[_0x57da8c(0x25f)][_0x57da8c(0x373)]);return _0x57da8c(0x213);}async[_0x56b5f7(0x272)](_0xd95467,_0x38f83e){const _0x41e71f=_0x56b5f7,_0x31da88=bcrypt[_0x41e71f(0x28f)](_0x38f83e,0xa),_0x17614a=await this[_0x41e71f(0x26d)][_0x41e71f(0x1f2)]({'id':_0xd95467},{'password':_0x31da88});if(_0x17614a[_0x41e71f(0x1bd)]<=0x0)throw new common_1[(_0x41e71f(0x330))](_0x41e71f(0x24f),common_1[_0x41e71f(0x25f)][_0x41e71f(0x373)]);}async['favorite'](_0x52cc2a,_0x398ce0){const _0x1b6acd=_0x56b5f7;try{const _0x9d7985=await this['userFavoriteEntity'][_0x1b6acd(0x326)]({'where':{'userId':_0x52cc2a[_0x1b6acd(0x232)]['id'],'relateId':_0x398ce0['relateId'],'relateType':_0x398ce0[_0x1b6acd(0x1e0)]}});return _0x9d7985?await this['userFavoriteEntity'][_0x1b6acd(0x1e8)]({'id':_0x9d7985['id']}):await this[_0x1b6acd(0x1ca)][_0x1b6acd(0x352)]({'userId':_0x52cc2a[_0x1b6acd(0x232)]['id'],'relateId':_0x398ce0[_0x1b6acd(0x1fd)],'relateType':_0x398ce0['relateType']}),!![];}catch(_0x44473a){throw new common_1['HttpException'](_0x44473a[_0x1b6acd(0x2d6)],common_1[_0x1b6acd(0x25f)][_0x1b6acd(0x373)]);}}async[_0x56b5f7(0x20b)](_0x1bcbea,_0x15b7a4,_0x225621){const _0x367a39=_0x56b5f7;return this[_0x367a39(0x1ca)][_0x367a39(0x27e)]({'where':{'userId':_0x1bcbea,'relateType':_0x15b7a4,'relateId':(0x0,typeorm_2['In'])(_0x225621)}});}async[_0x56b5f7(0x202)](_0x3c125d){const _0xc24b93=_0x56b5f7,{id:_0x39ed98}=_0x3c125d[_0xc24b93(0x232)],_0x5090ed=await this[_0xc24b93(0x26d)]['findOne']({'where':{'id':_0x39ed98}});if(!_0x5090ed||_0x5090ed['inviteCode'])throw new common_1[(_0xc24b93(0x330))](_0xc24b93(0x27c),common_1[_0xc24b93(0x25f)][_0xc24b93(0x373)]);const _0x2cc72d=(0x0,utils_1['generateRandomString'])(),_0x4a70cb=await this[_0xc24b93(0x26d)]['findOne']({'where':{'inviteCode':_0x2cc72d}});if(_0x4a70cb)throw new common_1['HttpException'](_0xc24b93(0x36a),common_1[_0xc24b93(0x25f)][_0xc24b93(0x373)]);const _0x3ed45d=await this[_0xc24b93(0x26d)][_0xc24b93(0x1f2)]({'id':_0x39ed98},{'inviteCode':_0x2cc72d});if(_0x3ed45d[_0xc24b93(0x1bd)]<=0x0)throw new common_1['HttpException'](_0xc24b93(0x36a),common_1[_0xc24b93(0x25f)][_0xc24b93(0x373)]);return _0x2cc72d;}async['getInviteRecord'](_0x535ce8,_0x5addd1){const _0x2c8d83=_0x56b5f7;try{const {id:_0x2b2577}=_0x535ce8[_0x2c8d83(0x232)],{page:page=0x1,size:size=0xa}=_0x5addd1,_0xf9f23c=await this[_0x2c8d83(0x26d)][_0x2c8d83(0x326)]({'where':{'id':_0x2b2577}}),{inviteCode:_0x2bd1ce}=_0xf9f23c;if(!_0x2bd1ce)return[];const [_0x3c6fe6,_0x35b2f2]=await this[_0x2c8d83(0x26d)][_0x2c8d83(0x261)]({'where':{'inviteCode':_0x2bd1ce},'order':{'id':_0x2c8d83(0x288)},'select':[_0x2c8d83(0x234),_0x2c8d83(0x205),_0x2c8d83(0x1c0),_0x2c8d83(0x365),_0x2c8d83(0x2cb)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x2c8d83(0x1d3)])(_0x3c6fe6)['map'](_0x520b8b=>{const _0x46624b=_0x2c8d83;return _0x520b8b[_0x46624b(0x205)]=(0x0,utils_1['maskEmail'])(_0x520b8b['email']),_0x520b8b;}),{'rows':_0x3c6fe6,'count':_0x35b2f2};}catch(_0x333b6c){console['log']('error:\x20',_0x333b6c);throw new common_1['HttpException'](_0x2c8d83(0x2c1),common_1[_0x2c8d83(0x25f)][_0x2c8d83(0x373)]);}}async[_0x56b5f7(0x212)](_0x7b8f35,_0x26fe19,_0x226bac){const _0x3b52b1=_0x56b5f7,_0x441792=(0x0,utils_1[_0x3b52b1(0x2da)])(this['clsService']),{page:page=0x1,size:size=0x14,startTime:_0x30d78a,endTime:_0x2ac4e1,saasId:_0x2c9354,keyword:_0x57957c,inviterKeyword:_0x593945}=_0x26fe19,_0x157832=_0x3b52b1(0x277)+(_0x226bac?_0x3b52b1(0x2df)+_0x226bac:'')+_0x3b52b1(0x267)+(_0x2ac4e1?'\x20AND\x20u.createdAt\x20<=\x20\x27'+_0x2ac4e1+'\x27':'')+_0x3b52b1(0x267)+(_0x30d78a?_0x3b52b1(0x33d)+_0x30d78a+'\x27':'')+_0x3b52b1(0x267)+(_0x441792!==0x0?_0x3b52b1(0x252)+_0x441792:(0x0,utils_1[_0x3b52b1(0x1a9)])(_0x2c9354)?_0x3b52b1(0x252)+_0x2c9354:'')+_0x3b52b1(0x267)+(_0x57957c?_0x3b52b1(0x243)+_0x57957c+_0x3b52b1(0x299)+_0x57957c+_0x3b52b1(0x355)+_0x57957c+_0x3b52b1(0x262)+_0x57957c+'%\x27\x20)':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x593945?'\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%'+_0x593945+_0x3b52b1(0x349)+_0x593945+_0x3b52b1(0x2f5)+_0x593945+_0x3b52b1(0x379)+_0x593945+_0x3b52b1(0x2d2):'')+_0x3b52b1(0x2a8),_0x3b4429=_0x3b52b1(0x2a5)+_0x157832+_0x3b52b1(0x2a8),_0x2c6af6=_0x3b52b1(0x1dd)+_0x157832+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20'+size+_0x3b52b1(0x273)+(page-0x1)*size+_0x3b52b1(0x2a8),_0x34dd2c=await this[_0x3b52b1(0x2c6)][_0x3b52b1(0x343)](_0x3b4429),_0x1368c4=await this['connection'][_0x3b52b1(0x343)](_0x2c6af6);return!(0x0,utils_1[_0x3b52b1(0x2c2)])(this[_0x3b52b1(0x2fa)])&&_0x1368c4['forEach'](_0x546737=>{const _0x59eb9f=_0x3b52b1;_0x546737[_0x59eb9f(0x31a)]=(0x0,utils_1['hideString'])(_0x546737[_0x59eb9f(0x31a)]),_0x546737[_0x59eb9f(0x205)]=(0x0,utils_1[_0x59eb9f(0x350)])(_0x546737[_0x59eb9f(0x205)]),_0x546737[_0x59eb9f(0x257)]=(0x0,utils_1[_0x59eb9f(0x350)])(_0x546737[_0x59eb9f(0x257)]),_0x546737[_0x59eb9f(0x2a1)]=(0x0,utils_1[_0x59eb9f(0x350)])(_0x546737['inviterEmail']);}),{'rows':_0x1368c4,'count':Number(_0x34dd2c[0x0]?.['count']||0x0)};}async['inviteLink'](_0x4fc6b7){const _0x1a74af=_0x56b5f7,_0x3d76ae=await this['userEntity']['findOne']({'where':{'inviteCode':_0x4fc6b7}});if(!_0x3d76ae)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x3d76ae,_0x50c9c1=await this[_0x1a74af(0x26d)][_0x1a74af(0x1f2)]({'inviteCode':_0x4fc6b7},{'inviteLinkCount':inviteLinkCount+0x1});return _0x50c9c1[_0x1a74af(0x1bd)]?0x1:0x0;}async['qureyUserInfoByInviteCode'](_0x21ae0d){const _0x2d9bff=_0x56b5f7;return await this['userEntity'][_0x2d9bff(0x326)]({'where':{'inviteCode':_0x21ae0d}});}async['queryAll'](_0x142388,_0x309798){const _0x4e0c5a=_0x56b5f7,_0x5bd7a1=(0x0,utils_1[_0x4e0c5a(0x2da)])(this[_0x4e0c5a(0x2fa)]);let {page:page=0x1,size:size=0xa,username:_0x46d720,phone:_0x32971c,email:_0x2f1f02,status:_0x2da7ad,keyword:_0x1dbf52,roleCode:_0x226d44,vip:_0xb755e2,saasId:_0x32461e}=_0x142388,_0x30795e=_0x4e0c5a(0x276);_0x2da7ad&&(_0x30795e=_0x30795e+(_0x4e0c5a(0x2b9)+_0x2da7ad));_0x226d44&&(_0x30795e=_0x30795e+(_0x4e0c5a(0x29e)+_0x226d44+'\x27'));_0xb755e2&&(_0xb755e2=Number(_0xb755e2));if(_0xb755e2===0x1)_0x30795e=_0x30795e+_0x4e0c5a(0x2ca);else _0xb755e2===0x0&&(_0x30795e=_0x30795e+_0x4e0c5a(0x2b3));_0x1dbf52?_0x30795e=_0x30795e+(_0x4e0c5a(0x304)+_0x1dbf52+_0x4e0c5a(0x235)+_0x1dbf52+_0x4e0c5a(0x369)+_0x1dbf52+_0x4e0c5a(0x281)+_0x1dbf52+_0x4e0c5a(0x26f)+_0x1dbf52+'\x27)'):(_0x46d720&&(_0x30795e=_0x30795e+(_0x4e0c5a(0x21d)+_0x46d720+'%\x27')),_0x2f1f02&&(_0x30795e=_0x30795e+(_0x4e0c5a(0x1d0)+_0x2f1f02+'%\x27')),_0x32971c&&(_0x30795e=_0x30795e+('\x20AND\x20phone\x20LIKE\x20\x27%'+_0x32971c+'%\x27')));(0x0,utils_1[_0x4e0c5a(0x228)])(this[_0x4e0c5a(0x2fa)])?(0x0,utils_1[_0x4e0c5a(0x280)])(this[_0x4e0c5a(0x2fa)])&&_0x32461e&&(_0x30795e=_0x30795e+(_0x4e0c5a(0x366)+_0x32461e)):_0x30795e=_0x30795e+(_0x4e0c5a(0x366)+_0x5bd7a1);const _0x407fbd=await this[_0x4e0c5a(0x2c6)][_0x4e0c5a(0x343)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x30795e+_0x4e0c5a(0x255)),_0x199900=await this['connection'][_0x4e0c5a(0x343)](_0x4e0c5a(0x22b)+_0x30795e+_0x4e0c5a(0x27f)+size+_0x4e0c5a(0x273)+(page-0x1)*size+_0x4e0c5a(0x2a8)),_0x401bd6=[],_0x1c5d66=(0x0,utils_1['isSuper'])(this[_0x4e0c5a(0x2fa)]),_0xd44a8f=new Map([[Role_constant_1[_0x4e0c5a(0x2ea)][_0x4e0c5a(0x35b)],'代理商'],[Role_constant_1[_0x4e0c5a(0x2ea)][_0x4e0c5a(0x1cd)],_0x4e0c5a(0x2b8)],[Role_constant_1[_0x4e0c5a(0x2ea)][_0x4e0c5a(0x316)],_0x4e0c5a(0x374)]]);for(let _0x5e3b41=0x0;_0x5e3b41<_0x199900[_0x4e0c5a(0x361)];_0x5e3b41++){const _0x453834=_0x199900[_0x5e3b41];let _0x2fc69c=_0x4e0c5a(0x374);if(_0xd44a8f[_0x4e0c5a(0x2b6)](_0x453834['role']))_0x2fc69c=_0xd44a8f[_0x4e0c5a(0x30b)](_0x453834[_0x4e0c5a(0x30d)]);else{const _0x42e70b=await this[_0x4e0c5a(0x2e9)][_0x4e0c5a(0x326)]({'where':{'code':_0x453834['role'],'saasId':_0x453834[_0x4e0c5a(0x22e)]}});_0x2fc69c=_0x42e70b[_0x4e0c5a(0x34a)];}_0x401bd6[_0x4e0c5a(0x214)]({..._0x453834,'roleName':_0x2fc69c,'isBindWx':!!_0x453834?.[_0x4e0c5a(0x227)],'password':_0x453834[_0x4e0c5a(0x37d)]?_0x4e0c5a(0x30e):'no','email':_0x1c5d66?_0x453834[_0x4e0c5a(0x205)]:(0x0,utils_1[_0x4e0c5a(0x223)])(_0x453834[_0x4e0c5a(0x205)]),'phone':_0x1c5d66?_0x453834[_0x4e0c5a(0x31a)]:(0x0,utils_1['maskEmail'])(_0x453834['phone']),'lastLoginIp':_0x1c5d66?_0x453834[_0x4e0c5a(0x211)]:(0x0,utils_1[_0x4e0c5a(0x244)])(_0x453834[_0x4e0c5a(0x211)])});}return{'rows':_0x401bd6,'count':Number(_0x407fbd[0x0]?.[_0x4e0c5a(0x2af)]||0x0)};}async[_0x56b5f7(0x34c)](_0x512bac){const _0x488a5b=_0x56b5f7,{page:page=0x1,size:size=0xa,username:_0x5ed402,status:_0x2c951c}=_0x512bac;let _0x14e1d0={};_0x5ed402&&Object[_0x488a5b(0x32a)](_0x14e1d0,{'username':(0x0,typeorm_2['Like'])('%'+_0x5ed402+'%')}),_0x2c951c&&Object[_0x488a5b(0x32a)](_0x14e1d0,{'status':_0x2c951c});const [_0x4f49f4,_0x47420f]=await this[_0x488a5b(0x26d)][_0x488a5b(0x261)]({'skip':(page-0x1)*size,'where':_0x14e1d0,'take':size,'cache':!![],'order':{'createdAt':'DESC'},'select':[_0x488a5b(0x234),_0x488a5b(0x37d),_0x488a5b(0x30d),_0x488a5b(0x365),'id']});return{'rows':_0x4f49f4,'count':_0x47420f};}async[_0x56b5f7(0x339)]({id:_0x2984f9}){const _0x3dac27=_0x56b5f7;let _0x1e6c55,_0x34e6d7;const _0x2fa2ca=await this['userEntity'][_0x3dac27(0x326)]({'where':{'id':_0x2984f9}});if(!_0x2fa2ca)throw new common_1[(_0x3dac27(0x330))](_0x3dac27(0x23d),common_1[_0x3dac27(0x25f)]['UNAUTHORIZED']);if((0x0,utils_1[_0x3dac27(0x33e)])(_0x2fa2ca[_0x3dac27(0x30d)])){const _0x57fc4c=_0x2fa2ca[_0x3dac27(0x30d)]===Role_constant_1[_0x3dac27(0x2ea)][_0x3dac27(0x35b)]?0x0:_0x2fa2ca[_0x3dac27(0x22e)],_0x1cd247=await this[_0x3dac27(0x2e9)][_0x3dac27(0x326)]({'where':{'code':_0x2fa2ca['role'],'saasId':_0x57fc4c}});if(!_0x1cd247)throw new common_1[(_0x3dac27(0x330))](_0x3dac27(0x240),common_1[_0x3dac27(0x25f)]['BAD_REQUEST']);_0x1e6c55=_0x1cd247[_0x3dac27(0x1e5)],_0x34e6d7=_0x1cd247[_0x3dac27(0x1b0)];}return{..._0x2fa2ca,'access':_0x1e6c55,'accessLabel':_0x34e6d7,'isBindWx':!!_0x2fa2ca?.[_0x3dac27(0x227)],'password':_0x2fa2ca['password']?_0x3dac27(0x30e):'no'};}async[_0x56b5f7(0x1ab)](_0x4f2b47){const _0x565cb8=_0x56b5f7;return await this[_0x565cb8(0x26d)][_0x565cb8(0x326)]({'where':{'username':_0x4f2b47}});}async[_0x56b5f7(0x2f3)](_0x2f62df){const _0x241289=_0x56b5f7,{id:_0x54fe86,status:_0x427859}=_0x2f62df,_0x12728b=await this[_0x241289(0x26d)][_0x241289(0x326)]({'where':{'id':_0x54fe86}});if(!_0x12728b)throw new common_1[(_0x241289(0x330))]('用户不存在！',common_1[_0x241289(0x25f)][_0x241289(0x373)]);if(_0x12728b[_0x241289(0x30d)]===Role_constant_1[_0x241289(0x2ea)]['SUPER'])throw new common_1[(_0x241289(0x330))](_0x241289(0x200),common_1[_0x241289(0x25f)]['BAD_REQUEST']);if(_0x12728b[_0x241289(0x365)]===user_constant_1[_0x241289(0x2d0)]['PENDING'])throw new common_1[(_0x241289(0x330))](_0x241289(0x2b0),common_1['HttpStatus'][_0x241289(0x373)]);if(_0x427859===user_constant_1[_0x241289(0x2d0)][_0x241289(0x216)])throw new common_1[(_0x241289(0x330))]('不可将用户置为未激活状态！',common_1[_0x241289(0x25f)]['BAD_REQUEST']);const _0x596df7=await this[_0x241289(0x26d)][_0x241289(0x1f2)]({'id':_0x54fe86},{'status':_0x427859});if(_0x596df7[_0x241289(0x1bd)]<=0x0)throw new common_1[(_0x241289(0x330))](_0x241289(0x2b7),common_1[_0x241289(0x25f)][_0x241289(0x373)]);return _0x241289(0x2d9);}async[_0x56b5f7(0x286)](_0x75a61c){const _0x33f986=_0x56b5f7,{id:_0x51e019,role:_0x363eee}=_0x75a61c,_0x54e5a4=await this[_0x33f986(0x26d)][_0x33f986(0x1f2)]({'id':_0x51e019},{'role':_0x363eee});if(_0x54e5a4[_0x33f986(0x1bd)]<=0x0)throw new common_1[(_0x33f986(0x330))](_0x33f986(0x256),common_1['HttpStatus'][_0x33f986(0x373)]);return _0x33f986(0x21e);}async[_0x56b5f7(0x2ba)](_0x299f00){const _0x781d6f=_0x56b5f7,{id:_0x4413f3}=_0x299f00,_0x174491=await this[_0x781d6f(0x26d)]['findOne']({'where':{'id':_0x4413f3}});if(!_0x174491)throw new common_1[(_0x781d6f(0x330))](_0x781d6f(0x268),common_1['HttpStatus'][_0x781d6f(0x373)]);const _0x4f9037='123456',_0x47d399=bcrypt[_0x781d6f(0x28f)](_0x4f9037,0xa),_0x40b299=await this[_0x781d6f(0x26d)][_0x781d6f(0x1f2)]({'id':_0x4413f3},{'password':_0x47d399});if(_0x40b299[_0x781d6f(0x1bd)]<=0x0)throw new common_1[(_0x781d6f(0x330))]('重置密码失败！',common_1[_0x781d6f(0x25f)][_0x781d6f(0x373)]);return'密码重置为['+_0x4f9037+_0x781d6f(0x21a);}async[_0x56b5f7(0x1aa)](_0xcddac,_0x4ee4f9){const _0x49fcaf=_0x56b5f7;return await this[_0x49fcaf(0x26d)][_0x49fcaf(0x1f2)]({'id':_0xcddac},{'lastLoginIp':_0x4ee4f9});}async[_0x56b5f7(0x24b)](_0x310f99,_0x427836){const _0x46ca77=_0x56b5f7;try{const _0x598b1e=await this['userEntity'][_0x46ca77(0x326)]({'where':{'id':_0x427836}});if(!_0x598b1e)return{'status':![],'msg':'当前绑定用户不存在！'};const _0x455a90=await this[_0x46ca77(0x26d)]['findOne']({'where':{'openId':_0x310f99}});if(_0x455a90)return{'status':![],'msg':_0x46ca77(0x31b)};const _0xc41f4a=await this[_0x46ca77(0x26d)][_0x46ca77(0x1f2)]({'id':_0x427836},{'openId':_0x310f99});if(_0xc41f4a[_0x46ca77(0x1bd)]<=0x0)return{'status':![],'msg':_0x46ca77(0x362)};return{'status':!![],'msg':'恭喜您绑定成功、后续可直接扫码登录了！'};}catch(_0x321bf6){return{'status':![],'msg':_0x46ca77(0x362)};}}async[_0x56b5f7(0x305)](_0x329d0f){const _0x43f5cb=_0x56b5f7,_0xfb6c19=await this[_0x43f5cb(0x26d)][_0x43f5cb(0x326)]({'where':{'id':_0x329d0f}});return _0xfb6c19?.[_0x43f5cb(0x227)];}async[_0x56b5f7(0x25e)](_0x3ab0ae){const _0x2f6f78=_0x56b5f7,_0x169bed=await this[_0x2f6f78(0x26d)][_0x2f6f78(0x326)]({'where':{'id':_0x3ab0ae}});return _0x169bed?.[_0x2f6f78(0x270)];}async['verifyUserRegisterByPhone'](_0x5bde35){const _0x40bd56=_0x56b5f7,{username:_0x3933ff,password:_0x217c38,phone:_0x1bf217,phoneCode:_0xe857b6}=_0x5bde35,_0x31015b=await this['userEntity'][_0x40bd56(0x326)]({'where':[{'username':_0x3933ff},{'phone':_0x1bf217}]});if(_0x31015b&&_0x31015b[_0x40bd56(0x234)]===_0x3933ff)throw new common_1[(_0x40bd56(0x330))](_0x40bd56(0x278),common_1['HttpStatus'][_0x40bd56(0x373)]);if(_0x31015b&&_0x31015b[_0x40bd56(0x31a)]===_0x1bf217)throw new common_1[(_0x40bd56(0x330))](_0x40bd56(0x2e5),common_1[_0x40bd56(0x25f)][_0x40bd56(0x373)]);}async[_0x56b5f7(0x298)](_0x5eeb3){const _0x191a6e=_0x56b5f7,_0x1978e3=(0x0,utils_1[_0x191a6e(0x2da)])(this[_0x191a6e(0x2fa)]);if(_0x5eeb3[_0x191a6e(0x30d)]!==Role_constant_1[_0x191a6e(0x2ea)][_0x191a6e(0x35b)])_0x5eeb3[_0x191a6e(0x22e)]=_0x1978e3;else{if(!_0x5eeb3['saasId'])throw new common_1['HttpException'](_0x191a6e(0x307),common_1[_0x191a6e(0x25f)][_0x191a6e(0x373)]);}return await this[_0x191a6e(0x26d)][_0x191a6e(0x352)](_0x5eeb3);}async['delUser'](_0x34d5c2){const _0x2557cb=_0x56b5f7,{id:_0x54ef66,moreId:_0x309f43}=_0x34d5c2;if(_0x54ef66)return await this[_0x2557cb(0x26d)][_0x2557cb(0x1e8)]({'id':_0x54ef66});if(_0x309f43)return await this[_0x2557cb(0x26d)][_0x2557cb(0x1e8)]({'id':(0x0,typeorm_2[_0x2557cb(0x1c9)])(_0x309f43)});}async[_0x56b5f7(0x33b)](_0x393882){const _0x114ff2=_0x56b5f7,_0x306c6c=_0x393882['user']['id'];return await this[_0x114ff2(0x26d)][_0x114ff2(0x1e8)]({'id':_0x306c6c})[_0x114ff2(0x279)](_0x343e3c=>_0x343e3c[_0x114ff2(0x1bd)]>0x0);}async[_0x56b5f7(0x27b)](_0x47dcce,_0x2be1bb){const _0x3d258c=_0x56b5f7;try{if(!_0x47dcce[_0x3d258c(0x234)]&&!_0x47dcce['phone']&&!_0x47dcce[_0x3d258c(0x205)])throw new Error(_0x3d258c(0x20f));if(_0x47dcce[_0x3d258c(0x234)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x3d258c(0x1db)](_0x47dcce['username']))throw new Error(_0x3d258c(0x34b));if(!_0x47dcce[_0x3d258c(0x37d)])throw new Error(_0x3d258c(0x1f9));}if(_0x47dcce['phone']){if(!(0x0,class_validator_1[_0x3d258c(0x2cd)])(_0x47dcce[_0x3d258c(0x31a)],_0x3d258c(0x2f1)))throw new Error(_0x3d258c(0x2fd));}if(_0x47dcce[_0x3d258c(0x205)]){if(!(0x0,class_validator_1[_0x3d258c(0x2d7)])(_0x47dcce[_0x3d258c(0x205)]))throw new Error(_0x3d258c(0x217));}if(_0x47dcce[_0x3d258c(0x234)]){const _0x56b28b=await this['userEntity']['exists']({'where':{'username':_0x47dcce['username']}});if(_0x56b28b)throw new Error('用户名已被使用！');}if(_0x47dcce[_0x3d258c(0x31a)]){const _0x2f2771=await this[_0x3d258c(0x26d)][_0x3d258c(0x303)]({'where':{'phone':_0x47dcce[_0x3d258c(0x31a)]}});if(_0x2f2771)throw new Error('手机号已被使用！');}if(_0x47dcce['email']){const _0x75d999=await this[_0x3d258c(0x26d)][_0x3d258c(0x303)]({'where':{'email':_0x47dcce[_0x3d258c(0x205)]}});if(_0x75d999)throw new Error(_0x3d258c(0x338));}const _0x514f7d=new user_entity_1[(_0x3d258c(0x266))]();for(let _0x220d33 in _0x47dcce){_0x47dcce[_0x220d33]&&(_0x514f7d[_0x220d33]=_0x47dcce[_0x220d33]);}return _0x514f7d['password']&&(_0x514f7d[_0x3d258c(0x37d)]=bcrypt[_0x3d258c(0x28f)](_0x47dcce[_0x3d258c(0x37d)],0xa)),_0x514f7d[_0x3d258c(0x365)]=user_constant_1['UserStatusEnum'][_0x3d258c(0x28d)],!_0x514f7d[_0x3d258c(0x2be)]&&(_0x514f7d['nickname']=_0x514f7d['nickname']||'小智'),!_0x514f7d[_0x3d258c(0x2cb)]&&(_0x514f7d['avatar']=await this[_0x3d258c(0x253)][_0x3d258c(0x314)]([_0x3d258c(0x2aa)])),await this['createUser'](_0x514f7d),!![];}catch(_0x5331a9){throw new common_1[(_0x3d258c(0x330))](_0x5331a9[_0x3d258c(0x2d6)],common_1['HttpStatus']['BAD_REQUEST']);}}[_0x56b5f7(0x2e8)](){const _0x170e2f=_0x56b5f7;let _0x46bd74=_0x170e2f(0x1dc);const _0x1d7a1b=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x551fb1=0x0;_0x551fb1<0xa;_0x551fb1++){_0x46bd74=_0x46bd74+_0x1d7a1b[Math['floor'](Math['random']()*0x3f)];}return _0x46bd74;}async[_0x56b5f7(0x36d)](_0x59af98){const _0x6893cb=_0x56b5f7;let _0x2171dd=[];for(let _0x7b29ca=0x0;_0x7b29ca<_0x59af98;_0x7b29ca++){_0x2171dd['push'](this[_0x6893cb(0x2e8)]());}const _0x436618=await this[_0x6893cb(0x26d)][_0x6893cb(0x27e)]({'where':{'username':(0x0,typeorm_2['In'])(_0x2171dd)}});if(!_0x436618[_0x6893cb(0x361)])return _0x2171dd;else{const _0x472704=new Set(_0x436618[_0x6893cb(0x285)](_0x1415c2=>_0x1415c2[_0x6893cb(0x234)]));_0x2171dd=_0x2171dd['filter'](_0x3b3932=>!_0x472704['has'](_0x3b3932));const _0x3d0d03=await this[_0x6893cb(0x36d)](_0x472704['size']);return _0x2171dd=_0x2171dd[_0x6893cb(0x368)](_0x3d0d03),_0x2171dd;}}async[_0x56b5f7(0x1d2)](_0x3a209f,_0x3b062a){const _0x433eba=_0x56b5f7;let _0x4f1f31='';_0x4f1f31=_0x433eba(0x371);const _0x4015aa=await this[_0x433eba(0x36d)](_0x3a209f[_0x433eba(0x2b1)]),_0x195e01=[],_0x3df962=[],_0x17c6d8=await this[_0x433eba(0x253)]['getConfigByKeys'](['userDefautlAvatar']);for(let _0x286f4b=0x0;_0x286f4b<_0x3a209f[_0x433eba(0x2b1)];_0x286f4b++){const _0x5ccb5f=new user_entity_1[(_0x433eba(0x266))]();_0x5ccb5f[_0x433eba(0x365)]=0x1,_0x5ccb5f[_0x433eba(0x2cb)]=_0x17c6d8,_0x5ccb5f[_0x433eba(0x234)]=_0x4015aa[_0x286f4b],_0x5ccb5f[_0x433eba(0x2be)]=_0x4015aa[_0x286f4b],_0x5ccb5f[_0x433eba(0x37d)]=bcrypt['hashSync']('mj123456admin',0xa),_0x4f1f31=_0x4f1f31+(_0x4015aa[_0x286f4b]+_0x433eba(0x336)),_0x3a209f[_0x433eba(0x35f)]&&(_0x5ccb5f['vipLeavelId']=Number(_0x3a209f[_0x433eba(0x35f)])),_0x3a209f[_0x433eba(0x1fc)]&&(_0x5ccb5f[_0x433eba(0x1fc)]=_0x3a209f['vipLeavelName']),_0x3a209f['score']&&(_0x5ccb5f[_0x433eba(0x210)]=_0x3a209f['score']),_0x3a209f[_0x433eba(0x1af)]&&_0x3df962[_0x433eba(0x214)]({'username':_0x4015aa[_0x286f4b],'vipDays':_0x3a209f[_0x433eba(0x1af)]}),_0x195e01['push'](_0x5ccb5f);}try{return await this['connection'][_0x433eba(0x2a9)](async()=>{const _0x414cbd=_0x433eba;await this['userEntity'][_0x414cbd(0x352)](_0x195e01),await this['userInitVipEntity'][_0x414cbd(0x352)](_0x3df962);}),_0x4f1f31;}catch(_0x46a1f7){throw new common_1[(_0x433eba(0x330))](_0x46a1f7['message'],axios_1['HttpStatusCode'][_0x433eba(0x220)]);}}async[_0x56b5f7(0x284)](_0x3f5fd7,_0x12b4f8){const _0x2a6281=_0x56b5f7,_0x3b907d=await this[_0x2a6281(0x26d)][_0x2a6281(0x326)]({'where':{'id':_0x12b4f8[_0x2a6281(0x231)]}});await this['userEntity']['increment']({'id':_0x3b907d['id']},_0x2a6281(0x210),_0x12b4f8['score']),await this[_0x2a6281(0x250)]['insertAccountLog']({'userId':_0x3b907d['id'],'rawScore':_0x3b907d[_0x2a6281(0x210)],'newScore':_0x3b907d[_0x2a6281(0x210)]+_0x12b4f8[_0x2a6281(0x210)],'changeScore':_0x12b4f8[_0x2a6281(0x210)],'changeType':balance_constant_1['EChangeType']['AdminGift'],'rebateUserId':_0x3f5fd7[_0x2a6281(0x232)]['id'],'description':'管理员赠送'});}async[_0x56b5f7(0x36c)](_0x2db0ec,_0x33a3aa){const _0x60d5c2=_0x56b5f7,_0x2ad854=await this[_0x60d5c2(0x26d)][_0x60d5c2(0x326)]({'where':{'id':_0x33a3aa[_0x60d5c2(0x231)]}});return await this[_0x60d5c2(0x1d8)](_0x2ad854,balance_constant_1[_0x60d5c2(0x259)][_0x60d5c2(0x1b7)],_0x33a3aa[_0x60d5c2(0x310)],_0x60d5c2(0x36f),_0x2db0ec['user']['id']),!![];}async['userInitVip'](_0x53c770){const _0x43f8e=_0x56b5f7,_0x34431b=await this[_0x43f8e(0x1c6)][_0x43f8e(0x326)]({'where':{'username':_0x53c770['username']}});_0x34431b&&await this[_0x43f8e(0x2c6)][_0x43f8e(0x2a9)](async()=>{const _0x2f4b38=_0x43f8e;_0x34431b[_0x2f4b38(0x1af)]===-0x1?_0x53c770[_0x2f4b38(0x1bb)]=0x1:_0x53c770['vipExpire']=(0x0,date_1['default'])()['add'](_0x34431b[_0x2f4b38(0x1af)],_0x2f4b38(0x2f7))['toDate'](),_0x53c770=await this[_0x2f4b38(0x26d)][_0x2f4b38(0x352)](_0x53c770),await this['userInitVipEntity'][_0x2f4b38(0x1e8)]({'id':_0x34431b['id']});});}async['updateSignDay'](_0x16d061,_0x2aa67e){const _0x9dc5e4=_0x56b5f7;await this[_0x9dc5e4(0x26d)][_0x9dc5e4(0x1f2)]({'id':_0x16d061},{'consecutiveDays':_0x2aa67e});}async[_0x56b5f7(0x382)](_0x215155){const _0xf69d81=_0x56b5f7,_0x19de8d=await this[_0xf69d81(0x367)](_0x215155);_0x19de8d[_0xf69d81(0x1e6)]=_0x19de8d[_0xf69d81(0x1e6)]+0x1,await this[_0xf69d81(0x26d)][_0xf69d81(0x352)](_0x19de8d);}async[_0x56b5f7(0x258)](_0x12385e,_0xfe9b59){const _0x42bf18=_0x56b5f7,_0x5ee4b6=await this[_0x42bf18(0x253)][_0x42bf18(0x314)]([_0x42bf18(0x37a),'registerRewards',_0x42bf18(0x1f4),'inviteRewards','inviteRewardVip',_0x42bf18(0x23c),'invitedRewardVip']),_0x2e8a99={};for(let _0x4a2336 in _0x5ee4b6){const _0x1a2b7a=Number(_0x5ee4b6[_0x4a2336]),_0x42cb87=Number[_0x42bf18(0x1c7)](_0x1a2b7a)&&_0x1a2b7a>0x0?_0x1a2b7a:0x0;_0x2e8a99[_0x4a2336]=_0x42cb87;}_0x2e8a99[_0x42bf18(0x37a)]&&(await this[_0x42bf18(0x26d)][_0x42bf18(0x1f2)]({'id':_0x12385e['id']},{'score':_0x2e8a99[_0x42bf18(0x325)]}),await this['userBalanceService'][_0x42bf18(0x1f6)]({'userId':_0x12385e['id'],'rawScore':0x0,'newScore':_0x2e8a99['registerRewards'],'changeScore':_0x2e8a99[_0x42bf18(0x325)],'changeType':balance_constant_1['EChangeType'][_0x42bf18(0x275)],'description':_0x42bf18(0x260)}));if(_0xfe9b59&&_0x2e8a99[_0x42bf18(0x1f4)]){_0x2e8a99['inviteRewards']&&(await this[_0x42bf18(0x26d)]['increment']({'id':_0xfe9b59['id']},'score',_0x2e8a99[_0x42bf18(0x23e)]),await this[_0x42bf18(0x250)][_0x42bf18(0x1f6)]({'userId':_0xfe9b59['id'],'rawScore':_0xfe9b59[_0x42bf18(0x210)],'newScore':_0xfe9b59[_0x42bf18(0x210)]+_0x2e8a99['inviteRewards'],'changeScore':_0x2e8a99[_0x42bf18(0x23e)],'changeType':balance_constant_1[_0x42bf18(0x259)][_0x42bf18(0x1cc)],'rebateUserId':_0x12385e['id'],'description':_0x42bf18(0x221)}));_0x2e8a99[_0x42bf18(0x322)]&&await this[_0x42bf18(0x1d8)](_0xfe9b59,balance_constant_1[_0x42bf18(0x259)][_0x42bf18(0x1cc)],_0x2e8a99[_0x42bf18(0x322)],'邀请新用户注册奖励',_0x12385e['id']);const _0xb19903=await this['userEntity'][_0x42bf18(0x326)]({'where':{'id':_0x12385e['id']}});_0x2e8a99[_0x42bf18(0x23c)]&&(await this[_0x42bf18(0x26d)]['increment']({'id':_0xb19903['id']},_0x42bf18(0x210),_0x2e8a99[_0x42bf18(0x23c)]),await this[_0x42bf18(0x250)][_0x42bf18(0x1f6)]({'userId':_0x12385e['id'],'rawScore':_0xb19903['score'],'newScore':_0xb19903['score']+_0x2e8a99[_0x42bf18(0x23c)],'changeScore':_0x2e8a99[_0x42bf18(0x23c)],'changeType':balance_constant_1[_0x42bf18(0x259)]['Invited'],'rebateUserId':_0xfe9b59['id'],'description':_0x42bf18(0x29f)})),_0x2e8a99[_0x42bf18(0x2c9)]&&await this[_0x42bf18(0x1d8)](_0xb19903,balance_constant_1[_0x42bf18(0x259)][_0x42bf18(0x342)],_0x2e8a99[_0x42bf18(0x2c9)],_0x42bf18(0x29f),_0xfe9b59['id']);}}async[_0x56b5f7(0x37e)](_0x2fed9c,_0x31a1ea,_0x26ac5e,_0x3ae751,_0x10575c){const _0x295d13=_0x56b5f7;await this[_0x295d13(0x26d)][_0x295d13(0x1f2)]({'id':_0x2fed9c['id']},{'score':_0x2fed9c['score']+_0x26ac5e}),await this[_0x295d13(0x250)][_0x295d13(0x1f6)]({'userId':_0x2fed9c['id'],'rawScore':_0x2fed9c[_0x295d13(0x210)],'newScore':_0x2fed9c['score']+_0x26ac5e,'changeScore':_0x26ac5e,'changeType':_0x31a1ea,'relateId':_0x10575c?String(_0x10575c):null,'description':_0x3ae751});}async[_0x56b5f7(0x1d8)](_0x1f2c45,_0x28033e,_0x3729f3,_0x2c3ef1,_0x1b4c57){const _0x58e29e=_0x56b5f7;if(_0x1f2c45['lifetimeVip'])return;_0x3729f3===-0x1?await this['userEntity']['update']({'id':_0x1f2c45['id']},{'lifetimeVip':0x1}):(_0x1f2c45[_0x58e29e(0x1bc)]?_0x1f2c45[_0x58e29e(0x1bc)]=(0x0,date_1[_0x58e29e(0x2e0)])(_0x1f2c45[_0x58e29e(0x1bc)])[_0x58e29e(0x2e1)](_0x3729f3,_0x58e29e(0x2f7))['toDate']():_0x1f2c45[_0x58e29e(0x1bc)]=(0x0,date_1['default'])()[_0x58e29e(0x2e1)](_0x3729f3,_0x58e29e(0x2f7))[_0x58e29e(0x1ee)](),await this[_0x58e29e(0x26d)][_0x58e29e(0x1f2)]({'id':_0x1f2c45['id']},{'vipExpire':_0x1f2c45['vipExpire']})),_0x1f2c45=await this[_0x58e29e(0x26d)][_0x58e29e(0x326)]({'where':{'id':_0x1f2c45['id']}}),await this[_0x58e29e(0x250)][_0x58e29e(0x2fb)]({'userId':_0x1f2c45['id'],'vipDays':_0x3729f3,'vipExpire':_0x1f2c45[_0x58e29e(0x1bc)],'relateType':_0x28033e,'relateId':_0x1b4c57?String(_0x1b4c57):'','description':_0x2c3ef1});}async[_0x56b5f7(0x1c3)](_0x1b5524,_0x10f3e5){const _0xce6a54=_0x56b5f7;let _0x18f4bc=!![];const _0x185655=await this['getUserById'](_0x1b5524);if(_0x185655[_0xce6a54(0x1bb)]||_0x185655[_0xce6a54(0x1bc)]){if(_0x10f3e5[_0xce6a54(0x380)]<0x0)_0x18f4bc=!![];else{if(_0x10f3e5[_0xce6a54(0x380)]>0x0){const _0x4eb2e0=redisKey_constant_1['VIP_FREE']+'-'+_0x1b5524+'-'+_0x10f3e5['id'];let _0x1c4760=await this[_0xce6a54(0x22a)][_0xce6a54(0x30b)]({'key':_0x4eb2e0});console[_0xce6a54(0x35c)](_0x1c4760);let _0x10261b=Number(_0x1c4760||0x0);_0x10261b<_0x10f3e5['vipFreeNum']?_0x18f4bc=!![]:_0x18f4bc=_0x185655[_0xce6a54(0x210)]>=_0x10f3e5[_0xce6a54(0x1c1)];}else _0x18f4bc=_0x185655[_0xce6a54(0x210)]>=_0x10f3e5[_0xce6a54(0x1c1)];}}else _0x18f4bc=_0x185655[_0xce6a54(0x210)]>=_0x10f3e5[_0xce6a54(0x1c1)];if(!_0x18f4bc)throw new common_1[(_0xce6a54(0x330))](_0xce6a54(0x1f3),common_1[_0xce6a54(0x25f)][_0xce6a54(0x373)]);}async['deductBalance4Chat'](_0x38be8f,_0x18594c,_0x3cb426){const _0x5222c8=_0x56b5f7,_0x327411=await this[_0x5222c8(0x367)](_0x38be8f);let _0x468a53;switch(_0x18594c[_0x5222c8(0x2c5)]){case model_constant_1[_0x5222c8(0x28a)]['PPT']:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x263)];break;case model_constant_1[_0x5222c8(0x28a)][_0x5222c8(0x31c)]:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x291)];break;case model_constant_1['EModelType']['MUSIC']:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x24e)];break;case model_constant_1['EModelType'][_0x5222c8(0x32d)]:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x32d)];break;case model_constant_1[_0x5222c8(0x28a)]['DRAW']:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x30f)];break;case model_constant_1[_0x5222c8(0x28a)]['CHAT']:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x33c)];break;case model_constant_1['EModelType'][_0x5222c8(0x2c3)]:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x332)];break;case model_constant_1[_0x5222c8(0x28a)][_0x5222c8(0x1b4)]:_0x468a53=balance_constant_1['EChangeType'][_0x5222c8(0x34d)];break;case model_constant_1[_0x5222c8(0x28a)]['TTS']:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x24c)];break;default:_0x468a53=balance_constant_1[_0x5222c8(0x259)][_0x5222c8(0x33c)];}if(_0x327411['lifetimeVip']||_0x327411[_0x5222c8(0x1bc)]){if(_0x18594c['vipFreeNum']<0x0)await this[_0x5222c8(0x37e)](_0x327411,_0x468a53,0x0,'模型【'+_0x18594c[_0x5222c8(0x1ed)]+'】会员永久免费',_0x3cb426);else{if(_0x18594c[_0x5222c8(0x380)]>0x0){const _0xda195c=redisKey_constant_1[_0x5222c8(0x318)]+'-'+_0x38be8f+'-'+_0x18594c['id'];let _0x3b1a7a=await this[_0x5222c8(0x22a)][_0x5222c8(0x30b)]({'key':_0xda195c}),_0x33a1a9=Number(_0x3b1a7a||0x0);if(_0x33a1a9<_0x18594c['vipFreeNum']){const _0xbd7e69=(0x0,date_1[_0x5222c8(0x2e0)])()[_0x5222c8(0x2a4)]('d')[_0x5222c8(0x2f0)]((0x0,date_1[_0x5222c8(0x2e0)])(),'s');await this[_0x5222c8(0x22a)][_0x5222c8(0x37f)]({'key':_0xda195c,'val':_0x33a1a9+0x1},_0xbd7e69),await this[_0x5222c8(0x37e)](_0x327411,_0x468a53,0x0,_0x5222c8(0x2e2)+_0x18594c['modelName']+_0x5222c8(0x25c),_0x3cb426);}else await this['changeScore4Other'](_0x327411,_0x468a53,-_0x18594c[_0x5222c8(0x1c1)],_0x5222c8(0x2e2)+_0x18594c[_0x5222c8(0x1ed)]+_0x5222c8(0x329),_0x3cb426);}else await this[_0x5222c8(0x37e)](_0x327411,_0x468a53,-_0x18594c['deduct'],_0x5222c8(0x2e2)+_0x18594c[_0x5222c8(0x1ed)]+_0x5222c8(0x329),_0x3cb426);}}else await this[_0x5222c8(0x37e)](_0x327411,_0x468a53,-_0x18594c[_0x5222c8(0x1c1)],_0x5222c8(0x2e2)+_0x18594c[_0x5222c8(0x1ed)]+_0x5222c8(0x329),_0x3cb426);}async['validateBalance4Video'](_0x5f1b23,_0x36ae53,_0x13bb46){const _0x330c43=_0x56b5f7;let _0x5c55c9=!![],_0x5841ed=await this[_0x330c43(0x1d1)](_0x36ae53,_0x13bb46);const _0x178fed=await this[_0x330c43(0x367)](_0x5f1b23);if(_0x178fed[_0x330c43(0x1bb)]||_0x178fed[_0x330c43(0x1bc)]){if(_0x36ae53['vipFreeNum']<0x0||_0x5841ed?.[_0x330c43(0x380)]<0x0){_0x5c55c9=!![];return;}else{if(_0x5841ed?.[_0x330c43(0x380)]>0x0){const _0x4c8198=redisKey_constant_1[_0x330c43(0x318)]+'-'+_0x5f1b23+'-'+_0x5841ed[_0x330c43(0x358)]+'-'+_0x5841ed[_0x330c43(0x1d5)]+'-'+_0x5841ed[_0x330c43(0x1ea)];let _0x53e279=await this['redisCacheService'][_0x330c43(0x30b)]({'key':_0x4c8198}),_0x2d7034=Number(_0x53e279||0x0);if(_0x2d7034<_0x5841ed[_0x330c43(0x380)]){_0x5c55c9=!![];return;}}else{if(_0x36ae53['vipFreeNum']>0x0){const _0x1e00b1=redisKey_constant_1[_0x330c43(0x318)]+'-'+_0x5f1b23+'-'+_0x36ae53['id'];let _0x226c8c=await this['redisCacheService'][_0x330c43(0x30b)]({'key':_0x1e00b1});console[_0x330c43(0x35c)](_0x226c8c);let _0x32ea72=Number(_0x226c8c||0x0);if(_0x32ea72<_0x36ae53[_0x330c43(0x380)]){_0x5c55c9=!![];return;}}}}}_0x5c55c9=_0x178fed[_0x330c43(0x210)]>=_0x36ae53[_0x330c43(0x1c1)];if(!_0x5c55c9)throw new common_1[(_0x330c43(0x330))](_0x330c43(0x1f3),common_1['HttpStatus'][_0x330c43(0x373)]);}async[_0x56b5f7(0x1eb)](_0x29e9d0,_0x4f8594,_0x49a982,_0x55e556){const _0x42ebca=_0x56b5f7,_0x3adda0=await this[_0x42ebca(0x367)](_0x29e9d0);let _0x1eba44=await this[_0x42ebca(0x1d1)](_0x4f8594,_0x49a982);console[_0x42ebca(0x35c)]('------------------VVVVVVVVVVV1------------',_0x1eba44);if(_0x3adda0[_0x42ebca(0x1bb)]||_0x3adda0['vipExpire']){if(_0x4f8594[_0x42ebca(0x380)]<0x0||_0x1eba44?.[_0x42ebca(0x380)]<0x0){await this[_0x42ebca(0x37e)](_0x3adda0,balance_constant_1[_0x42ebca(0x259)][_0x42ebca(0x32d)],0x0,_0x42ebca(0x2e2)+_0x4f8594['modelName']+_0x42ebca(0x2ed),_0x55e556);return;}else{if(_0x1eba44?.[_0x42ebca(0x380)]>0x0){const _0x59ad49=redisKey_constant_1[_0x42ebca(0x318)]+'-'+_0x29e9d0+'-'+_0x1eba44[_0x42ebca(0x358)]+'-'+_0x1eba44[_0x42ebca(0x1d5)]+'-'+_0x1eba44['duration'];let _0x33bbd3=await this[_0x42ebca(0x22a)][_0x42ebca(0x30b)]({'key':_0x59ad49}),_0x2ebb53=Number(_0x33bbd3||0x0);if(_0x2ebb53<_0x1eba44['vipFreeNum']){const _0x4643cb=(0x0,date_1[_0x42ebca(0x2e0)])()[_0x42ebca(0x2a4)]('d')['diff']((0x0,date_1[_0x42ebca(0x2e0)])(),'s');await this[_0x42ebca(0x22a)]['set']({'key':_0x59ad49,'val':_0x2ebb53+0x1},_0x4643cb);return;}}else{if(_0x4f8594[_0x42ebca(0x380)]>0x0){const _0x542213=redisKey_constant_1[_0x42ebca(0x318)]+'-'+_0x29e9d0+'-'+_0x4f8594['id'];let _0x5c986a=await this[_0x42ebca(0x22a)][_0x42ebca(0x30b)]({'key':_0x542213}),_0x53b9f1=Number(_0x5c986a||0x0);if(_0x53b9f1<_0x4f8594[_0x42ebca(0x380)]){const _0x1c628c=(0x0,date_1['default'])()[_0x42ebca(0x2a4)]('d')[_0x42ebca(0x2f0)]((0x0,date_1[_0x42ebca(0x2e0)])(),'s');await this[_0x42ebca(0x22a)][_0x42ebca(0x37f)]({'key':_0x542213,'val':_0x53b9f1+0x1},_0x1c628c);return;}}}}}await this[_0x42ebca(0x37e)](_0x3adda0,balance_constant_1[_0x42ebca(0x259)][_0x42ebca(0x32d)],_0x1eba44?.[_0x42ebca(0x251)]>0x0?-_0x1eba44?.[_0x42ebca(0x251)]:-_0x4f8594[_0x42ebca(0x1c1)],_0x42ebca(0x2e2)+_0x4f8594['modelName']+_0x42ebca(0x25c),_0x55e556);}async['refundBalance4Video'](_0x4d4bbd,_0x4decab,_0x5aa1c5,_0x2b3560){const _0x1a21b4=_0x56b5f7;let _0x11962d=await this[_0x1a21b4(0x1d1)](_0x4decab,_0x5aa1c5);const _0x2333ab=await this['getUserById'](_0x4d4bbd);if(_0x2333ab[_0x1a21b4(0x1bb)]||_0x2333ab[_0x1a21b4(0x1bc)]){if(_0x4decab['vipFreeNum']<0x0||_0x11962d?.['vipFreeNum']<0x0)return;else{if(_0x11962d?.['vipFreeNum']>0x0){const _0x2591aa=redisKey_constant_1[_0x1a21b4(0x318)]+'-'+_0x4d4bbd+'-'+_0x11962d[_0x1a21b4(0x358)]+'-'+_0x11962d[_0x1a21b4(0x1d5)]+'-'+_0x11962d[_0x1a21b4(0x1ea)];let _0x58e06b=await this[_0x1a21b4(0x22a)][_0x1a21b4(0x30b)]({'key':_0x2591aa}),_0x4b9c3b=Number(_0x58e06b||0x0);if(_0x4b9c3b>=_0x11962d[_0x1a21b4(0x380)]){const _0x37de90=(0x0,date_1[_0x1a21b4(0x2e0)])()['endOf']('d')[_0x1a21b4(0x2f0)]((0x0,date_1['default'])(),'s');await this[_0x1a21b4(0x22a)][_0x1a21b4(0x37f)]({'key':_0x2591aa,'val':_0x4b9c3b-0x1},_0x37de90);return;}}else{if(_0x4decab[_0x1a21b4(0x380)]>0x0){const _0x72b78e=redisKey_constant_1[_0x1a21b4(0x318)]+'-'+_0x4d4bbd+'-'+_0x4decab['id'];let _0xbb637c=await this['redisCacheService']['get']({'key':_0x72b78e}),_0x4bb830=Number(_0xbb637c||0x0);if(_0x4bb830>=_0x4decab[_0x1a21b4(0x380)]){const _0x5b6281=(0x0,date_1[_0x1a21b4(0x2e0)])()['endOf']('d')[_0x1a21b4(0x2f0)]((0x0,date_1[_0x1a21b4(0x2e0)])(),'s');await this[_0x1a21b4(0x22a)][_0x1a21b4(0x37f)]({'key':_0x72b78e,'val':_0x4bb830-0x1},_0x5b6281);return;}}}}}await this[_0x1a21b4(0x37e)](_0x2333ab,balance_constant_1[_0x1a21b4(0x259)]['VIDEO'],_0x11962d?.['price']>0x0?_0x11962d?.[_0x1a21b4(0x251)]:_0x4decab[_0x1a21b4(0x1c1)],'模型【'+_0x4decab[_0x1a21b4(0x1ed)]+'】失败退还',_0x2b3560);}async[_0x56b5f7(0x2e7)](_0x5b2754,_0x11267c,_0xda516c){const _0x2a4a0c=_0x56b5f7,_0x198791=await this[_0x2a4a0c(0x367)](_0x5b2754);let _0x1bcc4a;switch(_0x11267c[_0x2a4a0c(0x2c5)]){case model_constant_1[_0x2a4a0c(0x28a)][_0x2a4a0c(0x31c)]:_0x1bcc4a=balance_constant_1[_0x2a4a0c(0x259)]['GPTS'];break;case model_constant_1[_0x2a4a0c(0x28a)][_0x2a4a0c(0x1df)]:_0x1bcc4a=balance_constant_1[_0x2a4a0c(0x259)][_0x2a4a0c(0x24e)];break;case model_constant_1[_0x2a4a0c(0x28a)]['DRAW']:_0x1bcc4a=balance_constant_1[_0x2a4a0c(0x259)][_0x2a4a0c(0x30f)];break;case model_constant_1[_0x2a4a0c(0x28a)][_0x2a4a0c(0x208)]:_0x1bcc4a=balance_constant_1[_0x2a4a0c(0x259)]['Chat'];break;case model_constant_1[_0x2a4a0c(0x28a)][_0x2a4a0c(0x2c3)]:_0x1bcc4a=balance_constant_1[_0x2a4a0c(0x259)][_0x2a4a0c(0x332)];break;case model_constant_1[_0x2a4a0c(0x28a)][_0x2a4a0c(0x32d)]:_0x1bcc4a=balance_constant_1[_0x2a4a0c(0x259)][_0x2a4a0c(0x32d)];break;default:_0x1bcc4a=balance_constant_1[_0x2a4a0c(0x259)]['Chat'];}await this[_0x2a4a0c(0x37e)](_0x198791,_0x1bcc4a,_0x11267c[_0x2a4a0c(0x1c1)],_0x2a4a0c(0x2e2)+_0x11267c[_0x2a4a0c(0x1ed)]+_0x2a4a0c(0x20a),_0xda516c);}async[_0x56b5f7(0x203)](_0x71c431,_0xf32005,_0x3c6080){const _0x1f013c=_0x56b5f7;let _0x1f122f='',_0x2214bd='',_0x3fe817='',_0x33cd12=_0xf32005;const _0xa13486=_0xf32005[_0x1f013c(0x309)](),_0x41ac73=new RegExp(_0x1f013c(0x1ef)),_0x581659=new RegExp(_0x1f013c(0x237)),_0x5bae7a=new RegExp(_0x1f013c(0x2bc));if(_0x71c431===midjourney_constant_1[_0x1f013c(0x25b)][_0x1f013c(0x2d8)])_0x2214bd=_0x1f013c(0x2ab),_0x1f122f='fast_mjDeduction',_0x3fe817=_0x1f013c(0x204);else{if(_0x71c431===midjourney_constant_1[_0x1f013c(0x25b)][_0x1f013c(0x2cf)])_0x2214bd=_0x1f013c(0x294),_0x1f122f='relax_mjDeduction',_0x3fe817='relax_vip_free';else _0x71c431===midjourney_constant_1[_0x1f013c(0x25b)]['turbo']&&(_0x2214bd='type3',_0x1f122f=_0x1f013c(0x29d),_0x3fe817=_0x1f013c(0x35a));}if(_0x41ac73[_0x1f013c(0x1db)](_0xa13486))_0x1f122f=_0x1f122f+0x1;else{if(_0x581659['test'](_0xa13486))_0x1f122f=_0x1f122f+0x2;else _0x5bae7a[_0x1f013c(0x1db)](_0xa13486)&&(_0x1f122f=_0x1f122f+0x3);}const _0x572a75=await this[_0x1f013c(0x282)][_0x1f013c(0x2ad)]('MjLeavelRel');let _0x105827={};if(!_0x572a75){let _0x175fc1=await this[_0x1f013c(0x253)]['getConfigByKeys']([_0x1f122f,_0x3fe817]);for(let _0x5bbcd0 in _0x175fc1){_0x105827[_0x5bbcd0]=Number(_0x175fc1[_0x5bbcd0])||0x0;}if(_0x3c6080[_0x1f013c(0x35f)]){const _0x40981b=await this[_0x1f013c(0x253)][_0x1f013c(0x24d)](_0x3c6080[_0x1f013c(0x35f)],'mj');_0x40981b&&(_0x105827[_0x3fe817]=_0x40981b[_0x2214bd]||0x0);}}else{const _0x30a419=_0x3c6080[_0x1f013c(0x1fc)]||'';_0x105827=_0x572a75[_0x1f013c(0x1c5)][_0x30a419],(!_0x105827||!_0x105827[_0x1f013c(0x204)])&&(_0x105827=_0x572a75[_0x1f013c(0x1c5)][_0x1f013c(0x1f7)]);}for(let _0x29ca26 in midjourney_constant_1['ActionCN']){if(_0xa13486[_0x1f013c(0x1b5)](midjourney_constant_1['ActionCN'][_0x29ca26][_0x1f013c(0x32b)])){_0x33cd12=midjourney_constant_1['ActionCN'][_0x29ca26]['cn'];break;}}return{'price':Number(_0x105827[_0x1f122f]),'vipFreeNum':Number(_0x105827[_0x3fe817]),'vipFreeKey':_0x3fe817,'description':_0x33cd12};}async[_0x56b5f7(0x20d)](_0xa42a06,_0x223955=midjourney_constant_1[_0x56b5f7(0x25b)]['relax'],_0x42bf64){const _0x5a1d9f=_0x56b5f7;let _0x3faa88=!![];const _0x1e1828=await this[_0x5a1d9f(0x367)](_0xa42a06),_0x317dbd=await this[_0x5a1d9f(0x203)](_0x223955,_0x42bf64,_0x1e1828);console[_0x5a1d9f(0x35c)]('------------------------Price--------------',_0x317dbd);if(_0x1e1828[_0x5a1d9f(0x1bb)]||_0x1e1828[_0x5a1d9f(0x1bc)]){if(_0x317dbd[_0x5a1d9f(0x380)]<0x0)_0x3faa88=!![];else{if(_0x317dbd[_0x5a1d9f(0x380)]>0x0){const _0x434e2c=redisKey_constant_1['VIP_FREE']+'-'+_0xa42a06+'-'+_0x317dbd[_0x5a1d9f(0x34e)];let _0x7e5c4d=await this[_0x5a1d9f(0x22a)][_0x5a1d9f(0x30b)]({'key':_0x434e2c}),_0x53ea0f=Number(_0x7e5c4d||0x0);_0x53ea0f<_0x317dbd[_0x5a1d9f(0x380)]?_0x3faa88=!![]:_0x3faa88=_0x1e1828[_0x5a1d9f(0x210)]>=_0x317dbd[_0x5a1d9f(0x251)];}else _0x3faa88=_0x1e1828[_0x5a1d9f(0x210)]>=_0x317dbd[_0x5a1d9f(0x251)];}}else _0x3faa88=_0x1e1828['score']>=_0x317dbd[_0x5a1d9f(0x251)];if(_0x223955===midjourney_constant_1[_0x5a1d9f(0x25b)][_0x5a1d9f(0x2cf)]){if(!_0x3faa88)throw new common_1['HttpException'](_0x5a1d9f(0x1f3),common_1[_0x5a1d9f(0x25f)][_0x5a1d9f(0x373)]);}else{if(!_0x3faa88)return this['validateBalance4MJ'](_0xa42a06,midjourney_constant_1['DrawSpeed']['relax'],_0x42bf64);}return _0x223955;}async['deductBalance4MJ'](_0x55858e,_0x207b5d,_0x5268d1,_0x280927){const _0x23854e=_0x56b5f7,_0x21025f=await this['getUserById'](_0x55858e),_0x2b9ed3=await this['getMjPrice'](_0x207b5d,_0x5268d1,_0x21025f),_0x3525f8=balance_constant_1[_0x23854e(0x259)][_0x23854e(0x1f1)];if(_0x21025f[_0x23854e(0x1bb)]||_0x21025f[_0x23854e(0x1bc)]){if(_0x2b9ed3[_0x23854e(0x380)]<0x0)await this[_0x23854e(0x37e)](_0x21025f,_0x3525f8,0x0,_0x23854e(0x356)+_0x2b9ed3['description']+_0x23854e(0x2ed),_0x280927);else{if(_0x2b9ed3[_0x23854e(0x380)]>0x0){const _0x33d71c=redisKey_constant_1[_0x23854e(0x318)]+'-'+_0x55858e+'-'+_0x2b9ed3[_0x23854e(0x34e)];let _0x7442fe=await this[_0x23854e(0x22a)]['get']({'key':_0x33d71c}),_0x598cb3=Number(_0x7442fe||0x0);if(_0x598cb3<_0x2b9ed3['vipFreeNum']){const _0x1f6209=(0x0,date_1['default'])()[_0x23854e(0x2a4)]('d')['diff']((0x0,date_1[_0x23854e(0x2e0)])(),'s');await this[_0x23854e(0x22a)][_0x23854e(0x37f)]({'key':_0x33d71c,'val':_0x598cb3+0x1},_0x1f6209),await this[_0x23854e(0x37e)](_0x21025f,_0x3525f8,0x0,_0x23854e(0x356)+_0x2b9ed3[_0x23854e(0x2bb)]+'】会员每日限免',_0x280927);}else await this[_0x23854e(0x37e)](_0x21025f,_0x3525f8,-_0x2b9ed3[_0x23854e(0x251)],_0x23854e(0x356)+_0x2b9ed3[_0x23854e(0x2bb)]+_0x23854e(0x329),_0x280927);}else await this[_0x23854e(0x37e)](_0x21025f,_0x3525f8,-_0x2b9ed3[_0x23854e(0x251)],'MJ绘画【'+_0x2b9ed3[_0x23854e(0x2bb)]+_0x23854e(0x329),_0x280927);}}else await this[_0x23854e(0x37e)](_0x21025f,_0x3525f8,-_0x2b9ed3[_0x23854e(0x251)],_0x23854e(0x356)+_0x2b9ed3[_0x23854e(0x2bb)]+_0x23854e(0x329),_0x280927);}async['refundBalance4MJ'](_0xec26b9,_0x236f6b,_0x53db9d,_0x301f59){const _0x225319=_0x56b5f7,_0x242b61=await this[_0x225319(0x367)](_0xec26b9),_0x454857=await this[_0x225319(0x203)](_0x236f6b,_0x53db9d,_0x242b61),_0x48e833=balance_constant_1[_0x225319(0x259)]['MjDraw'];if(_0x242b61[_0x225319(0x1bb)]||_0x242b61[_0x225319(0x1bc)]){if(_0x454857[_0x225319(0x380)]<0x0)return;else{if(_0x454857[_0x225319(0x380)]>0x0){const _0x44925c=redisKey_constant_1[_0x225319(0x318)]+'-'+_0xec26b9+'-'+_0x454857[_0x225319(0x34e)];let _0x170bfc=await this[_0x225319(0x22a)][_0x225319(0x30b)]({'key':_0x44925c}),_0x50c321=Number(_0x170bfc||0x0);if(_0x50c321<_0x454857[_0x225319(0x380)]){const _0x36c95f=(0x0,date_1['default'])()[_0x225319(0x2a4)]('d')[_0x225319(0x2f0)]((0x0,date_1[_0x225319(0x2e0)])(),'s');await this[_0x225319(0x22a)]['set']({'key':_0x44925c,'val':_0x50c321-0x1},_0x36c95f);return;}}}}await this[_0x225319(0x37e)](_0x242b61,_0x48e833,_0x454857[_0x225319(0x251)],'MJ绘画【'+_0x454857[_0x225319(0x2bb)]+'】使用失败退费',_0x301f59);}async[_0x56b5f7(0x1d7)](_0x516ae6,_0x478ff8,_0xc3a7ff,_0x30f9b6=![]){const _0x2f3919=_0x56b5f7,_0x71fc8={'create':{'key':_0x2f3919(0x347),'desc':_0x2f3919(0x33f)},'lyrics':{'key':_0x2f3919(0x287),'desc':_0x2f3919(0x28e)},'upload':{'key':'musicUpload','desc':'上传音乐'}},_0x43ba08=_0x71fc8[_0xc3a7ff]['desc'],_0xcb5261=_0x71fc8[_0xc3a7ff]['key']+_0x2f3919(0x1f8),_0x89e457=_0x71fc8[_0xc3a7ff]['key']+_0x2f3919(0x2f8),_0x3c2a08={},_0x398ad3=await this['globalConfigService'][_0x2f3919(0x314)]([_0xcb5261,_0x89e457]);for(let _0x59798f in _0x398ad3){_0x3c2a08[_0x59798f]=Number(_0x398ad3[_0x59798f])||0x0;}const _0x37cab4=await this[_0x2f3919(0x367)](_0x516ae6);if(_0x37cab4[_0x2f3919(0x1bb)]||_0x37cab4['vipExpire']){if(_0x3c2a08[_0x89e457]<0x0){!_0x30f9b6&&await this[_0x2f3919(0x37e)](_0x37cab4,balance_constant_1[_0x2f3919(0x259)]['Music'],0x0,_0x2f3919(0x375)+_0x43ba08+_0x2f3919(0x2ed),_0x478ff8);return;}else{if(_0x3c2a08[_0x89e457]>0x0){const _0x5b86c2=redisKey_constant_1[_0x2f3919(0x318)]+'-'+_0x516ae6+'-'+_0x89e457;let _0x3f1cc4=await this[_0x2f3919(0x22a)]['get']({'key':_0x5b86c2}),_0x19b234=Number(_0x3f1cc4||0x0);if(!_0x30f9b6){if(_0x19b234<_0x3c2a08[_0x89e457]){const _0x30be3e=(0x0,date_1[_0x2f3919(0x2e0)])()[_0x2f3919(0x2a4)]('d')[_0x2f3919(0x2f0)]((0x0,date_1[_0x2f3919(0x2e0)])(),'s');await this[_0x2f3919(0x22a)][_0x2f3919(0x37f)]({'key':_0x5b86c2,'val':_0x19b234+0x1},_0x30be3e),await this[_0x2f3919(0x37e)](_0x37cab4,balance_constant_1[_0x2f3919(0x259)][_0x2f3919(0x24e)],0x0,_0x2f3919(0x375)+_0x43ba08+'】会员每日限免',_0x478ff8);return;}}else{const _0x4cf8c0=(0x0,date_1[_0x2f3919(0x2e0)])()['endOf']('d')[_0x2f3919(0x2f0)]((0x0,date_1['default'])(),'s');await this[_0x2f3919(0x22a)]['set']({'key':_0x5b86c2,'val':_0x19b234-0x1},_0x4cf8c0);return;}}}}if(!_0x30f9b6&&_0x37cab4[_0x2f3919(0x210)]<_0x3c2a08[_0xcb5261])throw new common_1[(_0x2f3919(0x330))](_0x2f3919(0x1f3),common_1[_0x2f3919(0x25f)][_0x2f3919(0x373)]);if(!_0x30f9b6){await this[_0x2f3919(0x37e)](_0x37cab4,balance_constant_1[_0x2f3919(0x259)]['Music'],-_0x3c2a08[_0xcb5261],'音乐【'+_0x43ba08+_0x2f3919(0x329),_0x478ff8);return;}await this[_0x2f3919(0x37e)](_0x37cab4,balance_constant_1[_0x2f3919(0x259)][_0x2f3919(0x24e)],_0x3c2a08[_0xcb5261],_0x2f3919(0x375)+_0x43ba08+_0x2f3919(0x346),_0x478ff8);}async[_0x56b5f7(0x2e4)](_0x2a915d,_0x375e63,_0x3c3125,_0x1d9e4f=![]){const _0xbc3256=_0x56b5f7,_0x4eb9fc={'structure':{'key':_0xbc3256(0x376),'vlrk':_0xbc3256(0x2ab),'desc':_0xbc3256(0x229)},'cover':{'key':_0xbc3256(0x376),'vlrk':_0xbc3256(0x2ab),'desc':'封面任务'},'recover':{'key':_0xbc3256(0x376),'vlrk':_0xbc3256(0x2ab),'desc':'重新生成封面任务'},'create':{'key':_0xbc3256(0x2f4),'vlrk':'type2','desc':_0xbc3256(0x327)},'thesis':{'key':_0xbc3256(0x348),'vlrk':_0xbc3256(0x34f),'desc':_0xbc3256(0x351)},'file':{'key':'pptCreate','vlrk':_0xbc3256(0x294),'desc':_0xbc3256(0x23b)},'theme':{'key':'pptCreate','vlrk':_0xbc3256(0x294),'desc':_0xbc3256(0x26a)},'editor':{'key':'pptEditor','vlrk':_0xbc3256(0x2ab),'desc':_0xbc3256(0x2d4)},'addpage':{'key':_0xbc3256(0x2f4),'vlrk':_0xbc3256(0x294),'desc':_0xbc3256(0x35e)},'addNotes':{'key':'pptCreate','vlrk':_0xbc3256(0x294),'desc':_0xbc3256(0x264)}},_0x4d644c=_0x4eb9fc[_0x3c3125][_0xbc3256(0x2f2)],_0x32dac9=_0x4eb9fc[_0x3c3125][_0xbc3256(0x245)]+_0xbc3256(0x1f8),_0x22296c=_0x4eb9fc[_0x3c3125][_0xbc3256(0x245)]+_0xbc3256(0x2f8),_0x4cbac7={},_0x31c7ae=await this[_0xbc3256(0x253)]['getConfigByKeys']([_0x32dac9,_0x22296c]);for(let _0xefc37d in _0x31c7ae){_0x4cbac7[_0xefc37d]=Number(_0x31c7ae[_0xefc37d])||0x0;}const _0x1b5807=await this['getUserById'](_0x2a915d);if(_0x1b5807[_0xbc3256(0x35f)]){const _0x135b68=await this['globalConfigService'][_0xbc3256(0x24d)](_0x1b5807[_0xbc3256(0x35f)],model_constant_1[_0xbc3256(0x28a)][_0xbc3256(0x263)]);_0x135b68&&(_0x4cbac7[_0x22296c]=_0x135b68[_0x4eb9fc[_0x3c3125][_0xbc3256(0x344)]]||0x0);}if(_0x1b5807[_0xbc3256(0x1bb)]||_0x1b5807[_0xbc3256(0x1bc)]){if(_0x4cbac7[_0x22296c]<0x0){!_0x1d9e4f&&await this[_0xbc3256(0x37e)](_0x1b5807,balance_constant_1[_0xbc3256(0x259)]['PPT'],0x0,_0xbc3256(0x22c)+_0x4d644c+_0xbc3256(0x2ed),_0x375e63);return;}else{if(_0x4cbac7[_0x22296c]>0x0){const _0x3bcf3c=redisKey_constant_1[_0xbc3256(0x318)]+'-'+_0x2a915d+'-'+_0x22296c;let _0x257b48=await this[_0xbc3256(0x22a)][_0xbc3256(0x30b)]({'key':_0x3bcf3c}),_0x37bb90=Number(_0x257b48||0x0);if(!_0x1d9e4f){if(_0x37bb90<_0x4cbac7[_0x22296c]){const _0x5d8585=(0x0,date_1[_0xbc3256(0x2e0)])()[_0xbc3256(0x2a4)]('d')['diff']((0x0,date_1[_0xbc3256(0x2e0)])(),'s');await this[_0xbc3256(0x22a)][_0xbc3256(0x37f)]({'key':_0x3bcf3c,'val':_0x37bb90+0x1},_0x5d8585),await this[_0xbc3256(0x37e)](_0x1b5807,balance_constant_1[_0xbc3256(0x259)]['PPT'],0x0,_0xbc3256(0x22c)+_0x4d644c+_0xbc3256(0x25c),_0x375e63);return;}}else{const _0x3f810c=(0x0,date_1[_0xbc3256(0x2e0)])()[_0xbc3256(0x2a4)]('d')[_0xbc3256(0x2f0)]((0x0,date_1[_0xbc3256(0x2e0)])(),'s');await this[_0xbc3256(0x22a)][_0xbc3256(0x37f)]({'key':_0x3bcf3c,'val':_0x37bb90-0x1},_0x3f810c);return;}}}}if(!_0x1d9e4f&&_0x1b5807[_0xbc3256(0x210)]<_0x4cbac7[_0x32dac9])throw new common_1['HttpException'](_0xbc3256(0x1f3),common_1[_0xbc3256(0x25f)][_0xbc3256(0x373)]);if(!_0x1d9e4f){await this[_0xbc3256(0x37e)](_0x1b5807,balance_constant_1[_0xbc3256(0x259)][_0xbc3256(0x263)],-_0x4cbac7[_0x32dac9],_0xbc3256(0x22c)+_0x4d644c+_0xbc3256(0x329),_0x375e63);return;}await this[_0xbc3256(0x37e)](_0x1b5807,balance_constant_1[_0xbc3256(0x259)]['PPT'],_0x4cbac7[_0x32dac9],_0xbc3256(0x22c)+_0x4d644c+_0xbc3256(0x346),_0x375e63);}async[_0x56b5f7(0x1b1)](_0x5c7cc0,_0x24c616,_0xfd2ccf){const _0x4f856c=_0x56b5f7,_0x4ca19a=await this['getUserById'](_0x5c7cc0);if(_0x4ca19a[_0x4f856c(0x1bb)]||_0x4ca19a[_0x4f856c(0x1bc)]){if(_0x24c616[_0x4f856c(0x380)]<0x0)await this['changeScore4Other'](_0x4ca19a,balance_constant_1[_0x4f856c(0x259)][_0x4f856c(0x247)],0x0,_0x4f856c(0x341)+_0x24c616[_0x4f856c(0x1ed)]+_0x4f856c(0x2ed),_0xfd2ccf);else{if(_0x24c616[_0x4f856c(0x380)]>0x0){const _0x985fec=redisKey_constant_1[_0x4f856c(0x318)]+'-'+_0x5c7cc0+'-'+_0x24c616['id'];let _0x1a7721=await this[_0x4f856c(0x22a)][_0x4f856c(0x30b)]({'key':_0x985fec}),_0xaab9f3=Number(_0x1a7721||0x0);if(_0xaab9f3<_0x24c616[_0x4f856c(0x380)]){const _0x8daa5b=(0x0,date_1['default'])()[_0x4f856c(0x2a4)]('d')[_0x4f856c(0x2f0)]((0x0,date_1[_0x4f856c(0x2e0)])(),'s');await this['redisCacheService'][_0x4f856c(0x37f)]({'key':_0x985fec,'val':_0xaab9f3+0x1},_0x8daa5b),await this['changeScore4Other'](_0x4ca19a,balance_constant_1[_0x4f856c(0x259)][_0x4f856c(0x247)],0x0,_0x4f856c(0x341)+_0x24c616[_0x4f856c(0x1ed)]+_0x4f856c(0x25c),_0xfd2ccf);}else{if(_0x4ca19a[_0x4f856c(0x210)]<_0x24c616[_0x4f856c(0x1c1)])throw new common_1[(_0x4f856c(0x330))](_0x4f856c(0x1f3),common_1['HttpStatus'][_0x4f856c(0x373)]);await this[_0x4f856c(0x37e)](_0x4ca19a,balance_constant_1[_0x4f856c(0x259)]['WORKFLOW'],-_0x24c616[_0x4f856c(0x1c1)],'小工具【'+_0x24c616[_0x4f856c(0x1ed)]+_0x4f856c(0x329),_0xfd2ccf);}}else{if(_0x4ca19a['score']<_0x24c616[_0x4f856c(0x1c1)])throw new common_1[(_0x4f856c(0x330))](_0x4f856c(0x1f3),common_1['HttpStatus'][_0x4f856c(0x373)]);await this[_0x4f856c(0x37e)](_0x4ca19a,balance_constant_1['EChangeType'][_0x4f856c(0x247)],-_0x24c616[_0x4f856c(0x1c1)],_0x4f856c(0x341)+_0x24c616[_0x4f856c(0x1ed)]+'】使用扣减',_0xfd2ccf);}}}else{if(_0x4ca19a[_0x4f856c(0x210)]<_0x24c616['deduct'])throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0x4f856c(0x25f)][_0x4f856c(0x373)]);await this[_0x4f856c(0x37e)](_0x4ca19a,balance_constant_1[_0x4f856c(0x259)][_0x4f856c(0x247)],-_0x24c616[_0x4f856c(0x1c1)],_0x4f856c(0x341)+_0x24c616[_0x4f856c(0x1ed)]+_0x4f856c(0x329),_0xfd2ccf);}}async[_0x56b5f7(0x1ff)](_0x43357d,_0x584375){const _0x597cfd=_0x56b5f7,_0x4a79d5=store_1[_0x597cfd(0x345)][_0x597cfd(0x312)],_0x1e3dcc=await this[_0x597cfd(0x367)](_0x43357d),_0x58e095=balance_constant_1[_0x597cfd(0x259)]['SD'];if(_0x1e3dcc[_0x597cfd(0x1bb)]||_0x1e3dcc[_0x597cfd(0x1bc)]){if(store_1[_0x597cfd(0x345)]['czVipFree']<0x0)await this['changeScore4Other'](_0x1e3dcc,_0x58e095,0x0,_0x597cfd(0x31e),_0x584375);else{if(store_1['CZConfig'][_0x597cfd(0x21b)]>0x0){const _0x3ffc7=redisKey_constant_1[_0x597cfd(0x318)]+'-'+_0x43357d+'-SD';let _0x34d664=await this['redisCacheService'][_0x597cfd(0x30b)]({'key':_0x3ffc7}),_0x2c167f=Number(_0x34d664||0x0);if(_0x2c167f<store_1[_0x597cfd(0x345)][_0x597cfd(0x21b)]){const _0x4794f6=(0x0,date_1[_0x597cfd(0x2e0)])()[_0x597cfd(0x2a4)]('d')[_0x597cfd(0x2f0)]((0x0,date_1[_0x597cfd(0x2e0)])(),'s');await this[_0x597cfd(0x22a)]['set']({'key':_0x3ffc7,'val':_0x2c167f+0x1},_0x4794f6),await this[_0x597cfd(0x37e)](_0x1e3dcc,_0x58e095,0x0,'SD绘画【'+_0x4a79d5+_0x597cfd(0x25c),_0x584375);}else await this[_0x597cfd(0x37e)](_0x1e3dcc,_0x58e095,-_0x4a79d5,_0x597cfd(0x2ee)+_0x4a79d5+_0x597cfd(0x329),_0x584375);}else await this[_0x597cfd(0x37e)](_0x1e3dcc,_0x58e095,-_0x4a79d5,'SD绘画【'+_0x4a79d5+'】使用扣减',_0x584375);}}else await this['changeScore4Other'](_0x1e3dcc,_0x58e095,-_0x4a79d5,_0x597cfd(0x2ee)+_0x4a79d5+'】使用扣减',_0x584375);}async[_0x56b5f7(0x2b5)](_0x7430cc,_0xcfc9f8){const _0x18bfe2=_0x56b5f7,_0x34887e=redisKey_constant_1['VIP_FREE']+'-'+_0x7430cc+'-'+_0xcfc9f8['id'];let _0x38ff35=await this['redisCacheService'][_0x18bfe2(0x30b)]({'key':_0x34887e}),_0x50d0a6=Number(_0x38ff35||0x0);return _0xcfc9f8[_0x18bfe2(0x380)]-_0x50d0a6;}async[_0x56b5f7(0x1d1)](_0x251a1f,_0x2b2293){const _0x21a2e3=_0x56b5f7;let _0x28f179;const _0x202559=await this[_0x21a2e3(0x282)]['getValue']('AIVideoMutiConfig');if(_0x202559){const _0x6fb559=_0x202559[_0x21a2e3(0x1bf)][_0x251a1f[_0x21a2e3(0x360)]['toString']()],_0x3c88be=_0x6fb559[0x0];let _0x22204a='',_0x2cb9f2='';Object[_0x21a2e3(0x246)](_0x3c88be)[_0x21a2e3(0x1d5)]!==undefined&&(_0x22204a=_0x2b2293[_0x21a2e3(0x1d5)]),Object[_0x21a2e3(0x246)](_0x3c88be)[_0x21a2e3(0x1ea)]!==undefined&&(_0x2cb9f2=_0x2b2293['duration']),_0x28f179=_0x6fb559[_0x21a2e3(0x27e)](_0x505d61=>(_0x505d61['mode']==_0x22204a||_0x22204a==='')&&(_0x505d61['duration']==_0x2cb9f2||_0x2cb9f2==='')&&_0x505d61[_0x21a2e3(0x358)]==_0x2b2293[_0x21a2e3(0x358)]);}return console['log'](_0x21a2e3(0x317),_0x28f179),_0x28f179;}async[_0x56b5f7(0x219)](_0x139142,_0x2841e9,_0x45a845){const _0x26c867=_0x56b5f7;let _0x32947e=await this[_0x26c867(0x1d1)](_0x2841e9,_0x45a845);if(!_0x32947e)return await this['getModelVipFree'](_0x139142,_0x2841e9);const _0x2438d9=redisKey_constant_1[_0x26c867(0x318)]+'-'+_0x139142+'-'+_0x32947e[_0x26c867(0x358)]+'-'+_0x32947e[_0x26c867(0x1d5)]+'-'+_0x32947e[_0x26c867(0x1ea)];let _0x4f1964=await this['redisCacheService']['get']({'key':_0x2438d9}),_0x48a6b8=Number(_0x4f1964||0x0);return _0x32947e['vipFreeNum']-_0x48a6b8;}async[_0x56b5f7(0x378)](_0x37cb7f){const _0x39885a=_0x56b5f7,_0x3b9355=redisKey_constant_1[_0x39885a(0x318)]+'-'+_0x37cb7f+_0x39885a(0x2e6);let _0x37134c=await this[_0x39885a(0x22a)][_0x39885a(0x30b)]({'key':_0x3b9355}),_0x153582=Number(_0x37134c||0x0);return store_1['LinkFoxConfig'][_0x39885a(0x289)]-_0x153582;}async['getKeyFree'](_0x10b803,_0x3943d8,_0x59bdbc){const _0x2dcc08=_0x56b5f7;let _0x35e636=await this['redisCacheService'][_0x2dcc08(0x30b)]({'key':_0x3943d8}),_0x52223a=Number(_0x35e636||0x0);return _0x59bdbc-_0x52223a;}async[_0x56b5f7(0x2bf)](_0x1553e4){const _0x51b889=_0x56b5f7;let _0x35da6b=!![];const _0x59d574=await this[_0x51b889(0x367)](_0x1553e4);if(_0x59d574[_0x51b889(0x1bb)]||_0x59d574[_0x51b889(0x1bc)]){if(store_1[_0x51b889(0x311)]['lfVipFree']<0x0)_0x35da6b=!![];else{if(store_1[_0x51b889(0x311)][_0x51b889(0x289)]>0x0){const _0x3ad20=await this[_0x51b889(0x378)](_0x1553e4);_0x3ad20>0x0?_0x35da6b=!![]:_0x35da6b=_0x59d574['score']>=store_1[_0x51b889(0x311)][_0x51b889(0x1fe)];}else _0x35da6b=_0x59d574[_0x51b889(0x210)]>=store_1[_0x51b889(0x311)][_0x51b889(0x1fe)];}}else _0x35da6b=_0x59d574[_0x51b889(0x210)]>=store_1[_0x51b889(0x311)][_0x51b889(0x1fe)];if(!_0x35da6b)throw new common_1[(_0x51b889(0x330))]('用户余额不足，请充值',common_1[_0x51b889(0x25f)][_0x51b889(0x373)]);}async['deductBalanceLinxFox'](_0x2bc84c,_0x155be0){const _0x30f386=_0x56b5f7,_0x21c18e=store_1['LinkFoxConfig'][_0x30f386(0x1fe)],_0x13f7e7=await this['getUserById'](_0x2bc84c),_0x516ca9=balance_constant_1[_0x30f386(0x259)]['LinkFox'];if(_0x13f7e7['lifetimeVip']||_0x13f7e7[_0x30f386(0x1bc)]){if(store_1[_0x30f386(0x311)][_0x30f386(0x289)]<0x0)await this['changeScore4Other'](_0x13f7e7,_0x516ca9,0x0,_0x30f386(0x2c7),_0x155be0);else{if(store_1[_0x30f386(0x311)][_0x30f386(0x289)]>0x0){const _0x1c7218=redisKey_constant_1[_0x30f386(0x318)]+'-'+_0x2bc84c+'-LinkFox';let _0x5b38e5=await this[_0x30f386(0x22a)][_0x30f386(0x30b)]({'key':_0x1c7218}),_0x3c5554=Number(_0x5b38e5||0x0);if(_0x3c5554<store_1[_0x30f386(0x311)]['lfVipFree']){const _0x415b75=(0x0,date_1[_0x30f386(0x2e0)])()[_0x30f386(0x2a4)]('d')[_0x30f386(0x2f0)]((0x0,date_1[_0x30f386(0x2e0)])(),'s');await this[_0x30f386(0x22a)][_0x30f386(0x37f)]({'key':_0x1c7218,'val':_0x3c5554+0x1},_0x415b75),await this[_0x30f386(0x37e)](_0x13f7e7,_0x516ca9,0x0,_0x30f386(0x1cf)+_0x21c18e+'】会员每日限免',_0x155be0);}else await this[_0x30f386(0x37e)](_0x13f7e7,_0x516ca9,-_0x21c18e,_0x30f386(0x1be)+_0x21c18e+'】使用扣减',_0x155be0);}else await this[_0x30f386(0x37e)](_0x13f7e7,_0x516ca9,-_0x21c18e,_0x30f386(0x1be)+_0x21c18e+'】使用扣减',_0x155be0);}}else await this[_0x30f386(0x37e)](_0x13f7e7,_0x516ca9,-_0x21c18e,_0x30f386(0x1be)+_0x21c18e+_0x30f386(0x329),_0x155be0);}async['updateVipExpire2Redis'](){const _0x2a9883=_0x56b5f7,_0x207c67=await this[_0x2a9883(0x26d)][_0x2a9883(0x27e)]({'where':{'vipExpire':(0x0,typeorm_2['Between'])((0x0,date_1[_0x2a9883(0x2e0)])()[_0x2a9883(0x2ac)]('d')[_0x2a9883(0x1ee)](),(0x0,date_1[_0x2a9883(0x2e0)])()['endOf']('d')['toDate']())}});if(_0x207c67['length'])for(let _0x134735=0x0;_0x134735<_0x207c67[_0x2a9883(0x361)];_0x134735++){const _0x1bedbc=_0x207c67[_0x134735];await this[_0x2a9883(0x22a)][_0x2a9883(0x37f)]({'key':redisKey_constant_1[_0x2a9883(0x22d)]+_0x1bedbc['id'],'val':''},(0x0,date_1['default'])()[_0x2a9883(0x2a4)]('d')[_0x2a9883(0x2f0)]((0x0,date_1[_0x2a9883(0x2e0)])(),'s'));}const _0x6dafde=await this[_0x2a9883(0x26d)][_0x2a9883(0x27e)]({'where':{'vipExpire':(0x0,typeorm_2[_0x2a9883(0x2c4)])((0x0,date_1[_0x2a9883(0x2e0)])()[_0x2a9883(0x1ee)]())}});if(_0x6dafde[_0x2a9883(0x361)]){const _0x2e9fac=_0x6dafde[_0x2a9883(0x285)](_0x4277c1=>_0x4277c1['id']);await this[_0x2a9883(0x26d)]['update']({'id':(0x0,typeorm_2['In'])(_0x2e9fac)},{'vipExpire':null});}}async['collect'](_0x1a3ef3,_0x35c2f5,_0x42eae9){const _0x1405aa=_0x56b5f7,_0x357946=(0x0,utils_1[_0x1405aa(0x2da)])(this[_0x1405aa(0x2fa)]),_0x474f85=await this[_0x1405aa(0x1b6)][_0x1405aa(0x326)]({'where':{'userId':_0x1a3ef3,'relId':_0x35c2f5,'relType':_0x42eae9,'saasId':_0x357946}});if(_0x474f85)throw new common_1['HttpException'](_0x1405aa(0x1b2),common_1[_0x1405aa(0x25f)][_0x1405aa(0x373)]);else await this[_0x1405aa(0x1b6)][_0x1405aa(0x352)]({'userId':_0x1a3ef3,'relId':_0x35c2f5,'relType':_0x42eae9,'sassId':_0x357946});}async[_0x56b5f7(0x2dc)](_0x16ff61,_0x3b2713,_0x43ebed){const _0xf1320f=_0x56b5f7,_0x95ec08=(0x0,utils_1[_0xf1320f(0x2da)])(this[_0xf1320f(0x2fa)]),_0x311fc5=await this['userCollectEntity'][_0xf1320f(0x326)]({'where':{'userId':_0x16ff61,'relId':_0x3b2713,'relType':_0x43ebed,'saasId':_0x95ec08}});if(!_0x311fc5)throw new common_1[(_0xf1320f(0x330))]('您还未收藏过该内容',common_1[_0xf1320f(0x25f)][_0xf1320f(0x373)]);else await this[_0xf1320f(0x1b6)][_0xf1320f(0x1e8)]({'id':_0x311fc5['id']});}async[_0x56b5f7(0x2d1)](_0x31575b,_0xe74cdf){const _0x79aebc=_0x56b5f7,_0x19d14d=(0x0,utils_1[_0x79aebc(0x2da)])(this[_0x79aebc(0x2fa)]);_0x31575b[_0x79aebc(0x29c)](_0x10ab37=>{const _0x21dda1=_0x79aebc,_0xcdf27d=Number(_0x10ab37);this[_0x21dda1(0x1b6)]['delete']({'relId':_0xcdf27d,'relType':_0xe74cdf,'saasId':_0x19d14d});});}async[_0x56b5f7(0x28b)](_0x4678a1,_0x39227e,_0x1ac7ea,_0x5c7287){const _0x9f37a7=_0x56b5f7,_0x114def=(0x0,utils_1['getReqSaasId'])(this[_0x9f37a7(0x2fa)]),[_0x95adf2,_0x1c14cb]=await this[_0x9f37a7(0x1b6)][_0x9f37a7(0x261)]({'where':{'userId':_0x1ac7ea,'relType':_0x5c7287,'saasId':_0x114def},'take':_0x39227e,'skip':(_0x4678a1-0x1)*_0x39227e,'order':{'createdAt':_0x9f37a7(0x288)}});return{'rows':_0x95adf2,'count':_0x1c14cb};}async[_0x56b5f7(0x320)](_0x3428fa,_0x1e07c1,_0x2040d8){const _0xea2e3e=_0x56b5f7,_0x44cda4=(0x0,utils_1['getReqSaasId'])(this[_0xea2e3e(0x2fa)]);return await this[_0xea2e3e(0x1b6)]['find']({'where':{'userId':_0x1e07c1,'relType':_0x2040d8,'saasId':_0x44cda4,'relId':(0x0,typeorm_2['In'])(_0x3428fa)}});}async[_0x56b5f7(0x21c)](_0x24ea5e,_0x51f028){const _0x14781d=_0x56b5f7;let _0x1a0bdd=Object[_0x14781d(0x32a)](_0x24ea5e),_0xaa7e5a=[];return _0x51f028['user']?.['id']&&(_0xaa7e5a=await this[_0x14781d(0x320)](_0x24ea5e['map'](_0x4fb0fe=>_0x4fb0fe['id']),_0x51f028['user']['id'],collectType_constant_1['UserCollectType'][_0x14781d(0x263)])),_0x1a0bdd[_0x14781d(0x29c)](_0x163e25=>{const _0x2da26a=_0x14781d;_0xaa7e5a['find'](_0x772fdd=>_0x772fdd[_0x2da26a(0x1cb)]==_0x163e25['id'])?_0x163e25['isCollect']=!![]:_0x163e25['isCollect']=![];}),_0x1a0bdd;}};UserService=__decorate([(0x0,common_1[_0x56b5f7(0x30a)])(),__param(0x0,(0x0,common_1[_0x56b5f7(0x249)])(_0x56b5f7(0x306))),__param(0x1,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x56b5f7(0x266)])),__param(0x2,(0x0,typeorm_1[_0x56b5f7(0x357)])(saas_entity_1[_0x56b5f7(0x370)])),__param(0x3,(0x0,typeorm_1[_0x56b5f7(0x357)])(role_entity_1[_0x56b5f7(0x2ae)])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(user_init_vip_entity_1['UserInitVipEntity'])),__param(0x5,(0x0,typeorm_1[_0x56b5f7(0x357)])(userFavorite_entity_1[_0x56b5f7(0x1f0)])),__param(0x6,(0x0,typeorm_1[_0x56b5f7(0x357)])(userCollect_entity_1['UserCollectEntity'])),__metadata(_0x56b5f7(0x334),[Object,typeorm_2[_0x56b5f7(0x377)],typeorm_2[_0x56b5f7(0x377)],typeorm_2[_0x56b5f7(0x377)],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x56b5f7(0x377)],nestjs_cls_1[_0x56b5f7(0x207)],mailer_1['MailerService'],redisCache_service_1[_0x56b5f7(0x2dd)],userBalance_service_1[_0x56b5f7(0x1e9)],globalConfig_service_1['GlobalConfigService'],verification_service_1[_0x56b5f7(0x1ac)],cm_service_1[_0x56b5f7(0x20e)],typeorm_2[_0x56b5f7(0x241)]])],UserService),exports[_0x56b5f7(0x265)]=UserService;