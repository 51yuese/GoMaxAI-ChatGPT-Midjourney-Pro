'use strict';const _0x1faef5=_0x300b;function _0x56b3(){const _0xc533fa=['deductBalance4Draw','getCozeModelVipFree','前台用户','zh-CN','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','refundBalance4MJ','sendMail','exists','__param','模板生成PPT','FaceSwap','\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL','__keyevent@0__:expired','vipExpire','16704VWmbyU','isMobilePhone','toLowerCase','LinkFox','queryOne','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27','Bearer\x20','UserCollectEntity','UserCollectType','num','params','./user_init_vip.entity','%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27','clsService','APP','PPT【','userCollectEntity','add','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','disabled','deductBalance4WorkFlow','BadRequest','relateId','includes','Coze','MjLeavelRel','】会员永久免费','../../common/constants/Role.constant','updateUserPassword','----------YYYYYYYYYYYY--------------','用户名已被使用！','UserBalanceService','updateRole','queryByPage','受邀请注册赠送','user','------------------------Price--------------','角色信息不存在！','UserStatusEnum','ERole','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getDrawModelVipFree','turbo_vip_free','手机号格式错误！','bcryptjs','headers','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','registerBaseUrl','inviteSendStatus','恭喜您绑定成功、后续可直接扫码登录了！','邮箱已被使用！','set','registerSendStatus','更换模板','mergeCollectDataForUserId','upscale|describe|picread::retry|faceswap|shorten','生成邀请码失败，请重新试一次吧！','Connection','SD绘画会员永久免费','\x20OFFSET\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','VerificationService','File','deductBalance4SD','delete','%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%','用户名\x09密码\x0a','】生成失败退还','CmConfigService','queryOneUserInfo','5381768hFtYnQ','endOf','roleSave','saasMap','getReqSaasId','没有变更，无需更改！','HttpStatus','编辑PPT','keyType','../../common/utils/date','env','changeScore4registe','管理员赠送','pptCreate','fetch|listbyids|modal|seed','collectListForUserID','InjectRepository','imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll','../../common/constants/user.constant','】使用扣减','vlrk','getLfVipFree','Registe','】使用失败退费','validateBalance4Draw','VIP_FREE','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getMjUserModelPrice','userFavoriteEntity','LinkFoxConfig','当前密码错误！','violationCount','不可将用户置为未激活状态！','type2','账号注册时密码不能为空！','SD绘画【','%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','../../common/constants/balance.constant','updateUserMiniOpenId','修改密码失败、请重新试试吧。','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','getMiniOpenIdByUserId','UNAUTHORIZED','PENDING','RoleEntity','price','relateType','customId','Music','inviteCode','用户名或者邮箱已被注册！','vipDays','重新生成封面任务','fast_vip_free','globalConfigService','当前手机号已注册、请勿重复注册！','getVideoModelVipFree','\x20AND\x20u.createdAt\x20>=\x20\x27','count','UserService','SaasEntity','updateSignDay','密码重置为[','\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','VipFree','userBalanceService','roleDel','pptThesis','avatar','code','FILE','SUPER','ClsService','用户余额不足，请充值','%\x27\x20)','modelName','queryUserInfoById','DrawSpeed','手机号已被使用！','超级管理员不可被操作！','register','getVipLeavelRelById','EChangeType','UserFavoriteEntity','assign','message','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','miniOpenId','defineProperty','修改用户状态失败！','%\x27\x20OR\x20id\x20=\x20\x27','mergeCollectCountData','../../common/constants/model.constant','genInviteCode','random','InvitationReward','findByIds','changeScore4Other','key','error:\x20','createdAt','updateUserAppOpenId','增加PPT备注','affected','updateInfo','day','inviteRewards','BAD_REQUEST','\x09mj123456admin\x0a','configService','绑定微信失败、请联系管理员！','getUserByInviteCode','Chat','relax_vip_free','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','userInitVipEntity','Imagine','./../verification/verification.service','\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','-LinkFox','67210URBJsq','yes','userDefautlAvatar','您还未收藏过该内容','PPT','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','lfPrice','MoreThan','hashSync','has','createBatch','getConfigByKeys','LinxFox会员永久免费','genUserName','AdminGift','pptOutline','log','增加PPT单页','getUserListByIds','fast_mjDeduction','Inject','\x20AND\x20`status`\x20=\x20','status','邀请新用户注册奖励','concat','collect','inviteLink','您已经收藏过该内容','collectList','registerVerifyEmailFrom','getVideoConfig','用户不存在！','WORKFLOW','valueOf','clear','saasName','getMjPrice','Price','deductBalanceLinxFox','findAndCount','\x20AND\x20phone\x20LIKE\x20\x27%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','destroyAccount','音乐【','Invited','invitePage','verifyUserCredentials','\x20AND\x20u.createdAt\x20<=\x20\x27','deductBalance4Video','modelType','103570CQbHHO','VIDEO','lastLoginIp','relax','Repository','GOMAXAI_HOST','saasDel','toDate','用户名已存在、请更换用户名！','czProxyPrice','shouldAccess','修改用户信息失败！','的账号激活','object','create','userEntity','visitor','\x20AND\x20username\x20LIKE\x20\x27%','decorate','92967rbebXB','isPlatform','Tts','nickname','../cmConfig/cm.service','userInitVip','\x20AND\x20role\x20=\x20\x27','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','deduct','JWT_SECRET','connection','countByInviteCode','@nestjs/typeorm','】会员每日限免','2812347MbXrOj','verificationService','标题大纲任务','qureyUserInfoByInviteCode','type3','validateBalance4Video','updateUserPsd','queryUserByUsername','当前绑定用户不存在！','openId','上传音乐','14BKRzAF','days','__esModule','CZConfig','uncollect','./role.entity','__metadata','domain','find','LessThanOrEqual','RedisCacheService','mjLeavelRel','query','GPTS','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','VIP_EXPIRE','name','mj-','userId','class-validator','get','Like','turbo','isCollect','queryAll','metadata','giftVip','filter','updateStatus','save','mj123456admin','type1','无效的邀请码！','歌词生成','description','deductBalance4Coze','giftScore','verifyUserPassword','getUserById','Registration','超级管理员','LinxFox【【','MailerService','LinxFox【','MJ绘画【','compareSync','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','length','修改用户状态成功！','vipFreeNum','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','修改用户角色失败！','inviterEmail','%\x27\x20OR\x20nickname\x20LIKE\x20\x27%','../redisCache/redisCache.service','forEach','maskEmail','map','validateBalanceLinxFox','您的账户已被封禁、如有疑问、请联系管理员！','VIEWER','validateBalance4MJ','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','mailerService','./userFavorite.entity','resetUserPass','getUserUnionId','findOne','generateRandomString','修改用户信息成功！','isSuper','updateVipExpire2Redis',']成功!','注册赠送','Failed\x20to\x20verify\x20JWT\x20token:','封面任务','../../common/constants/verification.constant','2156847XjKkOl','formatCreateOrUpdateDate','authorization','test','inviteRewardVip','invitedRewards','lodash','collectNum','saasUpdate','\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%','registerRewards','accessLabel','fast','ActionCN','then','collectPage','./saas.entity','Not','function','getClientIp','update','isVerifyEmail','bindWx','getOwnPropertyDescriptor','cloneDeep','registerVerifyEmailDesc','DESC','GlobalConfigService','saasId','diff','transaction','../userBalance/userBalance.service','refundBalance4Chat','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','invitedRewardVip','saasEntity','savaLoginIp','ids','EModelType','debuctBalance4Muisc','AIVideoMutiConfig','邮箱格式错误！','非法访问','DRAW','getUserInfoFromHeader','getValue','VerificationEnum','\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','AGENT','%\x27\x20OR\x20email\x20LIKE\x20\x27%','\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','当前账户不存在！','updateVipExpire','%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%','turbo_mjDeduction','increment','CHAT','pptEditor','action','redisCacheService','MjDraw','\x20AND\x20saasId\x20=\x20','registerVerifyExpir','lfVipFree','inviterPhone','createUser','ACTIVE','saasSave','获取邀请记录失败！','lifetimeVip','role','UserService\x20Init','push','username','model','toString','../../common/utils','desc','registerIp','isDefined','checkUserStatus','LOCKED','mode','getUserStatus','duration','roleEntity','vipFreeKey','genUserNames','userCount','startsWith','password','AND\x20email\x20LIKE\x20\x27%','还有用户使用相关角色，无法删除！','HttpException','typeorm','Tool','subscriber','updateUserOpenId','@nestjs-modules/mailer','小工具【','重置密码失败！','score','updateUserStatus','getUserOpenId','nestjs-cls','rolePage','用户名已存在！','vipLeavelName','delUser','Draw','phone','getEntity','default','initSaasMap','insertAccountLog','email','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','updateViolationCount','findBy','registerVerifyEmailTitle','getSaasById','vipLeavelId','czVipFree','hideString','16RjvltA','模型【'];_0x56b3=function(){return _0xc533fa;};return _0x56b3();}(function(_0x26cc76,_0x526567){const _0x37e453=_0x300b,_0x4bfd3d=_0x26cc76();while(!![]){try{const _0x192b98=parseInt(_0x37e453(0x38d))/0x1*(parseInt(_0x37e453(0x3b9))/0x2)+-parseInt(_0x37e453(0x20d))/0x3+-parseInt(_0x37e453(0x28a))/0x4*(-parseInt(_0x37e453(0x35b))/0x5)+-parseInt(_0x37e453(0x29a))/0x6+-parseInt(_0x37e453(0x3a0))/0x7+parseInt(_0x37e453(0x2e2))/0x8+-parseInt(_0x37e453(0x3ae))/0x9;if(_0x192b98===_0x526567)break;else _0x4bfd3d['push'](_0x4bfd3d['shift']());}catch(_0x2c89d9){_0x4bfd3d['push'](_0x4bfd3d['shift']());}}}(_0x56b3,0x62a0e));function _0x300b(_0x5d6c0a,_0x1d48c4){const _0x56b3b4=_0x56b3();return _0x300b=function(_0x300b38,_0xabd4ce){_0x300b38=_0x300b38-0x1e5;let _0x4a2fb5=_0x56b3b4[_0x300b38];return _0x4a2fb5;},_0x300b(_0x5d6c0a,_0x1d48c4);}var __decorate=this&&this['__decorate']||function(_0x5f509f,_0x3ffb1c,_0x1fac39,_0x3bb561){const _0x1458fd=_0x300b;var _0x5651d7=arguments['length'],_0x176626=_0x5651d7<0x3?_0x3ffb1c:_0x3bb561===null?_0x3bb561=Object[_0x1458fd(0x224)](_0x3ffb1c,_0x1fac39):_0x3bb561,_0x18b997;if(typeof Reflect===_0x1458fd(0x39a)&&typeof Reflect[_0x1458fd(0x39f)]===_0x1458fd(0x21f))_0x176626=Reflect[_0x1458fd(0x39f)](_0x5f509f,_0x3ffb1c,_0x1fac39,_0x3bb561);else{for(var _0x2c88f3=_0x5f509f[_0x1458fd(0x1ef)]-0x1;_0x2c88f3>=0x0;_0x2c88f3--)if(_0x18b997=_0x5f509f[_0x2c88f3])_0x176626=(_0x5651d7<0x3?_0x18b997(_0x176626):_0x5651d7>0x3?_0x18b997(_0x3ffb1c,_0x1fac39,_0x176626):_0x18b997(_0x3ffb1c,_0x1fac39))||_0x176626;}return _0x5651d7>0x3&&_0x176626&&Object[_0x1458fd(0x33b)](_0x3ffb1c,_0x1fac39,_0x176626),_0x176626;},__metadata=this&&this[_0x1faef5(0x3bf)]||function(_0x27c483,_0x1a3f1d){const _0x55254a=_0x1faef5;if(typeof Reflect===_0x55254a(0x39a)&&typeof Reflect[_0x55254a(0x3d2)]==='function')return Reflect[_0x55254a(0x3d2)](_0x27c483,_0x1a3f1d);},__param=this&&this[_0x1faef5(0x294)]||function(_0x4c0c86,_0x55038e){return function(_0xafd9a0,_0x583271){_0x55038e(_0xafd9a0,_0x583271,_0x4c0c86);};};Object[_0x1faef5(0x33b)](exports,_0x1faef5(0x3bb),{'value':!![]}),exports[_0x1faef5(0x31e)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),user_constant_1=require(_0x1faef5(0x2f4)),mailer_1=require(_0x1faef5(0x26f)),verification_service_1=require(_0x1faef5(0x358)),common_1=require('@nestjs/common'),typeorm_1=require(_0x1faef5(0x3ac)),typeorm_2=require(_0x1faef5(0x26b)),user_entity_1=require('./user.entity'),bcrypt=require(_0x1faef5(0x2c8)),_=require(_0x1faef5(0x213)),jwt=require('jsonwebtoken'),verification_constant_1=require(_0x1faef5(0x20c)),userBalance_service_1=require(_0x1faef5(0x22c)),utils_1=require(_0x1faef5(0x259)),balance_constant_1=require(_0x1faef5(0x308)),class_validator_1=require(_0x1faef5(0x3cc)),redisKey_constant_1=require('../../common/constants/redisKey.constant'),redisCache_service_1=require(_0x1faef5(0x1f6)),model_constant_1=require(_0x1faef5(0x33f)),midjourney_constant_1=require('../../common/constants/midjourney.constant'),user_init_vip_entity_1=require(_0x1faef5(0x2a6)),axios_1=require('axios'),date_1=require(_0x1faef5(0x2eb)),saas_entity_1=require(_0x1faef5(0x21d)),role_entity_1=require(_0x1faef5(0x3be)),store_1=require('../../common/store'),nestjs_cls_1=require(_0x1faef5(0x275)),Role_constant_1=require(_0x1faef5(0x2b7)),userFavorite_entity_1=require(_0x1faef5(0x200)),userCollect_entity_1=require('./entity/userCollect.entity'),collectType_constant_1=require('../../common/constants/collectType.constant'),cm_service_1=require(_0x1faef5(0x3a4));let UserService=class UserService{constructor(_0x2e75ee,_0x278d5b,_0x59280d,_0x4fe893,_0x510f8a,_0x41d1bb,_0x2f7328,_0x4a6405,_0x136d24,_0x495d23,_0x598da5,_0xed5b3,_0x290610,_0x4cbd94,_0x34c774){const _0x369b39=_0x1faef5;this[_0x369b39(0x26d)]=_0x2e75ee,this[_0x369b39(0x39c)]=_0x278d5b,this['saasEntity']=_0x59280d,this[_0x369b39(0x262)]=_0x4fe893,this[_0x369b39(0x356)]=_0x510f8a,this[_0x369b39(0x2ff)]=_0x41d1bb,this[_0x369b39(0x2ac)]=_0x2f7328,this[_0x369b39(0x2a9)]=_0x4a6405,this[_0x369b39(0x1ff)]=_0x136d24,this['redisCacheService']=_0x495d23,this[_0x369b39(0x324)]=_0x598da5,this[_0x369b39(0x319)]=_0xed5b3,this[_0x369b39(0x3af)]=_0x290610,this[_0x369b39(0x350)]=_0x4cbd94,this[_0x369b39(0x3aa)]=_0x34c774;}['onModuleInit'](){const _0x29ccaf=_0x1faef5;console['log'](_0x29ccaf(0x254)),this[_0x29ccaf(0x3aa)][_0x29ccaf(0x3c5)](_0x29ccaf(0x3a7)+Role_constant_1[_0x29ccaf(0x2c3)][_0x29ccaf(0x32a)]+_0x29ccaf(0x2a8)+Role_constant_1['ERole'][_0x29ccaf(0x23d)]+_0x29ccaf(0x2a0)+Role_constant_1['ERole']['VIEWER']+_0x29ccaf(0x322)),this['initSaasMap'](),this[_0x29ccaf(0x26d)]['pSubscribe'](_0x29ccaf(0x298),async _0x32bc86=>{const _0x4aa971=_0x29ccaf;if(_0x32bc86[_0x4aa971(0x266)](redisKey_constant_1[_0x4aa971(0x3c8)])){const _0x364b41=_0x32bc86['replace'](redisKey_constant_1[_0x4aa971(0x3c8)],'');this['userEntity']['update']({'id':Number(_0x364b41)},{'vipExpire':null});}});}async[_0x1faef5(0x27e)](){const _0x2c097c=_0x1faef5,_0x4d1b20=await this[_0x2c097c(0x230)][_0x2c097c(0x3c1)]({'where':{'deleteFlag':0x0}});store_1[_0x2c097c(0x2e5)][_0x2c097c(0x37d)](),_0x4d1b20[_0x2c097c(0x1f7)](_0x5176b9=>store_1[_0x2c097c(0x2e5)][_0x2c097c(0x2cf)](_0x5176b9[_0x2c097c(0x3c0)],_0x5176b9['id'])),store_1['saasMap'][_0x2c097c(0x2cf)](process['env'][_0x2c097c(0x392)],0x0);}[_0x1faef5(0x27c)](){return this['userEntity'];}async['ListSaasByIds'](_0x49aa87){const _0x2f7276=_0x1faef5;if(!_0x49aa87[_0x2f7276(0x1ef)])return[];return this[_0x2f7276(0x230)][_0x2f7276(0x3c1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x49aa87)}});}async['saasPage'](_0xf43a2f){const _0x5d9f54=_0x1faef5,{page:page=0x1,size:size=0x14,keyword:_0x1ee4f5}=_0xf43a2f;let _0x34c074;_0x1ee4f5?_0x34c074=[{'deleteFlag':0x0,'name':(0x0,typeorm_2[_0x5d9f54(0x3ce)])('%'+_0x1ee4f5+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2[_0x5d9f54(0x3ce)])('%'+_0x1ee4f5+'%')}]:_0x34c074={'deleteFlag':0x0};const [_0xe9d9b6,_0x28b8ca]=await this[_0x5d9f54(0x230)][_0x5d9f54(0x382)]({'where':_0x34c074,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x5d9f54(0x227)}});if(!_0xe9d9b6[_0x5d9f54(0x1ef)])return{'rows':[],'count':_0x28b8ca};const _0x436949=_0xe9d9b6['map'](_0x232979=>_0x232979['id']),_0x2007ad=new Map(),_0x3d6074=await this['userEntity']['find']({'where':{'saasId':(0x0,typeorm_2['In'])(_0x436949),'role':Role_constant_1['ERole'][_0x5d9f54(0x23d)]}});_0x3d6074['forEach'](_0x15b7f0=>{const _0x13d9cf=_0x5d9f54;_0x2007ad[_0x13d9cf(0x2cf)](_0x15b7f0[_0x13d9cf(0x229)],_0x15b7f0);});const _0x1a931f=new Map(),_0x3da77b=await this[_0x5d9f54(0x3aa)][_0x5d9f54(0x3c5)](_0x5d9f54(0x2fd));_0x3da77b[_0x5d9f54(0x1f7)](_0x47aa6c=>_0x1a931f[_0x5d9f54(0x2cf)](_0x47aa6c[_0x5d9f54(0x229)],_0x47aa6c[_0x5d9f54(0x31d)]));const _0x145eec=_0xe9d9b6[_0x5d9f54(0x1f9)](_0x7df0e5=>{const _0x67687=_0x5d9f54;let _0x201eb2=null,_0x2fddcf=null,_0x3d65a0=null,_0x31a229=null;const _0x1a9292=_0x2007ad['get'](_0x7df0e5['id']);return _0x1a9292&&(_0x201eb2=_0x1a9292[_0x67687(0x256)],_0x2fddcf=_0x1a9292[_0x67687(0x3a3)],_0x3d65a0=_0x1a9292[_0x67687(0x27b)],_0x31a229=_0x1a9292[_0x67687(0x280)]),{..._0x7df0e5,'username':_0x201eb2,'nickname':_0x2fddcf,'phone':_0x3d65a0,'email':_0x31a229,'userCount':_0x1a931f[_0x67687(0x3cd)](_0x7df0e5['id'])||0x0};});return{'rows':_0x145eec,'count':_0x28b8ca};}async[_0x1faef5(0x286)](_0x15e358){const _0x5e8a14=_0x1faef5;return this[_0x5e8a14(0x230)]['findOne']({'where':{'id':_0x15e358}});}async[_0x1faef5(0x250)](_0x2e0f10){const _0x27cb88=_0x1faef5,_0x196438=(0x0,utils_1[_0x27cb88(0x2e6)])(this[_0x27cb88(0x2a9)]);if(_0x196438!==0x0)throw new common_1[(_0x27cb88(0x26a))](_0x27cb88(0x237),common_1[_0x27cb88(0x2e8)]['FORBIDDEN']);return await this[_0x27cb88(0x230)][_0x27cb88(0x3d6)](_0x2e0f10),this['initSaasMap'](),!![];}async[_0x1faef5(0x215)](_0x593865){const _0x1e332b=_0x1faef5,_0x4f392d=(0x0,utils_1[_0x1e332b(0x2e6)])(this['clsService']);return await this['saasEntity'][_0x1e332b(0x3d6)]({..._0x593865,'id':_0x4f392d}),!![];}async[_0x1faef5(0x393)](_0xe7a4d7){const _0xf4ef5=_0x1faef5;if(!_0xe7a4d7['ids']||!_0xe7a4d7[_0xf4ef5(0x232)]['length'])return!![];return await this[_0xf4ef5(0x230)][_0xf4ef5(0x221)]({'id':(0x0,typeorm_2['In'])(_0xe7a4d7[_0xf4ef5(0x232)])},{'deleteFlag':0x1}),!![];}async[_0x1faef5(0x276)](_0x140525,_0x1bbdf7){const _0x5370e2=_0x1faef5,_0x3c8c83=await(0x0,utils_1[_0x5370e2(0x2e6)])(this[_0x5370e2(0x2a9)]),{page:page=0x1,size:size=0x14,keyword:_0x17f0f0}=_0x1bbdf7;let _0xda936e=_0x5370e2(0x384)+_0x3c8c83+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27'+Role_constant_1[_0x5370e2(0x2c3)]['VIEWER']+_0x5370e2(0x23c);_0x17f0f0&&(_0xda936e=_0x5370e2(0x30b)+_0x3c8c83+_0x5370e2(0x359)+_0x17f0f0+_0x5370e2(0x2ae)+_0x17f0f0+_0x5370e2(0x282)+Role_constant_1[_0x5370e2(0x2c3)][_0x5370e2(0x1fc)]+_0x5370e2(0x339)+_0x17f0f0+_0x5370e2(0x2ae)+_0x17f0f0+_0x5370e2(0x307));const _0x5a8cb6=await this['connection'][_0x5370e2(0x3c5)](_0x5370e2(0x281)+_0xda936e+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x48a3fe=await this['connection']['query'](_0x5370e2(0x2c4)+_0xda936e+_0x5370e2(0x22e)+size+_0x5370e2(0x2d7)+(page-0x1)*size+_0x5370e2(0x360)),_0x46a97d=_0x48a3fe[_0x5370e2(0x1f9)](_0x135a34=>_0x135a34['id']);if(_0x46a97d['length']){const _0x10571c=await this[_0x5370e2(0x230)]['findOne']({'where':{'id':_0x140525['user'][_0x5370e2(0x229)]}}),_0xff9734=new Map(),_0x39b5a5=await this[_0x5370e2(0x3aa)][_0x5370e2(0x3c5)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');_0x39b5a5[_0x5370e2(0x1f7)](_0x29fe89=>_0xff9734[_0x5370e2(0x2cf)](_0x29fe89[_0x5370e2(0x253)],_0x29fe89['count'])),_0x48a3fe[_0x5370e2(0x1f7)](_0x3a7ec4=>{const _0x4d3477=_0x5370e2;_0x3a7ec4[_0x4d3477(0x37e)]=_0x10571c?.[_0x4d3477(0x3c9)]||'平台',_0x3a7ec4[_0x4d3477(0x265)]=_0xff9734[_0x4d3477(0x3cd)](_0x3a7ec4[_0x4d3477(0x328)])||0x0;});}return{'rows':_0x48a3fe,'count':Number(_0x5a8cb6[0x0]?.[_0x5370e2(0x31d)]||0x0)};}async[_0x1faef5(0x2e4)](_0x162c5d,_0x128c36){const _0x21c8cd=_0x1faef5,_0xa3c183=await(0x0,utils_1['getReqSaasId'])(this[_0x21c8cd(0x2a9)]);if([Role_constant_1[_0x21c8cd(0x2c3)]['SUPER']['valueOf'](),Role_constant_1['ERole'][_0x21c8cd(0x23d)][_0x21c8cd(0x37c)](),Role_constant_1[_0x21c8cd(0x2c3)][_0x21c8cd(0x1fc)]['valueOf']()][_0x21c8cd(0x2b3)](_0x128c36[_0x21c8cd(0x328)])&&_0xa3c183!==0x0)throw new common_1[(_0x21c8cd(0x26a))]('当前角色编码不可用，请使用其他角色编码',common_1['HttpStatus']['BAD_REQUEST']);return await this[_0x21c8cd(0x262)][_0x21c8cd(0x3d6)]({..._0x128c36,'saasId':_0xa3c183,'disabled':_0x128c36[_0x21c8cd(0x2af)]??0x0}),!![];}async[_0x1faef5(0x325)](_0x217dd0,_0x481bb4){const _0x3da238=_0x1faef5,_0x36bbda=await(0x0,utils_1[_0x3da238(0x2e6)])(this[_0x3da238(0x2a9)]);if(!_0x481bb4[_0x3da238(0x232)]||!_0x481bb4[_0x3da238(0x232)][_0x3da238(0x1ef)])return!![];const _0x43d2eb=await this['roleEntity'][_0x3da238(0x3c1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x481bb4['ids']),'saasId':_0x36bbda}});if(!_0x43d2eb[_0x3da238(0x1ef)])return!![];const _0xff95a2=_0x43d2eb[_0x3da238(0x1f9)](_0x2ccb79=>_0x2ccb79[_0x3da238(0x328)]),_0x1e5a17=await this[_0x3da238(0x39c)][_0x3da238(0x31d)]({'where':{'role':(0x0,typeorm_2['In'])(_0xff95a2),'saasId':_0x36bbda}});if(_0x1e5a17>0x0)throw new common_1[(_0x3da238(0x26a))](_0x3da238(0x269),common_1[_0x3da238(0x2e8)][_0x3da238(0x34e)]);return await this[_0x3da238(0x262)]['delete']({'id':(0x0,typeorm_2['In'])(_0x481bb4[_0x3da238(0x232)])}),!![];}async[_0x1faef5(0x343)](_0x21c768){const _0x26ae8d=_0x1faef5;if(!_0x21c768[_0x26ae8d(0x1ef)])return[];const _0x1607da=await this['userEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x21c768)}});return _0x1607da;}async['createUserAndVerifycation'](_0x2aa00c,_0x5ecc65){const _0x3f3db1=_0x1faef5,{username:_0x1a0024,email:_0x4df71d,password:_0x59268d,invitedBy:_0x4f2fac,client:client=0x0}=_0x2aa00c;if(_0x4f2fac){const _0xfec98d=await this[_0x3f3db1(0x39c)]['findOne']({'where':{'inviteCode':_0x4f2fac}});if(!_0xfec98d)throw new common_1[(_0x3f3db1(0x26a))](_0x3f3db1(0x3d9),common_1[_0x3f3db1(0x2e8)]['BAD_REQUEST']);}const _0x112516=[{'username':_0x1a0024},{'email':_0x4df71d}],_0x42f69e=await this[_0x3f3db1(0x39c)]['findOne']({'where':_0x112516});if(_0x42f69e&&_0x42f69e[_0x3f3db1(0x371)]!==user_constant_1[_0x3f3db1(0x2c2)][_0x3f3db1(0x30e)])throw new common_1[(_0x3f3db1(0x26a))](_0x3f3db1(0x315),common_1[_0x3f3db1(0x2e8)][_0x3f3db1(0x34e)]);try{const _0x1f2ccc=_[_0x3f3db1(0x225)](_0x2aa00c),_0x38e947=bcrypt[_0x3f3db1(0x363)](_0x59268d,0xa),_0x3618dd=(0x0,utils_1[_0x3f3db1(0x220)])(_0x5ecc65);_0x1f2ccc[_0x3f3db1(0x267)]=_0x38e947,_0x1f2ccc[_0x3f3db1(0x25b)]=_0x3618dd,_0x1f2ccc['client']=client;let _0x5c40b5;if(!_0x42f69e){const _0xdb9bf3=await this[_0x3f3db1(0x319)][_0x3f3db1(0x366)](['userDefautlAvatar']);_0x1f2ccc[_0x3f3db1(0x327)]=_0xdb9bf3,_0x5c40b5=await this[_0x3f3db1(0x39c)][_0x3f3db1(0x3d6)](_0x1f2ccc);}else _0x5c40b5=_0x42f69e;const _0x1d0b02=await this['globalConfigService'][_0x3f3db1(0x366)]([_0x3f3db1(0x222),'registerBaseUrl',_0x3f3db1(0x285),_0x3f3db1(0x226),_0x3f3db1(0x378),_0x3f3db1(0x24b)]),_0x4c535a=_0x1d0b02[_0x3f3db1(0x222)]?Number(_0x1d0b02[_0x3f3db1(0x222)]):0x1;if(_0x4c535a){const _0x4331de=_0x1d0b02[_0x3f3db1(0x24b)]?Number(_0x1d0b02['registerVerifyExpir']):0x1e*0x3c,_0x2f01df=await this[_0x3f3db1(0x3af)]['createVerification'](_0x5c40b5,verification_constant_1[_0x3f3db1(0x23b)][_0x3f3db1(0x1e7)],_0x4331de),{code:_0x1d32a2,email:_0x2763fc,id:_0x5be83a}=_0x2f01df,{registerVerifyEmailFrom:_0x47bff1}=_0x1d0b02;await this[_0x3f3db1(0x1ff)][_0x3f3db1(0x292)]({'to':_0x2763fc,'subject':'来自'+_0x47bff1+_0x3f3db1(0x399),'template':_0x3f3db1(0x333),'context':{'baseUrl':_0x1d0b02[_0x3f3db1(0x2cb)],'code':_0x1d32a2,'id':_0x5be83a,..._0x1d0b02}});}else{const {id:_0x4b1111,invitedBy:_0x434f6f}=_0x5c40b5;await this[_0x3f3db1(0x273)](_0x4b1111,user_constant_1[_0x3f3db1(0x2c2)][_0x3f3db1(0x24f)]);let _0x2caad3;_0x434f6f&&(_0x2caad3=await this[_0x3f3db1(0x3b1)](_0x434f6f)),await this[_0x3f3db1(0x2ed)](_0x5c40b5,_0x2caad3);}return _0x5c40b5;}catch(_0x39a8f4){console[_0x3f3db1(0x36b)](_0x3f3db1(0x346),_0x39a8f4);throw _0x39a8f4;}}async[_0x1faef5(0x389)](_0x31fa5e){const _0x4aac4d=_0x1faef5,{username:_0x4107ef,password:_0x1b3fd4,uid:uid=0x0,phone:_0x395221}=_0x31fa5e;let _0x12c32b=null;if(uid>0x0){_0x12c32b=await this[_0x4aac4d(0x39c)]['findOne']({'where':{'id':uid}});if(!_0x12c32b)throw new common_1['HttpException'](_0x4aac4d(0x240),common_1[_0x4aac4d(0x2e8)][_0x4aac4d(0x34e)]);if(!bcrypt[_0x4aac4d(0x1ed)](_0x1b3fd4,_0x12c32b[_0x4aac4d(0x267)]))throw new common_1[(_0x4aac4d(0x26a))](_0x4aac4d(0x301),common_1[_0x4aac4d(0x2e8)]['BAD_REQUEST']);}if(_0x4107ef&&_0x1b3fd4){const _0x311526=[{'username':_0x4107ef},{'email':_0x4107ef}];_0x12c32b=await this[_0x4aac4d(0x39c)][_0x4aac4d(0x203)]({'where':_0x311526});if(!_0x12c32b)throw new common_1[(_0x4aac4d(0x26a))](_0x4aac4d(0x240),common_1['HttpStatus'][_0x4aac4d(0x34e)]);if(!bcrypt[_0x4aac4d(0x1ed)](_0x1b3fd4,_0x12c32b[_0x4aac4d(0x267)]))throw new common_1[(_0x4aac4d(0x26a))](_0x4aac4d(0x301),common_1[_0x4aac4d(0x2e8)][_0x4aac4d(0x34e)]);}if(_0x395221&&_0x1b3fd4){const _0x4e7475=[{'phone':_0x395221}];_0x12c32b=await this[_0x4aac4d(0x39c)]['findOne']({'where':_0x4e7475});if(!_0x12c32b)throw new common_1[(_0x4aac4d(0x26a))](_0x4aac4d(0x240),common_1[_0x4aac4d(0x2e8)][_0x4aac4d(0x34e)]);if(!bcrypt[_0x4aac4d(0x1ed)](_0x1b3fd4,_0x12c32b[_0x4aac4d(0x267)]))throw new common_1['HttpException'](_0x4aac4d(0x301),common_1[_0x4aac4d(0x2e8)][_0x4aac4d(0x34e)]);}if(!_0x12c32b)throw new common_1[(_0x4aac4d(0x26a))](_0x4aac4d(0x240),common_1[_0x4aac4d(0x2e8)][_0x4aac4d(0x34e)]);if(_0x12c32b[_0x4aac4d(0x371)]!==user_constant_1[_0x4aac4d(0x2c2)]['ACTIVE'])throw new common_1['HttpException'](user_constant_1['UserStatusErrMsg'][_0x12c32b[_0x4aac4d(0x371)]],common_1[_0x4aac4d(0x2e8)][_0x4aac4d(0x34e)]);if(_0x12c32b[_0x4aac4d(0x256)]&&!_0x12c32b[_0x4aac4d(0x38f)]){const _0x285ee5=await this['userInitVipEntity'][_0x4aac4d(0x203)]({'where':{'username':_0x12c32b['username']}});_0x285ee5&&await this[_0x4aac4d(0x3aa)]['transaction'](async()=>{const _0x1c4dec=_0x4aac4d;_0x285ee5[_0x1c4dec(0x316)]===-0x1?_0x12c32b[_0x1c4dec(0x252)]=0x1:_0x12c32b[_0x1c4dec(0x299)]=(0x0,date_1['default'])()['add'](_0x285ee5[_0x1c4dec(0x316)],_0x1c4dec(0x34c))['toDate'](),_0x12c32b=await this[_0x1c4dec(0x39c)]['save'](_0x12c32b),await this[_0x1c4dec(0x356)]['delete']({'id':_0x285ee5['id']});});}return _0x12c32b;}async[_0x1faef5(0x1e5)](_0x33fa8c,_0x48312e){const _0xb1598e=_0x1faef5,_0x1ea211=await this[_0xb1598e(0x39c)][_0xb1598e(0x203)]({'where':{'id':_0x33fa8c}});return bcrypt[_0xb1598e(0x1ed)](_0x48312e,_0x1ea211[_0xb1598e(0x267)]);}async[_0x1faef5(0x273)](_0x469674,_0x2d6d15){const _0xe8dbfe=_0x1faef5,_0x50df9b=await this['userEntity'][_0xe8dbfe(0x221)]({'id':_0x469674},{'status':_0x2d6d15});return _0x50df9b[_0xe8dbfe(0x34a)]>0x0;}async[_0x1faef5(0x260)](_0x2515b7){const _0xe7736e=_0x1faef5,_0x30c889=await this[_0xe7736e(0x39c)][_0xe7736e(0x203)]({'where':{'id':_0x2515b7}});return _0x30c889[_0xe7736e(0x371)];}async[_0x1faef5(0x32f)](_0x2fc5e3){return await this['userEntity']['findOne']({'where':{'id':_0x2fc5e3}});}async['queryUserInfoByIds'](_0x1b209d){const _0x58b72b=_0x1faef5;return await this[_0x58b72b(0x39c)][_0x58b72b(0x284)]({'id':(0x0,typeorm_2['In'])(_0x1b209d)});}async[_0x1faef5(0x3b5)](_0xc5f2d){const _0x1255e3=_0x1faef5;return await this['userEntity'][_0x1255e3(0x203)]({'where':{'username':_0xc5f2d}});}async[_0x1faef5(0x26e)](_0x2451e2,_0x348a2e,_0x122794){const _0x321f04=_0x1faef5;return await this[_0x321f04(0x39c)][_0x321f04(0x221)](_0x2451e2,{'openId':_0x348a2e,'unionid':_0x122794});}async[_0x1faef5(0x309)](_0x57e99c,_0x344191,_0x3dcd87){const _0x71852b=_0x1faef5;return await this[_0x71852b(0x39c)][_0x71852b(0x221)](_0x57e99c,{'miniOpenId':_0x344191,'unionid':_0x3dcd87});}async[_0x1faef5(0x348)](_0x691f61,_0x1070de,_0xf85030){const _0x4568e5=_0x1faef5;return await this[_0x4568e5(0x39c)]['update'](_0x691f61,{'weAppOpenId':_0x1070de,'unionid':_0xf85030});}async[_0x1faef5(0x3b4)](_0x48f783){const _0x5c580a=_0x1faef5,{id:_0x52972f,username:_0x550b31,password:_0x68d1ec}=_0x48f783;return await this['userEntity'][_0x5c580a(0x221)](_0x52972f,{'username':_0x550b31,'password':_0x68d1ec});}async[_0x1faef5(0x2e1)](_0x403343){const _0x3fa47f=_0x1faef5;return await this[_0x3fa47f(0x39c)][_0x3fa47f(0x203)]({'where':{'id':_0x403343}});}async[_0x1faef5(0x25d)](_0x16f095){const _0x2cabe8=_0x1faef5,{id:_0x16ed3c,role:_0xbd0141}=_0x16f095;if(_0xbd0141===_0x2cabe8(0x39d))return!![];const _0x39040d=await this[_0x2cabe8(0x39c)][_0x2cabe8(0x203)]({'where':{'id':_0x16ed3c}});if(!_0x39040d)throw new common_1[(_0x2cabe8(0x26a))]('当前用户信息失效、请重新登录！',common_1['HttpStatus'][_0x2cabe8(0x30d)]);if(_0x39040d[_0x2cabe8(0x371)]===user_constant_1[_0x2cabe8(0x2c2)]['BLACKLISTED'])throw new common_1[(_0x2cabe8(0x26a))]('您的账户已被永久加入黑名单、如有疑问、请联系管理员！',common_1['HttpStatus'][_0x2cabe8(0x34e)]);if(_0x39040d[_0x2cabe8(0x371)]===user_constant_1[_0x2cabe8(0x2c2)][_0x2cabe8(0x25e)])throw new common_1[(_0x2cabe8(0x26a))](_0x2cabe8(0x1fb),common_1[_0x2cabe8(0x2e8)][_0x2cabe8(0x34e)]);}async['getUserById'](_0x103ccf){return await this['userEntity']['findOne']({'where':{'id':_0x103ccf}});}[_0x1faef5(0x36d)](_0x376e9b){const _0x1d4c55=_0x1faef5;return this['userEntity'][_0x1d4c55(0x3c1)]({'where':{'id':(0x0,typeorm_2['In'])(_0x376e9b)}});}async[_0x1faef5(0x352)](_0x112825){const _0x256edd=_0x1faef5;return this[_0x256edd(0x39c)][_0x256edd(0x203)]({'where':{'inviteCode':_0x112825}});}async[_0x1faef5(0x274)](_0x2fe14c){const _0x17bcdb=_0x1faef5,_0x306cce=(0x0,utils_1['getReqSaasId'])(this[_0x17bcdb(0x2a9)]);return await this[_0x17bcdb(0x39c)]['findOne']({'where':{'openId':_0x2fe14c,'saasId':_0x306cce}});}async[_0x1faef5(0x202)](_0x55e90a){const _0x4632dc=_0x1faef5,_0x3347d1=(0x0,utils_1[_0x4632dc(0x2e6)])(this['clsService']);return await this['userEntity'][_0x4632dc(0x203)]({'where':{'unionid':_0x55e90a,'saasId':_0x3347d1}});}async[_0x1faef5(0x3ab)](_0xf968dd){const _0x583217=_0x1faef5;return this[_0x583217(0x39c)][_0x583217(0x31d)]({'where':{'invitedBy':_0xf968dd}});}async[_0x1faef5(0x34b)](_0x15f54c,_0x34c11e){const _0x3123c0=_0x1faef5,{id:_0x4219f9}=_0x34c11e[_0x3123c0(0x2bf)],_0x2f8209=await this[_0x3123c0(0x39c)][_0x3123c0(0x203)]({'where':{'id':_0x4219f9}});if(!_0x2f8209)throw new common_1[(_0x3123c0(0x26a))]('当前用户不存在！',common_1['HttpStatus']['BAD_REQUEST']);if(_0x15f54c[_0x3123c0(0x256)]&&_0x2f8209[_0x3123c0(0x256)]===_0x15f54c['username'])throw new common_1[(_0x3123c0(0x26a))](_0x3123c0(0x2e7),common_1[_0x3123c0(0x2e8)][_0x3123c0(0x34e)]);if(_0x15f54c[_0x3123c0(0x256)]){const _0x142512=await this[_0x3123c0(0x39c)][_0x3123c0(0x203)]({'where':{'username':_0x15f54c[_0x3123c0(0x256)],'id':(0x0,typeorm_2[_0x3123c0(0x21e)])(_0x4219f9)}});if(_0x142512)throw new common_1[(_0x3123c0(0x26a))](_0x3123c0(0x277),common_1['HttpStatus'][_0x3123c0(0x34e)]);}const _0x5c667c=await this[_0x3123c0(0x39c)]['update']({'id':_0x4219f9},_0x15f54c);if(_0x5c667c[_0x3123c0(0x34a)]<=0x0)throw new common_1[(_0x3123c0(0x26a))](_0x3123c0(0x398),common_1['HttpStatus'][_0x3123c0(0x34e)]);return _0x3123c0(0x205);}async[_0x1faef5(0x2b8)](_0x5e9ce0,_0x423362){const _0x5babb2=_0x1faef5,_0x36ac0c=bcrypt[_0x5babb2(0x363)](_0x423362,0xa),_0x1cbaf8=await this['userEntity']['update']({'id':_0x5e9ce0},{'password':_0x36ac0c});if(_0x1cbaf8[_0x5babb2(0x34a)]<=0x0)throw new common_1[(_0x5babb2(0x26a))](_0x5babb2(0x30a),common_1[_0x5babb2(0x2e8)][_0x5babb2(0x34e)]);}async['favorite'](_0x1e2894,_0x267971){const _0x244b8f=_0x1faef5;try{const _0x18be1a=await this[_0x244b8f(0x2ff)][_0x244b8f(0x203)]({'where':{'userId':_0x1e2894['user']['id'],'relateId':_0x267971[_0x244b8f(0x2b2)],'relateType':_0x267971[_0x244b8f(0x311)]}});return _0x18be1a?await this[_0x244b8f(0x2ff)][_0x244b8f(0x2dc)]({'id':_0x18be1a['id']}):await this[_0x244b8f(0x2ff)]['save']({'userId':_0x1e2894[_0x244b8f(0x2bf)]['id'],'relateId':_0x267971[_0x244b8f(0x2b2)],'relateType':_0x267971[_0x244b8f(0x311)]}),!![];}catch(_0x2cb195){throw new common_1[(_0x244b8f(0x26a))](_0x2cb195[_0x244b8f(0x338)],common_1[_0x244b8f(0x2e8)][_0x244b8f(0x34e)]);}}async['favoriteListByTypeAndIds'](_0x1e7eff,_0x14575e,_0x25f517){const _0x2d6b85=_0x1faef5;return this[_0x2d6b85(0x2ff)][_0x2d6b85(0x3c1)]({'where':{'userId':_0x1e7eff,'relateType':_0x14575e,'relateId':(0x0,typeorm_2['In'])(_0x25f517)}});}async[_0x1faef5(0x340)](_0x4a9530){const _0x299636=_0x1faef5,{id:_0x1e6225}=_0x4a9530[_0x299636(0x2bf)],_0x27d88b=await this[_0x299636(0x39c)]['findOne']({'where':{'id':_0x1e6225}});if(!_0x27d88b||_0x27d88b[_0x299636(0x314)])throw new common_1[(_0x299636(0x26a))]('已生成过邀请码、请勿重复生成',common_1['HttpStatus']['BAD_REQUEST']);const _0x535c88=(0x0,utils_1[_0x299636(0x204)])(),_0x4ad444=await this['userEntity'][_0x299636(0x203)]({'where':{'inviteCode':_0x535c88}});if(_0x4ad444)throw new common_1[(_0x299636(0x26a))](_0x299636(0x2d4),common_1[_0x299636(0x2e8)][_0x299636(0x34e)]);const _0x410341=await this[_0x299636(0x39c)][_0x299636(0x221)]({'id':_0x1e6225},{'inviteCode':_0x535c88});if(_0x410341[_0x299636(0x34a)]<=0x0)throw new common_1[(_0x299636(0x26a))](_0x299636(0x2d4),common_1['HttpStatus'][_0x299636(0x34e)]);return _0x535c88;}async['getInviteRecord'](_0x4b3713,_0x15d29a){const _0x1c6d63=_0x1faef5;try{const {id:_0x394f82}=_0x4b3713['user'],{page:page=0x1,size:size=0xa}=_0x15d29a,_0x5a345e=await this['userEntity'][_0x1c6d63(0x203)]({'where':{'id':_0x394f82}}),{inviteCode:_0x4b123b}=_0x5a345e;if(!_0x4b123b)return[];const [_0x506985,_0x331f2c]=await this[_0x1c6d63(0x39c)]['findAndCount']({'where':{'inviteCode':_0x4b123b},'order':{'id':_0x1c6d63(0x227)},'select':['username',_0x1c6d63(0x280),_0x1c6d63(0x347),_0x1c6d63(0x371),_0x1c6d63(0x327)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x1c6d63(0x20e)])(_0x506985)[_0x1c6d63(0x1f9)](_0x112feb=>{const _0x20be42=_0x1c6d63;return _0x112feb[_0x20be42(0x280)]=(0x0,utils_1['maskEmail'])(_0x112feb[_0x20be42(0x280)]),_0x112feb;}),{'rows':_0x506985,'count':_0x331f2c};}catch(_0x33dc2a){console[_0x1c6d63(0x36b)](_0x1c6d63(0x346),_0x33dc2a);throw new common_1[(_0x1c6d63(0x26a))](_0x1c6d63(0x251),common_1[_0x1c6d63(0x2e8)][_0x1c6d63(0x34e)]);}}async[_0x1faef5(0x388)](_0x5dc247,_0x139c55,_0x18d40f){const _0x421af8=_0x1faef5,_0x272ed4=(0x0,utils_1['getReqSaasId'])(this[_0x421af8(0x2a9)]),{page:page=0x1,size:size=0x14,startTime:_0x1fef80,endTime:_0x5b7795,saasId:_0x19efa2,keyword:_0x2edfc1,inviterKeyword:_0x35dc72}=_0x139c55,_0x3ad9b3='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x18d40f?'\x20AND\x20u.userId\x20=\x20'+_0x18d40f:'')+_0x421af8(0x1f2)+(_0x5b7795?_0x421af8(0x38a)+_0x5b7795+'\x27':'')+_0x421af8(0x1f2)+(_0x1fef80?_0x421af8(0x31c)+_0x1fef80+'\x27':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x272ed4!==0x0?'\x20AND\x20u.saasId\x20=\x20'+_0x272ed4:(0x0,utils_1[_0x421af8(0x25c)])(_0x19efa2)?'\x20AND\x20u.saasId\x20=\x20'+_0x19efa2:'')+_0x421af8(0x1f2)+(_0x2edfc1?_0x421af8(0x23f)+_0x2edfc1+'%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%'+_0x2edfc1+_0x421af8(0x242)+_0x2edfc1+'%\x27\x20OR\x20u.email\x20LIKE\x20\x27%'+_0x2edfc1+_0x421af8(0x32d):'')+_0x421af8(0x1f2)+(_0x35dc72?_0x421af8(0x216)+_0x35dc72+_0x421af8(0x2dd)+_0x35dc72+_0x421af8(0x2a7)+_0x35dc72+_0x421af8(0x1ee)+_0x35dc72+'%\x27\x20)':'')+_0x421af8(0x360),_0x5ddc0b=_0x421af8(0x355)+_0x3ad9b3+_0x421af8(0x360),_0x3e44b6=_0x421af8(0x2d8)+_0x3ad9b3+_0x421af8(0x29f)+size+_0x421af8(0x2d7)+(page-0x1)*size+_0x421af8(0x360),_0x14f91a=await this['connection']['query'](_0x5ddc0b),_0x2af305=await this[_0x421af8(0x3aa)][_0x421af8(0x3c5)](_0x3e44b6);return!(0x0,utils_1[_0x421af8(0x206)])(this[_0x421af8(0x2a9)])&&_0x2af305[_0x421af8(0x1f7)](_0x28634d=>{const _0x5324e4=_0x421af8;_0x28634d['phone']=(0x0,utils_1[_0x5324e4(0x289)])(_0x28634d[_0x5324e4(0x27b)]),_0x28634d[_0x5324e4(0x280)]=(0x0,utils_1['hideString'])(_0x28634d[_0x5324e4(0x280)]),_0x28634d[_0x5324e4(0x24d)]=(0x0,utils_1[_0x5324e4(0x289)])(_0x28634d[_0x5324e4(0x24d)]),_0x28634d[_0x5324e4(0x1f4)]=(0x0,utils_1['hideString'])(_0x28634d[_0x5324e4(0x1f4)]);}),{'rows':_0x2af305,'count':Number(_0x14f91a[0x0]?.[_0x421af8(0x31d)]||0x0)};}async[_0x1faef5(0x375)](_0x4c400a){const _0x3a081f=_0x1faef5,_0x57ba6a=await this['userEntity'][_0x3a081f(0x203)]({'where':{'inviteCode':_0x4c400a}});if(!_0x57ba6a)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x57ba6a,_0x5da3b0=await this[_0x3a081f(0x39c)][_0x3a081f(0x221)]({'inviteCode':_0x4c400a},{'inviteLinkCount':inviteLinkCount+0x1});return _0x5da3b0['affected']?0x1:0x0;}async[_0x1faef5(0x3b1)](_0x3457da){const _0x2662b9=_0x1faef5;return await this['userEntity'][_0x2662b9(0x203)]({'where':{'inviteCode':_0x3457da}});}async[_0x1faef5(0x3d1)](_0x2833b0,_0x2eead7){const _0x5073a5=_0x1faef5,_0x304830=(0x0,utils_1[_0x5073a5(0x2e6)])(this[_0x5073a5(0x2a9)]);let {page:page=0x1,size:size=0xa,username:_0x4c6213,phone:_0x3070ef,email:_0x2dfabc,status:_0x3468c0,keyword:_0x15cbd3,roleCode:_0x2dc7d1,vip:_0x1fb94b,saasId:_0x24d013}=_0x2833b0,_0x3f61ea='1\x20=\x201';_0x3468c0&&(_0x3f61ea=_0x3f61ea+(_0x5073a5(0x370)+_0x3468c0));_0x2dc7d1&&(_0x3f61ea=_0x3f61ea+(_0x5073a5(0x3a6)+_0x2dc7d1+'\x27'));_0x1fb94b&&(_0x1fb94b=Number(_0x1fb94b));if(_0x1fb94b===0x1)_0x3f61ea=_0x3f61ea+'\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)';else _0x1fb94b===0x0&&(_0x3f61ea=_0x3f61ea+_0x5073a5(0x297));_0x15cbd3?_0x3f61ea=_0x3f61ea+('\x20AND\x20(username\x20LIKE\x20\x27%'+_0x15cbd3+_0x5073a5(0x1f5)+_0x15cbd3+_0x5073a5(0x2ca)+_0x15cbd3+_0x5073a5(0x23e)+_0x15cbd3+_0x5073a5(0x33d)+_0x15cbd3+'\x27)'):(_0x4c6213&&(_0x3f61ea=_0x3f61ea+(_0x5073a5(0x39e)+_0x4c6213+'%\x27')),_0x2dfabc&&(_0x3f61ea=_0x3f61ea+(_0x5073a5(0x268)+_0x2dfabc+'%\x27')),_0x3070ef&&(_0x3f61ea=_0x3f61ea+(_0x5073a5(0x383)+_0x3070ef+'%\x27')));(0x0,utils_1[_0x5073a5(0x3a1)])(this['clsService'])?(0x0,utils_1['isManage'])(this[_0x5073a5(0x2a9)])&&_0x24d013&&(_0x3f61ea=_0x3f61ea+(_0x5073a5(0x24a)+_0x24d013)):_0x3f61ea=_0x3f61ea+(_0x5073a5(0x24a)+_0x304830);const _0x889610=await this[_0x5073a5(0x3aa)]['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3f61ea+_0x5073a5(0x290)),_0x55b014=await this[_0x5073a5(0x3aa)][_0x5073a5(0x3c5)](_0x5073a5(0x1fe)+_0x3f61ea+_0x5073a5(0x2fc)+size+_0x5073a5(0x2d7)+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x12de3c=[],_0x156066=(0x0,utils_1[_0x5073a5(0x206)])(this[_0x5073a5(0x2a9)]),_0x534fa3=new Map([[Role_constant_1[_0x5073a5(0x2c3)][_0x5073a5(0x23d)],'代理商'],[Role_constant_1[_0x5073a5(0x2c3)]['SUPER'],_0x5073a5(0x1e8)],[Role_constant_1[_0x5073a5(0x2c3)][_0x5073a5(0x1fc)],_0x5073a5(0x28e)]]);for(let _0x3f28b3=0x0;_0x3f28b3<_0x55b014[_0x5073a5(0x1ef)];_0x3f28b3++){const _0x3ada9d=_0x55b014[_0x3f28b3];let _0x35a0bf=_0x5073a5(0x28e);if(_0x534fa3[_0x5073a5(0x364)](_0x3ada9d[_0x5073a5(0x253)]))_0x35a0bf=_0x534fa3[_0x5073a5(0x3cd)](_0x3ada9d[_0x5073a5(0x253)]);else{const _0xc5a98b=await this[_0x5073a5(0x262)][_0x5073a5(0x203)]({'where':{'code':_0x3ada9d[_0x5073a5(0x253)],'saasId':_0x3ada9d['saasId']}});_0x35a0bf=_0xc5a98b[_0x5073a5(0x3c9)];}_0x12de3c[_0x5073a5(0x255)]({..._0x3ada9d,'roleName':_0x35a0bf,'isBindWx':!!_0x3ada9d?.[_0x5073a5(0x3b7)],'password':_0x3ada9d[_0x5073a5(0x267)]?_0x5073a5(0x35c):'no','email':_0x156066?_0x3ada9d['email']:(0x0,utils_1[_0x5073a5(0x1f8)])(_0x3ada9d[_0x5073a5(0x280)]),'phone':_0x156066?_0x3ada9d[_0x5073a5(0x27b)]:(0x0,utils_1[_0x5073a5(0x1f8)])(_0x3ada9d[_0x5073a5(0x27b)]),'lastLoginIp':_0x156066?_0x3ada9d[_0x5073a5(0x38f)]:(0x0,utils_1['maskIpAddress'])(_0x3ada9d[_0x5073a5(0x38f)])});}return{'rows':_0x12de3c,'count':Number(_0x889610[0x0]?.[_0x5073a5(0x31d)]||0x0)};}async[_0x1faef5(0x2bd)](_0x4c2a70){const _0x4352ce=_0x1faef5,{page:page=0x1,size:size=0xa,username:_0x3bdbe8,status:_0x62100a}=_0x4c2a70;let _0x40ace4={};_0x3bdbe8&&Object[_0x4352ce(0x337)](_0x40ace4,{'username':(0x0,typeorm_2[_0x4352ce(0x3ce)])('%'+_0x3bdbe8+'%')}),_0x62100a&&Object[_0x4352ce(0x337)](_0x40ace4,{'status':_0x62100a});const [_0x1466d7,_0x1f5c57]=await this[_0x4352ce(0x39c)][_0x4352ce(0x382)]({'skip':(page-0x1)*size,'where':_0x40ace4,'take':size,'cache':!![],'order':{'createdAt':'DESC'},'select':[_0x4352ce(0x256),_0x4352ce(0x267),'role',_0x4352ce(0x371),'id']});return{'rows':_0x1466d7,'count':_0x1f5c57};}async[_0x1faef5(0x29e)]({id:_0x21d440}){const _0x1830e1=_0x1faef5;let _0x15f5c2,_0x4f5b9c;const _0x384a79=await this[_0x1830e1(0x39c)][_0x1830e1(0x203)]({'where':{'id':_0x21d440}});if(!_0x384a79)throw new common_1[(_0x1830e1(0x26a))]('查询用户不存在！',common_1[_0x1830e1(0x2e8)][_0x1830e1(0x30d)]);if((0x0,utils_1[_0x1830e1(0x397)])(_0x384a79[_0x1830e1(0x253)])){const _0xf4df8=_0x384a79[_0x1830e1(0x253)]===Role_constant_1[_0x1830e1(0x2c3)]['AGENT']?0x0:_0x384a79[_0x1830e1(0x229)],_0x3005b4=await this['roleEntity'][_0x1830e1(0x203)]({'where':{'code':_0x384a79[_0x1830e1(0x253)],'saasId':_0xf4df8}});if(!_0x3005b4)throw new common_1[(_0x1830e1(0x26a))](_0x1830e1(0x2c1),common_1['HttpStatus'][_0x1830e1(0x34e)]);_0x15f5c2=_0x3005b4['access'],_0x4f5b9c=_0x3005b4[_0x1830e1(0x218)];}return{..._0x384a79,'access':_0x15f5c2,'accessLabel':_0x4f5b9c,'isBindWx':!!_0x384a79?.[_0x1830e1(0x3b7)],'password':_0x384a79[_0x1830e1(0x267)]?_0x1830e1(0x35c):'no'};}async['getOne'](_0x186bf5){const _0x46b4bb=_0x1faef5;return await this[_0x46b4bb(0x39c)][_0x46b4bb(0x203)]({'where':{'username':_0x186bf5}});}async[_0x1faef5(0x3d5)](_0x388578){const _0x2302d0=_0x1faef5,{id:_0x2bb1e5,status:_0xf4fa14}=_0x388578,_0x50f00c=await this[_0x2302d0(0x39c)][_0x2302d0(0x203)]({'where':{'id':_0x2bb1e5}});if(!_0x50f00c)throw new common_1[(_0x2302d0(0x26a))](_0x2302d0(0x37a),common_1[_0x2302d0(0x2e8)][_0x2302d0(0x34e)]);if(_0x50f00c[_0x2302d0(0x253)]===Role_constant_1['ERole'][_0x2302d0(0x32a)])throw new common_1[(_0x2302d0(0x26a))](_0x2302d0(0x332),common_1[_0x2302d0(0x2e8)][_0x2302d0(0x34e)]);if(_0x50f00c[_0x2302d0(0x371)]===user_constant_1[_0x2302d0(0x2c2)][_0x2302d0(0x30e)])throw new common_1[(_0x2302d0(0x26a))]('未激活用户不可手动变更状态！',common_1[_0x2302d0(0x2e8)][_0x2302d0(0x34e)]);if(_0xf4fa14===user_constant_1[_0x2302d0(0x2c2)]['PENDING'])throw new common_1[(_0x2302d0(0x26a))](_0x2302d0(0x303),common_1[_0x2302d0(0x2e8)][_0x2302d0(0x34e)]);const _0x8fcfa1=await this[_0x2302d0(0x39c)][_0x2302d0(0x221)]({'id':_0x2bb1e5},{'status':_0xf4fa14});if(_0x8fcfa1[_0x2302d0(0x34a)]<=0x0)throw new common_1[(_0x2302d0(0x26a))](_0x2302d0(0x33c),common_1[_0x2302d0(0x2e8)][_0x2302d0(0x34e)]);return _0x2302d0(0x1f0);}async[_0x1faef5(0x2bc)](_0x49851b){const _0x40a588=_0x1faef5,{id:_0x117fbd,role:_0x1ede1c}=_0x49851b,_0x168e44=await this['userEntity']['update']({'id':_0x117fbd},{'role':_0x1ede1c});if(_0x168e44[_0x40a588(0x34a)]<=0x0)throw new common_1[(_0x40a588(0x26a))](_0x40a588(0x1f3),common_1[_0x40a588(0x2e8)][_0x40a588(0x34e)]);return'修改用户角色成功！';}async[_0x1faef5(0x201)](_0x30f2ec){const _0x39d504=_0x1faef5,{id:_0x5e7ae5}=_0x30f2ec,_0x3b9cb4=await this['userEntity'][_0x39d504(0x203)]({'where':{'id':_0x5e7ae5}});if(!_0x3b9cb4)throw new common_1['HttpException'](_0x39d504(0x37a),common_1[_0x39d504(0x2e8)][_0x39d504(0x34e)]);const _0x1b0bcf='123456',_0xda1759=bcrypt[_0x39d504(0x363)](_0x1b0bcf,0xa),_0xcd983c=await this[_0x39d504(0x39c)][_0x39d504(0x221)]({'id':_0x5e7ae5},{'password':_0xda1759});if(_0xcd983c['affected']<=0x0)throw new common_1[(_0x39d504(0x26a))](_0x39d504(0x271),common_1[_0x39d504(0x2e8)]['BAD_REQUEST']);return _0x39d504(0x321)+_0x1b0bcf+_0x39d504(0x208);}async[_0x1faef5(0x231)](_0x3f5c66,_0x48d2fc){const _0x56fa27=_0x1faef5;return await this[_0x56fa27(0x39c)][_0x56fa27(0x221)]({'id':_0x3f5c66},{'lastLoginIp':_0x48d2fc});}async[_0x1faef5(0x223)](_0x1119e7,_0x4c2102){const _0x115066=_0x1faef5;try{const _0x2f447c=await this['userEntity'][_0x115066(0x203)]({'where':{'id':_0x4c2102}});if(!_0x2f447c)return{'status':![],'msg':_0x115066(0x3b6)};const _0x477360=await this[_0x115066(0x39c)][_0x115066(0x203)]({'where':{'openId':_0x1119e7}});if(_0x477360)return{'status':![],'msg':'该微信已绑定其他账号！'};const _0x15ed66=await this[_0x115066(0x39c)][_0x115066(0x221)]({'id':_0x4c2102},{'openId':_0x1119e7});if(_0x15ed66[_0x115066(0x34a)]<=0x0)return{'status':![],'msg':_0x115066(0x351)};return{'status':!![],'msg':_0x115066(0x2cd)};}catch(_0xb43a72){return{'status':![],'msg':'绑定微信失败、请联系管理员！'};}}async['getOpenIdByUserId'](_0x4d94b7){const _0x50816b=_0x1faef5,_0x3bcb37=await this['userEntity']['findOne']({'where':{'id':_0x4d94b7}});return _0x3bcb37?.[_0x50816b(0x3b7)];}async[_0x1faef5(0x30c)](_0x58f2b4){const _0x5e5d4b=_0x1faef5,_0x227aa3=await this[_0x5e5d4b(0x39c)]['findOne']({'where':{'id':_0x58f2b4}});return _0x227aa3?.[_0x5e5d4b(0x33a)];}async['verifyUserRegisterByPhone'](_0x7528fd){const _0x2657a4=_0x1faef5,{username:_0x2efab5,password:_0x35b190,phone:_0x4f9d9c,phoneCode:_0x430304}=_0x7528fd,_0x30a694=await this[_0x2657a4(0x39c)]['findOne']({'where':[{'username':_0x2efab5},{'phone':_0x4f9d9c}]});if(_0x30a694&&_0x30a694[_0x2657a4(0x256)]===_0x2efab5)throw new common_1[(_0x2657a4(0x26a))](_0x2657a4(0x395),common_1['HttpStatus'][_0x2657a4(0x34e)]);if(_0x30a694&&_0x30a694[_0x2657a4(0x27b)]===_0x4f9d9c)throw new common_1['HttpException'](_0x2657a4(0x31a),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x1faef5(0x24e)](_0xc74c6e){const _0x382977=_0x1faef5,_0x5dbb2a=(0x0,utils_1[_0x382977(0x2e6)])(this['clsService']);if(_0xc74c6e[_0x382977(0x253)]!==Role_constant_1[_0x382977(0x2c3)][_0x382977(0x23d)])_0xc74c6e[_0x382977(0x229)]=_0x5dbb2a;else{if(!_0xc74c6e[_0x382977(0x229)])throw new common_1[(_0x382977(0x26a))]('saasId不能为空！',common_1['HttpStatus'][_0x382977(0x34e)]);}return await this[_0x382977(0x39c)][_0x382977(0x3d6)](_0xc74c6e);}async[_0x1faef5(0x279)](_0x3ea523){const _0x493c81=_0x1faef5,{id:_0x20c555,moreId:_0x1a4f7e}=_0x3ea523;if(_0x20c555)return await this[_0x493c81(0x39c)][_0x493c81(0x2dc)]({'id':_0x20c555});if(_0x1a4f7e)return await this['userEntity'][_0x493c81(0x2dc)]({'id':(0x0,typeorm_2[_0x493c81(0x362)])(_0x1a4f7e)});}async[_0x1faef5(0x385)](_0x3199d2){const _0x58fd85=_0x1faef5,_0x23088a=_0x3199d2[_0x58fd85(0x2bf)]['id'];return await this[_0x58fd85(0x39c)][_0x58fd85(0x2dc)]({'id':_0x23088a})[_0x58fd85(0x21b)](_0x28c9fa=>_0x28c9fa['affected']>0x0);}async[_0x1faef5(0x39b)](_0x1a02c7,_0x44040d){const _0x2442cd=_0x1faef5;try{if(!_0x1a02c7[_0x2442cd(0x256)]&&!_0x1a02c7['phone']&&!_0x1a02c7['email'])throw new Error('账号、手机、邮箱必须存在一个');if(_0x1a02c7['username']){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/['test'](_0x1a02c7[_0x2442cd(0x256)]))throw new Error(_0x2442cd(0x3c7));if(!_0x1a02c7[_0x2442cd(0x267)])throw new Error(_0x2442cd(0x305));}if(_0x1a02c7[_0x2442cd(0x27b)]){if(!(0x0,class_validator_1[_0x2442cd(0x29b)])(_0x1a02c7['phone'],_0x2442cd(0x28f)))throw new Error(_0x2442cd(0x2c7));}if(_0x1a02c7[_0x2442cd(0x280)]){if(!(0x0,class_validator_1['isEmail'])(_0x1a02c7[_0x2442cd(0x280)]))throw new Error(_0x2442cd(0x236));}if(_0x1a02c7[_0x2442cd(0x256)]){const _0x742270=await this[_0x2442cd(0x39c)][_0x2442cd(0x293)]({'where':{'username':_0x1a02c7[_0x2442cd(0x256)]}});if(_0x742270)throw new Error(_0x2442cd(0x2ba));}if(_0x1a02c7[_0x2442cd(0x27b)]){const _0x48f164=await this['userEntity'][_0x2442cd(0x293)]({'where':{'phone':_0x1a02c7['phone']}});if(_0x48f164)throw new Error(_0x2442cd(0x331));}if(_0x1a02c7[_0x2442cd(0x280)]){const _0x15ac20=await this[_0x2442cd(0x39c)][_0x2442cd(0x293)]({'where':{'email':_0x1a02c7[_0x2442cd(0x280)]}});if(_0x15ac20)throw new Error(_0x2442cd(0x2ce));}const _0x200fe0=new user_entity_1['UserEntity']();for(let _0x631e3a in _0x1a02c7){_0x1a02c7[_0x631e3a]&&(_0x200fe0[_0x631e3a]=_0x1a02c7[_0x631e3a]);}return _0x200fe0[_0x2442cd(0x267)]&&(_0x200fe0[_0x2442cd(0x267)]=bcrypt[_0x2442cd(0x363)](_0x1a02c7[_0x2442cd(0x267)],0xa)),_0x200fe0[_0x2442cd(0x371)]=user_constant_1[_0x2442cd(0x2c2)]['ACTIVE'],!_0x200fe0[_0x2442cd(0x3a3)]&&(_0x200fe0['nickname']=_0x200fe0['nickname']||'小智'),!_0x200fe0[_0x2442cd(0x327)]&&(_0x200fe0['avatar']=await this['globalConfigService'][_0x2442cd(0x366)](['userDefautlAvatar'])),await this['createUser'](_0x200fe0),!![];}catch(_0x9bd314){throw new common_1[(_0x2442cd(0x26a))](_0x9bd314[_0x2442cd(0x338)],common_1['HttpStatus']['BAD_REQUEST']);}}[_0x1faef5(0x368)](){const _0x457977=_0x1faef5;let _0x512bed=_0x457977(0x3ca);const _0x3ca639=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x1e7481=0x0;_0x1e7481<0xa;_0x1e7481++){_0x512bed=_0x512bed+_0x3ca639[Math['floor'](Math[_0x457977(0x341)]()*0x3f)];}return _0x512bed;}async[_0x1faef5(0x264)](_0x1b1628){const _0xbf0f60=_0x1faef5;let _0x48d430=[];for(let _0x23bd75=0x0;_0x23bd75<_0x1b1628;_0x23bd75++){_0x48d430[_0xbf0f60(0x255)](this[_0xbf0f60(0x368)]());}const _0x2575b5=await this['userEntity'][_0xbf0f60(0x3c1)]({'where':{'username':(0x0,typeorm_2['In'])(_0x48d430)}});if(!_0x2575b5['length'])return _0x48d430;else{const _0x359ece=new Set(_0x2575b5['map'](_0x1b3d29=>_0x1b3d29[_0xbf0f60(0x256)]));_0x48d430=_0x48d430['filter'](_0x4212e4=>!_0x359ece['has'](_0x4212e4));const _0x29c13c=await this[_0xbf0f60(0x264)](_0x359ece['size']);return _0x48d430=_0x48d430[_0xbf0f60(0x373)](_0x29c13c),_0x48d430;}}async[_0x1faef5(0x365)](_0x1390ae,_0x3c0cfd){const _0x553949=_0x1faef5;let _0x370730='';_0x370730=_0x553949(0x2de);const _0x2b26bc=await this['genUserNames'](_0x1390ae[_0x553949(0x2a4)]),_0x2490e7=[],_0x268f6a=[],_0x36d841=await this[_0x553949(0x319)][_0x553949(0x366)]([_0x553949(0x35d)]);for(let _0x5a7323=0x0;_0x5a7323<_0x1390ae[_0x553949(0x2a4)];_0x5a7323++){const _0x4b3720=new user_entity_1['UserEntity']();_0x4b3720[_0x553949(0x371)]=0x1,_0x4b3720['avatar']=_0x36d841,_0x4b3720[_0x553949(0x256)]=_0x2b26bc[_0x5a7323],_0x4b3720[_0x553949(0x3a3)]=_0x2b26bc[_0x5a7323],_0x4b3720[_0x553949(0x267)]=bcrypt['hashSync'](_0x553949(0x3d7),0xa),_0x370730=_0x370730+(_0x2b26bc[_0x5a7323]+_0x553949(0x34f)),_0x1390ae[_0x553949(0x287)]&&(_0x4b3720['vipLeavelId']=Number(_0x1390ae[_0x553949(0x287)])),_0x1390ae[_0x553949(0x278)]&&(_0x4b3720[_0x553949(0x278)]=_0x1390ae[_0x553949(0x278)]),_0x1390ae[_0x553949(0x272)]&&(_0x4b3720[_0x553949(0x272)]=_0x1390ae[_0x553949(0x272)]),_0x1390ae['vipDays']&&_0x268f6a[_0x553949(0x255)]({'username':_0x2b26bc[_0x5a7323],'vipDays':_0x1390ae['vipDays']}),_0x2490e7[_0x553949(0x255)](_0x4b3720);}try{return await this[_0x553949(0x3aa)][_0x553949(0x22b)](async()=>{const _0x514cf7=_0x553949;await this[_0x514cf7(0x39c)][_0x514cf7(0x3d6)](_0x2490e7),await this[_0x514cf7(0x356)][_0x514cf7(0x3d6)](_0x268f6a);}),_0x370730;}catch(_0x855442){throw new common_1[(_0x553949(0x26a))](_0x855442[_0x553949(0x338)],axios_1['HttpStatusCode'][_0x553949(0x2b1)]);}}async[_0x1faef5(0x3dd)](_0x2fa4d6,_0x27110a){const _0x2f532e=_0x1faef5,_0x5df537=await this['userEntity']['findOne']({'where':{'id':_0x27110a[_0x2f532e(0x3cb)]}});await this['userEntity'][_0x2f532e(0x244)]({'id':_0x5df537['id']},_0x2f532e(0x272),_0x27110a[_0x2f532e(0x272)]),await this[_0x2f532e(0x324)][_0x2f532e(0x27f)]({'userId':_0x5df537['id'],'rawScore':_0x5df537['score'],'newScore':_0x5df537[_0x2f532e(0x272)]+_0x27110a[_0x2f532e(0x272)],'changeScore':_0x27110a[_0x2f532e(0x272)],'changeType':balance_constant_1['EChangeType'][_0x2f532e(0x369)],'rebateUserId':_0x2fa4d6['user']['id'],'description':'管理员赠送'});}async[_0x1faef5(0x3d3)](_0x29e664,_0x72736e){const _0x5c9a98=_0x1faef5,_0x4f3501=await this[_0x5c9a98(0x39c)][_0x5c9a98(0x203)]({'where':{'id':_0x72736e['userId']}});return await this['updateVipExpire'](_0x4f3501,balance_constant_1[_0x5c9a98(0x335)][_0x5c9a98(0x369)],_0x72736e[_0x5c9a98(0x3ba)],_0x5c9a98(0x2ee),_0x29e664[_0x5c9a98(0x2bf)]['id']),!![];}async[_0x1faef5(0x3a5)](_0xa2f149){const _0x5aec68=_0x1faef5,_0x24e240=await this[_0x5aec68(0x356)][_0x5aec68(0x203)]({'where':{'username':_0xa2f149[_0x5aec68(0x256)]}});_0x24e240&&await this[_0x5aec68(0x3aa)][_0x5aec68(0x22b)](async()=>{const _0x55768f=_0x5aec68;_0x24e240[_0x55768f(0x316)]===-0x1?_0xa2f149[_0x55768f(0x252)]=0x1:_0xa2f149[_0x55768f(0x299)]=(0x0,date_1['default'])()[_0x55768f(0x2ad)](_0x24e240[_0x55768f(0x316)],_0x55768f(0x34c))[_0x55768f(0x394)](),_0xa2f149=await this[_0x55768f(0x39c)]['save'](_0xa2f149),await this[_0x55768f(0x356)][_0x55768f(0x2dc)]({'id':_0x24e240['id']});});}async[_0x1faef5(0x320)](_0xd18d78,_0x505474){const _0x3b25c8=_0x1faef5;await this['userEntity'][_0x3b25c8(0x221)]({'id':_0xd18d78},{'consecutiveDays':_0x505474});}async[_0x1faef5(0x283)](_0x26ba42){const _0x340e42=_0x1faef5,_0x478c18=await this[_0x340e42(0x1e6)](_0x26ba42);_0x478c18[_0x340e42(0x302)]=_0x478c18[_0x340e42(0x302)]+0x1,await this[_0x340e42(0x39c)][_0x340e42(0x3d6)](_0x478c18);}async[_0x1faef5(0x2ed)](_0x4c98e4,_0x183bfa){const _0x5e40fc=_0x1faef5,_0x40ab88=await this['globalConfigService']['getConfigByKeys'](['registerSendStatus',_0x5e40fc(0x217),_0x5e40fc(0x2cc),_0x5e40fc(0x34d),_0x5e40fc(0x211),_0x5e40fc(0x212),_0x5e40fc(0x22f)]),_0x32bff3={};for(let _0x46494f in _0x40ab88){const _0x2be0e7=Number(_0x40ab88[_0x46494f]),_0x3ea98b=Number['isInteger'](_0x2be0e7)&&_0x2be0e7>0x0?_0x2be0e7:0x0;_0x32bff3[_0x46494f]=_0x3ea98b;}_0x32bff3[_0x5e40fc(0x2d0)]&&(await this[_0x5e40fc(0x39c)][_0x5e40fc(0x221)]({'id':_0x4c98e4['id']},{'score':_0x32bff3[_0x5e40fc(0x217)]}),await this[_0x5e40fc(0x324)][_0x5e40fc(0x27f)]({'userId':_0x4c98e4['id'],'rawScore':0x0,'newScore':_0x32bff3[_0x5e40fc(0x217)],'changeScore':_0x32bff3[_0x5e40fc(0x217)],'changeType':balance_constant_1[_0x5e40fc(0x335)][_0x5e40fc(0x2f8)],'description':_0x5e40fc(0x209)}));if(_0x183bfa&&_0x32bff3[_0x5e40fc(0x2cc)]){_0x32bff3['inviteRewards']&&(await this[_0x5e40fc(0x39c)][_0x5e40fc(0x244)]({'id':_0x183bfa['id']},_0x5e40fc(0x272),_0x32bff3[_0x5e40fc(0x34d)]),await this[_0x5e40fc(0x324)][_0x5e40fc(0x27f)]({'userId':_0x183bfa['id'],'rawScore':_0x183bfa[_0x5e40fc(0x272)],'newScore':_0x183bfa[_0x5e40fc(0x272)]+_0x32bff3[_0x5e40fc(0x34d)],'changeScore':_0x32bff3[_0x5e40fc(0x34d)],'changeType':balance_constant_1[_0x5e40fc(0x335)][_0x5e40fc(0x342)],'rebateUserId':_0x4c98e4['id'],'description':_0x5e40fc(0x372)}));_0x32bff3[_0x5e40fc(0x211)]&&await this[_0x5e40fc(0x241)](_0x183bfa,balance_constant_1[_0x5e40fc(0x335)]['InvitationReward'],_0x32bff3['inviteRewardVip'],'邀请新用户注册奖励',_0x4c98e4['id']);const _0x388a16=await this[_0x5e40fc(0x39c)]['findOne']({'where':{'id':_0x4c98e4['id']}});_0x32bff3[_0x5e40fc(0x212)]&&(await this[_0x5e40fc(0x39c)][_0x5e40fc(0x244)]({'id':_0x388a16['id']},_0x5e40fc(0x272),_0x32bff3['invitedRewards']),await this[_0x5e40fc(0x324)]['insertAccountLog']({'userId':_0x4c98e4['id'],'rawScore':_0x388a16[_0x5e40fc(0x272)],'newScore':_0x388a16[_0x5e40fc(0x272)]+_0x32bff3['invitedRewards'],'changeScore':_0x32bff3[_0x5e40fc(0x212)],'changeType':balance_constant_1[_0x5e40fc(0x335)]['Invited'],'rebateUserId':_0x183bfa['id'],'description':_0x5e40fc(0x2be)})),_0x32bff3[_0x5e40fc(0x22f)]&&await this['updateVipExpire'](_0x388a16,balance_constant_1[_0x5e40fc(0x335)][_0x5e40fc(0x387)],_0x32bff3[_0x5e40fc(0x22f)],_0x5e40fc(0x2be),_0x183bfa['id']);}}async[_0x1faef5(0x344)](_0x5ddad1,_0x5a19fe,_0x47099a,_0x36e4e7,_0x479f8a){const _0x5d2576=_0x1faef5;await this[_0x5d2576(0x39c)][_0x5d2576(0x221)]({'id':_0x5ddad1['id']},{'score':_0x5ddad1[_0x5d2576(0x272)]+_0x47099a}),await this['userBalanceService'][_0x5d2576(0x27f)]({'userId':_0x5ddad1['id'],'rawScore':_0x5ddad1[_0x5d2576(0x272)],'newScore':_0x5ddad1[_0x5d2576(0x272)]+_0x47099a,'changeScore':_0x47099a,'changeType':_0x5a19fe,'relateId':_0x479f8a?String(_0x479f8a):null,'description':_0x36e4e7});}async['updateVipExpire'](_0x2421f9,_0x5be612,_0x5e91f6,_0x4ab156,_0x4c3c81){const _0x26e3db=_0x1faef5;if(_0x2421f9['lifetimeVip'])return;_0x5e91f6===-0x1?await this[_0x26e3db(0x39c)][_0x26e3db(0x221)]({'id':_0x2421f9['id']},{'lifetimeVip':0x1}):(_0x2421f9[_0x26e3db(0x299)]?_0x2421f9[_0x26e3db(0x299)]=(0x0,date_1[_0x26e3db(0x27d)])(_0x2421f9['vipExpire'])[_0x26e3db(0x2ad)](_0x5e91f6,_0x26e3db(0x34c))[_0x26e3db(0x394)]():_0x2421f9[_0x26e3db(0x299)]=(0x0,date_1[_0x26e3db(0x27d)])()['add'](_0x5e91f6,_0x26e3db(0x34c))[_0x26e3db(0x394)](),await this[_0x26e3db(0x39c)][_0x26e3db(0x221)]({'id':_0x2421f9['id']},{'vipExpire':_0x2421f9[_0x26e3db(0x299)]})),_0x2421f9=await this[_0x26e3db(0x39c)][_0x26e3db(0x203)]({'where':{'id':_0x2421f9['id']}}),await this[_0x26e3db(0x324)]['insertAccountVipLog']({'userId':_0x2421f9['id'],'vipDays':_0x5e91f6,'vipExpire':_0x2421f9['vipExpire'],'relateType':_0x5be612,'relateId':_0x4c3c81?String(_0x4c3c81):'','description':_0x4ab156});}async['validateBalance4Chat'](_0x2fff0b,_0x1d2056){const _0xb85763=_0x1faef5;let _0x307c51=!![];const _0x2302ee=await this['getUserById'](_0x2fff0b);if(_0x2302ee['lifetimeVip']||_0x2302ee[_0xb85763(0x299)]){if(_0x1d2056[_0xb85763(0x1f1)]<0x0)_0x307c51=!![];else{if(_0x1d2056[_0xb85763(0x1f1)]>0x0){const _0x5733e0=redisKey_constant_1[_0xb85763(0x2fb)]+'-'+_0x2fff0b+'-'+_0x1d2056['id'];let _0x1a49a1=await this[_0xb85763(0x248)][_0xb85763(0x3cd)]({'key':_0x5733e0});console[_0xb85763(0x36b)](_0x1a49a1);let _0x5649ae=Number(_0x1a49a1||0x0);_0x5649ae<_0x1d2056[_0xb85763(0x1f1)]?_0x307c51=!![]:_0x307c51=_0x2302ee[_0xb85763(0x272)]>=_0x1d2056[_0xb85763(0x3a8)];}else _0x307c51=_0x2302ee['score']>=_0x1d2056[_0xb85763(0x3a8)];}}else _0x307c51=_0x2302ee['score']>=_0x1d2056['deduct'];if(!_0x307c51)throw new common_1[(_0xb85763(0x26a))](_0xb85763(0x32c),common_1[_0xb85763(0x2e8)]['BAD_REQUEST']);}async['deductBalance4Chat'](_0x556032,_0x705892,_0x55428d){const _0x48d57c=_0x1faef5,_0x41be6b=await this[_0x48d57c(0x1e6)](_0x556032);let _0x4af7ca;switch(_0x705892[_0x48d57c(0x38c)]){case model_constant_1['EModelType']['PPT']:_0x4af7ca=balance_constant_1[_0x48d57c(0x335)][_0x48d57c(0x35f)];break;case model_constant_1[_0x48d57c(0x233)]['APP']:_0x4af7ca=balance_constant_1['EChangeType'][_0x48d57c(0x3c6)];break;case model_constant_1[_0x48d57c(0x233)]['MUSIC']:_0x4af7ca=balance_constant_1['EChangeType'][_0x48d57c(0x313)];break;case model_constant_1[_0x48d57c(0x233)][_0x48d57c(0x38e)]:_0x4af7ca=balance_constant_1['EChangeType'][_0x48d57c(0x38e)];break;case model_constant_1[_0x48d57c(0x233)][_0x48d57c(0x238)]:_0x4af7ca=balance_constant_1[_0x48d57c(0x335)][_0x48d57c(0x27a)];break;case model_constant_1[_0x48d57c(0x233)][_0x48d57c(0x245)]:_0x4af7ca=balance_constant_1[_0x48d57c(0x335)][_0x48d57c(0x353)];break;case model_constant_1['EModelType']['OTHER']:_0x4af7ca=balance_constant_1[_0x48d57c(0x335)]['Tool'];break;case model_constant_1[_0x48d57c(0x233)][_0x48d57c(0x329)]:_0x4af7ca=balance_constant_1[_0x48d57c(0x335)][_0x48d57c(0x2da)];break;case model_constant_1[_0x48d57c(0x233)]['TTS']:_0x4af7ca=balance_constant_1[_0x48d57c(0x335)][_0x48d57c(0x3a2)];break;default:_0x4af7ca=balance_constant_1['EChangeType'][_0x48d57c(0x353)];}if(_0x41be6b[_0x48d57c(0x252)]||_0x41be6b[_0x48d57c(0x299)]){if(_0x705892[_0x48d57c(0x1f1)]<0x0){await this[_0x48d57c(0x344)](_0x41be6b,_0x4af7ca,0x0,_0x48d57c(0x28b)+_0x705892['modelName']+'】会员永久免费',_0x55428d);return;}else{if(_0x705892['vipFreeNum']>0x0){const _0x235f38=redisKey_constant_1[_0x48d57c(0x2fb)]+'-'+_0x556032+'-'+_0x705892['id'];let _0x1f6af2=await this['redisCacheService'][_0x48d57c(0x3cd)]({'key':_0x235f38}),_0x5bad6c=Number(_0x1f6af2||0x0);if(_0x5bad6c<_0x705892['vipFreeNum']){const _0x20a1cb=(0x0,date_1[_0x48d57c(0x27d)])()[_0x48d57c(0x2e3)]('d')[_0x48d57c(0x22a)]((0x0,date_1[_0x48d57c(0x27d)])(),'s');await this['redisCacheService'][_0x48d57c(0x2cf)]({'key':_0x235f38,'val':_0x5bad6c+0x1},_0x20a1cb),await this[_0x48d57c(0x344)](_0x41be6b,_0x4af7ca,0x0,_0x48d57c(0x28b)+_0x705892[_0x48d57c(0x32e)]+_0x48d57c(0x3ad),_0x55428d);return;}}}}await this['changeScore4Other'](_0x41be6b,_0x4af7ca,-_0x705892[_0x48d57c(0x3a8)],'模型【'+_0x705892[_0x48d57c(0x32e)]+_0x48d57c(0x2f5),_0x55428d);}async[_0x1faef5(0x28c)](_0x56b30a,_0x2a3748,_0x140a0a,_0x43d4ef){const _0x330507=_0x1faef5,_0x480c58=await this[_0x330507(0x1e6)](_0x56b30a);let _0x3dd425=balance_constant_1[_0x330507(0x335)]['Draw'];if(_0x480c58[_0x330507(0x252)]||_0x480c58[_0x330507(0x299)]){if(_0x2a3748[_0x330507(0x1f1)]<0x0){await this['changeScore4Other'](_0x480c58,_0x3dd425,0x0,_0x330507(0x28b)+_0x2a3748['modelName']+'】会员永久免费',_0x140a0a);return;}else{if(_0x2a3748[_0x330507(0x1f1)]>0x0){const _0x27af07=redisKey_constant_1[_0x330507(0x2fb)]+'-'+_0x56b30a+'-'+_0x2a3748['id'];let _0x573f09=await this['redisCacheService'][_0x330507(0x3cd)]({'key':_0x27af07}),_0x133149=Number(_0x573f09||0x0);if(_0x133149<_0x2a3748['vipFreeNum']){const _0x3423e9=(0x0,date_1['default'])()[_0x330507(0x2e3)]('d')[_0x330507(0x22a)]((0x0,date_1[_0x330507(0x27d)])(),'s');await this[_0x330507(0x248)]['set']({'key':_0x27af07,'val':_0x133149+0x1},_0x3423e9),await this[_0x330507(0x344)](_0x480c58,_0x3dd425,0x0,_0x330507(0x28b)+_0x2a3748['modelName']+_0x330507(0x3ad),_0x140a0a);return;}}}}await this[_0x330507(0x344)](_0x480c58,_0x3dd425,-_0x2a3748[_0x330507(0x3a8)]*(_0x43d4ef||0x1),_0x330507(0x28b)+_0x2a3748[_0x330507(0x32e)]+'】使用扣减',_0x140a0a);}async[_0x1faef5(0x2fa)](_0x586a95,_0x5ac21a,_0x442d8c){const _0x56c148=_0x1faef5;let _0x4fdbf2=!![];const _0x203436=await this[_0x56c148(0x1e6)](_0x586a95);if(_0x203436[_0x56c148(0x252)]||_0x203436[_0x56c148(0x299)]){if(_0x5ac21a['vipFreeNum']<0x0){_0x4fdbf2=!![];return;}else{if(_0x5ac21a[_0x56c148(0x1f1)]>0x0){const _0x4ddb5a=redisKey_constant_1[_0x56c148(0x2fb)]+'-'+_0x586a95+'-'+_0x5ac21a['id'];let _0x5f3399=await this['redisCacheService'][_0x56c148(0x3cd)]({'key':_0x4ddb5a}),_0x52f320=Number(_0x5f3399||0x0);if(_0x52f320<_0x5ac21a[_0x56c148(0x1f1)]){_0x4fdbf2=!![];return;}}}}_0x4fdbf2=_0x203436[_0x56c148(0x272)]>=_0x5ac21a[_0x56c148(0x3a8)]*_0x442d8c;if(!_0x4fdbf2)throw new common_1[(_0x56c148(0x26a))](_0x56c148(0x32c),common_1[_0x56c148(0x2e8)][_0x56c148(0x34e)]);}async[_0x1faef5(0x3b3)](_0x321b67,_0x2f1637,_0x24ae87){const _0x3b1e68=_0x1faef5;let _0x465601=!![],_0x46a6f1=await this[_0x3b1e68(0x379)](_0x2f1637,_0x24ae87);const _0x12371e=await this['getUserById'](_0x321b67);if(_0x12371e['lifetimeVip']||_0x12371e[_0x3b1e68(0x299)]){if(_0x2f1637['vipFreeNum']<0x0||_0x46a6f1?.['vipFreeNum']<0x0){_0x465601=!![];return;}else{if(_0x46a6f1?.[_0x3b1e68(0x1f1)]>0x0){const _0x56b53c=redisKey_constant_1[_0x3b1e68(0x2fb)]+'-'+_0x321b67+'-'+_0x46a6f1[_0x3b1e68(0x257)]+'-'+_0x46a6f1[_0x3b1e68(0x25f)]+'-'+_0x46a6f1[_0x3b1e68(0x261)];let _0x2b9591=await this[_0x3b1e68(0x248)][_0x3b1e68(0x3cd)]({'key':_0x56b53c}),_0x407bdd=Number(_0x2b9591||0x0);if(_0x407bdd<_0x46a6f1[_0x3b1e68(0x1f1)]){_0x465601=!![];return;}}else{if(_0x2f1637[_0x3b1e68(0x1f1)]>0x0){const _0x2ec03b=redisKey_constant_1['VIP_FREE']+'-'+_0x321b67+'-'+_0x2f1637['id'];let _0x187b52=await this[_0x3b1e68(0x248)][_0x3b1e68(0x3cd)]({'key':_0x2ec03b});console[_0x3b1e68(0x36b)](_0x187b52);let _0x48ae3e=Number(_0x187b52||0x0);if(_0x48ae3e<_0x2f1637[_0x3b1e68(0x1f1)]){_0x465601=!![];return;}}}}}_0x465601=_0x12371e[_0x3b1e68(0x272)]>=(_0x46a6f1?.[_0x3b1e68(0x310)]>0x0?_0x46a6f1?.[_0x3b1e68(0x310)]:_0x2f1637[_0x3b1e68(0x3a8)]);if(!_0x465601)throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0x3b1e68(0x2e8)]['BAD_REQUEST']);}async[_0x1faef5(0x38b)](_0x23b5ce,_0x17c812,_0x1237c6,_0x306b0e){const _0x44101b=_0x1faef5,_0x15c946=await this['getUserById'](_0x23b5ce);let _0x2d6d0c=await this[_0x44101b(0x379)](_0x17c812,_0x1237c6);if(_0x15c946[_0x44101b(0x252)]||_0x15c946[_0x44101b(0x299)]){if(_0x17c812[_0x44101b(0x1f1)]<0x0||_0x2d6d0c?.[_0x44101b(0x1f1)]<0x0){await this[_0x44101b(0x344)](_0x15c946,balance_constant_1[_0x44101b(0x335)][_0x44101b(0x38e)],0x0,'模型【'+_0x17c812[_0x44101b(0x32e)]+'】会员永久免费',_0x306b0e);return;}else{if(_0x2d6d0c?.[_0x44101b(0x1f1)]>0x0){const _0x15f0a3=redisKey_constant_1[_0x44101b(0x2fb)]+'-'+_0x23b5ce+'-'+_0x2d6d0c['model']+'-'+_0x2d6d0c[_0x44101b(0x25f)]+'-'+_0x2d6d0c['duration'];let _0x4fe3d0=await this[_0x44101b(0x248)]['get']({'key':_0x15f0a3}),_0xf377e1=Number(_0x4fe3d0||0x0);if(_0xf377e1<_0x2d6d0c['vipFreeNum']){const _0x37f93a=(0x0,date_1[_0x44101b(0x27d)])()[_0x44101b(0x2e3)]('d')[_0x44101b(0x22a)]((0x0,date_1[_0x44101b(0x27d)])(),'s');await this[_0x44101b(0x248)][_0x44101b(0x2cf)]({'key':_0x15f0a3,'val':_0xf377e1+0x1},_0x37f93a);return;}}else{if(_0x17c812[_0x44101b(0x1f1)]>0x0){const _0x1ccbad=redisKey_constant_1['VIP_FREE']+'-'+_0x23b5ce+'-'+_0x17c812['id'];let _0x48176e=await this['redisCacheService'][_0x44101b(0x3cd)]({'key':_0x1ccbad}),_0x4a7842=Number(_0x48176e||0x0);if(_0x4a7842<_0x17c812['vipFreeNum']){const _0x425483=(0x0,date_1[_0x44101b(0x27d)])()[_0x44101b(0x2e3)]('d')['diff']((0x0,date_1['default'])(),'s');await this['redisCacheService'][_0x44101b(0x2cf)]({'key':_0x1ccbad,'val':_0x4a7842+0x1},_0x425483);return;}}}}}await this['changeScore4Other'](_0x15c946,balance_constant_1[_0x44101b(0x335)][_0x44101b(0x38e)],_0x2d6d0c?.[_0x44101b(0x310)]>0x0?-_0x2d6d0c?.[_0x44101b(0x310)]:-_0x17c812[_0x44101b(0x3a8)],_0x44101b(0x28b)+_0x17c812['modelName']+'】会员每日限免',_0x306b0e);}async['refundBalance4Video'](_0x33af99,_0x20f1a0,_0x42d5e7,_0x55e971){const _0x395df7=_0x1faef5;let _0x5a4d2e=await this['getVideoConfig'](_0x20f1a0,_0x42d5e7);const _0x5033a5=await this[_0x395df7(0x1e6)](_0x33af99);if(_0x5033a5[_0x395df7(0x252)]||_0x5033a5[_0x395df7(0x299)]){if(_0x20f1a0[_0x395df7(0x1f1)]<0x0||_0x5a4d2e?.[_0x395df7(0x1f1)]<0x0)return;else{if(_0x5a4d2e?.[_0x395df7(0x1f1)]>0x0){const _0x5befba=redisKey_constant_1[_0x395df7(0x2fb)]+'-'+_0x33af99+'-'+_0x5a4d2e['model']+'-'+_0x5a4d2e[_0x395df7(0x25f)]+'-'+_0x5a4d2e[_0x395df7(0x261)];let _0xbd6ceb=await this[_0x395df7(0x248)]['get']({'key':_0x5befba}),_0x3c2d7b=Number(_0xbd6ceb||0x0);if(_0x3c2d7b>=_0x5a4d2e['vipFreeNum']){const _0x110b5e=(0x0,date_1[_0x395df7(0x27d)])()[_0x395df7(0x2e3)]('d')[_0x395df7(0x22a)]((0x0,date_1[_0x395df7(0x27d)])(),'s');await this[_0x395df7(0x248)][_0x395df7(0x2cf)]({'key':_0x5befba,'val':_0x3c2d7b-0x1},_0x110b5e);return;}}else{if(_0x20f1a0[_0x395df7(0x1f1)]>0x0){const _0x24f3a4=redisKey_constant_1[_0x395df7(0x2fb)]+'-'+_0x33af99+'-'+_0x20f1a0['id'];let _0x4e932d=await this[_0x395df7(0x248)][_0x395df7(0x3cd)]({'key':_0x24f3a4}),_0x126960=Number(_0x4e932d||0x0);if(_0x126960>=_0x20f1a0['vipFreeNum']){const _0x5bead5=(0x0,date_1[_0x395df7(0x27d)])()['endOf']('d')['diff']((0x0,date_1[_0x395df7(0x27d)])(),'s');await this[_0x395df7(0x248)]['set']({'key':_0x24f3a4,'val':_0x126960-0x1},_0x5bead5);return;}}}}}await this[_0x395df7(0x344)](_0x5033a5,balance_constant_1[_0x395df7(0x335)][_0x395df7(0x38e)],_0x5a4d2e?.[_0x395df7(0x310)]>0x0?_0x5a4d2e?.[_0x395df7(0x310)]:_0x20f1a0['deduct'],'模型【'+_0x20f1a0[_0x395df7(0x32e)]+'】失败退还',_0x55e971);}async[_0x1faef5(0x22d)](_0x5e728e,_0x1fd2f7,_0x59fb9b){const _0x4fe242=_0x1faef5,_0x5426bf=await this['getUserById'](_0x5e728e);let _0x5e5fd4;switch(_0x1fd2f7[_0x4fe242(0x38c)]){case model_constant_1[_0x4fe242(0x233)][_0x4fe242(0x2aa)]:_0x5e5fd4=balance_constant_1['EChangeType'][_0x4fe242(0x3c6)];break;case model_constant_1[_0x4fe242(0x233)]['MUSIC']:_0x5e5fd4=balance_constant_1[_0x4fe242(0x335)][_0x4fe242(0x313)];break;case model_constant_1['EModelType'][_0x4fe242(0x238)]:_0x5e5fd4=balance_constant_1[_0x4fe242(0x335)][_0x4fe242(0x27a)];break;case model_constant_1[_0x4fe242(0x233)]['CHAT']:_0x5e5fd4=balance_constant_1[_0x4fe242(0x335)]['Chat'];break;case model_constant_1[_0x4fe242(0x233)]['OTHER']:_0x5e5fd4=balance_constant_1[_0x4fe242(0x335)][_0x4fe242(0x26c)];break;case model_constant_1[_0x4fe242(0x233)]['VIDEO']:_0x5e5fd4=balance_constant_1[_0x4fe242(0x335)][_0x4fe242(0x38e)];break;default:_0x5e5fd4=balance_constant_1['EChangeType']['Chat'];}await this[_0x4fe242(0x344)](_0x5426bf,_0x5e5fd4,_0x1fd2f7[_0x4fe242(0x3a8)],_0x4fe242(0x28b)+_0x1fd2f7[_0x4fe242(0x32e)]+'】调用失败退还',_0x59fb9b);}async[_0x1faef5(0x3dc)](_0x1bad11,_0x3a59f3,_0x316d79,_0x584676,_0x54f7f6,_0x28e838){const _0x1b354a=_0x1faef5,_0x5d975c=await this[_0x1b354a(0x1e6)](_0x1bad11);if(_0x5d975c[_0x1b354a(0x252)]||_0x5d975c[_0x1b354a(0x299)]){if(_0x584676<0x0){await this[_0x1b354a(0x344)](_0x5d975c,balance_constant_1[_0x1b354a(0x335)][_0x1b354a(0x2b4)],0x0,_0x1b354a(0x28b)+_0x316d79+_0x1b354a(0x2b6),_0x28e838);return;}else{if(_0x584676>0x0){const _0x225d4e=redisKey_constant_1['VIP_FREE']+'-'+_0x1bad11+'-'+_0x3a59f3;let _0x301325=await this['redisCacheService'][_0x1b354a(0x3cd)]({'key':_0x225d4e}),_0x35ef61=Number(_0x301325||0x0);if(_0x35ef61<_0x584676){const _0x2174c1=(0x0,date_1[_0x1b354a(0x27d)])()[_0x1b354a(0x2e3)]('d')[_0x1b354a(0x22a)]((0x0,date_1[_0x1b354a(0x27d)])(),'s');await this['redisCacheService'][_0x1b354a(0x2cf)]({'key':_0x225d4e,'val':_0x35ef61+0x1},_0x2174c1),await this[_0x1b354a(0x344)](_0x5d975c,balance_constant_1[_0x1b354a(0x335)]['Coze'],0x0,_0x1b354a(0x28b)+_0x316d79+_0x1b354a(0x3ad),_0x28e838);return;}}}}await this['changeScore4Other'](_0x5d975c,balance_constant_1[_0x1b354a(0x335)][_0x1b354a(0x2b4)],-_0x54f7f6,_0x1b354a(0x28b)+_0x316d79+_0x1b354a(0x2f5),_0x28e838);}async[_0x1faef5(0x37f)](_0x5e0024,_0x3b6b80,_0x1578eb){const _0x58adc5=_0x1faef5;let _0x1cc457='',_0x4e1cd6='',_0x4331b3='',_0x4f7345=_0x3b6b80;const _0x1c949c=_0x3b6b80[_0x58adc5(0x29c)](),_0xb52d95=new RegExp(_0x58adc5(0x2f3)),_0x4590e1=new RegExp(_0x58adc5(0x2d3)),_0x3e4af3=new RegExp('fetch|listbyids|modal|seed');if(_0x5e0024===midjourney_constant_1[_0x58adc5(0x330)][_0x58adc5(0x219)])_0x4e1cd6=_0x58adc5(0x3d8),_0x1cc457=_0x58adc5(0x36e),_0x4331b3=_0x58adc5(0x318);else{if(_0x5e0024===midjourney_constant_1[_0x58adc5(0x330)][_0x58adc5(0x390)])_0x4e1cd6=_0x58adc5(0x304),_0x1cc457='relax_mjDeduction',_0x4331b3=_0x58adc5(0x354);else _0x5e0024===midjourney_constant_1[_0x58adc5(0x330)][_0x58adc5(0x3cf)]&&(_0x4e1cd6=_0x58adc5(0x3b2),_0x1cc457='turbo_mjDeduction',_0x4331b3=_0x58adc5(0x2c6));}if(_0xb52d95['test'](_0x1c949c))_0x1cc457=_0x1cc457+0x1;else{if(_0x4590e1[_0x58adc5(0x210)](_0x1c949c))_0x1cc457=_0x1cc457+0x2;else _0x3e4af3['test'](_0x1c949c)&&(_0x1cc457=_0x1cc457+0x3);}const _0xeda28c=await this[_0x58adc5(0x350)][_0x58adc5(0x23a)](_0x58adc5(0x2b5));let _0x213b81={};if(!_0xeda28c){let _0x3d1d08=await this[_0x58adc5(0x319)][_0x58adc5(0x366)]([_0x1cc457,_0x4331b3]);for(let _0x54f5df in _0x3d1d08){_0x213b81[_0x54f5df]=Number(_0x3d1d08[_0x54f5df])||0x0;}if(_0x1578eb['vipLeavelId']){const _0x57e3ba=await this['globalConfigService'][_0x58adc5(0x334)](_0x1578eb[_0x58adc5(0x287)],'mj');_0x57e3ba&&(_0x213b81[_0x4331b3]=_0x57e3ba[_0x4e1cd6]||0x0);}}else{const _0x39fec7=_0x1578eb[_0x58adc5(0x278)]||'';_0x213b81=_0xeda28c[_0x58adc5(0x3c4)][_0x39fec7],(!_0x213b81||!_0x213b81['fast_vip_free'])&&(_0x213b81=_0xeda28c[_0x58adc5(0x3c4)]['体验会员']);}for(let _0x3446af in midjourney_constant_1['ActionCN']){if(_0x1c949c[_0x58adc5(0x2b3)](midjourney_constant_1[_0x58adc5(0x21a)][_0x3446af][_0x58adc5(0x247)])){_0x4f7345=midjourney_constant_1[_0x58adc5(0x21a)][_0x3446af]['cn'];break;}}return{'price':Number(_0x213b81[_0x1cc457]),'vipFreeNum':Number(_0x213b81[_0x4331b3]),'vipFreeKey':_0x4331b3,'description':_0x4f7345};}async[_0x1faef5(0x2fe)](_0x384e4b,_0x33b0b6){const _0x1c2fd5=_0x1faef5;try{let _0xcb6c93=_0x1c2fd5(0x357);_0x33b0b6['type']==0x5&&(_0xcb6c93=_0x1c2fd5(0x296));const _0x4d3193=_0x33b0b6[_0x1c2fd5(0x2a5)];_0x4d3193[_0x1c2fd5(0x312)]&&(_0xcb6c93=_0x4d3193[_0x1c2fd5(0x312)]);const _0x59d43e=await this[_0x1c2fd5(0x1e6)](_0x384e4b);let _0x1763c1='',_0x5e13a9='',_0x1078c5='',_0x5a2e1a=_0xcb6c93;const _0x194cc9=_0xcb6c93[_0x1c2fd5(0x29c)](),_0x5b07de=new RegExp(_0x1c2fd5(0x2f3)),_0x220e4c=new RegExp('upscale|describe|picread::retry|faceswap|shorten'),_0x5097cf=new RegExp(_0x1c2fd5(0x2f0));if(_0x4d3193[_0x1c2fd5(0x25f)]===midjourney_constant_1[_0x1c2fd5(0x330)][_0x1c2fd5(0x219)])_0x5e13a9=_0x1c2fd5(0x3d8),_0x1763c1=_0x1c2fd5(0x36e),_0x1078c5=_0x1c2fd5(0x318);else{if(_0x4d3193['mode']===midjourney_constant_1['DrawSpeed'][_0x1c2fd5(0x390)])_0x5e13a9=_0x1c2fd5(0x304),_0x1763c1='relax_mjDeduction',_0x1078c5=_0x1c2fd5(0x354);else _0x4d3193[_0x1c2fd5(0x25f)]===midjourney_constant_1[_0x1c2fd5(0x330)][_0x1c2fd5(0x3cf)]&&(_0x5e13a9=_0x1c2fd5(0x3b2),_0x1763c1=_0x1c2fd5(0x243),_0x1078c5=_0x1c2fd5(0x2c6));}if(_0x5b07de[_0x1c2fd5(0x210)](_0x194cc9))_0x1763c1=_0x1763c1+0x1;else{if(_0x220e4c[_0x1c2fd5(0x210)](_0x194cc9))_0x1763c1=_0x1763c1+0x2;else _0x5097cf[_0x1c2fd5(0x210)](_0x194cc9)&&(_0x1763c1=_0x1763c1+0x3);}const _0x211f89=await this[_0x1c2fd5(0x350)][_0x1c2fd5(0x23a)](_0x1c2fd5(0x2b5));let _0x39de5f={};if(!_0x211f89){let _0x4ac49b=await this['globalConfigService'][_0x1c2fd5(0x366)]([_0x1763c1,_0x1078c5]);for(let _0x290872 in _0x4ac49b){_0x39de5f[_0x290872]=Number(_0x4ac49b[_0x290872])||0x0;}if(_0x59d43e?.['vipLeavelId']){const _0x27ab66=await this[_0x1c2fd5(0x319)][_0x1c2fd5(0x334)](_0x59d43e?.[_0x1c2fd5(0x287)],'mj');_0x27ab66&&(_0x39de5f[_0x1078c5]=_0x27ab66[_0x5e13a9]||0x0);}}else{const _0x196d68=_0x59d43e?.[_0x1c2fd5(0x278)]||'';_0x39de5f=_0x211f89['mjLeavelRel'][_0x196d68],(!_0x39de5f||!_0x39de5f[_0x1c2fd5(0x318)])&&(_0x39de5f=_0x211f89[_0x1c2fd5(0x3c4)]['体验会员']);}for(let _0xb197e0 in midjourney_constant_1['ActionCN']){if(_0x194cc9['includes'](midjourney_constant_1[_0x1c2fd5(0x21a)][_0xb197e0][_0x1c2fd5(0x247)])){_0x5a2e1a=midjourney_constant_1['ActionCN'][_0xb197e0]['cn'];break;}}console[_0x1c2fd5(0x36b)](_0x1c2fd5(0x2b9),_0x39de5f[_0x1078c5]);if(_0x384e4b<=0x0)return{'remainCount':0x0,'freeCount':Number(_0x39de5f[_0x1078c5]),'isVipFree':Number(_0x39de5f[_0x1078c5])==-0x1,'useIntegrate':Number(_0x39de5f[_0x1763c1])};const _0x5217e6=redisKey_constant_1[_0x1c2fd5(0x2fb)]+'-'+_0x384e4b+'-'+_0x1078c5;let _0x55d6c5=await this['redisCacheService'][_0x1c2fd5(0x3cd)]({'key':_0x5217e6}),_0x34c067=Number(_0x55d6c5||0x0);return{'remainCount':Number(_0x39de5f[_0x1078c5])-_0x34c067,'freeCount':Number(_0x39de5f[_0x1078c5]),'isVipFree':Number(_0x39de5f[_0x1078c5])==-0x1,'useIntegrate':Number(_0x39de5f[_0x1763c1])};}catch(_0x2f6261){return _0x2f6261;}}async['validateBalance4Coze'](_0x1c6526,_0x3307d0,_0x1b5e65,_0x2c91e8){const _0x18f76d=_0x1faef5;let _0x10d24b=!![];const _0xc300d=await this[_0x18f76d(0x1e6)](_0x1c6526);if(_0xc300d[_0x18f76d(0x252)]||_0xc300d[_0x18f76d(0x299)]){if(_0x1b5e65<0x0)_0x10d24b=!![];else{if(_0x1b5e65>0x0){const _0x8d40ca=redisKey_constant_1[_0x18f76d(0x2fb)]+'-'+_0x1c6526+'-'+_0x3307d0;let _0x59c901=await this[_0x18f76d(0x248)][_0x18f76d(0x3cd)]({'key':_0x8d40ca}),_0x376db8=Number(_0x59c901||0x0);_0x376db8<_0x1b5e65?_0x10d24b=!![]:_0x10d24b=_0xc300d[_0x18f76d(0x272)]>=_0x2c91e8;}else _0x10d24b=_0xc300d[_0x18f76d(0x272)]>=_0x2c91e8;}}else _0x10d24b=_0xc300d[_0x18f76d(0x272)]>=_0x2c91e8;if(!_0x10d24b)throw new common_1[(_0x18f76d(0x26a))](_0x18f76d(0x32c),common_1[_0x18f76d(0x2e8)][_0x18f76d(0x34e)]);}async[_0x1faef5(0x1fd)](_0x1a90f1,_0xec1a34=midjourney_constant_1['DrawSpeed']['relax'],_0x5b79ee){const _0x4dd6df=_0x1faef5;let _0xeb8d7d=!![];const _0x3d4cd9=await this[_0x4dd6df(0x1e6)](_0x1a90f1),_0x2d7e84=await this[_0x4dd6df(0x37f)](_0xec1a34,_0x5b79ee,_0x3d4cd9);console['log'](_0x4dd6df(0x2c0),_0x2d7e84);if(_0x3d4cd9[_0x4dd6df(0x252)]||_0x3d4cd9[_0x4dd6df(0x299)]){if(_0x2d7e84[_0x4dd6df(0x1f1)]<0x0)_0xeb8d7d=!![];else{if(_0x2d7e84[_0x4dd6df(0x1f1)]>0x0){const _0x2f2f78=redisKey_constant_1[_0x4dd6df(0x2fb)]+'-'+_0x1a90f1+'-'+_0x2d7e84[_0x4dd6df(0x263)];let _0x57fa9d=await this[_0x4dd6df(0x248)][_0x4dd6df(0x3cd)]({'key':_0x2f2f78}),_0x110353=Number(_0x57fa9d||0x0);_0x110353<_0x2d7e84['vipFreeNum']?_0xeb8d7d=!![]:_0xeb8d7d=_0x3d4cd9[_0x4dd6df(0x272)]>=_0x2d7e84[_0x4dd6df(0x310)];}else _0xeb8d7d=_0x3d4cd9[_0x4dd6df(0x272)]>=_0x2d7e84[_0x4dd6df(0x310)];}}else _0xeb8d7d=_0x3d4cd9[_0x4dd6df(0x272)]>=_0x2d7e84[_0x4dd6df(0x310)];if(_0xec1a34===midjourney_constant_1[_0x4dd6df(0x330)]['relax']){if(!_0xeb8d7d)throw new common_1[(_0x4dd6df(0x26a))](_0x4dd6df(0x32c),common_1['HttpStatus'][_0x4dd6df(0x34e)]);}else{if(!_0xeb8d7d)return this[_0x4dd6df(0x1fd)](_0x1a90f1,midjourney_constant_1['DrawSpeed'][_0x4dd6df(0x390)],_0x5b79ee);}return _0xec1a34;}async['deductBalance4MJ'](_0x1c70f6,_0x349f89,_0x4ef5e7,_0x105085){const _0x4c5aae=_0x1faef5,_0x1799f9=await this['getUserById'](_0x1c70f6),_0x59a4f2=await this['getMjPrice'](_0x349f89,_0x4ef5e7,_0x1799f9),_0x463cd1=balance_constant_1['EChangeType'][_0x4c5aae(0x249)];if(_0x1799f9[_0x4c5aae(0x252)]||_0x1799f9[_0x4c5aae(0x299)]){if(_0x59a4f2[_0x4c5aae(0x1f1)]<0x0)await this['changeScore4Other'](_0x1799f9,_0x463cd1,0x0,_0x4c5aae(0x1ec)+_0x59a4f2['description']+_0x4c5aae(0x2b6),_0x105085);else{if(_0x59a4f2['vipFreeNum']>0x0){const _0x1dec11=redisKey_constant_1[_0x4c5aae(0x2fb)]+'-'+_0x1c70f6+'-'+_0x59a4f2[_0x4c5aae(0x263)];let _0x3cbd5a=await this[_0x4c5aae(0x248)][_0x4c5aae(0x3cd)]({'key':_0x1dec11}),_0x11fc09=Number(_0x3cbd5a||0x0);if(_0x11fc09<_0x59a4f2[_0x4c5aae(0x1f1)]){const _0x2f6c04=(0x0,date_1[_0x4c5aae(0x27d)])()[_0x4c5aae(0x2e3)]('d')[_0x4c5aae(0x22a)]((0x0,date_1[_0x4c5aae(0x27d)])(),'s');await this[_0x4c5aae(0x248)][_0x4c5aae(0x2cf)]({'key':_0x1dec11,'val':_0x11fc09+0x1},_0x2f6c04),await this[_0x4c5aae(0x344)](_0x1799f9,_0x463cd1,0x0,_0x4c5aae(0x1ec)+_0x59a4f2[_0x4c5aae(0x3db)]+_0x4c5aae(0x3ad),_0x105085);}else await this[_0x4c5aae(0x344)](_0x1799f9,_0x463cd1,-_0x59a4f2[_0x4c5aae(0x310)],_0x4c5aae(0x1ec)+_0x59a4f2[_0x4c5aae(0x3db)]+_0x4c5aae(0x2f5),_0x105085);}else await this[_0x4c5aae(0x344)](_0x1799f9,_0x463cd1,-_0x59a4f2[_0x4c5aae(0x310)],_0x4c5aae(0x1ec)+_0x59a4f2[_0x4c5aae(0x3db)]+_0x4c5aae(0x2f5),_0x105085);}}else await this[_0x4c5aae(0x344)](_0x1799f9,_0x463cd1,-_0x59a4f2['price'],_0x4c5aae(0x1ec)+_0x59a4f2[_0x4c5aae(0x3db)]+_0x4c5aae(0x2f5),_0x105085);}async[_0x1faef5(0x291)](_0x56c7ac,_0x34ed48,_0x4e3ae6,_0x532271){const _0x25bdb1=_0x1faef5,_0x44c2b4=await this[_0x25bdb1(0x1e6)](_0x56c7ac),_0xe3d644=await this[_0x25bdb1(0x37f)](_0x34ed48,_0x4e3ae6,_0x44c2b4),_0x62567=balance_constant_1[_0x25bdb1(0x335)][_0x25bdb1(0x249)];if(_0x44c2b4[_0x25bdb1(0x252)]||_0x44c2b4[_0x25bdb1(0x299)]){if(_0xe3d644[_0x25bdb1(0x1f1)]<0x0)return;else{if(_0xe3d644[_0x25bdb1(0x1f1)]>0x0){const _0x2d748a=redisKey_constant_1[_0x25bdb1(0x2fb)]+'-'+_0x56c7ac+'-'+_0xe3d644['vipFreeKey'];let _0xc349a2=await this[_0x25bdb1(0x248)][_0x25bdb1(0x3cd)]({'key':_0x2d748a}),_0x52419d=Number(_0xc349a2||0x0);if(_0x52419d<_0xe3d644[_0x25bdb1(0x1f1)]){const _0x5b4799=(0x0,date_1['default'])()['endOf']('d')[_0x25bdb1(0x22a)]((0x0,date_1[_0x25bdb1(0x27d)])(),'s');await this['redisCacheService']['set']({'key':_0x2d748a,'val':_0x52419d-0x1},_0x5b4799);return;}}}}await this[_0x25bdb1(0x344)](_0x44c2b4,_0x62567,_0xe3d644[_0x25bdb1(0x310)],_0x25bdb1(0x1ec)+_0xe3d644['description']+_0x25bdb1(0x2f9),_0x532271);}async[_0x1faef5(0x234)](_0x34d4b3,_0x350fe3,_0xafbc07,_0x363926=![]){const _0xcaaa61=_0x1faef5,_0x31311d={'create':{'key':'musicCreate','desc':'音乐创作'},'lyrics':{'key':'musicLyrics','desc':_0xcaaa61(0x3da)},'upload':{'key':'musicUpload','desc':_0xcaaa61(0x3b8)}},_0x9c0dba=_0x31311d[_0xafbc07][_0xcaaa61(0x25a)],_0x372b58=_0x31311d[_0xafbc07][_0xcaaa61(0x345)]+'Price',_0x7c3ce9=_0x31311d[_0xafbc07][_0xcaaa61(0x345)]+_0xcaaa61(0x323),_0x5e951b={},_0x6f7187=await this[_0xcaaa61(0x319)]['getConfigByKeys']([_0x372b58,_0x7c3ce9]);for(let _0x2c5817 in _0x6f7187){_0x5e951b[_0x2c5817]=Number(_0x6f7187[_0x2c5817])||0x0;}const _0x12e424=await this[_0xcaaa61(0x1e6)](_0x34d4b3);if(_0x12e424[_0xcaaa61(0x252)]||_0x12e424['vipExpire']){if(_0x5e951b[_0x7c3ce9]<0x0){!_0x363926&&await this[_0xcaaa61(0x344)](_0x12e424,balance_constant_1[_0xcaaa61(0x335)]['Music'],0x0,_0xcaaa61(0x386)+_0x9c0dba+_0xcaaa61(0x2b6),_0x350fe3);return;}else{if(_0x5e951b[_0x7c3ce9]>0x0){const _0x18684c=redisKey_constant_1['VIP_FREE']+'-'+_0x34d4b3+'-'+_0x7c3ce9;let _0x29c2df=await this['redisCacheService']['get']({'key':_0x18684c}),_0x183e40=Number(_0x29c2df||0x0);if(!_0x363926){if(_0x183e40<_0x5e951b[_0x7c3ce9]){const _0x138294=(0x0,date_1[_0xcaaa61(0x27d)])()[_0xcaaa61(0x2e3)]('d')[_0xcaaa61(0x22a)]((0x0,date_1[_0xcaaa61(0x27d)])(),'s');await this[_0xcaaa61(0x248)][_0xcaaa61(0x2cf)]({'key':_0x18684c,'val':_0x183e40+0x1},_0x138294),await this[_0xcaaa61(0x344)](_0x12e424,balance_constant_1[_0xcaaa61(0x335)][_0xcaaa61(0x313)],0x0,_0xcaaa61(0x386)+_0x9c0dba+_0xcaaa61(0x3ad),_0x350fe3);return;}}else{const _0x47ff8f=(0x0,date_1[_0xcaaa61(0x27d)])()[_0xcaaa61(0x2e3)]('d')[_0xcaaa61(0x22a)]((0x0,date_1[_0xcaaa61(0x27d)])(),'s');await this['redisCacheService'][_0xcaaa61(0x2cf)]({'key':_0x18684c,'val':_0x183e40-0x1},_0x47ff8f);return;}}}}if(!_0x363926&&_0x12e424[_0xcaaa61(0x272)]<_0x5e951b[_0x372b58])throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0xcaaa61(0x2e8)][_0xcaaa61(0x34e)]);if(!_0x363926){await this[_0xcaaa61(0x344)](_0x12e424,balance_constant_1[_0xcaaa61(0x335)]['Music'],-_0x5e951b[_0x372b58],'音乐【'+_0x9c0dba+_0xcaaa61(0x2f5),_0x350fe3);return;}await this[_0xcaaa61(0x344)](_0x12e424,balance_constant_1[_0xcaaa61(0x335)][_0xcaaa61(0x313)],_0x5e951b[_0x372b58],_0xcaaa61(0x386)+_0x9c0dba+_0xcaaa61(0x2df),_0x350fe3);}async['debuctBalance4PPT'](_0x3832f9,_0x3047ad,_0x1eeae5,_0x51aa62=![]){const _0x2ecf0a=_0x1faef5,_0x27bc9f={'structure':{'key':_0x2ecf0a(0x36a),'vlrk':_0x2ecf0a(0x3d8),'desc':_0x2ecf0a(0x3b0)},'cover':{'key':_0x2ecf0a(0x36a),'vlrk':_0x2ecf0a(0x3d8),'desc':_0x2ecf0a(0x20b)},'recover':{'key':'pptOutline','vlrk':_0x2ecf0a(0x3d8),'desc':_0x2ecf0a(0x317)},'create':{'key':_0x2ecf0a(0x2ef),'vlrk':'type2','desc':_0x2ecf0a(0x295)},'thesis':{'key':_0x2ecf0a(0x326),'vlrk':_0x2ecf0a(0x3b2),'desc':'论文生成PPT'},'file':{'key':_0x2ecf0a(0x2ef),'vlrk':'type2','desc':'文件生成PPT'},'theme':{'key':_0x2ecf0a(0x2ef),'vlrk':_0x2ecf0a(0x304),'desc':_0x2ecf0a(0x2d1)},'editor':{'key':_0x2ecf0a(0x246),'vlrk':_0x2ecf0a(0x3d8),'desc':_0x2ecf0a(0x2e9)},'addpage':{'key':_0x2ecf0a(0x2ef),'vlrk':_0x2ecf0a(0x304),'desc':_0x2ecf0a(0x36c)},'addNotes':{'key':'pptCreate','vlrk':'type2','desc':_0x2ecf0a(0x349)}},_0x455ff3=_0x27bc9f[_0x1eeae5][_0x2ecf0a(0x25a)],_0x49742b=_0x27bc9f[_0x1eeae5][_0x2ecf0a(0x345)]+_0x2ecf0a(0x380),_0x4f584c=_0x27bc9f[_0x1eeae5][_0x2ecf0a(0x345)]+_0x2ecf0a(0x323),_0x3ba1f2={},_0x3b8279=await this[_0x2ecf0a(0x319)][_0x2ecf0a(0x366)]([_0x49742b,_0x4f584c]);for(let _0x4638f2 in _0x3b8279){_0x3ba1f2[_0x4638f2]=Number(_0x3b8279[_0x4638f2])||0x0;}const _0x14c24d=await this['getUserById'](_0x3832f9);if(_0x14c24d[_0x2ecf0a(0x287)]){const _0x4ef180=await this[_0x2ecf0a(0x319)][_0x2ecf0a(0x334)](_0x14c24d[_0x2ecf0a(0x287)],model_constant_1['EModelType'][_0x2ecf0a(0x35f)]);_0x4ef180&&(_0x3ba1f2[_0x4f584c]=_0x4ef180[_0x27bc9f[_0x1eeae5][_0x2ecf0a(0x2f6)]]||0x0);}if(_0x14c24d[_0x2ecf0a(0x252)]||_0x14c24d[_0x2ecf0a(0x299)]){if(_0x3ba1f2[_0x4f584c]<0x0){!_0x51aa62&&await this[_0x2ecf0a(0x344)](_0x14c24d,balance_constant_1[_0x2ecf0a(0x335)]['PPT'],0x0,'PPT【'+_0x455ff3+_0x2ecf0a(0x2b6),_0x3047ad);return;}else{if(_0x3ba1f2[_0x4f584c]>0x0){const _0x4c3608=redisKey_constant_1[_0x2ecf0a(0x2fb)]+'-'+_0x3832f9+'-'+_0x4f584c;let _0x1d0547=await this[_0x2ecf0a(0x248)][_0x2ecf0a(0x3cd)]({'key':_0x4c3608}),_0x26ed41=Number(_0x1d0547||0x0);if(!_0x51aa62){if(_0x26ed41<_0x3ba1f2[_0x4f584c]){const _0x4b497e=(0x0,date_1[_0x2ecf0a(0x27d)])()[_0x2ecf0a(0x2e3)]('d')[_0x2ecf0a(0x22a)]((0x0,date_1[_0x2ecf0a(0x27d)])(),'s');await this['redisCacheService'][_0x2ecf0a(0x2cf)]({'key':_0x4c3608,'val':_0x26ed41+0x1},_0x4b497e),await this[_0x2ecf0a(0x344)](_0x14c24d,balance_constant_1[_0x2ecf0a(0x335)]['PPT'],0x0,_0x2ecf0a(0x2ab)+_0x455ff3+_0x2ecf0a(0x3ad),_0x3047ad);return;}}else{const _0x40547e=(0x0,date_1['default'])()[_0x2ecf0a(0x2e3)]('d')['diff']((0x0,date_1[_0x2ecf0a(0x27d)])(),'s');await this[_0x2ecf0a(0x248)][_0x2ecf0a(0x2cf)]({'key':_0x4c3608,'val':_0x26ed41-0x1},_0x40547e);return;}}}}if(!_0x51aa62&&_0x14c24d[_0x2ecf0a(0x272)]<_0x3ba1f2[_0x49742b])throw new common_1[(_0x2ecf0a(0x26a))](_0x2ecf0a(0x32c),common_1['HttpStatus'][_0x2ecf0a(0x34e)]);if(!_0x51aa62){await this[_0x2ecf0a(0x344)](_0x14c24d,balance_constant_1['EChangeType'][_0x2ecf0a(0x35f)],-_0x3ba1f2[_0x49742b],_0x2ecf0a(0x2ab)+_0x455ff3+_0x2ecf0a(0x2f5),_0x3047ad);return;}await this[_0x2ecf0a(0x344)](_0x14c24d,balance_constant_1['EChangeType'][_0x2ecf0a(0x35f)],_0x3ba1f2[_0x49742b],_0x2ecf0a(0x2ab)+_0x455ff3+_0x2ecf0a(0x2df),_0x3047ad);}async[_0x1faef5(0x2b0)](_0x1ddf51,_0x4ebeb0,_0x180c8d){const _0x4d08f7=_0x1faef5,_0x5035ec=await this[_0x4d08f7(0x1e6)](_0x1ddf51);if(_0x5035ec['lifetimeVip']||_0x5035ec[_0x4d08f7(0x299)]){if(_0x4ebeb0[_0x4d08f7(0x1f1)]<0x0)await this[_0x4d08f7(0x344)](_0x5035ec,balance_constant_1[_0x4d08f7(0x335)][_0x4d08f7(0x37b)],0x0,_0x4d08f7(0x270)+_0x4ebeb0[_0x4d08f7(0x32e)]+_0x4d08f7(0x2b6),_0x180c8d);else{if(_0x4ebeb0[_0x4d08f7(0x1f1)]>0x0){const _0x5c6752=redisKey_constant_1[_0x4d08f7(0x2fb)]+'-'+_0x1ddf51+'-'+_0x4ebeb0['id'];let _0x3fc63d=await this[_0x4d08f7(0x248)]['get']({'key':_0x5c6752}),_0x2c770=Number(_0x3fc63d||0x0);if(_0x2c770<_0x4ebeb0['vipFreeNum']){const _0xa544bd=(0x0,date_1[_0x4d08f7(0x27d)])()[_0x4d08f7(0x2e3)]('d')[_0x4d08f7(0x22a)]((0x0,date_1[_0x4d08f7(0x27d)])(),'s');await this[_0x4d08f7(0x248)][_0x4d08f7(0x2cf)]({'key':_0x5c6752,'val':_0x2c770+0x1},_0xa544bd),await this[_0x4d08f7(0x344)](_0x5035ec,balance_constant_1[_0x4d08f7(0x335)][_0x4d08f7(0x37b)],0x0,_0x4d08f7(0x270)+_0x4ebeb0[_0x4d08f7(0x32e)]+_0x4d08f7(0x3ad),_0x180c8d);}else{if(_0x5035ec[_0x4d08f7(0x272)]<_0x4ebeb0[_0x4d08f7(0x3a8)])throw new common_1[(_0x4d08f7(0x26a))](_0x4d08f7(0x32c),common_1['HttpStatus'][_0x4d08f7(0x34e)]);await this['changeScore4Other'](_0x5035ec,balance_constant_1[_0x4d08f7(0x335)][_0x4d08f7(0x37b)],-_0x4ebeb0['deduct'],_0x4d08f7(0x270)+_0x4ebeb0['modelName']+'】使用扣减',_0x180c8d);}}else{if(_0x5035ec[_0x4d08f7(0x272)]<_0x4ebeb0[_0x4d08f7(0x3a8)])throw new common_1[(_0x4d08f7(0x26a))]('用户余额不足，请充值',common_1[_0x4d08f7(0x2e8)][_0x4d08f7(0x34e)]);await this['changeScore4Other'](_0x5035ec,balance_constant_1[_0x4d08f7(0x335)][_0x4d08f7(0x37b)],-_0x4ebeb0[_0x4d08f7(0x3a8)],_0x4d08f7(0x270)+_0x4ebeb0[_0x4d08f7(0x32e)]+'】使用扣减',_0x180c8d);}}}else{if(_0x5035ec[_0x4d08f7(0x272)]<_0x4ebeb0[_0x4d08f7(0x3a8)])throw new common_1['HttpException'](_0x4d08f7(0x32c),common_1['HttpStatus'][_0x4d08f7(0x34e)]);await this[_0x4d08f7(0x344)](_0x5035ec,balance_constant_1[_0x4d08f7(0x335)]['WORKFLOW'],-_0x4ebeb0[_0x4d08f7(0x3a8)],'小工具【'+_0x4ebeb0['modelName']+_0x4d08f7(0x2f5),_0x180c8d);}}async[_0x1faef5(0x2db)](_0x3004d5,_0x54d493){const _0x23ba19=_0x1faef5,_0x5c2d8f=store_1[_0x23ba19(0x3bc)][_0x23ba19(0x396)],_0x15c9a7=await this[_0x23ba19(0x1e6)](_0x3004d5),_0x41de7e=balance_constant_1['EChangeType']['SD'];if(_0x15c9a7[_0x23ba19(0x252)]||_0x15c9a7[_0x23ba19(0x299)]){if(store_1[_0x23ba19(0x3bc)]['czVipFree']<0x0)await this['changeScore4Other'](_0x15c9a7,_0x41de7e,0x0,_0x23ba19(0x2d6),_0x54d493);else{if(store_1['CZConfig']['czVipFree']>0x0){const _0x4cab90=redisKey_constant_1['VIP_FREE']+'-'+_0x3004d5+'-SD';let _0x2c5e43=await this[_0x23ba19(0x248)][_0x23ba19(0x3cd)]({'key':_0x4cab90}),_0x59f1a8=Number(_0x2c5e43||0x0);if(_0x59f1a8<store_1[_0x23ba19(0x3bc)][_0x23ba19(0x288)]){const _0x1fe422=(0x0,date_1[_0x23ba19(0x27d)])()[_0x23ba19(0x2e3)]('d')[_0x23ba19(0x22a)]((0x0,date_1[_0x23ba19(0x27d)])(),'s');await this[_0x23ba19(0x248)][_0x23ba19(0x2cf)]({'key':_0x4cab90,'val':_0x59f1a8+0x1},_0x1fe422),await this[_0x23ba19(0x344)](_0x15c9a7,_0x41de7e,0x0,_0x23ba19(0x306)+_0x5c2d8f+'】会员每日限免',_0x54d493);}else await this[_0x23ba19(0x344)](_0x15c9a7,_0x41de7e,-_0x5c2d8f,'SD绘画【'+_0x5c2d8f+_0x23ba19(0x2f5),_0x54d493);}else await this[_0x23ba19(0x344)](_0x15c9a7,_0x41de7e,-_0x5c2d8f,_0x23ba19(0x306)+_0x5c2d8f+_0x23ba19(0x2f5),_0x54d493);}}else await this[_0x23ba19(0x344)](_0x15c9a7,_0x41de7e,-_0x5c2d8f,'SD绘画【'+_0x5c2d8f+_0x23ba19(0x2f5),_0x54d493);}async['getModelVipFree'](_0x401a7a,_0x17dfd8){const _0x57f111=_0x1faef5,_0x2571ff=redisKey_constant_1[_0x57f111(0x2fb)]+'-'+_0x401a7a+'-'+_0x17dfd8['id'];let _0xd675ba=await this['redisCacheService'][_0x57f111(0x3cd)]({'key':_0x2571ff}),_0x22210f=Number(_0xd675ba||0x0);return _0x17dfd8[_0x57f111(0x1f1)]-_0x22210f;}async[_0x1faef5(0x379)](_0x566873,_0x53ddf9){const _0x521b6b=_0x1faef5;let _0x1b0eba;const _0xb6a9d5=await this['configService'][_0x521b6b(0x23a)](_0x521b6b(0x235));if(_0xb6a9d5){const _0x1721d8=_0xb6a9d5['config'][_0x566873[_0x521b6b(0x2ea)][_0x521b6b(0x258)]()];let _0x32c878=_0x53ddf9[_0x521b6b(0x25f)],_0x55385f=_0x53ddf9[_0x521b6b(0x261)];_0x1b0eba=_0x1721d8[_0x521b6b(0x3c1)](_0x5576ad=>_0x5576ad[_0x521b6b(0x257)]==_0x53ddf9[_0x521b6b(0x257)]&&_0x5576ad[_0x521b6b(0x25f)]==_0x32c878&&_0x5576ad[_0x521b6b(0x261)]==_0x55385f);}return _0x1b0eba;}async[_0x1faef5(0x31b)](_0x4bbf23,_0x19b8c3,_0xc4203e){const _0x25a274=_0x1faef5;let _0x3ef60b=await this[_0x25a274(0x379)](_0x19b8c3,_0xc4203e);if(!_0x3ef60b)return await this['getModelVipFree'](_0x4bbf23,_0x19b8c3);const _0x59ada9=redisKey_constant_1['VIP_FREE']+'-'+_0x4bbf23+'-'+_0x3ef60b['model']+'-'+_0x3ef60b[_0x25a274(0x25f)]+'-'+_0x3ef60b['duration'];let _0x26bbce=await this[_0x25a274(0x248)][_0x25a274(0x3cd)]({'key':_0x59ada9}),_0x5a61cf=Number(_0x26bbce||0x0);return _0x3ef60b[_0x25a274(0x1f1)]-_0x5a61cf;}async[_0x1faef5(0x2c5)](_0x354ecf,_0x521552){const _0x51888c=_0x1faef5,_0x1840b6=redisKey_constant_1[_0x51888c(0x2fb)]+'-'+_0x354ecf+'-'+_0x521552['model'];let _0x10d7c4=await this[_0x51888c(0x248)][_0x51888c(0x3cd)]({'key':_0x1840b6}),_0x18b99c=Number(_0x10d7c4||0x0);return _0x521552['vipFreeNum']-_0x18b99c;}async[_0x1faef5(0x28d)](_0x5d8adf,_0x26917f,_0x2d5647){const _0xa60468=_0x1faef5,_0x4ecda4=redisKey_constant_1[_0xa60468(0x2fb)]+'-'+_0x5d8adf+'-'+_0x26917f;let _0x5c5d07=await this['redisCacheService'][_0xa60468(0x3cd)]({'key':_0x4ecda4}),_0x1730d3=Number(_0x5c5d07||0x0);return _0x2d5647-_0x1730d3;}async[_0x1faef5(0x2f7)](_0x561f5e){const _0x9bdc63=_0x1faef5,_0x22c8eb=redisKey_constant_1['VIP_FREE']+'-'+_0x561f5e+_0x9bdc63(0x35a);let _0x16c535=await this[_0x9bdc63(0x248)]['get']({'key':_0x22c8eb}),_0x191673=Number(_0x16c535||0x0);return store_1[_0x9bdc63(0x300)][_0x9bdc63(0x24c)]-_0x191673;}async['getKeyFree'](_0x419b4b,_0x4921b2,_0x5e7a99){let _0x36112a=await this['redisCacheService']['get']({'key':_0x4921b2}),_0x390e7=Number(_0x36112a||0x0);return _0x5e7a99-_0x390e7;}async[_0x1faef5(0x1fa)](_0x181ef2){const _0x55bd4b=_0x1faef5;let _0x4cdb68=!![];const _0x20e472=await this[_0x55bd4b(0x1e6)](_0x181ef2);if(_0x20e472[_0x55bd4b(0x252)]||_0x20e472[_0x55bd4b(0x299)]){if(store_1['LinkFoxConfig'][_0x55bd4b(0x24c)]<0x0)_0x4cdb68=!![];else{if(store_1[_0x55bd4b(0x300)][_0x55bd4b(0x24c)]>0x0){const _0x3701af=await this[_0x55bd4b(0x2f7)](_0x181ef2);_0x3701af>0x0?_0x4cdb68=!![]:_0x4cdb68=_0x20e472[_0x55bd4b(0x272)]>=store_1[_0x55bd4b(0x300)][_0x55bd4b(0x361)];}else _0x4cdb68=_0x20e472[_0x55bd4b(0x272)]>=store_1[_0x55bd4b(0x300)][_0x55bd4b(0x361)];}}else _0x4cdb68=_0x20e472[_0x55bd4b(0x272)]>=store_1[_0x55bd4b(0x300)]['lfPrice'];if(!_0x4cdb68)throw new common_1[(_0x55bd4b(0x26a))](_0x55bd4b(0x32c),common_1[_0x55bd4b(0x2e8)][_0x55bd4b(0x34e)]);}async[_0x1faef5(0x381)](_0x5a8889,_0x353b86){const _0x37f564=_0x1faef5,_0x2d3f8f=store_1[_0x37f564(0x300)]['lfPrice'],_0x5bb91e=await this[_0x37f564(0x1e6)](_0x5a8889),_0x3e1844=balance_constant_1[_0x37f564(0x335)][_0x37f564(0x29d)];if(_0x5bb91e[_0x37f564(0x252)]||_0x5bb91e['vipExpire']){if(store_1[_0x37f564(0x300)][_0x37f564(0x24c)]<0x0)await this['changeScore4Other'](_0x5bb91e,_0x3e1844,0x0,_0x37f564(0x367),_0x353b86);else{if(store_1[_0x37f564(0x300)]['lfVipFree']>0x0){const _0x2462f6=redisKey_constant_1[_0x37f564(0x2fb)]+'-'+_0x5a8889+_0x37f564(0x35a);let _0x37f1f4=await this['redisCacheService'][_0x37f564(0x3cd)]({'key':_0x2462f6}),_0x23ee7c=Number(_0x37f1f4||0x0);if(_0x23ee7c<store_1[_0x37f564(0x300)][_0x37f564(0x24c)]){const _0x2c3e43=(0x0,date_1['default'])()[_0x37f564(0x2e3)]('d')[_0x37f564(0x22a)]((0x0,date_1[_0x37f564(0x27d)])(),'s');await this[_0x37f564(0x248)]['set']({'key':_0x2462f6,'val':_0x23ee7c+0x1},_0x2c3e43),await this[_0x37f564(0x344)](_0x5bb91e,_0x3e1844,0x0,_0x37f564(0x1eb)+_0x2d3f8f+_0x37f564(0x3ad),_0x353b86);}else await this[_0x37f564(0x344)](_0x5bb91e,_0x3e1844,-_0x2d3f8f,_0x37f564(0x1e9)+_0x2d3f8f+'】使用扣减',_0x353b86);}else await this[_0x37f564(0x344)](_0x5bb91e,_0x3e1844,-_0x2d3f8f,_0x37f564(0x1e9)+_0x2d3f8f+_0x37f564(0x2f5),_0x353b86);}}else await this[_0x37f564(0x344)](_0x5bb91e,_0x3e1844,-_0x2d3f8f,_0x37f564(0x1e9)+_0x2d3f8f+_0x37f564(0x2f5),_0x353b86);}async[_0x1faef5(0x207)](){const _0x1b17ff=_0x1faef5,_0x8be0b9=await this[_0x1b17ff(0x39c)]['find']({'where':{'vipExpire':(0x0,typeorm_2['Between'])((0x0,date_1[_0x1b17ff(0x27d)])()['startOf']('d')['toDate'](),(0x0,date_1[_0x1b17ff(0x27d)])()[_0x1b17ff(0x2e3)]('d')[_0x1b17ff(0x394)]())}});if(_0x8be0b9[_0x1b17ff(0x1ef)])for(let _0xca9e34=0x0;_0xca9e34<_0x8be0b9['length'];_0xca9e34++){const _0x21f64a=_0x8be0b9[_0xca9e34];await this[_0x1b17ff(0x248)][_0x1b17ff(0x2cf)]({'key':redisKey_constant_1[_0x1b17ff(0x3c8)]+_0x21f64a['id'],'val':''},(0x0,date_1[_0x1b17ff(0x27d)])()[_0x1b17ff(0x2e3)]('d')[_0x1b17ff(0x22a)]((0x0,date_1['default'])(),'s'));}const _0x1c2fd4=await this[_0x1b17ff(0x39c)][_0x1b17ff(0x3c1)]({'where':{'vipExpire':(0x0,typeorm_2[_0x1b17ff(0x3c2)])((0x0,date_1['default'])()['toDate']())}});if(_0x1c2fd4[_0x1b17ff(0x1ef)]){const _0xd0a0c2=_0x1c2fd4[_0x1b17ff(0x1f9)](_0x3a0a33=>_0x3a0a33['id']);await this[_0x1b17ff(0x39c)][_0x1b17ff(0x221)]({'id':(0x0,typeorm_2['In'])(_0xd0a0c2)},{'vipExpire':null});}}async[_0x1faef5(0x374)](_0x512b29,_0xfb3b9,_0x2c2f1f){const _0x32225b=_0x1faef5,_0x1d3006=(0x0,utils_1[_0x32225b(0x2e6)])(this[_0x32225b(0x2a9)]),_0x42c9c1=await this['userCollectEntity'][_0x32225b(0x203)]({'where':{'userId':_0x512b29,'relId':_0xfb3b9,'relType':_0x2c2f1f,'saasId':_0x1d3006}});if(_0x42c9c1)throw new common_1[(_0x32225b(0x26a))](_0x32225b(0x376),common_1[_0x32225b(0x2e8)][_0x32225b(0x34e)]);else await this[_0x32225b(0x2ac)][_0x32225b(0x3d6)]({'userId':_0x512b29,'relId':_0xfb3b9,'relType':_0x2c2f1f,'sassId':_0x1d3006});}async[_0x1faef5(0x3bd)](_0x40879e,_0x42d7e6,_0x29a6a2){const _0x3b12f1=_0x1faef5,_0x324e6d=(0x0,utils_1[_0x3b12f1(0x2e6)])(this[_0x3b12f1(0x2a9)]),_0x429723=await this[_0x3b12f1(0x2ac)][_0x3b12f1(0x203)]({'where':{'userId':_0x40879e,'relId':_0x42d7e6,'relType':_0x29a6a2,'saasId':_0x324e6d}});if(!_0x429723)throw new common_1['HttpException'](_0x3b12f1(0x35e),common_1[_0x3b12f1(0x2e8)][_0x3b12f1(0x34e)]);else await this['userCollectEntity'][_0x3b12f1(0x2dc)]({'id':_0x429723['id']});}async['uncollectByRelIds'](_0x3e3515,_0x19314f){const _0x79707d=_0x1faef5,_0x24e056=(0x0,utils_1[_0x79707d(0x2e6)])(this[_0x79707d(0x2a9)]);_0x3e3515[_0x79707d(0x1f7)](_0x135cf5=>{const _0x5226b9=_0x79707d,_0x23f9d7=Number(_0x135cf5);this[_0x5226b9(0x2ac)][_0x5226b9(0x2dc)]({'relId':_0x23f9d7,'relType':_0x19314f,'saasId':_0x24e056});});}async[_0x1faef5(0x21c)](_0x28ad28,_0x58b922,_0x31658c,_0x3641b8){const _0x5eb531=_0x1faef5,_0x1668c3=(0x0,utils_1['getReqSaasId'])(this[_0x5eb531(0x2a9)]),[_0x18a370,_0x41d59c]=await this['userCollectEntity']['findAndCount']({'where':{'userId':_0x31658c,'relType':_0x3641b8,'saasId':_0x1668c3},'take':_0x58b922,'skip':(_0x28ad28-0x1)*_0x58b922,'order':{'createdAt':_0x5eb531(0x227)}});return{'rows':_0x18a370,'count':_0x41d59c};}async[_0x1faef5(0x2f1)](_0x51c4dc,_0x32f202,_0x4407d4){const _0x33a64a=_0x1faef5,_0x5582da=(0x0,utils_1[_0x33a64a(0x2e6)])(this['clsService']);return await this['userCollectEntity'][_0x33a64a(0x3c1)]({'where':{'userId':_0x32f202,'relType':_0x4407d4,'saasId':_0x5582da,'relId':(0x0,typeorm_2['In'])(_0x51c4dc)}});}async[_0x1faef5(0x377)](_0x9ce9c8,_0x788f4c){const _0x43387f=_0x1faef5,_0x668411=(0x0,utils_1[_0x43387f(0x2e6)])(this[_0x43387f(0x2a9)]);return await this[_0x43387f(0x2ac)][_0x43387f(0x3c1)]({'where':{'relType':_0x788f4c,'saasId':_0x668411,'relId':(0x0,typeorm_2['In'])(_0x9ce9c8)}});}async[_0x1faef5(0x2d2)](_0x50cc5c,_0x15fd2a,_0x279e24=collectType_constant_1[_0x1faef5(0x2a3)][_0x1faef5(0x35f)]){const _0x1ae908=_0x1faef5;let _0x5b9f4b=Object[_0x1ae908(0x337)](_0x50cc5c),_0x4bc181=[];return _0x15fd2a&&(_0x4bc181=await this['collectListForUserID'](_0x50cc5c[_0x1ae908(0x1f9)](_0x49ead7=>_0x49ead7['id']),_0x15fd2a,_0x279e24)),_0x5b9f4b[_0x1ae908(0x1f7)](_0xc6aa32=>{const _0x37fc0c=_0x1ae908;_0x4bc181['find'](_0x16921b=>_0x16921b['relId']==_0xc6aa32['id'])?_0xc6aa32[_0x37fc0c(0x3d0)]=!![]:_0xc6aa32[_0x37fc0c(0x3d0)]=![];}),_0x5b9f4b;}async['mergeCollectData'](_0x52c199,_0x3a8d8b,_0x5649c1=collectType_constant_1[_0x1faef5(0x2a3)][_0x1faef5(0x35f)]){const _0x1a727c=_0x1faef5;return this['mergeCollectDataForUserId'](_0x52c199,_0x3a8d8b[_0x1a727c(0x2bf)]?.['id'],_0x5649c1);}async[_0x1faef5(0x33e)](_0x1ae5ae,_0x39c0e5=collectType_constant_1[_0x1faef5(0x2a3)][_0x1faef5(0x35f)]){const _0x42fc99=_0x1faef5;let _0x5a0399=Object['assign'](_0x1ae5ae),_0x9860a5=[];return _0x9860a5=await this['collectList'](_0x1ae5ae[_0x42fc99(0x1f9)](_0x49d71b=>_0x49d71b['id']),_0x39c0e5),_0x5a0399[_0x42fc99(0x1f7)](_0x26d52e=>{const _0x1834ee=_0x42fc99;_0x26d52e[_0x1834ee(0x214)]=_0x9860a5[_0x1834ee(0x3d4)](_0x1d0648=>_0x1d0648['relId']==_0x26d52e['id'])['length'];}),_0x5a0399;}[_0x1faef5(0x239)](_0x159c56){const _0x429803=_0x1faef5;let _0xbef0be=null;const _0x36e81f=_0x159c56[_0x429803(0x2c9)][_0x429803(0x20f)];if(_0x36e81f&&_0x36e81f['startsWith'](_0x429803(0x2a1))){const _0x497705=_0x36e81f['substring'](0x7);if(_0x497705)try{_0xbef0be=jwt['verify'](_0x497705,process[_0x429803(0x2ec)][_0x429803(0x3a9)]);}catch(_0x546fc8){console[_0x429803(0x36b)](_0x429803(0x20a),_0x159c56);}}return _0xbef0be;}};UserService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x1faef5(0x36f)])('REDIS_SUBSCRIBER')),__param(0x1,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__param(0x2,(0x0,typeorm_1[_0x1faef5(0x2f2)])(saas_entity_1[_0x1faef5(0x31f)])),__param(0x3,(0x0,typeorm_1[_0x1faef5(0x2f2)])(role_entity_1[_0x1faef5(0x30f)])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(user_init_vip_entity_1['UserInitVipEntity'])),__param(0x5,(0x0,typeorm_1[_0x1faef5(0x2f2)])(userFavorite_entity_1[_0x1faef5(0x336)])),__param(0x6,(0x0,typeorm_1['InjectRepository'])(userCollect_entity_1[_0x1faef5(0x2a2)])),__metadata('design:paramtypes',[Object,typeorm_2[_0x1faef5(0x391)],typeorm_2[_0x1faef5(0x391)],typeorm_2[_0x1faef5(0x391)],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x1faef5(0x391)],nestjs_cls_1[_0x1faef5(0x32b)],mailer_1[_0x1faef5(0x1ea)],redisCache_service_1[_0x1faef5(0x3c3)],userBalance_service_1[_0x1faef5(0x2bb)],globalConfig_service_1[_0x1faef5(0x228)],verification_service_1[_0x1faef5(0x2d9)],cm_service_1[_0x1faef5(0x2e0)],typeorm_2[_0x1faef5(0x2d5)]])],UserService),exports['UserService']=UserService;