'use strict';const _0xb33111=_0x3c62;function _0x1375(){const _0xccc2ad=['\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','当前绑定用户不存在！','diff','../../common/constants/model.constant','registerSendStatus','管理员赠送','Connection','__esModule','生成邀请码失败，请重新试一次吧！','超级管理员','小工具【','\x20AND\x20u.userId\x20=\x20','updateInfo','%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%','ListSaasByIds','hideString','saasSave','deductBalance4WorkFlow','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','】调用失败退还','Draw','password','queryByPage','更换模板','getEntity','inviterPhone','获取邀请记录失败！','邀请新用户注册奖励','pptOutline','OTHER','pptThesis','PPT【','default','insertAccountVipLog','VerificationEnum','VipFree','vipDays','countByInviteCode','./role.entity','手机号格式错误！','save','mj-','giftVip','changeScore4Other','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','getLfVipFree','getModelVipFree','genInviteCode','clear','修改用户状态成功！','desc','userCollectEntity','client','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','disabled','Not','未激活用户不可手动变更状态！','get','VIDEO','genUserName','File','GPTS','name','账号、手机、邮箱必须存在一个','】会员永久免费','userBalanceService','模型【','InjectRepository','function','endOf','1903693oYMvCF','getReqSaasId','./saas.entity','add','map','\x20AND\x20(username\x20LIKE\x20\x27%','isVerifyEmail','该微信已绑定其他账号！','verificationService','relax_mjDeduction','Between','access','UNAUTHORIZED','lastLoginIp','globalConfigService','Registration','inviteRewardVip','4847780TUhnme','maskEmail','修改用户信息失败！','\x20AND\x20role\x20=\x20\x27','debuctBalance4PPT','queryAll','vipFreeNum','update','增加PPT单页','音乐创作','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','score','replace','redisCacheService','Invited','TTS','username','恭喜您绑定成功、后续可直接扫码登录了！','getMjPrice','\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','set','avatar','deduct','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','../../common/store','onModuleInit','changeScore4registe','favoriteListByTypeAndIds','BadRequest','openId','violationCount','saasId','description','受邀请注册赠送','updateViolationCount','deductBalance4MJ','HttpStatus','@nestjs-modules/mailer','AdminGift','CZConfig','log','WORKFLOW','非法访问','savaLoginIp','resetUserPass','czVipFree','EChangeType','nestjs-cls','sendMail','../../common/constants/midjourney.constant','GlobalConfigService','role','vipFreeKey','\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%','UserFavoriteEntity','邮箱已被使用！','%\x27\x20)','generateRandomString','fast','论文生成PPT','collectList','@nestjs/common','design:paramtypes','无效的邀请码！','../redisCache/redisCache.service','musicLyrics','refundBalance4MJ','%\x27\x20OR\x20email\x20LIKE\x20\x27%','标题大纲任务','\x20AND\x20saasId\x20=\x20','inviteRewards','exists','visitor','queryUserInfoByIds','ERole','validateBalance4Chat','queryOneUserInfo','Injectable','\x20AND\x20username\x20LIKE\x20\x27%','env','invitedRewardVip','没有变更，无需更改！','用户名已存在！','的账号激活','pptEditor','Chat','userInitVipEntity','】失败退还','relateType','register','AGENT','getOne','domain','当前密码错误！','verifyUserPassword','../../common/constants/verification.constant','24Slwvhk','PENDING','count','delete','getMiniOpenIdByUserId','Inject','relId','updateUserPassword','assign','maskIpAddress','lfVipFree','2812530erQnuE','czProxyPrice','isDefined','includes','GOMAXAI_HOST','../../common/constants/Role.constant','./../globalConfig/globalConfig.service','\x20AND\x20u.createdAt\x20<=\x20\x27','isSuper','createUser','day','defineProperty','】会员每日限免','LinkFoxConfig','invitedRewards','绑定微信失败、请联系管理员！','当前用户信息失效、请重新登录！','getConfigByKeys','getUserByInviteCode','relateId','DESC','../../common/utils/date','1\x20=\x201','LessThanOrEqual','roleDel','refundBalance4Chat','user','ActionCN','userEntity','\x20OFFSET\x20','affected','../../common/constants/balance.constant','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','subscriber','SUPER','用户名已被使用！','lfPrice','vipExpire','\x09mj123456admin\x0a','\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','VIEWER','isEmail','isCollect','./user_init_vip.entity','typeorm','collect','372965yywYMI','relax_vip_free','\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','push','%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','上传音乐','24OPfBeE','./entity/userCollect.entity','floor','音乐【','updateStatus','connection','roleEntity','code','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','lifetimeVip','num','object','用户名已存在、请更换用户名！','zh-CN','getClientIp','message','Music','EModelType','updateVipExpire','findOne','%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%','isPlatform','模板生成PPT','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','findAndCount','validateBalance4MJ','turbo_vip_free','toDate','metadata','UserInitVipEntity','\x20AND\x20`status`\x20=\x20','userFavoriteEntity','代理商','角色信息不存在！','-SD','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27','mailerService','-LinkFox','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','userDefautlAvatar','saasEntity','test','createBatch','getVipLeavelRelById','queryUserInfoById','Tool','__keyevent@0__:expired','Like','days','用户不存在！','您已经收藏过该内容','重置密码失败！','isInteger','forEach','modelType','saasPage','UserEntity','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','invitePage','type3','queryUserByUsername','verifyUserCredentials','has','VIP_FREE','HttpException','type1','getUserById','UserBalanceService','insertAccountLog','yes','getSaasById','relax','不可将用户置为未激活状态！','validateBalanceLinxFox','phone','../userBalance/userBalance.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','查询用户不存在！','密码重置为[','axios','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','SD绘画【','size','turbo_mjDeduction','delUser','uncollect','saasUpdate','getKeyFree','UserService\x20Init','registerBaseUrl','cloneDeep','email','deductBalance4Chat','decorate','用户余额不足，请充值','BAD_REQUEST','saasMap','userInitVip','bindWx','__metadata','vipLeavelId','ACTIVE','pptCreate','turbo','modelName','MailerService','MjDraw','queryOne','refundBalance4Video','userCount','Repository','status','DrawSpeed','@nestjs/typeorm','DRAW','create','您还未收藏过该内容','initSaasMap','手机号已被使用！','LinxFox会员永久免费','MoreThan','当前角色编码不可用，请使用其他角色编码','文件生成PPT','%\x27\x20OR\x20nickname\x20LIKE\x20\x27%','createVerification','registerVerifyEmailDesc','MJ绘画【','用户名或者邮箱已被注册！','userId','saasName','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','LinkFox','../../common/utils','action','../../common/constants/redisKey.constant','saasId不能为空！','updateUserStatus','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)','13012AcJjtM','getInviteRecord','getUserOpenId','1115487nGOkAY','APP','BLACKLISTED','InvitationReward','inviterEmail','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','compareSync','registerRewards','checkUserStatus','findByIds','SD绘画会员永久免费','vlrk','】使用扣减','%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%','../../common/constants/collectType.constant','vipLeavelName','valueOf','PPT','updateVipExpire2Redis','VIP_EXPIRE','账号注册时密码不能为空！','genUserNames','increment','HttpStatusCode','当前用户不存在！','27ZNDJaM','ids','length','SaasEntity','1TAmacH','roleSave','nickname','transaction','pSubscribe','destroyAccount','】使用失败退费','\x20AND\x20u.saasId\x20=\x20','前台用户','REDIS_SUBSCRIBER','error:\x20','registerVerifyExpir','当前账户不存在！','UserStatusEnum','collectPage','qureyUserInfoByInviteCode','key','type2','price','rolePage','Price','VerificationService','AND\x20email\x20LIKE\x20\x27%','../../common/constants/user.constant','toLowerCase','fetch|listbyids|modal|seed','clsService','saasDel','registerVerifyEmailFrom','find','UserService','registerVerifyEmailTitle','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','musicCreate','693466FkzlNb','mergeCollectData','hashSync','mj123456admin','注册赠送','LinxFox【','query','then'];_0x1375=function(){return _0xccc2ad;};return _0x1375();}(function(_0x2ecab0,_0x2dd6b4){const _0x4f7169=_0x3c62,_0x504dcd=_0x2ecab0();while(!![]){try{const _0x348154=-parseInt(_0x4f7169(0x27b))/0x1*(parseInt(_0x4f7169(0x29e))/0x2)+parseInt(_0x4f7169(0x277))/0x3*(-parseInt(_0x4f7169(0x25b))/0x4)+parseInt(_0x4f7169(0x1c8))/0x5*(-parseInt(_0x4f7169(0x1ce))/0x6)+parseInt(_0x4f7169(0x19a))/0x7+-parseInt(_0x4f7169(0x35d))/0x8*(-parseInt(_0x4f7169(0x25e))/0x9)+parseInt(_0x4f7169(0x2fd))/0xa+-parseInt(_0x4f7169(0x2ec))/0xb;if(_0x348154===_0x2dd6b4)break;else _0x504dcd['push'](_0x504dcd['shift']());}catch(_0x146e41){_0x504dcd['push'](_0x504dcd['shift']());}}}(_0x1375,0x64548));var __decorate=this&&this['__decorate']||function(_0x53e641,_0x2deb5c,_0x11f3d8,_0x40bbd5){const _0x2837af=_0x3c62;var _0x27851c=arguments[_0x2837af(0x279)],_0x2da1c7=_0x27851c<0x3?_0x2deb5c:_0x40bbd5===null?_0x40bbd5=Object['getOwnPropertyDescriptor'](_0x2deb5c,_0x11f3d8):_0x40bbd5,_0x2f5bfa;if(typeof Reflect===_0x2837af(0x1d9)&&typeof Reflect[_0x2837af(0x22d)]==='function')_0x2da1c7=Reflect[_0x2837af(0x22d)](_0x53e641,_0x2deb5c,_0x11f3d8,_0x40bbd5);else{for(var _0x46c9d4=_0x53e641[_0x2837af(0x279)]-0x1;_0x46c9d4>=0x0;_0x46c9d4--)if(_0x2f5bfa=_0x53e641[_0x46c9d4])_0x2da1c7=(_0x27851c<0x3?_0x2f5bfa(_0x2da1c7):_0x27851c>0x3?_0x2f5bfa(_0x2deb5c,_0x11f3d8,_0x2da1c7):_0x2f5bfa(_0x2deb5c,_0x11f3d8))||_0x2da1c7;}return _0x27851c>0x3&&_0x2da1c7&&Object[_0x2837af(0x1a5)](_0x2deb5c,_0x11f3d8,_0x2da1c7),_0x2da1c7;},__metadata=this&&this[_0xb33111(0x233)]||function(_0x3eb9f6,_0x2cb028){const _0x41a7c9=_0xb33111;if(typeof Reflect===_0x41a7c9(0x1d9)&&typeof Reflect[_0x41a7c9(0x1ea)]===_0x41a7c9(0x2ea))return Reflect[_0x41a7c9(0x1ea)](_0x3eb9f6,_0x2cb028);},__param=this&&this['__param']||function(_0x472e6b,_0x37a017){return function(_0x32f70c,_0x992c91){_0x37a017(_0x32f70c,_0x992c91,_0x472e6b);};};function _0x3c62(_0x173bb7,_0x2ccd9c){const _0x1375ed=_0x1375();return _0x3c62=function(_0x3c62f2,_0x300f58){_0x3c62f2=_0x3c62f2-0x193;let _0x37658f=_0x1375ed[_0x3c62f2];return _0x37658f;},_0x3c62(_0x173bb7,_0x2ccd9c);}Object[_0xb33111(0x1a5)](exports,_0xb33111(0x2ad),{'value':!![]}),exports[_0xb33111(0x299)]=void 0x0;const globalConfig_service_1=require(_0xb33111(0x1a0)),user_constant_1=require(_0xb33111(0x292)),mailer_1=require(_0xb33111(0x322)),verification_service_1=require('./../verification/verification.service'),common_1=require(_0xb33111(0x33a)),typeorm_1=require(_0xb33111(0x241)),typeorm_2=require(_0xb33111(0x1c6)),user_entity_1=require('./user.entity'),bcrypt=require('bcryptjs'),_=require('lodash'),verification_constant_1=require(_0xb33111(0x35c)),userBalance_service_1=require(_0xb33111(0x21a)),utils_1=require(_0xb33111(0x254)),balance_constant_1=require(_0xb33111(0x1b9)),class_validator_1=require('class-validator'),redisKey_constant_1=require(_0xb33111(0x256)),redisCache_service_1=require(_0xb33111(0x33d)),model_constant_1=require(_0xb33111(0x2a9)),midjourney_constant_1=require(_0xb33111(0x32e)),user_init_vip_entity_1=require(_0xb33111(0x1c5)),axios_1=require(_0xb33111(0x21e)),date_1=require(_0xb33111(0x1af)),saas_entity_1=require(_0xb33111(0x2ee)),role_entity_1=require(_0xb33111(0x2cc)),store_1=require(_0xb33111(0x315)),nestjs_cls_1=require(_0xb33111(0x32c)),Role_constant_1=require(_0xb33111(0x19f)),userFavorite_entity_1=require('./userFavorite.entity'),userCollect_entity_1=require(_0xb33111(0x1cf)),collectType_constant_1=require(_0xb33111(0x26c));let UserService=class UserService{constructor(_0x367c00,_0x533c43,_0x355287,_0x2352aa,_0x34e1d3,_0x297a8e,_0x16b42b,_0x5faf69,_0x2ce711,_0x45262e,_0x34b3ee,_0x4f9e96,_0x46bc8e,_0x1f6b0c){const _0x279fc6=_0xb33111;this[_0x279fc6(0x1bb)]=_0x367c00,this['userEntity']=_0x533c43,this[_0x279fc6(0x1f7)]=_0x355287,this[_0x279fc6(0x1d4)]=_0x2352aa,this[_0x279fc6(0x353)]=_0x34e1d3,this[_0x279fc6(0x1ed)]=_0x297a8e,this[_0x279fc6(0x2d9)]=_0x16b42b,this[_0x279fc6(0x295)]=_0x5faf69,this['mailerService']=_0x2ce711,this[_0x279fc6(0x30a)]=_0x45262e,this[_0x279fc6(0x2e7)]=_0x34b3ee,this[_0x279fc6(0x2fa)]=_0x4f9e96,this[_0x279fc6(0x2f4)]=_0x46bc8e,this['connection']=_0x1f6b0c;}[_0xb33111(0x316)](){const _0x29408e=_0xb33111;console[_0x29408e(0x325)](_0x29408e(0x228)),this[_0x29408e(0x1d3)]['query'](_0x29408e(0x314)+Role_constant_1[_0x29408e(0x347)]['SUPER']+_0x29408e(0x1f1)+Role_constant_1['ERole'][_0x29408e(0x357)]+'\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27'+Role_constant_1['ERole'][_0x29408e(0x1c2)]+_0x29408e(0x1ca)),this[_0x29408e(0x245)](),this[_0x29408e(0x1bb)][_0x29408e(0x27f)](_0x29408e(0x1fd),async _0x42f59b=>{const _0x3b4fc5=_0x29408e;if(_0x42f59b['startsWith'](redisKey_constant_1[_0x3b4fc5(0x271)])){const _0x212254=_0x42f59b[_0x3b4fc5(0x309)](redisKey_constant_1[_0x3b4fc5(0x271)],'');this[_0x3b4fc5(0x1b6)][_0x3b4fc5(0x304)]({'id':Number(_0x212254)},{'vipExpire':null});}});}async[_0xb33111(0x245)](){const _0x4d106d=_0xb33111,_0xeb4126=await this[_0x4d106d(0x1f7)][_0x4d106d(0x298)]({'where':{'deleteFlag':0x0}});store_1[_0x4d106d(0x230)][_0x4d106d(0x2d6)](),_0xeb4126[_0x4d106d(0x204)](_0x24718a=>store_1['saasMap'][_0x4d106d(0x311)](_0x24718a[_0x4d106d(0x359)],_0x24718a['id'])),store_1[_0x4d106d(0x230)][_0x4d106d(0x311)](process[_0x4d106d(0x34c)][_0x4d106d(0x19e)],0x0);}[_0xb33111(0x2be)](){const _0x476882=_0xb33111;return this[_0x476882(0x1b6)];}async[_0xb33111(0x2b4)](_0x241244){if(!_0x241244['length'])return[];return this['saasEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x241244)}});}async[_0xb33111(0x206)](_0x22c866){const _0x4d2421=_0xb33111,{page:page=0x1,size:size=0x14,keyword:_0x28af8c}=_0x22c866;let _0x3bac9f;_0x28af8c?_0x3bac9f=[{'deleteFlag':0x0,'name':(0x0,typeorm_2['Like'])('%'+_0x28af8c+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2[_0x4d2421(0x1fe)])('%'+_0x28af8c+'%')}]:_0x3bac9f={'deleteFlag':0x0};const [_0x5b0d0a,_0x1f711d]=await this[_0x4d2421(0x1f7)][_0x4d2421(0x1e6)]({'where':_0x3bac9f,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x4d2421(0x1ae)}});if(!_0x5b0d0a[_0x4d2421(0x279)])return{'rows':[],'count':_0x1f711d};const _0x19fc9e=_0x5b0d0a['map'](_0x5cb686=>_0x5cb686['id']),_0x23b2a5=new Map(),_0x4ea9ae=await this[_0x4d2421(0x1b6)][_0x4d2421(0x298)]({'where':{'saasId':(0x0,typeorm_2['In'])(_0x19fc9e),'role':Role_constant_1[_0x4d2421(0x347)][_0x4d2421(0x357)]}});_0x4ea9ae[_0x4d2421(0x204)](_0x1dfc60=>{const _0xf62406=_0x4d2421;_0x23b2a5[_0xf62406(0x311)](_0x1dfc60['saasId'],_0x1dfc60);});const _0x304abc=new Map(),_0x2ac5f0=await this[_0x4d2421(0x1d3)][_0x4d2421(0x2a4)](_0x4d2421(0x29c));_0x2ac5f0[_0x4d2421(0x204)](_0xe32243=>_0x304abc[_0x4d2421(0x311)](_0xe32243[_0x4d2421(0x31c)],_0xe32243[_0x4d2421(0x35f)]));const _0x4a0b79=_0x5b0d0a['map'](_0xd6e46f=>{const _0x363d66=_0x4d2421;let _0x5da33e=null,_0x1b0725=null,_0x1e14b8=null,_0x3067a7=null;const _0x32702f=_0x23b2a5['get'](_0xd6e46f['id']);return _0x32702f&&(_0x5da33e=_0x32702f[_0x363d66(0x30d)],_0x1b0725=_0x32702f[_0x363d66(0x27d)],_0x1e14b8=_0x32702f[_0x363d66(0x219)],_0x3067a7=_0x32702f[_0x363d66(0x22b)]),{..._0xd6e46f,'username':_0x5da33e,'nickname':_0x1b0725,'phone':_0x1e14b8,'email':_0x3067a7,'userCount':_0x304abc[_0x363d66(0x2df)](_0xd6e46f['id'])||0x0};});return{'rows':_0x4a0b79,'count':_0x1f711d};}async[_0xb33111(0x215)](_0x2cbb15){const _0x1f48dc=_0xb33111;return this[_0x1f48dc(0x1f7)]['findOne']({'where':{'id':_0x2cbb15}});}async[_0xb33111(0x2b6)](_0x3f1a48){const _0x1b84d2=_0xb33111,_0x461174=(0x0,utils_1[_0x1b84d2(0x2ed)])(this[_0x1b84d2(0x295)]);if(_0x461174!==0x0)throw new common_1[(_0x1b84d2(0x20f))](_0x1b84d2(0x327),common_1['HttpStatus']['FORBIDDEN']);return await this[_0x1b84d2(0x1f7)][_0x1b84d2(0x2ce)](_0x3f1a48),this[_0x1b84d2(0x245)](),!![];}async[_0xb33111(0x226)](_0x35c76c){const _0x22de28=_0xb33111,_0xbaa924=(0x0,utils_1[_0x22de28(0x2ed)])(this[_0x22de28(0x295)]);return await this[_0x22de28(0x1f7)][_0x22de28(0x2ce)]({..._0x35c76c,'id':_0xbaa924}),!![];}async[_0xb33111(0x296)](_0x5af484){const _0x29f229=_0xb33111;if(!_0x5af484[_0x29f229(0x278)]||!_0x5af484[_0x29f229(0x278)][_0x29f229(0x279)])return!![];return await this[_0x29f229(0x1f7)]['update']({'id':(0x0,typeorm_2['In'])(_0x5af484[_0x29f229(0x278)])},{'deleteFlag':0x1}),!![];}async[_0xb33111(0x28e)](_0x409696,_0x23e95f){const _0xa38da9=_0xb33111,_0x49a10b=await(0x0,utils_1[_0xa38da9(0x2ed)])(this[_0xa38da9(0x295)]),{page:page=0x1,size:size=0x14,keyword:_0x3851a9}=_0x23e95f;let _0x87ba14=_0xa38da9(0x307)+_0x49a10b+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27'+Role_constant_1[_0xa38da9(0x347)][_0xa38da9(0x1c2)]+_0xa38da9(0x310);_0x3851a9&&(_0x87ba14='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20'+_0x49a10b+_0xa38da9(0x1c1)+_0x3851a9+_0xa38da9(0x263)+_0x3851a9+_0xa38da9(0x1cc)+Role_constant_1['ERole'][_0xa38da9(0x1c2)]+'\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%'+_0x3851a9+_0xa38da9(0x263)+_0x3851a9+'%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');const _0x18e0cd=await this[_0xa38da9(0x1d3)][_0xa38da9(0x2a4)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x87ba14+_0xa38da9(0x252)),_0x1b2fb6=await this['connection']['query'](_0xa38da9(0x21b)+_0x87ba14+_0xa38da9(0x1f4)+size+_0xa38da9(0x1b7)+(page-0x1)*size+_0xa38da9(0x252)),_0x321867=_0x1b2fb6[_0xa38da9(0x2f0)](_0x52422b=>_0x52422b['id']);if(_0x321867[_0xa38da9(0x279)]){const _0x271a6a=await this[_0xa38da9(0x1f7)][_0xa38da9(0x1e1)]({'where':{'id':_0x409696[_0xa38da9(0x1b4)]['saasId']}}),_0x46a733=new Map(),_0x4ffd53=await this[_0xa38da9(0x1d3)][_0xa38da9(0x2a4)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');_0x4ffd53[_0xa38da9(0x204)](_0x18b35a=>_0x46a733[_0xa38da9(0x311)](_0x18b35a[_0xa38da9(0x330)],_0x18b35a[_0xa38da9(0x35f)])),_0x1b2fb6[_0xa38da9(0x204)](_0x2b09ff=>{const _0x44721a=_0xa38da9;_0x2b09ff[_0x44721a(0x251)]=_0x271a6a?.['name']||'平台',_0x2b09ff[_0x44721a(0x23d)]=_0x46a733[_0x44721a(0x2df)](_0x2b09ff[_0x44721a(0x1d5)])||0x0;});}return{'rows':_0x1b2fb6,'count':Number(_0x18e0cd[0x0]?.[_0xa38da9(0x35f)]||0x0)};}async[_0xb33111(0x27c)](_0x973adc,_0x7bf194){const _0x53750e=_0xb33111,_0xdd0e0e=await(0x0,utils_1[_0x53750e(0x2ed)])(this[_0x53750e(0x295)]);if([Role_constant_1[_0x53750e(0x347)][_0x53750e(0x1bc)]['valueOf'](),Role_constant_1[_0x53750e(0x347)][_0x53750e(0x357)][_0x53750e(0x26e)](),Role_constant_1[_0x53750e(0x347)][_0x53750e(0x1c2)][_0x53750e(0x26e)]()][_0x53750e(0x19d)](_0x7bf194['code'])&&_0xdd0e0e!==0x0)throw new common_1[(_0x53750e(0x20f))](_0x53750e(0x249),common_1[_0x53750e(0x321)][_0x53750e(0x22f)]);return await this['roleEntity'][_0x53750e(0x2ce)]({..._0x7bf194,'saasId':_0xdd0e0e,'disabled':_0x7bf194[_0x53750e(0x2dc)]??0x0}),!![];}async[_0xb33111(0x1b2)](_0x47ba8c,_0x78b8af){const _0x20c995=_0xb33111,_0x22beae=await(0x0,utils_1[_0x20c995(0x2ed)])(this[_0x20c995(0x295)]);if(!_0x78b8af[_0x20c995(0x278)]||!_0x78b8af[_0x20c995(0x278)][_0x20c995(0x279)])return!![];const _0x371718=await this[_0x20c995(0x1d4)][_0x20c995(0x298)]({'where':{'id':(0x0,typeorm_2['In'])(_0x78b8af[_0x20c995(0x278)]),'saasId':_0x22beae}});if(!_0x371718[_0x20c995(0x279)])return!![];const _0x31f245=_0x371718[_0x20c995(0x2f0)](_0x3307c2=>_0x3307c2[_0x20c995(0x1d5)]),_0x3c1b87=await this[_0x20c995(0x1b6)][_0x20c995(0x35f)]({'where':{'role':(0x0,typeorm_2['In'])(_0x31f245),'saasId':_0x22beae}});if(_0x3c1b87>0x0)throw new common_1[(_0x20c995(0x20f))]('还有用户使用相关角色，无法删除！',common_1[_0x20c995(0x321)][_0x20c995(0x22f)]);return await this[_0x20c995(0x1d4)][_0x20c995(0x360)]({'id':(0x0,typeorm_2['In'])(_0x78b8af['ids'])}),!![];}async[_0xb33111(0x267)](_0x28626b){const _0x437b32=_0xb33111;if(!_0x28626b['length'])return[];const _0x3aff37=await this[_0x437b32(0x1b6)][_0x437b32(0x298)]({'where':{'id':(0x0,typeorm_2['In'])(_0x28626b)}});return _0x3aff37;}async['createUserAndVerifycation'](_0x264974,_0x557a57){const _0x2fa7ee=_0xb33111,{username:_0xef6a80,email:_0x34e37e,password:_0x11c88e,invitedBy:_0x2822cd,client:client=0x0}=_0x264974;if(_0x2822cd){const _0x1fb5cd=await this[_0x2fa7ee(0x1b6)][_0x2fa7ee(0x1e1)]({'where':{'inviteCode':_0x2822cd}});if(!_0x1fb5cd)throw new common_1[(_0x2fa7ee(0x20f))](_0x2fa7ee(0x33c),common_1[_0x2fa7ee(0x321)]['BAD_REQUEST']);}const _0x496077=[{'username':_0xef6a80},{'email':_0x34e37e}],_0x532fac=await this['userEntity']['findOne']({'where':_0x496077});if(_0x532fac&&_0x532fac[_0x2fa7ee(0x23f)]!==user_constant_1[_0x2fa7ee(0x288)][_0x2fa7ee(0x35e)])throw new common_1[(_0x2fa7ee(0x20f))](_0x2fa7ee(0x24f),common_1[_0x2fa7ee(0x321)][_0x2fa7ee(0x22f)]);try{const _0x133440=_[_0x2fa7ee(0x22a)](_0x264974),_0x54218d=bcrypt[_0x2fa7ee(0x2a0)](_0x11c88e,0xa),_0x23aaab=(0x0,utils_1[_0x2fa7ee(0x1dc)])(_0x557a57);_0x133440['password']=_0x54218d,_0x133440['registerIp']=_0x23aaab,_0x133440[_0x2fa7ee(0x2da)]=client;let _0x4ee0cd;if(!_0x532fac){const _0x2371c6=await this[_0x2fa7ee(0x2fa)]['getConfigByKeys']([_0x2fa7ee(0x1f6)]);_0x133440[_0x2fa7ee(0x312)]=_0x2371c6,_0x4ee0cd=await this[_0x2fa7ee(0x1b6)][_0x2fa7ee(0x2ce)](_0x133440);}else _0x4ee0cd=_0x532fac;const _0x34649a=await this[_0x2fa7ee(0x2fa)][_0x2fa7ee(0x1ab)](['isVerifyEmail',_0x2fa7ee(0x229),_0x2fa7ee(0x29a),_0x2fa7ee(0x24d),_0x2fa7ee(0x297),'registerVerifyExpir']),_0x19ba2e=_0x34649a[_0x2fa7ee(0x2f2)]?Number(_0x34649a['isVerifyEmail']):0x1;if(_0x19ba2e){const _0x2f881f=_0x34649a[_0x2fa7ee(0x286)]?Number(_0x34649a[_0x2fa7ee(0x286)]):0x1e*0x3c,_0xa35848=await this[_0x2fa7ee(0x2f4)][_0x2fa7ee(0x24c)](_0x4ee0cd,verification_constant_1[_0x2fa7ee(0x2c8)][_0x2fa7ee(0x2fb)],_0x2f881f),{code:_0x5cd86a,email:_0x4d1ae7,id:_0x168369}=_0xa35848,{registerVerifyEmailFrom:_0x162bb7}=_0x34649a;await this[_0x2fa7ee(0x1f2)][_0x2fa7ee(0x32d)]({'to':_0x4d1ae7,'subject':'来自'+_0x162bb7+_0x2fa7ee(0x350),'template':_0x2fa7ee(0x356),'context':{'baseUrl':_0x34649a[_0x2fa7ee(0x229)],'code':_0x5cd86a,'id':_0x168369,..._0x34649a}});}else{const {id:_0x3ed066,invitedBy:_0x12d8c6}=_0x4ee0cd;await this['updateUserStatus'](_0x3ed066,user_constant_1[_0x2fa7ee(0x288)][_0x2fa7ee(0x235)]);let _0x4b875a;_0x12d8c6&&(_0x4b875a=await this[_0x2fa7ee(0x28a)](_0x12d8c6)),await this[_0x2fa7ee(0x317)](_0x4ee0cd,_0x4b875a);}return _0x4ee0cd;}catch(_0x194b89){console[_0x2fa7ee(0x325)]('error:\x20',_0x194b89);throw _0x194b89;}}async[_0xb33111(0x20c)](_0x465111){const _0x283980=_0xb33111,{username:_0x1eccd0,password:_0x3ee956,uid:uid=0x0,phone:_0x3fdd43}=_0x465111;let _0x253b32=null;if(uid>0x0){_0x253b32=await this['userEntity'][_0x283980(0x1e1)]({'where':{'id':uid}});if(!_0x253b32)throw new common_1[(_0x283980(0x20f))](_0x283980(0x287),common_1[_0x283980(0x321)][_0x283980(0x22f)]);if(!bcrypt[_0x283980(0x264)](_0x3ee956,_0x253b32['password']))throw new common_1[(_0x283980(0x20f))](_0x283980(0x35a),common_1[_0x283980(0x321)][_0x283980(0x22f)]);}if(_0x1eccd0&&_0x3ee956){const _0x44417c=[{'username':_0x1eccd0},{'email':_0x1eccd0}];_0x253b32=await this[_0x283980(0x1b6)][_0x283980(0x1e1)]({'where':_0x44417c});if(!_0x253b32)throw new common_1[(_0x283980(0x20f))](_0x283980(0x287),common_1['HttpStatus'][_0x283980(0x22f)]);if(!bcrypt[_0x283980(0x264)](_0x3ee956,_0x253b32[_0x283980(0x2bb)]))throw new common_1['HttpException']('当前密码错误！',common_1[_0x283980(0x321)][_0x283980(0x22f)]);}if(_0x3fdd43&&_0x3ee956){const _0x33108d=[{'phone':_0x3fdd43}];_0x253b32=await this[_0x283980(0x1b6)]['findOne']({'where':_0x33108d});if(!_0x253b32)throw new common_1['HttpException'](_0x283980(0x287),common_1[_0x283980(0x321)][_0x283980(0x22f)]);if(!bcrypt[_0x283980(0x264)](_0x3ee956,_0x253b32[_0x283980(0x2bb)]))throw new common_1[(_0x283980(0x20f))](_0x283980(0x35a),common_1[_0x283980(0x321)]['BAD_REQUEST']);}if(!_0x253b32)throw new common_1[(_0x283980(0x20f))](_0x283980(0x287),common_1[_0x283980(0x321)][_0x283980(0x22f)]);if(_0x253b32['status']!==user_constant_1['UserStatusEnum'][_0x283980(0x235)])throw new common_1[(_0x283980(0x20f))](user_constant_1['UserStatusErrMsg'][_0x253b32[_0x283980(0x23f)]],common_1[_0x283980(0x321)]['BAD_REQUEST']);if(_0x253b32[_0x283980(0x30d)]&&!_0x253b32[_0x283980(0x2f9)]){const _0x20a26c=await this[_0x283980(0x353)][_0x283980(0x1e1)]({'where':{'username':_0x253b32['username']}});_0x20a26c&&await this[_0x283980(0x1d3)]['transaction'](async()=>{const _0x54a9bd=_0x283980;_0x20a26c[_0x54a9bd(0x2ca)]===-0x1?_0x253b32['lifetimeVip']=0x1:_0x253b32[_0x54a9bd(0x1bf)]=(0x0,date_1[_0x54a9bd(0x2c6)])()[_0x54a9bd(0x2ef)](_0x20a26c[_0x54a9bd(0x2ca)],'day')[_0x54a9bd(0x1e9)](),_0x253b32=await this[_0x54a9bd(0x1b6)][_0x54a9bd(0x2ce)](_0x253b32),await this['userInitVipEntity'][_0x54a9bd(0x360)]({'id':_0x20a26c['id']});});}return _0x253b32;}async[_0xb33111(0x35b)](_0x2e4876,_0x39142a){const _0xd8a0ea=_0xb33111,_0x509e7d=await this[_0xd8a0ea(0x1b6)][_0xd8a0ea(0x1e1)]({'where':{'id':_0x2e4876}});return bcrypt[_0xd8a0ea(0x264)](_0x39142a,_0x509e7d['password']);}async[_0xb33111(0x258)](_0x53d0a0,_0x1820b2){const _0x4be8b0=_0xb33111,_0x755c9f=await this[_0x4be8b0(0x1b6)][_0x4be8b0(0x304)]({'id':_0x53d0a0},{'status':_0x1820b2});return _0x755c9f[_0x4be8b0(0x1b8)]>0x0;}async['getUserStatus'](_0x24294c){const _0x22899d=_0xb33111,_0x331f5a=await this[_0x22899d(0x1b6)][_0x22899d(0x1e1)]({'where':{'id':_0x24294c}});return _0x331f5a[_0x22899d(0x23f)];}async[_0xb33111(0x1fb)](_0x1fd423){const _0x41d482=_0xb33111;return await this['userEntity'][_0x41d482(0x1e1)]({'where':{'id':_0x1fd423}});}async[_0xb33111(0x346)](_0x3316db){const _0x4c4768=_0xb33111;return await this[_0x4c4768(0x1b6)]['findBy']({'id':(0x0,typeorm_2['In'])(_0x3316db)});}async[_0xb33111(0x20b)](_0x13ee3d){const _0x4695fd=_0xb33111;return await this[_0x4695fd(0x1b6)][_0x4695fd(0x1e1)]({'where':{'username':_0x13ee3d}});}async['updateUserPsd'](_0x342dac){const _0x1a60e2=_0xb33111,{id:_0x15f892,username:_0x3f3c83,password:_0x2875a3}=_0x342dac;return await this[_0x1a60e2(0x1b6)]['update'](_0x15f892,{'username':_0x3f3c83,'password':_0x2875a3});}async[_0xb33111(0x349)](_0x278f4c){const _0x28c636=_0xb33111;return await this['userEntity'][_0x28c636(0x1e1)]({'where':{'id':_0x278f4c}});}async[_0xb33111(0x266)](_0x41d636){const _0x298204=_0xb33111,{id:_0x30e972,role:_0x10d5c2}=_0x41d636;if(_0x10d5c2===_0x298204(0x345))return!![];const _0x37020a=await this['userEntity'][_0x298204(0x1e1)]({'where':{'id':_0x30e972}});if(!_0x37020a)throw new common_1[(_0x298204(0x20f))](_0x298204(0x1aa),common_1['HttpStatus'][_0x298204(0x2f8)]);if(_0x37020a['status']===user_constant_1['UserStatusEnum'][_0x298204(0x260)])throw new common_1[(_0x298204(0x20f))](_0x298204(0x208),common_1[_0x298204(0x321)]['BAD_REQUEST']);if(_0x37020a[_0x298204(0x23f)]===user_constant_1['UserStatusEnum']['LOCKED'])throw new common_1[(_0x298204(0x20f))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1[_0x298204(0x321)][_0x298204(0x22f)]);}async[_0xb33111(0x211)](_0x1bd327){const _0x53f641=_0xb33111;return await this[_0x53f641(0x1b6)][_0x53f641(0x1e1)]({'where':{'id':_0x1bd327}});}['getUserListByIds'](_0x1993eb){const _0x222300=_0xb33111;return this[_0x222300(0x1b6)][_0x222300(0x298)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1993eb)}});}async[_0xb33111(0x1ac)](_0x581f54){const _0x454fed=_0xb33111;return this[_0x454fed(0x1b6)][_0x454fed(0x1e1)]({'where':{'inviteCode':_0x581f54}});}async[_0xb33111(0x25d)](_0x41f52c){const _0x478a3e=_0xb33111,_0x3e1c6a=(0x0,utils_1[_0x478a3e(0x2ed)])(this['clsService']);return await this[_0x478a3e(0x1b6)]['findOne']({'where':{'openId':_0x41f52c,'saasId':_0x3e1c6a}});}async[_0xb33111(0x2cb)](_0x5051b8){return this['userEntity']['count']({'where':{'invitedBy':_0x5051b8}});}async[_0xb33111(0x2b2)](_0x2e4900,_0x105d7f){const _0x51799b=_0xb33111,{id:_0x20e886}=_0x105d7f['user'],_0x3e7260=await this[_0x51799b(0x1b6)][_0x51799b(0x1e1)]({'where':{'id':_0x20e886}});if(!_0x3e7260)throw new common_1[(_0x51799b(0x20f))](_0x51799b(0x276),common_1['HttpStatus'][_0x51799b(0x22f)]);if(_0x2e4900[_0x51799b(0x30d)]&&_0x3e7260['username']===_0x2e4900[_0x51799b(0x30d)])throw new common_1[(_0x51799b(0x20f))](_0x51799b(0x34e),common_1[_0x51799b(0x321)]['BAD_REQUEST']);if(_0x2e4900['username']){const _0x5c6cf3=await this[_0x51799b(0x1b6)][_0x51799b(0x1e1)]({'where':{'username':_0x2e4900[_0x51799b(0x30d)],'id':(0x0,typeorm_2[_0x51799b(0x2dd)])(_0x20e886)}});if(_0x5c6cf3)throw new common_1[(_0x51799b(0x20f))](_0x51799b(0x34f),common_1['HttpStatus'][_0x51799b(0x22f)]);}const _0x108d06=await this['userEntity']['update']({'id':_0x20e886},_0x2e4900);if(_0x108d06[_0x51799b(0x1b8)]<=0x0)throw new common_1['HttpException'](_0x51799b(0x2ff),common_1[_0x51799b(0x321)]['BAD_REQUEST']);return'修改用户信息成功！';}async[_0xb33111(0x196)](_0x4daf6f,_0x36b285){const _0x4fb0f3=_0xb33111,_0x5a5011=bcrypt[_0x4fb0f3(0x2a0)](_0x36b285,0xa),_0x33afab=await this[_0x4fb0f3(0x1b6)][_0x4fb0f3(0x304)]({'id':_0x4daf6f},{'password':_0x5a5011});if(_0x33afab[_0x4fb0f3(0x1b8)]<=0x0)throw new common_1[(_0x4fb0f3(0x20f))]('修改密码失败、请重新试试吧。',common_1[_0x4fb0f3(0x321)]['BAD_REQUEST']);}async['favorite'](_0x33ef13,_0x31c462){const _0x36d53b=_0xb33111;try{const _0x25ffa3=await this[_0x36d53b(0x1ed)]['findOne']({'where':{'userId':_0x33ef13['user']['id'],'relateId':_0x31c462[_0x36d53b(0x1ad)],'relateType':_0x31c462[_0x36d53b(0x355)]}});return _0x25ffa3?await this[_0x36d53b(0x1ed)][_0x36d53b(0x360)]({'id':_0x25ffa3['id']}):await this[_0x36d53b(0x1ed)]['save']({'userId':_0x33ef13[_0x36d53b(0x1b4)]['id'],'relateId':_0x31c462[_0x36d53b(0x1ad)],'relateType':_0x31c462['relateType']}),!![];}catch(_0x42aeb9){throw new common_1['HttpException'](_0x42aeb9[_0x36d53b(0x1dd)],common_1[_0x36d53b(0x321)][_0x36d53b(0x22f)]);}}async[_0xb33111(0x318)](_0x430ae9,_0x834b5b,_0x56c829){const _0xa99b68=_0xb33111;return this[_0xa99b68(0x1ed)]['find']({'where':{'userId':_0x430ae9,'relateType':_0x834b5b,'relateId':(0x0,typeorm_2['In'])(_0x56c829)}});}async[_0xb33111(0x2d5)](_0xb45309){const _0x56f586=_0xb33111,{id:_0x379b92}=_0xb45309[_0x56f586(0x1b4)],_0x130306=await this[_0x56f586(0x1b6)][_0x56f586(0x1e1)]({'where':{'id':_0x379b92}});if(!_0x130306||_0x130306['inviteCode'])throw new common_1[(_0x56f586(0x20f))]('已生成过邀请码、请勿重复生成',common_1['HttpStatus'][_0x56f586(0x22f)]);const _0x293ea6=(0x0,utils_1[_0x56f586(0x336)])(),_0x3851e5=await this[_0x56f586(0x1b6)]['findOne']({'where':{'inviteCode':_0x293ea6}});if(_0x3851e5)throw new common_1[(_0x56f586(0x20f))](_0x56f586(0x2ae),common_1[_0x56f586(0x321)][_0x56f586(0x22f)]);const _0x1f89be=await this[_0x56f586(0x1b6)][_0x56f586(0x304)]({'id':_0x379b92},{'inviteCode':_0x293ea6});if(_0x1f89be[_0x56f586(0x1b8)]<=0x0)throw new common_1[(_0x56f586(0x20f))](_0x56f586(0x2ae),common_1[_0x56f586(0x321)][_0x56f586(0x22f)]);return _0x293ea6;}async[_0xb33111(0x25c)](_0x42974c,_0x396586){const _0x994b38=_0xb33111;try{const {id:_0x515227}=_0x42974c[_0x994b38(0x1b4)],{page:page=0x1,size:size=0xa}=_0x396586,_0x176ffa=await this[_0x994b38(0x1b6)][_0x994b38(0x1e1)]({'where':{'id':_0x515227}}),{inviteCode:_0x3a8518}=_0x176ffa;if(!_0x3a8518)return[];const [_0x25086e,_0x2a7d0e]=await this['userEntity'][_0x994b38(0x1e6)]({'where':{'inviteCode':_0x3a8518},'order':{'id':_0x994b38(0x1ae)},'select':['username',_0x994b38(0x22b),'createdAt','status','avatar'],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1['formatCreateOrUpdateDate'])(_0x25086e)[_0x994b38(0x2f0)](_0x48c04a=>{const _0x1ce14c=_0x994b38;return _0x48c04a[_0x1ce14c(0x22b)]=(0x0,utils_1['maskEmail'])(_0x48c04a['email']),_0x48c04a;}),{'rows':_0x25086e,'count':_0x2a7d0e};}catch(_0x3415e2){console['log'](_0x994b38(0x285),_0x3415e2);throw new common_1[(_0x994b38(0x20f))](_0x994b38(0x2c0),common_1[_0x994b38(0x321)][_0x994b38(0x22f)]);}}async[_0xb33111(0x209)](_0x52978e,_0x53db2d,_0x54b75d){const _0x2b0397=_0xb33111,_0xa54dc5=(0x0,utils_1[_0x2b0397(0x2ed)])(this[_0x2b0397(0x295)]),{page:page=0x1,size:size=0x14,startTime:_0x20dab3,endTime:_0x1a267f,saasId:_0x81c5e0,keyword:_0xbb5bcf,inviterKeyword:_0x4659c3}=_0x53db2d,_0x5003b2=_0x2b0397(0x2db)+(_0x54b75d?_0x2b0397(0x2b1)+_0x54b75d:'')+_0x2b0397(0x1ba)+(_0x1a267f?_0x2b0397(0x1a1)+_0x1a267f+'\x27':'')+_0x2b0397(0x1ba)+(_0x20dab3?'\x20AND\x20u.createdAt\x20>=\x20\x27'+_0x20dab3+'\x27':'')+_0x2b0397(0x1ba)+(_0xa54dc5!==0x0?'\x20AND\x20u.saasId\x20=\x20'+_0xa54dc5:(0x0,utils_1[_0x2b0397(0x19c)])(_0x81c5e0)?_0x2b0397(0x282)+_0x81c5e0:'')+_0x2b0397(0x1ba)+(_0xbb5bcf?_0x2b0397(0x2a6)+_0xbb5bcf+_0x2b0397(0x1d6)+_0xbb5bcf+_0x2b0397(0x26b)+_0xbb5bcf+'%\x27\x20OR\x20u.email\x20LIKE\x20\x27%'+_0xbb5bcf+_0x2b0397(0x335):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x4659c3?_0x2b0397(0x332)+_0x4659c3+_0x2b0397(0x1e2)+_0x4659c3+_0x2b0397(0x2b3)+_0x4659c3+_0x2b0397(0x1e5)+_0x4659c3+_0x2b0397(0x335):'')+_0x2b0397(0x252),_0x496f59='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5003b2+_0x2b0397(0x252),_0x52e90c='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x5003b2+_0x2b0397(0x1f5)+size+_0x2b0397(0x1b7)+(page-0x1)*size+_0x2b0397(0x252),_0xf1da04=await this[_0x2b0397(0x1d3)]['query'](_0x496f59),_0x4d59c0=await this[_0x2b0397(0x1d3)][_0x2b0397(0x2a4)](_0x52e90c);return!(0x0,utils_1[_0x2b0397(0x1a2)])(this[_0x2b0397(0x295)])&&_0x4d59c0[_0x2b0397(0x204)](_0x1ac842=>{const _0x56d97c=_0x2b0397;_0x1ac842[_0x56d97c(0x219)]=(0x0,utils_1[_0x56d97c(0x2b5)])(_0x1ac842[_0x56d97c(0x219)]),_0x1ac842['email']=(0x0,utils_1[_0x56d97c(0x2b5)])(_0x1ac842['email']),_0x1ac842[_0x56d97c(0x2bf)]=(0x0,utils_1['hideString'])(_0x1ac842['inviterPhone']),_0x1ac842[_0x56d97c(0x262)]=(0x0,utils_1[_0x56d97c(0x2b5)])(_0x1ac842[_0x56d97c(0x262)]);}),{'rows':_0x4d59c0,'count':Number(_0xf1da04[0x0]?.['count']||0x0)};}async['inviteLink'](_0x2b2da2){const _0x191212=_0xb33111,_0x3e0646=await this['userEntity'][_0x191212(0x1e1)]({'where':{'inviteCode':_0x2b2da2}});if(!_0x3e0646)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x3e0646,_0x1a283b=await this[_0x191212(0x1b6)][_0x191212(0x304)]({'inviteCode':_0x2b2da2},{'inviteLinkCount':inviteLinkCount+0x1});return _0x1a283b[_0x191212(0x1b8)]?0x1:0x0;}async[_0xb33111(0x28a)](_0x9a63e7){const _0x30a36e=_0xb33111;return await this[_0x30a36e(0x1b6)][_0x30a36e(0x1e1)]({'where':{'inviteCode':_0x9a63e7}});}async[_0xb33111(0x302)](_0x595829,_0x5232d6){const _0x2731f2=_0xb33111,_0x566773=(0x0,utils_1[_0x2731f2(0x2ed)])(this[_0x2731f2(0x295)]);let {page:page=0x1,size:size=0xa,username:_0x260e7a,phone:_0x45e66e,email:_0x2e2008,status:_0x2d5362,keyword:_0x43efb9,roleCode:_0x22977a,vip:_0xfd6315,saasId:_0x3bbdf5}=_0x595829,_0x253eb2=_0x2731f2(0x1b0);_0x2d5362&&(_0x253eb2=_0x253eb2+(_0x2731f2(0x1ec)+_0x2d5362));_0x22977a&&(_0x253eb2=_0x253eb2+(_0x2731f2(0x300)+_0x22977a+'\x27'));_0xfd6315&&(_0xfd6315=Number(_0xfd6315));if(_0xfd6315===0x1)_0x253eb2=_0x253eb2+_0x2731f2(0x25a);else _0xfd6315===0x0&&(_0x253eb2=_0x253eb2+'\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL');_0x43efb9?_0x253eb2=_0x253eb2+(_0x2731f2(0x2f1)+_0x43efb9+_0x2731f2(0x24b)+_0x43efb9+_0x2731f2(0x2b8)+_0x43efb9+_0x2731f2(0x340)+_0x43efb9+'%\x27\x20OR\x20id\x20=\x20\x27'+_0x43efb9+'\x27)'):(_0x260e7a&&(_0x253eb2=_0x253eb2+(_0x2731f2(0x34b)+_0x260e7a+'%\x27')),_0x2e2008&&(_0x253eb2=_0x253eb2+(_0x2731f2(0x291)+_0x2e2008+'%\x27')),_0x45e66e&&(_0x253eb2=_0x253eb2+('\x20AND\x20phone\x20LIKE\x20\x27%'+_0x45e66e+'%\x27')));(0x0,utils_1[_0x2731f2(0x1e3)])(this[_0x2731f2(0x295)])?(0x0,utils_1['isManage'])(this[_0x2731f2(0x295)])&&_0x3bbdf5&&(_0x253eb2=_0x253eb2+(_0x2731f2(0x342)+_0x3bbdf5)):_0x253eb2=_0x253eb2+('\x20AND\x20saasId\x20=\x20'+_0x566773);const _0x51d036=await this[_0x2731f2(0x1d3)][_0x2731f2(0x2a4)](_0x2731f2(0x220)+_0x253eb2+_0x2731f2(0x2d2)),_0x5a971b=await this[_0x2731f2(0x1d3)][_0x2731f2(0x2a4)](_0x2731f2(0x259)+_0x253eb2+_0x2731f2(0x21f)+size+_0x2731f2(0x1b7)+(page-0x1)*size+_0x2731f2(0x252)),_0x44c0d3=[],_0x2bf7dd=(0x0,utils_1[_0x2731f2(0x1a2)])(this[_0x2731f2(0x295)]),_0x5573b1=new Map([[Role_constant_1[_0x2731f2(0x347)][_0x2731f2(0x357)],_0x2731f2(0x1ee)],[Role_constant_1[_0x2731f2(0x347)][_0x2731f2(0x1bc)],_0x2731f2(0x2af)],[Role_constant_1[_0x2731f2(0x347)][_0x2731f2(0x1c2)],'前台用户']]);for(let _0x1b33a2=0x0;_0x1b33a2<_0x5a971b['length'];_0x1b33a2++){const _0x1ed48e=_0x5a971b[_0x1b33a2];let _0x1b0b25=_0x2731f2(0x283);if(_0x5573b1[_0x2731f2(0x20d)](_0x1ed48e['role']))_0x1b0b25=_0x5573b1[_0x2731f2(0x2df)](_0x1ed48e[_0x2731f2(0x330)]);else{const _0x282304=await this[_0x2731f2(0x1d4)]['findOne']({'where':{'code':_0x1ed48e['role'],'saasId':_0x1ed48e[_0x2731f2(0x31c)]}});_0x1b0b25=_0x282304[_0x2731f2(0x2e4)];}_0x44c0d3[_0x2731f2(0x1cb)]({..._0x1ed48e,'roleName':_0x1b0b25,'isBindWx':!!_0x1ed48e?.[_0x2731f2(0x31a)],'password':_0x1ed48e[_0x2731f2(0x2bb)]?_0x2731f2(0x214):'no','email':_0x2bf7dd?_0x1ed48e[_0x2731f2(0x22b)]:(0x0,utils_1[_0x2731f2(0x2fe)])(_0x1ed48e[_0x2731f2(0x22b)]),'phone':_0x2bf7dd?_0x1ed48e[_0x2731f2(0x219)]:(0x0,utils_1[_0x2731f2(0x2fe)])(_0x1ed48e['phone']),'lastLoginIp':_0x2bf7dd?_0x1ed48e[_0x2731f2(0x2f9)]:(0x0,utils_1[_0x2731f2(0x198)])(_0x1ed48e['lastLoginIp'])});}return{'rows':_0x44c0d3,'count':Number(_0x51d036[0x0]?.[_0x2731f2(0x35f)]||0x0)};}async[_0xb33111(0x2bc)](_0x316625){const _0x4da300=_0xb33111,{page:page=0x1,size:size=0xa,username:_0x2d6535,status:_0x122355}=_0x316625;let _0x247cdb={};_0x2d6535&&Object[_0x4da300(0x197)](_0x247cdb,{'username':(0x0,typeorm_2[_0x4da300(0x1fe)])('%'+_0x2d6535+'%')}),_0x122355&&Object[_0x4da300(0x197)](_0x247cdb,{'status':_0x122355});const [_0x50a037,_0x4b3863]=await this[_0x4da300(0x1b6)][_0x4da300(0x1e6)]({'skip':(page-0x1)*size,'where':_0x247cdb,'take':size,'cache':!![],'order':{'createdAt':_0x4da300(0x1ae)},'select':['username','password',_0x4da300(0x330),_0x4da300(0x23f),'id']});return{'rows':_0x50a037,'count':_0x4b3863};}async[_0xb33111(0x23b)]({id:_0x3b52f4}){const _0x73ad27=_0xb33111;let _0xb01961,_0x512955;const _0x68c98b=await this[_0x73ad27(0x1b6)][_0x73ad27(0x1e1)]({'where':{'id':_0x3b52f4}});if(!_0x68c98b)throw new common_1[(_0x73ad27(0x20f))](_0x73ad27(0x21c),common_1[_0x73ad27(0x321)][_0x73ad27(0x2f8)]);if((0x0,utils_1['shouldAccess'])(_0x68c98b[_0x73ad27(0x330)])){const _0x4e958b=_0x68c98b['role']===Role_constant_1[_0x73ad27(0x347)][_0x73ad27(0x357)]?0x0:_0x68c98b['saasId'],_0x45d35c=await this[_0x73ad27(0x1d4)][_0x73ad27(0x1e1)]({'where':{'code':_0x68c98b[_0x73ad27(0x330)],'saasId':_0x4e958b}});if(!_0x45d35c)throw new common_1['HttpException'](_0x73ad27(0x1ef),common_1[_0x73ad27(0x321)][_0x73ad27(0x22f)]);_0xb01961=_0x45d35c[_0x73ad27(0x2f7)],_0x512955=_0x45d35c['accessLabel'];}return{..._0x68c98b,'access':_0xb01961,'accessLabel':_0x512955,'isBindWx':!!_0x68c98b?.[_0x73ad27(0x31a)],'password':_0x68c98b[_0x73ad27(0x2bb)]?_0x73ad27(0x214):'no'};}async[_0xb33111(0x358)](_0x431edf){const _0x3d9db0=_0xb33111;return await this[_0x3d9db0(0x1b6)][_0x3d9db0(0x1e1)]({'where':{'username':_0x431edf}});}async[_0xb33111(0x1d2)](_0x86c7af){const _0x5d774a=_0xb33111,{id:_0x3d7152,status:_0x251cfb}=_0x86c7af,_0x21fb21=await this[_0x5d774a(0x1b6)]['findOne']({'where':{'id':_0x3d7152}});if(!_0x21fb21)throw new common_1[(_0x5d774a(0x20f))](_0x5d774a(0x200),common_1[_0x5d774a(0x321)][_0x5d774a(0x22f)]);if(_0x21fb21['role']===Role_constant_1[_0x5d774a(0x347)]['SUPER'])throw new common_1['HttpException']('超级管理员不可被操作！',common_1[_0x5d774a(0x321)][_0x5d774a(0x22f)]);if(_0x21fb21[_0x5d774a(0x23f)]===user_constant_1[_0x5d774a(0x288)][_0x5d774a(0x35e)])throw new common_1['HttpException'](_0x5d774a(0x2de),common_1['HttpStatus']['BAD_REQUEST']);if(_0x251cfb===user_constant_1[_0x5d774a(0x288)][_0x5d774a(0x35e)])throw new common_1[(_0x5d774a(0x20f))](_0x5d774a(0x217),common_1[_0x5d774a(0x321)]['BAD_REQUEST']);const _0x5a0cb5=await this[_0x5d774a(0x1b6)][_0x5d774a(0x304)]({'id':_0x3d7152},{'status':_0x251cfb});if(_0x5a0cb5[_0x5d774a(0x1b8)]<=0x0)throw new common_1['HttpException']('修改用户状态失败！',common_1[_0x5d774a(0x321)]['BAD_REQUEST']);return _0x5d774a(0x2d7);}async[_0xb33111(0x329)](_0x201ce0){const _0xd1737f=_0xb33111,{id:_0x3375aa}=_0x201ce0,_0x371a48=await this['userEntity'][_0xd1737f(0x1e1)]({'where':{'id':_0x3375aa}});if(!_0x371a48)throw new common_1[(_0xd1737f(0x20f))](_0xd1737f(0x200),common_1[_0xd1737f(0x321)][_0xd1737f(0x22f)]);const _0x318494='123456',_0x1a749a=bcrypt[_0xd1737f(0x2a0)](_0x318494,0xa),_0x5e2e92=await this[_0xd1737f(0x1b6)]['update']({'id':_0x3375aa},{'password':_0x1a749a});if(_0x5e2e92[_0xd1737f(0x1b8)]<=0x0)throw new common_1['HttpException'](_0xd1737f(0x202),common_1[_0xd1737f(0x321)][_0xd1737f(0x22f)]);return _0xd1737f(0x21d)+_0x318494+']成功!';}async[_0xb33111(0x328)](_0x2081e5,_0x23fbe8){const _0xfa5718=_0xb33111;return await this[_0xfa5718(0x1b6)][_0xfa5718(0x304)]({'id':_0x2081e5},{'lastLoginIp':_0x23fbe8});}async[_0xb33111(0x232)](_0x466a8b,_0x3bb128){const _0x455db9=_0xb33111;try{const _0x17399c=await this[_0x455db9(0x1b6)][_0x455db9(0x1e1)]({'where':{'id':_0x3bb128}});if(!_0x17399c)return{'status':![],'msg':_0x455db9(0x2a7)};const _0x48430f=await this['userEntity']['findOne']({'where':{'openId':_0x466a8b}});if(_0x48430f)return{'status':![],'msg':_0x455db9(0x2f3)};const _0x5ea99f=await this[_0x455db9(0x1b6)][_0x455db9(0x304)]({'id':_0x3bb128},{'openId':_0x466a8b});if(_0x5ea99f[_0x455db9(0x1b8)]<=0x0)return{'status':![],'msg':'绑定微信失败、请联系管理员！'};return{'status':!![],'msg':_0x455db9(0x30e)};}catch(_0x41e85b){return{'status':![],'msg':_0x455db9(0x1a9)};}}async['getOpenIdByUserId'](_0x1a1e97){const _0x2aaa31=_0xb33111,_0x426ba4=await this[_0x2aaa31(0x1b6)][_0x2aaa31(0x1e1)]({'where':{'id':_0x1a1e97}});return _0x426ba4?.[_0x2aaa31(0x31a)];}async[_0xb33111(0x193)](_0x1bf05f){const _0x3a76f9=_0xb33111,_0x511026=await this['userEntity'][_0x3a76f9(0x1e1)]({'where':{'id':_0x1bf05f}});return _0x511026?.['miniOpenId'];}async['verifyUserRegisterByPhone'](_0x555694){const _0x11a329=_0xb33111,{username:_0x18f1a4,password:_0x54cdba,phone:_0x1cfe4b,phoneCode:_0x1a116b}=_0x555694,_0x486891=await this[_0x11a329(0x1b6)][_0x11a329(0x1e1)]({'where':[{'username':_0x18f1a4},{'phone':_0x1cfe4b}]});if(_0x486891&&_0x486891['username']===_0x18f1a4)throw new common_1[(_0x11a329(0x20f))](_0x11a329(0x1da),common_1['HttpStatus']['BAD_REQUEST']);if(_0x486891&&_0x486891[_0x11a329(0x219)]===_0x1cfe4b)throw new common_1[(_0x11a329(0x20f))]('当前手机号已注册、请勿重复注册！',common_1[_0x11a329(0x321)][_0x11a329(0x22f)]);}async['createUser'](_0x402258){const _0x38bcaa=_0xb33111,_0xc8ba0d=(0x0,utils_1['getReqSaasId'])(this[_0x38bcaa(0x295)]);if(_0x402258[_0x38bcaa(0x330)]!==Role_constant_1['ERole'][_0x38bcaa(0x357)])_0x402258[_0x38bcaa(0x31c)]=_0xc8ba0d;else{if(!_0x402258['saasId'])throw new common_1[(_0x38bcaa(0x20f))](_0x38bcaa(0x257),common_1[_0x38bcaa(0x321)][_0x38bcaa(0x22f)]);}return await this[_0x38bcaa(0x1b6)]['save'](_0x402258);}async[_0xb33111(0x224)](_0x575d30){const _0x1d3bd3=_0xb33111,{id:_0x252d8d,moreId:_0x275ecd}=_0x575d30;if(_0x252d8d)return await this[_0x1d3bd3(0x1b6)][_0x1d3bd3(0x360)]({'id':_0x252d8d});if(_0x275ecd)return await this['userEntity']['delete']({'id':(0x0,typeorm_2[_0x1d3bd3(0x248)])(_0x275ecd)});}async[_0xb33111(0x280)](_0x527d51){const _0x303464=_0xb33111,_0x42a57d=_0x527d51[_0x303464(0x1b4)]['id'];return await this[_0x303464(0x1b6)][_0x303464(0x360)]({'id':_0x42a57d})[_0x303464(0x2a5)](_0x4d4271=>_0x4d4271[_0x303464(0x1b8)]>0x0);}async[_0xb33111(0x243)](_0x42de73,_0x10be8d){const _0x160e43=_0xb33111;try{if(!_0x42de73[_0x160e43(0x30d)]&&!_0x42de73[_0x160e43(0x219)]&&!_0x42de73[_0x160e43(0x22b)])throw new Error(_0x160e43(0x2e5));if(_0x42de73[_0x160e43(0x30d)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x160e43(0x1f8)](_0x42de73['username']))throw new Error(_0x160e43(0x29b));if(!_0x42de73['password'])throw new Error(_0x160e43(0x272));}if(_0x42de73[_0x160e43(0x219)]){if(!(0x0,class_validator_1['isMobilePhone'])(_0x42de73[_0x160e43(0x219)],_0x160e43(0x1db)))throw new Error(_0x160e43(0x2cd));}if(_0x42de73[_0x160e43(0x22b)]){if(!(0x0,class_validator_1[_0x160e43(0x1c3)])(_0x42de73[_0x160e43(0x22b)]))throw new Error('邮箱格式错误！');}if(_0x42de73[_0x160e43(0x30d)]){const _0x8335cb=await this[_0x160e43(0x1b6)][_0x160e43(0x344)]({'where':{'username':_0x42de73['username']}});if(_0x8335cb)throw new Error(_0x160e43(0x1bd));}if(_0x42de73[_0x160e43(0x219)]){const _0x4288a1=await this['userEntity'][_0x160e43(0x344)]({'where':{'phone':_0x42de73[_0x160e43(0x219)]}});if(_0x4288a1)throw new Error(_0x160e43(0x246));}if(_0x42de73[_0x160e43(0x22b)]){const _0x26eac0=await this['userEntity'][_0x160e43(0x344)]({'where':{'email':_0x42de73['email']}});if(_0x26eac0)throw new Error(_0x160e43(0x334));}const _0x47f456=new user_entity_1['UserEntity']();for(let _0x379a9e in _0x42de73){_0x42de73[_0x379a9e]&&(_0x47f456[_0x379a9e]=_0x42de73[_0x379a9e]);}return _0x47f456[_0x160e43(0x2bb)]&&(_0x47f456[_0x160e43(0x2bb)]=bcrypt['hashSync'](_0x42de73[_0x160e43(0x2bb)],0xa)),_0x47f456[_0x160e43(0x23f)]=user_constant_1[_0x160e43(0x288)][_0x160e43(0x235)],!_0x47f456[_0x160e43(0x27d)]&&(_0x47f456[_0x160e43(0x27d)]=_0x47f456[_0x160e43(0x27d)]||'小智'),!_0x47f456[_0x160e43(0x312)]&&(_0x47f456[_0x160e43(0x312)]=await this[_0x160e43(0x2fa)]['getConfigByKeys']([_0x160e43(0x1f6)])),await this[_0x160e43(0x1a3)](_0x47f456),!![];}catch(_0x2b4fd3){throw new common_1['HttpException'](_0x2b4fd3[_0x160e43(0x1dd)],common_1['HttpStatus']['BAD_REQUEST']);}}[_0xb33111(0x2e1)](){const _0x336653=_0xb33111;let _0x438c49=_0x336653(0x2cf);const _0x423b50=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x3f36ad=0x0;_0x3f36ad<0xa;_0x3f36ad++){_0x438c49=_0x438c49+_0x423b50[Math[_0x336653(0x1d0)](Math['random']()*0x3f)];}return _0x438c49;}async[_0xb33111(0x273)](_0x3be04f){const _0x5b82b7=_0xb33111;let _0x32b5b2=[];for(let _0xfa106d=0x0;_0xfa106d<_0x3be04f;_0xfa106d++){_0x32b5b2[_0x5b82b7(0x1cb)](this[_0x5b82b7(0x2e1)]());}const _0x1b8be0=await this[_0x5b82b7(0x1b6)][_0x5b82b7(0x298)]({'where':{'username':(0x0,typeorm_2['In'])(_0x32b5b2)}});if(!_0x1b8be0[_0x5b82b7(0x279)])return _0x32b5b2;else{const _0x1491b6=new Set(_0x1b8be0[_0x5b82b7(0x2f0)](_0x5d6276=>_0x5d6276[_0x5b82b7(0x30d)]));_0x32b5b2=_0x32b5b2['filter'](_0x3d9b21=>!_0x1491b6['has'](_0x3d9b21));const _0x5ab7c0=await this[_0x5b82b7(0x273)](_0x1491b6[_0x5b82b7(0x222)]);return _0x32b5b2=_0x32b5b2['concat'](_0x5ab7c0),_0x32b5b2;}}async[_0xb33111(0x1f9)](_0x429482,_0x44b454){const _0x5d7677=_0xb33111;let _0xeccea0='';_0xeccea0='用户名\x09密码\x0a';const _0x4da074=await this['genUserNames'](_0x429482[_0x5d7677(0x1d8)]),_0x247944=[],_0x33ab88=[],_0x155ffa=await this[_0x5d7677(0x2fa)][_0x5d7677(0x1ab)]([_0x5d7677(0x1f6)]);for(let _0x2b0bcd=0x0;_0x2b0bcd<_0x429482['num'];_0x2b0bcd++){const _0x4a0856=new user_entity_1['UserEntity']();_0x4a0856[_0x5d7677(0x23f)]=0x1,_0x4a0856[_0x5d7677(0x312)]=_0x155ffa,_0x4a0856[_0x5d7677(0x30d)]=_0x4da074[_0x2b0bcd],_0x4a0856[_0x5d7677(0x27d)]=_0x4da074[_0x2b0bcd],_0x4a0856['password']=bcrypt[_0x5d7677(0x2a0)](_0x5d7677(0x2a1),0xa),_0xeccea0=_0xeccea0+(_0x4da074[_0x2b0bcd]+_0x5d7677(0x1c0)),_0x429482[_0x5d7677(0x234)]&&(_0x4a0856[_0x5d7677(0x234)]=Number(_0x429482[_0x5d7677(0x234)])),_0x429482['vipLeavelName']&&(_0x4a0856['vipLeavelName']=_0x429482[_0x5d7677(0x26d)]),_0x429482[_0x5d7677(0x308)]&&(_0x4a0856[_0x5d7677(0x308)]=_0x429482['score']),_0x429482[_0x5d7677(0x2ca)]&&_0x33ab88[_0x5d7677(0x1cb)]({'username':_0x4da074[_0x2b0bcd],'vipDays':_0x429482[_0x5d7677(0x2ca)]}),_0x247944[_0x5d7677(0x1cb)](_0x4a0856);}try{return await this[_0x5d7677(0x1d3)][_0x5d7677(0x27e)](async()=>{const _0x114178=_0x5d7677;await this['userEntity']['save'](_0x247944),await this[_0x114178(0x353)]['save'](_0x33ab88);}),_0xeccea0;}catch(_0x1288ec){throw new common_1['HttpException'](_0x1288ec[_0x5d7677(0x1dd)],axios_1[_0x5d7677(0x275)][_0x5d7677(0x319)]);}}async['giftScore'](_0x11e013,_0x148800){const _0x1c19e2=_0xb33111,_0xa8cef2=await this['userEntity']['findOne']({'where':{'id':_0x148800[_0x1c19e2(0x250)]}});await this[_0x1c19e2(0x1b6)]['increment']({'id':_0xa8cef2['id']},'score',_0x148800[_0x1c19e2(0x308)]),await this['userBalanceService'][_0x1c19e2(0x213)]({'userId':_0xa8cef2['id'],'rawScore':_0xa8cef2[_0x1c19e2(0x308)],'newScore':_0xa8cef2[_0x1c19e2(0x308)]+_0x148800[_0x1c19e2(0x308)],'changeScore':_0x148800[_0x1c19e2(0x308)],'changeType':balance_constant_1[_0x1c19e2(0x32b)]['AdminGift'],'rebateUserId':_0x11e013[_0x1c19e2(0x1b4)]['id'],'description':_0x1c19e2(0x2ab)});}async[_0xb33111(0x2d0)](_0x5f4ce4,_0x2a92e9){const _0x2c0051=_0xb33111,_0x23eaeb=await this[_0x2c0051(0x1b6)][_0x2c0051(0x1e1)]({'where':{'id':_0x2a92e9[_0x2c0051(0x250)]}});return await this[_0x2c0051(0x1e0)](_0x23eaeb,balance_constant_1[_0x2c0051(0x32b)][_0x2c0051(0x323)],_0x2a92e9[_0x2c0051(0x1ff)],_0x2c0051(0x2ab),_0x5f4ce4[_0x2c0051(0x1b4)]['id']),!![];}async[_0xb33111(0x231)](_0x22b472){const _0x4e12ec=_0xb33111,_0x28014c=await this[_0x4e12ec(0x353)]['findOne']({'where':{'username':_0x22b472['username']}});_0x28014c&&await this[_0x4e12ec(0x1d3)][_0x4e12ec(0x27e)](async()=>{const _0x3f4946=_0x4e12ec;_0x28014c['vipDays']===-0x1?_0x22b472[_0x3f4946(0x1d7)]=0x1:_0x22b472['vipExpire']=(0x0,date_1[_0x3f4946(0x2c6)])()[_0x3f4946(0x2ef)](_0x28014c[_0x3f4946(0x2ca)],_0x3f4946(0x1a4))['toDate'](),_0x22b472=await this[_0x3f4946(0x1b6)][_0x3f4946(0x2ce)](_0x22b472),await this[_0x3f4946(0x353)][_0x3f4946(0x360)]({'id':_0x28014c['id']});});}async['updateSignDay'](_0x2eb493,_0x30cda8){const _0x58a42c=_0xb33111;await this[_0x58a42c(0x1b6)]['update']({'id':_0x2eb493},{'consecutiveDays':_0x30cda8});}async[_0xb33111(0x31f)](_0x17027b){const _0xfedd64=_0xb33111,_0x3cb53a=await this['getUserById'](_0x17027b);_0x3cb53a[_0xfedd64(0x31b)]=_0x3cb53a[_0xfedd64(0x31b)]+0x1,await this['userEntity'][_0xfedd64(0x2ce)](_0x3cb53a);}async['changeScore4registe'](_0x1cb6ba,_0x2be570){const _0x1c0a25=_0xb33111,_0x111080=await this[_0x1c0a25(0x2fa)][_0x1c0a25(0x1ab)]([_0x1c0a25(0x2aa),'registerRewards','inviteSendStatus',_0x1c0a25(0x343),_0x1c0a25(0x2fc),_0x1c0a25(0x1a8),'invitedRewardVip']),_0x1b9993={};for(let _0x252812 in _0x111080){const _0x2d51c5=Number(_0x111080[_0x252812]),_0x5c6336=Number[_0x1c0a25(0x203)](_0x2d51c5)&&_0x2d51c5>0x0?_0x2d51c5:0x0;_0x1b9993[_0x252812]=_0x5c6336;}_0x1b9993['registerSendStatus']&&(await this[_0x1c0a25(0x1b6)]['update']({'id':_0x1cb6ba['id']},{'score':_0x1b9993['registerRewards']}),await this['userBalanceService'][_0x1c0a25(0x213)]({'userId':_0x1cb6ba['id'],'rawScore':0x0,'newScore':_0x1b9993[_0x1c0a25(0x265)],'changeScore':_0x1b9993[_0x1c0a25(0x265)],'changeType':balance_constant_1['EChangeType']['Registe'],'description':_0x1c0a25(0x2a2)}));if(_0x2be570&&_0x1b9993['inviteSendStatus']){_0x1b9993[_0x1c0a25(0x343)]&&(await this[_0x1c0a25(0x1b6)]['increment']({'id':_0x2be570['id']},_0x1c0a25(0x308),_0x1b9993['inviteRewards']),await this['userBalanceService'][_0x1c0a25(0x213)]({'userId':_0x2be570['id'],'rawScore':_0x2be570[_0x1c0a25(0x308)],'newScore':_0x2be570['score']+_0x1b9993[_0x1c0a25(0x343)],'changeScore':_0x1b9993[_0x1c0a25(0x343)],'changeType':balance_constant_1['EChangeType'][_0x1c0a25(0x261)],'rebateUserId':_0x1cb6ba['id'],'description':_0x1c0a25(0x2c1)}));_0x1b9993[_0x1c0a25(0x2fc)]&&await this[_0x1c0a25(0x1e0)](_0x2be570,balance_constant_1[_0x1c0a25(0x32b)][_0x1c0a25(0x261)],_0x1b9993['inviteRewardVip'],'邀请新用户注册奖励',_0x1cb6ba['id']);const _0x399710=await this[_0x1c0a25(0x1b6)][_0x1c0a25(0x1e1)]({'where':{'id':_0x1cb6ba['id']}});_0x1b9993['invitedRewards']&&(await this['userEntity'][_0x1c0a25(0x274)]({'id':_0x399710['id']},'score',_0x1b9993['invitedRewards']),await this['userBalanceService']['insertAccountLog']({'userId':_0x1cb6ba['id'],'rawScore':_0x399710[_0x1c0a25(0x308)],'newScore':_0x399710[_0x1c0a25(0x308)]+_0x1b9993[_0x1c0a25(0x1a8)],'changeScore':_0x1b9993[_0x1c0a25(0x1a8)],'changeType':balance_constant_1[_0x1c0a25(0x32b)][_0x1c0a25(0x30b)],'rebateUserId':_0x2be570['id'],'description':_0x1c0a25(0x31e)})),_0x1b9993[_0x1c0a25(0x34d)]&&await this[_0x1c0a25(0x1e0)](_0x399710,balance_constant_1[_0x1c0a25(0x32b)]['Invited'],_0x1b9993['invitedRewardVip'],_0x1c0a25(0x31e),_0x2be570['id']);}}async[_0xb33111(0x2d1)](_0x510a95,_0x424c8b,_0x24b65d,_0x35285d,_0x49579d){const _0x3b7942=_0xb33111;await this['userEntity'][_0x3b7942(0x304)]({'id':_0x510a95['id']},{'score':_0x510a95[_0x3b7942(0x308)]+_0x24b65d}),await this['userBalanceService'][_0x3b7942(0x213)]({'userId':_0x510a95['id'],'rawScore':_0x510a95['score'],'newScore':_0x510a95[_0x3b7942(0x308)]+_0x24b65d,'changeScore':_0x24b65d,'changeType':_0x424c8b,'relateId':_0x49579d?String(_0x49579d):null,'description':_0x35285d});}async['updateVipExpire'](_0x41ee31,_0x3339e8,_0x5a8fa5,_0x4e81f6,_0x1ba7cc){const _0x19fb4d=_0xb33111;if(_0x41ee31[_0x19fb4d(0x1d7)])return;_0x5a8fa5===-0x1?await this[_0x19fb4d(0x1b6)][_0x19fb4d(0x304)]({'id':_0x41ee31['id']},{'lifetimeVip':0x1}):(_0x41ee31[_0x19fb4d(0x1bf)]?_0x41ee31[_0x19fb4d(0x1bf)]=(0x0,date_1[_0x19fb4d(0x2c6)])(_0x41ee31[_0x19fb4d(0x1bf)])[_0x19fb4d(0x2ef)](_0x5a8fa5,'day')[_0x19fb4d(0x1e9)]():_0x41ee31[_0x19fb4d(0x1bf)]=(0x0,date_1[_0x19fb4d(0x2c6)])()['add'](_0x5a8fa5,_0x19fb4d(0x1a4))[_0x19fb4d(0x1e9)](),await this[_0x19fb4d(0x1b6)][_0x19fb4d(0x304)]({'id':_0x41ee31['id']},{'vipExpire':_0x41ee31[_0x19fb4d(0x1bf)]})),_0x41ee31=await this[_0x19fb4d(0x1b6)][_0x19fb4d(0x1e1)]({'where':{'id':_0x41ee31['id']}}),await this['userBalanceService'][_0x19fb4d(0x2c7)]({'userId':_0x41ee31['id'],'vipDays':_0x5a8fa5,'vipExpire':_0x41ee31[_0x19fb4d(0x1bf)],'relateType':_0x3339e8,'relateId':_0x1ba7cc?String(_0x1ba7cc):'','description':_0x4e81f6});}async[_0xb33111(0x348)](_0x3f1c2d,_0x427d33){const _0x39ac6a=_0xb33111;let _0x168643=!![];const _0x3981a4=await this[_0x39ac6a(0x211)](_0x3f1c2d);if(_0x3981a4['lifetimeVip']||_0x3981a4[_0x39ac6a(0x1bf)]){if(_0x427d33['vipFreeNum']<0x0)_0x168643=!![];else{if(_0x427d33[_0x39ac6a(0x303)]>0x0){const _0x366821=redisKey_constant_1['VIP_FREE']+'-'+_0x3f1c2d+'-'+_0x427d33['id'];let _0x6424d1=await this[_0x39ac6a(0x30a)][_0x39ac6a(0x2df)]({'key':_0x366821});console[_0x39ac6a(0x325)](_0x6424d1);let _0x35380f=Number(_0x6424d1||0x0);_0x35380f<_0x427d33[_0x39ac6a(0x303)]?_0x168643=!![]:_0x168643=_0x3981a4[_0x39ac6a(0x308)]>=_0x427d33[_0x39ac6a(0x313)];}else _0x168643=_0x3981a4[_0x39ac6a(0x308)]>=_0x427d33[_0x39ac6a(0x313)];}}else _0x168643=_0x3981a4['score']>=_0x427d33[_0x39ac6a(0x313)];if(!_0x168643)throw new common_1[(_0x39ac6a(0x20f))]('用户余额不足，请充值',common_1[_0x39ac6a(0x321)][_0x39ac6a(0x22f)]);}async[_0xb33111(0x22c)](_0x1ff9ac,_0x102301,_0x5a4b55){const _0x111d51=_0xb33111,_0x464823=await this[_0x111d51(0x211)](_0x1ff9ac);let _0x53d345;switch(_0x102301[_0x111d51(0x205)]){case model_constant_1[_0x111d51(0x1df)][_0x111d51(0x26f)]:_0x53d345=balance_constant_1[_0x111d51(0x32b)][_0x111d51(0x26f)];break;case model_constant_1[_0x111d51(0x1df)][_0x111d51(0x25f)]:_0x53d345=balance_constant_1[_0x111d51(0x32b)][_0x111d51(0x2e3)];break;case model_constant_1[_0x111d51(0x1df)]['MUSIC']:_0x53d345=balance_constant_1[_0x111d51(0x32b)]['Music'];break;case model_constant_1['EModelType']['VIDEO']:_0x53d345=balance_constant_1[_0x111d51(0x32b)][_0x111d51(0x2e0)];break;case model_constant_1[_0x111d51(0x1df)]['DRAW']:_0x53d345=balance_constant_1[_0x111d51(0x32b)][_0x111d51(0x2ba)];break;case model_constant_1['EModelType']['CHAT']:_0x53d345=balance_constant_1[_0x111d51(0x32b)]['Chat'];break;case model_constant_1[_0x111d51(0x1df)][_0x111d51(0x2c3)]:_0x53d345=balance_constant_1[_0x111d51(0x32b)]['Tool'];break;case model_constant_1[_0x111d51(0x1df)]['FILE']:_0x53d345=balance_constant_1['EChangeType'][_0x111d51(0x2e2)];break;case model_constant_1[_0x111d51(0x1df)][_0x111d51(0x30c)]:_0x53d345=balance_constant_1['EChangeType']['Tts'];break;default:_0x53d345=balance_constant_1['EChangeType'][_0x111d51(0x352)];}if(_0x464823[_0x111d51(0x1d7)]||_0x464823[_0x111d51(0x1bf)]){if(_0x102301[_0x111d51(0x303)]<0x0)await this[_0x111d51(0x2d1)](_0x464823,_0x53d345,0x0,_0x111d51(0x2e8)+_0x102301['modelName']+'】会员永久免费',_0x5a4b55);else{if(_0x102301[_0x111d51(0x303)]>0x0){const _0x26430b=redisKey_constant_1[_0x111d51(0x20e)]+'-'+_0x1ff9ac+'-'+_0x102301['id'];let _0x433dd6=await this[_0x111d51(0x30a)]['get']({'key':_0x26430b}),_0x512804=Number(_0x433dd6||0x0);if(_0x512804<_0x102301['vipFreeNum']){const _0x3878af=(0x0,date_1[_0x111d51(0x2c6)])()['endOf']('d')[_0x111d51(0x2a8)]((0x0,date_1[_0x111d51(0x2c6)])(),'s');await this[_0x111d51(0x30a)][_0x111d51(0x311)]({'key':_0x26430b,'val':_0x512804+0x1},_0x3878af),await this[_0x111d51(0x2d1)](_0x464823,_0x53d345,0x0,_0x111d51(0x2e8)+_0x102301[_0x111d51(0x238)]+'】会员每日限免',_0x5a4b55);}else await this[_0x111d51(0x2d1)](_0x464823,_0x53d345,-_0x102301[_0x111d51(0x313)],_0x111d51(0x2e8)+_0x102301[_0x111d51(0x238)]+_0x111d51(0x26a),_0x5a4b55);}else await this[_0x111d51(0x2d1)](_0x464823,_0x53d345,-_0x102301[_0x111d51(0x313)],'模型【'+_0x102301['modelName']+_0x111d51(0x26a),_0x5a4b55);}}else await this[_0x111d51(0x2d1)](_0x464823,_0x53d345,-_0x102301[_0x111d51(0x313)],'模型【'+_0x102301[_0x111d51(0x238)]+_0x111d51(0x26a),_0x5a4b55);}async[_0xb33111(0x23c)](_0x3fc29b,_0x2fc7ec,_0x54ce40){const _0x7a8fa1=_0xb33111,_0x57f51a=await this[_0x7a8fa1(0x211)](_0x3fc29b);if(_0x57f51a[_0x7a8fa1(0x1d7)]||_0x57f51a[_0x7a8fa1(0x1bf)]){if(_0x2fc7ec[_0x7a8fa1(0x303)]<0x0){}else{if(_0x2fc7ec[_0x7a8fa1(0x303)]>0x0){const _0x52e953=redisKey_constant_1[_0x7a8fa1(0x20e)]+'-'+_0x3fc29b+'-'+_0x2fc7ec['id'];let _0x124762=await this[_0x7a8fa1(0x30a)]['get']({'key':_0x52e953}),_0x4c093e=Number(_0x124762||0x0);if(_0x4c093e>=_0x2fc7ec[_0x7a8fa1(0x303)]){const _0x536466=(0x0,date_1[_0x7a8fa1(0x2c6)])()[_0x7a8fa1(0x2eb)]('d')[_0x7a8fa1(0x2a8)]((0x0,date_1[_0x7a8fa1(0x2c6)])(),'s');await this[_0x7a8fa1(0x30a)][_0x7a8fa1(0x311)]({'key':_0x52e953,'val':_0x4c093e-0x1},_0x536466);}else await this['changeScore4Other'](_0x57f51a,balance_constant_1['EChangeType'][_0x7a8fa1(0x2e0)],_0x2fc7ec[_0x7a8fa1(0x313)],'模型【'+_0x2fc7ec[_0x7a8fa1(0x238)]+_0x7a8fa1(0x354),_0x54ce40);}else await this[_0x7a8fa1(0x2d1)](_0x57f51a,balance_constant_1[_0x7a8fa1(0x32b)][_0x7a8fa1(0x2e0)],_0x2fc7ec[_0x7a8fa1(0x313)],_0x7a8fa1(0x2e8)+_0x2fc7ec[_0x7a8fa1(0x238)]+_0x7a8fa1(0x354),_0x54ce40);}}else await this[_0x7a8fa1(0x2d1)](_0x57f51a,balance_constant_1['EChangeType'][_0x7a8fa1(0x2e0)],_0x2fc7ec[_0x7a8fa1(0x313)],_0x7a8fa1(0x2e8)+_0x2fc7ec[_0x7a8fa1(0x238)]+'】失败退还',_0x54ce40);}async[_0xb33111(0x1b3)](_0x5589e6,_0x23d44e,_0xc26ec4){const _0x4d4b17=_0xb33111,_0xdf05bc=await this['getUserById'](_0x5589e6);let _0x533f38;switch(_0x23d44e[_0x4d4b17(0x205)]){case model_constant_1[_0x4d4b17(0x1df)][_0x4d4b17(0x25f)]:_0x533f38=balance_constant_1[_0x4d4b17(0x32b)][_0x4d4b17(0x2e3)];break;case model_constant_1[_0x4d4b17(0x1df)]['MUSIC']:_0x533f38=balance_constant_1[_0x4d4b17(0x32b)][_0x4d4b17(0x1de)];break;case model_constant_1[_0x4d4b17(0x1df)][_0x4d4b17(0x242)]:_0x533f38=balance_constant_1['EChangeType'][_0x4d4b17(0x2ba)];break;case model_constant_1[_0x4d4b17(0x1df)]['CHAT']:_0x533f38=balance_constant_1[_0x4d4b17(0x32b)][_0x4d4b17(0x352)];break;case model_constant_1[_0x4d4b17(0x1df)][_0x4d4b17(0x2c3)]:_0x533f38=balance_constant_1[_0x4d4b17(0x32b)][_0x4d4b17(0x1fc)];break;case model_constant_1[_0x4d4b17(0x1df)][_0x4d4b17(0x2e0)]:_0x533f38=balance_constant_1[_0x4d4b17(0x32b)]['VIDEO'];break;default:_0x533f38=balance_constant_1['EChangeType']['Chat'];}await this['changeScore4Other'](_0xdf05bc,_0x533f38,_0x23d44e[_0x4d4b17(0x313)],_0x4d4b17(0x2e8)+_0x23d44e[_0x4d4b17(0x238)]+_0x4d4b17(0x2b9),_0xc26ec4);}async[_0xb33111(0x30f)](_0x1e1eb6,_0x292dc7,_0x285f69){const _0x3b4bdb=_0xb33111;let _0x3597e1='',_0x46a270='',_0x15f568='',_0xad16d0=_0x292dc7;const _0x1bd9a8=_0x292dc7[_0x3b4bdb(0x293)](),_0x592b9d=new RegExp('imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll'),_0x3afddd=new RegExp('upscale|describe|picread::retry|faceswap|shorten'),_0x4837b0=new RegExp(_0x3b4bdb(0x294));if(_0x1e1eb6===midjourney_constant_1['DrawSpeed'][_0x3b4bdb(0x337)])_0x46a270='type1',_0x3597e1='fast_mjDeduction',_0x15f568='fast_vip_free';else{if(_0x1e1eb6===midjourney_constant_1['DrawSpeed'][_0x3b4bdb(0x216)])_0x46a270=_0x3b4bdb(0x28c),_0x3597e1=_0x3b4bdb(0x2f5),_0x15f568=_0x3b4bdb(0x1c9);else _0x1e1eb6===midjourney_constant_1[_0x3b4bdb(0x240)][_0x3b4bdb(0x237)]&&(_0x46a270=_0x3b4bdb(0x20a),_0x3597e1=_0x3b4bdb(0x223),_0x15f568=_0x3b4bdb(0x1e8));}if(_0x592b9d[_0x3b4bdb(0x1f8)](_0x1bd9a8))_0x3597e1=_0x3597e1+0x1;else{if(_0x3afddd[_0x3b4bdb(0x1f8)](_0x1bd9a8))_0x3597e1=_0x3597e1+0x2;else _0x4837b0[_0x3b4bdb(0x1f8)](_0x1bd9a8)&&(_0x3597e1=_0x3597e1+0x3);}const _0x15c376={},_0xa9f7ca=await this[_0x3b4bdb(0x2fa)][_0x3b4bdb(0x1ab)]([_0x3597e1,_0x15f568]);for(let _0x3ef955 in _0xa9f7ca){_0x15c376[_0x3ef955]=Number(_0xa9f7ca[_0x3ef955])||0x0;}if(_0x285f69[_0x3b4bdb(0x234)]){const _0x1a7037=await this['globalConfigService'][_0x3b4bdb(0x1fa)](_0x285f69['vipLeavelId'],'mj');_0x1a7037&&(_0x15c376[_0x15f568]=_0x1a7037[_0x46a270]||0x0);}for(let _0x479cf4 in midjourney_constant_1['ActionCN']){if(_0x1bd9a8[_0x3b4bdb(0x19d)](midjourney_constant_1[_0x3b4bdb(0x1b5)][_0x479cf4][_0x3b4bdb(0x255)])){_0xad16d0=midjourney_constant_1[_0x3b4bdb(0x1b5)][_0x479cf4]['cn'];break;}}return{'price':_0x15c376[_0x3597e1],'vipFreeNum':_0x15c376[_0x15f568],'vipFreeKey':_0x15f568,'description':_0xad16d0};}async[_0xb33111(0x1e7)](_0x47e424,_0x525e0a=midjourney_constant_1['DrawSpeed']['relax'],_0x11b1b2){const _0x8fa420=_0xb33111;let _0x53fef5=!![];const _0x574505=await this['getUserById'](_0x47e424),_0x1b0cea=await this[_0x8fa420(0x30f)](_0x525e0a,_0x11b1b2,_0x574505);if(_0x574505[_0x8fa420(0x1d7)]||_0x574505['vipExpire']){if(_0x1b0cea[_0x8fa420(0x303)]<0x0)_0x53fef5=!![];else{if(_0x1b0cea[_0x8fa420(0x303)]>0x0){const _0xf04772=redisKey_constant_1['VIP_FREE']+'-'+_0x47e424+'-'+_0x1b0cea['vipFreeKey'];let _0xcdd0e2=await this[_0x8fa420(0x30a)]['get']({'key':_0xf04772}),_0x15f64d=Number(_0xcdd0e2||0x0);_0x15f64d<_0x1b0cea[_0x8fa420(0x303)]?_0x53fef5=!![]:_0x53fef5=_0x574505[_0x8fa420(0x308)]>=_0x1b0cea[_0x8fa420(0x28d)];}else _0x53fef5=_0x574505[_0x8fa420(0x308)]>=_0x1b0cea[_0x8fa420(0x28d)];}}else _0x53fef5=_0x574505[_0x8fa420(0x308)]>=_0x1b0cea[_0x8fa420(0x28d)];if(_0x525e0a===midjourney_constant_1[_0x8fa420(0x240)][_0x8fa420(0x216)]){if(!_0x53fef5)throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0x8fa420(0x321)][_0x8fa420(0x22f)]);}else{if(!_0x53fef5)return this[_0x8fa420(0x1e7)](_0x47e424,midjourney_constant_1[_0x8fa420(0x240)][_0x8fa420(0x216)],_0x11b1b2);}return _0x525e0a;}async[_0xb33111(0x320)](_0x389fd3,_0x214bc3,_0xb91f8c,_0x10a463){const _0xd1ad91=_0xb33111,_0x36bce8=await this['getUserById'](_0x389fd3),_0x5bd5ed=await this[_0xd1ad91(0x30f)](_0x214bc3,_0xb91f8c,_0x36bce8),_0x4efe48=balance_constant_1['EChangeType'][_0xd1ad91(0x23a)];if(_0x36bce8[_0xd1ad91(0x1d7)]||_0x36bce8[_0xd1ad91(0x1bf)]){if(_0x5bd5ed[_0xd1ad91(0x303)]<0x0)await this['changeScore4Other'](_0x36bce8,_0x4efe48,0x0,_0xd1ad91(0x24e)+_0x5bd5ed[_0xd1ad91(0x31d)]+'】会员永久免费',_0x10a463);else{if(_0x5bd5ed[_0xd1ad91(0x303)]>0x0){const _0x2743ae=redisKey_constant_1[_0xd1ad91(0x20e)]+'-'+_0x389fd3+'-'+_0x5bd5ed[_0xd1ad91(0x331)];let _0x3487eb=await this[_0xd1ad91(0x30a)][_0xd1ad91(0x2df)]({'key':_0x2743ae}),_0x43dbce=Number(_0x3487eb||0x0);if(_0x43dbce<_0x5bd5ed[_0xd1ad91(0x303)]){const _0x234735=(0x0,date_1[_0xd1ad91(0x2c6)])()['endOf']('d')['diff']((0x0,date_1[_0xd1ad91(0x2c6)])(),'s');await this['redisCacheService'][_0xd1ad91(0x311)]({'key':_0x2743ae,'val':_0x43dbce+0x1},_0x234735),await this['changeScore4Other'](_0x36bce8,_0x4efe48,0x0,_0xd1ad91(0x24e)+_0x5bd5ed[_0xd1ad91(0x31d)]+_0xd1ad91(0x1a6),_0x10a463);}else await this['changeScore4Other'](_0x36bce8,_0x4efe48,-_0x5bd5ed[_0xd1ad91(0x28d)],'MJ绘画【'+_0x5bd5ed[_0xd1ad91(0x31d)]+_0xd1ad91(0x26a),_0x10a463);}else await this['changeScore4Other'](_0x36bce8,_0x4efe48,-_0x5bd5ed[_0xd1ad91(0x28d)],_0xd1ad91(0x24e)+_0x5bd5ed['description']+_0xd1ad91(0x26a),_0x10a463);}}else await this[_0xd1ad91(0x2d1)](_0x36bce8,_0x4efe48,-_0x5bd5ed[_0xd1ad91(0x28d)],'MJ绘画【'+_0x5bd5ed[_0xd1ad91(0x31d)]+'】使用扣减',_0x10a463);}async[_0xb33111(0x33f)](_0x282259,_0x291329,_0x10a09a,_0x3b7d1a){const _0x4596e4=_0xb33111,_0x3f71ec=await this[_0x4596e4(0x211)](_0x282259),_0x5e65cc=await this['getMjPrice'](_0x291329,_0x10a09a,_0x3f71ec),_0x518655=balance_constant_1[_0x4596e4(0x32b)]['MjDraw'];if(_0x3f71ec[_0x4596e4(0x1d7)]||_0x3f71ec['vipExpire']){if(_0x5e65cc[_0x4596e4(0x303)]<0x0)return;else{if(_0x5e65cc['vipFreeNum']>0x0){const _0x7b18e0=redisKey_constant_1[_0x4596e4(0x20e)]+'-'+_0x282259+'-'+_0x5e65cc['vipFreeKey'];let _0x1be9ed=await this[_0x4596e4(0x30a)][_0x4596e4(0x2df)]({'key':_0x7b18e0}),_0x2a348c=Number(_0x1be9ed||0x0);if(_0x2a348c<_0x5e65cc[_0x4596e4(0x303)]){const _0x127444=(0x0,date_1[_0x4596e4(0x2c6)])()[_0x4596e4(0x2eb)]('d')['diff']((0x0,date_1[_0x4596e4(0x2c6)])(),'s');await this['redisCacheService'][_0x4596e4(0x311)]({'key':_0x7b18e0,'val':_0x2a348c-0x1},_0x127444);return;}}}}await this[_0x4596e4(0x2d1)](_0x3f71ec,_0x518655,_0x5e65cc[_0x4596e4(0x28d)],_0x4596e4(0x24e)+_0x5e65cc[_0x4596e4(0x31d)]+_0x4596e4(0x281),_0x3b7d1a);}async['debuctBalance4Muisc'](_0x151d21,_0x18213b,_0x8ffd5,_0x3d5b7e=![]){const _0x242cf8=_0xb33111,_0xb4b954={'create':{'key':_0x242cf8(0x29d),'desc':_0x242cf8(0x306)},'lyrics':{'key':_0x242cf8(0x33e),'desc':'歌词生成'},'upload':{'key':'musicUpload','desc':_0x242cf8(0x1cd)}},_0x2d8c21=_0xb4b954[_0x8ffd5][_0x242cf8(0x2d8)],_0x195ddc=_0xb4b954[_0x8ffd5][_0x242cf8(0x28b)]+_0x242cf8(0x28f),_0x589a6b=_0xb4b954[_0x8ffd5][_0x242cf8(0x28b)]+'VipFree',_0x5c08cc={},_0x385cd3=await this[_0x242cf8(0x2fa)][_0x242cf8(0x1ab)]([_0x195ddc,_0x589a6b]);for(let _0x30c9f0 in _0x385cd3){_0x5c08cc[_0x30c9f0]=Number(_0x385cd3[_0x30c9f0])||0x0;}const _0x5b69e3=await this[_0x242cf8(0x211)](_0x151d21);if(_0x5b69e3[_0x242cf8(0x1d7)]||_0x5b69e3[_0x242cf8(0x1bf)]){if(_0x5c08cc[_0x589a6b]<0x0){!_0x3d5b7e&&await this[_0x242cf8(0x2d1)](_0x5b69e3,balance_constant_1['EChangeType'][_0x242cf8(0x1de)],0x0,'音乐【'+_0x2d8c21+_0x242cf8(0x2e6),_0x18213b);return;}else{if(_0x5c08cc[_0x589a6b]>0x0){const _0xe8598c=redisKey_constant_1[_0x242cf8(0x20e)]+'-'+_0x151d21+'-'+_0x589a6b;let _0x5b4f43=await this['redisCacheService']['get']({'key':_0xe8598c}),_0x32881e=Number(_0x5b4f43||0x0);if(!_0x3d5b7e){if(_0x32881e<_0x5c08cc[_0x589a6b]){const _0x1c2108=(0x0,date_1[_0x242cf8(0x2c6)])()['endOf']('d')[_0x242cf8(0x2a8)]((0x0,date_1[_0x242cf8(0x2c6)])(),'s');await this[_0x242cf8(0x30a)][_0x242cf8(0x311)]({'key':_0xe8598c,'val':_0x32881e+0x1},_0x1c2108),await this[_0x242cf8(0x2d1)](_0x5b69e3,balance_constant_1[_0x242cf8(0x32b)][_0x242cf8(0x1de)],0x0,_0x242cf8(0x1d1)+_0x2d8c21+_0x242cf8(0x1a6),_0x18213b);return;}}else{const _0x28f452=(0x0,date_1[_0x242cf8(0x2c6)])()[_0x242cf8(0x2eb)]('d')[_0x242cf8(0x2a8)]((0x0,date_1[_0x242cf8(0x2c6)])(),'s');await this['redisCacheService'][_0x242cf8(0x311)]({'key':_0xe8598c,'val':_0x32881e-0x1},_0x28f452);return;}}}}if(!_0x3d5b7e&&_0x5b69e3[_0x242cf8(0x308)]<_0x5c08cc[_0x195ddc])throw new common_1['HttpException'](_0x242cf8(0x22e),common_1[_0x242cf8(0x321)]['BAD_REQUEST']);if(!_0x3d5b7e){await this[_0x242cf8(0x2d1)](_0x5b69e3,balance_constant_1['EChangeType'][_0x242cf8(0x1de)],-_0x5c08cc[_0x195ddc],_0x242cf8(0x1d1)+_0x2d8c21+_0x242cf8(0x26a),_0x18213b);return;}await this[_0x242cf8(0x2d1)](_0x5b69e3,balance_constant_1[_0x242cf8(0x32b)][_0x242cf8(0x1de)],_0x5c08cc[_0x195ddc],_0x242cf8(0x1d1)+_0x2d8c21+'】生成失败退还',_0x18213b);}async[_0xb33111(0x301)](_0x138b15,_0x113166,_0x10bf41,_0x321f61=![]){const _0x71d481=_0xb33111,_0xbe6bdc={'structure':{'key':_0x71d481(0x2c2),'vlrk':_0x71d481(0x210),'desc':_0x71d481(0x341)},'cover':{'key':_0x71d481(0x2c2),'vlrk':_0x71d481(0x210),'desc':'封面任务'},'recover':{'key':'pptOutline','vlrk':_0x71d481(0x210),'desc':'重新生成封面任务'},'create':{'key':_0x71d481(0x236),'vlrk':'type2','desc':_0x71d481(0x1e4)},'thesis':{'key':_0x71d481(0x2c4),'vlrk':_0x71d481(0x20a),'desc':_0x71d481(0x338)},'file':{'key':_0x71d481(0x236),'vlrk':_0x71d481(0x28c),'desc':_0x71d481(0x24a)},'theme':{'key':_0x71d481(0x236),'vlrk':_0x71d481(0x28c),'desc':_0x71d481(0x2bd)},'editor':{'key':_0x71d481(0x351),'vlrk':_0x71d481(0x210),'desc':'编辑PPT'},'addpage':{'key':_0x71d481(0x236),'vlrk':_0x71d481(0x28c),'desc':_0x71d481(0x305)},'addNotes':{'key':_0x71d481(0x236),'vlrk':_0x71d481(0x28c),'desc':'增加PPT备注'}},_0x1aa251=_0xbe6bdc[_0x10bf41][_0x71d481(0x2d8)],_0x296d0d=_0xbe6bdc[_0x10bf41]['key']+_0x71d481(0x28f),_0xa636d9=_0xbe6bdc[_0x10bf41][_0x71d481(0x28b)]+_0x71d481(0x2c9),_0x228e35={},_0x25f397=await this[_0x71d481(0x2fa)]['getConfigByKeys']([_0x296d0d,_0xa636d9]);for(let _0x416d6d in _0x25f397){_0x228e35[_0x416d6d]=Number(_0x25f397[_0x416d6d])||0x0;}const _0x195ac9=await this[_0x71d481(0x211)](_0x138b15);if(_0x195ac9[_0x71d481(0x234)]){const _0x4d1035=await this[_0x71d481(0x2fa)][_0x71d481(0x1fa)](_0x195ac9[_0x71d481(0x234)],model_constant_1[_0x71d481(0x1df)][_0x71d481(0x26f)]);_0x4d1035&&(_0x228e35[_0xa636d9]=_0x4d1035[_0xbe6bdc[_0x10bf41][_0x71d481(0x269)]]||0x0);}if(_0x195ac9['lifetimeVip']||_0x195ac9[_0x71d481(0x1bf)]){if(_0x228e35[_0xa636d9]<0x0){!_0x321f61&&await this['changeScore4Other'](_0x195ac9,balance_constant_1['EChangeType'][_0x71d481(0x26f)],0x0,_0x71d481(0x2c5)+_0x1aa251+'】会员永久免费',_0x113166);return;}else{if(_0x228e35[_0xa636d9]>0x0){const _0x1b9f43=redisKey_constant_1['VIP_FREE']+'-'+_0x138b15+'-'+_0xa636d9;let _0x5d8862=await this[_0x71d481(0x30a)][_0x71d481(0x2df)]({'key':_0x1b9f43}),_0x275d29=Number(_0x5d8862||0x0);if(!_0x321f61){if(_0x275d29<_0x228e35[_0xa636d9]){const _0xfbebe1=(0x0,date_1[_0x71d481(0x2c6)])()[_0x71d481(0x2eb)]('d')['diff']((0x0,date_1['default'])(),'s');await this[_0x71d481(0x30a)][_0x71d481(0x311)]({'key':_0x1b9f43,'val':_0x275d29+0x1},_0xfbebe1),await this['changeScore4Other'](_0x195ac9,balance_constant_1[_0x71d481(0x32b)]['PPT'],0x0,_0x71d481(0x2c5)+_0x1aa251+_0x71d481(0x1a6),_0x113166);return;}}else{const _0x5bf082=(0x0,date_1[_0x71d481(0x2c6)])()[_0x71d481(0x2eb)]('d')[_0x71d481(0x2a8)]((0x0,date_1['default'])(),'s');await this['redisCacheService'][_0x71d481(0x311)]({'key':_0x1b9f43,'val':_0x275d29-0x1},_0x5bf082);return;}}}}if(!_0x321f61&&_0x195ac9[_0x71d481(0x308)]<_0x228e35[_0x296d0d])throw new common_1['HttpException'](_0x71d481(0x22e),common_1[_0x71d481(0x321)][_0x71d481(0x22f)]);if(!_0x321f61){await this[_0x71d481(0x2d1)](_0x195ac9,balance_constant_1[_0x71d481(0x32b)][_0x71d481(0x26f)],-_0x228e35[_0x296d0d],_0x71d481(0x2c5)+_0x1aa251+_0x71d481(0x26a),_0x113166);return;}await this['changeScore4Other'](_0x195ac9,balance_constant_1[_0x71d481(0x32b)][_0x71d481(0x26f)],_0x228e35[_0x296d0d],_0x71d481(0x2c5)+_0x1aa251+'】生成失败退还',_0x113166);}async[_0xb33111(0x2b7)](_0x2d6013,_0x476f73,_0x4dbf23){const _0x4b5fc6=_0xb33111,_0x3bb9e7=await this[_0x4b5fc6(0x211)](_0x2d6013);if(_0x3bb9e7[_0x4b5fc6(0x1d7)]||_0x3bb9e7[_0x4b5fc6(0x1bf)]){if(_0x476f73[_0x4b5fc6(0x303)]<0x0)await this[_0x4b5fc6(0x2d1)](_0x3bb9e7,balance_constant_1[_0x4b5fc6(0x32b)]['WORKFLOW'],0x0,_0x4b5fc6(0x2b0)+_0x476f73[_0x4b5fc6(0x238)]+_0x4b5fc6(0x2e6),_0x4dbf23);else{if(_0x476f73['vipFreeNum']>0x0){const _0xcd9bff=redisKey_constant_1[_0x4b5fc6(0x20e)]+'-'+_0x2d6013+'-'+_0x476f73['id'];let _0x4a9e21=await this[_0x4b5fc6(0x30a)][_0x4b5fc6(0x2df)]({'key':_0xcd9bff}),_0x2bb172=Number(_0x4a9e21||0x0);if(_0x2bb172<_0x476f73[_0x4b5fc6(0x303)]){const _0x336b9a=(0x0,date_1['default'])()['endOf']('d')[_0x4b5fc6(0x2a8)]((0x0,date_1['default'])(),'s');await this[_0x4b5fc6(0x30a)]['set']({'key':_0xcd9bff,'val':_0x2bb172+0x1},_0x336b9a),await this[_0x4b5fc6(0x2d1)](_0x3bb9e7,balance_constant_1[_0x4b5fc6(0x32b)]['WORKFLOW'],0x0,_0x4b5fc6(0x2b0)+_0x476f73[_0x4b5fc6(0x238)]+'】会员每日限免',_0x4dbf23);}else await this['changeScore4Other'](_0x3bb9e7,balance_constant_1[_0x4b5fc6(0x32b)][_0x4b5fc6(0x326)],-_0x476f73['deduct'],_0x4b5fc6(0x2b0)+_0x476f73[_0x4b5fc6(0x238)]+_0x4b5fc6(0x26a),_0x4dbf23);}else await this[_0x4b5fc6(0x2d1)](_0x3bb9e7,balance_constant_1['EChangeType'][_0x4b5fc6(0x326)],-_0x476f73['deduct'],_0x4b5fc6(0x2b0)+_0x476f73[_0x4b5fc6(0x238)]+_0x4b5fc6(0x26a),_0x4dbf23);}}else await this['changeScore4Other'](_0x3bb9e7,balance_constant_1[_0x4b5fc6(0x32b)][_0x4b5fc6(0x326)],-_0x476f73[_0x4b5fc6(0x313)],_0x4b5fc6(0x2b0)+_0x476f73[_0x4b5fc6(0x238)]+_0x4b5fc6(0x26a),_0x4dbf23);}async['deductBalance4SD'](_0x337eb9,_0x280e2f){const _0x2de40f=_0xb33111,_0x3b10b4=store_1[_0x2de40f(0x324)][_0x2de40f(0x19b)],_0x5b57d7=await this[_0x2de40f(0x211)](_0x337eb9),_0x47eec3=balance_constant_1[_0x2de40f(0x32b)]['SD'];if(_0x5b57d7[_0x2de40f(0x1d7)]||_0x5b57d7[_0x2de40f(0x1bf)]){if(store_1['CZConfig'][_0x2de40f(0x32a)]<0x0)await this['changeScore4Other'](_0x5b57d7,_0x47eec3,0x0,_0x2de40f(0x268),_0x280e2f);else{if(store_1[_0x2de40f(0x324)][_0x2de40f(0x32a)]>0x0){const _0x110688=redisKey_constant_1[_0x2de40f(0x20e)]+'-'+_0x337eb9+_0x2de40f(0x1f0);let _0x35bdb5=await this[_0x2de40f(0x30a)][_0x2de40f(0x2df)]({'key':_0x110688}),_0x4b80cf=Number(_0x35bdb5||0x0);if(_0x4b80cf<store_1['CZConfig'][_0x2de40f(0x32a)]){const _0x2eff7d=(0x0,date_1[_0x2de40f(0x2c6)])()[_0x2de40f(0x2eb)]('d')[_0x2de40f(0x2a8)]((0x0,date_1[_0x2de40f(0x2c6)])(),'s');await this[_0x2de40f(0x30a)][_0x2de40f(0x311)]({'key':_0x110688,'val':_0x4b80cf+0x1},_0x2eff7d),await this[_0x2de40f(0x2d1)](_0x5b57d7,_0x47eec3,0x0,'SD绘画【'+_0x3b10b4+_0x2de40f(0x1a6),_0x280e2f);}else await this[_0x2de40f(0x2d1)](_0x5b57d7,_0x47eec3,-_0x3b10b4,_0x2de40f(0x221)+_0x3b10b4+'】使用扣减',_0x280e2f);}else await this[_0x2de40f(0x2d1)](_0x5b57d7,_0x47eec3,-_0x3b10b4,_0x2de40f(0x221)+_0x3b10b4+_0x2de40f(0x26a),_0x280e2f);}}else await this['changeScore4Other'](_0x5b57d7,_0x47eec3,-_0x3b10b4,_0x2de40f(0x221)+_0x3b10b4+_0x2de40f(0x26a),_0x280e2f);}async[_0xb33111(0x2d4)](_0x3c60cb,_0xce88a8){const _0x32f6f2=_0xb33111,_0x52cabb=redisKey_constant_1['VIP_FREE']+'-'+_0x3c60cb+'-'+_0xce88a8['id'];let _0x32de95=await this[_0x32f6f2(0x30a)][_0x32f6f2(0x2df)]({'key':_0x52cabb}),_0x2618d6=Number(_0x32de95||0x0);return _0xce88a8[_0x32f6f2(0x303)]-_0x2618d6;}async[_0xb33111(0x2d3)](_0x251dbf){const _0x2667b9=_0xb33111,_0x4600e4=redisKey_constant_1[_0x2667b9(0x20e)]+'-'+_0x251dbf+_0x2667b9(0x1f3);let _0x86fdc=await this[_0x2667b9(0x30a)]['get']({'key':_0x4600e4}),_0x371722=Number(_0x86fdc||0x0);return store_1['LinkFoxConfig'][_0x2667b9(0x199)]-_0x371722;}async[_0xb33111(0x227)](_0x5aca4b,_0x58b66c,_0x1f8879){const _0x40ab25=_0xb33111;let _0x1f8361=await this['redisCacheService'][_0x40ab25(0x2df)]({'key':_0x58b66c}),_0x2ed92a=Number(_0x1f8361||0x0);return _0x1f8879-_0x2ed92a;}async[_0xb33111(0x218)](_0xd124b9){const _0x2ae48f=_0xb33111;let _0x2e49e0=!![];const _0x48e7bd=await this['getUserById'](_0xd124b9);if(_0x48e7bd[_0x2ae48f(0x1d7)]||_0x48e7bd['vipExpire']){if(store_1[_0x2ae48f(0x1a7)]['lfVipFree']<0x0)_0x2e49e0=!![];else{if(store_1[_0x2ae48f(0x1a7)][_0x2ae48f(0x199)]>0x0){const _0x5f57c2=await this[_0x2ae48f(0x2d3)](_0xd124b9);_0x5f57c2>0x0?_0x2e49e0=!![]:_0x2e49e0=_0x48e7bd[_0x2ae48f(0x308)]>=store_1[_0x2ae48f(0x1a7)][_0x2ae48f(0x1be)];}else _0x2e49e0=_0x48e7bd[_0x2ae48f(0x308)]>=store_1[_0x2ae48f(0x1a7)][_0x2ae48f(0x1be)];}}else _0x2e49e0=_0x48e7bd[_0x2ae48f(0x308)]>=store_1[_0x2ae48f(0x1a7)][_0x2ae48f(0x1be)];if(!_0x2e49e0)throw new common_1[(_0x2ae48f(0x20f))](_0x2ae48f(0x22e),common_1['HttpStatus'][_0x2ae48f(0x22f)]);}async['deductBalanceLinxFox'](_0x16c9ef,_0x47ea11){const _0x2e9a67=_0xb33111,_0x4d1767=store_1[_0x2e9a67(0x1a7)][_0x2e9a67(0x1be)],_0x19f9a8=await this[_0x2e9a67(0x211)](_0x16c9ef),_0x1e998e=balance_constant_1[_0x2e9a67(0x32b)][_0x2e9a67(0x253)];if(_0x19f9a8['lifetimeVip']||_0x19f9a8[_0x2e9a67(0x1bf)]){if(store_1[_0x2e9a67(0x1a7)][_0x2e9a67(0x199)]<0x0)await this[_0x2e9a67(0x2d1)](_0x19f9a8,_0x1e998e,0x0,_0x2e9a67(0x247),_0x47ea11);else{if(store_1[_0x2e9a67(0x1a7)]['lfVipFree']>0x0){const _0x33af0e=redisKey_constant_1[_0x2e9a67(0x20e)]+'-'+_0x16c9ef+'-LinkFox';let _0x2e9a02=await this[_0x2e9a67(0x30a)][_0x2e9a67(0x2df)]({'key':_0x33af0e}),_0x459226=Number(_0x2e9a02||0x0);if(_0x459226<store_1[_0x2e9a67(0x1a7)][_0x2e9a67(0x199)]){const _0x1185d4=(0x0,date_1[_0x2e9a67(0x2c6)])()[_0x2e9a67(0x2eb)]('d')[_0x2e9a67(0x2a8)]((0x0,date_1[_0x2e9a67(0x2c6)])(),'s');await this[_0x2e9a67(0x30a)][_0x2e9a67(0x311)]({'key':_0x33af0e,'val':_0x459226+0x1},_0x1185d4),await this['changeScore4Other'](_0x19f9a8,_0x1e998e,0x0,_0x2e9a67(0x2a3)+_0x4d1767+'】会员每日限免',_0x47ea11);}else await this['changeScore4Other'](_0x19f9a8,_0x1e998e,-_0x4d1767,'LinxFox【【'+_0x4d1767+'】使用扣减',_0x47ea11);}else await this[_0x2e9a67(0x2d1)](_0x19f9a8,_0x1e998e,-_0x4d1767,'LinxFox【【'+_0x4d1767+_0x2e9a67(0x26a),_0x47ea11);}}else await this[_0x2e9a67(0x2d1)](_0x19f9a8,_0x1e998e,-_0x4d1767,'LinxFox【【'+_0x4d1767+_0x2e9a67(0x26a),_0x47ea11);}async[_0xb33111(0x270)](){const _0x3a0a2e=_0xb33111,_0x4b303b=await this[_0x3a0a2e(0x1b6)][_0x3a0a2e(0x298)]({'where':{'vipExpire':(0x0,typeorm_2[_0x3a0a2e(0x2f6)])((0x0,date_1[_0x3a0a2e(0x2c6)])()['startOf']('d')[_0x3a0a2e(0x1e9)](),(0x0,date_1[_0x3a0a2e(0x2c6)])()[_0x3a0a2e(0x2eb)]('d')['toDate']())}});if(_0x4b303b[_0x3a0a2e(0x279)])for(let _0x42c56a=0x0;_0x42c56a<_0x4b303b['length'];_0x42c56a++){const _0x2b9e2c=_0x4b303b[_0x42c56a];await this[_0x3a0a2e(0x30a)][_0x3a0a2e(0x311)]({'key':redisKey_constant_1[_0x3a0a2e(0x271)]+_0x2b9e2c['id'],'val':''},(0x0,date_1[_0x3a0a2e(0x2c6)])()[_0x3a0a2e(0x2eb)]('d')[_0x3a0a2e(0x2a8)]((0x0,date_1[_0x3a0a2e(0x2c6)])(),'s'));}const _0x1148b6=await this[_0x3a0a2e(0x1b6)][_0x3a0a2e(0x298)]({'where':{'vipExpire':(0x0,typeorm_2[_0x3a0a2e(0x1b1)])((0x0,date_1[_0x3a0a2e(0x2c6)])()[_0x3a0a2e(0x1e9)]())}});if(_0x1148b6[_0x3a0a2e(0x279)]){const _0x185c73=_0x1148b6[_0x3a0a2e(0x2f0)](_0x4ab8ca=>_0x4ab8ca['id']);await this[_0x3a0a2e(0x1b6)][_0x3a0a2e(0x304)]({'id':(0x0,typeorm_2['In'])(_0x185c73)},{'vipExpire':null});}}async[_0xb33111(0x1c7)](_0x15e22f,_0x2f7fa2,_0x26f8bd){const _0x257fdc=_0xb33111,_0x324ec6=(0x0,utils_1['getReqSaasId'])(this['clsService']),_0x26572c=await this[_0x257fdc(0x2d9)][_0x257fdc(0x1e1)]({'where':{'userId':_0x15e22f,'relId':_0x2f7fa2,'relType':_0x26f8bd,'saasId':_0x324ec6}});if(_0x26572c)throw new common_1[(_0x257fdc(0x20f))](_0x257fdc(0x201),common_1[_0x257fdc(0x321)][_0x257fdc(0x22f)]);else await this[_0x257fdc(0x2d9)][_0x257fdc(0x2ce)]({'userId':_0x15e22f,'relId':_0x2f7fa2,'relType':_0x26f8bd,'sassId':_0x324ec6});}async[_0xb33111(0x225)](_0x57a030,_0x53aa76,_0x3040ae){const _0x171fbc=_0xb33111,_0x3f6a27=(0x0,utils_1[_0x171fbc(0x2ed)])(this['clsService']),_0x379a76=await this['userCollectEntity'][_0x171fbc(0x1e1)]({'where':{'userId':_0x57a030,'relId':_0x53aa76,'relType':_0x3040ae,'saasId':_0x3f6a27}});if(!_0x379a76)throw new common_1[(_0x171fbc(0x20f))](_0x171fbc(0x244),common_1[_0x171fbc(0x321)][_0x171fbc(0x22f)]);else await this['userCollectEntity']['delete']({'id':_0x379a76['id']});}async['uncollectByRelIds'](_0x529d18,_0x33b5d4){const _0x34fb2e=_0xb33111,_0x442192=(0x0,utils_1['getReqSaasId'])(this[_0x34fb2e(0x295)]);_0x529d18['forEach'](_0x3a86ad=>{const _0x4b7286=_0x34fb2e,_0x481dc1=Number(_0x3a86ad);this[_0x4b7286(0x2d9)][_0x4b7286(0x360)]({'relId':_0x481dc1,'relType':_0x33b5d4,'saasId':_0x442192});});}async[_0xb33111(0x289)](_0x1ea544,_0x519223,_0x5e49d1,_0x42b67a){const _0xa4caec=_0xb33111,_0x5c5756=(0x0,utils_1[_0xa4caec(0x2ed)])(this[_0xa4caec(0x295)]),[_0x1fb1ff,_0x43c55c]=await this[_0xa4caec(0x2d9)]['findAndCount']({'where':{'userId':_0x5e49d1,'relType':_0x42b67a,'saasId':_0x5c5756},'take':_0x519223,'skip':(_0x1ea544-0x1)*_0x519223,'order':{'createdAt':_0xa4caec(0x1ae)}});return{'rows':_0x1fb1ff,'count':_0x43c55c};}async[_0xb33111(0x339)](_0x3a2d87,_0x36c9ff,_0x21c3d4){const _0x1b7d6b=_0xb33111,_0x440ac7=(0x0,utils_1['getReqSaasId'])(this['clsService']);return await this[_0x1b7d6b(0x2d9)]['find']({'where':{'userId':_0x36c9ff,'relType':_0x21c3d4,'saasId':_0x440ac7,'relId':(0x0,typeorm_2['In'])(_0x3a2d87)}});}async[_0xb33111(0x29f)](_0x4ab2a6,_0x1ed87b){const _0x318ab0=_0xb33111;let _0x202e95=Object[_0x318ab0(0x197)](_0x4ab2a6),_0x13a9ad=[];return _0x1ed87b[_0x318ab0(0x1b4)]?.['id']&&(_0x13a9ad=await this[_0x318ab0(0x339)](_0x4ab2a6[_0x318ab0(0x2f0)](_0x431d49=>_0x431d49['id']),_0x1ed87b[_0x318ab0(0x1b4)]['id'],collectType_constant_1['UserCollectType'][_0x318ab0(0x26f)])),_0x202e95[_0x318ab0(0x204)](_0x2abb3f=>{const _0x354149=_0x318ab0;_0x13a9ad[_0x354149(0x298)](_0x1fa7e6=>_0x1fa7e6[_0x354149(0x195)]==_0x2abb3f['id'])?_0x2abb3f['isCollect']=!![]:_0x2abb3f[_0x354149(0x1c4)]=![];}),_0x202e95;}};UserService=__decorate([(0x0,common_1[_0xb33111(0x34a)])(),__param(0x0,(0x0,common_1[_0xb33111(0x194)])(_0xb33111(0x284))),__param(0x1,(0x0,typeorm_1[_0xb33111(0x2e9)])(user_entity_1[_0xb33111(0x207)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(saas_entity_1[_0xb33111(0x27a)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(role_entity_1['RoleEntity'])),__param(0x4,(0x0,typeorm_1[_0xb33111(0x2e9)])(user_init_vip_entity_1[_0xb33111(0x1eb)])),__param(0x5,(0x0,typeorm_1[_0xb33111(0x2e9)])(userFavorite_entity_1[_0xb33111(0x333)])),__param(0x6,(0x0,typeorm_1['InjectRepository'])(userCollect_entity_1['UserCollectEntity'])),__metadata(_0xb33111(0x33b),[Object,typeorm_2['Repository'],typeorm_2[_0xb33111(0x23e)],typeorm_2[_0xb33111(0x23e)],typeorm_2[_0xb33111(0x23e)],typeorm_2['Repository'],typeorm_2['Repository'],nestjs_cls_1['ClsService'],mailer_1[_0xb33111(0x239)],redisCache_service_1['RedisCacheService'],userBalance_service_1[_0xb33111(0x212)],globalConfig_service_1[_0xb33111(0x32f)],verification_service_1[_0xb33111(0x290)],typeorm_2[_0xb33111(0x2ac)]])],UserService),exports[_0xb33111(0x299)]=UserService;