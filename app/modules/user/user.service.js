'use strict';const _0x4d5a00=_0x1a0e;(function(_0x3f75f8,_0x515f73){const _0xd61e61=_0x1a0e,_0x5bbe6b=_0x3f75f8();while(!![]){try{const _0x38fa0d=-parseInt(_0xd61e61(0x1a2))/0x1*(-parseInt(_0xd61e61(0x1fa))/0x2)+-parseInt(_0xd61e61(0x2ad))/0x3+parseInt(_0xd61e61(0x165))/0x4+-parseInt(_0xd61e61(0x1e9))/0x5*(parseInt(_0xd61e61(0x199))/0x6)+parseInt(_0xd61e61(0x1c9))/0x7+parseInt(_0xd61e61(0x2a3))/0x8*(parseInt(_0xd61e61(0x229))/0x9)+-parseInt(_0xd61e61(0x1a4))/0xa;if(_0x38fa0d===_0x515f73)break;else _0x5bbe6b['push'](_0x5bbe6b['shift']());}catch(_0x2017bc){_0x5bbe6b['push'](_0x5bbe6b['shift']());}}}(_0x395e,0xd068a));function _0x1a0e(_0x2f1495,_0x2191d8){const _0x395ed1=_0x395e();return _0x1a0e=function(_0x1a0e37,_0x6d800){_0x1a0e37=_0x1a0e37-0x153;let _0x4dc115=_0x395ed1[_0x1a0e37];return _0x4dc115;},_0x1a0e(_0x2f1495,_0x2191d8);}var __decorate=this&&this[_0x4d5a00(0x179)]||function(_0x5348a8,_0x24fee4,_0x311bd1,_0x914821){const _0x36c8f9=_0x4d5a00;var _0x2fb6e3=arguments['length'],_0x30786e=_0x2fb6e3<0x3?_0x24fee4:_0x914821===null?_0x914821=Object[_0x36c8f9(0x1f9)](_0x24fee4,_0x311bd1):_0x914821,_0x5316ae;if(typeof Reflect==='object'&&typeof Reflect[_0x36c8f9(0x1c8)]===_0x36c8f9(0x2a0))_0x30786e=Reflect[_0x36c8f9(0x1c8)](_0x5348a8,_0x24fee4,_0x311bd1,_0x914821);else{for(var _0x5e704b=_0x5348a8[_0x36c8f9(0x247)]-0x1;_0x5e704b>=0x0;_0x5e704b--)if(_0x5316ae=_0x5348a8[_0x5e704b])_0x30786e=(_0x2fb6e3<0x3?_0x5316ae(_0x30786e):_0x2fb6e3>0x3?_0x5316ae(_0x24fee4,_0x311bd1,_0x30786e):_0x5316ae(_0x24fee4,_0x311bd1))||_0x30786e;}return _0x2fb6e3>0x3&&_0x30786e&&Object[_0x36c8f9(0x2ec)](_0x24fee4,_0x311bd1,_0x30786e),_0x30786e;},__metadata=this&&this[_0x4d5a00(0x2fc)]||function(_0x3626cf,_0x5eee47){const _0x436ca4=_0x4d5a00;if(typeof Reflect===_0x436ca4(0x175)&&typeof Reflect['metadata']===_0x436ca4(0x2a0))return Reflect[_0x436ca4(0x20a)](_0x3626cf,_0x5eee47);},__param=this&&this[_0x4d5a00(0x2b0)]||function(_0x501c31,_0x3b2d19){return function(_0xc0825e,_0x1c0ee5){_0x3b2d19(_0xc0825e,_0x1c0ee5,_0x501c31);};};Object[_0x4d5a00(0x2ec)](exports,_0x4d5a00(0x2e3),{'value':!![]}),exports[_0x4d5a00(0x296)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),user_constant_1=require(_0x4d5a00(0x2d0)),mailer_1=require(_0x4d5a00(0x2e7)),verification_service_1=require(_0x4d5a00(0x256)),common_1=require(_0x4d5a00(0x272)),typeorm_1=require(_0x4d5a00(0x21b)),typeorm_2=require('typeorm'),user_entity_1=require(_0x4d5a00(0x254)),bcrypt=require(_0x4d5a00(0x27f)),_=require('lodash'),verification_constant_1=require(_0x4d5a00(0x20c)),userBalance_service_1=require(_0x4d5a00(0x2fd)),utils_1=require(_0x4d5a00(0x271)),balance_constant_1=require(_0x4d5a00(0x2c9)),class_validator_1=require('class-validator'),redisKey_constant_1=require(_0x4d5a00(0x286)),redisCache_service_1=require('../redisCache/redisCache.service'),model_constant_1=require(_0x4d5a00(0x2cb)),midjourney_constant_1=require(_0x4d5a00(0x1a7)),user_init_vip_entity_1=require(_0x4d5a00(0x1c1)),axios_1=require(_0x4d5a00(0x1ba)),date_1=require(_0x4d5a00(0x2de)),saas_entity_1=require(_0x4d5a00(0x2ab)),role_entity_1=require(_0x4d5a00(0x2ef)),store_1=require(_0x4d5a00(0x1a3)),nestjs_cls_1=require(_0x4d5a00(0x26e)),Role_constant_1=require(_0x4d5a00(0x297)),userFavorite_entity_1=require('./userFavorite.entity');function _0x395e(){const _0x2b196a=['角色信息不存在！','Repository','getConfigByKeys','mailerService','vipExpire','绑定微信失败、请联系管理员！','client','saasId','createUser','queryByPage','查询用户不存在！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','】使用扣减','registerIp','countByInviteCode','floor','type1','hideString','pptThesis','startsWith','nestjs-cls','czProxyPrice','VIEWER','../../common/utils','@nestjs/common','valueOf','ActionCN','PPT','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','verifyUserCredentials','修改用户状态成功！','insertAccountLog','userId','updateUserStatus','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','用户名已存在、请更换用户名！','Registration','bcryptjs','bindWx','未激活用户不可手动变更状态！','PPT【','queryOne','createdAt','deduct','../../common/constants/redisKey.constant','isPlatform','isMobilePhone','violationCount','\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','\x20AND\x20u.createdAt\x20<=\x20\x27','formatCreateOrUpdateDate','管理员赠送','phone','inviteRewards','还有用户使用相关角色，无法删除！','name','score','getOpenIdByUserId','UserService','../../common/constants/Role.constant','password','ListSaasByIds','queryUserInfoByIds','lastLoginIp','用户名已存在！','getUserOpenId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','重置密码失败！','function','updateVipExpire2Redis','roleEntity','9778224DLZHtB','verificationService','lifetimeVip','assign','userEntity','邀请新用户注册奖励','access','GOMAXAI_HOST','./saas.entity','修改密码失败、请重新试试吧。','4122699IHQXum','获取邀请记录失败！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','__param','vipFreeNum','mj-','globalConfigService','isVerifyEmail','subscriber','saasName','不可将用户置为未激活状态！','verifyUserRegisterByPhone','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','shouldAccess','nickname','fetch|listbyids|modal|seed','受邀请注册赠送','onModuleInit','registerRewards','\x20AND\x20phone\x20LIKE\x20\x27%','maskEmail','\x27,\x20\x271\x27,\x20\x27defaultSuper@cooper.com\x27,\x20\x27','genUserName','UserInitVipEntity','userInitVipEntity','HttpStatus','CZConfig','VIDEO','../../common/constants/balance.constant','initSaasMap','../../common/constants/model.constant','Inject','roleDel','】会员永久免费','redisCacheService','../../common/constants/user.constant','createVerification','UserService\x20Init','checkUserStatus','qureyUserInfoByInviteCode','updateVipExpire','SUPER','账号、手机、邮箱必须存在一个','用户名已被使用！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','VipFree','type2',']成功!','increment','../../common/utils/date','add','VerificationEnum','query','当前手机号已注册、请勿重复注册！','__esModule','forEach','registerVerifyEmailDesc','num','@nestjs-modules/mailer','非法访问','vipDays','用户余额不足，请充值','UserBalanceService','defineProperty','AGENT','MjDraw','./role.entity','getOne','day','deductBalance4WorkFlow','createUserAndVerifycation','queryUserInfoById','Injectable','updateUserPsd','\x20AND\x20role\x20=\x20\x27','\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','AdminGift','BAD_REQUEST','favorite','__metadata','../userBalance/userBalance.service','Tool','inviteSendStatus','手机号已被使用！','domain','giftVip','getReqSaasId','createBatch','endOf','Connection','Chat','openId','ACTIVE','inviteCode','模型【','message','updateViolationCount','then','%\x27\x20OR\x20email\x20LIKE\x20\x27%','邮箱已被使用！','BLACKLISTED','PENDING','default','days','getInviteRecord','SD绘画会员永久免费','没有变更，无需更改！','userBalanceService','rolePage','changeScore4registe','DESC','findAndCount','超级管理员','6240912oMWGwH','role','mj123456admin','增加PPT单页','已生成过邀请码、请勿重复生成','userInitVip','File','upscale|describe|picread::retry|faceswap|shorten','当前用户信息失效、请重新登录！','toDate','重新生成封面任务','UNAUTHORIZED','saasId不能为空！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','】会员每日限免','miniOpenId','object','clsService','turbo_mjDeduction','roleSave','__decorate','status','toLowerCase','registerVerifyEmailFrom','invitePage','ClsService','inviteLink','注册赠送','代理商','Draw','registerSendStatus','concat','diff','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','error:\x20','用户名或者邮箱已被注册！','inviteRewardVip','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','env','MUSIC','get','count','random','手机号格式错误！','无效的邀请码！','%\x27\x20OR\x20id\x20=\x20\x27','UserFavoriteEntity','deductBalance4SD','GPTS','price','update','maskIpAddress','54042MBifjW','getVipLeavelRelById','pSubscribe','disabled','\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL','INSERT\x20IGNORE\x20INTO\x20users\x20(username,\x20password,\x20status,\x20email,\x20role)\x20VALUES\x20(\x27super\x27,\x20\x27','pptCreate','invitedRewards','relax_mjDeduction','1172936QwbCBd','../../common/store','21112160HhduUr','\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%','\x20AND\x20username\x20LIKE\x20\x27%','../../common/constants/midjourney.constant','findOne','模板生成PPT','size','InvitationReward','\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','DrawSpeed','user','modelType','userDefautlAvatar','用户不存在！','vipLeavelId','%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','giftScore','userFavoriteEntity','description','ERole','saasPage','axios','inviterPhone','Not','getUserListByIds','saasMap','EChangeType','push','./user_init_vip.entity','updateInfo','UserEntity','deductBalance4MJ','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','compareSync','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','decorate','10818864cVcGZD','exists','find','avatar','debuctBalance4PPT','fast_vip_free','queryOneUserInfo','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','CHAT','HttpException','REDIS_SUBSCRIBER','isEmail','前台用户','VerificationService','transaction','set','OTHER','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','inviterEmail','saasDel','genInviteCode','vipFreeKey','email','\x20AND\x20`status`\x20=\x20','pptOutline','design:paramtypes','code','LOCKED','MJ绘画【','生成邀请码失败，请重新试一次吧！','修改用户状态失败！','%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','645dwctdQ','includes','论文生成PPT','yes','map','InjectRepository','key','EModelType','AND\x20email\x20LIKE\x20\x27%','%\x27\x20OR\x20nickname\x20LIKE\x20\x27%','vlrk','czVipFree','Invited','registerVerifyExpir','当前用户不存在！','super123456','getOwnPropertyDescriptor','2xKAHhw','GlobalConfigService','relateType','RedisCacheService','-SD','当前密码错误！','的账号激活','Price','register','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','getUserByInviteCode','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27','\x20AND\x20saasId\x20=\x20','save','当前角色编码不可用，请使用其他角色编码','metadata','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','../../common/constants/verification.constant','getMjPrice','test','connection','UserStatusEnum','username','vipLeavelName','当前绑定用户不存在！','Tts','genUserNames','saasEntity','resetUserPass','文件生成PPT','BadRequest','当前账户不存在！','@nestjs/typeorm','SD绘画【','zh-CN','isSuper','updateStatus','modelName','getClientIp','FILE','userCount','filter','标题大纲任务','action','type3','destroyAccount','9dNmeLu','%\x27\x20)','refundBalance4Chat','\x20OFFSET\x20','log','hashSync','accessLabel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','Between','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','affected','relateId','修改用户信息成功！','invitedRewardVip','\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','APP','changeScore4Other','visitor','Like','Music','账号注册时密码不能为空！','clear','%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%','WORKFLOW','delete','favoriteListByTypeAndIds','getUserById','超级管理员不可被操作！','length','has','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','delUser','SaasEntity','123456','VIP_FREE','ids','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','desc','小工具【','DRAW','generateRandomString','./user.entity','getUserStatus','./../verification/verification.service','\x20AND\x20u.saasId\x20=\x20','VIP_EXPIRE','%\x27\x20OR\x20u.email\x20LIKE\x20\x27%'];_0x395e=function(){return _0x2b196a;};return _0x395e();}let UserService=class UserService{constructor(_0x16c1f4,_0x454202,_0x46d93d,_0x143729,_0x2c4aca,_0x261f29,_0x424ec5,_0x21d588,_0x5bdc34,_0x232eae,_0x149fc5,_0x1cea30,_0x36a6d0){const _0x348f10=_0x4d5a00;this[_0x348f10(0x2b5)]=_0x16c1f4,this[_0x348f10(0x2a7)]=_0x454202,this['saasEntity']=_0x46d93d,this['roleEntity']=_0x143729,this['userInitVipEntity']=_0x2c4aca,this[_0x348f10(0x1b6)]=_0x261f29,this[_0x348f10(0x176)]=_0x424ec5,this[_0x348f10(0x25d)]=_0x21d588,this[_0x348f10(0x2cf)]=_0x5bdc34,this[_0x348f10(0x15f)]=_0x232eae,this[_0x348f10(0x2b3)]=_0x149fc5,this[_0x348f10(0x2a4)]=_0x1cea30,this[_0x348f10(0x20f)]=_0x36a6d0;}[_0x4d5a00(0x2be)](){const _0x2f4ace=_0x4d5a00;console[_0x2f4ace(0x22d)](_0x2f4ace(0x2d2)),this[_0x2f4ace(0x20f)][_0x2f4ace(0x2e1)](_0x2f4ace(0x28c)+Role_constant_1[_0x2f4ace(0x1b8)][_0x2f4ace(0x2d6)]+'\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27'+Role_constant_1[_0x2f4ace(0x1b8)][_0x2f4ace(0x2ed)]+_0x2f4ace(0x206)+Role_constant_1['ERole']['VIEWER']+_0x2f4ace(0x238));const _0x67493a=bcrypt[_0x2f4ace(0x22e)](_0x2f4ace(0x1f8),0xa);this[_0x2f4ace(0x20f)][_0x2f4ace(0x2e1)](_0x2f4ace(0x19e)+_0x67493a+_0x2f4ace(0x2c2)+Role_constant_1[_0x2f4ace(0x1b8)]['SUPER']+'\x27)'),this[_0x2f4ace(0x2ca)](),this[_0x2f4ace(0x2b5)][_0x2f4ace(0x19b)]('__keyevent@0__:expired',async _0x3cee6c=>{const _0x4a6a31=_0x2f4ace;if(_0x3cee6c[_0x4a6a31(0x26d)](redisKey_constant_1['VIP_EXPIRE'])){const _0x33871e=_0x3cee6c['replace'](redisKey_constant_1[_0x4a6a31(0x258)],'');this[_0x4a6a31(0x2a7)][_0x4a6a31(0x197)]({'id':Number(_0x33871e)},{'vipExpire':null});}});}async[_0x4d5a00(0x2ca)](){const _0x5b41b0=_0x4d5a00,_0x26ccbf=await this['saasEntity']['find']({'where':{'deleteFlag':0x0}});store_1['saasMap'][_0x5b41b0(0x240)](),_0x26ccbf[_0x5b41b0(0x2e4)](_0x30798c=>store_1['saasMap'][_0x5b41b0(0x1d8)](_0x30798c[_0x5b41b0(0x301)],_0x30798c['id'])),store_1[_0x5b41b0(0x1be)][_0x5b41b0(0x1d8)](process[_0x5b41b0(0x18b)][_0x5b41b0(0x2aa)],0x0);}['getEntity'](){const _0x3f1e77=_0x4d5a00;return this[_0x3f1e77(0x2a7)];}async[_0x4d5a00(0x299)](_0x4ae809){const _0x3466bc=_0x4d5a00;if(!_0x4ae809['length'])return[];return this[_0x3466bc(0x216)][_0x3466bc(0x1cb)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4ae809)}});}async[_0x4d5a00(0x1b9)](_0x493af1){const _0x169357=_0x4d5a00,{page:page=0x1,size:size=0x14,keyword:_0x5c3037}=_0x493af1;let _0x2d29cf;_0x5c3037?_0x2d29cf=[{'deleteFlag':0x0,'name':(0x0,typeorm_2[_0x169357(0x23d)])('%'+_0x5c3037+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2[_0x169357(0x23d)])('%'+_0x5c3037+'%')}]:_0x2d29cf={'deleteFlag':0x0};const [_0x1a4a52,_0xd522f]=await this[_0x169357(0x216)][_0x169357(0x163)]({'where':_0x2d29cf,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'}});if(!_0x1a4a52[_0x169357(0x247)])return{'rows':[],'count':_0xd522f};const _0x6c2aeb=_0x1a4a52[_0x169357(0x1ed)](_0x5d9782=>_0x5d9782['id']),_0x12088e=new Map(),_0x16064b=await this[_0x169357(0x2a7)][_0x169357(0x1cb)]({'where':{'saasId':(0x0,typeorm_2['In'])(_0x6c2aeb),'role':Role_constant_1[_0x169357(0x1b8)][_0x169357(0x2ed)]}});_0x16064b['forEach'](_0x54310f=>{const _0x6003d0=_0x169357;_0x12088e[_0x6003d0(0x1d8)](_0x54310f[_0x6003d0(0x261)],_0x54310f);});const _0x51b405=new Map(),_0x24c3ff=await this[_0x169357(0x20f)][_0x169357(0x2e1)](_0x169357(0x2af));_0x24c3ff['forEach'](_0x552552=>_0x51b405['set'](_0x552552[_0x169357(0x261)],_0x552552[_0x169357(0x18e)]));const _0x354574=_0x1a4a52[_0x169357(0x1ed)](_0x27aaf0=>{const _0xa52181=_0x169357;let _0x29c72b=null,_0x46073b=null,_0x3f8ccd=null,_0x536bbb=null;const _0x498db4=_0x12088e['get'](_0x27aaf0['id']);return _0x498db4&&(_0x29c72b=_0x498db4[_0xa52181(0x211)],_0x46073b=_0x498db4[_0xa52181(0x2bb)],_0x3f8ccd=_0x498db4['phone'],_0x536bbb=_0x498db4[_0xa52181(0x1df)]),{..._0x27aaf0,'username':_0x29c72b,'nickname':_0x46073b,'phone':_0x3f8ccd,'email':_0x536bbb,'userCount':_0x51b405[_0xa52181(0x18d)](_0x27aaf0['id'])||0x0};});return{'rows':_0x354574,'count':_0xd522f};}async['getSaasById'](_0x109575){const _0x679080=_0x4d5a00;return this[_0x679080(0x216)]['findOne']({'where':{'id':_0x109575}});}async['saasSave'](_0x517944){const _0x5a13ac=_0x4d5a00,_0x2899f1=(0x0,utils_1[_0x5a13ac(0x303)])(this[_0x5a13ac(0x176)]);if(_0x2899f1!==0x0)throw new common_1[(_0x5a13ac(0x1d2))](_0x5a13ac(0x2e8),common_1[_0x5a13ac(0x2c6)]['FORBIDDEN']);return await this[_0x5a13ac(0x216)][_0x5a13ac(0x208)](_0x517944),this[_0x5a13ac(0x2ca)](),!![];}async['saasUpdate'](_0x18a37e){const _0x3e5676=_0x4d5a00,_0x1cfa99=(0x0,utils_1[_0x3e5676(0x303)])(this[_0x3e5676(0x176)]);return await this[_0x3e5676(0x216)][_0x3e5676(0x208)]({..._0x18a37e,'id':_0x1cfa99}),!![];}async[_0x4d5a00(0x1dc)](_0x50bda3){const _0x226b65=_0x4d5a00;if(!_0x50bda3[_0x226b65(0x24e)]||!_0x50bda3[_0x226b65(0x24e)][_0x226b65(0x247)])return!![];return await this[_0x226b65(0x216)][_0x226b65(0x197)]({'id':(0x0,typeorm_2['In'])(_0x50bda3[_0x226b65(0x24e)])},{'deleteFlag':0x1}),!![];}async[_0x4d5a00(0x160)](_0x4a7f03,_0x30beb6){const _0x323d0f=_0x4d5a00,_0x38974c=await(0x0,utils_1['getReqSaasId'])(this[_0x323d0f(0x176)]),{page:page=0x1,size:size=0x14,keyword:_0x4af74b}=_0x30beb6;let _0x1672ef=_0x323d0f(0x2b9)+_0x38974c+_0x323d0f(0x1c7)+Role_constant_1[_0x323d0f(0x1b8)][_0x323d0f(0x270)]+'\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20';_0x4af74b&&(_0x1672ef=_0x323d0f(0x2d9)+_0x38974c+_0x323d0f(0x28a)+_0x4af74b+'%\x27\x20OR\x20`code`\x20LIKE\x20\x27%'+_0x4af74b+_0x323d0f(0x1e8)+Role_constant_1[_0x323d0f(0x1b8)]['VIEWER']+_0x323d0f(0x249)+_0x4af74b+_0x323d0f(0x1da)+_0x4af74b+_0x323d0f(0x1b4));const _0x24552d=await this[_0x323d0f(0x20f)][_0x323d0f(0x2e1)](_0x323d0f(0x186)+_0x1672ef+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x216139=await this[_0x323d0f(0x20f)]['query'](_0x323d0f(0x24f)+_0x1672ef+_0x323d0f(0x29e)+size+_0x323d0f(0x22c)+(page-0x1)*size+_0x323d0f(0x1d0)),_0x3210fe=_0x216139[_0x323d0f(0x1ed)](_0x3b08df=>_0x3b08df['id']);if(_0x3210fe[_0x323d0f(0x247)]){const _0x223434=await this[_0x323d0f(0x216)]['findOne']({'where':{'id':_0x4a7f03[_0x323d0f(0x1af)][_0x323d0f(0x261)]}}),_0x42341e=new Map(),_0xb9d17c=await this[_0x323d0f(0x20f)][_0x323d0f(0x2e1)](_0x323d0f(0x233));_0xb9d17c[_0x323d0f(0x2e4)](_0x226250=>_0x42341e[_0x323d0f(0x1d8)](_0x226250[_0x323d0f(0x166)],_0x226250[_0x323d0f(0x18e)])),_0x216139[_0x323d0f(0x2e4)](_0x56b87b=>{const _0x1dcc40=_0x323d0f;_0x56b87b[_0x1dcc40(0x2b6)]=_0x223434?.['name']||'平台',_0x56b87b[_0x1dcc40(0x223)]=_0x42341e[_0x1dcc40(0x18d)](_0x56b87b['code'])||0x0;});}return{'rows':_0x216139,'count':Number(_0x24552d[0x0]?.['count']||0x0)};}async[_0x4d5a00(0x178)](_0x4b2329,_0x3508b0){const _0xc11950=_0x4d5a00,_0x3fd462=await(0x0,utils_1[_0xc11950(0x303)])(this['clsService']);if([Role_constant_1[_0xc11950(0x1b8)][_0xc11950(0x2d6)][_0xc11950(0x273)](),Role_constant_1[_0xc11950(0x1b8)][_0xc11950(0x2ed)]['valueOf'](),Role_constant_1[_0xc11950(0x1b8)]['VIEWER'][_0xc11950(0x273)]()][_0xc11950(0x1ea)](_0x3508b0['code'])&&_0x3fd462!==0x0)throw new common_1['HttpException'](_0xc11950(0x209),common_1[_0xc11950(0x2c6)][_0xc11950(0x2fa)]);return await this['roleEntity']['save']({..._0x3508b0,'saasId':_0x3fd462,'disabled':_0x3508b0[_0xc11950(0x19c)]??0x0}),!![];}async[_0x4d5a00(0x2cd)](_0x18f088,_0x43dac0){const _0x480417=_0x4d5a00,_0x15ac11=await(0x0,utils_1[_0x480417(0x303)])(this['clsService']);if(!_0x43dac0[_0x480417(0x24e)]||!_0x43dac0[_0x480417(0x24e)][_0x480417(0x247)])return!![];const _0x414f57=await this[_0x480417(0x2a2)][_0x480417(0x1cb)]({'where':{'id':(0x0,typeorm_2['In'])(_0x43dac0[_0x480417(0x24e)]),'saasId':_0x15ac11}});if(!_0x414f57[_0x480417(0x247)])return!![];const _0x187e20=_0x414f57['map'](_0x23f603=>_0x23f603[_0x480417(0x1e3)]),_0x34d00d=await this[_0x480417(0x2a7)][_0x480417(0x18e)]({'where':{'role':(0x0,typeorm_2['In'])(_0x187e20),'saasId':_0x15ac11}});if(_0x34d00d>0x0)throw new common_1[(_0x480417(0x1d2))](_0x480417(0x292),common_1[_0x480417(0x2c6)][_0x480417(0x2fa)]);return await this[_0x480417(0x2a2)][_0x480417(0x243)]({'id':(0x0,typeorm_2['In'])(_0x43dac0[_0x480417(0x24e)])}),!![];}async['findByIds'](_0xa32f4b){const _0x54b6d4=_0x4d5a00;if(!_0xa32f4b['length'])return[];const _0x1c6fa6=await this['userEntity'][_0x54b6d4(0x1cb)]({'where':{'id':(0x0,typeorm_2['In'])(_0xa32f4b)}});return _0x1c6fa6;}async[_0x4d5a00(0x2f3)](_0x3cd7db,_0x42f6b3){const _0x22af8e=_0x4d5a00,{username:_0x5599b5,email:_0x508593,password:_0x267b9b,invitedBy:_0x57a284,client:client=0x0}=_0x3cd7db;if(_0x57a284){const _0xb0cf8a=await this[_0x22af8e(0x2a7)][_0x22af8e(0x1a8)]({'where':{'inviteCode':_0x57a284}});if(!_0xb0cf8a)throw new common_1[(_0x22af8e(0x1d2))](_0x22af8e(0x191),common_1[_0x22af8e(0x2c6)][_0x22af8e(0x2fa)]);}const _0x4d71cc=[{'username':_0x5599b5},{'email':_0x508593}],_0x46852c=await this['userEntity'][_0x22af8e(0x1a8)]({'where':_0x4d71cc});if(_0x46852c&&_0x46852c[_0x22af8e(0x17a)]!==user_constant_1[_0x22af8e(0x210)][_0x22af8e(0x159)])throw new common_1['HttpException'](_0x22af8e(0x188),common_1['HttpStatus'][_0x22af8e(0x2fa)]);try{const _0x390abd=_['cloneDeep'](_0x3cd7db),_0xd52d1e=bcrypt[_0x22af8e(0x22e)](_0x267b9b,0xa),_0x43c0c6=(0x0,utils_1[_0x22af8e(0x221)])(_0x42f6b3);_0x390abd['password']=_0xd52d1e,_0x390abd[_0x22af8e(0x267)]=_0x43c0c6,_0x390abd[_0x22af8e(0x260)]=client;let _0x1688b5;if(!_0x46852c){const _0x26c3f2=await this['globalConfigService'][_0x22af8e(0x25c)]([_0x22af8e(0x1b1)]);_0x390abd[_0x22af8e(0x1cc)]=_0x26c3f2,_0x1688b5=await this[_0x22af8e(0x2a7)][_0x22af8e(0x208)](_0x390abd);}else _0x1688b5=_0x46852c;const _0x357355=await this['globalConfigService'][_0x22af8e(0x25c)]([_0x22af8e(0x2b4),'registerBaseUrl','registerVerifyEmailTitle',_0x22af8e(0x2e5),_0x22af8e(0x17c),'registerVerifyExpir']),_0x6b7446=_0x357355[_0x22af8e(0x2b4)]?Number(_0x357355['isVerifyEmail']):0x1;if(_0x6b7446){const _0x3249ad=_0x357355[_0x22af8e(0x1f6)]?Number(_0x357355['registerVerifyExpir']):0x1e*0x3c,_0x572f4f=await this[_0x22af8e(0x2a4)][_0x22af8e(0x2d1)](_0x1688b5,verification_constant_1[_0x22af8e(0x2e0)][_0x22af8e(0x27e)],_0x3249ad),{code:_0x31a615,email:_0x525a15,id:_0x402e38}=_0x572f4f,{registerVerifyEmailFrom:_0x174793}=_0x357355;await this[_0x22af8e(0x25d)]['sendMail']({'to':_0x525a15,'subject':'来自'+_0x174793+_0x22af8e(0x200),'template':_0x22af8e(0x202),'context':{'baseUrl':_0x357355['registerBaseUrl'],'code':_0x31a615,'id':_0x402e38,..._0x357355}});}else{const {id:_0x2b766d,invitedBy:_0x142ff3}=_0x1688b5;await this[_0x22af8e(0x27b)](_0x2b766d,user_constant_1[_0x22af8e(0x210)]['ACTIVE']);let _0x2a7539;_0x142ff3&&(_0x2a7539=await this['qureyUserInfoByInviteCode'](_0x142ff3)),await this[_0x22af8e(0x161)](_0x1688b5,_0x2a7539);}return _0x1688b5;}catch(_0x9fbb32){console[_0x22af8e(0x22d)]('error:\x20',_0x9fbb32);throw _0x9fbb32;}}async[_0x4d5a00(0x277)](_0xf4ab5a){const _0x543534=_0x4d5a00,{username:_0x4cd351,password:_0x3c1dee,uid:uid=0x0,phone:_0xc752a5}=_0xf4ab5a;let _0x5a851c=null;if(uid>0x0){_0x5a851c=await this[_0x543534(0x2a7)][_0x543534(0x1a8)]({'where':{'id':uid}});if(!_0x5a851c)throw new common_1[(_0x543534(0x1d2))](_0x543534(0x21a),common_1[_0x543534(0x2c6)]['BAD_REQUEST']);if(!bcrypt[_0x543534(0x1c6)](_0x3c1dee,_0x5a851c[_0x543534(0x298)]))throw new common_1[(_0x543534(0x1d2))]('当前密码错误！',common_1[_0x543534(0x2c6)]['BAD_REQUEST']);}if(_0x4cd351&&_0x3c1dee){const _0x1c4e4b=[{'username':_0x4cd351},{'email':_0x4cd351}];_0x5a851c=await this[_0x543534(0x2a7)][_0x543534(0x1a8)]({'where':_0x1c4e4b});if(!_0x5a851c)throw new common_1[(_0x543534(0x1d2))](_0x543534(0x21a),common_1['HttpStatus']['BAD_REQUEST']);if(!bcrypt[_0x543534(0x1c6)](_0x3c1dee,_0x5a851c['password']))throw new common_1[(_0x543534(0x1d2))](_0x543534(0x1ff),common_1[_0x543534(0x2c6)][_0x543534(0x2fa)]);}if(_0xc752a5&&_0x3c1dee){const _0x6e21ff=[{'phone':_0xc752a5}];_0x5a851c=await this[_0x543534(0x2a7)]['findOne']({'where':_0x6e21ff});if(!_0x5a851c)throw new common_1[(_0x543534(0x1d2))]('当前账户不存在！',common_1[_0x543534(0x2c6)][_0x543534(0x2fa)]);if(!bcrypt[_0x543534(0x1c6)](_0x3c1dee,_0x5a851c[_0x543534(0x298)]))throw new common_1[(_0x543534(0x1d2))](_0x543534(0x1ff),common_1['HttpStatus'][_0x543534(0x2fa)]);}if(!_0x5a851c)throw new common_1[(_0x543534(0x1d2))](_0x543534(0x21a),common_1[_0x543534(0x2c6)]['BAD_REQUEST']);if(_0x5a851c[_0x543534(0x17a)]!==user_constant_1[_0x543534(0x210)][_0x543534(0x309)])throw new common_1[(_0x543534(0x1d2))](user_constant_1['UserStatusErrMsg'][_0x5a851c[_0x543534(0x17a)]],common_1['HttpStatus'][_0x543534(0x2fa)]);if(_0x5a851c[_0x543534(0x211)]&&!_0x5a851c[_0x543534(0x29b)]){const _0xdd7063=await this['userInitVipEntity'][_0x543534(0x1a8)]({'where':{'username':_0x5a851c[_0x543534(0x211)]}});_0xdd7063&&await this[_0x543534(0x20f)][_0x543534(0x1d7)](async()=>{const _0x531cf5=_0x543534;_0xdd7063[_0x531cf5(0x2e9)]===-0x1?_0x5a851c[_0x531cf5(0x2a5)]=0x1:_0x5a851c['vipExpire']=(0x0,date_1['default'])()[_0x531cf5(0x2df)](_0xdd7063[_0x531cf5(0x2e9)],_0x531cf5(0x2f1))[_0x531cf5(0x16e)](),_0x5a851c=await this[_0x531cf5(0x2a7)][_0x531cf5(0x208)](_0x5a851c),await this[_0x531cf5(0x2c5)][_0x531cf5(0x243)]({'id':_0xdd7063['id']});});}return _0x5a851c;}async['verifyUserPassword'](_0x343687,_0x3a1ab5){const _0x1a7102=_0x4d5a00,_0xc0bc3e=await this['userEntity'][_0x1a7102(0x1a8)]({'where':{'id':_0x343687}});return bcrypt[_0x1a7102(0x1c6)](_0x3a1ab5,_0xc0bc3e[_0x1a7102(0x298)]);}async[_0x4d5a00(0x27b)](_0x5557d2,_0x52b8cf){const _0x105610=_0x4d5a00,_0x32fbd9=await this[_0x105610(0x2a7)]['update']({'id':_0x5557d2},{'status':_0x52b8cf});return _0x32fbd9[_0x105610(0x234)]>0x0;}async[_0x4d5a00(0x255)](_0x373d16){const _0x4b6b89=_0x4d5a00,_0x38590d=await this[_0x4b6b89(0x2a7)]['findOne']({'where':{'id':_0x373d16}});return _0x38590d[_0x4b6b89(0x17a)];}async[_0x4d5a00(0x2f4)](_0x1068f3){const _0x206c80=_0x4d5a00;return await this[_0x206c80(0x2a7)][_0x206c80(0x1a8)]({'where':{'id':_0x1068f3}});}async[_0x4d5a00(0x29a)](_0x1ed848){const _0x3bc2db=_0x4d5a00;return await this[_0x3bc2db(0x2a7)]['findBy']({'id':(0x0,typeorm_2['In'])(_0x1ed848)});}async['queryUserByUsername'](_0x2d6044){const _0x492e1a=_0x4d5a00;return await this['userEntity'][_0x492e1a(0x1a8)]({'where':{'username':_0x2d6044}});}async[_0x4d5a00(0x2f6)](_0x54b5f2){const _0x557758=_0x4d5a00,{id:_0xe1099d,username:_0x31d2f3,password:_0x308294}=_0x54b5f2;return await this[_0x557758(0x2a7)][_0x557758(0x197)](_0xe1099d,{'username':_0x31d2f3,'password':_0x308294});}async[_0x4d5a00(0x1cf)](_0x4ba7bc){const _0x239530=_0x4d5a00;return await this['userEntity'][_0x239530(0x1a8)]({'where':{'id':_0x4ba7bc}});}async[_0x4d5a00(0x2d3)](_0x1446e6){const _0x3453ab=_0x4d5a00,{id:_0x24b481,role:_0x7b32cb}=_0x1446e6;if(_0x7b32cb===_0x3453ab(0x23c))return!![];const _0x2541a3=await this[_0x3453ab(0x2a7)]['findOne']({'where':{'id':_0x24b481}});if(!_0x2541a3)throw new common_1[(_0x3453ab(0x1d2))](_0x3453ab(0x16d),common_1[_0x3453ab(0x2c6)]['UNAUTHORIZED']);if(_0x2541a3[_0x3453ab(0x17a)]===user_constant_1[_0x3453ab(0x210)][_0x3453ab(0x158)])throw new common_1['HttpException'](_0x3453ab(0x203),common_1[_0x3453ab(0x2c6)][_0x3453ab(0x2fa)]);if(_0x2541a3['status']===user_constant_1[_0x3453ab(0x210)][_0x3453ab(0x1e4)])throw new common_1[(_0x3453ab(0x1d2))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1['HttpStatus']['BAD_REQUEST']);}async[_0x4d5a00(0x245)](_0x54a53e){const _0x124a66=_0x4d5a00;return await this[_0x124a66(0x2a7)][_0x124a66(0x1a8)]({'where':{'id':_0x54a53e}});}[_0x4d5a00(0x1bd)](_0x4f1ca4){const _0x215546=_0x4d5a00;return this[_0x215546(0x2a7)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x4f1ca4)}});}async[_0x4d5a00(0x204)](_0x36f84d){const _0x1b6883=_0x4d5a00;return this['userEntity'][_0x1b6883(0x1a8)]({'where':{'inviteCode':_0x36f84d}});}async[_0x4d5a00(0x29d)](_0x2d3a29){const _0x2718c6=_0x4d5a00,_0x547bba=(0x0,utils_1[_0x2718c6(0x303)])(this[_0x2718c6(0x176)]);return await this[_0x2718c6(0x2a7)][_0x2718c6(0x1a8)]({'where':{'openId':_0x2d3a29,'saasId':_0x547bba}});}async[_0x4d5a00(0x268)](_0x1bd8b4){const _0x33fab5=_0x4d5a00;return this[_0x33fab5(0x2a7)][_0x33fab5(0x18e)]({'where':{'invitedBy':_0x1bd8b4}});}async[_0x4d5a00(0x1c2)](_0x19a3bf,_0xf07360){const _0x5b70ef=_0x4d5a00,{id:_0x51c9b3}=_0xf07360[_0x5b70ef(0x1af)],_0x3e7608=await this['userEntity']['findOne']({'where':{'id':_0x51c9b3}});if(!_0x3e7608)throw new common_1[(_0x5b70ef(0x1d2))](_0x5b70ef(0x1f7),common_1[_0x5b70ef(0x2c6)][_0x5b70ef(0x2fa)]);if(_0x19a3bf[_0x5b70ef(0x211)]&&_0x3e7608[_0x5b70ef(0x211)]===_0x19a3bf[_0x5b70ef(0x211)])throw new common_1[(_0x5b70ef(0x1d2))](_0x5b70ef(0x15e),common_1[_0x5b70ef(0x2c6)][_0x5b70ef(0x2fa)]);if(_0x19a3bf[_0x5b70ef(0x211)]){const _0x395315=await this['userEntity'][_0x5b70ef(0x1a8)]({'where':{'username':_0x19a3bf[_0x5b70ef(0x211)],'id':(0x0,typeorm_2[_0x5b70ef(0x1bc)])(_0x51c9b3)}});if(_0x395315)throw new common_1[(_0x5b70ef(0x1d2))](_0x5b70ef(0x29c),common_1[_0x5b70ef(0x2c6)][_0x5b70ef(0x2fa)]);}const _0x45e5d6=await this[_0x5b70ef(0x2a7)][_0x5b70ef(0x197)]({'id':_0x51c9b3},_0x19a3bf);if(_0x45e5d6[_0x5b70ef(0x234)]<=0x0)throw new common_1['HttpException']('修改用户信息失败！',common_1[_0x5b70ef(0x2c6)][_0x5b70ef(0x2fa)]);return _0x5b70ef(0x236);}async['updateUserPassword'](_0x334699,_0x2a5fb1){const _0x39b77f=_0x4d5a00,_0x547217=bcrypt[_0x39b77f(0x22e)](_0x2a5fb1,0xa),_0x25e16b=await this[_0x39b77f(0x2a7)][_0x39b77f(0x197)]({'id':_0x334699},{'password':_0x547217});if(_0x25e16b[_0x39b77f(0x234)]<=0x0)throw new common_1[(_0x39b77f(0x1d2))](_0x39b77f(0x2ac),common_1[_0x39b77f(0x2c6)][_0x39b77f(0x2fa)]);}async[_0x4d5a00(0x2fb)](_0x2fda6b,_0x15c3a2){const _0x6874e6=_0x4d5a00;try{const _0x1a898c=await this[_0x6874e6(0x1b6)][_0x6874e6(0x1a8)]({'where':{'userId':_0x2fda6b[_0x6874e6(0x1af)]['id'],'relateId':_0x15c3a2[_0x6874e6(0x235)],'relateType':_0x15c3a2[_0x6874e6(0x1fc)]}});return _0x1a898c?await this[_0x6874e6(0x1b6)][_0x6874e6(0x243)]({'id':_0x1a898c['id']}):await this[_0x6874e6(0x1b6)][_0x6874e6(0x208)]({'userId':_0x2fda6b[_0x6874e6(0x1af)]['id'],'relateId':_0x15c3a2[_0x6874e6(0x235)],'relateType':_0x15c3a2[_0x6874e6(0x1fc)]}),!![];}catch(_0x2eec5d){throw new common_1[(_0x6874e6(0x1d2))](_0x2eec5d['message'],common_1[_0x6874e6(0x2c6)]['BAD_REQUEST']);}}async[_0x4d5a00(0x244)](_0x278946,_0xa9ced2,_0x15878f){const _0x265e07=_0x4d5a00;return this[_0x265e07(0x1b6)]['find']({'where':{'userId':_0x278946,'relateType':_0xa9ced2,'relateId':(0x0,typeorm_2['In'])(_0x15878f)}});}async[_0x4d5a00(0x1dd)](_0x349431){const _0x341fad=_0x4d5a00,{id:_0x4a6192}=_0x349431[_0x341fad(0x1af)],_0x5eafc2=await this[_0x341fad(0x2a7)][_0x341fad(0x1a8)]({'where':{'id':_0x4a6192}});if(!_0x5eafc2||_0x5eafc2[_0x341fad(0x30a)])throw new common_1['HttpException'](_0x341fad(0x169),common_1[_0x341fad(0x2c6)]['BAD_REQUEST']);const _0x57582e=(0x0,utils_1[_0x341fad(0x253)])(),_0x1a72ed=await this[_0x341fad(0x2a7)][_0x341fad(0x1a8)]({'where':{'inviteCode':_0x57582e}});if(_0x1a72ed)throw new common_1[(_0x341fad(0x1d2))](_0x341fad(0x1e6),common_1[_0x341fad(0x2c6)][_0x341fad(0x2fa)]);const _0x439385=await this['userEntity'][_0x341fad(0x197)]({'id':_0x4a6192},{'inviteCode':_0x57582e});if(_0x439385[_0x341fad(0x234)]<=0x0)throw new common_1['HttpException']('生成邀请码失败，请重新试一次吧！',common_1['HttpStatus'][_0x341fad(0x2fa)]);return _0x57582e;}async[_0x4d5a00(0x15c)](_0x5da0c7,_0x20d149){const _0x38e858=_0x4d5a00;try{const {id:_0x7a9408}=_0x5da0c7['user'],{page:page=0x1,size:size=0xa}=_0x20d149,_0x1fa9e3=await this[_0x38e858(0x2a7)][_0x38e858(0x1a8)]({'where':{'id':_0x7a9408}}),{inviteCode:_0x4d1c87}=_0x1fa9e3;if(!_0x4d1c87)return[];const [_0x10233e,_0x45a305]=await this['userEntity'][_0x38e858(0x163)]({'where':{'inviteCode':_0x4d1c87},'order':{'id':_0x38e858(0x162)},'select':[_0x38e858(0x211),_0x38e858(0x1df),_0x38e858(0x284),_0x38e858(0x17a),_0x38e858(0x1cc)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x38e858(0x28e)])(_0x10233e)[_0x38e858(0x1ed)](_0x19df7b=>{const _0xbbc65b=_0x38e858;return _0x19df7b[_0xbbc65b(0x1df)]=(0x0,utils_1[_0xbbc65b(0x2c1)])(_0x19df7b[_0xbbc65b(0x1df)]),_0x19df7b;}),{'rows':_0x10233e,'count':_0x45a305};}catch(_0x165b24){console[_0x38e858(0x22d)](_0x38e858(0x187),_0x165b24);throw new common_1['HttpException'](_0x38e858(0x2ae),common_1[_0x38e858(0x2c6)][_0x38e858(0x2fa)]);}}async[_0x4d5a00(0x17d)](_0x34e5c8,_0x16b6e1,_0x165d5a){const _0xde882e=_0x4d5a00,_0x456f15=(0x0,utils_1[_0xde882e(0x303)])(this[_0xde882e(0x176)]),{page:page=0x1,size:size=0x14,startTime:_0xcbcc4c,endTime:_0x30f98d,saasId:_0x118605,keyword:_0x401780,inviterKeyword:_0x568e54}=_0x16b6e1,_0x30fa47=_0xde882e(0x20b)+(_0x165d5a?'\x20AND\x20u.userId\x20=\x20'+_0x165d5a:'')+_0xde882e(0x232)+(_0x30f98d?_0xde882e(0x28d)+_0x30f98d+'\x27':'')+_0xde882e(0x232)+(_0xcbcc4c?'\x20AND\x20u.createdAt\x20>=\x20\x27'+_0xcbcc4c+'\x27':'')+_0xde882e(0x232)+(_0x456f15!==0x0?'\x20AND\x20u.saasId\x20=\x20'+_0x456f15:(0x0,utils_1['isDefined'])(_0x118605)?_0xde882e(0x257)+_0x118605:'')+_0xde882e(0x232)+(_0x401780?_0xde882e(0x2f8)+_0x401780+_0xde882e(0x205)+_0x401780+'%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%'+_0x401780+_0xde882e(0x259)+_0x401780+'%\x27\x20)':'')+_0xde882e(0x232)+(_0x568e54?_0xde882e(0x1a5)+_0x568e54+_0xde882e(0x241)+_0x568e54+'%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%'+_0x568e54+_0xde882e(0x27c)+_0x568e54+_0xde882e(0x22a):'')+_0xde882e(0x1d0),_0x532604=_0xde882e(0x1c5)+_0x30fa47+_0xde882e(0x1d0),_0x3e5d35=_0xde882e(0x172)+_0x30fa47+_0xde882e(0x230)+size+'\x20OFFSET\x20'+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x3a3cb9=await this[_0xde882e(0x20f)][_0xde882e(0x2e1)](_0x532604),_0x2a2b0a=await this['connection'][_0xde882e(0x2e1)](_0x3e5d35);return!(0x0,utils_1[_0xde882e(0x21e)])(this[_0xde882e(0x176)])&&_0x2a2b0a[_0xde882e(0x2e4)](_0x7c378c=>{const _0x717314=_0xde882e;_0x7c378c[_0x717314(0x290)]=(0x0,utils_1[_0x717314(0x26b)])(_0x7c378c[_0x717314(0x290)]),_0x7c378c[_0x717314(0x1df)]=(0x0,utils_1[_0x717314(0x26b)])(_0x7c378c[_0x717314(0x1df)]),_0x7c378c[_0x717314(0x1bb)]=(0x0,utils_1[_0x717314(0x26b)])(_0x7c378c[_0x717314(0x1bb)]),_0x7c378c[_0x717314(0x1db)]=(0x0,utils_1['hideString'])(_0x7c378c[_0x717314(0x1db)]);}),{'rows':_0x2a2b0a,'count':Number(_0x3a3cb9[0x0]?.['count']||0x0)};}async[_0x4d5a00(0x17f)](_0x441f48){const _0x5206ab=_0x4d5a00,_0x16c3ba=await this[_0x5206ab(0x2a7)][_0x5206ab(0x1a8)]({'where':{'inviteCode':_0x441f48}});if(!_0x16c3ba)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x16c3ba,_0x589cdd=await this[_0x5206ab(0x2a7)][_0x5206ab(0x197)]({'inviteCode':_0x441f48},{'inviteLinkCount':inviteLinkCount+0x1});return _0x589cdd['affected']?0x1:0x0;}async[_0x4d5a00(0x2d4)](_0x437444){const _0x57694a=_0x4d5a00;return await this[_0x57694a(0x2a7)][_0x57694a(0x1a8)]({'where':{'inviteCode':_0x437444}});}async['queryAll'](_0x2f84b7,_0x41d9c2){const _0x476c07=_0x4d5a00,_0x1716b2=(0x0,utils_1[_0x476c07(0x303)])(this['clsService']);let {page:page=0x1,size:size=0xa,username:_0x49d339,phone:_0x3fa490,email:_0x393876,status:_0x549093,keyword:_0x425533,roleCode:_0x2fdab9,vip:_0x2dd865,saasId:_0x179bb2}=_0x2f84b7,_0x8a462f='1\x20=\x201';_0x549093&&(_0x8a462f=_0x8a462f+(_0x476c07(0x1e0)+_0x549093));_0x2fdab9&&(_0x8a462f=_0x8a462f+(_0x476c07(0x2f7)+_0x2fdab9+'\x27'));_0x2dd865&&(_0x2dd865=Number(_0x2dd865));if(_0x2dd865===0x1)_0x8a462f=_0x8a462f+_0x476c07(0x1ac);else _0x2dd865===0x0&&(_0x8a462f=_0x8a462f+_0x476c07(0x19d));_0x425533?_0x8a462f=_0x8a462f+('\x20AND\x20(username\x20LIKE\x20\x27%'+_0x425533+_0x476c07(0x1f2)+_0x425533+_0x476c07(0x18a)+_0x425533+_0x476c07(0x156)+_0x425533+_0x476c07(0x192)+_0x425533+'\x27)'):(_0x49d339&&(_0x8a462f=_0x8a462f+(_0x476c07(0x1a6)+_0x49d339+'%\x27')),_0x393876&&(_0x8a462f=_0x8a462f+(_0x476c07(0x1f1)+_0x393876+'%\x27')),_0x3fa490&&(_0x8a462f=_0x8a462f+(_0x476c07(0x2c0)+_0x3fa490+'%\x27')));(0x0,utils_1[_0x476c07(0x287)])(this[_0x476c07(0x176)])?(0x0,utils_1['isManage'])(this['clsService'])&&_0x179bb2&&(_0x8a462f=_0x8a462f+(_0x476c07(0x207)+_0x179bb2)):_0x8a462f=_0x8a462f+(_0x476c07(0x207)+_0x1716b2);const _0x19f9cf=await this[_0x476c07(0x20f)][_0x476c07(0x2e1)](_0x476c07(0x276)+_0x8a462f+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x142b4d=await this[_0x476c07(0x20f)][_0x476c07(0x2e1)](_0x476c07(0x265)+_0x8a462f+_0x476c07(0x239)+size+_0x476c07(0x22c)+(page-0x1)*size+_0x476c07(0x1d0)),_0xf94f7e=[],_0x1c612c=(0x0,utils_1[_0x476c07(0x21e)])(this['clsService']),_0x2668b9=new Map([[Role_constant_1[_0x476c07(0x1b8)]['AGENT'],_0x476c07(0x181)],[Role_constant_1['ERole']['SUPER'],_0x476c07(0x164)],[Role_constant_1['ERole'][_0x476c07(0x270)],_0x476c07(0x1d5)]]);for(let _0x352ab0=0x0;_0x352ab0<_0x142b4d[_0x476c07(0x247)];_0x352ab0++){const _0x6f6220=_0x142b4d[_0x352ab0];let _0x48df83=_0x476c07(0x1d5);if(_0x2668b9['has'](_0x6f6220[_0x476c07(0x166)]))_0x48df83=_0x2668b9['get'](_0x6f6220[_0x476c07(0x166)]);else{const _0x45ac24=await this['roleEntity']['findOne']({'where':{'code':_0x6f6220[_0x476c07(0x166)],'saasId':_0x6f6220[_0x476c07(0x261)]}});_0x48df83=_0x45ac24[_0x476c07(0x293)];}_0xf94f7e[_0x476c07(0x1c0)]({..._0x6f6220,'roleName':_0x48df83,'isBindWx':!!_0x6f6220?.[_0x476c07(0x308)],'password':_0x6f6220[_0x476c07(0x298)]?_0x476c07(0x1ec):'no','email':_0x1c612c?_0x6f6220[_0x476c07(0x1df)]:(0x0,utils_1['maskEmail'])(_0x6f6220[_0x476c07(0x1df)]),'phone':_0x1c612c?_0x6f6220[_0x476c07(0x290)]:(0x0,utils_1[_0x476c07(0x2c1)])(_0x6f6220[_0x476c07(0x290)]),'lastLoginIp':_0x1c612c?_0x6f6220[_0x476c07(0x29b)]:(0x0,utils_1[_0x476c07(0x198)])(_0x6f6220[_0x476c07(0x29b)])});}return{'rows':_0xf94f7e,'count':Number(_0x19f9cf[0x0]?.[_0x476c07(0x18e)]||0x0)};}async[_0x4d5a00(0x263)](_0x307b58){const _0x341aa0=_0x4d5a00,{page:page=0x1,size:size=0xa,username:_0x3c8340,status:_0x2ad124}=_0x307b58;let _0x288409={};_0x3c8340&&Object[_0x341aa0(0x2a6)](_0x288409,{'username':(0x0,typeorm_2[_0x341aa0(0x23d)])('%'+_0x3c8340+'%')}),_0x2ad124&&Object['assign'](_0x288409,{'status':_0x2ad124});const [_0x385fd2,_0x1e3246]=await this[_0x341aa0(0x2a7)][_0x341aa0(0x163)]({'skip':(page-0x1)*size,'where':_0x288409,'take':size,'cache':!![],'order':{'createdAt':'DESC'},'select':[_0x341aa0(0x211),'password',_0x341aa0(0x166),'status','id']});return{'rows':_0x385fd2,'count':_0x1e3246};}async[_0x4d5a00(0x283)]({id:_0x5dd8b5}){const _0x532719=_0x4d5a00;let _0x3dd71e,_0x207a1b;const _0x91c1a3=await this[_0x532719(0x2a7)][_0x532719(0x1a8)]({'where':{'id':_0x5dd8b5}});if(!_0x91c1a3)throw new common_1['HttpException'](_0x532719(0x264),common_1[_0x532719(0x2c6)][_0x532719(0x170)]);if((0x0,utils_1[_0x532719(0x2ba)])(_0x91c1a3[_0x532719(0x166)])){const _0x248bea=_0x91c1a3[_0x532719(0x166)]===Role_constant_1['ERole'][_0x532719(0x2ed)]?0x0:_0x91c1a3['saasId'],_0x49a9a5=await this[_0x532719(0x2a2)][_0x532719(0x1a8)]({'where':{'code':_0x91c1a3[_0x532719(0x166)],'saasId':_0x248bea}});if(!_0x49a9a5)throw new common_1[(_0x532719(0x1d2))](_0x532719(0x25a),common_1[_0x532719(0x2c6)][_0x532719(0x2fa)]);_0x3dd71e=_0x49a9a5[_0x532719(0x2a9)],_0x207a1b=_0x49a9a5[_0x532719(0x22f)];}return{..._0x91c1a3,'access':_0x3dd71e,'accessLabel':_0x207a1b,'isBindWx':!!_0x91c1a3?.[_0x532719(0x308)],'password':_0x91c1a3['password']?_0x532719(0x1ec):'no'};}async[_0x4d5a00(0x2f0)](_0x45916a){const _0xf04d3c=_0x4d5a00;return await this['userEntity'][_0xf04d3c(0x1a8)]({'where':{'username':_0x45916a}});}async[_0x4d5a00(0x21f)](_0x1b9019){const _0x461144=_0x4d5a00,{id:_0x111f8f,status:_0x37ea7f}=_0x1b9019,_0x31e119=await this[_0x461144(0x2a7)]['findOne']({'where':{'id':_0x111f8f}});if(!_0x31e119)throw new common_1[(_0x461144(0x1d2))](_0x461144(0x1b2),common_1[_0x461144(0x2c6)][_0x461144(0x2fa)]);if(_0x31e119[_0x461144(0x166)]===Role_constant_1[_0x461144(0x1b8)]['SUPER'])throw new common_1[(_0x461144(0x1d2))](_0x461144(0x246),common_1[_0x461144(0x2c6)]['BAD_REQUEST']);if(_0x31e119[_0x461144(0x17a)]===user_constant_1[_0x461144(0x210)][_0x461144(0x159)])throw new common_1[(_0x461144(0x1d2))](_0x461144(0x281),common_1[_0x461144(0x2c6)][_0x461144(0x2fa)]);if(_0x37ea7f===user_constant_1['UserStatusEnum'][_0x461144(0x159)])throw new common_1['HttpException'](_0x461144(0x2b7),common_1[_0x461144(0x2c6)][_0x461144(0x2fa)]);const _0x514dc5=await this[_0x461144(0x2a7)][_0x461144(0x197)]({'id':_0x111f8f},{'status':_0x37ea7f});if(_0x514dc5['affected']<=0x0)throw new common_1['HttpException'](_0x461144(0x1e7),common_1['HttpStatus'][_0x461144(0x2fa)]);return _0x461144(0x278);}async[_0x4d5a00(0x217)](_0x866554){const _0x5b948a=_0x4d5a00,{id:_0x503299}=_0x866554,_0x3e2d31=await this[_0x5b948a(0x2a7)][_0x5b948a(0x1a8)]({'where':{'id':_0x503299}});if(!_0x3e2d31)throw new common_1['HttpException'](_0x5b948a(0x1b2),common_1[_0x5b948a(0x2c6)]['BAD_REQUEST']);const _0x357e75=_0x5b948a(0x24c),_0x583d42=bcrypt[_0x5b948a(0x22e)](_0x357e75,0xa),_0x5d8406=await this[_0x5b948a(0x2a7)][_0x5b948a(0x197)]({'id':_0x503299},{'password':_0x583d42});if(_0x5d8406['affected']<=0x0)throw new common_1['HttpException'](_0x5b948a(0x29f),common_1['HttpStatus'][_0x5b948a(0x2fa)]);return'密码重置为['+_0x357e75+_0x5b948a(0x2dc);}async['savaLoginIp'](_0x1f6182,_0x3374fc){const _0x17523c=_0x4d5a00;return await this[_0x17523c(0x2a7)]['update']({'id':_0x1f6182},{'lastLoginIp':_0x3374fc});}async[_0x4d5a00(0x280)](_0x52fa7a,_0x5b04e2){const _0x448f74=_0x4d5a00;try{const _0x5d5a80=await this['userEntity'][_0x448f74(0x1a8)]({'where':{'id':_0x5b04e2}});if(!_0x5d5a80)return{'status':![],'msg':_0x448f74(0x213)};const _0x5e822b=await this[_0x448f74(0x2a7)][_0x448f74(0x1a8)]({'where':{'openId':_0x52fa7a}});if(_0x5e822b)return{'status':![],'msg':'该微信已绑定其他账号！'};const _0x3dcdd2=await this['userEntity'][_0x448f74(0x197)]({'id':_0x5b04e2},{'openId':_0x52fa7a});if(_0x3dcdd2[_0x448f74(0x234)]<=0x0)return{'status':![],'msg':'绑定微信失败、请联系管理员！'};return{'status':!![],'msg':'恭喜您绑定成功、后续可直接扫码登录了！'};}catch(_0x444824){return{'status':![],'msg':_0x448f74(0x25f)};}}async[_0x4d5a00(0x295)](_0x313029){const _0xf7b4cc=_0x4d5a00,_0x27de76=await this['userEntity'][_0xf7b4cc(0x1a8)]({'where':{'id':_0x313029}});return _0x27de76?.[_0xf7b4cc(0x308)];}async['getMiniOpenIdByUserId'](_0x15efb8){const _0x538860=_0x4d5a00,_0x81ad7b=await this[_0x538860(0x2a7)][_0x538860(0x1a8)]({'where':{'id':_0x15efb8}});return _0x81ad7b?.[_0x538860(0x174)];}async[_0x4d5a00(0x2b8)](_0x123d15){const _0x259906=_0x4d5a00,{username:_0x1a2de6,password:_0x4b0910,phone:_0x5818d3,phoneCode:_0x4c3539}=_0x123d15,_0xdbb8e6=await this['userEntity']['findOne']({'where':[{'username':_0x1a2de6},{'phone':_0x5818d3}]});if(_0xdbb8e6&&_0xdbb8e6[_0x259906(0x211)]===_0x1a2de6)throw new common_1['HttpException'](_0x259906(0x27d),common_1['HttpStatus'][_0x259906(0x2fa)]);if(_0xdbb8e6&&_0xdbb8e6[_0x259906(0x290)]===_0x5818d3)throw new common_1['HttpException'](_0x259906(0x2e2),common_1[_0x259906(0x2c6)][_0x259906(0x2fa)]);}async[_0x4d5a00(0x262)](_0x59397e){const _0x49c617=_0x4d5a00,_0x24e329=(0x0,utils_1[_0x49c617(0x303)])(this['clsService']);if(_0x59397e['role']!==Role_constant_1[_0x49c617(0x1b8)]['AGENT'])_0x59397e[_0x49c617(0x261)]=_0x24e329;else{if(!_0x59397e[_0x49c617(0x261)])throw new common_1[(_0x49c617(0x1d2))](_0x49c617(0x171),common_1['HttpStatus'][_0x49c617(0x2fa)]);}return await this[_0x49c617(0x2a7)][_0x49c617(0x208)](_0x59397e);}async[_0x4d5a00(0x24a)](_0x36354a){const _0x21ce29=_0x4d5a00,{id:_0x5f3c65,moreId:_0x16de56}=_0x36354a;if(_0x5f3c65)return await this[_0x21ce29(0x2a7)][_0x21ce29(0x243)]({'id':_0x5f3c65});if(_0x16de56)return await this[_0x21ce29(0x2a7)]['delete']({'id':(0x0,typeorm_2['MoreThan'])(_0x16de56)});}async[_0x4d5a00(0x228)](_0x1bf6d4){const _0x3c4ea9=_0x4d5a00,_0x21bf9b=_0x1bf6d4['user']['id'];return await this[_0x3c4ea9(0x2a7)]['delete']({'id':_0x21bf9b})[_0x3c4ea9(0x155)](_0x2db976=>_0x2db976[_0x3c4ea9(0x234)]>0x0);}async['create'](_0x1c6d4d,_0xa2785d){const _0x284ba4=_0x4d5a00;try{if(!_0x1c6d4d[_0x284ba4(0x211)]&&!_0x1c6d4d['phone']&&!_0x1c6d4d[_0x284ba4(0x1df)])throw new Error(_0x284ba4(0x2d7));if(_0x1c6d4d[_0x284ba4(0x211)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/['test'](_0x1c6d4d['username']))throw new Error(_0x284ba4(0x1ad));if(!_0x1c6d4d[_0x284ba4(0x298)])throw new Error(_0x284ba4(0x23f));}if(_0x1c6d4d['phone']){if(!(0x0,class_validator_1[_0x284ba4(0x288)])(_0x1c6d4d[_0x284ba4(0x290)],_0x284ba4(0x21d)))throw new Error(_0x284ba4(0x190));}if(_0x1c6d4d[_0x284ba4(0x1df)]){if(!(0x0,class_validator_1[_0x284ba4(0x1d4)])(_0x1c6d4d[_0x284ba4(0x1df)]))throw new Error('邮箱格式错误！');}if(_0x1c6d4d[_0x284ba4(0x211)]){const _0x2bb23f=await this['userEntity'][_0x284ba4(0x1ca)]({'where':{'username':_0x1c6d4d[_0x284ba4(0x211)]}});if(_0x2bb23f)throw new Error(_0x284ba4(0x2d8));}if(_0x1c6d4d[_0x284ba4(0x290)]){const _0x147d04=await this[_0x284ba4(0x2a7)][_0x284ba4(0x1ca)]({'where':{'phone':_0x1c6d4d['phone']}});if(_0x147d04)throw new Error(_0x284ba4(0x300));}if(_0x1c6d4d[_0x284ba4(0x1df)]){const _0x3c8360=await this['userEntity'][_0x284ba4(0x1ca)]({'where':{'email':_0x1c6d4d[_0x284ba4(0x1df)]}});if(_0x3c8360)throw new Error(_0x284ba4(0x157));}const _0x442346=new user_entity_1[(_0x284ba4(0x1c3))]();for(let _0x58aea8 in _0x1c6d4d){_0x1c6d4d[_0x58aea8]&&(_0x442346[_0x58aea8]=_0x1c6d4d[_0x58aea8]);}return _0x442346[_0x284ba4(0x298)]&&(_0x442346['password']=bcrypt[_0x284ba4(0x22e)](_0x1c6d4d[_0x284ba4(0x298)],0xa)),_0x442346[_0x284ba4(0x17a)]=user_constant_1[_0x284ba4(0x210)][_0x284ba4(0x309)],!_0x442346[_0x284ba4(0x2bb)]&&(_0x442346['nickname']=_0x442346[_0x284ba4(0x2bb)]||'小智'),!_0x442346['avatar']&&(_0x442346['avatar']=await this['globalConfigService'][_0x284ba4(0x25c)]([_0x284ba4(0x1b1)])),await this[_0x284ba4(0x262)](_0x442346),!![];}catch(_0x89055d){throw new common_1['HttpException'](_0x89055d['message'],common_1[_0x284ba4(0x2c6)][_0x284ba4(0x2fa)]);}}[_0x4d5a00(0x2c3)](){const _0x2941e1=_0x4d5a00;let _0x1ecd3b=_0x2941e1(0x2b2);const _0x3dd05d=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x259885=0x0;_0x259885<0xa;_0x259885++){_0x1ecd3b=_0x1ecd3b+_0x3dd05d[Math[_0x2941e1(0x269)](Math[_0x2941e1(0x18f)]()*0x3f)];}return _0x1ecd3b;}async[_0x4d5a00(0x215)](_0x255e75){const _0x497946=_0x4d5a00;let _0x1fe389=[];for(let _0x4bc3f9=0x0;_0x4bc3f9<_0x255e75;_0x4bc3f9++){_0x1fe389['push'](this[_0x497946(0x2c3)]());}const _0x3134bb=await this[_0x497946(0x2a7)][_0x497946(0x1cb)]({'where':{'username':(0x0,typeorm_2['In'])(_0x1fe389)}});if(!_0x3134bb[_0x497946(0x247)])return _0x1fe389;else{const _0x3e62e7=new Set(_0x3134bb[_0x497946(0x1ed)](_0x558d42=>_0x558d42[_0x497946(0x211)]));_0x1fe389=_0x1fe389[_0x497946(0x224)](_0x2ffbe1=>!_0x3e62e7[_0x497946(0x248)](_0x2ffbe1));const _0x1c1c3d=await this[_0x497946(0x215)](_0x3e62e7[_0x497946(0x1aa)]);return _0x1fe389=_0x1fe389[_0x497946(0x184)](_0x1c1c3d),_0x1fe389;}}async[_0x4d5a00(0x304)](_0x11d3a3,_0x271d53){const _0x281b52=_0x4d5a00,_0x18ac93=await this[_0x281b52(0x215)](_0x11d3a3['num']),_0x4636bb=[],_0x20c2ea=[],_0x59488d=await this[_0x281b52(0x2b3)]['getConfigByKeys']([_0x281b52(0x1b1)]);for(let _0xdf255e=0x0;_0xdf255e<_0x11d3a3[_0x281b52(0x2e6)];_0xdf255e++){const _0x2c4ab4=new user_entity_1['UserEntity']();_0x2c4ab4[_0x281b52(0x17a)]=0x1,_0x2c4ab4[_0x281b52(0x1cc)]=_0x59488d,_0x2c4ab4[_0x281b52(0x211)]=_0x18ac93[_0xdf255e],_0x2c4ab4['nickname']=_0x18ac93[_0xdf255e],_0x2c4ab4['password']=bcrypt['hashSync'](_0x281b52(0x167),0xa),_0x11d3a3[_0x281b52(0x1b3)]&&(_0x2c4ab4['vipLeavelId']=Number(_0x11d3a3[_0x281b52(0x1b3)])),_0x11d3a3[_0x281b52(0x212)]&&(_0x2c4ab4['vipLeavelName']=_0x11d3a3[_0x281b52(0x212)]),_0x11d3a3['score']&&(_0x2c4ab4[_0x281b52(0x294)]=_0x11d3a3['score']),_0x11d3a3['vipDays']&&_0x20c2ea[_0x281b52(0x1c0)]({'username':_0x18ac93[_0xdf255e],'vipDays':_0x11d3a3[_0x281b52(0x2e9)]}),_0x4636bb[_0x281b52(0x1c0)](_0x2c4ab4);}try{return await this[_0x281b52(0x20f)]['transaction'](async()=>{const _0x2a9fad=_0x281b52;await this['userEntity'][_0x2a9fad(0x208)](_0x4636bb),await this['userInitVipEntity'][_0x2a9fad(0x208)](_0x20c2ea);}),!![];}catch(_0x3dbf3d){throw new common_1['HttpException'](_0x3dbf3d[_0x281b52(0x153)],axios_1['HttpStatusCode'][_0x281b52(0x219)]);}}async[_0x4d5a00(0x1b5)](_0x11c3f9,_0x4a4cc6){const _0x30c213=_0x4d5a00,_0x5de1a9=await this['userEntity'][_0x30c213(0x1a8)]({'where':{'id':_0x4a4cc6[_0x30c213(0x27a)]}});await this[_0x30c213(0x2a7)][_0x30c213(0x2dd)]({'id':_0x5de1a9['id']},'score',_0x4a4cc6['score']),await this[_0x30c213(0x15f)][_0x30c213(0x279)]({'userId':_0x5de1a9['id'],'rawScore':_0x5de1a9[_0x30c213(0x294)],'newScore':_0x5de1a9[_0x30c213(0x294)]+_0x4a4cc6['score'],'changeScore':_0x4a4cc6[_0x30c213(0x294)],'changeType':balance_constant_1[_0x30c213(0x1bf)][_0x30c213(0x2f9)],'rebateUserId':_0x11c3f9['user']['id'],'description':_0x30c213(0x28f)});}async[_0x4d5a00(0x302)](_0x296226,_0x567151){const _0xf83fda=_0x4d5a00,_0xa6edf2=await this['userEntity'][_0xf83fda(0x1a8)]({'where':{'id':_0x567151[_0xf83fda(0x27a)]}});return await this['updateVipExpire'](_0xa6edf2,balance_constant_1[_0xf83fda(0x1bf)][_0xf83fda(0x2f9)],_0x567151[_0xf83fda(0x15b)],_0xf83fda(0x28f),_0x296226[_0xf83fda(0x1af)]['id']),!![];}async[_0x4d5a00(0x16a)](_0x3326cb){const _0x3408aa=_0x4d5a00,_0x334aaf=await this[_0x3408aa(0x2c5)]['findOne']({'where':{'username':_0x3326cb[_0x3408aa(0x211)]}});_0x334aaf&&await this[_0x3408aa(0x20f)][_0x3408aa(0x1d7)](async()=>{const _0x279310=_0x3408aa;_0x334aaf[_0x279310(0x2e9)]===-0x1?_0x3326cb[_0x279310(0x2a5)]=0x1:_0x3326cb[_0x279310(0x25e)]=(0x0,date_1[_0x279310(0x15a)])()['add'](_0x334aaf['vipDays'],'day')[_0x279310(0x16e)](),_0x3326cb=await this[_0x279310(0x2a7)]['save'](_0x3326cb),await this[_0x279310(0x2c5)]['delete']({'id':_0x334aaf['id']});});}async['updateSignDay'](_0x18a3f4,_0x3d07b9){const _0x2571b6=_0x4d5a00;await this[_0x2571b6(0x2a7)][_0x2571b6(0x197)]({'id':_0x18a3f4},{'consecutiveDays':_0x3d07b9});}async[_0x4d5a00(0x154)](_0x258d1c){const _0x23fe0e=_0x4d5a00,_0x1f3c14=await this['getUserById'](_0x258d1c);_0x1f3c14['violationCount']=_0x1f3c14[_0x23fe0e(0x289)]+0x1,await this['userEntity'][_0x23fe0e(0x208)](_0x1f3c14);}async[_0x4d5a00(0x161)](_0x16fa4b,_0x289248){const _0x3108a6=_0x4d5a00,_0x36e8db=await this[_0x3108a6(0x2b3)][_0x3108a6(0x25c)](['registerSendStatus',_0x3108a6(0x2bf),_0x3108a6(0x2ff),_0x3108a6(0x291),_0x3108a6(0x189),_0x3108a6(0x1a0),_0x3108a6(0x237)]),_0x254f0c={};for(let _0xd9d656 in _0x36e8db){const _0x38818b=Number(_0x36e8db[_0xd9d656]),_0x3ad482=Number['isInteger'](_0x38818b)&&_0x38818b>0x0?_0x38818b:0x0;_0x254f0c[_0xd9d656]=_0x3ad482;}_0x254f0c[_0x3108a6(0x183)]&&(await this[_0x3108a6(0x2a7)]['update']({'id':_0x16fa4b['id']},{'score':_0x254f0c['registerRewards']}),await this['userBalanceService'][_0x3108a6(0x279)]({'userId':_0x16fa4b['id'],'rawScore':0x0,'newScore':_0x254f0c['registerRewards'],'changeScore':_0x254f0c[_0x3108a6(0x2bf)],'changeType':balance_constant_1[_0x3108a6(0x1bf)]['Registe'],'description':_0x3108a6(0x180)}));if(_0x289248&&_0x254f0c['inviteSendStatus']){_0x254f0c[_0x3108a6(0x291)]&&(await this[_0x3108a6(0x2a7)]['increment']({'id':_0x289248['id']},'score',_0x254f0c[_0x3108a6(0x291)]),await this['userBalanceService'][_0x3108a6(0x279)]({'userId':_0x289248['id'],'rawScore':_0x289248['score'],'newScore':_0x289248['score']+_0x254f0c[_0x3108a6(0x291)],'changeScore':_0x254f0c[_0x3108a6(0x291)],'changeType':balance_constant_1['EChangeType'][_0x3108a6(0x1ab)],'rebateUserId':_0x16fa4b['id'],'description':'邀请新用户注册奖励'}));_0x254f0c[_0x3108a6(0x189)]&&await this[_0x3108a6(0x2d5)](_0x289248,balance_constant_1[_0x3108a6(0x1bf)]['InvitationReward'],_0x254f0c[_0x3108a6(0x189)],_0x3108a6(0x2a8),_0x16fa4b['id']);const _0x226137=await this[_0x3108a6(0x2a7)][_0x3108a6(0x1a8)]({'where':{'id':_0x16fa4b['id']}});_0x254f0c[_0x3108a6(0x1a0)]&&(await this[_0x3108a6(0x2a7)][_0x3108a6(0x2dd)]({'id':_0x226137['id']},_0x3108a6(0x294),_0x254f0c[_0x3108a6(0x1a0)]),await this[_0x3108a6(0x15f)][_0x3108a6(0x279)]({'userId':_0x16fa4b['id'],'rawScore':_0x226137['score'],'newScore':_0x226137['score']+_0x254f0c[_0x3108a6(0x1a0)],'changeScore':_0x254f0c['invitedRewards'],'changeType':balance_constant_1[_0x3108a6(0x1bf)]['Invited'],'rebateUserId':_0x289248['id'],'description':_0x3108a6(0x2bd)})),_0x254f0c[_0x3108a6(0x237)]&&await this[_0x3108a6(0x2d5)](_0x226137,balance_constant_1[_0x3108a6(0x1bf)][_0x3108a6(0x1f5)],_0x254f0c[_0x3108a6(0x237)],'受邀请注册赠送',_0x289248['id']);}}async[_0x4d5a00(0x23b)](_0x51c68d,_0x5ec9dc,_0x5e31c9,_0x239c45,_0x5b841b){const _0x2fc8cf=_0x4d5a00;await this[_0x2fc8cf(0x2a7)][_0x2fc8cf(0x197)]({'id':_0x51c68d['id']},{'score':_0x51c68d[_0x2fc8cf(0x294)]+_0x5e31c9}),await this['userBalanceService'][_0x2fc8cf(0x279)]({'userId':_0x51c68d['id'],'rawScore':_0x51c68d[_0x2fc8cf(0x294)],'newScore':_0x51c68d[_0x2fc8cf(0x294)]+_0x5e31c9,'changeScore':_0x5e31c9,'changeType':_0x5ec9dc,'relateId':_0x5b841b?String(_0x5b841b):null,'description':_0x239c45});}async['updateVipExpire'](_0x26321a,_0x22d766,_0x4b84f7,_0x28bff5,_0x5bfa3f){const _0x1ad5e0=_0x4d5a00;if(_0x26321a[_0x1ad5e0(0x2a5)])return;_0x4b84f7===-0x1?await this[_0x1ad5e0(0x2a7)][_0x1ad5e0(0x197)]({'id':_0x26321a['id']},{'lifetimeVip':0x1}):(_0x26321a[_0x1ad5e0(0x25e)]?_0x26321a['vipExpire']=(0x0,date_1[_0x1ad5e0(0x15a)])(_0x26321a['vipExpire'])[_0x1ad5e0(0x2df)](_0x4b84f7,_0x1ad5e0(0x2f1))['toDate']():_0x26321a['vipExpire']=(0x0,date_1[_0x1ad5e0(0x15a)])()[_0x1ad5e0(0x2df)](_0x4b84f7,_0x1ad5e0(0x2f1))[_0x1ad5e0(0x16e)](),await this['userEntity'][_0x1ad5e0(0x197)]({'id':_0x26321a['id']},{'vipExpire':_0x26321a['vipExpire']})),_0x26321a=await this[_0x1ad5e0(0x2a7)][_0x1ad5e0(0x1a8)]({'where':{'id':_0x26321a['id']}}),await this[_0x1ad5e0(0x15f)]['insertAccountVipLog']({'userId':_0x26321a['id'],'vipDays':_0x4b84f7,'vipExpire':_0x26321a[_0x1ad5e0(0x25e)],'relateType':_0x22d766,'relateId':_0x5bfa3f?String(_0x5bfa3f):'','description':_0x28bff5});}async['validateBalance4Chat'](_0x4eee6b,_0x173061){const _0x4de86a=_0x4d5a00;let _0x5ad8cc=!![];const _0x2bd1dd=await this['getUserById'](_0x4eee6b);if(_0x2bd1dd[_0x4de86a(0x2a5)]||_0x2bd1dd[_0x4de86a(0x25e)]){if(_0x173061[_0x4de86a(0x2b1)]<0x0)_0x5ad8cc=!![];else{if(_0x173061[_0x4de86a(0x2b1)]>0x0){const _0x1b7b90=redisKey_constant_1[_0x4de86a(0x24d)]+'-'+_0x4eee6b+'-'+_0x173061['id'];let _0x5bf7ae=await this['redisCacheService'][_0x4de86a(0x18d)]({'key':_0x1b7b90});console[_0x4de86a(0x22d)](_0x5bf7ae);let _0x335508=Number(_0x5bf7ae||0x0);_0x335508<_0x173061[_0x4de86a(0x2b1)]?_0x5ad8cc=!![]:_0x5ad8cc=_0x2bd1dd[_0x4de86a(0x294)]>=_0x173061['deduct'];}else _0x5ad8cc=_0x2bd1dd[_0x4de86a(0x294)]>=_0x173061['deduct'];}}else _0x5ad8cc=_0x2bd1dd[_0x4de86a(0x294)]>=_0x173061[_0x4de86a(0x285)];if(!_0x5ad8cc)throw new common_1[(_0x4de86a(0x1d2))](_0x4de86a(0x2ea),common_1[_0x4de86a(0x2c6)][_0x4de86a(0x2fa)]);}async['deductBalance4Chat'](_0x349937,_0x2a2f15,_0x14cd9c){const _0x4cf8ff=_0x4d5a00,_0x4f16ac=await this[_0x4cf8ff(0x245)](_0x349937);let _0x5a4297;switch(_0x2a2f15[_0x4cf8ff(0x1b0)]){case model_constant_1[_0x4cf8ff(0x1f0)]['PPT']:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x275)];break;case model_constant_1['EModelType'][_0x4cf8ff(0x23a)]:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x195)];break;case model_constant_1[_0x4cf8ff(0x1f0)][_0x4cf8ff(0x18c)]:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x23e)];break;case model_constant_1['EModelType']['VIDEO']:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x2c8)];break;case model_constant_1[_0x4cf8ff(0x1f0)][_0x4cf8ff(0x252)]:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x182)];break;case model_constant_1[_0x4cf8ff(0x1f0)][_0x4cf8ff(0x1d1)]:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x307)];break;case model_constant_1[_0x4cf8ff(0x1f0)][_0x4cf8ff(0x1d9)]:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x2fe)];break;case model_constant_1['EModelType'][_0x4cf8ff(0x222)]:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x16b)];break;case model_constant_1[_0x4cf8ff(0x1f0)]['TTS']:_0x5a4297=balance_constant_1[_0x4cf8ff(0x1bf)][_0x4cf8ff(0x214)];break;default:_0x5a4297=balance_constant_1['EChangeType'][_0x4cf8ff(0x307)];}if(_0x4f16ac[_0x4cf8ff(0x2a5)]||_0x4f16ac[_0x4cf8ff(0x25e)]){if(_0x2a2f15['vipFreeNum']<0x0)await this[_0x4cf8ff(0x23b)](_0x4f16ac,_0x5a4297,0x0,'模型【'+_0x2a2f15[_0x4cf8ff(0x220)]+_0x4cf8ff(0x2ce),_0x14cd9c);else{if(_0x2a2f15['vipFreeNum']>0x0){const _0x567aba=redisKey_constant_1[_0x4cf8ff(0x24d)]+'-'+_0x349937+'-'+_0x2a2f15['id'];let _0x52a9a4=await this[_0x4cf8ff(0x2cf)][_0x4cf8ff(0x18d)]({'key':_0x567aba}),_0x43ff91=Number(_0x52a9a4||0x0);if(_0x43ff91<_0x2a2f15[_0x4cf8ff(0x2b1)]){const _0x6c4864=(0x0,date_1[_0x4cf8ff(0x15a)])()[_0x4cf8ff(0x305)]('d')[_0x4cf8ff(0x185)]((0x0,date_1['default'])(),'s');await this[_0x4cf8ff(0x2cf)][_0x4cf8ff(0x1d8)]({'key':_0x567aba,'val':_0x43ff91+0x1},_0x6c4864),await this['changeScore4Other'](_0x4f16ac,_0x5a4297,0x0,_0x4cf8ff(0x30b)+_0x2a2f15['modelName']+'】会员每日限免',_0x14cd9c);}else await this[_0x4cf8ff(0x23b)](_0x4f16ac,_0x5a4297,-_0x2a2f15[_0x4cf8ff(0x285)],'模型【'+_0x2a2f15[_0x4cf8ff(0x220)]+_0x4cf8ff(0x266),_0x14cd9c);}else await this[_0x4cf8ff(0x23b)](_0x4f16ac,_0x5a4297,-_0x2a2f15['deduct'],'模型【'+_0x2a2f15[_0x4cf8ff(0x220)]+_0x4cf8ff(0x266),_0x14cd9c);}}else await this[_0x4cf8ff(0x23b)](_0x4f16ac,_0x5a4297,-_0x2a2f15['deduct'],_0x4cf8ff(0x30b)+_0x2a2f15[_0x4cf8ff(0x220)]+'】使用扣减',_0x14cd9c);}async[_0x4d5a00(0x22b)](_0x2d2d5f,_0x27d025,_0x25744e){const _0x37a624=_0x4d5a00,_0x4e63aa=await this[_0x37a624(0x245)](_0x2d2d5f);let _0x54022f;switch(_0x27d025['modelType']){case model_constant_1['EModelType'][_0x37a624(0x23a)]:_0x54022f=balance_constant_1[_0x37a624(0x1bf)][_0x37a624(0x195)];break;case model_constant_1[_0x37a624(0x1f0)][_0x37a624(0x18c)]:_0x54022f=balance_constant_1[_0x37a624(0x1bf)][_0x37a624(0x23e)];break;case model_constant_1[_0x37a624(0x1f0)][_0x37a624(0x252)]:_0x54022f=balance_constant_1[_0x37a624(0x1bf)][_0x37a624(0x182)];break;case model_constant_1[_0x37a624(0x1f0)][_0x37a624(0x1d1)]:_0x54022f=balance_constant_1[_0x37a624(0x1bf)][_0x37a624(0x307)];break;case model_constant_1['EModelType'][_0x37a624(0x1d9)]:_0x54022f=balance_constant_1[_0x37a624(0x1bf)]['Tool'];break;default:_0x54022f=balance_constant_1['EChangeType'][_0x37a624(0x307)];}await this[_0x37a624(0x23b)](_0x4e63aa,_0x54022f,_0x27d025[_0x37a624(0x285)],_0x37a624(0x30b)+_0x27d025['modelName']+'】调用失败退还',_0x25744e);}async[_0x4d5a00(0x20d)](_0x196866,_0xb980c,_0x2eaaa7){const _0x20ec12=_0x4d5a00;let _0x18ea23='',_0x1e720c='',_0x3ba962='',_0x107e69=_0xb980c;const _0x4c3612=_0xb980c[_0x20ec12(0x17b)](),_0x2d21aa=new RegExp(_0x20ec12(0x28b)),_0x11deb9=new RegExp(_0x20ec12(0x16c)),_0x39e554=new RegExp(_0x20ec12(0x2bc));if(_0x196866===midjourney_constant_1[_0x20ec12(0x1ae)]['fast'])_0x1e720c=_0x20ec12(0x26a),_0x18ea23='fast_mjDeduction',_0x3ba962=_0x20ec12(0x1ce);else{if(_0x196866===midjourney_constant_1['DrawSpeed']['relax'])_0x1e720c=_0x20ec12(0x2db),_0x18ea23=_0x20ec12(0x1a1),_0x3ba962='relax_vip_free';else _0x196866===midjourney_constant_1[_0x20ec12(0x1ae)]['turbo']&&(_0x1e720c=_0x20ec12(0x227),_0x18ea23=_0x20ec12(0x177),_0x3ba962='turbo_vip_free');}if(_0x2d21aa[_0x20ec12(0x20e)](_0x4c3612))_0x18ea23=_0x18ea23+0x1;else{if(_0x11deb9[_0x20ec12(0x20e)](_0x4c3612))_0x18ea23=_0x18ea23+0x2;else _0x39e554['test'](_0x4c3612)&&(_0x18ea23=_0x18ea23+0x3);}const _0x1be4fd={},_0x5565b5=await this[_0x20ec12(0x2b3)][_0x20ec12(0x25c)]([_0x18ea23,_0x3ba962]);for(let _0x390cb7 in _0x5565b5){_0x1be4fd[_0x390cb7]=Number(_0x5565b5[_0x390cb7])||0x0;}if(_0x2eaaa7[_0x20ec12(0x1b3)]){const _0x227eea=await this[_0x20ec12(0x2b3)][_0x20ec12(0x19a)](_0x2eaaa7[_0x20ec12(0x1b3)],'mj');_0x227eea&&(_0x1be4fd[_0x3ba962]=_0x227eea[_0x1e720c]||0x0);}for(let _0x261000 in midjourney_constant_1[_0x20ec12(0x274)]){if(_0x4c3612[_0x20ec12(0x1ea)](midjourney_constant_1[_0x20ec12(0x274)][_0x261000][_0x20ec12(0x226)])){_0x107e69=midjourney_constant_1['ActionCN'][_0x261000]['cn'];break;}}return{'price':_0x1be4fd[_0x18ea23],'vipFreeNum':_0x1be4fd[_0x3ba962],'vipFreeKey':_0x3ba962,'description':_0x107e69};}async['validateBalance4MJ'](_0x2f9474,_0x32bd8e,_0x5b98f6){const _0x474312=_0x4d5a00;let _0x30d32d=!![];const _0x1f1d28=await this[_0x474312(0x245)](_0x2f9474),_0x4c15e2=await this[_0x474312(0x20d)](_0x32bd8e,_0x5b98f6,_0x1f1d28);if(_0x1f1d28[_0x474312(0x2a5)]||_0x1f1d28[_0x474312(0x25e)]){if(_0x4c15e2['vipFreeNum']<0x0)_0x30d32d=!![];else{if(_0x4c15e2[_0x474312(0x2b1)]>0x0){const _0x273057=redisKey_constant_1[_0x474312(0x24d)]+'-'+_0x2f9474+'-'+_0x4c15e2[_0x474312(0x1de)];let _0x573621=await this[_0x474312(0x2cf)][_0x474312(0x18d)]({'key':_0x273057}),_0x36c290=Number(_0x573621||0x0);_0x36c290<_0x4c15e2[_0x474312(0x2b1)]?_0x30d32d=!![]:_0x30d32d=_0x1f1d28[_0x474312(0x294)]>=_0x4c15e2[_0x474312(0x196)];}else _0x30d32d=_0x1f1d28[_0x474312(0x294)]>=_0x4c15e2[_0x474312(0x196)];}}else _0x30d32d=_0x1f1d28['score']>=_0x4c15e2[_0x474312(0x196)];if(!_0x30d32d)throw new common_1[(_0x474312(0x1d2))]('用户余额不足，请充值',common_1['HttpStatus'][_0x474312(0x2fa)]);}async[_0x4d5a00(0x1c4)](_0x327985,_0x1cb1ce,_0x39186d,_0x7f0d32){const _0x392149=_0x4d5a00,_0x44dafc=await this[_0x392149(0x245)](_0x327985),_0x15ed63=await this['getMjPrice'](_0x1cb1ce,_0x39186d,_0x44dafc),_0x44572a=balance_constant_1[_0x392149(0x1bf)][_0x392149(0x2ee)];if(_0x44dafc[_0x392149(0x2a5)]||_0x44dafc['vipExpire']){if(_0x15ed63[_0x392149(0x2b1)]<0x0)await this[_0x392149(0x23b)](_0x44dafc,_0x44572a,0x0,'MJ绘画【'+_0x15ed63['description']+_0x392149(0x2ce),_0x7f0d32);else{if(_0x15ed63[_0x392149(0x2b1)]>0x0){const _0x214166=redisKey_constant_1[_0x392149(0x24d)]+'-'+_0x327985+'-'+_0x15ed63[_0x392149(0x1de)];let _0x4f6cc4=await this['redisCacheService'][_0x392149(0x18d)]({'key':_0x214166}),_0x1a0ba4=Number(_0x4f6cc4||0x0);if(_0x1a0ba4<_0x15ed63[_0x392149(0x2b1)]){const _0x3184f4=(0x0,date_1['default'])()[_0x392149(0x305)]('d')['diff']((0x0,date_1[_0x392149(0x15a)])(),'s');await this[_0x392149(0x2cf)]['set']({'key':_0x214166,'val':_0x1a0ba4+0x1},_0x3184f4),await this[_0x392149(0x23b)](_0x44dafc,_0x44572a,0x0,'MJ绘画【'+_0x15ed63[_0x392149(0x1b7)]+_0x392149(0x173),_0x7f0d32);}else await this[_0x392149(0x23b)](_0x44dafc,_0x44572a,-_0x15ed63[_0x392149(0x196)],_0x392149(0x1e5)+_0x15ed63['description']+'】使用扣减',_0x7f0d32);}else await this[_0x392149(0x23b)](_0x44dafc,_0x44572a,-_0x15ed63[_0x392149(0x196)],'MJ绘画【'+_0x15ed63[_0x392149(0x1b7)]+'】使用扣减',_0x7f0d32);}}else await this['changeScore4Other'](_0x44dafc,_0x44572a,-_0x15ed63[_0x392149(0x196)],'MJ绘画【'+_0x15ed63[_0x392149(0x1b7)]+_0x392149(0x266),_0x7f0d32);}async[_0x4d5a00(0x1cd)](_0x25bdc5,_0x24f31b,_0x2f9f84,_0x1e8e7e=![]){const _0x1aa355=_0x4d5a00,_0x58c72d={'structure':{'key':_0x1aa355(0x1e1),'vlrk':'type1','desc':_0x1aa355(0x225)},'cover':{'key':_0x1aa355(0x1e1),'vlrk':_0x1aa355(0x26a),'desc':'封面任务'},'recover':{'key':_0x1aa355(0x1e1),'vlrk':'type1','desc':_0x1aa355(0x16f)},'create':{'key':'pptCreate','vlrk':_0x1aa355(0x2db),'desc':_0x1aa355(0x1a9)},'thesis':{'key':_0x1aa355(0x26c),'vlrk':_0x1aa355(0x227),'desc':_0x1aa355(0x1eb)},'file':{'key':_0x1aa355(0x19f),'vlrk':_0x1aa355(0x2db),'desc':_0x1aa355(0x218)},'theme':{'key':_0x1aa355(0x19f),'vlrk':_0x1aa355(0x2db),'desc':'更换模板'},'addpage':{'key':_0x1aa355(0x19f),'vlrk':_0x1aa355(0x2db),'desc':_0x1aa355(0x168)},'addNotes':{'key':_0x1aa355(0x19f),'vlrk':_0x1aa355(0x2db),'desc':'增加PPT备注'}},_0x5c303e=_0x58c72d[_0x2f9f84][_0x1aa355(0x250)],_0x257e84=_0x58c72d[_0x2f9f84][_0x1aa355(0x1ef)]+_0x1aa355(0x201),_0x33350f=_0x58c72d[_0x2f9f84][_0x1aa355(0x1ef)]+_0x1aa355(0x2da),_0x140db9={},_0x163646=await this['globalConfigService'][_0x1aa355(0x25c)]([_0x257e84,_0x33350f]);for(let _0x116dcb in _0x163646){_0x140db9[_0x116dcb]=Number(_0x163646[_0x116dcb])||0x0;}const _0x280f8b=await this[_0x1aa355(0x245)](_0x25bdc5);if(_0x280f8b[_0x1aa355(0x1b3)]){const _0xf7eb84=await this[_0x1aa355(0x2b3)][_0x1aa355(0x19a)](_0x280f8b[_0x1aa355(0x1b3)],model_constant_1['EModelType'][_0x1aa355(0x275)]);_0xf7eb84&&(_0x140db9[_0x33350f]=_0xf7eb84[_0x58c72d[_0x2f9f84][_0x1aa355(0x1f3)]]||0x0);}if(_0x280f8b['lifetimeVip']||_0x280f8b[_0x1aa355(0x25e)]){if(_0x140db9[_0x33350f]<0x0)await this[_0x1aa355(0x23b)](_0x280f8b,balance_constant_1[_0x1aa355(0x1bf)][_0x1aa355(0x275)],0x0,_0x1aa355(0x282)+_0x5c303e+_0x1aa355(0x2ce),_0x24f31b);else{if(_0x140db9[_0x33350f]>0x0){const _0x6e62d=redisKey_constant_1[_0x1aa355(0x24d)]+'-'+_0x25bdc5+'-'+_0x33350f;let _0x503c47=await this['redisCacheService'][_0x1aa355(0x18d)]({'key':_0x6e62d}),_0x1b6984=Number(_0x503c47||0x0);if(_0x1b6984<_0x140db9[_0x33350f]){const _0xda19ec=(0x0,date_1[_0x1aa355(0x15a)])()[_0x1aa355(0x305)]('d')['diff']((0x0,date_1[_0x1aa355(0x15a)])(),'s');await this[_0x1aa355(0x2cf)]['set']({'key':_0x6e62d,'val':_0x1b6984+0x1},_0xda19ec),await this[_0x1aa355(0x23b)](_0x280f8b,balance_constant_1[_0x1aa355(0x1bf)][_0x1aa355(0x275)],0x0,_0x1aa355(0x282)+_0x5c303e+_0x1aa355(0x173),_0x24f31b);}else await this[_0x1aa355(0x23b)](_0x280f8b,balance_constant_1[_0x1aa355(0x1bf)][_0x1aa355(0x275)],-_0x140db9[_0x257e84],_0x1aa355(0x282)+_0x5c303e+_0x1aa355(0x266),_0x24f31b);}else await this['changeScore4Other'](_0x280f8b,balance_constant_1['EChangeType'][_0x1aa355(0x275)],-_0x140db9[_0x257e84],'PPT【'+_0x5c303e+_0x1aa355(0x266),_0x24f31b);}}else await this[_0x1aa355(0x23b)](_0x280f8b,balance_constant_1[_0x1aa355(0x1bf)]['PPT'],-_0x140db9[_0x257e84],'PPT【'+_0x5c303e+'】使用扣减',_0x24f31b);}async[_0x4d5a00(0x2f2)](_0x2568e7,_0x4b3b30,_0x48c753){const _0xa43503=_0x4d5a00,_0x33f922=await this[_0xa43503(0x245)](_0x2568e7);if(_0x33f922['lifetimeVip']||_0x33f922['vipExpire']){if(_0x4b3b30['vipFreeNum']<0x0)await this[_0xa43503(0x23b)](_0x33f922,balance_constant_1[_0xa43503(0x1bf)][_0xa43503(0x242)],0x0,'小工具【'+_0x4b3b30[_0xa43503(0x220)]+_0xa43503(0x2ce),_0x48c753);else{if(_0x4b3b30[_0xa43503(0x2b1)]>0x0){const _0x14c48b=redisKey_constant_1[_0xa43503(0x24d)]+'-'+_0x2568e7+'-'+_0x4b3b30['id'];let _0x540512=await this['redisCacheService'][_0xa43503(0x18d)]({'key':_0x14c48b}),_0x22414c=Number(_0x540512||0x0);if(_0x22414c<_0x4b3b30[_0xa43503(0x2b1)]){const _0x3ad977=(0x0,date_1[_0xa43503(0x15a)])()[_0xa43503(0x305)]('d')['diff']((0x0,date_1[_0xa43503(0x15a)])(),'s');await this['redisCacheService'][_0xa43503(0x1d8)]({'key':_0x14c48b,'val':_0x22414c+0x1},_0x3ad977),await this[_0xa43503(0x23b)](_0x33f922,balance_constant_1[_0xa43503(0x1bf)][_0xa43503(0x242)],0x0,_0xa43503(0x251)+_0x4b3b30[_0xa43503(0x220)]+'】会员每日限免',_0x48c753);}else await this['changeScore4Other'](_0x33f922,balance_constant_1['EChangeType'][_0xa43503(0x242)],-_0x4b3b30[_0xa43503(0x285)],_0xa43503(0x251)+_0x4b3b30[_0xa43503(0x220)]+_0xa43503(0x266),_0x48c753);}else await this[_0xa43503(0x23b)](_0x33f922,balance_constant_1['EChangeType'][_0xa43503(0x242)],-_0x4b3b30[_0xa43503(0x285)],_0xa43503(0x251)+_0x4b3b30[_0xa43503(0x220)]+_0xa43503(0x266),_0x48c753);}}else await this[_0xa43503(0x23b)](_0x33f922,balance_constant_1[_0xa43503(0x1bf)][_0xa43503(0x242)],-_0x4b3b30['deduct'],_0xa43503(0x251)+_0x4b3b30['modelName']+'】使用扣减',_0x48c753);}async[_0x4d5a00(0x194)](_0x2e194d,_0x323a0d){const _0x3fb9a2=_0x4d5a00,_0x2491d5=store_1[_0x3fb9a2(0x2c7)][_0x3fb9a2(0x26f)],_0xc2162e=await this['getUserById'](_0x2e194d),_0x3d0a6c=balance_constant_1[_0x3fb9a2(0x1bf)]['SD'];if(_0xc2162e[_0x3fb9a2(0x2a5)]||_0xc2162e[_0x3fb9a2(0x25e)]){if(store_1[_0x3fb9a2(0x2c7)][_0x3fb9a2(0x1f4)]<0x0)await this[_0x3fb9a2(0x23b)](_0xc2162e,_0x3d0a6c,0x0,_0x3fb9a2(0x15d),_0x323a0d);else{if(store_1[_0x3fb9a2(0x2c7)]['czVipFree']>0x0){const _0x22c1ae=redisKey_constant_1['VIP_FREE']+'-'+_0x2e194d+_0x3fb9a2(0x1fe);let _0x3d7c44=await this[_0x3fb9a2(0x2cf)]['get']({'key':_0x22c1ae}),_0xcaadeb=Number(_0x3d7c44||0x0);if(_0xcaadeb<store_1[_0x3fb9a2(0x2c7)][_0x3fb9a2(0x1f4)]){const _0x28a825=(0x0,date_1[_0x3fb9a2(0x15a)])()[_0x3fb9a2(0x305)]('d')[_0x3fb9a2(0x185)]((0x0,date_1[_0x3fb9a2(0x15a)])(),'s');await this[_0x3fb9a2(0x2cf)]['set']({'key':_0x22c1ae,'val':_0xcaadeb+0x1},_0x28a825),await this[_0x3fb9a2(0x23b)](_0xc2162e,_0x3d0a6c,0x0,_0x3fb9a2(0x21c)+_0x2491d5+_0x3fb9a2(0x173),_0x323a0d);}else await this[_0x3fb9a2(0x23b)](_0xc2162e,_0x3d0a6c,-_0x2491d5,'SD绘画【'+_0x2491d5+_0x3fb9a2(0x266),_0x323a0d);}else await this['changeScore4Other'](_0xc2162e,_0x3d0a6c,-_0x2491d5,_0x3fb9a2(0x21c)+_0x2491d5+_0x3fb9a2(0x266),_0x323a0d);}}else await this[_0x3fb9a2(0x23b)](_0xc2162e,_0x3d0a6c,-_0x2491d5,_0x3fb9a2(0x21c)+_0x2491d5+_0x3fb9a2(0x266),_0x323a0d);}async[_0x4d5a00(0x2a1)](){const _0x138d9d=_0x4d5a00,_0x36e4d4=await this[_0x138d9d(0x2a7)]['find']({'where':{'vipExpire':(0x0,typeorm_2[_0x138d9d(0x231)])((0x0,date_1[_0x138d9d(0x15a)])()['startOf']('d')[_0x138d9d(0x16e)](),(0x0,date_1['default'])()[_0x138d9d(0x305)]('d')[_0x138d9d(0x16e)]())}});if(_0x36e4d4[_0x138d9d(0x247)])for(let _0x4228bb=0x0;_0x4228bb<_0x36e4d4[_0x138d9d(0x247)];_0x4228bb++){const _0x2e63a5=_0x36e4d4[_0x4228bb];await this[_0x138d9d(0x2cf)][_0x138d9d(0x1d8)]({'key':redisKey_constant_1[_0x138d9d(0x258)]+_0x2e63a5['id'],'val':''},(0x0,date_1['default'])()[_0x138d9d(0x305)]('d')['diff']((0x0,date_1[_0x138d9d(0x15a)])(),'s'));}const _0x268e49=await this[_0x138d9d(0x2a7)][_0x138d9d(0x1cb)]({'where':{'vipExpire':(0x0,typeorm_2['LessThanOrEqual'])((0x0,date_1[_0x138d9d(0x15a)])()['toDate']())}});if(_0x268e49[_0x138d9d(0x247)]){const _0x187d9e=_0x268e49[_0x138d9d(0x1ed)](_0x5cd9fd=>_0x5cd9fd['id']);await this[_0x138d9d(0x2a7)]['update']({'id':(0x0,typeorm_2['In'])(_0x187d9e)},{'vipExpire':null});}}};UserService=__decorate([(0x0,common_1[_0x4d5a00(0x2f5)])(),__param(0x0,(0x0,common_1[_0x4d5a00(0x2cc)])(_0x4d5a00(0x1d3))),__param(0x1,(0x0,typeorm_1[_0x4d5a00(0x1ee)])(user_entity_1[_0x4d5a00(0x1c3)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(saas_entity_1[_0x4d5a00(0x24b)])),__param(0x3,(0x0,typeorm_1[_0x4d5a00(0x1ee)])(role_entity_1['RoleEntity'])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(user_init_vip_entity_1[_0x4d5a00(0x2c4)])),__param(0x5,(0x0,typeorm_1[_0x4d5a00(0x1ee)])(userFavorite_entity_1[_0x4d5a00(0x193)])),__metadata(_0x4d5a00(0x1e2),[Object,typeorm_2[_0x4d5a00(0x25b)],typeorm_2[_0x4d5a00(0x25b)],typeorm_2[_0x4d5a00(0x25b)],typeorm_2[_0x4d5a00(0x25b)],typeorm_2[_0x4d5a00(0x25b)],nestjs_cls_1[_0x4d5a00(0x17e)],mailer_1['MailerService'],redisCache_service_1[_0x4d5a00(0x1fd)],userBalance_service_1[_0x4d5a00(0x2eb)],globalConfig_service_1[_0x4d5a00(0x1fb)],verification_service_1[_0x4d5a00(0x1d6)],typeorm_2[_0x4d5a00(0x306)]])],UserService),exports[_0x4d5a00(0x296)]=UserService;