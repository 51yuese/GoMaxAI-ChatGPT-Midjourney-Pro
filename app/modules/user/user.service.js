'use strict';const _0x2189f4=_0x2c6b;(function(_0x11a410,_0x59fd39){const _0x48c48a=_0x2c6b,_0x49f48d=_0x11a410();while(!![]){try{const _0x4b38cb=-parseInt(_0x48c48a(0x255))/0x1+-parseInt(_0x48c48a(0x262))/0x2+parseInt(_0x48c48a(0x29f))/0x3+-parseInt(_0x48c48a(0x213))/0x4*(parseInt(_0x48c48a(0x25b))/0x5)+-parseInt(_0x48c48a(0x21a))/0x6*(parseInt(_0x48c48a(0x278))/0x7)+parseInt(_0x48c48a(0x2b3))/0x8*(-parseInt(_0x48c48a(0x11f))/0x9)+-parseInt(_0x48c48a(0x207))/0xa*(-parseInt(_0x48c48a(0x194))/0xb);if(_0x4b38cb===_0x59fd39)break;else _0x49f48d['push'](_0x49f48d['shift']());}catch(_0xf12aec){_0x49f48d['push'](_0x49f48d['shift']());}}}(_0x26a0,0x6eddb));var __decorate=this&&this[_0x2189f4(0x1e0)]||function(_0xafaf67,_0x4fdf25,_0x5a5605,_0x3f8f21){const _0x5db650=_0x2189f4;var _0x236668=arguments['length'],_0x53579e=_0x236668<0x3?_0x4fdf25:_0x3f8f21===null?_0x3f8f21=Object[_0x5db650(0x1ee)](_0x4fdf25,_0x5a5605):_0x3f8f21,_0x400d12;if(typeof Reflect===_0x5db650(0x129)&&typeof Reflect[_0x5db650(0x155)]==='function')_0x53579e=Reflect[_0x5db650(0x155)](_0xafaf67,_0x4fdf25,_0x5a5605,_0x3f8f21);else{for(var _0x14d5b6=_0xafaf67[_0x5db650(0x25d)]-0x1;_0x14d5b6>=0x0;_0x14d5b6--)if(_0x400d12=_0xafaf67[_0x14d5b6])_0x53579e=(_0x236668<0x3?_0x400d12(_0x53579e):_0x236668>0x3?_0x400d12(_0x4fdf25,_0x5a5605,_0x53579e):_0x400d12(_0x4fdf25,_0x5a5605))||_0x53579e;}return _0x236668>0x3&&_0x53579e&&Object[_0x5db650(0x206)](_0x4fdf25,_0x5a5605,_0x53579e),_0x53579e;},__metadata=this&&this[_0x2189f4(0x10a)]||function(_0x82149e,_0x54aa59){const _0x18b16c=_0x2189f4;if(typeof Reflect===_0x18b16c(0x129)&&typeof Reflect[_0x18b16c(0x1f7)]==='function')return Reflect['metadata'](_0x82149e,_0x54aa59);},__param=this&&this['__param']||function(_0x85f090,_0x1a4d8c){return function(_0x5e8286,_0xe6f590){_0x1a4d8c(_0x5e8286,_0xe6f590,_0x85f090);};};Object[_0x2189f4(0x206)](exports,_0x2189f4(0x14e),{'value':!![]}),exports['UserService']=void 0x0;function _0x2c6b(_0x2031b5,_0xbbfa12){const _0x26a0e9=_0x26a0();return _0x2c6b=function(_0x2c6b48,_0xa5b1ab){_0x2c6b48=_0x2c6b48-0x102;let _0x41a9df=_0x26a0e9[_0x2c6b48];return _0x41a9df;},_0x2c6b(_0x2031b5,_0xbbfa12);}const globalConfig_service_1=require(_0x2189f4(0x170)),user_constant_1=require('../../common/constants/user.constant'),mailer_1=require(_0x2189f4(0x219)),verification_service_1=require(_0x2189f4(0x245)),common_1=require('@nestjs/common'),typeorm_1=require(_0x2189f4(0x149)),typeorm_2=require(_0x2189f4(0x2a9)),user_entity_1=require(_0x2189f4(0x12f)),bcrypt=require(_0x2189f4(0x17c)),_=require('lodash'),verification_constant_1=require(_0x2189f4(0x2c5)),userBalance_service_1=require(_0x2189f4(0x236)),utils_1=require('../../common/utils'),balance_constant_1=require('../../common/constants/balance.constant'),class_validator_1=require(_0x2189f4(0x2ce)),redisKey_constant_1=require(_0x2189f4(0x15b)),redisCache_service_1=require(_0x2189f4(0x1eb)),model_constant_1=require(_0x2189f4(0x28c)),midjourney_constant_1=require(_0x2189f4(0x131)),user_init_vip_entity_1=require(_0x2189f4(0x1cc)),axios_1=require(_0x2189f4(0x2a4)),date_1=require('../../common/utils/date'),saas_entity_1=require('./saas.entity'),role_entity_1=require('./role.entity'),store_1=require(_0x2189f4(0x263)),nestjs_cls_1=require(_0x2189f4(0x17d)),Role_constant_1=require(_0x2189f4(0x279)),userFavorite_entity_1=require(_0x2189f4(0x295)),userCollect_entity_1=require(_0x2189f4(0x174)),collectType_constant_1=require(_0x2189f4(0x10f)),cm_service_1=require('../cmConfig/cm.service');let UserService=class UserService{constructor(_0x264aeb,_0x55c190,_0x379048,_0x137b46,_0x4d8752,_0x4bb4e8,_0x477796,_0x38d06d,_0x22e4f5,_0x42afc6,_0x40f6a4,_0x2ae34f,_0x40bfb5,_0x18e6c5,_0x5a559b){const _0x2e6f69=_0x2189f4;this[_0x2e6f69(0x26b)]=_0x264aeb,this[_0x2e6f69(0x107)]=_0x55c190,this[_0x2e6f69(0x10d)]=_0x379048,this[_0x2e6f69(0x20c)]=_0x137b46,this[_0x2e6f69(0x2b9)]=_0x4d8752,this['userFavoriteEntity']=_0x4bb4e8,this[_0x2e6f69(0x166)]=_0x477796,this['clsService']=_0x38d06d,this[_0x2e6f69(0x232)]=_0x22e4f5,this[_0x2e6f69(0x20d)]=_0x42afc6,this[_0x2e6f69(0x1f4)]=_0x40f6a4,this[_0x2e6f69(0x1f0)]=_0x2ae34f,this[_0x2e6f69(0x1dd)]=_0x40bfb5,this[_0x2e6f69(0x121)]=_0x18e6c5,this[_0x2e6f69(0x2d0)]=_0x5a559b;}[_0x2189f4(0x157)](){const _0x145464=_0x2189f4;console[_0x145464(0x24e)](_0x145464(0x2a2)),this[_0x145464(0x2d0)][_0x145464(0x1c5)](_0x145464(0x148)+Role_constant_1[_0x145464(0x19b)][_0x145464(0x1f5)]+_0x145464(0x160)+Role_constant_1['ERole'][_0x145464(0x136)]+'\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27'+Role_constant_1[_0x145464(0x19b)][_0x145464(0x13b)]+'\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),this[_0x145464(0x23d)](),this[_0x145464(0x26b)][_0x145464(0x1ef)]('__keyevent@0__:expired',async _0x2e620f=>{const _0x5340dd=_0x145464;if(_0x2e620f[_0x5340dd(0x13c)](redisKey_constant_1[_0x5340dd(0x1b8)])){const _0x47ce23=_0x2e620f[_0x5340dd(0x115)](redisKey_constant_1[_0x5340dd(0x1b8)],'');this['userEntity'][_0x5340dd(0x29b)]({'id':Number(_0x47ce23)},{'vipExpire':null});}});}async[_0x2189f4(0x23d)](){const _0x4f5d90=_0x2189f4,_0x448580=await this[_0x4f5d90(0x10d)]['find']({'where':{'deleteFlag':0x0}});store_1[_0x4f5d90(0x145)][_0x4f5d90(0x165)](),_0x448580[_0x4f5d90(0x283)](_0x2ef2e6=>store_1[_0x4f5d90(0x145)][_0x4f5d90(0x2cf)](_0x2ef2e6['domain'],_0x2ef2e6['id'])),store_1[_0x4f5d90(0x145)][_0x4f5d90(0x2cf)](process[_0x4f5d90(0x266)][_0x4f5d90(0x143)],0x0);}[_0x2189f4(0x119)](){const _0xa8a489=_0x2189f4;return this[_0xa8a489(0x107)];}async[_0x2189f4(0x249)](_0x20d06b){const _0x4f7448=_0x2189f4;if(!_0x20d06b[_0x4f7448(0x25d)])return[];return this[_0x4f7448(0x10d)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x20d06b)}});}async['saasPage'](_0x4b3fb5){const _0x300387=_0x2189f4,{page:page=0x1,size:size=0x14,keyword:_0x302317}=_0x4b3fb5;let _0x2fbb5d;_0x302317?_0x2fbb5d=[{'deleteFlag':0x0,'name':(0x0,typeorm_2['Like'])('%'+_0x302317+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2[_0x300387(0x123)])('%'+_0x302317+'%')}]:_0x2fbb5d={'deleteFlag':0x0};const [_0x12c49e,_0x5cf0d5]=await this[_0x300387(0x10d)][_0x300387(0x1cf)]({'where':_0x2fbb5d,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'}});if(!_0x12c49e[_0x300387(0x25d)])return{'rows':[],'count':_0x5cf0d5};const _0xcbbdbd=_0x12c49e[_0x300387(0x28a)](_0x434d63=>_0x434d63['id']),_0x25df55=new Map(),_0x12c0e8=await this['userEntity'][_0x300387(0x2bd)]({'where':{'saasId':(0x0,typeorm_2['In'])(_0xcbbdbd),'role':Role_constant_1[_0x300387(0x19b)][_0x300387(0x136)]}});_0x12c0e8['forEach'](_0x34962c=>{const _0x2ad652=_0x300387;_0x25df55[_0x2ad652(0x2cf)](_0x34962c[_0x2ad652(0x110)],_0x34962c);});const _0x2cd1e1=new Map(),_0xc4fb8=await this['connection'][_0x300387(0x1c5)](_0x300387(0x2d1));_0xc4fb8[_0x300387(0x283)](_0x3bd1a7=>_0x2cd1e1[_0x300387(0x2cf)](_0x3bd1a7[_0x300387(0x110)],_0x3bd1a7[_0x300387(0x14f)]));const _0x4b0034=_0x12c49e[_0x300387(0x28a)](_0x2cc73a=>{const _0x259e8f=_0x300387;let _0x44eb7d=null,_0x4ed20a=null,_0x426076=null,_0x15ab2e=null;const _0x1f064f=_0x25df55[_0x259e8f(0x22a)](_0x2cc73a['id']);return _0x1f064f&&(_0x44eb7d=_0x1f064f[_0x259e8f(0x186)],_0x4ed20a=_0x1f064f[_0x259e8f(0x209)],_0x426076=_0x1f064f[_0x259e8f(0x275)],_0x15ab2e=_0x1f064f[_0x259e8f(0x28d)]),{..._0x2cc73a,'username':_0x44eb7d,'nickname':_0x4ed20a,'phone':_0x426076,'email':_0x15ab2e,'userCount':_0x2cd1e1[_0x259e8f(0x22a)](_0x2cc73a['id'])||0x0};});return{'rows':_0x4b0034,'count':_0x5cf0d5};}async[_0x2189f4(0x1de)](_0x33f1d3){const _0x3f1077=_0x2189f4;return this['saasEntity'][_0x3f1077(0x2cb)]({'where':{'id':_0x33f1d3}});}async[_0x2189f4(0x1f3)](_0x208a2a){const _0x19292e=_0x2189f4,_0x3416bf=(0x0,utils_1['getReqSaasId'])(this[_0x19292e(0x1d5)]);if(_0x3416bf!==0x0)throw new common_1[(_0x19292e(0x18c))](_0x19292e(0x2aa),common_1['HttpStatus'][_0x19292e(0x13d)]);return await this[_0x19292e(0x10d)][_0x19292e(0x1aa)](_0x208a2a),this['initSaasMap'](),!![];}async['saasUpdate'](_0x3b7c4e){const _0x51a3e2=_0x2189f4,_0xcba10e=(0x0,utils_1[_0x51a3e2(0x208)])(this[_0x51a3e2(0x1d5)]);return await this[_0x51a3e2(0x10d)][_0x51a3e2(0x1aa)]({..._0x3b7c4e,'id':_0xcba10e}),!![];}async[_0x2189f4(0x2cc)](_0x3ccd27){const _0x40ac14=_0x2189f4;if(!_0x3ccd27['ids']||!_0x3ccd27[_0x40ac14(0x1bc)][_0x40ac14(0x25d)])return!![];return await this[_0x40ac14(0x10d)][_0x40ac14(0x29b)]({'id':(0x0,typeorm_2['In'])(_0x3ccd27[_0x40ac14(0x1bc)])},{'deleteFlag':0x1}),!![];}async[_0x2189f4(0x172)](_0x484ac2,_0x2ad92a){const _0x4ba688=_0x2189f4,_0x14cce6=await(0x0,utils_1[_0x4ba688(0x208)])(this['clsService']),{page:page=0x1,size:size=0x14,keyword:_0x46024a}=_0x2ad92a;let _0xc1f908=_0x4ba688(0x269)+_0x14cce6+_0x4ba688(0x164)+Role_constant_1[_0x4ba688(0x19b)][_0x4ba688(0x13b)]+'\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20';_0x46024a&&(_0xc1f908=_0x4ba688(0x282)+_0x14cce6+_0x4ba688(0x1c2)+_0x46024a+_0x4ba688(0x2af)+_0x46024a+_0x4ba688(0x26c)+Role_constant_1[_0x4ba688(0x19b)][_0x4ba688(0x13b)]+_0x4ba688(0x16b)+_0x46024a+_0x4ba688(0x2af)+_0x46024a+_0x4ba688(0x247));const _0xd46971=await this[_0x4ba688(0x2d0)]['query'](_0x4ba688(0x27f)+_0xc1f908+_0x4ba688(0x1bd)),_0x5ca2da=await this[_0x4ba688(0x2d0)][_0x4ba688(0x1c5)](_0x4ba688(0x25f)+_0xc1f908+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20'+size+_0x4ba688(0x1f6)+(page-0x1)*size+_0x4ba688(0x1bd)),_0xfccb3d=_0x5ca2da[_0x4ba688(0x28a)](_0x4d4538=>_0x4d4538['id']);if(_0xfccb3d[_0x4ba688(0x25d)]){const _0x461d77=await this[_0x4ba688(0x10d)][_0x4ba688(0x2cb)]({'where':{'id':_0x484ac2[_0x4ba688(0x17a)][_0x4ba688(0x110)]}}),_0x5f54aa=new Map(),_0x49fc7e=await this[_0x4ba688(0x2d0)][_0x4ba688(0x1c5)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20');_0x49fc7e[_0x4ba688(0x283)](_0x1fbe96=>_0x5f54aa[_0x4ba688(0x2cf)](_0x1fbe96[_0x4ba688(0x240)],_0x1fbe96[_0x4ba688(0x14f)])),_0x5ca2da[_0x4ba688(0x283)](_0x18a23b=>{const _0x3b18dc=_0x4ba688;_0x18a23b['saasName']=_0x461d77?.[_0x3b18dc(0x294)]||'平台',_0x18a23b[_0x3b18dc(0x286)]=_0x5f54aa[_0x3b18dc(0x22a)](_0x18a23b[_0x3b18dc(0x161)])||0x0;});}return{'rows':_0x5ca2da,'count':Number(_0xd46971[0x0]?.['count']||0x0)};}async[_0x2189f4(0x22e)](_0x12b465,_0x16d997){const _0x358b59=_0x2189f4,_0x2515ee=await(0x0,utils_1['getReqSaasId'])(this[_0x358b59(0x1d5)]);if([Role_constant_1[_0x358b59(0x19b)][_0x358b59(0x1f5)]['valueOf'](),Role_constant_1[_0x358b59(0x19b)][_0x358b59(0x136)][_0x358b59(0x168)](),Role_constant_1['ERole'][_0x358b59(0x13b)][_0x358b59(0x168)]()][_0x358b59(0x16d)](_0x16d997[_0x358b59(0x161)])&&_0x2515ee!==0x0)throw new common_1[(_0x358b59(0x18c))](_0x358b59(0x242),common_1[_0x358b59(0x2ca)][_0x358b59(0x1e7)]);return await this[_0x358b59(0x20c)][_0x358b59(0x1aa)]({..._0x16d997,'saasId':_0x2515ee,'disabled':_0x16d997['disabled']??0x0}),!![];}async[_0x2189f4(0x28b)](_0x57123d,_0x4d0a2b){const _0x4b043f=_0x2189f4,_0x17a929=await(0x0,utils_1[_0x4b043f(0x208)])(this[_0x4b043f(0x1d5)]);if(!_0x4d0a2b[_0x4b043f(0x1bc)]||!_0x4d0a2b[_0x4b043f(0x1bc)][_0x4b043f(0x25d)])return!![];const _0x298741=await this[_0x4b043f(0x20c)][_0x4b043f(0x2bd)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4d0a2b['ids']),'saasId':_0x17a929}});if(!_0x298741[_0x4b043f(0x25d)])return!![];const _0x50ba62=_0x298741['map'](_0x520b9d=>_0x520b9d[_0x4b043f(0x161)]),_0x573f9e=await this['userEntity'][_0x4b043f(0x14f)]({'where':{'role':(0x0,typeorm_2['In'])(_0x50ba62),'saasId':_0x17a929}});if(_0x573f9e>0x0)throw new common_1['HttpException'](_0x4b043f(0x130),common_1['HttpStatus'][_0x4b043f(0x1e7)]);return await this[_0x4b043f(0x20c)][_0x4b043f(0x104)]({'id':(0x0,typeorm_2['In'])(_0x4d0a2b[_0x4b043f(0x1bc)])}),!![];}async['findByIds'](_0x385f2d){const _0x3e4c84=_0x2189f4;if(!_0x385f2d[_0x3e4c84(0x25d)])return[];const _0x2a05bd=await this[_0x3e4c84(0x107)][_0x3e4c84(0x2bd)]({'where':{'id':(0x0,typeorm_2['In'])(_0x385f2d)}});return _0x2a05bd;}async[_0x2189f4(0x211)](_0x1335e9,_0xa90cc7){const _0x129a5d=_0x2189f4,{username:_0x36af19,email:_0x50b5f6,password:_0x14ebd0,invitedBy:_0x3566b9,client:client=0x0}=_0x1335e9;if(_0x3566b9){const _0x48f160=await this['userEntity'][_0x129a5d(0x2cb)]({'where':{'inviteCode':_0x3566b9}});if(!_0x48f160)throw new common_1['HttpException']('无效的邀请码！',common_1[_0x129a5d(0x2ca)][_0x129a5d(0x1e7)]);}const _0x5287bf=[{'username':_0x36af19},{'email':_0x50b5f6}],_0xbde4ea=await this[_0x129a5d(0x107)][_0x129a5d(0x2cb)]({'where':_0x5287bf});if(_0xbde4ea&&_0xbde4ea['status']!==user_constant_1[_0x129a5d(0x18b)][_0x129a5d(0x24f)])throw new common_1['HttpException'](_0x129a5d(0x25c),common_1[_0x129a5d(0x2ca)][_0x129a5d(0x1e7)]);try{const _0x468162=_['cloneDeep'](_0x1335e9),_0x119f7e=bcrypt['hashSync'](_0x14ebd0,0xa),_0x580de7=(0x0,utils_1['getClientIp'])(_0xa90cc7);_0x468162[_0x129a5d(0x137)]=_0x119f7e,_0x468162['registerIp']=_0x580de7,_0x468162['client']=client;let _0x432511;if(!_0xbde4ea){const _0x448d46=await this[_0x129a5d(0x1f0)]['getConfigByKeys']([_0x129a5d(0x2c9)]);_0x468162['avatar']=_0x448d46,_0x432511=await this[_0x129a5d(0x107)]['save'](_0x468162);}else _0x432511=_0xbde4ea;const _0x2e8da0=await this[_0x129a5d(0x1f0)][_0x129a5d(0x1b7)]([_0x129a5d(0x1a6),_0x129a5d(0x192),_0x129a5d(0x1b2),_0x129a5d(0x17f),_0x129a5d(0x2ae),'registerVerifyExpir']),_0x34a34e=_0x2e8da0[_0x129a5d(0x1a6)]?Number(_0x2e8da0[_0x129a5d(0x1a6)]):0x1;if(_0x34a34e){const _0x309ffd=_0x2e8da0[_0x129a5d(0x218)]?Number(_0x2e8da0['registerVerifyExpir']):0x1e*0x3c,_0x374f04=await this['verificationService']['createVerification'](_0x432511,verification_constant_1['VerificationEnum'][_0x129a5d(0x147)],_0x309ffd),{code:_0x24096b,email:_0x28b4f2,id:_0x647bb2}=_0x374f04,{registerVerifyEmailFrom:_0xa79c8e}=_0x2e8da0;await this[_0x129a5d(0x232)]['sendMail']({'to':_0x28b4f2,'subject':'来自'+_0xa79c8e+_0x129a5d(0x259),'template':'register','context':{'baseUrl':_0x2e8da0[_0x129a5d(0x192)],'code':_0x24096b,'id':_0x647bb2,..._0x2e8da0}});}else{const {id:_0x48bf83,invitedBy:_0x18d5be}=_0x432511;await this[_0x129a5d(0x1c7)](_0x48bf83,user_constant_1[_0x129a5d(0x18b)][_0x129a5d(0x2cd)]);let _0x16621a;_0x18d5be&&(_0x16621a=await this[_0x129a5d(0x154)](_0x18d5be)),await this[_0x129a5d(0x252)](_0x432511,_0x16621a);}return _0x432511;}catch(_0xc7e399){console['log'](_0x129a5d(0x140),_0xc7e399);throw _0xc7e399;}}async['verifyUserCredentials'](_0x2c6e9a){const _0x4cfd91=_0x2189f4,{username:_0x145769,password:_0x157179,uid:uid=0x0,phone:_0x3ad7c7}=_0x2c6e9a;let _0x4f4bfc=null;if(uid>0x0){_0x4f4bfc=await this[_0x4cfd91(0x107)][_0x4cfd91(0x2cb)]({'where':{'id':uid}});if(!_0x4f4bfc)throw new common_1[(_0x4cfd91(0x18c))](_0x4cfd91(0x1dc),common_1[_0x4cfd91(0x2ca)][_0x4cfd91(0x1e7)]);if(!bcrypt[_0x4cfd91(0x113)](_0x157179,_0x4f4bfc['password']))throw new common_1[(_0x4cfd91(0x18c))](_0x4cfd91(0x233),common_1[_0x4cfd91(0x2ca)][_0x4cfd91(0x1e7)]);}if(_0x145769&&_0x157179){const _0x19db6d=[{'username':_0x145769},{'email':_0x145769}];_0x4f4bfc=await this[_0x4cfd91(0x107)][_0x4cfd91(0x2cb)]({'where':_0x19db6d});if(!_0x4f4bfc)throw new common_1['HttpException'](_0x4cfd91(0x1dc),common_1[_0x4cfd91(0x2ca)][_0x4cfd91(0x1e7)]);if(!bcrypt[_0x4cfd91(0x113)](_0x157179,_0x4f4bfc[_0x4cfd91(0x137)]))throw new common_1[(_0x4cfd91(0x18c))]('当前密码错误！',common_1['HttpStatus'][_0x4cfd91(0x1e7)]);}if(_0x3ad7c7&&_0x157179){const _0x48e9e5=[{'phone':_0x3ad7c7}];_0x4f4bfc=await this[_0x4cfd91(0x107)]['findOne']({'where':_0x48e9e5});if(!_0x4f4bfc)throw new common_1['HttpException'](_0x4cfd91(0x1dc),common_1[_0x4cfd91(0x2ca)][_0x4cfd91(0x1e7)]);if(!bcrypt[_0x4cfd91(0x113)](_0x157179,_0x4f4bfc[_0x4cfd91(0x137)]))throw new common_1[(_0x4cfd91(0x18c))](_0x4cfd91(0x233),common_1[_0x4cfd91(0x2ca)][_0x4cfd91(0x1e7)]);}if(!_0x4f4bfc)throw new common_1['HttpException'](_0x4cfd91(0x1dc),common_1[_0x4cfd91(0x2ca)][_0x4cfd91(0x1e7)]);if(_0x4f4bfc[_0x4cfd91(0x20a)]!==user_constant_1[_0x4cfd91(0x18b)]['ACTIVE'])throw new common_1['HttpException'](user_constant_1[_0x4cfd91(0x2c3)][_0x4f4bfc[_0x4cfd91(0x20a)]],common_1[_0x4cfd91(0x2ca)][_0x4cfd91(0x1e7)]);if(_0x4f4bfc[_0x4cfd91(0x186)]&&!_0x4f4bfc['lastLoginIp']){const _0xa9c554=await this[_0x4cfd91(0x2b9)]['findOne']({'where':{'username':_0x4f4bfc[_0x4cfd91(0x186)]}});_0xa9c554&&await this[_0x4cfd91(0x2d0)][_0x4cfd91(0x15f)](async()=>{const _0x5771c7=_0x4cfd91;_0xa9c554[_0x5771c7(0x16a)]===-0x1?_0x4f4bfc[_0x5771c7(0x243)]=0x1:_0x4f4bfc['vipExpire']=(0x0,date_1[_0x5771c7(0x10e)])()[_0x5771c7(0x28f)](_0xa9c554[_0x5771c7(0x16a)],'day')[_0x5771c7(0x1ce)](),_0x4f4bfc=await this['userEntity'][_0x5771c7(0x1aa)](_0x4f4bfc),await this[_0x5771c7(0x2b9)][_0x5771c7(0x104)]({'id':_0xa9c554['id']});});}return _0x4f4bfc;}async[_0x2189f4(0x1fa)](_0x597f0b,_0x3b52bb){const _0x3e91f4=_0x2189f4,_0x48be34=await this[_0x3e91f4(0x107)][_0x3e91f4(0x2cb)]({'where':{'id':_0x597f0b}});return bcrypt['compareSync'](_0x3b52bb,_0x48be34[_0x3e91f4(0x137)]);}async[_0x2189f4(0x1c7)](_0x3e6aa7,_0x2791f7){const _0x560e23=_0x2189f4,_0x53d8da=await this[_0x560e23(0x107)][_0x560e23(0x29b)]({'id':_0x3e6aa7},{'status':_0x2791f7});return _0x53d8da['affected']>0x0;}async[_0x2189f4(0x14b)](_0x44f2a9){const _0x48940a=_0x2189f4,_0x4943bb=await this[_0x48940a(0x107)][_0x48940a(0x2cb)]({'where':{'id':_0x44f2a9}});return _0x4943bb[_0x48940a(0x20a)];}async[_0x2189f4(0x1e8)](_0x489a1d){const _0x12f9b5=_0x2189f4;return await this[_0x12f9b5(0x107)][_0x12f9b5(0x2cb)]({'where':{'id':_0x489a1d}});}async[_0x2189f4(0x106)](_0x384598){const _0x37e5fa=_0x2189f4;return await this[_0x37e5fa(0x107)]['findBy']({'id':(0x0,typeorm_2['In'])(_0x384598)});}async['queryUserByUsername'](_0x500514){const _0x55078b=_0x2189f4;return await this['userEntity'][_0x55078b(0x2cb)]({'where':{'username':_0x500514}});}async[_0x2189f4(0x15e)](_0x317ad7,_0x4fec1b,_0x1d8c20){const _0xc396f2=_0x2189f4;return await this['userEntity'][_0xc396f2(0x29b)](_0x317ad7,{'openId':_0x4fec1b,'unionid':_0x1d8c20});}async['updateUserMiniOpenId'](_0x92d63,_0x214470,_0x408c2b){const _0x34eea9=_0x2189f4;return await this[_0x34eea9(0x107)][_0x34eea9(0x29b)](_0x92d63,{'miniOpenId':_0x214470,'unionid':_0x408c2b});}async[_0x2189f4(0x292)](_0xd387ef,_0x583922,_0x4cf081){const _0x1479ab=_0x2189f4;return await this[_0x1479ab(0x107)][_0x1479ab(0x29b)](_0xd387ef,{'weAppOpenId':_0x583922,'unionid':_0x4cf081});}async[_0x2189f4(0x27b)](_0xde0648){const _0x57a1e9=_0x2189f4,{id:_0x2462e3,username:_0x1d248f,password:_0x101dce}=_0xde0648;return await this['userEntity'][_0x57a1e9(0x29b)](_0x2462e3,{'username':_0x1d248f,'password':_0x101dce});}async[_0x2189f4(0x210)](_0x2fc453){const _0xd97656=_0x2189f4;return await this[_0xd97656(0x107)][_0xd97656(0x2cb)]({'where':{'id':_0x2fc453}});}async[_0x2189f4(0x1d9)](_0x335729){const _0x2e017d=_0x2189f4,{id:_0x2f34c4,role:_0x37ee2a}=_0x335729;if(_0x37ee2a==='visitor')return!![];const _0x39d6cb=await this['userEntity'][_0x2e017d(0x2cb)]({'where':{'id':_0x2f34c4}});if(!_0x39d6cb)throw new common_1[(_0x2e017d(0x18c))]('当前用户信息失效、请重新登录！',common_1[_0x2e017d(0x2ca)]['UNAUTHORIZED']);if(_0x39d6cb[_0x2e017d(0x20a)]===user_constant_1[_0x2e017d(0x18b)][_0x2e017d(0x12e)])throw new common_1['HttpException']('您的账户已被永久加入黑名单、如有疑问、请联系管理员！',common_1[_0x2e017d(0x2ca)][_0x2e017d(0x1e7)]);if(_0x39d6cb[_0x2e017d(0x20a)]===user_constant_1[_0x2e017d(0x18b)][_0x2e017d(0x27d)])throw new common_1[(_0x2e017d(0x18c))](_0x2e017d(0x199),common_1[_0x2e017d(0x2ca)]['BAD_REQUEST']);}async[_0x2189f4(0x229)](_0x382418){const _0x34ee26=_0x2189f4;return await this['userEntity'][_0x34ee26(0x2cb)]({'where':{'id':_0x382418}});}['getUserListByIds'](_0x4b3dbc){const _0x3066bd=_0x2189f4;return this[_0x3066bd(0x107)][_0x3066bd(0x2bd)]({'where':{'id':(0x0,typeorm_2['In'])(_0x4b3dbc)}});}async[_0x2189f4(0x15d)](_0x2e32e8){const _0x474b7d=_0x2189f4;return this[_0x474b7d(0x107)]['findOne']({'where':{'inviteCode':_0x2e32e8}});}async[_0x2189f4(0x204)](_0x52513d){const _0x17a2a1=_0x2189f4,_0x22926a=(0x0,utils_1[_0x17a2a1(0x208)])(this[_0x17a2a1(0x1d5)]);return await this[_0x17a2a1(0x107)][_0x17a2a1(0x2cb)]({'where':{'openId':_0x52513d,'saasId':_0x22926a}});}async['getUserUnionId'](_0x2b1b86){const _0xb91457=_0x2189f4,_0x2ab81f=(0x0,utils_1['getReqSaasId'])(this[_0xb91457(0x1d5)]);return await this[_0xb91457(0x107)][_0xb91457(0x2cb)]({'where':{'unionid':_0x2b1b86,'saasId':_0x2ab81f}});}async[_0x2189f4(0x1b1)](_0x12eaf4){const _0x3f2db3=_0x2189f4;return this[_0x3f2db3(0x107)][_0x3f2db3(0x14f)]({'where':{'invitedBy':_0x12eaf4}});}async[_0x2189f4(0x1f9)](_0x5eeea8,_0x9fe29a){const _0x511971=_0x2189f4,{id:_0x5a1093}=_0x9fe29a[_0x511971(0x17a)],_0x32d9d5=await this[_0x511971(0x107)][_0x511971(0x2cb)]({'where':{'id':_0x5a1093}});if(!_0x32d9d5)throw new common_1['HttpException'](_0x511971(0x1cb),common_1['HttpStatus'][_0x511971(0x1e7)]);if(_0x5eeea8['username']&&_0x32d9d5['username']===_0x5eeea8[_0x511971(0x186)])throw new common_1[(_0x511971(0x18c))]('没有变更，无需更改！',common_1['HttpStatus'][_0x511971(0x1e7)]);if(_0x5eeea8[_0x511971(0x186)]){const _0x8465aa=await this[_0x511971(0x107)][_0x511971(0x2cb)]({'where':{'username':_0x5eeea8[_0x511971(0x186)],'id':(0x0,typeorm_2[_0x511971(0x264)])(_0x5a1093)}});if(_0x8465aa)throw new common_1[(_0x511971(0x18c))](_0x511971(0x1ae),common_1['HttpStatus'][_0x511971(0x1e7)]);}const _0x253279=await this[_0x511971(0x107)]['update']({'id':_0x5a1093},_0x5eeea8);if(_0x253279['affected']<=0x0)throw new common_1[(_0x511971(0x18c))](_0x511971(0x1c4),common_1[_0x511971(0x2ca)]['BAD_REQUEST']);return'修改用户信息成功！';}async[_0x2189f4(0x1d0)](_0x2dcabe,_0x4be64e){const _0x5db6a9=_0x2189f4,_0x5d6acd=bcrypt[_0x5db6a9(0x181)](_0x4be64e,0xa),_0x8b37=await this[_0x5db6a9(0x107)][_0x5db6a9(0x29b)]({'id':_0x2dcabe},{'password':_0x5d6acd});if(_0x8b37[_0x5db6a9(0x141)]<=0x0)throw new common_1[(_0x5db6a9(0x18c))]('修改密码失败、请重新试试吧。',common_1[_0x5db6a9(0x2ca)][_0x5db6a9(0x1e7)]);}async[_0x2189f4(0x2a0)](_0x31c007,_0x1f1d49){const _0x1bcf4f=_0x2189f4;try{const _0x37a96f=await this[_0x1bcf4f(0x135)][_0x1bcf4f(0x2cb)]({'where':{'userId':_0x31c007[_0x1bcf4f(0x17a)]['id'],'relateId':_0x1f1d49[_0x1bcf4f(0x191)],'relateType':_0x1f1d49[_0x1bcf4f(0x246)]}});return _0x37a96f?await this[_0x1bcf4f(0x135)][_0x1bcf4f(0x104)]({'id':_0x37a96f['id']}):await this[_0x1bcf4f(0x135)][_0x1bcf4f(0x1aa)]({'userId':_0x31c007[_0x1bcf4f(0x17a)]['id'],'relateId':_0x1f1d49['relateId'],'relateType':_0x1f1d49[_0x1bcf4f(0x246)]}),!![];}catch(_0x219e18){throw new common_1[(_0x1bcf4f(0x18c))](_0x219e18[_0x1bcf4f(0x215)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x2189f4(0x19c)](_0x187ab4,_0x141d68,_0x29117d){const _0x282934=_0x2189f4;return this['userFavoriteEntity'][_0x282934(0x2bd)]({'where':{'userId':_0x187ab4,'relateType':_0x141d68,'relateId':(0x0,typeorm_2['In'])(_0x29117d)}});}async['genInviteCode'](_0x4d2443){const _0x6e84f4=_0x2189f4,{id:_0x261156}=_0x4d2443[_0x6e84f4(0x17a)],_0x18e099=await this[_0x6e84f4(0x107)][_0x6e84f4(0x2cb)]({'where':{'id':_0x261156}});if(!_0x18e099||_0x18e099['inviteCode'])throw new common_1[(_0x6e84f4(0x18c))](_0x6e84f4(0x239),common_1['HttpStatus'][_0x6e84f4(0x1e7)]);const _0x5288b9=(0x0,utils_1[_0x6e84f4(0x114)])(),_0x8e339d=await this[_0x6e84f4(0x107)][_0x6e84f4(0x2cb)]({'where':{'inviteCode':_0x5288b9}});if(_0x8e339d)throw new common_1[(_0x6e84f4(0x18c))]('生成邀请码失败，请重新试一次吧！',common_1[_0x6e84f4(0x2ca)][_0x6e84f4(0x1e7)]);const _0x110ebf=await this['userEntity'][_0x6e84f4(0x29b)]({'id':_0x261156},{'inviteCode':_0x5288b9});if(_0x110ebf[_0x6e84f4(0x141)]<=0x0)throw new common_1['HttpException'](_0x6e84f4(0x284),common_1['HttpStatus'][_0x6e84f4(0x1e7)]);return _0x5288b9;}async[_0x2189f4(0x1ed)](_0x400b16,_0xcfc1b6){const _0x3fabe5=_0x2189f4;try{const {id:_0x2ba8c7}=_0x400b16[_0x3fabe5(0x17a)],{page:page=0x1,size:size=0xa}=_0xcfc1b6,_0x540659=await this[_0x3fabe5(0x107)][_0x3fabe5(0x2cb)]({'where':{'id':_0x2ba8c7}}),{inviteCode:_0xb9ec27}=_0x540659;if(!_0xb9ec27)return[];const [_0xadf7f8,_0x4dc05e]=await this[_0x3fabe5(0x107)][_0x3fabe5(0x1cf)]({'where':{'inviteCode':_0xb9ec27},'order':{'id':_0x3fabe5(0x124)},'select':[_0x3fabe5(0x186),_0x3fabe5(0x28d),_0x3fabe5(0x2a1),_0x3fabe5(0x20a),_0x3fabe5(0x116)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x3fabe5(0x27a)])(_0xadf7f8)[_0x3fabe5(0x28a)](_0x13f668=>{const _0x1160aa=_0x3fabe5;return _0x13f668['email']=(0x0,utils_1['maskEmail'])(_0x13f668[_0x1160aa(0x28d)]),_0x13f668;}),{'rows':_0xadf7f8,'count':_0x4dc05e};}catch(_0x14b3a9){console[_0x3fabe5(0x24e)]('error:\x20',_0x14b3a9);throw new common_1[(_0x3fabe5(0x18c))](_0x3fabe5(0x226),common_1[_0x3fabe5(0x2ca)]['BAD_REQUEST']);}}async['invitePage'](_0x4dd259,_0x20ab3c,_0x14f695){const _0xbb9474=_0x2189f4,_0x1b2c72=(0x0,utils_1[_0xbb9474(0x208)])(this[_0xbb9474(0x1d5)]),{page:page=0x1,size:size=0x14,startTime:_0xd28c9a,endTime:_0x2db11f,saasId:_0x3cb8e5,keyword:_0x57e77f,inviterKeyword:_0x5806a0}=_0x20ab3c,_0x2b1204=_0xbb9474(0x111)+(_0x14f695?_0xbb9474(0x298)+_0x14f695:'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x2db11f?'\x20AND\x20u.createdAt\x20<=\x20\x27'+_0x2db11f+'\x27':'')+_0xbb9474(0x1fc)+(_0xd28c9a?_0xbb9474(0x24c)+_0xd28c9a+'\x27':'')+_0xbb9474(0x1fc)+(_0x1b2c72!==0x0?'\x20AND\x20u.saasId\x20=\x20'+_0x1b2c72:(0x0,utils_1[_0xbb9474(0x2ba)])(_0x3cb8e5)?_0xbb9474(0x24d)+_0x3cb8e5:'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x57e77f?_0xbb9474(0x13f)+_0x57e77f+_0xbb9474(0x2c1)+_0x57e77f+'%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%'+_0x57e77f+'%\x27\x20OR\x20u.email\x20LIKE\x20\x27%'+_0x57e77f+_0xbb9474(0x1a5):'')+_0xbb9474(0x1fc)+(_0x5806a0?'\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%'+_0x5806a0+'%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%'+_0x5806a0+_0xbb9474(0x1d7)+_0x5806a0+_0xbb9474(0x1a2)+_0x5806a0+_0xbb9474(0x1a5):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x7226a='\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x2b1204+_0xbb9474(0x1bd),_0x8653d3=_0xbb9474(0x290)+_0x2b1204+_0xbb9474(0x175)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0xbb9474(0x1bd),_0x299dcd=await this[_0xbb9474(0x2d0)][_0xbb9474(0x1c5)](_0x7226a),_0x40c983=await this[_0xbb9474(0x2d0)][_0xbb9474(0x1c5)](_0x8653d3);return!(0x0,utils_1[_0xbb9474(0x296)])(this['clsService'])&&_0x40c983[_0xbb9474(0x283)](_0x531281=>{const _0x4edfde=_0xbb9474;_0x531281[_0x4edfde(0x275)]=(0x0,utils_1[_0x4edfde(0x1e5)])(_0x531281[_0x4edfde(0x275)]),_0x531281['email']=(0x0,utils_1[_0x4edfde(0x1e5)])(_0x531281['email']),_0x531281[_0x4edfde(0x234)]=(0x0,utils_1['hideString'])(_0x531281[_0x4edfde(0x234)]),_0x531281[_0x4edfde(0x1b4)]=(0x0,utils_1[_0x4edfde(0x1e5)])(_0x531281[_0x4edfde(0x1b4)]);}),{'rows':_0x40c983,'count':Number(_0x299dcd[0x0]?.['count']||0x0)};}async['inviteLink'](_0x41a115){const _0x12bf0c=_0x2189f4,_0xc745e3=await this[_0x12bf0c(0x107)][_0x12bf0c(0x2cb)]({'where':{'inviteCode':_0x41a115}});if(!_0xc745e3)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0xc745e3,_0x7f2fa0=await this[_0x12bf0c(0x107)][_0x12bf0c(0x29b)]({'inviteCode':_0x41a115},{'inviteLinkCount':inviteLinkCount+0x1});return _0x7f2fa0[_0x12bf0c(0x141)]?0x1:0x0;}async[_0x2189f4(0x154)](_0xbc6fa0){const _0x13f5ac=_0x2189f4;return await this[_0x13f5ac(0x107)][_0x13f5ac(0x2cb)]({'where':{'inviteCode':_0xbc6fa0}});}async[_0x2189f4(0x1fd)](_0x3c9749,_0x3f6e81){const _0x1b41be=_0x2189f4,_0x2bb329=(0x0,utils_1[_0x1b41be(0x208)])(this[_0x1b41be(0x1d5)]);let {page:page=0x1,size:size=0xa,username:_0x90c5d9,phone:_0x422774,email:_0x23abb3,status:_0x4a47e9,keyword:_0x5812e0,roleCode:_0x4466a0,vip:_0xa217e8,saasId:_0x192254}=_0x3c9749,_0x3f6815=_0x1b41be(0x178);_0x4a47e9&&(_0x3f6815=_0x3f6815+(_0x1b41be(0x23a)+_0x4a47e9));_0x4466a0&&(_0x3f6815=_0x3f6815+(_0x1b41be(0x2c4)+_0x4466a0+'\x27'));_0xa217e8&&(_0xa217e8=Number(_0xa217e8));if(_0xa217e8===0x1)_0x3f6815=_0x3f6815+'\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)';else _0xa217e8===0x0&&(_0x3f6815=_0x3f6815+'\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL');_0x5812e0?_0x3f6815=_0x3f6815+('\x20AND\x20(username\x20LIKE\x20\x27%'+_0x5812e0+_0x1b41be(0x103)+_0x5812e0+_0x1b41be(0x16c)+_0x5812e0+_0x1b41be(0x2a3)+_0x5812e0+_0x1b41be(0x21f)+_0x5812e0+'\x27)'):(_0x90c5d9&&(_0x3f6815=_0x3f6815+(_0x1b41be(0x267)+_0x90c5d9+'%\x27')),_0x23abb3&&(_0x3f6815=_0x3f6815+(_0x1b41be(0x189)+_0x23abb3+'%\x27')),_0x422774&&(_0x3f6815=_0x3f6815+(_0x1b41be(0x142)+_0x422774+'%\x27')));(0x0,utils_1[_0x1b41be(0x265)])(this['clsService'])?(0x0,utils_1[_0x1b41be(0x200)])(this[_0x1b41be(0x1d5)])&&_0x192254&&(_0x3f6815=_0x3f6815+('\x20AND\x20saasId\x20=\x20'+_0x192254)):_0x3f6815=_0x3f6815+('\x20AND\x20saasId\x20=\x20'+_0x2bb329);const _0x3d77a0=await this['connection']['query'](_0x1b41be(0x258)+_0x3f6815+_0x1b41be(0x276)),_0xd39348=await this[_0x1b41be(0x2d0)][_0x1b41be(0x1c5)](_0x1b41be(0x12b)+_0x3f6815+_0x1b41be(0x299)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x1b41be(0x1bd)),_0x1135f2=[],_0x5437e5=(0x0,utils_1[_0x1b41be(0x296)])(this[_0x1b41be(0x1d5)]),_0x4e1dfd=new Map([[Role_constant_1[_0x1b41be(0x19b)][_0x1b41be(0x136)],'代理商'],[Role_constant_1[_0x1b41be(0x19b)][_0x1b41be(0x1f5)],_0x1b41be(0x188)],[Role_constant_1['ERole'][_0x1b41be(0x13b)],_0x1b41be(0x153)]]);for(let _0x110204=0x0;_0x110204<_0xd39348[_0x1b41be(0x25d)];_0x110204++){const _0x4c7646=_0xd39348[_0x110204];let _0x3db9f1=_0x1b41be(0x153);if(_0x4e1dfd[_0x1b41be(0x1e9)](_0x4c7646[_0x1b41be(0x240)]))_0x3db9f1=_0x4e1dfd[_0x1b41be(0x22a)](_0x4c7646[_0x1b41be(0x240)]);else{const _0x219cff=await this['roleEntity'][_0x1b41be(0x2cb)]({'where':{'code':_0x4c7646['role'],'saasId':_0x4c7646['saasId']}});_0x3db9f1=_0x219cff['name'];}_0x1135f2[_0x1b41be(0x227)]({..._0x4c7646,'roleName':_0x3db9f1,'isBindWx':!!_0x4c7646?.['openId'],'password':_0x4c7646[_0x1b41be(0x137)]?_0x1b41be(0x1df):'no','email':_0x5437e5?_0x4c7646[_0x1b41be(0x28d)]:(0x0,utils_1[_0x1b41be(0x29d)])(_0x4c7646[_0x1b41be(0x28d)]),'phone':_0x5437e5?_0x4c7646[_0x1b41be(0x275)]:(0x0,utils_1[_0x1b41be(0x29d)])(_0x4c7646[_0x1b41be(0x275)]),'lastLoginIp':_0x5437e5?_0x4c7646[_0x1b41be(0x133)]:(0x0,utils_1[_0x1b41be(0x237)])(_0x4c7646['lastLoginIp'])});}return{'rows':_0x1135f2,'count':Number(_0x3d77a0[0x0]?.[_0x1b41be(0x14f)]||0x0)};}async[_0x2189f4(0x1a3)](_0x477223){const _0x116a1d=_0x2189f4,{page:page=0x1,size:size=0xa,username:_0x5b5cbe,status:_0x1e6785}=_0x477223;let _0x1162ed={};_0x5b5cbe&&Object['assign'](_0x1162ed,{'username':(0x0,typeorm_2[_0x116a1d(0x123)])('%'+_0x5b5cbe+'%')}),_0x1e6785&&Object['assign'](_0x1162ed,{'status':_0x1e6785});const [_0x77238c,_0x444b25]=await this[_0x116a1d(0x107)][_0x116a1d(0x1cf)]({'skip':(page-0x1)*size,'where':_0x1162ed,'take':size,'cache':!![],'order':{'createdAt':_0x116a1d(0x124)},'select':[_0x116a1d(0x186),_0x116a1d(0x137),_0x116a1d(0x240),_0x116a1d(0x20a),'id']});return{'rows':_0x77238c,'count':_0x444b25};}async[_0x2189f4(0x1ad)]({id:_0x2168af}){const _0x4e377f=_0x2189f4;let _0x24d041,_0x45dce6;const _0x55b324=await this[_0x4e377f(0x107)][_0x4e377f(0x2cb)]({'where':{'id':_0x2168af}});if(!_0x55b324)throw new common_1[(_0x4e377f(0x18c))](_0x4e377f(0x146),common_1[_0x4e377f(0x2ca)]['UNAUTHORIZED']);if((0x0,utils_1[_0x4e377f(0x28e)])(_0x55b324['role'])){const _0x29f350=_0x55b324[_0x4e377f(0x240)]===Role_constant_1['ERole'][_0x4e377f(0x136)]?0x0:_0x55b324[_0x4e377f(0x110)],_0x5d225f=await this[_0x4e377f(0x20c)][_0x4e377f(0x2cb)]({'where':{'code':_0x55b324[_0x4e377f(0x240)],'saasId':_0x29f350}});if(!_0x5d225f)throw new common_1['HttpException']('角色信息不存在！',common_1[_0x4e377f(0x2ca)]['BAD_REQUEST']);_0x24d041=_0x5d225f[_0x4e377f(0x291)],_0x45dce6=_0x5d225f[_0x4e377f(0x1d1)];}return{..._0x55b324,'access':_0x24d041,'accessLabel':_0x45dce6,'isBindWx':!!_0x55b324?.[_0x4e377f(0x173)],'password':_0x55b324[_0x4e377f(0x137)]?_0x4e377f(0x1df):'no'};}async[_0x2189f4(0x280)](_0x4d5e40){const _0x1d08e1=_0x2189f4;return await this[_0x1d08e1(0x107)]['findOne']({'where':{'username':_0x4d5e40}});}async[_0x2189f4(0x16f)](_0x187025){const _0x16c892=_0x2189f4,{id:_0x3946b0,status:_0x10ce53}=_0x187025,_0x43352c=await this[_0x16c892(0x107)][_0x16c892(0x2cb)]({'where':{'id':_0x3946b0}});if(!_0x43352c)throw new common_1[(_0x16c892(0x18c))](_0x16c892(0x144),common_1[_0x16c892(0x2ca)]['BAD_REQUEST']);if(_0x43352c['role']===Role_constant_1[_0x16c892(0x19b)]['SUPER'])throw new common_1['HttpException']('超级管理员不可被操作！',common_1[_0x16c892(0x2ca)][_0x16c892(0x1e7)]);if(_0x43352c['status']===user_constant_1[_0x16c892(0x18b)][_0x16c892(0x24f)])throw new common_1[(_0x16c892(0x18c))]('未激活用户不可手动变更状态！',common_1[_0x16c892(0x2ca)][_0x16c892(0x1e7)]);if(_0x10ce53===user_constant_1[_0x16c892(0x18b)][_0x16c892(0x24f)])throw new common_1['HttpException']('不可将用户置为未激活状态！',common_1[_0x16c892(0x2ca)][_0x16c892(0x1e7)]);const _0x228a90=await this[_0x16c892(0x107)][_0x16c892(0x29b)]({'id':_0x3946b0},{'status':_0x10ce53});if(_0x228a90[_0x16c892(0x141)]<=0x0)throw new common_1['HttpException'](_0x16c892(0x179),common_1[_0x16c892(0x2ca)][_0x16c892(0x1e7)]);return _0x16c892(0x1c8);}async['updateRole'](_0x276e59){const _0x21609f=_0x2189f4,{id:_0x4fb53c,role:_0x132b1d}=_0x276e59,_0x171121=await this[_0x21609f(0x107)]['update']({'id':_0x4fb53c},{'role':_0x132b1d});if(_0x171121[_0x21609f(0x141)]<=0x0)throw new common_1[(_0x21609f(0x18c))](_0x21609f(0x271),common_1[_0x21609f(0x2ca)][_0x21609f(0x1e7)]);return _0x21609f(0x251);}async['resetUserPass'](_0x4f4ddf){const _0x1f919f=_0x2189f4,{id:_0x4130a4}=_0x4f4ddf,_0xa1ff8b=await this[_0x1f919f(0x107)][_0x1f919f(0x2cb)]({'where':{'id':_0x4130a4}});if(!_0xa1ff8b)throw new common_1[(_0x1f919f(0x18c))](_0x1f919f(0x144),common_1['HttpStatus'][_0x1f919f(0x1e7)]);const _0x1cd0bd='123456',_0x5021e4=bcrypt['hashSync'](_0x1cd0bd,0xa),_0x3d88a0=await this[_0x1f919f(0x107)]['update']({'id':_0x4130a4},{'password':_0x5021e4});if(_0x3d88a0['affected']<=0x0)throw new common_1[(_0x1f919f(0x18c))](_0x1f919f(0x203),common_1[_0x1f919f(0x2ca)][_0x1f919f(0x1e7)]);return'密码重置为['+_0x1cd0bd+_0x1f919f(0x289);}async['savaLoginIp'](_0xbf51c9,_0x497a13){return await this['userEntity']['update']({'id':_0xbf51c9},{'lastLoginIp':_0x497a13});}async['bindWx'](_0x572765,_0x547365){const _0x3d55b9=_0x2189f4;try{const _0x454be9=await this['userEntity'][_0x3d55b9(0x2cb)]({'where':{'id':_0x547365}});if(!_0x454be9)return{'status':![],'msg':_0x3d55b9(0x19d)};const _0x12f691=await this[_0x3d55b9(0x107)][_0x3d55b9(0x2cb)]({'where':{'openId':_0x572765}});if(_0x12f691)return{'status':![],'msg':_0x3d55b9(0x14a)};const _0x28a7da=await this[_0x3d55b9(0x107)][_0x3d55b9(0x29b)]({'id':_0x547365},{'openId':_0x572765});if(_0x28a7da['affected']<=0x0)return{'status':![],'msg':_0x3d55b9(0x1f1)};return{'status':!![],'msg':_0x3d55b9(0x1bb)};}catch(_0x5a0439){return{'status':![],'msg':_0x3d55b9(0x1f1)};}}async[_0x2189f4(0x2b7)](_0x4aeff1){const _0x23499d=_0x2189f4,_0x4498d2=await this[_0x23499d(0x107)][_0x23499d(0x2cb)]({'where':{'id':_0x4aeff1}});return _0x4498d2?.[_0x23499d(0x173)];}async['getMiniOpenIdByUserId'](_0x4d5a3f){const _0x19a03b=_0x2189f4,_0x589ae1=await this['userEntity'][_0x19a03b(0x2cb)]({'where':{'id':_0x4d5a3f}});return _0x589ae1?.[_0x19a03b(0x108)];}async[_0x2189f4(0x293)](_0x45eb53){const _0x1044f2=_0x2189f4,{username:_0x27e284,password:_0x340935,phone:_0x187759,phoneCode:_0x697222}=_0x45eb53,_0x1461f4=await this[_0x1044f2(0x107)][_0x1044f2(0x2cb)]({'where':[{'username':_0x27e284},{'phone':_0x187759}]});if(_0x1461f4&&_0x1461f4[_0x1044f2(0x186)]===_0x27e284)throw new common_1[(_0x1044f2(0x18c))](_0x1044f2(0x21e),common_1[_0x1044f2(0x2ca)][_0x1044f2(0x1e7)]);if(_0x1461f4&&_0x1461f4[_0x1044f2(0x275)]===_0x187759)throw new common_1[(_0x1044f2(0x18c))](_0x1044f2(0x1d8),common_1[_0x1044f2(0x2ca)][_0x1044f2(0x1e7)]);}async['createUser'](_0x2c683e){const _0x5b15e7=_0x2189f4,_0x52a573=(0x0,utils_1[_0x5b15e7(0x208)])(this[_0x5b15e7(0x1d5)]);if(_0x2c683e[_0x5b15e7(0x240)]!==Role_constant_1[_0x5b15e7(0x19b)][_0x5b15e7(0x136)])_0x2c683e[_0x5b15e7(0x110)]=_0x52a573;else{if(!_0x2c683e['saasId'])throw new common_1[(_0x5b15e7(0x18c))](_0x5b15e7(0x13a),common_1[_0x5b15e7(0x2ca)][_0x5b15e7(0x1e7)]);}return await this[_0x5b15e7(0x107)]['save'](_0x2c683e);}async['delUser'](_0x3caf47){const _0x1e1821=_0x2189f4,{id:_0x5dbb09,moreId:_0x80f209}=_0x3caf47;if(_0x5dbb09)return await this['userEntity'][_0x1e1821(0x104)]({'id':_0x5dbb09});if(_0x80f209)return await this['userEntity']['delete']({'id':(0x0,typeorm_2['MoreThan'])(_0x80f209)});}async[_0x2189f4(0x22d)](_0x2afb4a){const _0x48094e=_0x2189f4,_0x5982cd=_0x2afb4a[_0x48094e(0x17a)]['id'];return await this[_0x48094e(0x107)]['delete']({'id':_0x5982cd})[_0x48094e(0x2bb)](_0x14ee0f=>_0x14ee0f['affected']>0x0);}async['create'](_0x2b696f,_0x287cb5){const _0x1f6ee8=_0x2189f4;try{if(!_0x2b696f['username']&&!_0x2b696f[_0x1f6ee8(0x275)]&&!_0x2b696f[_0x1f6ee8(0x28d)])throw new Error('账号、手机、邮箱必须存在一个');if(_0x2b696f[_0x1f6ee8(0x186)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x1f6ee8(0x274)](_0x2b696f[_0x1f6ee8(0x186)]))throw new Error(_0x1f6ee8(0x2b5));if(!_0x2b696f[_0x1f6ee8(0x137)])throw new Error(_0x1f6ee8(0x139));}if(_0x2b696f[_0x1f6ee8(0x275)]){if(!(0x0,class_validator_1[_0x1f6ee8(0x118)])(_0x2b696f[_0x1f6ee8(0x275)],_0x1f6ee8(0x26e)))throw new Error(_0x1f6ee8(0x18e));}if(_0x2b696f[_0x1f6ee8(0x28d)]){if(!(0x0,class_validator_1[_0x1f6ee8(0x270)])(_0x2b696f[_0x1f6ee8(0x28d)]))throw new Error('邮箱格式错误！');}if(_0x2b696f[_0x1f6ee8(0x186)]){const _0x289177=await this[_0x1f6ee8(0x107)][_0x1f6ee8(0x21b)]({'where':{'username':_0x2b696f['username']}});if(_0x289177)throw new Error('用户名已被使用！');}if(_0x2b696f[_0x1f6ee8(0x275)]){const _0x26bca4=await this[_0x1f6ee8(0x107)][_0x1f6ee8(0x21b)]({'where':{'phone':_0x2b696f['phone']}});if(_0x26bca4)throw new Error('手机号已被使用！');}if(_0x2b696f[_0x1f6ee8(0x28d)]){const _0x3c243e=await this[_0x1f6ee8(0x107)][_0x1f6ee8(0x21b)]({'where':{'email':_0x2b696f[_0x1f6ee8(0x28d)]}});if(_0x3c243e)throw new Error('邮箱已被使用！');}const _0x23523c=new user_entity_1[(_0x1f6ee8(0x11d))]();for(let _0x117870 in _0x2b696f){_0x2b696f[_0x117870]&&(_0x23523c[_0x117870]=_0x2b696f[_0x117870]);}return _0x23523c[_0x1f6ee8(0x137)]&&(_0x23523c[_0x1f6ee8(0x137)]=bcrypt[_0x1f6ee8(0x181)](_0x2b696f[_0x1f6ee8(0x137)],0xa)),_0x23523c[_0x1f6ee8(0x20a)]=user_constant_1['UserStatusEnum'][_0x1f6ee8(0x2cd)],!_0x23523c['nickname']&&(_0x23523c[_0x1f6ee8(0x209)]=_0x23523c[_0x1f6ee8(0x209)]||'小智'),!_0x23523c[_0x1f6ee8(0x116)]&&(_0x23523c[_0x1f6ee8(0x116)]=await this[_0x1f6ee8(0x1f0)][_0x1f6ee8(0x1b7)](['userDefautlAvatar'])),await this[_0x1f6ee8(0x17b)](_0x23523c),!![];}catch(_0x330e87){throw new common_1['HttpException'](_0x330e87[_0x1f6ee8(0x215)],common_1[_0x1f6ee8(0x2ca)]['BAD_REQUEST']);}}[_0x2189f4(0x1fe)](){const _0x2b6cbd=_0x2189f4;let _0x5233fa=_0x2b6cbd(0x1da);const _0x2a1117=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x3cd3ef=0x0;_0x3cd3ef<0xa;_0x3cd3ef++){_0x5233fa=_0x5233fa+_0x2a1117[Math[_0x2b6cbd(0x27c)](Math[_0x2b6cbd(0x288)]()*0x3f)];}return _0x5233fa;}async['genUserNames'](_0x557331){const _0x1ace50=_0x2189f4;let _0x48a1e0=[];for(let _0x238508=0x0;_0x238508<_0x557331;_0x238508++){_0x48a1e0[_0x1ace50(0x227)](this[_0x1ace50(0x1fe)]());}const _0x4f7748=await this[_0x1ace50(0x107)][_0x1ace50(0x2bd)]({'where':{'username':(0x0,typeorm_2['In'])(_0x48a1e0)}});if(!_0x4f7748[_0x1ace50(0x25d)])return _0x48a1e0;else{const _0x4e8419=new Set(_0x4f7748[_0x1ace50(0x28a)](_0x29192d=>_0x29192d['username']));_0x48a1e0=_0x48a1e0[_0x1ace50(0x1b6)](_0x590118=>!_0x4e8419[_0x1ace50(0x1e9)](_0x590118));const _0x2a7a53=await this[_0x1ace50(0x25a)](_0x4e8419['size']);return _0x48a1e0=_0x48a1e0[_0x1ace50(0x112)](_0x2a7a53),_0x48a1e0;}}async[_0x2189f4(0x25e)](_0x375f37,_0x22ff3f){const _0x4fbccf=_0x2189f4;let _0x563528='';_0x563528=_0x4fbccf(0x1ac);const _0x2bd814=await this['genUserNames'](_0x375f37['num']),_0x24fca0=[],_0x40641a=[],_0x50cc6d=await this[_0x4fbccf(0x1f0)][_0x4fbccf(0x1b7)]([_0x4fbccf(0x2c9)]);for(let _0x68f41a=0x0;_0x68f41a<_0x375f37['num'];_0x68f41a++){const _0x27c50d=new user_entity_1[(_0x4fbccf(0x11d))]();_0x27c50d['status']=0x1,_0x27c50d[_0x4fbccf(0x116)]=_0x50cc6d,_0x27c50d[_0x4fbccf(0x186)]=_0x2bd814[_0x68f41a],_0x27c50d[_0x4fbccf(0x209)]=_0x2bd814[_0x68f41a],_0x27c50d[_0x4fbccf(0x137)]=bcrypt[_0x4fbccf(0x181)](_0x4fbccf(0x1c1),0xa),_0x563528=_0x563528+(_0x2bd814[_0x68f41a]+_0x4fbccf(0x2c8)),_0x375f37[_0x4fbccf(0x184)]&&(_0x27c50d[_0x4fbccf(0x184)]=Number(_0x375f37['vipLeavelId'])),_0x375f37[_0x4fbccf(0x29e)]&&(_0x27c50d[_0x4fbccf(0x29e)]=_0x375f37[_0x4fbccf(0x29e)]),_0x375f37['score']&&(_0x27c50d[_0x4fbccf(0x190)]=_0x375f37['score']),_0x375f37[_0x4fbccf(0x16a)]&&_0x40641a[_0x4fbccf(0x227)]({'username':_0x2bd814[_0x68f41a],'vipDays':_0x375f37[_0x4fbccf(0x16a)]}),_0x24fca0[_0x4fbccf(0x227)](_0x27c50d);}try{return await this[_0x4fbccf(0x2d0)][_0x4fbccf(0x15f)](async()=>{const _0x5af078=_0x4fbccf;await this[_0x5af078(0x107)]['save'](_0x24fca0),await this[_0x5af078(0x2b9)][_0x5af078(0x1aa)](_0x40641a);}),_0x563528;}catch(_0x32eec1){throw new common_1[(_0x4fbccf(0x18c))](_0x32eec1[_0x4fbccf(0x215)],axios_1[_0x4fbccf(0x1ba)]['BadRequest']);}}async['giftScore'](_0x4c69ad,_0x50255b){const _0x23d291=_0x2189f4,_0x496f76=await this[_0x23d291(0x107)]['findOne']({'where':{'id':_0x50255b[_0x23d291(0x235)]}});await this[_0x23d291(0x107)][_0x23d291(0x1d4)]({'id':_0x496f76['id']},'score',_0x50255b['score']),await this[_0x23d291(0x1f4)][_0x23d291(0x248)]({'userId':_0x496f76['id'],'rawScore':_0x496f76['score'],'newScore':_0x496f76[_0x23d291(0x190)]+_0x50255b['score'],'changeScore':_0x50255b['score'],'changeType':balance_constant_1[_0x23d291(0x214)][_0x23d291(0x238)],'rebateUserId':_0x4c69ad[_0x23d291(0x17a)]['id'],'description':_0x23d291(0x151)});}async[_0x2189f4(0x126)](_0x48f03d,_0x487093){const _0x56faff=_0x2189f4,_0x26d499=await this[_0x56faff(0x107)]['findOne']({'where':{'id':_0x487093[_0x56faff(0x235)]}});return await this[_0x56faff(0x167)](_0x26d499,balance_constant_1[_0x56faff(0x214)][_0x56faff(0x238)],_0x487093['days'],_0x56faff(0x151),_0x48f03d['user']['id']),!![];}async[_0x2189f4(0x2bf)](_0x3487e3){const _0x467c32=_0x2189f4,_0x2a7f75=await this[_0x467c32(0x2b9)][_0x467c32(0x2cb)]({'where':{'username':_0x3487e3[_0x467c32(0x186)]}});_0x2a7f75&&await this[_0x467c32(0x2d0)]['transaction'](async()=>{const _0x39efd9=_0x467c32;_0x2a7f75[_0x39efd9(0x16a)]===-0x1?_0x3487e3[_0x39efd9(0x243)]=0x1:_0x3487e3[_0x39efd9(0x23f)]=(0x0,date_1[_0x39efd9(0x10e)])()[_0x39efd9(0x28f)](_0x2a7f75[_0x39efd9(0x16a)],_0x39efd9(0x250))[_0x39efd9(0x1ce)](),_0x3487e3=await this[_0x39efd9(0x107)][_0x39efd9(0x1aa)](_0x3487e3),await this['userInitVipEntity'][_0x39efd9(0x104)]({'id':_0x2a7f75['id']});});}async['updateSignDay'](_0x212d3f,_0x17cb14){const _0x597ed8=_0x2189f4;await this[_0x597ed8(0x107)][_0x597ed8(0x29b)]({'id':_0x212d3f},{'consecutiveDays':_0x17cb14});}async['updateViolationCount'](_0x22f46a){const _0x55eeb8=_0x2189f4,_0x3dbf17=await this[_0x55eeb8(0x229)](_0x22f46a);_0x3dbf17[_0x55eeb8(0x159)]=_0x3dbf17[_0x55eeb8(0x159)]+0x1,await this[_0x55eeb8(0x107)][_0x55eeb8(0x1aa)](_0x3dbf17);}async[_0x2189f4(0x252)](_0x25648e,_0x11d94d){const _0x500e6e=_0x2189f4,_0x480854=await this[_0x500e6e(0x1f0)]['getConfigByKeys']([_0x500e6e(0x205),_0x500e6e(0x13e),'inviteSendStatus',_0x500e6e(0x1a8),_0x500e6e(0x230),'invitedRewards',_0x500e6e(0x222)]),_0x9613a0={};for(let _0x5a11f2 in _0x480854){const _0x6cd09c=Number(_0x480854[_0x5a11f2]),_0x1d0477=Number[_0x500e6e(0x1e4)](_0x6cd09c)&&_0x6cd09c>0x0?_0x6cd09c:0x0;_0x9613a0[_0x5a11f2]=_0x1d0477;}_0x9613a0[_0x500e6e(0x205)]&&(await this[_0x500e6e(0x107)][_0x500e6e(0x29b)]({'id':_0x25648e['id']},{'score':_0x9613a0[_0x500e6e(0x13e)]}),await this['userBalanceService'][_0x500e6e(0x248)]({'userId':_0x25648e['id'],'rawScore':0x0,'newScore':_0x9613a0[_0x500e6e(0x13e)],'changeScore':_0x9613a0[_0x500e6e(0x13e)],'changeType':balance_constant_1[_0x500e6e(0x214)][_0x500e6e(0x1bf)],'description':'注册赠送'}));if(_0x11d94d&&_0x9613a0[_0x500e6e(0x187)]){_0x9613a0[_0x500e6e(0x1a8)]&&(await this[_0x500e6e(0x107)][_0x500e6e(0x1d4)]({'id':_0x11d94d['id']},_0x500e6e(0x190),_0x9613a0[_0x500e6e(0x1a8)]),await this[_0x500e6e(0x1f4)]['insertAccountLog']({'userId':_0x11d94d['id'],'rawScore':_0x11d94d[_0x500e6e(0x190)],'newScore':_0x11d94d[_0x500e6e(0x190)]+_0x9613a0[_0x500e6e(0x1a8)],'changeScore':_0x9613a0[_0x500e6e(0x1a8)],'changeType':balance_constant_1[_0x500e6e(0x214)][_0x500e6e(0x2bc)],'rebateUserId':_0x25648e['id'],'description':_0x500e6e(0x225)}));_0x9613a0[_0x500e6e(0x230)]&&await this[_0x500e6e(0x167)](_0x11d94d,balance_constant_1['EChangeType'][_0x500e6e(0x2bc)],_0x9613a0['inviteRewardVip'],_0x500e6e(0x225),_0x25648e['id']);const _0x21a2a0=await this['userEntity'][_0x500e6e(0x2cb)]({'where':{'id':_0x25648e['id']}});_0x9613a0[_0x500e6e(0x138)]&&(await this[_0x500e6e(0x107)][_0x500e6e(0x1d4)]({'id':_0x21a2a0['id']},_0x500e6e(0x190),_0x9613a0['invitedRewards']),await this[_0x500e6e(0x1f4)][_0x500e6e(0x248)]({'userId':_0x25648e['id'],'rawScore':_0x21a2a0[_0x500e6e(0x190)],'newScore':_0x21a2a0[_0x500e6e(0x190)]+_0x9613a0[_0x500e6e(0x138)],'changeScore':_0x9613a0['invitedRewards'],'changeType':balance_constant_1[_0x500e6e(0x214)][_0x500e6e(0x216)],'rebateUserId':_0x11d94d['id'],'description':_0x500e6e(0x11e)})),_0x9613a0[_0x500e6e(0x222)]&&await this[_0x500e6e(0x167)](_0x21a2a0,balance_constant_1['EChangeType'][_0x500e6e(0x216)],_0x9613a0[_0x500e6e(0x222)],'受邀请注册赠送',_0x11d94d['id']);}}async[_0x2189f4(0x10c)](_0x331113,_0x558bdc,_0x405cc9,_0x4e2f5c,_0xfb178e){const _0x2ba1bc=_0x2189f4;await this[_0x2ba1bc(0x107)][_0x2ba1bc(0x29b)]({'id':_0x331113['id']},{'score':_0x331113[_0x2ba1bc(0x190)]+_0x405cc9}),await this[_0x2ba1bc(0x1f4)]['insertAccountLog']({'userId':_0x331113['id'],'rawScore':_0x331113[_0x2ba1bc(0x190)],'newScore':_0x331113[_0x2ba1bc(0x190)]+_0x405cc9,'changeScore':_0x405cc9,'changeType':_0x558bdc,'relateId':_0xfb178e?String(_0xfb178e):null,'description':_0x4e2f5c});}async['updateVipExpire'](_0x517056,_0x520b1f,_0x13ff31,_0x44a570,_0x17b1e3){const _0x36a549=_0x2189f4;if(_0x517056[_0x36a549(0x243)])return;_0x13ff31===-0x1?await this[_0x36a549(0x107)][_0x36a549(0x29b)]({'id':_0x517056['id']},{'lifetimeVip':0x1}):(_0x517056[_0x36a549(0x23f)]?_0x517056['vipExpire']=(0x0,date_1['default'])(_0x517056[_0x36a549(0x23f)])[_0x36a549(0x28f)](_0x13ff31,_0x36a549(0x250))[_0x36a549(0x1ce)]():_0x517056[_0x36a549(0x23f)]=(0x0,date_1['default'])()[_0x36a549(0x28f)](_0x13ff31,'day')[_0x36a549(0x1ce)](),await this['userEntity'][_0x36a549(0x29b)]({'id':_0x517056['id']},{'vipExpire':_0x517056['vipExpire']})),_0x517056=await this['userEntity'][_0x36a549(0x2cb)]({'where':{'id':_0x517056['id']}}),await this[_0x36a549(0x1f4)][_0x36a549(0x23e)]({'userId':_0x517056['id'],'vipDays':_0x13ff31,'vipExpire':_0x517056['vipExpire'],'relateType':_0x520b1f,'relateId':_0x17b1e3?String(_0x17b1e3):'','description':_0x44a570});}async['validateBalance4Chat'](_0x6979d8,_0x1c2d6f){const _0x46eb5e=_0x2189f4;let _0x1364bf=!![];const _0x3af9ff=await this['getUserById'](_0x6979d8);if(_0x3af9ff['lifetimeVip']||_0x3af9ff[_0x46eb5e(0x23f)]){if(_0x1c2d6f[_0x46eb5e(0x26d)]<0x0)_0x1364bf=!![];else{if(_0x1c2d6f[_0x46eb5e(0x26d)]>0x0){const _0x1f6b0a=redisKey_constant_1['VIP_FREE']+'-'+_0x6979d8+'-'+_0x1c2d6f['id'];let _0x1e1e1a=await this[_0x46eb5e(0x20d)][_0x46eb5e(0x22a)]({'key':_0x1f6b0a});console[_0x46eb5e(0x24e)](_0x1e1e1a);let _0x424d89=Number(_0x1e1e1a||0x0);_0x424d89<_0x1c2d6f[_0x46eb5e(0x26d)]?_0x1364bf=!![]:_0x1364bf=_0x3af9ff[_0x46eb5e(0x190)]>=_0x1c2d6f[_0x46eb5e(0x2b1)];}else _0x1364bf=_0x3af9ff[_0x46eb5e(0x190)]>=_0x1c2d6f[_0x46eb5e(0x2b1)];}}else _0x1364bf=_0x3af9ff['score']>=_0x1c2d6f[_0x46eb5e(0x2b1)];if(!_0x1364bf)throw new common_1[(_0x46eb5e(0x18c))](_0x46eb5e(0x2ac),common_1['HttpStatus'][_0x46eb5e(0x1e7)]);}async[_0x2189f4(0x20b)](_0x51c524,_0x351666,_0x11ad53){const _0x35369c=_0x2189f4,_0x2a8d0=await this[_0x35369c(0x229)](_0x51c524);let _0x5e13d6;switch(_0x351666['modelType']){case model_constant_1['EModelType'][_0x35369c(0x1ab)]:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x1ab)];break;case model_constant_1[_0x35369c(0x14c)]['APP']:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x180)];break;case model_constant_1[_0x35369c(0x14c)][_0x35369c(0x1b0)]:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x21d)];break;case model_constant_1['EModelType']['VIDEO']:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x1db)];break;case model_constant_1['EModelType'][_0x35369c(0x105)]:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x18f)];break;case model_constant_1[_0x35369c(0x14c)]['CHAT']:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x22b)];break;case model_constant_1['EModelType'][_0x35369c(0x2ab)]:_0x5e13d6=balance_constant_1[_0x35369c(0x214)]['Tool'];break;case model_constant_1[_0x35369c(0x14c)][_0x35369c(0x1b9)]:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x198)];break;case model_constant_1[_0x35369c(0x14c)][_0x35369c(0x12a)]:_0x5e13d6=balance_constant_1['EChangeType'][_0x35369c(0x2a7)];break;default:_0x5e13d6=balance_constant_1[_0x35369c(0x214)][_0x35369c(0x22b)];}if(_0x2a8d0['lifetimeVip']||_0x2a8d0['vipExpire']){if(_0x351666['vipFreeNum']<0x0)await this[_0x35369c(0x10c)](_0x2a8d0,_0x5e13d6,0x0,_0x35369c(0x11b)+_0x351666[_0x35369c(0x20e)]+_0x35369c(0x127),_0x11ad53);else{if(_0x351666[_0x35369c(0x26d)]>0x0){const _0x4e796d=redisKey_constant_1[_0x35369c(0x202)]+'-'+_0x51c524+'-'+_0x351666['id'];let _0x22d248=await this[_0x35369c(0x20d)][_0x35369c(0x22a)]({'key':_0x4e796d}),_0x48a004=Number(_0x22d248||0x0);if(_0x48a004<_0x351666['vipFreeNum']){const _0xee2bb8=(0x0,date_1[_0x35369c(0x10e)])()[_0x35369c(0x1d3)]('d')[_0x35369c(0x231)]((0x0,date_1[_0x35369c(0x10e)])(),'s');await this['redisCacheService'][_0x35369c(0x2cf)]({'key':_0x4e796d,'val':_0x48a004+0x1},_0xee2bb8),await this['changeScore4Other'](_0x2a8d0,_0x5e13d6,0x0,_0x35369c(0x11b)+_0x351666[_0x35369c(0x20e)]+_0x35369c(0x132),_0x11ad53);}else await this['changeScore4Other'](_0x2a8d0,_0x5e13d6,-_0x351666[_0x35369c(0x2b1)],_0x35369c(0x11b)+_0x351666[_0x35369c(0x20e)]+'】使用扣减',_0x11ad53);}else await this[_0x35369c(0x10c)](_0x2a8d0,_0x5e13d6,-_0x351666[_0x35369c(0x2b1)],'模型【'+_0x351666[_0x35369c(0x20e)]+'】使用扣减',_0x11ad53);}}else await this[_0x35369c(0x10c)](_0x2a8d0,_0x5e13d6,-_0x351666['deduct'],_0x35369c(0x11b)+_0x351666[_0x35369c(0x20e)]+_0x35369c(0x102),_0x11ad53);}async[_0x2189f4(0x162)](_0x20ea71,_0x9f0e3,_0xf6db15){const _0x270bb7=_0x2189f4;let _0x4be4d5=!![],_0x4345d9=await this[_0x270bb7(0x22c)](_0x9f0e3,_0xf6db15);const _0x537374=await this['getUserById'](_0x20ea71);if(_0x537374[_0x270bb7(0x243)]||_0x537374['vipExpire']){if(_0x9f0e3[_0x270bb7(0x26d)]<0x0||_0x4345d9?.['vipFreeNum']<0x0){_0x4be4d5=!![];return;}else{if(_0x4345d9?.[_0x270bb7(0x26d)]>0x0){const _0x4a95b1=redisKey_constant_1[_0x270bb7(0x202)]+'-'+_0x20ea71+'-'+_0x4345d9[_0x270bb7(0x26a)]+'-'+_0x4345d9['mode']+'-'+_0x4345d9[_0x270bb7(0x256)];let _0x4a4d3c=await this[_0x270bb7(0x20d)]['get']({'key':_0x4a95b1}),_0x109d22=Number(_0x4a4d3c||0x0);if(_0x109d22<_0x4345d9[_0x270bb7(0x26d)]){_0x4be4d5=!![];return;}}else{if(_0x9f0e3[_0x270bb7(0x26d)]>0x0){const _0xad2dfa=redisKey_constant_1[_0x270bb7(0x202)]+'-'+_0x20ea71+'-'+_0x9f0e3['id'];let _0x75c4f1=await this[_0x270bb7(0x20d)][_0x270bb7(0x22a)]({'key':_0xad2dfa});console[_0x270bb7(0x24e)](_0x75c4f1);let _0x180b62=Number(_0x75c4f1||0x0);if(_0x180b62<_0x9f0e3[_0x270bb7(0x26d)]){_0x4be4d5=!![];return;}}}}}_0x4be4d5=_0x537374[_0x270bb7(0x190)]>=_0x9f0e3[_0x270bb7(0x2b1)];if(!_0x4be4d5)throw new common_1[(_0x270bb7(0x18c))]('用户余额不足，请充值',common_1[_0x270bb7(0x2ca)]['BAD_REQUEST']);}async[_0x2189f4(0x1a4)](_0x3f238d,_0x585f04,_0x41d8a8,_0x5991f8){const _0x41867c=_0x2189f4,_0x31fe05=await this['getUserById'](_0x3f238d);let _0x33a7ef=await this['getVideoConfig'](_0x585f04,_0x41d8a8);console[_0x41867c(0x24e)](_0x41867c(0x201),_0x33a7ef);if(_0x31fe05[_0x41867c(0x243)]||_0x31fe05['vipExpire']){if(_0x585f04[_0x41867c(0x26d)]<0x0||_0x33a7ef?.[_0x41867c(0x26d)]<0x0){await this['changeScore4Other'](_0x31fe05,balance_constant_1[_0x41867c(0x214)][_0x41867c(0x1db)],0x0,_0x41867c(0x11b)+_0x585f04['modelName']+'】会员永久免费',_0x5991f8);return;}else{if(_0x33a7ef?.[_0x41867c(0x26d)]>0x0){const _0x577dc1=redisKey_constant_1['VIP_FREE']+'-'+_0x3f238d+'-'+_0x33a7ef[_0x41867c(0x26a)]+'-'+_0x33a7ef[_0x41867c(0x15a)]+'-'+_0x33a7ef[_0x41867c(0x256)];let _0xfe0d9=await this['redisCacheService'][_0x41867c(0x22a)]({'key':_0x577dc1}),_0xa34657=Number(_0xfe0d9||0x0);if(_0xa34657<_0x33a7ef[_0x41867c(0x26d)]){const _0x2fcc8c=(0x0,date_1[_0x41867c(0x10e)])()[_0x41867c(0x1d3)]('d')['diff']((0x0,date_1['default'])(),'s');await this[_0x41867c(0x20d)][_0x41867c(0x2cf)]({'key':_0x577dc1,'val':_0xa34657+0x1},_0x2fcc8c);return;}}else{if(_0x585f04[_0x41867c(0x26d)]>0x0){const _0x9973d0=redisKey_constant_1[_0x41867c(0x202)]+'-'+_0x3f238d+'-'+_0x585f04['id'];let _0x13ee8b=await this[_0x41867c(0x20d)][_0x41867c(0x22a)]({'key':_0x9973d0}),_0x17ee93=Number(_0x13ee8b||0x0);if(_0x17ee93<_0x585f04[_0x41867c(0x26d)]){const _0x19ff7d=(0x0,date_1['default'])()['endOf']('d')[_0x41867c(0x231)]((0x0,date_1[_0x41867c(0x10e)])(),'s');await this[_0x41867c(0x20d)][_0x41867c(0x2cf)]({'key':_0x9973d0,'val':_0x17ee93+0x1},_0x19ff7d);return;}}}}}await this[_0x41867c(0x10c)](_0x31fe05,balance_constant_1[_0x41867c(0x214)]['VIDEO'],_0x33a7ef?.[_0x41867c(0x1d2)]>0x0?-_0x33a7ef?.[_0x41867c(0x1d2)]:-_0x585f04[_0x41867c(0x2b1)],_0x41867c(0x11b)+_0x585f04[_0x41867c(0x20e)]+'】会员每日限免',_0x5991f8);}async[_0x2189f4(0x19a)](_0x2db20d,_0x197911,_0xc6963b,_0x1110d3){const _0x45e10e=_0x2189f4;let _0x7c3241=await this[_0x45e10e(0x22c)](_0x197911,_0xc6963b);const _0x266931=await this['getUserById'](_0x2db20d);if(_0x266931[_0x45e10e(0x243)]||_0x266931[_0x45e10e(0x23f)]){if(_0x197911[_0x45e10e(0x26d)]<0x0||_0x7c3241?.[_0x45e10e(0x26d)]<0x0)return;else{if(_0x7c3241?.[_0x45e10e(0x26d)]>0x0){const _0x5a07a7=redisKey_constant_1[_0x45e10e(0x202)]+'-'+_0x2db20d+'-'+_0x7c3241['model']+'-'+_0x7c3241[_0x45e10e(0x15a)]+'-'+_0x7c3241[_0x45e10e(0x256)];let _0x3f5af2=await this[_0x45e10e(0x20d)]['get']({'key':_0x5a07a7}),_0x4612c4=Number(_0x3f5af2||0x0);if(_0x4612c4>=_0x7c3241[_0x45e10e(0x26d)]){const _0x44b713=(0x0,date_1[_0x45e10e(0x10e)])()[_0x45e10e(0x1d3)]('d')[_0x45e10e(0x231)]((0x0,date_1[_0x45e10e(0x10e)])(),'s');await this['redisCacheService']['set']({'key':_0x5a07a7,'val':_0x4612c4-0x1},_0x44b713);return;}}else{if(_0x197911['vipFreeNum']>0x0){const _0x5ad523=redisKey_constant_1[_0x45e10e(0x202)]+'-'+_0x2db20d+'-'+_0x197911['id'];let _0x3276e6=await this[_0x45e10e(0x20d)][_0x45e10e(0x22a)]({'key':_0x5ad523}),_0x3c72eb=Number(_0x3276e6||0x0);if(_0x3c72eb>=_0x197911[_0x45e10e(0x26d)]){const _0x2b9933=(0x0,date_1['default'])()[_0x45e10e(0x1d3)]('d')[_0x45e10e(0x231)]((0x0,date_1[_0x45e10e(0x10e)])(),'s');await this['redisCacheService'][_0x45e10e(0x2cf)]({'key':_0x5ad523,'val':_0x3c72eb-0x1},_0x2b9933);return;}}}}}await this[_0x45e10e(0x10c)](_0x266931,balance_constant_1['EChangeType'][_0x45e10e(0x1db)],_0x7c3241?.['price']>0x0?_0x7c3241?.[_0x45e10e(0x1d2)]:_0x197911['deduct'],_0x45e10e(0x11b)+_0x197911[_0x45e10e(0x20e)]+_0x45e10e(0x19e),_0x1110d3);}async[_0x2189f4(0x169)](_0x2dfcc9,_0x1872f4,_0x5d43a5){const _0x53cc84=_0x2189f4,_0x173783=await this[_0x53cc84(0x229)](_0x2dfcc9);let _0x1abf45;switch(_0x1872f4[_0x53cc84(0x2b6)]){case model_constant_1[_0x53cc84(0x14c)]['APP']:_0x1abf45=balance_constant_1['EChangeType']['GPTS'];break;case model_constant_1[_0x53cc84(0x14c)][_0x53cc84(0x1b0)]:_0x1abf45=balance_constant_1['EChangeType']['Music'];break;case model_constant_1[_0x53cc84(0x14c)]['DRAW']:_0x1abf45=balance_constant_1['EChangeType'][_0x53cc84(0x18f)];break;case model_constant_1[_0x53cc84(0x14c)][_0x53cc84(0x1c0)]:_0x1abf45=balance_constant_1['EChangeType'][_0x53cc84(0x22b)];break;case model_constant_1['EModelType'][_0x53cc84(0x2ab)]:_0x1abf45=balance_constant_1[_0x53cc84(0x214)][_0x53cc84(0x2ad)];break;case model_constant_1['EModelType'][_0x53cc84(0x1db)]:_0x1abf45=balance_constant_1['EChangeType'][_0x53cc84(0x1db)];break;default:_0x1abf45=balance_constant_1[_0x53cc84(0x214)]['Chat'];}await this[_0x53cc84(0x10c)](_0x173783,_0x1abf45,_0x1872f4[_0x53cc84(0x2b1)],'模型【'+_0x1872f4[_0x53cc84(0x20e)]+_0x53cc84(0x29c),_0x5d43a5);}async[_0x2189f4(0x2a6)](_0x3029c2,_0xebca55,_0x2fa076,_0x2563cc,_0x49b1be,_0x2e8c5e){const _0x924f1c=_0x2189f4,_0xd9b3aa=await this[_0x924f1c(0x229)](_0x3029c2);if(_0xd9b3aa[_0x924f1c(0x243)]||_0xd9b3aa[_0x924f1c(0x23f)]){if(_0x2563cc<0x0){await this[_0x924f1c(0x10c)](_0xd9b3aa,balance_constant_1['EChangeType'][_0x924f1c(0x254)],0x0,_0x924f1c(0x11b)+_0x2fa076+'】会员永久免费',_0x2e8c5e);return;}else{if(_0x2563cc>0x0){const _0x3169b0=redisKey_constant_1[_0x924f1c(0x202)]+'-'+_0x3029c2+'-'+_0xebca55;let _0x3132ff=await this[_0x924f1c(0x20d)]['get']({'key':_0x3169b0}),_0x169dd1=Number(_0x3132ff||0x0);if(_0x169dd1<_0x2563cc){const _0x1de9b6=(0x0,date_1['default'])()[_0x924f1c(0x1d3)]('d')[_0x924f1c(0x231)]((0x0,date_1[_0x924f1c(0x10e)])(),'s');await this[_0x924f1c(0x20d)]['set']({'key':_0x3169b0,'val':_0x169dd1+0x1},_0x1de9b6),await this[_0x924f1c(0x10c)](_0xd9b3aa,balance_constant_1[_0x924f1c(0x214)]['Coze'],0x0,'模型【'+_0x2fa076+'】会员每日限免',_0x2e8c5e);return;}}}}await this[_0x924f1c(0x10c)](_0xd9b3aa,balance_constant_1[_0x924f1c(0x214)]['Coze'],-_0x49b1be,_0x924f1c(0x11b)+_0x2fa076+_0x924f1c(0x102),_0x2e8c5e);}async['getMjPrice'](_0x8f92cc,_0xfccdff,_0x48c1f9){const _0x1bfe03=_0x2189f4;let _0x5ccb4a='',_0x9e6390='',_0x541743='',_0x11233c=_0xfccdff;const _0x3f48f8=_0xfccdff[_0x1bfe03(0x150)](),_0x54205e=new RegExp('imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll'),_0x1edb2c=new RegExp('upscale|describe|picread::retry|faceswap|shorten'),_0xb3f0ce=new RegExp(_0x1bfe03(0x1c3));if(_0x8f92cc===midjourney_constant_1[_0x1bfe03(0x23b)]['fast'])_0x9e6390=_0x1bfe03(0x257),_0x5ccb4a=_0x1bfe03(0x2c2),_0x541743=_0x1bfe03(0x117);else{if(_0x8f92cc===midjourney_constant_1[_0x1bfe03(0x23b)]['relax'])_0x9e6390=_0x1bfe03(0x2c0),_0x5ccb4a=_0x1bfe03(0x268),_0x541743=_0x1bfe03(0x1d6);else _0x8f92cc===midjourney_constant_1[_0x1bfe03(0x23b)][_0x1bfe03(0x24b)]&&(_0x9e6390=_0x1bfe03(0x261),_0x5ccb4a='turbo_mjDeduction',_0x541743=_0x1bfe03(0x2b2));}if(_0x54205e[_0x1bfe03(0x274)](_0x3f48f8))_0x5ccb4a=_0x5ccb4a+0x1;else{if(_0x1edb2c['test'](_0x3f48f8))_0x5ccb4a=_0x5ccb4a+0x2;else _0xb3f0ce[_0x1bfe03(0x274)](_0x3f48f8)&&(_0x5ccb4a=_0x5ccb4a+0x3);}const _0x46aca9=await this[_0x1bfe03(0x121)]['getValue'](_0x1bfe03(0x12c));let _0x242912={};if(!_0x46aca9){let _0x1a4190=await this[_0x1bfe03(0x1f0)][_0x1bfe03(0x1b7)]([_0x5ccb4a,_0x541743]);for(let _0x1042c8 in _0x1a4190){_0x242912[_0x1042c8]=Number(_0x1a4190[_0x1042c8])||0x0;}if(_0x48c1f9[_0x1bfe03(0x184)]){const _0xfa6d8d=await this['globalConfigService'][_0x1bfe03(0x223)](_0x48c1f9[_0x1bfe03(0x184)],'mj');_0xfa6d8d&&(_0x242912[_0x541743]=_0xfa6d8d[_0x9e6390]||0x0);}}else{const _0x99126c=_0x48c1f9[_0x1bfe03(0x29e)]||'';_0x242912=_0x46aca9[_0x1bfe03(0x228)][_0x99126c],(!_0x242912||!_0x242912[_0x1bfe03(0x117)])&&(_0x242912=_0x46aca9[_0x1bfe03(0x228)][_0x1bfe03(0x158)]);}for(let _0x2222d9 in midjourney_constant_1[_0x1bfe03(0x125)]){if(_0x3f48f8['includes'](midjourney_constant_1[_0x1bfe03(0x125)][_0x2222d9][_0x1bfe03(0x156)])){_0x11233c=midjourney_constant_1['ActionCN'][_0x2222d9]['cn'];break;}}return{'price':Number(_0x242912[_0x5ccb4a]),'vipFreeNum':Number(_0x242912[_0x541743]),'vipFreeKey':_0x541743,'description':_0x11233c};}async['validateBalance4Coze'](_0x31a2fd,_0x1f70a2,_0x385195,_0x2b4ada){const _0x1e2dea=_0x2189f4;let _0x50e838=!![];const _0x35912c=await this[_0x1e2dea(0x229)](_0x31a2fd);if(_0x35912c[_0x1e2dea(0x243)]||_0x35912c[_0x1e2dea(0x23f)]){if(_0x385195<0x0)_0x50e838=!![];else{if(_0x385195>0x0){const _0x473bcc=redisKey_constant_1[_0x1e2dea(0x202)]+'-'+_0x31a2fd+'-'+_0x1f70a2;let _0x5c0ce7=await this['redisCacheService'][_0x1e2dea(0x22a)]({'key':_0x473bcc}),_0x359412=Number(_0x5c0ce7||0x0);_0x359412<_0x385195?_0x50e838=!![]:_0x50e838=_0x35912c[_0x1e2dea(0x190)]>=_0x2b4ada;}else _0x50e838=_0x35912c['score']>=_0x2b4ada;}}else _0x50e838=_0x35912c[_0x1e2dea(0x190)]>=_0x2b4ada;if(!_0x50e838)throw new common_1[(_0x1e2dea(0x18c))](_0x1e2dea(0x2ac),common_1[_0x1e2dea(0x2ca)]['BAD_REQUEST']);}async['validateBalance4MJ'](_0xe5fe20,_0x357ee9=midjourney_constant_1[_0x2189f4(0x23b)]['relax'],_0x4c553b){const _0x128c31=_0x2189f4;let _0x27bfba=!![];const _0x1fb830=await this['getUserById'](_0xe5fe20),_0x1aa830=await this[_0x128c31(0x2b8)](_0x357ee9,_0x4c553b,_0x1fb830);console[_0x128c31(0x24e)](_0x128c31(0x12d),_0x1aa830);if(_0x1fb830[_0x128c31(0x243)]||_0x1fb830['vipExpire']){if(_0x1aa830['vipFreeNum']<0x0)_0x27bfba=!![];else{if(_0x1aa830[_0x128c31(0x26d)]>0x0){const _0x1e6e54=redisKey_constant_1[_0x128c31(0x202)]+'-'+_0xe5fe20+'-'+_0x1aa830[_0x128c31(0x2a5)];let _0x32c567=await this[_0x128c31(0x20d)]['get']({'key':_0x1e6e54}),_0xd593e8=Number(_0x32c567||0x0);_0xd593e8<_0x1aa830[_0x128c31(0x26d)]?_0x27bfba=!![]:_0x27bfba=_0x1fb830['score']>=_0x1aa830[_0x128c31(0x1d2)];}else _0x27bfba=_0x1fb830['score']>=_0x1aa830[_0x128c31(0x1d2)];}}else _0x27bfba=_0x1fb830[_0x128c31(0x190)]>=_0x1aa830['price'];if(_0x357ee9===midjourney_constant_1[_0x128c31(0x23b)][_0x128c31(0x29a)]){if(!_0x27bfba)throw new common_1[(_0x128c31(0x18c))](_0x128c31(0x2ac),common_1[_0x128c31(0x2ca)][_0x128c31(0x1e7)]);}else{if(!_0x27bfba)return this[_0x128c31(0x23c)](_0xe5fe20,midjourney_constant_1['DrawSpeed']['relax'],_0x4c553b);}return _0x357ee9;}async['deductBalance4MJ'](_0x3a854a,_0x3c4053,_0x2e2fba,_0x1cc587){const _0x233256=_0x2189f4,_0x280062=await this[_0x233256(0x229)](_0x3a854a),_0x4790c3=await this[_0x233256(0x2b8)](_0x3c4053,_0x2e2fba,_0x280062),_0x4c7b65=balance_constant_1[_0x233256(0x214)]['MjDraw'];if(_0x280062[_0x233256(0x243)]||_0x280062[_0x233256(0x23f)]){if(_0x4790c3[_0x233256(0x26d)]<0x0)await this[_0x233256(0x10c)](_0x280062,_0x4c7b65,0x0,_0x233256(0x20f)+_0x4790c3['description']+_0x233256(0x127),_0x1cc587);else{if(_0x4790c3[_0x233256(0x26d)]>0x0){const _0x585337=redisKey_constant_1[_0x233256(0x202)]+'-'+_0x3a854a+'-'+_0x4790c3[_0x233256(0x2a5)];let _0x29ac52=await this['redisCacheService']['get']({'key':_0x585337}),_0xaa0e99=Number(_0x29ac52||0x0);if(_0xaa0e99<_0x4790c3[_0x233256(0x26d)]){const _0x46d480=(0x0,date_1['default'])()[_0x233256(0x1d3)]('d')['diff']((0x0,date_1[_0x233256(0x10e)])(),'s');await this['redisCacheService'][_0x233256(0x2cf)]({'key':_0x585337,'val':_0xaa0e99+0x1},_0x46d480),await this['changeScore4Other'](_0x280062,_0x4c7b65,0x0,_0x233256(0x20f)+_0x4790c3[_0x233256(0x285)]+_0x233256(0x132),_0x1cc587);}else await this['changeScore4Other'](_0x280062,_0x4c7b65,-_0x4790c3[_0x233256(0x1d2)],'MJ绘画【'+_0x4790c3[_0x233256(0x285)]+_0x233256(0x102),_0x1cc587);}else await this[_0x233256(0x10c)](_0x280062,_0x4c7b65,-_0x4790c3[_0x233256(0x1d2)],_0x233256(0x20f)+_0x4790c3[_0x233256(0x285)]+_0x233256(0x102),_0x1cc587);}}else await this[_0x233256(0x10c)](_0x280062,_0x4c7b65,-_0x4790c3[_0x233256(0x1d2)],_0x233256(0x20f)+_0x4790c3[_0x233256(0x285)]+_0x233256(0x102),_0x1cc587);}async[_0x2189f4(0x196)](_0x2d4b35,_0x353099,_0x5e55f9,_0x281b1e){const _0x227d13=_0x2189f4,_0x22d862=await this[_0x227d13(0x229)](_0x2d4b35),_0xfc2728=await this[_0x227d13(0x2b8)](_0x353099,_0x5e55f9,_0x22d862),_0x344662=balance_constant_1[_0x227d13(0x214)][_0x227d13(0x1e1)];if(_0x22d862[_0x227d13(0x243)]||_0x22d862[_0x227d13(0x23f)]){if(_0xfc2728[_0x227d13(0x26d)]<0x0)return;else{if(_0xfc2728[_0x227d13(0x26d)]>0x0){const _0x13508f=redisKey_constant_1[_0x227d13(0x202)]+'-'+_0x2d4b35+'-'+_0xfc2728[_0x227d13(0x2a5)];let _0x4d40e8=await this[_0x227d13(0x20d)][_0x227d13(0x22a)]({'key':_0x13508f}),_0x34483b=Number(_0x4d40e8||0x0);if(_0x34483b<_0xfc2728['vipFreeNum']){const _0x2b1b1b=(0x0,date_1[_0x227d13(0x10e)])()[_0x227d13(0x1d3)]('d')[_0x227d13(0x231)]((0x0,date_1['default'])(),'s');await this['redisCacheService'][_0x227d13(0x2cf)]({'key':_0x13508f,'val':_0x34483b-0x1},_0x2b1b1b);return;}}}}await this['changeScore4Other'](_0x22d862,_0x344662,_0xfc2728[_0x227d13(0x1d2)],'MJ绘画【'+_0xfc2728[_0x227d13(0x285)]+_0x227d13(0x287),_0x281b1e);}async[_0x2189f4(0x1e6)](_0x472249,_0x242deb,_0x52d1f3,_0x2698ad=![]){const _0x4c7f44=_0x2189f4,_0x5d72b8={'create':{'key':'musicCreate','desc':_0x4c7f44(0x26f)},'lyrics':{'key':_0x4c7f44(0x2a8),'desc':'歌词生成'},'upload':{'key':'musicUpload','desc':'上传音乐'}},_0x49ad93=_0x5d72b8[_0x52d1f3][_0x4c7f44(0x122)],_0x437075=_0x5d72b8[_0x52d1f3][_0x4c7f44(0x171)]+_0x4c7f44(0x297),_0x3f30bb=_0x5d72b8[_0x52d1f3]['key']+_0x4c7f44(0x152),_0x101645={},_0x32a24e=await this['globalConfigService'][_0x4c7f44(0x1b7)]([_0x437075,_0x3f30bb]);for(let _0x38bfd6 in _0x32a24e){_0x101645[_0x38bfd6]=Number(_0x32a24e[_0x38bfd6])||0x0;}const _0x35b1fb=await this[_0x4c7f44(0x229)](_0x472249);if(_0x35b1fb[_0x4c7f44(0x243)]||_0x35b1fb['vipExpire']){if(_0x101645[_0x3f30bb]<0x0){!_0x2698ad&&await this['changeScore4Other'](_0x35b1fb,balance_constant_1[_0x4c7f44(0x214)][_0x4c7f44(0x21d)],0x0,'音乐【'+_0x49ad93+'】会员永久免费',_0x242deb);return;}else{if(_0x101645[_0x3f30bb]>0x0){const _0x89a095=redisKey_constant_1['VIP_FREE']+'-'+_0x472249+'-'+_0x3f30bb;let _0x23b3d4=await this[_0x4c7f44(0x20d)][_0x4c7f44(0x22a)]({'key':_0x89a095}),_0x3afd5a=Number(_0x23b3d4||0x0);if(!_0x2698ad){if(_0x3afd5a<_0x101645[_0x3f30bb]){const _0x1bb21e=(0x0,date_1[_0x4c7f44(0x10e)])()['endOf']('d')[_0x4c7f44(0x231)]((0x0,date_1[_0x4c7f44(0x10e)])(),'s');await this[_0x4c7f44(0x20d)][_0x4c7f44(0x2cf)]({'key':_0x89a095,'val':_0x3afd5a+0x1},_0x1bb21e),await this[_0x4c7f44(0x10c)](_0x35b1fb,balance_constant_1['EChangeType'][_0x4c7f44(0x21d)],0x0,_0x4c7f44(0x1ca)+_0x49ad93+_0x4c7f44(0x132),_0x242deb);return;}}else{const _0x59e93b=(0x0,date_1[_0x4c7f44(0x10e)])()[_0x4c7f44(0x1d3)]('d')[_0x4c7f44(0x231)]((0x0,date_1[_0x4c7f44(0x10e)])(),'s');await this[_0x4c7f44(0x20d)][_0x4c7f44(0x2cf)]({'key':_0x89a095,'val':_0x3afd5a-0x1},_0x59e93b);return;}}}}if(!_0x2698ad&&_0x35b1fb[_0x4c7f44(0x190)]<_0x101645[_0x437075])throw new common_1[(_0x4c7f44(0x18c))](_0x4c7f44(0x2ac),common_1[_0x4c7f44(0x2ca)][_0x4c7f44(0x1e7)]);if(!_0x2698ad){await this[_0x4c7f44(0x10c)](_0x35b1fb,balance_constant_1[_0x4c7f44(0x214)]['Music'],-_0x101645[_0x437075],_0x4c7f44(0x1ca)+_0x49ad93+_0x4c7f44(0x102),_0x242deb);return;}await this[_0x4c7f44(0x10c)](_0x35b1fb,balance_constant_1[_0x4c7f44(0x214)]['Music'],_0x101645[_0x437075],'音乐【'+_0x49ad93+_0x4c7f44(0x220),_0x242deb);}async['debuctBalance4PPT'](_0x38295c,_0x2abadf,_0x5d626a,_0x4bd77b=![]){const _0x2a86cc=_0x2189f4,_0x3d125a={'structure':{'key':_0x2a86cc(0x281),'vlrk':_0x2a86cc(0x257),'desc':_0x2a86cc(0x128)},'cover':{'key':_0x2a86cc(0x281),'vlrk':_0x2a86cc(0x257),'desc':'封面任务'},'recover':{'key':_0x2a86cc(0x281),'vlrk':_0x2a86cc(0x257),'desc':'重新生成封面任务'},'create':{'key':_0x2a86cc(0x1a9),'vlrk':_0x2a86cc(0x2c0),'desc':_0x2a86cc(0x212)},'thesis':{'key':_0x2a86cc(0x1e2),'vlrk':_0x2a86cc(0x261),'desc':_0x2a86cc(0x19f)},'file':{'key':_0x2a86cc(0x1a9),'vlrk':_0x2a86cc(0x2c0),'desc':_0x2a86cc(0x24a)},'theme':{'key':'pptCreate','vlrk':_0x2a86cc(0x2c0),'desc':'更换模板'},'editor':{'key':_0x2a86cc(0x1a0),'vlrk':'type1','desc':_0x2a86cc(0x217)},'addpage':{'key':_0x2a86cc(0x1a9),'vlrk':_0x2a86cc(0x2c0),'desc':_0x2a86cc(0x272)},'addNotes':{'key':_0x2a86cc(0x1a9),'vlrk':_0x2a86cc(0x2c0),'desc':_0x2a86cc(0x1e3)}},_0x499181=_0x3d125a[_0x5d626a][_0x2a86cc(0x122)],_0x159de1=_0x3d125a[_0x5d626a]['key']+'Price',_0x44f2cd=_0x3d125a[_0x5d626a]['key']+'VipFree',_0x290a0f={},_0x296519=await this['globalConfigService'][_0x2a86cc(0x1b7)]([_0x159de1,_0x44f2cd]);for(let _0x461582 in _0x296519){_0x290a0f[_0x461582]=Number(_0x296519[_0x461582])||0x0;}const _0x14a008=await this[_0x2a86cc(0x229)](_0x38295c);if(_0x14a008[_0x2a86cc(0x184)]){const _0x5b3174=await this[_0x2a86cc(0x1f0)][_0x2a86cc(0x223)](_0x14a008[_0x2a86cc(0x184)],model_constant_1[_0x2a86cc(0x14c)]['PPT']);_0x5b3174&&(_0x290a0f[_0x44f2cd]=_0x5b3174[_0x3d125a[_0x5d626a][_0x2a86cc(0x120)]]||0x0);}if(_0x14a008[_0x2a86cc(0x243)]||_0x14a008['vipExpire']){if(_0x290a0f[_0x44f2cd]<0x0){!_0x4bd77b&&await this[_0x2a86cc(0x10c)](_0x14a008,balance_constant_1[_0x2a86cc(0x214)][_0x2a86cc(0x1ab)],0x0,'PPT【'+_0x499181+_0x2a86cc(0x127),_0x2abadf);return;}else{if(_0x290a0f[_0x44f2cd]>0x0){const _0x1083b4=redisKey_constant_1['VIP_FREE']+'-'+_0x38295c+'-'+_0x44f2cd;let _0x3face3=await this[_0x2a86cc(0x20d)][_0x2a86cc(0x22a)]({'key':_0x1083b4}),_0x47861b=Number(_0x3face3||0x0);if(!_0x4bd77b){if(_0x47861b<_0x290a0f[_0x44f2cd]){const _0x42dce0=(0x0,date_1[_0x2a86cc(0x10e)])()[_0x2a86cc(0x1d3)]('d')[_0x2a86cc(0x231)]((0x0,date_1[_0x2a86cc(0x10e)])(),'s');await this[_0x2a86cc(0x20d)]['set']({'key':_0x1083b4,'val':_0x47861b+0x1},_0x42dce0),await this[_0x2a86cc(0x10c)](_0x14a008,balance_constant_1[_0x2a86cc(0x214)][_0x2a86cc(0x1ab)],0x0,_0x2a86cc(0x109)+_0x499181+_0x2a86cc(0x132),_0x2abadf);return;}}else{const _0x4fdbbb=(0x0,date_1[_0x2a86cc(0x10e)])()['endOf']('d')[_0x2a86cc(0x231)]((0x0,date_1['default'])(),'s');await this[_0x2a86cc(0x20d)]['set']({'key':_0x1083b4,'val':_0x47861b-0x1},_0x4fdbbb);return;}}}}if(!_0x4bd77b&&_0x14a008[_0x2a86cc(0x190)]<_0x290a0f[_0x159de1])throw new common_1['HttpException'](_0x2a86cc(0x2ac),common_1[_0x2a86cc(0x2ca)]['BAD_REQUEST']);if(!_0x4bd77b){await this[_0x2a86cc(0x10c)](_0x14a008,balance_constant_1['EChangeType'][_0x2a86cc(0x1ab)],-_0x290a0f[_0x159de1],'PPT【'+_0x499181+_0x2a86cc(0x102),_0x2abadf);return;}await this['changeScore4Other'](_0x14a008,balance_constant_1[_0x2a86cc(0x214)][_0x2a86cc(0x1ab)],_0x290a0f[_0x159de1],'PPT【'+_0x499181+_0x2a86cc(0x220),_0x2abadf);}async['deductBalance4WorkFlow'](_0x3e7534,_0x4ae8e7,_0x4e2bfc){const _0x4e7d02=_0x2189f4,_0x2edf6c=await this[_0x4e7d02(0x229)](_0x3e7534);if(_0x2edf6c[_0x4e7d02(0x243)]||_0x2edf6c[_0x4e7d02(0x23f)]){if(_0x4ae8e7['vipFreeNum']<0x0)await this['changeScore4Other'](_0x2edf6c,balance_constant_1['EChangeType']['WORKFLOW'],0x0,_0x4e7d02(0x182)+_0x4ae8e7[_0x4e7d02(0x20e)]+'】会员永久免费',_0x4e2bfc);else{if(_0x4ae8e7[_0x4e7d02(0x26d)]>0x0){const _0x49b0c1=redisKey_constant_1[_0x4e7d02(0x202)]+'-'+_0x3e7534+'-'+_0x4ae8e7['id'];let _0x161193=await this[_0x4e7d02(0x20d)][_0x4e7d02(0x22a)]({'key':_0x49b0c1}),_0x2992ac=Number(_0x161193||0x0);if(_0x2992ac<_0x4ae8e7['vipFreeNum']){const _0x686c1a=(0x0,date_1['default'])()[_0x4e7d02(0x1d3)]('d')['diff']((0x0,date_1[_0x4e7d02(0x10e)])(),'s');await this[_0x4e7d02(0x20d)][_0x4e7d02(0x2cf)]({'key':_0x49b0c1,'val':_0x2992ac+0x1},_0x686c1a),await this[_0x4e7d02(0x10c)](_0x2edf6c,balance_constant_1[_0x4e7d02(0x214)]['WORKFLOW'],0x0,_0x4e7d02(0x182)+_0x4ae8e7[_0x4e7d02(0x20e)]+_0x4e7d02(0x132),_0x4e2bfc);}else{if(_0x2edf6c['score']<_0x4ae8e7[_0x4e7d02(0x2b1)])throw new common_1[(_0x4e7d02(0x18c))](_0x4e7d02(0x2ac),common_1['HttpStatus'][_0x4e7d02(0x1e7)]);await this[_0x4e7d02(0x10c)](_0x2edf6c,balance_constant_1['EChangeType'][_0x4e7d02(0x1af)],-_0x4ae8e7[_0x4e7d02(0x2b1)],_0x4e7d02(0x182)+_0x4ae8e7[_0x4e7d02(0x20e)]+'】使用扣减',_0x4e2bfc);}}else{if(_0x2edf6c[_0x4e7d02(0x190)]<_0x4ae8e7[_0x4e7d02(0x2b1)])throw new common_1[(_0x4e7d02(0x18c))]('用户余额不足，请充值',common_1[_0x4e7d02(0x2ca)][_0x4e7d02(0x1e7)]);await this[_0x4e7d02(0x10c)](_0x2edf6c,balance_constant_1['EChangeType'][_0x4e7d02(0x1af)],-_0x4ae8e7['deduct'],_0x4e7d02(0x182)+_0x4ae8e7[_0x4e7d02(0x20e)]+_0x4e7d02(0x102),_0x4e2bfc);}}}else{if(_0x2edf6c[_0x4e7d02(0x190)]<_0x4ae8e7[_0x4e7d02(0x2b1)])throw new common_1[(_0x4e7d02(0x18c))](_0x4e7d02(0x2ac),common_1[_0x4e7d02(0x2ca)]['BAD_REQUEST']);await this[_0x4e7d02(0x10c)](_0x2edf6c,balance_constant_1[_0x4e7d02(0x214)][_0x4e7d02(0x1af)],-_0x4ae8e7[_0x4e7d02(0x2b1)],_0x4e7d02(0x182)+_0x4ae8e7[_0x4e7d02(0x20e)]+_0x4e7d02(0x102),_0x4e2bfc);}}async[_0x2189f4(0x221)](_0x15c688,_0x5488ee){const _0x1687bd=_0x2189f4,_0x2f8ec5=store_1[_0x1687bd(0x15c)][_0x1687bd(0x1c6)],_0x4ff532=await this['getUserById'](_0x15c688),_0x920849=balance_constant_1[_0x1687bd(0x214)]['SD'];if(_0x4ff532[_0x1687bd(0x243)]||_0x4ff532[_0x1687bd(0x23f)]){if(store_1[_0x1687bd(0x15c)][_0x1687bd(0x197)]<0x0)await this['changeScore4Other'](_0x4ff532,_0x920849,0x0,_0x1687bd(0x1b5),_0x5488ee);else{if(store_1[_0x1687bd(0x15c)][_0x1687bd(0x197)]>0x0){const _0x327718=redisKey_constant_1[_0x1687bd(0x202)]+'-'+_0x15c688+'-SD';let _0x4ac0d5=await this['redisCacheService']['get']({'key':_0x327718}),_0x18a8ff=Number(_0x4ac0d5||0x0);if(_0x18a8ff<store_1[_0x1687bd(0x15c)][_0x1687bd(0x197)]){const _0x4a4d63=(0x0,date_1[_0x1687bd(0x10e)])()[_0x1687bd(0x1d3)]('d')[_0x1687bd(0x231)]((0x0,date_1['default'])(),'s');await this[_0x1687bd(0x20d)][_0x1687bd(0x2cf)]({'key':_0x327718,'val':_0x18a8ff+0x1},_0x4a4d63),await this[_0x1687bd(0x10c)](_0x4ff532,_0x920849,0x0,_0x1687bd(0x11a)+_0x2f8ec5+_0x1687bd(0x132),_0x5488ee);}else await this[_0x1687bd(0x10c)](_0x4ff532,_0x920849,-_0x2f8ec5,_0x1687bd(0x11a)+_0x2f8ec5+_0x1687bd(0x102),_0x5488ee);}else await this[_0x1687bd(0x10c)](_0x4ff532,_0x920849,-_0x2f8ec5,'SD绘画【'+_0x2f8ec5+_0x1687bd(0x102),_0x5488ee);}}else await this[_0x1687bd(0x10c)](_0x4ff532,_0x920849,-_0x2f8ec5,_0x1687bd(0x11a)+_0x2f8ec5+'】使用扣减',_0x5488ee);}async['getModelVipFree'](_0x486a09,_0x3e6f2b){const _0x3ab36e=_0x2189f4,_0x1a6b57=redisKey_constant_1[_0x3ab36e(0x202)]+'-'+_0x486a09+'-'+_0x3e6f2b['id'];let _0x1b959f=await this[_0x3ab36e(0x20d)][_0x3ab36e(0x22a)]({'key':_0x1a6b57}),_0x33609b=Number(_0x1b959f||0x0);return _0x3e6f2b['vipFreeNum']-_0x33609b;}async['getVideoConfig'](_0x31c6e1,_0x29260c){const _0x1228a6=_0x2189f4;let _0x42892d;const _0x2be819=await this[_0x1228a6(0x121)][_0x1228a6(0x22f)](_0x1228a6(0x224));if(_0x2be819){const _0x37b331=_0x2be819[_0x1228a6(0x2c6)][_0x31c6e1['keyType']['toString']()],_0xce1315=_0x37b331[0x0];let _0x5d72e5=_0x29260c[_0x1228a6(0x15a)],_0x27f381=_0x29260c[_0x1228a6(0x256)];_0x42892d=_0x37b331['find'](_0x3fc27d=>_0x3fc27d[_0x1228a6(0x26a)]==_0x29260c['model']&&_0x3fc27d[_0x1228a6(0x15a)]==_0x5d72e5&&_0x3fc27d[_0x1228a6(0x256)]==_0x27f381);}return console[_0x1228a6(0x24e)](_0x1228a6(0x14d),_0x42892d),_0x42892d;}async[_0x2189f4(0x18d)](_0x55dae6,_0x79edaf,_0x3cca40){const _0x28513a=_0x2189f4;let _0x1fcaba=await this[_0x28513a(0x22c)](_0x79edaf,_0x3cca40);if(!_0x1fcaba)return await this['getModelVipFree'](_0x55dae6,_0x79edaf);const _0xb47965=redisKey_constant_1[_0x28513a(0x202)]+'-'+_0x55dae6+'-'+_0x1fcaba[_0x28513a(0x26a)]+'-'+_0x1fcaba[_0x28513a(0x15a)]+'-'+_0x1fcaba[_0x28513a(0x256)];let _0xe24177=await this[_0x28513a(0x20d)][_0x28513a(0x22a)]({'key':_0xb47965}),_0x3e4cd9=Number(_0xe24177||0x0);return _0x1fcaba['vipFreeNum']-_0x3e4cd9;}async[_0x2189f4(0x241)](_0x58e18b,_0x812068,_0x389c83){const _0x4e303f=_0x2189f4,_0x4cd4fa=redisKey_constant_1[_0x4e303f(0x202)]+'-'+_0x58e18b+'-'+_0x812068;let _0xb8c2df=await this['redisCacheService'][_0x4e303f(0x22a)]({'key':_0x4cd4fa}),_0x5c9b22=Number(_0xb8c2df||0x0);return _0x389c83-_0x5c9b22;}async[_0x2189f4(0x134)](_0x1f331f){const _0x2e472c=_0x2189f4,_0x31f0eb=redisKey_constant_1[_0x2e472c(0x202)]+'-'+_0x1f331f+_0x2e472c(0x2be);let _0x9311bf=await this['redisCacheService'][_0x2e472c(0x22a)]({'key':_0x31f0eb}),_0x558f25=Number(_0x9311bf||0x0);return store_1[_0x2e472c(0x183)]['lfVipFree']-_0x558f25;}async['getKeyFree'](_0xf1f2e3,_0x3946fe,_0x11c8c6){const _0x20a96e=_0x2189f4;let _0x239355=await this[_0x20a96e(0x20d)][_0x20a96e(0x22a)]({'key':_0x3946fe}),_0x85a012=Number(_0x239355||0x0);return _0x11c8c6-_0x85a012;}async[_0x2189f4(0x1f8)](_0x464af5){const _0x5dd490=_0x2189f4;let _0x53d9e6=!![];const _0x9afdeb=await this['getUserById'](_0x464af5);if(_0x9afdeb['lifetimeVip']||_0x9afdeb[_0x5dd490(0x23f)]){if(store_1[_0x5dd490(0x183)]['lfVipFree']<0x0)_0x53d9e6=!![];else{if(store_1['LinkFoxConfig']['lfVipFree']>0x0){const _0x160770=await this[_0x5dd490(0x134)](_0x464af5);_0x160770>0x0?_0x53d9e6=!![]:_0x53d9e6=_0x9afdeb['score']>=store_1[_0x5dd490(0x183)][_0x5dd490(0x1a7)];}else _0x53d9e6=_0x9afdeb[_0x5dd490(0x190)]>=store_1[_0x5dd490(0x183)][_0x5dd490(0x1a7)];}}else _0x53d9e6=_0x9afdeb['score']>=store_1['LinkFoxConfig'][_0x5dd490(0x1a7)];if(!_0x53d9e6)throw new common_1['HttpException'](_0x5dd490(0x2ac),common_1[_0x5dd490(0x2ca)][_0x5dd490(0x1e7)]);}async['deductBalanceLinxFox'](_0x1fd875,_0x14a7eb){const _0x242a58=_0x2189f4,_0x2a9aa9=store_1[_0x242a58(0x183)][_0x242a58(0x1a7)],_0x45d30f=await this[_0x242a58(0x229)](_0x1fd875),_0x12a93e=balance_constant_1[_0x242a58(0x214)][_0x242a58(0x277)];if(_0x45d30f[_0x242a58(0x243)]||_0x45d30f[_0x242a58(0x23f)]){if(store_1[_0x242a58(0x183)][_0x242a58(0x1ff)]<0x0)await this[_0x242a58(0x10c)](_0x45d30f,_0x12a93e,0x0,_0x242a58(0x163),_0x14a7eb);else{if(store_1[_0x242a58(0x183)][_0x242a58(0x1ff)]>0x0){const _0x22e1d1=redisKey_constant_1[_0x242a58(0x202)]+'-'+_0x1fd875+_0x242a58(0x2be);let _0x1f901b=await this['redisCacheService'][_0x242a58(0x22a)]({'key':_0x22e1d1}),_0x224817=Number(_0x1f901b||0x0);if(_0x224817<store_1[_0x242a58(0x183)][_0x242a58(0x1ff)]){const _0x5c4e5a=(0x0,date_1[_0x242a58(0x10e)])()[_0x242a58(0x1d3)]('d')[_0x242a58(0x231)]((0x0,date_1[_0x242a58(0x10e)])(),'s');await this[_0x242a58(0x20d)][_0x242a58(0x2cf)]({'key':_0x22e1d1,'val':_0x224817+0x1},_0x5c4e5a),await this[_0x242a58(0x10c)](_0x45d30f,_0x12a93e,0x0,_0x242a58(0x1ec)+_0x2a9aa9+'】会员每日限免',_0x14a7eb);}else await this[_0x242a58(0x10c)](_0x45d30f,_0x12a93e,-_0x2a9aa9,'LinxFox【【'+_0x2a9aa9+_0x242a58(0x102),_0x14a7eb);}else await this[_0x242a58(0x10c)](_0x45d30f,_0x12a93e,-_0x2a9aa9,_0x242a58(0x177)+_0x2a9aa9+_0x242a58(0x102),_0x14a7eb);}}else await this[_0x242a58(0x10c)](_0x45d30f,_0x12a93e,-_0x2a9aa9,_0x242a58(0x177)+_0x2a9aa9+_0x242a58(0x102),_0x14a7eb);}async[_0x2189f4(0x273)](){const _0xaa1eea=_0x2189f4,_0x2ed89a=await this[_0xaa1eea(0x107)][_0xaa1eea(0x2bd)]({'where':{'vipExpire':(0x0,typeorm_2[_0xaa1eea(0x11c)])((0x0,date_1[_0xaa1eea(0x10e)])()[_0xaa1eea(0x10b)]('d')['toDate'](),(0x0,date_1['default'])()['endOf']('d')[_0xaa1eea(0x1ce)]())}});if(_0x2ed89a['length'])for(let _0x5d8927=0x0;_0x5d8927<_0x2ed89a['length'];_0x5d8927++){const _0x40f071=_0x2ed89a[_0x5d8927];await this['redisCacheService'][_0xaa1eea(0x2cf)]({'key':redisKey_constant_1[_0xaa1eea(0x1b8)]+_0x40f071['id'],'val':''},(0x0,date_1[_0xaa1eea(0x10e)])()[_0xaa1eea(0x1d3)]('d')[_0xaa1eea(0x231)]((0x0,date_1[_0xaa1eea(0x10e)])(),'s'));}const _0x1a28ac=await this[_0xaa1eea(0x107)][_0xaa1eea(0x2bd)]({'where':{'vipExpire':(0x0,typeorm_2[_0xaa1eea(0x193)])((0x0,date_1[_0xaa1eea(0x10e)])()[_0xaa1eea(0x1ce)]())}});if(_0x1a28ac['length']){const _0x35e2c2=_0x1a28ac['map'](_0x8a338b=>_0x8a338b['id']);await this[_0xaa1eea(0x107)][_0xaa1eea(0x29b)]({'id':(0x0,typeorm_2['In'])(_0x35e2c2)},{'vipExpire':null});}}async['collect'](_0x4117c6,_0x57d7bd,_0x173e54){const _0x2e016c=_0x2189f4,_0x154395=(0x0,utils_1['getReqSaasId'])(this[_0x2e016c(0x1d5)]),_0x1d57cf=await this['userCollectEntity']['findOne']({'where':{'userId':_0x4117c6,'relId':_0x57d7bd,'relType':_0x173e54,'saasId':_0x154395}});if(_0x1d57cf)throw new common_1[(_0x2e016c(0x18c))](_0x2e016c(0x253),common_1[_0x2e016c(0x2ca)][_0x2e016c(0x1e7)]);else await this['userCollectEntity'][_0x2e016c(0x1aa)]({'userId':_0x4117c6,'relId':_0x57d7bd,'relType':_0x173e54,'sassId':_0x154395});}async[_0x2189f4(0x1a1)](_0x644dbf,_0x481aca,_0x23d8bb){const _0x208861=_0x2189f4,_0x1695fe=(0x0,utils_1['getReqSaasId'])(this[_0x208861(0x1d5)]),_0x348335=await this[_0x208861(0x166)]['findOne']({'where':{'userId':_0x644dbf,'relId':_0x481aca,'relType':_0x23d8bb,'saasId':_0x1695fe}});if(!_0x348335)throw new common_1[(_0x208861(0x18c))](_0x208861(0x2b4),common_1['HttpStatus'][_0x208861(0x1e7)]);else await this[_0x208861(0x166)][_0x208861(0x104)]({'id':_0x348335['id']});}async['uncollectByRelIds'](_0x121366,_0x3253e4){const _0x36031a=_0x2189f4,_0x1f0db2=(0x0,utils_1[_0x36031a(0x208)])(this['clsService']);_0x121366['forEach'](_0x59c138=>{const _0x2220c0=_0x36031a,_0x2fdf39=Number(_0x59c138);this[_0x2220c0(0x166)][_0x2220c0(0x104)]({'relId':_0x2fdf39,'relType':_0x3253e4,'saasId':_0x1f0db2});});}async[_0x2189f4(0x2b0)](_0x99e8af,_0x5d3cd4,_0x457ec1,_0x14d6ff){const _0x380c2d=_0x2189f4,_0x3bd20f=(0x0,utils_1[_0x380c2d(0x208)])(this[_0x380c2d(0x1d5)]),[_0x1c5027,_0x39f2af]=await this[_0x380c2d(0x166)]['findAndCount']({'where':{'userId':_0x457ec1,'relType':_0x14d6ff,'saasId':_0x3bd20f},'take':_0x5d3cd4,'skip':(_0x99e8af-0x1)*_0x5d3cd4,'order':{'createdAt':_0x380c2d(0x124)}});return{'rows':_0x1c5027,'count':_0x39f2af};}async[_0x2189f4(0x195)](_0x129ad4,_0x4579c7,_0x3f69fb){const _0x3009b1=_0x2189f4,_0x32cc67=(0x0,utils_1[_0x3009b1(0x208)])(this[_0x3009b1(0x1d5)]);return await this[_0x3009b1(0x166)][_0x3009b1(0x2bd)]({'where':{'userId':_0x4579c7,'relType':_0x3f69fb,'saasId':_0x32cc67,'relId':(0x0,typeorm_2['In'])(_0x129ad4)}});}async[_0x2189f4(0x1f2)](_0x76a19e,_0x2bb66b,_0x3056bb=collectType_constant_1[_0x2189f4(0x1b3)][_0x2189f4(0x1ab)]){const _0x45fb62=_0x2189f4;let _0x5894bc=Object['assign'](_0x76a19e),_0x37cdda=[];return _0x2bb66b[_0x45fb62(0x17a)]?.['id']&&(_0x37cdda=await this['collectList'](_0x76a19e[_0x45fb62(0x28a)](_0x2c12ac=>_0x2c12ac['id']),_0x2bb66b[_0x45fb62(0x17a)]['id'],_0x3056bb)),_0x5894bc[_0x45fb62(0x283)](_0x11fc6b=>{const _0x55c153=_0x45fb62;_0x37cdda[_0x55c153(0x2bd)](_0x420cab=>_0x420cab[_0x55c153(0x18a)]==_0x11fc6b['id'])?_0x11fc6b[_0x55c153(0x1cd)]=!![]:_0x11fc6b[_0x55c153(0x1cd)]=![];}),_0x5894bc;}};UserService=__decorate([(0x0,common_1[_0x2189f4(0x2c7)])(),__param(0x0,(0x0,common_1[_0x2189f4(0x1ea)])('REDIS_SUBSCRIBER')),__param(0x1,(0x0,typeorm_1[_0x2189f4(0x27e)])(user_entity_1[_0x2189f4(0x11d)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(saas_entity_1[_0x2189f4(0x260)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(role_entity_1['RoleEntity'])),__param(0x4,(0x0,typeorm_1[_0x2189f4(0x27e)])(user_init_vip_entity_1['UserInitVipEntity'])),__param(0x5,(0x0,typeorm_1[_0x2189f4(0x27e)])(userFavorite_entity_1[_0x2189f4(0x21c)])),__param(0x6,(0x0,typeorm_1[_0x2189f4(0x27e)])(userCollect_entity_1[_0x2189f4(0x1c9)])),__metadata('design:paramtypes',[Object,typeorm_2[_0x2189f4(0x185)],typeorm_2[_0x2189f4(0x185)],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x2189f4(0x185)],nestjs_cls_1['ClsService'],mailer_1['MailerService'],redisCache_service_1[_0x2189f4(0x1be)],userBalance_service_1[_0x2189f4(0x176)],globalConfig_service_1[_0x2189f4(0x17e)],verification_service_1[_0x2189f4(0x1fb)],cm_service_1[_0x2189f4(0x244)],typeorm_2[_0x2189f4(0x16e)]])],UserService),exports['UserService']=UserService;function _0x26a0(){const _0x48398e=['GPTS','hashSync','小工具【','LinkFoxConfig','vipLeavelId','Repository','username','inviteSendStatus','超级管理员','AND\x20email\x20LIKE\x20\x27%','relId','UserStatusEnum','HttpException','getVideoModelVipFree','手机号格式错误！','Draw','score','relateId','registerBaseUrl','LessThanOrEqual','11CGMKql','collectList','refundBalance4MJ','czVipFree','File','您的账户已被封禁、如有疑问、请联系管理员！','refundBalance4Video','ERole','favoriteListByTypeAndIds','当前绑定用户不存在！','】失败退还','论文生成PPT','pptEditor','uncollect','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','queryByPage','deductBalance4Video','%\x27\x20)','isVerifyEmail','lfPrice','inviteRewards','pptCreate','save','PPT','用户名\x09密码\x0a','queryOne','用户名已存在！','WORKFLOW','MUSIC','countByInviteCode','registerVerifyEmailTitle','UserCollectType','inviterEmail','SD绘画会员永久免费','filter','getConfigByKeys','VIP_EXPIRE','FILE','HttpStatusCode','恭喜您绑定成功、后续可直接扫码登录了！','ids','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','RedisCacheService','Registe','CHAT','mj123456admin','\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','fetch|listbyids|modal|seed','修改用户信息失败！','query','czProxyPrice','updateUserStatus','修改用户状态成功！','UserCollectEntity','音乐【','当前用户不存在！','./user_init_vip.entity','isCollect','toDate','findAndCount','updateUserPassword','accessLabel','price','endOf','increment','clsService','relax_vip_free','%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%','当前手机号已注册、请勿重复注册！','checkUserStatus','mj-','VIDEO','当前账户不存在！','verificationService','getSaasById','yes','__decorate','MjDraw','pptThesis','增加PPT备注','isInteger','hideString','debuctBalance4Muisc','BAD_REQUEST','queryUserInfoById','has','Inject','../redisCache/redisCache.service','LinxFox【','getInviteRecord','getOwnPropertyDescriptor','pSubscribe','globalConfigService','绑定微信失败、请联系管理员！','mergeCollectData','saasSave','userBalanceService','SUPER','\x20OFFSET\x20','metadata','validateBalanceLinxFox','updateInfo','verifyUserPassword','VerificationService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','queryAll','genUserName','lfVipFree','isManage','------------------VVVVVVVVVVV1------------','VIP_FREE','重置密码失败！','getUserOpenId','registerSendStatus','defineProperty','27327800OlSbsA','getReqSaasId','nickname','status','deductBalance4Chat','roleEntity','redisCacheService','modelName','MJ绘画【','queryOneUserInfo','createUserAndVerifycation','模板生成PPT','12XHXldk','EChangeType','message','Invited','编辑PPT','registerVerifyExpir','@nestjs-modules/mailer','6pVSNWe','exists','UserFavoriteEntity','Music','用户名已存在、请更换用户名！','%\x27\x20OR\x20id\x20=\x20\x27','】生成失败退还','deductBalance4SD','invitedRewardVip','getVipLeavelRelById','AIVideoMutiConfig','邀请新用户注册奖励','获取邀请记录失败！','push','mjLeavelRel','getUserById','get','Chat','getVideoConfig','destroyAccount','roleSave','getValue','inviteRewardVip','diff','mailerService','当前密码错误！','inviterPhone','userId','../userBalance/userBalance.service','maskIpAddress','AdminGift','已生成过邀请码、请勿重复生成','\x20AND\x20`status`\x20=\x20','DrawSpeed','validateBalance4MJ','initSaasMap','insertAccountVipLog','vipExpire','role','getCozeModelVipFree','当前角色编码不可用，请使用其他角色编码','lifetimeVip','CmConfigService','./../verification/verification.service','relateType','%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','insertAccountLog','ListSaasByIds','文件生成PPT','turbo','\x20AND\x20u.createdAt\x20>=\x20\x27','\x20AND\x20u.saasId\x20=\x20','log','PENDING','day','修改用户角色成功！','changeScore4registe','您已经收藏过该内容','Coze','558557wzBiic','duration','type1','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','的账号激活','genUserNames','498965VlCzZJ','用户名或者邮箱已被注册！','length','createBatch','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','SaasEntity','type3','1317884MZbqvy','../../common/store','Not','isPlatform','env','\x20AND\x20username\x20LIKE\x20\x27%','relax_mjDeduction','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','model','subscriber','%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','vipFreeNum','zh-CN','音乐创作','isEmail','修改用户角色失败！','增加PPT单页','updateVipExpire2Redis','test','phone','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20','LinkFox','4005470BNahtC','../../common/constants/Role.constant','formatCreateOrUpdateDate','updateUserPsd','floor','LOCKED','InjectRepository','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getOne','pptOutline','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','forEach','生成邀请码失败，请重新试一次吧！','description','userCount','】使用失败退费','random',']成功!','map','roleDel','../../common/constants/model.constant','email','shouldAccess','add','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','access','updateUserAppOpenId','verifyUserRegisterByPhone','name','./userFavorite.entity','isSuper','Price','\x20AND\x20u.userId\x20=\x20','\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','relax','update','】调用失败退还','maskEmail','vipLeavelName','1682433vJqVik','favorite','createdAt','UserService\x20Init','%\x27\x20OR\x20email\x20LIKE\x20\x27%','axios','vipFreeKey','deductBalance4Coze','Tts','musicLyrics','typeorm','非法访问','OTHER','用户余额不足，请充值','Tool','registerVerifyEmailFrom','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','collectPage','deduct','turbo_vip_free','1000528ittbFO','您还未收藏过该内容','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','modelType','getOpenIdByUserId','getMjPrice','userInitVipEntity','isDefined','then','InvitationReward','find','-LinkFox','userInitVip','type2','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','fast_mjDeduction','UserStatusErrMsg','\x20AND\x20role\x20=\x20\x27','../../common/constants/verification.constant','config','Injectable','\x09mj123456admin\x0a','userDefautlAvatar','HttpStatus','findOne','saasDel','ACTIVE','class-validator','set','connection','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','】使用扣减','%\x27\x20OR\x20nickname\x20LIKE\x20\x27%','delete','DRAW','queryUserInfoByIds','userEntity','miniOpenId','PPT【','__metadata','startOf','changeScore4Other','saasEntity','default','../../common/constants/collectType.constant','saasId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','concat','compareSync','generateRandomString','replace','avatar','fast_vip_free','isMobilePhone','getEntity','SD绘画【','模型【','Between','UserEntity','受邀请注册赠送','54rVaQUL','vlrk','configService','desc','Like','DESC','ActionCN','giftVip','】会员永久免费','标题大纲任务','object','TTS','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','MjLeavelRel','------------------------Price--------------','BLACKLISTED','./user.entity','还有用户使用相关角色，无法删除！','../../common/constants/midjourney.constant','】会员每日限免','lastLoginIp','getLfVipFree','userFavoriteEntity','AGENT','password','invitedRewards','账号注册时密码不能为空！','saasId不能为空！','VIEWER','startsWith','FORBIDDEN','registerRewards','\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','error:\x20','affected','\x20AND\x20phone\x20LIKE\x20\x27%','GOMAXAI_HOST','用户不存在！','saasMap','查询用户不存在！','Registration','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','@nestjs/typeorm','该微信已绑定其他账号！','getUserStatus','EModelType','--------------------------------VVVVVVVVVVVVV----','__esModule','count','toLowerCase','管理员赠送','VipFree','前台用户','qureyUserInfoByInviteCode','decorate','action','onModuleInit','体验会员','violationCount','mode','../../common/constants/redisKey.constant','CZConfig','getUserByInviteCode','updateUserOpenId','transaction','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27','code','validateBalance4Video','LinxFox会员永久免费','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','clear','userCollectEntity','updateVipExpire','valueOf','refundBalance4Chat','vipDays','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','includes','Connection','updateStatus','./../globalConfig/globalConfig.service','key','rolePage','openId','./entity/userCollect.entity','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','UserBalanceService','LinxFox【【','1\x20=\x201','修改用户状态失败！','user','createUser','bcryptjs','nestjs-cls','GlobalConfigService','registerVerifyEmailDesc'];_0x26a0=function(){return _0x48398e;};return _0x26a0();}