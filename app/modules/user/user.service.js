'use strict';function _0x5edc(){const _0x1b9b8d=['智能体【','saasPage','map','用户名格式错误,\x20用户名只能由字母+数字，且不包含特殊字符','修改用户角色失败！','../../common/constants/balance.constant','REDIS_SUBSCRIBER','UserService','isDefined','VerificationService','%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%','getUserByInviteCode','substring','deductBalance4MJ','updateStatus','collectListForUserID','lfVipFree','标题大纲任务','changeScore4registe','decorate','length','\x20AND\x20(\x20u.username\x20LIKE\x20\x27%','initSaasMap','RoleEntity','%\x27\x20OR\x20u.email\x20LIKE\x20\x27%','密码重置为[','vipExpire','ActionCN','type2','register','UserCollectEntity','getUserListByIds','test','configService','\x20AND\x20(vipExpire\x20IS\x20NOT\x20NULL\x20OR\x20lifetimeVip\x20=\x201)','63151wDXMmT','log','InjectRepository','getValue','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','day','relax_mjDeduction','../../common/constants/verification.constant','keyType','getConfigByKeys','\x20AND\x20(username\x20LIKE\x20\x27%','重新生成封面任务','modelType','LessThanOrEqual','countByInviteCode','LinxFox【','FILE','avatar','modelName','\x27,\x200)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','pptUserType','./userFavorite.entity','__metadata','账号注册时密码不能为空！','count','您已经收藏过该内容','Chat','getUserOpenId','文件生成PPT','fetch|listbyids|modal|seed','%\x27\x20))\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','registerIp','@nestjs/common','updateVipExpire2Redis','maskIpAddress','Inject','num','code','fast_vip_free','price','findOne','updateVipType','indexOf','用户名已被使用！','AGENT','vipFreeNum','getUserById','修改用户信息成功！','2cPNtFb','createBatch','refundBalance4Draw','verifyUserRegisterByPhone','pptOutline','turbo_mjDeduction','getOne','refundBalance4MJ','DRAW','musicLyrics','openId','turbo_vip_free','1369640njqmIm','SD绘画【','desc','startOf','\x20AND\x20lifetimeVip\x20=\x200\x20AND\x20vipExpire\x20IS\x20NULL','queryOne','push','数字人【','Registe','修改用户角色成功！','createUser','VerificationEnum','filter','get','修改用户信息失败！','nickname','redisCacheService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x20','inviterPhone','nestjs-cls','endOf','insertAccountVipLog','userDefautlAvatar','violationCount','用户名已存在！','getMjUserModelPrice','dictName','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','查询用户不存在！','size','saasId不能为空！','updateUserPsd','key','Registration','verificationService','add','musicCreate','当前账户不存在！','------------------------Price--------------','../../common/constants/dict.constant','%\x27\x20OR\x20u1.email\x20LIKE\x20\x27%','当前绑定用户不存在！','debuctBalance4Muisc','cloneDeep','default','您的账户已被永久加入黑名单、如有疑问、请联系管理员！','toLowerCase','relateType','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','当前密码错误！','increment','ACTIVE','deductBalance4Chat','vipFreeKey','vipLeavelName','GOMAXAI_HOST','论文生成PPT','../../common/constants/collectType.constant','password','受邀请注册赠送','genUserNames','LinxFox会员永久免费','roleSave','@nestjs/typeorm','AND\x20email\x20LIKE\x20\x27%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.avatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.id\x20AS\x20inviterId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.avatar\x20AS\x20inviterAvatar,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.username\x20AS\x20inviterUsername,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.nickname\x20AS\x20inviterNickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.phone\x20AS\x20inviterPhone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u1.email\x20AS\x20inviterEmail\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','split','LinxFox【【','updateUser','fast_mjDeduction','MUSIC','Tool','isEmail','registerBaseUrl','getMjPrice','isInteger','】使用失败退费','relax','】会员每日限免','saasId','LinkFox','musicUserType','create','没有变更，无需更改！','saasMap','../../common/utils','description','config','deductBalance4WorkFlow','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','mj123456admin','access','VipLeavel','email',']成功!','updateSignDay','./../verification/verification.service','UserBalanceService','registerRewards','queryByPage','metadata','该模型仅限','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20IGNORE\x20INTO\x20user_role\x20(name,\x20code,\x20saasId)\x20VALUES\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27超级管理员\x27,\x20\x27','修改用户状态失败！','object','LinkFoxConfig','./role.entity','userCount','updateUserMiniOpenId','deduct','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','ListSaasByIds','用户余额不足，请充值','DrawSpeed','%\x27\x20))\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','toDate','connection','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','defineProperty','axios','userId','还有用户使用相关角色，无法删除！','VIEWER','2367pjKqMz','%\x27\x20OR\x20id\x20=\x20\x27','\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27前台用户\x27,\x20\x27','globalConfigService','getVideoConfig','未激活用户不可手动变更状态！','findBy','%\x27\x20)','增加PPT备注','hashSync','\x20AND\x20saasId\x20=\x20','exists','insertAccountLog','registerSendStatus','当前用户不存在！','增加PPT单页','角色信息不存在！','3210704iwryfL','createVerification','MjDraw','findAndCount','\x20AND\x20phone\x20LIKE\x20\x27%','deductBalance4SD','updateRole','collect','ERole','MJ绘画【','超级管理员','saasUpdate','】调用失败退还','username','用户名\x09密码\x0a','roleEntity','Tts','VipFree','\x20AND\x20(\x20u1.username\x20LIKE\x20\x27%','params','authorization','的账号激活','手机号格式错误！','inviteCode','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20u\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u1\x20ON\x20u.invitedBy\x20=\x20u1.inviteCode\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','transaction','SUPER','forEach','WORKFLOW','封面任务','inviteRewardVip','userType','EChangeType','EDictType','../../common/constants/midjourney.constant','userFavoriteEntity','userInitVipEntity','手机号已被使用！','inviteSendStatus','czVipFree','】使用扣减','isCollect','createdAt','toString','BAD_REQUEST','czProxyPrice','bindWx','PPT','体验会员','replace','dictEntity','saasDel','Price','refundBalance4Human','pSubscribe','./entity/userCollect.entity','userInitVip','生成邀请码失败，请重新试一次吧！','userCollectEntity','refundBalance4Video','HttpStatusCode','consumeConfig','genInviteCode','\x20AND\x20`status`\x20=\x20','validateBalance4MJ','\x20AND\x20u.saasId\x20=\x20','LOCKED','AdminGift','typeorm','798GLUapV','giftScore','Between','sendMail','./user.entity','queryAll','当前用户信息失效、请重新登录！','isSuper','status','validateBalance4Video','__param','模板生成PPT','customId','savaLoginIp','valueOf','getLfVipFree','当前手机号已注册、请勿重复注册！','action','imagine|variation|outpaint|pan|blend|inpaint|upsample|picreader|reroll','queryUserByUsername','accessLabel','relax_vip_free','inviterEmail','HttpException','__esModule','getVipLeavelRelById','\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','Failed\x20to\x20verify\x20JWT\x20token:','assign','UserEntity','前台用户','OTHER','updateVipExpire','delUser','update','turbo','save','pptThesis','./../globalConfig/globalConfig.service','../../common/constants/Role.constant','绑定微信失败、请联系管理员！','VIDEO','获取邀请记录失败！','GPTS','Invited','VIP_EXPIRE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','-SD','../cmConfig/cm.service','APP','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.invitedBy\x20!=\x20\x27\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20u.invitedBy\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','getOwnPropertyDescriptor','../../common/utils/date','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(saasId\x20=\x200\x20AND\x20`code`\x20=\x20\x27','lastLoginIp','2570022NBSeJP','Draw','isMobilePhone','../dict/dict.entity','音乐创作','query','Coze','编辑PPT','HttpStatus','lifetimeVip','invitedRewardVip','maskEmail','message','非法访问','deductBalance4Human','diff','phone','userBalanceService','%\x27\x20OR\x20u1.nickname\x20LIKE\x20\x27%','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','ASC','user','\x20AND\x20username\x20LIKE\x20\x27%','1\x20=\x201','ids','%\x27\x20OR\x20u1.phone\x20LIKE\x20\x27%','env','账号、手机、邮箱必须存在一个','mailerService','clsService','UserStatusEnum','邀请新用户注册奖励','./saas.entity','PENDING','model','invitedRewards','UNAUTHORIZED','vipLeavelId','lfPrice','vipDays','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x20=\x20','不可将用户置为未激活状态！','ClsService','SaasEntity','validateUserType','】生成失败退还','FORBIDDEN','score','getHumanConfig','checkUserStatus','updateViolationCount','】失败退还','name','getOpenIdByUserId','find','refundBalance4Chat','AIVideoMutiConfig','Bearer\x20','visitor','destroyAccount','resetUserPass','validateBalance4Draw','changeScore4Other','getUserUnionId','重置密码失败！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20saasId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','EModelType','updateUserOpenId','yes','getUserInfoFromHeader','mergeCollectData','%\x27\x20OR\x20phone\x20LIKE\x20\x27%','hideString','邮箱格式错误！','JWT_SECRET','days','debuctBalance4PPT','%\x27\x20OR\x20`code`\x20LIKE\x20\x27%','Connection','歌词生成','zh-CN','RedisCacheService','relId','1140SykaWW','pptEditor','deductBalanceLinxFox','DESC','mode','@nestjs-modules/mailer','恭喜您绑定成功、后续可直接扫码登录了！','Music','registerVerifyExpir','invitePage','duration','BLACKLISTED','InvitationReward','10150ANdQHh','模型【','type1','musicUpload','FaceSwap','design:paramtypes','无效的邀请码！','has','../userBalance/userBalance.service','uncollectByRelIds','disabled','123456','mjLeavelRel','favoriteListByTypeAndIds','isVerifyEmail','updateUserStatus','jsonwebtoken','shouldAccess','getVideoModelVipFree','deductBalance4Coze','role','音乐【','isPlatform','affected','fast','getKeyFree','Like','validateBalance4Coze','clear','\x27\x20AND\x20(\x20`name`\x20LIKE\x20\x27%','collectList','subscriber','pptCreate','MjLeavelRel','549568Clfrmu','relateId','userEntity','更换模板','getEntity','vlrk','\x20AND\x20u.createdAt\x20<=\x20\x27','MailerService','getModelVipFree','registerVerifyEmailTitle','用户不存在！','delete','PPT【','修改用户状态成功！','floor','headers','saasEntity','超级管理员不可被操作！','管理员赠送','已生成过邀请码、请勿重复生成','Not','error:\x20','saasName','getMiniOpenIdByUserId','mj-','roleDel','修改密码失败、请重新试试吧。','queryOneUserInfo','__keyevent@0__:expired','formatCreateOrUpdateDate','getDrawModelVipFree','validateBalance4Gpt','mergeCollectCountData','getReqSaasId','../../common/constants/model.constant','UserStatusErrMsg','VIP_FREE','deductBalance4Draw','onModuleInit','includes','小工具【','set','BadRequest','getInviteRecord','\x20AND\x20u.userId\x20=\x20','Human','Repository','genUserName','rolePage','createUserAndVerifycation','verify','UserCollectType','compareSync','TTS','】会员永久免费','inviteRewards','type3','CZConfig','domain','validateBalance4Chat','CHAT','-LinkFox'];_0x5edc=function(){return _0x1b9b8d;};return _0x5edc();}const _0x5ee955=_0x17f4;(function(_0x2e51ae,_0x38b6d4){const _0x400528=_0x17f4,_0x17e99d=_0x2e51ae();while(!![]){try{const _0x45e592=parseInt(_0x400528(0x1b2))/0x1+-parseInt(_0x400528(0x1e2))/0x2*(-parseInt(_0x400528(0xcf))/0x3)+-parseInt(_0x400528(0x27a))/0x4+parseInt(_0x400528(0x1ee))/0x5+parseInt(_0x400528(0x122))/0x6*(-parseInt(_0x400528(0x98))/0x7)+-parseInt(_0x400528(0x151))/0x8+-parseInt(_0x400528(0x269))/0x9*(-parseInt(_0x400528(0x12f))/0xa);if(_0x45e592===_0x38b6d4)break;else _0x17e99d['push'](_0x17e99d['shift']());}catch(_0x470cc7){_0x17e99d['push'](_0x17e99d['shift']());}}}(_0x5edc,0x8a972));var __decorate=this&&this['__decorate']||function(_0x5b840f,_0x16d52b,_0x4436e6,_0x3675c9){const _0x4fd165=_0x17f4;var _0x4019c2=arguments[_0x4fd165(0x1a3)],_0x4667ca=_0x4019c2<0x3?_0x16d52b:_0x3675c9===null?_0x3675c9=Object[_0x4fd165(0xcb)](_0x16d52b,_0x4436e6):_0x3675c9,_0x497c98;if(typeof Reflect==='object'&&typeof Reflect[_0x4fd165(0x1a2)]==='function')_0x4667ca=Reflect[_0x4fd165(0x1a2)](_0x5b840f,_0x16d52b,_0x4436e6,_0x3675c9);else{for(var _0x2d74d9=_0x5b840f[_0x4fd165(0x1a3)]-0x1;_0x2d74d9>=0x0;_0x2d74d9--)if(_0x497c98=_0x5b840f[_0x2d74d9])_0x4667ca=(_0x4019c2<0x3?_0x497c98(_0x4667ca):_0x4019c2>0x3?_0x497c98(_0x16d52b,_0x4436e6,_0x4667ca):_0x497c98(_0x16d52b,_0x4436e6))||_0x4667ca;}return _0x4019c2>0x3&&_0x4667ca&&Object[_0x4fd165(0x264)](_0x16d52b,_0x4436e6,_0x4667ca),_0x4667ca;},__metadata=this&&this[_0x5ee955(0x1c8)]||function(_0x29c41d,_0x245441){const _0x512342=_0x5ee955;if(typeof Reflect===_0x512342(0x256)&&typeof Reflect[_0x512342(0x252)]==='function')return Reflect[_0x512342(0x252)](_0x29c41d,_0x245441);},__param=this&&this[_0x5ee955(0xa2)]||function(_0x594ea5,_0x31449a){return function(_0x909247,_0x288c09){_0x31449a(_0x909247,_0x288c09,_0x594ea5);};};function _0x17f4(_0x51923d,_0x18e923){const _0x5edce4=_0x5edc();return _0x17f4=function(_0x17f4f9,_0x64dbb3){_0x17f4f9=_0x17f4f9-0x8c;let _0x554290=_0x5edce4[_0x17f4f9];return _0x554290;},_0x17f4(_0x51923d,_0x18e923);}Object[_0x5ee955(0x264)](exports,_0x5ee955(0xb0),{'value':!![]}),exports['UserService']=void 0x0;const globalConfig_service_1=require(_0x5ee955(0xbe)),user_constant_1=require('../../common/constants/user.constant'),mailer_1=require(_0x5ee955(0x127)),verification_service_1=require(_0x5ee955(0x24e)),common_1=require(_0x5ee955(0x1d2)),typeorm_1=require(_0x5ee955(0x22d)),typeorm_2=require(_0x5ee955(0x97)),user_entity_1=require(_0x5ee955(0x9c)),bcrypt=require('bcryptjs'),_=require('lodash'),jwt=require(_0x5ee955(0x13f)),verification_constant_1=require(_0x5ee955(0x1b9)),userBalance_service_1=require(_0x5ee955(0x137)),utils_1=require(_0x5ee955(0x243)),balance_constant_1=require(_0x5ee955(0x194)),class_validator_1=require('class-validator'),redisKey_constant_1=require('../../common/constants/redisKey.constant'),redisCache_service_1=require('../redisCache/redisCache.service'),model_constant_1=require(_0x5ee955(0x173)),midjourney_constant_1=require(_0x5ee955(0x29c)),user_init_vip_entity_1=require('./user_init_vip.entity'),axios_1=require(_0x5ee955(0x265)),date_1=require(_0x5ee955(0xcc)),saas_entity_1=require(_0x5ee955(0xef)),role_entity_1=require(_0x5ee955(0x258)),store_1=require('../../common/store'),nestjs_cls_1=require(_0x5ee955(0x201)),Role_constant_1=require(_0x5ee955(0xbf)),userFavorite_entity_1=require(_0x5ee955(0x1c7)),userCollect_entity_1=require(_0x5ee955(0x2b1)),collectType_constant_1=require(_0x5ee955(0x227)),cm_service_1=require(_0x5ee955(0xc8)),dict_entity_1=require(_0x5ee955(0xd2)),dict_constant_1=require(_0x5ee955(0x215));let UserService=class UserService{constructor(_0x545d4f,_0x47773f,_0x3d1a3e,_0x4fc1a1,_0x5077ab,_0x5efbce,_0x51d1d4,_0x252152,_0x2515ab,_0x30e357,_0x239f29,_0x116fdd,_0x3cbfd7,_0x40624f,_0x3d9c8c,_0x21d856){const _0x409f60=_0x5ee955;this[_0x409f60(0x14e)]=_0x545d4f,this[_0x409f60(0x153)]=_0x47773f,this[_0x409f60(0x161)]=_0x3d1a3e,this[_0x409f60(0x289)]=_0x4fc1a1,this[_0x409f60(0x29e)]=_0x5077ab,this[_0x409f60(0x29d)]=_0x5efbce,this[_0x409f60(0x8d)]=_0x51d1d4,this[_0x409f60(0x2ac)]=_0x252152,this[_0x409f60(0xec)]=_0x2515ab,this['mailerService']=_0x30e357,this['redisCacheService']=_0x239f29,this[_0x409f60(0xe0)]=_0x116fdd,this[_0x409f60(0x26c)]=_0x3cbfd7,this[_0x409f60(0x210)]=_0x40624f,this[_0x409f60(0x1b0)]=_0x3d9c8c,this['connection']=_0x21d856;}[_0x5ee955(0x177)](){const _0x341855=_0x5ee955;console['log']('UserService\x20Init'),this[_0x341855(0x262)][_0x341855(0xd4)](_0x341855(0x254)+Role_constant_1['ERole'][_0x341855(0x294)]+'\x27,\x200),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x27代理商\x27,\x20\x27'+Role_constant_1[_0x341855(0x282)]['AGENT']+_0x341855(0x26b)+Role_constant_1['ERole'][_0x341855(0x268)]+_0x341855(0x1c5)),this['initSaasMap'](),this[_0x341855(0x14e)][_0x341855(0x2b0)](_0x341855(0x16d),async _0x4da1cb=>{const _0x135349=_0x341855;if(_0x4da1cb['startsWith'](redisKey_constant_1['VIP_EXPIRE'])){const _0x54fa91=_0x4da1cb[_0x135349(0x2ab)](redisKey_constant_1[_0x135349(0xc5)],'');this['userEntity'][_0x135349(0xba)]({'id':Number(_0x54fa91)},{'vipExpire':null});}});}async[_0x5ee955(0x1a5)](){const _0xfd9320=_0x5ee955,_0x419eb1=await this[_0xfd9320(0x161)][_0xfd9320(0x105)]({'where':{'deleteFlag':0x0}});store_1[_0xfd9320(0x242)][_0xfd9320(0x14b)](),_0x419eb1['forEach'](_0x3b142c=>store_1[_0xfd9320(0x242)][_0xfd9320(0x17a)](_0x3b142c[_0xfd9320(0x18b)],_0x3b142c['id'])),store_1['saasMap'][_0xfd9320(0x17a)](process[_0xfd9320(0xe9)][_0xfd9320(0x225)],0x0);}[_0x5ee955(0x155)](){const _0x17eb54=_0x5ee955;return this[_0x17eb54(0x153)];}async[_0x5ee955(0x25d)](_0x17ad08){const _0x5ab7f8=_0x5ee955;if(!_0x17ad08['length'])return[];return this[_0x5ab7f8(0x161)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x17ad08)}});}async[_0x5ee955(0x190)](_0x215c1a){const _0x3a9a07=_0x5ee955,{page:page=0x1,size:size=0x14,keyword:_0x1992b5}=_0x215c1a;let _0x2cb42a;_0x1992b5?_0x2cb42a=[{'deleteFlag':0x0,'name':(0x0,typeorm_2['Like'])('%'+_0x1992b5+'%')},{'deleteFlag':0x0,'domain':(0x0,typeorm_2[_0x3a9a07(0x149)])('%'+_0x1992b5+'%')}]:_0x2cb42a={'deleteFlag':0x0};const [_0x55350e,_0x555e56]=await this[_0x3a9a07(0x161)][_0x3a9a07(0x27d)]({'where':_0x2cb42a,'skip':(page-0x1)*size,'take':size,'order':{'createdAt':'DESC'}});if(!_0x55350e[_0x3a9a07(0x1a3)])return{'rows':[],'count':_0x555e56};const _0x8f6160=_0x55350e[_0x3a9a07(0x191)](_0x1dc2ec=>_0x1dc2ec['id']),_0x3d3495=new Map(),_0x56cdaa=await this[_0x3a9a07(0x153)][_0x3a9a07(0x105)]({'where':{'saasId':(0x0,typeorm_2['In'])(_0x8f6160),'role':Role_constant_1[_0x3a9a07(0x282)][_0x3a9a07(0x1de)]}});_0x56cdaa['forEach'](_0x1c983a=>{const _0x4b71fa=_0x3a9a07;_0x3d3495[_0x4b71fa(0x17a)](_0x1c983a[_0x4b71fa(0x23d)],_0x1c983a);});const _0x5e03cb=new Map(),_0x3603f6=await this[_0x3a9a07(0x262)][_0x3a9a07(0xd4)](_0x3a9a07(0x110));_0x3603f6[_0x3a9a07(0x295)](_0x1099a7=>_0x5e03cb['set'](_0x1099a7[_0x3a9a07(0x23d)],_0x1099a7['count']));const _0x3cba2e=_0x55350e[_0x3a9a07(0x191)](_0x5fc7da=>{const _0xe1b7d3=_0x3a9a07;let _0x39300b=null,_0x192769=null,_0x55ad03=null,_0xc4c270=null;const _0x1a7881=_0x3d3495['get'](_0x5fc7da['id']);return _0x1a7881&&(_0x39300b=_0x1a7881[_0xe1b7d3(0x287)],_0x192769=_0x1a7881['nickname'],_0x55ad03=_0x1a7881['phone'],_0xc4c270=_0x1a7881[_0xe1b7d3(0x24b)]),{..._0x5fc7da,'username':_0x39300b,'nickname':_0x192769,'phone':_0x55ad03,'email':_0xc4c270,'userCount':_0x5e03cb[_0xe1b7d3(0x1fb)](_0x5fc7da['id'])||0x0};});return{'rows':_0x3cba2e,'count':_0x555e56};}async['getSaasById'](_0x539c52){return this['saasEntity']['findOne']({'where':{'id':_0x539c52}});}async['saasSave'](_0x3c873d){const _0x55f507=_0x5ee955,_0x3b757b=(0x0,utils_1[_0x55f507(0x172)])(this[_0x55f507(0xec)]);if(_0x3b757b!==0x0)throw new common_1[(_0x55f507(0xaf))](_0x55f507(0xdc),common_1[_0x55f507(0xd7)][_0x55f507(0xfd)]);return await this['saasEntity']['save'](_0x3c873d),this[_0x55f507(0x1a5)](),!![];}async[_0x5ee955(0x285)](_0x5ad73b){const _0x4a3664=_0x5ee955,_0x581b65=(0x0,utils_1[_0x4a3664(0x172)])(this[_0x4a3664(0xec)]);return await this[_0x4a3664(0x161)][_0x4a3664(0xbc)]({..._0x5ad73b,'id':_0x581b65}),!![];}async[_0x5ee955(0x2ad)](_0xc16a6f){const _0x330e38=_0x5ee955;if(!_0xc16a6f['ids']||!_0xc16a6f[_0x330e38(0xe7)][_0x330e38(0x1a3)])return!![];return await this[_0x330e38(0x161)][_0x330e38(0xba)]({'id':(0x0,typeorm_2['In'])(_0xc16a6f[_0x330e38(0xe7)])},{'deleteFlag':0x1}),!![];}async[_0x5ee955(0x181)](_0x477f0d,_0x29a15e){const _0x5e1bf3=_0x5ee955,_0xe58601=await(0x0,utils_1[_0x5e1bf3(0x172)])(this['clsService']),{page:page=0x1,size:size=0x14,keyword:_0x10d8d3}=_0x29a15e;let _0x1c162a=_0x5e1bf3(0xf7)+_0xe58601+_0x5e1bf3(0xcd)+Role_constant_1['ERole'][_0x5e1bf3(0x268)]+'\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20';_0x10d8d3&&(_0x1c162a=_0x5e1bf3(0x1ff)+_0xe58601+_0x5e1bf3(0xb2)+_0x10d8d3+_0x5e1bf3(0x11c)+_0x10d8d3+_0x5e1bf3(0x1d0)+Role_constant_1[_0x5e1bf3(0x282)][_0x5e1bf3(0x268)]+_0x5e1bf3(0x14c)+_0x10d8d3+_0x5e1bf3(0x11c)+_0x10d8d3+_0x5e1bf3(0x260));const _0x1d1c17=await this[_0x5e1bf3(0x262)]['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_role\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x1c162a+_0x5e1bf3(0x209)),_0x358541=await this[_0x5e1bf3(0x262)][_0x5e1bf3(0xd4)](_0x5e1bf3(0x21e)+_0x1c162a+_0x5e1bf3(0xe2)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x5e1bf3(0x209)),_0x62611a=_0x358541[_0x5e1bf3(0x191)](_0x5a1c1e=>_0x5a1c1e['id']);if(_0x62611a[_0x5e1bf3(0x1a3)]){const _0x134b4c=await this[_0x5e1bf3(0x161)][_0x5e1bf3(0x1da)]({'where':{'id':_0x477f0d[_0x5e1bf3(0xe4)]['saasId']}}),_0x270b2f=new Map(),_0x478dd9=await this[_0x5e1bf3(0x262)][_0x5e1bf3(0xd4)](_0x5e1bf3(0x263));_0x478dd9[_0x5e1bf3(0x295)](_0x40f1ab=>_0x270b2f[_0x5e1bf3(0x17a)](_0x40f1ab[_0x5e1bf3(0x143)],_0x40f1ab['count'])),_0x358541[_0x5e1bf3(0x295)](_0x268b53=>{const _0x3f483a=_0x5e1bf3;_0x268b53[_0x3f483a(0x167)]=_0x134b4c?.[_0x3f483a(0x103)]||'平台',_0x268b53[_0x3f483a(0x259)]=_0x270b2f[_0x3f483a(0x1fb)](_0x268b53['code'])||0x0;});}return{'rows':_0x358541,'count':Number(_0x1d1c17[0x0]?.[_0x5e1bf3(0x1ca)]||0x0)};}async[_0x5ee955(0x22c)](_0x9c6627,_0x393d1e){const _0x4fc4df=_0x5ee955,_0x484c57=await(0x0,utils_1[_0x4fc4df(0x172)])(this[_0x4fc4df(0xec)]);if([Role_constant_1['ERole'][_0x4fc4df(0x294)][_0x4fc4df(0xa6)](),Role_constant_1[_0x4fc4df(0x282)][_0x4fc4df(0x1de)][_0x4fc4df(0xa6)](),Role_constant_1[_0x4fc4df(0x282)][_0x4fc4df(0x268)]['valueOf']()][_0x4fc4df(0x178)](_0x393d1e[_0x4fc4df(0x1d7)])&&_0x484c57!==0x0)throw new common_1[(_0x4fc4df(0xaf))]('当前角色编码不可用，请使用其他角色编码',common_1['HttpStatus'][_0x4fc4df(0x2a6)]);return await this[_0x4fc4df(0x289)]['save']({..._0x393d1e,'saasId':_0x484c57,'disabled':_0x393d1e[_0x4fc4df(0x139)]??0x0}),!![];}async[_0x5ee955(0x16a)](_0x12bb81,_0x5e1f2f){const _0x3b0c7d=_0x5ee955,_0x18ec32=await(0x0,utils_1[_0x3b0c7d(0x172)])(this[_0x3b0c7d(0xec)]);if(!_0x5e1f2f['ids']||!_0x5e1f2f['ids'][_0x3b0c7d(0x1a3)])return!![];const _0x51e959=await this[_0x3b0c7d(0x289)][_0x3b0c7d(0x105)]({'where':{'id':(0x0,typeorm_2['In'])(_0x5e1f2f['ids']),'saasId':_0x18ec32}});if(!_0x51e959[_0x3b0c7d(0x1a3)])return!![];const _0x2c0f89=_0x51e959[_0x3b0c7d(0x191)](_0xd31645=>_0xd31645['code']),_0x4a9c5c=await this[_0x3b0c7d(0x153)][_0x3b0c7d(0x1ca)]({'where':{'role':(0x0,typeorm_2['In'])(_0x2c0f89),'saasId':_0x18ec32}});if(_0x4a9c5c>0x0)throw new common_1['HttpException'](_0x3b0c7d(0x267),common_1[_0x3b0c7d(0xd7)][_0x3b0c7d(0x2a6)]);return await this[_0x3b0c7d(0x289)][_0x3b0c7d(0x15c)]({'id':(0x0,typeorm_2['In'])(_0x5e1f2f[_0x3b0c7d(0xe7)])}),!![];}async['findByIds'](_0x58d0b0){const _0x2ada92=_0x5ee955;if(!_0x58d0b0[_0x2ada92(0x1a3)])return[];const _0x1230e3=await this[_0x2ada92(0x153)][_0x2ada92(0x105)]({'where':{'id':(0x0,typeorm_2['In'])(_0x58d0b0)}});return _0x1230e3;}async[_0x5ee955(0x182)](_0x2c11ee,_0x275c37){const _0x3f737a=_0x5ee955,{username:_0x258818,email:_0x13d1d3,password:_0x1a150c,invitedBy:_0x3c3d3c,client:client=0x0}=_0x2c11ee;if(_0x3c3d3c){const _0x4d612a=await this['userEntity'][_0x3f737a(0x1da)]({'where':{'inviteCode':_0x3c3d3c}});if(!_0x4d612a)throw new common_1[(_0x3f737a(0xaf))](_0x3f737a(0x135),common_1[_0x3f737a(0xd7)][_0x3f737a(0x2a6)]);}const _0x2993f7=[{'username':_0x258818},{'email':_0x13d1d3}],_0x3a9e7a=await this[_0x3f737a(0x153)][_0x3f737a(0x1da)]({'where':_0x2993f7});if(_0x3a9e7a&&_0x3a9e7a[_0x3f737a(0xa0)]!==user_constant_1['UserStatusEnum'][_0x3f737a(0xf0)])throw new common_1[(_0x3f737a(0xaf))]('用户名或者邮箱已被注册！',common_1['HttpStatus']['BAD_REQUEST']);try{const _0x461549=_[_0x3f737a(0x219)](_0x2c11ee),_0x3e50f6=bcrypt['hashSync'](_0x1a150c,0xa),_0x3c02dc=(0x0,utils_1['getClientIp'])(_0x275c37);_0x461549[_0x3f737a(0x228)]=_0x3e50f6,_0x461549[_0x3f737a(0x1d1)]=_0x3c02dc,_0x461549['client']=client;let _0x5f379c;if(!_0x3a9e7a){const _0x449ff7=await this[_0x3f737a(0x26c)]['getConfigByKeys']([_0x3f737a(0x204)]);_0x461549[_0x3f737a(0x1c3)]=_0x449ff7,_0x5f379c=await this[_0x3f737a(0x153)]['save'](_0x461549);}else _0x5f379c=_0x3a9e7a;const _0x103f17=await this[_0x3f737a(0x26c)]['getConfigByKeys']([_0x3f737a(0x13d),_0x3f737a(0x237),_0x3f737a(0x15a),'registerVerifyEmailDesc','registerVerifyEmailFrom',_0x3f737a(0x12a)]),_0x1f45e6=_0x103f17['isVerifyEmail']?Number(_0x103f17[_0x3f737a(0x13d)]):0x1;if(_0x1f45e6){const _0xd6a2fc=_0x103f17[_0x3f737a(0x12a)]?Number(_0x103f17['registerVerifyExpir']):0x1e*0x3c,_0x137f98=await this['verificationService'][_0x3f737a(0x27b)](_0x5f379c,verification_constant_1[_0x3f737a(0x1f9)][_0x3f737a(0x20f)],_0xd6a2fc),{code:_0x212d42,email:_0x10f520,id:_0x54c8c3}=_0x137f98,{registerVerifyEmailFrom:_0x5d89de}=_0x103f17;await this[_0x3f737a(0xeb)][_0x3f737a(0x9b)]({'to':_0x10f520,'subject':'来自'+_0x5d89de+_0x3f737a(0x28f),'template':_0x3f737a(0x1ac),'context':{'baseUrl':_0x103f17[_0x3f737a(0x237)],'code':_0x212d42,'id':_0x54c8c3,..._0x103f17}});}else{const {id:_0x405267,invitedBy:_0x2ac3c5}=_0x5f379c;await this['updateUserStatus'](_0x405267,user_constant_1[_0x3f737a(0xed)][_0x3f737a(0x221)]);let _0x1f2244;_0x2ac3c5&&(_0x1f2244=await this['qureyUserInfoByInviteCode'](_0x2ac3c5)),await this[_0x3f737a(0x1a1)](_0x5f379c,_0x1f2244);}return _0x5f379c;}catch(_0x46aaf6){console[_0x3f737a(0x1b3)](_0x3f737a(0x166),_0x46aaf6);throw _0x46aaf6;}}async['verifyUserCredentials'](_0x1961ef){const _0xe84dd=_0x5ee955,{username:_0x2068c8,password:_0xca6f90,uid:uid=0x0,phone:_0x5ecf0c}=_0x1961ef;let _0x3bd12b=null;if(uid>0x0){_0x3bd12b=await this['userEntity'][_0xe84dd(0x1da)]({'where':{'id':uid}});if(!_0x3bd12b)throw new common_1[(_0xe84dd(0xaf))](_0xe84dd(0x213),common_1[_0xe84dd(0xd7)][_0xe84dd(0x2a6)]);if(!bcrypt[_0xe84dd(0x185)](_0xca6f90,_0x3bd12b[_0xe84dd(0x228)]))throw new common_1[(_0xe84dd(0xaf))](_0xe84dd(0x21f),common_1[_0xe84dd(0xd7)]['BAD_REQUEST']);}if(_0x2068c8&&_0xca6f90){const _0x3888ea=[{'username':_0x2068c8},{'email':_0x2068c8}];_0x3bd12b=await this[_0xe84dd(0x153)][_0xe84dd(0x1da)]({'where':_0x3888ea});if(!_0x3bd12b)throw new common_1[(_0xe84dd(0xaf))](_0xe84dd(0x213),common_1[_0xe84dd(0xd7)][_0xe84dd(0x2a6)]);if(!bcrypt[_0xe84dd(0x185)](_0xca6f90,_0x3bd12b['password']))throw new common_1[(_0xe84dd(0xaf))]('当前密码错误！',common_1[_0xe84dd(0xd7)][_0xe84dd(0x2a6)]);}if(_0x5ecf0c&&_0xca6f90){const _0x2b6f30=[{'phone':_0x5ecf0c}];_0x3bd12b=await this[_0xe84dd(0x153)][_0xe84dd(0x1da)]({'where':_0x2b6f30});if(!_0x3bd12b)throw new common_1[(_0xe84dd(0xaf))](_0xe84dd(0x213),common_1[_0xe84dd(0xd7)]['BAD_REQUEST']);if(!bcrypt[_0xe84dd(0x185)](_0xca6f90,_0x3bd12b['password']))throw new common_1[(_0xe84dd(0xaf))](_0xe84dd(0x21f),common_1[_0xe84dd(0xd7)]['BAD_REQUEST']);}if(!_0x3bd12b)throw new common_1[(_0xe84dd(0xaf))]('当前账户不存在！',common_1[_0xe84dd(0xd7)][_0xe84dd(0x2a6)]);if(_0x3bd12b[_0xe84dd(0xa0)]!==user_constant_1[_0xe84dd(0xed)][_0xe84dd(0x221)])throw new common_1[(_0xe84dd(0xaf))](user_constant_1[_0xe84dd(0x174)][_0x3bd12b['status']],common_1[_0xe84dd(0xd7)][_0xe84dd(0x2a6)]);if(_0x3bd12b[_0xe84dd(0x287)]&&!_0x3bd12b[_0xe84dd(0xce)]){const _0x1152be=await this[_0xe84dd(0x29e)][_0xe84dd(0x1da)]({'where':{'username':_0x3bd12b[_0xe84dd(0x287)]}});_0x1152be&&await this[_0xe84dd(0x262)][_0xe84dd(0x293)](async()=>{const _0x532211=_0xe84dd;_0x1152be[_0x532211(0xf6)]===-0x1?_0x3bd12b[_0x532211(0xd8)]=0x1:_0x3bd12b['vipExpire']=(0x0,date_1[_0x532211(0x21a)])()['add'](_0x1152be[_0x532211(0xf6)],_0x532211(0x1b7))['toDate'](),_0x3bd12b=await this['userEntity'][_0x532211(0xbc)](_0x3bd12b),await this[_0x532211(0x29e)]['delete']({'id':_0x1152be['id']});});}return _0x3bd12b;}async['verifyUserPassword'](_0x10f326,_0x412bd8){const _0x1fd737=_0x5ee955,_0x15d89a=await this[_0x1fd737(0x153)]['findOne']({'where':{'id':_0x10f326}});return bcrypt[_0x1fd737(0x185)](_0x412bd8,_0x15d89a[_0x1fd737(0x228)]);}async[_0x5ee955(0x13e)](_0x2aed0c,_0x1d2137){const _0x9df0ee=_0x5ee955,_0x219969=await this['userEntity'][_0x9df0ee(0xba)]({'id':_0x2aed0c},{'status':_0x1d2137});return _0x219969[_0x9df0ee(0x146)]>0x0;}async['getUserStatus'](_0x3501d1){const _0x3b27fd=_0x5ee955,_0x3e465f=await this[_0x3b27fd(0x153)][_0x3b27fd(0x1da)]({'where':{'id':_0x3501d1}});return _0x3e465f[_0x3b27fd(0xa0)];}async['queryUserInfoById'](_0x33a4a3){const _0x39e161=_0x5ee955;return await this[_0x39e161(0x153)][_0x39e161(0x1da)]({'where':{'id':_0x33a4a3}});}async['queryUserInfoByIds'](_0x5118b8){const _0x42ac48=_0x5ee955;return await this['userEntity'][_0x42ac48(0x26f)]({'id':(0x0,typeorm_2['In'])(_0x5118b8)});}async[_0x5ee955(0xab)](_0x2788bd){const _0x4dcbaa=_0x5ee955;return await this[_0x4dcbaa(0x153)][_0x4dcbaa(0x1da)]({'where':{'username':_0x2788bd}});}async[_0x5ee955(0x112)](_0x27784a,_0x3e3497,_0x327a5a){const _0x47224c=_0x5ee955;return await this[_0x47224c(0x153)][_0x47224c(0xba)](_0x27784a,{'openId':_0x3e3497,'unionid':_0x327a5a});}async[_0x5ee955(0x25a)](_0x32498a,_0x560c4f,_0x312aad){const _0x14c24a=_0x5ee955;return await this[_0x14c24a(0x153)][_0x14c24a(0xba)](_0x32498a,{'miniOpenId':_0x560c4f,'unionid':_0x312aad});}async['updateUserAppOpenId'](_0x4a6453,_0x36f891,_0x35ec16){const _0x55017e=_0x5ee955;return await this[_0x55017e(0x153)][_0x55017e(0xba)](_0x4a6453,{'weAppOpenId':_0x36f891,'unionid':_0x35ec16});}async[_0x5ee955(0x20d)](_0x18bd57){const _0x4cc2a8=_0x5ee955,{id:_0x39504c,username:_0x14dc96,password:_0x5bf228}=_0x18bd57;return await this[_0x4cc2a8(0x153)][_0x4cc2a8(0xba)](_0x39504c,{'username':_0x14dc96,'password':_0x5bf228});}async[_0x5ee955(0x16c)](_0x3140d9){return await this['userEntity']['findOne']({'where':{'id':_0x3140d9}});}async[_0x5ee955(0x100)](_0x2168ae){const _0x1606ed=_0x5ee955,{id:_0x1fd087,role:_0x268503}=_0x2168ae;if(_0x268503===_0x1606ed(0x109))return!![];const _0x4af2e2=await this[_0x1606ed(0x153)][_0x1606ed(0x1da)]({'where':{'id':_0x1fd087}});if(!_0x4af2e2)throw new common_1[(_0x1606ed(0xaf))](_0x1606ed(0x9e),common_1[_0x1606ed(0xd7)][_0x1606ed(0xf3)]);if(_0x4af2e2['status']===user_constant_1[_0x1606ed(0xed)][_0x1606ed(0x12d)])throw new common_1[(_0x1606ed(0xaf))](_0x1606ed(0x21b),common_1[_0x1606ed(0xd7)][_0x1606ed(0x2a6)]);if(_0x4af2e2['status']===user_constant_1[_0x1606ed(0xed)][_0x1606ed(0x95)])throw new common_1[(_0x1606ed(0xaf))]('您的账户已被封禁、如有疑问、请联系管理员！',common_1['HttpStatus'][_0x1606ed(0x2a6)]);}async[_0x5ee955(0x1e0)](_0x1e9f68){const _0x558c87=_0x5ee955;return await this[_0x558c87(0x153)][_0x558c87(0x1da)]({'where':{'id':_0x1e9f68}});}[_0x5ee955(0x1ae)](_0x1b2c67){const _0x8969d4=_0x5ee955;return this['userEntity'][_0x8969d4(0x105)]({'where':{'id':(0x0,typeorm_2['In'])(_0x1b2c67)}});}async[_0x5ee955(0x19a)](_0x3cf092){const _0x345f60=_0x5ee955;return this[_0x345f60(0x153)][_0x345f60(0x1da)]({'where':{'inviteCode':_0x3cf092}});}async[_0x5ee955(0x1cd)](_0x25cda9){const _0x55daa6=_0x5ee955,_0x4e5781=(0x0,utils_1[_0x55daa6(0x172)])(this['clsService']);return await this[_0x55daa6(0x153)][_0x55daa6(0x1da)]({'where':{'openId':_0x25cda9,'saasId':_0x4e5781}});}async[_0x5ee955(0x10e)](_0x39e80e){const _0x215ec1=_0x5ee955,_0x297d13=(0x0,utils_1[_0x215ec1(0x172)])(this[_0x215ec1(0xec)]);return await this[_0x215ec1(0x153)][_0x215ec1(0x1da)]({'where':{'unionid':_0x39e80e,'saasId':_0x297d13}});}async[_0x5ee955(0x1c0)](_0x17b479){const _0x3df70f=_0x5ee955;return this[_0x3df70f(0x153)]['count']({'where':{'invitedBy':_0x17b479}});}async['updateInfo'](_0x8e748f,_0x266a6f){const _0x5d0ad4=_0x5ee955,{id:_0x12b290}=_0x266a6f[_0x5d0ad4(0xe4)],_0x5830fe=await this[_0x5d0ad4(0x153)][_0x5d0ad4(0x1da)]({'where':{'id':_0x12b290}});if(!_0x5830fe)throw new common_1[(_0x5d0ad4(0xaf))](_0x5d0ad4(0x277),common_1[_0x5d0ad4(0xd7)][_0x5d0ad4(0x2a6)]);if(_0x8e748f[_0x5d0ad4(0x287)]&&_0x5830fe[_0x5d0ad4(0x287)]===_0x8e748f[_0x5d0ad4(0x287)])throw new common_1[(_0x5d0ad4(0xaf))](_0x5d0ad4(0x241),common_1['HttpStatus'][_0x5d0ad4(0x2a6)]);if(_0x8e748f[_0x5d0ad4(0x287)]){const _0x349461=await this[_0x5d0ad4(0x153)][_0x5d0ad4(0x1da)]({'where':{'username':_0x8e748f[_0x5d0ad4(0x287)],'id':(0x0,typeorm_2[_0x5d0ad4(0x165)])(_0x12b290)}});if(_0x349461)throw new common_1[(_0x5d0ad4(0xaf))](_0x5d0ad4(0x206),common_1[_0x5d0ad4(0xd7)][_0x5d0ad4(0x2a6)]);}const _0x249d16=await this[_0x5d0ad4(0x153)][_0x5d0ad4(0xba)]({'id':_0x12b290},_0x8e748f);if(_0x249d16[_0x5d0ad4(0x146)]<=0x0)throw new common_1[(_0x5d0ad4(0xaf))](_0x5d0ad4(0x1fc),common_1[_0x5d0ad4(0xd7)][_0x5d0ad4(0x2a6)]);return _0x5d0ad4(0x1e1);}async['updateUserPassword'](_0x1f3e0d,_0x1a00d5){const _0x139b90=_0x5ee955,_0x48e609=bcrypt[_0x139b90(0x272)](_0x1a00d5,0xa),_0x2d6366=await this[_0x139b90(0x153)][_0x139b90(0xba)]({'id':_0x1f3e0d},{'password':_0x48e609});if(_0x2d6366[_0x139b90(0x146)]<=0x0)throw new common_1[(_0x139b90(0xaf))](_0x139b90(0x16b),common_1['HttpStatus'][_0x139b90(0x2a6)]);}async['favorite'](_0x21f7b1,_0x168d19){const _0x54ed0e=_0x5ee955;try{const _0x5d4922=await this[_0x54ed0e(0x29d)][_0x54ed0e(0x1da)]({'where':{'userId':_0x21f7b1[_0x54ed0e(0xe4)]['id'],'relateId':_0x168d19[_0x54ed0e(0x152)],'relateType':_0x168d19['relateType']}});return _0x5d4922?await this[_0x54ed0e(0x29d)][_0x54ed0e(0x15c)]({'id':_0x5d4922['id']}):await this[_0x54ed0e(0x29d)][_0x54ed0e(0xbc)]({'userId':_0x21f7b1['user']['id'],'relateId':_0x168d19['relateId'],'relateType':_0x168d19[_0x54ed0e(0x21d)]}),!![];}catch(_0x5d70e3){throw new common_1[(_0x54ed0e(0xaf))](_0x5d70e3['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x5ee955(0x13c)](_0x2ea01a,_0x1ce10a,_0x5c4188){const _0x1f5c2c=_0x5ee955;return this[_0x1f5c2c(0x29d)][_0x1f5c2c(0x105)]({'where':{'userId':_0x2ea01a,'relateType':_0x1ce10a,'relateId':(0x0,typeorm_2['In'])(_0x5c4188)}});}async[_0x5ee955(0x91)](_0x185ddc){const _0x3268d0=_0x5ee955,{id:_0x4ee624}=_0x185ddc['user'],_0x21c8d4=await this['userEntity']['findOne']({'where':{'id':_0x4ee624}});if(!_0x21c8d4||_0x21c8d4[_0x3268d0(0x291)])throw new common_1[(_0x3268d0(0xaf))](_0x3268d0(0x164),common_1['HttpStatus'][_0x3268d0(0x2a6)]);const _0x348b04=(0x0,utils_1['generateRandomString'])(),_0x2bf6c5=await this[_0x3268d0(0x153)][_0x3268d0(0x1da)]({'where':{'inviteCode':_0x348b04}});if(_0x2bf6c5)throw new common_1[(_0x3268d0(0xaf))](_0x3268d0(0x8c),common_1['HttpStatus']['BAD_REQUEST']);const _0x6eba6a=await this[_0x3268d0(0x153)][_0x3268d0(0xba)]({'id':_0x4ee624},{'inviteCode':_0x348b04});if(_0x6eba6a[_0x3268d0(0x146)]<=0x0)throw new common_1[(_0x3268d0(0xaf))](_0x3268d0(0x8c),common_1[_0x3268d0(0xd7)][_0x3268d0(0x2a6)]);return _0x348b04;}async[_0x5ee955(0x17c)](_0x5cb2b6,_0x23cb68){const _0x4510c3=_0x5ee955;try{const {id:_0x3d9418}=_0x5cb2b6[_0x4510c3(0xe4)],{page:page=0x1,size:size=0xa}=_0x23cb68,_0x429766=await this[_0x4510c3(0x153)]['findOne']({'where':{'id':_0x3d9418}}),{inviteCode:_0x436bd1}=_0x429766;if(!_0x436bd1)return[];const [_0x48fa28,_0x2aeb0a]=await this[_0x4510c3(0x153)][_0x4510c3(0x27d)]({'where':{'inviteCode':_0x436bd1},'order':{'id':_0x4510c3(0x125)},'select':[_0x4510c3(0x287),_0x4510c3(0x24b),_0x4510c3(0x2a4),_0x4510c3(0xa0),_0x4510c3(0x1c3)],'take':size,'skip':(page-0x1)*size});return(0x0,utils_1[_0x4510c3(0x16e)])(_0x48fa28)[_0x4510c3(0x191)](_0x16d282=>{const _0x98256=_0x4510c3;return _0x16d282['email']=(0x0,utils_1[_0x98256(0xda)])(_0x16d282[_0x98256(0x24b)]),_0x16d282;}),{'rows':_0x48fa28,'count':_0x2aeb0a};}catch(_0x1c3fc8){console[_0x4510c3(0x1b3)](_0x4510c3(0x166),_0x1c3fc8);throw new common_1['HttpException'](_0x4510c3(0xc2),common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x5ee955(0x12b)](_0x202031,_0x36220a,_0x79cbc1){const _0x15c6f8=_0x5ee955,_0x33f61b=(0x0,utils_1[_0x15c6f8(0x172)])(this['clsService']),{page:page=0x1,size:size=0x14,startTime:_0x37ee5b,endTime:_0x2e4f2e,saasId:_0x5de08f,keyword:_0x5f3633,inviterKeyword:_0x123c04}=_0x36220a,_0x253dce=_0x15c6f8(0xca)+(_0x79cbc1?_0x15c6f8(0x17d)+_0x79cbc1:'')+_0x15c6f8(0x25c)+(_0x2e4f2e?_0x15c6f8(0x157)+_0x2e4f2e+'\x27':'')+_0x15c6f8(0x25c)+(_0x37ee5b?'\x20AND\x20u.createdAt\x20>=\x20\x27'+_0x37ee5b+'\x27':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x33f61b!==0x0?_0x15c6f8(0x94)+_0x33f61b:(0x0,utils_1[_0x15c6f8(0x197)])(_0x5de08f)?_0x15c6f8(0x94)+_0x5de08f:'')+_0x15c6f8(0x25c)+(_0x5f3633?_0x15c6f8(0x1a4)+_0x5f3633+_0x15c6f8(0x247)+_0x5f3633+_0x15c6f8(0x199)+_0x5f3633+_0x15c6f8(0x1a7)+_0x5f3633+_0x15c6f8(0x270):'')+_0x15c6f8(0x25c)+(_0x123c04?_0x15c6f8(0x28c)+_0x123c04+_0x15c6f8(0xe8)+_0x123c04+_0x15c6f8(0xe1)+_0x123c04+_0x15c6f8(0x216)+_0x123c04+_0x15c6f8(0x270):'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x18daf8=_0x15c6f8(0x292)+_0x253dce+_0x15c6f8(0x209),_0x77d869=_0x15c6f8(0x22f)+_0x253dce+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20'+size+'\x20OFFSET\x20'+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20',_0x521751=await this[_0x15c6f8(0x262)][_0x15c6f8(0xd4)](_0x18daf8),_0x3984f9=await this['connection'][_0x15c6f8(0xd4)](_0x77d869);return!(0x0,utils_1['isSuper'])(this[_0x15c6f8(0xec)])&&_0x3984f9[_0x15c6f8(0x295)](_0x2542f0=>{const _0xa3bea3=_0x15c6f8;_0x2542f0[_0xa3bea3(0xdf)]=(0x0,utils_1[_0xa3bea3(0x117)])(_0x2542f0[_0xa3bea3(0xdf)]),_0x2542f0[_0xa3bea3(0x24b)]=(0x0,utils_1[_0xa3bea3(0x117)])(_0x2542f0[_0xa3bea3(0x24b)]),_0x2542f0[_0xa3bea3(0x200)]=(0x0,utils_1[_0xa3bea3(0x117)])(_0x2542f0[_0xa3bea3(0x200)]),_0x2542f0['inviterEmail']=(0x0,utils_1['hideString'])(_0x2542f0[_0xa3bea3(0xae)]);}),{'rows':_0x3984f9,'count':Number(_0x521751[0x0]?.[_0x15c6f8(0x1ca)]||0x0)};}async['inviteLink'](_0xe4e079){const _0x33929a=_0x5ee955,_0x2da4a8=await this[_0x33929a(0x153)][_0x33929a(0x1da)]({'where':{'inviteCode':_0xe4e079}});if(!_0x2da4a8)return 0x1;const {inviteLinkCount:inviteLinkCount=0x0}=_0x2da4a8,_0x2459df=await this[_0x33929a(0x153)][_0x33929a(0xba)]({'inviteCode':_0xe4e079},{'inviteLinkCount':inviteLinkCount+0x1});return _0x2459df['affected']?0x1:0x0;}async['qureyUserInfoByInviteCode'](_0x2f42f6){const _0x20a923=_0x5ee955;return await this[_0x20a923(0x153)][_0x20a923(0x1da)]({'where':{'inviteCode':_0x2f42f6}});}async[_0x5ee955(0x9d)](_0x8899c6,_0x11b798){const _0xc15512=_0x5ee955,_0x3b665b=(0x0,utils_1[_0xc15512(0x172)])(this[_0xc15512(0xec)]);let {page:page=0x1,size:size=0xa,username:_0x4e6980,phone:_0x17c3a2,email:_0x256877,status:_0x216689,keyword:_0x1532e4,roleCode:_0x1dcee1,vip:_0x16f023,saasId:_0x3cc0bf}=_0x8899c6,_0x5b2468=_0xc15512(0xe6);_0x216689&&(_0x5b2468=_0x5b2468+(_0xc15512(0x92)+_0x216689));_0x1dcee1&&(_0x5b2468=_0x5b2468+('\x20AND\x20role\x20=\x20\x27'+_0x1dcee1+'\x27'));_0x16f023&&(_0x16f023=Number(_0x16f023));if(_0x16f023===0x1)_0x5b2468=_0x5b2468+_0xc15512(0x1b1);else _0x16f023===0x0&&(_0x5b2468=_0x5b2468+_0xc15512(0x1f2));_0x1532e4?_0x5b2468=_0x5b2468+(_0xc15512(0x1bc)+_0x1532e4+'%\x27\x20OR\x20nickname\x20LIKE\x20\x27%'+_0x1532e4+_0xc15512(0x116)+_0x1532e4+'%\x27\x20OR\x20email\x20LIKE\x20\x27%'+_0x1532e4+_0xc15512(0x26a)+_0x1532e4+'\x27)'):(_0x4e6980&&(_0x5b2468=_0x5b2468+(_0xc15512(0xe5)+_0x4e6980+'%\x27')),_0x256877&&(_0x5b2468=_0x5b2468+(_0xc15512(0x22e)+_0x256877+'%\x27')),_0x17c3a2&&(_0x5b2468=_0x5b2468+(_0xc15512(0x27e)+_0x17c3a2+'%\x27')));(0x0,utils_1[_0xc15512(0x145)])(this['clsService'])?(0x0,utils_1['isManage'])(this[_0xc15512(0xec)])&&_0x3cc0bf&&(_0x5b2468=_0x5b2468+(_0xc15512(0x273)+_0x3cc0bf)):_0x5b2468=_0x5b2468+(_0xc15512(0x273)+_0x3b665b);const _0x5d951b=await this[_0xc15512(0x262)][_0xc15512(0xd4)](_0xc15512(0x1b6)+_0x5b2468+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x3f8142=await this[_0xc15512(0x262)]['query'](_0xc15512(0xc6)+_0x5b2468+'\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20'+size+'\x20OFFSET\x20'+(page-0x1)*size+_0xc15512(0x209)),_0xb23915=[],_0x9235f4=(0x0,utils_1[_0xc15512(0x9f)])(this['clsService']),_0x48a367=new Map([[Role_constant_1['ERole'][_0xc15512(0x1de)],'代理商'],[Role_constant_1[_0xc15512(0x282)]['SUPER'],_0xc15512(0x284)],[Role_constant_1[_0xc15512(0x282)][_0xc15512(0x268)],_0xc15512(0xb6)]]);for(let _0x4b9c26=0x0;_0x4b9c26<_0x3f8142[_0xc15512(0x1a3)];_0x4b9c26++){const _0x323e4b=_0x3f8142[_0x4b9c26];let _0xfbcd16=_0xc15512(0xb6);if(_0x48a367['has'](_0x323e4b['role']))_0xfbcd16=_0x48a367[_0xc15512(0x1fb)](_0x323e4b[_0xc15512(0x143)]);else{const _0x1cf9a8=await this[_0xc15512(0x289)]['findOne']({'where':{'code':_0x323e4b['role'],'saasId':_0x323e4b[_0xc15512(0x23d)]}});_0xfbcd16=_0x1cf9a8[_0xc15512(0x103)];}_0xb23915[_0xc15512(0x1f4)]({..._0x323e4b,'roleName':_0xfbcd16,'isBindWx':!!_0x323e4b?.['openId'],'password':_0x323e4b[_0xc15512(0x228)]?_0xc15512(0x113):'no','email':_0x9235f4?_0x323e4b[_0xc15512(0x24b)]:(0x0,utils_1['maskEmail'])(_0x323e4b[_0xc15512(0x24b)]),'phone':_0x9235f4?_0x323e4b[_0xc15512(0xdf)]:(0x0,utils_1[_0xc15512(0xda)])(_0x323e4b[_0xc15512(0xdf)]),'lastLoginIp':_0x9235f4?_0x323e4b[_0xc15512(0xce)]:(0x0,utils_1[_0xc15512(0x1d4)])(_0x323e4b[_0xc15512(0xce)])});}return{'rows':_0xb23915,'count':Number(_0x5d951b[0x0]?.['count']||0x0)};}async[_0x5ee955(0x251)](_0x2cf38c){const _0x111046=_0x5ee955,{page:page=0x1,size:size=0xa,username:_0x520910,status:_0xa80794}=_0x2cf38c;let _0x9221e3={};_0x520910&&Object['assign'](_0x9221e3,{'username':(0x0,typeorm_2[_0x111046(0x149)])('%'+_0x520910+'%')}),_0xa80794&&Object['assign'](_0x9221e3,{'status':_0xa80794});const [_0x242434,_0x357172]=await this[_0x111046(0x153)][_0x111046(0x27d)]({'skip':(page-0x1)*size,'where':_0x9221e3,'take':size,'cache':!![],'order':{'createdAt':'DESC'},'select':['username',_0x111046(0x228),_0x111046(0x143),_0x111046(0xa0),'id']});return{'rows':_0x242434,'count':_0x357172};}async[_0x5ee955(0x1f3)]({id:_0xb4aa10}){const _0x28b933=_0x5ee955;let _0x45b105,_0x19c166;const _0x397524=await this[_0x28b933(0x153)]['findOne']({'where':{'id':_0xb4aa10}});if(!_0x397524)throw new common_1[(_0x28b933(0xaf))](_0x28b933(0x20a),common_1[_0x28b933(0xd7)][_0x28b933(0xf3)]);if((0x0,utils_1[_0x28b933(0x140)])(_0x397524[_0x28b933(0x143)])){const _0x2d3e81=_0x397524['role']===Role_constant_1[_0x28b933(0x282)][_0x28b933(0x1de)]?0x0:_0x397524['saasId'],_0x4020a5=await this['roleEntity'][_0x28b933(0x1da)]({'where':{'code':_0x397524[_0x28b933(0x143)],'saasId':_0x2d3e81}});if(!_0x4020a5)throw new common_1['HttpException'](_0x28b933(0x279),common_1[_0x28b933(0xd7)]['BAD_REQUEST']);_0x45b105=_0x4020a5[_0x28b933(0x249)],_0x19c166=_0x4020a5[_0x28b933(0xac)];}return{..._0x397524,'access':_0x45b105,'accessLabel':_0x19c166,'isBindWx':!!_0x397524?.[_0x28b933(0x1ec)],'password':_0x397524['password']?_0x28b933(0x113):'no'};}async[_0x5ee955(0x1e8)](_0x196d83){const _0x8699be=_0x5ee955;return await this[_0x8699be(0x153)][_0x8699be(0x1da)]({'where':{'username':_0x196d83}});}async[_0x5ee955(0x19d)](_0x3611ab){const _0x3a72b6=_0x5ee955,{id:_0xbd1b24,status:_0x4b5080}=_0x3611ab,_0x549741=await this[_0x3a72b6(0x153)][_0x3a72b6(0x1da)]({'where':{'id':_0xbd1b24}});if(!_0x549741)throw new common_1['HttpException'](_0x3a72b6(0x15b),common_1[_0x3a72b6(0xd7)][_0x3a72b6(0x2a6)]);if(_0x549741[_0x3a72b6(0x143)]===Role_constant_1[_0x3a72b6(0x282)][_0x3a72b6(0x294)])throw new common_1[(_0x3a72b6(0xaf))](_0x3a72b6(0x162),common_1[_0x3a72b6(0xd7)]['BAD_REQUEST']);if(_0x549741[_0x3a72b6(0xa0)]===user_constant_1[_0x3a72b6(0xed)][_0x3a72b6(0xf0)])throw new common_1['HttpException'](_0x3a72b6(0x26e),common_1[_0x3a72b6(0xd7)][_0x3a72b6(0x2a6)]);if(_0x4b5080===user_constant_1[_0x3a72b6(0xed)][_0x3a72b6(0xf0)])throw new common_1[(_0x3a72b6(0xaf))](_0x3a72b6(0xf8),common_1[_0x3a72b6(0xd7)][_0x3a72b6(0x2a6)]);const _0x16fe38=await this['userEntity'][_0x3a72b6(0xba)]({'id':_0xbd1b24},{'status':_0x4b5080});if(_0x16fe38[_0x3a72b6(0x146)]<=0x0)throw new common_1[(_0x3a72b6(0xaf))](_0x3a72b6(0x255),common_1[_0x3a72b6(0xd7)][_0x3a72b6(0x2a6)]);return _0x3a72b6(0x15e);}async[_0x5ee955(0x232)](_0x37539e){const _0x1f4f98=_0x5ee955,{id:_0x2d6a96}=_0x37539e,_0x45e089=await this[_0x1f4f98(0x153)]['findOne']({'where':{'id':_0x2d6a96}});if(!_0x45e089)throw new common_1[(_0x1f4f98(0xaf))](_0x1f4f98(0x15b),common_1[_0x1f4f98(0xd7)][_0x1f4f98(0x2a6)]);if(_0x45e089['role']===Role_constant_1[_0x1f4f98(0x282)]['SUPER'])throw new common_1['HttpException']('超级管理员不可被操作！',common_1[_0x1f4f98(0xd7)][_0x1f4f98(0x2a6)]);const _0x29fe29=await this[_0x1f4f98(0x153)]['save'](_0x37539e);return _0x1f4f98(0x15e);}async[_0x5ee955(0x280)](_0x2aa317){const _0x4090fc=_0x5ee955,{id:_0x520987,role:_0x247b60}=_0x2aa317,_0x4865cb=await this[_0x4090fc(0x153)][_0x4090fc(0xba)]({'id':_0x520987},{'role':_0x247b60});if(_0x4865cb[_0x4090fc(0x146)]<=0x0)throw new common_1[(_0x4090fc(0xaf))](_0x4090fc(0x193),common_1[_0x4090fc(0xd7)][_0x4090fc(0x2a6)]);return _0x4090fc(0x1f7);}async[_0x5ee955(0x10b)](_0x4d8daa){const _0x360d62=_0x5ee955,{id:_0x46118a}=_0x4d8daa,_0x5e672e=await this[_0x360d62(0x153)]['findOne']({'where':{'id':_0x46118a}});if(!_0x5e672e)throw new common_1['HttpException'](_0x360d62(0x15b),common_1[_0x360d62(0xd7)]['BAD_REQUEST']);const _0x1ecb56=_0x360d62(0x13a),_0x141ded=bcrypt['hashSync'](_0x1ecb56,0xa),_0x1cbfeb=await this['userEntity'][_0x360d62(0xba)]({'id':_0x46118a},{'password':_0x141ded});if(_0x1cbfeb[_0x360d62(0x146)]<=0x0)throw new common_1[(_0x360d62(0xaf))](_0x360d62(0x10f),common_1['HttpStatus'][_0x360d62(0x2a6)]);return _0x360d62(0x1a8)+_0x1ecb56+_0x360d62(0x24c);}async[_0x5ee955(0xa5)](_0x3b3723,_0x12f517){const _0x465703=_0x5ee955;return await this[_0x465703(0x153)][_0x465703(0xba)]({'id':_0x3b3723},{'lastLoginIp':_0x12f517});}async[_0x5ee955(0x2a8)](_0x1816c2,_0x2e21fe,_0x473790){const _0x3bb807=_0x5ee955;try{const _0x5d941b=await this['userEntity'][_0x3bb807(0x1da)]({'where':{'id':_0x473790}});if(!_0x5d941b)return{'status':![],'msg':_0x3bb807(0x217)};if(_0x2e21fe){const _0x4e07fc=await this[_0x3bb807(0x153)]['findOne']({'where':{'unionid':_0x2e21fe}});if(_0x4e07fc)return{'status':![],'msg':'该微信已绑定其他账号！'};}const _0x3fabee=await this[_0x3bb807(0x153)]['findOne']({'where':{'openId':_0x1816c2}});if(_0x3fabee)return{'status':![],'msg':'该微信已绑定其他账号！'};const _0x4f4498=await this[_0x3bb807(0x153)][_0x3bb807(0xba)]({'id':_0x473790},{'openId':_0x1816c2});if(_0x4f4498['affected']<=0x0)return{'status':![],'msg':_0x3bb807(0xc0)};return{'status':!![],'msg':_0x3bb807(0x128)};}catch(_0x1d41e2){return{'status':![],'msg':_0x3bb807(0xc0)};}}async[_0x5ee955(0x104)](_0x2eb892){const _0x5194d6=_0x5ee955,_0x30030d=await this[_0x5194d6(0x153)][_0x5194d6(0x1da)]({'where':{'id':_0x2eb892}});return _0x30030d?.[_0x5194d6(0x1ec)];}async[_0x5ee955(0x168)](_0x4d6ba9){const _0x55d4b3=_0x5ee955,_0x2463c6=await this[_0x55d4b3(0x153)]['findOne']({'where':{'id':_0x4d6ba9}});return _0x2463c6?.['miniOpenId'];}async[_0x5ee955(0x1e5)](_0x17ba62){const _0x5310b1=_0x5ee955,{username:_0x144d79,password:_0x2f241a,phone:_0x3d8942,phoneCode:_0x24c14f}=_0x17ba62,_0x1267bc=await this['userEntity'][_0x5310b1(0x1da)]({'where':[{'username':_0x144d79},{'phone':_0x3d8942}]});if(_0x1267bc&&_0x1267bc[_0x5310b1(0x287)]===_0x144d79)throw new common_1['HttpException']('用户名已存在、请更换用户名！',common_1[_0x5310b1(0xd7)][_0x5310b1(0x2a6)]);if(_0x1267bc&&_0x1267bc['phone']===_0x3d8942)throw new common_1[(_0x5310b1(0xaf))](_0x5310b1(0xa8),common_1[_0x5310b1(0xd7)][_0x5310b1(0x2a6)]);}async['createUser'](_0x19c525){const _0x4e1c85=_0x5ee955,_0x595a4b=(0x0,utils_1[_0x4e1c85(0x172)])(this[_0x4e1c85(0xec)]);if(_0x19c525['role']!==Role_constant_1[_0x4e1c85(0x282)][_0x4e1c85(0x1de)])_0x19c525[_0x4e1c85(0x23d)]=_0x595a4b;else{if(!_0x19c525['saasId'])throw new common_1[(_0x4e1c85(0xaf))](_0x4e1c85(0x20c),common_1['HttpStatus'][_0x4e1c85(0x2a6)]);}return await this[_0x4e1c85(0x153)][_0x4e1c85(0xbc)](_0x19c525);}async[_0x5ee955(0xb9)](_0x1c1cba){const _0x24351a=_0x5ee955,{id:_0x22fc5e,moreId:_0x13d869}=_0x1c1cba;if(_0x22fc5e)return await this['userEntity']['delete']({'id':_0x22fc5e});if(_0x13d869)return await this[_0x24351a(0x153)]['delete']({'id':(0x0,typeorm_2['MoreThan'])(_0x13d869)});}async[_0x5ee955(0x10a)](_0x97fcd0){const _0x41be94=_0x5ee955,_0x248da8=_0x97fcd0[_0x41be94(0xe4)]['id'];return await this[_0x41be94(0x153)][_0x41be94(0x15c)]({'id':_0x248da8})['then'](_0x2fdb44=>_0x2fdb44[_0x41be94(0x146)]>0x0);}async[_0x5ee955(0x240)](_0x22f04f,_0x2d93e0){const _0x304589=_0x5ee955;try{if(!_0x22f04f[_0x304589(0x287)]&&!_0x22f04f['phone']&&!_0x22f04f[_0x304589(0x24b)])throw new Error(_0x304589(0xea));if(_0x22f04f[_0x304589(0x287)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x304589(0x1af)](_0x22f04f['username']))throw new Error(_0x304589(0x192));if(!_0x22f04f[_0x304589(0x228)])throw new Error(_0x304589(0x1c9));}if(_0x22f04f[_0x304589(0xdf)]){if(!(0x0,class_validator_1[_0x304589(0xd1)])(_0x22f04f[_0x304589(0xdf)],_0x304589(0x11f)))throw new Error(_0x304589(0x290));}if(_0x22f04f['email']){if(!(0x0,class_validator_1[_0x304589(0x236)])(_0x22f04f[_0x304589(0x24b)]))throw new Error(_0x304589(0x118));}if(_0x22f04f[_0x304589(0x287)]){const _0x30e48f=await this[_0x304589(0x153)][_0x304589(0x274)]({'where':{'username':_0x22f04f[_0x304589(0x287)]}});if(_0x30e48f)throw new Error(_0x304589(0x1dd));}if(_0x22f04f[_0x304589(0xdf)]){const _0x58f5c6=await this[_0x304589(0x153)]['exists']({'where':{'phone':_0x22f04f['phone']}});if(_0x58f5c6)throw new Error(_0x304589(0x29f));}if(_0x22f04f[_0x304589(0x24b)]){const _0x5ec8ff=await this[_0x304589(0x153)]['exists']({'where':{'email':_0x22f04f['email']}});if(_0x5ec8ff)throw new Error('邮箱已被使用！');}const _0x3c7bec=new user_entity_1[(_0x304589(0xb5))]();for(let _0x217ec6 in _0x22f04f){_0x22f04f[_0x217ec6]&&(_0x3c7bec[_0x217ec6]=_0x22f04f[_0x217ec6]);}return _0x3c7bec['password']&&(_0x3c7bec[_0x304589(0x228)]=bcrypt['hashSync'](_0x22f04f[_0x304589(0x228)],0xa)),_0x3c7bec[_0x304589(0xa0)]=user_constant_1['UserStatusEnum'][_0x304589(0x221)],!_0x3c7bec[_0x304589(0x1fd)]&&(_0x3c7bec[_0x304589(0x1fd)]=_0x3c7bec['nickname']||'小智'),!_0x3c7bec[_0x304589(0x1c3)]&&(_0x3c7bec[_0x304589(0x1c3)]=await this[_0x304589(0x26c)][_0x304589(0x1bb)]([_0x304589(0x204)])),await this[_0x304589(0x1f8)](_0x3c7bec),!![];}catch(_0x29e6a3){throw new common_1[(_0x304589(0xaf))](_0x29e6a3[_0x304589(0xdb)],common_1[_0x304589(0xd7)][_0x304589(0x2a6)]);}}[_0x5ee955(0x180)](){const _0xd6ebe9=_0x5ee955;let _0x4e50ef=_0xd6ebe9(0x169);const _0x7ae426=[0x0,0x1,0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,'-','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];for(let _0x2c0696=0x0;_0x2c0696<0xa;_0x2c0696++){_0x4e50ef=_0x4e50ef+_0x7ae426[Math[_0xd6ebe9(0x15f)](Math['random']()*0x3f)];}return _0x4e50ef;}async[_0x5ee955(0x22a)](_0xcf59){const _0x4b06c2=_0x5ee955;let _0x579b68=[];for(let _0xbade88=0x0;_0xbade88<_0xcf59;_0xbade88++){_0x579b68[_0x4b06c2(0x1f4)](this[_0x4b06c2(0x180)]());}const _0x5bc741=await this[_0x4b06c2(0x153)][_0x4b06c2(0x105)]({'where':{'username':(0x0,typeorm_2['In'])(_0x579b68)}});if(!_0x5bc741[_0x4b06c2(0x1a3)])return _0x579b68;else{const _0x2a93ab=new Set(_0x5bc741[_0x4b06c2(0x191)](_0x53785c=>_0x53785c[_0x4b06c2(0x287)]));_0x579b68=_0x579b68[_0x4b06c2(0x1fa)](_0x494cd8=>!_0x2a93ab[_0x4b06c2(0x136)](_0x494cd8));const _0x952b3f=await this[_0x4b06c2(0x22a)](_0x2a93ab[_0x4b06c2(0x20b)]);return _0x579b68=_0x579b68['concat'](_0x952b3f),_0x579b68;}}async[_0x5ee955(0x1e3)](_0x487c72,_0x45696f){const _0x11c8c1=_0x5ee955;let _0x17c703='';_0x17c703=_0x11c8c1(0x288);const _0x528c83=await this[_0x11c8c1(0x22a)](_0x487c72[_0x11c8c1(0x1d6)]),_0x171d7d=[],_0x3162df=[],_0xe798e1=await this[_0x11c8c1(0x26c)]['getConfigByKeys'](['userDefautlAvatar']);for(let _0x49a413=0x0;_0x49a413<_0x487c72['num'];_0x49a413++){const _0x2aa006=new user_entity_1[(_0x11c8c1(0xb5))]();_0x2aa006[_0x11c8c1(0xa0)]=0x1,_0x2aa006[_0x11c8c1(0x1c3)]=_0xe798e1,_0x2aa006[_0x11c8c1(0x287)]=_0x528c83[_0x49a413],_0x2aa006['nickname']=_0x528c83[_0x49a413],_0x2aa006['password']=bcrypt[_0x11c8c1(0x272)](_0x11c8c1(0x248),0xa),_0x17c703=_0x17c703+(_0x528c83[_0x49a413]+'\x09mj123456admin\x0a'),_0x487c72[_0x11c8c1(0xf4)]&&(_0x2aa006[_0x11c8c1(0xf4)]=Number(_0x487c72['vipLeavelId'])),_0x487c72['vipLeavelName']&&(_0x2aa006[_0x11c8c1(0x224)]=_0x487c72[_0x11c8c1(0x224)]),_0x487c72[_0x11c8c1(0xfe)]&&(_0x2aa006[_0x11c8c1(0xfe)]=_0x487c72['score']),_0x487c72[_0x11c8c1(0xf6)]&&_0x3162df[_0x11c8c1(0x1f4)]({'username':_0x528c83[_0x49a413],'vipDays':_0x487c72[_0x11c8c1(0xf6)]}),_0x171d7d[_0x11c8c1(0x1f4)](_0x2aa006);}try{return await this[_0x11c8c1(0x262)][_0x11c8c1(0x293)](async()=>{const _0x582689=_0x11c8c1;await this[_0x582689(0x153)][_0x582689(0xbc)](_0x171d7d),await this[_0x582689(0x29e)]['save'](_0x3162df);}),_0x17c703;}catch(_0x80a02d){throw new common_1[(_0x11c8c1(0xaf))](_0x80a02d['message'],axios_1[_0x11c8c1(0x8f)][_0x11c8c1(0x17b)]);}}async[_0x5ee955(0x99)](_0x39ad7e,_0x4e7adb){const _0x2608d2=_0x5ee955,_0x4c1701=await this[_0x2608d2(0x153)][_0x2608d2(0x1da)]({'where':{'id':_0x4e7adb['userId']}});await this[_0x2608d2(0x153)][_0x2608d2(0x220)]({'id':_0x4c1701['id']},_0x2608d2(0xfe),_0x4e7adb[_0x2608d2(0xfe)]),await this[_0x2608d2(0xe0)]['insertAccountLog']({'userId':_0x4c1701['id'],'rawScore':_0x4c1701[_0x2608d2(0xfe)],'newScore':_0x4c1701[_0x2608d2(0xfe)]+_0x4e7adb[_0x2608d2(0xfe)],'changeScore':_0x4e7adb[_0x2608d2(0xfe)],'changeType':balance_constant_1['EChangeType'][_0x2608d2(0x96)],'rebateUserId':_0x39ad7e['user']['id'],'description':'管理员赠送'});}async['giftVip'](_0x35f4ab,_0x4296a4){const _0x43d820=_0x5ee955,_0x11a230=await this[_0x43d820(0x153)][_0x43d820(0x1da)]({'where':{'id':_0x4296a4[_0x43d820(0x266)]}});return await this[_0x43d820(0xb8)](_0x11a230,balance_constant_1[_0x43d820(0x29a)][_0x43d820(0x96)],_0x4296a4[_0x43d820(0x11a)],_0x43d820(0x163),_0x35f4ab[_0x43d820(0xe4)]['id']),!![];}async[_0x5ee955(0x2b2)](_0x1c5017){const _0x17a9be=_0x5ee955,_0x3ef959=await this[_0x17a9be(0x29e)][_0x17a9be(0x1da)]({'where':{'username':_0x1c5017[_0x17a9be(0x287)]}});_0x3ef959&&await this['connection'][_0x17a9be(0x293)](async()=>{const _0x5d53f9=_0x17a9be;_0x3ef959[_0x5d53f9(0xf6)]===-0x1?_0x1c5017['lifetimeVip']=0x1:_0x1c5017[_0x5d53f9(0x1a9)]=(0x0,date_1[_0x5d53f9(0x21a)])()[_0x5d53f9(0x211)](_0x3ef959['vipDays'],_0x5d53f9(0x1b7))[_0x5d53f9(0x261)](),_0x1c5017=await this[_0x5d53f9(0x153)][_0x5d53f9(0xbc)](_0x1c5017),await this['userInitVipEntity'][_0x5d53f9(0x15c)]({'id':_0x3ef959['id']});});}async[_0x5ee955(0x24d)](_0x4740d4,_0x46184a){const _0x45b3cd=_0x5ee955;await this[_0x45b3cd(0x153)][_0x45b3cd(0xba)]({'id':_0x4740d4},{'consecutiveDays':_0x46184a});}async[_0x5ee955(0x101)](_0x10e833){const _0x547218=_0x5ee955,_0x395178=await this[_0x547218(0x1e0)](_0x10e833);_0x395178[_0x547218(0x205)]=_0x395178[_0x547218(0x205)]+0x1,await this['userEntity'][_0x547218(0xbc)](_0x395178);}async['changeScore4registe'](_0x24bd0d,_0x10a854){const _0x481bb4=_0x5ee955,_0x4ac603=await this['globalConfigService'][_0x481bb4(0x1bb)]([_0x481bb4(0x276),'registerRewards','inviteSendStatus',_0x481bb4(0x188),_0x481bb4(0x298),'invitedRewards',_0x481bb4(0xd9)]),_0xf61d0d={};for(let _0x1bad3e in _0x4ac603){const _0x33a220=Number(_0x4ac603[_0x1bad3e]),_0x3a8662=Number[_0x481bb4(0x239)](_0x33a220)&&_0x33a220>0x0?_0x33a220:0x0;_0xf61d0d[_0x1bad3e]=_0x3a8662;}_0xf61d0d[_0x481bb4(0x276)]&&(await this[_0x481bb4(0x153)][_0x481bb4(0xba)]({'id':_0x24bd0d['id']},{'score':_0xf61d0d[_0x481bb4(0x250)]}),await this[_0x481bb4(0xe0)][_0x481bb4(0x275)]({'userId':_0x24bd0d['id'],'rawScore':0x0,'newScore':_0xf61d0d[_0x481bb4(0x250)],'changeScore':_0xf61d0d[_0x481bb4(0x250)],'changeType':balance_constant_1[_0x481bb4(0x29a)][_0x481bb4(0x1f6)],'description':'注册赠送'}));if(_0x10a854&&_0xf61d0d[_0x481bb4(0x2a0)]){_0xf61d0d[_0x481bb4(0x188)]&&(await this['userEntity']['increment']({'id':_0x10a854['id']},_0x481bb4(0xfe),_0xf61d0d['inviteRewards']),await this['userBalanceService'][_0x481bb4(0x275)]({'userId':_0x10a854['id'],'rawScore':_0x10a854[_0x481bb4(0xfe)],'newScore':_0x10a854[_0x481bb4(0xfe)]+_0xf61d0d[_0x481bb4(0x188)],'changeScore':_0xf61d0d[_0x481bb4(0x188)],'changeType':balance_constant_1[_0x481bb4(0x29a)][_0x481bb4(0x12e)],'rebateUserId':_0x24bd0d['id'],'description':_0x481bb4(0xee)}));_0xf61d0d[_0x481bb4(0x298)]&&await this[_0x481bb4(0xb8)](_0x10a854,balance_constant_1[_0x481bb4(0x29a)][_0x481bb4(0x12e)],_0xf61d0d[_0x481bb4(0x298)],_0x481bb4(0xee),_0x24bd0d['id']);const _0x716a7c=await this[_0x481bb4(0x153)][_0x481bb4(0x1da)]({'where':{'id':_0x24bd0d['id']}});_0xf61d0d[_0x481bb4(0xf2)]&&(await this['userEntity'][_0x481bb4(0x220)]({'id':_0x716a7c['id']},'score',_0xf61d0d[_0x481bb4(0xf2)]),await this[_0x481bb4(0xe0)][_0x481bb4(0x275)]({'userId':_0x24bd0d['id'],'rawScore':_0x716a7c[_0x481bb4(0xfe)],'newScore':_0x716a7c[_0x481bb4(0xfe)]+_0xf61d0d['invitedRewards'],'changeScore':_0xf61d0d[_0x481bb4(0xf2)],'changeType':balance_constant_1[_0x481bb4(0x29a)]['Invited'],'rebateUserId':_0x10a854['id'],'description':'受邀请注册赠送'})),_0xf61d0d[_0x481bb4(0xd9)]&&await this[_0x481bb4(0xb8)](_0x716a7c,balance_constant_1['EChangeType'][_0x481bb4(0xc4)],_0xf61d0d[_0x481bb4(0xd9)],_0x481bb4(0x229),_0x10a854['id']);}}async['changeScore4Other'](_0x1633a5,_0x5db5e6,_0xd5b0ce,_0x4ca2d7,_0x1075d8){const _0x503b8a=_0x5ee955;await this['userEntity'][_0x503b8a(0xba)]({'id':_0x1633a5['id']},{'score':_0x1633a5['score']+_0xd5b0ce}),await this[_0x503b8a(0xe0)][_0x503b8a(0x275)]({'userId':_0x1633a5['id'],'rawScore':_0x1633a5['score'],'newScore':_0x1633a5['score']+_0xd5b0ce,'changeScore':_0xd5b0ce,'changeType':_0x5db5e6,'relateId':_0x1075d8?String(_0x1075d8):null,'description':_0x4ca2d7});}async[_0x5ee955(0xb8)](_0x46f16a,_0x553b6f,_0x408106,_0x1d66fc,_0x8bc9e1){const _0x1fb28c=_0x5ee955;if(_0x46f16a[_0x1fb28c(0xd8)])return;_0x408106===-0x1?await this[_0x1fb28c(0x153)][_0x1fb28c(0xba)]({'id':_0x46f16a['id']},{'lifetimeVip':0x1}):(_0x46f16a[_0x1fb28c(0x1a9)]?_0x46f16a[_0x1fb28c(0x1a9)]=(0x0,date_1[_0x1fb28c(0x21a)])(_0x46f16a[_0x1fb28c(0x1a9)])['add'](_0x408106,_0x1fb28c(0x1b7))[_0x1fb28c(0x261)]():_0x46f16a[_0x1fb28c(0x1a9)]=(0x0,date_1[_0x1fb28c(0x21a)])()['add'](_0x408106,_0x1fb28c(0x1b7))[_0x1fb28c(0x261)](),await this[_0x1fb28c(0x153)][_0x1fb28c(0xba)]({'id':_0x46f16a['id']},{'vipExpire':_0x46f16a['vipExpire']})),_0x46f16a=await this['userEntity'][_0x1fb28c(0x1da)]({'where':{'id':_0x46f16a['id']}}),await this[_0x1fb28c(0xe0)][_0x1fb28c(0x203)]({'userId':_0x46f16a['id'],'vipDays':_0x408106,'vipExpire':_0x46f16a[_0x1fb28c(0x1a9)],'relateType':_0x553b6f,'relateId':_0x8bc9e1?String(_0x8bc9e1):'','description':_0x1d66fc});}async[_0x5ee955(0x1db)](_0x9d67c7,_0x11dfa5){const _0x31b017=_0x5ee955,_0x2cee4d=await this[_0x31b017(0x2ac)][_0x31b017(0x1da)]({'where':{'id':_0x11dfa5}});await this[_0x31b017(0x153)][_0x31b017(0xba)]({'id':_0x9d67c7['id']},{'vipLeavelId':_0x11dfa5,'vipLeavelName':_0x2cee4d[_0x31b017(0x208)]});}async[_0x5ee955(0x18c)](_0x1e5f6e,_0xc12603){const _0x11cf4e=_0x5ee955;let _0x2e8ac6=!![];const _0x60e4d9=await this['getUserById'](_0x1e5f6e);if(_0x60e4d9[_0x11cf4e(0xd8)]||_0x60e4d9[_0x11cf4e(0x1a9)]){if(_0xc12603[_0x11cf4e(0x1df)]<0x0)_0x2e8ac6=!![];else{if(_0xc12603[_0x11cf4e(0x1df)]>0x0){const _0x30f5dd=redisKey_constant_1[_0x11cf4e(0x175)]+'-'+_0x1e5f6e+'-'+_0xc12603['id'];let _0x1e2e8f=await this['redisCacheService']['get']({'key':_0x30f5dd});console['log'](_0x1e2e8f);let _0x39c435=Number(_0x1e2e8f||0x0);_0x39c435<_0xc12603[_0x11cf4e(0x1df)]?_0x2e8ac6=!![]:_0x2e8ac6=_0x60e4d9[_0x11cf4e(0xfe)]>=_0xc12603['deduct'];}else _0x2e8ac6=_0x60e4d9[_0x11cf4e(0xfe)]>=_0xc12603[_0x11cf4e(0x25b)];}}else _0x2e8ac6=_0x60e4d9[_0x11cf4e(0xfe)]>=_0xc12603[_0x11cf4e(0x25b)];if(!_0x2e8ac6)throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0x11cf4e(0xd7)]['BAD_REQUEST']);}async[_0x5ee955(0x170)](_0x570244,_0x163d43){const _0x2725a6=_0x5ee955;let _0x544d89=!![];const _0x24e830=await this['getUserById'](_0x570244);if(_0x24e830[_0x2725a6(0xd8)]||_0x24e830[_0x2725a6(0x1a9)]){if(_0x163d43[_0x2725a6(0x1df)]<0x0)_0x544d89=!![];else{if(_0x163d43[_0x2725a6(0x1df)]>0x0){const _0x16c3cf=redisKey_constant_1[_0x2725a6(0x175)]+'-'+_0x570244+'-'+_0x163d43['id'];let _0x59601c=await this['redisCacheService'][_0x2725a6(0x1fb)]({'key':_0x16c3cf});console[_0x2725a6(0x1b3)](_0x59601c);let _0x3d72e4=Number(_0x59601c||0x0);_0x3d72e4<_0x163d43[_0x2725a6(0x1df)]?_0x544d89=!![]:_0x544d89=_0x24e830['score']>=_0x163d43['deduct'];}else _0x544d89=_0x24e830[_0x2725a6(0xfe)]>=_0x163d43['deduct'];}}else _0x544d89=_0x24e830['score']>=_0x163d43[_0x2725a6(0x25b)];if(!_0x544d89)throw new common_1[(_0x2725a6(0xaf))](_0x2725a6(0x25e),common_1[_0x2725a6(0xd7)]['BAD_REQUEST']);}async['validateUserType'](_0x4d3eb6,_0x5b0c08){const _0x8ab860=_0x5ee955;let _0x12b539=!![];if(!_0x5b0c08)return;const _0x3f99fb=await this[_0x8ab860(0x1e0)](_0x4d3eb6);_0x5b0c08&&(_0x12b539=_0x5b0c08[_0x8ab860(0x230)](',')[_0x8ab860(0x1dc)](_0x3f99fb[_0x8ab860(0xf4)]?.[_0x8ab860(0x2a5)]())>-0x1);if(!_0x12b539){const _0x3cd03d=await this[_0x8ab860(0x2ac)][_0x8ab860(0x105)]({'where':{'dictType':dict_constant_1[_0x8ab860(0x29b)][_0x8ab860(0x24a)]},'order':{'createdAt':_0x8ab860(0xe3)}});throw new common_1[(_0x8ab860(0xaf))](_0x8ab860(0x253)+_0x5b0c08['split'](',')[_0x8ab860(0x191)](_0x8f2ee4=>_0x3cd03d['find'](_0x13d961=>_0x13d961['id'][_0x8ab860(0x2a5)]()===_0x8f2ee4)?.[_0x8ab860(0x208)])[_0x8ab860(0x2a5)]()+'可用',common_1[_0x8ab860(0xd7)]['BAD_REQUEST']);}}async[_0x5ee955(0x222)](_0x577d33,_0x1874e6,_0x4a961b){const _0x4309d4=_0x5ee955,_0x240213=await this['getUserById'](_0x577d33);let _0x391575;switch(_0x1874e6[_0x4309d4(0x1be)]){case model_constant_1[_0x4309d4(0x111)][_0x4309d4(0x2a9)]:_0x391575=balance_constant_1[_0x4309d4(0x29a)]['PPT'];break;case model_constant_1['EModelType'][_0x4309d4(0xc9)]:_0x391575=balance_constant_1[_0x4309d4(0x29a)][_0x4309d4(0xc3)];break;case model_constant_1[_0x4309d4(0x111)][_0x4309d4(0x234)]:_0x391575=balance_constant_1[_0x4309d4(0x29a)][_0x4309d4(0x129)];break;case model_constant_1[_0x4309d4(0x111)][_0x4309d4(0xc1)]:_0x391575=balance_constant_1['EChangeType'][_0x4309d4(0xc1)];break;case model_constant_1[_0x4309d4(0x111)][_0x4309d4(0x1ea)]:_0x391575=balance_constant_1['EChangeType'][_0x4309d4(0xd0)];break;case model_constant_1['EModelType']['CHAT']:_0x391575=balance_constant_1['EChangeType'][_0x4309d4(0x1cc)];break;case model_constant_1[_0x4309d4(0x111)][_0x4309d4(0xb7)]:_0x391575=balance_constant_1[_0x4309d4(0x29a)][_0x4309d4(0x235)];break;case model_constant_1['EModelType'][_0x4309d4(0x1c2)]:_0x391575=balance_constant_1[_0x4309d4(0x29a)]['File'];break;case model_constant_1[_0x4309d4(0x111)][_0x4309d4(0x186)]:_0x391575=balance_constant_1['EChangeType'][_0x4309d4(0x28a)];break;default:_0x391575=balance_constant_1[_0x4309d4(0x29a)][_0x4309d4(0x1cc)];}if(_0x240213[_0x4309d4(0xd8)]||_0x240213[_0x4309d4(0x1a9)]){if(_0x1874e6[_0x4309d4(0x1df)]<0x0){await this[_0x4309d4(0x10d)](_0x240213,_0x391575,0x0,_0x4309d4(0x130)+_0x1874e6[_0x4309d4(0x1c4)]+_0x4309d4(0x187),_0x4a961b);return;}else{if(_0x1874e6[_0x4309d4(0x1df)]>0x0){const _0x362bcb=redisKey_constant_1[_0x4309d4(0x175)]+'-'+_0x577d33+'-'+_0x1874e6['id'];let _0x30d308=await this[_0x4309d4(0x1fe)]['get']({'key':_0x362bcb}),_0x3d84bf=Number(_0x30d308||0x0);if(_0x3d84bf<_0x1874e6[_0x4309d4(0x1df)]){const _0xd0c265=(0x0,date_1['default'])()[_0x4309d4(0x202)]('d')[_0x4309d4(0xde)]((0x0,date_1[_0x4309d4(0x21a)])(),'s');await this[_0x4309d4(0x1fe)][_0x4309d4(0x17a)]({'key':_0x362bcb,'val':_0x3d84bf+0x1},_0xd0c265),await this[_0x4309d4(0x10d)](_0x240213,_0x391575,0x0,_0x4309d4(0x130)+_0x1874e6['modelName']+_0x4309d4(0x23c),_0x4a961b);return;}}}}await this[_0x4309d4(0x10d)](_0x240213,_0x391575,-_0x1874e6[_0x4309d4(0x25b)],_0x4309d4(0x130)+_0x1874e6[_0x4309d4(0x1c4)]+_0x4309d4(0x2a2),_0x4a961b);}async[_0x5ee955(0x176)](_0x2a8ea6,_0x2a32d6,_0x3ca4d2,_0x2e5d8c,_0x14779d=balance_constant_1[_0x5ee955(0x29a)][_0x5ee955(0xd0)]){const _0x3843e0=_0x5ee955,_0x5f52c2=await this['getUserById'](_0x2a8ea6);if(_0x5f52c2['lifetimeVip']||_0x5f52c2[_0x3843e0(0x1a9)]){if(_0x2a32d6[_0x3843e0(0x1df)]<0x0){await this[_0x3843e0(0x10d)](_0x5f52c2,_0x14779d,0x0,_0x3843e0(0x130)+_0x2a32d6['name']+'】会员永久免费',_0x3ca4d2);return;}else{if(_0x2a32d6[_0x3843e0(0x1df)]>0x0){const _0x54d279=redisKey_constant_1[_0x3843e0(0x175)]+'-'+_0x2a8ea6+'-'+_0x2a32d6[_0x3843e0(0xf1)];let _0x5e6cb5=await this['redisCacheService'][_0x3843e0(0x1fb)]({'key':_0x54d279}),_0x430611=Number(_0x5e6cb5||0x0);if(_0x430611<_0x2a32d6[_0x3843e0(0x1df)]){const _0x3ec3ad=(0x0,date_1[_0x3843e0(0x21a)])()[_0x3843e0(0x202)]('d')[_0x3843e0(0xde)]((0x0,date_1[_0x3843e0(0x21a)])(),'s');await this[_0x3843e0(0x1fe)][_0x3843e0(0x17a)]({'key':_0x54d279,'val':_0x430611+0x1},_0x3ec3ad),await this['changeScore4Other'](_0x5f52c2,_0x14779d,0x0,'模型【'+_0x2a32d6[_0x3843e0(0x103)]+_0x3843e0(0x23c),_0x3ca4d2);return;}}}}await this[_0x3843e0(0x10d)](_0x5f52c2,_0x14779d,-_0x2a32d6[_0x3843e0(0x25b)]*(_0x2e5d8c||0x1),_0x3843e0(0x130)+_0x2a32d6[_0x3843e0(0x103)]+_0x3843e0(0x2a2),_0x3ca4d2);}async[_0x5ee955(0x1e4)](_0x2103ef,_0x3a3c27,_0x115612,_0x5e1c7c=balance_constant_1[_0x5ee955(0x29a)]['Draw']){const _0x9b5ca8=_0x5ee955,_0x488548=await this['getUserById'](_0x2103ef);await this[_0x9b5ca8(0x10d)](_0x488548,_0x5e1c7c,_0x3a3c27[_0x9b5ca8(0x25b)],_0x9b5ca8(0x130)+_0x3a3c27[_0x9b5ca8(0x103)]+_0x9b5ca8(0x286),_0x115612);}async[_0x5ee955(0x10c)](_0x33f099,_0x3263ca,_0x409e91){const _0x130096=_0x5ee955;let _0x520609=!![];const _0x5e2c15=await this['getUserById'](_0x33f099);if(_0x5e2c15[_0x130096(0xd8)]||_0x5e2c15[_0x130096(0x1a9)]){if(_0x3263ca[_0x130096(0x1df)]<0x0){_0x520609=!![];return;}else{if(_0x3263ca[_0x130096(0x1df)]>0x0){const _0x255713=redisKey_constant_1['VIP_FREE']+'-'+_0x33f099+'-'+_0x3263ca[_0x130096(0xf1)];let _0x3fe5f3=await this['redisCacheService'][_0x130096(0x1fb)]({'key':_0x255713}),_0x38f508=Number(_0x3fe5f3||0x0);if(_0x38f508<_0x3263ca['vipFreeNum']){_0x520609=!![];return;}}}}_0x520609=_0x5e2c15[_0x130096(0xfe)]>=_0x3263ca[_0x130096(0x25b)]*_0x409e91;if(!_0x520609)throw new common_1['HttpException']('用户余额不足，请充值',common_1[_0x130096(0xd7)][_0x130096(0x2a6)]);}async[_0x5ee955(0xa1)](_0x21d6c9,_0x1410a1,_0x4c571e){const _0x1ef438=_0x5ee955;let _0x1bd45f=!![],_0x1e7318=await this[_0x1ef438(0x26d)](_0x1410a1,_0x4c571e);const _0x38f8ad=await this['getUserById'](_0x21d6c9);if(_0x38f8ad[_0x1ef438(0xd8)]||_0x38f8ad[_0x1ef438(0x1a9)]){if(_0x1410a1[_0x1ef438(0x1df)]<0x0||_0x1e7318?.[_0x1ef438(0x1df)]<0x0){_0x1bd45f=!![];return;}else{if(_0x1e7318?.[_0x1ef438(0x1df)]>0x0){const _0x3e8379=redisKey_constant_1[_0x1ef438(0x175)]+'-'+_0x21d6c9+'-'+_0x1e7318[_0x1ef438(0xf1)]+'-'+_0x1e7318[_0x1ef438(0x126)]+'-'+_0x1e7318[_0x1ef438(0x12c)];let _0x21aaf4=await this['redisCacheService'][_0x1ef438(0x1fb)]({'key':_0x3e8379}),_0x4ee6c3=Number(_0x21aaf4||0x0);if(_0x4ee6c3<_0x1e7318[_0x1ef438(0x1df)]){_0x1bd45f=!![];return;}}else{if(_0x1410a1[_0x1ef438(0x1df)]>0x0){const _0x3a6f71=redisKey_constant_1[_0x1ef438(0x175)]+'-'+_0x21d6c9+'-'+_0x1410a1['id'];let _0x2e3320=await this['redisCacheService'][_0x1ef438(0x1fb)]({'key':_0x3a6f71});console['log'](_0x2e3320);let _0x3a2f0d=Number(_0x2e3320||0x0);if(_0x3a2f0d<_0x1410a1[_0x1ef438(0x1df)]){_0x1bd45f=!![];return;}}}}}_0x1bd45f=_0x38f8ad[_0x1ef438(0xfe)]>=(_0x1e7318?.[_0x1ef438(0x1d9)]>0x0?_0x1e7318?.[_0x1ef438(0x1d9)]:_0x1410a1['deduct']);if(!_0x1bd45f)throw new common_1[(_0x1ef438(0xaf))](_0x1ef438(0x25e),common_1[_0x1ef438(0xd7)][_0x1ef438(0x2a6)]);}async['validateBalance4Human'](_0x44c186,_0x33b129,_0x4d80a3=0x1){const _0x49d575=_0x5ee955;let _0x283cca=!![],_0x2842e8=await this[_0x49d575(0xff)](_0x33b129);await this[_0x49d575(0xfb)](_0x44c186,_0x2842e8[_0x49d575(0x299)]);const _0x3f4415=await this['getUserById'](_0x44c186);if(_0x3f4415[_0x49d575(0xd8)]||_0x3f4415[_0x49d575(0x1a9)]){if(_0x2842e8?.['vipFreeNum']<0x0){_0x283cca=!![];return;}else{if(_0x2842e8?.[_0x49d575(0x1df)]>0x0){const _0x32d0d8=redisKey_constant_1['VIP_FREE']+'-'+_0x44c186+'-'+_0x33b129;let _0x110c88=await this['redisCacheService']['get']({'key':_0x32d0d8}),_0x1ca85b=Number(_0x110c88||0x0);if(_0x1ca85b<_0x2842e8['vipFreeNum']){_0x283cca=!![];return;}}}}_0x4d80a3?_0x283cca=_0x3f4415['score']>=_0x2842e8?.[_0x49d575(0x1d9)]*parseInt(_0x4d80a3[_0x49d575(0x2a5)]()):_0x283cca=_0x3f4415[_0x49d575(0xfe)]>=_0x2842e8?.[_0x49d575(0x1d9)];if(!_0x283cca)throw new common_1['HttpException'](_0x49d575(0x25e),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x5ee955(0xdd)](_0x54b8ea,_0x56fda2,_0x5e2a89,_0x3b4843=0x1){const _0x3df99e=_0x5ee955,_0xc1085e=await this[_0x3df99e(0x1e0)](_0x54b8ea);let _0x245471=await this[_0x3df99e(0xff)](_0x56fda2);if(_0xc1085e[_0x3df99e(0xd8)]||_0xc1085e[_0x3df99e(0x1a9)]){if(_0x245471?.['vipFreeNum']<0x0){await this[_0x3df99e(0x10d)](_0xc1085e,balance_constant_1[_0x3df99e(0x29a)][_0x3df99e(0x17e)],0x0,'数字人【'+_0x56fda2+'】会员永久免费',_0x5e2a89);return;}else{if(_0x245471?.['vipFreeNum']>0x0){const _0x1daa51=redisKey_constant_1[_0x3df99e(0x175)]+'-'+_0x54b8ea+'-'+_0x56fda2;let _0x5a3207=await this[_0x3df99e(0x1fe)]['get']({'key':_0x1daa51}),_0x190d59=Number(_0x5a3207||0x0);if(_0x190d59<_0x245471[_0x3df99e(0x1df)]){const _0x1329c0=(0x0,date_1[_0x3df99e(0x21a)])()['endOf']('d')['diff']((0x0,date_1[_0x3df99e(0x21a)])(),'s');await this[_0x3df99e(0x1fe)][_0x3df99e(0x17a)]({'key':_0x1daa51,'val':_0x190d59+0x1},_0x1329c0);return;}}}}_0x3b4843?await this[_0x3df99e(0x10d)](_0xc1085e,balance_constant_1[_0x3df99e(0x29a)][_0x3df99e(0x17e)],-_0x245471?.[_0x3df99e(0x1d9)]*parseInt(_0x3b4843['toString']()),_0x3df99e(0x1f5)+_0x56fda2+'消耗',_0x5e2a89):await this[_0x3df99e(0x10d)](_0xc1085e,balance_constant_1[_0x3df99e(0x29a)][_0x3df99e(0x17e)],-_0x245471?.[_0x3df99e(0x1d9)],_0x3df99e(0x1f5)+_0x56fda2+'消耗',_0x5e2a89);}async[_0x5ee955(0x2af)](_0x18a58b,_0x2ed631,_0x19358d,_0x1e8d76=0x1){const _0x424049=_0x5ee955,_0x33c414=await this[_0x424049(0x1e0)](_0x18a58b);let _0x5ae30e=await this[_0x424049(0xff)](_0x2ed631);if(_0x33c414['lifetimeVip']||_0x33c414[_0x424049(0x1a9)]){if(_0x5ae30e?.['vipFreeNum']<0x0)return;else{if(_0x5ae30e?.[_0x424049(0x1df)]>0x0){const _0x593e3d=redisKey_constant_1[_0x424049(0x175)]+'-'+_0x18a58b+'-'+_0x2ed631;let _0x2424d5=await this[_0x424049(0x1fe)][_0x424049(0x1fb)]({'key':_0x593e3d}),_0x1ac4ad=Number(_0x2424d5||0x0);if(_0x1ac4ad>=_0x5ae30e[_0x424049(0x1df)]){const _0x5c55f7=(0x0,date_1['default'])()[_0x424049(0x202)]('d')[_0x424049(0xde)]((0x0,date_1[_0x424049(0x21a)])(),'s');await this['redisCacheService']['set']({'key':_0x593e3d,'val':_0x1ac4ad-0x1},_0x5c55f7);return;}}}}_0x1e8d76?await this[_0x424049(0x10d)](_0x33c414,balance_constant_1[_0x424049(0x29a)][_0x424049(0x17e)],_0x5ae30e?.[_0x424049(0x1d9)]*parseInt(_0x1e8d76[_0x424049(0x2a5)]()),_0x424049(0x1f5)+_0x2ed631+_0x424049(0x102),_0x19358d):await this['changeScore4Other'](_0x33c414,balance_constant_1[_0x424049(0x29a)][_0x424049(0x17e)],_0x5ae30e?.[_0x424049(0x1d9)],_0x424049(0x1f5)+_0x2ed631+_0x424049(0x102),_0x19358d);}async['deductBalance4Video'](_0x2fc020,_0x3bbded,_0x4b0e38,_0x2def7f,_0x3f7c26=balance_constant_1['EChangeType'][_0x5ee955(0xc1)]){const _0x999e15=_0x5ee955,_0x41c587=await this[_0x999e15(0x1e0)](_0x2fc020);let _0x40be75=await this['getVideoConfig'](_0x3bbded,_0x4b0e38);if(_0x41c587['lifetimeVip']||_0x41c587[_0x999e15(0x1a9)]){if(_0x3bbded[_0x999e15(0x1df)]<0x0||_0x40be75?.['vipFreeNum']<0x0){await this[_0x999e15(0x10d)](_0x41c587,_0x3f7c26,0x0,_0x999e15(0x130)+_0x3bbded['modelName']+_0x999e15(0x187),_0x2def7f);return;}else{if(_0x40be75?.['vipFreeNum']>0x0){const _0x6598b=redisKey_constant_1[_0x999e15(0x175)]+'-'+_0x2fc020+'-'+_0x40be75['model']+'-'+_0x40be75[_0x999e15(0x126)]+'-'+_0x40be75[_0x999e15(0x12c)];let _0x3affea=await this[_0x999e15(0x1fe)][_0x999e15(0x1fb)]({'key':_0x6598b}),_0x2a1d9e=Number(_0x3affea||0x0);if(_0x2a1d9e<_0x40be75[_0x999e15(0x1df)]){const _0x2d13d8=(0x0,date_1[_0x999e15(0x21a)])()['endOf']('d')['diff']((0x0,date_1['default'])(),'s');await this['redisCacheService']['set']({'key':_0x6598b,'val':_0x2a1d9e+0x1},_0x2d13d8);return;}}else{if(_0x3bbded[_0x999e15(0x1df)]>0x0){const _0x544cc8=redisKey_constant_1[_0x999e15(0x175)]+'-'+_0x2fc020+'-'+_0x3bbded['id'];let _0x42b272=await this[_0x999e15(0x1fe)][_0x999e15(0x1fb)]({'key':_0x544cc8}),_0x4911c8=Number(_0x42b272||0x0);if(_0x4911c8<_0x3bbded['vipFreeNum']){const _0x560158=(0x0,date_1[_0x999e15(0x21a)])()[_0x999e15(0x202)]('d')[_0x999e15(0xde)]((0x0,date_1[_0x999e15(0x21a)])(),'s');await this['redisCacheService']['set']({'key':_0x544cc8,'val':_0x4911c8+0x1},_0x560158);return;}}}}}await this['changeScore4Other'](_0x41c587,_0x3f7c26,_0x40be75?.[_0x999e15(0x1d9)]>0x0?-_0x40be75?.[_0x999e15(0x1d9)]:-_0x3bbded[_0x999e15(0x25b)],_0x999e15(0x130)+_0x3bbded['modelName']+_0x999e15(0x23c),_0x2def7f);}async[_0x5ee955(0x8e)](_0x300690,_0x19eca6,_0x18f25c,_0xb379e2,_0x541537=balance_constant_1['EChangeType'][_0x5ee955(0xc1)]){const _0x1c42c5=_0x5ee955;let _0x306db9=await this[_0x1c42c5(0x26d)](_0x19eca6,_0x18f25c);const _0x5b2c24=await this[_0x1c42c5(0x1e0)](_0x300690);if(_0x5b2c24['lifetimeVip']||_0x5b2c24[_0x1c42c5(0x1a9)]){if(_0x19eca6['vipFreeNum']<0x0||_0x306db9?.['vipFreeNum']<0x0)return;else{if(_0x306db9?.['vipFreeNum']>0x0){const _0x3cac76=redisKey_constant_1['VIP_FREE']+'-'+_0x300690+'-'+_0x306db9[_0x1c42c5(0xf1)]+'-'+_0x306db9[_0x1c42c5(0x126)]+'-'+_0x306db9[_0x1c42c5(0x12c)];let _0x1a5517=await this[_0x1c42c5(0x1fe)]['get']({'key':_0x3cac76}),_0x4917c0=Number(_0x1a5517||0x0);if(_0x4917c0>=_0x306db9[_0x1c42c5(0x1df)]){const _0x388057=(0x0,date_1[_0x1c42c5(0x21a)])()[_0x1c42c5(0x202)]('d')['diff']((0x0,date_1[_0x1c42c5(0x21a)])(),'s');await this[_0x1c42c5(0x1fe)][_0x1c42c5(0x17a)]({'key':_0x3cac76,'val':_0x4917c0-0x1},_0x388057);return;}}else{if(_0x19eca6['vipFreeNum']>0x0){const _0x4dd5e5=redisKey_constant_1[_0x1c42c5(0x175)]+'-'+_0x300690+'-'+_0x19eca6['id'];let _0x1d33da=await this[_0x1c42c5(0x1fe)]['get']({'key':_0x4dd5e5}),_0x5f1c16=Number(_0x1d33da||0x0);if(_0x5f1c16>=_0x19eca6[_0x1c42c5(0x1df)]){const _0x49f40d=(0x0,date_1[_0x1c42c5(0x21a)])()[_0x1c42c5(0x202)]('d')[_0x1c42c5(0xde)]((0x0,date_1[_0x1c42c5(0x21a)])(),'s');await this[_0x1c42c5(0x1fe)]['set']({'key':_0x4dd5e5,'val':_0x5f1c16-0x1},_0x49f40d);return;}}}}}await this[_0x1c42c5(0x10d)](_0x5b2c24,_0x541537,_0x306db9?.[_0x1c42c5(0x1d9)]>0x0?_0x306db9?.[_0x1c42c5(0x1d9)]:_0x19eca6[_0x1c42c5(0x25b)],_0x1c42c5(0x130)+_0x19eca6[_0x1c42c5(0x1c4)]+'】失败退还',_0xb379e2);}async[_0x5ee955(0x106)](_0x4d1c9c,_0x53e017,_0x36d2cb){const _0x4d6a74=_0x5ee955,_0x1eb4d0=await this[_0x4d6a74(0x1e0)](_0x4d1c9c);let _0x271865;switch(_0x53e017[_0x4d6a74(0x1be)]){case model_constant_1['EModelType'][_0x4d6a74(0xc9)]:_0x271865=balance_constant_1[_0x4d6a74(0x29a)][_0x4d6a74(0xc3)];break;case model_constant_1[_0x4d6a74(0x111)]['MUSIC']:_0x271865=balance_constant_1['EChangeType']['Music'];break;case model_constant_1[_0x4d6a74(0x111)][_0x4d6a74(0x1ea)]:_0x271865=balance_constant_1[_0x4d6a74(0x29a)][_0x4d6a74(0xd0)];break;case model_constant_1['EModelType'][_0x4d6a74(0x18d)]:_0x271865=balance_constant_1[_0x4d6a74(0x29a)][_0x4d6a74(0x1cc)];break;case model_constant_1[_0x4d6a74(0x111)][_0x4d6a74(0xb7)]:_0x271865=balance_constant_1[_0x4d6a74(0x29a)][_0x4d6a74(0x235)];break;case model_constant_1[_0x4d6a74(0x111)][_0x4d6a74(0xc1)]:_0x271865=balance_constant_1[_0x4d6a74(0x29a)][_0x4d6a74(0xc1)];break;default:_0x271865=balance_constant_1[_0x4d6a74(0x29a)][_0x4d6a74(0x1cc)];}await this[_0x4d6a74(0x10d)](_0x1eb4d0,_0x271865,_0x53e017[_0x4d6a74(0x25b)],_0x4d6a74(0x130)+_0x53e017[_0x4d6a74(0x1c4)]+_0x4d6a74(0x286),_0x36d2cb);}async[_0x5ee955(0x142)](_0xe3120c,_0x415988,_0x1a6740,_0x1009b1,_0x145ca0,_0x45dd9b,_0x15f9ff=balance_constant_1[_0x5ee955(0x29a)][_0x5ee955(0xd5)]){const _0x398011=_0x5ee955,_0x234f78=await this['getUserById'](_0xe3120c);if(_0x234f78[_0x398011(0xd8)]||_0x234f78[_0x398011(0x1a9)]){if(_0x1009b1<0x0){await this[_0x398011(0x10d)](_0x234f78,_0x15f9ff,0x0,_0x398011(0x18f)+_0x1a6740+_0x398011(0x187),_0x45dd9b);return;}else{if(_0x1009b1>0x0){const _0x12342d=redisKey_constant_1[_0x398011(0x175)]+'-'+_0xe3120c+'-'+_0x415988;let _0x485bd3=await this[_0x398011(0x1fe)][_0x398011(0x1fb)]({'key':_0x12342d}),_0x248264=Number(_0x485bd3||0x0);if(_0x248264<_0x1009b1){const _0x2c8371=(0x0,date_1[_0x398011(0x21a)])()[_0x398011(0x202)]('d')[_0x398011(0xde)]((0x0,date_1['default'])(),'s');await this[_0x398011(0x1fe)]['set']({'key':_0x12342d,'val':_0x248264+0x1},_0x2c8371),await this[_0x398011(0x10d)](_0x234f78,_0x15f9ff,0x0,_0x398011(0x18f)+_0x1a6740+_0x398011(0x23c),_0x45dd9b);return;}}}}await this['changeScore4Other'](_0x234f78,_0x15f9ff,-_0x145ca0,_0x398011(0x18f)+_0x1a6740+_0x398011(0x2a2),_0x45dd9b);}async[_0x5ee955(0x238)](_0x29be91,_0x131cb9,_0x538b28){const _0x1cba97=_0x5ee955;let _0xc3e20='',_0x54151b='',_0x36d834='',_0x139da3=_0x131cb9;const _0x5da054=_0x131cb9[_0x1cba97(0x21c)](),_0x284cce=new RegExp(_0x1cba97(0xaa)),_0x41db44=new RegExp('upscale|describe|picread::retry|faceswap|shorten'),_0x558ab6=new RegExp(_0x1cba97(0x1cf));if(_0x29be91===midjourney_constant_1[_0x1cba97(0x25f)][_0x1cba97(0x147)])_0x54151b=_0x1cba97(0x131),_0xc3e20=_0x1cba97(0x233),_0x36d834=_0x1cba97(0x1d8);else{if(_0x29be91===midjourney_constant_1[_0x1cba97(0x25f)]['relax'])_0x54151b='type2',_0xc3e20=_0x1cba97(0x1b8),_0x36d834='relax_vip_free';else _0x29be91===midjourney_constant_1[_0x1cba97(0x25f)]['turbo']&&(_0x54151b=_0x1cba97(0x189),_0xc3e20=_0x1cba97(0x1e7),_0x36d834=_0x1cba97(0x1ed));}if(_0x284cce[_0x1cba97(0x1af)](_0x5da054))_0xc3e20=_0xc3e20+0x1;else{if(_0x41db44['test'](_0x5da054))_0xc3e20=_0xc3e20+0x2;else _0x558ab6[_0x1cba97(0x1af)](_0x5da054)&&(_0xc3e20=_0xc3e20+0x3);}const _0x321cc7=await this['configService'][_0x1cba97(0x1b5)](_0x1cba97(0x150));let _0x3082e1={};if(!_0x321cc7){let _0x2c8b3b=await this[_0x1cba97(0x26c)][_0x1cba97(0x1bb)]([_0xc3e20,_0x36d834]);for(let _0x541014 in _0x2c8b3b){_0x3082e1[_0x541014]=Number(_0x2c8b3b[_0x541014])||0x0;}if(_0x538b28[_0x1cba97(0xf4)]){const _0x20ddb2=await this[_0x1cba97(0x26c)][_0x1cba97(0xb1)](_0x538b28[_0x1cba97(0xf4)],'mj');_0x20ddb2&&(_0x3082e1[_0x36d834]=_0x20ddb2[_0x54151b]||0x0);}}else{const _0x2654d0=_0x538b28[_0x1cba97(0x224)]||'';_0x3082e1=_0x321cc7[_0x1cba97(0x13b)][_0x2654d0],(!_0x3082e1||!_0x3082e1[_0x1cba97(0x1d8)])&&(_0x3082e1=_0x321cc7[_0x1cba97(0x13b)][_0x1cba97(0x2aa)]);}for(let _0x1641e7 in midjourney_constant_1[_0x1cba97(0x1aa)]){if(_0x5da054['includes'](midjourney_constant_1[_0x1cba97(0x1aa)][_0x1641e7][_0x1cba97(0xa9)])){_0x139da3=midjourney_constant_1[_0x1cba97(0x1aa)][_0x1641e7]['cn'];break;}}return{'price':Number(_0x3082e1[_0xc3e20]),'vipFreeNum':Number(_0x3082e1[_0x36d834]),'vipFreeKey':_0x36d834,'description':_0x139da3};}async[_0x5ee955(0x207)](_0x1d7b59,_0x18545a){const _0x379868=_0x5ee955;try{let _0x355043='Imagine';_0x18545a['type']==0x5&&(_0x355043=_0x379868(0x133));const _0x59e5c5=_0x18545a[_0x379868(0x28d)];_0x59e5c5[_0x379868(0xa4)]&&(_0x355043=_0x59e5c5['customId']);const _0x18b337=await this[_0x379868(0x1e0)](_0x1d7b59);let _0x434685='',_0x5614cf='',_0x3e34a0='',_0x2d3f94=_0x355043;const _0x1107f5=_0x355043['toLowerCase'](),_0x449426=new RegExp(_0x379868(0xaa)),_0x1b0753=new RegExp('upscale|describe|picread::retry|faceswap|shorten'),_0x1719f5=new RegExp(_0x379868(0x1cf));if(_0x59e5c5[_0x379868(0x126)]===midjourney_constant_1[_0x379868(0x25f)][_0x379868(0x147)])_0x5614cf=_0x379868(0x131),_0x434685='fast_mjDeduction',_0x3e34a0='fast_vip_free';else{if(_0x59e5c5['mode']===midjourney_constant_1[_0x379868(0x25f)][_0x379868(0x23b)])_0x5614cf=_0x379868(0x1ab),_0x434685=_0x379868(0x1b8),_0x3e34a0=_0x379868(0xad);else _0x59e5c5[_0x379868(0x126)]===midjourney_constant_1['DrawSpeed'][_0x379868(0xbb)]&&(_0x5614cf='type3',_0x434685=_0x379868(0x1e7),_0x3e34a0=_0x379868(0x1ed));}if(_0x449426[_0x379868(0x1af)](_0x1107f5))_0x434685=_0x434685+0x1;else{if(_0x1b0753['test'](_0x1107f5))_0x434685=_0x434685+0x2;else _0x1719f5[_0x379868(0x1af)](_0x1107f5)&&(_0x434685=_0x434685+0x3);}const _0x5df397=await this[_0x379868(0x1b0)]['getValue']('MjLeavelRel');let _0x25a089={};if(!_0x5df397){let _0x2024de=await this[_0x379868(0x26c)][_0x379868(0x1bb)]([_0x434685,_0x3e34a0]);for(let _0x2a1245 in _0x2024de){_0x25a089[_0x2a1245]=Number(_0x2024de[_0x2a1245])||0x0;}if(_0x18b337?.[_0x379868(0xf4)]){const _0x5e688e=await this[_0x379868(0x26c)][_0x379868(0xb1)](_0x18b337?.[_0x379868(0xf4)],'mj');_0x5e688e&&(_0x25a089[_0x3e34a0]=_0x5e688e[_0x5614cf]||0x0);}}else{const _0xdb9366=_0x18b337?.['vipLeavelName']||'';_0x25a089=_0x5df397['mjLeavelRel'][_0xdb9366],(!_0x25a089||!_0x25a089['fast_vip_free'])&&(_0x25a089=_0x5df397['mjLeavelRel'][_0x379868(0x2aa)]);}for(let _0x37a5b9 in midjourney_constant_1[_0x379868(0x1aa)]){if(_0x1107f5[_0x379868(0x178)](midjourney_constant_1[_0x379868(0x1aa)][_0x37a5b9][_0x379868(0xa9)])){_0x2d3f94=midjourney_constant_1[_0x379868(0x1aa)][_0x37a5b9]['cn'];break;}}if(_0x1d7b59<=0x0)return{'remainCount':0x0,'freeCount':Number(_0x25a089[_0x3e34a0]),'isVipFree':Number(_0x25a089[_0x3e34a0])==-0x1,'useIntegrate':Number(_0x25a089[_0x434685])};const _0x4ee3b2=redisKey_constant_1['VIP_FREE']+'-'+_0x1d7b59+'-'+_0x3e34a0;let _0x4d000a=await this[_0x379868(0x1fe)][_0x379868(0x1fb)]({'key':_0x4ee3b2}),_0x27f586=Number(_0x4d000a||0x0);return{'remainCount':Number(_0x25a089[_0x3e34a0])-_0x27f586,'freeCount':Number(_0x25a089[_0x3e34a0]),'isVipFree':Number(_0x25a089[_0x3e34a0])==-0x1,'useIntegrate':Number(_0x25a089[_0x434685]),'isVipUsed':_0x5df397['userType']?!![]:![],'userType':_0x5df397[_0x379868(0x299)]};}catch(_0x2b02e7){return _0x2b02e7;}}async[_0x5ee955(0x14a)](_0x225830,_0x2d2e9d,_0x23c5c1,_0x3155ed){const _0x543998=_0x5ee955;let _0x392cf3=!![];const _0xde63c9=await this[_0x543998(0x1e0)](_0x225830);if(_0xde63c9['lifetimeVip']||_0xde63c9[_0x543998(0x1a9)]){if(_0x23c5c1<0x0)_0x392cf3=!![];else{if(_0x23c5c1>0x0){const _0x1704b2=redisKey_constant_1[_0x543998(0x175)]+'-'+_0x225830+'-'+_0x2d2e9d;let _0xd45ac3=await this[_0x543998(0x1fe)][_0x543998(0x1fb)]({'key':_0x1704b2}),_0x46222d=Number(_0xd45ac3||0x0);_0x46222d<_0x23c5c1?_0x392cf3=!![]:_0x392cf3=_0xde63c9['score']>=_0x3155ed;}else _0x392cf3=_0xde63c9[_0x543998(0xfe)]>=_0x3155ed;}}else _0x392cf3=_0xde63c9[_0x543998(0xfe)]>=_0x3155ed;if(!_0x392cf3)throw new common_1[(_0x543998(0xaf))](_0x543998(0x25e),common_1[_0x543998(0xd7)]['BAD_REQUEST']);}async[_0x5ee955(0x93)](_0x2ee889,_0x421d11=midjourney_constant_1[_0x5ee955(0x25f)][_0x5ee955(0x23b)],_0x319263){const _0x55b289=_0x5ee955;let _0x503e42=!![];const _0x143491=await this['getUserById'](_0x2ee889),_0x46e74b=await this[_0x55b289(0x238)](_0x421d11,_0x319263,_0x143491);console[_0x55b289(0x1b3)](_0x55b289(0x214),_0x46e74b);if(_0x143491[_0x55b289(0xd8)]||_0x143491[_0x55b289(0x1a9)]){if(_0x46e74b[_0x55b289(0x1df)]<0x0)_0x503e42=!![];else{if(_0x46e74b[_0x55b289(0x1df)]>0x0){const _0x1054ef=redisKey_constant_1[_0x55b289(0x175)]+'-'+_0x2ee889+'-'+_0x46e74b['vipFreeKey'];let _0x5bfe5d=await this[_0x55b289(0x1fe)]['get']({'key':_0x1054ef}),_0x9c6a11=Number(_0x5bfe5d||0x0);_0x9c6a11<_0x46e74b[_0x55b289(0x1df)]?_0x503e42=!![]:_0x503e42=_0x143491[_0x55b289(0xfe)]>=_0x46e74b[_0x55b289(0x1d9)];}else _0x503e42=_0x143491['score']>=_0x46e74b['price'];}}else _0x503e42=_0x143491['score']>=_0x46e74b['price'];if(_0x421d11===midjourney_constant_1[_0x55b289(0x25f)][_0x55b289(0x23b)]){if(!_0x503e42)throw new common_1[(_0x55b289(0xaf))](_0x55b289(0x25e),common_1['HttpStatus']['BAD_REQUEST']);}else{if(!_0x503e42)return this[_0x55b289(0x93)](_0x2ee889,midjourney_constant_1[_0x55b289(0x25f)][_0x55b289(0x23b)],_0x319263);}return _0x421d11;}async[_0x5ee955(0x19c)](_0x303c62,_0x196300,_0x476506,_0x157d21){const _0x2ad73a=_0x5ee955,_0x286c29=await this[_0x2ad73a(0x1e0)](_0x303c62),_0x1d9f7a=await this[_0x2ad73a(0x238)](_0x196300,_0x476506,_0x286c29),_0x1e13a9=balance_constant_1['EChangeType'][_0x2ad73a(0x27c)];if(_0x286c29[_0x2ad73a(0xd8)]||_0x286c29[_0x2ad73a(0x1a9)]){if(_0x1d9f7a[_0x2ad73a(0x1df)]<0x0)await this['changeScore4Other'](_0x286c29,_0x1e13a9,0x0,_0x2ad73a(0x283)+_0x1d9f7a[_0x2ad73a(0x244)]+_0x2ad73a(0x187),_0x157d21);else{if(_0x1d9f7a['vipFreeNum']>0x0){const _0x57a893=redisKey_constant_1[_0x2ad73a(0x175)]+'-'+_0x303c62+'-'+_0x1d9f7a[_0x2ad73a(0x223)];let _0x577dc3=await this[_0x2ad73a(0x1fe)]['get']({'key':_0x57a893}),_0x1589ec=Number(_0x577dc3||0x0);if(_0x1589ec<_0x1d9f7a['vipFreeNum']){const _0x2cc1a9=(0x0,date_1[_0x2ad73a(0x21a)])()['endOf']('d')[_0x2ad73a(0xde)]((0x0,date_1[_0x2ad73a(0x21a)])(),'s');await this['redisCacheService'][_0x2ad73a(0x17a)]({'key':_0x57a893,'val':_0x1589ec+0x1},_0x2cc1a9),await this[_0x2ad73a(0x10d)](_0x286c29,_0x1e13a9,0x0,_0x2ad73a(0x283)+_0x1d9f7a[_0x2ad73a(0x244)]+_0x2ad73a(0x23c),_0x157d21);}else await this[_0x2ad73a(0x10d)](_0x286c29,_0x1e13a9,-_0x1d9f7a[_0x2ad73a(0x1d9)],_0x2ad73a(0x283)+_0x1d9f7a[_0x2ad73a(0x244)]+_0x2ad73a(0x2a2),_0x157d21);}else await this[_0x2ad73a(0x10d)](_0x286c29,_0x1e13a9,-_0x1d9f7a[_0x2ad73a(0x1d9)],_0x2ad73a(0x283)+_0x1d9f7a[_0x2ad73a(0x244)]+_0x2ad73a(0x2a2),_0x157d21);}}else await this[_0x2ad73a(0x10d)](_0x286c29,_0x1e13a9,-_0x1d9f7a[_0x2ad73a(0x1d9)],_0x2ad73a(0x283)+_0x1d9f7a['description']+_0x2ad73a(0x2a2),_0x157d21);}async[_0x5ee955(0x1e9)](_0xc394a1,_0x4d7d02,_0x57da0f,_0x73c886){const _0x3ede29=_0x5ee955,_0x61fae=await this[_0x3ede29(0x1e0)](_0xc394a1),_0x409bcf=await this[_0x3ede29(0x238)](_0x4d7d02,_0x57da0f,_0x61fae),_0x4942d0=balance_constant_1['EChangeType']['MjDraw'];if(_0x61fae[_0x3ede29(0xd8)]||_0x61fae[_0x3ede29(0x1a9)]){if(_0x409bcf[_0x3ede29(0x1df)]<0x0)return;else{if(_0x409bcf[_0x3ede29(0x1df)]>0x0){const _0xe0e9f1=redisKey_constant_1[_0x3ede29(0x175)]+'-'+_0xc394a1+'-'+_0x409bcf[_0x3ede29(0x223)];let _0x214d01=await this[_0x3ede29(0x1fe)][_0x3ede29(0x1fb)]({'key':_0xe0e9f1}),_0x5b6615=Number(_0x214d01||0x0);if(_0x5b6615<_0x409bcf[_0x3ede29(0x1df)]){const _0x3b4819=(0x0,date_1['default'])()[_0x3ede29(0x202)]('d')[_0x3ede29(0xde)]((0x0,date_1['default'])(),'s');await this['redisCacheService'][_0x3ede29(0x17a)]({'key':_0xe0e9f1,'val':_0x5b6615-0x1},_0x3b4819);return;}}}}await this[_0x3ede29(0x10d)](_0x61fae,_0x4942d0,_0x409bcf[_0x3ede29(0x1d9)],_0x3ede29(0x283)+_0x409bcf[_0x3ede29(0x244)]+_0x3ede29(0x23a),_0x73c886);}async[_0x5ee955(0x218)](_0x1d67ad,_0x1b0c9d,_0x5cd225,_0x2531fd=![]){const _0x5eddf4=_0x5ee955,_0xbfa915={'create':{'key':_0x5eddf4(0x212),'desc':_0x5eddf4(0xd3)},'lyrics':{'key':_0x5eddf4(0x1eb),'desc':_0x5eddf4(0x11e)},'upload':{'key':_0x5eddf4(0x132),'desc':'上传音乐'}},_0x51408f=_0xbfa915[_0x5cd225][_0x5eddf4(0x1f0)],_0x4ae52d=_0xbfa915[_0x5cd225][_0x5eddf4(0x20e)]+_0x5eddf4(0x2ae),_0x4dbf79=_0xbfa915[_0x5cd225][_0x5eddf4(0x20e)]+'VipFree',_0x472f2c={},_0x5297cc=await this[_0x5eddf4(0x26c)]['getConfigByKeys']([_0x4ae52d,_0x4dbf79,_0x5eddf4(0x23f)]);this[_0x5eddf4(0xfb)](_0x1d67ad,_0x5297cc[_0x5eddf4(0x23f)]);for(let _0x4a9aef in _0x5297cc){_0x472f2c[_0x4a9aef]=Number(_0x5297cc[_0x4a9aef])||0x0;}const _0x35d3e8=await this[_0x5eddf4(0x1e0)](_0x1d67ad);if(_0x35d3e8[_0x5eddf4(0xd8)]||_0x35d3e8[_0x5eddf4(0x1a9)]){if(_0x472f2c[_0x4dbf79]<0x0){!_0x2531fd&&await this['changeScore4Other'](_0x35d3e8,balance_constant_1['EChangeType'][_0x5eddf4(0x129)],0x0,_0x5eddf4(0x144)+_0x51408f+_0x5eddf4(0x187),_0x1b0c9d);return;}else{if(_0x472f2c[_0x4dbf79]>0x0){const _0x571253=redisKey_constant_1[_0x5eddf4(0x175)]+'-'+_0x1d67ad+'-'+_0x4dbf79;let _0x469a44=await this[_0x5eddf4(0x1fe)][_0x5eddf4(0x1fb)]({'key':_0x571253}),_0x46248a=Number(_0x469a44||0x0);if(!_0x2531fd){if(_0x46248a<_0x472f2c[_0x4dbf79]){const _0x2e9abf=(0x0,date_1['default'])()[_0x5eddf4(0x202)]('d')[_0x5eddf4(0xde)]((0x0,date_1['default'])(),'s');await this[_0x5eddf4(0x1fe)][_0x5eddf4(0x17a)]({'key':_0x571253,'val':_0x46248a+0x1},_0x2e9abf),await this['changeScore4Other'](_0x35d3e8,balance_constant_1['EChangeType'][_0x5eddf4(0x129)],0x0,_0x5eddf4(0x144)+_0x51408f+_0x5eddf4(0x23c),_0x1b0c9d);return;}}else{const _0x5cce6a=(0x0,date_1[_0x5eddf4(0x21a)])()[_0x5eddf4(0x202)]('d')[_0x5eddf4(0xde)]((0x0,date_1['default'])(),'s');await this[_0x5eddf4(0x1fe)][_0x5eddf4(0x17a)]({'key':_0x571253,'val':_0x46248a-0x1},_0x5cce6a);return;}}}}if(!_0x2531fd&&_0x35d3e8[_0x5eddf4(0xfe)]<_0x472f2c[_0x4ae52d])throw new common_1[(_0x5eddf4(0xaf))]('用户余额不足，请充值',common_1[_0x5eddf4(0xd7)][_0x5eddf4(0x2a6)]);if(!_0x2531fd){await this[_0x5eddf4(0x10d)](_0x35d3e8,balance_constant_1[_0x5eddf4(0x29a)]['Music'],-_0x472f2c[_0x4ae52d],'音乐【'+_0x51408f+_0x5eddf4(0x2a2),_0x1b0c9d);return;}await this[_0x5eddf4(0x10d)](_0x35d3e8,balance_constant_1[_0x5eddf4(0x29a)][_0x5eddf4(0x129)],_0x472f2c[_0x4ae52d],'音乐【'+_0x51408f+_0x5eddf4(0xfc),_0x1b0c9d);}async[_0x5ee955(0x11b)](_0x4b8d6b,_0x2a19dc,_0x31f757,_0x7afb2=![]){const _0xb47c18=_0x5ee955,_0x3cc26d={'structure':{'key':_0xb47c18(0x1e6),'vlrk':_0xb47c18(0x131),'desc':_0xb47c18(0x1a0)},'cover':{'key':_0xb47c18(0x1e6),'vlrk':'type1','desc':_0xb47c18(0x297)},'recover':{'key':_0xb47c18(0x1e6),'vlrk':_0xb47c18(0x131),'desc':_0xb47c18(0x1bd)},'create':{'key':_0xb47c18(0x14f),'vlrk':_0xb47c18(0x1ab),'desc':_0xb47c18(0xa3)},'thesis':{'key':_0xb47c18(0xbd),'vlrk':_0xb47c18(0x189),'desc':_0xb47c18(0x226)},'file':{'key':_0xb47c18(0x14f),'vlrk':_0xb47c18(0x1ab),'desc':_0xb47c18(0x1ce)},'theme':{'key':_0xb47c18(0x14f),'vlrk':'type2','desc':_0xb47c18(0x154)},'editor':{'key':_0xb47c18(0x123),'vlrk':'type1','desc':_0xb47c18(0xd6)},'addpage':{'key':_0xb47c18(0x14f),'vlrk':_0xb47c18(0x1ab),'desc':_0xb47c18(0x278)},'addNotes':{'key':_0xb47c18(0x14f),'vlrk':_0xb47c18(0x1ab),'desc':_0xb47c18(0x271)}},_0x4b80ab=_0x3cc26d[_0x31f757][_0xb47c18(0x1f0)],_0x4b24a1=_0x3cc26d[_0x31f757][_0xb47c18(0x20e)]+_0xb47c18(0x2ae),_0x35417b=_0x3cc26d[_0x31f757][_0xb47c18(0x20e)]+_0xb47c18(0x28b),_0x15f9b2={},_0x3c912f=await this[_0xb47c18(0x26c)][_0xb47c18(0x1bb)]([_0x4b24a1,_0x35417b,_0xb47c18(0x1c6)]);this[_0xb47c18(0xfb)](_0x4b8d6b,_0x3c912f[_0xb47c18(0x1c6)]);for(let _0x5e5c0b in _0x3c912f){_0x15f9b2[_0x5e5c0b]=Number(_0x3c912f[_0x5e5c0b])||0x0;}const _0x19f905=await this[_0xb47c18(0x1e0)](_0x4b8d6b);if(_0x19f905['vipLeavelId']){const _0x1ce1bf=await this[_0xb47c18(0x26c)][_0xb47c18(0xb1)](_0x19f905[_0xb47c18(0xf4)],model_constant_1['EModelType']['PPT']);_0x1ce1bf&&(_0x15f9b2[_0x35417b]=_0x1ce1bf[_0x3cc26d[_0x31f757][_0xb47c18(0x156)]]||0x0);}if(_0x19f905[_0xb47c18(0xd8)]||_0x19f905[_0xb47c18(0x1a9)]){if(_0x15f9b2[_0x35417b]<0x0){!_0x7afb2&&await this[_0xb47c18(0x10d)](_0x19f905,balance_constant_1[_0xb47c18(0x29a)][_0xb47c18(0x2a9)],0x0,_0xb47c18(0x15d)+_0x4b80ab+_0xb47c18(0x187),_0x2a19dc);return;}else{if(_0x15f9b2[_0x35417b]>0x0){const _0x4460c0=redisKey_constant_1['VIP_FREE']+'-'+_0x4b8d6b+'-'+_0x35417b;let _0x4c9960=await this[_0xb47c18(0x1fe)]['get']({'key':_0x4460c0}),_0x41fe85=Number(_0x4c9960||0x0);if(!_0x7afb2){if(_0x41fe85<_0x15f9b2[_0x35417b]){const _0x43fd1e=(0x0,date_1['default'])()['endOf']('d')['diff']((0x0,date_1[_0xb47c18(0x21a)])(),'s');await this['redisCacheService'][_0xb47c18(0x17a)]({'key':_0x4460c0,'val':_0x41fe85+0x1},_0x43fd1e),await this[_0xb47c18(0x10d)](_0x19f905,balance_constant_1[_0xb47c18(0x29a)][_0xb47c18(0x2a9)],0x0,_0xb47c18(0x15d)+_0x4b80ab+_0xb47c18(0x23c),_0x2a19dc);return;}}else{const _0x5d6ec2=(0x0,date_1[_0xb47c18(0x21a)])()['endOf']('d')['diff']((0x0,date_1['default'])(),'s');await this[_0xb47c18(0x1fe)]['set']({'key':_0x4460c0,'val':_0x41fe85-0x1},_0x5d6ec2);return;}}}}if(!_0x7afb2&&_0x19f905[_0xb47c18(0xfe)]<_0x15f9b2[_0x4b24a1])throw new common_1[(_0xb47c18(0xaf))]('用户余额不足，请充值',common_1[_0xb47c18(0xd7)]['BAD_REQUEST']);if(!_0x7afb2){await this['changeScore4Other'](_0x19f905,balance_constant_1['EChangeType'][_0xb47c18(0x2a9)],-_0x15f9b2[_0x4b24a1],_0xb47c18(0x15d)+_0x4b80ab+_0xb47c18(0x2a2),_0x2a19dc);return;}await this[_0xb47c18(0x10d)](_0x19f905,balance_constant_1[_0xb47c18(0x29a)]['PPT'],_0x15f9b2[_0x4b24a1],_0xb47c18(0x15d)+_0x4b80ab+_0xb47c18(0xfc),_0x2a19dc);}async[_0x5ee955(0x246)](_0x367a5e,_0x241c2f,_0x394c0b){const _0x9399dd=_0x5ee955,_0x396907=await this[_0x9399dd(0x1e0)](_0x367a5e);if(_0x396907['lifetimeVip']||_0x396907[_0x9399dd(0x1a9)]){if(_0x241c2f[_0x9399dd(0x1df)]<0x0)await this[_0x9399dd(0x10d)](_0x396907,balance_constant_1['EChangeType'][_0x9399dd(0x296)],0x0,_0x9399dd(0x179)+_0x241c2f[_0x9399dd(0x1c4)]+_0x9399dd(0x187),_0x394c0b);else{if(_0x241c2f[_0x9399dd(0x1df)]>0x0){const _0x1fc047=redisKey_constant_1[_0x9399dd(0x175)]+'-'+_0x367a5e+'-'+_0x241c2f['id'];let _0x28ac0c=await this[_0x9399dd(0x1fe)][_0x9399dd(0x1fb)]({'key':_0x1fc047}),_0x4c7569=Number(_0x28ac0c||0x0);if(_0x4c7569<_0x241c2f[_0x9399dd(0x1df)]){const _0x2ac39d=(0x0,date_1[_0x9399dd(0x21a)])()[_0x9399dd(0x202)]('d')['diff']((0x0,date_1[_0x9399dd(0x21a)])(),'s');await this['redisCacheService']['set']({'key':_0x1fc047,'val':_0x4c7569+0x1},_0x2ac39d),await this[_0x9399dd(0x10d)](_0x396907,balance_constant_1[_0x9399dd(0x29a)][_0x9399dd(0x296)],0x0,_0x9399dd(0x179)+_0x241c2f[_0x9399dd(0x1c4)]+_0x9399dd(0x23c),_0x394c0b);}else{if(_0x396907[_0x9399dd(0xfe)]<_0x241c2f[_0x9399dd(0x25b)])throw new common_1['HttpException'](_0x9399dd(0x25e),common_1[_0x9399dd(0xd7)][_0x9399dd(0x2a6)]);await this[_0x9399dd(0x10d)](_0x396907,balance_constant_1[_0x9399dd(0x29a)]['WORKFLOW'],-_0x241c2f[_0x9399dd(0x25b)],_0x9399dd(0x179)+_0x241c2f['modelName']+_0x9399dd(0x2a2),_0x394c0b);}}else{if(_0x396907[_0x9399dd(0xfe)]<_0x241c2f[_0x9399dd(0x25b)])throw new common_1[(_0x9399dd(0xaf))](_0x9399dd(0x25e),common_1[_0x9399dd(0xd7)][_0x9399dd(0x2a6)]);await this[_0x9399dd(0x10d)](_0x396907,balance_constant_1[_0x9399dd(0x29a)][_0x9399dd(0x296)],-_0x241c2f[_0x9399dd(0x25b)],_0x9399dd(0x179)+_0x241c2f[_0x9399dd(0x1c4)]+_0x9399dd(0x2a2),_0x394c0b);}}}else{if(_0x396907[_0x9399dd(0xfe)]<_0x241c2f[_0x9399dd(0x25b)])throw new common_1[(_0x9399dd(0xaf))](_0x9399dd(0x25e),common_1[_0x9399dd(0xd7)][_0x9399dd(0x2a6)]);await this[_0x9399dd(0x10d)](_0x396907,balance_constant_1[_0x9399dd(0x29a)][_0x9399dd(0x296)],-_0x241c2f['deduct'],_0x9399dd(0x179)+_0x241c2f['modelName']+_0x9399dd(0x2a2),_0x394c0b);}}async[_0x5ee955(0x27f)](_0x3378c1,_0x47f229){const _0x12c9c2=_0x5ee955,_0x5d6c18=store_1['CZConfig'][_0x12c9c2(0x2a7)],_0x5f39ee=await this[_0x12c9c2(0x1e0)](_0x3378c1),_0x3a863b=balance_constant_1[_0x12c9c2(0x29a)]['SD'];if(_0x5f39ee[_0x12c9c2(0xd8)]||_0x5f39ee[_0x12c9c2(0x1a9)]){if(store_1[_0x12c9c2(0x18a)][_0x12c9c2(0x2a1)]<0x0)await this[_0x12c9c2(0x10d)](_0x5f39ee,_0x3a863b,0x0,'SD绘画会员永久免费',_0x47f229);else{if(store_1[_0x12c9c2(0x18a)][_0x12c9c2(0x2a1)]>0x0){const _0xbcb4=redisKey_constant_1[_0x12c9c2(0x175)]+'-'+_0x3378c1+_0x12c9c2(0xc7);let _0x1bf337=await this[_0x12c9c2(0x1fe)][_0x12c9c2(0x1fb)]({'key':_0xbcb4}),_0x576a7b=Number(_0x1bf337||0x0);if(_0x576a7b<store_1[_0x12c9c2(0x18a)][_0x12c9c2(0x2a1)]){const _0x4193fa=(0x0,date_1[_0x12c9c2(0x21a)])()[_0x12c9c2(0x202)]('d')[_0x12c9c2(0xde)]((0x0,date_1[_0x12c9c2(0x21a)])(),'s');await this[_0x12c9c2(0x1fe)][_0x12c9c2(0x17a)]({'key':_0xbcb4,'val':_0x576a7b+0x1},_0x4193fa),await this[_0x12c9c2(0x10d)](_0x5f39ee,_0x3a863b,0x0,'SD绘画【'+_0x5d6c18+_0x12c9c2(0x23c),_0x47f229);}else await this[_0x12c9c2(0x10d)](_0x5f39ee,_0x3a863b,-_0x5d6c18,'SD绘画【'+_0x5d6c18+_0x12c9c2(0x2a2),_0x47f229);}else await this['changeScore4Other'](_0x5f39ee,_0x3a863b,-_0x5d6c18,_0x12c9c2(0x1ef)+_0x5d6c18+_0x12c9c2(0x2a2),_0x47f229);}}else await this['changeScore4Other'](_0x5f39ee,_0x3a863b,-_0x5d6c18,'SD绘画【'+_0x5d6c18+_0x12c9c2(0x2a2),_0x47f229);}async[_0x5ee955(0xff)](_0x2e885b){const _0x929a08=_0x5ee955;let _0x31f568;const _0x41835d=await this[_0x929a08(0x1b0)][_0x929a08(0x1b5)]('HumanApiConfig');if(_0x41835d)return _0x41835d[_0x929a08(0x90)][_0x2e885b];return _0x31f568;}async['getHumanModelVipFree'](_0x3efbbf,_0x1cfcdb){const _0x480a13=_0x5ee955,_0x435837=this['getHumanConfig'](_0x1cfcdb);if(!_0x435837)return 0x0;const _0x3ce74b=redisKey_constant_1[_0x480a13(0x175)]+'-'+_0x3efbbf+'-'+_0x1cfcdb;let _0x38078a=await this[_0x480a13(0x1fe)][_0x480a13(0x1fb)]({'key':_0x3ce74b}),_0xa3cc46=Number(_0x38078a||0x0);return _0xa3cc46;}async[_0x5ee955(0x159)](_0x11b30a,_0x5d6700){const _0xc98ccc=_0x5ee955,_0x4477a3=redisKey_constant_1[_0xc98ccc(0x175)]+'-'+_0x11b30a+'-'+_0x5d6700['id'];let _0x40f7d8=await this[_0xc98ccc(0x1fe)]['get']({'key':_0x4477a3}),_0x202697=Number(_0x40f7d8||0x0);return _0x5d6700['vipFreeNum']-_0x202697;}async[_0x5ee955(0x26d)](_0x4d27ee,_0x24cf18){const _0x3bab4d=_0x5ee955;let _0x35a673;const _0x916c1e=await this[_0x3bab4d(0x1b0)][_0x3bab4d(0x1b5)](_0x3bab4d(0x107));if(_0x916c1e){const _0xf56720=_0x916c1e[_0x3bab4d(0x245)][_0x4d27ee[_0x3bab4d(0x1ba)]['toString']()];let _0x262f13=_0x24cf18[_0x3bab4d(0x126)],_0x47c8e6=_0x24cf18['duration'];_0x35a673=_0xf56720[_0x3bab4d(0x105)](_0xdbc620=>_0xdbc620[_0x3bab4d(0xf1)]==_0x24cf18[_0x3bab4d(0xf1)]&&_0xdbc620[_0x3bab4d(0x126)]==_0x262f13&&_0xdbc620[_0x3bab4d(0x12c)]==_0x47c8e6);}return _0x35a673;}async[_0x5ee955(0x141)](_0x1d67f1,_0x26e43b,_0x347ddf){const _0xf807b5=_0x5ee955;let _0x576f44=await this[_0xf807b5(0x26d)](_0x26e43b,_0x347ddf);if(!_0x576f44)return await this[_0xf807b5(0x159)](_0x1d67f1,_0x26e43b);const _0x2f78e7=redisKey_constant_1['VIP_FREE']+'-'+_0x1d67f1+'-'+_0x576f44['model']+'-'+_0x576f44['mode']+'-'+_0x576f44[_0xf807b5(0x12c)];let _0x5e43ae=await this['redisCacheService'][_0xf807b5(0x1fb)]({'key':_0x2f78e7}),_0x1e51ba=Number(_0x5e43ae||0x0);return _0x576f44[_0xf807b5(0x1df)]-_0x1e51ba;}async[_0x5ee955(0x16f)](_0x4f5345,_0x4fcf43){const _0x59de54=_0x5ee955,_0x2fd2f2=redisKey_constant_1['VIP_FREE']+'-'+_0x4f5345+'-'+_0x4fcf43[_0x59de54(0xf1)];let _0x1c7f68=await this['redisCacheService'][_0x59de54(0x1fb)]({'key':_0x2fd2f2}),_0x2587a9=Number(_0x1c7f68||0x0);return _0x4fcf43[_0x59de54(0x1df)]-_0x2587a9;}async['getCozeModelVipFree'](_0x4a0ec3,_0x1f1753,_0x315fdf){const _0x313ffd=_0x5ee955,_0x1e8c50=redisKey_constant_1['VIP_FREE']+'-'+_0x4a0ec3+'-'+_0x1f1753;let _0x55f8d8=await this[_0x313ffd(0x1fe)][_0x313ffd(0x1fb)]({'key':_0x1e8c50}),_0x4b48be=Number(_0x55f8d8||0x0);return _0x315fdf-_0x4b48be;}async[_0x5ee955(0xa7)](_0xc3f7c0){const _0x4c2f31=_0x5ee955,_0x5c7bca=redisKey_constant_1[_0x4c2f31(0x175)]+'-'+_0xc3f7c0+'-LinkFox';let _0x37a0db=await this[_0x4c2f31(0x1fe)]['get']({'key':_0x5c7bca}),_0x19efb1=Number(_0x37a0db||0x0);return store_1['LinkFoxConfig'][_0x4c2f31(0x19f)]-_0x19efb1;}async[_0x5ee955(0x148)](_0x3fdd3e,_0x509fea,_0xeff495){const _0x3677f9=_0x5ee955;let _0x153dff=await this[_0x3677f9(0x1fe)][_0x3677f9(0x1fb)]({'key':_0x509fea}),_0x5a80a2=Number(_0x153dff||0x0);return _0xeff495-_0x5a80a2;}async['validateBalanceLinxFox'](_0x5bca6d){const _0x35bab4=_0x5ee955;let _0x2a8a22=!![];const _0x533485=await this[_0x35bab4(0x1e0)](_0x5bca6d);if(_0x533485[_0x35bab4(0xd8)]||_0x533485['vipExpire']){if(store_1[_0x35bab4(0x257)][_0x35bab4(0x19f)]<0x0)_0x2a8a22=!![];else{if(store_1[_0x35bab4(0x257)][_0x35bab4(0x19f)]>0x0){const _0x46af2e=await this[_0x35bab4(0xa7)](_0x5bca6d);_0x46af2e>0x0?_0x2a8a22=!![]:_0x2a8a22=_0x533485['score']>=store_1[_0x35bab4(0x257)][_0x35bab4(0xf5)];}else _0x2a8a22=_0x533485[_0x35bab4(0xfe)]>=store_1[_0x35bab4(0x257)][_0x35bab4(0xf5)];}}else _0x2a8a22=_0x533485[_0x35bab4(0xfe)]>=store_1[_0x35bab4(0x257)][_0x35bab4(0xf5)];if(!_0x2a8a22)throw new common_1[(_0x35bab4(0xaf))](_0x35bab4(0x25e),common_1[_0x35bab4(0xd7)][_0x35bab4(0x2a6)]);}async[_0x5ee955(0x124)](_0x2904e8,_0x2f6f72){const _0x201e25=_0x5ee955,_0x4f5188=store_1['LinkFoxConfig'][_0x201e25(0xf5)],_0x592cf5=await this[_0x201e25(0x1e0)](_0x2904e8),_0x5d39fb=balance_constant_1['EChangeType'][_0x201e25(0x23e)];if(_0x592cf5[_0x201e25(0xd8)]||_0x592cf5[_0x201e25(0x1a9)]){if(store_1[_0x201e25(0x257)][_0x201e25(0x19f)]<0x0)await this['changeScore4Other'](_0x592cf5,_0x5d39fb,0x0,_0x201e25(0x22b),_0x2f6f72);else{if(store_1['LinkFoxConfig']['lfVipFree']>0x0){const _0x50aed5=redisKey_constant_1['VIP_FREE']+'-'+_0x2904e8+_0x201e25(0x18e);let _0x551ff8=await this[_0x201e25(0x1fe)][_0x201e25(0x1fb)]({'key':_0x50aed5}),_0xaf5586=Number(_0x551ff8||0x0);if(_0xaf5586<store_1[_0x201e25(0x257)][_0x201e25(0x19f)]){const _0x201e24=(0x0,date_1[_0x201e25(0x21a)])()['endOf']('d')[_0x201e25(0xde)]((0x0,date_1[_0x201e25(0x21a)])(),'s');await this[_0x201e25(0x1fe)][_0x201e25(0x17a)]({'key':_0x50aed5,'val':_0xaf5586+0x1},_0x201e24),await this[_0x201e25(0x10d)](_0x592cf5,_0x5d39fb,0x0,_0x201e25(0x1c1)+_0x4f5188+_0x201e25(0x23c),_0x2f6f72);}else await this[_0x201e25(0x10d)](_0x592cf5,_0x5d39fb,-_0x4f5188,_0x201e25(0x231)+_0x4f5188+_0x201e25(0x2a2),_0x2f6f72);}else await this['changeScore4Other'](_0x592cf5,_0x5d39fb,-_0x4f5188,_0x201e25(0x231)+_0x4f5188+_0x201e25(0x2a2),_0x2f6f72);}}else await this[_0x201e25(0x10d)](_0x592cf5,_0x5d39fb,-_0x4f5188,_0x201e25(0x231)+_0x4f5188+'】使用扣减',_0x2f6f72);}async[_0x5ee955(0x1d3)](){const _0x5eaff0=_0x5ee955,_0x202b31=await this[_0x5eaff0(0x153)][_0x5eaff0(0x105)]({'where':{'vipExpire':(0x0,typeorm_2[_0x5eaff0(0x9a)])((0x0,date_1[_0x5eaff0(0x21a)])()[_0x5eaff0(0x1f1)]('d')['toDate'](),(0x0,date_1[_0x5eaff0(0x21a)])()[_0x5eaff0(0x202)]('d')[_0x5eaff0(0x261)]())}});if(_0x202b31['length'])for(let _0x2f790d=0x0;_0x2f790d<_0x202b31[_0x5eaff0(0x1a3)];_0x2f790d++){const _0x1e003d=_0x202b31[_0x2f790d];await this['redisCacheService'][_0x5eaff0(0x17a)]({'key':redisKey_constant_1[_0x5eaff0(0xc5)]+_0x1e003d['id'],'val':''},(0x0,date_1[_0x5eaff0(0x21a)])()[_0x5eaff0(0x202)]('d')[_0x5eaff0(0xde)]((0x0,date_1['default'])(),'s'));}const _0xbcee5f=await this[_0x5eaff0(0x153)]['find']({'where':{'vipExpire':(0x0,typeorm_2[_0x5eaff0(0x1bf)])((0x0,date_1['default'])()[_0x5eaff0(0x261)]())}});if(_0xbcee5f[_0x5eaff0(0x1a3)]){const _0x1fb19b=_0xbcee5f['map'](_0x36f66c=>_0x36f66c['id']);await this['userEntity'][_0x5eaff0(0xba)]({'id':(0x0,typeorm_2['In'])(_0x1fb19b)},{'vipExpire':null,'vipLeavelId':0x0,'vipLeavelName':''});}}async[_0x5ee955(0x281)](_0xf1462b,_0x57102d,_0x2d2d9e){const _0xd2e7c5=_0x5ee955,_0x40f7b5=(0x0,utils_1[_0xd2e7c5(0x172)])(this[_0xd2e7c5(0xec)]),_0x57f079=await this[_0xd2e7c5(0x8d)][_0xd2e7c5(0x1da)]({'where':{'userId':_0xf1462b,'relId':_0x57102d,'relType':_0x2d2d9e,'saasId':_0x40f7b5}});if(_0x57f079)throw new common_1[(_0xd2e7c5(0xaf))](_0xd2e7c5(0x1cb),common_1['HttpStatus']['BAD_REQUEST']);else await this[_0xd2e7c5(0x8d)][_0xd2e7c5(0xbc)]({'userId':_0xf1462b,'relId':_0x57102d,'relType':_0x2d2d9e,'sassId':_0x40f7b5});}async['uncollect'](_0x34be55,_0x2e5aef,_0x1f2bb3){const _0x10fd1b=_0x5ee955,_0x2c0a65=(0x0,utils_1[_0x10fd1b(0x172)])(this['clsService']),_0x1f7b3c=await this[_0x10fd1b(0x8d)][_0x10fd1b(0x1da)]({'where':{'userId':_0x34be55,'relId':_0x2e5aef,'relType':_0x1f2bb3,'saasId':_0x2c0a65}});if(!_0x1f7b3c)throw new common_1['HttpException']('您还未收藏过该内容',common_1[_0x10fd1b(0xd7)][_0x10fd1b(0x2a6)]);else await this['userCollectEntity'][_0x10fd1b(0x15c)]({'id':_0x1f7b3c['id']});}async[_0x5ee955(0x138)](_0x15d623,_0x222459){const _0x1efa7b=_0x5ee955,_0x36bf30=(0x0,utils_1[_0x1efa7b(0x172)])(this[_0x1efa7b(0xec)]);_0x15d623['forEach'](_0x525184=>{const _0x38ea5a=_0x1efa7b,_0x859d4b=Number(_0x525184);this['userCollectEntity'][_0x38ea5a(0x15c)]({'relId':_0x859d4b,'relType':_0x222459,'saasId':_0x36bf30});});}async['collectPage'](_0x58ad1a,_0x706a3,_0x4f84a4,_0x3321a7){const _0x25509c=_0x5ee955,_0x22b1ed=(0x0,utils_1[_0x25509c(0x172)])(this[_0x25509c(0xec)]),[_0x437285,_0x1422cc]=await this[_0x25509c(0x8d)][_0x25509c(0x27d)]({'where':{'userId':_0x4f84a4,'relType':_0x3321a7,'saasId':_0x22b1ed},'take':_0x706a3,'skip':(_0x58ad1a-0x1)*_0x706a3,'order':{'createdAt':'DESC'}});return{'rows':_0x437285,'count':_0x1422cc};}async[_0x5ee955(0x19e)](_0x41b7f6,_0xc65fed,_0x39d2e9){const _0x490cb2=_0x5ee955,_0x534bbd=(0x0,utils_1[_0x490cb2(0x172)])(this['clsService']);return await this[_0x490cb2(0x8d)][_0x490cb2(0x105)]({'where':{'userId':_0xc65fed,'relType':_0x39d2e9,'saasId':_0x534bbd,'relId':(0x0,typeorm_2['In'])(_0x41b7f6)}});}async[_0x5ee955(0x14d)](_0x8eff16,_0x283294){const _0x1fa17a=_0x5ee955,_0x55d79b=(0x0,utils_1['getReqSaasId'])(this[_0x1fa17a(0xec)]);return await this[_0x1fa17a(0x8d)][_0x1fa17a(0x105)]({'where':{'relType':_0x283294,'saasId':_0x55d79b,'relId':(0x0,typeorm_2['In'])(_0x8eff16)}});}async['mergeCollectDataForUserId'](_0x4f3893,_0x5b21ff,_0x57bb55=collectType_constant_1[_0x5ee955(0x184)][_0x5ee955(0x2a9)]){const _0xddc711=_0x5ee955;let _0x4570c6=Object[_0xddc711(0xb4)](_0x4f3893),_0xe65d9f=[];return _0x5b21ff&&(_0xe65d9f=await this[_0xddc711(0x19e)](_0x4f3893[_0xddc711(0x191)](_0x32639f=>_0x32639f['id']),_0x5b21ff,_0x57bb55)),_0x4570c6['forEach'](_0x20ea4c=>{const _0x4a5b8b=_0xddc711;_0xe65d9f[_0x4a5b8b(0x105)](_0x24a5c0=>_0x24a5c0[_0x4a5b8b(0x121)]==_0x20ea4c['id'])?_0x20ea4c[_0x4a5b8b(0x2a3)]=!![]:_0x20ea4c[_0x4a5b8b(0x2a3)]=![];}),_0x4570c6;}async[_0x5ee955(0x115)](_0x5685ce,_0x57be79,_0x455463=collectType_constant_1[_0x5ee955(0x184)]['PPT']){return this['mergeCollectDataForUserId'](_0x5685ce,_0x57be79['user']?.['id'],_0x455463);}async[_0x5ee955(0x171)](_0x25ad56,_0x1bb3df=collectType_constant_1[_0x5ee955(0x184)][_0x5ee955(0x2a9)]){const _0x1edd5c=_0x5ee955;let _0x2b68e4=Object[_0x1edd5c(0xb4)](_0x25ad56),_0x594a30=[];return _0x594a30=await this[_0x1edd5c(0x14d)](_0x25ad56['map'](_0x1ecb88=>_0x1ecb88['id']),_0x1bb3df),_0x2b68e4[_0x1edd5c(0x295)](_0x50b4c=>{const _0x100b1a=_0x1edd5c;_0x50b4c['collectNum']=_0x594a30['filter'](_0x3bd213=>_0x3bd213[_0x100b1a(0x121)]==_0x50b4c['id'])['length'];}),_0x2b68e4;}[_0x5ee955(0x114)](_0x24757a){const _0x277f4a=_0x5ee955;let _0x24c8eb=null;const _0x2ac20b=_0x24757a[_0x277f4a(0x160)][_0x277f4a(0x28e)];if(_0x2ac20b&&_0x2ac20b['startsWith'](_0x277f4a(0x108))){const _0x524fd3=_0x2ac20b[_0x277f4a(0x19b)](0x7);if(_0x524fd3)try{_0x24c8eb=jwt[_0x277f4a(0x183)](_0x524fd3,process[_0x277f4a(0xe9)][_0x277f4a(0x119)]);}catch(_0x25d2e0){console[_0x277f4a(0x1b3)](_0x277f4a(0xb3),_0x24757a);}}return _0x24c8eb;}};UserService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,common_1[_0x5ee955(0x1d5)])(_0x5ee955(0x195))),__param(0x1,(0x0,typeorm_1[_0x5ee955(0x1b4)])(user_entity_1[_0x5ee955(0xb5)])),__param(0x2,(0x0,typeorm_1[_0x5ee955(0x1b4)])(saas_entity_1[_0x5ee955(0xfa)])),__param(0x3,(0x0,typeorm_1[_0x5ee955(0x1b4)])(role_entity_1[_0x5ee955(0x1a6)])),__param(0x4,(0x0,typeorm_1[_0x5ee955(0x1b4)])(user_init_vip_entity_1['UserInitVipEntity'])),__param(0x5,(0x0,typeorm_1[_0x5ee955(0x1b4)])(userFavorite_entity_1['UserFavoriteEntity'])),__param(0x6,(0x0,typeorm_1[_0x5ee955(0x1b4)])(userCollect_entity_1[_0x5ee955(0x1ad)])),__param(0x7,(0x0,typeorm_1['InjectRepository'])(dict_entity_1['DictEntity'])),__metadata(_0x5ee955(0x134),[Object,typeorm_2[_0x5ee955(0x17f)],typeorm_2[_0x5ee955(0x17f)],typeorm_2[_0x5ee955(0x17f)],typeorm_2[_0x5ee955(0x17f)],typeorm_2[_0x5ee955(0x17f)],typeorm_2[_0x5ee955(0x17f)],typeorm_2[_0x5ee955(0x17f)],nestjs_cls_1[_0x5ee955(0xf9)],mailer_1[_0x5ee955(0x158)],redisCache_service_1[_0x5ee955(0x120)],userBalance_service_1[_0x5ee955(0x24f)],globalConfig_service_1['GlobalConfigService'],verification_service_1[_0x5ee955(0x198)],cm_service_1['CmConfigService'],typeorm_2[_0x5ee955(0x11d)]])],UserService),exports[_0x5ee955(0x196)]=UserService;