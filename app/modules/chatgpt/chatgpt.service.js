'use strict';const _0x434455=_0x5d1e;function _0x5d1e(_0x35978a,_0x30968c){const _0x433a5c=_0x433a();return _0x5d1e=function(_0x5d1e85,_0x1f7fac){_0x5d1e85=_0x5d1e85-0x12f;let _0x3a591b=_0x433a5c[_0x5d1e85];return _0x3a591b;},_0x5d1e(_0x35978a,_0x30968c);}(function(_0x56176c,_0x2979b4){const _0x52be89=_0x5d1e,_0x4c7a07=_0x56176c();while(!![]){try{const _0x477a5b=-parseInt(_0x52be89(0x146))/0x1+parseInt(_0x52be89(0x13b))/0x2*(parseInt(_0x52be89(0x25a))/0x3)+-parseInt(_0x52be89(0x1d0))/0x4+parseInt(_0x52be89(0x33f))/0x5*(-parseInt(_0x52be89(0x1d4))/0x6)+-parseInt(_0x52be89(0x1ee))/0x7*(-parseInt(_0x52be89(0x295))/0x8)+parseInt(_0x52be89(0x15a))/0x9*(parseInt(_0x52be89(0x1ae))/0xa)+parseInt(_0x52be89(0x2a8))/0xb*(parseInt(_0x52be89(0x1c2))/0xc);if(_0x477a5b===_0x2979b4)break;else _0x4c7a07['push'](_0x4c7a07['shift']());}catch(_0x43e82c){_0x4c7a07['push'](_0x4c7a07['shift']());}}}(_0x433a,0x89014));function _0x433a(){const _0x1c3ce3=['Logger','\x20回复数不得大于等于模型上下文数,\x20已自动调整为\x20maxTokenRes:\x20','当前模型key余额已耗尽','@nestjs/typeorm','gpt-3','392IKKTFB','listTaskByIds','kling-video_std_5','api','collectPage','model','music-task','video-task','editorUrl','服务异常、请重新试试吧！！！','remove\x20file\x20%s\x20success','cwd','defaultBaseUrl','chat','getGroupInfoFromId','%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20p.sub_title\x20LIKE\x20(\x27%','pptReCover','__param','chatMuiscTask','4521vVUWwV','url','bad\x20response\x20status\x20code\x20307','[耗时打印]保存文件耗时：','isSuper','chatMusic','buildOptions','16k','openai','TTS','push','debuctBalance4PPT','abort','type','AUC7419233800922468658','audio2text\x20','page_count','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','task_status','tts','creat','preview_url','Catch\x20Error\x20','openaiModel3MaxTokensRes','message_id','saveVoiceChat','openAiErrHandler','complex','DeductionKey','openaiBaseUrl','pptTaskEntity','request\x20gpt\x20','listByGroupId','https://api.openai.com','once','remove\x20file\x20','GptsService','runwayTaskService','getModelById','created_at','download_url','\x20model:\x20','statusCode','你当前使用的应用已被下架、请删除当前对话开启新的对话吧！','klingTaskService','totalTokens','32k','join','setHeader','apiKey','formatDate','saveMindTask','createReadStream','from','make_instrumental','ratio','userService','metadata','stream','REDIS_USER','author','getOwnPropertyDescriptor','%\x27)\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','get','PPT不存在','ChatGroupService','../api/runwayTask.service','lockKey','timeout','conversationId','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','key\x20%s,\x20proxy\x20%s','Speech_Synthesis7418877984234656063','floor','is_end','split','decorate','getConfigByKeys','pptOutlinePrice','音乐生成失败，没有响应','response.length','../api/doubao.service','requestFromGpt','../../common/constants/balance.constant','vipFreeNum','HttpStatus','fontName','data','chatMusicLyrics','.png','checkBadWords','code','system','getReqSaasId','task_result','style','accessToken','klingChatVideo','同步PPT生成任务进度失败！','image','subTitle','state','语音转换失败','./../user/user.service','THEME','Content-Type','chatProcess','EMusicTaskType','choices','catalogs','application/octet-stream','transition','DALL-E2','ADDPAGE','提供了错误的模型秘钥、已冻结当前调用Key、请重新尝试对话！','finish_reason','SunoTaskService','contents','BV700_streaming','object','end','badwordsService','../api/sunoTask.service','validateVideoBeforeChat','randomUUID','parse','Your\x20request\x20was\x20rejected\x20as\x20a\x20result\x20of\x20our\x20safety\x20system','EChatType','BAD_REQUEST','DRAW','progress','getUserModelFree','baseURL','webroot','parentMessageId','post','sendMessage','Unauthorized','deductBalance4Chat','runwayChatVideo','checkUserStatus','VIDEO','connection','messages','../mindTask/mindTask.service','status','LumaTaskService','STRUCTURE','REDIS_HOST','UserCollectType','@nestjs/common','2645105cIRWqd','200','systemPreMessage','task_id','\x20key\x20->\x20','musicCreate','unifiedFormattingResponse','mkdirSync','downUrl','getKeyFree','state_description','openaiTimeoutMs','groupId','transaction','pptResult','set','pageCount','pptDel','内容提取失败','mergeCollectData','400\x20error','debuctBalance4Muisc','The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.','getRandomAudioKey','openaiModel4MaxTokens','mp3','result','ASR','@keyv/redis','CREATE','当前模型不是聊天模型、已冻结当前调用Key、请重新尝试对话！','promptTokens','你是\x20Kimi，由\x20Moonshot\x20AI\x20提供的人工智能助手，你更擅长中文和英文的对话。你会为用户提供安全，有帮助，','AutoreplyService','modelName','THESIS','../api/lumaTask.service','pptCover','file','Please\x20check\x20the\x20back-end\x20console','当前模型key余额已耗尽、已冻结当前调用Key、尝试重新对话试试吧！','messageStore','FILE','images','uploadFile','appid','musicCreatePrice','succeed','msg','relId','/api/chatgpt/notify-asr','gen2','chatMusicUpload','initOpenAi','模型秘钥错误或模型金额不足，请联系管理员！','globalConfigService','MUSIC','string','proxyUrl','getModelByKeyType','schoolPicture','getClientIp','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.type,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.user_id\x20AS\x20userId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.sub_title\x20AS\x20subTitle,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.theme,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.catalogs,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.contents,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.notes,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.author,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.color,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.style,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.state_desc\x20as\x20stateDesc,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.font_name\x20AS\x20fontName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.transition,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.complex,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.cover_id\x20AS\x20coverId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.origin_id\x20AS\x20originId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.file_url\x20AS\x20fileUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.pleader,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.advisor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school_logo\x20AS\x20schoolLogo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school_picture\x20AS\x20schoolPicture,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.slide_number\x20AS\x20slideNumber,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.slide_type\x20AS\x20slideType,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.yoo_task_id\x20AS\x20yooTaskId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.res_cover\x20AS\x20resCover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.editor_url\x20as\x20editorUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.images,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.preview_url\x20as\x20previewUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.pdf_down_url\x20as\x20pdfDownUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.png_down_url\x20as\x20pngDownUrl\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ppt_task\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20p.user_id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','startTime','saveGptsUseLog','PAYMENT_REQUIRED','mindTaskId','当前模型不是聊天模型','Like','EModelType','Injectable','VIP_FREE','gomaxAiStore','png','GlobalConfigService','kimiUpload','file-extract','now','ids','PPT','role','defineProperty','../api/yooPPT.service','lumaVideoTask','2QYDjRN','files','b64_json','KLingTaskService','musicUploadVipFree','http','PPT\x20任务不存在！','writeFileSync','sendMessageFromZhipu','refundBalance4Chat','no-cache','721381PpAmUU','voiceChat','syncLumaTask','VipFree','function','https://','emit','musicLyricsVipFree','pptService','user','buffer','__esModule','[耗时打印]文字转语音耗时：','pptStructure','findAndCount','yooTaskId','Content-type','/upload','[耗时打印]语音转文字耗时：','volcano_tts','59949dCkztg','autoreplyService','toString','deduct','./spark','/api/chatLog/notify-Suno-upload?id=','replace','user_prompt','preset','当前模型key已被封禁','apiBaseUrl','video_url','../../common/constants/errorMessage.constant','text','/api/v3','OTHER','mindTaskService','count','REDIS_PASSWORD','ClsService','fileUrl','gomaxai-default-key','slideNumber','getVideoFree','all','chatDraw','forEach','errMsg','模型秘钥错误或模型余额不足','catch','/api/chatLog/notify-Suno-lyrics?id=','title','pptCreateThesis','toISOString','asr','existsSync','musicUploadPrice','abs','includes','YooPPTService','updated_at','gomaxai-chatlog','transcriptions','keyType','musicCreateVipFree','pptConfig','EPPTTaskType','conversationOptions','modelsService','buildMessageFromParentMessageId','Beare\x20','answer','pptChangeTheme','write','BadwordsService','./helper','color','fileService','yoo_task_id','map','key:\x20','env','application/octet-stream;\x20charset=utf-8','resCover','PPTTaskEntity','pptEditorPrice','getRandomKey','pptDownload','typeorm','doubaoService','json','error',',\x20模型名称:\x20','t2v','success','configKimiApi','school','key','stringify','setData','request','getModelsByModelType','last_image','base64','270sDOSOu','checkAutoReply','mind','getRandomKeyForKeyType','email','clsService','../file/file.service','musicUpload','path','notifyAsr','SunoMusicTask','../../common/constants/redisKey.constant','slideType','slice','price','params','../models/models.service','CHAT_TYPE','Invalid\x20user\x20information','aac','20844oYWjCr','listUndoneVideo','./entity/pptTask.entity','validateBeforeChat','then','OpenAiErrorCodeMessage','parseAndSaveVideo','\x20image_url\x20','modelInfo','getVideoConfig','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','draw\x20paompt\x20info\x20<======*******======>\x20','ChatgptService','debug','1166632hZhire','video','openaiModel4MaxTokens32kRes','assistant','6JoJLoS','removeSpecialCharacters','abortController','Download','originTaskId','options','gpt-4','openaiModel3MaxTokens16kRes','pptx','configDoubaoApi','mergedOptions','delta','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','openAi','select\x20*\x20from\x20ppt_task\x20where\x20status=2\x20and\x20yoo_task_id\x20is\x20not\x20null\x20and\x20png_down_url\x20is\x20null','GOMAXAI_HOST','validateBalance4Chat','pptCreate','getTime','LessThan','pptOutline','usage','default','chatGroupService','stateDesc','\x20image_end_url\x20','150409BmpKMP','model_name','videos','绘制图片失败，此次绘画被拒绝了！','arrayBuffer','saveChatLog','pptCreatePrice','Incorrect\x20API\x20key\x20provided','RunwayTaskService','gpt_description_prompt','模型类型不存在','Repository','sunoTaskService','formatModelToken','pathname','../api/klingTask.service','tts-1','CHAT','create','prompt','SUCCEEDED','pptCollectPage','\x0a\x20\x20\x20\x20\x20\x20','progressUrl','modelType','chunked','pdf_down_url','openaiModel4MaxTokensRes','maskEmail','Connection','This\x20is\x20not\x20a\x20chat\x20model\x20and\x20thus\x20not\x20supported','theme','/v1','listAssetsBychatLogIds','modelOptions','buildSystemMessage','asyncPPTProgress','pptEditor','responseMessage','redis://','getModelInfoByKeyType','modelSubType','removeFile','.mp3','completed','phone','Price','原始任务不存在！','pptCreateVipFree','chatLogId','addOneIfOdd','/v1/images/generations','unlink','../../common/utils','signal','schoolLogo','upload','openai-draw','视频生成失败，没有响应','pptNote','thirdId','axios','log','upload2Local','__decorate','notify_hook','../chatGroup/chatGroup.service','content','appId','uuid','length','musicLyricsPrice','Bearer\x20','DESC','------------------------DEBUG-----------------------------','saveUseLog','chatRealTime','本次调用:\x20','size','toLowerCase','advisor','语音转文本失败','chatLogService','query','getModelByType','ModelsService','ChatGPTAPI','extend','coverId','sunoMusicTask','pop','detail','completionTokens','../../common/constants/collectType.constant','pptAddNote','DrawService','configChatGptApi','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.del_flag\x20=\x200\x20and\x20(type=\x27create\x27\x20or\x20type=\x27file\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','findOne','select\x20*\x20from\x20ppt_task\x20where\x20status=2\x20and\x20yoo_task_id\x20is\x20not\x20null\x20and\x20pdf_down_url\x20is\x20null','getVideoModelFree','deductBalance4Video','update','lumaTaskService','准确的回答。同时，你会拒绝一切涉及恐怖主义，种族歧视，黄色暴力等问题的回答。Moonshot\x20AI\x20为专有名词，不','close','runwayVideoTask','getModelConfig','469845kgqzEa','../../common/store','test','getCurrentModel','chatTask','i2v','MindTaskService','config','Result','HttpException','gptsService','当前请求已过载、请稍等会儿再试试吧！','select\x20*\x20from\x20ppt_task\x20where\x20\x20(status<>2\x20or\x20status\x20is\x20null\x20)and\x20yoo_task_id\x20is\x20not\x20null','modelConfig','png_down_url','Error\x20in\x20pptConfig:','message','audio','sendMessageFromSpark','\x0a\x20Respond\x20using\x20markdown.\x20\x0a\x20Current\x20date:\x20','../../common/constants/model.constant','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','pptAddPage','userId','../../common/constants/music.constant','未配置语音模型或语音模型key，请配置并启用语音功能！','uncollectByRelIds','luma-video','../badwords/badwords.service','gpts','ChatLogService','pptPage','openaiModel4MaxTokens32k','FileService','getModelVipFree','openaiModel3MaxTokens16k','klingVideoTask','importDynamic','sunoMusicId','data:\x20','resolve','REDIS_PORT','systemMessage','save','../../common/constants/ppt.constant','answerMp3','response','chatgpt','previewUrl','pleader','suno-v3','getVideoModelVipFree','../gpts/gpts.service','lyrics'];_0x433a=function(){return _0x1c3ce3;};return _0x433a();}var __decorate=this&&this[_0x434455(0x22e)]||function(_0x29fa11,_0x1ff5d8,_0xbbedda,_0x1e0c49){const _0x6b7eca=_0x434455;var _0x48784c=arguments[_0x6b7eca(0x234)],_0xd7fa57=_0x48784c<0x3?_0x1ff5d8:_0x1e0c49===null?_0x1e0c49=Object[_0x6b7eca(0x2e5)](_0x1ff5d8,_0xbbedda):_0x1e0c49,_0x1a7111;if(typeof Reflect===_0x6b7eca(0x31f)&&typeof Reflect[_0x6b7eca(0x2f4)]===_0x6b7eca(0x14a))_0xd7fa57=Reflect[_0x6b7eca(0x2f4)](_0x29fa11,_0x1ff5d8,_0xbbedda,_0x1e0c49);else{for(var _0x4721e7=_0x29fa11['length']-0x1;_0x4721e7>=0x0;_0x4721e7--)if(_0x1a7111=_0x29fa11[_0x4721e7])_0xd7fa57=(_0x48784c<0x3?_0x1a7111(_0xd7fa57):_0x48784c>0x3?_0x1a7111(_0x1ff5d8,_0xbbedda,_0xd7fa57):_0x1a7111(_0x1ff5d8,_0xbbedda))||_0xd7fa57;}return _0x48784c>0x3&&_0xd7fa57&&Object[_0x6b7eca(0x138)](_0x1ff5d8,_0xbbedda,_0xd7fa57),_0xd7fa57;},__metadata=this&&this['__metadata']||function(_0xe7f96b,_0x473b39){const _0x5bae16=_0x434455;if(typeof Reflect===_0x5bae16(0x31f)&&typeof Reflect[_0x5bae16(0x2e1)]==='function')return Reflect[_0x5bae16(0x2e1)](_0xe7f96b,_0x473b39);},__param=this&&this[_0x434455(0x2a6)]||function(_0x38bcc8,_0x31cb9c){return function(_0x3ecb1b,_0x324f48){_0x31cb9c(_0x3ecb1b,_0x324f48,_0x38bcc8);};};Object[_0x434455(0x138)](exports,_0x434455(0x151),{'value':!![]}),exports['ChatgptService']=void 0x0;const file_service_1=require(_0x434455(0x1b4)),user_service_1=require(_0x434455(0x30f)),openai_1=require(_0x434455(0x2b0)),common_1=require(_0x434455(0x33e)),errorMessage_constant_1=require(_0x434455(0x166)),utils_1=require(_0x434455(0x223)),axios_1=require(_0x434455(0x22b)),balance_constant_1=require(_0x434455(0x2fb)),chatLog_service_1=require('../chatLog/chatLog.service'),uuid=require(_0x434455(0x233)),fs=require('fs'),typeorm_1=require(_0x434455(0x19e)),typeorm_2=require(_0x434455(0x293)),badwords_service_1=require(_0x434455(0x276)),autoreply_service_1=require('../autoreply/autoreply.service'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),chatGroup_service_1=require(_0x434455(0x230)),models_service_1=require(_0x434455(0x1be)),baidu_1=require('./baidu'),helper_1=require(_0x434455(0x191)),store_1=require('./store'),zhipu_1=require('./zhipu'),spark_1=require(_0x434455(0x15e)),model_constant_1=require(_0x434455(0x26e)),fs_1=require('fs'),path_1=require(_0x434455(0x1b6)),gpts_service_1=require(_0x434455(0x28e)),yooPPT_service_1=require(_0x434455(0x139)),pptTask_entity_1=require(_0x434455(0x1c4)),ppt_constant_1=require(_0x434455(0x286)),lumaTask_service_1=require(_0x434455(0x363)),nestjs_cls_1=require('nestjs-cls'),doubao_service_1=require(_0x434455(0x2f9)),crypto_1=require('crypto'),chat_constant_1=require('../../common/constants/chat.constant'),result_1=require('../../common/result'),runwayTask_service_1=require(_0x434455(0x2ea)),klingTask_service_1=require(_0x434455(0x1fd)),sunoTask_service_1=require(_0x434455(0x322)),mindTask_service_1=require(_0x434455(0x338)),collectType_constant_1=require(_0x434455(0x24b)),redisKey_constant_1=require(_0x434455(0x1b9)),store_2=require(_0x434455(0x25b)),music_constant_1=require(_0x434455(0x272));let ChatgptService=class ChatgptService{constructor(_0x1dd7e1,_0x34acd6,_0x35e850,_0x580093,_0x217ec2,_0x264dbe,_0x1d7cb2,_0x5a2400,_0x4ffa1c,_0x12a436,_0x4a4cd2,_0xd1a344,_0xccd167,_0x62e2a7,_0xdebbb4,_0x204169,_0x37edd3,_0x1633e2,_0xf34caf){const _0x1f33f2=_0x434455;this[_0x1f33f2(0x2c6)]=_0x1dd7e1,this[_0x1f33f2(0x1b3)]=_0x34acd6,this[_0x1f33f2(0x2e0)]=_0x35e850,this[_0x1f33f2(0x193)]=_0x580093,this['gptsService']=_0x217ec2,this[_0x1f33f2(0x14e)]=_0x264dbe,this[_0x1f33f2(0x19f)]=_0x1d7cb2,this[_0x1f33f2(0x18a)]=_0x5a2400,this[_0x1f33f2(0x240)]=_0x4ffa1c,this['lumaTaskService']=_0x12a436,this[_0x1f33f2(0x2cd)]=_0x4a4cd2,this['klingTaskService']=_0xd1a344,this[_0x1f33f2(0x1fa)]=_0xccd167,this[_0x1f33f2(0x321)]=_0x62e2a7,this['autoreplyService']=_0xdebbb4,this[_0x1f33f2(0x1eb)]=_0x204169,this[_0x1f33f2(0x376)]=_0x37edd3,this[_0x1f33f2(0x336)]=_0x1633e2,this[_0x1f33f2(0x16a)]=_0xf34caf,this[_0x1f33f2(0x2a1)]='https://api.openai.com',this[_0x1f33f2(0x368)]=null,this[_0x1f33f2(0x12f)]=null,this['removeFile']=_0x34e4d9=>{const _0x287bda=_0x1f33f2;return fs[_0x287bda(0x222)](_0x34e4d9,_0x33f759=>{const _0x1becc0=_0x287bda;_0x33f759?console[_0x1becc0(0x22c)](_0x1becc0(0x2cb),_0x33f759):console['log'](_0x1becc0(0x29f),_0x34e4d9);});};}async['onModuleInit'](){const _0x559b2b=_0x434455;let _0x8eab3c=await(0x0,utils_1[_0x559b2b(0x27f)])(_0x559b2b(0x289));_0x8eab3c=_0x8eab3c?.[_0x559b2b(0x1ea)]?_0x8eab3c['default']:_0x8eab3c,this['api']=_0x8eab3c[_0x559b2b(0x244)];let _0x28b921=await(0x0,utils_1[_0x559b2b(0x27f)])('keyv');_0x28b921=_0x28b921?.['default']?_0x28b921[_0x559b2b(0x1ea)]:_0x28b921;let _0x3227b6=await(0x0,utils_1[_0x559b2b(0x27f)])(_0x559b2b(0x35b));_0x3227b6=_0x3227b6?.[_0x559b2b(0x1ea)]?_0x3227b6['default']:_0x3227b6;const _0x3d544a=+process[_0x559b2b(0x197)][_0x559b2b(0x283)],_0x44b0ce=process[_0x559b2b(0x197)][_0x559b2b(0x33c)],_0x438542=process['env'][_0x559b2b(0x16c)],_0x1d9430=process[_0x559b2b(0x197)][_0x559b2b(0x2e3)],_0x3a4676=_0x559b2b(0x215)+(_0x1d9430||'')+':'+(_0x438542||'')+'@'+_0x44b0ce+':'+_0x3d544a,_0x540e7b=new _0x3227b6(_0x3a4676);this[_0x559b2b(0x368)]=new _0x28b921({'store':_0x540e7b,'namespace':_0x559b2b(0x183)}),this[_0x559b2b(0x12f)]=new store_1['NineStore']({'store':this[_0x559b2b(0x368)],'namespace':_0x559b2b(0x2a2)}),!this[_0x559b2b(0x1e1)]&&this['initOpenAi']();}[_0x434455(0x374)](){const _0x27050f=_0x434455;this[_0x27050f(0x1e1)]=new openai_1[(_0x27050f(0x1ea))]({'apiKey':_0x27050f(0x16f),'baseURL':this['defaultBaseUrl']+_0x27050f(0x20e)});}async[_0x434455(0x259)](_0xf877db){const _0x751d87=_0x434455,{type:_0x42efcd,groupId:_0x2d31b2,modelType:_0xef67ec,officialModel:_0x1de80d,keyType:_0x1d9ad9}=_0xf877db;console[_0x751d87(0x22c)]('--------------------------------------------------------',_0xf877db);let _0x43452a,_0x348e6c;_0x42efcd&&_0x42efcd===_0x751d87(0x277)?(_0x348e6c=await this[_0x751d87(0x264)]['getGroupInfoFromId'](_0x2d31b2),_0x43452a=_0x348e6c['modelId']):_0x348e6c=await this[_0x751d87(0x1eb)][_0x751d87(0x2a3)](_0x2d31b2);let _0x1d1869;if(_0x348e6c)_0x1d1869=JSON[_0x751d87(0x325)](_0x348e6c[_0x751d87(0x261)]);else{if(_0x1d9ad9)_0x1d1869=await this[_0x751d87(0x18a)][_0x751d87(0x216)](_0xef67ec,_0x1d9ad9);else _0xef67ec?_0x1d1869=await this[_0x751d87(0x18a)][_0x751d87(0x242)](_0xef67ec,_0x1de80d):_0x1d1869=await this['modelsService']['getModelByType'](model_constant_1['EModelType']['OTHER']);}if(!_0x1d1869)throw new common_1['HttpException']('未获取到模型基础配置，请前往后台配置并启用',common_1[_0x751d87(0x2fd)][_0x751d87(0x328)]);return{'appId':_0x43452a,'modelConfig':_0x1d1869};}async[_0x434455(0x211)](_0x1d0f01){const _0x4670e2=_0x434455,_0x41f643=this;let _0x28257c='',_0x1c487c='',{type:_0x1cef02,appId:_0x58fc14,prompt:_0x562105,custom:_0xad2717,usingNetwork:_0x4c8eef,systemMessage:_0x3d84c1,customSystemMessage:_0x217233}=_0x1d0f01;const _0x63873e=async function(){const _0x5b76c4=_0x5d1e,_0x457420=new Date()[_0x5b76c4(0x17b)]()[_0x5b76c4(0x2f3)]('T')[0x0];return _0x1c487c=await _0x41f643['globalConfigService'][_0x5b76c4(0x2f5)]([_0x5b76c4(0x341)]),_0x1c487c+(_0x5b76c4(0x26d)+_0x457420);};if(_0x58fc14){const _0x11f78d=await this['gptsService']['getAppById'](_0x58fc14,0x1);if(!_0x11f78d)throw new common_1['HttpException'](_0x4670e2(0x2d3),common_1[_0x4670e2(0x2fd)][_0x4670e2(0x328)]);_0x11f78d[_0x4670e2(0x162)]&&(_0x3d84c1=_0x11f78d[_0x4670e2(0x162)]);}else{if(_0xad2717)_0x3d84c1=_0x3d84c1;else _0x217233?_0x3d84c1=_0x217233:_0x1cef02!==_0x4670e2(0x277)&&(_0x3d84c1=await _0x63873e());}return _0x4c8eef&&(_0x28257c=await(0x0,utils_1['compileNetwork'])(_0x562105),!_0x1c487c&&(_0x3d84c1=await _0x63873e())),{'systemMessage':_0x3d84c1,'netWorkPrompt':_0x28257c};}async[_0x434455(0x25d)](_0x22ee8d){const _0x846ec5=_0x434455,{type:_0xb2276d,custom:_0xfeec66,groupId:_0x5cf02d,modelConfig:_0x40b4f5}=_0x22ee8d;let _0x582357=null;if(!_0xfeec66&&!_0xb2276d){const _0x25b242=await this['modelsService']['getModelByType'](model_constant_1[_0x846ec5(0x384)][_0x846ec5(0x1ff)],_0x40b4f5[_0x846ec5(0x1ca)][_0x846ec5(0x29a)]);_0x582357=_0x25b242[_0x846ec5(0x1ca)];}else{if(_0xb2276d===_0x846ec5(0x277))_0x582357=await this[_0x846ec5(0x264)]['getCurrentModelByChatGroupId'](_0x5cf02d);else{if(_0xb2276d===_0x846ec5(0x365)){const _0x5d0e22=await this[_0x846ec5(0x18a)][_0x846ec5(0x242)](model_constant_1[_0x846ec5(0x384)][_0x846ec5(0x369)],_0x40b4f5[_0x846ec5(0x1ca)]['model']);_0x582357=_0x5d0e22[_0x846ec5(0x1ca)];}else _0xfeec66?_0x582357=await this[_0x846ec5(0x18a)][_0x846ec5(0x19c)](model_constant_1[_0x846ec5(0x384)][_0x846ec5(0x169)]):_0x582357=await this[_0x846ec5(0x18a)][_0x846ec5(0x19c)](model_constant_1['EModelType'][_0x846ec5(0x1ff)]);}}if(!_0x582357)throw new common_1[(_0x846ec5(0x263))](_0x846ec5(0x26f),common_1['HttpStatus'][_0x846ec5(0x328)]);return _0xb2276d===_0x846ec5(0x277)?_0x40b4f5[_0x846ec5(0x1ca)][_0x846ec5(0x29a)]=_0x582357[_0x846ec5(0x29a)]:_0x582357[_0x846ec5(0x29a)]=_0x40b4f5[_0x846ec5(0x1ca)][_0x846ec5(0x29a)],_0x582357;}async[_0x434455(0x323)](_0x3c7a57){const _0x2c4d6c=_0x434455,{user:_0x174c83,prompt:_0x5977df,currentRequestModel:_0x563b27}=_0x3c7a57;await this[_0x2c4d6c(0x2e0)][_0x2c4d6c(0x334)](_0x174c83),await this[_0x2c4d6c(0x321)][_0x2c4d6c(0x302)](_0x5977df,_0x174c83['id']),await this['userService']['validateBalance4Video'](_0x174c83['id'],_0x563b27,_0x3c7a57);}async[_0x434455(0x1c5)](_0x22d9aa){const _0x23a7c4=_0x434455,{user:_0x21d670,prompt:_0x5bef64,currentRequestModel:_0x9f3d7a}=_0x22d9aa;await this[_0x23a7c4(0x2e0)][_0x23a7c4(0x334)](_0x21d670),await this[_0x23a7c4(0x321)][_0x23a7c4(0x302)](_0x5bef64,_0x21d670['id']),await this['userService'][_0x23a7c4(0x1e4)](_0x21d670['id'],_0x9f3d7a);}async[_0x434455(0x2ae)](_0x1f710a,_0x110e0e,_0x39e45a){const _0x2b18ce=_0x434455,_0x3fe6c7=await this['globalConfigService'][_0x2b18ce(0x2f5)]([_0x2b18ce(0x34a)]),_0x8054ea=Number(_0x3fe6c7)||0x493e0,_0x3631e6={'timeoutMs':+_0x8054ea,'systemMessage':_0x110e0e||'','parentMessageId':_0x1f710a||'','completionParams':{'temperature':0.8,'model':_0x39e45a[_0x2b18ce(0x29a)]}};return _0x3631e6;}async[_0x434455(0x24e)](_0x210dfe,_0x150c1b){const _0xc07119=_0x434455;let _0x3b1735=_0x210dfe[_0xc07119(0x379)];if(!_0x3b1735){const _0x2ac08c=await this[_0xc07119(0x376)][_0xc07119(0x2f5)](['openaiBaseUrl']);_0x2ac08c?_0x3b1735=_0x2ac08c:_0x3b1735=_0xc07119(0x2c9);}const _0x48e68e=0x1f40,_0x3a51d7=0x1000;console[_0xc07119(0x22c)](_0xc07119(0x238),_0x210dfe);const _0x279b08=new this[(_0xc07119(0x298))]({'maxModelTokens':_0x48e68e,'apiBaseUrl':_0x3b1735+'/v1','messageStore':this[_0xc07119(0x368)],'apiKey':(0x0,utils_1[_0xc07119(0x1d5)])(_0x210dfe['key']),'maxResponseTokens':_0x3a51d7>=_0x48e68e?Math[_0xc07119(0x17f)](Math[_0xc07119(0x2f1)](_0x48e68e/0x2)):_0x3a51d7});return console['log']('apiKey',_0x279b08[_0xc07119(0x2d9)]),console[_0xc07119(0x22c)](_0xc07119(0x1de),_0x150c1b),console['log']('apiBaseUrl',_0x3b1735+'/v1'),_0x279b08;}async['configKimiApi'](_0x26b9a8){const _0x527469=_0x434455,_0x402ad0=new openai_1['default']({'baseURL':_0x26b9a8[_0x527469(0x379)]+_0x527469(0x20e)||'https://api.moonshot.cn/v1','apiKey':_0x26b9a8[_0x527469(0x1a7)]});return _0x402ad0;}async['configDoubaoApi'](_0x4547d1,_0x3045f4){const _0x1e6a2c=_0x434455;let _0x166827=_0x4547d1[_0x1e6a2c(0x379)]||'https://ark.cn-beijing.volces.com';const _0x154aa7=0x1f40,_0x240a20=0x1000,_0x235092=new this[(_0x1e6a2c(0x298))]({'maxModelTokens':_0x154aa7,'apiBaseUrl':_0x166827+'/api/v3','messageStore':this[_0x1e6a2c(0x368)],'apiKey':(0x0,utils_1[_0x1e6a2c(0x1d5)])(_0x4547d1['key']),'maxResponseTokens':_0x240a20>=_0x154aa7?Math[_0x1e6a2c(0x17f)](Math[_0x1e6a2c(0x2f1)](_0x154aa7/0x2)):_0x240a20});return console[_0x1e6a2c(0x22c)](_0x1e6a2c(0x2d9),_0x235092[_0x1e6a2c(0x2d9)]),console['log']('mergedOptions',_0x3045f4),console['log'](_0x1e6a2c(0x164),_0x166827+_0x1e6a2c(0x168)),_0x235092;}async[_0x434455(0x132)](_0x719d9c,_0x1db427,_0x59633f=null){const _0x15c126=_0x434455;let _0x4be572=[];for(const _0xb435d1 of _0x1db427){const _0x524391=new URL(_0xb435d1);let _0x477067=(0x0,path_1[_0x15c126(0x2d7)])(process[_0x15c126(0x2a0)](),_0x15c126(0x32d),_0x524391[_0x15c126(0x1fc)]);_0x477067=decodeURIComponent(_0x477067);const _0x59a681=await _0x719d9c['files'][_0x15c126(0x200)]({'file':fs[_0x15c126(0x2dc)](_0x477067),'purpose':_0x15c126(0x133)});let _0xf28c2a=await(await _0x719d9c[_0x15c126(0x13c)]['content'](_0x59a681['id']))['text']();_0x4be572[_0x15c126(0x2b2)]({'role':_0x15c126(0x304),'content':_0xf28c2a});}return _0x4be572;}async[_0x434455(0x2c2)](_0x3b9738,_0xc6e6eb){const _0x4ad26a=_0x434455;let _0xc1abec='',_0x308ba0=_0x3b9738['statusCode'];return!_0xc1abec&&(_0xc1abec=errorMessage_constant_1['OpenAiErrorCodeMessage'][_0x308ba0]?errorMessage_constant_1[_0x4ad26a(0x1c7)][_0x308ba0]:_0x4ad26a(0x29e)),_0x3b9738?.['message']['includes']('The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.')&&(await this[_0x4ad26a(0x18a)][_0x4ad26a(0x2eb)](_0xc6e6eb['id'],_0x4ad26a(0x2ee),-0x1),_0xc1abec='当前模型key已被封禁'),_0x3b9738?.[_0x4ad26a(0x2d2)]===0x1ad&&_0x3b9738[_0x4ad26a(0x26a)][_0x4ad26a(0x180)]('You\x20exceeded\x20your\x20current\x20quota,\x20please\x20check\x20your\x20plan\x20and\x20billing\x20details.')&&(await this[_0x4ad26a(0x18a)][_0x4ad26a(0x2eb)](_0xc6e6eb['id'],_0x4ad26a(0x367),-0x3),_0xc1abec=_0x4ad26a(0x292)),_0x3b9738?.['statusCode']===0x191&&_0x3b9738[_0x4ad26a(0x26a)][_0x4ad26a(0x180)](_0x4ad26a(0x1f5))&&(await this[_0x4ad26a(0x18a)]['lockKey'](_0xc6e6eb['id'],_0x4ad26a(0x176),-0x2),_0xc1abec='模型秘钥错误或模型金额不足，请联系管理员！'),_0x3b9738?.[_0x4ad26a(0x2d2)]===0x191&&(_0xc1abec=_0x4ad26a(0x375)),_0x3b9738?.[_0x4ad26a(0x2d2)]===0x191&&_0x3b9738[_0x4ad26a(0x26a)][_0x4ad26a(0x180)](_0x4ad26a(0x331))&&(await this[_0x4ad26a(0x18a)][_0x4ad26a(0x2eb)](_0xc6e6eb['id'],_0x4ad26a(0x176),-0x2),_0xc1abec='模型秘钥错误或模型金额不足，请联系管理员！'),_0x3b9738?.[_0x4ad26a(0x2d2)]===0x194&&_0x3b9738['message'][_0x4ad26a(0x180)](_0x4ad26a(0x20c))&&(await this['modelsService'][_0x4ad26a(0x2eb)](_0xc6e6eb['id'],_0x4ad26a(0x382),-0x4),_0xc1abec=_0x4ad26a(0x35d)),_0xc1abec;}[_0x434455(0x214)](_0x2685fa,_0x33e445,_0x33b6d8,_0x152775,_0x49a514){const _0x4a4442=_0x434455;if(_0x33b6d8)_0x2685fa[_0x4a4442(0x18f)](_0x4a4442(0x281)+JSON[_0x4a4442(0x1a8)](_0x33e445)+'\x0a\x0a');else _0x152775&&_0x2685fa[_0x4a4442(0x18f)](_0x49a514?JSON[_0x4a4442(0x1a8)](_0x33e445):'\x0a'+JSON[_0x4a4442(0x1a8)](_0x33e445));}async['chatProcess'](_0x50c952,_0x3e6efc,_0x1c4c31,_0x79e52b=!![],_0x106833=''){const _0x487b89=_0x434455;try{const _0x5224a3=_0x3e6efc[_0x487b89(0x1d6)],_0x2f390b=(0x0,utils_1['getReqSaasId'])(this[_0x487b89(0x1b3)]),{options:options={},prompt:_0x3c21b0,cusromPrompt:_0x3ee56e,assetsId:_0x24b8d7,autoVoice:_0x52b840}=_0x50c952,{groupId:_0x1bcac3,usingNetwork:_0x42835e,parentMessageId:_0x11c1c8,type:_0x480d5c}=options,{appId:_0x13f5f0,modelConfig:_0x370b71}=await this['getModelConfig']({'type':_0x480d5c,'groupId':_0x1bcac3}),{systemMessage:_0x32ce49,netWorkPrompt:_0x398b87}=await this[_0x487b89(0x211)]({'type':_0x480d5c,'appId':_0x13f5f0,'prompt':_0x3c21b0,'usingNetwork':_0x42835e,'custom':_0x3ee56e,'systemMessage':_0x50c952[_0x487b89(0x284)],'customSystemMessage':_0x370b71[_0x487b89(0x1ca)][_0x487b89(0x284)]}),_0x223dac=await this['getCurrentModel']({'type':_0x480d5c,'groupId':_0x1bcac3,'modelConfig':_0x370b71,'custom':_0x3ee56e});await this[_0x487b89(0x1c5)]({'prompt':_0x3c21b0,'currentRequestModel':_0x223dac,'user':_0x3e6efc['user']});const _0x1cb89f=await this[_0x487b89(0x15b)][_0x487b89(0x1af)](_0x3c21b0);_0x1c4c31&&_0x79e52b&&(!_0x50c952[_0x487b89(0x2e2)]?_0x1c4c31[_0x487b89(0x2d8)](_0x487b89(0x156),_0x487b89(0x198)):(_0x1c4c31[_0x487b89(0x2d8)](_0x487b89(0x311),'text/event-stream'),_0x1c4c31[_0x487b89(0x2d8)]('Transfer-Encoding',_0x487b89(0x207)),_0x1c4c31['setHeader']('Cache-Control',_0x487b89(0x145)),_0x1c4c31[_0x487b89(0x2d8)]('X-Accel-Buffering','no'),_0x1c4c31['setHeader']('Access-Control-Allow-Origin','*')));if(_0x1cb89f){if(_0x1c4c31&&_0x79e52b){const _0x256582={'message':_0x1cb89f,'code':0x1f4};_0x1c4c31[_0x487b89(0x18f)](JSON['stringify'](_0x256582)),_0x1c4c31[_0x487b89(0x320)]();return;}else return _0x1cb89f;}const _0x57603e=await this[_0x487b89(0x2ae)](options['parentMessageId'],_0x32ce49,_0x223dac);options[_0x487b89(0x29a)]&&(_0x57603e['completionParams']['model']=options[_0x487b89(0x29a)]);let {model:_0x4a9feb,rounds:_0xa2806d,keyType:_0x4ef49f,modelType:_0x513e16,id:_0x4d7ffe,topN:_0x4c3504}=_0x370b71[_0x487b89(0x1ca)];const {key:_0x247d90,modelName:_0x268300,id:_0x4aa631,accessToken:_0x129a33}=_0x223dac;_0x4a9feb=_0x57603e['completionParams'][_0x487b89(0x29a)];_0x1c4c31&&_0x79e52b&&_0x1c4c31[_0x487b89(0x339)](0xc8);let _0x5d1986=null,_0x41db01=null;const _0x2f9967=(0x0,utils_1[_0x487b89(0x37c)])(_0x3e6efc),_0x388ce4={'appId':_0x13f5f0,'curIp':_0x2f9967,'prompt':_0x3c21b0,'groupId':_0x1bcac3,'modelId':_0x4d7ffe,'modelType':_0x513e16,'answer':'','model':_0x4a9feb,'role':_0x487b89(0x14f),'userId':_0x3e6efc[_0x487b89(0x14f)]['id'],'completionTokens':0x0,'type':balance_constant_1[_0x487b89(0x2c4)][_0x487b89(0x1bf)],'logType':_0x480d5c===_0x487b89(0x277)?0x2:0x1,'requestOptions':JSON['stringify']({'options':options,'prompt':_0x3c21b0}),'saasId':_0x2f390b,'modelSubType':_0x106833},_0x62136d={..._0x388ce4,'role':_0x487b89(0x1d3),'requestOptions':JSON[_0x487b89(0x1a8)]({'prompt':_0x3c21b0,'options':{'model':_0x4a9feb,'temperature':_0x4c3504}})};try{if(_0x1c4c31){let _0x8cfd94=null,_0x5cc50e=![];_0x1c4c31['on'](_0x487b89(0x257),async()=>{const _0x3e9a68=_0x487b89;if(_0x5cc50e)return;_0x5224a3[_0x3e9a68(0x2b4)]();const _0x40efb4=0x0,_0x13bcf9=0x0,_0x2cbe5a=_0x40efb4+_0x13bcf9;_0x388ce4['totalTokens']=_0x40efb4,_0x388ce4['promptTokens']=_0x40efb4,await this[_0x3e9a68(0x240)]['saveChatLog'](_0x388ce4),_0x62136d[_0x3e9a68(0x18d)]=_0x8cfd94?.[_0x3e9a68(0x167)],_0x62136d[_0x3e9a68(0x2d5)]=_0x2cbe5a,_0x62136d[_0x3e9a68(0x35e)]=_0x40efb4,_0x62136d[_0x3e9a68(0x24a)]=_0x13bcf9,_0x62136d[_0x3e9a68(0x189)]=JSON['stringify']({'conversationId':_0x8cfd94?.[_0x3e9a68(0x2ed)],'model':_0x4a9feb,'parentMessageId':_0x8cfd94?.['id'],'temperature':_0x4c3504});const _0x444442=await this[_0x3e9a68(0x240)][_0x3e9a68(0x1f3)](_0x62136d);if(_0x106833==_0x3e9a68(0x1b0)){const _0x46554c=await this[_0x3e9a68(0x16a)]['saveMindTask']({'id':_0x24b8d7,'userId':_0x444442['userId'],'chatLogId':_0x444442['id'],'prompt':_0x444442['prompt'],'result':_0x62136d[_0x3e9a68(0x18d)],'status':0x1});_0x5d1986[_0x3e9a68(0x381)]=_0x46554c['id'];}await this[_0x3e9a68(0x2e0)][_0x3e9a68(0x332)](_0x3e6efc[_0x3e9a68(0x14f)]['id'],_0x223dac,_0x444442['id']);}),_0x1c4c31['on'](_0x487b89(0x1a1),_0x510326=>{console['log'](_0x510326);});if(Number(_0x4ef49f)===0x1){let _0x1a272e=!![];const _0x4bf49e=await this[_0x487b89(0x24e)](_0x223dac,_0x57603e);_0x5d1986=await _0x4bf49e[_0x487b89(0x330)](_0x42835e?_0x398b87:_0x3c21b0,{..._0x57603e,'onProgress':_0x3e3579=>{const _0x59fdc9=_0x487b89;this[_0x59fdc9(0x214)](_0x1c4c31,_0x3e3579,_0x50c952['stream'],_0x79e52b,_0x1a272e),_0x1a272e=![],_0x8cfd94=_0x3e3579;},'abortSignal':_0x5224a3['signal']}),_0x5cc50e=!![];}if(Number(_0x4ef49f)===0x2){let _0x474390=!![];const _0x485247=await this[_0x487b89(0x12f)][_0x487b89(0x18b)](_0x42835e?_0x398b87:_0x3c21b0,{'parentMessageId':_0x11c1c8,'maxRounds':(0x0,helper_1[_0x487b89(0x220)])(_0xa2806d)});_0x5d1986=await(0x0,baidu_1['sendMessageFromBaidu'])(_0x42835e?_0x398b87:_0x485247,{'temperature':_0x4c3504,'accessToken':_0x129a33,'model':_0x4a9feb,'onProgress':_0x675059=>{const _0x4bf982=_0x487b89;this[_0x4bf982(0x214)](_0x1c4c31,_0x675059,_0x50c952['stream'],_0x79e52b,_0x474390),_0x474390=![],_0x8cfd94=_0x675059;}}),_0x5cc50e=!![];}if(Number(_0x4ef49f)===0x3){let _0x1b0ef3=!![];const _0x3dec3b=await this[_0x487b89(0x12f)]['buildMessageFromParentMessageId'](_0x42835e?_0x398b87:_0x3c21b0,{'parentMessageId':_0x11c1c8,'maxRounds':(0x0,helper_1[_0x487b89(0x220)])(_0xa2806d)});console[_0x487b89(0x22c)](_0x3dec3b),_0x5d1986=await(0x0,zhipu_1[_0x487b89(0x143)])(_0x42835e?_0x398b87:_0x3dec3b,{'temperature':_0x4c3504,'key':_0x247d90,'model':_0x4a9feb,'onProgress':_0x4125e6=>{const _0x5ed969=_0x487b89;this[_0x5ed969(0x214)](_0x1c4c31,_0x4125e6,_0x50c952['stream'],_0x79e52b,_0x1b0ef3),_0x1b0ef3=![],_0x8cfd94=_0x4125e6;}}),_0x5cc50e=!![];}if(Number(_0x4ef49f)===0x4){let _0x3a93df=!![];const _0x59c1de=await this[_0x487b89(0x12f)][_0x487b89(0x18b)](_0x42835e?_0x398b87:_0x3c21b0,{'parentMessageId':_0x11c1c8,'maxRounds':(0x0,helper_1['addOneIfOdd'])(_0xa2806d)});_0x5d1986=await(0x0,spark_1[_0x487b89(0x26c)])(_0x42835e?_0x398b87:_0x59c1de,{'temperature':_0x4c3504,'key':_0x247d90,'model':_0x4a9feb,'onProgress':_0x1655a0=>{const _0x120b1a=_0x487b89;this['responseMessage'](_0x1c4c31,_0x1655a0,_0x50c952[_0x120b1a(0x2e2)],_0x79e52b,_0x3a93df),_0x3a93df=![],_0x8cfd94=_0x1655a0;}}),_0x5cc50e=!![];}if(Number(_0x4ef49f)===0x7){_0x5d1986={};const _0x14b7cb=await this[_0x487b89(0x1a5)](_0x223dac);let _0x390297=!![],_0x3d61d3=[],_0xaed8c2=!![];const _0x5c4b39=[],_0x3fb39c=[],_0x240868=_0x3c21b0[_0x487b89(0x2f3)]('\x20');for(let _0x5762ed=0x0;_0x5762ed<_0x240868['length'];_0x5762ed++){_0x390297&&/^[http:\/\/|https:\/\/]/[_0x487b89(0x25c)](_0x240868[_0x5762ed])?_0x5c4b39['push'](_0x240868[_0x5762ed]):(_0x390297=![],_0x240868[_0x5762ed]&&_0x3fb39c['push'](_0x240868[_0x5762ed]));}if(options[_0x487b89(0x32e)]){const _0x20c97b=await this[_0x487b89(0x240)][_0x487b89(0x2c8)](options[_0x487b89(0x34b)]);_0x3d61d3=_0x20c97b[_0x487b89(0x195)](_0x5b636e=>{const _0x490834=_0x487b89;return{'role':_0x5b636e['role']==='user'?_0x490834(0x14f):'system','content':_0x5b636e['prompt']||_0x5b636e[_0x490834(0x18d)]};});}const _0x391747=await this[_0x487b89(0x132)](_0x14b7cb,_0x5c4b39),_0x31ba4f=[..._0x3d61d3,..._0x391747,{'role':_0x487b89(0x304),'content':_0x487b89(0x35f)+_0x487b89(0x256)+'可翻译成其他语言。'},{'role':_0x487b89(0x14f),'content':_0x3fb39c[_0x487b89(0x2d7)]('\x20')}];console[_0x487b89(0x22c)](_0x487b89(0x2d9),_0x14b7cb[_0x487b89(0x2d9)]),console[_0x487b89(0x22c)](_0x487b89(0x1de),options),console[_0x487b89(0x22c)](_0x487b89(0x164),_0x14b7cb[_0x487b89(0x32c)]+_0x487b89(0x20e)),console[_0x487b89(0x22c)](_0x487b89(0x337),JSON[_0x487b89(0x1a8)](_0x31ba4f));const _0x43c124=await _0x14b7cb['chat']['completions'][_0x487b89(0x200)]({'stream':!![],..._0x57603e,'messages':_0x31ba4f,'model':_0x223dac[_0x487b89(0x29a)]});for await(const _0xe4b568 of _0x43c124){const _0x286bbf=_0xe4b568?.[_0x487b89(0x314)][0x0],_0x3fee1c=_0x286bbf?.[_0x487b89(0x1df)];_0x5d1986[_0x487b89(0x249)]=_0xe4b568,_0xe4b568['id']&&(_0x5d1986['id']=_0xe4b568['id']),_0x3fee1c[_0x487b89(0x137)]&&(_0x5d1986['role']=_0x3fee1c['role']),_0x3fee1c&&_0x3fee1c['content']&&(_0x5d1986[_0x487b89(0x167)]+=_0x3fee1c[_0x487b89(0x231)],_0x5d1986[_0x487b89(0x1df)]=_0x3fee1c?.['content']),_0x286bbf[_0x487b89(0x31b)]&&(_0x5d1986['text']=_0x5d1986[_0x487b89(0x167)]['trim']()),this[_0x487b89(0x214)](_0x1c4c31,_0x5d1986,_0x50c952[_0x487b89(0x2e2)],_0x79e52b,_0xaed8c2),_0xaed8c2=![],_0x8cfd94=_0xe4b568;}}if(Number(_0x4ef49f)===0x8){let _0x570a28=!![];const _0x336b44=await this[_0x487b89(0x1dd)](_0x223dac,_0x57603e);_0x5d1986=await _0x336b44[_0x487b89(0x330)](_0x42835e?_0x398b87:_0x3c21b0,{..._0x57603e,'onProgress':_0x188a16=>{this['responseMessage'](_0x1c4c31,_0x188a16,_0x50c952['stream'],_0x79e52b,_0x570a28),_0x570a28=![],_0x8cfd94=_0x188a16;},'abortSignal':_0x5224a3[_0x487b89(0x224)]}),_0x5cc50e=!![];}const _0x58c706={'id':this[_0x487b89(0x12f)]['getUuid'](),'text':_0x3c21b0,'role':_0x487b89(0x14f),'name':undefined,'usage':null,'parentMessageId':_0x11c1c8,'conversationId':_0x5d1986?.[_0x487b89(0x2ed)]||null};_0x41db01={'model':_0x4a9feb,'parentMessageId':_0x11c1c8},await this[_0x487b89(0x12f)]['setData'](_0x58c706);const _0x358791={'id':_0x5d1986?.['id']||this['gomaxAiStore']['getUuid'](),'text':_0x5d1986[_0x487b89(0x167)],'role':_0x487b89(0x1d3),'name':undefined,'usage':_0x5d1986[_0x487b89(0x1e9)],'parentMessageId':_0x58c706['id'],'conversationId':_0x5d1986?.[_0x487b89(0x2ed)]};await this[_0x487b89(0x12f)][_0x487b89(0x1a9)](_0x358791),_0x41db01={'model':_0x4a9feb,'parentMessageId':_0x58c706['id']};}else{console[_0x487b89(0x22c)]('fanyi\x20mj-associate');const _0x305c97=await this[_0x487b89(0x24e)](_0x223dac,_0x57603e);_0x5d1986=await _0x305c97[_0x487b89(0x330)](_0x42835e?_0x398b87:_0x3c21b0,_0x57603e);}const _0x78d2d8=(0x0,helper_1[_0x487b89(0x345)])(_0x4ef49f,_0x5d1986,_0x41db01),{prompt_tokens:prompt_tokens=0x0,completion_tokens:completion_tokens=0x0,total_tokens:total_tokens=0x0}=_0x78d2d8[_0x487b89(0x1e9)];_0x480d5c===_0x487b89(0x277)?await this['gptsService'][_0x487b89(0x37f)](_0x4aa631,total_tokens):await this[_0x487b89(0x18a)]['saveUseLog'](_0x4aa631,total_tokens);_0x388ce4[_0x487b89(0x2d5)]=total_tokens,await this[_0x487b89(0x240)]['saveChatLog'](_0x388ce4),_0x62136d[_0x487b89(0x18d)]=_0x78d2d8?.[_0x487b89(0x167)],_0x62136d[_0x487b89(0x2d5)]=total_tokens,_0x62136d['promptTokens']=prompt_tokens,_0x62136d[_0x487b89(0x24a)]=completion_tokens,_0x62136d[_0x487b89(0x189)]=JSON[_0x487b89(0x1a8)]({'conversationId':_0x5d1986['conversationId'],'model':_0x4a9feb,'parentMessageId':_0x5d1986['id'],'temperature':_0x4c3504});const _0x317869=await this['chatLogService'][_0x487b89(0x1f3)](_0x62136d);common_1[_0x487b89(0x290)]['debug'](_0x487b89(0x23b)+_0x3e6efc['user']['id']+'\x20model:\x20'+_0x4a9feb+_0x487b89(0x343)+_0x247d90+_0x487b89(0x1a2)+_0x268300,_0x487b89(0x1ce)),_0x5d1986[_0x487b89(0x359)]&&(_0x5d1986[_0x487b89(0x359)]=''),_0x5d1986[_0x487b89(0x2f2)]=!![],_0x5d1986[_0x487b89(0x21f)]=_0x317869['id'];_0x52b840&&setTimeout(()=>{const _0x41365b=_0x487b89;this[_0x41365b(0x2c1)](_0x3e6efc,_0x317869);},0x64);if(_0x106833=='mind'){const _0x2191d9=await this[_0x487b89(0x16a)][_0x487b89(0x2db)]({'id':_0x24b8d7,'userId':_0x317869[_0x487b89(0x271)],'chatLogId':_0x317869['id'],'prompt':_0x317869[_0x487b89(0x201)],'result':_0x62136d[_0x487b89(0x18d)],'status':0x1});_0x5d1986[_0x487b89(0x381)]=_0x2191d9['id'];}if(_0x1c4c31&&_0x79e52b)await this[_0x487b89(0x2e0)]['deductBalance4Chat'](_0x3e6efc[_0x487b89(0x14f)]['id'],_0x223dac,_0x317869['id']),_0x50c952['stream']?_0x1c4c31[_0x487b89(0x18f)]('data:\x20'+JSON[_0x487b89(0x1a8)](_0x5d1986)+'\x0a\x0a'):_0x1c4c31['write']('\x0a'+JSON[_0x487b89(0x1a8)](_0x5d1986));else return _0x5d1986['text'];}catch(_0x5c3a20){_0x62136d[_0x487b89(0x18d)]=_0x5c3a20[_0x487b89(0x26a)],_0x62136d['errMsg']=_0x5c3a20['message'],_0x62136d[_0x487b89(0x189)]=JSON[_0x487b89(0x1a8)]({'conversationId':_0x5d1986?.[_0x487b89(0x2ed)],'model':_0x4a9feb,'parentMessageId':_0x5d1986?.['id'],'temperature':_0x4c3504});const _0x26350b=await this[_0x487b89(0x240)][_0x487b89(0x1f3)](_0x62136d);if(_0x106833=='mind'){const _0x4c3c0a=await this[_0x487b89(0x16a)][_0x487b89(0x2db)]({'id':_0x24b8d7,'userId':_0x26350b[_0x487b89(0x271)],'prompt':_0x26350b[_0x487b89(0x201)],'chatLogId':_0x26350b['id'],'result':_0x62136d[_0x487b89(0x18d)],'status':-0x1});_0x5d1986[_0x487b89(0x381)]=_0x4c3c0a['id'];}const _0x41fcc8=_0x5c3a20['statusCode'];_0x41fcc8===0x190&&console[_0x487b89(0x22c)](_0x487b89(0x353),_0x5c3a20,_0x5c3a20[_0x487b89(0x26a)]);if(_0x5c3a20[_0x487b89(0x339)]&&_0x5c3a20['status']===0x192){const _0x46bb55={'message':_0x487b89(0x2be)+_0x5c3a20[_0x487b89(0x26a)],'code':0x192};if(_0x1c4c31&&_0x79e52b){_0x50c952[_0x487b89(0x2e2)]?_0x1c4c31[_0x487b89(0x18f)](_0x487b89(0x281)+JSON[_0x487b89(0x1a8)](_0x46bb55)+'\x0a\x0a'):_0x1c4c31[_0x487b89(0x18f)](JSON['stringify'](_0x46bb55));_0x1c4c31['end']();return;}else throw new common_1['HttpException'](_0x5c3a20[_0x487b89(0x26a)],common_1[_0x487b89(0x2fd)][_0x487b89(0x380)]);}if(!_0x41fcc8){if(_0x1c4c31&&_0x79e52b){_0x50c952[_0x487b89(0x2e2)]?_0x1c4c31[_0x487b89(0x18f)](_0x487b89(0x281)+JSON[_0x487b89(0x1a8)]({'message':_0x5c3a20['message'],'code':0x1f4})+'\x0a\x0a'):_0x1c4c31[_0x487b89(0x18f)](JSON[_0x487b89(0x1a8)]({'message':_0x5c3a20[_0x487b89(0x26a)],'code':0x1f4}));_0x1c4c31['end']();return;}else throw new common_1[(_0x487b89(0x263))](_0x5c3a20[_0x487b89(0x26a)],common_1['HttpStatus']['BAD_REQUEST']);}const _0x149df0=await this[_0x487b89(0x2c2)](_0x5c3a20,_0x223dac),_0x59bd8f={'message':_0x149df0||_0x487b89(0x366),'code':_0x41fcc8===0x191?0x191:_0x41fcc8||0x1f4};if(_0x1c4c31&&_0x79e52b)_0x1c4c31[_0x487b89(0x2d2)]=0x190,_0x50c952[_0x487b89(0x2e2)]?_0x1c4c31[_0x487b89(0x18f)](_0x487b89(0x281)+JSON[_0x487b89(0x1a8)](_0x59bd8f)+'\x0a\x0a'):_0x1c4c31['write'](JSON['stringify'](_0x59bd8f));else throw new common_1['HttpException'](_0x59bd8f['message'],common_1['HttpStatus'][_0x487b89(0x328)]);}finally{_0x1c4c31&&_0x79e52b&&_0x1c4c31['end']();}}catch(_0x5abb6d){if(_0x5abb6d instanceof common_1[_0x487b89(0x263)])throw _0x5abb6d;else throw new common_1[(_0x487b89(0x263))](_0x5abb6d[_0x487b89(0x26a)],common_1[_0x487b89(0x2fd)][_0x487b89(0x328)]);}}async[_0x434455(0x2c1)](_0x10d69b,_0x1bf60d){const _0x5df5a8=_0x434455,_0x5c7b4c=await this['tts'](_0x10d69b,{'request':{'text':_0x1bf60d[_0x5df5a8(0x18d)]}});_0x1bf60d[_0x5df5a8(0x287)]=_0x5c7b4c,this['chatLogService'][_0x5df5a8(0x1f3)](_0x1bf60d);}async['musicConfig'](_0xf01627){const _0x332613=_0x434455;try{const _0x402882=[_0x332613(0x235),_0x332613(0x14d),_0x332613(0x36d),_0x332613(0x186),_0x332613(0x17e),_0x332613(0x13f)],_0xd6f586=await this[_0x332613(0x376)][_0x332613(0x2f5)](_0x402882);if(!_0xf01627[_0x332613(0x14f)]||!_0xf01627[_0x332613(0x14f)]['id'])throw new Error(_0x332613(0x1c0));const _0x15b2e6=['musicLyrics',_0x332613(0x344),_0x332613(0x1b5)],_0x9d5120=await Promise[_0x332613(0x172)](_0x15b2e6[_0x332613(0x195)](async _0x1f8207=>{const _0x54a12b=_0x332613,_0x5e6f92=_0xd6f586[_0x1f8207+'VipFree'],_0x3e0241=_0xd6f586[_0x1f8207+_0x54a12b(0x21c)],_0x5ad03f=redisKey_constant_1[_0x54a12b(0x386)]+'-'+_0xf01627[_0x54a12b(0x14f)]['id']+'-'+(_0x1f8207+'VipFree'),_0x279ce2=await this[_0x54a12b(0x2e0)][_0x54a12b(0x348)](_0xf01627[_0x54a12b(0x14f)]['id'],_0x5ad03f,_0x5e6f92);return{'type':_0x1f8207,'remainCount':_0x279ce2,'freeCount':Number(_0x5e6f92),'useIntegrate':Number(_0x3e0241)};}));return _0x9d5120;}catch(_0x10c4fd){console[_0x332613(0x1a1)]('Error\x20in\x20pptConfig:',_0x10c4fd);throw _0x10c4fd;}}async['sunoMusicTask'](_0x1252ab){const _0x2f0d52=_0x434455,{data:_0x3ee49f,answerLogDTO:_0x1f3c0b,currentRequestModel:_0x5ae663,musicTaskType:_0x2bd711}=_0x1252ab;try{let _0x4eb34b=process[_0x2f0d52(0x197)][_0x2f0d52(0x1e3)];!/^http/[_0x2f0d52(0x25c)](_0x4eb34b)&&(_0x4eb34b=_0x2f0d52(0x14b)+_0x4eb34b);let _0x4befe3;if(_0x2bd711==music_constant_1[_0x2f0d52(0x313)][_0x2f0d52(0x35c)])!_0x3ee49f['isCustom']&&(_0x3ee49f[_0x2f0d52(0x1f7)]=_0x3ee49f[_0x2f0d52(0x201)],delete _0x3ee49f[_0x2f0d52(0x201)]),_0x4befe3=await this[_0x2f0d52(0x1fa)]['music']({'data':_0x3ee49f,'baseURL':_0x5ae663[_0x2f0d52(0x379)],'headers':{'Authorization':_0x2f0d52(0x236)+_0x5ae663[_0x2f0d52(0x1a7)]}});else _0x2bd711==music_constant_1[_0x2f0d52(0x313)]['LYRICS']?(_0x3ee49f[_0x2f0d52(0x22f)]=_0x4eb34b+(_0x2f0d52(0x178)+_0x1f3c0b['id']),_0x4befe3=await this['sunoTaskService'][_0x2f0d52(0x28f)]({'data':_0x3ee49f,'baseURL':_0x5ae663[_0x2f0d52(0x379)],'headers':{'Authorization':'Bearer\x20'+_0x5ae663[_0x2f0d52(0x1a7)]}})):(_0x3ee49f[_0x2f0d52(0x22f)]=_0x4eb34b+(_0x2f0d52(0x15f)+_0x1f3c0b['id']),_0x4befe3=await this[_0x2f0d52(0x1fa)][_0x2f0d52(0x226)]({'data':_0x3ee49f,'baseURL':_0x5ae663[_0x2f0d52(0x379)],'headers':{'Authorization':_0x2f0d52(0x236)+_0x5ae663['key']}}));await this['modelsService'][_0x2f0d52(0x239)](_0x5ae663['id'],0x0),_0x1f3c0b['totalTokens']=0x0,_0x1f3c0b[_0x2f0d52(0x35e)]=0x0,_0x1f3c0b[_0x2f0d52(0x24a)]=0x0,_0x1f3c0b[_0x2f0d52(0x2c0)]=_0x4befe3['data'],_0x1f3c0b[_0x2f0d52(0x217)]=_0x2bd711,_0x1f3c0b['conversationOptions']=JSON[_0x2f0d52(0x1a8)]({'model':_0x5ae663[_0x2f0d52(0x29a)],'parentMessageId':_0x4befe3['data']}),await this[_0x2f0d52(0x240)]['saveChatLog'](_0x1f3c0b),common_1[_0x2f0d52(0x290)]['debug']('本次调用:\x20'+_0x1f3c0b[_0x2f0d52(0x271)]+'\x20model:\x20'+_0x5ae663[_0x2f0d52(0x29a)]+_0x2f0d52(0x343)+_0x5ae663[_0x2f0d52(0x1a7)]+',\x20模型名称:\x20'+_0x5ae663[_0x2f0d52(0x361)],_0x2f0d52(0x1b8));if(_0x4befe3[_0x2f0d52(0x303)]!==_0x2f0d52(0x1a4))throw new Error(_0x2f0d52(0x2f7));}catch(_0x431443){console['log'](_0x2f0d52(0x29b),_0x5ae663[_0x2f0d52(0x1a7)],_0x431443);const _0x368901=await this[_0x2f0d52(0x2c2)](_0x431443,_0x5ae663);_0x1f3c0b['errMsg']=_0x368901,await this[_0x2f0d52(0x240)][_0x2f0d52(0x1f3)](_0x1f3c0b),await this[_0x2f0d52(0x2e0)][_0x2f0d52(0x354)](_0x1f3c0b['userId'],_0x1f3c0b['id'],_0x2bd711,!![]);}}async[_0x434455(0x13a)](_0x3aa3c6){const _0x4266f3=_0x434455,{data:_0x106884,answerLogDTO:_0x1342b0,currentRequestModel:_0x18e121}=_0x3aa3c6;try{let _0x5ccbe4;await this[_0x4266f3(0x2e0)][_0x4266f3(0x332)](_0x1342b0[_0x4266f3(0x271)],_0x18e121,_0x1342b0['id']);_0x106884[_0x4266f3(0x22a)]?_0x5ccbe4=await this['lumaTaskService'][_0x4266f3(0x245)]({'data':_0x106884,'baseURL':_0x18e121[_0x4266f3(0x379)],'headers':{'Authorization':_0x4266f3(0x236)+_0x18e121[_0x4266f3(0x1a7)]}},_0x106884[_0x4266f3(0x22a)]):_0x5ccbe4=await this[_0x4266f3(0x255)][_0x4266f3(0x2bc)]({'data':_0x106884,'baseURL':_0x18e121['proxyUrl'],'headers':{'Authorization':_0x4266f3(0x236)+_0x18e121[_0x4266f3(0x1a7)]}});await this[_0x4266f3(0x18a)]['saveUseLog'](_0x18e121['id'],0x0),_0x1342b0[_0x4266f3(0x2d5)]=0x0,_0x1342b0[_0x4266f3(0x35e)]=0x0,_0x1342b0[_0x4266f3(0x24a)]=0x0,_0x1342b0['answer']=_0x5ccbe4[_0x4266f3(0x30d)],_0x1342b0[_0x4266f3(0x189)]=JSON[_0x4266f3(0x1a8)]({'model':_0x18e121[_0x4266f3(0x29a)],'parentMessageId':_0x5ccbe4['id']}),await this[_0x4266f3(0x240)][_0x4266f3(0x1f3)](_0x1342b0),common_1[_0x4266f3(0x290)][_0x4266f3(0x1cf)]('本次调用:\x20'+_0x1342b0[_0x4266f3(0x271)]+_0x4266f3(0x2d1)+_0x18e121['model']+_0x4266f3(0x343)+_0x18e121['key']+',\x20模型名称:\x20'+_0x18e121[_0x4266f3(0x361)],_0x4266f3(0x1ce));if(!_0x1342b0[_0x4266f3(0x18d)])throw new Error('视频生成失败，没有响应');await this['chatLogService'][_0x4266f3(0x1c8)](_0x1342b0,{'id':_0x5ccbe4['id'],'state':_0x5ccbe4[_0x4266f3(0x30d)],'completed':_0x5ccbe4['state']===_0x4266f3(0x21a),'videoUrl':_0x5ccbe4[_0x4266f3(0x1d1)]?.[_0x4266f3(0x2a9)]});}catch(_0x5cba85){console['log'](_0x4266f3(0x29c),_0x18e121['key'],_0x5cba85);const _0x5512ea=await this['openAiErrHandler'](_0x5cba85,_0x18e121);_0x1342b0[_0x4266f3(0x175)]=_0x5512ea,await this[_0x4266f3(0x240)][_0x4266f3(0x1f3)](_0x1342b0),await this[_0x4266f3(0x2e0)]['refundBalance4Chat'](_0x1342b0[_0x4266f3(0x271)],_0x18e121,_0x1342b0['id']);}}async[_0x434455(0x258)](_0x24479e){const _0x26b3c8=_0x434455,{data:_0x5208ae,answerLogDTO:_0x13ffd6,currentRequestModel:_0x58a7d4}=_0x24479e;try{let _0x376c2f;await this['userService'][_0x26b3c8(0x332)](_0x13ffd6[_0x26b3c8(0x271)],_0x58a7d4,_0x13ffd6['id']);const _0x5e26ea=_0x5208ae[_0x26b3c8(0x210)],_0x4b37d7={'model':_0x5208ae[_0x26b3c8(0x29a)],'ratio':_0x5208ae[_0x26b3c8(0x2df)],'prompt':_0x5208ae[_0x26b3c8(0x201)],'style':_0x5208ae[_0x26b3c8(0x307)],'options':_0x5e26ea};_0x5208ae[_0x26b3c8(0x30b)]&&(_0x4b37d7[_0x26b3c8(0x30b)]=_0x5208ae[_0x26b3c8(0x30b)]);_0x5208ae[_0x26b3c8(0x1ac)]&&(_0x4b37d7[_0x26b3c8(0x1ac)]=_0x5208ae[_0x26b3c8(0x1ac)]);_0x376c2f=await this[_0x26b3c8(0x2cd)][_0x26b3c8(0x2bc)]({'data':_0x4b37d7,'baseURL':_0x58a7d4[_0x26b3c8(0x379)],'headers':{'Authorization':_0x26b3c8(0x236)+_0x58a7d4[_0x26b3c8(0x1a7)]}}),await this['modelsService']['saveUseLog'](_0x58a7d4['id'],0x0),_0x13ffd6[_0x26b3c8(0x2d5)]=0x0,_0x13ffd6[_0x26b3c8(0x35e)]=0x0,_0x13ffd6['completionTokens']=0x0,_0x13ffd6[_0x26b3c8(0x175)]=_0x376c2f['msg'],_0x13ffd6['answer']=_0x376c2f[_0x26b3c8(0x339)]=='3'?_0x26b3c8(0x202):_0x376c2f[_0x26b3c8(0x339)],_0x13ffd6[_0x26b3c8(0x189)]=JSON['stringify']({'model':_0x58a7d4['model'],'parentMessageId':_0x376c2f[_0x26b3c8(0x342)]}),await this['chatLogService'][_0x26b3c8(0x1f3)](_0x13ffd6),common_1['Logger'][_0x26b3c8(0x1cf)](_0x26b3c8(0x23b)+_0x13ffd6['userId']+'\x20model:\x20'+_0x58a7d4[_0x26b3c8(0x29a)]+'\x20key\x20->\x20'+_0x58a7d4['key']+_0x26b3c8(0x1a2)+_0x58a7d4['modelName'],'ChatgptService');if(_0x376c2f[_0x26b3c8(0x36f)])throw new Error(_0x26b3c8(0x228));await this['chatLogService'][_0x26b3c8(0x1c8)](_0x13ffd6,{'id':_0x376c2f[_0x26b3c8(0x342)],'state':_0x376c2f[_0x26b3c8(0x339)]=='3'?_0x26b3c8(0x202):_0x376c2f[_0x26b3c8(0x339)],'completed':_0x376c2f[_0x26b3c8(0x339)]==='3','videoUrl':_0x376c2f[_0x26b3c8(0x165)]});}catch(_0x33d8e0){console[_0x26b3c8(0x22c)](_0x26b3c8(0x29c),_0x58a7d4[_0x26b3c8(0x1a7)],_0x33d8e0);const _0x3bf44a=await this[_0x26b3c8(0x2c2)](_0x33d8e0,_0x58a7d4);_0x13ffd6[_0x26b3c8(0x175)]=_0x3bf44a,await this[_0x26b3c8(0x240)][_0x26b3c8(0x1f3)](_0x13ffd6),await this['userService'][_0x26b3c8(0x144)](_0x13ffd6['userId'],_0x58a7d4,_0x13ffd6['id']);}}async['klingVideoTask'](_0x336ea5){const _0x31b337=_0x434455,{data:_0x3ae02d,answerLogDTO:_0x1c500e,currentRequestModel:_0x284e44}=_0x336ea5;try{let _0xe46870;await this[_0x31b337(0x2e0)][_0x31b337(0x332)](_0x1c500e[_0x31b337(0x271)],_0x284e44,_0x1c500e['id']);!_0x3ae02d['model_name']?(_0x3ae02d[_0x31b337(0x1ef)]=_0x3ae02d[_0x31b337(0x29a)],delete _0x3ae02d[_0x31b337(0x29a)]):delete _0x3ae02d[_0x31b337(0x29a)];_0x3ae02d[_0x31b337(0x30b)]?_0xe46870=await this['klingTaskService'][_0x31b337(0x25f)]({'data':_0x3ae02d,'baseURL':_0x284e44[_0x31b337(0x379)],'headers':{'Authorization':'Bearer\x20'+_0x284e44[_0x31b337(0x1a7)]}}):_0xe46870=await this[_0x31b337(0x2d4)][_0x31b337(0x1a3)]({'data':_0x3ae02d,'baseURL':_0x284e44[_0x31b337(0x379)],'headers':{'Authorization':'Bearer\x20'+_0x284e44[_0x31b337(0x1a7)]}});await this[_0x31b337(0x18a)][_0x31b337(0x239)](_0x284e44['id'],0x0),_0x1c500e[_0x31b337(0x2d5)]=0x0,_0x1c500e[_0x31b337(0x35e)]=0x0,_0x1c500e[_0x31b337(0x24a)]=0x0,_0x1c500e[_0x31b337(0x18d)]=_0xe46870['task_status'],_0x1c500e[_0x31b337(0x189)]=JSON['stringify']({'model':_0x284e44['model'],'parentMessageId':_0xe46870[_0x31b337(0x342)]}),await this['chatLogService'][_0x31b337(0x1f3)](_0x1c500e),common_1[_0x31b337(0x290)][_0x31b337(0x1cf)](_0x31b337(0x23b)+_0x1c500e[_0x31b337(0x271)]+_0x31b337(0x2d1)+_0x284e44['model']+_0x31b337(0x343)+_0x284e44['key']+_0x31b337(0x1a2)+_0x284e44[_0x31b337(0x361)],_0x31b337(0x1ce));if(!_0x1c500e[_0x31b337(0x18d)]||_0x1c500e[_0x31b337(0x18d)]==='failed')throw new Error(_0x31b337(0x228));await this[_0x31b337(0x240)]['parseAndSaveVideo'](_0x1c500e,{'id':_0xe46870[_0x31b337(0x342)],'state':_0xe46870[_0x31b337(0x2ba)],'completed':_0xe46870[_0x31b337(0x2ba)]===_0x31b337(0x36e),'videoUrl':_0xe46870[_0x31b337(0x306)]&&_0xe46870[_0x31b337(0x306)]['videos']&&_0xe46870['task_result'][_0x31b337(0x1f0)]['length']?_0xe46870[_0x31b337(0x306)][_0x31b337(0x1f0)][0x0]?.[_0x31b337(0x2a9)]:''});}catch(_0x5f1db2){console[_0x31b337(0x22c)]('video-task',_0x284e44[_0x31b337(0x1a7)],_0x5f1db2);const _0x195c30=await this[_0x31b337(0x2c2)](_0x5f1db2,_0x284e44);_0x1c500e[_0x31b337(0x175)]=_0x195c30,await this[_0x31b337(0x240)][_0x31b337(0x1f3)](_0x1c500e),await this['userService'][_0x31b337(0x144)](_0x1c500e[_0x31b337(0x271)],_0x284e44,_0x1c500e['id']);}}async[_0x434455(0x2a7)](_0x391a24){const _0x301446=_0x434455;try{const _0x3ddc07=(0x0,utils_1['getReqSaasId'])(this[_0x301446(0x1b3)]),{req:_0x16b062,model:_0x39f534,modelType:_0x420630,datas:_0x5e2d09,requestBody:_0x34d301,musicTaskType:_0x5d03c8}=_0x391a24;let _0x20ec48,_0xea958d;const _0x515187=await this[_0x301446(0x259)]({'modelType':_0x420630});_0x20ec48=_0x515187[_0x301446(0x232)],_0xea958d=_0x515187[_0x301446(0x267)];let _0x41d5ad='';_0x301446(0x201)in _0x5e2d09&&(_0x41d5ad=_0x5e2d09[_0x301446(0x201)]);const _0x4c54f8=await this['modelsService']['getRandomKey'](_0x420630,_0x420630===model_constant_1[_0x301446(0x384)]['VIDEO']?_0x39f534:'');_0x4c54f8['model']=_0x39f534,_0xea958d['modelInfo'][_0x301446(0x29a)]=_0x39f534;_0x301446(0x201)in _0x5e2d09&&await this[_0x301446(0x1c5)]({'prompt':_0x41d5ad,'currentRequestModel':_0x4c54f8,'user':_0x16b062[_0x301446(0x14f)]});let {id:_0x205b06,topN:_0x419f7d,keyType:_0x38f431}=_0xea958d[_0x301446(0x1ca)];const _0x18e7ad=0x0,_0x4e90ae=0x0,_0x345eef=_0x18e7ad+_0x4e90ae,_0x4241f8=(0x0,utils_1[_0x301446(0x37c)])(_0x16b062),_0x4bd2ad={'appId':_0x20ec48,'curIp':_0x4241f8,'prompt':_0x41d5ad,'modelId':_0x205b06,'modelType':_0x420630,'answer':'','model':_0x39f534,'role':_0x301446(0x14f),'userId':_0x16b062[_0x301446(0x14f)]['id'],'completionTokens':0x0,'totalTokens':_0x345eef,'type':balance_constant_1['DeductionKey'][_0x301446(0x1bf)],'logType':0x1,'modelSubType':'','requestParams':_0x34d301||_0x5e2d09,'requestOptions':JSON[_0x301446(0x1a8)]({'options':null,'prompt':_0x41d5ad}),'saasId':_0x3ddc07},_0x102723={..._0x4bd2ad,'role':_0x301446(0x1d3),'requestOptions':JSON[_0x301446(0x1a8)]({'prompt':_0x41d5ad,'options':{'model':_0x39f534,'temperature':_0x419f7d}})};await this[_0x301446(0x240)]['saveChatLog'](_0x4bd2ad);const _0x554896=await this[_0x301446(0x240)][_0x301446(0x1f3)](_0x102723);return await this[_0x301446(0x2e0)][_0x301446(0x354)](_0x16b062[_0x301446(0x14f)]['id'],_0x554896['id'],_0x5d03c8),await this[_0x301446(0x247)]({'data':_0x5e2d09,'currentRequestModel':_0x4c54f8,'answerLogDTO':_0x554896,'musicTaskType':_0x5d03c8}),_0x554896;}catch(_0x347afc){if(_0x347afc instanceof common_1[_0x301446(0x263)])throw _0x347afc;else throw new common_1['HttpException'](_0x347afc[_0x301446(0x26a)],common_1['HttpStatus']['BAD_REQUEST']);}}async['chatTask'](_0xd231c){const _0x43a9bb=_0x434455;try{const _0x26c7ef=(0x0,utils_1[_0x43a9bb(0x305)])(this['clsService']),{req:_0x2f4ecd,model:_0x4b043a,modelType:_0x200f9e,datas:_0x13839a,requestBody:_0x92089}=_0xd231c,{prompt:_0xa74349,options:options={}}=_0x13839a,{groupId:_0x5c1bcd,type:_0x52a5b6}=options;let _0x5a4cda,_0x215348,_0x147a51;if(_0x200f9e===model_constant_1[_0x43a9bb(0x384)][_0x43a9bb(0x335)]){const _0x419c55=await this[_0x43a9bb(0x259)]({'modelType':_0x200f9e,'keyType':_0xd231c['keyType']});_0x5a4cda=_0x419c55[_0x43a9bb(0x232)],_0x215348=_0x419c55['modelConfig'],_0x147a51=await this['modelsService'][_0x43a9bb(0x1b1)](_0x200f9e,parseInt(_0xd231c[_0x43a9bb(0x185)]));}else{const _0x55627=await this[_0x43a9bb(0x259)]({'modelType':_0x200f9e});_0x5a4cda=_0x55627[_0x43a9bb(0x232)],_0x215348=_0x55627['modelConfig'],_0x147a51=await this[_0x43a9bb(0x18a)]['getRandomKey'](_0x200f9e);}_0x147a51[_0x43a9bb(0x29a)]=_0x4b043a,_0x215348['modelInfo'][_0x43a9bb(0x29a)]=_0x4b043a;_0x200f9e===model_constant_1[_0x43a9bb(0x384)][_0x43a9bb(0x335)]?await this[_0x43a9bb(0x323)]({'prompt':_0xa74349,'currentRequestModel':_0x147a51,'user':_0x2f4ecd[_0x43a9bb(0x14f)],'params':_0x92089}):await this['validateBeforeChat']({'prompt':_0xa74349,'currentRequestModel':_0x147a51,'user':_0x2f4ecd[_0x43a9bb(0x14f)]});let {id:_0x8418ff,topN:_0x5ee752,keyType:_0x40115d}=_0x215348[_0x43a9bb(0x1ca)];const _0x3a9ce8=0x0,_0x19e05d=0x0,_0x524a98=_0x3a9ce8+_0x19e05d,_0x211d35=(0x0,utils_1[_0x43a9bb(0x37c)])(_0x2f4ecd),_0x5bf031={'appId':_0x5a4cda,'curIp':_0x211d35,'prompt':_0xa74349,'groupId':_0x5c1bcd,'modelId':_0x8418ff,'modelType':_0x200f9e,'answer':'','model':_0x4b043a,'role':_0x43a9bb(0x14f),'userId':_0x2f4ecd[_0x43a9bb(0x14f)]['id'],'completionTokens':0x0,'totalTokens':_0x524a98,'type':balance_constant_1[_0x43a9bb(0x2c4)][_0x43a9bb(0x1bf)],'logType':_0x52a5b6===_0x43a9bb(0x277)?0x2:0x1,'modelSubType':_0x200f9e===model_constant_1[_0x43a9bb(0x384)][_0x43a9bb(0x335)]?_0x40115d[_0x43a9bb(0x15c)]():'','requestParams':_0x92089||_0x13839a,'requestOptions':JSON[_0x43a9bb(0x1a8)]({'options':null,'prompt':_0xa74349}),'saasId':_0x26c7ef},_0x4bc6b9={..._0x5bf031,'role':'assistant','requestOptions':JSON['stringify']({'prompt':_0xa74349,'options':{'model':_0x4b043a,'temperature':_0x5ee752}})};await this[_0x43a9bb(0x240)]['saveChatLog'](_0x5bf031);const _0x21367e=await this['chatLogService'][_0x43a9bb(0x1f3)](_0x4bc6b9);if(_0x200f9e===model_constant_1[_0x43a9bb(0x384)]['VIDEO']){await this[_0x43a9bb(0x2e0)][_0x43a9bb(0x253)](_0x2f4ecd[_0x43a9bb(0x14f)]['id'],_0x147a51,_0x92089,_0x21367e['id']);switch(_0x40115d){case 0x2:this['runwayVideoTask']({'data':_0x13839a,'currentRequestModel':_0x147a51,'answerLogDTO':_0x21367e});break;case 0x3:this[_0x43a9bb(0x27e)]({'data':_0x13839a,'currentRequestModel':_0x147a51,'answerLogDTO':_0x21367e});break;default:this[_0x43a9bb(0x13a)]({'data':_0x13839a,'currentRequestModel':_0x147a51,'answerLogDTO':_0x21367e});}}else await this[_0x43a9bb(0x2e0)][_0x43a9bb(0x332)](_0x2f4ecd[_0x43a9bb(0x14f)]['id'],_0x147a51,_0x21367e['id']);return _0x21367e;}catch(_0x26f445){if(_0x26f445 instanceof common_1['HttpException'])throw _0x26f445;else throw new common_1['HttpException'](_0x26f445['message'],common_1[_0x43a9bb(0x2fd)][_0x43a9bb(0x328)]);}}async[_0x434455(0x2ad)](_0x7453a,_0x54469d){const _0x4a3df4=_0x434455;let {mv:_0x1f5cbe}=_0x7453a;return!_0x7453a['make_instrumental']?_0x7453a[_0x4a3df4(0x2de)]=![]:_0x7453a[_0x4a3df4(0x2de)]=!![],this['chatMuiscTask']({'req':_0x54469d,'datas':_0x7453a,'model':_0x1f5cbe||'suno-v3','modelType':model_constant_1[_0x4a3df4(0x384)][_0x4a3df4(0x377)],'musicTaskType':music_constant_1[_0x4a3df4(0x313)][_0x4a3df4(0x35c)]});}async[_0x434455(0x373)](_0x4eeb40,_0x135326){const _0x1cddc0=_0x434455,_0x3571b6={'url':_0x4eeb40};return this[_0x1cddc0(0x2a7)]({'req':_0x135326,'datas':_0x3571b6,'model':'suno-v3','modelType':model_constant_1['EModelType']['MUSIC'],'musicTaskType':music_constant_1[_0x1cddc0(0x313)]['UPLOAD']});}async[_0x434455(0x300)](_0x297182,_0x1cae0f){const _0x407660=_0x434455;return this[_0x407660(0x2a7)]({'req':_0x1cae0f,'datas':_0x297182,'model':_0x407660(0x28c),'modelType':model_constant_1['EModelType'][_0x407660(0x377)],'musicTaskType':music_constant_1[_0x407660(0x313)]['LYRICS']});}async['lumaChatVideo'](_0xab41c8,_0x498556){const _0x3b3bc6=_0x434455,_0x586463=JSON[_0x3b3bc6(0x325)](JSON[_0x3b3bc6(0x1a8)](_0xab41c8));let {model:_0x4d7aa0,prompt:_0x19b71d,expand_prompt:_0x3d03e3,aspect_ratio:_0x26b440,image_url:_0x4a02d5,image_end_url:_0xa5762a}=_0xab41c8,_0x2cd223='prompt\x20'+_0x19b71d+'\x20--expand_prompt\x20'+_0x3d03e3+'\x20--aspect_ratio\x20'+_0x26b440;return _0x4a02d5&&(_0x2cd223=_0x2cd223+_0x3b3bc6(0x1c9)+_0x4a02d5),_0xa5762a&&(_0x2cd223=_0x2cd223+_0x3b3bc6(0x1ed)+_0xa5762a),_0xab41c8[_0x3b3bc6(0x201)]=_0x2cd223,_0xab41c8[_0x3b3bc6(0x161)]=_0x19b71d,this[_0x3b3bc6(0x25e)]({'req':_0x498556,'datas':_0xab41c8,'requestBody':_0x586463,'model':_0x4d7aa0||_0x3b3bc6(0x275),'keyType':'1','modelType':model_constant_1[_0x3b3bc6(0x384)][_0x3b3bc6(0x335)]});}async[_0x434455(0x333)](_0x140517,_0x1bedab){const _0x5676c5=_0x434455,_0x2716d3=JSON[_0x5676c5(0x325)](JSON[_0x5676c5(0x1a8)](_0x140517));return this['chatTask']({'req':_0x1bedab,'datas':_0x140517,'requestBody':_0x2716d3,'model':_0x140517[_0x5676c5(0x29a)]||_0x5676c5(0x372),'keyType':'2','modelType':model_constant_1[_0x5676c5(0x384)][_0x5676c5(0x335)]});}async[_0x434455(0x309)](_0x572796,_0x3c5d13){const _0x3cdc39=_0x434455,_0x4c62d2=JSON[_0x3cdc39(0x325)](JSON[_0x3cdc39(0x1a8)](_0x572796));return this['chatTask']({'req':_0x3c5d13,'datas':_0x572796,'requestBody':_0x4c62d2,'model':_0x572796[_0x3cdc39(0x29a)]||_0x3cdc39(0x297),'keyType':'3','modelType':model_constant_1['EModelType']['VIDEO']});}async[_0x434455(0x148)](){const _0x41da15=_0x434455,_0x215bf2=await this[_0x41da15(0x240)][_0x41da15(0x1c3)]();if(!_0x215bf2[_0x41da15(0x234)])return;const _0x2ad681=[],_0x5a3868=new Map();_0x215bf2[_0x41da15(0x174)](_0x2313c4=>{const _0x190d2d=_0x41da15;_0x2ad681[_0x190d2d(0x2b2)](_0x2313c4['id']),_0x5a3868[_0x190d2d(0x34e)](_0x2313c4['id'],_0x2313c4);});const _0x16482c=await this[_0x41da15(0x240)][_0x41da15(0x20f)](_0x2ad681),_0x46288d=[],_0x15f65c=new Map();_0x16482c['forEach'](_0x103fd9=>{const _0x309b9a=_0x41da15;_0x46288d[_0x309b9a(0x2b2)](_0x103fd9[_0x309b9a(0x280)]),_0x15f65c[_0x309b9a(0x34e)](_0x103fd9['sunoMusicId'],_0x103fd9);});const _0x22109c=await this[_0x41da15(0x18a)]['getRandomKey'](model_constant_1[_0x41da15(0x384)][_0x41da15(0x335)]),_0xb5fa78=await this[_0x41da15(0x255)][_0x41da15(0x296)]({'baseURL':_0x22109c[_0x41da15(0x379)],'headers':{'Authorization':_0x41da15(0x236)+_0x22109c[_0x41da15(0x1a7)]},'data':{'ids':_0x46288d}});for(let _0x4d4cbf=0x0;_0x4d4cbf<_0xb5fa78[_0x41da15(0x234)];_0x4d4cbf++){const _0x4c247f=_0xb5fa78[_0x4d4cbf],_0xa32af5=_0x15f65c['get'](_0x4c247f[_0x41da15(0x342)]),_0x1ae36f=_0x5a3868[_0x41da15(0x2e7)](_0xa32af5[_0x41da15(0x21f)]);await this[_0x41da15(0x240)][_0x41da15(0x1c8)](_0x1ae36f,{'id':_0x4c247f[_0x41da15(0x2ff)]['id'],'state':_0x4c247f[_0x41da15(0x2ff)][_0x41da15(0x30d)],'completed':_0x4c247f['data'][_0x41da15(0x30d)]===_0x41da15(0x21a),'videoUrl':_0x4c247f[_0x41da15(0x2ff)][_0x41da15(0x1d1)]?.[_0x41da15(0x2a9)]});}}async['requestFromGpt'](_0x162cdb){const _0x4908fd=_0x434455,{prompt:_0x5f4ba2,userId:_0x1a2968,abortController:_0x1f1027}=_0x162cdb,_0x555d1a=await this['modelsService']['getModelByType'](model_constant_1['EModelType'][_0x4908fd(0x1ff)]),_0x41d16b=_0x555d1a[_0x4908fd(0x1ca)],_0x52db9c=_0x555d1a[_0x4908fd(0x1ca)][_0x4908fd(0x185)];if(!_0x41d16b)throw new common_1[(_0x4908fd(0x263))]('当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！',common_1['HttpStatus']['BAD_REQUEST']);const {id:_0x4290be}=_0x41d16b;let _0x428516=null,_0x230915=null;try{const _0x36b451=await this['buildOptions']('','',_0x41d16b),_0x43665c=await this[_0x4908fd(0x24e)](_0x41d16b,_0x36b451);_0x428516=await _0x43665c[_0x4908fd(0x330)](_0x5f4ba2,{..._0x36b451,'abortSignal':_0x1f1027[_0x4908fd(0x224)]});const _0x3f8025=(0x0,helper_1[_0x4908fd(0x345)])(_0x52db9c,_0x428516,_0x230915),{total_tokens:total_tokens=0x0}=_0x3f8025[_0x4908fd(0x1e9)];return await this['modelsService'][_0x4908fd(0x239)](_0x4290be,total_tokens),await this[_0x4908fd(0x2e0)][_0x4908fd(0x332)](_0x1a2968,_0x41d16b,-0x1),_0x428516[_0x4908fd(0x167)];}catch(_0x2d219b){common_1['Logger'][_0x4908fd(0x22c)](_0x2d219b);const _0x39c094=_0x2d219b[_0x4908fd(0x2d2)];console[_0x4908fd(0x22c)](_0x39c094);if(_0x2d219b[_0x4908fd(0x339)]&&_0x2d219b[_0x4908fd(0x339)]===0x192)throw new common_1[(_0x4908fd(0x263))](_0x2d219b[_0x4908fd(0x26a)],common_1[_0x4908fd(0x2fd)]['PAYMENT_REQUIRED']);if(!_0x39c094)throw new common_1[(_0x4908fd(0x263))](_0x2d219b[_0x4908fd(0x26a)],common_1[_0x4908fd(0x2fd)][_0x4908fd(0x328)]);let _0x35dfc5=errorMessage_constant_1[_0x4908fd(0x1c7)][_0x39c094]?errorMessage_constant_1[_0x4908fd(0x1c7)][_0x39c094]:_0x4908fd(0x29e);_0x2d219b?.[_0x4908fd(0x26a)][_0x4908fd(0x180)](_0x4908fd(0x355))&&Number(_0x52db9c)===0x1&&(await this['modelsService'][_0x4908fd(0x2eb)](_0x4290be,_0x4908fd(0x2ee),-0x1),_0x35dfc5=_0x4908fd(0x163));_0x2d219b?.[_0x4908fd(0x2d2)]===0x1ad&&_0x2d219b['message']['includes']('You\x20exceeded\x20your\x20current\x20quota,\x20please\x20check\x20your\x20plan\x20and\x20billing\x20details.')&&Number(_0x52db9c)===0x1&&(await this['modelsService'][_0x4908fd(0x2eb)](_0x4290be,_0x4908fd(0x367),-0x3),_0x35dfc5=_0x4908fd(0x292));_0x2d219b?.[_0x4908fd(0x2d2)]===0x191&&_0x2d219b['message'][_0x4908fd(0x180)](_0x4908fd(0x1f5))&&Number(_0x52db9c)===0x1&&(await this[_0x4908fd(0x18a)][_0x4908fd(0x2eb)](_0x4290be,'提供了错误的模型秘钥',-0x2),_0x35dfc5=_0x4908fd(0x31a));_0x2d219b?.[_0x4908fd(0x2d2)]===0x191&&_0x2d219b['message']['includes'](_0x4908fd(0x331))&&Number(_0x52db9c)===0x1&&(await this[_0x4908fd(0x18a)][_0x4908fd(0x2eb)](_0x4290be,_0x4908fd(0x292),-0x2),_0x35dfc5='当前模型key余额已耗尽，请充值！');_0x2d219b?.[_0x4908fd(0x2d2)]===0x194&&_0x2d219b[_0x4908fd(0x26a)][_0x4908fd(0x180)]('This\x20is\x20not\x20a\x20chat\x20model\x20and\x20thus\x20not\x20supported')&&Number(_0x52db9c)===0x1&&(await this['modelsService']['lockKey'](_0x4290be,'当前模型不是聊天模型',-0x4),_0x35dfc5=_0x4908fd(0x35d));_0x2d219b?.[_0x4908fd(0x2d2)]===0x133&&_0x2d219b[_0x4908fd(0x26a)][_0x4908fd(0x180)](_0x4908fd(0x2aa))&&Number(_0x52db9c)===0x1&&(_0x35dfc5='\x20！');_0x39c094===0x190&&console[_0x4908fd(0x22c)]('400\x20error',_0x2d219b,_0x2d219b[_0x4908fd(0x26a)]);const _0x582bb3={'message':_0x35dfc5||_0x4908fd(0x366),'code':_0x39c094===0x191?0x191:_0x39c094||0x1f4};throw new common_1['HttpException'](_0x582bb3['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x434455(0x23a)](_0x3dbdf5,_0x55a507,_0x34e7d6){const _0x34d8e8=_0x434455;try{const {audio:_0x5ea5b9,voice:_0x40d424}=_0x3dbdf5,_0x3a0e14=_0x55a507['abortController'],_0x2fed3e=await this[_0x34d8e8(0x18a)][_0x34d8e8(0x356)]();if(!_0x2fed3e)throw _0x34d8e8(0x273);const {key:_0x39beab,proxyUrl:_0x31571f}=_0x2fed3e;await this[_0x34d8e8(0x2e0)][_0x34d8e8(0x334)](_0x55a507[_0x34d8e8(0x14f)]),await this[_0x34d8e8(0x2e0)][_0x34d8e8(0x1e4)](_0x55a507['user']['id'],_0x2fed3e),console[_0x34d8e8(0x22c)](_0x34d8e8(0x2ef),_0x39beab,_0x31571f),this[_0x34d8e8(0x1e1)][_0x34d8e8(0x2d9)]=_0x39beab,this[_0x34d8e8(0x1e1)][_0x34d8e8(0x32c)]=(_0x31571f||this['defaultBaseUrl'])+_0x34d8e8(0x20e),this['openAi'][_0x34d8e8(0x2ec)]=0x989680;const _0x534c47=await this[_0x34d8e8(0x1e1)][_0x34d8e8(0x26b)][_0x34d8e8(0x184)][_0x34d8e8(0x200)]({'file':(0x0,fs_1[_0x34d8e8(0x2dc)])((0x0,path_1[_0x34d8e8(0x282)])(_0x5ea5b9[_0x34d8e8(0x1b6)])),'model':'whisper-1','language':'zh','response_format':_0x34d8e8(0x1a0),'temperature':0x0})[_0x34d8e8(0x1c6)](_0x3ec252=>_0x3ec252[_0x34d8e8(0x167)])[_0x34d8e8(0x177)](_0x72af6f=>{const _0x35926c=_0x34d8e8;common_1[_0x35926c(0x290)]['error'](_0x72af6f);});console[_0x34d8e8(0x22c)](_0x34d8e8(0x2b7),_0x534c47);if(!_0x534c47){this['removeFile']((0x0,path_1[_0x34d8e8(0x282)])(_0x5ea5b9[_0x34d8e8(0x1b6)]));throw new common_1[(_0x34d8e8(0x263))](_0x34d8e8(0x23f),common_1[_0x34d8e8(0x2fd)]['BAD_REQUEST']);}await this[_0x34d8e8(0x2e0)][_0x34d8e8(0x332)](_0x55a507[_0x34d8e8(0x14f)]['id'],_0x2fed3e,-0x1);const _0x19244f=await this[_0x34d8e8(0x2fa)]({'userId':_0x55a507[_0x34d8e8(0x14f)]['id'],'prompt':_0x534c47,'abortController':_0x3a0e14});console['log'](_0x34d8e8(0x2c7),_0x19244f);if(!_0x19244f){this[_0x34d8e8(0x218)]((0x0,path_1[_0x34d8e8(0x282)])(_0x5ea5b9[_0x34d8e8(0x1b6)]));throw new common_1[(_0x34d8e8(0x263))](_0x34d8e8(0x351),common_1[_0x34d8e8(0x2fd)][_0x34d8e8(0x328)]);}console[_0x34d8e8(0x22c)](_0x34d8e8(0x2f8),_0x19244f['length']);let _0x4fe248=_0x19244f[_0x34d8e8(0x234)]>0x1000?_0x19244f[_0x34d8e8(0x1bb)](0x0,0xfff):_0x19244f;const _0x5ce502=await this['openAi'][_0x34d8e8(0x26b)]['speech'][_0x34d8e8(0x200)]({'input':_0x4fe248,'model':_0x34d8e8(0x1fe),'response_format':_0x34d8e8(0x1c1),'voice':_0x40d424,'speed':0x1})[_0x34d8e8(0x1c6)](_0x1ef773=>_0x1ef773[_0x34d8e8(0x1f2)]())[_0x34d8e8(0x177)](_0x6b37ac=>{const _0x14b1b6=_0x34d8e8;common_1[_0x14b1b6(0x290)][_0x14b1b6(0x1a1)](_0x6b37ac);});if(!_0x5ce502){this[_0x34d8e8(0x218)]((0x0,path_1['resolve'])(_0x5ea5b9[_0x34d8e8(0x1b6)]));throw new common_1[(_0x34d8e8(0x263))](_0x34d8e8(0x30e),common_1['HttpStatus'][_0x34d8e8(0x328)]);}await this[_0x34d8e8(0x2e0)]['deductBalance4Chat'](_0x55a507[_0x34d8e8(0x14f)]['id'],_0x2fed3e,-0x1);const _0x37560c=Buffer[_0x34d8e8(0x2dd)](_0x5ce502);return _0x34e7d6[_0x34d8e8(0x2d8)](_0x34d8e8(0x156),_0x34d8e8(0x316)),_0x34e7d6[_0x34d8e8(0x18f)](_0x37560c),_0x34e7d6[_0x34d8e8(0x320)](_0x37560c),this['removeFile']((0x0,path_1[_0x34d8e8(0x282)])(_0x5ea5b9['path'])),_0x37560c;}catch(_0x3150b3){if(_0x3150b3 instanceof common_1[_0x34d8e8(0x263)])throw _0x3150b3;else throw new common_1[(_0x34d8e8(0x263))](_0x3150b3[_0x34d8e8(0x26a)],common_1['HttpStatus'][_0x34d8e8(0x328)]);}}async[_0x434455(0x173)](_0x3105f9,_0x5574a1){const _0x32846c=_0x434455;common_1['Logger'][_0x32846c(0x22c)](_0x32846c(0x1cd)+_0x3105f9[_0x32846c(0x201)],_0x32846c(0x24d)),await this[_0x32846c(0x321)]['checkBadWords'](_0x3105f9[_0x32846c(0x201)],_0x5574a1[_0x32846c(0x14f)]['id']),await this[_0x32846c(0x2e0)][_0x32846c(0x334)](_0x5574a1[_0x32846c(0x14f)]);let _0x3389de=[];const _0x35688b=await this['modelsService'][_0x32846c(0x19c)](model_constant_1['EModelType'][_0x32846c(0x329)]);await this['userService'][_0x32846c(0x1e4)](_0x5574a1['user']['id'],_0x35688b);const {key:_0x3ab3d1,model:_0x194b25,proxyUrl:_0x23644d}=await this[_0x32846c(0x1fb)](_0x35688b),_0x47fbb5=_0x23644d+_0x32846c(0x221);try{const _0x461d31=await axios_1[_0x32846c(0x1ea)][_0x32846c(0x32f)](_0x47fbb5,{..._0x3105f9,'model':_0x194b25,'response_format':'b64_json'},{'headers':{'Authorization':'Bearer\x20'+_0x3ab3d1}});_0x3389de=_0x461d31[_0x32846c(0x2ff)]['data'];}catch(_0x38b631){console[_0x32846c(0x22c)](_0x32846c(0x227),_0x38b631);const _0x510f27=_0x38b631?.[_0x32846c(0x288)]?.[_0x32846c(0x339)]||0x1f4,_0x5bad3f=_0x38b631?.['response']?.[_0x32846c(0x2ff)]?.[_0x32846c(0x1a1)]?.[_0x32846c(0x26a)];if(_0x510f27===0x1ad)throw new common_1[(_0x32846c(0x263))](_0x32846c(0x265),common_1[_0x32846c(0x2fd)][_0x32846c(0x328)]);if(_0x510f27===0x190||_0x5bad3f[_0x32846c(0x180)](_0x32846c(0x326)))throw new common_1[(_0x32846c(0x263))](_0x32846c(0x1e0),common_1[_0x32846c(0x2fd)][_0x32846c(0x328)]);if(_0x510f27===0x1f4)throw new common_1[(_0x32846c(0x263))]('绘制图片失败，请检查你的提示词是否有非法描述！',common_1[_0x32846c(0x2fd)][_0x32846c(0x328)]);if(_0x510f27===0x191)throw new common_1[(_0x32846c(0x263))](_0x32846c(0x1f1),common_1['HttpStatus'][_0x32846c(0x328)]);throw new common_1[(_0x32846c(0x263))]('绘制图片失败，请稍后试试吧！',common_1['HttpStatus'][_0x32846c(0x328)]);}const _0x549768=[];for(const _0xe97c7b of _0x3389de){const _0x13b11a=_0xe97c7b[_0x32846c(0x13d)][_0x32846c(0x160)](/^data:image\/\w+;base64,/,''),_0x4eb39c=uuid['v4']()[_0x32846c(0x1bb)](0x0,0xa)+_0x32846c(0x301),_0x10c09a=Buffer[_0x32846c(0x2dd)](_0x13b11a,_0x32846c(0x1ad));_0x549768[_0x32846c(0x2b2)](this['fileService'][_0x32846c(0x36b)]({'filename':_0x4eb39c,'buffer':_0x10c09a}));}const _0x43ecad=(0x0,utils_1[_0x32846c(0x37c)])(_0x5574a1),_0x8abc6f=await Promise['all'](_0x549768),[_0x113419,_0x444c9c]=_0x3105f9[_0x32846c(0x23c)][_0x32846c(0x2f3)]('x'),_0x53297a=_0x8abc6f[_0x32846c(0x195)](_0xa4c8d1=>{const _0x3870c2=_0x32846c;return this[_0x3870c2(0x240)][_0x3870c2(0x1f3)]({'curIp':_0x43ecad,'logType':0x3,'answer':_0xa4c8d1,'totalTokens':0x0,'promptTokens':0x0,'model':_0x3870c2(0x318),'userId':_0x5574a1[_0x3870c2(0x14f)]['id'],'prompt':_0x3105f9[_0x3870c2(0x201)],'completionTokens':0x0,'modelType':model_constant_1[_0x3870c2(0x384)][_0x3870c2(0x329)],'type':balance_constant_1[_0x3870c2(0x2c4)]['PAINT_TYPE'],'fileInfo':JSON[_0x3870c2(0x1a8)]({'width':_0x113419,'height':_0x444c9c,'cosUrl':_0xa4c8d1})});}),_0x17b7eb=await Promise[_0x32846c(0x172)](_0x53297a);return await this[_0x32846c(0x2e0)]['deductBalance4Chat'](_0x5574a1[_0x32846c(0x14f)]['id'],_0x35688b,_0x17b7eb[0x0]['id']),_0x8abc6f;}async[_0x434455(0x1fb)](_0x73e885){const _0x31baf2=_0x434455,{openaiModel3MaxTokens:openaiModel3MaxTokens=0x0,openaiModel3MaxTokensRes:openaiModel3MaxTokensRes=0x0,openaiModel3MaxTokens16k:openaiModel3MaxTokens16k=0x0,openaiModel3MaxTokens16kRes:openaiModel3MaxTokens16kRes=0x0,openaiModel4MaxTokens:openaiModel4MaxTokens=0x0,openaiModel4MaxTokensRes:openaiModel4MaxTokensRes=0x0,openaiModel4MaxTokens32k:openaiModel4MaxTokens32k=0x0,openaiModel4MaxTokens32kRes:openaiModel4MaxTokens32kRes=0x0,openaiBaseUrl:openaiBaseUrl=''}=await this[_0x31baf2(0x376)]['getConfigByKeys'](['openaiModel3MaxTokens',_0x31baf2(0x2bf),_0x31baf2(0x27d),_0x31baf2(0x1db),_0x31baf2(0x357),_0x31baf2(0x209),_0x31baf2(0x27a),_0x31baf2(0x1d2),_0x31baf2(0x2c5)]);let _0x1c3402=null,_0x1d68f4=null,_0x18ea49=null;const {model:_0x3e84c3,maxModelTokens:maxModelTokens=0x0,maxResponseTokens:maxResponseTokens=0x0,proxyUrl:_0x21fcd8,key:_0xceca42}=_0x73e885;return _0x3e84c3['toLowerCase']()[_0x31baf2(0x180)](_0x31baf2(0x1da))&&(_0x3e84c3['toLowerCase']()[_0x31baf2(0x180)](_0x31baf2(0x2d6))?(_0x1c3402=maxModelTokens||openaiModel4MaxTokens32k||0x8000,_0x1d68f4=maxResponseTokens||openaiModel4MaxTokens32kRes||0x4000):(_0x1c3402=maxModelTokens||openaiModel4MaxTokens||0x2000,_0x1d68f4=maxResponseTokens||openaiModel4MaxTokensRes||0x1000)),_0x3e84c3['toLowerCase']()[_0x31baf2(0x180)](_0x31baf2(0x294))&&(_0x3e84c3[_0x31baf2(0x23d)]()['includes'](_0x31baf2(0x2af))?(_0x1c3402=maxModelTokens||openaiModel3MaxTokens16k||0x4000,_0x1d68f4=maxResponseTokens||openaiModel3MaxTokens16kRes||0x2000):(_0x1c3402=maxModelTokens||openaiModel3MaxTokens||0x1000,_0x1d68f4=maxResponseTokens||openaiModel3MaxTokensRes||0x3e8)),_0x18ea49=_0x21fcd8||openaiBaseUrl||_0x31baf2(0x2c9),_0x1d68f4>=_0x1c3402&&(_0x1d68f4=Math[_0x31baf2(0x2f1)](_0x1c3402/0x2),common_1[_0x31baf2(0x290)]['debug'](_0x31baf2(0x196)+_0xceca42+_0x31baf2(0x291)+_0x1d68f4)),{'key':_0xceca42,'model':_0x3e84c3,'maxToken':_0x1c3402,'maxTokenRes':_0x1d68f4,'proxyUrl':_0x18ea49};}async[_0x434455(0x212)](_0x5a1502){const _0x52ae06=_0x434455;try{const _0x12d427=await this[_0x52ae06(0x14e)][_0x52ae06(0x34d)](_0x5a1502),_0xa0d82=await this[_0x52ae06(0x2c6)][_0x52ae06(0x250)]({'where':{'yooTaskId':_0x5a1502[_0x52ae06(0x1bd)]['id']}});if(!_0xa0d82)throw new Error(_0x52ae06(0x141));_0xa0d82[_0x52ae06(0x339)]=_0x12d427['data'][_0x52ae06(0x339)],_0xa0d82[_0x52ae06(0x1ec)]=_0x12d427[_0x52ae06(0x2ff)][_0x52ae06(0x349)],_0xa0d82['progress']=_0x12d427['data'][_0x52ae06(0x32a)],_0xa0d82[_0x52ae06(0x205)]=_0x12d427[_0x52ae06(0x2ff)]['process_url'],_0xa0d82[_0x52ae06(0x34f)]=_0x12d427[_0x52ae06(0x2ff)][_0x52ae06(0x2b8)],_0xa0d82[_0x52ae06(0x347)]=_0x12d427[_0x52ae06(0x2ff)]['pptx_url'],_0xa0d82[_0x52ae06(0x36a)]=_0x12d427[_0x52ae06(0x2ff)]['images_url'],_0xa0d82[_0x52ae06(0x37e)]=_0x12d427[_0x52ae06(0x2ff)][_0x52ae06(0x2cf)],_0xa0d82['endTime']=_0x12d427['data'][_0x52ae06(0x182)],_0xa0d82[_0x52ae06(0x28a)]=_0x12d427[_0x52ae06(0x2ff)][_0x52ae06(0x2bd)],await this['pptTaskEntity']['save'](_0xa0d82);}catch(_0x7b7655){common_1[_0x52ae06(0x290)][_0x52ae06(0x1a1)](_0x7b7655[_0x52ae06(0x26a)],_0x52ae06(0x30a));}}async[_0x434455(0x153)](_0x341fd8,_0x18553f){const _0x2a794d=_0x434455;try{return this['connection'][_0x2a794d(0x34c)](async()=>{const _0x138f73=_0x2a794d,_0x2319ce=await this['modelsService'][_0x138f73(0x242)](model_constant_1[_0x138f73(0x384)]['PPT']);let _0x20044a={'userId':_0x341fd8['user']['id'],'type':ppt_constant_1[_0x138f73(0x188)][_0x138f73(0x33b)],'title':_0x18553f[_0x138f73(0x179)],'text':_0x18553f[_0x138f73(0x167)],'theme':_0x18553f['theme']};_0x20044a=await this[_0x138f73(0x2c6)][_0x138f73(0x285)](_0x20044a),await this['userService']['debuctBalance4PPT'](_0x341fd8[_0x138f73(0x14f)]['id'],_0x20044a['id'],_0x20044a[_0x138f73(0x2b5)]);const _0x3fc399=await this[_0x138f73(0x14e)][_0x138f73(0x153)]({'data':_0x18553f,'baseURL':_0x2319ce['modelInfo'][_0x138f73(0x379)],'headers':{'Authorization':_0x138f73(0x236)+_0x2319ce[_0x138f73(0x1ca)][_0x138f73(0x308)]}});return _0x20044a[_0x138f73(0x179)]=_0x3fc399['data'][_0x138f73(0x179)],_0x20044a[_0x138f73(0x315)]=_0x3fc399[_0x138f73(0x2ff)][_0x138f73(0x315)],await this[_0x138f73(0x2c6)][_0x138f73(0x285)](_0x20044a),_0x20044a;});}catch(_0x36dd93){throw new common_1['HttpException'](_0x36dd93[_0x2a794d(0x26a)],common_1[_0x2a794d(0x2fd)][_0x2a794d(0x328)]);}}async['pptOnlineEditor'](_0x14fbb2,_0x4e9d95){const _0x1e0f81=_0x434455,_0xc888a7=await this[_0x1e0f81(0x2c6)][_0x1e0f81(0x250)]({'where':{'id':_0x4e9d95}});if(!_0xc888a7)throw new common_1[(_0x1e0f81(0x263))](_0x1e0f81(0x2e8),common_1[_0x1e0f81(0x2fd)]['BAD_REQUEST']);await this['userService'][_0x1e0f81(0x2b3)](_0x14fbb2[_0x1e0f81(0x14f)]['id'],_0xc888a7['id'],ppt_constant_1[_0x1e0f81(0x188)]['EDITOR']);const _0x518f5f=await this[_0x1e0f81(0x18a)][_0x1e0f81(0x242)](model_constant_1[_0x1e0f81(0x384)][_0x1e0f81(0x136)]),_0x4aaa28=await this['pptService'][_0x1e0f81(0x213)]({'baseURL':_0x518f5f[_0x1e0f81(0x1ca)][_0x1e0f81(0x379)],'headers':{'Authorization':_0x1e0f81(0x18c)+_0x518f5f[_0x1e0f81(0x1ca)][_0x1e0f81(0x308)]},'data':{'id':_0xc888a7['yooTaskId'],'expire':0x83d600}});return _0x4aaa28['code']==_0x1e0f81(0x340)&&_0x4aaa28[_0x1e0f81(0x2ff)][_0x1e0f81(0x2a9)]&&(_0xc888a7[_0x1e0f81(0x29d)]=_0x4aaa28[_0x1e0f81(0x2ff)][_0x1e0f81(0x2a9)],await this[_0x1e0f81(0x2c6)][_0x1e0f81(0x254)]({'id':_0xc888a7['id']},{'editorUrl':_0xc888a7[_0x1e0f81(0x29d)]})),_0xc888a7;}async[_0x434455(0x19d)](_0x5a77b4,_0x2a7e18){const _0x40357b=_0x434455,_0x4ea2f3=await this[_0x40357b(0x2c6)][_0x40357b(0x250)]({'where':{'id':_0x2a7e18}});if(!_0x4ea2f3)throw new common_1[(_0x40357b(0x263))]('PPT不存在',common_1[_0x40357b(0x2fd)][_0x40357b(0x328)]);await this[_0x40357b(0x2e0)][_0x40357b(0x2b3)](_0x5a77b4['user']['id'],_0x4ea2f3['id'],ppt_constant_1[_0x40357b(0x188)][_0x40357b(0x1d7)]);const _0x159604=await this[_0x40357b(0x18a)][_0x40357b(0x242)](model_constant_1['EModelType']['PPT']),_0x5815f1=await this[_0x40357b(0x14e)][_0x40357b(0x19d)]({'baseURL':_0x159604[_0x40357b(0x1ca)][_0x40357b(0x379)],'headers':{'Authorization':_0x40357b(0x18c)+_0x159604[_0x40357b(0x1ca)][_0x40357b(0x308)]},'params':{'id':_0x4ea2f3[_0x40357b(0x155)],'type':_0x40357b(0x1dc)}});return _0x5815f1[_0x40357b(0x303)]=='200'&&_0x5815f1[_0x40357b(0x2ff)][_0x40357b(0x2d0)]&&(_0x4ea2f3[_0x40357b(0x347)]=_0x5815f1[_0x40357b(0x2ff)][_0x40357b(0x2d0)],await this['pptTaskEntity'][_0x40357b(0x254)]({'id':_0x4ea2f3['id']},{'downUrl':_0x4ea2f3[_0x40357b(0x347)]})),_0x4ea2f3;}[_0x434455(0x364)](_0x1ea555,_0xd6ec7f){const _0x152291=_0x434455;try{return this[_0x152291(0x336)][_0x152291(0x34c)](async()=>{const _0x15e2a2=_0x152291,_0x530f63=await this[_0x15e2a2(0x18a)][_0x15e2a2(0x242)](model_constant_1[_0x15e2a2(0x384)]['PPT']);let _0x36a708={'userId':_0x1ea555[_0x15e2a2(0x14f)]['id'],'type':ppt_constant_1[_0x15e2a2(0x188)]['COVER'],'title':_0xd6ec7f['title'],'text':_0xd6ec7f[_0x15e2a2(0x167)],'author':_0xd6ec7f[_0x15e2a2(0x2e4)],'color':_0xd6ec7f[_0x15e2a2(0x192)],'style':_0xd6ec7f[_0x15e2a2(0x307)]};_0x36a708=await this[_0x15e2a2(0x2c6)][_0x15e2a2(0x285)](_0x36a708),await this[_0x15e2a2(0x2e0)][_0x15e2a2(0x2b3)](_0x1ea555[_0x15e2a2(0x14f)]['id'],_0x36a708['id'],_0x36a708[_0x15e2a2(0x2b5)]);const _0x17bda2=await this[_0x15e2a2(0x14e)][_0x15e2a2(0x364)]({'data':{'title':_0xd6ec7f[_0x15e2a2(0x179)],'count':_0xd6ec7f['text'],'user_name':_0xd6ec7f[_0x15e2a2(0x2e4)],'color':_0xd6ec7f['color'],'style':_0xd6ec7f[_0x15e2a2(0x307)]},'baseURL':_0x530f63[_0x15e2a2(0x1ca)]['proxyUrl'],'headers':{'Authorization':_0x15e2a2(0x18c)+_0x530f63[_0x15e2a2(0x1ca)][_0x15e2a2(0x308)]}});return _0x36a708[_0x15e2a2(0x199)]=_0x17bda2[_0x15e2a2(0x2ff)],await this['pptTaskEntity']['save'](_0x36a708),_0x36a708;});}catch(_0x4aea75){throw new common_1['HttpException'](_0x4aea75[_0x152291(0x26a)],common_1['HttpStatus']['BAD_REQUEST']);}}[_0x434455(0x2a5)](_0x275aa8,_0x2c08d1){const _0x530803=_0x434455;try{return this[_0x530803(0x336)][_0x530803(0x34c)](async()=>{const _0x12bed3=_0x530803,_0x21e0f4=await this['modelsService']['getModelByType'](model_constant_1['EModelType'][_0x12bed3(0x136)]);let _0x4399dc={'userId':_0x275aa8[_0x12bed3(0x14f)]['id'],'type':ppt_constant_1['EPPTTaskType']['RECOVER'],'title':_0x2c08d1[_0x12bed3(0x179)],'text':_0x2c08d1[_0x12bed3(0x167)],'author':_0x2c08d1[_0x12bed3(0x2e4)],'coverId':_0x2c08d1[_0x12bed3(0x246)]};_0x4399dc=await this[_0x12bed3(0x2c6)]['save'](_0x4399dc),await this['userService'][_0x12bed3(0x2b3)](_0x275aa8[_0x12bed3(0x14f)]['id'],_0x4399dc['id'],_0x4399dc[_0x12bed3(0x2b5)]);const _0x32ef49=await this[_0x12bed3(0x14e)]['pptReCover']({'data':{'title':_0x2c08d1[_0x12bed3(0x179)],'count':_0x2c08d1['text'],'user_name':_0x2c08d1[_0x12bed3(0x2e4)],'cover_id':_0x2c08d1[_0x12bed3(0x246)]},'baseURL':_0x21e0f4[_0x12bed3(0x1ca)][_0x12bed3(0x379)],'headers':{'Authorization':_0x12bed3(0x18c)+_0x21e0f4[_0x12bed3(0x1ca)]['accessToken']}});return _0x4399dc[_0x12bed3(0x199)]=_0x32ef49['data'],await this[_0x12bed3(0x2c6)][_0x12bed3(0x285)](_0x4399dc),_0x4399dc;});}catch(_0x42e007){throw new common_1['HttpException'](_0x42e007['message'],common_1[_0x530803(0x2fd)][_0x530803(0x328)]);}}async[_0x434455(0x187)](_0x112c21){const _0x4a64cb=_0x434455;try{const _0x5d521a=[_0x4a64cb(0x2f6),'pptOutlineVipFree',_0x4a64cb(0x1f4),_0x4a64cb(0x21e),_0x4a64cb(0x19b),'pptEditorVipFree'],_0x59ec56=await this[_0x4a64cb(0x376)][_0x4a64cb(0x2f5)](_0x5d521a);if(!_0x112c21[_0x4a64cb(0x14f)]||!_0x112c21[_0x4a64cb(0x14f)]['id'])throw new Error('Invalid\x20user\x20information');const _0x4169b6=[_0x4a64cb(0x1e8),_0x4a64cb(0x1e5),_0x4a64cb(0x213)],_0x583c52=await Promise[_0x4a64cb(0x172)](_0x4169b6['map'](async _0x558846=>{const _0x182caa=_0x4a64cb,_0xa398ac=_0x59ec56[_0x558846+'VipFree'],_0x8480ea=_0x59ec56[_0x558846+_0x182caa(0x21c)],_0x2ac3ee=redisKey_constant_1['VIP_FREE']+'-'+_0x112c21['user']['id']+'-'+(_0x558846+_0x182caa(0x149)),_0x4d4264=await this[_0x182caa(0x2e0)]['getKeyFree'](_0x112c21[_0x182caa(0x14f)]['id'],_0x2ac3ee,_0xa398ac);return{'type':_0x558846,'remainCount':_0x4d4264,'freeCount':Number(_0xa398ac),'useIntegrate':Number(_0x8480ea)};}));return _0x583c52;}catch(_0x1cb6e9){console['error'](_0x4a64cb(0x269),_0x1cb6e9);throw _0x1cb6e9;}}[_0x434455(0x1e5)](_0x4b54f0,_0x7e34e4){const _0x57d250=_0x434455;try{return this['connection']['transaction'](async()=>{const _0x234d2f=_0x5d1e;let _0x399dd9;const _0x5b8506=await this['modelsService'][_0x234d2f(0x242)](model_constant_1[_0x234d2f(0x384)][_0x234d2f(0x136)]);if(_0x7e34e4[_0x234d2f(0x1d8)]){_0x399dd9=await this[_0x234d2f(0x2c6)][_0x234d2f(0x250)]({'where':{'id':_0x7e34e4[_0x234d2f(0x1d8)]}});if(!_0x399dd9)throw new Error('原始任务不存在！');}let _0x3b8cb8={'userId':_0x4b54f0[_0x234d2f(0x14f)]['id'],'type':ppt_constant_1[_0x234d2f(0x188)][_0x234d2f(0x35c)],'title':_0x7e34e4[_0x234d2f(0x179)],'subTitle':_0x7e34e4['subTitle'],'text':_0x7e34e4[_0x234d2f(0x167)],'catalogs':_0x7e34e4['catalogs'],'contents':_0x7e34e4[_0x234d2f(0x31d)],'author':_0x7e34e4[_0x234d2f(0x2e4)],'fontName':_0x7e34e4[_0x234d2f(0x2fe)],'transition':_0x7e34e4[_0x234d2f(0x317)],'complex':_0x7e34e4[_0x234d2f(0x2c3)],'coverId':_0x7e34e4['coverId'],'originId':_0x7e34e4[_0x234d2f(0x1d8)]};_0x3b8cb8=await this[_0x234d2f(0x2c6)][_0x234d2f(0x285)](_0x3b8cb8),await this[_0x234d2f(0x2e0)][_0x234d2f(0x2b3)](_0x4b54f0['user']['id'],_0x3b8cb8['id'],_0x3b8cb8['type']);try{const _0x3feefb=await this[_0x234d2f(0x14e)]['pptCreate']({'data':{'text':_0x7e34e4['text'],'custom_data':{'title':_0x7e34e4['title'],'sub_title':_0x7e34e4[_0x234d2f(0x30c)],'author':_0x7e34e4[_0x234d2f(0x2e4)],'catalogs':_0x7e34e4[_0x234d2f(0x315)],'contents':_0x7e34e4[_0x234d2f(0x31d)]},'cover_id':_0x7e34e4['coverId'],'font_name':_0x7e34e4[_0x234d2f(0x2fe)],'transition':_0x7e34e4[_0x234d2f(0x317)],'complex':_0x7e34e4['complex'],'user_name':_0x7e34e4[_0x234d2f(0x2e4)],'id':_0x399dd9?.[_0x234d2f(0x155)]},'baseURL':_0x5b8506[_0x234d2f(0x1ca)][_0x234d2f(0x379)],'headers':{'Authorization':_0x234d2f(0x18c)+_0x5b8506[_0x234d2f(0x1ca)][_0x234d2f(0x308)]}});return _0x3b8cb8[_0x234d2f(0x155)]=_0x3feefb[_0x234d2f(0x2ff)]['id'],await this[_0x234d2f(0x2c6)][_0x234d2f(0x285)](_0x3b8cb8),_0x3b8cb8;}catch(_0x91eb46){await this[_0x234d2f(0x2e0)]['debuctBalance4PPT'](_0x4b54f0[_0x234d2f(0x14f)]['id'],_0x3b8cb8['id'],_0x3b8cb8['type'],!![]);throw new common_1[(_0x234d2f(0x263))](_0x91eb46['message'],common_1[_0x234d2f(0x2fd)][_0x234d2f(0x328)]);}});}catch(_0x4c1afa){throw new common_1[(_0x57d250(0x263))](_0x4c1afa['message'],common_1[_0x57d250(0x2fd)][_0x57d250(0x328)]);}}[_0x434455(0x17a)](_0xce412e,_0x98fae7){const _0x37f5f3=_0x434455;try{return this[_0x37f5f3(0x336)]['transaction'](async()=>{const _0x197574=_0x37f5f3,_0xcde2ae=await this[_0x197574(0x18a)][_0x197574(0x242)](model_constant_1[_0x197574(0x384)][_0x197574(0x136)]);let _0x546471={'userId':_0xce412e[_0x197574(0x14f)]['id'],'type':ppt_constant_1[_0x197574(0x188)][_0x197574(0x362)],'title':_0x98fae7['title'],'color':_0x98fae7[_0x197574(0x192)],'style':_0x98fae7[_0x197574(0x307)],'fileUrl':_0x98fae7[_0x197574(0x16e)],'pleader':_0x98fae7[_0x197574(0x28b)],'advisor':_0x98fae7[_0x197574(0x23e)],'school':_0x98fae7['school'],'schoolLogo':_0x98fae7['schoolLogo'],'schoolPicture':_0x98fae7[_0x197574(0x37b)]};_0x546471=await this[_0x197574(0x2c6)][_0x197574(0x285)](_0x546471),await this['userService'][_0x197574(0x2b3)](_0xce412e['user']['id'],_0x546471['id'],_0x546471[_0x197574(0x2b5)]);const _0x4e80c2=await this['pptService'][_0x197574(0x17a)]({'data':{'file_key':_0x98fae7[_0x197574(0x16e)],'title':_0x98fae7[_0x197574(0x179)],'color':_0x98fae7[_0x197574(0x192)],'style':_0x98fae7[_0x197574(0x307)],'pleader':_0x98fae7[_0x197574(0x28b)],'advisor':_0x98fae7[_0x197574(0x23e)],'school':_0x98fae7[_0x197574(0x1a6)],'school_logo':_0x98fae7[_0x197574(0x225)],'school_picture':_0x98fae7[_0x197574(0x37b)]},'baseURL':_0xcde2ae['modelInfo'][_0x197574(0x379)],'headers':{'Authorization':'Beare\x20'+_0xcde2ae['modelInfo'][_0x197574(0x308)]}});return _0x546471['yooTaskId']=_0x4e80c2[_0x197574(0x2ff)]['id'],await this[_0x197574(0x2c6)][_0x197574(0x285)](_0x546471),setTimeout(()=>this[_0x197574(0x212)]({'baseURL':_0xcde2ae[_0x197574(0x1ca)][_0x197574(0x379)],'headers':{'Authorization':_0x197574(0x18c)+_0xcde2ae['modelInfo'][_0x197574(0x308)]},'params':{'id':_0x546471['yooTaskId']}}),0xbb8),_0x546471;});}catch(_0x593d57){throw new common_1[(_0x37f5f3(0x263))](_0x593d57['message'],common_1[_0x37f5f3(0x2fd)]['BAD_REQUEST']);}}['pptCreateFile'](_0x34b7a0,_0x51982e){const _0x162d2=_0x434455;try{return this['connection']['transaction'](async()=>{const _0x222b47=_0x5d1e,_0x4620e1=await this[_0x222b47(0x18a)][_0x222b47(0x242)](model_constant_1[_0x222b47(0x384)][_0x222b47(0x136)]);let _0x210184={'userId':_0x34b7a0[_0x222b47(0x14f)]['id'],'type':ppt_constant_1[_0x222b47(0x188)][_0x222b47(0x369)],'fileUrl':_0x51982e[_0x222b47(0x16e)],'coverId':_0x51982e[_0x222b47(0x246)],'author':_0x51982e[_0x222b47(0x2e4)]};_0x210184=await this['pptTaskEntity'][_0x222b47(0x285)](_0x210184),await this[_0x222b47(0x2e0)][_0x222b47(0x2b3)](_0x34b7a0[_0x222b47(0x14f)]['id'],_0x210184['id'],_0x210184['type']);const _0x16c061=await this[_0x222b47(0x14e)]['pptCreateFile']({'data':{'file_url':_0x51982e[_0x222b47(0x16e)],'cover_id':_0x51982e['coverId'],'user_name':_0x51982e[_0x222b47(0x2e4)]},'baseURL':_0x4620e1[_0x222b47(0x1ca)][_0x222b47(0x379)],'headers':{'Authorization':_0x222b47(0x18c)+_0x4620e1['modelInfo']['accessToken']}});return _0x210184[_0x222b47(0x155)]=_0x16c061[_0x222b47(0x2ff)]['id'],await this['pptTaskEntity'][_0x222b47(0x285)](_0x210184),setTimeout(()=>this['asyncPPTProgress']({'baseURL':_0x4620e1[_0x222b47(0x1ca)][_0x222b47(0x379)],'headers':{'Authorization':'Beare\x20'+_0x4620e1[_0x222b47(0x1ca)][_0x222b47(0x308)]},'params':{'id':_0x210184[_0x222b47(0x155)]}}),0xbb8),_0x210184;});}catch(_0x34b0ec){throw new common_1[(_0x162d2(0x263))](_0x34b0ec[_0x162d2(0x26a)],common_1[_0x162d2(0x2fd)][_0x162d2(0x328)]);}}['pptDetail'](_0x2b5207){const _0x596a8f=_0x434455;return this[_0x596a8f(0x2c6)]['findOne']({'where':{'id':_0x2b5207}});}[_0x434455(0x18e)](_0x34bffe,_0x56f33e){const _0x129206=_0x434455;try{return this[_0x129206(0x336)][_0x129206(0x34c)](async()=>{const _0x4c23db=_0x129206,_0x237cfb=await this['pptTaskEntity'][_0x4c23db(0x250)]({'where':{'id':_0x56f33e['originTaskId']}});if(!_0x237cfb)throw new Error(_0x4c23db(0x21d));const _0x5c2352=await this[_0x4c23db(0x18a)][_0x4c23db(0x242)](model_constant_1[_0x4c23db(0x384)][_0x4c23db(0x136)]);let _0x7b4a93={'userId':_0x34bffe[_0x4c23db(0x14f)]['id'],'type':ppt_constant_1[_0x4c23db(0x188)][_0x4c23db(0x310)],'originId':_0x56f33e['originTaskId'],'coverId':_0x56f33e['coverId'],'fontName':_0x56f33e[_0x4c23db(0x2fe)],'transition':_0x56f33e[_0x4c23db(0x317)]};_0x7b4a93=await this[_0x4c23db(0x2c6)][_0x4c23db(0x285)](_0x7b4a93),await this[_0x4c23db(0x2e0)][_0x4c23db(0x2b3)](_0x34bffe[_0x4c23db(0x14f)]['id'],_0x7b4a93['id'],_0x7b4a93[_0x4c23db(0x2b5)]);const _0xb2be7d=await this['pptService'][_0x4c23db(0x18e)]({'data':{'id':_0x237cfb['yooTaskId'],'cover_id':_0x56f33e['coverId'],'font_name':_0x56f33e[_0x4c23db(0x2fe)],'transition':_0x56f33e[_0x4c23db(0x317)]},'baseURL':_0x5c2352[_0x4c23db(0x1ca)][_0x4c23db(0x379)],'headers':{'Authorization':_0x4c23db(0x18c)+_0x5c2352[_0x4c23db(0x1ca)][_0x4c23db(0x308)]}});return _0x7b4a93['yooTaskId']=_0xb2be7d['data']['id'],await this[_0x4c23db(0x2c6)][_0x4c23db(0x285)](_0x7b4a93),setTimeout(()=>this[_0x4c23db(0x212)]({'baseURL':_0x5c2352['modelInfo']['proxyUrl'],'headers':{'Authorization':'Beare\x20'+_0x5c2352['modelInfo'][_0x4c23db(0x308)]},'params':{'id':_0x7b4a93[_0x4c23db(0x155)]}}),0xbb8),_0x7b4a93;});}catch(_0x1f8db8){throw new common_1[(_0x129206(0x263))](_0x1f8db8[_0x129206(0x26a)],common_1[_0x129206(0x2fd)]['BAD_REQUEST']);}}['pptAddPage'](_0x309971,_0x1ec41d){const _0x53f329=_0x434455;try{return this[_0x53f329(0x336)]['transaction'](async()=>{const _0x47c84c=_0x53f329,_0x4c5bb8=await this[_0x47c84c(0x2c6)]['findOne']({'where':{'id':_0x1ec41d[_0x47c84c(0x1d8)]}});if(!_0x4c5bb8)throw new Error(_0x47c84c(0x21d));const _0x4eb0a5=await this['modelsService'][_0x47c84c(0x242)](model_constant_1[_0x47c84c(0x384)][_0x47c84c(0x136)]);let _0x5d32b6={'userId':_0x309971[_0x47c84c(0x14f)]['id'],'type':ppt_constant_1[_0x47c84c(0x188)][_0x47c84c(0x319)],'originId':_0x1ec41d[_0x47c84c(0x1d8)],'theme':_0x1ec41d[_0x47c84c(0x20d)],'text':_0x1ec41d[_0x47c84c(0x167)],'complex':_0x1ec41d[_0x47c84c(0x2c3)]?String(_0x1ec41d['complex']):'1','author':_0x1ec41d[_0x47c84c(0x2e4)],'fontName':_0x1ec41d[_0x47c84c(0x2fe)],'transition':_0x1ec41d[_0x47c84c(0x317)],'slideNumber':_0x1ec41d[_0x47c84c(0x170)],'slideType':_0x1ec41d['slideType']};_0x5d32b6=await this[_0x47c84c(0x2c6)][_0x47c84c(0x285)](_0x5d32b6),await this[_0x47c84c(0x2e0)][_0x47c84c(0x2b3)](_0x309971[_0x47c84c(0x14f)]['id'],_0x5d32b6['id'],_0x5d32b6['type']);const _0x49e844=await this[_0x47c84c(0x14e)][_0x47c84c(0x270)]({'data':{'id':_0x4c5bb8[_0x47c84c(0x155)],'text':_0x1ec41d[_0x47c84c(0x167)],'complex':_0x1ec41d[_0x47c84c(0x2c3)],'user_name':_0x1ec41d[_0x47c84c(0x2e4)],'font_name':_0x1ec41d[_0x47c84c(0x2fe)],'transition':_0x1ec41d['transition'],'slide_number':_0x1ec41d[_0x47c84c(0x170)],'slide_type':_0x1ec41d[_0x47c84c(0x1ba)],'theme':_0x1ec41d[_0x47c84c(0x20d)]},'baseURL':_0x4eb0a5[_0x47c84c(0x1ca)][_0x47c84c(0x379)],'headers':{'Authorization':_0x47c84c(0x18c)+_0x4eb0a5[_0x47c84c(0x1ca)][_0x47c84c(0x308)]}});return _0x5d32b6[_0x47c84c(0x155)]=_0x49e844[_0x47c84c(0x2ff)]['id'],await this['pptTaskEntity'][_0x47c84c(0x285)](_0x5d32b6),setTimeout(()=>this[_0x47c84c(0x212)]({'baseURL':_0x4eb0a5[_0x47c84c(0x1ca)]['proxyUrl'],'headers':{'Authorization':_0x47c84c(0x18c)+_0x4eb0a5[_0x47c84c(0x1ca)][_0x47c84c(0x308)]},'params':{'id':_0x5d32b6['yooTaskId']}}),0xbb8),_0x5d32b6;});}catch(_0x2e2412){throw new common_1[(_0x53f329(0x263))](_0x2e2412[_0x53f329(0x26a)],common_1[_0x53f329(0x2fd)][_0x53f329(0x328)]);}}[_0x434455(0x24c)](_0x3f74d0,_0xbcd308){const _0x3d94e4=_0x434455;try{return this['connection'][_0x3d94e4(0x34c)](async()=>{const _0x1e1e8b=_0x3d94e4,_0x862177=await this[_0x1e1e8b(0x2c6)][_0x1e1e8b(0x250)]({'where':{'id':_0xbcd308[_0x1e1e8b(0x1d8)]}});if(!_0x862177)throw new Error('原始任务不存在！');const _0x414d65=await this[_0x1e1e8b(0x18a)][_0x1e1e8b(0x242)](model_constant_1['EModelType'][_0x1e1e8b(0x136)]);let _0x516af0={'userId':_0x3f74d0[_0x1e1e8b(0x14f)]['id'],'type':ppt_constant_1[_0x1e1e8b(0x188)]['ADDNOTES'],'originId':_0xbcd308[_0x1e1e8b(0x1d8)],'notes':_0xbcd308};_0x516af0=await this['pptTaskEntity'][_0x1e1e8b(0x285)](_0x516af0),await this[_0x1e1e8b(0x2e0)]['debuctBalance4PPT'](_0x3f74d0[_0x1e1e8b(0x14f)]['id'],_0x516af0['id'],_0x516af0['type']);const _0x2e558c=await this[_0x1e1e8b(0x14e)][_0x1e1e8b(0x229)]({'data':{..._0xbcd308,'id':_0x862177[_0x1e1e8b(0x155)]},'baseURL':_0x414d65[_0x1e1e8b(0x1ca)][_0x1e1e8b(0x379)],'headers':{'Authorization':'Beare\x20'+_0x414d65[_0x1e1e8b(0x1ca)][_0x1e1e8b(0x308)]}});return _0x516af0[_0x1e1e8b(0x155)]=_0x2e558c['data']['id'],await this['pptTaskEntity']['save'](_0x516af0),setTimeout(()=>this['asyncPPTProgress']({'baseURL':_0x414d65['modelInfo'][_0x1e1e8b(0x379)],'headers':{'Authorization':_0x1e1e8b(0x18c)+_0x414d65[_0x1e1e8b(0x1ca)][_0x1e1e8b(0x308)]},'params':{'id':_0x516af0['yooTaskId']}}),0xbb8),_0x516af0;});}catch(_0x37dc08){throw new common_1[(_0x3d94e4(0x263))](_0x37dc08[_0x3d94e4(0x26a)],common_1[_0x3d94e4(0x2fd)][_0x3d94e4(0x328)]);}}async['pptRecPage'](_0x2b672c,_0xded9d7){const _0x7b6e4d=_0x434455,{page:page=0x1,size:size=0x14,keyword:_0xec30d8}=_0x2b672c,_0x4d6523=[{'delFlag':0x0,'publishFlag':0x1,'type':(0x0,typeorm_1['In'])([ppt_constant_1[_0x7b6e4d(0x188)]['CREATE'],ppt_constant_1[_0x7b6e4d(0x188)][_0x7b6e4d(0x369)]])}];_0xec30d8&&_0x4d6523['push']({'title':(0x0,typeorm_1[_0x7b6e4d(0x383)])('%'+_0xec30d8+'%'),'delFlag':0x0},{'subTitle':(0x0,typeorm_1[_0x7b6e4d(0x383)])('%'+_0xec30d8+'%'),'delFlag':0x0});const [_0x107454,_0x4ca1e4]=await this[_0x7b6e4d(0x2c6)][_0x7b6e4d(0x154)]({'where':_0x4d6523,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x7b6e4d(0x237)}}),_0x9fc820=await this[_0x7b6e4d(0x2e0)][_0x7b6e4d(0x352)](_0x107454,_0xded9d7);return{'rows':_0x9fc820,'count':_0x4ca1e4};}async[_0x434455(0x279)](_0x3da543,_0x3dddad){const _0x2f12cd=_0x434455,_0x1b60e9=_0x3dddad['user']['id'],{page:page=0x1,size:size=0x14,keyword:_0x51c05a}=_0x3da543,_0x267b8d=_0x2f12cd(0x24f)+(_0x51c05a?'\x20AND\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.title\x20LIKE\x20(\x27%'+_0x51c05a+_0x2f12cd(0x2a4)+_0x51c05a+_0x2f12cd(0x2e6):'')+_0x2f12cd(0x1cc)+(_0x1b60e9?'\x20AND\x20p.user_id\x20=\x20'+_0x1b60e9:'')+'\x0a\x20\x20\x20\x20\x20\x20',_0x1e7b64=await this['connection']['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(p.id)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ppt_task\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20p.user_id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+_0x267b8d+_0x2f12cd(0x204)),_0x7ee4be=await this[_0x2f12cd(0x336)]['query'](_0x2f12cd(0x37d)+_0x267b8d+_0x2f12cd(0x2b9)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x2f12cd(0x204));!(0x0,utils_1[_0x2f12cd(0x2ac)])(this[_0x2f12cd(0x1b3)])&&_0x7ee4be[_0x2f12cd(0x174)](_0x59e7f7=>{const _0x2ad7d5=_0x2f12cd;_0x59e7f7[_0x2ad7d5(0x1b2)]=(0x0,utils_1[_0x2ad7d5(0x20a)])(_0x59e7f7['email']),_0x59e7f7[_0x2ad7d5(0x21b)]=(0x0,utils_1[_0x2ad7d5(0x20a)])(_0x59e7f7[_0x2ad7d5(0x21b)]);});const _0x3dfc9d=await this[_0x2f12cd(0x2e0)][_0x2f12cd(0x352)](_0x7ee4be,_0x3dddad);return{'rows':_0x3dfc9d,'count':Number(_0x1e7b64[0x0]?.[_0x2f12cd(0x16b)]||0x0)};}async[_0x434455(0x203)](_0x234355,_0xb5f2b0=0x1,_0x1cd1f1=0xa){const _0x559bca=_0x434455,{rows:_0xf853d4,count:_0xc65b2e}=await this[_0x559bca(0x2e0)][_0x559bca(0x299)](_0xb5f2b0,_0x1cd1f1,_0x234355[_0x559bca(0x14f)]['id'],collectType_constant_1[_0x559bca(0x33d)]['PPT']),_0x2aba85=await this[_0x559bca(0x2c6)]['find']({'where':{'id':(0x0,typeorm_1['In'])(_0xf853d4[_0x559bca(0x195)](_0x3e3bb3=>_0x3e3bb3[_0x559bca(0x370)]))}});return{'rows':_0x2aba85,'count':_0xc65b2e};}async[_0x434455(0x350)](_0x33ff29,_0x55116c){const _0x4ea3d5=_0x434455;if(!_0x33ff29[_0x4ea3d5(0x135)]||!_0x33ff29[_0x4ea3d5(0x135)]['length'])return!![];const _0x300bee={'id':(0x0,typeorm_1['In'])(_0x33ff29['ids'])};return _0x55116c&&(_0x300bee[_0x4ea3d5(0x271)]=_0x55116c),await this[_0x4ea3d5(0x2c6)][_0x4ea3d5(0x254)](_0x300bee,{'delFlag':0x1}),await this[_0x4ea3d5(0x2e0)][_0x4ea3d5(0x274)](_0x33ff29[_0x4ea3d5(0x135)],collectType_constant_1['UserCollectType'][_0x4ea3d5(0x136)]),!![];}async[_0x434455(0x2bb)](_0x1cc84b,_0x3d9c90){const _0x249226=_0x434455;try{let _0x51d9d5='';return await this[_0x249226(0x336)][_0x249226(0x34c)](async()=>{const _0x5d5713=_0x249226,_0x2bbeb5=(0x0,utils_1[_0x5d5713(0x305)])(this[_0x5d5713(0x1b3)]),{modelInfo:_0x43aacc}=await this['modelsService'][_0x5d5713(0x242)](model_constant_1[_0x5d5713(0x384)][_0x5d5713(0x2b1)],_0x5d5713(0x2f0));await this[_0x5d5713(0x1c5)]({'prompt':_0x3d9c90[_0x5d5713(0x1aa)][_0x5d5713(0x167)],'user':_0x1cc84b[_0x5d5713(0x14f)],'currentRequestModel':_0x43aacc});const _0x4e9dbd={'curIp':(0x0,utils_1[_0x5d5713(0x37c)])(_0x1cc84b),'prompt':_0x3d9c90[_0x5d5713(0x1aa)][_0x5d5713(0x167)],'modelId':_0x43aacc['id'],'modelType':_0x43aacc[_0x5d5713(0x206)],'answer':'','model':_0x43aacc['model'],'role':_0x5d5713(0x14f),'userId':_0x1cc84b[_0x5d5713(0x14f)]['id'],'completionTokens':0x0,'totalTokens':0x0,'type':balance_constant_1[_0x5d5713(0x2c4)][_0x5d5713(0x1bf)],'logType':0x1,'requestOptions':JSON[_0x5d5713(0x1a8)](_0x3d9c90),'saasId':_0x2bbeb5},_0x572d86={..._0x4e9dbd,'role':_0x5d5713(0x1d3),'requestOptions':JSON[_0x5d5713(0x1a8)]({'prompt':_0x3d9c90[_0x5d5713(0x1aa)][_0x5d5713(0x167)],'options':{'model':_0x43aacc[_0x5d5713(0x29a)]}})};await this[_0x5d5713(0x240)][_0x5d5713(0x1f3)](_0x4e9dbd),await this['chatLogService'][_0x5d5713(0x1f3)](_0x572d86),await this[_0x5d5713(0x2e0)][_0x5d5713(0x332)](_0x1cc84b[_0x5d5713(0x14f)]['id'],_0x43aacc,_0x572d86['id']);const _0x2c9bc9={'app':{'appid':_0x43aacc[_0x5d5713(0x36c)],'token':_0x43aacc['appid'],'cluster':_0x5d5713(0x159)},'user':{'uid':String(_0x1cc84b[_0x5d5713(0x14f)]['id'])},'audio':{'voice_type':_0x5d5713(0x31e),'encoding':_0x5d5713(0x358)},'request':{'reqid':(0x0,crypto_1[_0x5d5713(0x324)])(),'text':_0x3d9c90[_0x5d5713(0x1aa)][_0x5d5713(0x167)],'operation':'query'}},_0x17a09b=await this[_0x5d5713(0x19f)][_0x5d5713(0x2bb)]({'data':_0x2c9bc9,'headers':{'Authorization':'Bearer;'+_0x43aacc[_0x5d5713(0x308)]}}),_0x4dbcc0=chat_constant_1[_0x5d5713(0x327)][_0x5d5713(0x2b1)]+'-'+_0x2bbeb5+'-'+_0x1cc84b['user']['id']+'-'+new Date()['getTime']()+_0x5d5713(0x219);let _0x48ad20=(0x0,path_1[_0x5d5713(0x2d7)])(process['cwd'](),_0x5d5713(0x32d),_0x5d5713(0x226)),_0x406690=_0x5d5713(0x157);_0x406690=_0x406690+'/'+_0x4dbcc0;!(0x0,fs_1[_0x5d5713(0x17d)])(_0x48ad20)&&(0x0,fs_1[_0x5d5713(0x346)])(_0x48ad20,{'recursive':!![]});_0x48ad20=(0x0,path_1[_0x5d5713(0x2d7)])(_0x48ad20,_0x4dbcc0),(0x0,fs_1[_0x5d5713(0x142)])(_0x48ad20,_0x17a09b[_0x5d5713(0x2ff)],'base64');let _0x2ac3f9=process[_0x5d5713(0x197)][_0x5d5713(0x1e3)];_0x2ac3f9['startsWith'](_0x5d5713(0x140))?_0x51d9d5=_0x2ac3f9+_0x406690:_0x51d9d5='https://'+_0x2ac3f9+_0x406690,_0x572d86[_0x5d5713(0x18d)]=_0x51d9d5,await this[_0x5d5713(0x240)][_0x5d5713(0x1f3)](_0x572d86);}),_0x51d9d5;}catch(_0x4caa01){throw new common_1[(_0x249226(0x263))](_0x4caa01[_0x249226(0x26a)],common_1[_0x249226(0x2fd)][_0x249226(0x328)]);}}async[_0x434455(0x17c)](_0x186922,_0x169868,_0x4238d3){const _0x17b286=_0x434455;try{let _0x30602f,_0xf9cd7c;return await this[_0x17b286(0x336)][_0x17b286(0x34c)](async()=>{const _0x1e5040=_0x17b286,_0x42c1ca=(0x0,utils_1[_0x1e5040(0x305)])(this[_0x1e5040(0x1b3)]),{modelInfo:_0x22db6d}=await this[_0x1e5040(0x18a)][_0x1e5040(0x242)](model_constant_1[_0x1e5040(0x384)]['ASR'],_0x1e5040(0x2b6));await this[_0x1e5040(0x2e0)][_0x1e5040(0x1e4)](_0x186922[_0x1e5040(0x14f)]['id'],_0x22db6d);const _0x5e44a4={'groupId':_0x4238d3,'curIp':(0x0,utils_1[_0x1e5040(0x37c)])(_0x186922),'prompt':_0x169868,'modelId':_0x22db6d['id'],'modelType':_0x22db6d['modelType'],'answer':'','model':_0x22db6d[_0x1e5040(0x29a)],'role':_0x1e5040(0x14f),'userId':_0x186922['user']['id'],'completionTokens':0x0,'totalTokens':0x0,'type':balance_constant_1['DeductionKey']['CHAT_TYPE'],'logType':0x1,'requestOptions':JSON[_0x1e5040(0x1a8)]({'url':_0x169868}),'saasId':_0x42c1ca},_0x695db={..._0x5e44a4,'role':_0x1e5040(0x1d3),'requestOptions':JSON[_0x1e5040(0x1a8)]({'prompt':_0x169868,'options':{'model':_0x22db6d[_0x1e5040(0x29a)]}})};await this[_0x1e5040(0x240)][_0x1e5040(0x1f3)](_0x5e44a4),await this[_0x1e5040(0x240)][_0x1e5040(0x1f3)](_0x695db),await this[_0x1e5040(0x2e0)][_0x1e5040(0x332)](_0x186922[_0x1e5040(0x14f)]['id'],_0x22db6d,_0x695db['id']);let _0xfa8aa=process[_0x1e5040(0x197)][_0x1e5040(0x1e3)];!/^http/[_0x1e5040(0x25c)](_0xfa8aa)&&(_0xfa8aa=_0x1e5040(0x14b)+_0xfa8aa);const _0x6eb77b={'app':{'appid':_0x22db6d[_0x1e5040(0x36c)],'token':_0x22db6d['appid'],'cluster':'volc_auc_common'},'user':{'uid':String(_0x186922[_0x1e5040(0x14f)]['id'])},'audio':{'url':_0x169868,'format':_0x169868['split']('.')[_0x1e5040(0x248)]()},'request':{'callback':_0xfa8aa+_0x1e5040(0x371)}},_0x217215=await this[_0x1e5040(0x19f)][_0x1e5040(0x17c)]({'data':_0x6eb77b,'headers':{'Authorization':'Bearer;'+_0x22db6d[_0x1e5040(0x308)]}});_0x30602f=_0x217215['id'],_0xf9cd7c=await this[_0x1e5040(0x240)][_0x1e5040(0x1f3)](_0x695db);}),new Promise(_0x32f9c8=>{const _0x1f6db9=_0x17b286;utils_1['EE'][_0x1f6db9(0x2ca)](chat_constant_1[_0x1f6db9(0x327)]['ASR']+'-'+_0x30602f,async _0x320efe=>{const _0x2f2af0=_0x1f6db9;_0xf9cd7c[_0x2f2af0(0x18d)]=_0x320efe['text'],_0xf9cd7c=await this[_0x2f2af0(0x240)][_0x2f2af0(0x1f3)](_0xf9cd7c),_0x32f9c8(_0xf9cd7c);});});}catch(_0x2001d2){throw new common_1[(_0x17b286(0x263))](_0x2001d2['message'],common_1['HttpStatus'][_0x17b286(0x328)]);}}[_0x434455(0x1b7)](_0x3f264f){const _0x378e23=_0x434455;_0x3f264f[_0x378e23(0x303)]===0x3e8&&utils_1['EE'][_0x378e23(0x14c)](chat_constant_1[_0x378e23(0x327)][_0x378e23(0x35a)]+'-'+_0x3f264f['id'],_0x3f264f);}async[_0x434455(0x147)](_0x1e9bc6,_0x1ddc5b,_0x4d1951,_0x301350){const _0x4b077b=_0x434455;try{let _0x373df5=await this['connection'][_0x4b077b(0x34c)](async()=>{const _0x3b177e=_0x4b077b;let _0x18682b=new Date()['getTime'](),_0x12bcca=new Date()['getTime']();const _0x3c4913=_0x1e9bc6[_0x3b177e(0x14f)]['id'],_0x49cf3f=(0x0,utils_1[_0x3b177e(0x305)])(this['clsService']),_0x49989b=chat_constant_1[_0x3b177e(0x327)][_0x3b177e(0x35a)]+'-'+_0x49cf3f+'-'+_0x3c4913+'-'+new Date()[_0x3b177e(0x1e6)]()+_0x3b177e(0x219),_0x1e724f=await this[_0x3b177e(0x193)][_0x3b177e(0x22d)]({'filename':_0x49989b,'buffer':_0x301350[_0x3b177e(0x150)]});_0x12bcca=new Date()[_0x3b177e(0x1e6)](),console[_0x3b177e(0x22c)](_0x3b177e(0x2ab),_0x12bcca-_0x18682b);const _0x234d76=await this[_0x3b177e(0x17c)](_0x1e9bc6,_0x1e724f,_0x4d1951?.['options']?.[_0x3b177e(0x34b)]);_0x18682b=new Date()[_0x3b177e(0x1e6)](),console[_0x3b177e(0x22c)](_0x3b177e(0x158),_0x18682b-_0x12bcca),_0x4d1951['prompt']=_0x234d76[_0x3b177e(0x18d)];typeof _0x4d1951[_0x3b177e(0x1d9)]===_0x3b177e(0x378)&&(_0x4d1951[_0x3b177e(0x1d9)]=JSON[_0x3b177e(0x325)](_0x4d1951[_0x3b177e(0x1d9)]));const _0x2f26cd=await this[_0x3b177e(0x312)](_0x4d1951,_0x1e9bc6,_0x1ddc5b,![]);_0x12bcca=new Date()['getTime'](),console['log']('[耗时打印]文字对话耗时：',_0x12bcca-_0x18682b);const _0x15aa5f=await this[_0x3b177e(0x2bb)](_0x1e9bc6,{'request':{'text':_0x2f26cd['answer']}});_0x2f26cd[_0x3b177e(0x287)]=_0x15aa5f,this[_0x3b177e(0x240)][_0x3b177e(0x1f3)](_0x2f26cd),_0x18682b=new Date()['getTime'](),console[_0x3b177e(0x22c)](_0x3b177e(0x152),_0x18682b-_0x12bcca);const {prompt:_0x508a5a,role:_0x28fb52,answer:_0x515031,createdAt:_0x3910f4,conversationOptions:_0x22c2b5,requestOptions:_0x462aa1,id:_0x4f8671,answerMp3:_0x3f60ca}=_0x2f26cd;return{'chatId':_0x4f8671,'dateTime':(0x0,utils_1[_0x3b177e(0x2da)])(_0x3910f4),'text':_0x28fb52===_0x3b177e(0x14f)?_0x508a5a:_0x515031,'textMp3':_0x3f60ca,'inversion':_0x28fb52===_0x3b177e(0x14f),'error':![],'conversationOptions':_0x22c2b5?JSON[_0x3b177e(0x325)](_0x22c2b5):null,'requestOptions':_0x462aa1?JSON[_0x3b177e(0x325)](_0x462aa1):null};});_0x1ddc5b[_0x4b077b(0x339)](0xc8)[_0x4b077b(0x1a0)](result_1[_0x4b077b(0x262)][_0x4b077b(0x1a4)](_0x373df5));}catch(_0x2c73fc){throw new common_1[(_0x4b077b(0x263))](_0x2c73fc[_0x4b077b(0x26a)],common_1[_0x4b077b(0x2fd)][_0x4b077b(0x328)]);}}async[_0x434455(0x32b)](_0x34e9f7,_0x55ea61){const _0x3aab75=_0x434455,_0x294214=_0x55ea61[_0x3aab75(0x14f)]['id'],_0x12c6c7=await this[_0x3aab75(0x18a)][_0x3aab75(0x2ce)](_0x34e9f7);return{'remainCount':await this[_0x3aab75(0x2e0)][_0x3aab75(0x27c)](_0x294214,_0x12c6c7),'freeCount':_0x12c6c7[_0x3aab75(0x2fc)],'isVipFree':_0x12c6c7['vipFreeNum']==-0x1,'useIntegrate':_0x12c6c7[_0x3aab75(0x15d)]};}async[_0x434455(0x252)](_0x228134){const _0x2bf4e0=_0x434455,_0x4610cb=_0x228134[_0x2bf4e0(0x14f)]?.['id'],_0x54db6f=await this[_0x2bf4e0(0x18a)][_0x2bf4e0(0x1ab)](model_constant_1['EModelType'][_0x2bf4e0(0x335)]),_0x29e5f8=[];if(_0x4610cb)for(const _0x4fdb0a of _0x54db6f){_0x29e5f8[_0x2bf4e0(0x2b2)]({'id':_0x4fdb0a['id'],'keyType':_0x4fdb0a[_0x2bf4e0(0x185)],'model':_0x4fdb0a['model'],'name':_0x4fdb0a['modelName'],'modelType':_0x4fdb0a['modelType'],'remainCount':await this[_0x2bf4e0(0x2e0)][_0x2bf4e0(0x27c)](_0x4610cb,_0x4fdb0a),'freeCount':_0x4fdb0a[_0x2bf4e0(0x2fc)],'isVipFree':_0x4fdb0a[_0x2bf4e0(0x2fc)]==-0x1,'useIntegrate':_0x4fdb0a['deduct']});}else _0x54db6f['forEach'](_0x54b876=>{const _0x950b92=_0x2bf4e0;_0x29e5f8[_0x950b92(0x2b2)]({'id':_0x54b876['id'],'keyType':_0x54b876[_0x950b92(0x185)],'model':_0x54b876['model'],'name':_0x54b876['modelName'],'modelType':_0x54b876[_0x950b92(0x206)],'remainCount':0x0,'freeCount':_0x54b876[_0x950b92(0x2fc)],'isVipFree':_0x54b876[_0x950b92(0x2fc)]==-0x1,'useIntegrate':_0x54b876[_0x950b92(0x15d)]});});return _0x29e5f8;}async[_0x434455(0x171)](_0x4ac22d,_0x5ddc3d){const _0x374db1=_0x434455,_0x46179b=_0x4ac22d[_0x374db1(0x14f)]?.['id'];let _0x54cbbd=_0x5ddc3d[_0x374db1(0x185)];const _0x387e12=await this[_0x374db1(0x18a)][_0x374db1(0x37a)](model_constant_1[_0x374db1(0x384)][_0x374db1(0x335)],_0x54cbbd);if(!_0x387e12)throw new common_1[(_0x374db1(0x263))](_0x374db1(0x1f8),common_1[_0x374db1(0x2fd)]['BAD_REQUEST']);const _0x50dbaf=await this[_0x374db1(0x2e0)][_0x374db1(0x1cb)](_0x387e12,_0x5ddc3d);if(!_0x46179b)return{'remainCount':0x0,'freeCount':_0x387e12[_0x374db1(0x2fc)]>0x0?_0x387e12[_0x374db1(0x2fc)]:_0x50dbaf?.[_0x374db1(0x2fc)]||0x0,'isVipFree':_0x387e12['vipFreeNum']==-0x1||_0x50dbaf?.[_0x374db1(0x2fc)]==-0x1,'useIntegrate':_0x387e12[_0x374db1(0x15d)]>0x0?_0x387e12[_0x374db1(0x15d)]:_0x50dbaf?.[_0x374db1(0x1bc)]||0x0};return{'remainCount':await this[_0x374db1(0x2e0)][_0x374db1(0x28d)](_0x46179b,_0x387e12,_0x5ddc3d),'freeCount':_0x387e12['vipFreeNum']>0x0?_0x387e12[_0x374db1(0x2fc)]:_0x50dbaf?.[_0x374db1(0x2fc)]||0x0,'isVipFree':_0x387e12[_0x374db1(0x2fc)]==-0x1||_0x50dbaf?.[_0x374db1(0x2fc)]==-0x1,'useIntegrate':_0x387e12[_0x374db1(0x15d)]>0x0?_0x387e12['deduct']:_0x50dbaf?.[_0x374db1(0x1bc)]||0x0};}async['batchPPTResult'](){const _0x538d5a=_0x434455,_0x33abaf=await this[_0x538d5a(0x18a)]['getModelByType'](model_constant_1['EModelType']['PPT']),_0x1f9821=await this[_0x538d5a(0x2c6)][_0x538d5a(0x241)](_0x538d5a(0x266));_0x1f9821[_0x538d5a(0x234)]&&_0x1f9821[_0x538d5a(0x174)](async _0x4cf3a4=>{const _0x4f241b=_0x538d5a;this['asyncPPTProgress']({'baseURL':_0x33abaf['modelInfo'][_0x4f241b(0x379)],'headers':{'Authorization':_0x4f241b(0x18c)+_0x33abaf[_0x4f241b(0x1ca)][_0x4f241b(0x308)]},'params':{'id':_0x4cf3a4[_0x4f241b(0x194)]}});});const _0x14a4f5=await this['pptTaskEntity'][_0x538d5a(0x241)](_0x538d5a(0x251));_0x14a4f5[_0x538d5a(0x234)]&&_0x14a4f5['forEach'](async _0x4baa31=>{const _0x397ec7=_0x538d5a,_0x309700=await this['pptService'][_0x397ec7(0x19d)]({'baseURL':_0x33abaf[_0x397ec7(0x1ca)]['proxyUrl'],'headers':{'Authorization':_0x397ec7(0x18c)+_0x33abaf[_0x397ec7(0x1ca)][_0x397ec7(0x308)]},'params':{'id':_0x4baa31[_0x397ec7(0x194)],'type':'pdf'}});_0x309700[_0x397ec7(0x303)]=='200'&&_0x309700[_0x397ec7(0x2ff)][_0x397ec7(0x2d0)]&&(_0x4baa31['pdf_down_url']=_0x309700[_0x397ec7(0x2ff)][_0x397ec7(0x2d0)],await this[_0x397ec7(0x2c6)]['update']({'id':_0x4baa31['id']},{'pdfDownUrl':_0x4baa31[_0x397ec7(0x208)]}));});const _0x325230=await this[_0x538d5a(0x2c6)][_0x538d5a(0x241)](_0x538d5a(0x1e2));_0x325230[_0x538d5a(0x234)]&&_0x325230[_0x538d5a(0x174)](async _0x315fa1=>{const _0x138c45=_0x538d5a,_0x128738=await this[_0x138c45(0x14e)][_0x138c45(0x19d)]({'baseURL':_0x33abaf[_0x138c45(0x1ca)][_0x138c45(0x379)],'headers':{'Authorization':'Beare\x20'+_0x33abaf['modelInfo'][_0x138c45(0x308)]},'params':{'id':_0x315fa1[_0x138c45(0x194)],'type':_0x138c45(0x130)}});_0x128738['code']==_0x138c45(0x340)&&_0x128738[_0x138c45(0x2ff)]['download_url']&&(_0x315fa1[_0x138c45(0x268)]=_0x128738[_0x138c45(0x2ff)]['download_url'],await this[_0x138c45(0x2c6)]['update']({'id':_0x315fa1['id']},{'pngDownUrl':_0x315fa1[_0x138c45(0x268)]}));});try{const _0x27a4a5=store_2['PPTConfig']['pptTimeoutMs']||0x5,_0x2d1fda=[{'status':0x1,'type':ppt_constant_1['EPPTTaskType']['CREATE'],'updatedAt':(0x0,typeorm_1[_0x538d5a(0x1e7)])(new Date(Date[_0x538d5a(0x134)]()-_0x27a4a5*0x3c*0x3e8))}],_0x30ddee=await this[_0x538d5a(0x2c6)]['find']({'where':_0x2d1fda});_0x30ddee['forEach'](async _0x50659e=>{const _0x2f2e7e=_0x538d5a;_0x50659e[_0x2f2e7e(0x1ec)]=_0x2f2e7e(0x2ec),_0x50659e[_0x2f2e7e(0x339)]=0x3,this[_0x2f2e7e(0x2c6)]['save'](_0x50659e),this[_0x2f2e7e(0x2e0)]['debuctBalance4PPT'](_0x50659e[_0x2f2e7e(0x271)],_0x50659e['id'],_0x50659e[_0x2f2e7e(0x2b5)],!![]);});}catch(_0x5bac9a){common_1[_0x538d5a(0x290)][_0x538d5a(0x1a1)](_0x5bac9a);}}};ChatgptService=__decorate([(0x0,common_1[_0x434455(0x385)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(pptTask_entity_1[_0x434455(0x19a)])),__metadata('design:paramtypes',[typeorm_1[_0x434455(0x1f9)],nestjs_cls_1[_0x434455(0x16d)],user_service_1['UserService'],file_service_1[_0x434455(0x27b)],gpts_service_1[_0x434455(0x2cc)],yooPPT_service_1[_0x434455(0x181)],doubao_service_1['DoubaoService'],models_service_1[_0x434455(0x243)],chatLog_service_1[_0x434455(0x278)],lumaTask_service_1[_0x434455(0x33a)],runwayTask_service_1[_0x434455(0x1f6)],klingTask_service_1[_0x434455(0x13e)],sunoTask_service_1[_0x434455(0x31c)],badwords_service_1[_0x434455(0x190)],autoreply_service_1[_0x434455(0x360)],chatGroup_service_1[_0x434455(0x2e9)],globalConfig_service_1[_0x434455(0x131)],typeorm_1[_0x434455(0x20b)],mindTask_service_1[_0x434455(0x260)]])],ChatgptService),exports['ChatgptService']=ChatgptService;