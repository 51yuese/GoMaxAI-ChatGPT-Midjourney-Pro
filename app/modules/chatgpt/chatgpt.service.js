'use strict';const _0x2b172c=_0xa55e;function _0xa55e(_0x1e9423,_0x2370b8){const _0x46bc35=_0x46bc();return _0xa55e=function(_0xa55e19,_0x5cc6fa){_0xa55e19=_0xa55e19-0x1ac;let _0x2d3a76=_0x46bc35[_0xa55e19];return _0x2d3a76;},_0xa55e(_0x1e9423,_0x2370b8);}(function(_0x55a716,_0x12a82f){const _0x4f4220=_0xa55e,_0x22f01a=_0x55a716();while(!![]){try{const _0x456639=-parseInt(_0x4f4220(0x214))/0x1*(parseInt(_0x4f4220(0x1f1))/0x2)+parseInt(_0x4f4220(0x1f2))/0x3*(-parseInt(_0x4f4220(0x31a))/0x4)+parseInt(_0x4f4220(0x215))/0x5+-parseInt(_0x4f4220(0x21f))/0x6*(-parseInt(_0x4f4220(0x387))/0x7)+parseInt(_0x4f4220(0x308))/0x8*(parseInt(_0x4f4220(0x2f2))/0x9)+-parseInt(_0x4f4220(0x349))/0xa+-parseInt(_0x4f4220(0x355))/0xb*(-parseInt(_0x4f4220(0x264))/0xc);if(_0x456639===_0x12a82f)break;else _0x22f01a['push'](_0x22f01a['shift']());}catch(_0x21c02e){_0x22f01a['push'](_0x22f01a['shift']());}}}(_0x46bc,0x4bfe2));var __decorate=this&&this['__decorate']||function(_0x2a7bff,_0x5866d3,_0x5c5127,_0x4516b7){const _0x75ef9c=_0xa55e;var _0x2bdaf1=arguments[_0x75ef9c(0x1da)],_0x8f91d=_0x2bdaf1<0x3?_0x5866d3:_0x4516b7===null?_0x4516b7=Object[_0x75ef9c(0x371)](_0x5866d3,_0x5c5127):_0x4516b7,_0x5990fb;if(typeof Reflect===_0x75ef9c(0x389)&&typeof Reflect[_0x75ef9c(0x307)]===_0x75ef9c(0x1cc))_0x8f91d=Reflect[_0x75ef9c(0x307)](_0x2a7bff,_0x5866d3,_0x5c5127,_0x4516b7);else{for(var _0x278a60=_0x2a7bff[_0x75ef9c(0x1da)]-0x1;_0x278a60>=0x0;_0x278a60--)if(_0x5990fb=_0x2a7bff[_0x278a60])_0x8f91d=(_0x2bdaf1<0x3?_0x5990fb(_0x8f91d):_0x2bdaf1>0x3?_0x5990fb(_0x5866d3,_0x5c5127,_0x8f91d):_0x5990fb(_0x5866d3,_0x5c5127))||_0x8f91d;}return _0x2bdaf1>0x3&&_0x8f91d&&Object[_0x75ef9c(0x36f)](_0x5866d3,_0x5c5127,_0x8f91d),_0x8f91d;},__metadata=this&&this[_0x2b172c(0x28a)]||function(_0x3f2ed4,_0x3ff32d){const _0x222d53=_0x2b172c;if(typeof Reflect===_0x222d53(0x389)&&typeof Reflect['metadata']===_0x222d53(0x1cc))return Reflect[_0x222d53(0x23f)](_0x3f2ed4,_0x3ff32d);},__param=this&&this[_0x2b172c(0x1bc)]||function(_0x44da9e,_0xaa09e4){return function(_0x20f4d2,_0x4e8dba){_0xaa09e4(_0x20f4d2,_0x4e8dba,_0x44da9e);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['ChatgptService']=void 0x0;const file_service_1=require(_0x2b172c(0x3de)),user_service_1=require('./../user/user.service'),openai_1=require(_0x2b172c(0x268)),common_1=require(_0x2b172c(0x342)),errorMessage_constant_1=require(_0x2b172c(0x31e)),utils_1=require(_0x2b172c(0x3fe)),axios_1=require('axios'),balance_constant_1=require(_0x2b172c(0x33c)),chatLog_service_1=require(_0x2b172c(0x1d6)),uuid=require(_0x2b172c(0x3fc)),fs=require('fs'),typeorm_1=require(_0x2b172c(0x1db)),typeorm_2=require(_0x2b172c(0x31b)),badwords_service_1=require(_0x2b172c(0x24d)),autoreply_service_1=require(_0x2b172c(0x384)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),chatGroup_service_1=require(_0x2b172c(0x3f5)),models_service_1=require(_0x2b172c(0x36d)),baidu_1=require('./baidu'),helper_1=require(_0x2b172c(0x3c7)),store_1=require('./store'),zhipu_1=require(_0x2b172c(0x37e)),spark_1=require('./spark'),model_constant_1=require(_0x2b172c(0x393)),fs_1=require('fs'),path_1=require('path'),gpts_service_1=require(_0x2b172c(0x2b8)),yooPPT_service_1=require(_0x2b172c(0x331)),pptTask_entity_1=require(_0x2b172c(0x3e5)),ppt_constant_1=require(_0x2b172c(0x1fa)),lumaTask_service_1=require(_0x2b172c(0x285)),nestjs_cls_1=require(_0x2b172c(0x207)),doubao_service_1=require(_0x2b172c(0x224)),crypto_1=require(_0x2b172c(0x37a)),chat_constant_1=require(_0x2b172c(0x344)),result_1=require(_0x2b172c(0x29e)),runwayTask_service_1=require('../api/runwayTask.service'),klingTask_service_1=require(_0x2b172c(0x256)),sunoTask_service_1=require('../api/sunoTask.service'),mindTask_service_1=require(_0x2b172c(0x26c)),collectType_constant_1=require(_0x2b172c(0x2c7)),redisKey_constant_1=require(_0x2b172c(0x324)),store_2=require(_0x2b172c(0x3e6)),music_constant_1=require('../../common/constants/music.constant'),openapi_1=require('@volcengine/openapi');function _0x46bc(){const _0xc91870=['../models/models.service','end','defineProperty','schoolPicture','getOwnPropertyDescriptor','pptOnlineEditor','\x20image_url\x20','deductBalance4Chat','pptOutlinePrice','test','task_id','map','requestParams','crypto','is_end','appid','timeout','./zhipu','Your\x20request\x20was\x20rejected\x20as\x20a\x20result\x20of\x20our\x20safety\x20system','SunoTaskService','default','style','jmengImageTask','../autoreply/autoreply.service','getUserModelFree','configKimiApi','35AEqVGz','BadwordsService','object','openaiModel3MaxTokensRes','msg','formatModelToken','chat','audio','luma-video','data:\x20','query','price','../../common/constants/model.constant','chatMusic','importDynamic','updateLastMessage','@keyv/redis','i2v','pptx','ChatLogService','validateVideoBeforeChat','getUuid','getCurrentModelByChatGroupId','getClientIp','vipFreeNum','Service','images_url','data','musicUploadVipFree','DRAW','unlink','PPT','toISOString','autoreplyService','transcriptions','responseMessageWithThink','infer_ctx','\x20model:\x20','select\x20*\x20from\x20ppt_task\x20where\x20status=2\x20and\x20yoo_task_id\x20is\x20not\x20null\x20and\x20png_down_url\x20is\x20null','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(p.id)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ppt_task\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20p.user_id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','DeductionKey','video-task','startsWith','runwayTaskService','VipFree','json','createAPI','klingChatVideo','formatDate','aac','musicConfig','asr','chatDraw','pageCount','ChatGPTAPI','HttpStatus','responseMessage','ids','/api/v3','pptCreateFile','视频生成失败，没有响应','DESC','task_result','slice','./helper','email','transition','keyType','您的请求已被系统拒绝。您的提示可能存在一些非法的文本。','writeFileSync','ASR','未配置语音模型或语音模型key，请配置并启用语音功能！','user','pptCreatePrice','musicUpload','addOneIfOdd','modelSubType','DrawService','HttpException','debug','appId','listByGroupId','png','thirdId','getDrawModelVipFree','coverId','uploadFile','../file/file.service','pptRecPage','https://ark.cn-beijing.volces.com','musicCreateVipFree','abs','model','validateBeforeDraw','./entity/pptTask.entity','../../common/store','prompt\x20','tts-1','Content-type','png_down_url','模型类型不存在','pptChangeTheme','pptCreateThesis','OpenAiErrorCodeMessage','color','原始任务不存在！','totalTokens','getRandomKey','pptEditor','pdf','../chatGroup/chatGroup.service','checkUserStatus','modelId','Result','parentMessageId','volc_auc_common','failed','uuid','key:\x20','../../common/utils','pptAddPage','connection','stringify','getRandomAudioKey','join','getModelInfoByKeyType','Download','模型秘钥错误或模型金额不足，请联系管理员！','count','GptsService','getTime','当前模型key余额已耗尽、已冻结当前调用Key、尝试重新对话试试吧！','BV700_streaming','reasoning_content','pptCover','create','batchPPTResult','process_url','CREATE','YooPPTService','maskEmail','http','notify_hook','getKeyFree','fileUrl','validateBalance4Video','openaiModel4MaxTokens32kRes','\x20key\x20->\x20','listTaskByIds','gptsService','catalogs','pptDel','size','configDoubaoApi','statusCode','getRandomKeyForKeyType','musicLyricsVipFree','refundBalance4Chat','mindTaskId','sendMessageFromFastgpt','emit','from','runwayVideoTask','pdf_down_url','key','text','request','options','includes','url','gomaxai-chatlog','schoolLogo','mkdirSync','openAi','binary_data_base64','getModelByType','KLingTaskService','getUserInfoFromHeader','aspect_ratio',',\x20模型名称:\x20','You\x20exceeded\x20your\x20current\x20quota,\x20please\x20check\x20your\x20plan\x20and\x20billing\x20details.','内容提取失败','__param','request\x20gpt\x20','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','status','200','modelConfig','isSuper','saveVoiceChat','服务异常、请重新试试吧！！！','sunoMusicTask','COVER','musicCreate','UserService','RunwayTaskService','openaiModel3MaxTokens16k','yoo_task_id','function','Like','pptReCover','redis://','get','openaiModel3MaxTokens16kRes','\x0a\x20Respond\x20using\x20markdown.\x20\x0a\x20Current\x20date:\x20','files','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.del_flag\x20=\x200\x20and\x20(type=\x27create\x27\x20or\x20type=\x27file\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','openaiModel3MaxTokens','../chatLog/chatLog.service','jimeng_vgfm_i2v_l20','chatLogId','sendMessage','length','typeorm','Logger','configChatGptApi','findAndCount','globalConfigService','t2v','advisor','绘制图片失败，此次绘画被拒绝了！','/api/chatLog/notify-Suno-lyrics?id=','LumaTaskService','file','defaultBaseUrl','FileService','saveChatLog','image_urls','Incorrect\x20API\x20key\x20provided','config','sendMessageFromSpark','chatRealTime','本次调用:\x20','checkBadWords','PPTConfig','6CUmbPC','27RJGPZw','write','当前模型不是聊天模型','This\x20is\x20not\x20a\x20chat\x20model\x20and\x20thus\x20not\x20supported','downUrl','https://api.openai.com','initOpenAi','cwd','../../common/constants/ppt.constant','audio2text\x20','Error\x20in\x20pptConfig:','answer','choices','conversationId','modelName','yooTaskId','complex','CHAT_TYPE','api','transaction','Repository','nestjs-cls','pptConfig','success','Access-Control-Allow-Origin','Bearer\x20','[耗时打印]语音转文字耗时：','validateBalance4Chat','debuctBalance4PPT','/v1','base64','parse','pptResult','pleader','63533HKPnLh','705685xDUbtx','state','REDIS_PASSWORD','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.type,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.user_id\x20AS\x20userId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.title,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.sub_title\x20AS\x20subTitle,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.theme,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.catalogs,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.contents,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.notes,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.author,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.color,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.style,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.state_desc\x20as\x20stateDesc,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.font_name\x20AS\x20fontName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.transition,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.complex,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.cover_id\x20AS\x20coverId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.origin_id\x20AS\x20originId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.file_url\x20AS\x20fileUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.pleader,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.advisor,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school_logo\x20AS\x20schoolLogo,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.school_picture\x20AS\x20schoolPicture,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.slide_number\x20AS\x20slideNumber,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.slide_type\x20AS\x20slideType,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.yoo_task_id\x20AS\x20yooTaskId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.res_cover\x20AS\x20resCover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.editor_url\x20as\x20editorUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20u.email,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.images,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.preview_url\x20as\x20previewUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.pdf_down_url\x20as\x20pdfDownUrl,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.png_down_url\x20as\x20pngDownUrl\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ppt_task\x20p\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20p.user_id\x20=\x20u.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','deduct','getModelByKeyType','buildMessageFromParentMessageId','promptTokens','fontName','signal','568362nzXWto','close','setHeader','PAINT_TYPE','AUC7419233800922468658','../api/doubao.service','videos','path','title','sunoMusicId','all','post','type','completionParams','modelInfo','STRUCTURE','fastgpt','modelOptions','progressUrl','progress','/v1/images/generations','当前模型key已被封禁','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','当前模型不是聊天模型、已冻结当前调用Key、请重新尝试对话！','32k','绘制图片失败，请稍后试试吧！','floor','remove\x20file\x20%s\x20success','getVideoConfig','w2t','chatTask','getModelVipFree','metadata','validateBalance4Draw','musicLyrics','fileService','Cache-Control','klingVideoTask','Injectable','ADDPAGE','sunoTaskService','toLowerCase','FILE','debuctBalance4Muisc','deductBalance4Video','pptNote','../badwords/badwords.service','parseAndSaveVideo','BAD_REQUEST','modelType','https://','preset','getReqSaasId','select\x20*\x20from\x20ppt_task\x20where\x20status=2\x20and\x20yoo_task_id\x20is\x20not\x20null\x20and\x20pdf_down_url\x20is\x20null','----------Doubao---------','../api/klingTask.service','existsSync','getCurrentModel','conversationOptions','forEach','CVSync2AsyncSubmitTask','chatProcess','LYRICS','ratio','jmengChatVideo','suno-v3','当前模型key余额已耗尽，请充值！','Beare\x20','saveMindTask','12deAOov','getGroupInfoFromId','catch','pptOutline','openai','ChatgptService','task_status','/api/chatgpt/notify-asr','../mindTask/mindTask.service','accessToken','getModelsByModelType','\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','gomaxai-default-key','modelsService','VIDEO','-------------openAiErrHandler--------------','kling-video_std_5','klingTaskService','chatGroupService','select\x20*\x20from\x20ppt_task\x20where\x20\x20(status<>2\x20or\x20status\x20is\x20null\x20)and\x20yoo_task_id\x20is\x20not\x20null','user_prompt','completed','buildSystemMessage','SunoMusicTask','ADDNOTES','env','video_url','REDIS_USER','asyncPPTProgress','未获取到模型基础配置，请前往后台配置并启用','TTS','musicLyricsPrice','set','../api/lumaTask.service','error','assistant','endTime','slideNumber','__metadata','MindTaskService','findOne','isCustom','Invalid\x20user\x20information','startTime','chunked','PAYMENT_REQUIRED','/upload','onModuleInit','CHAT','think','jmeng-draw-task','file-extract','EMusicTaskType','GOMAXAI_HOST','lyrics','curIp','Unauthorized','getVideoFree','../../common/result','gen2','messageStore','lockKey','ChatGroupService','beforeChatProcess','string','绘制图片失败，请检查你的提示词是否有非法描述！','page_count','make_instrumental','VIP_FREE','同步PPT生成任务进度失败！','secret','once','musicUploadPrice','detail','systemMessage','returnDrawDetail','buildOptions','EModelType','\x0a\x20\x20\x20\x20\x20\x20','PPT不存在','result','last_image','UserCollectType','whisper-1','../gpts/gpts.service','clsService','draw\x20paompt\x20info\x20<======*******======>\x20','prompt','%\x27)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20OR\x20p.sub_title\x20LIKE\x20(\x27%','keyv','提供了错误的模型秘钥','voiceChat','准确的回答。同时，你会拒绝一切涉及恐怖主义，种族歧视，黄色暴力等问题的回答。Moonshot\x20AI\x20为专有名词，不','upload','PPT\x20任务不存在！','resolve','CVProcess','POST','theme','../../common/constants/collectType.constant','notifyAsr','musicCreatePrice','THESIS','proxyUrl','editorUrl','pptEditorPrice','openaiModel4MaxTokens32k','当前请求已过载、请稍等会儿再试试吧！','getVideoModelVipFree','kimiUpload','userId','RECOVER','[耗时打印]文字转语音耗时：','then','pptPage','author','OTHER','当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！','validateBeforeChat','Please\x20check\x20the\x20back-end\x20console','Bearer;','badwordsService','music-task','MUSIC','completionTokens','openaiBaseUrl','listUndoneVideoForLuma','EPPTTaskType','message_id','Content-Type','\x20--expand_prompt\x20','400\x20error','pptStructure','pptDownload','pptx_url','delta','uncollectByRelIds','download_url','openaiTimeoutMs','doubaoService','b64_json','2022-08-31','1166283ckWFKo','lumaTaskService','pptCreate','getModelConfig','openaiModel4MaxTokensRes','requestFromGpt','GlobalConfigService','ModelsService','图片生成失败','subTitle','https://api.moonshot.cn/v1','saveGptsUseLog','stream','%\x27)\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','chatMusicUpload','getModelById','模型秘钥错误或模型余额不足','bad\x20response\x20status\x20code\x20307','视频生成失败','saveUseLog','chatLogService','decorate','16EGxbXI','openaiModel4MaxTokens','语音转换失败','可翻译成其他语言。','gpt_description_prompt','THEME','message','code','abortController','relId','cn-north-1','contents','pptTaskEntity','model_name','getDrawFree','fileInfo','chatgpt','deductBalance4Draw','223268aKnPTx','@nestjs/typeorm','pptOutlineVipFree','gpts','../../common/constants/errorMessage.constant','mp3','role','save','音乐生成失败，没有响应','find','../../common/constants/redisKey.constant','image','\x20AND\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20p.title\x20LIKE\x20(\x27%','removeFile','completions','\x20OFFSET\x20','response','tts','arrayBuffer','originTaskId','pptAddNote','log','userService','../api/yooPPT.service','preview_url','EChatType','InjectRepository','gomaxAiStore','apiKey','getConfigByKeys','\x20--aspect_ratio\x20','update','setData','push','../../common/constants/balance.constant','previewUrl','resCover','systemPreMessage','chatMuiscTask','/api/chatLog/notify-Suno-upload?id=','@nestjs/common','trim','../../common/constants/chat.constant','toString','errMsg','pathname','gpt-3','2776120fsaLyB','pptTimeoutMs','当前模型key余额已耗尽','removeSpecialCharacters','webroot','params','pptService','mergeCollectData','\x20image_end_url\x20','system','extend','seed','4486724QMYxoe','usage','pop','buffer','image_url','createReadStream','pptCollectPage','phone','stateDesc','content','The\x20OpenAI\x20account\x20associated\x20with\x20this\x20API\x20key\x20has\x20been\x20deactivated.','checkAutoReply','images','abort','mindTaskService','succeed','\x20回复数不得大于等于模型上下文数,\x20已自动调整为\x20maxTokenRes:\x20','openAiErrHandler','AutoreplyService','answerMp3','finish_reason','split','jmengVideoTask','groupId'];_0x46bc=function(){return _0xc91870;};return _0x46bc();}let ChatgptService=class ChatgptService{constructor(_0x3109af,_0x18351e,_0x4e5887,_0x2eabc6,_0x596087,_0x43b9a3,_0x180f97,_0xfdb818,_0x10ab0c,_0x457077,_0x37b3ca,_0x4b042b,_0x1a887d,_0x34f4f0,_0x483b35,_0x27ea24,_0x3b491a,_0x552155,_0x1495ef){const _0x720d3a=_0x2b172c;this[_0x720d3a(0x314)]=_0x3109af,this[_0x720d3a(0x2b9)]=_0x18351e,this[_0x720d3a(0x330)]=_0x4e5887,this[_0x720d3a(0x242)]=_0x2eabc6,this[_0x720d3a(0x41c)]=_0x596087,this[_0x720d3a(0x34f)]=_0x43b9a3,this[_0x720d3a(0x2ef)]=_0x180f97,this[_0x720d3a(0x271)]=_0xfdb818,this['chatLogService']=_0x10ab0c,this[_0x720d3a(0x2f3)]=_0x457077,this['runwayTaskService']=_0x37b3ca,this[_0x720d3a(0x275)]=_0x4b042b,this[_0x720d3a(0x247)]=_0x1a887d,this['badwordsService']=_0x34f4f0,this[_0x720d3a(0x3a8)]=_0x483b35,this['chatGroupService']=_0x27ea24,this['globalConfigService']=_0x3b491a,this['connection']=_0x552155,this[_0x720d3a(0x363)]=_0x1495ef,this[_0x720d3a(0x1e6)]=_0x720d3a(0x1f7),this[_0x720d3a(0x2a0)]=null,this[_0x720d3a(0x335)]=null,this['removeFile']=_0x4f19ba=>{const _0x12c4ef=_0x720d3a;return fs[_0x12c4ef(0x3a5)](_0x4f19ba,_0x3fa54d=>{const _0x268828=_0x12c4ef;_0x3fa54d?console[_0x268828(0x32f)]('remove\x20file\x20',_0x3fa54d):console[_0x268828(0x32f)](_0x268828(0x23a),_0x4f19ba);});};}async[_0x2b172c(0x293)](){const _0x2500e4=_0x2b172c;let _0x1c02f3=await(0x0,utils_1[_0x2500e4(0x395)])(_0x2500e4(0x318));_0x1c02f3=_0x1c02f3?.[_0x2500e4(0x381)]?_0x1c02f3['default']:_0x1c02f3,this[_0x2500e4(0x204)]=_0x1c02f3[_0x2500e4(0x3bd)];let _0x1b1cbc=await(0x0,utils_1[_0x2500e4(0x395)])(_0x2500e4(0x2bd));_0x1b1cbc=_0x1b1cbc?.[_0x2500e4(0x381)]?_0x1b1cbc[_0x2500e4(0x381)]:_0x1b1cbc;let _0x1a84fa=await(0x0,utils_1[_0x2500e4(0x395)])(_0x2500e4(0x397));_0x1a84fa=_0x1a84fa?.[_0x2500e4(0x381)]?_0x1a84fa[_0x2500e4(0x381)]:_0x1a84fa;const _0x2df21b=+process['env']['REDIS_PORT'],_0x1c9959=process['env']['REDIS_HOST'],_0x3b8d47=process['env'][_0x2500e4(0x217)],_0x4f9156=process[_0x2500e4(0x27d)][_0x2500e4(0x27f)],_0x38e6d8=_0x2500e4(0x1cf)+(_0x4f9156||'')+':'+(_0x3b8d47||'')+'@'+_0x1c9959+':'+_0x2df21b,_0x1e26e4=new _0x1a84fa(_0x38e6d8);this[_0x2500e4(0x2a0)]=new _0x1b1cbc({'store':_0x1e26e4,'namespace':_0x2500e4(0x1b0)}),this[_0x2500e4(0x335)]=new store_1['NineStore']({'store':this[_0x2500e4(0x2a0)],'namespace':'chat'}),!this[_0x2500e4(0x1b3)]&&this[_0x2500e4(0x1f8)]();}[_0x2b172c(0x1f8)](){const _0x290295=_0x2b172c;this[_0x290295(0x1b3)]=new openai_1[(_0x290295(0x381))]({'apiKey':_0x290295(0x270),'baseURL':this[_0x290295(0x1e6)]+_0x290295(0x20f)});}async[_0x2b172c(0x2f5)](_0x382ea8){const _0x4122b2=_0x2b172c,{type:_0x23fb0d,groupId:_0x2bfa5a,modelType:_0x58fd9a,officialModel:_0x3a4a06,keyType:_0x215fa5}=_0x382ea8;console[_0x4122b2(0x32f)]('--------------------------------------------------------',_0x382ea8);let _0x16f6be,_0x20b921;_0x23fb0d&&_0x23fb0d==='gpts'?(_0x20b921=await this[_0x4122b2(0x41c)][_0x4122b2(0x265)](_0x2bfa5a),_0x16f6be=_0x20b921[_0x4122b2(0x3f7)]):_0x20b921=await this[_0x4122b2(0x276)][_0x4122b2(0x265)](_0x2bfa5a);let _0x38d946;if(_0x20b921)_0x38d946=JSON['parse'](_0x20b921[_0x4122b2(0x1eb)]);else{if(_0x215fa5)_0x38d946=await this[_0x4122b2(0x271)][_0x4122b2(0x404)](_0x58fd9a,_0x215fa5);else _0x58fd9a?_0x38d946=await this[_0x4122b2(0x271)]['getModelByType'](_0x58fd9a,_0x3a4a06):_0x38d946=await this[_0x4122b2(0x271)][_0x4122b2(0x1b5)](model_constant_1[_0x4122b2(0x2b1)][_0x4122b2(0x2d8)]);}if(!_0x38d946)throw new common_1[(_0x4122b2(0x3d5))](_0x4122b2(0x281),common_1[_0x4122b2(0x3be)][_0x4122b2(0x24f)]);return{'appId':_0x16f6be,'modelConfig':_0x38d946};}async['buildSystemMessage'](_0x57c097){const _0x40ada6=_0x2b172c,_0x4d1c21=this;let _0xbc8d92='',_0x44f0c6='',{type:_0x437819,appId:_0x100893,prompt:_0x14d5eb,custom:_0x5aba45,usingNetwork:_0x20c6b8,systemMessage:_0x6f09b3,customSystemMessage:_0x3cf28e}=_0x57c097;const _0x5455fb=async function(){const _0x1885a6=_0xa55e,_0x574235=new Date()[_0x1885a6(0x3a7)]()[_0x1885a6(0x36a)]('T')[0x0];return _0x44f0c6=await _0x4d1c21[_0x1885a6(0x1df)][_0x1885a6(0x337)]([_0x1885a6(0x33f)]),_0x44f0c6+(_0x1885a6(0x1d2)+_0x574235);};if(_0x100893){const _0x1367af=await this[_0x40ada6(0x41c)]['getAppById'](_0x100893,0x1);if(!_0x1367af)throw new common_1[(_0x40ada6(0x3d5))]('你当前使用的应用已被下架、请删除当前对话开启新的对话吧！',common_1[_0x40ada6(0x3be)][_0x40ada6(0x24f)]);_0x1367af[_0x40ada6(0x252)]&&(_0x6f09b3=_0x1367af[_0x40ada6(0x252)]);}else{if(_0x5aba45)_0x6f09b3=_0x6f09b3;else _0x3cf28e?_0x6f09b3=_0x3cf28e:_0x437819!=='gpts'&&(_0x6f09b3=await _0x5455fb());}return _0x20c6b8&&(_0xbc8d92=await(0x0,utils_1['compileNetwork'])(_0x14d5eb),!_0x44f0c6&&(_0x6f09b3=await _0x5455fb())),{'systemMessage':_0x6f09b3,'netWorkPrompt':_0xbc8d92};}async[_0x2b172c(0x258)](_0x212fcd){const _0x16fd42=_0x2b172c,{type:_0xc2fac5,custom:_0x555cd8,groupId:_0x1a5dbf,modelConfig:_0x4a0400}=_0x212fcd;let _0xf5ff72=null;if(!_0x555cd8&&!_0xc2fac5){const _0x5d65b7=await this[_0x16fd42(0x271)][_0x16fd42(0x1b5)](model_constant_1['EModelType']['CHAT'],_0x4a0400[_0x16fd42(0x22d)][_0x16fd42(0x3e3)]);_0xf5ff72=_0x5d65b7[_0x16fd42(0x22d)];}else{if(_0xc2fac5===_0x16fd42(0x31d))_0xf5ff72=await this[_0x16fd42(0x41c)][_0x16fd42(0x39d)](_0x1a5dbf);else{if(_0xc2fac5===_0x16fd42(0x1e5)){const _0x5730ac=await this[_0x16fd42(0x271)][_0x16fd42(0x1b5)](model_constant_1['EModelType']['FILE'],_0x4a0400[_0x16fd42(0x22d)][_0x16fd42(0x3e3)]);_0xf5ff72=_0x5730ac[_0x16fd42(0x22d)];}else _0x555cd8?_0xf5ff72=await this['modelsService'][_0x16fd42(0x3f2)](model_constant_1[_0x16fd42(0x2b1)][_0x16fd42(0x2d8)]):_0xf5ff72=await this[_0x16fd42(0x271)][_0x16fd42(0x3f2)](model_constant_1[_0x16fd42(0x2b1)][_0x16fd42(0x294)]);}}if(!_0xf5ff72)throw new common_1[(_0x16fd42(0x3d5))](_0x16fd42(0x235),common_1[_0x16fd42(0x3be)][_0x16fd42(0x24f)]);return _0xc2fac5===_0x16fd42(0x31d)?_0x4a0400[_0x16fd42(0x22d)]['model']=_0xf5ff72[_0x16fd42(0x3e3)]:_0xf5ff72[_0x16fd42(0x3e3)]=_0x4a0400['modelInfo'][_0x16fd42(0x3e3)],_0xf5ff72;}async[_0x2b172c(0x39b)](_0x32fc00){const _0x47b564=_0x2b172c,{user:_0x3f5df5,prompt:_0x4dbeb5,currentRequestModel:_0x486bbb,requestParams:_0x4769e6}=_0x32fc00;await this[_0x47b564(0x330)][_0x47b564(0x3f6)](_0x3f5df5),await this[_0x47b564(0x2dd)][_0x47b564(0x1ef)](_0x4dbeb5,_0x3f5df5['id']),await this[_0x47b564(0x330)][_0x47b564(0x418)](_0x3f5df5['id'],_0x486bbb,_0x4769e6);}async['validateBeforeChat'](_0x496722){const _0x1816d4=_0x2b172c,{user:_0x3d1570,prompt:_0x280a93,currentRequestModel:_0x444995}=_0x496722;await this[_0x1816d4(0x330)][_0x1816d4(0x3f6)](_0x3d1570),await this[_0x1816d4(0x2dd)]['checkBadWords'](_0x280a93,_0x3d1570['id']),await this[_0x1816d4(0x330)][_0x1816d4(0x20d)](_0x3d1570['id'],_0x444995);}async[_0x2b172c(0x3e4)](_0x3069ac){const _0x220244=_0x2b172c,{user:_0x448a75,prompt:_0x31dbea,currentRequestModel:_0x1e76ba,count:_0x298b17}=_0x3069ac;await this[_0x220244(0x330)]['checkUserStatus'](_0x448a75),await this[_0x220244(0x2dd)][_0x220244(0x1ef)](_0x31dbea,_0x448a75['id']),await this[_0x220244(0x330)][_0x220244(0x240)](_0x448a75['id'],_0x1e76ba,_0x298b17||0x1);}async[_0x2b172c(0x2b0)](_0x4c5ab5,_0x19782d,_0x516d46){const _0x5d0b02=_0x2b172c,_0x5f0aee=await this[_0x5d0b02(0x1df)][_0x5d0b02(0x337)]([_0x5d0b02(0x2ee)]),_0x2fa627=Number(_0x5f0aee)||0x493e0,_0x5e5ad8={'timeoutMs':+_0x2fa627,'systemMessage':_0x19782d||'','parentMessageId':_0x4c5ab5||'','completionParams':{'temperature':0.8,'model':_0x516d46['model']}};return _0x5e5ad8;}async[_0x2b172c(0x1dd)](_0x54476c,_0x496400){const _0x290abe=_0x2b172c;let _0x6013=_0x54476c[_0x290abe(0x2cb)];if(!_0x6013){const _0x46b951=await this[_0x290abe(0x1df)][_0x290abe(0x337)]([_0x290abe(0x2e1)]);_0x46b951?_0x6013=_0x46b951:_0x6013=_0x290abe(0x1f7);}const _0x495b7f=0x1f40,_0x119372=0x1000;let _0xe13092='v1';_0x6013['indexOf']('v2')==-0x1&&(_0x6013=_0x6013+'/'+_0xe13092);const _0x309601=new this[(_0x290abe(0x204))]({'maxModelTokens':_0x495b7f,'apiBaseUrl':_0x6013,'messageStore':this[_0x290abe(0x2a0)],'apiKey':(0x0,utils_1[_0x290abe(0x34c)])(_0x54476c[_0x290abe(0x42b)]),'maxResponseTokens':_0x119372>=_0x495b7f?Math[_0x290abe(0x3e2)](Math[_0x290abe(0x239)](_0x495b7f/0x2)):_0x119372});return _0x309601;}async[_0x2b172c(0x386)](_0x501b18){const _0x38673c=_0x2b172c,_0x3fd8b8=new openai_1['default']({'baseURL':_0x501b18[_0x38673c(0x2cb)]+_0x38673c(0x20f)||_0x38673c(0x2fc),'apiKey':_0x501b18['key']});return _0x3fd8b8;}async[_0x2b172c(0x420)](_0x261855){const _0x230135=_0x2b172c;let _0x506a34=_0x261855[_0x230135(0x2cb)]||_0x230135(0x3e0);const _0x521dab=new openai_1[(_0x230135(0x381))]({'baseURL':_0x506a34+_0x230135(0x3c1),'apiKey':(0x0,utils_1[_0x230135(0x34c)])(_0x261855['key'])});return _0x521dab;}async[_0x2b172c(0x2d1)](_0x28b164,_0x217cce,_0x278b37=null){const _0x20a57f=_0x2b172c;let _0x3a67df=[];for(const _0x17eb9c of _0x217cce){const _0x396561=new URL(_0x17eb9c);let _0x23030e=(0x0,path_1['join'])(process['cwd'](),'webroot',_0x396561[_0x20a57f(0x347)]);_0x23030e=decodeURIComponent(_0x23030e);const _0x3d43ed=await _0x28b164[_0x20a57f(0x1d3)][_0x20a57f(0x40e)]({'file':fs[_0x20a57f(0x35a)](_0x23030e),'purpose':_0x20a57f(0x297)});let _0x7cdaf3=await(await _0x28b164[_0x20a57f(0x1d3)][_0x20a57f(0x35e)](_0x3d43ed['id']))[_0x20a57f(0x42c)]();_0x3a67df['push']({'role':_0x20a57f(0x352),'content':_0x7cdaf3});}return _0x3a67df;}async[_0x2b172c(0x366)](_0x32274c,_0x291729){const _0x4e136b=_0x2b172c;console['log'](_0x4e136b(0x273),_0x32274c);let _0x53cc7b='',_0x54f5bd=_0x32274c['statusCode'];return!_0x53cc7b&&(_0x53cc7b=errorMessage_constant_1[_0x4e136b(0x3ee)][_0x54f5bd]?errorMessage_constant_1[_0x4e136b(0x3ee)][_0x54f5bd]:'服务异常、请重新试试吧！！！'),_0x32274c?.['message'][_0x4e136b(0x1ae)](_0x4e136b(0x35f))&&(await this[_0x4e136b(0x271)][_0x4e136b(0x2a1)](_0x291729['id'],'当前模型key已被封禁、已冻结当前调用Key、尝试重新对话试试吧！',-0x1),_0x53cc7b=_0x4e136b(0x234)),_0x32274c?.[_0x4e136b(0x421)]===0x1ad&&_0x32274c['message'][_0x4e136b(0x1ae)](_0x4e136b(0x1ba))&&(await this[_0x4e136b(0x271)]['lockKey'](_0x291729['id'],_0x4e136b(0x40a),-0x3),_0x53cc7b=_0x4e136b(0x34b)),_0x32274c?.[_0x4e136b(0x421)]===0x191&&_0x32274c[_0x4e136b(0x30e)][_0x4e136b(0x1ae)](_0x4e136b(0x1ea))&&(await this[_0x4e136b(0x271)][_0x4e136b(0x2a1)](_0x291729['id'],'模型秘钥错误或模型余额不足',-0x2),_0x53cc7b='模型秘钥错误或模型金额不足，请联系管理员！'),_0x32274c?.[_0x4e136b(0x421)]===0x191&&(_0x53cc7b=_0x4e136b(0x406)),_0x32274c?.[_0x4e136b(0x421)]===0x191&&_0x32274c[_0x4e136b(0x30e)][_0x4e136b(0x1ae)](_0x4e136b(0x29c))&&(await this['modelsService'][_0x4e136b(0x2a1)](_0x291729['id'],_0x4e136b(0x302),-0x2),_0x53cc7b='模型秘钥错误或模型金额不足，请联系管理员！'),_0x32274c?.[_0x4e136b(0x421)]===0x194&&_0x32274c[_0x4e136b(0x30e)][_0x4e136b(0x1ae)](_0x4e136b(0x1f5))&&(await this[_0x4e136b(0x271)][_0x4e136b(0x2a1)](_0x291729['id'],_0x4e136b(0x1f4),-0x4),_0x53cc7b=_0x4e136b(0x236)),_0x53cc7b;}[_0x2b172c(0x3aa)](_0x21bda6,_0x441d0f,_0x3e7cce,_0x33e233,_0x591abf){const _0x2d83c9=_0x2b172c;let _0x28eb27='';_0x441d0f[_0x2d83c9(0x2ad)][_0x2d83c9(0x1fe)][_0x2d83c9(0x1da)]&&_0x441d0f[_0x2d83c9(0x2ad)]['choices'][_0x2d83c9(0x25a)](_0x5c75ed=>{const _0x225f8b=_0x2d83c9;_0x5c75ed[_0x225f8b(0x2eb)]?.[_0x225f8b(0x40c)]&&(_0x28eb27+=_0x5c75ed[_0x225f8b(0x2eb)][_0x225f8b(0x40c)]);});_0x441d0f[_0x2d83c9(0x295)]=_0x28eb27;if(_0x3e7cce)_0x21bda6[_0x2d83c9(0x1f3)]('data:\x20'+JSON[_0x2d83c9(0x401)](_0x441d0f)+'\x0a\x0a');else _0x33e233&&_0x21bda6[_0x2d83c9(0x1f3)](_0x591abf?JSON[_0x2d83c9(0x401)](_0x441d0f):'\x0a'+JSON['stringify'](_0x441d0f));return _0x28eb27;}[_0x2b172c(0x3bf)](_0x177f91,_0x3fb87b,_0x4955e3,_0x54c228,_0x2eab73){const _0x528937=_0x2b172c;if(_0x4955e3)console[_0x528937(0x32f)](_0x528937(0x255),_0x3fb87b),_0x177f91[_0x528937(0x1f3)](_0x528937(0x390)+JSON[_0x528937(0x401)](_0x3fb87b)+'\x0a\x0a');else _0x54c228&&(console['log']('----------Doubao---------',_0x3fb87b),_0x177f91[_0x528937(0x1f3)](_0x2eab73?JSON[_0x528937(0x401)](_0x3fb87b):'\x0a'+JSON[_0x528937(0x401)](_0x3fb87b)));}async[_0x2b172c(0x2a3)](_0x4e5a96,_0x5ecb5c){const _0x203e68=_0x2b172c,{options:options={},prompt:_0x4649d6,cusromPrompt:_0x1214e9}=_0x4e5a96,{groupId:_0x5d3265,type:_0x329c2f}=options,{modelConfig:_0x3e96ca}=await this[_0x203e68(0x2f5)]({'type':_0x329c2f,'groupId':_0x5d3265}),_0x234dc3=await this[_0x203e68(0x258)]({'type':_0x329c2f,'groupId':_0x5d3265,'modelConfig':_0x3e96ca,'custom':_0x1214e9});return await this['validateBeforeChat']({'prompt':_0x4649d6,'currentRequestModel':_0x234dc3,'user':_0x5ecb5c[_0x203e68(0x3cf)]}),!![];}async['chatProcess'](_0x281e47,_0x4924fa,_0x3385a3,_0xa1bb9c=!![],_0x33442b=''){const _0x37451d=_0x2b172c;try{const _0x6ebd11=_0x4924fa[_0x37451d(0x310)],_0x21be3c=(0x0,utils_1['getReqSaasId'])(this['clsService']),{options:options={},prompt:_0x239d37,cusromPrompt:_0x1493bd,assetsId:_0x4fe121,autoVoice:_0x37e6c7}=_0x281e47,{groupId:_0x1f0a96,usingNetwork:_0x3afb28,parentMessageId:_0xcdf1b9,type:_0x44a11f}=options,{appId:_0x5d36e3,modelConfig:_0x50496e}=await this['getModelConfig']({'type':_0x44a11f,'groupId':_0x1f0a96}),{systemMessage:_0x44fef1,netWorkPrompt:_0x16887b}=await this[_0x37451d(0x27a)]({'type':_0x44a11f,'appId':_0x5d36e3,'prompt':_0x239d37,'usingNetwork':_0x3afb28,'custom':_0x1493bd,'systemMessage':_0x281e47[_0x37451d(0x2ae)],'customSystemMessage':_0x281e47['customSystemMessage']||_0x50496e[_0x37451d(0x22d)][_0x37451d(0x2ae)]}),_0x4650c8=await this[_0x37451d(0x258)]({'type':_0x44a11f,'groupId':_0x1f0a96,'modelConfig':_0x50496e,'custom':_0x1493bd});await this[_0x37451d(0x2da)]({'prompt':_0x239d37,'currentRequestModel':_0x4650c8,'user':_0x4924fa['user']});let _0x45a1ab='';const _0x2ee1c4=await this[_0x37451d(0x3a8)][_0x37451d(0x360)](_0x239d37);_0x3385a3&&_0xa1bb9c&&(!_0x281e47[_0x37451d(0x2fe)]?_0x3385a3[_0x37451d(0x221)](_0x37451d(0x3e9),'application/octet-stream;\x20charset=utf-8'):(_0x3385a3[_0x37451d(0x221)](_0x37451d(0x2e5),'text/event-stream'),_0x3385a3['setHeader']('Transfer-Encoding',_0x37451d(0x290)),_0x3385a3[_0x37451d(0x221)](_0x37451d(0x243),'no-cache'),_0x3385a3[_0x37451d(0x221)]('X-Accel-Buffering','no'),_0x3385a3[_0x37451d(0x221)](_0x37451d(0x20a),'*')));if(_0x2ee1c4){if(_0x3385a3&&_0xa1bb9c){const _0x5d0eeb={'message':_0x2ee1c4,'code':0x1f4};_0x3385a3[_0x37451d(0x1f3)](JSON['stringify'](_0x5d0eeb)),_0x3385a3[_0x37451d(0x36e)]();return;}else return _0x2ee1c4;}const _0x408ed9=await this['buildOptions'](options[_0x37451d(0x3f9)],_0x44fef1,_0x4650c8);options['model']&&(_0x408ed9['completionParams']['model']=options[_0x37451d(0x3e3)]);let {model:_0x108566,rounds:_0x1de7a9,keyType:_0x3a7f3e,modelType:_0x4fd280,id:_0x35bae1,topN:_0x3b5fdd}=_0x50496e['modelInfo'];const {key:_0x267562,modelName:_0x5bc034,id:_0x385adb,accessToken:_0x16706b}=_0x4650c8;_0x108566=_0x408ed9[_0x37451d(0x22c)][_0x37451d(0x3e3)];_0x3385a3&&_0xa1bb9c&&_0x3385a3[_0x37451d(0x1bf)](0xc8);let _0x11fc73=null,_0x535606=null;const _0x5e5275=(0x0,utils_1[_0x37451d(0x39e)])(_0x4924fa),_0x27d795={'appId':_0x5d36e3,'curIp':_0x5e5275,'prompt':_0x239d37,'groupId':_0x1f0a96,'modelId':_0x35bae1,'modelType':_0x4fd280,'answer':'','model':_0x108566,'role':'user','userId':_0x4924fa[_0x37451d(0x3cf)]['id'],'completionTokens':0x0,'type':balance_constant_1['DeductionKey'][_0x37451d(0x203)],'logType':_0x44a11f===_0x37451d(0x31d)?0x2:0x1,'requestOptions':JSON[_0x37451d(0x401)]({'options':options,'prompt':_0x239d37}),'saasId':_0x21be3c,'modelSubType':_0x33442b},_0x3c177c={..._0x27d795,'role':'assistant','requestOptions':JSON[_0x37451d(0x401)]({'prompt':_0x239d37,'options':{'model':_0x108566,'temperature':_0x3b5fdd}})};try{if(_0x3385a3){let _0x24b060=null,_0x4b6b46=![];_0x3385a3['on'](_0x37451d(0x220),async()=>{const _0x5a00af=_0x37451d;if(_0x4b6b46)return;_0x6ebd11[_0x5a00af(0x362)]();const _0x3a682b=0x0,_0x24c8e6=0x0,_0x374249=_0x3a682b+_0x24c8e6;_0x27d795[_0x5a00af(0x3f1)]=_0x3a682b,_0x27d795['promptTokens']=_0x3a682b,await this[_0x5a00af(0x306)][_0x5a00af(0x1e8)](_0x27d795),_0x3c177c[_0x5a00af(0x1fd)]=_0x24b060?.[_0x5a00af(0x42c)],_0x3c177c[_0x5a00af(0x3f1)]=_0x374249,_0x3c177c[_0x5a00af(0x21c)]=_0x3a682b,_0x3c177c[_0x5a00af(0x2e0)]=_0x24c8e6,_0x3c177c[_0x5a00af(0x259)]=JSON['stringify']({'conversationId':_0x24b060?.[_0x5a00af(0x1ff)],'model':_0x108566,'parentMessageId':_0x24b060?.['id'],'temperature':_0x3b5fdd});const _0x4e3f79=await this['chatLogService'][_0x5a00af(0x1e8)](_0x3c177c);if(_0x33442b=='mind'){const _0x251119=await this[_0x5a00af(0x363)][_0x5a00af(0x263)]({'id':_0x4fe121,'userId':_0x4e3f79[_0x5a00af(0x2d2)],'chatLogId':_0x4e3f79['id'],'prompt':_0x4e3f79[_0x5a00af(0x2bb)],'result':_0x3c177c[_0x5a00af(0x1fd)],'status':0x1});_0x11fc73[_0x5a00af(0x425)]=_0x251119['id'];}await this['userService'][_0x5a00af(0x374)](_0x4924fa[_0x5a00af(0x3cf)]['id'],_0x4650c8,_0x4e3f79['id']);}),_0x3385a3['on']('error',_0x3b83f8=>{const _0x3bd096=_0x37451d;console[_0x3bd096(0x32f)](_0x3b83f8);});if(Number(_0x3a7f3e)===0x1){if(_0x4650c8['modelName'][_0x37451d(0x248)]()[_0x37451d(0x1ae)](_0x37451d(0x22f))){let _0x2ad030=!![];const _0x5a721c=await this[_0x37451d(0x335)][_0x37451d(0x21b)](_0x3afb28?_0x16887b:_0x239d37,{'parentMessageId':_0xcdf1b9,'maxRounds':(0x0,helper_1[_0x37451d(0x3d2)])(_0x1de7a9)});_0x11fc73=await(0x0,zhipu_1[_0x37451d(0x426)])(_0x3afb28?_0x16887b:_0x5a721c,{'key':_0x4650c8[_0x37451d(0x42b)],'chatId':this[_0x37451d(0x335)]['getUuid'](),'model':_0x108566,'apiUrl':_0x4650c8[_0x37451d(0x2cb)],'onProgress':_0x15ffa7=>{const _0x24147c=_0x37451d;this[_0x24147c(0x3bf)](_0x3385a3,_0x15ffa7,_0x281e47[_0x24147c(0x2fe)],_0xa1bb9c,_0x2ad030),_0x2ad030=![],_0x24b060=_0x15ffa7;}}),_0x4b6b46=!![];}else{let _0x1e34bd=!![];const _0x416e87=await this[_0x37451d(0x1dd)](_0x4650c8,_0x408ed9);_0x11fc73=await _0x416e87[_0x37451d(0x1d9)](_0x3afb28?_0x16887b:_0x239d37,{..._0x408ed9,'onProgress':_0x35c977=>{const _0x59a1ad=_0x37451d;let _0x2018b8=this['responseMessageWithThink'](_0x3385a3,_0x35c977,_0x281e47[_0x59a1ad(0x2fe)],_0xa1bb9c,_0x1e34bd);_0x45a1ab+=_0x2018b8,_0x1e34bd=![],_0x24b060=_0x35c977;},'abortSignal':_0x6ebd11[_0x37451d(0x21e)]}),_0x4b6b46=!![];}}if(Number(_0x3a7f3e)===0x2){let _0x129467=!![];const _0x4d58d5=await this[_0x37451d(0x335)]['buildMessageFromParentMessageId'](_0x3afb28?_0x16887b:_0x239d37,{'parentMessageId':_0xcdf1b9,'maxRounds':(0x0,helper_1[_0x37451d(0x3d2)])(_0x1de7a9)});_0x11fc73=await(0x0,baidu_1['sendMessageFromBaidu'])(_0x3afb28?_0x16887b:_0x4d58d5,{'temperature':_0x3b5fdd,'accessToken':_0x16706b,'model':_0x108566,'onProgress':_0x224903=>{const _0x2c111e=_0x37451d;this[_0x2c111e(0x3bf)](_0x3385a3,_0x224903,_0x281e47['stream'],_0xa1bb9c,_0x129467),_0x129467=![],_0x24b060=_0x224903;}}),_0x4b6b46=!![];}if(Number(_0x3a7f3e)===0x3){let _0x519d7c=!![];const _0x50bc1=await this[_0x37451d(0x335)][_0x37451d(0x21b)](_0x3afb28?_0x16887b:_0x239d37,{'parentMessageId':_0xcdf1b9,'maxRounds':(0x0,helper_1[_0x37451d(0x3d2)])(_0x1de7a9)});console[_0x37451d(0x32f)](_0x50bc1),_0x11fc73=await(0x0,zhipu_1['sendMessageFromZhipu'])(_0x3afb28?_0x16887b:_0x50bc1,{'temperature':_0x3b5fdd,'key':_0x267562,'model':_0x108566,'onProgress':_0x709698=>{const _0x54e2a8=_0x37451d;this[_0x54e2a8(0x3bf)](_0x3385a3,_0x709698,_0x281e47[_0x54e2a8(0x2fe)],_0xa1bb9c,_0x519d7c),_0x519d7c=![],_0x24b060=_0x709698;}}),_0x4b6b46=!![];}if(Number(_0x3a7f3e)===0x4){let _0xdce914=!![];const _0x2ef39d=await this[_0x37451d(0x335)][_0x37451d(0x21b)](_0x3afb28?_0x16887b:_0x239d37,{'parentMessageId':_0xcdf1b9,'maxRounds':(0x0,helper_1[_0x37451d(0x3d2)])(_0x1de7a9)});_0x11fc73=await(0x0,spark_1[_0x37451d(0x1ec)])(_0x3afb28?_0x16887b:_0x2ef39d,{'temperature':_0x3b5fdd,'key':_0x267562,'model':_0x108566,'onProgress':_0x200c87=>{const _0xf67af7=_0x37451d;this[_0xf67af7(0x3bf)](_0x3385a3,_0x200c87,_0x281e47[_0xf67af7(0x2fe)],_0xa1bb9c,_0xdce914),_0xdce914=![],_0x24b060=_0x200c87;}}),_0x4b6b46=!![];}if(Number(_0x3a7f3e)===0x7){_0x11fc73={};const _0x28aaf1=await this['configKimiApi'](_0x4650c8);let _0x1b4e0d=!![],_0xf24364=[],_0x3b9895=!![];const _0x1990da=[],_0x51fab6=[],_0x31aa5e=_0x239d37[_0x37451d(0x36a)]('\x20');for(let _0x4970e2=0x0;_0x4970e2<_0x31aa5e['length'];_0x4970e2++){_0x1b4e0d&&/^[http:\/\/|https:\/\/]/[_0x37451d(0x376)](_0x31aa5e[_0x4970e2])?_0x1990da[_0x37451d(0x33b)](_0x31aa5e[_0x4970e2]):(_0x1b4e0d=![],_0x31aa5e[_0x4970e2]&&_0x51fab6[_0x37451d(0x33b)](_0x31aa5e[_0x4970e2]));}if(options[_0x37451d(0x3f9)]){const _0x2a6104=await this[_0x37451d(0x306)][_0x37451d(0x3d8)](options[_0x37451d(0x36c)]);_0xf24364=_0x2a6104[_0x37451d(0x378)](_0x333e2b=>{const _0x12d318=_0x37451d;return{'role':_0x333e2b[_0x12d318(0x320)]===_0x12d318(0x3cf)?_0x12d318(0x3cf):_0x12d318(0x352),'content':_0x333e2b[_0x12d318(0x2bb)]||_0x333e2b[_0x12d318(0x1fd)]};});}const _0x10a52c=await this[_0x37451d(0x2d1)](_0x28aaf1,_0x1990da),_0x53361a=[..._0xf24364,..._0x10a52c,{'role':'system','content':'你是\x20Kimi，由\x20Moonshot\x20AI\x20提供的人工智能助手，你更擅长中文和英文的对话。你会为用户提供安全，有帮助，'+_0x37451d(0x2c0)+_0x37451d(0x30b)},{'role':'user','content':_0x51fab6[_0x37451d(0x403)]('\x20')}],_0x570c37=await _0x28aaf1[_0x37451d(0x38d)][_0x37451d(0x328)][_0x37451d(0x40e)]({'stream':!![],..._0x408ed9,'messages':_0x53361a,'model':_0x4650c8[_0x37451d(0x3e3)]});for await(const _0x2805a5 of _0x570c37){const _0x569554=_0x2805a5?.['choices'][0x0],_0x54ab0a=_0x569554?.[_0x37451d(0x2eb)];_0x11fc73['detail']=_0x2805a5,_0x2805a5['id']&&(_0x11fc73['id']=_0x2805a5['id']),_0x54ab0a['role']&&(_0x11fc73[_0x37451d(0x320)]=_0x54ab0a[_0x37451d(0x320)]),_0x54ab0a&&_0x54ab0a[_0x37451d(0x35e)]&&(_0x11fc73['text']+=_0x54ab0a[_0x37451d(0x35e)],_0x11fc73[_0x37451d(0x2eb)]=_0x54ab0a?.[_0x37451d(0x35e)]),_0x569554[_0x37451d(0x369)]&&(_0x11fc73[_0x37451d(0x42c)]=_0x11fc73[_0x37451d(0x42c)][_0x37451d(0x343)]()),this[_0x37451d(0x3bf)](_0x3385a3,_0x11fc73,_0x281e47[_0x37451d(0x2fe)],_0xa1bb9c,_0x3b9895),_0x3b9895=![],_0x24b060=_0x2805a5;}}if(Number(_0x3a7f3e)===0x8){_0x11fc73={'text':''};const _0x3229f3=await this[_0x37451d(0x420)](_0x4650c8);let _0x3ed70c=!![],_0x1bc6d8=[],_0x4190fe=!![];const _0x481267=[],_0xbd1425=[],_0x155881=_0x239d37[_0x37451d(0x36a)]('\x20');for(let _0xab9fca=0x0;_0xab9fca<_0x155881[_0x37451d(0x1da)];_0xab9fca++){_0x3ed70c&&/^[http:\/\/|https:\/\/]/[_0x37451d(0x376)](_0x155881[_0xab9fca])?_0x481267[_0x37451d(0x33b)](_0x155881[_0xab9fca]):(_0x3ed70c=![],_0x155881[_0xab9fca]&&_0xbd1425[_0x37451d(0x33b)](_0x155881[_0xab9fca]));}if(options['parentMessageId']){const _0x530d58=await this[_0x37451d(0x306)]['listByGroupId'](options[_0x37451d(0x36c)]);_0x1bc6d8=_0x530d58[_0x37451d(0x378)](_0x1e1d76=>{const _0x53ef7d=_0x37451d;return{'role':_0x1e1d76[_0x53ef7d(0x320)]===_0x53ef7d(0x3cf)?'user':_0x53ef7d(0x352),'content':_0x1e1d76[_0x53ef7d(0x2bb)]||_0x1e1d76[_0x53ef7d(0x1fd)]};});}let _0x29142b=[];for(const _0x1d0498 of _0x481267){_0x29142b[_0x37451d(0x33b)]({'type':_0x37451d(0x359),'image_url':{'url':_0x1d0498}});}let _0x1ab1a7=[];_0x29142b[_0x37451d(0x1da)]?_0x1ab1a7=[..._0x1bc6d8,{'role':_0x37451d(0x3cf),'content':[{'text':_0xbd1425[_0x37451d(0x403)]('\x20'),'type':'text'},..._0x29142b]}]:_0x1ab1a7=[..._0x1bc6d8,{'role':_0x37451d(0x3cf),'content':_0xbd1425['join']('\x20')}];const _0x1208ed=await _0x3229f3[_0x37451d(0x38d)][_0x37451d(0x328)][_0x37451d(0x40e)]({'stream':!![],..._0x408ed9,'messages':_0x1ab1a7,'model':_0x4650c8[_0x37451d(0x3e3)]});for await(const _0x2614f5 of _0x1208ed){const _0xc70298=_0x2614f5?.[_0x37451d(0x1fe)][0x0],_0x565816=_0xc70298?.[_0x37451d(0x2eb)];_0x11fc73['detail']=_0x2614f5;_0x2614f5['id']&&(_0x11fc73['id']=_0x2614f5['id']);_0x565816[_0x37451d(0x320)]&&(_0x11fc73['role']=_0x565816[_0x37451d(0x320)]);_0x565816&&_0x565816[_0x37451d(0x35e)]&&(_0x11fc73[_0x37451d(0x42c)]+=_0x565816[_0x37451d(0x35e)],_0x11fc73[_0x37451d(0x2eb)]=_0x565816?.[_0x37451d(0x35e)]);_0xc70298[_0x37451d(0x369)]&&(_0x11fc73[_0x37451d(0x42c)]=_0x11fc73['text'][_0x37451d(0x343)]());let _0x375aa8=this[_0x37451d(0x3aa)](_0x3385a3,_0x11fc73,_0x281e47[_0x37451d(0x2fe)],_0xa1bb9c,_0x4190fe);_0x45a1ab+=_0x375aa8,_0x4190fe=![],_0x24b060=_0x2614f5;}_0x4b6b46=!![];}const _0x5105aa={'id':this[_0x37451d(0x335)]['getUuid'](),'text':_0x239d37,'role':'user','name':undefined,'usage':null,'parentMessageId':_0xcdf1b9,'conversationId':_0x11fc73?.['conversationId']||null};_0x535606={'model':_0x108566,'parentMessageId':_0xcdf1b9},await this[_0x37451d(0x335)][_0x37451d(0x33a)](_0x5105aa);const _0xb26643={'id':_0x11fc73?.['id']||this['gomaxAiStore'][_0x37451d(0x39c)](),'text':_0x11fc73[_0x37451d(0x42c)],'role':_0x37451d(0x287),'name':undefined,'usage':_0x11fc73[_0x37451d(0x356)],'parentMessageId':_0x5105aa['id'],'conversationId':_0x11fc73?.[_0x37451d(0x1ff)]};await this[_0x37451d(0x335)][_0x37451d(0x33a)](_0xb26643),_0x535606={'model':_0x108566,'parentMessageId':_0x5105aa['id']};}else{console[_0x37451d(0x32f)]('fanyi\x20mj-associate');const _0x16ef06=await this[_0x37451d(0x1dd)](_0x4650c8,_0x408ed9);_0x11fc73=await _0x16ef06[_0x37451d(0x1d9)](_0x3afb28?_0x16887b:_0x239d37,_0x408ed9);}const _0x43bba7=(0x0,helper_1['unifiedFormattingResponse'])(_0x3a7f3e,_0x11fc73,_0x535606),{prompt_tokens:prompt_tokens=0x0,completion_tokens:completion_tokens=0x0,total_tokens:total_tokens=0x0}=_0x43bba7[_0x37451d(0x356)];_0x44a11f==='gpts'?await this[_0x37451d(0x41c)][_0x37451d(0x2fd)](_0x385adb,total_tokens):await this[_0x37451d(0x271)][_0x37451d(0x305)](_0x385adb,total_tokens);_0x27d795[_0x37451d(0x3f1)]=total_tokens,await this['chatLogService'][_0x37451d(0x1e8)](_0x27d795),_0x3c177c['think']=_0x45a1ab,_0x3c177c[_0x37451d(0x1fd)]=_0x43bba7?.[_0x37451d(0x42c)],_0x3c177c[_0x37451d(0x3f1)]=total_tokens,_0x3c177c[_0x37451d(0x21c)]=prompt_tokens,_0x3c177c[_0x37451d(0x2e0)]=completion_tokens,_0x3c177c[_0x37451d(0x259)]=JSON['stringify']({'conversationId':_0x11fc73[_0x37451d(0x1ff)],'model':_0x108566,'parentMessageId':_0x11fc73['id'],'temperature':_0x3b5fdd});const _0x40f5ea=await this['chatLogService'][_0x37451d(0x1e8)](_0x3c177c);common_1['Logger'][_0x37451d(0x3d6)]('本次调用:\x20'+_0x4924fa[_0x37451d(0x3cf)]['id']+_0x37451d(0x3ac)+_0x108566+'\x20key\x20->\x20'+_0x267562+_0x37451d(0x1b9)+_0x5bc034,_0x37451d(0x269)),await this['chatGroupService'][_0x37451d(0x396)](_0x44a11f,_0x1f0a96,_0x4924fa,_0x3c177c[_0x37451d(0x1fd)]),_0x11fc73[_0x37451d(0x2b4)]&&(_0x11fc73['result']=''),_0x11fc73[_0x37451d(0x37b)]=!![],_0x11fc73[_0x37451d(0x1d8)]=_0x40f5ea['id'];_0x37e6c7&&setTimeout(()=>{const _0x1a2d97=_0x37451d;this[_0x1a2d97(0x1c3)](_0x4924fa,_0x40f5ea);},0x64);if(_0x33442b=='mind'){const _0x12d8b2=await this[_0x37451d(0x363)]['saveMindTask']({'id':_0x4fe121,'userId':_0x40f5ea[_0x37451d(0x2d2)],'chatLogId':_0x40f5ea['id'],'prompt':_0x40f5ea[_0x37451d(0x2bb)],'result':_0x3c177c[_0x37451d(0x1fd)],'status':0x1});_0x11fc73[_0x37451d(0x425)]=_0x12d8b2['id'];}if(_0x3385a3&&_0xa1bb9c)await this[_0x37451d(0x330)]['deductBalance4Chat'](_0x4924fa['user']['id'],_0x4650c8,_0x40f5ea['id']),_0x281e47[_0x37451d(0x2fe)]?_0x3385a3[_0x37451d(0x1f3)](_0x37451d(0x390)+JSON[_0x37451d(0x401)](_0x11fc73)+'\x0a\x0a'):_0x3385a3[_0x37451d(0x1f3)]('\x0a'+JSON[_0x37451d(0x401)](_0x11fc73));else return _0x11fc73[_0x37451d(0x42c)];}catch(_0x4010b8){_0x3c177c['answer']=_0x4010b8[_0x37451d(0x30e)],_0x3c177c['errMsg']=_0x4010b8[_0x37451d(0x30e)],_0x3c177c['conversationOptions']=JSON['stringify']({'conversationId':_0x11fc73?.[_0x37451d(0x1ff)],'model':_0x108566,'parentMessageId':_0x11fc73?.['id'],'temperature':_0x3b5fdd});const _0x176be3=await this[_0x37451d(0x306)][_0x37451d(0x1e8)](_0x3c177c);if(_0x33442b=='mind'){const _0x20bb41=await this[_0x37451d(0x363)][_0x37451d(0x263)]({'id':_0x4fe121,'userId':_0x176be3['userId'],'prompt':_0x176be3[_0x37451d(0x2bb)],'chatLogId':_0x176be3['id'],'result':_0x3c177c[_0x37451d(0x1fd)],'status':-0x1});_0x11fc73[_0x37451d(0x425)]=_0x20bb41['id'];}const _0x2180eb=_0x4010b8[_0x37451d(0x421)];_0x2180eb===0x190&&console[_0x37451d(0x32f)](_0x37451d(0x2e7),_0x4010b8,_0x4010b8['message']);if(_0x4010b8[_0x37451d(0x1bf)]&&_0x4010b8['status']===0x192){const _0x50f087={'message':'Catch\x20Error\x20'+_0x4010b8['message'],'code':0x192};if(_0x3385a3&&_0xa1bb9c){_0x281e47['stream']?_0x3385a3['write'](_0x37451d(0x390)+JSON['stringify'](_0x50f087)+'\x0a\x0a'):_0x3385a3[_0x37451d(0x1f3)](JSON[_0x37451d(0x401)](_0x50f087));_0x3385a3[_0x37451d(0x36e)]();return;}else throw new common_1[(_0x37451d(0x3d5))](_0x4010b8[_0x37451d(0x30e)],common_1['HttpStatus'][_0x37451d(0x291)]);}if(!_0x2180eb){if(_0x3385a3&&_0xa1bb9c){_0x281e47['stream']?_0x3385a3[_0x37451d(0x1f3)]('data:\x20'+JSON[_0x37451d(0x401)]({'message':_0x4010b8[_0x37451d(0x30e)],'code':0x1f4})+'\x0a\x0a'):_0x3385a3[_0x37451d(0x1f3)](JSON[_0x37451d(0x401)]({'message':_0x4010b8['message'],'code':0x1f4}));_0x3385a3['end']();return;}else throw new common_1[(_0x37451d(0x3d5))](_0x4010b8[_0x37451d(0x30e)],common_1['HttpStatus']['BAD_REQUEST']);}const _0x334c19=await this['openAiErrHandler'](_0x4010b8,_0x4650c8),_0x288749={'message':_0x334c19||'Please\x20check\x20the\x20back-end\x20console','code':_0x2180eb===0x191?0x191:_0x2180eb||0x1f4};if(_0x3385a3&&_0xa1bb9c)_0x3385a3[_0x37451d(0x421)]=0x190,_0x281e47[_0x37451d(0x2fe)]?_0x3385a3['write'](_0x37451d(0x390)+JSON[_0x37451d(0x401)](_0x288749)+'\x0a\x0a'):_0x3385a3[_0x37451d(0x1f3)](JSON[_0x37451d(0x401)](_0x288749));else throw new common_1[(_0x37451d(0x3d5))](_0x288749[_0x37451d(0x30e)],common_1['HttpStatus'][_0x37451d(0x24f)]);}finally{_0x3385a3&&_0xa1bb9c&&_0x3385a3[_0x37451d(0x36e)]();}}catch(_0x15070f){if(_0x15070f instanceof common_1[_0x37451d(0x3d5)])throw _0x15070f;else throw new common_1[(_0x37451d(0x3d5))](_0x15070f[_0x37451d(0x30e)],common_1[_0x37451d(0x3be)]['BAD_REQUEST']);}}async[_0x2b172c(0x1c3)](_0x4b04ae,_0x43f254){const _0x519ae6=_0x2b172c,_0x5b078f=await this[_0x519ae6(0x32b)](_0x4b04ae,{'request':{'text':_0x43f254['answer']}});_0x43f254['answerMp3']=_0x5b078f,this[_0x519ae6(0x306)][_0x519ae6(0x1e8)](_0x43f254);}async[_0x2b172c(0x3b9)](_0x1ac5d5){const _0x2c5270=_0x2b172c;try{const _0x283b11=[_0x2c5270(0x283),_0x2c5270(0x423),_0x2c5270(0x2c9),_0x2c5270(0x3e1),_0x2c5270(0x2ac),_0x2c5270(0x3a3)],_0x3c5460=await this['globalConfigService'][_0x2c5270(0x337)](_0x283b11);if(!_0x1ac5d5[_0x2c5270(0x3cf)]||!_0x1ac5d5[_0x2c5270(0x3cf)]['id'])throw new Error(_0x2c5270(0x28e));const _0x30254f=[_0x2c5270(0x241),_0x2c5270(0x1c7),_0x2c5270(0x3d1)],_0x17d0d6=await Promise[_0x2c5270(0x229)](_0x30254f[_0x2c5270(0x378)](async _0x1ebd1=>{const _0x1576ff=_0x2c5270,_0x5bb545=_0x3c5460[_0x1ebd1+_0x1576ff(0x3b3)],_0x1159f9=_0x3c5460[_0x1ebd1+'Price'],_0x37aced=redisKey_constant_1[_0x1576ff(0x2a8)]+'-'+_0x1ac5d5[_0x1576ff(0x3cf)]['id']+'-'+(_0x1ebd1+_0x1576ff(0x3b3)),_0x4867af=await this['userService'][_0x1576ff(0x416)](_0x1ac5d5[_0x1576ff(0x3cf)]['id'],_0x37aced,_0x5bb545);return{'type':_0x1ebd1,'remainCount':_0x4867af,'freeCount':Number(_0x5bb545),'useIntegrate':Number(_0x1159f9)};}));return _0x17d0d6;}catch(_0x5e7bae){console[_0x2c5270(0x286)](_0x2c5270(0x1fc),_0x5e7bae);throw _0x5e7bae;}}async[_0x2b172c(0x1c5)](_0x4ae732){const _0x4bc3b5=_0x2b172c,{data:_0x1ddc50,answerLogDTO:_0x4dc37f,currentRequestModel:_0x316847,musicTaskType:_0x1c73d5}=_0x4ae732;try{let _0x23fafc=process[_0x4bc3b5(0x27d)][_0x4bc3b5(0x299)];!/^http/[_0x4bc3b5(0x376)](_0x23fafc)&&(_0x23fafc=_0x4bc3b5(0x251)+_0x23fafc);let _0x5cf91b;if(_0x1c73d5==music_constant_1[_0x4bc3b5(0x298)]['CREATE'])!_0x1ddc50[_0x4bc3b5(0x28d)]&&(_0x1ddc50[_0x4bc3b5(0x30c)]=_0x1ddc50[_0x4bc3b5(0x2bb)],delete _0x1ddc50[_0x4bc3b5(0x2bb)]),_0x5cf91b=await this['sunoTaskService']['music']({'data':_0x1ddc50,'baseURL':_0x316847['proxyUrl'],'headers':{'Authorization':_0x4bc3b5(0x20b)+_0x316847[_0x4bc3b5(0x42b)]}});else _0x1c73d5==music_constant_1[_0x4bc3b5(0x298)]['LYRICS']?(_0x1ddc50[_0x4bc3b5(0x415)]=_0x23fafc+(_0x4bc3b5(0x1e3)+_0x4dc37f['id']),_0x5cf91b=await this[_0x4bc3b5(0x247)][_0x4bc3b5(0x29a)]({'data':_0x1ddc50,'baseURL':_0x316847[_0x4bc3b5(0x2cb)],'headers':{'Authorization':_0x4bc3b5(0x20b)+_0x316847[_0x4bc3b5(0x42b)]}})):(_0x1ddc50[_0x4bc3b5(0x415)]=_0x23fafc+(_0x4bc3b5(0x341)+_0x4dc37f['id']),_0x5cf91b=await this['sunoTaskService']['upload']({'data':_0x1ddc50,'baseURL':_0x316847[_0x4bc3b5(0x2cb)],'headers':{'Authorization':_0x4bc3b5(0x20b)+_0x316847[_0x4bc3b5(0x42b)]}}));await this[_0x4bc3b5(0x271)]['saveUseLog'](_0x316847['id'],0x0),_0x4dc37f[_0x4bc3b5(0x3f1)]=0x0,_0x4dc37f[_0x4bc3b5(0x21c)]=0x0,_0x4dc37f[_0x4bc3b5(0x2e0)]=0x0,_0x4dc37f[_0x4bc3b5(0x2e4)]=_0x5cf91b[_0x4bc3b5(0x3a2)],_0x4dc37f[_0x4bc3b5(0x3d3)]=_0x1c73d5,_0x4dc37f[_0x4bc3b5(0x259)]=JSON[_0x4bc3b5(0x401)]({'model':_0x316847[_0x4bc3b5(0x3e3)],'parentMessageId':_0x5cf91b[_0x4bc3b5(0x3a2)]}),await this[_0x4bc3b5(0x306)]['saveChatLog'](_0x4dc37f),common_1[_0x4bc3b5(0x1dc)][_0x4bc3b5(0x3d6)](_0x4bc3b5(0x1ee)+_0x4dc37f[_0x4bc3b5(0x2d2)]+'\x20model:\x20'+_0x316847[_0x4bc3b5(0x3e3)]+_0x4bc3b5(0x41a)+_0x316847['key']+_0x4bc3b5(0x1b9)+_0x316847['modelName'],_0x4bc3b5(0x27b));if(_0x5cf91b[_0x4bc3b5(0x30f)]!==_0x4bc3b5(0x209))throw new Error(_0x4bc3b5(0x322));}catch(_0x367b3d){console[_0x4bc3b5(0x32f)](_0x4bc3b5(0x2de),_0x316847[_0x4bc3b5(0x42b)],_0x367b3d);const _0x1e990d=await this[_0x4bc3b5(0x366)](_0x367b3d,_0x316847);_0x4dc37f[_0x4bc3b5(0x346)]=_0x1e990d,await this[_0x4bc3b5(0x306)]['saveChatLog'](_0x4dc37f),await this[_0x4bc3b5(0x330)][_0x4bc3b5(0x24a)](_0x4dc37f[_0x4bc3b5(0x2d2)],_0x4dc37f['id'],_0x1c73d5,!![]);}}async['lumaVideoTask'](_0x280974){const _0x1b72a5=_0x2b172c,{data:_0x2f8755,answerLogDTO:_0x215b94,currentRequestModel:_0x58002a}=_0x280974;try{let _0x1f8944;await this[_0x1b72a5(0x330)]['deductBalance4Chat'](_0x215b94[_0x1b72a5(0x2d2)],_0x58002a,_0x215b94['id']);_0x2f8755[_0x1b72a5(0x3da)]?_0x1f8944=await this[_0x1b72a5(0x2f3)][_0x1b72a5(0x353)]({'data':_0x2f8755,'baseURL':_0x58002a[_0x1b72a5(0x2cb)],'headers':{'Authorization':_0x1b72a5(0x20b)+_0x58002a[_0x1b72a5(0x42b)]}},_0x2f8755[_0x1b72a5(0x3da)]):_0x1f8944=await this[_0x1b72a5(0x2f3)]['creat']({'data':_0x2f8755,'baseURL':_0x58002a[_0x1b72a5(0x2cb)],'headers':{'Authorization':'Bearer\x20'+_0x58002a[_0x1b72a5(0x42b)]}});await this[_0x1b72a5(0x271)][_0x1b72a5(0x305)](_0x58002a['id'],0x0),_0x215b94[_0x1b72a5(0x3f1)]=0x0,_0x215b94[_0x1b72a5(0x21c)]=0x0,_0x215b94['completionTokens']=0x0,_0x215b94['answer']=_0x1f8944[_0x1b72a5(0x216)],_0x215b94['conversationOptions']=JSON['stringify']({'model':_0x58002a[_0x1b72a5(0x3e3)],'parentMessageId':_0x1f8944['id']}),await this[_0x1b72a5(0x306)]['saveChatLog'](_0x215b94),common_1['Logger'][_0x1b72a5(0x3d6)](_0x1b72a5(0x1ee)+_0x215b94[_0x1b72a5(0x2d2)]+'\x20model:\x20'+_0x58002a[_0x1b72a5(0x3e3)]+'\x20key\x20->\x20'+_0x58002a[_0x1b72a5(0x42b)]+_0x1b72a5(0x1b9)+_0x58002a[_0x1b72a5(0x200)],_0x1b72a5(0x269));if(!_0x215b94['answer'])throw new Error(_0x1b72a5(0x3c3));await this[_0x1b72a5(0x306)][_0x1b72a5(0x24e)](_0x215b94,{'id':_0x1f8944['id'],'state':_0x1f8944['state'],'completed':_0x1f8944[_0x1b72a5(0x216)]==='completed','videoUrl':_0x1f8944['video']?.[_0x1b72a5(0x1af)]});}catch(_0x3a7c1d){console['log'](_0x1b72a5(0x3b0),_0x58002a[_0x1b72a5(0x42b)],_0x3a7c1d);const _0x9727a3=await this[_0x1b72a5(0x366)](_0x3a7c1d,_0x58002a);_0x215b94[_0x1b72a5(0x346)]=_0x9727a3,await this[_0x1b72a5(0x306)][_0x1b72a5(0x1e8)](_0x215b94),await this[_0x1b72a5(0x330)]['refundBalance4Chat'](_0x215b94[_0x1b72a5(0x2d2)],_0x58002a,_0x215b94['id']);}}async[_0x2b172c(0x429)](_0x148258){const _0x279416=_0x2b172c,{data:_0x571223,answerLogDTO:_0x420362,currentRequestModel:_0x2ab9ac}=_0x148258;try{let _0x56f216;await this[_0x279416(0x330)][_0x279416(0x374)](_0x420362[_0x279416(0x2d2)],_0x2ab9ac,_0x420362['id']);const _0x3388fb=_0x571223[_0x279416(0x230)],_0x31cf8a={'model':_0x571223[_0x279416(0x3e3)],'ratio':_0x571223[_0x279416(0x25e)],'prompt':_0x571223[_0x279416(0x2bb)],'style':_0x571223[_0x279416(0x382)],'options':_0x3388fb};_0x571223[_0x279416(0x325)]&&(_0x31cf8a[_0x279416(0x325)]=_0x571223[_0x279416(0x325)]);_0x571223[_0x279416(0x2b5)]&&(_0x31cf8a['last_image']=_0x571223['last_image']);_0x56f216=await this[_0x279416(0x3b2)]['creat']({'data':_0x31cf8a,'baseURL':_0x2ab9ac['proxyUrl'],'headers':{'Authorization':'Bearer\x20'+_0x2ab9ac[_0x279416(0x42b)]}}),await this[_0x279416(0x271)]['saveUseLog'](_0x2ab9ac['id'],0x0),_0x420362[_0x279416(0x3f1)]=0x0,_0x420362[_0x279416(0x21c)]=0x0,_0x420362[_0x279416(0x2e0)]=0x0,_0x420362[_0x279416(0x346)]=_0x56f216[_0x279416(0x38b)],_0x420362['answer']=_0x56f216[_0x279416(0x1bf)]=='3'?'SUCCEEDED':_0x56f216[_0x279416(0x1bf)],_0x420362[_0x279416(0x259)]=JSON[_0x279416(0x401)]({'model':_0x2ab9ac[_0x279416(0x3e3)],'parentMessageId':_0x56f216[_0x279416(0x377)]}),await this[_0x279416(0x306)][_0x279416(0x1e8)](_0x420362),common_1['Logger'][_0x279416(0x3d6)](_0x279416(0x1ee)+_0x420362[_0x279416(0x2d2)]+_0x279416(0x3ac)+_0x2ab9ac[_0x279416(0x3e3)]+_0x279416(0x41a)+_0x2ab9ac[_0x279416(0x42b)]+_0x279416(0x1b9)+_0x2ab9ac[_0x279416(0x200)],_0x279416(0x269));if(_0x56f216['msg'])throw new Error(_0x279416(0x3c3));await this['chatLogService'][_0x279416(0x24e)](_0x420362,{'id':_0x56f216[_0x279416(0x377)],'state':_0x56f216['status']=='3'?'SUCCEEDED':_0x56f216['status'],'completed':_0x56f216[_0x279416(0x1bf)]==='3','videoUrl':_0x56f216[_0x279416(0x27e)]});}catch(_0x3d712d){console['log'](_0x279416(0x3b0),_0x2ab9ac[_0x279416(0x42b)],_0x3d712d);const _0x2a032f=await this[_0x279416(0x366)](_0x3d712d,_0x2ab9ac);_0x420362['errMsg']=_0x2a032f,await this[_0x279416(0x306)]['saveChatLog'](_0x420362),await this[_0x279416(0x330)][_0x279416(0x424)](_0x420362['userId'],_0x2ab9ac,_0x420362['id']);}}async[_0x2b172c(0x244)](_0xad101c){const _0x405989=_0x2b172c,{data:_0xa5520e,answerLogDTO:_0x579f0d,currentRequestModel:_0x7e0f11}=_0xad101c;try{let _0x3a2334;await this[_0x405989(0x330)][_0x405989(0x374)](_0x579f0d[_0x405989(0x2d2)],_0x7e0f11,_0x579f0d['id']);!_0xa5520e['model_name']?(_0xa5520e[_0x405989(0x315)]=_0xa5520e['model'],delete _0xa5520e[_0x405989(0x3e3)]):delete _0xa5520e['model'];_0xa5520e['image']?_0x3a2334=await this[_0x405989(0x275)][_0x405989(0x398)]({'data':_0xa5520e,'baseURL':_0x7e0f11[_0x405989(0x2cb)],'headers':{'Authorization':'Bearer\x20'+_0x7e0f11[_0x405989(0x42b)]}}):_0x3a2334=await this[_0x405989(0x275)][_0x405989(0x1e0)]({'data':_0xa5520e,'baseURL':_0x7e0f11[_0x405989(0x2cb)],'headers':{'Authorization':'Bearer\x20'+_0x7e0f11['key']}});await this[_0x405989(0x271)]['saveUseLog'](_0x7e0f11['id'],0x0),_0x579f0d[_0x405989(0x3f1)]=0x0,_0x579f0d[_0x405989(0x21c)]=0x0,_0x579f0d[_0x405989(0x2e0)]=0x0,_0x579f0d[_0x405989(0x1fd)]=_0x3a2334['task_status'],_0x579f0d[_0x405989(0x259)]=JSON[_0x405989(0x401)]({'model':_0x7e0f11[_0x405989(0x3e3)],'parentMessageId':_0x3a2334['task_id']}),await this[_0x405989(0x306)][_0x405989(0x1e8)](_0x579f0d),common_1[_0x405989(0x1dc)]['debug'](_0x405989(0x1ee)+_0x579f0d[_0x405989(0x2d2)]+_0x405989(0x3ac)+_0x7e0f11[_0x405989(0x3e3)]+'\x20key\x20->\x20'+_0x7e0f11[_0x405989(0x42b)]+_0x405989(0x1b9)+_0x7e0f11[_0x405989(0x200)],_0x405989(0x269));if(!_0x579f0d[_0x405989(0x1fd)]||_0x579f0d[_0x405989(0x1fd)]===_0x405989(0x3fb))throw new Error('视频生成失败，没有响应');await this[_0x405989(0x306)][_0x405989(0x24e)](_0x579f0d,{'id':_0x3a2334[_0x405989(0x377)],'state':_0x3a2334[_0x405989(0x26a)],'completed':_0x3a2334[_0x405989(0x26a)]===_0x405989(0x364),'videoUrl':_0x3a2334[_0x405989(0x3c5)]&&_0x3a2334[_0x405989(0x3c5)][_0x405989(0x225)]&&_0x3a2334[_0x405989(0x3c5)][_0x405989(0x225)][_0x405989(0x1da)]?_0x3a2334[_0x405989(0x3c5)][_0x405989(0x225)][0x0]?.[_0x405989(0x1af)]:''});}catch(_0x368fdc){console[_0x405989(0x32f)](_0x405989(0x3b0),_0x7e0f11['key'],_0x368fdc);const _0x25699e=await this[_0x405989(0x366)](_0x368fdc,_0x7e0f11);_0x579f0d['errMsg']=_0x25699e,await this['chatLogService'][_0x405989(0x1e8)](_0x579f0d),await this[_0x405989(0x330)][_0x405989(0x424)](_0x579f0d[_0x405989(0x2d2)],_0x7e0f11,_0x579f0d['id']);}}async['klingImageTask'](_0x1f8a6a,_0x461b7d){const _0x5096ed=_0x2b172c;try{const _0x22d6b6=(0x0,utils_1['getReqSaasId'])(this[_0x5096ed(0x2b9)]),_0x362bc5=await this[_0x5096ed(0x2f5)]({'modelType':model_constant_1[_0x5096ed(0x2b1)][_0x5096ed(0x3a4)],'keyType':'2'});let _0x29876d=_0x362bc5['appId'],_0x324830=_0x362bc5[_0x5096ed(0x1c1)],_0xc8d7e8=await this[_0x5096ed(0x271)][_0x5096ed(0x422)](model_constant_1['EModelType']['DRAW'],parseInt('2'));_0xc8d7e8['model']=_0x1f8a6a['model_name'],_0x324830['modelInfo'][_0x5096ed(0x3e3)]=_0x1f8a6a[_0x5096ed(0x315)],await this[_0x5096ed(0x3e4)]({'prompt':_0x1f8a6a[_0x5096ed(0x2bb)],'currentRequestModel':_0xc8d7e8,'user':_0x461b7d[_0x5096ed(0x3cf)],'count':_0x1f8a6a['n']});let {id:_0x405505,keyType:_0x3b150d}=_0x324830[_0x5096ed(0x22d)];const _0x4860ff=(0x0,utils_1[_0x5096ed(0x39e)])(_0x461b7d),_0x3f702={'appId':_0x29876d,'curIp':_0x4860ff,'prompt':_0x1f8a6a[_0x5096ed(0x2bb)],'modelId':_0x405505,'modelType':model_constant_1['EModelType'][_0x5096ed(0x3a4)],'answer':'','model':_0x1f8a6a['model_name'],'role':_0x5096ed(0x3cf),'userId':_0x461b7d[_0x5096ed(0x3cf)]['id'],'completionTokens':0x0,'type':balance_constant_1['DeductionKey'][_0x5096ed(0x222)],'logType':0x1,'modelSubType':_0x3b150d[_0x5096ed(0x345)](),'requestParams':_0x1f8a6a,'requestOptions':JSON['stringify']({'options':null,'prompt':_0x1f8a6a[_0x5096ed(0x2bb)]}),'saasId':_0x22d6b6};await this[_0x5096ed(0x306)][_0x5096ed(0x1e8)](_0x3f702);try{await this['userService'][_0x5096ed(0x319)](_0x3f702[_0x5096ed(0x2d2)],_0xc8d7e8,_0x3f702['id'],_0x1f8a6a['n']);const _0x579863=await this[_0x5096ed(0x275)][_0x5096ed(0x23c)]({'data':_0x1f8a6a,'baseURL':_0xc8d7e8[_0x5096ed(0x2cb)],'headers':{'Authorization':_0x5096ed(0x20b)+_0xc8d7e8['key']}});_0x3f702[_0x5096ed(0x29b)]=_0x4860ff,_0x3f702[_0x5096ed(0x1fd)]=_0x579863[_0x5096ed(0x26a)],_0x3f702['message_id']=_0x579863[_0x5096ed(0x377)],await this[_0x5096ed(0x306)][_0x5096ed(0x1e8)](_0x3f702);if(!_0x3f702[_0x5096ed(0x1fd)]||_0x3f702[_0x5096ed(0x1fd)]==='failed')throw new Error(_0x5096ed(0x2fa));}catch(_0xca291b){console[_0x5096ed(0x32f)]('kling-draw-task',_0xc8d7e8['key'],_0xca291b);const _0x358d40=await this[_0x5096ed(0x366)](_0xca291b,_0xc8d7e8);_0x3f702[_0x5096ed(0x346)]=_0x358d40,await this[_0x5096ed(0x306)]['saveChatLog'](_0x3f702),await this[_0x5096ed(0x330)][_0x5096ed(0x424)](_0x3f702[_0x5096ed(0x2d2)],_0xc8d7e8,_0x3f702['id']);}return this[_0x5096ed(0x306)][_0x5096ed(0x2af)](_0x3f702);}catch(_0x6d143b){if(_0x6d143b instanceof common_1[_0x5096ed(0x3d5)])throw _0x6d143b;else throw new common_1['HttpException'](_0x6d143b[_0x5096ed(0x30e)],common_1[_0x5096ed(0x3be)]['BAD_REQUEST']);}}async['jmengVideoTask'](_0x4a1d26){const _0x5f080a=_0x2b172c,{data:_0x3395f7,answerLogDTO:_0x123cf1,currentRequestModel:_0x4724dd}=_0x4a1d26;try{await this[_0x5f080a(0x330)]['deductBalance4Chat'](_0x123cf1[_0x5f080a(0x2d2)],_0x4724dd,_0x123cf1['id']);!_0x3395f7['model_name']?(_0x3395f7[_0x5f080a(0x315)]=_0x3395f7[_0x5f080a(0x3e3)],delete _0x3395f7[_0x5f080a(0x3e3)]):delete _0x3395f7[_0x5f080a(0x3e3)];const _0x1ca271=new openapi_1[(_0x5f080a(0x3a0))]({'serviceName':'cv','region':_0x5f080a(0x312),'host':_0x4724dd['proxyUrl'],'accessKeyId':_0x4724dd[_0x5f080a(0x42b)],'secretKey':_0x4724dd[_0x5f080a(0x2aa)]}),_0x3d4cdf=_0x1ca271['createAPI'](_0x5f080a(0x25b),{'Version':_0x5f080a(0x2f1),'method':_0x5f080a(0x2c5),'contentType':_0x5f080a(0x3b4)}),_0x18ee2f={'req_key':_0x4724dd[_0x5f080a(0x3e3)],'model_name':_0x3395f7[_0x5f080a(0x315)],'prompt':_0x3395f7[_0x5f080a(0x2bb)],'seed':_0x3395f7[_0x5f080a(0x354)],'aspect_ratio':_0x3395f7[_0x5f080a(0x1b8)],'image_urls':_0x3395f7[_0x5f080a(0x1e9)]},_0x48b1c3=await _0x3d4cdf(_0x18ee2f);if(_0x48b1c3[_0x5f080a(0x30f)]!=0x2710)throw new Error(_0x5f080a(0x304)+_0x48b1c3[_0x5f080a(0x30e)]);await this[_0x5f080a(0x271)]['saveUseLog'](_0x4724dd['id'],0x0),_0x123cf1[_0x5f080a(0x2e4)]=_0x48b1c3[_0x5f080a(0x3a2)][_0x5f080a(0x377)],_0x123cf1[_0x5f080a(0x1fd)]=_0x48b1c3['status'],_0x123cf1['conversationOptions']=JSON[_0x5f080a(0x401)]({'model':_0x4724dd[_0x5f080a(0x3e3)],'parentMessageId':_0x48b1c3[_0x5f080a(0x3a2)][_0x5f080a(0x377)]}),await this['chatLogService'][_0x5f080a(0x1e8)](_0x123cf1),await this[_0x5f080a(0x306)][_0x5f080a(0x24e)](_0x123cf1,{'id':_0x48b1c3[_0x5f080a(0x3a2)]['task_id'],'state':_0x48b1c3[_0x5f080a(0x1bf)],'completed':![],'videoUrl':''});}catch(_0x38e849){console['log']('jmengvideo-task',_0x4724dd[_0x5f080a(0x42b)],_0x38e849);const _0x375881=await this[_0x5f080a(0x366)](_0x38e849,_0x4724dd);_0x123cf1[_0x5f080a(0x346)]=_0x375881,_0x123cf1[_0x5f080a(0x1fd)]='failed',await this[_0x5f080a(0x306)]['saveChatLog'](_0x123cf1),await this[_0x5f080a(0x330)][_0x5f080a(0x424)](_0x123cf1[_0x5f080a(0x2d2)],_0x4724dd,_0x123cf1['id']);}}async[_0x2b172c(0x383)](_0x117d65,_0x4e550d){const _0xee63d4=_0x2b172c;try{const _0x22ce5d=(0x0,utils_1[_0xee63d4(0x253)])(this[_0xee63d4(0x2b9)]),_0x3aea8a=await this[_0xee63d4(0x2f5)]({'modelType':model_constant_1[_0xee63d4(0x2b1)]['DRAW'],'keyType':'3'});let _0x4be500=_0x3aea8a[_0xee63d4(0x3d7)],_0xe08bf9=_0x3aea8a[_0xee63d4(0x1c1)],_0x51338d=await this[_0xee63d4(0x271)][_0xee63d4(0x422)](model_constant_1[_0xee63d4(0x2b1)][_0xee63d4(0x3a4)],parseInt('3'));_0x51338d['model']=_0x117d65[_0xee63d4(0x315)],_0xe08bf9[_0xee63d4(0x22d)]['model']=_0x117d65[_0xee63d4(0x315)],await this[_0xee63d4(0x3e4)]({'prompt':_0x117d65[_0xee63d4(0x2bb)],'currentRequestModel':_0x51338d,'user':_0x4e550d[_0xee63d4(0x3cf)]});let {id:_0x1e9ccf,keyType:_0x118d8c}=_0xe08bf9[_0xee63d4(0x22d)];const _0x24ec9d=(0x0,utils_1[_0xee63d4(0x39e)])(_0x4e550d),_0x354e63={'appId':_0x4be500,'curIp':_0x24ec9d,'prompt':_0x117d65[_0xee63d4(0x2bb)],'modelId':_0x1e9ccf,'modelType':model_constant_1[_0xee63d4(0x2b1)]['DRAW'],'answer':'','model':_0x117d65[_0xee63d4(0x315)],'role':'user','userId':_0x4e550d[_0xee63d4(0x3cf)]['id'],'completionTokens':0x0,'type':balance_constant_1[_0xee63d4(0x3af)][_0xee63d4(0x222)],'logType':0x1,'modelSubType':_0x118d8c[_0xee63d4(0x345)](),'requestParams':_0x117d65,'requestOptions':JSON[_0xee63d4(0x401)]({'options':null,'prompt':_0x117d65[_0xee63d4(0x2bb)]}),'saasId':_0x22ce5d};await this['chatLogService'][_0xee63d4(0x1e8)](_0x354e63);try{await this['userService']['deductBalance4Draw'](_0x354e63[_0xee63d4(0x2d2)],_0x51338d,_0x354e63['id']);const _0xa8a426=new openapi_1[(_0xee63d4(0x3a0))]({'serviceName':'cv','region':'cn-north-1','host':_0xe08bf9[_0xee63d4(0x22d)][_0xee63d4(0x2cb)],'accessKeyId':_0xe08bf9['modelInfo'][_0xee63d4(0x42b)],'secretKey':_0xe08bf9['modelInfo']['secret']}),_0x560547=_0xa8a426[_0xee63d4(0x3b5)](_0xee63d4(0x2c4),{'Version':_0xee63d4(0x2f1),'method':_0xee63d4(0x2c5),'contentType':_0xee63d4(0x3b4)}),_0x7fc2a1=await _0x560547({'req_key':_0xe08bf9['modelInfo'][_0xee63d4(0x3e3)],..._0x117d65});_0x354e63[_0xee63d4(0x29b)]=_0x24ec9d;if(_0x7fc2a1['code']==0x2710){const _0x42cf77=[];_0x354e63[_0xee63d4(0x379)]=_0x7fc2a1[_0xee63d4(0x3a2)][_0xee63d4(0x3ab)][_0xee63d4(0x34e)];for(const _0x347174 of _0x7fc2a1[_0xee63d4(0x3a2)][_0xee63d4(0x1b4)]){const _0x2e16ba=_0x347174,_0x1bdf2b=uuid['v4']()['slice'](0x0,0xa)+'.png',_0x96a609=Buffer['from'](_0x2e16ba,_0xee63d4(0x210));_0x42cf77['push'](this[_0xee63d4(0x242)][_0xee63d4(0x3dd)]({'filename':_0x1bdf2b,'buffer':_0x96a609}));}const _0xc598c=await Promise[_0xee63d4(0x229)](_0x42cf77);_0x354e63[_0xee63d4(0x317)]=JSON[_0xee63d4(0x401)](_0xc598c);}else throw new Error(_0xee63d4(0x2fa)+_0x7fc2a1[_0xee63d4(0x30e)]);await this[_0xee63d4(0x306)][_0xee63d4(0x1e8)](_0x354e63);}catch(_0x586c8d){console['log'](_0xee63d4(0x296),_0x51338d['key'],_0x586c8d);const _0x418010=await this[_0xee63d4(0x366)](_0x586c8d,_0x51338d);_0x354e63[_0xee63d4(0x346)]=_0x418010,await this['chatLogService'][_0xee63d4(0x1e8)](_0x354e63),await this[_0xee63d4(0x330)][_0xee63d4(0x424)](_0x354e63[_0xee63d4(0x2d2)],_0x51338d,_0x354e63['id']);}return this[_0xee63d4(0x306)]['returnDrawDetail'](_0x354e63);}catch(_0xf60675){if(_0xf60675 instanceof common_1[_0xee63d4(0x3d5)])throw _0xf60675;else throw new common_1[(_0xee63d4(0x3d5))](_0xf60675['message'],common_1[_0xee63d4(0x3be)][_0xee63d4(0x24f)]);}}async['chatMuiscTask'](_0x19283a){const _0x16d790=_0x2b172c;try{const _0x2c2f64=(0x0,utils_1[_0x16d790(0x253)])(this[_0x16d790(0x2b9)]),{req:_0x410a50,model:_0xb01d2b,modelType:_0x1b0079,datas:_0x1a0afa,requestBody:_0x38f94d,musicTaskType:_0x4c0bde}=_0x19283a;let _0x23e317,_0x57fc05;const _0x1bce25=await this[_0x16d790(0x2f5)]({'modelType':_0x1b0079});_0x23e317=_0x1bce25['appId'],_0x57fc05=_0x1bce25['modelConfig'];let _0x5d5db0='';_0x16d790(0x2bb)in _0x1a0afa&&(_0x5d5db0=_0x1a0afa['prompt']);const _0x46c2d9=await this[_0x16d790(0x271)][_0x16d790(0x3f2)](_0x1b0079,_0x1b0079===model_constant_1['EModelType'][_0x16d790(0x272)]?_0xb01d2b:'');_0x46c2d9[_0x16d790(0x3e3)]=_0xb01d2b,_0x57fc05[_0x16d790(0x22d)][_0x16d790(0x3e3)]=_0xb01d2b;'prompt'in _0x1a0afa&&await this[_0x16d790(0x2da)]({'prompt':_0x5d5db0,'currentRequestModel':_0x46c2d9,'user':_0x410a50[_0x16d790(0x3cf)]});let {id:_0x4a5cf2,topN:_0x3bb76b,keyType:_0x3997f3}=_0x57fc05[_0x16d790(0x22d)];const _0x116706=0x0,_0x5af6a4=0x0,_0x4d453d=_0x116706+_0x5af6a4,_0x13be4b=(0x0,utils_1[_0x16d790(0x39e)])(_0x410a50),_0x54319a={'appId':_0x23e317,'curIp':_0x13be4b,'prompt':_0x5d5db0,'modelId':_0x4a5cf2,'modelType':_0x1b0079,'answer':'','model':_0xb01d2b,'role':_0x16d790(0x3cf),'userId':_0x410a50[_0x16d790(0x3cf)]['id'],'completionTokens':0x0,'totalTokens':_0x4d453d,'type':balance_constant_1[_0x16d790(0x3af)][_0x16d790(0x203)],'logType':0x1,'modelSubType':'','requestParams':_0x38f94d||_0x1a0afa,'requestOptions':JSON[_0x16d790(0x401)]({'options':null,'prompt':_0x5d5db0}),'saasId':_0x2c2f64},_0x573192={..._0x54319a,'role':_0x16d790(0x287),'requestOptions':JSON[_0x16d790(0x401)]({'prompt':_0x5d5db0,'options':{'model':_0xb01d2b,'temperature':_0x3bb76b}})};await this[_0x16d790(0x306)][_0x16d790(0x1e8)](_0x54319a);const _0xe76d19=await this[_0x16d790(0x306)][_0x16d790(0x1e8)](_0x573192);return await this[_0x16d790(0x330)][_0x16d790(0x24a)](_0x410a50[_0x16d790(0x3cf)]['id'],_0xe76d19['id'],_0x4c0bde),await this[_0x16d790(0x1c5)]({'data':_0x1a0afa,'currentRequestModel':_0x46c2d9,'answerLogDTO':_0xe76d19,'musicTaskType':_0x4c0bde}),_0xe76d19;}catch(_0xd5c53f){if(_0xd5c53f instanceof common_1['HttpException'])throw _0xd5c53f;else throw new common_1[(_0x16d790(0x3d5))](_0xd5c53f['message'],common_1['HttpStatus'][_0x16d790(0x24f)]);}}async['chatTask'](_0x57401f){const _0x5013ad=_0x2b172c;try{const _0xc886fd=(0x0,utils_1[_0x5013ad(0x253)])(this[_0x5013ad(0x2b9)]),{req:_0x26b789,model:_0x1f77b2,modelType:_0x4478fa,datas:_0x5e5072,requestBody:_0x117244}=_0x57401f,{prompt:_0x5a8df2,options:options={}}=_0x5e5072,{groupId:_0x375e80,type:_0x441bbb}=options;let _0x2b7bef,_0x8a77a7,_0x1e55bb;if(_0x4478fa===model_constant_1[_0x5013ad(0x2b1)][_0x5013ad(0x272)]){const _0x24193d=await this[_0x5013ad(0x2f5)]({'modelType':_0x4478fa,'keyType':_0x57401f[_0x5013ad(0x3ca)]});_0x2b7bef=_0x24193d[_0x5013ad(0x3d7)],_0x8a77a7=_0x24193d[_0x5013ad(0x1c1)],_0x1e55bb=await this[_0x5013ad(0x271)][_0x5013ad(0x422)](_0x4478fa,parseInt(_0x57401f[_0x5013ad(0x3ca)]));}else{const _0xa11815=await this['getModelConfig']({'modelType':_0x4478fa});_0x2b7bef=_0xa11815[_0x5013ad(0x3d7)],_0x8a77a7=_0xa11815['modelConfig'],_0x1e55bb=await this[_0x5013ad(0x271)]['getRandomKey'](_0x4478fa);}_0x1e55bb[_0x5013ad(0x3e3)]=_0x1f77b2,_0x8a77a7[_0x5013ad(0x22d)][_0x5013ad(0x3e3)]=_0x1f77b2;_0x4478fa===model_constant_1[_0x5013ad(0x2b1)][_0x5013ad(0x272)]?await this[_0x5013ad(0x39b)]({'prompt':_0x5a8df2,'currentRequestModel':_0x1e55bb,'user':_0x26b789[_0x5013ad(0x3cf)],'requestParams':_0x117244}):await this[_0x5013ad(0x2da)]({'prompt':_0x5a8df2,'currentRequestModel':_0x1e55bb,'user':_0x26b789[_0x5013ad(0x3cf)]});let {id:_0x7516a,topN:_0x2a3103,keyType:_0x455adb}=_0x8a77a7[_0x5013ad(0x22d)];const _0x49a49c=0x0,_0x223a02=0x0,_0xc8a7aa=_0x49a49c+_0x223a02,_0x56aad7=(0x0,utils_1['getClientIp'])(_0x26b789),_0x4be81f={'appId':_0x2b7bef,'curIp':_0x56aad7,'prompt':_0x5a8df2,'groupId':_0x375e80,'modelId':_0x7516a,'modelType':_0x4478fa,'answer':'','model':_0x1f77b2,'role':_0x5013ad(0x3cf),'userId':_0x26b789[_0x5013ad(0x3cf)]['id'],'completionTokens':0x0,'totalTokens':_0xc8a7aa,'type':balance_constant_1[_0x5013ad(0x3af)]['CHAT_TYPE'],'logType':_0x441bbb===_0x5013ad(0x31d)?0x2:0x1,'modelSubType':_0x4478fa===model_constant_1[_0x5013ad(0x2b1)]['VIDEO']?_0x455adb[_0x5013ad(0x345)]():'','requestParams':_0x117244||_0x5e5072,'requestOptions':JSON['stringify']({'options':null,'prompt':_0x5a8df2}),'saasId':_0xc886fd},_0x42afbc={..._0x4be81f,'role':_0x5013ad(0x287),'requestOptions':JSON['stringify']({'prompt':_0x5a8df2,'options':{'model':_0x1f77b2,'temperature':_0x2a3103}})};await this[_0x5013ad(0x306)][_0x5013ad(0x1e8)](_0x4be81f);const _0x3b37d6=await this[_0x5013ad(0x306)][_0x5013ad(0x1e8)](_0x42afbc);if(_0x4478fa===model_constant_1[_0x5013ad(0x2b1)][_0x5013ad(0x272)]){await this['userService'][_0x5013ad(0x24b)](_0x26b789[_0x5013ad(0x3cf)]['id'],_0x1e55bb,_0x117244,_0x3b37d6['id']);switch(_0x455adb){case 0x2:this[_0x5013ad(0x429)]({'data':_0x5e5072,'currentRequestModel':_0x1e55bb,'answerLogDTO':_0x3b37d6});break;case 0x3:this[_0x5013ad(0x244)]({'data':_0x5e5072,'currentRequestModel':_0x1e55bb,'answerLogDTO':_0x3b37d6});break;case 0x5:this[_0x5013ad(0x36b)]({'data':_0x5e5072,'currentRequestModel':_0x1e55bb,'answerLogDTO':_0x3b37d6});break;default:this['lumaVideoTask']({'data':_0x5e5072,'currentRequestModel':_0x1e55bb,'answerLogDTO':_0x3b37d6});}}else await this['userService'][_0x5013ad(0x374)](_0x26b789[_0x5013ad(0x3cf)]['id'],_0x1e55bb,_0x3b37d6['id']);return _0x3b37d6;}catch(_0x4365bb){if(_0x4365bb instanceof common_1['HttpException'])throw _0x4365bb;else throw new common_1['HttpException'](_0x4365bb[_0x5013ad(0x30e)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x2b172c(0x394)](_0x3c71d5,_0x2652ec){const _0x205ca8=_0x2b172c;let {mv:_0x17ca9b}=_0x3c71d5;return!_0x3c71d5['make_instrumental']?_0x3c71d5['make_instrumental']=![]:_0x3c71d5[_0x205ca8(0x2a7)]=!![],this[_0x205ca8(0x340)]({'req':_0x2652ec,'datas':_0x3c71d5,'model':_0x17ca9b||'suno-v3','modelType':model_constant_1[_0x205ca8(0x2b1)][_0x205ca8(0x2df)],'musicTaskType':music_constant_1['EMusicTaskType'][_0x205ca8(0x411)]});}async[_0x2b172c(0x300)](_0x1539c6,_0xc66aa0){const _0x1c6667=_0x2b172c,_0xc199a3={'url':_0x1539c6};return this[_0x1c6667(0x340)]({'req':_0xc66aa0,'datas':_0xc199a3,'model':_0x1c6667(0x260),'modelType':model_constant_1['EModelType'][_0x1c6667(0x2df)],'musicTaskType':music_constant_1[_0x1c6667(0x298)]['UPLOAD']});}async['chatMusicLyrics'](_0x14abc5,_0x2887db){const _0x1930c0=_0x2b172c;return this[_0x1930c0(0x340)]({'req':_0x2887db,'datas':_0x14abc5,'model':_0x1930c0(0x260),'modelType':model_constant_1[_0x1930c0(0x2b1)]['MUSIC'],'musicTaskType':music_constant_1['EMusicTaskType'][_0x1930c0(0x25d)]});}async['lumaChatVideo'](_0x193d4f,_0x552d75){const _0x5c9389=_0x2b172c,_0x5d919d=JSON['parse'](JSON['stringify'](_0x193d4f));let {model:_0x3ecb16,prompt:_0x41cab5,expand_prompt:_0x31392c,aspect_ratio:_0x3a8ca1,image_url:_0x31eee7,image_end_url:_0x40b969}=_0x193d4f,_0x2a5b62=_0x5c9389(0x3e7)+_0x41cab5+_0x5c9389(0x2e6)+_0x31392c+_0x5c9389(0x338)+_0x3a8ca1;return _0x31eee7&&(_0x2a5b62=_0x2a5b62+_0x5c9389(0x373)+_0x31eee7),_0x40b969&&(_0x2a5b62=_0x2a5b62+_0x5c9389(0x351)+_0x40b969),_0x193d4f[_0x5c9389(0x2bb)]=_0x2a5b62,_0x193d4f[_0x5c9389(0x278)]=_0x41cab5,this[_0x5c9389(0x23d)]({'req':_0x552d75,'datas':_0x193d4f,'requestBody':_0x5d919d,'model':_0x3ecb16||_0x5c9389(0x38f),'keyType':'1','modelType':model_constant_1['EModelType'][_0x5c9389(0x272)]});}async['runwayChatVideo'](_0x532ba8,_0x1a3e69){const _0x2fa3c2=_0x2b172c,_0xdcd102=JSON['parse'](JSON[_0x2fa3c2(0x401)](_0x532ba8));return this[_0x2fa3c2(0x23d)]({'req':_0x1a3e69,'datas':_0x532ba8,'requestBody':_0xdcd102,'model':_0x532ba8['model']||_0x2fa3c2(0x29f),'keyType':'2','modelType':model_constant_1[_0x2fa3c2(0x2b1)][_0x2fa3c2(0x272)]});}async[_0x2b172c(0x25f)](_0x2f0844,_0x378e20){const _0xae7006=_0x2b172c,_0x8201cf=JSON[_0xae7006(0x211)](JSON[_0xae7006(0x401)](_0x2f0844));return!_0x2f0844[_0xae7006(0x3e3)]&&(_0x2f0844[_0xae7006(0x3e3)]=_0x2f0844[_0xae7006(0x315)]),this[_0xae7006(0x23d)]({'req':_0x378e20,'datas':_0x2f0844,'requestBody':_0x8201cf,'model':_0x2f0844[_0xae7006(0x3e3)]||_0xae7006(0x1d7),'keyType':'5','modelType':model_constant_1[_0xae7006(0x2b1)][_0xae7006(0x272)]});}async[_0x2b172c(0x3b6)](_0x23f9b3,_0x3e1216){const _0x3f4f1a=_0x2b172c,_0x1b17cd=JSON[_0x3f4f1a(0x211)](JSON[_0x3f4f1a(0x401)](_0x23f9b3));return this[_0x3f4f1a(0x23d)]({'req':_0x3e1216,'datas':_0x23f9b3,'requestBody':_0x1b17cd,'model':_0x23f9b3['model']||_0x3f4f1a(0x274),'keyType':'3','modelType':model_constant_1['EModelType'][_0x3f4f1a(0x272)]});}async['syncLumaTask'](){const _0x4ee10b=_0x2b172c,_0x491ba8=await this[_0x4ee10b(0x306)][_0x4ee10b(0x2e2)]();if(!_0x491ba8[_0x4ee10b(0x1da)])return;const _0xfe1b9a=[],_0x58951c=new Map();_0x491ba8[_0x4ee10b(0x25a)](_0x12f847=>{const _0x26283f=_0x4ee10b;_0xfe1b9a[_0x26283f(0x33b)](_0x12f847['id']),_0x58951c[_0x26283f(0x284)](_0x12f847['id'],_0x12f847);});const _0x196583=await this[_0x4ee10b(0x306)]['listAssetsBychatLogIds'](_0xfe1b9a),_0x4407df=[],_0x197849=new Map();_0x196583[_0x4ee10b(0x25a)](_0x27fecf=>{const _0xeb2621=_0x4ee10b;_0x4407df['push'](_0x27fecf[_0xeb2621(0x228)]),_0x197849[_0xeb2621(0x284)](_0x27fecf[_0xeb2621(0x228)],_0x27fecf);});const _0x2cc536=await this[_0x4ee10b(0x271)]['getRandomKey'](model_constant_1[_0x4ee10b(0x2b1)][_0x4ee10b(0x272)]),_0x29dfa8=await this[_0x4ee10b(0x2f3)][_0x4ee10b(0x41b)]({'baseURL':_0x2cc536[_0x4ee10b(0x2cb)],'headers':{'Authorization':'Bearer\x20'+_0x2cc536[_0x4ee10b(0x42b)]},'data':{'ids':_0x4407df}});for(let _0x3d22a3=0x0;_0x3d22a3<_0x29dfa8[_0x4ee10b(0x1da)];_0x3d22a3++){const _0x4dfd3f=_0x29dfa8[_0x3d22a3],_0x216ce4=_0x197849[_0x4ee10b(0x1d0)](_0x4dfd3f[_0x4ee10b(0x377)]),_0x1ba3fd=_0x58951c[_0x4ee10b(0x1d0)](_0x216ce4[_0x4ee10b(0x1d8)]);await this[_0x4ee10b(0x306)]['parseAndSaveVideo'](_0x1ba3fd,{'id':_0x4dfd3f[_0x4ee10b(0x3a2)]['id'],'state':_0x4dfd3f[_0x4ee10b(0x3a2)][_0x4ee10b(0x216)],'completed':_0x4dfd3f[_0x4ee10b(0x3a2)]['state']===_0x4ee10b(0x279),'videoUrl':_0x4dfd3f[_0x4ee10b(0x3a2)]['video']?.[_0x4ee10b(0x1af)]});}}async[_0x2b172c(0x2f7)](_0x60e7c0){const _0x29f67d=_0x2b172c,{prompt:_0x35897f,userId:_0xf11b3a,abortController:_0x3e2421}=_0x60e7c0,_0x2ba0aa=await this[_0x29f67d(0x271)][_0x29f67d(0x1b5)](model_constant_1['EModelType'][_0x29f67d(0x294)]),_0x1f4167=_0x2ba0aa['modelInfo'],_0x3955ea=_0x2ba0aa['modelInfo'][_0x29f67d(0x3ca)];if(!_0x1f4167)throw new common_1[(_0x29f67d(0x3d5))](_0x29f67d(0x235),common_1[_0x29f67d(0x3be)]['BAD_REQUEST']);const {id:_0xbac353}=_0x1f4167;let _0xb45166=null,_0x5e2a07=null;try{const _0x16b172=await this[_0x29f67d(0x2b0)]('','',_0x1f4167),_0x791a5d=await this[_0x29f67d(0x1dd)](_0x1f4167,_0x16b172);_0xb45166=await _0x791a5d[_0x29f67d(0x1d9)](_0x35897f,{..._0x16b172,'abortSignal':_0x3e2421[_0x29f67d(0x21e)]});const _0x2b9c58=(0x0,helper_1['unifiedFormattingResponse'])(_0x3955ea,_0xb45166,_0x5e2a07),{total_tokens:total_tokens=0x0}=_0x2b9c58[_0x29f67d(0x356)];return await this[_0x29f67d(0x271)][_0x29f67d(0x305)](_0xbac353,total_tokens),await this[_0x29f67d(0x330)][_0x29f67d(0x374)](_0xf11b3a,_0x1f4167,-0x1),_0xb45166['text'];}catch(_0x4bf66c){common_1[_0x29f67d(0x1dc)]['log'](_0x4bf66c);const _0x36b4ca=_0x4bf66c[_0x29f67d(0x421)];console['log'](_0x36b4ca);if(_0x4bf66c[_0x29f67d(0x1bf)]&&_0x4bf66c[_0x29f67d(0x1bf)]===0x192)throw new common_1[(_0x29f67d(0x3d5))](_0x4bf66c['message'],common_1[_0x29f67d(0x3be)]['PAYMENT_REQUIRED']);if(!_0x36b4ca)throw new common_1[(_0x29f67d(0x3d5))](_0x4bf66c[_0x29f67d(0x30e)],common_1[_0x29f67d(0x3be)][_0x29f67d(0x24f)]);let _0xf2e4af=errorMessage_constant_1['OpenAiErrorCodeMessage'][_0x36b4ca]?errorMessage_constant_1[_0x29f67d(0x3ee)][_0x36b4ca]:_0x29f67d(0x1c4);_0x4bf66c?.['message'][_0x29f67d(0x1ae)](_0x29f67d(0x35f))&&Number(_0x3955ea)===0x1&&(await this[_0x29f67d(0x271)][_0x29f67d(0x2a1)](_0xbac353,_0x29f67d(0x2d9),-0x1),_0xf2e4af=_0x29f67d(0x234));_0x4bf66c?.[_0x29f67d(0x421)]===0x1ad&&_0x4bf66c['message'][_0x29f67d(0x1ae)]('You\x20exceeded\x20your\x20current\x20quota,\x20please\x20check\x20your\x20plan\x20and\x20billing\x20details.')&&Number(_0x3955ea)===0x1&&(await this[_0x29f67d(0x271)][_0x29f67d(0x2a1)](_0xbac353,_0x29f67d(0x40a),-0x3),_0xf2e4af=_0x29f67d(0x34b));_0x4bf66c?.[_0x29f67d(0x421)]===0x191&&_0x4bf66c['message'][_0x29f67d(0x1ae)](_0x29f67d(0x1ea))&&Number(_0x3955ea)===0x1&&(await this[_0x29f67d(0x271)]['lockKey'](_0xbac353,_0x29f67d(0x2be),-0x2),_0xf2e4af='提供了错误的模型秘钥、已冻结当前调用Key、请重新尝试对话！');_0x4bf66c?.[_0x29f67d(0x421)]===0x191&&_0x4bf66c[_0x29f67d(0x30e)]['includes'](_0x29f67d(0x29c))&&Number(_0x3955ea)===0x1&&(await this[_0x29f67d(0x271)]['lockKey'](_0xbac353,_0x29f67d(0x34b),-0x2),_0xf2e4af=_0x29f67d(0x261));_0x4bf66c?.[_0x29f67d(0x421)]===0x194&&_0x4bf66c[_0x29f67d(0x30e)][_0x29f67d(0x1ae)](_0x29f67d(0x1f5))&&Number(_0x3955ea)===0x1&&(await this[_0x29f67d(0x271)][_0x29f67d(0x2a1)](_0xbac353,_0x29f67d(0x1f4),-0x4),_0xf2e4af=_0x29f67d(0x236));_0x4bf66c?.[_0x29f67d(0x421)]===0x133&&_0x4bf66c[_0x29f67d(0x30e)][_0x29f67d(0x1ae)](_0x29f67d(0x303))&&Number(_0x3955ea)===0x1&&(_0xf2e4af='\x20！');_0x36b4ca===0x190&&console[_0x29f67d(0x32f)](_0x29f67d(0x2e7),_0x4bf66c,_0x4bf66c[_0x29f67d(0x30e)]);const _0x2b770a={'message':_0xf2e4af||_0x29f67d(0x2db),'code':_0x36b4ca===0x191?0x191:_0x36b4ca||0x1f4};throw new common_1[(_0x29f67d(0x3d5))](_0x2b770a[_0x29f67d(0x30e)],common_1[_0x29f67d(0x3be)]['BAD_REQUEST']);}}async[_0x2b172c(0x1ed)](_0x5a2e78,_0x44b365,_0x899b2f){const _0x198ab8=_0x2b172c;try{const {audio:_0x4848ec,voice:_0x58f2d1}=_0x5a2e78,_0x639cb5=_0x44b365['abortController'],_0x42295d=await this[_0x198ab8(0x271)][_0x198ab8(0x402)]();if(!_0x42295d)throw _0x198ab8(0x3ce);const {key:_0x5384e6,proxyUrl:_0x514438}=_0x42295d;await this[_0x198ab8(0x330)]['checkUserStatus'](_0x44b365['user']),await this[_0x198ab8(0x330)][_0x198ab8(0x20d)](_0x44b365[_0x198ab8(0x3cf)]['id'],_0x42295d),console[_0x198ab8(0x32f)]('key\x20%s,\x20proxy\x20%s',_0x5384e6,_0x514438),this[_0x198ab8(0x1b3)][_0x198ab8(0x336)]=_0x5384e6,this['openAi']['baseURL']=(_0x514438||this['defaultBaseUrl'])+_0x198ab8(0x20f),this[_0x198ab8(0x1b3)][_0x198ab8(0x37d)]=0x989680;const _0x5159f4=await this['openAi'][_0x198ab8(0x38e)][_0x198ab8(0x3a9)][_0x198ab8(0x40e)]({'file':(0x0,fs_1[_0x198ab8(0x35a)])((0x0,path_1['resolve'])(_0x4848ec[_0x198ab8(0x226)])),'model':_0x198ab8(0x2b7),'language':'zh','response_format':'json','temperature':0x0})[_0x198ab8(0x2d5)](_0x38e6cb=>_0x38e6cb[_0x198ab8(0x42c)])[_0x198ab8(0x266)](_0x2713fc=>{const _0x5d32a9=_0x198ab8;common_1['Logger'][_0x5d32a9(0x286)](_0x2713fc);});console[_0x198ab8(0x32f)](_0x198ab8(0x1fb),_0x5159f4);if(!_0x5159f4){this[_0x198ab8(0x327)]((0x0,path_1['resolve'])(_0x4848ec[_0x198ab8(0x226)]));throw new common_1[(_0x198ab8(0x3d5))]('语音转文本失败',common_1[_0x198ab8(0x3be)][_0x198ab8(0x24f)]);}await this[_0x198ab8(0x330)][_0x198ab8(0x374)](_0x44b365[_0x198ab8(0x3cf)]['id'],_0x42295d,-0x1);const _0x187c60=await this[_0x198ab8(0x2f7)]({'userId':_0x44b365[_0x198ab8(0x3cf)]['id'],'prompt':_0x5159f4,'abortController':_0x639cb5});console[_0x198ab8(0x32f)](_0x198ab8(0x1bd),_0x187c60);if(!_0x187c60){this[_0x198ab8(0x327)]((0x0,path_1[_0x198ab8(0x2c3)])(_0x4848ec[_0x198ab8(0x226)]));throw new common_1[(_0x198ab8(0x3d5))](_0x198ab8(0x1bb),common_1['HttpStatus'][_0x198ab8(0x24f)]);}console[_0x198ab8(0x32f)]('response.length',_0x187c60[_0x198ab8(0x1da)]);let _0x280203=_0x187c60['length']>0x1000?_0x187c60[_0x198ab8(0x3c6)](0x0,0xfff):_0x187c60;const _0x57e3db=await this[_0x198ab8(0x1b3)][_0x198ab8(0x38e)]['speech'][_0x198ab8(0x40e)]({'input':_0x280203,'model':_0x198ab8(0x3e8),'response_format':_0x198ab8(0x3b8),'voice':_0x58f2d1,'speed':0x1})[_0x198ab8(0x2d5)](_0x4a9173=>_0x4a9173[_0x198ab8(0x32c)]())[_0x198ab8(0x266)](_0x54c30a=>{const _0x52a49c=_0x198ab8;common_1[_0x52a49c(0x1dc)][_0x52a49c(0x286)](_0x54c30a);});if(!_0x57e3db){this['removeFile']((0x0,path_1['resolve'])(_0x4848ec[_0x198ab8(0x226)]));throw new common_1[(_0x198ab8(0x3d5))](_0x198ab8(0x30a),common_1['HttpStatus'][_0x198ab8(0x24f)]);}await this[_0x198ab8(0x330)][_0x198ab8(0x374)](_0x44b365[_0x198ab8(0x3cf)]['id'],_0x42295d,-0x1);const _0x8b63c3=Buffer[_0x198ab8(0x428)](_0x57e3db);return _0x899b2f[_0x198ab8(0x221)](_0x198ab8(0x3e9),'application/octet-stream'),_0x899b2f[_0x198ab8(0x1f3)](_0x8b63c3),_0x899b2f[_0x198ab8(0x36e)](_0x8b63c3),this[_0x198ab8(0x327)]((0x0,path_1[_0x198ab8(0x2c3)])(_0x4848ec[_0x198ab8(0x226)])),_0x8b63c3;}catch(_0x2d8aa5){if(_0x2d8aa5 instanceof common_1['HttpException'])throw _0x2d8aa5;else throw new common_1[(_0x198ab8(0x3d5))](_0x2d8aa5['message'],common_1[_0x198ab8(0x3be)]['BAD_REQUEST']);}}async[_0x2b172c(0x3bb)](_0x4ecec9,_0x360c42){const _0x4bdb94=_0x2b172c;common_1[_0x4bdb94(0x1dc)][_0x4bdb94(0x32f)](_0x4bdb94(0x2ba)+_0x4ecec9[_0x4bdb94(0x2bb)],_0x4bdb94(0x3d4)),await this[_0x4bdb94(0x2dd)][_0x4bdb94(0x1ef)](_0x4ecec9[_0x4bdb94(0x2bb)],_0x360c42[_0x4bdb94(0x3cf)]['id']),await this[_0x4bdb94(0x330)]['checkUserStatus'](_0x360c42[_0x4bdb94(0x3cf)]);let _0x260e10=[];const _0x350fc2=await this['modelsService'][_0x4bdb94(0x3f2)](model_constant_1[_0x4bdb94(0x2b1)]['DRAW'],_0x4ecec9[_0x4bdb94(0x3e3)]);await this[_0x4bdb94(0x330)]['validateBalance4Draw'](_0x360c42[_0x4bdb94(0x3cf)]['id'],_0x350fc2,_0x4ecec9['n']);const {key:_0x32303a,model:_0x1e0500,proxyUrl:_0x2941e1}=await this[_0x4bdb94(0x38c)](_0x350fc2),_0x5e1998=_0x2941e1+_0x4bdb94(0x233);try{const _0x1c9bb8=await axios_1[_0x4bdb94(0x381)][_0x4bdb94(0x22a)](_0x5e1998,{..._0x4ecec9,'model':_0x1e0500,'response_format':_0x4bdb94(0x2f0)},{'headers':{'Authorization':_0x4bdb94(0x20b)+_0x32303a}});console[_0x4bdb94(0x32f)]('--------------------CHATDRAW--------------------',_0x1c9bb8),_0x260e10=_0x1c9bb8['data'][_0x4bdb94(0x3a2)];}catch(_0x13fe1a){console[_0x4bdb94(0x32f)]('openai-draw',_0x13fe1a?.[_0x4bdb94(0x32a)]?.[_0x4bdb94(0x3a2)]?.[_0x4bdb94(0x286)]),console['log'](_0x4ecec9);const _0x31cc85=_0x13fe1a?.['response']?.['status']||0x1f4,_0x520e4d=_0x13fe1a?.[_0x4bdb94(0x32a)]?.[_0x4bdb94(0x3a2)]?.['error']?.[_0x4bdb94(0x30e)];if(_0x31cc85===0x1ad)throw new common_1['HttpException'](_0x4bdb94(0x2cf),common_1[_0x4bdb94(0x3be)][_0x4bdb94(0x24f)]);if(_0x31cc85===0x190||_0x520e4d[_0x4bdb94(0x1ae)](_0x4bdb94(0x37f)))throw new common_1[(_0x4bdb94(0x3d5))](_0x4bdb94(0x3cb),common_1[_0x4bdb94(0x3be)][_0x4bdb94(0x24f)]);if(_0x31cc85===0x1f4)throw new common_1[(_0x4bdb94(0x3d5))](_0x4bdb94(0x2a5),common_1[_0x4bdb94(0x3be)][_0x4bdb94(0x24f)]);if(_0x31cc85===0x191)throw new common_1['HttpException'](_0x4bdb94(0x1e2),common_1[_0x4bdb94(0x3be)][_0x4bdb94(0x24f)]);throw new common_1['HttpException'](_0x4bdb94(0x238),common_1['HttpStatus'][_0x4bdb94(0x24f)]);}const _0xb1e035=[];for(const _0x201fb8 of _0x260e10){const _0x2b43ed=_0x201fb8[_0x4bdb94(0x2f0)]['replace'](/^data:image\/\w+;base64,/,''),_0x51365b=uuid['v4']()[_0x4bdb94(0x3c6)](0x0,0xa)+'.png',_0x417e4b=Buffer[_0x4bdb94(0x428)](_0x2b43ed,_0x4bdb94(0x210));_0xb1e035[_0x4bdb94(0x33b)](this[_0x4bdb94(0x242)][_0x4bdb94(0x3dd)]({'filename':_0x51365b,'buffer':_0x417e4b}));}const _0x13ceab=(0x0,utils_1[_0x4bdb94(0x39e)])(_0x360c42),_0x5bffaa=await Promise[_0x4bdb94(0x229)](_0xb1e035),[_0x4e3068,_0x52d6e0]=_0x4ecec9[_0x4bdb94(0x41f)][_0x4bdb94(0x36a)]('x'),_0x403d6d=_0x5bffaa[_0x4bdb94(0x378)](_0x460be4=>{const _0x526965=_0x4bdb94;return this['chatLogService']['saveChatLog']({'curIp':_0x13ceab,'logType':0x3,'answer':_0x460be4,'totalTokens':0x0,'promptTokens':0x0,'model':_0x4ecec9['model'],'userId':_0x360c42[_0x526965(0x3cf)]['id'],'prompt':_0x4ecec9[_0x526965(0x2bb)],'completionTokens':0x0,'modelSubType':'1','modelType':model_constant_1[_0x526965(0x2b1)][_0x526965(0x3a4)],'type':balance_constant_1[_0x526965(0x3af)][_0x526965(0x222)],'fileInfo':JSON[_0x526965(0x401)]({'width':_0x4e3068,'height':_0x52d6e0,'cosUrl':_0x460be4})});}),_0x1ea189=await Promise[_0x4bdb94(0x229)](_0x403d6d);return await this[_0x4bdb94(0x330)][_0x4bdb94(0x319)](_0x360c42['user']['id'],_0x350fc2,_0x1ea189[0x0]['id'],_0x4ecec9['n']),_0x5bffaa;}async[_0x2b172c(0x38c)](_0x597d28){const _0x973c74=_0x2b172c,{openaiModel3MaxTokens:openaiModel3MaxTokens=0x0,openaiModel3MaxTokensRes:openaiModel3MaxTokensRes=0x0,openaiModel3MaxTokens16k:openaiModel3MaxTokens16k=0x0,openaiModel3MaxTokens16kRes:openaiModel3MaxTokens16kRes=0x0,openaiModel4MaxTokens:openaiModel4MaxTokens=0x0,openaiModel4MaxTokensRes:openaiModel4MaxTokensRes=0x0,openaiModel4MaxTokens32k:openaiModel4MaxTokens32k=0x0,openaiModel4MaxTokens32kRes:openaiModel4MaxTokens32kRes=0x0,openaiBaseUrl:openaiBaseUrl=''}=await this[_0x973c74(0x1df)][_0x973c74(0x337)]([_0x973c74(0x1d5),_0x973c74(0x38a),_0x973c74(0x1ca),_0x973c74(0x1d1),_0x973c74(0x309),_0x973c74(0x2f6),_0x973c74(0x2ce),_0x973c74(0x419),_0x973c74(0x2e1)]);let _0x369fb1=null,_0x593634=null,_0x2243e0=null;const {model:_0x49b7f5,maxModelTokens:maxModelTokens=0x0,maxResponseTokens:maxResponseTokens=0x0,proxyUrl:_0x2e19b3,key:_0x3015e4}=_0x597d28;return _0x49b7f5[_0x973c74(0x248)]()['includes']('gpt-4')&&(_0x49b7f5[_0x973c74(0x248)]()['includes'](_0x973c74(0x237))?(_0x369fb1=maxModelTokens||openaiModel4MaxTokens32k||0x8000,_0x593634=maxResponseTokens||openaiModel4MaxTokens32kRes||0x4000):(_0x369fb1=maxModelTokens||openaiModel4MaxTokens||0x2000,_0x593634=maxResponseTokens||openaiModel4MaxTokensRes||0x1000)),_0x49b7f5[_0x973c74(0x248)]()[_0x973c74(0x1ae)](_0x973c74(0x348))&&(_0x49b7f5[_0x973c74(0x248)]()['includes']('16k')?(_0x369fb1=maxModelTokens||openaiModel3MaxTokens16k||0x4000,_0x593634=maxResponseTokens||openaiModel3MaxTokens16kRes||0x2000):(_0x369fb1=maxModelTokens||openaiModel3MaxTokens||0x1000,_0x593634=maxResponseTokens||openaiModel3MaxTokensRes||0x3e8)),_0x2243e0=_0x2e19b3||openaiBaseUrl||_0x973c74(0x1f7),_0x593634>=_0x369fb1&&(_0x593634=Math[_0x973c74(0x239)](_0x369fb1/0x2),common_1['Logger'][_0x973c74(0x3d6)](_0x973c74(0x3fd)+_0x3015e4+_0x973c74(0x365)+_0x593634)),{'key':_0x3015e4,'model':_0x49b7f5,'maxToken':_0x369fb1,'maxTokenRes':_0x593634,'proxyUrl':_0x2243e0};}async[_0x2b172c(0x280)](_0x24ced2){const _0x3b7744=_0x2b172c;try{const _0x587e79=await this[_0x3b7744(0x34f)][_0x3b7744(0x212)](_0x24ced2),_0x1b98c6=await this[_0x3b7744(0x314)][_0x3b7744(0x28c)]({'where':{'yooTaskId':_0x24ced2[_0x3b7744(0x34e)]['id']}});if(!_0x1b98c6)throw new Error(_0x3b7744(0x2c2));_0x1b98c6[_0x3b7744(0x1bf)]=_0x587e79[_0x3b7744(0x3a2)][_0x3b7744(0x1bf)],_0x1b98c6[_0x3b7744(0x35d)]=_0x587e79[_0x3b7744(0x3a2)]['state_description'],_0x1b98c6[_0x3b7744(0x232)]=_0x587e79[_0x3b7744(0x3a2)][_0x3b7744(0x232)],_0x1b98c6[_0x3b7744(0x231)]=_0x587e79['data'][_0x3b7744(0x410)],_0x1b98c6[_0x3b7744(0x3bc)]=_0x587e79['data'][_0x3b7744(0x2a6)],_0x1b98c6[_0x3b7744(0x1f6)]=_0x587e79['data'][_0x3b7744(0x2ea)],_0x1b98c6[_0x3b7744(0x361)]=_0x587e79[_0x3b7744(0x3a2)][_0x3b7744(0x3a1)],_0x1b98c6[_0x3b7744(0x28f)]=_0x587e79[_0x3b7744(0x3a2)]['created_at'],_0x1b98c6[_0x3b7744(0x288)]=_0x587e79[_0x3b7744(0x3a2)]['updated_at'],_0x1b98c6[_0x3b7744(0x33d)]=_0x587e79['data'][_0x3b7744(0x332)],await this[_0x3b7744(0x314)]['save'](_0x1b98c6);}catch(_0x340b98){common_1[_0x3b7744(0x1dc)][_0x3b7744(0x286)](_0x340b98[_0x3b7744(0x30e)],_0x3b7744(0x2a9));}}async[_0x2b172c(0x2e8)](_0x511238,_0x256e8a){const _0x12b993=_0x2b172c;try{return this[_0x12b993(0x400)][_0x12b993(0x205)](async()=>{const _0x22384e=_0x12b993,_0x5d8baf=await this[_0x22384e(0x271)][_0x22384e(0x1b5)](model_constant_1[_0x22384e(0x2b1)][_0x22384e(0x3a6)]);let _0x2572e6={'userId':_0x511238[_0x22384e(0x3cf)]['id'],'type':ppt_constant_1[_0x22384e(0x2e3)][_0x22384e(0x22e)],'title':_0x256e8a[_0x22384e(0x227)],'text':_0x256e8a[_0x22384e(0x42c)],'theme':_0x256e8a['theme']};_0x2572e6=await this[_0x22384e(0x314)]['save'](_0x2572e6),await this[_0x22384e(0x330)][_0x22384e(0x20e)](_0x511238[_0x22384e(0x3cf)]['id'],_0x2572e6['id'],_0x2572e6[_0x22384e(0x22b)]);const _0x3b0ac6=await this[_0x22384e(0x34f)][_0x22384e(0x2e8)]({'data':_0x256e8a,'baseURL':_0x5d8baf[_0x22384e(0x22d)]['proxyUrl'],'headers':{'Authorization':_0x22384e(0x20b)+_0x5d8baf[_0x22384e(0x22d)][_0x22384e(0x26d)]}});return _0x2572e6[_0x22384e(0x227)]=_0x3b0ac6['data'][_0x22384e(0x227)],_0x2572e6[_0x22384e(0x41d)]=_0x3b0ac6[_0x22384e(0x3a2)][_0x22384e(0x41d)],await this[_0x22384e(0x314)][_0x22384e(0x321)](_0x2572e6),_0x2572e6;});}catch(_0x4348e9){throw new common_1['HttpException'](_0x4348e9[_0x12b993(0x30e)],common_1[_0x12b993(0x3be)][_0x12b993(0x24f)]);}}async[_0x2b172c(0x372)](_0x399a88,_0x40c65b){const _0xcf8b93=_0x2b172c,_0x53d076=await this['pptTaskEntity'][_0xcf8b93(0x28c)]({'where':{'id':_0x40c65b}});if(!_0x53d076)throw new common_1['HttpException'](_0xcf8b93(0x2b3),common_1[_0xcf8b93(0x3be)][_0xcf8b93(0x24f)]);await this[_0xcf8b93(0x330)]['debuctBalance4PPT'](_0x399a88['user']['id'],_0x53d076['id'],ppt_constant_1[_0xcf8b93(0x2e3)]['EDITOR']);const _0x560bf4=await this[_0xcf8b93(0x271)][_0xcf8b93(0x1b5)](model_constant_1[_0xcf8b93(0x2b1)]['PPT']),_0x40c3ce=await this['pptService'][_0xcf8b93(0x3f3)]({'baseURL':_0x560bf4[_0xcf8b93(0x22d)][_0xcf8b93(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0x560bf4[_0xcf8b93(0x22d)][_0xcf8b93(0x26d)]},'data':{'id':_0x53d076[_0xcf8b93(0x201)],'expire':0x83d600}});return _0x40c3ce[_0xcf8b93(0x30f)]==_0xcf8b93(0x1c0)&&_0x40c3ce[_0xcf8b93(0x3a2)][_0xcf8b93(0x1af)]&&(_0x53d076[_0xcf8b93(0x2cc)]=_0x40c3ce[_0xcf8b93(0x3a2)]['url'],await this[_0xcf8b93(0x314)][_0xcf8b93(0x339)]({'id':_0x53d076['id']},{'editorUrl':_0x53d076[_0xcf8b93(0x2cc)]})),_0x53d076;}async[_0x2b172c(0x2e9)](_0x325e7a,_0x5645d0){const _0x55df3d=_0x2b172c,_0x394584=await this[_0x55df3d(0x314)]['findOne']({'where':{'id':_0x5645d0}});if(!_0x394584)throw new common_1[(_0x55df3d(0x3d5))](_0x55df3d(0x2b3),common_1[_0x55df3d(0x3be)][_0x55df3d(0x24f)]);await this[_0x55df3d(0x330)][_0x55df3d(0x20e)](_0x325e7a['user']['id'],_0x394584['id'],ppt_constant_1[_0x55df3d(0x2e3)][_0x55df3d(0x405)]);const _0x5af140=await this['modelsService']['getModelByType'](model_constant_1[_0x55df3d(0x2b1)][_0x55df3d(0x3a6)]),_0x5b8b3c=await this[_0x55df3d(0x34f)][_0x55df3d(0x2e9)]({'baseURL':_0x5af140[_0x55df3d(0x22d)][_0x55df3d(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0x5af140['modelInfo'][_0x55df3d(0x26d)]},'params':{'id':_0x394584[_0x55df3d(0x201)],'type':_0x55df3d(0x399)}});return _0x5b8b3c[_0x55df3d(0x30f)]=='200'&&_0x5b8b3c['data'][_0x55df3d(0x2ed)]&&(_0x394584['downUrl']=_0x5b8b3c[_0x55df3d(0x3a2)][_0x55df3d(0x2ed)],await this[_0x55df3d(0x314)][_0x55df3d(0x339)]({'id':_0x394584['id']},{'downUrl':_0x394584['downUrl']})),_0x394584;}[_0x2b172c(0x40d)](_0x59e54d,_0x309f47){const _0xf84970=_0x2b172c;try{return this[_0xf84970(0x400)]['transaction'](async()=>{const _0x25978b=_0xf84970,_0x40d6d3=await this[_0x25978b(0x271)]['getModelByType'](model_constant_1[_0x25978b(0x2b1)][_0x25978b(0x3a6)]);let _0x22a612={'userId':_0x59e54d['user']['id'],'type':ppt_constant_1[_0x25978b(0x2e3)][_0x25978b(0x1c6)],'title':_0x309f47[_0x25978b(0x227)],'text':_0x309f47['text'],'author':_0x309f47[_0x25978b(0x2d7)],'color':_0x309f47[_0x25978b(0x3ef)],'style':_0x309f47[_0x25978b(0x382)]};_0x22a612=await this['pptTaskEntity']['save'](_0x22a612),await this['userService'][_0x25978b(0x20e)](_0x59e54d[_0x25978b(0x3cf)]['id'],_0x22a612['id'],_0x22a612[_0x25978b(0x22b)]);const _0x1f64e6=await this[_0x25978b(0x34f)][_0x25978b(0x40d)]({'data':{'title':_0x309f47[_0x25978b(0x227)],'count':_0x309f47[_0x25978b(0x42c)],'user_name':_0x309f47['author'],'color':_0x309f47['color'],'style':_0x309f47[_0x25978b(0x382)]},'baseURL':_0x40d6d3[_0x25978b(0x22d)][_0x25978b(0x2cb)],'headers':{'Authorization':_0x25978b(0x262)+_0x40d6d3[_0x25978b(0x22d)][_0x25978b(0x26d)]}});return _0x22a612[_0x25978b(0x33e)]=_0x1f64e6[_0x25978b(0x3a2)],await this['pptTaskEntity'][_0x25978b(0x321)](_0x22a612),_0x22a612;});}catch(_0x4787e5){throw new common_1[(_0xf84970(0x3d5))](_0x4787e5[_0xf84970(0x30e)],common_1[_0xf84970(0x3be)][_0xf84970(0x24f)]);}}[_0x2b172c(0x1ce)](_0x49206c,_0x145dda){const _0x585738=_0x2b172c;try{return this[_0x585738(0x400)][_0x585738(0x205)](async()=>{const _0x3e9a8e=_0x585738,_0x3d5c10=await this[_0x3e9a8e(0x271)]['getModelByType'](model_constant_1[_0x3e9a8e(0x2b1)][_0x3e9a8e(0x3a6)]);let _0x54d92f={'userId':_0x49206c[_0x3e9a8e(0x3cf)]['id'],'type':ppt_constant_1[_0x3e9a8e(0x2e3)][_0x3e9a8e(0x2d3)],'title':_0x145dda[_0x3e9a8e(0x227)],'text':_0x145dda['text'],'author':_0x145dda[_0x3e9a8e(0x2d7)],'coverId':_0x145dda[_0x3e9a8e(0x3dc)]};_0x54d92f=await this['pptTaskEntity']['save'](_0x54d92f),await this[_0x3e9a8e(0x330)][_0x3e9a8e(0x20e)](_0x49206c[_0x3e9a8e(0x3cf)]['id'],_0x54d92f['id'],_0x54d92f[_0x3e9a8e(0x22b)]);const _0x1a44fa=await this[_0x3e9a8e(0x34f)][_0x3e9a8e(0x1ce)]({'data':{'title':_0x145dda[_0x3e9a8e(0x227)],'count':_0x145dda[_0x3e9a8e(0x42c)],'user_name':_0x145dda[_0x3e9a8e(0x2d7)],'cover_id':_0x145dda[_0x3e9a8e(0x3dc)]},'baseURL':_0x3d5c10[_0x3e9a8e(0x22d)][_0x3e9a8e(0x2cb)],'headers':{'Authorization':_0x3e9a8e(0x262)+_0x3d5c10['modelInfo'][_0x3e9a8e(0x26d)]}});return _0x54d92f[_0x3e9a8e(0x33e)]=_0x1a44fa[_0x3e9a8e(0x3a2)],await this[_0x3e9a8e(0x314)][_0x3e9a8e(0x321)](_0x54d92f),_0x54d92f;});}catch(_0x1ecded){throw new common_1[(_0x585738(0x3d5))](_0x1ecded[_0x585738(0x30e)],common_1[_0x585738(0x3be)]['BAD_REQUEST']);}}async[_0x2b172c(0x208)](_0x44dc50){const _0x5a6c31=_0x2b172c;try{const _0x10ca73=[_0x5a6c31(0x375),_0x5a6c31(0x31c),_0x5a6c31(0x3d0),'pptCreateVipFree',_0x5a6c31(0x2cd),'pptEditorVipFree'],_0x2452fa=await this[_0x5a6c31(0x1df)][_0x5a6c31(0x337)](_0x10ca73);if(!_0x44dc50[_0x5a6c31(0x3cf)]||!_0x44dc50[_0x5a6c31(0x3cf)]['id'])throw new Error(_0x5a6c31(0x28e));const _0xfba84=[_0x5a6c31(0x267),_0x5a6c31(0x2f4),_0x5a6c31(0x3f3)],_0x5da336=await Promise[_0x5a6c31(0x229)](_0xfba84[_0x5a6c31(0x378)](async _0x390cdf=>{const _0x96800e=_0x5a6c31,_0x3316f8=_0x2452fa[_0x390cdf+_0x96800e(0x3b3)],_0x330e43=_0x2452fa[_0x390cdf+'Price'],_0x3ad77a=redisKey_constant_1[_0x96800e(0x2a8)]+'-'+_0x44dc50['user']['id']+'-'+(_0x390cdf+_0x96800e(0x3b3)),_0x28bef4=await this[_0x96800e(0x330)][_0x96800e(0x416)](_0x44dc50[_0x96800e(0x3cf)]['id'],_0x3ad77a,_0x3316f8);return{'type':_0x390cdf,'remainCount':_0x28bef4,'freeCount':Number(_0x3316f8),'useIntegrate':Number(_0x330e43)};}));return _0x5da336;}catch(_0x40110e){console[_0x5a6c31(0x286)](_0x5a6c31(0x1fc),_0x40110e);throw _0x40110e;}}[_0x2b172c(0x2f4)](_0x2af48f,_0x547f69){const _0xbce283=_0x2b172c;try{return this['connection'][_0xbce283(0x205)](async()=>{const _0x10f570=_0xbce283;let _0x1b7906;const _0x2809fe=await this[_0x10f570(0x271)][_0x10f570(0x1b5)](model_constant_1['EModelType'][_0x10f570(0x3a6)]);if(_0x547f69[_0x10f570(0x32d)]){_0x1b7906=await this[_0x10f570(0x314)][_0x10f570(0x28c)]({'where':{'id':_0x547f69['originTaskId']}});if(!_0x1b7906)throw new Error(_0x10f570(0x3f0));}let _0x1ab7e8={'userId':_0x2af48f[_0x10f570(0x3cf)]['id'],'type':ppt_constant_1['EPPTTaskType'][_0x10f570(0x411)],'title':_0x547f69['title'],'subTitle':_0x547f69[_0x10f570(0x2fb)],'text':_0x547f69[_0x10f570(0x42c)],'catalogs':_0x547f69[_0x10f570(0x41d)],'contents':_0x547f69[_0x10f570(0x313)],'author':_0x547f69[_0x10f570(0x2d7)],'fontName':_0x547f69[_0x10f570(0x21d)],'transition':_0x547f69[_0x10f570(0x3c9)],'complex':_0x547f69[_0x10f570(0x202)],'coverId':_0x547f69[_0x10f570(0x3dc)],'originId':_0x547f69[_0x10f570(0x32d)]};_0x1ab7e8=await this['pptTaskEntity'][_0x10f570(0x321)](_0x1ab7e8),await this[_0x10f570(0x330)][_0x10f570(0x20e)](_0x2af48f[_0x10f570(0x3cf)]['id'],_0x1ab7e8['id'],_0x1ab7e8[_0x10f570(0x22b)]);try{const _0x120fe8=await this['pptService'][_0x10f570(0x2f4)]({'data':{'text':_0x547f69['text'],'custom_data':{'title':_0x547f69[_0x10f570(0x227)],'sub_title':_0x547f69[_0x10f570(0x2fb)],'author':_0x547f69[_0x10f570(0x2d7)],'catalogs':_0x547f69['catalogs'],'contents':_0x547f69[_0x10f570(0x313)]},'cover_id':_0x547f69[_0x10f570(0x3dc)],'font_name':_0x547f69[_0x10f570(0x21d)],'transition':_0x547f69[_0x10f570(0x3c9)],'complex':_0x547f69[_0x10f570(0x202)],'user_name':_0x547f69['author'],'id':_0x1b7906?.['yooTaskId']},'baseURL':_0x2809fe[_0x10f570(0x22d)][_0x10f570(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0x2809fe[_0x10f570(0x22d)][_0x10f570(0x26d)]}});return _0x1ab7e8['yooTaskId']=_0x120fe8[_0x10f570(0x3a2)]['id'],await this['pptTaskEntity']['save'](_0x1ab7e8),_0x1ab7e8;}catch(_0x20e5d2){await this[_0x10f570(0x330)][_0x10f570(0x20e)](_0x2af48f[_0x10f570(0x3cf)]['id'],_0x1ab7e8['id'],_0x1ab7e8[_0x10f570(0x22b)],!![]);throw new common_1['HttpException'](_0x20e5d2[_0x10f570(0x30e)],common_1[_0x10f570(0x3be)][_0x10f570(0x24f)]);}});}catch(_0x606eb5){throw new common_1[(_0xbce283(0x3d5))](_0x606eb5['message'],common_1[_0xbce283(0x3be)][_0xbce283(0x24f)]);}}[_0x2b172c(0x3ed)](_0x1b39fb,_0x129b5f){const _0x209bbd=_0x2b172c;try{return this['connection'][_0x209bbd(0x205)](async()=>{const _0x5cfeb5=_0x209bbd,_0x21536e=await this[_0x5cfeb5(0x271)][_0x5cfeb5(0x1b5)](model_constant_1[_0x5cfeb5(0x2b1)][_0x5cfeb5(0x3a6)]);let _0x5aabc9={'userId':_0x1b39fb['user']['id'],'type':ppt_constant_1[_0x5cfeb5(0x2e3)][_0x5cfeb5(0x2ca)],'title':_0x129b5f[_0x5cfeb5(0x227)],'color':_0x129b5f['color'],'style':_0x129b5f['style'],'fileUrl':_0x129b5f[_0x5cfeb5(0x417)],'pleader':_0x129b5f[_0x5cfeb5(0x213)],'advisor':_0x129b5f[_0x5cfeb5(0x1e1)],'school':_0x129b5f['school'],'schoolLogo':_0x129b5f[_0x5cfeb5(0x1b1)],'schoolPicture':_0x129b5f[_0x5cfeb5(0x370)]};_0x5aabc9=await this[_0x5cfeb5(0x314)][_0x5cfeb5(0x321)](_0x5aabc9),await this[_0x5cfeb5(0x330)]['debuctBalance4PPT'](_0x1b39fb[_0x5cfeb5(0x3cf)]['id'],_0x5aabc9['id'],_0x5aabc9['type']);const _0x1250a3=await this[_0x5cfeb5(0x34f)][_0x5cfeb5(0x3ed)]({'data':{'file_key':_0x129b5f[_0x5cfeb5(0x417)],'title':_0x129b5f['title'],'color':_0x129b5f[_0x5cfeb5(0x3ef)],'style':_0x129b5f['style'],'pleader':_0x129b5f[_0x5cfeb5(0x213)],'advisor':_0x129b5f['advisor'],'school':_0x129b5f['school'],'school_logo':_0x129b5f[_0x5cfeb5(0x1b1)],'school_picture':_0x129b5f[_0x5cfeb5(0x370)]},'baseURL':_0x21536e[_0x5cfeb5(0x22d)][_0x5cfeb5(0x2cb)],'headers':{'Authorization':_0x5cfeb5(0x262)+_0x21536e[_0x5cfeb5(0x22d)][_0x5cfeb5(0x26d)]}});return _0x5aabc9['yooTaskId']=_0x1250a3[_0x5cfeb5(0x3a2)]['id'],await this[_0x5cfeb5(0x314)][_0x5cfeb5(0x321)](_0x5aabc9),setTimeout(()=>this[_0x5cfeb5(0x280)]({'baseURL':_0x21536e[_0x5cfeb5(0x22d)][_0x5cfeb5(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0x21536e[_0x5cfeb5(0x22d)][_0x5cfeb5(0x26d)]},'params':{'id':_0x5aabc9[_0x5cfeb5(0x201)]}}),0xbb8),_0x5aabc9;});}catch(_0x3df013){throw new common_1[(_0x209bbd(0x3d5))](_0x3df013[_0x209bbd(0x30e)],common_1[_0x209bbd(0x3be)][_0x209bbd(0x24f)]);}}[_0x2b172c(0x3c2)](_0x44836a,_0xf62ec0){const _0x488576=_0x2b172c;try{return this['connection'][_0x488576(0x205)](async()=>{const _0x1c1dda=_0x488576,_0x561d96=await this[_0x1c1dda(0x271)]['getModelByType'](model_constant_1[_0x1c1dda(0x2b1)][_0x1c1dda(0x3a6)]);let _0x3b45f8={'userId':_0x44836a[_0x1c1dda(0x3cf)]['id'],'type':ppt_constant_1['EPPTTaskType'][_0x1c1dda(0x249)],'fileUrl':_0xf62ec0[_0x1c1dda(0x417)],'coverId':_0xf62ec0[_0x1c1dda(0x3dc)],'author':_0xf62ec0[_0x1c1dda(0x2d7)]};_0x3b45f8=await this[_0x1c1dda(0x314)][_0x1c1dda(0x321)](_0x3b45f8),await this[_0x1c1dda(0x330)][_0x1c1dda(0x20e)](_0x44836a['user']['id'],_0x3b45f8['id'],_0x3b45f8[_0x1c1dda(0x22b)]);const _0xdc557e=await this[_0x1c1dda(0x34f)][_0x1c1dda(0x3c2)]({'data':{'file_url':_0xf62ec0[_0x1c1dda(0x417)],'cover_id':_0xf62ec0[_0x1c1dda(0x3dc)],'user_name':_0xf62ec0[_0x1c1dda(0x2d7)]},'baseURL':_0x561d96[_0x1c1dda(0x22d)][_0x1c1dda(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0x561d96['modelInfo'][_0x1c1dda(0x26d)]}});return _0x3b45f8['yooTaskId']=_0xdc557e['data']['id'],await this[_0x1c1dda(0x314)][_0x1c1dda(0x321)](_0x3b45f8),setTimeout(()=>this[_0x1c1dda(0x280)]({'baseURL':_0x561d96[_0x1c1dda(0x22d)][_0x1c1dda(0x2cb)],'headers':{'Authorization':_0x1c1dda(0x262)+_0x561d96[_0x1c1dda(0x22d)][_0x1c1dda(0x26d)]},'params':{'id':_0x3b45f8[_0x1c1dda(0x201)]}}),0xbb8),_0x3b45f8;});}catch(_0x44c11b){throw new common_1[(_0x488576(0x3d5))](_0x44c11b[_0x488576(0x30e)],common_1['HttpStatus']['BAD_REQUEST']);}}['pptDetail'](_0x351a2e){const _0x523531=_0x2b172c;return this[_0x523531(0x314)]['findOne']({'where':{'id':_0x351a2e}});}['pptChangeTheme'](_0x7a68bd,_0x3713c7){const _0x23f108=_0x2b172c;try{return this[_0x23f108(0x400)][_0x23f108(0x205)](async()=>{const _0x4df47d=_0x23f108,_0xe33221=await this[_0x4df47d(0x314)][_0x4df47d(0x28c)]({'where':{'id':_0x3713c7['originTaskId']}});if(!_0xe33221)throw new Error('原始任务不存在！');const _0xac866d=await this[_0x4df47d(0x271)]['getModelByType'](model_constant_1[_0x4df47d(0x2b1)][_0x4df47d(0x3a6)]);let _0x457f0b={'userId':_0x7a68bd[_0x4df47d(0x3cf)]['id'],'type':ppt_constant_1[_0x4df47d(0x2e3)][_0x4df47d(0x30d)],'originId':_0x3713c7[_0x4df47d(0x32d)],'coverId':_0x3713c7[_0x4df47d(0x3dc)],'fontName':_0x3713c7['fontName'],'transition':_0x3713c7['transition']};_0x457f0b=await this[_0x4df47d(0x314)]['save'](_0x457f0b),await this[_0x4df47d(0x330)][_0x4df47d(0x20e)](_0x7a68bd[_0x4df47d(0x3cf)]['id'],_0x457f0b['id'],_0x457f0b[_0x4df47d(0x22b)]);const _0x3dc06d=await this[_0x4df47d(0x34f)][_0x4df47d(0x3ec)]({'data':{'id':_0xe33221[_0x4df47d(0x201)],'cover_id':_0x3713c7['coverId'],'font_name':_0x3713c7[_0x4df47d(0x21d)],'transition':_0x3713c7[_0x4df47d(0x3c9)]},'baseURL':_0xac866d[_0x4df47d(0x22d)][_0x4df47d(0x2cb)],'headers':{'Authorization':_0x4df47d(0x262)+_0xac866d[_0x4df47d(0x22d)][_0x4df47d(0x26d)]}});return _0x457f0b[_0x4df47d(0x201)]=_0x3dc06d['data']['id'],await this[_0x4df47d(0x314)][_0x4df47d(0x321)](_0x457f0b),setTimeout(()=>this[_0x4df47d(0x280)]({'baseURL':_0xac866d[_0x4df47d(0x22d)][_0x4df47d(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0xac866d['modelInfo'][_0x4df47d(0x26d)]},'params':{'id':_0x457f0b['yooTaskId']}}),0xbb8),_0x457f0b;});}catch(_0x5e79be){throw new common_1['HttpException'](_0x5e79be[_0x23f108(0x30e)],common_1[_0x23f108(0x3be)][_0x23f108(0x24f)]);}}['pptAddPage'](_0x3b1599,_0x2869e7){const _0x3eddae=_0x2b172c;try{return this[_0x3eddae(0x400)][_0x3eddae(0x205)](async()=>{const _0x125b58=_0x3eddae,_0x56eb7d=await this['pptTaskEntity'][_0x125b58(0x28c)]({'where':{'id':_0x2869e7[_0x125b58(0x32d)]}});if(!_0x56eb7d)throw new Error(_0x125b58(0x3f0));const _0x4018d5=await this[_0x125b58(0x271)]['getModelByType'](model_constant_1[_0x125b58(0x2b1)][_0x125b58(0x3a6)]);let _0x4dc2de={'userId':_0x3b1599[_0x125b58(0x3cf)]['id'],'type':ppt_constant_1[_0x125b58(0x2e3)][_0x125b58(0x246)],'originId':_0x2869e7['originTaskId'],'theme':_0x2869e7[_0x125b58(0x2c6)],'text':_0x2869e7[_0x125b58(0x42c)],'complex':_0x2869e7[_0x125b58(0x202)]?String(_0x2869e7[_0x125b58(0x202)]):'1','author':_0x2869e7[_0x125b58(0x2d7)],'fontName':_0x2869e7[_0x125b58(0x21d)],'transition':_0x2869e7[_0x125b58(0x3c9)],'slideNumber':_0x2869e7[_0x125b58(0x289)],'slideType':_0x2869e7['slideType']};_0x4dc2de=await this['pptTaskEntity'][_0x125b58(0x321)](_0x4dc2de),await this[_0x125b58(0x330)][_0x125b58(0x20e)](_0x3b1599[_0x125b58(0x3cf)]['id'],_0x4dc2de['id'],_0x4dc2de['type']);const _0x1e6434=await this[_0x125b58(0x34f)][_0x125b58(0x3ff)]({'data':{'id':_0x56eb7d[_0x125b58(0x201)],'text':_0x2869e7[_0x125b58(0x42c)],'complex':_0x2869e7[_0x125b58(0x202)],'user_name':_0x2869e7['author'],'font_name':_0x2869e7[_0x125b58(0x21d)],'transition':_0x2869e7[_0x125b58(0x3c9)],'slide_number':_0x2869e7[_0x125b58(0x289)],'slide_type':_0x2869e7['slideType'],'theme':_0x2869e7[_0x125b58(0x2c6)]},'baseURL':_0x4018d5[_0x125b58(0x22d)][_0x125b58(0x2cb)],'headers':{'Authorization':_0x125b58(0x262)+_0x4018d5[_0x125b58(0x22d)][_0x125b58(0x26d)]}});return _0x4dc2de[_0x125b58(0x201)]=_0x1e6434[_0x125b58(0x3a2)]['id'],await this[_0x125b58(0x314)]['save'](_0x4dc2de),setTimeout(()=>this[_0x125b58(0x280)]({'baseURL':_0x4018d5['modelInfo'][_0x125b58(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0x4018d5[_0x125b58(0x22d)]['accessToken']},'params':{'id':_0x4dc2de[_0x125b58(0x201)]}}),0xbb8),_0x4dc2de;});}catch(_0x61a8a1){throw new common_1[(_0x3eddae(0x3d5))](_0x61a8a1[_0x3eddae(0x30e)],common_1[_0x3eddae(0x3be)][_0x3eddae(0x24f)]);}}[_0x2b172c(0x32e)](_0x3252ad,_0x2b2894){const _0x4eaa85=_0x2b172c;try{return this['connection'][_0x4eaa85(0x205)](async()=>{const _0x2d506a=_0x4eaa85,_0x582046=await this['pptTaskEntity'][_0x2d506a(0x28c)]({'where':{'id':_0x2b2894[_0x2d506a(0x32d)]}});if(!_0x582046)throw new Error('原始任务不存在！');const _0x81bd83=await this[_0x2d506a(0x271)][_0x2d506a(0x1b5)](model_constant_1[_0x2d506a(0x2b1)][_0x2d506a(0x3a6)]);let _0x1ef308={'userId':_0x3252ad[_0x2d506a(0x3cf)]['id'],'type':ppt_constant_1[_0x2d506a(0x2e3)][_0x2d506a(0x27c)],'originId':_0x2b2894[_0x2d506a(0x32d)],'notes':_0x2b2894};_0x1ef308=await this[_0x2d506a(0x314)][_0x2d506a(0x321)](_0x1ef308),await this[_0x2d506a(0x330)][_0x2d506a(0x20e)](_0x3252ad[_0x2d506a(0x3cf)]['id'],_0x1ef308['id'],_0x1ef308[_0x2d506a(0x22b)]);const _0x5e8ffb=await this['pptService'][_0x2d506a(0x24c)]({'data':{..._0x2b2894,'id':_0x582046[_0x2d506a(0x201)]},'baseURL':_0x81bd83['modelInfo'][_0x2d506a(0x2cb)],'headers':{'Authorization':'Beare\x20'+_0x81bd83[_0x2d506a(0x22d)][_0x2d506a(0x26d)]}});return _0x1ef308[_0x2d506a(0x201)]=_0x5e8ffb[_0x2d506a(0x3a2)]['id'],await this[_0x2d506a(0x314)]['save'](_0x1ef308),setTimeout(()=>this[_0x2d506a(0x280)]({'baseURL':_0x81bd83[_0x2d506a(0x22d)][_0x2d506a(0x2cb)],'headers':{'Authorization':_0x2d506a(0x262)+_0x81bd83[_0x2d506a(0x22d)][_0x2d506a(0x26d)]},'params':{'id':_0x1ef308[_0x2d506a(0x201)]}}),0xbb8),_0x1ef308;});}catch(_0x33f0c7){throw new common_1[(_0x4eaa85(0x3d5))](_0x33f0c7[_0x4eaa85(0x30e)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x2b172c(0x3df)](_0x230e2b,_0x537129){const _0x3b7864=_0x2b172c,{page:page=0x1,size:size=0x14,keyword:_0x456000}=_0x230e2b,_0x2583ee=[{'delFlag':0x0,'publishFlag':0x1,'type':(0x0,typeorm_1['In'])([ppt_constant_1['EPPTTaskType'][_0x3b7864(0x411)],ppt_constant_1[_0x3b7864(0x2e3)][_0x3b7864(0x249)]])}];_0x456000&&_0x2583ee['push']({'title':(0x0,typeorm_1[_0x3b7864(0x1cd)])('%'+_0x456000+'%'),'delFlag':0x0},{'subTitle':(0x0,typeorm_1[_0x3b7864(0x1cd)])('%'+_0x456000+'%'),'delFlag':0x0});const [_0x44438a,_0x313cd6]=await this['pptTaskEntity'][_0x3b7864(0x1de)]({'where':_0x2583ee,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x3b7864(0x3c4)}}),_0x19861f=await this[_0x3b7864(0x330)][_0x3b7864(0x350)](_0x44438a,_0x537129);return{'rows':_0x19861f,'count':_0x313cd6};}async[_0x2b172c(0x2d6)](_0x5030a0,_0x53eb50){const _0x221481=_0x2b172c,_0x529a6d=_0x53eb50[_0x221481(0x3cf)]['id'],{page:page=0x1,size:size=0x14,keyword:_0x3128ea}=_0x5030a0,_0x1a5a51=_0x221481(0x1d4)+(_0x3128ea?_0x221481(0x326)+_0x3128ea+_0x221481(0x2bc)+_0x3128ea+_0x221481(0x2ff):'')+_0x221481(0x26f)+(_0x529a6d?'\x20AND\x20p.user_id\x20=\x20'+_0x529a6d:'')+_0x221481(0x2b2),_0x30f088=await this['connection']['query'](_0x221481(0x3ae)+_0x1a5a51+_0x221481(0x2b2)),_0x31cb23=await this[_0x221481(0x400)][_0x221481(0x391)](_0x221481(0x218)+_0x1a5a51+_0x221481(0x1be)+size+_0x221481(0x329)+(page-0x1)*size+_0x221481(0x2b2));!(0x0,utils_1[_0x221481(0x1c2)])(this[_0x221481(0x2b9)])&&_0x31cb23[_0x221481(0x25a)](_0x2d77e0=>{const _0x5a9247=_0x221481;_0x2d77e0[_0x5a9247(0x3c8)]=(0x0,utils_1['maskEmail'])(_0x2d77e0[_0x5a9247(0x3c8)]),_0x2d77e0['phone']=(0x0,utils_1[_0x5a9247(0x413)])(_0x2d77e0[_0x5a9247(0x35c)]);});const _0x259e58=await this[_0x221481(0x330)][_0x221481(0x350)](_0x31cb23,_0x53eb50);return{'rows':_0x259e58,'count':Number(_0x30f088[0x0]?.[_0x221481(0x407)]||0x0)};}async[_0x2b172c(0x35b)](_0x570c7e,_0x312665=0x1,_0x13848e=0xa){const _0x138ba2=_0x2b172c,{rows:_0x35b188,count:_0x51ac26}=await this['userService']['collectPage'](_0x312665,_0x13848e,_0x570c7e[_0x138ba2(0x3cf)]['id'],collectType_constant_1[_0x138ba2(0x2b6)][_0x138ba2(0x3a6)]),_0x1d7111=await this[_0x138ba2(0x314)][_0x138ba2(0x323)]({'where':{'id':(0x0,typeorm_1['In'])(_0x35b188[_0x138ba2(0x378)](_0x2cb4c=>_0x2cb4c[_0x138ba2(0x311)]))}});return{'rows':_0x1d7111,'count':_0x51ac26};}async[_0x2b172c(0x41e)](_0x54631c,_0x5b20ac){const _0x106d5e=_0x2b172c;if(!_0x54631c[_0x106d5e(0x3c0)]||!_0x54631c[_0x106d5e(0x3c0)][_0x106d5e(0x1da)])return!![];const _0x249038={'id':(0x0,typeorm_1['In'])(_0x54631c['ids'])};return _0x5b20ac&&(_0x249038[_0x106d5e(0x2d2)]=_0x5b20ac),await this[_0x106d5e(0x314)][_0x106d5e(0x339)](_0x249038,{'delFlag':0x1}),await this[_0x106d5e(0x330)][_0x106d5e(0x2ec)](_0x54631c[_0x106d5e(0x3c0)],collectType_constant_1[_0x106d5e(0x2b6)][_0x106d5e(0x3a6)]),!![];}async['tts'](_0x163b71,_0x5624e0){const _0x5a7a26=_0x2b172c;try{let _0x4d470b='';return await this[_0x5a7a26(0x400)][_0x5a7a26(0x205)](async()=>{const _0x12d1f3=_0x5a7a26,_0x526f8f=(0x0,utils_1[_0x12d1f3(0x253)])(this[_0x12d1f3(0x2b9)]),{modelInfo:_0x30873b}=await this[_0x12d1f3(0x271)]['getModelByType'](model_constant_1[_0x12d1f3(0x2b1)][_0x12d1f3(0x282)],'Speech_Synthesis7418877984234656063');await this['validateBeforeChat']({'prompt':_0x5624e0[_0x12d1f3(0x1ac)][_0x12d1f3(0x42c)],'user':_0x163b71[_0x12d1f3(0x3cf)],'currentRequestModel':_0x30873b});const _0x3a61e4={'curIp':(0x0,utils_1[_0x12d1f3(0x39e)])(_0x163b71),'prompt':_0x5624e0['request'][_0x12d1f3(0x42c)],'modelId':_0x30873b['id'],'modelType':_0x30873b['modelType'],'answer':'','model':_0x30873b[_0x12d1f3(0x3e3)],'role':_0x12d1f3(0x3cf),'userId':_0x163b71['user']['id'],'completionTokens':0x0,'totalTokens':0x0,'type':balance_constant_1[_0x12d1f3(0x3af)]['CHAT_TYPE'],'logType':0x1,'requestOptions':JSON[_0x12d1f3(0x401)](_0x5624e0),'saasId':_0x526f8f},_0x366258={..._0x3a61e4,'role':_0x12d1f3(0x287),'requestOptions':JSON['stringify']({'prompt':_0x5624e0[_0x12d1f3(0x1ac)][_0x12d1f3(0x42c)],'options':{'model':_0x30873b[_0x12d1f3(0x3e3)]}})};await this[_0x12d1f3(0x306)][_0x12d1f3(0x1e8)](_0x3a61e4),await this[_0x12d1f3(0x306)][_0x12d1f3(0x1e8)](_0x366258),await this['userService'][_0x12d1f3(0x374)](_0x163b71['user']['id'],_0x30873b,_0x366258['id']);const _0x2c4dcc={'app':{'appid':_0x30873b[_0x12d1f3(0x37c)],'token':_0x30873b[_0x12d1f3(0x37c)],'cluster':'volcano_tts'},'user':{'uid':String(_0x163b71[_0x12d1f3(0x3cf)]['id'])},'audio':{'voice_type':_0x12d1f3(0x40b),'encoding':_0x12d1f3(0x31f)},'request':{'reqid':(0x0,crypto_1['randomUUID'])(),'text':_0x5624e0['request'][_0x12d1f3(0x42c)],'operation':'query'}},_0x2c6821=await this[_0x12d1f3(0x2ef)][_0x12d1f3(0x32b)]({'data':_0x2c4dcc,'headers':{'Authorization':_0x12d1f3(0x2dc)+_0x30873b['accessToken']}}),_0x34296a=chat_constant_1['EChatType'][_0x12d1f3(0x282)]+'-'+_0x526f8f+'-'+_0x163b71[_0x12d1f3(0x3cf)]['id']+'-'+new Date()[_0x12d1f3(0x409)]()+'.mp3';let _0x32ae21=(0x0,path_1['join'])(process[_0x12d1f3(0x1f9)](),_0x12d1f3(0x34d),_0x12d1f3(0x2c1)),_0x3884c0=_0x12d1f3(0x292);_0x3884c0=_0x3884c0+'/'+_0x34296a;!(0x0,fs_1[_0x12d1f3(0x257)])(_0x32ae21)&&(0x0,fs_1[_0x12d1f3(0x1b2)])(_0x32ae21,{'recursive':!![]});_0x32ae21=(0x0,path_1[_0x12d1f3(0x403)])(_0x32ae21,_0x34296a),(0x0,fs_1[_0x12d1f3(0x3cc)])(_0x32ae21,_0x2c6821[_0x12d1f3(0x3a2)],_0x12d1f3(0x210));let _0x19809e=process[_0x12d1f3(0x27d)][_0x12d1f3(0x299)];_0x19809e[_0x12d1f3(0x3b1)](_0x12d1f3(0x414))?_0x4d470b=_0x19809e+_0x3884c0:_0x4d470b=_0x12d1f3(0x251)+_0x19809e+_0x3884c0,_0x366258[_0x12d1f3(0x1fd)]=_0x4d470b,await this['chatLogService']['saveChatLog'](_0x366258);}),_0x4d470b;}catch(_0x1f8b0f){throw new common_1[(_0x5a7a26(0x3d5))](_0x1f8b0f[_0x5a7a26(0x30e)],common_1[_0x5a7a26(0x3be)][_0x5a7a26(0x24f)]);}}async[_0x2b172c(0x3ba)](_0x5c6da2,_0x530145,_0x42de47){const _0x32a9e0=_0x2b172c;try{let _0x2d10ac,_0x40669b;return await this['connection'][_0x32a9e0(0x205)](async()=>{const _0x2c4aaf=_0x32a9e0,_0x3fb1c2=(0x0,utils_1[_0x2c4aaf(0x253)])(this[_0x2c4aaf(0x2b9)]),{modelInfo:_0x404240}=await this['modelsService'][_0x2c4aaf(0x1b5)](model_constant_1[_0x2c4aaf(0x2b1)][_0x2c4aaf(0x3cd)],_0x2c4aaf(0x223));await this['userService']['validateBalance4Chat'](_0x5c6da2[_0x2c4aaf(0x3cf)]['id'],_0x404240);const _0x197d5c={'groupId':_0x42de47,'curIp':(0x0,utils_1[_0x2c4aaf(0x39e)])(_0x5c6da2),'prompt':_0x530145,'modelId':_0x404240['id'],'modelType':_0x404240['modelType'],'answer':'','model':_0x404240[_0x2c4aaf(0x3e3)],'role':_0x2c4aaf(0x3cf),'userId':_0x5c6da2['user']['id'],'completionTokens':0x0,'totalTokens':0x0,'type':balance_constant_1[_0x2c4aaf(0x3af)][_0x2c4aaf(0x203)],'logType':0x1,'requestOptions':JSON[_0x2c4aaf(0x401)]({'url':_0x530145}),'saasId':_0x3fb1c2},_0x15b547={..._0x197d5c,'role':_0x2c4aaf(0x287),'requestOptions':JSON[_0x2c4aaf(0x401)]({'prompt':_0x530145,'options':{'model':_0x404240['model']}})};await this[_0x2c4aaf(0x306)][_0x2c4aaf(0x1e8)](_0x197d5c),await this['chatLogService'][_0x2c4aaf(0x1e8)](_0x15b547),await this[_0x2c4aaf(0x330)]['deductBalance4Chat'](_0x5c6da2[_0x2c4aaf(0x3cf)]['id'],_0x404240,_0x15b547['id']);let _0x1dfb8c=process[_0x2c4aaf(0x27d)][_0x2c4aaf(0x299)];!/^http/[_0x2c4aaf(0x376)](_0x1dfb8c)&&(_0x1dfb8c='https://'+_0x1dfb8c);const _0x58e3f4={'app':{'appid':_0x404240['appid'],'token':_0x404240[_0x2c4aaf(0x37c)],'cluster':_0x2c4aaf(0x3fa)},'user':{'uid':String(_0x5c6da2[_0x2c4aaf(0x3cf)]['id'])},'audio':{'url':_0x530145,'format':_0x530145[_0x2c4aaf(0x36a)]('.')[_0x2c4aaf(0x357)]()},'request':{'callback':_0x1dfb8c+_0x2c4aaf(0x26b)}},_0x47e8ff=await this[_0x2c4aaf(0x2ef)]['asr']({'data':_0x58e3f4,'headers':{'Authorization':_0x2c4aaf(0x2dc)+_0x404240[_0x2c4aaf(0x26d)]}});_0x2d10ac=_0x47e8ff['id'],_0x40669b=await this[_0x2c4aaf(0x306)][_0x2c4aaf(0x1e8)](_0x15b547);}),new Promise(_0x1253bf=>{const _0x55054b=_0x32a9e0;utils_1['EE'][_0x55054b(0x2ab)](chat_constant_1['EChatType'][_0x55054b(0x3cd)]+'-'+_0x2d10ac,async _0x4da032=>{const _0x3d2e42=_0x55054b;_0x40669b[_0x3d2e42(0x1fd)]=_0x4da032[_0x3d2e42(0x42c)],_0x40669b=await this[_0x3d2e42(0x306)][_0x3d2e42(0x1e8)](_0x40669b),_0x1253bf(_0x40669b);});});}catch(_0x5f1fd1){throw new common_1['HttpException'](_0x5f1fd1[_0x32a9e0(0x30e)],common_1[_0x32a9e0(0x3be)]['BAD_REQUEST']);}}[_0x2b172c(0x2c8)](_0x476651){const _0x4ab47b=_0x2b172c;_0x476651['code']===0x3e8&&utils_1['EE'][_0x4ab47b(0x427)](chat_constant_1['EChatType'][_0x4ab47b(0x3cd)]+'-'+_0x476651['id'],_0x476651);}async[_0x2b172c(0x2bf)](_0x42c2a3,_0x4d20f7,_0x179135,_0x238751){const _0x3e0941=_0x2b172c;try{let _0x5417d4=await this['connection'][_0x3e0941(0x205)](async()=>{const _0xf6a4a9=_0x3e0941;let _0xb6773e=new Date()['getTime'](),_0x2c6431=new Date()[_0xf6a4a9(0x409)]();const _0x221d90=_0x42c2a3[_0xf6a4a9(0x3cf)]['id'],_0x21ecbb=(0x0,utils_1['getReqSaasId'])(this[_0xf6a4a9(0x2b9)]),_0x23b32a=chat_constant_1[_0xf6a4a9(0x333)][_0xf6a4a9(0x3cd)]+'-'+_0x21ecbb+'-'+_0x221d90+'-'+new Date()[_0xf6a4a9(0x409)]()+'.mp3',_0x1bea9f=await this[_0xf6a4a9(0x242)]['upload2Local']({'filename':_0x23b32a,'buffer':_0x238751[_0xf6a4a9(0x358)]});_0x2c6431=new Date()[_0xf6a4a9(0x409)](),console['log']('[耗时打印]保存文件耗时：',_0x2c6431-_0xb6773e);const _0x4e1c4c=await this[_0xf6a4a9(0x3ba)](_0x42c2a3,_0x1bea9f,_0x179135?.['options']?.['groupId']);_0xb6773e=new Date()[_0xf6a4a9(0x409)](),console['log'](_0xf6a4a9(0x20c),_0xb6773e-_0x2c6431),_0x179135[_0xf6a4a9(0x2bb)]=_0x4e1c4c[_0xf6a4a9(0x1fd)];typeof _0x179135[_0xf6a4a9(0x1ad)]===_0xf6a4a9(0x2a4)&&(_0x179135[_0xf6a4a9(0x1ad)]=JSON['parse'](_0x179135[_0xf6a4a9(0x1ad)]));const _0x29f27b=await this[_0xf6a4a9(0x25c)](_0x179135,_0x42c2a3,_0x4d20f7,![]);_0x2c6431=new Date()[_0xf6a4a9(0x409)](),console[_0xf6a4a9(0x32f)]('[耗时打印]文字对话耗时：',_0x2c6431-_0xb6773e);const _0x31bd36=await this[_0xf6a4a9(0x32b)](_0x42c2a3,{'request':{'text':_0x29f27b['answer']}});_0x29f27b[_0xf6a4a9(0x368)]=_0x31bd36,this[_0xf6a4a9(0x306)][_0xf6a4a9(0x1e8)](_0x29f27b),_0xb6773e=new Date()[_0xf6a4a9(0x409)](),console[_0xf6a4a9(0x32f)](_0xf6a4a9(0x2d4),_0xb6773e-_0x2c6431);const {prompt:_0x3b0310,role:_0x2f0aa4,answer:_0x17f605,createdAt:_0x243091,conversationOptions:_0x2bc6d,requestOptions:_0x4d2a85,id:_0x52b8d4,answerMp3:_0x449fa6}=_0x29f27b;return{'chatId':_0x52b8d4,'dateTime':(0x0,utils_1[_0xf6a4a9(0x3b7)])(_0x243091),'text':_0x2f0aa4===_0xf6a4a9(0x3cf)?_0x3b0310:_0x17f605,'textMp3':_0x449fa6,'inversion':_0x2f0aa4==='user','error':![],'conversationOptions':_0x2bc6d?JSON[_0xf6a4a9(0x211)](_0x2bc6d):null,'requestOptions':_0x4d2a85?JSON[_0xf6a4a9(0x211)](_0x4d2a85):null};});_0x4d20f7['status'](0xc8)[_0x3e0941(0x3b4)](result_1[_0x3e0941(0x3f8)][_0x3e0941(0x209)](_0x5417d4));}catch(_0x554494){throw new common_1['HttpException'](_0x554494[_0x3e0941(0x30e)],common_1['HttpStatus'][_0x3e0941(0x24f)]);}}async[_0x2b172c(0x385)](_0xa4e506,_0x304bcc){const _0x28d75a=_0x2b172c,_0x205990=_0x304bcc['user']['id'],_0x5b5a1f=await this['modelsService'][_0x28d75a(0x301)](_0xa4e506);return{'remainCount':await this[_0x28d75a(0x330)][_0x28d75a(0x23e)](_0x205990,_0x5b5a1f),'freeCount':_0x5b5a1f[_0x28d75a(0x39f)],'isVipFree':_0x5b5a1f['vipFreeNum']==-0x1,'useIntegrate':_0x5b5a1f[_0x28d75a(0x219)]};}async['getVideoModelFree'](_0x28b137){const _0x321d4c=_0x2b172c,_0x3228f9=_0x28b137['user']?.['id'],_0x5f00fb=await this[_0x321d4c(0x271)][_0x321d4c(0x26e)](model_constant_1[_0x321d4c(0x2b1)]['VIDEO']),_0x2d0c1d=[];if(_0x3228f9)for(const _0x2a1d89 of _0x5f00fb){_0x2d0c1d[_0x321d4c(0x33b)]({'id':_0x2a1d89['id'],'keyType':_0x2a1d89[_0x321d4c(0x3ca)],'model':_0x2a1d89[_0x321d4c(0x3e3)],'name':_0x2a1d89[_0x321d4c(0x200)],'modelType':_0x2a1d89[_0x321d4c(0x250)],'remainCount':await this[_0x321d4c(0x330)][_0x321d4c(0x23e)](_0x3228f9,_0x2a1d89),'freeCount':_0x2a1d89[_0x321d4c(0x39f)],'isVipFree':_0x2a1d89[_0x321d4c(0x39f)]==-0x1,'useIntegrate':_0x2a1d89[_0x321d4c(0x219)]});}else _0x5f00fb[_0x321d4c(0x25a)](_0x42cfad=>{const _0x33af85=_0x321d4c;_0x2d0c1d['push']({'id':_0x42cfad['id'],'keyType':_0x42cfad[_0x33af85(0x3ca)],'model':_0x42cfad[_0x33af85(0x3e3)],'name':_0x42cfad[_0x33af85(0x200)],'modelType':_0x42cfad['modelType'],'remainCount':0x0,'freeCount':_0x42cfad[_0x33af85(0x39f)],'isVipFree':_0x42cfad[_0x33af85(0x39f)]==-0x1,'useIntegrate':_0x42cfad['deduct']});});return _0x2d0c1d;}async[_0x2b172c(0x29d)](_0x558e8d,_0x290488){const _0x19b743=_0x2b172c,_0x28a626=_0x558e8d[_0x19b743(0x3cf)]?.['id'];let _0x2522d1=_0x290488[_0x19b743(0x3ca)];const _0xb432c5=await this[_0x19b743(0x271)][_0x19b743(0x21a)](model_constant_1['EModelType'][_0x19b743(0x272)],_0x2522d1);if(!_0xb432c5)throw new common_1['HttpException'](_0x19b743(0x3eb),common_1[_0x19b743(0x3be)]['BAD_REQUEST']);const _0xfb0a70=await this[_0x19b743(0x330)][_0x19b743(0x23b)](_0xb432c5,_0x290488);if(!_0x28a626)return{'remainCount':0x0,'freeCount':_0xb432c5['vipFreeNum']>0x0?_0xb432c5['vipFreeNum']:_0xfb0a70?.[_0x19b743(0x39f)]||0x0,'isVipFree':_0xb432c5[_0x19b743(0x39f)]==-0x1||_0xfb0a70?.[_0x19b743(0x39f)]==-0x1,'useIntegrate':_0xb432c5['deduct']>0x0?_0xb432c5[_0x19b743(0x219)]:_0xfb0a70?.['price']||0x0};return{'remainCount':await this[_0x19b743(0x330)][_0x19b743(0x2d0)](_0x28a626,_0xb432c5,_0x290488),'freeCount':_0xb432c5[_0x19b743(0x39f)]>0x0?_0xb432c5['vipFreeNum']:_0xfb0a70?.[_0x19b743(0x39f)]||0x0,'isVipFree':_0xb432c5[_0x19b743(0x39f)]==-0x1||_0xfb0a70?.[_0x19b743(0x39f)]==-0x1,'useIntegrate':_0xb432c5[_0x19b743(0x219)]>0x0?_0xb432c5['deduct']:_0xfb0a70?.[_0x19b743(0x392)]||0x0};}async[_0x2b172c(0x316)](_0x2aeafc,_0x1a5ad4){const _0x8c3c54=_0x2b172c,_0x20b319=this[_0x8c3c54(0x330)][_0x8c3c54(0x1b7)](_0x2aeafc),_0x3ca1f1=_0x20b319?.['id'];let _0x49ac0e=_0x1a5ad4[_0x8c3c54(0x315)],_0x280af5=_0x1a5ad4['n']||0x1;const _0x3d3067=await this['modelsService']['getModelByKeyModel'](model_constant_1[_0x8c3c54(0x2b1)][_0x8c3c54(0x3a4)],_0x49ac0e);if(!_0x3d3067)throw new common_1[(_0x8c3c54(0x3d5))]('模型类型不存在',common_1[_0x8c3c54(0x3be)]['BAD_REQUEST']);if(!_0x3ca1f1)return{'remainCount':0x0,'freeCount':_0x3d3067['vipFreeNum']>0x0?_0x3d3067[_0x8c3c54(0x39f)]:0x0,'isVipFree':_0x3d3067['vipFreeNum']==-0x1,'useIntegrate':_0x3d3067[_0x8c3c54(0x219)]>0x0?_0x3d3067['deduct']:0x0};return{'remainCount':await this[_0x8c3c54(0x330)][_0x8c3c54(0x3db)](_0x3ca1f1,_0x3d3067),'freeCount':_0x3d3067[_0x8c3c54(0x39f)]>0x0?_0x3d3067['vipFreeNum']:0x0,'isVipFree':_0x3d3067['vipFreeNum']==-0x1,'useIntegrate':_0x3d3067[_0x8c3c54(0x219)]>0x0?_0x3d3067['deduct']*_0x280af5:0x0};}async[_0x2b172c(0x40f)](){const _0x577fdc=_0x2b172c,_0x20e078=await this[_0x577fdc(0x271)][_0x577fdc(0x1b5)](model_constant_1[_0x577fdc(0x2b1)]['PPT']),_0xb207a=await this[_0x577fdc(0x314)][_0x577fdc(0x391)](_0x577fdc(0x277));_0xb207a[_0x577fdc(0x1da)]&&_0xb207a['forEach'](async _0x3a05d9=>{const _0x17b42a=_0x577fdc;this[_0x17b42a(0x280)]({'baseURL':_0x20e078[_0x17b42a(0x22d)][_0x17b42a(0x2cb)],'headers':{'Authorization':_0x17b42a(0x262)+_0x20e078['modelInfo']['accessToken']},'params':{'id':_0x3a05d9[_0x17b42a(0x1cb)]}});});const _0x4a2d30=await this[_0x577fdc(0x314)]['query'](_0x577fdc(0x254));_0x4a2d30[_0x577fdc(0x1da)]&&_0x4a2d30[_0x577fdc(0x25a)](async _0x56b10d=>{const _0x5c8f6e=_0x577fdc,_0x11643a=await this[_0x5c8f6e(0x34f)][_0x5c8f6e(0x2e9)]({'baseURL':_0x20e078[_0x5c8f6e(0x22d)][_0x5c8f6e(0x2cb)],'headers':{'Authorization':_0x5c8f6e(0x262)+_0x20e078['modelInfo'][_0x5c8f6e(0x26d)]},'params':{'id':_0x56b10d[_0x5c8f6e(0x1cb)],'type':_0x5c8f6e(0x3f4)}});_0x11643a[_0x5c8f6e(0x30f)]==_0x5c8f6e(0x1c0)&&_0x11643a['data'][_0x5c8f6e(0x2ed)]&&(_0x56b10d[_0x5c8f6e(0x42a)]=_0x11643a['data'][_0x5c8f6e(0x2ed)],await this['pptTaskEntity'][_0x5c8f6e(0x339)]({'id':_0x56b10d['id']},{'pdfDownUrl':_0x56b10d[_0x5c8f6e(0x42a)]}));});const _0x11fa05=await this[_0x577fdc(0x314)][_0x577fdc(0x391)](_0x577fdc(0x3ad));_0x11fa05[_0x577fdc(0x1da)]&&_0x11fa05[_0x577fdc(0x25a)](async _0x51d9e8=>{const _0x499d7f=_0x577fdc,_0x10b703=await this[_0x499d7f(0x34f)][_0x499d7f(0x2e9)]({'baseURL':_0x20e078[_0x499d7f(0x22d)]['proxyUrl'],'headers':{'Authorization':_0x499d7f(0x262)+_0x20e078[_0x499d7f(0x22d)][_0x499d7f(0x26d)]},'params':{'id':_0x51d9e8[_0x499d7f(0x1cb)],'type':_0x499d7f(0x3d9)}});_0x10b703[_0x499d7f(0x30f)]==_0x499d7f(0x1c0)&&_0x10b703['data']['download_url']&&(_0x51d9e8[_0x499d7f(0x3ea)]=_0x10b703[_0x499d7f(0x3a2)][_0x499d7f(0x2ed)],await this['pptTaskEntity'][_0x499d7f(0x339)]({'id':_0x51d9e8['id']},{'pngDownUrl':_0x51d9e8[_0x499d7f(0x3ea)]}));});try{const _0x1cd90e=store_2[_0x577fdc(0x1f0)][_0x577fdc(0x34a)]||0x5,_0xd67f89=[{'status':0x1,'type':ppt_constant_1['EPPTTaskType'][_0x577fdc(0x411)],'updatedAt':(0x0,typeorm_1['LessThan'])(new Date(Date['now']()-_0x1cd90e*0x3c*0x3e8))}],_0x51c0d3=await this['pptTaskEntity'][_0x577fdc(0x323)]({'where':_0xd67f89});_0x51c0d3[_0x577fdc(0x25a)](async _0x50ce6a=>{const _0x27ae60=_0x577fdc;_0x50ce6a[_0x27ae60(0x35d)]=_0x27ae60(0x37d),_0x50ce6a['status']=0x3,this[_0x27ae60(0x314)][_0x27ae60(0x321)](_0x50ce6a),this[_0x27ae60(0x330)][_0x27ae60(0x20e)](_0x50ce6a[_0x27ae60(0x2d2)],_0x50ce6a['id'],_0x50ce6a[_0x27ae60(0x22b)],!![]);});}catch(_0x16c345){common_1[_0x577fdc(0x1dc)]['error'](_0x16c345);}}};ChatgptService=__decorate([(0x0,common_1[_0x2b172c(0x245)])(),__param(0x0,(0x0,typeorm_2[_0x2b172c(0x334)])(pptTask_entity_1['PPTTaskEntity'])),__metadata('design:paramtypes',[typeorm_1[_0x2b172c(0x206)],nestjs_cls_1['ClsService'],user_service_1[_0x2b172c(0x1c8)],file_service_1[_0x2b172c(0x1e7)],gpts_service_1[_0x2b172c(0x408)],yooPPT_service_1[_0x2b172c(0x412)],doubao_service_1['DoubaoService'],models_service_1[_0x2b172c(0x2f9)],chatLog_service_1[_0x2b172c(0x39a)],lumaTask_service_1[_0x2b172c(0x1e4)],runwayTask_service_1[_0x2b172c(0x1c9)],klingTask_service_1[_0x2b172c(0x1b6)],sunoTask_service_1[_0x2b172c(0x380)],badwords_service_1[_0x2b172c(0x388)],autoreply_service_1[_0x2b172c(0x367)],chatGroup_service_1[_0x2b172c(0x2a2)],globalConfig_service_1[_0x2b172c(0x2f8)],typeorm_1['Connection'],mindTask_service_1[_0x2b172c(0x28b)]])],ChatgptService),exports[_0x2b172c(0x269)]=ChatgptService;