'use strict';const _0x24e075=_0x2dac;(function(_0x48c691,_0x307b0b){const _0x1636c2=_0x2dac,_0x552675=_0x48c691();while(!![]){try{const _0x1081ba=-parseInt(_0x1636c2(0x1f2))/0x1+parseInt(_0x1636c2(0x215))/0x2*(-parseInt(_0x1636c2(0x211))/0x3)+parseInt(_0x1636c2(0x213))/0x4*(parseInt(_0x1636c2(0x1fd))/0x5)+-parseInt(_0x1636c2(0x1e2))/0x6+-parseInt(_0x1636c2(0x202))/0x7*(-parseInt(_0x1636c2(0x1ec))/0x8)+-parseInt(_0x1636c2(0x210))/0x9*(-parseInt(_0x1636c2(0x1ef))/0xa)+parseInt(_0x1636c2(0x20f))/0xb;if(_0x1081ba===_0x307b0b)break;else _0x552675['push'](_0x552675['shift']());}catch(_0x2fb81b){_0x552675['push'](_0x552675['shift']());}}}(_0x41ca,0xe00ae));function _0x41ca(){const _0x40db68=['defineProperty','round','choices','error:\x20','compilerMetaJsonStr','165hCqVBq','/v1/chat/completions','stream','created','data:\x20','12467eqPAfT','application/json','generateToken','event:','compilerStream','length','data','toString','id:','[DONE]','HS256','now','sendMessageFromZhipu','7263960XwvTcQ','9EhoToN','9QjfYub','json\x20parse\x20error\x20from\x20zhipu!','5436QnxaMt','chat.completion.chunk','442478igZqII','is_end','assistant','filter','parse','text','---------------FASTMessageHistory','catch','2351706WlGcxY','model','jsonwebtoken','usage','---------------FASTMessage','delta','data:','meta:','trim','replace','2680PjvMwE','error','sendMessageFromFastgpt','12023270bopYZa','indexOf','split','530823KuMGof','then','__esModule','forEach','log','POST'];_0x41ca=function(){return _0x40db68;};return _0x41ca();}Object[_0x24e075(0x1f8)](exports,_0x24e075(0x1f4),{'value':!![]}),exports[_0x24e075(0x1ee)]=exports[_0x24e075(0x20e)]=exports[_0x24e075(0x206)]=exports[_0x24e075(0x1fc)]=exports[_0x24e075(0x204)]=void 0x0;function _0x2dac(_0x51cf3b,_0x15d8dc){const _0x41cac0=_0x41ca();return _0x2dac=function(_0x2dacae,_0x1759f1){_0x2dacae=_0x2dacae-0x1dd;let _0x3556ea=_0x41cac0[_0x2dacae];return _0x3556ea;},_0x2dac(_0x51cf3b,_0x15d8dc);}const axios=require('axios'),jwt=require(_0x24e075(0x1e4));function generateToken(_0x27670e,_0x472be2=0x3e8*0x3c*0x3c*0x18*0x168){const _0x206f82=_0x24e075,[_0xe6b537,_0x5a4089]=_0x27670e[_0x206f82(0x1f1)]('.'),_0x3741f2={'api_key':_0xe6b537,'exp':Math['round'](Date[_0x206f82(0x20d)]())+_0x472be2*0x3e8,'timestamp':Math[_0x206f82(0x1f9)](Date[_0x206f82(0x20d)]())};return jwt['sign'](_0x3741f2,_0x5a4089,{'algorithm':_0x206f82(0x20c),'header':{'alg':_0x206f82(0x20c),'sign_type':'SIGN'}});}exports[_0x24e075(0x204)]=generateToken;function compilerMetaJsonStr(_0x33a7fd){const _0x132b98=_0x24e075;let _0x3f87eb={};try{_0x3f87eb=JSON['parse'](_0x33a7fd);}catch(_0x3d744c){_0x3f87eb={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x132b98(0x1ed)](_0x132b98(0x212),_0x33a7fd);}return _0x3f87eb;}exports[_0x24e075(0x1fc)]=compilerMetaJsonStr;function compilerStream(_0x314fb5){const _0x58f2a7=_0x24e075;console['log'](_0x314fb5);if(_0x314fb5[_0x58f2a7(0x207)]===0x3)return{'event':_0x314fb5[0x0][_0x58f2a7(0x1eb)]('event:',''),'id':_0x314fb5[0x1]['replace'](_0x58f2a7(0x20a),''),'is_end':![],'result':_0x314fb5[0x2][_0x58f2a7(0x1eb)](_0x58f2a7(0x1e8),'')['trim']()};if(_0x314fb5[_0x58f2a7(0x207)]===0x4)return{'event':_0x314fb5[0x0][_0x58f2a7(0x1eb)](_0x58f2a7(0x205),''),'id':_0x314fb5[0x1][_0x58f2a7(0x1eb)]('id:',''),'result':_0x314fb5[0x2]['replace']('data:','')['trim'](),'is_end':!![],'usage':compilerMetaJsonStr(_0x314fb5[0x3][_0x58f2a7(0x1eb)](_0x58f2a7(0x1e9),''))?.[_0x58f2a7(0x1e5)]};}exports['compilerStream']=compilerStream;async function sendMessageFromZhipu(_0x4c714c,{onProgress:_0x23ca2d,key:_0x1486f7,model:_0xc6cbb2,temperature:temperature=0.95}){const _0x5a68b8=await generateToken(_0x1486f7);return new Promise((_0x4248a4,_0x2067ec)=>{const _0x289fd8=_0x2dac,_0x1db2a9='https://open.bigmodel.cn/api/paas/v4/chat/completions',_0x1d3242={'method':_0x289fd8(0x1f7),'url':_0x1db2a9,'responseType':_0x289fd8(0x1ff),'headers':{'Content-Type':_0x289fd8(0x203),'Authorization':_0x5a68b8},'data':{'model':_0xc6cbb2,'messages':_0x4c714c,'temperature':temperature,'stream':!![]}};axios(_0x1d3242)[_0x289fd8(0x1f3)](_0x30b320=>{const _0x775451=_0x289fd8,_0x2250df=_0x30b320[_0x775451(0x208)];let _0x49ec8a,_0x199c75='';_0x2250df['on'](_0x775451(0x208),_0x4a4a89=>{const _0x213bff=_0x775451,_0x5943a9=_0x4a4a89[_0x213bff(0x209)]()[_0x213bff(0x1f1)]('\x0a')[_0x213bff(0x1dd)](_0x5b82d8=>_0x5b82d8[_0x213bff(0x1ea)]()!==''),_0x2c8610=_0x5943a9;console[_0x213bff(0x1f6)](_0x2c8610);if(!_0x2c8610)return;let _0x18fc2a=![],_0x412221='',_0x43ad89='',_0x8d3139='',_0x472342=null;_0x2c8610[_0x213bff(0x1f5)](_0x1b9df8=>{const _0x255384=_0x213bff;if(_0x1b9df8[_0x255384(0x1f0)]('[DONE]')>-0x1)_0x18fc2a=!![];else{const _0x5e1374=JSON['parse'](_0x1b9df8[_0x255384(0x1eb)](_0x255384(0x201),''));_0x412221=_0x5e1374['id'],_0x43ad89=_0x5e1374[_0x255384(0x200)],_0x8d3139=_0x5e1374[_0x255384(0x1e3)],_0x5e1374['usage']&&(_0x472342=_0x5e1374[_0x255384(0x1e5)]),_0x5e1374[_0x255384(0x1fa)][_0x255384(0x1f5)](_0xd5372a=>{_0x199c75+=_0xd5372a['delta']['content'];});}});let _0x4796cd={'role':'assistant','id':_0x412221,'text':_0x199c75,'delta':_0x199c75,'detail':{'choices':[{'delta':{'content':_0x199c75,'role':_0x213bff(0x217)},'index':0x0}],'created':_0x43ad89,'id':_0x412221,'model':_0x8d3139,'object':'chat.completion.chunk','usage':_0x472342}};_0x18fc2a&&(_0x4796cd[_0x213bff(0x216)]=![],_0x49ec8a=_0x4796cd,_0x49ec8a[_0x213bff(0x1df)]=_0x199c75),_0x23ca2d(_0x4796cd);}),_0x2250df['on']('end',()=>{_0x4248a4(_0x49ec8a),_0x199c75='';});})[_0x289fd8(0x1e1)](_0x2a12e4=>{console['log']('error:\x20',_0x2a12e4);});});}exports[_0x24e075(0x20e)]=sendMessageFromZhipu;async function sendMessageFromFastgpt(_0x26acf1,{chatId:_0x578275,onProgress:_0xa1241c,key:_0x56be68,model:_0x4d7272,apiUrl:_0x3fa54d}){return new Promise((_0x3c811e,_0x3bc2c3)=>{const _0x31c255=_0x2dac,_0x56c2c4=_0x3fa54d+_0x31c255(0x1fe),_0x4b85f5={'method':'POST','url':_0x56c2c4,'responseType':_0x31c255(0x1ff),'headers':{'Content-Type':_0x31c255(0x203),'Authorization':'Bearer\x20'+_0x56be68},'data':{'model':_0x4d7272,'detail':![],'messages':_0x26acf1,'stream':!![]}};console[_0x31c255(0x1f6)](_0x31c255(0x1e0),_0x26acf1),axios(_0x4b85f5)[_0x31c255(0x1f3)](_0x58615b=>{const _0x18f166=_0x31c255,_0x5870b3=_0x58615b[_0x18f166(0x208)];let _0xdac996,_0x2100b1='';_0x5870b3['on'](_0x18f166(0x208),_0x458a92=>{const _0x53073e=_0x18f166,_0x327415=_0x458a92[_0x53073e(0x209)]()['split']('\x0a')[_0x53073e(0x1dd)](_0x1d29bf=>_0x1d29bf['trim']()!==''),_0x38482b=_0x327415;console['log'](_0x53073e(0x1e6),_0x38482b);if(!_0x38482b)return;let _0x1ba4ec=![],_0x4d472c=_0x578275,_0xc1e582='',_0x32ae74='',_0x1838da=null;_0x38482b[_0x53073e(0x1f5)](_0x31fecf=>{const _0x319c56=_0x53073e;if(_0x31fecf['indexOf'](_0x319c56(0x20b))>-0x1)_0x1ba4ec=!![];else{const _0x21de57=JSON[_0x319c56(0x1de)](_0x31fecf[_0x319c56(0x1eb)](_0x319c56(0x201),''));_0x21de57['choices']&&(_0xc1e582=_0x21de57['created'],_0x32ae74=_0x21de57[_0x319c56(0x1e3)],_0x21de57['usage']&&(_0x1838da=_0x21de57['usage']),_0x21de57[_0x319c56(0x1fa)][_0x319c56(0x1f5)](_0x3a8cdb=>{const _0x354f6d=_0x319c56;_0x3a8cdb[_0x354f6d(0x1e7)]['content']&&(_0x2100b1+=_0x3a8cdb[_0x354f6d(0x1e7)]['content']);}));}});let _0x4fa012={'role':_0x53073e(0x217),'id':_0x4d472c,'text':_0x2100b1,'delta':_0x2100b1,'detail':{'choices':[{'delta':{'content':_0x2100b1,'role':'assistant'},'index':0x0}],'created':_0xc1e582,'id':_0x4d472c,'model':_0x32ae74,'object':_0x53073e(0x214),'usage':_0x1838da}};_0x1ba4ec&&(_0x4fa012[_0x53073e(0x216)]=![],_0xdac996=_0x4fa012,_0xdac996['text']=_0x2100b1),_0xa1241c(_0x4fa012);}),_0x5870b3['on']('end',()=>{_0x3c811e(_0xdac996),_0x2100b1='';});})[_0x31c255(0x1e1)](_0x131d6f=>{const _0x4abb6f=_0x31c255;console[_0x4abb6f(0x1f6)](_0x4abb6f(0x1fb),_0x131d6f);});});}exports[_0x24e075(0x1ee)]=sendMessageFromFastgpt;