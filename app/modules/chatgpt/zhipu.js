'use strict';const _0x2034ce=_0x3e46;(function(_0x2a1549,_0x24fb85){const _0x48d83e=_0x3e46,_0x12ef09=_0x2a1549();while(!![]){try{const _0x4a9287=parseInt(_0x48d83e(0x71))/0x1*(-parseInt(_0x48d83e(0x7a))/0x2)+parseInt(_0x48d83e(0x67))/0x3+parseInt(_0x48d83e(0x76))/0x4*(parseInt(_0x48d83e(0x6f))/0x5)+parseInt(_0x48d83e(0x7d))/0x6+parseInt(_0x48d83e(0x80))/0x7+-parseInt(_0x48d83e(0x74))/0x8+parseInt(_0x48d83e(0x72))/0x9;if(_0x4a9287===_0x24fb85)break;else _0x12ef09['push'](_0x12ef09['shift']());}catch(_0xf3114f){_0x12ef09['push'](_0x12ef09['shift']());}}}(_0x5de9,0x2acda));function _0x3e46(_0x166d4b,_0x4c6484){const _0x5de995=_0x5de9();return _0x3e46=function(_0x3e46ef,_0x397886){_0x3e46ef=_0x3e46ef-0x66;let _0x2d98e9=_0x5de995[_0x3e46ef];return _0x2d98e9;},_0x3e46(_0x166d4b,_0x4c6484);}Object[_0x2034ce(0x6d)](exports,_0x2034ce(0x69),{'value':!![]}),exports['sendMessageFromZhipu']=exports['compilerStream']=exports[_0x2034ce(0x8e)]=exports[_0x2034ce(0x84)]=void 0x0;const axios=require(_0x2034ce(0x66)),jwt=require(_0x2034ce(0x87));function generateToken(_0x3289c8,_0x470b17=0x3e8*0x3c*0x3c*0x18*0x168){const _0x418a94=_0x2034ce,[_0xeebf5e,_0x1e3bb0]=_0x3289c8[_0x418a94(0x88)]('.'),_0x48a50f={'api_key':_0xeebf5e,'exp':Math[_0x418a94(0x8d)](Date[_0x418a94(0x7f)]())+_0x470b17*0x3e8,'timestamp':Math[_0x418a94(0x8d)](Date['now']())};return jwt[_0x418a94(0x7c)](_0x48a50f,_0x1e3bb0,{'algorithm':_0x418a94(0x6e),'header':{'alg':_0x418a94(0x6e),'sign_type':_0x418a94(0x8b)}});}exports[_0x2034ce(0x84)]=generateToken;function compilerMetaJsonStr(_0x148c7d){const _0x44bd86=_0x2034ce;let _0x4ed22c={};try{_0x4ed22c=JSON[_0x44bd86(0x89)](_0x148c7d);}catch(_0x2bdf93){_0x4ed22c={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x44bd86(0x77)](_0x44bd86(0x6c),_0x148c7d);}return _0x4ed22c;}exports['compilerMetaJsonStr']=compilerMetaJsonStr;function compilerStream(_0x41325b){const _0x4da86e=_0x2034ce;console[_0x4da86e(0x81)](_0x41325b);if(_0x41325b[_0x4da86e(0x82)]===0x3)return{'event':_0x41325b[0x0][_0x4da86e(0x8c)]('event:',''),'id':_0x41325b[0x1][_0x4da86e(0x8c)](_0x4da86e(0x91),''),'is_end':![],'result':_0x41325b[0x2][_0x4da86e(0x8c)](_0x4da86e(0x83),'')[_0x4da86e(0x68)]()};if(_0x41325b[_0x4da86e(0x82)]===0x4)return{'event':_0x41325b[0x0][_0x4da86e(0x8c)](_0x4da86e(0x70),''),'id':_0x41325b[0x1][_0x4da86e(0x8c)](_0x4da86e(0x91),''),'result':_0x41325b[0x2][_0x4da86e(0x8c)](_0x4da86e(0x83),'')[_0x4da86e(0x68)](),'is_end':!![],'usage':compilerMetaJsonStr(_0x41325b[0x3][_0x4da86e(0x8c)](_0x4da86e(0x7b),''))?.[_0x4da86e(0x85)]};}exports[_0x2034ce(0x90)]=compilerStream;async function sendMessageFromZhipu(_0x3afd21,{onProgress:_0x3fda8b,key:_0x2340c3,model:_0x3fadbd,temperature:temperature=0.95}){const _0x1d78ae=await generateToken(_0x2340c3);return new Promise((_0x48e55f,_0x22262a)=>{const _0x16cf79=_0x3e46,_0x10683a=_0x16cf79(0x7e)+_0x3fadbd+_0x16cf79(0x78),_0x245b53={'method':_0x16cf79(0x8f),'url':_0x10683a,'responseType':'stream','headers':{'Content-Type':_0x16cf79(0x75),'Authorization':_0x1d78ae},'data':{'prompt':_0x3afd21,'temperature':temperature}};axios(_0x245b53)['then'](_0x3eb842=>{const _0x5c4914=_0x16cf79,_0x3ebe1f=_0x3eb842[_0x5c4914(0x8a)];let _0x47b88c,_0x2215db='';_0x3ebe1f['on']('data',_0x29ba92=>{const _0x174806=_0x5c4914,_0x2bdc0c=_0x29ba92['toString']()['split']('\x0a')[_0x174806(0x73)](_0x69a508=>_0x69a508[_0x174806(0x68)]()!=='');console[_0x174806(0x81)](_0x2bdc0c);const _0x56fb27=compilerStream(_0x2bdc0c);console['log'](_0x56fb27);if(!_0x56fb27)return;const {id:_0x5e5c8f,result:_0x26c223,is_end:_0x17c1a9}=_0x56fb27;_0x26c223&&(_0x2215db+=_0x26c223[_0x174806(0x68)]()),_0x17c1a9&&(_0x56fb27['is_end']=![],_0x47b88c=_0x56fb27,_0x47b88c[_0x174806(0x86)]=_0x2215db),_0x3fda8b(_0x56fb27);}),_0x3ebe1f['on'](_0x5c4914(0x6a),()=>{_0x48e55f(_0x47b88c),_0x2215db='';});})['catch'](_0x3354a3=>{const _0x1c1fb8=_0x16cf79;console[_0x1c1fb8(0x81)](_0x1c1fb8(0x79),_0x3354a3);});});}function _0x5de9(){const _0x3961b7=['data','SIGN','replace','round','compilerMetaJsonStr','POST','compilerStream','id:','axios','152403vcTGDB','trim','__esModule','end','sendMessageFromZhipu','json\x20parse\x20error\x20from\x20zhipu!','defineProperty','HS256','1905AsGcRs','event:','87EWzrUX','911529cxsPzW','filter','2516224ADqlOK','application/json','2320ArAHmK','error','/sse-invoke','error:\x20','5386EgxOhq','meta:','sign','1574634wrThYj','https://open.bigmodel.cn/api/paas/v3/model-api/','now','620480gRiJpA','log','length','data:','generateToken','usage','text','jsonwebtoken','split','parse'];_0x5de9=function(){return _0x3961b7;};return _0x5de9();}exports[_0x2034ce(0x6b)]=sendMessageFromZhipu;