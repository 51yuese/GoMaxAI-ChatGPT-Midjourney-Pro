'use strict';function _0x439e(_0x3dc0ea,_0x267035){const _0xc20012=_0xc200();return _0x439e=function(_0x439e5f,_0x3062cd){_0x439e5f=_0x439e5f-0x65;let _0x400f66=_0xc20012[_0x439e5f];return _0x400f66;},_0x439e(_0x3dc0ea,_0x267035);}const _0x485949=_0x439e;(function(_0x5d9105,_0x252e27){const _0x3ef05e=_0x439e,_0x512039=_0x5d9105();while(!![]){try{const _0x5efc36=parseInt(_0x3ef05e(0x74))/0x1+parseInt(_0x3ef05e(0x91))/0x2+-parseInt(_0x3ef05e(0x75))/0x3+parseInt(_0x3ef05e(0x7f))/0x4+-parseInt(_0x3ef05e(0x83))/0x5*(parseInt(_0x3ef05e(0x98))/0x6)+-parseInt(_0x3ef05e(0x73))/0x7+-parseInt(_0x3ef05e(0x8e))/0x8*(-parseInt(_0x3ef05e(0x6b))/0x9);if(_0x5efc36===_0x252e27)break;else _0x512039['push'](_0x512039['shift']());}catch(_0xcc7fc7){_0x512039['push'](_0x512039['shift']());}}}(_0xc200,0x5132a));Object[_0x485949(0x9f)](exports,_0x485949(0x66),{'value':!![]}),exports['sendDifyMessage']=exports[_0x485949(0x76)]=exports['sendMessageFromZhipu']=exports[_0x485949(0x8b)]=exports[_0x485949(0xa0)]=exports[_0x485949(0x84)]=void 0x0;const axios=require('axios'),jwt=require(_0x485949(0x8c));function generateToken(_0x5cb544,_0x1e6011=0x3e8*0x3c*0x3c*0x18*0x168){const _0x1d0b26=_0x485949,[_0x5c902d,_0x401c0b]=_0x5cb544[_0x1d0b26(0x79)]('.'),_0x14dc01={'api_key':_0x5c902d,'exp':Math[_0x1d0b26(0x93)](Date[_0x1d0b26(0xa6)]())+_0x1e6011*0x3e8,'timestamp':Math['round'](Date[_0x1d0b26(0xa6)]())};return jwt[_0x1d0b26(0x96)](_0x14dc01,_0x401c0b,{'algorithm':_0x1d0b26(0x92),'header':{'alg':_0x1d0b26(0x92),'sign_type':'SIGN'}});}exports[_0x485949(0x84)]=generateToken;function compilerMetaJsonStr(_0x306400){const _0x264735=_0x485949;let _0x1deb14={};try{_0x1deb14=JSON[_0x264735(0x72)](_0x306400);}catch(_0x55e4e8){_0x1deb14={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x264735(0x71)](_0x264735(0x9d),_0x306400);}return _0x1deb14;}exports[_0x485949(0xa0)]=compilerMetaJsonStr;function compilerStream(_0x2c79a4){const _0x13d2b9=_0x485949;console[_0x13d2b9(0xa3)](_0x2c79a4);if(_0x2c79a4[_0x13d2b9(0x78)]===0x3)return{'event':_0x2c79a4[0x0][_0x13d2b9(0x6f)](_0x13d2b9(0x9e),''),'id':_0x2c79a4[0x1][_0x13d2b9(0x6f)]('id:',''),'is_end':![],'result':_0x2c79a4[0x2][_0x13d2b9(0x6f)](_0x13d2b9(0x6c),'')['trim']()};if(_0x2c79a4[_0x13d2b9(0x78)]===0x4)return{'event':_0x2c79a4[0x0][_0x13d2b9(0x6f)](_0x13d2b9(0x9e),''),'id':_0x2c79a4[0x1][_0x13d2b9(0x6f)](_0x13d2b9(0x89),''),'result':_0x2c79a4[0x2][_0x13d2b9(0x6f)](_0x13d2b9(0x6c),'')[_0x13d2b9(0x86)](),'is_end':!![],'usage':compilerMetaJsonStr(_0x2c79a4[0x3][_0x13d2b9(0x6f)]('meta:',''))?.['usage']};}exports[_0x485949(0x8b)]=compilerStream;function _0xc200(){const _0x308653=['sendDifyMessage','content','1085820HQuYkK','text/event-stream','usage','toString','1630135TxkRss','generateToken','catch','trim','data','application/json','id:','streaming','compilerStream','jsonwebtoken','stream','16OtaRmC','created_at','Error\x20parsing\x20stream\x20chunk:','913824SWhvxy','HS256','round','message_id','created','sign','/chat-messages','6TPdqKj','data:\x20','Bearer\x20','assistant','filter','json\x20parse\x20error\x20from\x20zhipu!','event:','defineProperty','compilerMetaJsonStr','end','Stream\x20error:','log','is_end','failed','now','stringify','model','chat.completion.chunk','__esModule','indexOf','answer','startsWith','[DONE]','1597977SQnoIm','data:','then','https://open.bigmodel.cn/api/paas/v4/chat/completions','replace','forEach','error','parse','2612946pqnQVk','334774tJXsQK','1159068cYFiEb','sendMessageFromFastgpt','text','length','split','choices','Axios\x20error:','delta'];_0xc200=function(){return _0x308653;};return _0xc200();}async function sendMessageFromZhipu(_0x4d7cb8,{onProgress:_0x2f9841,key:_0xdc2d36,model:_0x5a0c8a,temperature:temperature=0.95}){const _0x4cbb06=await generateToken(_0xdc2d36);return new Promise((_0x5568b9,_0xed475f)=>{const _0x461ada=_0x439e,_0x28e17d=_0x461ada(0x6e),_0x3d8f6a={'method':'POST','url':_0x28e17d,'responseType':_0x461ada(0x8d),'headers':{'Content-Type':_0x461ada(0x88),'Authorization':_0x4cbb06},'data':{'model':_0x5a0c8a,'messages':_0x4d7cb8,'temperature':temperature,'stream':!![]}};axios(_0x3d8f6a)[_0x461ada(0x6d)](_0x242372=>{const _0x5381c0=_0x461ada,_0x456476=_0x242372[_0x5381c0(0x87)];let _0x5cca43,_0x3dc683='';_0x456476['on'](_0x5381c0(0x87),_0x3ebe9b=>{const _0x102f44=_0x5381c0,_0x216873=_0x3ebe9b[_0x102f44(0x82)]()[_0x102f44(0x79)]('\x0a')[_0x102f44(0x9c)](_0x213e32=>_0x213e32[_0x102f44(0x86)]()!==''),_0x236f2e=_0x216873;console['log'](_0x236f2e);if(!_0x236f2e)return;let _0x3859a2=![],_0x2489a4='',_0xfd5654='',_0x57cf30='',_0x53bdad=null;_0x236f2e[_0x102f44(0x70)](_0x2450ce=>{const _0x96c2c=_0x102f44;if(_0x2450ce[_0x96c2c(0x67)](_0x96c2c(0x6a))>-0x1)_0x3859a2=!![];else{const _0xa4139d=JSON[_0x96c2c(0x72)](_0x2450ce[_0x96c2c(0x6f)](_0x96c2c(0x99),''));_0x2489a4=_0xa4139d['id'],_0xfd5654=_0xa4139d[_0x96c2c(0x95)],_0x57cf30=_0xa4139d['model'],_0xa4139d[_0x96c2c(0x81)]&&(_0x53bdad=_0xa4139d[_0x96c2c(0x81)]),_0xa4139d[_0x96c2c(0x7a)]['forEach'](_0x16dd1c=>{const _0x382ba=_0x96c2c;_0x3dc683+=_0x16dd1c[_0x382ba(0x7c)][_0x382ba(0x7e)];});}});let _0x23fb6b={'role':_0x102f44(0x9b),'id':_0x2489a4,'text':_0x3dc683,'delta':_0x3dc683,'detail':{'choices':[{'delta':{'content':_0x3dc683,'role':_0x102f44(0x9b)},'index':0x0}],'created':_0xfd5654,'id':_0x2489a4,'model':_0x57cf30,'object':'chat.completion.chunk','usage':_0x53bdad}};_0x3859a2&&(_0x23fb6b[_0x102f44(0xa4)]=![],_0x5cca43=_0x23fb6b,_0x5cca43[_0x102f44(0x77)]=_0x3dc683),_0x2f9841(_0x23fb6b);}),_0x456476['on']('end',()=>{_0x5568b9(_0x5cca43),_0x3dc683='';});})[_0x461ada(0x85)](_0x43f582=>{console['log']('error:\x20',_0x43f582);});});}exports['sendMessageFromZhipu']=sendMessageFromZhipu;async function sendMessageFromFastgpt(_0x59d5be,{chatId:_0x53945d,onProgress:_0x3d122f,key:_0xc82e7e,model:_0x3570d4,apiUrl:_0x4d455e}){return new Promise((_0x5ddd7b,_0x1adc23)=>{const _0x3da959=_0x439e,_0x30aa90=_0x4d455e+'/chat/completions',_0x580a85={'method':'POST','url':_0x30aa90,'responseType':_0x3da959(0x8d),'headers':{'Content-Type':_0x3da959(0x88),'Authorization':_0x3da959(0x9a)+_0xc82e7e},'data':{'model':_0x3570d4,'detail':![],'messages':_0x59d5be,'stream':!![]}};axios(_0x580a85)[_0x3da959(0x6d)](_0x502561=>{const _0x32ae33=_0x3da959,_0x41d529=_0x502561[_0x32ae33(0x87)];let _0xfa3a3e='',_0x31cfbb=null;_0x41d529['on'](_0x32ae33(0x87),_0x278197=>{const _0x12bdea=_0x32ae33;try{const _0x1acf47=_0x278197[_0x12bdea(0x82)]()[_0x12bdea(0x79)]('\x0a')[_0x12bdea(0x9c)](_0x1bdcf7=>_0x1bdcf7[_0x12bdea(0x86)]()['startsWith'](_0x12bdea(0x99)));for(const _0x47daa3 of _0x1acf47){const _0x7edbe1=_0x47daa3[_0x12bdea(0x6f)](_0x12bdea(0x99),'')[_0x12bdea(0x86)]();if(_0x7edbe1===_0x12bdea(0x6a)){_0x31cfbb&&(_0x31cfbb['is_end']=![],_0x31cfbb[_0x12bdea(0x77)]=_0xfa3a3e);continue;}const _0xdf8abb=JSON[_0x12bdea(0x72)](_0x7edbe1);if(_0xdf8abb[_0x12bdea(0x7a)]&&_0xdf8abb[_0x12bdea(0x7a)]['length']>0x0){const _0x297500=_0xdf8abb['choices'][0x0],_0x5b8fb8=_0x297500[_0x12bdea(0x7c)]['content']||'';_0xfa3a3e+=_0x5b8fb8;const _0x26ce68={'role':'assistant','id':_0x53945d,'text':_0xfa3a3e,'delta':_0x5b8fb8,'detail':{'choices':[{'delta':{'content':_0x5b8fb8,'role':_0x12bdea(0x9b)},'index':0x0}],'created':_0xdf8abb[_0x12bdea(0x95)],'id':_0xdf8abb['id']||_0x53945d,'model':_0xdf8abb[_0x12bdea(0xa8)],'object':_0x12bdea(0x65),'usage':_0xdf8abb[_0x12bdea(0x81)]}};_0x31cfbb=_0x26ce68,_0x3d122f(_0x26ce68);}}}catch(_0x5ea9bd){console[_0x12bdea(0x71)](_0x12bdea(0x90),_0x5ea9bd);}}),_0x41d529['on']('end',()=>{_0x5ddd7b(_0x31cfbb),_0xfa3a3e='';}),_0x41d529['on'](_0x32ae33(0x71),_0x1d7f18=>{const _0x40ded=_0x32ae33;console['error'](_0x40ded(0xa2),_0x1d7f18),_0x1adc23(_0x1d7f18);});})[_0x3da959(0x85)](_0x29876=>{const _0x3155ec=_0x3da959;console[_0x3155ec(0x71)]('Axios\x20error:',_0x29876),_0x1adc23(_0x29876);});});}exports[_0x485949(0x76)]=sendMessageFromFastgpt;async function sendDifyMessage(_0x1eb6a0){const {chatId:_0x5a88d3,onProgress:_0x2d4ab8,apiKey:_0x1e8e85,apiUrl:_0x2805c3,query:_0x12093,inputs:inputs={},userId:userId='user'}=_0x1eb6a0;return new Promise((_0x17488d,_0x48a60)=>{const _0x4b6216=_0x439e,_0x1cfe67=_0x2805c3+_0x4b6216(0x97),_0x364a61=JSON[_0x4b6216(0xa7)]({'inputs':inputs,'query':_0x12093,'response_mode':_0x4b6216(0x8a),'user':userId,..._0x5a88d3?{'conversation_id':_0x5a88d3}:{},'auto_generate_name':!![]}),_0x437896={'method':'POST','url':_0x1cfe67,'responseType':'stream','headers':{'Authorization':_0x4b6216(0x9a)+_0x1e8e85,'Content-Type':_0x4b6216(0x88),'Accept':_0x4b6216(0x80)},'data':_0x364a61};axios(_0x437896)[_0x4b6216(0x6d)](_0x56fbfb=>{const _0x20ce7e=_0x4b6216,_0xbe299c=_0x56fbfb[_0x20ce7e(0x87)];let _0x52c39f='',_0x31137f=null;_0xbe299c['on'](_0x20ce7e(0x87),_0x454298=>{const _0x3284bc=_0x20ce7e;try{const _0x402a80=_0x454298[_0x3284bc(0x82)]()[_0x3284bc(0x79)]('\x0a')['filter'](_0x4656b5=>_0x4656b5['trim']()[_0x3284bc(0x69)](_0x3284bc(0x99)));for(const _0x216c87 of _0x402a80){const _0x2218dd=_0x216c87[_0x3284bc(0x6f)](_0x3284bc(0x99),'')[_0x3284bc(0x86)]();if(_0x2218dd===_0x3284bc(0x6a)){_0x31137f&&(_0x31137f[_0x3284bc(0xa4)]=![],_0x31137f[_0x3284bc(0x77)]=_0x52c39f);continue;}const _0x27d9ff=JSON[_0x3284bc(0x72)](_0x2218dd);if(_0x27d9ff['event']==_0x3284bc(0x71)||_0x27d9ff['event']==_0x3284bc(0xa5)){_0x31137f[_0x3284bc(0xa4)]=!![],_0x31137f[_0x3284bc(0x77)]=_0x52c39f;continue;}const _0x48ef71=_0x27d9ff[_0x3284bc(0x68)]||'';_0x52c39f+=_0x48ef71;const _0x5f0399={'role':_0x3284bc(0x9b),'id':_0x27d9ff['conversation_id'],'text':_0x52c39f,'delta':_0x48ef71,'detail':{'choices':[{'delta':{'content':_0x48ef71,'role':_0x3284bc(0x9b)},'index':0x0}],'created':_0x27d9ff[_0x3284bc(0x8f)],'id':_0x27d9ff[_0x3284bc(0x94)]||_0x5a88d3,'object':_0x3284bc(0x65),'usage':_0x27d9ff['metadata']?.['usage']}};_0x31137f=_0x5f0399,_0x2d4ab8(_0x5f0399);}}catch(_0x1de90a){console[_0x3284bc(0x71)](_0x3284bc(0x90),_0x1de90a);}}),_0xbe299c['on'](_0x20ce7e(0xa1),()=>{_0x17488d(_0x31137f),_0x52c39f='';}),_0xbe299c['on'](_0x20ce7e(0x71),_0xc92db2=>{const _0xe7d534=_0x20ce7e;console[_0xe7d534(0x71)](_0xe7d534(0xa2),_0xc92db2),_0x48a60(_0xc92db2);});})[_0x4b6216(0x85)](_0x24ad89=>{const _0x1a5bcc=_0x4b6216;console['error'](_0x1a5bcc(0x7b),_0x24ad89),_0x48a60(_0x24ad89);});});}exports[_0x485949(0x7d)]=sendDifyMessage;