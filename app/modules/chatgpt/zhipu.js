'use strict';const _0x246e9a=_0x55a4;(function(_0x3cceb0,_0x26435f){const _0x2faf03=_0x55a4,_0x28c725=_0x3cceb0();while(!![]){try{const _0x24c0fa=parseInt(_0x2faf03(0xcd))/0x1+parseInt(_0x2faf03(0xbe))/0x2+-parseInt(_0x2faf03(0xc9))/0x3+-parseInt(_0x2faf03(0xe1))/0x4*(parseInt(_0x2faf03(0xd7))/0x5)+parseInt(_0x2faf03(0xd0))/0x6+-parseInt(_0x2faf03(0xd9))/0x7*(-parseInt(_0x2faf03(0xbb))/0x8)+parseInt(_0x2faf03(0xcc))/0x9;if(_0x24c0fa===_0x26435f)break;else _0x28c725['push'](_0x28c725['shift']());}catch(_0x244c26){_0x28c725['push'](_0x28c725['shift']());}}}(_0x5020,0xd3996));Object[_0x246e9a(0xd4)](exports,'__esModule',{'value':!![]}),exports[_0x246e9a(0xc2)]=exports[_0x246e9a(0xe0)]=exports[_0x246e9a(0xbf)]=exports[_0x246e9a(0xe2)]=void 0x0;const axios=require(_0x246e9a(0xcf)),jwt=require(_0x246e9a(0xba));function generateToken(_0x585e31,_0x4347a9=0x3e8*0x3c*0x3c*0x18*0x168){const _0x22b339=_0x246e9a,[_0x3b4f0f,_0x96eab8]=_0x585e31['split']('.'),_0x217b83={'api_key':_0x3b4f0f,'exp':Math['round'](Date[_0x22b339(0xda)]())+_0x4347a9*0x3e8,'timestamp':Math[_0x22b339(0xdf)](Date[_0x22b339(0xda)]())};return jwt[_0x22b339(0xc7)](_0x217b83,_0x96eab8,{'algorithm':'HS256','header':{'alg':_0x22b339(0xd1),'sign_type':_0x22b339(0xd3)}});}exports[_0x246e9a(0xe2)]=generateToken;function compilerMetaJsonStr(_0x55d078){const _0x563960=_0x246e9a;let _0x5e7cbe={};try{_0x5e7cbe=JSON[_0x563960(0xce)](_0x55d078);}catch(_0x1e1330){_0x5e7cbe={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x563960(0xdb)]('json\x20parse\x20error\x20from\x20zhipu!',_0x55d078);}return _0x5e7cbe;}exports['compilerMetaJsonStr']=compilerMetaJsonStr;function compilerStream(_0x5b37a6){const _0x292084=_0x246e9a;console[_0x292084(0xc1)](_0x5b37a6);if(_0x5b37a6[_0x292084(0xbc)]===0x3)return{'event':_0x5b37a6[0x0][_0x292084(0xd2)](_0x292084(0xc6),''),'id':_0x5b37a6[0x1][_0x292084(0xd2)](_0x292084(0xdd),''),'is_end':![],'result':_0x5b37a6[0x2][_0x292084(0xd2)](_0x292084(0xca),'')[_0x292084(0xc8)]()};if(_0x5b37a6['length']===0x4)return{'event':_0x5b37a6[0x0][_0x292084(0xd2)](_0x292084(0xc6),''),'id':_0x5b37a6[0x1][_0x292084(0xd2)](_0x292084(0xdd),''),'result':_0x5b37a6[0x2][_0x292084(0xd2)]('data:','')['trim'](),'is_end':!![],'usage':compilerMetaJsonStr(_0x5b37a6[0x3][_0x292084(0xd2)](_0x292084(0xdc),''))?.['usage']};}function _0x55a4(_0x51d8e3,_0x1a2b1d){const _0x502013=_0x5020();return _0x55a4=function(_0x55a40a,_0x330b95){_0x55a40a=_0x55a40a-0xba;let _0x2a08ff=_0x502013[_0x55a40a];return _0x2a08ff;},_0x55a4(_0x51d8e3,_0x1a2b1d);}exports[_0x246e9a(0xe0)]=compilerStream;function _0x5020(){const _0x101711=['is_end','5wnksOF','data','2373qCRDae','now','error','meta:','id:','/sse-invoke','round','compilerStream','4417588XoKRfl','generateToken','jsonwebtoken','22712wAkwYh','length','application/json','1439848sBQZzm','compilerMetaJsonStr','https://open.bigmodel.cn/api/paas/v3/model-api/','log','sendMessageFromZhipu','filter','text','catch','event:','sign','trim','118314imZmZq','data:','error:\x20','1553229ELmPWl','135451vqcPLC','parse','axios','121008lxVRAX','HS256','replace','SIGN','defineProperty','toString'];_0x5020=function(){return _0x101711;};return _0x5020();}async function sendMessageFromZhipu(_0x4ae612,{onProgress:_0x4c9d17,key:_0x3d4133,model:_0x150d0e,temperature:temperature=0.95}){const _0x5144e1=await generateToken(_0x3d4133);return new Promise((_0x57d20e,_0x489a76)=>{const _0x307b75=_0x55a4,_0x20af8e=_0x307b75(0xc0)+_0x150d0e+_0x307b75(0xde),_0x618ccf={'method':'POST','url':_0x20af8e,'responseType':'stream','headers':{'Content-Type':_0x307b75(0xbd),'Authorization':_0x5144e1},'data':{'prompt':_0x4ae612,'temperature':temperature}};axios(_0x618ccf)['then'](_0x314486=>{const _0x2d8c14=_0x307b75,_0x268c77=_0x314486[_0x2d8c14(0xd8)];let _0x33f2e6,_0x2278a4='';_0x268c77['on'](_0x2d8c14(0xd8),_0x39af2f=>{const _0x163057=_0x2d8c14,_0x51423e=_0x39af2f[_0x163057(0xd5)]()['split']('\x0a')[_0x163057(0xc3)](_0x57c056=>_0x57c056[_0x163057(0xc8)]()!=='');console[_0x163057(0xc1)](_0x51423e);const _0x2903da=compilerStream(_0x51423e);console[_0x163057(0xc1)](_0x2903da);if(!_0x2903da)return;const {id:_0x183588,result:_0x1eda19,is_end:_0x280fae}=_0x2903da;_0x1eda19&&(_0x2278a4+=_0x1eda19[_0x163057(0xc8)]()),_0x280fae&&(_0x2903da[_0x163057(0xd6)]=![],_0x33f2e6=_0x2903da,_0x33f2e6[_0x163057(0xc4)]=_0x2278a4),_0x4c9d17(_0x2903da);}),_0x268c77['on']('end',()=>{_0x57d20e(_0x33f2e6),_0x2278a4='';});})[_0x307b75(0xc5)](_0x5184f1=>{const _0x4c75d3=_0x307b75;console[_0x4c75d3(0xc1)](_0x4c75d3(0xcb),_0x5184f1);});});}exports[_0x246e9a(0xc2)]=sendMessageFromZhipu;