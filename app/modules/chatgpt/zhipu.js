'use strict';const _0x4e08f2=_0xdee4;function _0x1dc5(){const _0x3e0f45=['split','2554083izOCBu','339985GjgYRi','trim','data:\x20','filter','compilerStream','[DONE]','104039KMFIbh','compilerMetaJsonStr','error','event:','axios','then','round','end','indexOf','/v1/chat/completions','chat.completion.chunk','forEach','stream','assistant','---------------FASTMessageHistory','toString','content','choices','error:\x20','520708SQAMoW','length','sign','data','usage','replace','HS256','1536600uQJNXn','catch','POST','__esModule','292999wKijWI','jsonwebtoken','6ytiDWs','text','id:','generateToken','is_end','json\x20parse\x20error\x20from\x20zhipu!','2qSCPMP','Bearer\x20','model','sendMessageFromFastgpt','now','log','defineProperty','delta','parse','meta:','211281qZfLbL','created','application/json','SIGN'];_0x1dc5=function(){return _0x3e0f45;};return _0x1dc5();}function _0xdee4(_0x2b560e,_0x355f99){const _0x1dc5b6=_0x1dc5();return _0xdee4=function(_0xdee46d,_0x329cd3){_0xdee46d=_0xdee46d-0x8a;let _0x2cb252=_0x1dc5b6[_0xdee46d];return _0x2cb252;},_0xdee4(_0x2b560e,_0x355f99);}(function(_0x3118c3,_0xfacf0){const _0x34c48c=_0xdee4,_0x24da1e=_0x3118c3();while(!![]){try{const _0x1a846a=parseInt(_0x34c48c(0x97))/0x1*(parseInt(_0x34c48c(0xbd))/0x2)+parseInt(_0x34c48c(0x8b))/0x3+-parseInt(_0x34c48c(0xaa))/0x4+-parseInt(_0x34c48c(0x91))/0x5*(parseInt(_0x34c48c(0xb7))/0x6)+parseInt(_0x34c48c(0xb5))/0x7+-parseInt(_0x34c48c(0xb1))/0x8+parseInt(_0x34c48c(0x90))/0x9;if(_0x1a846a===_0xfacf0)break;else _0x24da1e['push'](_0x24da1e['shift']());}catch(_0xccfef1){_0x24da1e['push'](_0x24da1e['shift']());}}}(_0x1dc5,0x1ad25));Object[_0x4e08f2(0xc3)](exports,_0x4e08f2(0xb4),{'value':!![]}),exports[_0x4e08f2(0xc0)]=exports['sendMessageFromZhipu']=exports['compilerStream']=exports[_0x4e08f2(0x98)]=exports['generateToken']=void 0x0;const axios=require(_0x4e08f2(0x9b)),jwt=require(_0x4e08f2(0xb6));function generateToken(_0x5af082,_0x57c6dc=0x3e8*0x3c*0x3c*0x18*0x168){const _0x4e4495=_0x4e08f2,[_0x2513d1,_0x5a5d99]=_0x5af082[_0x4e4495(0x8f)]('.'),_0x325681={'api_key':_0x2513d1,'exp':Math[_0x4e4495(0x9d)](Date[_0x4e4495(0xc1)]())+_0x57c6dc*0x3e8,'timestamp':Math[_0x4e4495(0x9d)](Date[_0x4e4495(0xc1)]())};return jwt[_0x4e4495(0xac)](_0x325681,_0x5a5d99,{'algorithm':'HS256','header':{'alg':_0x4e4495(0xb0),'sign_type':_0x4e4495(0x8e)}});}exports[_0x4e08f2(0xba)]=generateToken;function compilerMetaJsonStr(_0x480f72){const _0x33cfb3=_0x4e08f2;let _0x269061={};try{_0x269061=JSON[_0x33cfb3(0xc5)](_0x480f72);}catch(_0x1121ad){_0x269061={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x33cfb3(0x99)](_0x33cfb3(0xbc),_0x480f72);}return _0x269061;}exports[_0x4e08f2(0x98)]=compilerMetaJsonStr;function compilerStream(_0x27de39){const _0x3d9dc1=_0x4e08f2;console[_0x3d9dc1(0xc2)](_0x27de39);if(_0x27de39[_0x3d9dc1(0xab)]===0x3)return{'event':_0x27de39[0x0][_0x3d9dc1(0xaf)](_0x3d9dc1(0x9a),''),'id':_0x27de39[0x1][_0x3d9dc1(0xaf)](_0x3d9dc1(0xb9),''),'is_end':![],'result':_0x27de39[0x2][_0x3d9dc1(0xaf)]('data:','')[_0x3d9dc1(0x92)]()};if(_0x27de39[_0x3d9dc1(0xab)]===0x4)return{'event':_0x27de39[0x0]['replace'](_0x3d9dc1(0x9a),''),'id':_0x27de39[0x1][_0x3d9dc1(0xaf)](_0x3d9dc1(0xb9),''),'result':_0x27de39[0x2][_0x3d9dc1(0xaf)]('data:','')[_0x3d9dc1(0x92)](),'is_end':!![],'usage':compilerMetaJsonStr(_0x27de39[0x3][_0x3d9dc1(0xaf)](_0x3d9dc1(0x8a),''))?.['usage']};}exports[_0x4e08f2(0x95)]=compilerStream;async function sendMessageFromZhipu(_0x32ba95,{onProgress:_0x56b34e,key:_0x301f54,model:_0x51f543,temperature:temperature=0.95}){const _0x28d4a6=await generateToken(_0x301f54);return new Promise((_0x2c76ce,_0x4ad87f)=>{const _0x3faac5=_0xdee4,_0x14f5d9='https://open.bigmodel.cn/api/paas/v4/chat/completions',_0x14c773={'method':_0x3faac5(0xb3),'url':_0x14f5d9,'responseType':_0x3faac5(0xa3),'headers':{'Content-Type':'application/json','Authorization':_0x28d4a6},'data':{'model':_0x51f543,'messages':_0x32ba95,'temperature':temperature,'stream':!![]}};axios(_0x14c773)['then'](_0x3392d8=>{const _0x1a196d=_0x3faac5,_0x23267b=_0x3392d8['data'];let _0x6d7762,_0x74dd22='';_0x23267b['on'](_0x1a196d(0xad),_0x5ae2ed=>{const _0x4f66fb=_0x1a196d,_0x1e9250=_0x5ae2ed[_0x4f66fb(0xa6)]()['split']('\x0a')[_0x4f66fb(0x94)](_0x447c7a=>_0x447c7a[_0x4f66fb(0x92)]()!==''),_0xd3d4cc=_0x1e9250;console[_0x4f66fb(0xc2)](_0xd3d4cc);if(!_0xd3d4cc)return;let _0x335316=![],_0x1aed36='',_0x271c08='',_0x15cfb3='',_0x51e514=null;_0xd3d4cc[_0x4f66fb(0xa2)](_0x229712=>{const _0x5d5b7a=_0x4f66fb;if(_0x229712[_0x5d5b7a(0x9f)]('[DONE]')>-0x1)_0x335316=!![];else{const _0x41880b=JSON[_0x5d5b7a(0xc5)](_0x229712['replace']('data:\x20',''));_0x1aed36=_0x41880b['id'],_0x271c08=_0x41880b['created'],_0x15cfb3=_0x41880b[_0x5d5b7a(0xbf)],_0x41880b[_0x5d5b7a(0xae)]&&(_0x51e514=_0x41880b['usage']),_0x41880b[_0x5d5b7a(0xa8)][_0x5d5b7a(0xa2)](_0x3982a3=>{const _0x46b1f5=_0x5d5b7a;_0x74dd22+=_0x3982a3['delta'][_0x46b1f5(0xa7)];});}});let _0x221927={'role':_0x4f66fb(0xa4),'id':_0x1aed36,'text':_0x74dd22,'delta':_0x74dd22,'detail':{'choices':[{'delta':{'content':_0x74dd22,'role':_0x4f66fb(0xa4)},'index':0x0}],'created':_0x271c08,'id':_0x1aed36,'model':_0x15cfb3,'object':'chat.completion.chunk','usage':_0x51e514}};_0x335316&&(_0x221927['is_end']=![],_0x6d7762=_0x221927,_0x6d7762['text']=_0x74dd22),_0x56b34e(_0x221927);}),_0x23267b['on']('end',()=>{_0x2c76ce(_0x6d7762),_0x74dd22='';});})[_0x3faac5(0xb2)](_0x29fc35=>{const _0x19e290=_0x3faac5;console[_0x19e290(0xc2)](_0x19e290(0xa9),_0x29fc35);});});}exports['sendMessageFromZhipu']=sendMessageFromZhipu;async function sendMessageFromFastgpt(_0x564433,{chatId:_0x1326b2,onProgress:_0xcbf5a2,key:_0x3a3889,model:_0xea8f78,apiUrl:_0x55d076}){return new Promise((_0x172a9f,_0x18d4d1)=>{const _0x166c9b=_0xdee4,_0x5ad05a=_0x55d076+_0x166c9b(0xa0),_0x10e362={'method':_0x166c9b(0xb3),'url':_0x5ad05a,'responseType':_0x166c9b(0xa3),'headers':{'Content-Type':_0x166c9b(0x8d),'Authorization':_0x166c9b(0xbe)+_0x3a3889},'data':{'model':_0xea8f78,'detail':![],'messages':_0x564433,'stream':!![]}};console[_0x166c9b(0xc2)](_0x166c9b(0xa5),_0x564433),axios(_0x10e362)[_0x166c9b(0x9c)](_0x59173b=>{const _0x2f7a7c=_0x166c9b,_0x385d75=_0x59173b['data'];let _0x95b578,_0x5ba27b='';_0x385d75['on']('data',_0x29b6ab=>{const _0x4f4275=_0xdee4,_0x205c51=_0x29b6ab[_0x4f4275(0xa6)]()['split']('\x0a')[_0x4f4275(0x94)](_0x585e59=>_0x585e59[_0x4f4275(0x92)]()!==''),_0xf1ae03=_0x205c51;console[_0x4f4275(0xc2)]('---------------FASTMessage',_0xf1ae03);if(!_0xf1ae03)return;let _0x25b64c=![],_0x4e5852=_0x1326b2,_0x9c6fe8='',_0x2c8b87='',_0x38081c=null;_0xf1ae03[_0x4f4275(0xa2)](_0xff36ad=>{const _0x365c98=_0x4f4275;if(_0xff36ad[_0x365c98(0x9f)](_0x365c98(0x96))>-0x1)_0x25b64c=!![];else{const _0x1b7729=JSON[_0x365c98(0xc5)](_0xff36ad[_0x365c98(0xaf)](_0x365c98(0x93),''));_0x1b7729[_0x365c98(0xa8)]&&(_0x9c6fe8=_0x1b7729[_0x365c98(0x8c)],_0x2c8b87=_0x1b7729[_0x365c98(0xbf)],_0x1b7729[_0x365c98(0xae)]&&(_0x38081c=_0x1b7729['usage']),_0x1b7729['choices']['forEach'](_0x2d8b0e=>{const _0x2634f9=_0x365c98;_0x2d8b0e[_0x2634f9(0xc4)][_0x2634f9(0xa7)]&&(_0x5ba27b+=_0x2d8b0e[_0x2634f9(0xc4)][_0x2634f9(0xa7)]);}));}});let _0x1181b8={'role':_0x4f4275(0xa4),'id':_0x4e5852,'text':_0x5ba27b,'delta':_0x5ba27b,'detail':{'choices':[{'delta':{'content':_0x5ba27b,'role':'assistant'},'index':0x0}],'created':_0x9c6fe8,'id':_0x4e5852,'model':_0x2c8b87,'object':_0x4f4275(0xa1),'usage':_0x38081c}};_0x25b64c&&(_0x1181b8[_0x4f4275(0xbb)]=![],_0x95b578=_0x1181b8,_0x95b578[_0x4f4275(0xb8)]=_0x5ba27b),_0xcbf5a2(_0x1181b8);}),_0x385d75['on'](_0x2f7a7c(0x9e),()=>{_0x172a9f(_0x95b578),_0x5ba27b='';});})[_0x166c9b(0xb2)](_0x4509fa=>{const _0x4cf907=_0x166c9b;console[_0x4cf907(0xc2)](_0x4cf907(0xa9),_0x4509fa);});});}exports[_0x4e08f2(0xc0)]=sendMessageFromFastgpt;