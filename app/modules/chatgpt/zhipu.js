'use strict';function _0x10a2(_0x5b021c,_0xe33cf6){const _0x37eaa4=_0x37ea();return _0x10a2=function(_0x10a2b9,_0x3fecfd){_0x10a2b9=_0x10a2b9-0x1e5;let _0x2ec644=_0x37eaa4[_0x10a2b9];return _0x2ec644;},_0x10a2(_0x5b021c,_0xe33cf6);}function _0x37ea(){const _0x3494d0=['end','now','1685292PxpAyL','choices','jsonwebtoken','5624600HeghoS','data','indexOf','10296432HWsxZi','104pGptQa','sendMessageFromZhipu','7Tanufl','length','split','event:','error','trim','__esModule','compilerStream','data:','assistant','content','axios','json\x20parse\x20error\x20from\x20zhipu!','compilerMetaJsonStr','166300GJDzPx','meta:','then','created','log','chat.completion.chunk','filter','parse','id:','3593634YpzeGU','usage','replace','error:\x20','text','round','stream','HS256','forEach','215374cgbMiQ','generateToken','is_end','43257xooQQj','[DONE]'];_0x37ea=function(){return _0x3494d0;};return _0x37ea();}const _0x5a46c3=_0x10a2;(function(_0x49f774,_0xe7bca7){const _0x51b46c=_0x10a2,_0x5f1287=_0x49f774();while(!![]){try{const _0x393a49=parseInt(_0x51b46c(0x1f9))/0x1+parseInt(_0x51b46c(0x207))/0x2*(parseInt(_0x51b46c(0x1fc))/0x3)+-parseInt(_0x51b46c(0x200))/0x4+parseInt(_0x51b46c(0x1e7))/0x5+parseInt(_0x51b46c(0x1f0))/0x6*(-parseInt(_0x51b46c(0x209))/0x7)+-parseInt(_0x51b46c(0x203))/0x8+parseInt(_0x51b46c(0x206))/0x9;if(_0x393a49===_0xe7bca7)break;else _0x5f1287['push'](_0x5f1287['shift']());}catch(_0x1a36b1){_0x5f1287['push'](_0x5f1287['shift']());}}}(_0x37ea,0x6653d));Object['defineProperty'](exports,_0x5a46c3(0x20f),{'value':!![]}),exports[_0x5a46c3(0x208)]=exports['compilerStream']=exports[_0x5a46c3(0x1e6)]=exports['generateToken']=void 0x0;const axios=require(_0x5a46c3(0x214)),jwt=require(_0x5a46c3(0x202));function generateToken(_0x1f081f,_0x50d453=0x3e8*0x3c*0x3c*0x18*0x168){const _0x5bede0=_0x5a46c3,[_0x40ce46,_0xf0bc29]=_0x1f081f[_0x5bede0(0x20b)]('.'),_0x33da91={'api_key':_0x40ce46,'exp':Math[_0x5bede0(0x1f5)](Date[_0x5bede0(0x1ff)]())+_0x50d453*0x3e8,'timestamp':Math[_0x5bede0(0x1f5)](Date[_0x5bede0(0x1ff)]())};return jwt['sign'](_0x33da91,_0xf0bc29,{'algorithm':_0x5bede0(0x1f7),'header':{'alg':_0x5bede0(0x1f7),'sign_type':'SIGN'}});}exports[_0x5a46c3(0x1fa)]=generateToken;function compilerMetaJsonStr(_0x5edfeb){const _0x39fff9=_0x5a46c3;let _0x1100f5={};try{_0x1100f5=JSON[_0x39fff9(0x1ee)](_0x5edfeb);}catch(_0x2bca5a){_0x1100f5={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x39fff9(0x20d)](_0x39fff9(0x1e5),_0x5edfeb);}return _0x1100f5;}exports[_0x5a46c3(0x1e6)]=compilerMetaJsonStr;function compilerStream(_0x50791c){const _0x2e03ec=_0x5a46c3;console[_0x2e03ec(0x1eb)](_0x50791c);if(_0x50791c[_0x2e03ec(0x20a)]===0x3)return{'event':_0x50791c[0x0][_0x2e03ec(0x1f2)](_0x2e03ec(0x20c),''),'id':_0x50791c[0x1]['replace'](_0x2e03ec(0x1ef),''),'is_end':![],'result':_0x50791c[0x2]['replace'](_0x2e03ec(0x211),'')[_0x2e03ec(0x20e)]()};if(_0x50791c[_0x2e03ec(0x20a)]===0x4)return{'event':_0x50791c[0x0][_0x2e03ec(0x1f2)](_0x2e03ec(0x20c),''),'id':_0x50791c[0x1][_0x2e03ec(0x1f2)](_0x2e03ec(0x1ef),''),'result':_0x50791c[0x2][_0x2e03ec(0x1f2)](_0x2e03ec(0x211),'')['trim'](),'is_end':!![],'usage':compilerMetaJsonStr(_0x50791c[0x3][_0x2e03ec(0x1f2)](_0x2e03ec(0x1e8),''))?.['usage']};}exports[_0x5a46c3(0x210)]=compilerStream;async function sendMessageFromZhipu(_0x185ecc,{onProgress:_0x3e2865,key:_0x122b0d,model:_0x177a3f,temperature:temperature=0.95}){const _0x43886a=await generateToken(_0x122b0d);return new Promise((_0x304aa6,_0xd342ef)=>{const _0x5e590c=_0x10a2,_0x36f147='https://open.bigmodel.cn/api/paas/v4/chat/completions',_0x5bd2d2={'method':'POST','url':_0x36f147,'responseType':_0x5e590c(0x1f6),'headers':{'Content-Type':'application/json','Authorization':_0x43886a},'data':{'model':_0x177a3f,'messages':_0x185ecc,'temperature':temperature,'stream':!![]}};axios(_0x5bd2d2)[_0x5e590c(0x1e9)](_0x138b08=>{const _0x4fc0ad=_0x5e590c,_0x1a4a4f=_0x138b08['data'];let _0x9bf321,_0x467b9b='';_0x1a4a4f['on'](_0x4fc0ad(0x204),_0x485cf1=>{const _0x44f3f8=_0x4fc0ad,_0x380a07=_0x485cf1['toString']()[_0x44f3f8(0x20b)]('\x0a')[_0x44f3f8(0x1ed)](_0x11c646=>_0x11c646[_0x44f3f8(0x20e)]()!==''),_0xbfdb2e=_0x380a07;console[_0x44f3f8(0x1eb)](_0xbfdb2e);if(!_0xbfdb2e)return;let _0x508b99=![],_0x342a1d='',_0x3964b3='',_0x1a822b='',_0xd22dcb=null;_0xbfdb2e[_0x44f3f8(0x1f8)](_0x3286c7=>{const _0x352450=_0x44f3f8;if(_0x3286c7[_0x352450(0x205)](_0x352450(0x1fd))>-0x1)_0x508b99=!![];else{const _0x26d81e=JSON[_0x352450(0x1ee)](_0x3286c7[_0x352450(0x1f2)]('data:\x20',''));_0x342a1d=_0x26d81e['id'],_0x3964b3=_0x26d81e[_0x352450(0x1ea)],_0x1a822b=_0x26d81e['model'],_0x26d81e[_0x352450(0x1f1)]&&(_0xd22dcb=_0x26d81e[_0x352450(0x1f1)]),_0x26d81e[_0x352450(0x201)][_0x352450(0x1f8)](_0x5ccdd8=>{const _0x5b1fe7=_0x352450;_0x467b9b+=_0x5ccdd8['delta'][_0x5b1fe7(0x213)];});}});let _0xf4ea11={'role':_0x44f3f8(0x212),'id':_0x342a1d,'text':_0x467b9b,'delta':_0x467b9b,'detail':{'choices':[{'delta':{'content':_0x467b9b,'role':'assistant'},'index':0x0}],'created':_0x3964b3,'id':_0x342a1d,'model':_0x1a822b,'object':_0x44f3f8(0x1ec),'usage':_0xd22dcb}};_0x508b99&&(_0xf4ea11[_0x44f3f8(0x1fb)]=![],_0x9bf321=_0xf4ea11,_0x9bf321[_0x44f3f8(0x1f4)]=_0x467b9b),_0x3e2865(_0xf4ea11);}),_0x1a4a4f['on'](_0x4fc0ad(0x1fe),()=>{_0x304aa6(_0x9bf321),_0x467b9b='';});})['catch'](_0x41326a=>{const _0x3fcbab=_0x5e590c;console['log'](_0x3fcbab(0x1f3),_0x41326a);});});}exports[_0x5a46c3(0x208)]=sendMessageFromZhipu;