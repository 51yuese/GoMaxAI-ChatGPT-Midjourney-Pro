'use strict';const _0x3a0a47=_0x2d92;(function(_0x5880e6,_0x3edb61){const _0x407d6b=_0x2d92,_0x25498f=_0x5880e6();while(!![]){try{const _0x5a3ac6=parseInt(_0x407d6b(0x154))/0x1*(-parseInt(_0x407d6b(0x15b))/0x2)+parseInt(_0x407d6b(0x159))/0x3+parseInt(_0x407d6b(0x16d))/0x4*(-parseInt(_0x407d6b(0x15d))/0x5)+parseInt(_0x407d6b(0x156))/0x6*(parseInt(_0x407d6b(0x17c))/0x7)+parseInt(_0x407d6b(0x16b))/0x8+-parseInt(_0x407d6b(0x169))/0x9*(-parseInt(_0x407d6b(0x157))/0xa)+-parseInt(_0x407d6b(0x177))/0xb*(parseInt(_0x407d6b(0x14f))/0xc);if(_0x5a3ac6===_0x3edb61)break;else _0x25498f['push'](_0x25498f['shift']());}catch(_0x5ce7a4){_0x25498f['push'](_0x25498f['shift']());}}}(_0x4751,0xa4a1d));function _0x4751(){const _0xec11bf=['861384nyGhrr','compilerStream','916424eEsRHc','parse','replace','choices','forEach','compilerMetaJsonStr','__esModule','sendMessageFromZhipu','then','generateToken','2919598BUaRmh','event:','split','json\x20parse\x20error\x20from\x20zhipu!','error','198751duqfoI','id:','model','usage','data','24xWToXe','log','round','trim','delta','79238QeDayt','content','108JlovbI','2740mMlkeY','defineProperty','3148044RtLcUJ','toString','20unJfox','jsonwebtoken','20oWrzuz','created','length','is_end','data:','sign','catch','text','end','now','assistant','meta:','40923rrllKF','HS256'];_0x4751=function(){return _0xec11bf;};return _0x4751();}Object[_0x3a0a47(0x158)](exports,_0x3a0a47(0x173),{'value':!![]}),exports['sendMessageFromZhipu']=exports[_0x3a0a47(0x16c)]=exports[_0x3a0a47(0x172)]=exports[_0x3a0a47(0x176)]=void 0x0;const axios=require('axios'),jwt=require(_0x3a0a47(0x15c));function generateToken(_0x391c49,_0x2e53aa=0x3e8*0x3c*0x3c*0x18*0x168){const _0x3cc35e=_0x3a0a47,[_0x3a19cb,_0x3e4c51]=_0x391c49[_0x3cc35e(0x179)]('.'),_0x3729a7={'api_key':_0x3a19cb,'exp':Math[_0x3cc35e(0x151)](Date[_0x3cc35e(0x166)]())+_0x2e53aa*0x3e8,'timestamp':Math[_0x3cc35e(0x151)](Date[_0x3cc35e(0x166)]())};return jwt[_0x3cc35e(0x162)](_0x3729a7,_0x3e4c51,{'algorithm':_0x3cc35e(0x16a),'header':{'alg':'HS256','sign_type':'SIGN'}});}exports['generateToken']=generateToken;function compilerMetaJsonStr(_0x2ea4cb){const _0x2cf889=_0x3a0a47;let _0x1459e1={};try{_0x1459e1=JSON[_0x2cf889(0x16e)](_0x2ea4cb);}catch(_0x2cd658){_0x1459e1={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console[_0x2cf889(0x17b)](_0x2cf889(0x17a),_0x2ea4cb);}return _0x1459e1;}exports[_0x3a0a47(0x172)]=compilerMetaJsonStr;function _0x2d92(_0x412d00,_0x1dfc13){const _0x4751f9=_0x4751();return _0x2d92=function(_0x2d9268,_0x47d86){_0x2d9268=_0x2d9268-0x14b;let _0x51d944=_0x4751f9[_0x2d9268];return _0x51d944;},_0x2d92(_0x412d00,_0x1dfc13);}function compilerStream(_0x18c6dc){const _0x1587d5=_0x3a0a47;console['log'](_0x18c6dc);if(_0x18c6dc[_0x1587d5(0x15f)]===0x3)return{'event':_0x18c6dc[0x0][_0x1587d5(0x16f)](_0x1587d5(0x178),''),'id':_0x18c6dc[0x1][_0x1587d5(0x16f)](_0x1587d5(0x14b),''),'is_end':![],'result':_0x18c6dc[0x2][_0x1587d5(0x16f)](_0x1587d5(0x161),'')[_0x1587d5(0x152)]()};if(_0x18c6dc[_0x1587d5(0x15f)]===0x4)return{'event':_0x18c6dc[0x0][_0x1587d5(0x16f)](_0x1587d5(0x178),''),'id':_0x18c6dc[0x1][_0x1587d5(0x16f)](_0x1587d5(0x14b),''),'result':_0x18c6dc[0x2][_0x1587d5(0x16f)](_0x1587d5(0x161),'')[_0x1587d5(0x152)](),'is_end':!![],'usage':compilerMetaJsonStr(_0x18c6dc[0x3][_0x1587d5(0x16f)](_0x1587d5(0x168),''))?.[_0x1587d5(0x14d)]};}exports[_0x3a0a47(0x16c)]=compilerStream;async function sendMessageFromZhipu(_0x2c5c27,{onProgress:_0x2d865f,key:_0x4b7fee,model:_0x309e5b,temperature:temperature=0.95}){const _0x14007b=await generateToken(_0x4b7fee);return new Promise((_0x3191a5,_0x37642c)=>{const _0xeef55=_0x2d92,_0x53edcb='https://open.bigmodel.cn/api/paas/v4/chat/completions',_0x5e4d4b={'method':'POST','url':_0x53edcb,'responseType':'stream','headers':{'Content-Type':'application/json','Authorization':_0x14007b},'data':{'model':_0x309e5b,'messages':_0x2c5c27,'temperature':temperature,'stream':!![]}};axios(_0x5e4d4b)[_0xeef55(0x175)](_0x5ac6ad=>{const _0xdca148=_0xeef55,_0x817573=_0x5ac6ad[_0xdca148(0x14e)];let _0x3a84c9,_0x905f13='';_0x817573['on'](_0xdca148(0x14e),_0x442ffa=>{const _0x39938a=_0xdca148,_0x21851e=_0x442ffa[_0x39938a(0x15a)]()[_0x39938a(0x179)]('\x0a')['filter'](_0x1bb076=>_0x1bb076[_0x39938a(0x152)]()!==''),_0x37bb49=_0x21851e;console['log'](_0x37bb49);if(!_0x37bb49)return;let _0x11a169=![],_0x19a3b1='',_0x4cf772='',_0x2a6c65='',_0x4aa8ad=null;_0x37bb49[_0x39938a(0x171)](_0x482dda=>{const _0x30a064=_0x39938a;if(_0x482dda['indexOf']('[DONE]')>-0x1)_0x11a169=!![];else{const _0x1a9b22=JSON[_0x30a064(0x16e)](_0x482dda[_0x30a064(0x16f)]('data:\x20',''));_0x19a3b1=_0x1a9b22['id'],_0x4cf772=_0x1a9b22[_0x30a064(0x15e)],_0x2a6c65=_0x1a9b22[_0x30a064(0x14c)],_0x1a9b22[_0x30a064(0x14d)]&&(_0x4aa8ad=_0x1a9b22[_0x30a064(0x14d)]),_0x1a9b22[_0x30a064(0x170)][_0x30a064(0x171)](_0x1f95c5=>{const _0x34b7c0=_0x30a064;_0x905f13+=_0x1f95c5[_0x34b7c0(0x153)][_0x34b7c0(0x155)];});}});let _0x59194f={'role':_0x39938a(0x167),'id':_0x19a3b1,'text':_0x905f13,'delta':_0x905f13,'detail':{'choices':[{'delta':{'content':_0x905f13,'role':_0x39938a(0x167)},'index':0x0}],'created':_0x4cf772,'id':_0x19a3b1,'model':_0x2a6c65,'object':'chat.completion.chunk','usage':_0x4aa8ad}};_0x11a169&&(_0x59194f[_0x39938a(0x160)]=![],_0x3a84c9=_0x59194f,_0x3a84c9[_0x39938a(0x164)]=_0x905f13),_0x2d865f(_0x59194f);}),_0x817573['on'](_0xdca148(0x165),()=>{_0x3191a5(_0x3a84c9),_0x905f13='';});})[_0xeef55(0x163)](_0x5aab21=>{const _0x16a38a=_0xeef55;console[_0x16a38a(0x150)]('error:\x20',_0x5aab21);});});}exports[_0x3a0a47(0x174)]=sendMessageFromZhipu;