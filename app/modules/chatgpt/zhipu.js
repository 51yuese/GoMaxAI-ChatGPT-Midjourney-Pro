'use strict';const _0x2775c2=_0xd037;(function(_0x1d57d0,_0x5e61c6){const _0x3ab2a5=_0xd037,_0x4ccc3d=_0x1d57d0();while(!![]){try{const _0x268218=parseInt(_0x3ab2a5(0x170))/0x1*(-parseInt(_0x3ab2a5(0x166))/0x2)+-parseInt(_0x3ab2a5(0x161))/0x3+parseInt(_0x3ab2a5(0x158))/0x4+parseInt(_0x3ab2a5(0x15e))/0x5+-parseInt(_0x3ab2a5(0x154))/0x6*(parseInt(_0x3ab2a5(0x16b))/0x7)+parseInt(_0x3ab2a5(0x167))/0x8*(parseInt(_0x3ab2a5(0x173))/0x9)+parseInt(_0x3ab2a5(0x15f))/0xa;if(_0x268218===_0x5e61c6)break;else _0x4ccc3d['push'](_0x4ccc3d['shift']());}catch(_0x106171){_0x4ccc3d['push'](_0x4ccc3d['shift']());}}}(_0x3156,0x3e9dd));Object[_0x2775c2(0x179)](exports,'__esModule',{'value':!![]}),exports[_0x2775c2(0x17a)]=exports[_0x2775c2(0x160)]=exports[_0x2775c2(0x16d)]=exports['generateToken']=void 0x0;const axios=require(_0x2775c2(0x178)),jwt=require(_0x2775c2(0x174));function generateToken(_0x4ac510,_0x420057=0x3e8*0x3c*0x3c*0x18*0x168){const _0x286e61=_0x2775c2,[_0x1b77d9,_0x5e0d30]=_0x4ac510['split']('.'),_0x1197e5={'api_key':_0x1b77d9,'exp':Math['round'](Date[_0x286e61(0x155)]())+_0x420057*0x3e8,'timestamp':Math[_0x286e61(0x171)](Date[_0x286e61(0x155)]())};return jwt[_0x286e61(0x168)](_0x1197e5,_0x5e0d30,{'algorithm':'HS256','header':{'alg':'HS256','sign_type':'SIGN'}});}exports[_0x2775c2(0x175)]=generateToken;function compilerMetaJsonStr(_0x53316c){const _0x1553a6=_0x2775c2;let _0x21a020={};try{_0x21a020=JSON[_0x1553a6(0x156)](_0x53316c);}catch(_0x2f0818){_0x21a020={'usage':{'completion_tokens':0x31,'prompt_tokens':0x14d,'total_tokens':0x18f}},console['error'](_0x1553a6(0x163),_0x53316c);}return _0x21a020;}function _0xd037(_0x578098,_0x30f565){const _0x3156c5=_0x3156();return _0xd037=function(_0xd037ba,_0x4d0948){_0xd037ba=_0xd037ba-0x154;let _0x4b4671=_0x3156c5[_0xd037ba];return _0x4b4671;},_0xd037(_0x578098,_0x30f565);}exports[_0x2775c2(0x16d)]=compilerMetaJsonStr;function compilerStream(_0x1a5a12){const _0x330c7d=_0x2775c2;console[_0x330c7d(0x16c)](_0x1a5a12);if(_0x1a5a12[_0x330c7d(0x162)]===0x3)return{'event':_0x1a5a12[0x0][_0x330c7d(0x177)](_0x330c7d(0x159),''),'id':_0x1a5a12[0x1][_0x330c7d(0x177)](_0x330c7d(0x157),''),'is_end':![],'result':_0x1a5a12[0x2][_0x330c7d(0x177)]('data:','')['trim']()};if(_0x1a5a12['length']===0x4)return{'event':_0x1a5a12[0x0]['replace']('event:',''),'id':_0x1a5a12[0x1]['replace'](_0x330c7d(0x157),''),'result':_0x1a5a12[0x2][_0x330c7d(0x177)]('data:','')[_0x330c7d(0x176)](),'is_end':!![],'usage':compilerMetaJsonStr(_0x1a5a12[0x3][_0x330c7d(0x177)]('meta:',''))?.[_0x330c7d(0x16f)]};}exports[_0x2775c2(0x160)]=compilerStream;async function sendMessageFromZhipu(_0x42b848,{onProgress:_0x50da4b,key:_0x53230c,model:_0x45af7f,temperature:temperature=0.95}){const _0x41a57d=await generateToken(_0x53230c);return new Promise((_0x103f38,_0x494eea)=>{const _0x8dd062=_0xd037,_0x3b04f7='https://open.bigmodel.cn/api/paas/v3/model-api/'+_0x45af7f+_0x8dd062(0x15a),_0x2c3921={'method':_0x8dd062(0x15d),'url':_0x3b04f7,'responseType':'stream','headers':{'Content-Type':_0x8dd062(0x169),'Authorization':_0x41a57d},'data':{'prompt':_0x42b848,'temperature':temperature}};axios(_0x2c3921)['then'](_0x3ef13d=>{const _0x2a7667=_0x8dd062,_0x5b8add=_0x3ef13d[_0x2a7667(0x172)];let _0x5e5f65,_0x3471af='';_0x5b8add['on'](_0x2a7667(0x172),_0x3c7db3=>{const _0x128f5e=_0x2a7667,_0x2a655b=_0x3c7db3[_0x128f5e(0x15b)]()[_0x128f5e(0x17b)]('\x0a')[_0x128f5e(0x16e)](_0xbb95a7=>_0xbb95a7['trim']()!=='');console['log'](_0x2a655b);const _0x3dbd51=compilerStream(_0x2a655b);console['log'](_0x3dbd51);if(!_0x3dbd51)return;const {id:_0x3af841,result:_0x31f4d9,is_end:_0x32000c}=_0x3dbd51;_0x31f4d9&&(_0x3471af+=_0x31f4d9[_0x128f5e(0x176)]()),_0x32000c&&(_0x3dbd51[_0x128f5e(0x165)]=![],_0x5e5f65=_0x3dbd51,_0x5e5f65[_0x128f5e(0x16a)]=_0x3471af),_0x50da4b(_0x3dbd51);}),_0x5b8add['on'](_0x2a7667(0x164),()=>{_0x103f38(_0x5e5f65),_0x3471af='';});})[_0x8dd062(0x15c)](_0x2c76a8=>{const _0x5be0a1=_0x8dd062;console[_0x5be0a1(0x16c)]('error:\x20',_0x2c76a8);});});}function _0x3156(){const _0x5d45a3=['/sse-invoke','toString','catch','POST','599045SztPDW','534610JYWICT','compilerStream','1905dnzGeq','length','json\x20parse\x20error\x20from\x20zhipu!','end','is_end','116tTaYlF','1812488KrcNMc','sign','application/json','text','742eEGEgc','log','compilerMetaJsonStr','filter','usage','5513UGokTF','round','data','18Nxlpnd','jsonwebtoken','generateToken','trim','replace','axios','defineProperty','sendMessageFromZhipu','split','12912PJypnL','now','parse','id:','714344PZYkEa','event:'];_0x3156=function(){return _0x5d45a3;};return _0x3156();}exports[_0x2775c2(0x17a)]=sendMessageFromZhipu;