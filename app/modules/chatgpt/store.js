'use strict';const _0x2dd2e8=_0x7f1f;(function(_0x8a519f,_0x5d39eb){const _0x48de23=_0x7f1f,_0x474db4=_0x8a519f();while(!![]){try{const _0x4c5ab7=parseInt(_0x48de23(0xff))/0x1+-parseInt(_0x48de23(0xfc))/0x2+parseInt(_0x48de23(0x105))/0x3*(-parseInt(_0x48de23(0xf4))/0x4)+-parseInt(_0x48de23(0xf8))/0x5*(-parseInt(_0x48de23(0x10c))/0x6)+-parseInt(_0x48de23(0x100))/0x7+-parseInt(_0x48de23(0xf2))/0x8+parseInt(_0x48de23(0x11d))/0x9*(parseInt(_0x48de23(0x11a))/0xa);if(_0x4c5ab7===_0x5d39eb)break;else _0x474db4['push'](_0x474db4['shift']());}catch(_0x1fac36){_0x474db4['push'](_0x474db4['shift']());}}}(_0x1ab2,0x95bfc));function _0x7f1f(_0x2b7346,_0xaea206){const _0x1ab20=_0x1ab2();return _0x7f1f=function(_0x7f1f19,_0x312bca){_0x7f1f19=_0x7f1f19-0xf1;let _0x3ec502=_0x1ab20[_0x7f1f19];return _0x3ec502;},_0x7f1f(_0x2b7346,_0xaea206);}Object[_0x2dd2e8(0x11b)](exports,'__esModule',{'value':!![]}),exports[_0x2dd2e8(0x10e)]=void 0x0;function _0x1ab2(){const _0xe02368=['formatOptions','split','getData','55LUoXOX','log','@dqbd/tiktoken','concat','329198jiApRI','push','_recursivePruning','320602hCogoM','8158290EGTbsB','min','cl100k_base','max','user','3gpOShX','system','replace','store','set','汇总的文本数量:\x20','content','349842ybtlQF','parentMessageId','NineStore','image_url','_getTokenCount','slice','join','expires','text','splice','uuid','namespace','getUuid','encode','60MYorPv','defineProperty','length','3220101QfWsUa','get_encoding','7983792gryeRe','chat','669192bssAmp'];_0x1ab2=function(){return _0xe02368;};return _0x1ab2();}const uuid_1=require(_0x2dd2e8(0x116)),tiktoken_1=require(_0x2dd2e8(0xfa)),tokenizer=(0x0,tiktoken_1[_0x2dd2e8(0xf1)])(_0x2dd2e8(0x102));class NineStore{constructor(_0x4ffecb){const _0x5f3aed=_0x2dd2e8,{store:_0x142d2f,namespace:_0x29f331,expires:_0x4ca46e}=this[_0x5f3aed(0xf5)](_0x4ffecb);this[_0x5f3aed(0x108)]=_0x142d2f,this[_0x5f3aed(0x117)]=_0x29f331,this[_0x5f3aed(0x113)]=_0x4ca46e;}[_0x2dd2e8(0xf5)](_0x26f2d1){const _0x564b67=_0x2dd2e8,{store:_0x5e2cba,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x564b67(0xf3)}=_0x26f2d1;return{'store':_0x5e2cba,'namespace':namespace,'expires':expires};}['generateKey'](_0x33b0df){const _0x310800=_0x2dd2e8;return this[_0x310800(0x117)]?this[_0x310800(0x117)]+'-'+_0x33b0df:_0x33b0df;}async[_0x2dd2e8(0xf7)](_0x53a7a0){const _0x34f024=_0x2dd2e8,_0x65b837=await this[_0x34f024(0x108)]['get'](_0x53a7a0);return _0x65b837;}async['setData'](_0x21e913,_0x6e4ad2=this[_0x2dd2e8(0x113)]){const _0x105cd5=_0x2dd2e8;await this[_0x105cd5(0x108)][_0x105cd5(0x109)](_0x21e913['id'],_0x21e913,_0x6e4ad2);}async['buildMessageFromParentMessageId'](_0x4a4584,_0xb4d2c){const _0x1a1e7d=_0x2dd2e8;let {maxRounds:_0x36d0c3,maxModelToken:_0x5acd03,maxResponseTokens:_0x4b8e63,systemMessage:systemMessage='',name:_0x1091cb}=_0xb4d2c,{parentMessageId:_0xb2d980}=_0xb4d2c,_0x1a2e31=[],_0x989cd7=0x0;systemMessage&&_0x1a2e31[_0x1a1e7d(0xfd)]({'role':_0x1a1e7d(0x106),'content':systemMessage});const _0x6543f2=_0x1a2e31[_0x1a1e7d(0x11c)];let _0x52b8a9=0x0;if(_0x4a4584){let _0x5add9f=!![];const _0x2f3a88=[],_0x40a55b=[],_0x3b89c2=_0x4a4584[_0x1a1e7d(0xf6)]('\x20');for(let _0x5516af=0x0;_0x5516af<_0x3b89c2[_0x1a1e7d(0x11c)];_0x5516af++){_0x5add9f&&/^[http:\/\/|https:\/\/]/['test'](_0x3b89c2[_0x5516af])?_0x2f3a88[_0x1a1e7d(0xfd)](_0x3b89c2[_0x5516af]):(_0x5add9f=![],_0x3b89c2[_0x5516af]&&_0x40a55b[_0x1a1e7d(0xfd)](_0x3b89c2[_0x5516af]));}let _0x23703f=[];for(const _0x333018 of _0x2f3a88){_0x23703f[_0x1a1e7d(0xfd)]({'type':_0x1a1e7d(0x10f),'image_url':{'url':_0x333018}});}_0x23703f[_0x1a1e7d(0x11c)]?_0x1a2e31[_0x1a1e7d(0xfd)]({'role':'user','content':[{'text':_0x40a55b[_0x1a1e7d(0x112)]('\x20'),'type':_0x1a1e7d(0x114)},..._0x23703f]}):_0x1a2e31[_0x1a1e7d(0xfd)]({'role':_0x1a1e7d(0x104),'content':_0x40a55b[_0x1a1e7d(0x112)]('\x20'),'name':_0x1091cb});}let _0x4f57d8=_0x1a2e31;do{if(!_0xb2d980)break;const _0x33cc81=await this[_0x1a1e7d(0xf7)](_0xb2d980);if(!_0x33cc81)break;const {text:_0x47f632,name:_0x597011,role:_0xe213fa}=_0x33cc81;_0x4f57d8=_0x4f57d8[_0x1a1e7d(0x111)](0x0,_0x6543f2)[_0x1a1e7d(0xfb)]([{'role':_0xe213fa,'content':_0x47f632,'name':_0x597011},..._0x4f57d8['slice'](_0x6543f2)]),_0x52b8a9++;if(_0x36d0c3&&_0x52b8a9>=_0x36d0c3)break;if(_0x5acd03&&_0x4b8e63){const _0x3ea573=_0x5acd03-_0x4b8e63;_0x989cd7=await this[_0x1a1e7d(0x110)](_0x4f57d8);const _0x107aa=_0x989cd7+0xc8<=_0x3ea573;!_0x107aa&&(_0x4f57d8=this[_0x1a1e7d(0xfe)](_0x1a2e31,_0x3ea573,systemMessage));}_0xb2d980=_0x33cc81[_0x1a1e7d(0x10d)];}while(!![]);const _0xba799d=Math[_0x1a1e7d(0x103)](0x1,Math[_0x1a1e7d(0x101)](_0x5acd03-_0x989cd7,_0x4b8e63));return _0x4f57d8;}async['_getTokenCount'](_0x28690f){const _0x11dc4f=_0x2dd2e8;let _0xc29bdf=_0x28690f['reduce']((_0x57af5d,_0x1b40d3)=>{const _0x4c9b7c=_0x7f1f;return _0x57af5d+=_0x1b40d3[_0x4c9b7c(0x10b)];},'');return console[_0x11dc4f(0xf9)](_0x11dc4f(0x10a),_0xc29bdf),_0xc29bdf=_0xc29bdf[_0x11dc4f(0x107)](/<\|endoftext\|>/g,''),tokenizer[_0x11dc4f(0x119)](_0xc29bdf)[_0x11dc4f(0x11c)];}async[_0x2dd2e8(0xfe)](_0x4826c3,_0x4bfb0f,_0x39a4cf){const _0x134d71=_0x2dd2e8,_0x2287bf=await this[_0x134d71(0x110)](_0x4826c3);if(_0x2287bf<=_0x4bfb0f)return _0x4826c3;return _0x4826c3[_0x134d71(0x115)](_0x39a4cf?0x1:0x0,0x1),this[_0x134d71(0xfe)](_0x4826c3,_0x4bfb0f,_0x39a4cf);}[_0x2dd2e8(0x118)](){return(0x0,uuid_1['v4'])();}}exports[_0x2dd2e8(0x10e)]=NineStore;