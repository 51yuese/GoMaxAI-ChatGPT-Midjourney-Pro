'use strict';const _0xb8e18=_0x9f1f;function _0x389f(){const _0x311152=['15550368GTiebx','reduce','concat','get','buildMessageFromParentMessageId','248MuuGhp','@dqbd/tiktoken','slice','_getTokenCount','length','汇总的文本数量:\x20','replace','9PasTBH','user','3397130XsyLJj','setData','defineProperty','getData','NineStore','encode','parentMessageId','162561uOpdbj','push','77080gJwpaw','generateKey','__esModule','cl100k_base','35514lolMmk','2ZZcUlC','get_encoding','namespace','expires','_recursivePruning','max','2642350hgENri','41034FSvdZK','splice','log','store','22oSyAAV','164fRGJae'];_0x389f=function(){return _0x311152;};return _0x389f();}function _0x9f1f(_0x24d139,_0x3a509){const _0x389f42=_0x389f();return _0x9f1f=function(_0x9f1f68,_0x199116){_0x9f1f68=_0x9f1f68-0xd0;let _0x5b8350=_0x389f42[_0x9f1f68];return _0x5b8350;},_0x9f1f(_0x24d139,_0x3a509);}(function(_0x1f3a60,_0x32ad7c){const _0x1194c1=_0x9f1f,_0x5887e2=_0x1f3a60();while(!![]){try{const _0x1d1c23=parseInt(_0x1194c1(0xec))/0x1*(parseInt(_0x1194c1(0xf1))/0x2)+parseInt(_0x1194c1(0xf0))/0x3*(-parseInt(_0x1194c1(0xd4))/0x4)+-parseInt(_0x1194c1(0xe3))/0x5+parseInt(_0x1194c1(0xf8))/0x6+-parseInt(_0x1194c1(0xea))/0x7*(parseInt(_0x1194c1(0xda))/0x8)+-parseInt(_0x1194c1(0xe1))/0x9*(parseInt(_0x1194c1(0xf7))/0xa)+-parseInt(_0x1194c1(0xd3))/0xb*(-parseInt(_0x1194c1(0xd5))/0xc);if(_0x1d1c23===_0x32ad7c)break;else _0x5887e2['push'](_0x5887e2['shift']());}catch(_0x371324){_0x5887e2['push'](_0x5887e2['shift']());}}}(_0x389f,0x8097b));Object[_0xb8e18(0xe5)](exports,_0xb8e18(0xee),{'value':!![]}),exports[_0xb8e18(0xe7)]=void 0x0;const uuid_1=require('uuid'),tiktoken_1=require(_0xb8e18(0xdb)),tokenizer=(0x0,tiktoken_1[_0xb8e18(0xf2)])(_0xb8e18(0xef));class NineStore{constructor(_0x5a8214){const _0x4dcf6e=_0xb8e18,{store:_0x528027,namespace:_0x510722,expires:_0x1c81b2}=this['formatOptions'](_0x5a8214);this[_0x4dcf6e(0xd2)]=_0x528027,this['namespace']=_0x510722,this[_0x4dcf6e(0xf4)]=_0x1c81b2;}['formatOptions'](_0x1a6bbf){const {store:_0x4a2023,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace='chat'}=_0x1a6bbf;return{'store':_0x4a2023,'namespace':namespace,'expires':expires};}[_0xb8e18(0xed)](_0x3cac87){const _0x15efdb=_0xb8e18;return this[_0x15efdb(0xf3)]?this['namespace']+'-'+_0x3cac87:_0x3cac87;}async[_0xb8e18(0xe6)](_0x4f4ba0){const _0x3f084c=_0xb8e18,_0x2752e5=await this['store'][_0x3f084c(0xd8)](_0x4f4ba0);return _0x2752e5;}async[_0xb8e18(0xe4)](_0x53a77a,_0x3cdb84=this[_0xb8e18(0xf4)]){const _0x11352d=_0xb8e18;await this[_0x11352d(0xd2)]['set'](_0x53a77a['id'],_0x53a77a,_0x3cdb84);}async[_0xb8e18(0xd9)](_0xe980eb,_0xdaed6d){const _0x4a01b9=_0xb8e18;let {maxRounds:_0x47859f,maxModelToken:_0x2ae39c,maxResponseTokens:_0x8860f7,systemMessage:systemMessage='',name:_0x1c9a9f}=_0xdaed6d,{parentMessageId:_0x4b8906}=_0xdaed6d,_0x1f2bfb=[],_0x3ab1ef=0x0;systemMessage&&_0x1f2bfb[_0x4a01b9(0xeb)]({'role':'system','content':systemMessage});const _0x13660b=_0x1f2bfb[_0x4a01b9(0xde)];let _0x500541=0x0,_0xb35b14=_0xe980eb?_0x1f2bfb[_0x4a01b9(0xd7)]([{'role':_0x4a01b9(0xe2),'content':_0xe980eb,'name':_0x1c9a9f}]):_0x1f2bfb;do{if(!_0x4b8906)break;const _0x372727=await this['getData'](_0x4b8906);if(!_0x372727)break;const {text:_0x42eee5,name:_0x3f36cb,role:_0x44e421}=_0x372727;_0xb35b14=_0xb35b14[_0x4a01b9(0xdc)](0x0,_0x13660b)[_0x4a01b9(0xd7)]([{'role':_0x44e421,'content':_0x42eee5,'name':_0x3f36cb},..._0xb35b14['slice'](_0x13660b)]),_0x500541++;if(_0x47859f&&_0x500541>=_0x47859f)break;if(_0x2ae39c&&_0x8860f7){const _0x35c6e7=_0x2ae39c-_0x8860f7;_0x3ab1ef=await this[_0x4a01b9(0xdd)](_0xb35b14);const _0x4db84d=_0x3ab1ef+0xc8<=_0x35c6e7;!_0x4db84d&&(_0xb35b14=this[_0x4a01b9(0xf5)](_0x1f2bfb,_0x35c6e7,systemMessage));}_0x4b8906=_0x372727[_0x4a01b9(0xe9)];}while(!![]);const _0x3a3630=Math[_0x4a01b9(0xf6)](0x1,Math['min'](_0x2ae39c-_0x3ab1ef,_0x8860f7));return _0xb35b14;}async[_0xb8e18(0xdd)](_0x5474dd){const _0x2849fc=_0xb8e18;let _0x4d134c=_0x5474dd[_0x2849fc(0xd6)]((_0x1077e2,_0x1504f5)=>{return _0x1077e2+=_0x1504f5['content'];},'');return console[_0x2849fc(0xd1)](_0x2849fc(0xdf),_0x4d134c),_0x4d134c=_0x4d134c[_0x2849fc(0xe0)](/<\|endoftext\|>/g,''),tokenizer[_0x2849fc(0xe8)](_0x4d134c)[_0x2849fc(0xde)];}async[_0xb8e18(0xf5)](_0x489cca,_0x12e9f7,_0x52f2d5){const _0x3a76e5=_0xb8e18,_0x249bf9=await this['_getTokenCount'](_0x489cca);if(_0x249bf9<=_0x12e9f7)return _0x489cca;return _0x489cca[_0x3a76e5(0xd0)](_0x52f2d5?0x1:0x0,0x1),this[_0x3a76e5(0xf5)](_0x489cca,_0x12e9f7,_0x52f2d5);}['getUuid'](){return(0x0,uuid_1['v4'])();}}exports[_0xb8e18(0xe7)]=NineStore;