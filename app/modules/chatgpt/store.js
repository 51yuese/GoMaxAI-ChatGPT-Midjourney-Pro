'use strict';function _0x1428(){const _0x40ffdc=['max','12tQGzud','getData','_getTokenCount','1325Ugcymt','log','__esModule','buildMessageFromParentMessageId','store','formatOptions','get','generateKey','45089979AWCOGR','110704GBRRRq','get_encoding','defineProperty','uuid','6438616pFmVHi','8928tPVvrm','min','reduce','system','6vNBOJF','5134419rUFBiO','@dqbd/tiktoken','NineStore','chat','user','namespace','getUuid','cl100k_base','_recursivePruning','5693044GBMLbh','expires','encode','10bNwxZp','push','parentMessageId','1316967PpqLLu','content'];_0x1428=function(){return _0x40ffdc;};return _0x1428();}const _0x26372f=_0x4718;(function(_0x49aa82,_0x57571d){const _0x30aa03=_0x4718,_0x3ecd2a=_0x49aa82();while(!![]){try{const _0x313298=parseInt(_0x30aa03(0xfe))/0x1+parseInt(_0x30aa03(0xdf))/0x2*(-parseInt(_0x30aa03(0xef))/0x3)+parseInt(_0x30aa03(0x103))/0x4*(-parseInt(_0x30aa03(0xf5))/0x5)+-parseInt(_0x30aa03(0xf2))/0x6*(parseInt(_0x30aa03(0xe9))/0x7)+parseInt(_0x30aa03(0x102))/0x8+parseInt(_0x30aa03(0xe0))/0x9*(-parseInt(_0x30aa03(0xec))/0xa)+parseInt(_0x30aa03(0xfd))/0xb;if(_0x313298===_0x57571d)break;else _0x3ecd2a['push'](_0x3ecd2a['shift']());}catch(_0x2f42d1){_0x3ecd2a['push'](_0x3ecd2a['shift']());}}}(_0x1428,0xddf2a));Object[_0x26372f(0x100)](exports,_0x26372f(0xf7),{'value':!![]}),exports[_0x26372f(0xe2)]=void 0x0;const uuid_1=require(_0x26372f(0x101)),tiktoken_1=require(_0x26372f(0xe1)),tokenizer=(0x0,tiktoken_1[_0x26372f(0xff)])(_0x26372f(0xe7));class NineStore{constructor(_0x2afc71){const _0x12de06=_0x26372f,{store:_0x35bff4,namespace:_0xbbba6,expires:_0x5183ba}=this[_0x12de06(0xfa)](_0x2afc71);this['store']=_0x35bff4,this[_0x12de06(0xe5)]=_0xbbba6,this[_0x12de06(0xea)]=_0x5183ba;}['formatOptions'](_0x44f0df){const _0xa09a6d=_0x26372f,{store:_0x5bd131,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0xa09a6d(0xe3)}=_0x44f0df;return{'store':_0x5bd131,'namespace':namespace,'expires':expires};}[_0x26372f(0xfc)](_0x5e85c6){const _0x51798e=_0x26372f;return this[_0x51798e(0xe5)]?this[_0x51798e(0xe5)]+'-'+_0x5e85c6:_0x5e85c6;}async[_0x26372f(0xf3)](_0x34169b){const _0x2111ab=_0x26372f,_0x3a1a95=await this[_0x2111ab(0xf9)][_0x2111ab(0xfb)](_0x34169b);return _0x3a1a95;}async['setData'](_0x215ded,_0x11ea2f=this[_0x26372f(0xea)]){const _0x1689be=_0x26372f;await this[_0x1689be(0xf9)]['set'](_0x215ded['id'],_0x215ded,_0x11ea2f);}async[_0x26372f(0xf8)](_0x439586,_0xcf605a){const _0x1fab27=_0x26372f;let {maxRounds:_0x471655,maxModelToken:_0x4ceb41,maxResponseTokens:_0x7c3fa,systemMessage:systemMessage='',name:_0x17a7f1}=_0xcf605a,{parentMessageId:_0xd0c72b}=_0xcf605a,_0x1de541=[],_0x48d3d2=0x0;systemMessage&&_0x1de541[_0x1fab27(0xed)]({'role':_0x1fab27(0x106),'content':systemMessage});const _0x56e9e8=_0x1de541['length'];let _0x581068=0x0,_0x44fef8=_0x439586?_0x1de541['concat']([{'role':_0x1fab27(0xe4),'content':_0x439586,'name':_0x17a7f1}]):_0x1de541;do{if(!_0xd0c72b)break;const _0x12ab05=await this[_0x1fab27(0xf3)](_0xd0c72b);if(!_0x12ab05)break;const {text:_0x413536,name:_0x1ceb53,role:_0x42957b}=_0x12ab05;_0x44fef8=_0x44fef8['slice'](0x0,_0x56e9e8)['concat']([{'role':_0x42957b,'content':_0x413536,'name':_0x1ceb53},..._0x44fef8['slice'](_0x56e9e8)]),_0x581068++;if(_0x471655&&_0x581068>=_0x471655)break;if(_0x4ceb41&&_0x7c3fa){const _0x3e6bb6=_0x4ceb41-_0x7c3fa;_0x48d3d2=await this[_0x1fab27(0xf4)](_0x44fef8);const _0x1bbbbc=_0x48d3d2+0xc8<=_0x3e6bb6;!_0x1bbbbc&&(_0x44fef8=this[_0x1fab27(0xe8)](_0x1de541,_0x3e6bb6,systemMessage));}_0xd0c72b=_0x12ab05[_0x1fab27(0xee)];}while(!![]);const _0x363bf8=Math[_0x1fab27(0xf1)](0x1,Math[_0x1fab27(0x104)](_0x4ceb41-_0x48d3d2,_0x7c3fa));return _0x44fef8;}async[_0x26372f(0xf4)](_0x744375){const _0x1505fc=_0x26372f;let _0x2e2a69=_0x744375[_0x1505fc(0x105)]((_0x11f714,_0x23a445)=>{const _0x2316c7=_0x1505fc;return _0x11f714+=_0x23a445[_0x2316c7(0xf0)];},'');return console[_0x1505fc(0xf6)]('汇总的文本数量:\x20',_0x2e2a69),_0x2e2a69=_0x2e2a69['replace'](/<\|endoftext\|>/g,''),tokenizer[_0x1505fc(0xeb)](_0x2e2a69)['length'];}async[_0x26372f(0xe8)](_0x6b409b,_0x323a0b,_0x1ef84a){const _0x238d17=_0x26372f,_0x1c1a55=await this[_0x238d17(0xf4)](_0x6b409b);if(_0x1c1a55<=_0x323a0b)return _0x6b409b;return _0x6b409b['splice'](_0x1ef84a?0x1:0x0,0x1),this[_0x238d17(0xe8)](_0x6b409b,_0x323a0b,_0x1ef84a);}[_0x26372f(0xe6)](){return(0x0,uuid_1['v4'])();}}function _0x4718(_0x21a025,_0x11fb89){const _0x142863=_0x1428();return _0x4718=function(_0x47187b,_0x24232b){_0x47187b=_0x47187b-0xdf;let _0x35502d=_0x142863[_0x47187b];return _0x35502d;},_0x4718(_0x21a025,_0x11fb89);}exports[_0x26372f(0xe2)]=NineStore;