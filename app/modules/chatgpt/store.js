'use strict';const _0x1bbb73=_0x4b0b;(function(_0x57e909,_0x1e5b3f){const _0x1020f5=_0x4b0b,_0x1aef45=_0x57e909();while(!![]){try{const _0x5f2416=-parseInt(_0x1020f5(0x1d9))/0x1+parseInt(_0x1020f5(0x1cc))/0x2*(parseInt(_0x1020f5(0x1d4))/0x3)+parseInt(_0x1020f5(0x1c7))/0x4+parseInt(_0x1020f5(0x1de))/0x5+-parseInt(_0x1020f5(0x1d7))/0x6*(-parseInt(_0x1020f5(0x1e9))/0x7)+-parseInt(_0x1020f5(0x1e2))/0x8+parseInt(_0x1020f5(0x1d1))/0x9;if(_0x5f2416===_0x1e5b3f)break;else _0x1aef45['push'](_0x1aef45['shift']());}catch(_0x47169f){_0x1aef45['push'](_0x1aef45['shift']());}}}(_0x162f,0x68d7f));function _0x4b0b(_0x4a3c33,_0x1500fe){const _0x162fca=_0x162f();return _0x4b0b=function(_0x4b0b5b,_0x15240a){_0x4b0b5b=_0x4b0b5b-0x1c5;let _0xf4cd58=_0x162fca[_0x4b0b5b];return _0xf4cd58;},_0x4b0b(_0x4a3c33,_0x1500fe);}function _0x162f(){const _0x3498c8=['namespace','replace','6033784qRRGCE','__esModule','reduce','store','concat','formatOptions','getUuid','1148203uYLPPY','push','expires','log','1746700OsLsxe','setData','length','汇总的文本数量:\x20','slice','1512ZSEdrh','get','_recursivePruning','set','min','180477rqWfnO','system','max','828eqNujy','get_encoding','cl100k_base','12YNdJma','uuid','367914ZIQHMk','_getTokenCount','user','defineProperty','getData','2790670xibgRH','chat'];_0x162f=function(){return _0x3498c8;};return _0x162f();}Object[_0x1bbb73(0x1dc)](exports,_0x1bbb73(0x1e3),{'value':!![]}),exports['NineStore']=void 0x0;const uuid_1=require(_0x1bbb73(0x1d8)),tiktoken_1=require('@dqbd/tiktoken'),tokenizer=(0x0,tiktoken_1[_0x1bbb73(0x1d5)])(_0x1bbb73(0x1d6));class NineStore{constructor(_0x5a96c0){const _0x20d387=_0x1bbb73,{store:_0x5348b1,namespace:_0x289f3f,expires:_0x3019bf}=this[_0x20d387(0x1e7)](_0x5a96c0);this[_0x20d387(0x1e5)]=_0x5348b1,this[_0x20d387(0x1e0)]=_0x289f3f,this['expires']=_0x3019bf;}[_0x1bbb73(0x1e7)](_0x53c47d){const _0x16776f=_0x1bbb73,{store:_0x5a1f4b,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x16776f(0x1df)}=_0x53c47d;return{'store':_0x5a1f4b,'namespace':namespace,'expires':expires};}['generateKey'](_0x439c91){const _0x5e035e=_0x1bbb73;return this[_0x5e035e(0x1e0)]?this['namespace']+'-'+_0x439c91:_0x439c91;}async['getData'](_0x54ae4c){const _0x37abd1=_0x1bbb73,_0x5bb651=await this['store'][_0x37abd1(0x1cd)](_0x54ae4c);return _0x5bb651;}async[_0x1bbb73(0x1c8)](_0x79ef4e,_0x32b63f=this[_0x1bbb73(0x1c5)]){const _0x241cc9=_0x1bbb73;await this[_0x241cc9(0x1e5)][_0x241cc9(0x1cf)](_0x79ef4e['id'],_0x79ef4e,_0x32b63f);}async['buildMessageFromParentMessageId'](_0x18c614,_0x2cc733){const _0x246d27=_0x1bbb73;let {maxRounds:_0x543546,maxModelToken:_0x417379,maxResponseTokens:_0x13f8e5,systemMessage:systemMessage='',name:_0x5e128e}=_0x2cc733,{parentMessageId:_0x33c858}=_0x2cc733,_0x242d0e=[],_0x4b059c=0x0;systemMessage&&_0x242d0e[_0x246d27(0x1ea)]({'role':_0x246d27(0x1d2),'content':systemMessage});const _0x4cfffe=_0x242d0e['length'];let _0xc828b5=0x0,_0x476e2e=_0x18c614?_0x242d0e['concat']([{'role':_0x246d27(0x1db),'content':_0x18c614,'name':_0x5e128e}]):_0x242d0e;do{if(!_0x33c858)break;const _0x14a6bd=await this[_0x246d27(0x1dd)](_0x33c858);if(!_0x14a6bd)break;const {text:_0x2cf036,name:_0x5c0b4d,role:_0x57c2af}=_0x14a6bd;_0x476e2e=_0x476e2e[_0x246d27(0x1cb)](0x0,_0x4cfffe)[_0x246d27(0x1e6)]([{'role':_0x57c2af,'content':_0x2cf036,'name':_0x5c0b4d},..._0x476e2e['slice'](_0x4cfffe)]),_0xc828b5++;if(_0x543546&&_0xc828b5>=_0x543546)break;if(_0x417379&&_0x13f8e5){const _0x1a6ba4=_0x417379-_0x13f8e5;_0x4b059c=await this[_0x246d27(0x1da)](_0x476e2e);const _0x25d3d6=_0x4b059c+0xc8<=_0x1a6ba4;!_0x25d3d6&&(_0x476e2e=this['_recursivePruning'](_0x242d0e,_0x1a6ba4,systemMessage));}_0x33c858=_0x14a6bd['parentMessageId'];}while(!![]);const _0x232669=Math[_0x246d27(0x1d3)](0x1,Math[_0x246d27(0x1d0)](_0x417379-_0x4b059c,_0x13f8e5));return _0x476e2e;}async[_0x1bbb73(0x1da)](_0x1f966f){const _0x2df74a=_0x1bbb73;let _0x3f14a1=_0x1f966f[_0x2df74a(0x1e4)]((_0x377d44,_0x5a6d60)=>{return _0x377d44+=_0x5a6d60['content'];},'');return console[_0x2df74a(0x1c6)](_0x2df74a(0x1ca),_0x3f14a1),_0x3f14a1=_0x3f14a1[_0x2df74a(0x1e1)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x3f14a1)[_0x2df74a(0x1c9)];}async[_0x1bbb73(0x1ce)](_0x1bc6e3,_0x2f327f,_0x13ddb0){const _0x374c3c=_0x1bbb73,_0x4bb81b=await this[_0x374c3c(0x1da)](_0x1bc6e3);if(_0x4bb81b<=_0x2f327f)return _0x1bc6e3;return _0x1bc6e3['splice'](_0x13ddb0?0x1:0x0,0x1),this[_0x374c3c(0x1ce)](_0x1bc6e3,_0x2f327f,_0x13ddb0);}[_0x1bbb73(0x1e8)](){return(0x0,uuid_1['v4'])();}}exports['NineStore']=NineStore;