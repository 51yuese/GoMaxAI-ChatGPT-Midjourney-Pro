'use strict';const _0x59d5eb=_0xa68d;(function(_0x35c9fa,_0x792454){const _0xce9c0e=_0xa68d,_0x37d9d8=_0x35c9fa();while(!![]){try{const _0x1bcf53=-parseInt(_0xce9c0e(0x11a))/0x1*(-parseInt(_0xce9c0e(0x120))/0x2)+parseInt(_0xce9c0e(0x133))/0x3*(parseInt(_0xce9c0e(0x129))/0x4)+-parseInt(_0xce9c0e(0x11e))/0x5*(-parseInt(_0xce9c0e(0x13b))/0x6)+parseInt(_0xce9c0e(0x11b))/0x7*(parseInt(_0xce9c0e(0x12a))/0x8)+parseInt(_0xce9c0e(0x12d))/0x9+-parseInt(_0xce9c0e(0x127))/0xa+parseInt(_0xce9c0e(0x13c))/0xb*(-parseInt(_0xce9c0e(0x121))/0xc);if(_0x1bcf53===_0x792454)break;else _0x37d9d8['push'](_0x37d9d8['shift']());}catch(_0x345a35){_0x37d9d8['push'](_0x37d9d8['shift']());}}}(_0x1e5a,0x51fac));Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x59d5eb(0x128)]=void 0x0;function _0xa68d(_0x236cda,_0x1f9c19){const _0x1e5ad6=_0x1e5a();return _0xa68d=function(_0xa68df1,_0x49cce2){_0xa68df1=_0xa68df1-0x118;let _0x5b405f=_0x1e5ad6[_0xa68df1];return _0x5b405f;},_0xa68d(_0x236cda,_0x1f9c19);}const uuid_1=require('uuid'),tiktoken_1=require(_0x59d5eb(0x136)),tokenizer=(0x0,tiktoken_1[_0x59d5eb(0x13a)])(_0x59d5eb(0x137));class NineStore{constructor(_0xcdcbfb){const _0x2d0c8e=_0x59d5eb,{store:_0x448a5e,namespace:_0x55d910,expires:_0x16e83e}=this['formatOptions'](_0xcdcbfb);this['store']=_0x448a5e,this[_0x2d0c8e(0x11d)]=_0x55d910,this['expires']=_0x16e83e;}[_0x59d5eb(0x11f)](_0x44afb8){const _0x27883f=_0x59d5eb,{store:_0x39e3f3,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x27883f(0x13d)}=_0x44afb8;return{'store':_0x39e3f3,'namespace':namespace,'expires':expires};}['generateKey'](_0x151938){const _0xb22ec7=_0x59d5eb;return this[_0xb22ec7(0x11d)]?this[_0xb22ec7(0x11d)]+'-'+_0x151938:_0x151938;}async[_0x59d5eb(0x123)](_0xb86f3c){const _0x40f3d2=_0x59d5eb,_0x3feb3b=await this[_0x40f3d2(0x119)][_0x40f3d2(0x122)](_0xb86f3c);return _0x3feb3b;}async[_0x59d5eb(0x125)](_0x161a00,_0x12169b=this[_0x59d5eb(0x138)]){const _0xb5c48f=_0x59d5eb;await this[_0xb5c48f(0x119)]['set'](_0x161a00['id'],_0x161a00,_0x12169b);}async['buildMessageFromParentMessageId'](_0x13eef4,_0x3f7b62){const _0x348a75=_0x59d5eb;let {maxRounds:_0x205d0c,maxModelToken:_0x41afb4,maxResponseTokens:_0x220e40,systemMessage:systemMessage='',name:_0x5106f9}=_0x3f7b62,{parentMessageId:_0x425987}=_0x3f7b62,_0x1cb4b6=[],_0x25dfa2=0x0;systemMessage&&_0x1cb4b6[_0x348a75(0x135)]({'role':'system','content':systemMessage});const _0x36e4da=_0x1cb4b6[_0x348a75(0x12c)];let _0x2172b8=0x0,_0x5d1895=_0x13eef4?_0x1cb4b6['concat']([{'role':'user','content':_0x13eef4,'name':_0x5106f9}]):_0x1cb4b6;do{if(!_0x425987)break;const _0x4aeae1=await this[_0x348a75(0x123)](_0x425987);if(!_0x4aeae1)break;const {text:_0x40ce2b,name:_0x4a57fa,role:_0x294738}=_0x4aeae1;_0x5d1895=_0x5d1895[_0x348a75(0x139)](0x0,_0x36e4da)[_0x348a75(0x11c)]([{'role':_0x294738,'content':_0x40ce2b,'name':_0x4a57fa},..._0x5d1895['slice'](_0x36e4da)]),_0x2172b8++;if(_0x205d0c&&_0x2172b8>=_0x205d0c)break;if(_0x41afb4&&_0x220e40){const _0x20d2c6=_0x41afb4-_0x220e40;_0x25dfa2=await this[_0x348a75(0x12b)](_0x5d1895);const _0x383ab8=_0x25dfa2+0xc8<=_0x20d2c6;!_0x383ab8&&(_0x5d1895=this[_0x348a75(0x134)](_0x1cb4b6,_0x20d2c6,systemMessage));}_0x425987=_0x4aeae1[_0x348a75(0x12f)];}while(!![]);const _0x31c094=Math[_0x348a75(0x130)](0x1,Math[_0x348a75(0x118)](_0x41afb4-_0x25dfa2,_0x220e40));return _0x5d1895;}async['_getTokenCount'](_0x4a551c){const _0x1ac26f=_0x59d5eb;let _0x115bce=_0x4a551c[_0x1ac26f(0x126)]((_0x15427e,_0x4eb5c0)=>{const _0x471d72=_0x1ac26f;return _0x15427e+=_0x4eb5c0[_0x471d72(0x132)];},'');return console['log']('汇总的文本数量:\x20',_0x115bce),_0x115bce=_0x115bce[_0x1ac26f(0x131)](/<\|endoftext\|>/g,''),tokenizer[_0x1ac26f(0x124)](_0x115bce)[_0x1ac26f(0x12c)];}async['_recursivePruning'](_0x3cac3f,_0x25d89a,_0x4d6b0f){const _0x1e08e5=_0x59d5eb,_0x2f460d=await this[_0x1e08e5(0x12b)](_0x3cac3f);if(_0x2f460d<=_0x25d89a)return _0x3cac3f;return _0x3cac3f['splice'](_0x4d6b0f?0x1:0x0,0x1),this[_0x1e08e5(0x134)](_0x3cac3f,_0x25d89a,_0x4d6b0f);}[_0x59d5eb(0x12e)](){return(0x0,uuid_1['v4'])();}}function _0x1e5a(){const _0x5d70ae=['_getTokenCount','length','4220055sLBpbA','getUuid','parentMessageId','max','replace','content','534522YZjTnO','_recursivePruning','push','@dqbd/tiktoken','cl100k_base','expires','slice','get_encoding','456mVoold','95722hPSkcu','chat','min','store','178805UoERav','49APTQui','concat','namespace','29135OqRlxb','formatOptions','2FYdCiM','1740sRaaey','get','getData','encode','setData','reduce','363450LotPAn','NineStore','4CUYJRe','417368zFQYaX'];_0x1e5a=function(){return _0x5d70ae;};return _0x1e5a();}exports[_0x59d5eb(0x128)]=NineStore;