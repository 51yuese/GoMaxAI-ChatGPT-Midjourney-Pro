'use strict';const _0x447cad=_0x1aad;(function(_0x3bb4b6,_0xbde3b6){const _0x5d4a21=_0x1aad,_0x43b34f=_0x3bb4b6();while(!![]){try{const _0x5d0da7=parseInt(_0x5d4a21(0x18c))/0x1*(parseInt(_0x5d4a21(0x174))/0x2)+parseInt(_0x5d4a21(0x188))/0x3+-parseInt(_0x5d4a21(0x183))/0x4*(-parseInt(_0x5d4a21(0x181))/0x5)+-parseInt(_0x5d4a21(0x18a))/0x6*(-parseInt(_0x5d4a21(0x182))/0x7)+parseInt(_0x5d4a21(0x189))/0x8+parseInt(_0x5d4a21(0x186))/0x9*(parseInt(_0x5d4a21(0x167))/0xa)+parseInt(_0x5d4a21(0x16d))/0xb*(-parseInt(_0x5d4a21(0x173))/0xc);if(_0x5d0da7===_0xbde3b6)break;else _0x43b34f['push'](_0x43b34f['shift']());}catch(_0x3ea722){_0x43b34f['push'](_0x43b34f['shift']());}}}(_0x1148,0x2291f));Object[_0x447cad(0x171)](exports,_0x447cad(0x16a),{'value':!![]}),exports['NineStore']=void 0x0;function _0x1148(){const _0x561695=['2008mqZJhj','expires','setData','565875cBZGje','汇总的文本数量:\x20','189444UNukSB','89160rSQsqZ','24ReDqDN','reduce','1unNyzi','_recursivePruning','NineStore','concat','push','_getTokenCount','40cpzxBr','cl100k_base','slice','__esModule','@dqbd/tiktoken','encode','2057Eymaxx','length','store','getData','defineProperty','get_encoding','26076ZuebuM','178342PbhfJZ','content','replace','user','set','getUuid','generateKey','chat','parentMessageId','formatOptions','buildMessageFromParentMessageId','namespace','max','5IQvxpe','231847bZaQVY'];_0x1148=function(){return _0x561695;};return _0x1148();}function _0x1aad(_0x209336,_0x2c653b){const _0x114852=_0x1148();return _0x1aad=function(_0x1aad81,_0x367249){_0x1aad81=_0x1aad81-0x163;let _0x102937=_0x114852[_0x1aad81];return _0x102937;},_0x1aad(_0x209336,_0x2c653b);}const uuid_1=require('uuid'),tiktoken_1=require(_0x447cad(0x16b)),tokenizer=(0x0,tiktoken_1[_0x447cad(0x172)])(_0x447cad(0x168));class NineStore{constructor(_0x38125d){const _0x2b8e9d=_0x447cad,{store:_0x5b5506,namespace:_0x4e7c8e,expires:_0x32f99e}=this[_0x2b8e9d(0x17d)](_0x38125d);this['store']=_0x5b5506,this['namespace']=_0x4e7c8e,this[_0x2b8e9d(0x184)]=_0x32f99e;}[_0x447cad(0x17d)](_0x18365b){const _0x2623fb=_0x447cad,{store:_0x1fea30,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x2623fb(0x17b)}=_0x18365b;return{'store':_0x1fea30,'namespace':namespace,'expires':expires};}[_0x447cad(0x17a)](_0x5ef826){const _0x467011=_0x447cad;return this['namespace']?this[_0x467011(0x17f)]+'-'+_0x5ef826:_0x5ef826;}async[_0x447cad(0x170)](_0x4f4729){const _0x4d1bc8=_0x447cad,_0x3b79f=await this[_0x4d1bc8(0x16f)]['get'](_0x4f4729);return _0x3b79f;}async[_0x447cad(0x185)](_0x3eefee,_0x166c0c=this[_0x447cad(0x184)]){const _0x5eb7a8=_0x447cad;await this[_0x5eb7a8(0x16f)][_0x5eb7a8(0x178)](_0x3eefee['id'],_0x3eefee,_0x166c0c);}async[_0x447cad(0x17e)](_0x4be37f,_0x4d08b6){const _0x515a53=_0x447cad;let {maxRounds:_0x3112c2,maxModelToken:_0x178bb6,maxResponseTokens:_0x3fdf99,systemMessage:systemMessage='',name:_0x1855be}=_0x4d08b6,{parentMessageId:_0x38179c}=_0x4d08b6,_0x39c0bb=[],_0x33db93=0x0;systemMessage&&_0x39c0bb[_0x515a53(0x165)]({'role':'system','content':systemMessage});const _0x365211=_0x39c0bb[_0x515a53(0x16e)];let _0x22acb3=0x0,_0x21947e=_0x4be37f?_0x39c0bb['concat']([{'role':_0x515a53(0x177),'content':_0x4be37f,'name':_0x1855be}]):_0x39c0bb;do{if(!_0x38179c)break;const _0x56350d=await this[_0x515a53(0x170)](_0x38179c);if(!_0x56350d)break;const {text:_0x257e1c,name:_0x59b264,role:_0x1be640}=_0x56350d;_0x21947e=_0x21947e[_0x515a53(0x169)](0x0,_0x365211)[_0x515a53(0x164)]([{'role':_0x1be640,'content':_0x257e1c,'name':_0x59b264},..._0x21947e[_0x515a53(0x169)](_0x365211)]),_0x22acb3++;if(_0x3112c2&&_0x22acb3>=_0x3112c2)break;if(_0x178bb6&&_0x3fdf99){const _0x3916ac=_0x178bb6-_0x3fdf99;_0x33db93=await this['_getTokenCount'](_0x21947e);const _0x1c0fa0=_0x33db93+0xc8<=_0x3916ac;!_0x1c0fa0&&(_0x21947e=this[_0x515a53(0x18d)](_0x39c0bb,_0x3916ac,systemMessage));}_0x38179c=_0x56350d[_0x515a53(0x17c)];}while(!![]);const _0x2c58d8=Math[_0x515a53(0x180)](0x1,Math['min'](_0x178bb6-_0x33db93,_0x3fdf99));return _0x21947e;}async[_0x447cad(0x166)](_0x23e2f8){const _0x24626b=_0x447cad;let _0x4989dc=_0x23e2f8[_0x24626b(0x18b)]((_0x75735c,_0x34a11a)=>{const _0x39865d=_0x24626b;return _0x75735c+=_0x34a11a[_0x39865d(0x175)];},'');return console['log'](_0x24626b(0x187),_0x4989dc),_0x4989dc=_0x4989dc[_0x24626b(0x176)](/<\|endoftext\|>/g,''),tokenizer[_0x24626b(0x16c)](_0x4989dc)[_0x24626b(0x16e)];}async[_0x447cad(0x18d)](_0x409ea5,_0x2e1313,_0x4a0e2e){const _0x21b247=_0x447cad,_0x4398c9=await this[_0x21b247(0x166)](_0x409ea5);if(_0x4398c9<=_0x2e1313)return _0x409ea5;return _0x409ea5['splice'](_0x4a0e2e?0x1:0x0,0x1),this[_0x21b247(0x18d)](_0x409ea5,_0x2e1313,_0x4a0e2e);}[_0x447cad(0x179)](){return(0x0,uuid_1['v4'])();}}exports[_0x447cad(0x163)]=NineStore;