'use strict';function _0x2ffd(_0x465160,_0x4f5691){const _0x2bd516=_0x2bd5();return _0x2ffd=function(_0x2ffd0e,_0x29d384){_0x2ffd0e=_0x2ffd0e-0x12b;let _0x29929e=_0x2bd516[_0x2ffd0e];return _0x29929e;},_0x2ffd(_0x465160,_0x4f5691);}const _0x86ebed=_0x2ffd;(function(_0x5c8308,_0xc605a5){const _0x4e1d85=_0x2ffd,_0x51a1fe=_0x5c8308();while(!![]){try{const _0x4e942b=parseInt(_0x4e1d85(0x13c))/0x1+parseInt(_0x4e1d85(0x130))/0x2*(-parseInt(_0x4e1d85(0x13a))/0x3)+-parseInt(_0x4e1d85(0x13d))/0x4+parseInt(_0x4e1d85(0x13f))/0x5*(parseInt(_0x4e1d85(0x13b))/0x6)+parseInt(_0x4e1d85(0x12d))/0x7*(-parseInt(_0x4e1d85(0x12c))/0x8)+parseInt(_0x4e1d85(0x151))/0x9+parseInt(_0x4e1d85(0x137))/0xa*(parseInt(_0x4e1d85(0x144))/0xb);if(_0x4e942b===_0xc605a5)break;else _0x51a1fe['push'](_0x51a1fe['shift']());}catch(_0x22c4ce){_0x51a1fe['push'](_0x51a1fe['shift']());}}}(_0x2bd5,0xdf3da));Object[_0x86ebed(0x135)](exports,_0x86ebed(0x153),{'value':!![]}),exports[_0x86ebed(0x133)]=void 0x0;const uuid_1=require(_0x86ebed(0x14e)),tiktoken_1=require(_0x86ebed(0x154)),tokenizer=(0x0,tiktoken_1[_0x86ebed(0x14d)])(_0x86ebed(0x147));class NineStore{constructor(_0x5f160a){const _0x28a50d=_0x86ebed,{store:_0x172922,namespace:_0xf18503,expires:_0x34a372}=this[_0x28a50d(0x131)](_0x5f160a);this[_0x28a50d(0x146)]=_0x172922,this['namespace']=_0xf18503,this[_0x28a50d(0x143)]=_0x34a372;}[_0x86ebed(0x131)](_0x101a8c){const {store:_0x4df347,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace='chat'}=_0x101a8c;return{'store':_0x4df347,'namespace':namespace,'expires':expires};}[_0x86ebed(0x152)](_0x256b03){const _0x483bac=_0x86ebed;return this['namespace']?this[_0x483bac(0x139)]+'-'+_0x256b03:_0x256b03;}async[_0x86ebed(0x12e)](_0x9567c0){const _0x3f403f=await this['store']['get'](_0x9567c0);return _0x3f403f;}async[_0x86ebed(0x145)](_0x4df9f3,_0x3e3e99=this['expires']){const _0x3c457c=_0x86ebed;await this[_0x3c457c(0x146)]['set'](_0x4df9f3['id'],_0x4df9f3,_0x3e3e99);}async[_0x86ebed(0x134)](_0xb83f64,_0x453f3d){const _0x544e71=_0x86ebed;let {maxRounds:_0x1f2a7a,maxModelToken:_0x49909f,maxResponseTokens:_0x5355ae,systemMessage:systemMessage='',name:_0x4d7364}=_0x453f3d,{parentMessageId:_0x5d81d9}=_0x453f3d,_0x296eac=[],_0x2e7fdc=0x0;systemMessage&&_0x296eac[_0x544e71(0x142)]({'role':_0x544e71(0x149),'content':systemMessage});const _0x4ca065=_0x296eac[_0x544e71(0x140)];let _0x4714a2=0x0,_0x20b114=_0xb83f64?_0x296eac['concat']([{'role':'user','content':_0xb83f64,'name':_0x4d7364}]):_0x296eac;do{if(!_0x5d81d9)break;const _0x390265=await this[_0x544e71(0x12e)](_0x5d81d9);if(!_0x390265)break;const {text:_0x433b27,name:_0x118652,role:_0x46bea6}=_0x390265;_0x20b114=_0x20b114[_0x544e71(0x14a)](0x0,_0x4ca065)[_0x544e71(0x14b)]([{'role':_0x46bea6,'content':_0x433b27,'name':_0x118652},..._0x20b114['slice'](_0x4ca065)]),_0x4714a2++;if(_0x1f2a7a&&_0x4714a2>=_0x1f2a7a)break;if(_0x49909f&&_0x5355ae){const _0x4eb3c7=_0x49909f-_0x5355ae;_0x2e7fdc=await this[_0x544e71(0x12b)](_0x20b114);const _0x4b591a=_0x2e7fdc+0xc8<=_0x4eb3c7;!_0x4b591a&&(_0x20b114=this[_0x544e71(0x13e)](_0x296eac,_0x4eb3c7,systemMessage));}_0x5d81d9=_0x390265[_0x544e71(0x136)];}while(!![]);const _0x45a1a5=Math[_0x544e71(0x12f)](0x1,Math[_0x544e71(0x14c)](_0x49909f-_0x2e7fdc,_0x5355ae));return _0x20b114;}async[_0x86ebed(0x12b)](_0x439508){const _0x2129dd=_0x86ebed;let _0x5aec93=_0x439508[_0x2129dd(0x14f)]((_0xcb77e6,_0x1e7aba)=>{const _0x393ce6=_0x2129dd;return _0xcb77e6+=_0x1e7aba[_0x393ce6(0x148)];},'');return console[_0x2129dd(0x138)](_0x2129dd(0x141),_0x5aec93),_0x5aec93=_0x5aec93[_0x2129dd(0x132)](/<\|endoftext\|>/g,''),tokenizer['encode'](_0x5aec93)['length'];}async[_0x86ebed(0x13e)](_0x174e6d,_0x38c2d7,_0x13e794){const _0x5b1ec6=_0x86ebed,_0x2b8007=await this[_0x5b1ec6(0x12b)](_0x174e6d);if(_0x2b8007<=_0x38c2d7)return _0x174e6d;return _0x174e6d[_0x5b1ec6(0x150)](_0x13e794?0x1:0x0,0x1),this['_recursivePruning'](_0x174e6d,_0x38c2d7,_0x13e794);}[_0x86ebed(0x155)](){return(0x0,uuid_1['v4'])();}}exports[_0x86ebed(0x133)]=NineStore;function _0x2bd5(){const _0xbec7b2=['_getTokenCount','5271048sOJbjz','14toypcs','getData','max','2058hcJSYy','formatOptions','replace','NineStore','buildMessageFromParentMessageId','defineProperty','parentMessageId','490tarirp','log','namespace','4374SpNyXp','7014GlekUB','692081xXQNCK','714204yBdTIL','_recursivePruning','3265OBPzWW','length','汇总的文本数量:\x20','push','expires','299915QVLiRA','setData','store','cl100k_base','content','system','slice','concat','min','get_encoding','uuid','reduce','splice','10076094TTdjPN','generateKey','__esModule','@dqbd/tiktoken','getUuid'];_0x2bd5=function(){return _0xbec7b2;};return _0x2bd5();}