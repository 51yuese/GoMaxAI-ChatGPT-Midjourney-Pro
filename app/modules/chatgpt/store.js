'use strict';const _0x291f50=_0x262e;function _0x262e(_0x3b3c70,_0x90c41){const _0x3abe81=_0x3abe();return _0x262e=function(_0x262e65,_0x826f66){_0x262e65=_0x262e65-0x1b0;let _0x11ad99=_0x3abe81[_0x262e65];return _0x11ad99;},_0x262e(_0x3b3c70,_0x90c41);}(function(_0x3d61ba,_0x465819){const _0x1f3c1d=_0x262e,_0x40d940=_0x3d61ba();while(!![]){try{const _0x23e9f6=-parseInt(_0x1f3c1d(0x1b5))/0x1+parseInt(_0x1f3c1d(0x1d7))/0x2*(parseInt(_0x1f3c1d(0x1d8))/0x3)+parseInt(_0x1f3c1d(0x1c4))/0x4*(parseInt(_0x1f3c1d(0x1b7))/0x5)+parseInt(_0x1f3c1d(0x1dc))/0x6+-parseInt(_0x1f3c1d(0x1d1))/0x7*(parseInt(_0x1f3c1d(0x1c9))/0x8)+parseInt(_0x1f3c1d(0x1cb))/0x9*(parseInt(_0x1f3c1d(0x1d5))/0xa)+-parseInt(_0x1f3c1d(0x1c0))/0xb*(-parseInt(_0x1f3c1d(0x1bf))/0xc);if(_0x23e9f6===_0x465819)break;else _0x40d940['push'](_0x40d940['shift']());}catch(_0x450ae3){_0x40d940['push'](_0x40d940['shift']());}}}(_0x3abe,0x72566));function _0x3abe(){const _0x88aa10=['setData','splice','max','53968CZxkum','NineStore','uuid','_recursivePruning','expires','448qFNGFy','min','396hgMifJ','defineProperty','store','log','@dqbd/tiktoken','replace','103040PewjTx','content','getUuid','_getTokenCount','46610IzYeZa','汇总的文本数量:\x20','50144kxOImS','3KSgmsA','formatOptions','user','get','953400KXWQTR','getData','encode','get_encoding','push','parentMessageId','632917bKMPbt','system','225QScoQu','slice','namespace','chat','set','reduce','__esModule','concat','108qmhVzK','1135893yhuUBs'];_0x3abe=function(){return _0x88aa10;};return _0x3abe();}Object[_0x291f50(0x1cc)](exports,_0x291f50(0x1bd),{'value':!![]}),exports[_0x291f50(0x1c5)]=void 0x0;const uuid_1=require(_0x291f50(0x1c6)),tiktoken_1=require(_0x291f50(0x1cf)),tokenizer=(0x0,tiktoken_1[_0x291f50(0x1b2)])('cl100k_base');class NineStore{constructor(_0x20abdb){const _0x3c6284=_0x291f50,{store:_0x593457,namespace:_0x17b049,expires:_0x9d56c8}=this[_0x3c6284(0x1d9)](_0x20abdb);this[_0x3c6284(0x1cd)]=_0x593457,this['namespace']=_0x17b049,this['expires']=_0x9d56c8;}[_0x291f50(0x1d9)](_0x352be9){const _0x834f4d=_0x291f50,{store:_0x3fa07f,expires:expires=0x3e8*0x3c*0x3c*0x18*0x3,namespace:namespace=_0x834f4d(0x1ba)}=_0x352be9;return{'store':_0x3fa07f,'namespace':namespace,'expires':expires};}['generateKey'](_0x1f83bb){const _0xa5c880=_0x291f50;return this[_0xa5c880(0x1b9)]?this[_0xa5c880(0x1b9)]+'-'+_0x1f83bb:_0x1f83bb;}async[_0x291f50(0x1b0)](_0x2ce491){const _0x1c1171=_0x291f50,_0x5a9e9e=await this[_0x1c1171(0x1cd)][_0x1c1171(0x1db)](_0x2ce491);return _0x5a9e9e;}async[_0x291f50(0x1c1)](_0x283578,_0x464010=this[_0x291f50(0x1c8)]){const _0x20af73=_0x291f50;await this[_0x20af73(0x1cd)][_0x20af73(0x1bb)](_0x283578['id'],_0x283578,_0x464010);}async['buildMessageFromParentMessageId'](_0x59d8c5,_0x3b4c21){const _0x291cc0=_0x291f50;let {maxRounds:_0xd57673,maxModelToken:_0x59e989,maxResponseTokens:_0x4dfc3b,systemMessage:systemMessage='',name:_0x351a3f}=_0x3b4c21,{parentMessageId:_0x41f216}=_0x3b4c21,_0x33f7e4=[],_0x56224e=0x0;systemMessage&&_0x33f7e4[_0x291cc0(0x1b3)]({'role':_0x291cc0(0x1b6),'content':systemMessage});const _0x3649d6=_0x33f7e4['length'];let _0x413b51=0x0,_0x3d6502=_0x59d8c5?_0x33f7e4['concat']([{'role':_0x291cc0(0x1da),'content':_0x59d8c5,'name':_0x351a3f}]):_0x33f7e4;do{if(!_0x41f216)break;const _0x5d9e56=await this[_0x291cc0(0x1b0)](_0x41f216);if(!_0x5d9e56)break;const {text:_0xdf9e9d,name:_0x285905,role:_0x882d19}=_0x5d9e56;_0x3d6502=_0x3d6502[_0x291cc0(0x1b8)](0x0,_0x3649d6)[_0x291cc0(0x1be)]([{'role':_0x882d19,'content':_0xdf9e9d,'name':_0x285905},..._0x3d6502[_0x291cc0(0x1b8)](_0x3649d6)]),_0x413b51++;if(_0xd57673&&_0x413b51>=_0xd57673)break;if(_0x59e989&&_0x4dfc3b){const _0x32d311=_0x59e989-_0x4dfc3b;_0x56224e=await this[_0x291cc0(0x1d4)](_0x3d6502);const _0x4c3e63=_0x56224e+0xc8<=_0x32d311;!_0x4c3e63&&(_0x3d6502=this['_recursivePruning'](_0x33f7e4,_0x32d311,systemMessage));}_0x41f216=_0x5d9e56[_0x291cc0(0x1b4)];}while(!![]);const _0x4f21be=Math[_0x291cc0(0x1c3)](0x1,Math[_0x291cc0(0x1ca)](_0x59e989-_0x56224e,_0x4dfc3b));return _0x3d6502;}async['_getTokenCount'](_0x1f5103){const _0x1ee83a=_0x291f50;let _0x1fd1ee=_0x1f5103[_0x1ee83a(0x1bc)]((_0x1cb326,_0x2a6344)=>{const _0x1ad74c=_0x1ee83a;return _0x1cb326+=_0x2a6344[_0x1ad74c(0x1d2)];},'');return console[_0x1ee83a(0x1ce)](_0x1ee83a(0x1d6),_0x1fd1ee),_0x1fd1ee=_0x1fd1ee[_0x1ee83a(0x1d0)](/<\|endoftext\|>/g,''),tokenizer[_0x1ee83a(0x1b1)](_0x1fd1ee)['length'];}async[_0x291f50(0x1c7)](_0x976cdc,_0x4d3999,_0x89a1d1){const _0xf4a417=_0x291f50,_0x27c5d1=await this[_0xf4a417(0x1d4)](_0x976cdc);if(_0x27c5d1<=_0x4d3999)return _0x976cdc;return _0x976cdc[_0xf4a417(0x1c2)](_0x89a1d1?0x1:0x0,0x1),this[_0xf4a417(0x1c7)](_0x976cdc,_0x4d3999,_0x89a1d1);}[_0x291f50(0x1d3)](){return(0x0,uuid_1['v4'])();}}exports[_0x291f50(0x1c5)]=NineStore;