'use strict';const _0x32d344=_0xeae4;(function(_0xb211b7,_0x3dbb4e){const _0x2f1156=_0xeae4,_0x12723a=_0xb211b7();while(!![]){try{const _0x5aebf1=parseInt(_0x2f1156(0x1fe))/0x1+-parseInt(_0x2f1156(0x1a1))/0x2+parseInt(_0x2f1156(0x194))/0x3*(-parseInt(_0x2f1156(0x20c))/0x4)+parseInt(_0x2f1156(0x1c1))/0x5+parseInt(_0x2f1156(0x202))/0x6*(parseInt(_0x2f1156(0x1d3))/0x7)+-parseInt(_0x2f1156(0x1af))/0x8+parseInt(_0x2f1156(0x21e))/0x9;if(_0x5aebf1===_0x3dbb4e)break;else _0x12723a['push'](_0x12723a['shift']());}catch(_0x1f2495){_0x12723a['push'](_0x12723a['shift']());}}}(_0x4e3a,0x484d4));function _0x4e3a(){const _0x1280c5=['getAudioDurationByFFmpeg','FileService','HttpStatus','../cmConfig/cm.service','url','BAD_REQUEST','userService','video_task_id','1675664DYHGsG','defineProperty','@nestjs/common','post','find','fileId','-----------------------HumanPostResult---------------------------','split','vipFreeNum','-----------------------musetalkTask---------------------------','Like','text','HUMAN_VIDEO','Index/created','getMyVoices','humanPost','voiceCreated','getVoiceCloneFree','2469285tdCaes','/api/human/notify','axios','HUMAN_VOICE','https://','getPrivateKey','created','getHumanConfig','sceneId','数据不存在！','uncollect','fileService','userId','function','voiceResult','metadata','deductBalance4Human','Voice/clone','112AhUnZs','relId','Injectable','HumanApiConfig','HumanService','env','getMyWorksList','default','privateKey','findOne','musetalkGenerate','../../common/constants/collectType.constant','user','taskId','UserService','professionalClone','api','Voice/deepCreated','GET','voice','identity','video','coverUrl','GOMAXAI_HOST','userType','getVideoCloneFree','getHumanModelVipFree','humanmarketEntity','voice_id','fileUrl','UserCollectType','HttpException','-----------------------HumanPostError---------------------------','__param','cover','state','status','marketId','Repository','getOwnPropertyDescriptor','voiceClone','DESC','Musetalk/direct','81183mADaeh','page','get','typeorm','41502UQFSdR','Bearer\x20','Musetalk/task?task_id=','getCreatedFree','msg','./entity/human.entity','Voice/created','collect','price','object','36eTmfHl','../user/user.service','https://api.yidevs.com/','getVideoMarketList','__esModule','Voice/professionalClone','length','InjectRepository','scene_task_id','DhHumaninfoEntity','HUMAN_API_URL','Musetalk/generate','参数错误','videoUrl','collectList','decorate','app/human/human/','audio_url','3878415nXuTwG','professionalCreated','../file/file.service','isVipUsed','Scene/senior','log','cmService','name','task_id','size','design:paramtypes','humanEntity','duration','videoCreated','uploadFile','save','delete','data','description','voiceId','pop','audioUrl','refundBalance4Human','code','-----------------------------------UploadUrlToServerError----------','12423rYHAhn','uploadUrlToServer','getVoiceMarketList','validateUserType','rows','application/json','validateBalance4Human','findAndCount','uuid','update','findBy','count','./entity/market.entity','1147544ndhTsp','getValue','searchKey','type','__metadata','humanGet'];_0x4e3a=function(){return _0x1280c5;};return _0x4e3a();}function _0xeae4(_0x5d20f5,_0xd9dd17){const _0x4e3a32=_0x4e3a();return _0xeae4=function(_0xeae440,_0x1cc197){_0xeae440=_0xeae440-0x18e;let _0x548aa8=_0x4e3a32[_0xeae440];return _0x548aa8;},_0xeae4(_0x5d20f5,_0xd9dd17);}var __decorate=this&&this['__decorate']||function(_0x3d76e9,_0x55c0be,_0x1f7d91,_0x4c6062){const _0x4143b5=_0xeae4;var _0x4aec92=arguments[_0x4143b5(0x212)],_0x475e38=_0x4aec92<0x3?_0x55c0be:_0x4c6062===null?_0x4c6062=Object[_0x4143b5(0x1fa)](_0x55c0be,_0x1f7d91):_0x4c6062,_0x5dd5e3;if(typeof Reflect==='object'&&typeof Reflect[_0x4143b5(0x21b)]==='function')_0x475e38=Reflect[_0x4143b5(0x21b)](_0x3d76e9,_0x55c0be,_0x1f7d91,_0x4c6062);else{for(var _0x415d11=_0x3d76e9[_0x4143b5(0x212)]-0x1;_0x415d11>=0x0;_0x415d11--)if(_0x5dd5e3=_0x3d76e9[_0x415d11])_0x475e38=(_0x4aec92<0x3?_0x5dd5e3(_0x475e38):_0x4aec92>0x3?_0x5dd5e3(_0x55c0be,_0x1f7d91,_0x475e38):_0x5dd5e3(_0x55c0be,_0x1f7d91))||_0x475e38;}return _0x4aec92>0x3&&_0x475e38&&Object[_0x4143b5(0x1b0)](_0x55c0be,_0x1f7d91,_0x475e38),_0x475e38;},__metadata=this&&this[_0x32d344(0x1a5)]||function(_0x473339,_0x313fb2){const _0x3457e0=_0x32d344;if(typeof Reflect===_0x3457e0(0x20b)&&typeof Reflect[_0x3457e0(0x1d0)]===_0x3457e0(0x1ce))return Reflect['metadata'](_0x473339,_0x313fb2);},__param=this&&this[_0x32d344(0x1f4)]||function(_0x98a10a,_0x31768c){return function(_0x5df8e6,_0x376a9a){_0x31768c(_0x5df8e6,_0x376a9a,_0x98a10a);};};Object[_0x32d344(0x1b0)](exports,_0x32d344(0x210),{'value':!![]}),exports['HumanService']=void 0x0;const common_1=require(_0x32d344(0x1b1)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x32d344(0x201)),human_entity_1=require(_0x32d344(0x207)),cm_service_1=require(_0x32d344(0x1aa)),axios_1=require(_0x32d344(0x1c3)),uuid_1=require(_0x32d344(0x19c)),file_service_1=require(_0x32d344(0x220)),market_entity_1=require(_0x32d344(0x1a0)),user_service_1=require(_0x32d344(0x20d)),collectType_constant_1=require(_0x32d344(0x1de));let HumanService=class HumanService{constructor(_0x318179,_0x446977,_0x55b471,_0x408769,_0x6ae927){const _0x5d0829=_0x32d344;this['humanEntity']=_0x318179,this['humanmarketEntity']=_0x446977,this[_0x5d0829(0x224)]=_0x55b471,this['fileService']=_0x408769,this[_0x5d0829(0x1ad)]=_0x6ae927,this[_0x5d0829(0x216)]=_0x5d0829(0x20e);}async['getPrivateKey'](){const _0x1822b4=_0x32d344;try{const _0x2ac2b9=await this[_0x1822b4(0x224)][_0x1822b4(0x1a2)](_0x1822b4(0x1d6)),_0x5b4174=_0x2ac2b9[_0x1822b4(0x1e3)][_0x1822b4(0x1db)];return _0x2ac2b9['api'][_0x1822b4(0x1ab)]&&(this['HUMAN_API_URL']=_0x2ac2b9[_0x1822b4(0x1e3)]['url']),_0x5b4174;}catch(_0x13e89c){return'';}}async['humanPost'](_0x401e84,_0x372b79){const _0x20d437=_0x32d344;try{const _0x5a68a5=this[_0x20d437(0x216)]+_0x20d437(0x21c)+_0x401e84,_0x3bad21=_0x20d437(0x203)+await this[_0x20d437(0x1c6)]();let _0x4507d7=process[_0x20d437(0x1d8)][_0x20d437(0x1ea)];!/^http/['test'](_0x4507d7)&&(_0x4507d7=_0x20d437(0x1c5)+_0x4507d7);const _0x456759=_0x4507d7+_0x20d437(0x1c2),_0x791fb4=await axios_1[_0x20d437(0x1da)][_0x20d437(0x1b2)](_0x5a68a5,{'callback_url':_0x456759,..._0x372b79},{'headers':{'Authorization':_0x3bad21,'Accept':_0x20d437(0x199),'Content-Type':_0x20d437(0x199)}});return console[_0x20d437(0x223)](_0x20d437(0x1b5),_0x791fb4),_0x791fb4[_0x20d437(0x22f)];}catch(_0x428fef){console[_0x20d437(0x223)](_0x20d437(0x1f3),_0x428fef);}}async[_0x32d344(0x1a6)](_0x16c0b6){const _0x191dfb=_0x32d344;try{const _0x3ecd8d=this[_0x191dfb(0x216)]+'app/human/human/'+_0x16c0b6,_0x2cc509=_0x191dfb(0x203)+await this[_0x191dfb(0x1c6)](),_0x4010e2=await axios_1[_0x191dfb(0x1da)][_0x191dfb(0x200)](_0x3ecd8d,{'headers':{'Authorization':_0x2cc509,'Accept':'application/json','Content-Type':_0x191dfb(0x199)}});return _0x4010e2[_0x191dfb(0x22f)];}catch(_0x458b8b){console[_0x191dfb(0x223)]('-----------------------HumanGetError---------------------------',_0x458b8b);}}async['musetalkTask'](){const _0x59c598=_0x32d344;try{const _0x5d59c8=await this['humanEntity']['find']({'where':{'type':0xa,'status':0x0}});for(const _0x382a96 of _0x5d59c8){const _0x4d0f00=await this[_0x59c598(0x1a6)]('Musetalk/task?task_id='+_0x382a96[_0x59c598(0x1e0)]);if(_0x4d0f00[_0x59c598(0x192)]==0xc8&&_0x4d0f00[_0x59c598(0x22f)][_0x59c598(0x1c9)]){_0x382a96[_0x59c598(0x1f5)]=await this['uploadUrlToServer'](_0x4d0f00[_0x59c598(0x22f)][_0x59c598(0x1e9)]),_0x382a96[_0x59c598(0x1b4)]=_0x4d0f00['data']['sceneId'],_0x382a96[_0x59c598(0x1f7)]=0x1,_0x382a96['duration']=await this[_0x59c598(0x1cc)]['getVideoDurationByFFmpeg'](_0x382a96[_0x59c598(0x1f0)]),this[_0x59c598(0x229)][_0x59c598(0x22d)](_0x382a96);continue;}_0x4d0f00[_0x59c598(0x22f)]['state']==0x1e&&(_0x382a96['status']=0x2,await this[_0x59c598(0x229)]['save'](_0x382a96),_0x382a96[_0x59c598(0x22a)]>0x0&&await this[_0x59c598(0x1ad)][_0x59c598(0x191)](_0x382a96['userId'],'video',_0x382a96['id']));}const _0x632971=await this[_0x59c598(0x229)][_0x59c598(0x1b3)]({'where':{'type':0xc,'status':0x0}});for(const _0x518e66 of _0x632971){const _0x36e320=await this[_0x59c598(0x1a6)](_0x59c598(0x204)+_0x518e66[_0x59c598(0x1e0)]);if(_0x36e320[_0x59c598(0x192)]==0xc8&&_0x36e320[_0x59c598(0x22f)][_0x59c598(0x219)]&&_0x36e320[_0x59c598(0x22f)][_0x59c598(0x1e9)]){_0x518e66[_0x59c598(0x1f5)]=await this[_0x59c598(0x195)](_0x36e320[_0x59c598(0x22f)][_0x59c598(0x1e9)]),_0x518e66[_0x59c598(0x1f0)]=await this[_0x59c598(0x195)](_0x36e320[_0x59c598(0x22f)][_0x59c598(0x219)]),_0x518e66['status']=0x1,_0x518e66[_0x59c598(0x22a)]=_0x36e320[_0x59c598(0x22f)][_0x59c598(0x22a)],await this['humanEntity'][_0x59c598(0x22d)](_0x518e66),await this[_0x59c598(0x1ad)][_0x59c598(0x1d1)](_0x518e66[_0x59c598(0x1cd)],_0x59c598(0x1c7),_0x518e66['id'],_0x518e66[_0x59c598(0x22a)]);continue;}_0x36e320['data'][_0x59c598(0x1f6)]==0x1e&&(_0x518e66[_0x59c598(0x1f7)]=0x2,await this[_0x59c598(0x229)][_0x59c598(0x22d)](_0x518e66));}}catch(_0x2f4886){console['log'](_0x59c598(0x1b8),_0x2f4886);}}async[_0x32d344(0x1cf)](){const _0xbdfcfb=_0x32d344,_0x5bf578=await this[_0xbdfcfb(0x229)]['find']({'where':{'type':0x17,'status':0x0}});for(const _0x25e2a3 of _0x5bf578){const _0x43db65=await this[_0xbdfcfb(0x1a6)]('Voice/getResult?task_id='+_0x25e2a3[_0xbdfcfb(0x1e0)]);if(_0x43db65[_0xbdfcfb(0x192)]==0xc8&&_0x43db65['data'][_0xbdfcfb(0x1c9)]){const _0x57bdb6=await this['uploadUrlToServer'](_0x43db65[_0xbdfcfb(0x22f)][_0xbdfcfb(0x1e9)]);_0x25e2a3[_0xbdfcfb(0x1f5)]=_0x57bdb6,_0x25e2a3[_0xbdfcfb(0x1b4)]=_0x43db65[_0xbdfcfb(0x22f)][_0xbdfcfb(0x1c9)],_0x25e2a3[_0xbdfcfb(0x1f7)]=0x1,this[_0xbdfcfb(0x229)]['save'](_0x25e2a3);}}}async['sceneCreated'](_0x193648,_0x4eba85){const _0x2b4c8a=_0x32d344;await this[_0x2b4c8a(0x1ad)][_0x2b4c8a(0x19a)](_0x4eba85[_0x2b4c8a(0x1df)]['id'],_0x2b4c8a(0x1e8));const _0x29a0ee=await this[_0x2b4c8a(0x1be)]('Scene/created',{'video_name':_0x193648[_0x2b4c8a(0x225)],'video_url':_0x193648[_0x2b4c8a(0x219)]});if(_0x29a0ee[_0x2b4c8a(0x192)]==0xc8){const _0x5e9f9c=await this[_0x2b4c8a(0x229)][_0x2b4c8a(0x22d)]({'requestParams':_0x193648,'fileUrl':_0x193648['videoUrl'],'name':_0x193648[_0x2b4c8a(0x225)],'taskId':_0x29a0ee[_0x2b4c8a(0x22f)][_0x2b4c8a(0x214)],'type':0xa,'userId':_0x4eba85[_0x2b4c8a(0x1df)]['id']});return await this['userService'][_0x2b4c8a(0x1d1)](_0x4eba85[_0x2b4c8a(0x1df)]['id'],_0x2b4c8a(0x1e8),_0x5e9f9c['id']),_0x5e9f9c;}else throw new common_1[(_0x2b4c8a(0x1f2))](_0x29a0ee[_0x2b4c8a(0x206)],common_1['HttpStatus'][_0x2b4c8a(0x1ac)]);}async[_0x32d344(0x22b)](_0x1ae112,_0x2cfc01){const _0x21f1be=_0x32d344;await this[_0x21f1be(0x1ad)][_0x21f1be(0x19a)](_0x2cfc01[_0x21f1be(0x1df)]['id'],'created');const _0x10e43c=await this[_0x21f1be(0x229)][_0x21f1be(0x1dc)]({'where':{'taskId':_0x1ae112[_0x21f1be(0x1e0)]}}),_0xc88bf5=await this[_0x21f1be(0x1be)](_0x21f1be(0x1bc),{'scene_task_id':_0x1ae112[_0x21f1be(0x1e0)],'audio_url':_0x1ae112[_0x21f1be(0x190)]});if(_0xc88bf5[_0x21f1be(0x192)]==0xc8){const _0x3b1e13=await this[_0x21f1be(0x229)]['save']({'requestParams':_0x1ae112,'fileUrl':_0x1ae112[_0x21f1be(0x190)],'coverUrl':_0x10e43c['cover'],'taskId':_0xc88bf5['data'][_0x21f1be(0x1ae)],'type':0xc,'userId':_0x2cfc01[_0x21f1be(0x1df)]['id']});return _0x3b1e13;}else throw new common_1[(_0x21f1be(0x1f2))](_0xc88bf5['msg'],common_1['HttpStatus']['BAD_REQUEST']);}async[_0x32d344(0x1dd)](_0x44209b,_0x20dd3b){const _0x26b154=_0x32d344;if(_0x44209b[_0x26b154(0x1e0)]){const _0x4caad2=await this[_0x26b154(0x229)][_0x26b154(0x1dc)]({'where':{'taskId':_0x44209b[_0x26b154(0x1e0)]}});if(!_0x4caad2)throw new common_1['HttpException'](_0x26b154(0x218),common_1['HttpStatus'][_0x26b154(0x1ac)]);}let _0x58e71b='';if(_0x44209b[_0x26b154(0x1f8)]){const _0x4fe673=await this[_0x26b154(0x1ee)][_0x26b154(0x1dc)]({'where':{'id':_0x44209b[_0x26b154(0x1f8)]}});if(!_0x4fe673)throw new common_1['HttpException']('参数错误',common_1[_0x26b154(0x1a9)][_0x26b154(0x1ac)]);await this[_0x26b154(0x1ad)][_0x26b154(0x197)](_0x20dd3b[_0x26b154(0x1df)]['id'],_0x4fe673[_0x26b154(0x1eb)]),_0x58e71b=_0x4fe673[_0x26b154(0x1f0)];}if(_0x44209b[_0x26b154(0x1ba)]){const _0x43e818=await this['humanPost'](_0x26b154(0x1e4),{'voice_id':_0x44209b[_0x26b154(0x18e)],'text':_0x44209b[_0x26b154(0x1ba)]});if(_0x43e818[_0x26b154(0x192)]!==0xc8)return _0x43e818;_0x44209b[_0x26b154(0x190)]=_0x43e818['data']['audio_url'];}let _0x5551da;_0x58e71b?_0x5551da=await this[_0x26b154(0x1be)](_0x26b154(0x1fd),{'video_url':_0x58e71b,'audio_url':_0x44209b[_0x26b154(0x190)]}):_0x5551da=await this[_0x26b154(0x1be)](_0x26b154(0x217),{'scene_task_id':_0x44209b[_0x26b154(0x1e0)],'audio_url':_0x44209b[_0x26b154(0x190)]});if(_0x5551da['code']==0xc8){const _0x29e725=await this[_0x26b154(0x229)][_0x26b154(0x22d)]({'name':_0x44209b[_0x26b154(0x225)],'requestParams':_0x44209b,'taskId':_0x5551da[_0x26b154(0x22f)][_0x26b154(0x1ae)],'type':0xc,'userId':_0x20dd3b[_0x26b154(0x1df)]['id']});return _0x29e725;}else throw new common_1[(_0x26b154(0x1f2))](_0x5551da[_0x26b154(0x206)],common_1[_0x26b154(0x1a9)]['BAD_REQUEST']);}async['musetalkSenior'](_0x250108,_0x4e1410){const _0x19e21d=_0x32d344;await this['userService'][_0x19e21d(0x19a)](_0x4e1410['user']['id'],_0x19e21d(0x1c7));const _0x283f88=await this[_0x19e21d(0x229)]['findOne']({'where':{'taskId':_0x250108[_0x19e21d(0x1e0)]}}),_0x3f2559=await this[_0x19e21d(0x1be)]('Musetalk/senior',{'scene_task_id':_0x250108['taskId'],'audio_url':_0x250108[_0x19e21d(0x190)]});if(_0x3f2559['code']==0xc8){const _0x49a4ef=await this[_0x19e21d(0x229)][_0x19e21d(0x22d)]({'fileUrl':_0x250108['audioUrl'],'taskId':_0x250108[_0x19e21d(0x1e0)],'duration':_0x283f88[_0x19e21d(0x22a)],'type':0xd,'userId':_0x4e1410[_0x19e21d(0x1df)]['id']});return await this['userService'][_0x19e21d(0x1d1)](_0x4e1410[_0x19e21d(0x1df)]['id'],_0x19e21d(0x1c7),_0x49a4ef['id']),_0x49a4ef;}else throw new common_1[(_0x19e21d(0x1f2))](_0x3f2559[_0x19e21d(0x206)],common_1['HttpStatus'][_0x19e21d(0x1ac)]);}async['sceneSenior'](_0x1a769f,_0x1760ad,_0x17efb8){const _0x216df2=_0x32d344,_0x409d2f=await this['humanPost'](_0x216df2(0x222),{'video_name':_0x1a769f,'video_url':_0x1760ad});if(_0x409d2f[_0x216df2(0x192)]==0xc8){const _0x2507f2=this['humanEntity'][_0x216df2(0x22d)]({'name':_0x1a769f,'fileUrl':_0x1760ad,'type':0xe,'userId':_0x17efb8[_0x216df2(0x1df)]['id']});return _0x2507f2;}else throw new common_1[(_0x216df2(0x1f2))](_0x409d2f['msg'],common_1[_0x216df2(0x1a9)][_0x216df2(0x1ac)]);}async[_0x32d344(0x1e2)](_0x3828ea,_0x530f88,_0x51c66e,_0x420b37,_0x13fa48,_0xf89f9d){const _0x2d866a=_0x32d344,_0x391abc=await this[_0x2d866a(0x1be)](_0x2d866a(0x211),{'name':_0x3828ea,'audio_url':_0x51c66e,'task_id':_0x530f88,'text_id':_0x13fa48,'text_seg_id':_0x13fa48});if(_0x391abc[_0x2d866a(0x192)]==0xc8){const _0xfe9eff=this['humanEntity'][_0x2d866a(0x22d)]({'fileUrl':_0x51c66e,'fileId':_0x391abc[_0x2d866a(0x22f)][_0x2d866a(0x1ef)],'name':_0x3828ea,'taskId':_0x391abc[_0x2d866a(0x22f)][_0x2d866a(0x226)],'type':0x14,'userId':_0xf89f9d['user']['id']});return _0xfe9eff;}else throw new common_1[(_0x2d866a(0x1f2))](_0x391abc['msg'],common_1['HttpStatus'][_0x2d866a(0x1ac)]);}async[_0x32d344(0x1fb)](_0x5e894b,_0x121906){const _0x3874ac=_0x32d344;await this['userService'][_0x3874ac(0x19a)](_0x121906[_0x3874ac(0x1df)]['id'],'voice');const _0xd23f72=await this[_0x3874ac(0x1be)](_0x3874ac(0x1d2),{'name':_0x5e894b[_0x3874ac(0x225)],'audio_url':_0x5e894b[_0x3874ac(0x190)],'description':_0x5e894b[_0x3874ac(0x230)]}),_0x414e3b=await this[_0x3874ac(0x1cc)][_0x3874ac(0x1a7)](_0x5e894b['audioUrl']);if(_0xd23f72[_0x3874ac(0x192)]==0xc8){const _0x300d15=await this[_0x3874ac(0x229)]['save']({'requestParams':_0x5e894b,'fileUrl':_0x5e894b['audioUrl'],'fileId':_0xd23f72[_0x3874ac(0x22f)][_0x3874ac(0x1ef)],'name':_0x5e894b[_0x3874ac(0x225)],'cover':_0x5e894b[_0x3874ac(0x1f5)],'description':_0x5e894b[_0x3874ac(0x230)],'duration':_0x414e3b,'taskId':_0xd23f72[_0x3874ac(0x22f)][_0x3874ac(0x226)],'type':0x15,'status':0x1,'userId':_0x121906[_0x3874ac(0x1df)]['id']});return await this[_0x3874ac(0x1ad)][_0x3874ac(0x19a)](_0x121906['user']['id'],'voice'),_0x300d15;}else throw new common_1['HttpException'](_0xd23f72[_0x3874ac(0x206)],common_1[_0x3874ac(0x1a9)][_0x3874ac(0x1ac)]);}async[_0x32d344(0x1bf)](_0x3d8247,_0x1e6410,_0x3e9669){const _0x4b53ed=_0x32d344,_0x4be60a=await this[_0x4b53ed(0x1be)](_0x4b53ed(0x208),{'text':_0x3d8247,'voice_id':_0x1e6410});if(_0x4be60a[_0x4b53ed(0x192)]==0xc8){const _0x10d6e7=await this['uploadUrlToServer'](_0x4be60a['data'][_0x4b53ed(0x21d)]),_0x41f4a9=this[_0x4b53ed(0x229)][_0x4b53ed(0x22d)]({'fileUrl':_0x10d6e7,'fileId':_0x1e6410,'description':_0x3d8247,'type':0x16,'userId':_0x3e9669['user']['id']});return _0x41f4a9;}else throw new common_1[(_0x4b53ed(0x1f2))](_0x4be60a[_0x4b53ed(0x206)],common_1['HttpStatus'][_0x4b53ed(0x1ac)]);}async[_0x32d344(0x21f)](_0x385c3f,_0x53a94d,_0xc7d028,_0x2da27c){const _0x27237d=_0x32d344,_0x3d5e2e=await this[_0x27237d(0x1be)](_0x27237d(0x208),{'text':_0x385c3f,'task_id':_0x53a94d,'voice_id':_0xc7d028});if(_0x3d5e2e[_0x27237d(0x192)]==0xc8){const _0x450b7a=await this['uploadUrlToServer'](_0x3d5e2e[_0x27237d(0x22f)][_0x27237d(0x21d)]),_0x350675=this[_0x27237d(0x229)][_0x27237d(0x22d)]({'fileUrl':_0x450b7a,'fileId':_0xc7d028,'description':_0x385c3f,'type':0x17,'userId':_0x2da27c[_0x27237d(0x1df)]['id']});return _0x350675;}else throw new common_1[(_0x27237d(0x1f2))](_0x3d5e2e['msg'],common_1['HttpStatus'][_0x27237d(0x1ac)]);}async[_0x32d344(0x195)](_0x553309){const _0x4146e6=_0x32d344;try{const _0x4fd37a=await(0x0,axios_1[_0x4146e6(0x1da)])({'url':_0x553309,'method':_0x4146e6(0x1e5),'responseType':'stream','headers':{'Accept-Encoding':_0x4146e6(0x1e7)}}),_0xd90fd7=_0x4fd37a[_0x4146e6(0x22f)],_0x35629c=_0x553309[_0x4146e6(0x1b6)]('.')[_0x4146e6(0x18f)]();let _0x224eeb=(0x0,uuid_1['v4'])()+'.'+_0x35629c;const _0xc79991=await this[_0x4146e6(0x1cc)][_0x4146e6(0x22c)]({'filename':_0x224eeb,'buffer':_0xd90fd7});return _0xc79991;}catch(_0x34d476){console[_0x4146e6(0x223)](_0x4146e6(0x193),_0x34d476);}return null;}async['getMyVideos'](_0x224bef,_0x25b586){const _0x385401=_0x32d344,_0x35049d={'type':0xa,'userId':_0x25b586[_0x385401(0x1df)]['id']};_0x224bef['searchKey']&&(_0x35049d[_0x385401(0x225)]=(0x0,typeorm_2[_0x385401(0x1b9)])('%'+_0x224bef[_0x385401(0x1a3)]+'%'));const [_0x1bd173,_0x89cdf5]=await this[_0x385401(0x229)][_0x385401(0x19b)]({'where':_0x35049d,'order':{'id':'DESC'},'skip':(_0x224bef[_0x385401(0x1ff)]-0x1)*_0x224bef[_0x385401(0x227)],'take':_0x224bef['size']});return{'rows':_0x1bd173,'count':_0x89cdf5};}async[_0x32d344(0x1bd)](_0x358026,_0x1593e6){const _0x5dfa4a=_0x32d344,_0x14a1c7={'type':0x15,'userId':_0x1593e6['user']['id']};_0x358026[_0x5dfa4a(0x1a3)]&&(_0x14a1c7[_0x5dfa4a(0x225)]=(0x0,typeorm_2['Like'])('%'+_0x358026[_0x5dfa4a(0x1a3)]+'%'));const [_0x3e93c9,_0xa08044]=await this[_0x5dfa4a(0x229)][_0x5dfa4a(0x19b)]({'where':_0x14a1c7,'order':{'id':'DESC'},'skip':(_0x358026[_0x5dfa4a(0x1ff)]-0x1)*_0x358026[_0x5dfa4a(0x227)],'take':_0x358026[_0x5dfa4a(0x227)]});return{'rows':_0x3e93c9,'count':_0xa08044};}async[_0x32d344(0x1d9)](_0x165a6d,_0x260b8){const _0x3781da=_0x32d344,_0x1ccd4d={'type':0xc,'userId':_0x260b8[_0x3781da(0x1df)]['id']};_0x165a6d['searchKey']&&(_0x1ccd4d[_0x3781da(0x225)]=(0x0,typeorm_2['Like'])('%'+_0x165a6d[_0x3781da(0x1a3)]+'%'));const [_0x2c1f00,_0x5cbf49]=await this[_0x3781da(0x229)][_0x3781da(0x19b)]({'where':_0x1ccd4d,'order':{'id':_0x3781da(0x1fc)},'skip':(_0x165a6d['page']-0x1)*_0x165a6d[_0x3781da(0x227)],'take':_0x165a6d['size']});return{'rows':_0x2c1f00,'count':_0x5cbf49};}async[_0x32d344(0x20f)](_0x3c4bbf){const _0x19992e=_0x32d344,_0x58664e={'isRelease':0x1,'type':0x1};_0x3c4bbf[_0x19992e(0x1a3)]&&(_0x58664e['name']=(0x0,typeorm_2[_0x19992e(0x1b9)])('%'+_0x3c4bbf[_0x19992e(0x1a3)]+'%'));const _0x51f6b7=await this[_0x19992e(0x1ee)][_0x19992e(0x19b)]({'where':_0x58664e,'order':{'id':_0x19992e(0x1fc)},'skip':(_0x3c4bbf[_0x19992e(0x1ff)]-0x1)*_0x3c4bbf[_0x19992e(0x227)],'take':_0x3c4bbf[_0x19992e(0x227)]});_0x51f6b7[0x0]['forEach'](_0x4986d6=>{const _0x58d8f6=_0x19992e;_0x4986d6[_0x58d8f6(0x221)]=_0x4986d6['userType']?!![]:![];});const [_0xae88a1,_0x362d75]=_0x51f6b7;return{'rows':_0xae88a1,'count':_0x362d75};}async[_0x32d344(0x196)](_0x5bd939){const _0x2898ce=_0x32d344,_0x40d418={'isRelease':0x1,'type':0x2};_0x5bd939[_0x2898ce(0x1a3)]&&(_0x40d418[_0x2898ce(0x225)]=(0x0,typeorm_2[_0x2898ce(0x1b9)])('%'+_0x5bd939[_0x2898ce(0x1a3)]+'%'));const _0x19b9fd=await this[_0x2898ce(0x1ee)]['findAndCount']({'where':_0x40d418,'order':{'id':_0x2898ce(0x1fc)},'skip':(_0x5bd939[_0x2898ce(0x1ff)]-0x1)*_0x5bd939[_0x2898ce(0x227)],'take':_0x5bd939[_0x2898ce(0x227)]});_0x19b9fd[0x0]['forEach'](_0x52c298=>{_0x52c298['isVipUsed']=_0x52c298['userType']?!![]:![];});const [_0x57e80d,_0x440852]=_0x19b9fd;return{'rows':_0x57e80d,'count':_0x440852};}async['collect'](_0x35ef4c,_0x15f689,_0x42c4c3){const _0x157b65=_0x32d344,_0x3072a2=await this['humanEntity'][_0x157b65(0x1dc)]({'where':{'id':_0x35ef4c}});if(!_0x3072a2)throw new Error('数字人不存在！');_0x15f689==0x1?this['userService'][_0x157b65(0x209)](_0x42c4c3['user']['id'],_0x3072a2['id'],_0x3072a2['type']==0x1?collectType_constant_1[_0x157b65(0x1f1)]['HUMAN_VIDEO']:collectType_constant_1[_0x157b65(0x1f1)][_0x157b65(0x1c4)]):this['userService'][_0x157b65(0x1cb)](_0x42c4c3[_0x157b65(0x1df)]['id'],_0x3072a2['id'],_0x3072a2['type']==0x1?collectType_constant_1[_0x157b65(0x1f1)][_0x157b65(0x1bb)]:collectType_constant_1[_0x157b65(0x1f1)]['HUMAN_VOICE']);}async[_0x32d344(0x21a)](_0x59fd09,_0x1512e5){const _0x3bbfe0=_0x32d344,_0xa4c2d7=await this[_0x3bbfe0(0x1ad)]['collectPage'](_0x59fd09[_0x3bbfe0(0x1ff)],_0x59fd09[_0x3bbfe0(0x227)],_0x1512e5[_0x3bbfe0(0x1df)]['id'],_0x59fd09[_0x3bbfe0(0x1a4)]==0x1?collectType_constant_1[_0x3bbfe0(0x1f1)][_0x3bbfe0(0x1bb)]:collectType_constant_1[_0x3bbfe0(0x1f1)][_0x3bbfe0(0x1c4)]);if(_0xa4c2d7['count']>0x0){const _0x26e60b=await this[_0x3bbfe0(0x229)][_0x3bbfe0(0x19e)]({'id':(0x0,typeorm_2['In'])(_0xa4c2d7[_0x3bbfe0(0x198)]['map'](_0xe4e24c=>_0xe4e24c[_0x3bbfe0(0x1d4)]))});return{'rows':_0x26e60b,'count':_0xa4c2d7[_0x3bbfe0(0x19f)]};}return{'rows':[],'count':0x0};}async[_0x32d344(0x1ec)](_0x23a22b){const _0x1560eb=_0x32d344;try{const _0x3409b9=_0x23a22b[_0x1560eb(0x1df)]?.['id'],_0x10171b=await this['userService'][_0x1560eb(0x1c8)](_0x1560eb(0x1e8));if(!_0x3409b9)return{'remainCount':0x0,'freeCount':_0x10171b[_0x1560eb(0x1b7)],'isVipFree':_0x10171b[_0x1560eb(0x1b7)],'useIntegrate':_0x10171b[_0x1560eb(0x20a)],'userType':_0x10171b?.['userType'],'isVipUsed':_0x10171b?.[_0x1560eb(0x1eb)]?!![]:![]};return{'remainCount':await this[_0x1560eb(0x1ad)]['getHumanModelVipFree'](_0x3409b9,_0x1560eb(0x1e8)),'freeCount':_0x10171b[_0x1560eb(0x1b7)],'isVipFree':_0x10171b[_0x1560eb(0x1b7)]==-0x1,'useIntegrate':_0x10171b?.['price'],'userType':_0x10171b?.[_0x1560eb(0x1eb)],'isVipUsed':_0x10171b?.[_0x1560eb(0x1eb)]?!![]:![]};}catch(_0x4a6c6d){console[_0x1560eb(0x223)]('-----------------------HumanPostError---------------------------',_0x4a6c6d);}}async[_0x32d344(0x1c0)](_0x9c4c8c){const _0x1835fa=_0x32d344,_0x21b0ce=_0x9c4c8c[_0x1835fa(0x1df)]?.['id'],_0x19f7bd=await this['userService'][_0x1835fa(0x1c8)](_0x1835fa(0x1e6));if(!_0x21b0ce)return{'remainCount':0x0,'freeCount':_0x19f7bd[_0x1835fa(0x1b7)],'isVipFree':_0x19f7bd[_0x1835fa(0x1b7)],'useIntegrate':_0x19f7bd[_0x1835fa(0x20a)],'userType':_0x19f7bd?.['userType'],'isVipUsed':_0x19f7bd?.['userType']?!![]:![]};return{'remainCount':await this[_0x1835fa(0x1ad)][_0x1835fa(0x1ed)](_0x21b0ce,'voice'),'freeCount':_0x19f7bd[_0x1835fa(0x1b7)],'isVipFree':_0x19f7bd['vipFreeNum']==-0x1,'useIntegrate':_0x19f7bd?.[_0x1835fa(0x20a)],'userType':_0x19f7bd?.[_0x1835fa(0x1eb)],'isVipUsed':_0x19f7bd?.['userType']?!![]:![]};}async[_0x32d344(0x205)](_0x1318b4,_0x5180ee){const _0x459018=_0x32d344,_0x4a5318=_0x1318b4[_0x459018(0x1df)]?.['id'],_0x428bc4=await this[_0x459018(0x1ad)][_0x459018(0x1c8)](_0x459018(0x1c7));if(!_0x4a5318)return{'remainCount':0x0,'freeCount':_0x428bc4[_0x459018(0x1b7)],'isVipFree':_0x428bc4[_0x459018(0x1b7)],'useIntegrate':_0x428bc4[_0x459018(0x20a)],'userType':_0x428bc4?.[_0x459018(0x1eb)],'isVipUsed':_0x428bc4?.['userType']?!![]:![]};return{'remainCount':await this['userService'][_0x459018(0x1ed)](_0x4a5318,_0x459018(0x1c7)),'freeCount':_0x428bc4['vipFreeNum'],'isVipFree':_0x428bc4[_0x459018(0x1b7)]==-0x1,'useIntegrate':_0x428bc4?.['price'],'userType':_0x428bc4?.[_0x459018(0x1eb)],'isVipUsed':_0x428bc4?.[_0x459018(0x1eb)]?!![]:![]};}async[_0x32d344(0x19d)](_0x468ee5,_0x1eeb25){const _0x56a81b=_0x32d344,_0x2d8580=await this[_0x56a81b(0x229)][_0x56a81b(0x1dc)]({'where':{'id':_0x468ee5['id']}});if(!_0x2d8580||_0x2d8580[_0x56a81b(0x1cd)]!=_0x1eeb25[_0x56a81b(0x1df)]['id'])throw new Error(_0x56a81b(0x1ca));return _0x2d8580[_0x56a81b(0x225)]=_0x468ee5[_0x56a81b(0x225)],await this[_0x56a81b(0x229)]['save'](_0x2d8580);}async[_0x32d344(0x22e)](_0x476d76,_0x5c5b39){const _0xe08a89=_0x32d344,_0x26d5f8=await this[_0xe08a89(0x229)][_0xe08a89(0x1dc)]({'where':{'id':_0x476d76}});if(!_0x26d5f8||_0x26d5f8['userId']!=_0x5c5b39[_0xe08a89(0x1df)]['id'])throw new Error(_0xe08a89(0x1ca));return await this['humanEntity'][_0xe08a89(0x22e)](_0x476d76);}};HumanService=__decorate([(0x0,common_1[_0x32d344(0x1d5)])(),__param(0x0,(0x0,typeorm_1[_0x32d344(0x213)])(human_entity_1[_0x32d344(0x215)])),__param(0x1,(0x0,typeorm_1[_0x32d344(0x213)])(market_entity_1['DhHumanmarketEntity'])),__metadata(_0x32d344(0x228),[typeorm_2[_0x32d344(0x1f9)],typeorm_2[_0x32d344(0x1f9)],cm_service_1['CmConfigService'],file_service_1[_0x32d344(0x1a8)],user_service_1[_0x32d344(0x1e1)]])],HumanService),exports[_0x32d344(0x1d7)]=HumanService;