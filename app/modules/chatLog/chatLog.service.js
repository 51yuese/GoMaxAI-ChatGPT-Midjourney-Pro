'use strict';const _0x257886=_0x5898;(function(_0x332d14,_0x12c19){const _0x1c3ed5=_0x5898,_0x4d449f=_0x332d14();while(!![]){try{const _0x3c6f4f=parseInt(_0x1c3ed5(0x194))/0x1*(-parseInt(_0x1c3ed5(0x24d))/0x2)+parseInt(_0x1c3ed5(0x225))/0x3*(-parseInt(_0x1c3ed5(0x1b3))/0x4)+parseInt(_0x1c3ed5(0x1b9))/0x5+-parseInt(_0x1c3ed5(0x241))/0x6+parseInt(_0x1c3ed5(0x1e6))/0x7*(-parseInt(_0x1c3ed5(0x234))/0x8)+parseInt(_0x1c3ed5(0x23e))/0x9*(parseInt(_0x1c3ed5(0x193))/0xa)+parseInt(_0x1c3ed5(0x1b5))/0xb*(parseInt(_0x1c3ed5(0x227))/0xc);if(_0x3c6f4f===_0x12c19)break;else _0x4d449f['push'](_0x4d449f['shift']());}catch(_0x256ced){_0x4d449f['push'](_0x4d449f['shift']());}}}(_0x2366,0x6a228));var __decorate=this&&this[_0x257886(0x1e3)]||function(_0x341030,_0x5a2541,_0x29cc09,_0x4a0cef){const _0x4f3e4c=_0x257886;var _0x184e86=arguments[_0x4f3e4c(0x1f1)],_0x30976c=_0x184e86<0x3?_0x5a2541:_0x4a0cef===null?_0x4a0cef=Object[_0x4f3e4c(0x24b)](_0x5a2541,_0x29cc09):_0x4a0cef,_0xd2a448;if(typeof Reflect==='object'&&typeof Reflect[_0x4f3e4c(0x20f)]===_0x4f3e4c(0x219))_0x30976c=Reflect['decorate'](_0x341030,_0x5a2541,_0x29cc09,_0x4a0cef);else{for(var _0xe8207c=_0x341030['length']-0x1;_0xe8207c>=0x0;_0xe8207c--)if(_0xd2a448=_0x341030[_0xe8207c])_0x30976c=(_0x184e86<0x3?_0xd2a448(_0x30976c):_0x184e86>0x3?_0xd2a448(_0x5a2541,_0x29cc09,_0x30976c):_0xd2a448(_0x5a2541,_0x29cc09))||_0x30976c;}return _0x184e86>0x3&&_0x30976c&&Object[_0x4f3e4c(0x1ed)](_0x5a2541,_0x29cc09,_0x30976c),_0x30976c;},__metadata=this&&this[_0x257886(0x1aa)]||function(_0x37c4d6,_0x6826ca){const _0x300f4e=_0x257886;if(typeof Reflect===_0x300f4e(0x1b0)&&typeof Reflect[_0x300f4e(0x210)]==='function')return Reflect[_0x300f4e(0x210)](_0x37c4d6,_0x6826ca);},__param=this&&this[_0x257886(0x1ce)]||function(_0x2a9029,_0x3d9970){return function(_0x2b8e19,_0x1940fe){_0x3d9970(_0x2b8e19,_0x1940fe,_0x2a9029);};};Object[_0x257886(0x1ed)](exports,_0x257886(0x1c5),{'value':!![]}),exports[_0x257886(0x231)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x257886(0x1f3)),chatLog_entity_1=require(_0x257886(0x201)),typeorm_2=require(_0x257886(0x1c7)),balance_constant_1=require('../../common/constants/balance.constant'),utils_1=require('../../common/utils'),file_service_1=require('../file/file.service'),redisCache_service_1=require(_0x257886(0x221)),redisKey_constant_1=require(_0x257886(0x1e0)),aiAssets_entity_1=require('./aiAssets.entity'),aiLog_service_1=require('../aiLog/aiLog.service'),nestjs_cls_1=require('nestjs-cls'),class_validator_1=require('class-validator');let ChatLogService=class ChatLogService{constructor(_0x28c85e,_0x597418,_0x2385d4,_0x4d9bf8,_0x4f2b2f,_0x38e360,_0x2a5bd7){const _0xa6450b=_0x257886;this[_0xa6450b(0x1c0)]=_0x28c85e,this[_0xa6450b(0x22c)]=_0x597418,this[_0xa6450b(0x1ea)]=_0x2385d4,this[_0xa6450b(0x23c)]=_0x4d9bf8,this['aiLogService']=_0x4f2b2f,this['redisCacheService']=_0x38e360,this[_0xa6450b(0x23b)]=_0x2a5bd7;}async[_0x257886(0x1a1)](_0x48fa6a){const _0x5b9a68=_0x257886;return await this['chatLogEntity'][_0x5b9a68(0x224)](_0x48fa6a);}async[_0x257886(0x233)](_0xc74356){const _0x187731=_0x257886,_0x1c80b7=_0xc74356['answer'];let _0x421b1b={},_0x5de3a7={};if(_0x1c80b7[_0x187731(0x252)]('Request\x20failed')!=-0x1)throw new Error(_0x187731(0x22d)+_0x1c80b7);else{let _0x3dc3e1='',_0x5d3df1='',_0x293a4a='解析错误',_0x4eeb72=_0x187731(0x1bf),_0x174a0b=_0x187731(0x1bf),_0x56a70b='解析错误',_0x19916b=_0x187731(0x1bf),_0xfe92b=_0x187731(0x1bf),_0x12a5b6=_0x187731(0x1bf),_0xdfe8db='解析错误';if(_0x1c80b7['startsWith']('####')){const [_0x1c87a6]=_0x1c80b7[_0x187731(0x1a5)](/>(\S+)\n/g);_0x3dc3e1=_0x5d3df1=_0x1c87a6['substring'](0x1,_0x1c87a6[_0x187731(0x1f1)]-0x1),_0x293a4a=_0x1c80b7[_0x187731(0x20d)]('\x0a')[0x0][_0x187731(0x20c)](0x7),_0x4eeb72=_0x1c80b7[_0x187731(0x20d)](_0x187731(0x1ac))[0x1][_0x187731(0x21b)](/\[.*\]|（.*）/g,'')[_0x187731(0x21b)](/\n+/g,'\x0a');const _0x21c310=_0x1c80b7[_0x187731(0x1a5)](/!\[image\].*\)/g);_0x21c310&&([_0x174a0b,_0x56a70b]=_0x21c310[_0x187731(0x1f2)](_0x1153be=>_0x1153be[_0x187731(0x20c)](0x9,_0x1153be[_0x187731(0x1f1)]-0x1)));const _0x4cabf0=_0x1c80b7['match'](/https:\/\/(.*)\.mp3/g);_0x4cabf0&&([_0x19916b,_0xfe92b]=_0x4cabf0);const _0x54c4ac=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp4/g);_0x54c4ac&&([_0x12a5b6,_0xdfe8db]=_0x54c4ac);}else{if(_0x1c80b7[_0x187731(0x1ef)]('🎵')){_0x293a4a=_0x1c80b7[_0x187731(0x20d)]('\x0a')[0x0][_0x187731(0x21b)](/🎵/g,'');const _0x3d0a6d=_0x1c80b7[_0x187731(0x20d)]('--')['find'](_0xca848d=>/-\n\n\[/[_0x187731(0x1e9)](_0xca848d));if(_0x3d0a6d){const _0x576b6d=_0x3d0a6d['replace'](/\[.*\]|（.*）|-/g,'')[_0x187731(0x21b)](/\n+/g,'\x0a');_0x576b6d[_0x187731(0x1ef)]('\x0a')?_0x4eeb72=_0x576b6d[_0x187731(0x21b)]('\x0a',''):_0x4eeb72=_0x576b6d;}const _0x36368c=_0x1c80b7[_0x187731(0x1a5)](/歌曲id(.+)\n/ig);_0x36368c&&([_0x3dc3e1,_0x5d3df1]=_0x36368c[_0x187731(0x1f2)](_0x37269b=>_0x37269b[_0x187731(0x20c)](0xc,_0x37269b[_0x187731(0x1f1)]-0x1)));const _0x549d63=_0x1c80b7[_0x187731(0x1a5)](/\[封面图片\].*\)/g);_0x549d63&&([_0x174a0b,_0x56a70b]=_0x549d63['map'](_0x14b31e=>_0x14b31e['substring'](0x7,_0x14b31e['length']-0x1)));const _0x23f3ec=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp3/g);_0x23f3ec&&([_0x19916b,_0xfe92b]=_0x23f3ec);const _0x35f793=_0x1c80b7['match'](/https:\/\/(.*)\.mp4/g);_0x35f793&&([_0x12a5b6,_0xdfe8db]=_0x35f793);}else{if(_0x1c80b7[_0x187731(0x252)]('💄')!=-0x1){let _0x5d9476=_0x1c80b7['split']('\x0a');_0x5d9476[_0x187731(0x1fc)](_0x434773=>{const _0x2dbd9e=_0x187731;_0x434773[_0x2dbd9e(0x252)]('🔎')!=-0x1&&(_0x293a4a=_0x434773[_0x2dbd9e(0x20d)]('：')[0x1]);});const _0x26bd6a=_0x1c80b7[_0x187731(0x20d)](_0x187731(0x1ab))[0x1][_0x187731(0x20d)]('\x0a');if(_0x26bd6a){const _0x136407=_0x26bd6a[_0x187731(0x21a)](_0xa53d8f=>_0xa53d8f[_0x187731(0x252)]('[')==-0x1)[_0x187731(0x1af)]('');_0x136407[_0x187731(0x1ef)]('\x0a')?_0x4eeb72=_0x136407[_0x187731(0x21b)]('\x0a',''):_0x4eeb72=_0x136407;}const _0x2c32fb=_0x1c80b7[_0x187731(0x1a5)](/歌曲id(.+)\n/ig);_0x2c32fb&&([_0x3dc3e1,_0x5d3df1]=_0x2c32fb[_0x187731(0x1f2)](_0xcaed2d=>_0xcaed2d['substring'](0xa,_0xcaed2d[_0x187731(0x1f1)]-0x1)));const _0x55f58d=_0x1c80b7[_0x187731(0x1a5)](/\[封面图片\].*\)/g);_0x55f58d&&([_0x174a0b,_0x56a70b]=_0x55f58d[_0x187731(0x1f2)](_0x3432d3=>_0x3432d3['substring'](0x7,_0x3432d3[_0x187731(0x1f1)]-0x1)));const _0x142b9f=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp3/g);_0x142b9f&&([_0x19916b,_0xfe92b]=_0x142b9f);const _0x40316d=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp4/g);_0x40316d&&([_0x12a5b6,_0xdfe8db]=_0x40316d);}else{if(_0x1c80b7[_0x187731(0x1ef)]('🎁')){_0x293a4a=_0x1c80b7[_0x187731(0x20d)]('\x0a')[0x2][_0x187731(0x20d)](_0x187731(0x1b6))[0x1];const _0x1133d7=_0x1c80b7['split']('```')[0x1][_0x187731(0x20d)]('\x0a');if(_0x1133d7){const _0x3bc4b8=_0x1133d7[_0x187731(0x21a)](_0x771dc8=>_0x771dc8['indexOf']('[')==-0x1)['join']('');_0x3bc4b8['startsWith']('\x0a')?_0x4eeb72=_0x3bc4b8['replace']('\x0a',''):_0x4eeb72=_0x3bc4b8;}const _0x5c0d63=_0x1c80b7['match'](/歌曲ID：(.+)\n/ig);_0x5c0d63&&([_0x3dc3e1,_0x5d3df1]=_0x5c0d63[_0x187731(0x1f2)](_0x13d718=>_0x13d718[_0x187731(0x20c)](0x8,_0x13d718[_0x187731(0x1f1)]-0x1)));const _0x142537=_0x1c80b7[_0x187731(0x1a5)](/\[封面\].*\)/g);_0x142537&&([_0x174a0b,_0x56a70b]=_0x142537[_0x187731(0x1f2)](_0x2ff354=>_0x2ff354[_0x187731(0x20c)](0x5,_0x2ff354['length']-0x1)));const _0x3fc837=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp3/g);_0x3fc837&&([_0x19916b,_0xfe92b]=_0x3fc837);const _0x5d10a2=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp4/g);_0x5d10a2&&([_0x12a5b6,_0xdfe8db]=_0x5d10a2);}else{if(_0x1c80b7['indexOf'](_0x187731(0x20b))!==-0x1){let _0x39d0cf=_0x1c80b7[_0x187731(0x20d)]('\x0a'),_0x5f3ef7=![];const _0x55f00f=[];for(let _0x383267=0x0;_0x383267<_0x39d0cf[_0x187731(0x1f1)];_0x383267++){const _0x1d9c96=_0x39d0cf[_0x383267];_0x1d9c96['indexOf'](_0x187731(0x20b))!==-0x1&&(_0x293a4a=_0x1d9c96[_0x187731(0x20d)]('：\x20')[0x1]);if(_0x1d9c96[_0x187731(0x192)](_0x187731(0x243)))_0x5f3ef7=![];else{if(_0x5f3ef7&&!_0x1d9c96['startsWith']('['))_0x55f00f[_0x187731(0x247)](_0x1d9c96);else _0x1d9c96[_0x187731(0x192)](_0x187731(0x1fb))&&(_0x5f3ef7=!![]);}}_0x4eeb72=_0x55f00f['join']('\x20');const _0x324911=_0x1c80b7['match'](/版本ID：(.+)\n/ig);_0x324911&&([_0x3dc3e1,_0x5d3df1]=_0x324911[_0x187731(0x1f2)](_0x24a81b=>_0x24a81b[_0x187731(0x20c)](0xa,_0x24a81b[_0x187731(0x1f1)]-0x1)));const _0x241bec=_0x1c80b7['match'](/\[封面\].*\)/g);_0x241bec&&([_0x174a0b,_0x56a70b]=_0x241bec[_0x187731(0x1f2)](_0x153923=>_0x153923[_0x187731(0x20c)](0x5,_0x153923[_0x187731(0x1f1)]-0x1)));const _0x27eca9=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp3/g);_0x27eca9&&([_0x19916b,_0xfe92b]=_0x27eca9);const _0x5c5d2e=_0x1c80b7[_0x187731(0x1a5)](/https:\/\/(.*)\.mp4/g);_0x5c5d2e&&([_0x12a5b6,_0xdfe8db]=_0x5c5d2e);}else throw new Error('解析错误');}}}}_0x421b1b={'title':_0x293a4a,'intro':_0x4eeb72,'mp3':_0x19916b,'mp4':_0x12a5b6,'cover':_0x174a0b,'sunoMusicId':_0x3dc3e1,'chatLogId':_0xc74356['id'],'userId':_0xc74356[_0x187731(0x222)]},_0x5de3a7={'title':_0x293a4a,'intro':_0x4eeb72,'mp3':_0xfe92b,'mp4':_0xdfe8db,'cover':_0x56a70b,'sunoMusicId':_0x5d3df1,'chatLogId':_0xc74356['id'],'userId':_0xc74356[_0x187731(0x222)]};}await this[_0x187731(0x23b)][_0x187731(0x1cc)](async()=>{const _0x37b33a=_0x187731;await this[_0x37b33a(0x22c)][_0x37b33a(0x224)](_0x421b1b),await this[_0x37b33a(0x22c)][_0x37b33a(0x224)](_0x5de3a7);});}async[_0x257886(0x20a)](_0x1da3fa,_0x2b0c83){const _0x43f359=_0x257886;let _0x417b1c={'mp4':_0x2b0c83[_0x43f359(0x1df)]?.[_0x43f359(0x1a4)],'sunoMusicId':_0x2b0c83['id'],'chatLogId':_0x1da3fa['id'],'userId':_0x1da3fa['userId']};if(_0x2b0c83['id']){const _0x1ce95d=await this[_0x43f359(0x22c)][_0x43f359(0x1fa)]({'where':{'sunoMusicId':_0x2b0c83['id']}});_0x1ce95d&&(_0x417b1c=Object['assign'](_0x1ce95d,_0x417b1c));}_0x417b1c=await this[_0x43f359(0x22c)][_0x43f359(0x224)](_0x417b1c),_0x1da3fa[_0x43f359(0x1c3)]=_0x2b0c83[_0x43f359(0x1c4)],this[_0x43f359(0x1c0)][_0x43f359(0x224)](_0x1da3fa),_0x2b0c83[_0x43f359(0x1c4)]==='completed'&&_0x417b1c[_0x43f359(0x235)]&&this[_0x43f359(0x19e)](_0x417b1c);}async[_0x257886(0x23f)](_0x3c0b42,_0x28a04e){const _0x458da5=_0x257886,{id:_0x14631f}=_0x3c0b42[_0x458da5(0x1f5)],{model:_0x3830aa}=_0x28a04e,_0x234d97={'userId':_0x14631f,'type':balance_constant_1[_0x458da5(0x1e1)][_0x458da5(0x1f4)]};_0x3830aa&&(_0x234d97['model']=_0x3830aa);const _0x1fde15=await this[_0x458da5(0x1c0)][_0x458da5(0x196)]({'where':_0x234d97,'order':{'id':_0x458da5(0x19d)}});return _0x1fde15['forEach'](_0x1b6a40=>{const _0x2a5a41=_0x458da5;if(_0x1b6a40['type']==='paintCount'){const _0x4ea6a6=_0x1b6a40[_0x2a5a41(0x1eb)]==='mj'?0x136:0xa0,_0x511ba6=_0x1b6a40[_0x2a5a41(0x1c3)]['includes'](_0x2a5a41(0x1cd))?_0x2a5a41(0x251):'ali',_0x4f6247=_0x511ba6===_0x2a5a41(0x251)?'?imageView2/1/w/'+_0x4ea6a6+'/q/55':_0x2a5a41(0x1db)+_0x4ea6a6;_0x1b6a40[_0x2a5a41(0x1b8)]=_0x1b6a40['answer']+_0x4f6247;const _0x5d5cfb=_0x1b6a40[_0x2a5a41(0x1c8)]?JSON[_0x2a5a41(0x22f)](_0x1b6a40['extend']):null;_0x5d5cfb&&(_0x5d5cfb?_0x1b6a40[_0x2a5a41(0x200)]=_0x5d5cfb?.[_0x2a5a41(0x213)][0x0]?.[_0x2a5a41(0x213)]['length']===0x5:_0x1b6a40['isGroup']=![]);}}),_0x1fde15;}async[_0x257886(0x197)](_0x3cddef){const _0x31acf0=_0x257886,{page:page=0x1,size:size=0x14,rec:_0x1969ba,userId:_0x59fd2e,model:_0x5a9b1d}=_0x3cddef,_0x41f7ae={'type':balance_constant_1[_0x31acf0(0x1e1)][_0x31acf0(0x1f4)],'prompt':(0x0,typeorm_2[_0x31acf0(0x206)])(''),'answer':(0x0,typeorm_2[_0x31acf0(0x206)])('')};_0x1969ba&&Object[_0x31acf0(0x24c)](_0x41f7ae,{'rec':_0x1969ba}),_0x59fd2e&&Object['assign'](_0x41f7ae,{'userId':_0x59fd2e}),_0x5a9b1d&&Object[_0x31acf0(0x24c)](_0x41f7ae,{'model':_0x5a9b1d});const [_0x3d28cf,_0x5e52fc]=await this[_0x31acf0(0x1c0)][_0x31acf0(0x1b7)]({'order':{'id':_0x31acf0(0x19d)},'skip':(page-0x1)*size,'take':size,'where':_0x41f7ae});return _0x3d28cf['forEach'](_0x233d92=>{const _0xbe76c3=_0x31acf0;if(_0x233d92[_0xbe76c3(0x21f)]===_0xbe76c3(0x1a7)){const _0x42b730=_0x233d92[_0xbe76c3(0x1eb)]==='mj'?0x136:0xa0,_0x4c4cf0=_0x233d92[_0xbe76c3(0x1c3)][_0xbe76c3(0x192)](_0xbe76c3(0x1cd))?_0xbe76c3(0x251):_0xbe76c3(0x1e7),_0x4ddc18=_0x4c4cf0===_0xbe76c3(0x251)?_0xbe76c3(0x1d9)+_0x42b730+'/q/55':_0xbe76c3(0x1db)+_0x42b730;_0x233d92[_0xbe76c3(0x1b8)]=_0x233d92[_0xbe76c3(0x1c3)]+_0x4ddc18;const _0x4d725e=_0x233d92[_0xbe76c3(0x1c8)]?JSON[_0xbe76c3(0x22f)](_0x233d92[_0xbe76c3(0x1c8)]):null;_0x4d725e&&(_0x4d725e?_0x233d92['isGroup']=_0x4d725e?.[_0xbe76c3(0x213)][0x0]?.[_0xbe76c3(0x213)][_0xbe76c3(0x1f1)]===0x5:_0x233d92[_0xbe76c3(0x200)]=![]);}}),{'rows':_0x3d28cf,'count':_0x5e52fc};}async[_0x257886(0x18f)](_0x20a080){const _0x43e46a=_0x257886,{id:_0x2435ba}=_0x20a080,_0x5acae0=await this[_0x43e46a(0x1c0)][_0x43e46a(0x1fa)]({'where':{'id':_0x2435ba,'type':balance_constant_1[_0x43e46a(0x1e1)]['PAINT_TYPE']}});if(!_0x5acae0)throw new common_1[(_0x43e46a(0x232))](_0x43e46a(0x24a),common_1[_0x43e46a(0x1a2)]['BAD_REQUEST']);const _0x41c8c9=_0x5acae0['rec']===0x1?0x0:0x1,_0x132a7d=await this['chatLogEntity']['update']({'id':_0x2435ba},{'rec':_0x41c8c9});if(_0x132a7d[_0x43e46a(0x21e)]>0x0)return(_0x41c8c9?'推荐':_0x43e46a(0x236))+_0x43e46a(0x1dd);throw new common_1[(_0x43e46a(0x232))](_0x43e46a(0x237),common_1['HttpStatus'][_0x43e46a(0x1d7)]);}async[_0x257886(0x211)](_0x18bf1e,_0x14fed5){const _0x42d3ad=_0x257886,_0x2e3856=(0x0,utils_1[_0x42d3ad(0x19f)])(this['clsService']),{page:page=0x1,size:size=0x14,userId:_0x51a340,keyword:_0x570d89,prompt:_0x3b2842,saasId:_0x4c6dc5,modelType:_0x395172}=_0x18bf1e;let _0x3da298=_0x42d3ad(0x245);_0x51a340&&(_0x3da298=_0x3da298+('\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20c.userId\x20=\x20'+_0x51a340));_0x3b2842&&(_0x3da298=_0x3da298+(_0x42d3ad(0x23d)+_0x3b2842+'%\x27'));_0x395172&&(_0x3da298=_0x3da298+(_0x42d3ad(0x240)+_0x395172+'\x27'));(0x0,utils_1[_0x42d3ad(0x1d4)])(this[_0x42d3ad(0x1ea)])?(0x0,class_validator_1[_0x42d3ad(0x1c2)])(_0x4c6dc5)&&(_0x3da298=_0x3da298+(_0x42d3ad(0x1f8)+_0x4c6dc5)):_0x3da298=_0x3da298+(_0x42d3ad(0x204)+_0x2e3856);_0x570d89&&(_0x3da298=_0x3da298+(_0x42d3ad(0x1e5)+_0x570d89+_0x42d3ad(0x1a6)+_0x570d89+_0x42d3ad(0x207)+_0x570d89+_0x42d3ad(0x1da)+_0x570d89+_0x42d3ad(0x1fe)));const _0x15bcea=await this[_0x42d3ad(0x23b)][_0x42d3ad(0x1ad)](_0x42d3ad(0x19b)+_0x3da298+_0x42d3ad(0x1d6)),_0xbd6b34=await this[_0x42d3ad(0x23b)][_0x42d3ad(0x1ad)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.username,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.nickname,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.phone,\x0a\x20\x20\x20\x20\x20\x20\x20\x20u.email\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20c\x0a\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20u.id\x20=\x20c.userId\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x3da298+_0x42d3ad(0x244)+size+_0x42d3ad(0x1f6)+(page-0x1)*size+_0x42d3ad(0x19a));return!(0x0,utils_1[_0x42d3ad(0x203)])(this[_0x42d3ad(0x1ea)])&&_0xbd6b34['forEach'](_0x33b350=>{const _0x10d442=_0x42d3ad;_0x33b350['email']=(0x0,utils_1[_0x10d442(0x1e4)])(_0x33b350['email']),_0x33b350[_0x10d442(0x1d0)]=(0x0,utils_1[_0x10d442(0x1e4)])(_0x33b350['phone']);}),{'rows':_0xbd6b34,'count':Number(_0x15bcea[0x0]?.['count']||0x0)};}async['delChatLog'](_0x15b48c){const _0x1894c1=_0x257886;if(!_0x15b48c['ids']['length'])return!![];return await this[_0x1894c1(0x1c0)][_0x1894c1(0x1f9)]({'id':(0x0,typeorm_2['In'])(_0x15b48c['ids'])},{'isDelete':!![]}),!![];}async[_0x257886(0x238)](_0x11abbc,_0x4c64e7){const _0x56aa1d=_0x257886,{id:_0x4eb90c}=_0x11abbc['user'],{groupId:_0x52db12,logType:_0x31d8f7}=_0x4c64e7,_0xb5e0b9={'userId':_0x4eb90c,'isDelete':![]};_0x52db12&&Object[_0x56aa1d(0x24c)](_0xb5e0b9,{'groupId':_0x52db12}),_0x31d8f7&&Object['assign'](_0xb5e0b9,{'logType':_0x31d8f7});const _0x16fa41=await this[_0x56aa1d(0x1c0)]['find']({'where':_0xb5e0b9})[_0x56aa1d(0x205)](_0x2ac674=>{const _0x514ec1=_0x56aa1d;common_1['Logger'][_0x514ec1(0x1d3)](_0x2ac674);});if(!_0x16fa41||_0x16fa41['length']===0x0)return[];return _0x16fa41[_0x56aa1d(0x1f2)](_0x560bf9=>{const _0x4e6ccd=_0x56aa1d,{prompt:_0x488b54,role:_0x9332a4,answer:_0x51ce27,createdAt:_0xfc6ab7,model:_0xd3a855,conversationOptions:_0x56f679,requestOptions:_0x26848f,id:_0x499a24}=_0x560bf9;return{'chatId':_0x499a24,'dateTime':(0x0,utils_1['formatDate'])(_0xfc6ab7),'text':_0x9332a4===_0x4e6ccd(0x1f5)?_0x488b54:_0x51ce27,'inversion':_0x9332a4===_0x4e6ccd(0x1f5),'error':![],'conversationOptions':_0x56f679?JSON['parse'](_0x56f679):null,'requestOptions':_0x26848f?JSON['parse'](_0x26848f):null};});}async[_0x257886(0x1be)](_0x36249a){const _0x697472=_0x257886;return this[_0x697472(0x1c0)][_0x697472(0x196)]({'where':{'groupId':_0x36249a,'isDelete':![]}});}async[_0x257886(0x1ba)](_0x3d365b,_0x5c7a1a,_0x895aa4){const _0x30e9c7=_0x257886,_0x35cedb=new Map();if(!_0x5c7a1a[_0x30e9c7(0x1f1)])return _0x35cedb;const _0xd4f497=await this[_0x30e9c7(0x22c)][_0x30e9c7(0x196)]({'where':{'chatLogId':(0x0,typeorm_2['In'])(_0x5c7a1a),'deleteFlag':0x0}}),_0x121823=_0xd4f497['map'](_0x127928=>_0x127928['id']),_0x1546f4=await this[_0x30e9c7(0x1c1)][_0x30e9c7(0x1d1)](_0x3d365b,_0x121823,_0x895aa4),_0x2c4657=await this[_0x30e9c7(0x1c1)][_0x30e9c7(0x1bd)](_0x121823,_0x895aa4);return _0xd4f497['forEach'](_0x5a90e8=>{const _0x20c68b=_0x30e9c7;!_0x35cedb[_0x20c68b(0x239)](_0x5a90e8[_0x20c68b(0x248)])&&_0x35cedb[_0x20c68b(0x1a8)](_0x5a90e8['chatLogId'],[]);const _0x2ce373=_0x2c4657['get'](_0x5a90e8['id']);_0x35cedb[_0x20c68b(0x1b4)](_0x5a90e8[_0x20c68b(0x248)])['push']({..._0x5a90e8,'agree':_0x1546f4[_0x20c68b(0x1b4)](_0x5a90e8['id'])||null,'playNum':_0x2ce373?.[_0x20c68b(0x249)]||0x0,'visitNum':_0x2ce373?.['visitNum']||0x0,'agreeNum':_0x2ce373?.['agreeNum']||0x0});}),_0x35cedb;}async[_0x257886(0x1ec)](_0x215033,_0x14fb09,_0x274ab2){const _0x4ff1bd=_0x257886;if(!_0x14fb09[_0x4ff1bd(0x1f1)])return[];const _0x3115b6=await this['chatLogEntity'][_0x4ff1bd(0x196)]({'where':{'isDelete':![],'id':(0x0,typeorm_2['In'])(_0x14fb09)}});if(!_0x3115b6['length'])return[];const _0x1ea69c=await this['getMusicVoMap'](_0x215033[_0x4ff1bd(0x1f5)]['id'],_0x14fb09,_0x274ab2);return _0x3115b6[_0x4ff1bd(0x1f2)](_0x12f8f0=>{const _0x3c52aa=_0x4ff1bd;return{..._0x12f8f0,'children':_0x1ea69c[_0x3c52aa(0x1b4)](_0x12f8f0['id'])||[]};});}async[_0x257886(0x20e)](_0x39e155){const _0x437707=_0x257886;if(!_0x39e155['length'])return[];return this[_0x437707(0x22c)][_0x437707(0x196)]({'where':{'chatLogId':(0x0,typeorm_2['In'])(_0x39e155)}});}async[_0x257886(0x220)](_0x10c0cd,_0x2943e6){const _0x37b33f=_0x257886;try{const _0x376ce9={'isDelete':![],'role':_0x37b33f(0x208),'userId':_0x10c0cd[_0x37b33f(0x1f5)]['id'],'modelType':_0x2943e6[_0x37b33f(0x218)]},[_0x52f69b,_0x125658]=await this[_0x37b33f(0x1c0)]['findAndCount']({'where':_0x376ce9,'take':_0x2943e6[_0x37b33f(0x1bc)],'skip':(_0x2943e6['page']-0x1)*_0x2943e6[_0x37b33f(0x1bc)],'order':{'createdAt':'DESC'}}),_0x380b39=_0x52f69b[_0x37b33f(0x1f2)](_0x569694=>_0x569694['id']),_0x5d497e=await this[_0x37b33f(0x1ba)](_0x10c0cd['user']['id'],_0x380b39,_0x2943e6['modelType']),_0x4154e8=_0x52f69b['map'](_0x382097=>{const _0x1282d6=_0x37b33f;return{..._0x382097,'children':_0x5d497e[_0x1282d6(0x1b4)](_0x382097['id'])||[]};});return{'count':_0x125658,'records':_0x4154e8};}catch(_0x4c1a95){throw new common_1[(_0x37b33f(0x232))](_0x4c1a95[_0x37b33f(0x202)],common_1[_0x37b33f(0x1a2)]['BAD_REQUEST']);}}async[_0x257886(0x223)](_0x4e409e,_0x33a852){const _0x4d414e=_0x257886;if(!_0x33a852[_0x4d414e(0x230)]['length'])return!![];return await this[_0x4d414e(0x22c)][_0x4d414e(0x1f9)]({'userId':_0x4e409e[_0x4d414e(0x1f5)]['id'],'id':(0x0,typeorm_2['In'])(_0x33a852[_0x4d414e(0x230)])},{'deleteFlag':0x1}),!![];}async[_0x257886(0x1d2)](_0x543fc4,_0x1ff4d1){const _0x465558=_0x257886;if(!_0x1ff4d1[_0x465558(0x230)])return!![];return await this[_0x465558(0x23b)][_0x465558(0x1ad)]('\x0a\x20\x20\x20\x20\x20\x20UPDATE\x20ai_assets\x20\x0a\x20\x20\x20\x20\x20\x20SET\x20publish_flag\x20=\x20CASE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHEN\x20publish_flag\x20=\x200\x20THEN\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x201\x20ELSE\x200\x20\x0a\x20\x20\x20\x20\x20\x20END\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_id\x20=\x20'+_0x543fc4[_0x465558(0x1f5)]['id']+_0x465558(0x1bb)+_0x1ff4d1[_0x465558(0x230)][_0x465558(0x1af)]()+_0x465558(0x217)),!![];}async[_0x257886(0x1fd)](_0x54d969,_0xde38c2){const _0x5645f5=_0x257886,_0x5c551f=(0x0,utils_1[_0x5645f5(0x21d)])(this[_0x5645f5(0x1ea)]);try{const {page:page=0x1,size:size=0x14,order:_0x40f05c,keyword:_0x64df0b,modelType:_0x38200e}=_0xde38c2;let _0x4f36df=_0x5645f5(0x199);if(_0x40f05c===_0x5645f5(0x249))_0x4f36df=_0x5645f5(0x1a0);else _0x40f05c===_0x5645f5(0x1cf)&&(_0x4f36df='ale.agree_num');const _0x3e4141=await this[_0x5645f5(0x23b)][_0x5645f5(0x1ad)](_0x5645f5(0x1ae)+_0x38200e+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20cl.id\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20aa.delete_flag\x20=\x200\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20aa.publish_flag\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(_0x64df0b?_0x5645f5(0x1ca)+_0x64df0b+'%\x27)':'')+_0x5645f5(0x1ff)),_0xa86c15=await this[_0x5645f5(0x23b)][_0x5645f5(0x1ad)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20aa.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20cl.model\x20as\x20model,\x0a\x20\x20\x20\x20\x20\x20\x20\x20cl.prompt\x20as\x20prompt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20IFNULL(ale.play_num,0)\x20as\x20playNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20IFNULL(ale.visit_num,0)\x20as\x20visitNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20IFNULL(ale.agree_num,0)\x20as\x20agreeNum\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20ai_assets\x20aa\x0a\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20chatlog\x20cl\x20ON\x20cl.id\x20=\x20aa.chat_log_id\x20AND\x20cl.modelType\x20=\x20\x27'+_0x38200e+_0x5645f5(0x19c)+_0x38200e+_0x5645f5(0x190)+(_0x64df0b?_0x5645f5(0x1ca)+_0x64df0b+_0x5645f5(0x1fe):'')+'\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x4f36df+_0x5645f5(0x22e)+size+_0x5645f5(0x1f6)+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20'),_0x45b5fd=_0xa86c15[_0x5645f5(0x1f2)](_0x151d38=>_0x151d38['id']),_0x496e57=await this[_0x5645f5(0x1c1)][_0x5645f5(0x1d1)](_0x5c551f,_0x45b5fd,_0x38200e);return _0xa86c15[_0x5645f5(0x1fc)](_0x332048=>{_0x332048['agree']=_0x496e57['get'](_0x332048['id'])||null;}),{'records':_0xa86c15,'count':Number(_0x3e4141[0x0]?.[_0x5645f5(0x1dc)]||0x0)};}catch(_0x2880f3){throw new common_1['HttpException'](_0x2880f3[_0x5645f5(0x202)],common_1[_0x5645f5(0x1a2)][_0x5645f5(0x1d7)]);}}async[_0x257886(0x215)](_0x5ea416,_0x2d9f84){const _0x5b2895=_0x257886,{id:_0x182706}=_0x5ea416[_0x5b2895(0x1f5)],{groupId:_0x37d308}=_0x2d9f84,_0x2adefb={'userId':_0x182706,'isDelete':![]};_0x37d308&&Object[_0x5b2895(0x24c)](_0x2adefb,{'groupId':_0x37d308});const _0x1e1f7d=await this['chatLogEntity'][_0x5b2895(0x196)]({'where':_0x2adefb});return _0x1e1f7d[_0x5b2895(0x1f2)](_0x15bdba=>{const _0x517c94=_0x5b2895,{prompt:_0x5e26c1,role:_0x386e9d,answer:_0x279938,createdAt:_0x537754,model:_0x53af4d,conversationOptions:_0x576d6a,requestOptions:_0x1d2d8f,id:_0xe2bc53}=_0x15bdba;return{'chatId':_0xe2bc53,'dateTime':(0x0,utils_1[_0x517c94(0x195)])(_0x537754),'text':_0x386e9d===_0x517c94(0x1f5)?_0x5e26c1:_0x279938,'inversion':_0x386e9d==='user','error':![],'conversationOptions':_0x576d6a?JSON[_0x517c94(0x22f)](_0x576d6a):null,'requestOptions':_0x1d2d8f?JSON[_0x517c94(0x22f)](_0x1d2d8f):null};});}async[_0x257886(0x228)](_0x25c7d5,_0x53b849){const _0x10edc5=_0x257886,{id:_0x301ea3}=_0x25c7d5[_0x10edc5(0x1f5)],{id:_0x2301b1}=_0x53b849,_0x2d095d=await this[_0x10edc5(0x1c0)][_0x10edc5(0x1fa)]({'where':{'id':_0x2301b1,'userId':_0x301ea3}});if(!_0x2d095d)throw new common_1[(_0x10edc5(0x232))](_0x10edc5(0x250),common_1[_0x10edc5(0x1a2)][_0x10edc5(0x1d7)]);const _0x4387d7=await this[_0x10edc5(0x1c0)][_0x10edc5(0x1f9)]({'id':_0x2301b1},{'isDelete':!![]});if(_0x4387d7[_0x10edc5(0x21e)]>0x0)return _0x10edc5(0x246);else throw new common_1[(_0x10edc5(0x232))](_0x10edc5(0x250),common_1[_0x10edc5(0x1a2)][_0x10edc5(0x1d7)]);}async['delByGroupId'](_0x5ff914,_0x2fc8c2){const _0x2eabe3=_0x257886,{groupId:_0x2fccfa,type:_0x5e656c}=_0x2fc8c2,{id:_0x270e9e}=_0x5ff914[_0x2eabe3(0x1f5)],_0x27e5f9=_0x5e656c&&_0x5e656c===_0x2eabe3(0x1b1)?{'groupId':_0x2fccfa,'userId':_0x270e9e}:{'groupId':_0x2fccfa,'userId':_0x270e9e},_0x68defa=await this[_0x2eabe3(0x1c0)]['delete'](_0x27e5f9);if(_0x68defa['affected']>0x0)return!![];if(_0x68defa['affected']===0x0)throw new common_1['HttpException'](_0x2eabe3(0x242),common_1[_0x2eabe3(0x1a2)][_0x2eabe3(0x1d7)]);}async['removeLogsBatch'](_0x168a81){const _0x129f14=_0x257886,{ids:_0xca0b54,userId:_0x111d21}=_0x168a81;return await this[_0x129f14(0x1c0)]['delete']({'groupId':(0x0,typeorm_2['In'])(_0xca0b54),'userId':_0x111d21});}async[_0x257886(0x1f7)](_0x56d931,_0x1c6d0e){const _0x31ad7f=_0x257886,{id:_0x3e89ce}=_0x56d931['user'],{appId:_0x5266a8,page:page=0x1,size:size=0xa}=_0x1c6d0e,[_0x154c7c,_0x22ca8c]=await this[_0x31ad7f(0x1c0)][_0x31ad7f(0x1b7)]({'where':{'userId':_0x3e89ce,'appId':_0x5266a8,'role':_0x31ad7f(0x208)},'order':{'id':'DESC'},'take':size,'skip':(page-0x1)*size});return{'rows':_0x154c7c,'count':_0x22ca8c};}async['listUndoneVideo'](){const _0x553be6=_0x257886,_0x348e14=await this[_0x553be6(0x23b)][_0x553be6(0x1ad)](_0x553be6(0x22b));return _0x348e14;}async[_0x257886(0x1ee)](_0x1cedbb){const _0x4c04ba=_0x257886;console[_0x4c04ba(0x191)](_0x4c04ba(0x229),_0x1cedbb);const _0x2f1faa=await this[_0x4c04ba(0x22c)]['findOne']({'where':{'sunoMusicId':_0x1cedbb['id']}});if(!_0x2f1faa)throw new Error(_0x4c04ba(0x1e8));const _0x5133ab=await this['chatLogEntity'][_0x4c04ba(0x1fa)]({'where':{'id':_0x2f1faa[_0x4c04ba(0x248)]}});_0x5133ab[_0x4c04ba(0x1c3)]=_0x1cedbb[_0x4c04ba(0x1c4)],_0x2f1faa[_0x4c04ba(0x235)]=_0x1cedbb[_0x4c04ba(0x1df)]?.[_0x4c04ba(0x1a4)],await this[_0x4c04ba(0x1c0)][_0x4c04ba(0x224)](_0x5133ab),await this[_0x4c04ba(0x22c)][_0x4c04ba(0x224)](_0x2f1faa),_0x5133ab['answer']===_0x4c04ba(0x1cb)&&_0x2f1faa[_0x4c04ba(0x235)]&&this[_0x4c04ba(0x19e)](_0x2f1faa);}async[_0x257886(0x19e)](_0x5ca41e){const _0x3614ad=_0x257886,[_0x2e324c,_0x4ab36c]=await this[_0x3614ad(0x23c)][_0x3614ad(0x209)](_0x5ca41e[_0x3614ad(0x235)]);_0x5ca41e[_0x3614ad(0x235)]=_0x2e324c,_0x5ca41e[_0x3614ad(0x212)]=_0x4ab36c,await this['aiAssetsEntity']['save'](_0x5ca41e);}async['syncAssets'](){const _0x56b741=_0x257886,_0x2e4af5=await this[_0x56b741(0x22c)][_0x56b741(0x196)]({'where':[{'cover':(0x0,typeorm_2[_0x56b741(0x21c)])(_0x56b741(0x1b2))},{'mp3':(0x0,typeorm_2[_0x56b741(0x21c)])(_0x56b741(0x1b2))},{'mp4':(0x0,typeorm_2[_0x56b741(0x21c)])(_0x56b741(0x1b2))},{'mp4':(0x0,typeorm_2[_0x56b741(0x21c)])('%storage.cdn-luma.com%')}]});for(let _0x31fceb=0x0;_0x31fceb<_0x2e4af5[_0x56b741(0x1f1)];_0x31fceb++){const _0x708cfc=_0x2e4af5[_0x31fceb],_0x4bf0cb=redisKey_constant_1[_0x56b741(0x1c6)]+_0x708cfc['id'];try{const _0x11291c=await this['redisCacheService'][_0x56b741(0x1b4)]({'key':_0x4bf0cb});if(_0x11291c)continue;await this['redisCacheService'][_0x56b741(0x1a8)]({'key':_0x4bf0cb,'val':_0x56b741(0x1d5)});const {cover:_0x4b1c5b,mp3:_0x4c951b,mp4:_0xc0633c}=_0x708cfc;/filesystem.site/[_0x56b741(0x1e9)](_0x4b1c5b)&&(_0x708cfc[_0x56b741(0x212)]=await this[_0x56b741(0x23c)]['transferFile'](_0x4b1c5b));/filesystem.site/[_0x56b741(0x1e9)](_0x4c951b)&&(_0x708cfc['mp3']=await this[_0x56b741(0x23c)][_0x56b741(0x214)](_0x4c951b));if(/filesystem.site|storage.cdn-luma.com/[_0x56b741(0x1e9)](_0xc0633c)){if(_0x4b1c5b)_0x708cfc[_0x56b741(0x235)]=await this[_0x56b741(0x23c)]['transferFile'](_0xc0633c);else{const [_0x54d548,_0xc3f343]=await this[_0x56b741(0x23c)][_0x56b741(0x209)](_0xc0633c);_0x708cfc[_0x56b741(0x235)]=_0x54d548,_0x708cfc[_0x56b741(0x212)]=_0xc3f343;}}await this['aiAssetsEntity']['save'](_0x708cfc);}catch(_0x9644f1){common_1['Logger']['error'](_0x9644f1);}finally{await this[_0x56b741(0x1a3)][_0x56b741(0x1e2)]({'key':_0x4bf0cb});}}}async[_0x257886(0x1de)](_0x400058,_0x437c14){const _0x4e50ad=_0x257886,_0x5c970e=await this[_0x4e50ad(0x1c0)][_0x4e50ad(0x1ad)](_0x4e50ad(0x1d8)+_0x400058+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20appId\x20IN\x20(\x20'+_0x437c14['join']()+_0x4e50ad(0x22a));return _0x5c970e;}};function _0x2366(){const _0xc642b4=['query','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ai_assets\x20aa\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20chatlog\x20cl\x20ON\x20cl.id\x20=\x20aa.chat_log_id\x20AND\x20cl.modelType\x20=\x20\x27','join','object','gpts','%filesystem.site%','3296onDxIg','get','83864ZhjdTx','：**','findAndCount','thumbImg','1762610rrYSWh','getMusicVoMap','\x20AND\x20id\x20IN\x20(','size','getExtByRelate','listByGroupId','解析错误','chatLogEntity','aiLogService','isDefined','answer','state','__esModule','MUSIC_TRANSFER','typeorm','extend','AiAssetsEntity','AND\x20aa.title\x20LIKE\x20(\x27%','completed','transaction','cos','__param','agreeNum','phone','getAgreeMap','assetsPublish','error','isPlatform','lock','\x20\x0a\x20\x20\x20\x20','BAD_REQUEST','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20appId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20userId\x20=\x20','?imageView2/1/w/','%\x27\x20OR\x20u.email\x20LIKE\x20\x27%','?x-oss-process=image/resize,w_','count','图片成功！','getLastByUserAndAppIds','video','../../common/constants/redisKey.constant','DeductionKey','del','__decorate','maskEmail','\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20(u.username\x20LIKE\x20\x27%','901761nJdoAl','ali','资源不存在！','test','clsService','model','listByIds','defineProperty','videoNotify','startsWith','Repository','length','map','@nestjs/typeorm','PAINT_TYPE','user','\x20OFFSET\x20','byAppId','\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20c.saasId\x20=\x20','update','findOne','**歌词：**','forEach','assetsSquare','%\x27)','\x0a\x20\x20\x20\x20\x20\x20','isGroup','./chatLog.entity','message','isSuper','\x0a\x20\x20\x20\x20\x20\x20AND\x20c.saasId\x20=\x20','catch','Not','%\x27\x20OR\x20u.phone\x20LIKE\x20\x27%','assistant','transferAndCover','parseAndSaveVideo','###🎵\x20歌曲名','substring','split','listAssetsBychatLogIds','decorate','metadata','querAllChatLog','cover','components','transferFile','chatGptsList','Injectable',')\x0a\x20\x20\x20\x20','modelType','function','filter','replace','Like','getUserId','affected','type','chatTaskLog','../redisCache/redisCache.service','userId','assetsDel','save','969EcFrBO','FileService','444WVNOLQ','deleteChatLog','luma通知：','\x20)\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20appId\x0a\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.*\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20c\x0a\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20ai_assets\x20aa\x20ON\x20aa.chat_log_id\x20=\x20c.id\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.modelType\x20=\x20\x27video\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20c.errMsg\x20IS\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.answer\x20IN\x20(\x20\x27pending\x27,\x20\x27processing\x27\x20)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20OR\x20(\x20c.answer\x20=\x20\x27completed\x27\x20AND\x20aa.mp4\x20IS\x20NULL\x20))\x0a\x20\x20\x20\x20','aiAssetsEntity','音乐生成错误：','\x20DESC\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','parse','ids','ChatLogService','HttpException','parseAndSaveMusic','8kmHXob','mp4','取消推荐','你操作的图片不存在、请检查！','chatList','has','RedisCacheService','connection','fileService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20c.rompt\x20LIKE\x20\x27%','9ZdOaAP','querDrawLog','\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20c.modelType\x20=\x20\x27','21462LrQLJp','当前页面已经没有东西可以删除了！','**版本ID','\x20\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20c.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20','isDelete\x20=\x200','删除对话记录成功！','push','chatLogId','playNum','你推荐的图片不存在、请检查！','getOwnPropertyDescriptor','assign','2XlOgrU','ClsService','AiLogService','你删除的对话记录不存在、请检查！','tencent','indexOf','recDrawImg','\x27\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20cl.id\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20aa.delete_flag\x20=\x200\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20aa.publish_flag\x20=\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20','log','includes','6016810APgHdE','403011kMNUEx','formatDate','find','querAllDrawLog','InjectRepository','aa.createdAt','\x0a\x20\x20\x20\x20','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20c\x0a\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20users\x20u\x20ON\x20u.id\x20=\x20c.userId\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20ai_log_ext\x20ale\x20ON\x20ale.relate_id\x20=\x20aa.id\x20AND\x20ale.relate_type\x20=\x20\x27','DESC','syncVideo','getReqSaasId','ale.play_num','saveChatLog','HttpStatus','redisCacheService','url','match','%\x27\x20OR\x20u.nickname\x20LIKE\x20\x27%','paintCount','set','ChatLogEntity','__metadata','```','---'];_0x2366=function(){return _0xc642b4;};return _0x2366();}function _0x5898(_0x376c35,_0x23531a){const _0x236665=_0x2366();return _0x5898=function(_0x58980e,_0xfc519a){_0x58980e=_0x58980e-0x18f;let _0x3bf869=_0x236665[_0x58980e];return _0x3bf869;},_0x5898(_0x376c35,_0x23531a);}ChatLogService=__decorate([(0x0,common_1[_0x257886(0x216)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatLog_entity_1[_0x257886(0x1a9)])),__param(0x1,(0x0,typeorm_1[_0x257886(0x198)])(aiAssets_entity_1[_0x257886(0x1c9)])),__metadata('design:paramtypes',[typeorm_2[_0x257886(0x1f0)],typeorm_2[_0x257886(0x1f0)],nestjs_cls_1[_0x257886(0x24e)],file_service_1[_0x257886(0x226)],aiLog_service_1[_0x257886(0x24f)],redisCache_service_1[_0x257886(0x23a)],typeorm_2['Connection']])],ChatLogService),exports['ChatLogService']=ChatLogService;