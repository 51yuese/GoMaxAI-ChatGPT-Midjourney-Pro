'use strict';const _0x1d4bcb=_0x3c6e;(function(_0x1fae34,_0x103cd7){const _0x299a6e=_0x3c6e,_0x52d0fc=_0x1fae34();while(!![]){try{const _0x4781c3=-parseInt(_0x299a6e(0x1e4))/0x1*(-parseInt(_0x299a6e(0x1c1))/0x2)+-parseInt(_0x299a6e(0x1fc))/0x3*(-parseInt(_0x299a6e(0x1c5))/0x4)+parseInt(_0x299a6e(0x1f5))/0x5*(parseInt(_0x299a6e(0x1dd))/0x6)+-parseInt(_0x299a6e(0x1ee))/0x7+-parseInt(_0x299a6e(0x19b))/0x8+-parseInt(_0x299a6e(0x1f9))/0x9*(parseInt(_0x299a6e(0x1ef))/0xa)+-parseInt(_0x299a6e(0x1ae))/0xb*(parseInt(_0x299a6e(0x19c))/0xc);if(_0x4781c3===_0x103cd7)break;else _0x52d0fc['push'](_0x52d0fc['shift']());}catch(_0x45c6bb){_0x52d0fc['push'](_0x52d0fc['shift']());}}}(_0x4d5e,0x44834));function _0x4d5e(){const _0x2694c6=['officialAutoReplyText','../../common/utils','170611BAlrnp','82100PJETle','@nestjs/common','sceneStrMap','authToken','crypto','fetchQRCodeTicket','658995xWEGAP','jiangly','RedisCacheService','getConfigs','36dxkyso','loginByCode','../../common/constants/redisKey.constant','18JLozng','https://api.weixin.qq.com/cgi-bin/qrcode/create?access_token=','update','function','authService','./../auth/auth.service','__decorate','bindWx','https://open.weixin.qq.com/connect/oauth2/authorize?appid=','__esModule','&code=','&url=','getJwtToken','loginBySceneStr','HttpStatus','回跳跳转地址:\x20','&openid=','scanBindWx','347096UzVBDe','276612pxQwbj','&noncestr=','OfficialService','axios','log','GlobalConfigService','globalConfigService','./../autoreply/autoreply.service','HttpException','getWechatAccessToken','str:\x20','wechatOfficialToken',']]></FromUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<CreateTime>','hex','join','BAD_REQUEST','sort','wechatAccessToken','154vzkuhZ','fromusername','./../globalConfig/globalConfig.service','length','valueOf','userService','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','onModuleInit','OfficialLoginVO','object','jsapiTicket:\x20','getOwnPropertyDescriptor','aotoPlay','../redisCache/redisCache.service','AutoreplyService','default','defineProperty','toFixed','&secret=','3454DPgFaM','autoreplyService','wechatUser','&grant_type=authorization_code','57904afbadt','jsapi_ticket=','redisCacheService','getJsapiTicket','非法参数','./vo/Login.vo','&lang=zh_CN','createRandomNonceStr','metadata','QR_STR_SCENE','sha1','wechatOfficialAppId','getUserOpenId','../../common/utils/date','checkAutoReply','genXmlMsg','getRedirectUrl','design:paramtypes','genXmlMsgByConfig','wechatOfficialAppSecret','__metadata','appId:\x20','\x0a\x20\x20\x20\x20<xml>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<ToUserName><![CDATA[','get','6snpYSQ','getAccessToken',']]></Content>\x0a\x20\x20\x20\x20</xml>','split','&response_type=code&scope=snsapi_base&state=weChatLogin#wechat_redirect','post','errmsg','281aaPiBv','scanedSceneStrMap','decorate','openId','Injectable','</CreateTime>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<MsgType><![CDATA[text]]></MsgType>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<Content><![CDATA[','getQRSceneStr','UserService'];_0x4d5e=function(){return _0x2694c6;};return _0x4d5e();}var __decorate=this&&this[_0x1d4bcb(0x202)]||function(_0x39da97,_0x6f5f5a,_0x381c6a,_0x39db64){const _0x1627e2=_0x1d4bcb;var _0x1ba2b6=arguments[_0x1627e2(0x1b1)],_0x3e5689=_0x1ba2b6<0x3?_0x6f5f5a:_0x39db64===null?_0x39db64=Object[_0x1627e2(0x1b9)](_0x6f5f5a,_0x381c6a):_0x39db64,_0x44fa2d;if(typeof Reflect===_0x1627e2(0x1b7)&&typeof Reflect[_0x1627e2(0x1e6)]===_0x1627e2(0x1ff))_0x3e5689=Reflect[_0x1627e2(0x1e6)](_0x39da97,_0x6f5f5a,_0x381c6a,_0x39db64);else{for(var _0x535a2d=_0x39da97[_0x1627e2(0x1b1)]-0x1;_0x535a2d>=0x0;_0x535a2d--)if(_0x44fa2d=_0x39da97[_0x535a2d])_0x3e5689=(_0x1ba2b6<0x3?_0x44fa2d(_0x3e5689):_0x1ba2b6>0x3?_0x44fa2d(_0x6f5f5a,_0x381c6a,_0x3e5689):_0x44fa2d(_0x6f5f5a,_0x381c6a))||_0x3e5689;}return _0x1ba2b6>0x3&&_0x3e5689&&Object[_0x1627e2(0x1be)](_0x6f5f5a,_0x381c6a,_0x3e5689),_0x3e5689;},__metadata=this&&this[_0x1d4bcb(0x1d9)]||function(_0x52f3c5,_0x150d7c){const _0x1c5648=_0x1d4bcb;if(typeof Reflect===_0x1c5648(0x1b7)&&typeof Reflect[_0x1c5648(0x1cd)]===_0x1c5648(0x1ff))return Reflect[_0x1c5648(0x1cd)](_0x52f3c5,_0x150d7c);};Object[_0x1d4bcb(0x1be)](exports,_0x1d4bcb(0x205),{'value':!![]}),exports[_0x1d4bcb(0x19e)]=void 0x0;const globalConfig_service_1=require(_0x1d4bcb(0x1b0)),auth_service_1=require(_0x1d4bcb(0x201)),user_service_1=require('./../user/user.service'),autoreply_service_1=require(_0x1d4bcb(0x1a3)),common_1=require(_0x1d4bcb(0x1f0)),crypto=require(_0x1d4bcb(0x1f3)),axios_1=require(_0x1d4bcb(0x19f)),utils_1=require(_0x1d4bcb(0x1ed)),Login_vo_1=require(_0x1d4bcb(0x1ca)),redisKey_constant_1=require(_0x1d4bcb(0x1fb)),redisCache_service_1=require(_0x1d4bcb(0x1bb)),date_1=require(_0x1d4bcb(0x1d2));let OfficialService=class OfficialService{constructor(_0x2acd59,_0x5d3595,_0x3e9209,_0x2c3b03,_0x105bd8){const _0x327849=_0x1d4bcb;this[_0x327849(0x1c2)]=_0x2acd59,this['userService']=_0x5d3595,this[_0x327849(0x200)]=_0x3e9209,this['globalConfigService']=_0x2c3b03,this[_0x327849(0x1c7)]=_0x105bd8,this[_0x327849(0x1f1)]={},this[_0x327849(0x1e5)]={};}async[_0x1d4bcb(0x1b5)](){const _0x13c075=_0x1d4bcb;await this['globalConfigService'][_0x13c075(0x1a5)](!![]);}async[_0x1d4bcb(0x1ea)](_0x39d816){const _0x1c6fc9=_0x1d4bcb,{invitedBy:_0xa03938}=_0x39d816;let _0x377b93=(0x0,utils_1[_0x1c6fc9(0x1cc)])(0x20);return _0xa03938&&(_0x377b93+=':'+_0xa03938),this[_0x1c6fc9(0x1f1)][_0x377b93]=!![],_0x377b93;}async['getQRSceneStrByBind'](_0x1d7ddb){const _0x107961=_0x1d4bcb,{id:_0x2dbe05}=_0x1d7ddb['user'],_0x940088=(0x0,utils_1['createRandomNonceStr'])(0x20)+'/'+_0x2dbe05;return this[_0x107961(0x1f1)][_0x940088]=!![],_0x940088;}async['getQRCodeTicket'](_0x35676c){const _0x4565cc=_0x1d4bcb;return this[_0x4565cc(0x1f4)](_0x35676c);}async[_0x1d4bcb(0x1d5)](_0x3c9515){const _0x3e5407=_0x1d4bcb,_0x2b7e04=await this[_0x3e5407(0x1a2)][_0x3e5407(0x1f8)]([_0x3e5407(0x1d0)]),_0x211181=_0x3e5407(0x204)+_0x2b7e04+'&redirect_uri='+encodeURIComponent(_0x3c9515)+_0x3e5407(0x1e1);return console[_0x3e5407(0x1a0)](_0x3e5407(0x198),_0x211181),_0x211181;}async[_0x1d4bcb(0x1c8)](_0x211f13){const _0x40d37e=_0x1d4bcb,_0x4c0a2f=(0x0,utils_1[_0x40d37e(0x1cc)])(0x20),_0x3c75fc=(Date['now']()/0x3e8)[_0x40d37e(0x1bf)](0x0),_0x1c524e=await this[_0x40d37e(0x1a2)][_0x40d37e(0x1f8)](['wechatJsapiTicket']);console[_0x40d37e(0x1a0)](_0x40d37e(0x1b8),_0x1c524e);const _0x213b8b=await this['globalConfigService']['getConfigs']([_0x40d37e(0x1d0)]);console[_0x40d37e(0x1a0)](_0x40d37e(0x1da),_0x213b8b);const _0x425051=_0x40d37e(0x1c6)+_0x1c524e+_0x40d37e(0x19d)+_0x4c0a2f+'&timestamp='+_0x3c75fc+_0x40d37e(0x207)+_0x211f13;console['log'](_0x40d37e(0x1a6),_0x425051);const _0x3d735b=this[_0x40d37e(0x1cf)](_0x425051);return{'appId':_0x213b8b,'nonceStr':_0x4c0a2f,'timestamp':_0x3c75fc,'signature':_0x3d735b};}async['fetchQRCodeTicket'](_0x19e1b9){const _0x213436=_0x1d4bcb,_0x18ea5b=await this['globalConfigService'][_0x213436(0x1f8)]([_0x213436(0x1ad)]),_0x109ecc={'action_name':_0x213436(0x1ce),'action_info':{'scene':{'scene_str':_0x19e1b9}}},_0x2721a3=await axios_1[_0x213436(0x1bd)][_0x213436(0x1e2)](_0x213436(0x1fd)+_0x18ea5b,_0x109ecc),{data:{errmsg:_0x666a9e,ticket:_0x2dbba4}}=_0x2721a3;if(_0x666a9e)throw new common_1[(_0x213436(0x1a4))](_0x666a9e,common_1['HttpStatus'][_0x213436(0x1ab)]);return _0x2dbba4;}async[_0x1d4bcb(0x1fa)](_0x5e2a7c,_0x37ae0e){const _0x3228e0=_0x1d4bcb,_0x1b1894=await this['globalConfigService'][_0x3228e0(0x1f8)]([_0x3228e0(0x1d0)]),_0x5e7467=await this['globalConfigService'][_0x3228e0(0x1f8)]([_0x3228e0(0x1d8)]),_0x50f08f=await axios_1[_0x3228e0(0x1bd)][_0x3228e0(0x1dc)](_0x3228e0(0x1b4)+_0x1b1894+_0x3228e0(0x1c0)+_0x5e7467+_0x3228e0(0x206)+_0x37ae0e+_0x3228e0(0x1c4)),{data:{errmsg:_0x1f4d98,openid:_0x413e5f,access_token:_0x41b1d2}}=_0x50f08f;if(_0x1f4d98)throw new common_1[(_0x3228e0(0x1a4))](_0x1f4d98,common_1[_0x3228e0(0x197)][_0x3228e0(0x1ab)]);let _0x4cac13,_0x2bcd12=new Login_vo_1[(_0x3228e0(0x1b6))]();_0x2bcd12[_0x3228e0(0x1e7)]=_0x413e5f,_0x4cac13=await this[_0x3228e0(0x1b3)][_0x3228e0(0x1d1)](_0x413e5f);if(_0x4cac13)_0x2bcd12[_0x3228e0(0x1f2)]=await this[_0x3228e0(0x200)][_0x3228e0(0x195)](_0x4cac13,_0x5e2a7c);else{if(_0x41b1d2){const {data:_0x3cb23e}=await axios_1[_0x3228e0(0x1bd)][_0x3228e0(0x1dc)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20https://api.weixin.qq.com/sns/userinfo?access_token='+_0x41b1d2+_0x3228e0(0x199)+_0x413e5f+_0x3228e0(0x1cb));!_0x3cb23e[_0x3228e0(0x1e3)]&&console['error'](_0x3cb23e['errmsg']),_0x2bcd12[_0x3228e0(0x1c3)]=_0x3cb23e;}}return _0x2bcd12;}async['scan'](_0x56385c,_0x2352ad){const _0x1992d3=_0x1d4bcb;if(!this[_0x1992d3(0x1f1)][_0x2352ad])throw new common_1[(_0x1992d3(0x1a4))](_0x1992d3(0x1c9),common_1[_0x1992d3(0x197)][_0x1992d3(0x1ab)]);this['scanedSceneStrMap'][_0x2352ad]=_0x56385c;}async[_0x1d4bcb(0x196)](_0x453af6,_0x5c2de0){const _0x4f522f=_0x1d4bcb;if(!this[_0x4f522f(0x1f1)][_0x5c2de0])return;const _0x307a1b=this[_0x4f522f(0x1e5)][_0x5c2de0];if(!_0x307a1b)return new Login_vo_1[(_0x4f522f(0x1b6))]();let _0xb85836,_0x1c5909=new Login_vo_1[(_0x4f522f(0x1b6))]();return _0x1c5909[_0x4f522f(0x1e7)]=_0x307a1b,_0xb85836=await this[_0x4f522f(0x1b3)]['getUserOpenId'](_0x307a1b),_0xb85836&&(_0x1c5909[_0x4f522f(0x1f2)]=await this[_0x4f522f(0x200)][_0x4f522f(0x195)](_0xb85836,_0x453af6)),delete this['scanedSceneStrMap'][_0x5c2de0],_0x1c5909;}async[_0x1d4bcb(0x19a)](_0x332048,_0x2c914c){const _0x152fae=_0x1d4bcb;if(!this[_0x152fae(0x1f1)][_0x2c914c])throw new common_1[(_0x152fae(0x1a4))](_0x152fae(0x1c9),common_1[_0x152fae(0x197)][_0x152fae(0x1ab)]);const _0x2e13dd=_0x2c914c[_0x152fae(0x1e0)]('/')[0x1],_0x15ef0e=await this[_0x152fae(0x1b3)][_0x152fae(0x203)](_0x332048,_0x2e13dd);this['scanedSceneStrMap'][_0x2c914c]=_0x15ef0e;}async['bindWxBySceneStr'](_0xc25e12,_0x47a0ec){const _0x3f7102=_0x1d4bcb;if(!this['sceneStrMap'][_0x47a0ec])throw new common_1[(_0x3f7102(0x1a4))]('非法参数',common_1[_0x3f7102(0x197)][_0x3f7102(0x1ab)]);const {id:_0x1c9bf6}=_0xc25e12['user'],_0x6ebf37=this[_0x3f7102(0x1e5)][_0x47a0ec];if(!_0x6ebf37)return'';return delete this['scanedSceneStrMap'][_0x47a0ec],_0x6ebf37;}async['verify'](_0x58fcca,_0x5c5a99,_0x9c3967){const _0x264fe5=_0x1d4bcb,_0x138d02=await this[_0x264fe5(0x1a2)][_0x264fe5(0x1f8)]([_0x264fe5(0x1a7)])||_0x264fe5(0x1f6);return await this['sha1']([_0x138d02,_0x5c5a99,_0x9c3967][_0x264fe5(0x1ac)]()[_0x264fe5(0x1aa)](''))==_0x58fcca;}['sha1'](_0xb52ca0){const _0x1cad05=_0x1d4bcb;return crypto['createHash'](_0x1cad05(0x1cf))[_0x1cad05(0x1fe)](_0xb52ca0)['digest'](_0x1cad05(0x1a9));}async[_0x1d4bcb(0x1d7)](_0x432857,_0x53cbfb){const _0x4300e2=_0x1d4bcb,_0x487e58=await this['globalConfigService'][_0x4300e2(0x1f8)]([_0x53cbfb]);return this[_0x4300e2(0x1d4)](_0x432857,_0x487e58);}async['genXmlMsg'](_0x58ef8f,_0x23b6ad){const _0x1e17a1=_0x1d4bcb;return _0x1e17a1(0x1db)+_0x58ef8f[_0x1e17a1(0x1af)][0x0]+']]></ToUserName>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<FromUserName><![CDATA['+_0x58ef8f['tousername'][0x0]+_0x1e17a1(0x1a8)+(0x0,date_1[_0x1e17a1(0x1bd)])()[_0x1e17a1(0x1b2)]()+_0x1e17a1(0x1e9)+_0x23b6ad+_0x1e17a1(0x1df);}async[_0x1d4bcb(0x1ba)](_0x21234b){const _0x551b95=_0x1d4bcb;let _0x376bca=await this[_0x551b95(0x1c2)][_0x551b95(0x1d3)](_0x21234b);if(!_0x376bca){const _0x6320f5=await this[_0x551b95(0x1a2)][_0x551b95(0x1f8)]([_0x551b95(0x1ec)]);_0x376bca=_0x6320f5;}return _0x376bca;}async[_0x1d4bcb(0x1de)](_0x3b4fd0,_0x376b85){const _0x57ca1f=_0x1d4bcb;console[_0x57ca1f(0x1a0)](_0x3b4fd0['ip']);if(_0x376b85==='official'){const _0x12ab2d=await this['globalConfigService']['getConfigs'](['wechatAccessToken']);return _0x12ab2d;}else{if(_0x376b85==='mini'){const _0x3a5571=await this[_0x57ca1f(0x1c7)][_0x57ca1f(0x1dc)]({'key':redisKey_constant_1['WE_MINI_ACCESS_KEY']});return _0x3a5571;}else throw new common_1['HttpException'](null,common_1['HttpStatus'][_0x57ca1f(0x1ab)]);}}};function _0x3c6e(_0x7bd8b5,_0x2501e1){const _0x4d5eed=_0x4d5e();return _0x3c6e=function(_0x3c6e3c,_0x60f138){_0x3c6e3c=_0x3c6e3c-0x195;let _0x2a6584=_0x4d5eed[_0x3c6e3c];return _0x2a6584;},_0x3c6e(_0x7bd8b5,_0x2501e1);}OfficialService=__decorate([(0x0,common_1[_0x1d4bcb(0x1e8)])(),__metadata(_0x1d4bcb(0x1d6),[autoreply_service_1[_0x1d4bcb(0x1bc)],user_service_1[_0x1d4bcb(0x1eb)],auth_service_1['AuthService'],globalConfig_service_1[_0x1d4bcb(0x1a1)],redisCache_service_1[_0x1d4bcb(0x1f7)]])],OfficialService),exports[_0x1d4bcb(0x19e)]=OfficialService;