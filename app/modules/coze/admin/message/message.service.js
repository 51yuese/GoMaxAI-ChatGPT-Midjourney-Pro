'use strict';function _0x1e74(){const _0x242324=['metadata','decorate','query','\x20and\x20bot.id\x20is\x20not\x20null\x20','1585997QjZcXd','configEntity','496494CGSKRC','6014eXkWDS','BAD_REQUEST','Repository','HttpStatus','object','defineProperty','4727096bQZbLS','BaseService','HttpException','__param','../../../../common/admin/baseService','clsService','24TnCnUz','16374hwFFbW','function','Injectable','25COmhxT','__metadata','count','message','86124BDhxij','InjectRepository','12GTsgZF','length','__decorate','__esModule','getOwnPropertyDescriptor','where\x20bot.id\x20is\x20not\x20null\x20','alllist','CozeMessageEntity','where','3443180uPmKnE','228QBzgWJ','ceil'];_0x1e74=function(){return _0x242324;};return _0x1e74();}const _0xd3f2ac=_0x1130;(function(_0x2804ae,_0x52dcf1){const _0x54bb06=_0x1130,_0x30740f=_0x2804ae();while(!![]){try{const _0x19bb0a=parseInt(_0x54bb06(0x127))/0x1*(-parseInt(_0x54bb06(0x111))/0x2)+-parseInt(_0x54bb06(0x11e))/0x3*(parseInt(_0x54bb06(0x131))/0x4)+-parseInt(_0x54bb06(0x121))/0x5*(-parseInt(_0x54bb06(0x125))/0x6)+parseInt(_0x54bb06(0x10e))/0x7+-parseInt(_0x54bb06(0x11d))/0x8*(-parseInt(_0x54bb06(0x110))/0x9)+-parseInt(_0x54bb06(0x130))/0xa+parseInt(_0x54bb06(0x117))/0xb;if(_0x19bb0a===_0x52dcf1)break;else _0x30740f['push'](_0x30740f['shift']());}catch(_0x5b6c17){_0x30740f['push'](_0x30740f['shift']());}}}(_0x1e74,0x31553));var __decorate=this&&this[_0xd3f2ac(0x129)]||function(_0x4ce4e9,_0x1461b3,_0x52fa8d,_0x44c6d2){const _0x450065=_0xd3f2ac;var _0x1cd392=arguments[_0x450065(0x128)],_0x5dce09=_0x1cd392<0x3?_0x1461b3:_0x44c6d2===null?_0x44c6d2=Object[_0x450065(0x12b)](_0x1461b3,_0x52fa8d):_0x44c6d2,_0x36eb3e;if(typeof Reflect==='object'&&typeof Reflect[_0x450065(0x134)]===_0x450065(0x11f))_0x5dce09=Reflect[_0x450065(0x134)](_0x4ce4e9,_0x1461b3,_0x52fa8d,_0x44c6d2);else{for(var _0xfcb755=_0x4ce4e9[_0x450065(0x128)]-0x1;_0xfcb755>=0x0;_0xfcb755--)if(_0x36eb3e=_0x4ce4e9[_0xfcb755])_0x5dce09=(_0x1cd392<0x3?_0x36eb3e(_0x5dce09):_0x1cd392>0x3?_0x36eb3e(_0x1461b3,_0x52fa8d,_0x5dce09):_0x36eb3e(_0x1461b3,_0x52fa8d))||_0x5dce09;}return _0x1cd392>0x3&&_0x5dce09&&Object[_0x450065(0x116)](_0x1461b3,_0x52fa8d,_0x5dce09),_0x5dce09;},__metadata=this&&this[_0xd3f2ac(0x122)]||function(_0x366af2,_0x1e613f){const _0x589766=_0xd3f2ac;if(typeof Reflect===_0x589766(0x115)&&typeof Reflect['metadata']===_0x589766(0x11f))return Reflect[_0x589766(0x133)](_0x366af2,_0x1e613f);},__param=this&&this[_0xd3f2ac(0x11a)]||function(_0x46387d,_0x4b4d6c){return function(_0x1d068e,_0x11624c){_0x4b4d6c(_0x1d068e,_0x11624c,_0x46387d);};};Object['defineProperty'](exports,_0xd3f2ac(0x12a),{'value':!![]}),exports['CozeMessageService']=void 0x0;const common_1=require('@nestjs/common'),nestjs_cls_1=require('nestjs-cls'),typeorm_1=require('@nestjs/typeorm'),baseService_1=require(_0xd3f2ac(0x11b)),typeorm_2=require('typeorm'),message_entity_1=require('../../entity/message.entity');function _0x1130(_0x46b61f,_0x19b3ed){const _0x1e744d=_0x1e74();return _0x1130=function(_0x1130b2,_0x22994e){_0x1130b2=_0x1130b2-0x10c;let _0x4fc03c=_0x1e744d[_0x1130b2];return _0x4fc03c;},_0x1130(_0x46b61f,_0x19b3ed);}let CozeMessageService=class CozeMessageService extends baseService_1[_0xd3f2ac(0x118)]{constructor(_0xd81103,_0x11049b){const _0x2816da=_0xd3f2ac;super(_0x11049b,_0xd81103),this[_0x2816da(0x11c)]=_0xd81103,this[_0x2816da(0x10f)]=_0x11049b;}async[_0xd3f2ac(0x12d)](_0x219558){const _0x235b10=_0xd3f2ac;try{let {condition:_0x325151,sort:_0x1a3635,page:_0x21650f,size:_0x57440b}=this['getCondition'](_0x219558);_0x325151['indexOf'](_0x235b10(0x12f))==-0x1?_0x325151=_0x235b10(0x12c):_0x325151+=_0x235b10(0x10d);const _0x50143d=this[_0x235b10(0x10f)]['metadata'],_0x5baa7a=await this['configEntity']['query']('select\x20count(0)\x20as\x20count\x20from\x20coze_message_tb\x20chat\x20left\x20join\x20users\x20user\x20on\x20chat.userId=user.id\x20left\x20join\x20coze_bot_tb\x20bot\x20on\x20chat.botId=bot.botId\x20\x20'+_0x325151),_0x10d511=await this[_0x235b10(0x10f)][_0x235b10(0x10c)]('select\x20chat.*,user.nickname,user.email,user.phone,user.username,bot.name\x20as\x20botName\x20from\x20coze_message_tb\x20chat\x20left\x20join\x20users\x20user\x20on\x20chat.userId=user.id\x20left\x20join\x20coze_bot_tb\x20bot\x20on\x20chat.botId=bot.botId\x20\x20'+_0x325151+'\x20\x20'+_0x1a3635+'\x20limit\x20'+_0x21650f*_0x57440b+','+_0x57440b);return{'rows':_0x10d511,'size':_0x57440b,'page':_0x21650f,'count':parseInt(_0x5baa7a[0x0][_0x235b10(0x123)]),'totalPage':Math[_0x235b10(0x132)](_0x5baa7a[0x0][_0x235b10(0x123)]/_0x57440b)};}catch(_0x45f79b){throw new common_1[(_0x235b10(0x119))](_0x45f79b[_0x235b10(0x124)],common_1[_0x235b10(0x114)][_0x235b10(0x112)]);}}};CozeMessageService=__decorate([(0x0,common_1[_0xd3f2ac(0x120)])(),__param(0x1,(0x0,typeorm_1[_0xd3f2ac(0x126)])(message_entity_1[_0xd3f2ac(0x12e)])),__metadata('design:paramtypes',[nestjs_cls_1['ClsService'],typeorm_2[_0xd3f2ac(0x113)]])],CozeMessageService),exports['CozeMessageService']=CozeMessageService;