'use strict';const _0x129447=_0x309c;(function(_0x4e768d,_0x2f9aa4){const _0x79a3=_0x309c,_0x1befb7=_0x4e768d();while(!![]){try{const _0x4f8959=parseInt(_0x79a3(0x143))/0x1+parseInt(_0x79a3(0x19a))/0x2+-parseInt(_0x79a3(0x145))/0x3*(-parseInt(_0x79a3(0x158))/0x4)+-parseInt(_0x79a3(0x167))/0x5*(parseInt(_0x79a3(0x1d9))/0x6)+-parseInt(_0x79a3(0x1fd))/0x7*(-parseInt(_0x79a3(0x1c3))/0x8)+parseInt(_0x79a3(0x1db))/0x9+-parseInt(_0x79a3(0x1eb))/0xa;if(_0x4f8959===_0x2f9aa4)break;else _0x1befb7['push'](_0x1befb7['shift']());}catch(_0x14bb5d){_0x1befb7['push'](_0x1befb7['shift']());}}}(_0x5d4b,0x3a9d9));function _0x5d4b(){const _0x5597dc=['data','原密码不可为空','AGENT','&username=','updatePassword','userInitVip','/api/auth/registerError?message=','Injectable','验证码不能为空！','__param','验证码已过期、请重新发送！','openid','weAppOpenId','verifyCaptcha','loginV4','signinEntity','loginByPhoneV3','getJwtToken','phone_info','queryOne','/api/auth/changeEmailSuccess?id=','getReqSaasId','sendEmailCode','padStart','账户不存在，请联系管理员或注册','WE_MINI_APPSECRET','密码修改成功','邮箱格式错误！','toString','WE_MINI_TEMP_USER','873756xNMXNP','format','秒内不得重复发送短信！','verificationService','&code=','jwtService','role','../signin/signIn.entity','registeV3','email','get','password','&registerFailEmailTeamName=','旧密码错误、请检查提交','UserStatusEnum','shouldAccess','validatePhoneCode','phoneCode','loginWithWechatApp:\x20','手机号不能为空','../../common/utils/date','nickname','&registerSuccessEmailTeamName=','length','参数错误！','的注册验证','WE_APP_APPID','getClientIp','findOne','registerSuccessEmailTitle','https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=','ERole','InjectRepository','&registerSuccessEmailTitle=','验证码发送成功、请填写验证码完成注册！','../user/user.service','Error','env','userId','errcode','clsService','16vjgQVB','authorization_code','authToken','Repository','ACTIVE','WE_MINI_ACCESS_KEY','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','client_credential',':PHONECODE:','&grant_type=authorization_code','invitationRewards','../mailer/mailer.service','角色信息异常！','WE_APP_TEMP_USER','VerificationEnum','response','loginByAdmin','getPhoneStatus','set','MailerService','renewMiniAccessToken','WechatConfig','13074KvsQYt','createUser','1932867sWEQnt','@nestjs/common','message','access_token','accessLabel','access:','当前用户已注册，请勿重复注册！','../../common/constants/user.constant','saveToken','/api/auth/registerSuccess?id=','default','unionid','HttpException','getUserStatus','globalConfigService','WE_APP_APPSECRET','3919110hzsmDd','mailerService','openId','error','../../common/store','username','purePhoneNumber','createVerification','registerBaseUrl','../user/role.entity','AuthService','isVerifyEmail','userEntity','hashSync','signToken',':CAPTCHA:','phone','&registerSuccessEmaileAppend=','1076264nQeKkq','GlobalConfigService','该手机号已被其他账号绑定','registeByPhone','Logger','getPhoneInMini:\x20','function','__esModule','verifyCode','账号注册时密码不能为空！','bindPhone','updateUserStatus','邮箱已被其他用户使用','qureyUserInfoByInviteCode','decorate','metadata','用户名格式错误！','ceshi.qumao518.vip','createRandomUid','axios','updateUserMiniOpenId','registerVerifyExpir','registerVerifyEmailDesc','createMathExpr','comparePassword','registerVerifyEmailTitle','验证码填写错误、请重新输入！','Registration','errmsg','nestjs-cls','registerFailEmailTeamName','saas.qumao518.vip','save','registerVerifyEmailFrom','@nestjs/typeorm','changeEmail','https://api.weixin.qq.com/cgi-bin/stable_token','userService','loginInMinigin:\x20','registerSuccessEmailTeamName','sendMail','typeorm','design:paramtypes','getPhoneInMini','svg-captcha','loginInMinigin','saasId','updateEmail','savaLoginIp','activateAccount','loginWithWechatApp','redirect','RedisCacheService','test','miniOpenId','registerFailEmailTitle','113221rkFOvE','roleEntity','4254VmGXZF','checkUserOriginalPhone','user','text','BAD_REQUEST','compareSync','invitedBy','WE_MiNI_APPID','redisCacheService','BadRequest','HttpStatusCode','changeScore4registe','JwtService','getConfigByKeys','RoleEntity','visitor','status','getNamespace','ChangeEmail','24oicaYe','queryUserInfoById','&registerFailEmailTitle=','YYYY-MM-DD','accessToken','log','../../common/constants/redisKey.constant','ttl','emailVerify','GOMAXAI_HOST','用户名或密码错误！','@nine.com','./vo/WeAppLogin.vo','../../common/constants/Role.constant','用户名或密码错误','1030wsseMv','UserStatusErrMsg','HttpStatus','registerSuccessEmaileAppend','defineProperty','createTokenFromFingerprint','VerificationService','../../common/utils','userDefautlAvatar','该邮箱已注册！','WeAppLoginVO','createRandomCode','验证码类型错误','avatar','getOne','ClsService','bindPhoneInMini','sign','getOwnPropertyDescriptor','post','UserEntity'];_0x5d4b=function(){return _0x5597dc;};return _0x5d4b();}function _0x309c(_0xfbd070,_0x5f4aa7){const _0x5d4bdf=_0x5d4b();return _0x309c=function(_0x309c41,_0x9cae0b){_0x309c41=_0x309c41-0x110;let _0x597082=_0x5d4bdf[_0x309c41];return _0x597082;},_0x309c(_0xfbd070,_0x5f4aa7);}var __decorate=this&&this['__decorate']||function(_0x150893,_0x5cd3cd,_0x4ad03c,_0x23045c){const _0x1bd3a3=_0x309c;var _0x433cd9=arguments[_0x1bd3a3(0x1b1)],_0x4d6c73=_0x433cd9<0x3?_0x5cd3cd:_0x23045c===null?_0x23045c=Object[_0x1bd3a3(0x179)](_0x5cd3cd,_0x4ad03c):_0x23045c,_0x5608bb;if(typeof Reflect==='object'&&typeof Reflect[_0x1bd3a3(0x119)]==='function')_0x4d6c73=Reflect[_0x1bd3a3(0x119)](_0x150893,_0x5cd3cd,_0x4ad03c,_0x23045c);else{for(var _0x38fb92=_0x150893[_0x1bd3a3(0x1b1)]-0x1;_0x38fb92>=0x0;_0x38fb92--)if(_0x5608bb=_0x150893[_0x38fb92])_0x4d6c73=(_0x433cd9<0x3?_0x5608bb(_0x4d6c73):_0x433cd9>0x3?_0x5608bb(_0x5cd3cd,_0x4ad03c,_0x4d6c73):_0x5608bb(_0x5cd3cd,_0x4ad03c))||_0x4d6c73;}return _0x433cd9>0x3&&_0x4d6c73&&Object[_0x1bd3a3(0x16b)](_0x5cd3cd,_0x4ad03c,_0x4d6c73),_0x4d6c73;},__metadata=this&&this['__metadata']||function(_0x113276,_0xf2b92){const _0x3bb796=_0x309c;if(typeof Reflect==='object'&&typeof Reflect[_0x3bb796(0x11a)]===_0x3bb796(0x111))return Reflect[_0x3bb796(0x11a)](_0x113276,_0xf2b92);},__param=this&&this[_0x129447(0x185)]||function(_0x3935a2,_0x2b2926){return function(_0x26bb24,_0x3473f3){_0x2b2926(_0x26bb24,_0x3473f3,_0x3935a2);};};Object[_0x129447(0x16b)](exports,_0x129447(0x112),{'value':!![]}),exports[_0x129447(0x1f5)]=void 0x0;const globalConfig_service_1=require('../globalConfig/globalConfig.service'),verification_constant_1=require('../../common/constants/verification.constant'),verification_service_1=require('./../verification/verification.service'),user_entity_1=require('./../user/user.entity'),common_1=require(_0x129447(0x1dc)),jwt_1=require('@nestjs/jwt'),user_service_1=require(_0x129447(0x1bd)),mailer_service_1=require(_0x129447(0x1ce)),user_constant_1=require(_0x129447(0x1e2)),utils_1=require(_0x129447(0x16e)),redisCache_service_1=require('../redisCache/redisCache.service'),svgCaptcha=require(_0x129447(0x137)),bcrypt=require('bcryptjs'),store_1=require(_0x129447(0x1ef)),axios_1=require(_0x129447(0x11e)),redisKey_constant_1=require(_0x129447(0x15e)),Login_vo_1=require('./vo/Login.vo'),WeAppLogin_vo_1=require(_0x129447(0x164)),typeorm_1=require(_0x129447(0x12d)),typeorm_2=require(_0x129447(0x134)),nestjs_cls_1=require(_0x129447(0x128)),role_entity_1=require(_0x129447(0x1f4)),Role_constant_1=require(_0x129447(0x165)),signIn_entity_1=require(_0x129447(0x1a1)),date_1=require(_0x129447(0x1ae));let AuthService=class AuthService{constructor(_0x5ecef5,_0x235579,_0x30c7ec,_0x3a3947,_0x3481f3,_0x241518,_0x26a9fb,_0x2cbd07,_0x14ae96,_0x130feb){const _0x2460bd=_0x129447;this[_0x2460bd(0x1f7)]=_0x5ecef5,this[_0x2460bd(0x144)]=_0x235579,this[_0x2460bd(0x18b)]=_0x30c7ec,this['clsService']=_0x3a3947,this['jwtService']=_0x3481f3,this['userService']=_0x241518,this['mailerService']=_0x26a9fb,this[_0x2460bd(0x14d)]=_0x2cbd07,this[_0x2460bd(0x19d)]=_0x14ae96,this[_0x2460bd(0x1e9)]=_0x130feb;}['signToken'](_0x11c3ba){const _0x1583eb=_0x129447,{id:_0x50c452,username:_0x4a5326,role:_0x15e576,openId:_0x413f1d,email:_0x17ce93,client:_0x16dfe1,saasId:_0x52c744}=_0x11c3ba;return this[_0x1583eb(0x19f)][_0x1583eb(0x178)]({'id':_0x50c452,'username':_0x4a5326,'role':_0x15e576,'openId':_0x413f1d,'email':_0x17ce93,'client':_0x16dfe1,'saasId':_0x52c744});}async[_0x129447(0x1d3)](_0x5359ed){const _0x25be2d=_0x129447,{username:_0x4f0a80,password:_0x1be8ef}=_0x5359ed;if(!_0x4f0a80||!_0x1be8ef)throw new common_1['HttpException']('账号密码或密码错误',common_1[_0x25be2d(0x169)][_0x25be2d(0x149)]);const _0x150c28=await this[_0x25be2d(0x130)][_0x25be2d(0x175)](_0x4f0a80);if(!_0x150c28)throw new common_1['HttpException'](_0x25be2d(0x194),common_1[_0x25be2d(0x169)][_0x25be2d(0x149)]);if((0x0,utils_1[_0x25be2d(0x123)])(_0x1be8ef,_0x150c28[_0x25be2d(0x1a5)]))throw new common_1[(_0x25be2d(0x1e7))](_0x25be2d(0x166),common_1[_0x25be2d(0x169)][_0x25be2d(0x149)]);return this['signToken'](_0x150c28);}async[_0x129447(0x12e)](_0x1b3c52,_0xcfd507){const _0x568735=_0x129447,_0x287c91=await this[_0x568735(0x1e9)][_0x568735(0x152)](['registerSuccessEmailTitle','registerSuccessEmailTeamName',_0x568735(0x16a),_0x568735(0x142),_0x568735(0x129)]);try{const _0x5dcd81=await this['verificationService']['verifyCode'](_0x1b3c52,verification_constant_1['VerificationEnum'][_0x568735(0x157)]),{type:_0x2f1ee4,userId:_0x416ba8}=_0x5dcd81;if(_0x2f1ee4!==verification_constant_1[_0x568735(0x1d1)][_0x568735(0x157)])throw new common_1[(_0x568735(0x1e7))]('验证码类型错误',common_1['HttpStatus'][_0x568735(0x149)]);let _0x41b116=await this[_0x568735(0x1f7)][_0x568735(0x1b6)]({'where':{'id':_0x416ba8}});_0x41b116[_0x568735(0x1a3)]=_0x1b3c52[_0x568735(0x1a3)],_0x41b116=await this[_0x568735(0x1f7)][_0x568735(0x12b)](_0x41b116);const {id:_0x4468cd,username:_0x343689,email:_0xc37baa}=_0x41b116;_0xcfd507['redirect'](_0x568735(0x190)+_0x4468cd[_0x568735(0x198)]()['padStart'](0x4,'0')+_0x568735(0x17f)+_0x343689+'&email='+_0xc37baa+_0x568735(0x1bb)+_0x287c91[_0x568735(0x1b7)]+_0x568735(0x1b0)+_0x287c91[_0x568735(0x132)]+'&registerSuccessEmaileAppend='+_0x287c91[_0x568735(0x16a)]);}catch(_0x44a2f6){const _0x5e8a5d=_0x44a2f6[_0x568735(0x1d2)];_0xcfd507[_0x568735(0x13e)](_0x568735(0x182)+_0x5e8a5d+_0x568735(0x15a)+_0x287c91[_0x568735(0x142)]+_0x568735(0x1a6)+_0x287c91['registerFailEmailTeamName']);}}async['captcha'](_0x1182ba){const _0x17bfd5=_0x129447,_0x5b603d=await this[_0x17bfd5(0x1e9)][_0x17bfd5(0x156)](),{color:color='#fff'}=_0x1182ba,_0x4e6a24=svgCaptcha[_0x17bfd5(0x122)]({'background':color,'height':0x22,'width':0x78,'noise':0x3}),_0x31f361=_0x4e6a24['text'],_0x5cae9d=(0x0,utils_1[_0x17bfd5(0x11d)])(),_0x25b9ca=_0x5b603d+_0x17bfd5(0x1fa)+_0x5cae9d;return await this['redisCacheService'][_0x17bfd5(0x1d5)]({'key':_0x25b9ca,'val':_0x4e6a24[_0x17bfd5(0x148)]},0x5*0x3c),{'svgCode':_0x4e6a24[_0x17bfd5(0x17c)],'code':_0x5cae9d};}async['sendPhoneCode'](_0x5bc654){const _0x54249c=_0x129447;_0x5bc654['captchaId']&&await this[_0x54249c(0x19d)][_0x54249c(0x189)](_0x5bc654);const {phone:_0x35e8ed}=_0x5bc654,_0x226424=await this[_0x54249c(0x1e9)][_0x54249c(0x156)](),_0x31b444=_0x226424+_0x54249c(0x1cb)+_0x35e8ed,_0x119ee4=await this[_0x54249c(0x14d)][_0x54249c(0x15f)](_0x31b444);if(_0x119ee4&&_0x119ee4>0x0)throw new common_1['HttpException'](_0x119ee4+_0x54249c(0x19c),common_1[_0x54249c(0x169)][_0x54249c(0x149)]);const _0x5220d4=(0x0,utils_1[_0x54249c(0x172)])(),_0x55f4fb={'phone':_0x35e8ed,'code':_0x5220d4};return await this[_0x54249c(0x19d)]['sendPhoneCode'](_0x55f4fb),await this[_0x54249c(0x14d)]['set']({'key':_0x31b444,'val':_0x5220d4},0x1*0x3c),_0x54249c(0x1bc);}async[_0x129447(0x192)](_0x2e9f62){const _0x3911a0=_0x129447;try{var _0x28a0b3=/^[a-zA-Z0-9]+([_.w-]+[a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-.w-]+[a-zA-Z0-9]+)*.[a-zA-Z0-9]+$/;if(!_0x28a0b3[_0x3911a0(0x140)](_0x2e9f62))throw new Error(_0x3911a0(0x197));const _0x3df412=await this[_0x3911a0(0x1f7)][_0x3911a0(0x1b6)]({'where':{'email':_0x2e9f62}});if(_0x3df412)throw new Error(_0x3911a0(0x170));const _0x8439c1=await this[_0x3911a0(0x1e9)][_0x3911a0(0x152)]([_0x3911a0(0x1f3),'registerVerifyEmailTitle',_0x3911a0(0x121),_0x3911a0(0x12c),'registerVerifyExpir']),_0x55c05e=(0x0,utils_1[_0x3911a0(0x172)])(),_0x5209b7=_0x8439c1[_0x3911a0(0x120)]?Number(_0x8439c1[_0x3911a0(0x120)]):0x1e*0x3c;await this['redisCacheService'][_0x3911a0(0x1d5)]({'key':redisKey_constant_1['EMAIL_REGISTE']+_0x2e9f62,'val':_0x55c05e},_0x5209b7*0x3c),await this[_0x3911a0(0x1ec)][_0x3911a0(0x133)]({'to':_0x2e9f62,'template':_0x3911a0(0x160),'subject':'来自'+_0x8439c1[_0x3911a0(0x12c)]+_0x3911a0(0x1b3),'context':{'baseUrl':_0x8439c1[_0x3911a0(0x1f3)],'code':_0x55c05e,..._0x8439c1}});}catch(_0x68f362){throw new common_1[(_0x3911a0(0x1e7))](_0x68f362[_0x3911a0(0x1dd)],common_1[_0x3911a0(0x169)]['BAD_REQUEST']);}}async[_0x129447(0x136)](_0x14b22d){const _0x4e71a4=_0x129447;try{const _0x39044c=await this[_0x4e71a4(0x14d)][_0x4e71a4(0x1a4)]({'key':redisKey_constant_1[_0x4e71a4(0x1c8)]}),_0x3959f9=await axios_1['default']['post'](_0x4e71a4(0x1b8)+_0x39044c,{'code':_0x14b22d});if(_0x3959f9[_0x4e71a4(0x17c)][_0x4e71a4(0x1c1)])throw new Error(_0x3959f9[_0x4e71a4(0x17c)][_0x4e71a4(0x127)]);return _0x3959f9[_0x4e71a4(0x17c)][_0x4e71a4(0x18e)][_0x4e71a4(0x1f1)];}catch(_0x2a88de){common_1[_0x4e71a4(0x201)][_0x4e71a4(0x1ee)](_0x4e71a4(0x110),_0x2a88de);throw new common_1[(_0x4e71a4(0x1e7))](_0x2a88de[_0x4e71a4(0x1dd)],common_1['HttpStatus'][_0x4e71a4(0x149)]);}}async[_0x129447(0x177)](_0x1728b7,_0x532ef8){const _0x4502c5=_0x129447,_0xf50fc4=await this[_0x4502c5(0x136)](_0x1728b7),_0x482cb6=await this[_0x4502c5(0x1f7)][_0x4502c5(0x1b6)]({'where':{'phone':_0xf50fc4}}),_0x27ef6d=await this['userEntity']['findOne']({'where':{'id':_0x532ef8[_0x4502c5(0x147)]['id']}});if(_0x482cb6&&_0x27ef6d&&_0x27ef6d['id']!=_0x482cb6['id'])throw new common_1[(_0x4502c5(0x1e7))](_0x4502c5(0x1ff),common_1['HttpStatus'][_0x4502c5(0x149)]);if(!_0x27ef6d)throw new common_1[(_0x4502c5(0x1e7))](_0x4502c5(0x1be),common_1['HttpStatus'][_0x4502c5(0x149)]);return _0x27ef6d[_0x4502c5(0x1fb)]=_0xf50fc4,await this['userEntity'][_0x4502c5(0x12b)](_0x27ef6d),_0xf50fc4;}async['phoneWithOpenId4regist'](_0x3c4a0e){const _0x14f56c=_0x129447;try{if(!_0x3c4a0e[_0x14f56c(0x1ed)]&&!_0x3c4a0e[_0x14f56c(0x141)]&&!_0x3c4a0e[_0x14f56c(0x188)])throw new Error('openId、miniOpenId、weAppOpenId中必须存在一个');let _0x33196c=_0x14f56c(0x1ed),_0x21bd70={};if(_0x3c4a0e['openId'])_0x33196c=_0x14f56c(0x1ed);else _0x3c4a0e[_0x14f56c(0x141)]?_0x33196c=_0x14f56c(0x141):_0x33196c='weAppOpenId';_0x21bd70[_0x33196c]=_0x3c4a0e[_0x33196c];const _0x3fc39f=await this[_0x14f56c(0x1f7)][_0x14f56c(0x1b6)]({'where':_0x21bd70});if(_0x3fc39f&&_0x3fc39f['phone'])return![];const _0x13d99f=await this[_0x14f56c(0x1f7)][_0x14f56c(0x1b6)]({'where':{'phone':_0x3c4a0e[_0x14f56c(0x1fb)]}});if(_0x13d99f)return!_0x13d99f[_0x33196c];return!![];}catch(_0xd7716a){throw new common_1[(_0x14f56c(0x1e7))](_0xd7716a[_0x14f56c(0x1dd)],common_1[_0x14f56c(0x169)]['BAD_REQUEST']);}}async[_0x129447(0x200)](_0x13c961,_0x1c5181){const _0x5e9255=_0x129447,_0x22bfd4=(0x0,utils_1[_0x5e9255(0x191)])(this[_0x5e9255(0x1c2)]);try{if(!_0x13c961[_0x5e9255(0x1fb)])throw new Error(_0x5e9255(0x1ad));if(!_0x13c961[_0x5e9255(0x1ab)])throw new Error(_0x5e9255(0x184));let _0x12f32b=null;await this['validatePhoneCode'](_0x13c961['phone'],_0x13c961[_0x5e9255(0x1ab)]),_0x12f32b=await this[_0x5e9255(0x1f7)][_0x5e9255(0x1b6)]({'where':{'phone':_0x13c961['phone'],'saasId':_0x22bfd4}});if(_0x12f32b)throw new Error(_0x5e9255(0x1e1));const _0x1efbda=new user_entity_1[(_0x5e9255(0x17b))]();for(let _0x29f722 in _0x13c961){_0x13c961[_0x29f722]&&(_0x1efbda[_0x29f722]=_0x13c961[_0x29f722]);}_0x1efbda['password']&&(_0x1efbda[_0x5e9255(0x1a5)]=bcrypt[_0x5e9255(0x1f8)](_0x13c961[_0x5e9255(0x1a5)],0xa));_0x1efbda[_0x5e9255(0x155)]=user_constant_1[_0x5e9255(0x1a8)][_0x5e9255(0x1c7)];!_0x1efbda[_0x5e9255(0x1af)]&&(_0x1efbda[_0x5e9255(0x1af)]=_0x1efbda[_0x5e9255(0x1af)]||'小智');!_0x1efbda[_0x5e9255(0x174)]&&(_0x1efbda[_0x5e9255(0x174)]=await this[_0x5e9255(0x1e9)]['getConfigByKeys'](['userDefautlAvatar']));_0x1efbda[_0x5e9255(0x139)]=_0x22bfd4;const _0x542c77=await this[_0x5e9255(0x130)]['createUser'](_0x1efbda);this[_0x5e9255(0x1cd)](_0x542c77,_0x13c961['invitedBy']);const _0xf5cae6=(0x0,utils_1[_0x5e9255(0x1b5)])(_0x1c5181),_0x24b2cd=this[_0x5e9255(0x1f9)](_0x542c77);return await this[_0x5e9255(0x130)]['savaLoginIp'](_0x542c77['id'],_0xf5cae6),await this[_0x5e9255(0x14d)][_0x5e9255(0x1e3)](_0x542c77['id'],_0x24b2cd),_0x24b2cd;}catch(_0x41dfbb){if(_0x41dfbb instanceof common_1[_0x5e9255(0x1e7)])throw _0x41dfbb;else throw new common_1[(_0x5e9255(0x1e7))](_0x41dfbb[_0x5e9255(0x1dd)],common_1[_0x5e9255(0x169)][_0x5e9255(0x149)]);}}async[_0x129447(0x1a2)](_0x37e75c,_0x557351){const _0x87f0f1=_0x129447,_0x5186dd=(0x0,utils_1[_0x87f0f1(0x191)])(this['clsService']);try{if(_0x37e75c[_0x87f0f1(0x1f0)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x87f0f1(0x140)](_0x37e75c['username']))throw new Error(_0x87f0f1(0x11b));if(!_0x37e75c[_0x87f0f1(0x1a5)])throw new Error(_0x87f0f1(0x114));}else{if(!_0x37e75c[_0x87f0f1(0x1ed)]&&!_0x37e75c[_0x87f0f1(0x141)]&&!_0x37e75c[_0x87f0f1(0x188)]&&!_0x37e75c['unionid'])throw new Error(_0x87f0f1(0x1b2));}if(_0x37e75c[_0x87f0f1(0x1fb)]&&!_0x37e75c[_0x87f0f1(0x1ab)])throw new Error('验证码不能为空！');let _0x108bad=null;if(_0x37e75c['phone'])await this[_0x87f0f1(0x1aa)](_0x37e75c[_0x87f0f1(0x1fb)],_0x37e75c[_0x87f0f1(0x1ab)]),_0x108bad=await this['userEntity'][_0x87f0f1(0x1b6)]({'where':{'phone':_0x37e75c['phone'],'saasId':_0x5186dd}});else{if(_0x37e75c[_0x87f0f1(0x1ed)]||_0x37e75c[_0x87f0f1(0x141)]||_0x37e75c[_0x87f0f1(0x188)]||_0x37e75c[_0x87f0f1(0x1e6)]){let _0x7c727a=_0x87f0f1(0x1ed),_0x2dd2aa={'saasId':_0x5186dd};if(_0x37e75c[_0x87f0f1(0x1e6)])_0x7c727a=_0x87f0f1(0x1e6);else{if(_0x37e75c[_0x87f0f1(0x1ed)])_0x7c727a=_0x87f0f1(0x1ed);else _0x37e75c[_0x87f0f1(0x141)]?_0x7c727a=_0x87f0f1(0x141):_0x7c727a=_0x87f0f1(0x188);}_0x2dd2aa[_0x7c727a]=_0x37e75c[_0x7c727a],_0x108bad=await this['userEntity'][_0x87f0f1(0x1b6)]({'where':_0x2dd2aa});if(_0x108bad)throw new Error(_0x87f0f1(0x1e1));}else{_0x108bad=await this['userEntity'][_0x87f0f1(0x1b6)]({'where':{'username':_0x37e75c[_0x87f0f1(0x1f0)],'saasId':_0x5186dd}});if(_0x108bad)throw new Error('当前用户已注册，请勿重复注册！');}}const _0x2e4c46=new user_entity_1[(_0x87f0f1(0x17b))]();for(let _0x57ea07 in _0x37e75c){_0x37e75c[_0x57ea07]&&(_0x2e4c46[_0x57ea07]=_0x37e75c[_0x57ea07]);}_0x108bad?_0x2e4c46['id']=_0x108bad['id']:(_0x2e4c46[_0x87f0f1(0x1a5)]&&(_0x2e4c46[_0x87f0f1(0x1a5)]=bcrypt[_0x87f0f1(0x1f8)](_0x37e75c[_0x87f0f1(0x1a5)],0xa)),_0x2e4c46[_0x87f0f1(0x155)]=user_constant_1[_0x87f0f1(0x1a8)][_0x87f0f1(0x1c7)],!_0x2e4c46[_0x87f0f1(0x1af)]&&(_0x2e4c46[_0x87f0f1(0x1af)]=_0x2e4c46[_0x87f0f1(0x1af)]||'小智'),!_0x2e4c46[_0x87f0f1(0x174)]&&(_0x2e4c46[_0x87f0f1(0x174)]=await this[_0x87f0f1(0x1e9)]['getConfigByKeys']([_0x87f0f1(0x16f)])));_0x2e4c46['saasId']=_0x5186dd;const _0x511309=await this[_0x87f0f1(0x130)][_0x87f0f1(0x1da)](_0x2e4c46);!_0x108bad&&this['invitationRewards'](_0x511309,_0x37e75c[_0x87f0f1(0x14b)]);const _0x48d6d8=(0x0,utils_1[_0x87f0f1(0x1b5)])(_0x557351),_0x3bdadf=this['signToken'](_0x511309);return await this[_0x87f0f1(0x130)]['savaLoginIp'](_0x511309['id'],_0x48d6d8),await this['redisCacheService'][_0x87f0f1(0x1e3)](_0x511309['id'],_0x3bdadf),_0x3bdadf;}catch(_0xe07e1d){if(_0xe07e1d instanceof common_1[_0x87f0f1(0x1e7)])throw _0xe07e1d;else throw new common_1['HttpException'](_0xe07e1d[_0x87f0f1(0x1dd)],common_1[_0x87f0f1(0x169)][_0x87f0f1(0x149)]);}}async[_0x129447(0x18c)](_0x2bd994,_0x4e1147){const _0x5c49b0=_0x129447,_0x33ede5=(0x0,utils_1[_0x5c49b0(0x191)])(this[_0x5c49b0(0x1c2)]);await this[_0x5c49b0(0x1aa)](_0x2bd994[_0x5c49b0(0x1fb)],_0x2bd994[_0x5c49b0(0x1ab)]);let _0x246907=await this[_0x5c49b0(0x1f7)][_0x5c49b0(0x1b6)]({'where':{'phone':_0x2bd994[_0x5c49b0(0x1fb)],'saasId':_0x33ede5}});if(!_0x246907){const _0x1584ca=new user_entity_1[(_0x5c49b0(0x17b))]();_0x1584ca[_0x5c49b0(0x1fb)]=_0x2bd994['phone'],_0x1584ca[_0x5c49b0(0x1af)]=_0x2bd994['phone'],_0x1584ca[_0x5c49b0(0x155)]=user_constant_1['UserStatusEnum']['ACTIVE'],_0x1584ca[_0x5c49b0(0x174)]=await this[_0x5c49b0(0x1e9)][_0x5c49b0(0x152)](['userDefautlAvatar']),_0x246907=await this[_0x5c49b0(0x130)][_0x5c49b0(0x1da)](_0x1584ca),this[_0x5c49b0(0x1cd)](_0x246907,_0x2bd994[_0x5c49b0(0x14b)]);}const _0x291995=(0x0,utils_1[_0x5c49b0(0x1b5)])(_0x4e1147),_0x444423=this[_0x5c49b0(0x1f9)](_0x246907);return await this[_0x5c49b0(0x130)]['savaLoginIp'](_0x246907['id'],_0x291995),await this[_0x5c49b0(0x14d)]['saveToken'](_0x246907['id'],_0x444423),_0x444423;}async[_0x129447(0x18a)](_0x13b99c,_0x56e955){const _0xaeca45=_0x129447;try{const _0x5f0e36=(0x0,utils_1[_0xaeca45(0x191)])(this['clsService']),_0x5d06c4=await this[_0xaeca45(0x1f7)][_0xaeca45(0x1b6)]({'where':[{'username':_0x13b99c[_0xaeca45(0x1f0)],'saasId':_0x5f0e36},{'email':_0x13b99c[_0xaeca45(0x1f0)],'saasId':_0x5f0e36},{'phone':_0x13b99c['username'],'saasId':_0x5f0e36}]});if(!_0x5d06c4)throw new Error('用户名或密码错误！');if(!_0x5d06c4[_0xaeca45(0x1a5)])throw new Error('用户名或密码错误！');if(!bcrypt[_0xaeca45(0x14a)](_0x13b99c[_0xaeca45(0x1a5)],_0x5d06c4[_0xaeca45(0x1a5)]))throw new Error(_0xaeca45(0x162));_0x5d06c4[_0xaeca45(0x1f0)]&&!_0x5d06c4['lastLoginIp']&&await this['userService'][_0xaeca45(0x181)](_0x5d06c4);const _0x48a4f0=(0x0,utils_1['getClientIp'])(_0x56e955),_0x7b0ddc=this[_0xaeca45(0x1f9)](_0x5d06c4);await this[_0xaeca45(0x130)][_0xaeca45(0x13b)](_0x5d06c4['id'],_0x48a4f0),await this[_0xaeca45(0x14d)][_0xaeca45(0x1e3)](_0x5d06c4['id'],_0x7b0ddc);if((0x0,utils_1[_0xaeca45(0x1a9)])(_0x5d06c4[_0xaeca45(0x1a0)])){let _0x1cbbb2;_0x5d06c4[_0xaeca45(0x1a0)]===Role_constant_1[_0xaeca45(0x1b9)][_0xaeca45(0x17e)]?_0x1cbbb2=await this[_0xaeca45(0x144)][_0xaeca45(0x1b6)]({'where':{'code':_0x5d06c4[_0xaeca45(0x1a0)]}}):_0x1cbbb2=await this[_0xaeca45(0x144)]['findOne']({'where':{'code':_0x5d06c4['role'],'saasId':_0x5f0e36}});if(!_0x1cbbb2)throw new Error(_0xaeca45(0x1cf));await this[_0xaeca45(0x14d)]['set']({'key':_0xaeca45(0x1e0)+_0x5d06c4['id'],'val':_0x1cbbb2[_0xaeca45(0x1df)]});}return _0x7b0ddc;}catch(_0x412240){throw new common_1[(_0xaeca45(0x1e7))](_0x412240['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x129447(0x138)](_0x1b61e3){const _0x266f23=_0x129447;try{const _0x370286=new Login_vo_1[(_0x266f23(0x1e5))](),_0x1e7bf0=(0x0,utils_1['getReqSaasId'])(this['clsService']),_0x4746e2=await axios_1[_0x266f23(0x1e5)][_0x266f23(0x1a4)]('https://api.weixin.qq.com/sns/jscode2session',{'params':{'appid':store_1[_0x266f23(0x1d8)][_0x266f23(0x14c)],'secret':store_1[_0x266f23(0x1d8)][_0x266f23(0x195)],'js_code':_0x1b61e3,'grant_type':_0x266f23(0x1c4)}}),_0x7b8d8b=_0x4746e2['data'];if(_0x7b8d8b[_0x266f23(0x1c1)])throw new Error(_0x7b8d8b['errmsg']);let _0x603ddc;return _0x7b8d8b[_0x266f23(0x1e6)]&&(_0x603ddc=await this[_0x266f23(0x1f7)][_0x266f23(0x1b6)]({'where':{'unionid':_0x7b8d8b['unionid'],'saasId':_0x1e7bf0}})),!_0x603ddc&&(_0x603ddc=await this['userEntity'][_0x266f23(0x1b6)]({'where':{'miniOpenId':_0x7b8d8b['openid'],'saasId':_0x1e7bf0}})),!_0x603ddc?this[_0x266f23(0x14d)][_0x266f23(0x1d5)]({'key':redisKey_constant_1[_0x266f23(0x199)]+_0x7b8d8b[_0x266f23(0x187)],'val':_0x7b8d8b[_0x266f23(0x1e6)]||null}):(_0x603ddc[_0x266f23(0x1e6)]=_0x7b8d8b[_0x266f23(0x1e6)],_0x603ddc[_0x266f23(0x141)]=_0x7b8d8b[_0x266f23(0x187)],await this[_0x266f23(0x130)][_0x266f23(0x11f)](_0x603ddc['id'],_0x7b8d8b['openid'],_0x7b8d8b[_0x266f23(0x1e6)]),_0x370286[_0x266f23(0x1c5)]=this['signToken'](_0x603ddc),await this[_0x266f23(0x14d)][_0x266f23(0x1e3)](_0x603ddc['id'],_0x370286[_0x266f23(0x1c5)])),_0x370286[_0x266f23(0x1e6)]=_0x7b8d8b[_0x266f23(0x1e6)],_0x370286[_0x266f23(0x187)]=_0x7b8d8b[_0x266f23(0x187)],_0x370286;}catch(_0x5790c9){common_1[_0x266f23(0x201)][_0x266f23(0x1ee)](_0x266f23(0x131),_0x5790c9);throw new common_1[(_0x266f23(0x1e7))](_0x5790c9[_0x266f23(0x1dd)],common_1[_0x266f23(0x169)][_0x266f23(0x149)]);}}async[_0x129447(0x13d)](_0x22a8c3){const _0x4387b7=_0x129447,_0x44e07c=new WeAppLogin_vo_1[(_0x4387b7(0x171))](),_0x1c0975=(0x0,utils_1[_0x4387b7(0x191)])(this[_0x4387b7(0x1c2)]);try{const _0x40cacd=await axios_1[_0x4387b7(0x1e5)][_0x4387b7(0x1a4)](_0x4387b7(0x1c9)+store_1[_0x4387b7(0x1d8)][_0x4387b7(0x1b4)]+'&secret='+store_1['WechatConfig'][_0x4387b7(0x1ea)]+_0x4387b7(0x19e)+_0x22a8c3+_0x4387b7(0x1cc));if(_0x40cacd[_0x4387b7(0x17c)][_0x4387b7(0x1c1)])throw new Error(_0x40cacd['data'][_0x4387b7(0x127)]);const _0x4a4be5=_0x40cacd[_0x4387b7(0x17c)];let _0x4b223d;return _0x4a4be5[_0x4387b7(0x1e6)]&&(_0x4b223d=await this[_0x4387b7(0x1f7)][_0x4387b7(0x1b6)]({'where':{'unionid':_0x4a4be5[_0x4387b7(0x1e6)],'saasId':_0x1c0975}})),!_0x4b223d&&(_0x4b223d=await this[_0x4387b7(0x1f7)]['findOne']({'where':{'weAppOpenId':_0x4a4be5[_0x4387b7(0x187)],'saasId':_0x1c0975}})),!_0x4b223d?this[_0x4387b7(0x14d)][_0x4387b7(0x1d5)]({'key':redisKey_constant_1[_0x4387b7(0x1d0)]+_0x4a4be5[_0x4387b7(0x187)],'val':_0x4a4be5[_0x4387b7(0x1e6)]||null}):(_0x4b223d['unionid']=_0x4a4be5[_0x4387b7(0x1e6)],_0x4b223d[_0x4387b7(0x188)]=_0x4a4be5[_0x4387b7(0x187)],_0x44e07c[_0x4387b7(0x1c5)]=this['signToken'](_0x4b223d),await this[_0x4387b7(0x14d)][_0x4387b7(0x1e3)](_0x4b223d['id'],_0x44e07c['authToken']),await this[_0x4387b7(0x130)]['updateUserAppOpenId'](_0x4b223d['id'],_0x4a4be5[_0x4387b7(0x187)],_0x4a4be5[_0x4387b7(0x1e6)])),_0x44e07c[_0x4387b7(0x187)]=_0x4a4be5['openid'],_0x44e07c['unionid']=_0x4a4be5[_0x4387b7(0x1e6)],_0x44e07c[_0x4387b7(0x15c)]=_0x4a4be5['access_token'],_0x44e07c;}catch(_0x1e4ec0){common_1[_0x4387b7(0x201)]['error'](_0x4387b7(0x1ac),_0x1e4ec0);throw new common_1[(_0x4387b7(0x1e7))](_0x1e4ec0[_0x4387b7(0x1dd)],common_1[_0x4387b7(0x169)][_0x4387b7(0x149)]);}}async[_0x129447(0x13c)](_0x537a13,_0x2170f9){const _0x34d3f7=_0x129447,_0x5a728d=await this[_0x34d3f7(0x1e9)][_0x34d3f7(0x152)](['registerSuccessEmailTitle',_0x34d3f7(0x132),_0x34d3f7(0x16a),_0x34d3f7(0x142),_0x34d3f7(0x129)]);try{const _0x382484=await this[_0x34d3f7(0x19d)][_0x34d3f7(0x113)](_0x537a13,verification_constant_1[_0x34d3f7(0x1d1)][_0x34d3f7(0x126)]),{type:_0x4e63f0,userId:_0x51e746}=_0x382484;if(_0x4e63f0!==verification_constant_1[_0x34d3f7(0x1d1)]['Registration'])throw new common_1[(_0x34d3f7(0x1e7))](_0x34d3f7(0x173),common_1[_0x34d3f7(0x169)][_0x34d3f7(0x149)]);const _0x18764b=await this[_0x34d3f7(0x130)][_0x34d3f7(0x1e8)](_0x51e746);if(_0x18764b===user_constant_1[_0x34d3f7(0x1a8)][_0x34d3f7(0x1c7)])throw new common_1['HttpException']('账户已被激活过',common_1[_0x34d3f7(0x169)][_0x34d3f7(0x149)]);await this['userService'][_0x34d3f7(0x116)](_0x382484[_0x34d3f7(0x1c0)],user_constant_1[_0x34d3f7(0x1a8)][_0x34d3f7(0x1c7)]);const _0x6c2007=await this[_0x34d3f7(0x130)][_0x34d3f7(0x159)](_0x382484[_0x34d3f7(0x1c0)]),{username:_0x41645b,email:_0xa3c43f,id:_0x120bf2,invitedBy:_0x397a8b}=_0x6c2007;let _0x1766a4;_0x397a8b&&(_0x1766a4=await this[_0x34d3f7(0x130)][_0x34d3f7(0x118)](_0x397a8b)),await this[_0x34d3f7(0x130)][_0x34d3f7(0x150)](_0x6c2007,_0x1766a4),_0x2170f9[_0x34d3f7(0x13e)](_0x34d3f7(0x1e4)+_0x120bf2[_0x34d3f7(0x198)]()[_0x34d3f7(0x193)](0x4,'0')+'&username='+_0x41645b+'&email='+_0xa3c43f+_0x34d3f7(0x1bb)+_0x5a728d[_0x34d3f7(0x1b7)]+_0x34d3f7(0x1b0)+_0x5a728d[_0x34d3f7(0x132)]+_0x34d3f7(0x1fc)+_0x5a728d[_0x34d3f7(0x16a)]);}catch(_0x497554){console[_0x34d3f7(0x15d)]('error:\x20',_0x497554);const _0x3bf1dd=_0x497554[_0x34d3f7(0x1d2)];_0x2170f9['redirect'](_0x34d3f7(0x182)+_0x3bf1dd+'&registerFailEmailTitle='+_0x5a728d[_0x34d3f7(0x142)]+'&registerFailEmailTeamName='+_0x5a728d[_0x34d3f7(0x129)]);}}async['getInfo'](_0x27a0e7){const _0x3ac115=_0x129447,_0x1cc451=await this[_0x3ac115(0x130)][_0x3ac115(0x18f)]({'id':_0x27a0e7[_0x3ac115(0x147)]['id']});let _0x32eb65=![];const _0x3d9646=(0x0,date_1[_0x3ac115(0x1e5)])()[_0x3ac115(0x19b)](_0x3ac115(0x15b)),_0x1692d0=await this[_0x3ac115(0x18b)]['findOne']({'where':{'userId':_0x1cc451['id'],'signInDate':_0x3d9646}});return _0x1692d0&&(_0x32eb65=!![]),{'userInfo':_0x1cc451,'isSignIn':_0x32eb65};}async[_0x129447(0x180)](_0x43c4d6,_0x47b5a6){const _0x10c820=_0x129447,{id:_0x259b2a,client:_0x189b29}=_0x43c4d6['user'];if(_0x189b29&&Number(_0x189b29)>0x0)throw new common_1['HttpException']('无权此操作、请联系管理员！',common_1[_0x10c820(0x169)][_0x10c820(0x149)]);const {oldPassword:_0x1f0f9c,password:_0x3f0891}=_0x47b5a6,_0x319cb9=await this[_0x10c820(0x1f7)]['findOne']({'where':{'id':_0x259b2a}});if(_0x319cb9[_0x10c820(0x1a5)]){if(!_0x1f0f9c)throw new common_1[(_0x10c820(0x1e7))](_0x10c820(0x17d),common_1[_0x10c820(0x169)]['BAD_REQUEST']);const _0x44f33b=bcrypt[_0x10c820(0x14a)](_0x1f0f9c,_0x319cb9[_0x10c820(0x1a5)]);if(!_0x44f33b)throw new common_1[(_0x10c820(0x1e7))](_0x10c820(0x1a7),common_1[_0x10c820(0x169)][_0x10c820(0x149)]);}return _0x319cb9[_0x10c820(0x1a5)]=bcrypt[_0x10c820(0x1f8)](_0x3f0891,0xa),await this[_0x10c820(0x1f7)][_0x10c820(0x12b)](_0x319cb9),_0x10c820(0x196);}async[_0x129447(0x13a)](_0x4a3bf4,_0x534095){const _0x1ee9a0=_0x129447,_0x55ba0f=_0x4a3bf4[_0x1ee9a0(0x147)]['id'],_0x7dc010=await this[_0x1ee9a0(0x1f7)][_0x1ee9a0(0x1b6)]({'where':{'email':_0x534095['email']}});if(_0x7dc010)throw new common_1[(_0x1ee9a0(0x1e7))](_0x1ee9a0(0x117),axios_1[_0x1ee9a0(0x14f)][_0x1ee9a0(0x14e)]);const _0x24211b=await this[_0x1ee9a0(0x1f7)][_0x1ee9a0(0x1b6)]({'where':{'id':_0x55ba0f}}),_0x98f32c=await this[_0x1ee9a0(0x1e9)][_0x1ee9a0(0x152)]([_0x1ee9a0(0x1f6),_0x1ee9a0(0x1f3),_0x1ee9a0(0x124),'registerVerifyEmailDesc','registerVerifyEmailFrom',_0x1ee9a0(0x120)]);_0x24211b['email']=_0x534095[_0x1ee9a0(0x1a3)];const _0x14610d=_0x98f32c['registerVerifyExpir']?Number(_0x98f32c[_0x1ee9a0(0x120)]):0x1e*0x3c,_0x236109=await this[_0x1ee9a0(0x19d)][_0x1ee9a0(0x1f2)](_0x24211b,verification_constant_1[_0x1ee9a0(0x1d1)][_0x1ee9a0(0x157)],_0x14610d),{code:_0x2a3cb7,email:_0x1004e8,id:_0xe89231}=_0x236109,{registerVerifyEmailFrom:_0x24825b}=_0x98f32c;await this[_0x1ee9a0(0x1ec)][_0x1ee9a0(0x133)]({'to':_0x1004e8,'template':_0x1ee9a0(0x12e),'subject':'来自'+_0x24825b+'的邮箱验证','context':{'id':_0xe89231,'code':_0x2a3cb7,'email':_0x1004e8,..._0x98f32c,'baseUrl':_0x98f32c[_0x1ee9a0(0x1f3)]}});}async[_0x129447(0x1d4)](_0x56e3bd){const _0x205da0=await this['userEntity']['count']({'where':{'phone':_0x56e3bd}});return _0x205da0>0x0;}async[_0x129447(0x115)](_0x316e10){const _0x33f11b=_0x129447;await this[_0x33f11b(0x1aa)](_0x316e10[_0x33f11b(0x1fb)],_0x316e10[_0x33f11b(0x1ab)]);if(await this[_0x33f11b(0x1d4)](_0x316e10[_0x33f11b(0x1fb)]))throw new common_1[(_0x33f11b(0x1e7))]('当前手机号已绑定其他账户！',common_1[_0x33f11b(0x169)][_0x33f11b(0x149)]);return await this[_0x33f11b(0x1f7)][_0x33f11b(0x12b)]({'id':_0x316e10[_0x33f11b(0x1c0)],'phone':_0x316e10['phone']}),!![];}async[_0x129447(0x1d7)](){const _0x534e17=_0x129447;try{const _0x23d461=process[_0x534e17(0x1bf)][_0x534e17(0x161)];if(_0x23d461==='kaifa.qumao518.vip'||_0x23d461===_0x534e17(0x11c)||_0x23d461===_0x534e17(0x12a)){const _0x33d522=await axios_1[_0x534e17(0x1e5)][_0x534e17(0x1a4)]('https://gomaxai.qumao518.vip/api/official/getAccessToken?type=mini');await this[_0x534e17(0x14d)][_0x534e17(0x1d5)]({'key':redisKey_constant_1['WE_MINI_ACCESS_KEY'],'val':_0x33d522[_0x534e17(0x17c)][_0x534e17(0x17c)]});}else{const _0xf8b908=await axios_1['default'][_0x534e17(0x17a)](_0x534e17(0x12f),{'grant_type':_0x534e17(0x1ca),'appid':store_1[_0x534e17(0x1d8)][_0x534e17(0x14c)],'secret':store_1['WechatConfig'][_0x534e17(0x195)],'force_refresh':![]});await this[_0x534e17(0x14d)][_0x534e17(0x1d5)]({'key':redisKey_constant_1[_0x534e17(0x1c8)],'val':_0xf8b908['data'][_0x534e17(0x1de)]});}}catch(_0x3a8dac){common_1[_0x534e17(0x201)]['error']('wechat\x20获取access_token\x20失败：',_0x3a8dac);}}[_0x129447(0x16c)](_0x2e4986){const _0x29b387=_0x129447,_0x4dc356={'id':_0x2e4986,'openId':null,'client':null,'role':_0x29b387(0x154),'username':'游客'+_0x2e4986,'email':_0x2e4986+_0x29b387(0x163),'saasId':(0x0,utils_1[_0x29b387(0x191)])(this[_0x29b387(0x1c2)])};return this['signToken'](_0x4dc356);}async[_0x129447(0x18d)](_0x1cc557,_0x39c4e5){const _0x18aa2e=_0x129447,{status:_0x2e1354}=_0x1cc557;if(_0x2e1354!==user_constant_1[_0x18aa2e(0x1a8)][_0x18aa2e(0x1c7)])throw new common_1[(_0x18aa2e(0x1e7))](user_constant_1[_0x18aa2e(0x168)][_0x2e1354],common_1[_0x18aa2e(0x169)]['BAD_REQUEST']);const _0x42580b=(0x0,utils_1[_0x18aa2e(0x1b5)])(_0x39c4e5),_0x51f5a1=this[_0x18aa2e(0x1f9)](_0x1cc557);return await this[_0x18aa2e(0x130)][_0x18aa2e(0x13b)](_0x1cc557['id'],_0x42580b),await this[_0x18aa2e(0x14d)]['saveToken'](_0x1cc557['id'],_0x51f5a1),_0x51f5a1;}async['validatePhoneCode'](_0x164cb5,_0x20bec4){const _0x4f1499=_0x129447,_0x506113=await this[_0x4f1499(0x1e9)][_0x4f1499(0x156)](),_0x58ba37=_0x506113+_0x4f1499(0x1cb)+_0x164cb5;if(_0x20bec4==='000000')return;const _0x20fb55=await this[_0x4f1499(0x14d)]['get']({'key':_0x58ba37});if(!_0x20fb55)throw new common_1[(_0x4f1499(0x1e7))](_0x4f1499(0x186),common_1[_0x4f1499(0x169)][_0x4f1499(0x149)]);if(_0x20bec4!==_0x20fb55)throw new common_1[(_0x4f1499(0x1e7))](_0x4f1499(0x125),common_1[_0x4f1499(0x169)][_0x4f1499(0x149)]);}async['invitationRewards'](_0x1a681b,_0x7eec88){const _0x67e15a=_0x129447;let _0x1b8a78;_0x7eec88&&(_0x1b8a78=await this[_0x67e15a(0x130)]['qureyUserInfoByInviteCode'](_0x7eec88)),await this[_0x67e15a(0x130)][_0x67e15a(0x150)](_0x1a681b,_0x1b8a78);}async[_0x129447(0x146)](_0x4a041f,_0x188e9d,_0x24d3df){const _0x1aabbb=_0x129447;await this[_0x1aabbb(0x1aa)](_0x4a041f,_0x188e9d);const _0x2b24ce=await this[_0x1aabbb(0x1f7)][_0x1aabbb(0x1b6)]({'where':{'id':_0x24d3df['user']['id']}});if(_0x2b24ce[_0x1aabbb(0x1fb)]!==_0x4a041f)throw new common_1[(_0x1aabbb(0x1e7))]('手机号错误！',common_1['HttpStatus'][_0x1aabbb(0x149)]);return!![];}};AuthService=__decorate([(0x0,common_1[_0x129447(0x183)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x129447(0x17b)])),__param(0x1,(0x0,typeorm_1[_0x129447(0x1ba)])(role_entity_1[_0x129447(0x153)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(signIn_entity_1['SigninEntity'])),__metadata(_0x129447(0x135),[typeorm_2['Repository'],typeorm_2[_0x129447(0x1c6)],typeorm_2['Repository'],nestjs_cls_1[_0x129447(0x176)],jwt_1[_0x129447(0x151)],user_service_1['UserService'],mailer_service_1[_0x129447(0x1d6)],redisCache_service_1[_0x129447(0x13f)],verification_service_1[_0x129447(0x16d)],globalConfig_service_1[_0x129447(0x1fe)]])],AuthService),exports[_0x129447(0x1f5)]=AuthService;