'use strict';function _0x38f9(_0xa363d3,_0x31a59e){const _0x4f467f=_0x4f46();return _0x38f9=function(_0x38f964,_0x4a1927){_0x38f964=_0x38f964-0x1cc;let _0x187b68=_0x4f467f[_0x38f964];return _0x187b68;},_0x38f9(_0xa363d3,_0x31a59e);}const _0x214c48=_0x38f9;(function(_0x3720e6,_0x25feb4){const _0xf014a6=_0x38f9,_0x12fc4b=_0x3720e6();while(!![]){try{const _0x3883bd=parseInt(_0xf014a6(0x270))/0x1+parseInt(_0xf014a6(0x277))/0x2+parseInt(_0xf014a6(0x29d))/0x3+parseInt(_0xf014a6(0x27f))/0x4*(parseInt(_0xf014a6(0x22b))/0x5)+parseInt(_0xf014a6(0x28c))/0x6+-parseInt(_0xf014a6(0x2ba))/0x7+-parseInt(_0xf014a6(0x267))/0x8*(parseInt(_0xf014a6(0x225))/0x9);if(_0x3883bd===_0x25feb4)break;else _0x12fc4b['push'](_0x12fc4b['shift']());}catch(_0x15d5d5){_0x12fc4b['push'](_0x12fc4b['shift']());}}}(_0x4f46,0x245f9));var __decorate=this&&this[_0x214c48(0x22c)]||function(_0x436085,_0x5525ca,_0x121d66,_0x26d202){const _0x43066a=_0x214c48;var _0x539e14=arguments[_0x43066a(0x268)],_0x22fd73=_0x539e14<0x3?_0x5525ca:_0x26d202===null?_0x26d202=Object['getOwnPropertyDescriptor'](_0x5525ca,_0x121d66):_0x26d202,_0x43650d;if(typeof Reflect==='object'&&typeof Reflect[_0x43066a(0x1f8)]===_0x43066a(0x1f7))_0x22fd73=Reflect[_0x43066a(0x1f8)](_0x436085,_0x5525ca,_0x121d66,_0x26d202);else{for(var _0x578cf6=_0x436085[_0x43066a(0x268)]-0x1;_0x578cf6>=0x0;_0x578cf6--)if(_0x43650d=_0x436085[_0x578cf6])_0x22fd73=(_0x539e14<0x3?_0x43650d(_0x22fd73):_0x539e14>0x3?_0x43650d(_0x5525ca,_0x121d66,_0x22fd73):_0x43650d(_0x5525ca,_0x121d66))||_0x22fd73;}return _0x539e14>0x3&&_0x22fd73&&Object[_0x43066a(0x26f)](_0x5525ca,_0x121d66,_0x22fd73),_0x22fd73;},__metadata=this&&this[_0x214c48(0x1e7)]||function(_0xa387cd,_0x40a6bf){const _0x2c7e9c=_0x214c48;if(typeof Reflect===_0x2c7e9c(0x23f)&&typeof Reflect['metadata']===_0x2c7e9c(0x1f7))return Reflect[_0x2c7e9c(0x1f9)](_0xa387cd,_0x40a6bf);},__param=this&&this['__param']||function(_0x89647e,_0x4eb71d){return function(_0x4615b9,_0x213001){_0x4eb71d(_0x4615b9,_0x213001,_0x89647e);};};Object[_0x214c48(0x26f)](exports,_0x214c48(0x247),{'value':!![]}),exports[_0x214c48(0x26e)]=void 0x0;const globalConfig_service_1=require(_0x214c48(0x291)),verification_constant_1=require(_0x214c48(0x2af)),verification_service_1=require(_0x214c48(0x25c)),user_entity_1=require(_0x214c48(0x2b5)),common_1=require(_0x214c48(0x1db)),jwt_1=require('@nestjs/jwt'),user_service_1=require(_0x214c48(0x1dc)),mailer_service_1=require(_0x214c48(0x1ec)),user_constant_1=require(_0x214c48(0x2ac)),utils_1=require(_0x214c48(0x1cc)),redisCache_service_1=require('../redisCache/redisCache.service'),svgCaptcha=require(_0x214c48(0x27d)),bcrypt=require(_0x214c48(0x234)),store_1=require(_0x214c48(0x263)),axios_1=require(_0x214c48(0x2a6)),redisKey_constant_1=require(_0x214c48(0x28d)),Login_vo_1=require(_0x214c48(0x1ed)),WeAppLogin_vo_1=require('./vo/WeAppLogin.vo'),typeorm_1=require(_0x214c48(0x2b0)),typeorm_2=require(_0x214c48(0x213)),nestjs_cls_1=require(_0x214c48(0x285)),role_entity_1=require(_0x214c48(0x240)),Role_constant_1=require(_0x214c48(0x252)),signIn_entity_1=require(_0x214c48(0x200)),date_1=require('../../common/utils/date');let AuthService=class AuthService{constructor(_0x2a8411,_0x3f755c,_0x30e284,_0x139b70,_0x323228,_0x371049,_0x56d6c6,_0x13cf8b,_0xe94e6,_0x4dac42){const _0x56db24=_0x214c48;this['userEntity']=_0x2a8411,this[_0x56db24(0x295)]=_0x3f755c,this['signinEntity']=_0x30e284,this[_0x56db24(0x1f0)]=_0x139b70,this['jwtService']=_0x323228,this[_0x56db24(0x207)]=_0x371049,this[_0x56db24(0x1f3)]=_0x56d6c6,this[_0x56db24(0x2b4)]=_0x13cf8b,this['verificationService']=_0xe94e6,this[_0x56db24(0x220)]=_0x4dac42;}[_0x214c48(0x2b1)](_0x152dc4){const _0x5781b7=_0x214c48,{id:_0x148edf,username:_0x58f78c,role:_0x465653,openId:_0x181884,email:_0xeffa0b,client:_0x1d560a,saasId:_0x40c76d}=_0x152dc4;return this[_0x5781b7(0x264)][_0x5781b7(0x289)]({'id':_0x148edf,'username':_0x58f78c,'role':_0x465653,'openId':_0x181884,'email':_0xeffa0b,'client':_0x1d560a,'saasId':_0x40c76d});}async[_0x214c48(0x286)](_0x9f783d){const _0x189c77=_0x214c48,{username:_0x1bbb5c,password:_0x237a58}=_0x9f783d;if(!_0x1bbb5c||!_0x237a58)throw new common_1['HttpException']('账号密码或密码错误',common_1[_0x189c77(0x2bd)][_0x189c77(0x1e9)]);const _0x3a12b1=await this['userService']['getOne'](_0x1bbb5c);if(!_0x3a12b1)throw new common_1[(_0x189c77(0x2a1))](_0x189c77(0x1fd),common_1['HttpStatus'][_0x189c77(0x1e9)]);if((0x0,utils_1[_0x189c77(0x1cf)])(_0x237a58,_0x3a12b1[_0x189c77(0x233)]))throw new common_1['HttpException'](_0x189c77(0x24d),common_1[_0x189c77(0x2bd)][_0x189c77(0x1e9)]);return this[_0x189c77(0x2b1)](_0x3a12b1);}async[_0x214c48(0x232)](_0x27c4d5,_0x1c6e45){const _0x2dac8b=_0x214c48,_0x55e67c=await this[_0x2dac8b(0x220)]['getConfigByKeys']([_0x2dac8b(0x249),_0x2dac8b(0x251),_0x2dac8b(0x2bb),_0x2dac8b(0x266),_0x2dac8b(0x24c)]);try{const _0x451e21=await this[_0x2dac8b(0x27b)][_0x2dac8b(0x208)](_0x27c4d5,verification_constant_1[_0x2dac8b(0x265)][_0x2dac8b(0x29e)]),{type:_0x306716,userId:_0x4353ce}=_0x451e21;if(_0x306716!==verification_constant_1['VerificationEnum'][_0x2dac8b(0x29e)])throw new common_1[(_0x2dac8b(0x2a1))](_0x2dac8b(0x1e1),common_1[_0x2dac8b(0x2bd)][_0x2dac8b(0x1e9)]);let _0x443dee=await this[_0x2dac8b(0x25d)][_0x2dac8b(0x1e4)]({'where':{'id':_0x4353ce}});_0x443dee[_0x2dac8b(0x1de)]=_0x27c4d5['email'],_0x443dee=await this[_0x2dac8b(0x25d)][_0x2dac8b(0x21f)](_0x443dee);const {id:_0x108a34,username:_0x5b7b18,email:_0x13ed46}=_0x443dee;_0x1c6e45[_0x2dac8b(0x254)](_0x2dac8b(0x210)+_0x108a34['toString']()[_0x2dac8b(0x23d)](0x4,'0')+'&username='+_0x5b7b18+_0x2dac8b(0x2b8)+_0x13ed46+_0x2dac8b(0x1e8)+_0x55e67c[_0x2dac8b(0x249)]+'&registerSuccessEmailTeamName='+_0x55e67c[_0x2dac8b(0x251)]+_0x2dac8b(0x227)+_0x55e67c[_0x2dac8b(0x2bb)]);}catch(_0x53e612){const _0xe13c23=_0x53e612['response'];_0x1c6e45[_0x2dac8b(0x254)]('/api/auth/registerError?message='+_0xe13c23+'&registerFailEmailTitle='+_0x55e67c[_0x2dac8b(0x266)]+_0x2dac8b(0x235)+_0x55e67c[_0x2dac8b(0x24c)]);}}async[_0x214c48(0x297)](_0xf346d2){const _0x31d3aa=_0x214c48,_0x20dce6=await this[_0x31d3aa(0x220)][_0x31d3aa(0x212)](),{color:color=_0x31d3aa(0x1d4)}=_0xf346d2,_0xbb9982=svgCaptcha[_0x31d3aa(0x259)]({'background':color,'height':0x22,'width':0x78,'noise':0x3}),_0x46efae=_0xbb9982[_0x31d3aa(0x250)],_0x4b9419=(0x0,utils_1[_0x31d3aa(0x2a3)])(),_0x5ecdf0=_0x20dce6+_0x31d3aa(0x222)+_0x4b9419;return await this[_0x31d3aa(0x2b4)][_0x31d3aa(0x23e)]({'key':_0x5ecdf0,'val':_0xbb9982[_0x31d3aa(0x250)]},0x5*0x3c),{'svgCode':_0xbb9982['data'],'code':_0x4b9419};}async[_0x214c48(0x288)](_0x5469a8){const _0x21bffb=_0x214c48;_0x5469a8[_0x21bffb(0x29b)]&&await this[_0x21bffb(0x27b)][_0x21bffb(0x20f)](_0x5469a8);const {phone:_0x5a2bf3}=_0x5469a8,_0x3e1c57=await this[_0x21bffb(0x220)][_0x21bffb(0x212)](),_0x2fb46c=_0x3e1c57+_0x21bffb(0x2aa)+_0x5a2bf3,_0x5b9ea0=await this[_0x21bffb(0x2b4)][_0x21bffb(0x25f)](_0x2fb46c);if(_0x5b9ea0&&_0x5b9ea0>0x0)throw new common_1[(_0x21bffb(0x2a1))](_0x5b9ea0+_0x21bffb(0x230),common_1[_0x21bffb(0x2bd)][_0x21bffb(0x1e9)]);const _0x44af4e=(0x0,utils_1[_0x21bffb(0x1eb)])(),_0x32e2fc={'phone':_0x5a2bf3,'code':_0x44af4e};return await this[_0x21bffb(0x27b)][_0x21bffb(0x288)](_0x32e2fc),await this[_0x21bffb(0x2b4)][_0x21bffb(0x23e)]({'key':_0x2fb46c,'val':_0x44af4e},0x1*0x3c),_0x21bffb(0x1f1);}async['sendEmailCode'](_0x3d945a){const _0xcf4f0c=_0x214c48;try{var _0x138585=/^[a-zA-Z0-9]+([_.w-]+[a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-.w-]+[a-zA-Z0-9]+)*.[a-zA-Z0-9]+$/;if(!_0x138585[_0xcf4f0c(0x1ef)](_0x3d945a))throw new Error(_0xcf4f0c(0x2a0));const _0x5b6bbf=await this[_0xcf4f0c(0x25d)]['findOne']({'where':{'email':_0x3d945a}});if(_0x5b6bbf)throw new Error(_0xcf4f0c(0x1ea));const _0x3e8d1f=await this[_0xcf4f0c(0x220)][_0xcf4f0c(0x258)](['registerBaseUrl','registerVerifyEmailTitle',_0xcf4f0c(0x22d),_0xcf4f0c(0x20c),'registerVerifyExpir']),_0xa1ab61=(0x0,utils_1[_0xcf4f0c(0x1eb)])(),_0x1a5048=_0x3e8d1f[_0xcf4f0c(0x223)]?Number(_0x3e8d1f[_0xcf4f0c(0x223)]):0x1e*0x3c;await this[_0xcf4f0c(0x2b4)][_0xcf4f0c(0x23e)]({'key':redisKey_constant_1[_0xcf4f0c(0x239)]+_0x3d945a,'val':_0xa1ab61},_0x1a5048*0x3c),await this[_0xcf4f0c(0x1f3)][_0xcf4f0c(0x2b6)]({'to':_0x3d945a,'template':_0xcf4f0c(0x261),'subject':'来自'+_0x3e8d1f['registerVerifyEmailFrom']+_0xcf4f0c(0x1f5),'context':{'baseUrl':_0x3e8d1f[_0xcf4f0c(0x2a2)],'code':_0xa1ab61,..._0x3e8d1f}});}catch(_0x48f1cc){throw new common_1[(_0xcf4f0c(0x2a1))](_0x48f1cc['message'],common_1[_0xcf4f0c(0x2bd)][_0xcf4f0c(0x1e9)]);}}async[_0x214c48(0x226)](_0x498744){const _0x22c920=_0x214c48;try{const _0x59bb22=await this['redisCacheService'][_0x22c920(0x2b3)]({'key':redisKey_constant_1[_0x22c920(0x1cd)]}),_0x154e81=await axios_1[_0x22c920(0x1ce)][_0x22c920(0x257)](_0x22c920(0x292)+_0x59bb22,{'code':_0x498744});if(_0x154e81[_0x22c920(0x1ff)][_0x22c920(0x1d2)])throw new Error(_0x154e81[_0x22c920(0x1ff)][_0x22c920(0x28e)]);return _0x154e81['data'][_0x22c920(0x201)][_0x22c920(0x1df)];}catch(_0x5cf9de){common_1[_0x22c920(0x209)][_0x22c920(0x280)]('getPhoneInMini:\x20',_0x5cf9de);throw new common_1[(_0x22c920(0x2a1))](_0x5cf9de['message'],common_1[_0x22c920(0x2bd)][_0x22c920(0x1e9)]);}}async[_0x214c48(0x273)](_0x741d62,_0x29694b){const _0x1b4aa8=_0x214c48,_0x3647ca=await this[_0x1b4aa8(0x226)](_0x741d62),_0xc2372a=await this['userEntity'][_0x1b4aa8(0x1e4)]({'where':{'phone':_0x3647ca}}),_0x244c2f=await this['userEntity']['findOne']({'where':{'id':_0x29694b[_0x1b4aa8(0x24e)]['id']}});if(_0xc2372a&&_0x244c2f&&_0x244c2f['id']!=_0xc2372a['id'])throw new common_1[(_0x1b4aa8(0x2a1))](_0x1b4aa8(0x24f),common_1[_0x1b4aa8(0x2bd)][_0x1b4aa8(0x1e9)]);if(!_0x244c2f)throw new common_1['HttpException']('Error',common_1[_0x1b4aa8(0x2bd)][_0x1b4aa8(0x1e9)]);return _0x244c2f[_0x1b4aa8(0x279)]=_0x3647ca,await this[_0x1b4aa8(0x25d)]['save'](_0x244c2f),_0x3647ca;}async['phoneWithOpenId4regist'](_0x41b05d){const _0x56c190=_0x214c48;try{if(!_0x41b05d[_0x56c190(0x281)]&&!_0x41b05d[_0x56c190(0x269)]&&!_0x41b05d[_0x56c190(0x236)])throw new Error(_0x56c190(0x23a));let _0xe49a09=_0x56c190(0x281),_0x1bf46e={};if(_0x41b05d[_0x56c190(0x281)])_0xe49a09='openId';else _0x41b05d[_0x56c190(0x269)]?_0xe49a09=_0x56c190(0x269):_0xe49a09='weAppOpenId';_0x1bf46e[_0xe49a09]=_0x41b05d[_0xe49a09];const _0x4a62b8=await this['userEntity'][_0x56c190(0x1e4)]({'where':_0x1bf46e});if(_0x4a62b8&&_0x4a62b8['phone'])return![];const _0x2343e8=await this[_0x56c190(0x25d)][_0x56c190(0x1e4)]({'where':{'phone':_0x41b05d[_0x56c190(0x279)]}});if(_0x2343e8)return!_0x2343e8[_0xe49a09];return!![];}catch(_0x5d75d9){throw new common_1['HttpException'](_0x5d75d9[_0x56c190(0x1e6)],common_1[_0x56c190(0x2bd)][_0x56c190(0x1e9)]);}}async[_0x214c48(0x27a)](_0x6a4ae4,_0xf5fb36){const _0x5f5c37=_0x214c48,_0x397a82=(0x0,utils_1[_0x5f5c37(0x260)])(this[_0x5f5c37(0x1f0)]);try{if(!_0x6a4ae4['phone'])throw new Error(_0x5f5c37(0x1d9));if(!_0x6a4ae4[_0x5f5c37(0x231)])throw new Error(_0x5f5c37(0x1e0));let _0x5e9c08=null;await this[_0x5f5c37(0x216)](_0x6a4ae4[_0x5f5c37(0x279)],_0x6a4ae4[_0x5f5c37(0x231)]),_0x5e9c08=await this[_0x5f5c37(0x25d)][_0x5f5c37(0x1e4)]({'where':{'phone':_0x6a4ae4[_0x5f5c37(0x279)],'saasId':_0x397a82}});if(_0x5e9c08)throw new Error('当前用户已注册，请勿重复注册！');const _0xb393b4=new user_entity_1[(_0x5f5c37(0x21b))]();for(let _0x367181 in _0x6a4ae4){_0x6a4ae4[_0x367181]&&(_0xb393b4[_0x367181]=_0x6a4ae4[_0x367181]);}_0xb393b4[_0x5f5c37(0x233)]&&(_0xb393b4[_0x5f5c37(0x233)]=bcrypt[_0x5f5c37(0x294)](_0x6a4ae4[_0x5f5c37(0x233)],0xa));_0xb393b4[_0x5f5c37(0x26b)]=user_constant_1['UserStatusEnum'][_0x5f5c37(0x27e)];!_0xb393b4[_0x5f5c37(0x271)]&&(_0xb393b4[_0x5f5c37(0x271)]=_0xb393b4[_0x5f5c37(0x271)]||'小智');!_0xb393b4['avatar']&&(_0xb393b4[_0x5f5c37(0x244)]=await this['globalConfigService'][_0x5f5c37(0x258)]([_0x5f5c37(0x276)]));_0xb393b4[_0x5f5c37(0x282)]=_0x397a82;const _0x56a171=await this['userService'][_0x5f5c37(0x202)](_0xb393b4);this[_0x5f5c37(0x2be)](_0x56a171,_0x6a4ae4[_0x5f5c37(0x219)]);const _0x6dd2de=(0x0,utils_1[_0x5f5c37(0x25b)])(_0xf5fb36),_0x1a4adf=this[_0x5f5c37(0x2b1)](_0x56a171);return await this[_0x5f5c37(0x207)][_0x5f5c37(0x23b)](_0x56a171['id'],_0x6dd2de),await this[_0x5f5c37(0x2b4)][_0x5f5c37(0x29f)](_0x56a171['id'],_0x1a4adf),_0x1a4adf;}catch(_0x50baf9){if(_0x50baf9 instanceof common_1['HttpException'])throw _0x50baf9;else throw new common_1[(_0x5f5c37(0x2a1))](_0x50baf9['message'],common_1[_0x5f5c37(0x2bd)][_0x5f5c37(0x1e9)]);}}async['registeV3'](_0x33352e,_0x36309b){const _0x51ff32=_0x214c48,_0x21237f=(0x0,utils_1[_0x51ff32(0x260)])(this[_0x51ff32(0x1f0)]);try{if(_0x33352e[_0x51ff32(0x1fa)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x51ff32(0x1ef)](_0x33352e['username']))throw new Error(_0x51ff32(0x255));if(!_0x33352e['password'])throw new Error('账号注册时密码不能为空！');}else{if(!_0x33352e['openId']&&!_0x33352e[_0x51ff32(0x269)]&&!_0x33352e[_0x51ff32(0x236)]&&!_0x33352e[_0x51ff32(0x29a)])throw new Error(_0x51ff32(0x20b));}if(_0x33352e[_0x51ff32(0x279)]&&!_0x33352e[_0x51ff32(0x231)])throw new Error(_0x51ff32(0x1e0));let _0x2b2857=null;if(_0x33352e[_0x51ff32(0x279)])await this[_0x51ff32(0x216)](_0x33352e[_0x51ff32(0x279)],_0x33352e['phoneCode']),_0x2b2857=await this[_0x51ff32(0x25d)][_0x51ff32(0x1e4)]({'where':{'phone':_0x33352e[_0x51ff32(0x279)],'saasId':_0x21237f}});else{if(_0x33352e[_0x51ff32(0x281)]||_0x33352e[_0x51ff32(0x269)]||_0x33352e['weAppOpenId']||_0x33352e[_0x51ff32(0x29a)]){let _0x442709=_0x51ff32(0x281),_0x30a213={'saasId':_0x21237f};if(_0x33352e[_0x51ff32(0x29a)])_0x442709=_0x51ff32(0x29a);else{if(_0x33352e['openId'])_0x442709='openId';else _0x33352e[_0x51ff32(0x269)]?_0x442709=_0x51ff32(0x269):_0x442709=_0x51ff32(0x236);}_0x30a213[_0x442709]=_0x33352e[_0x442709],_0x2b2857=await this['userEntity']['findOne']({'where':_0x30a213});if(_0x2b2857)throw new Error('当前用户已注册，请勿重复注册！');}else{_0x2b2857=await this[_0x51ff32(0x25d)][_0x51ff32(0x1e4)]({'where':{'username':_0x33352e['username'],'saasId':_0x21237f}});if(_0x2b2857)throw new Error(_0x51ff32(0x293));}}const _0x577661=new user_entity_1[(_0x51ff32(0x21b))]();for(let _0x191b75 in _0x33352e){_0x33352e[_0x191b75]&&(_0x577661[_0x191b75]=_0x33352e[_0x191b75]);}_0x2b2857?_0x577661['id']=_0x2b2857['id']:(_0x577661[_0x51ff32(0x233)]&&(_0x577661['password']=bcrypt[_0x51ff32(0x294)](_0x33352e[_0x51ff32(0x233)],0xa)),_0x577661[_0x51ff32(0x26b)]=user_constant_1[_0x51ff32(0x246)][_0x51ff32(0x27e)],!_0x577661['nickname']&&(_0x577661[_0x51ff32(0x271)]=_0x577661[_0x51ff32(0x271)]||'小智'),!_0x577661[_0x51ff32(0x244)]&&(_0x577661[_0x51ff32(0x244)]=await this['globalConfigService'][_0x51ff32(0x258)]([_0x51ff32(0x276)])));_0x577661['saasId']=_0x21237f;const _0x19cc91=await this[_0x51ff32(0x207)][_0x51ff32(0x202)](_0x577661);!_0x2b2857&&this['invitationRewards'](_0x19cc91,_0x33352e[_0x51ff32(0x219)]);const _0x555574=(0x0,utils_1[_0x51ff32(0x25b)])(_0x36309b),_0x10c062=this[_0x51ff32(0x2b1)](_0x19cc91);return await this[_0x51ff32(0x207)]['savaLoginIp'](_0x19cc91['id'],_0x555574),await this[_0x51ff32(0x2b4)]['saveToken'](_0x19cc91['id'],_0x10c062),_0x10c062;}catch(_0x4039ce){if(_0x4039ce instanceof common_1[_0x51ff32(0x2a1)])throw _0x4039ce;else throw new common_1[(_0x51ff32(0x2a1))](_0x4039ce[_0x51ff32(0x1e6)],common_1[_0x51ff32(0x2bd)][_0x51ff32(0x1e9)]);}}async[_0x214c48(0x256)](_0x522ad3,_0x1651fa){const _0x285c04=_0x214c48,_0x247154=(0x0,utils_1[_0x285c04(0x260)])(this['clsService']);await this[_0x285c04(0x216)](_0x522ad3['phone'],_0x522ad3['phoneCode']);let _0x5c0d7f=await this[_0x285c04(0x25d)][_0x285c04(0x1e4)]({'where':{'phone':_0x522ad3[_0x285c04(0x279)],'saasId':_0x247154}});if(!_0x5c0d7f){const _0x5e7939=new user_entity_1[(_0x285c04(0x21b))]();_0x5e7939['phone']=_0x522ad3[_0x285c04(0x279)],_0x5e7939[_0x285c04(0x271)]=_0x522ad3[_0x285c04(0x279)],_0x5e7939[_0x285c04(0x26b)]=user_constant_1[_0x285c04(0x246)][_0x285c04(0x27e)],_0x5e7939[_0x285c04(0x244)]=await this[_0x285c04(0x220)][_0x285c04(0x258)]([_0x285c04(0x276)]),_0x5c0d7f=await this[_0x285c04(0x207)][_0x285c04(0x202)](_0x5e7939),this[_0x285c04(0x2be)](_0x5c0d7f,_0x522ad3[_0x285c04(0x219)]);}const _0x29122d=(0x0,utils_1[_0x285c04(0x25b)])(_0x1651fa),_0x88dbe5=this['signToken'](_0x5c0d7f);return await this[_0x285c04(0x207)]['savaLoginIp'](_0x5c0d7f['id'],_0x29122d),await this['redisCacheService'][_0x285c04(0x29f)](_0x5c0d7f['id'],_0x88dbe5),_0x88dbe5;}async['loginV4'](_0x15ce7b,_0x71bbb1){const _0x2db3e6=_0x214c48;try{const _0x5c99e5=(0x0,utils_1['getReqSaasId'])(this[_0x2db3e6(0x1f0)]),_0x158410=await this['userEntity']['findOne']({'where':[{'username':_0x15ce7b[_0x2db3e6(0x1fa)],'saasId':_0x5c99e5},{'email':_0x15ce7b['username'],'saasId':_0x5c99e5},{'phone':_0x15ce7b[_0x2db3e6(0x1fa)],'saasId':_0x5c99e5}]});if(!_0x158410)throw new Error('用户名或密码错误！');if(!_0x158410['password'])throw new Error(_0x2db3e6(0x21c));if(!bcrypt[_0x2db3e6(0x211)](_0x15ce7b['password'],_0x158410[_0x2db3e6(0x233)]))throw new Error('用户名或密码错误！');_0x158410[_0x2db3e6(0x1fa)]&&!_0x158410[_0x2db3e6(0x2a8)]&&await this[_0x2db3e6(0x207)][_0x2db3e6(0x21e)](_0x158410);const _0x1d8380=(0x0,utils_1[_0x2db3e6(0x25b)])(_0x71bbb1),_0x1a8958=this[_0x2db3e6(0x2b1)](_0x158410);await this[_0x2db3e6(0x207)]['savaLoginIp'](_0x158410['id'],_0x1d8380),await this[_0x2db3e6(0x2b4)][_0x2db3e6(0x29f)](_0x158410['id'],_0x1a8958);if((0x0,utils_1['shouldAccess'])(_0x158410[_0x2db3e6(0x224)])){let _0x4b5213;_0x158410[_0x2db3e6(0x224)]===Role_constant_1[_0x2db3e6(0x296)][_0x2db3e6(0x1d6)]?_0x4b5213=await this[_0x2db3e6(0x295)]['findOne']({'where':{'code':_0x158410['role']}}):_0x4b5213=await this[_0x2db3e6(0x295)][_0x2db3e6(0x1e4)]({'where':{'code':_0x158410[_0x2db3e6(0x224)],'saasId':_0x5c99e5}});if(!_0x4b5213)throw new Error('角色信息异常！');await this[_0x2db3e6(0x2b4)]['set']({'key':_0x2db3e6(0x253)+_0x158410['id'],'val':_0x4b5213[_0x2db3e6(0x28f)]});}return _0x1a8958;}catch(_0xa5f74f){throw new common_1[(_0x2db3e6(0x2a1))](_0xa5f74f[_0x2db3e6(0x1e6)],common_1[_0x2db3e6(0x2bd)]['BAD_REQUEST']);}}async[_0x214c48(0x1ee)](_0xceac63){const _0x14ff2b=_0x214c48;try{const _0x58a827=new Login_vo_1[(_0x14ff2b(0x1ce))](),_0x59abb8=(0x0,utils_1[_0x14ff2b(0x260)])(this['clsService']),_0x5d9e8b=await axios_1['default'][_0x14ff2b(0x2b3)]('https://api.weixin.qq.com/sns/jscode2session',{'params':{'appid':store_1[_0x14ff2b(0x1d0)][_0x14ff2b(0x205)],'secret':store_1[_0x14ff2b(0x1d0)][_0x14ff2b(0x2b2)],'js_code':_0xceac63,'grant_type':_0x14ff2b(0x2b7)}}),_0xb2f116=_0x5d9e8b[_0x14ff2b(0x1ff)];if(_0xb2f116[_0x14ff2b(0x1d2)])throw new Error(_0xb2f116[_0x14ff2b(0x28e)]);let _0x303a6d;return _0xb2f116[_0x14ff2b(0x29a)]&&(_0x303a6d=await this[_0x14ff2b(0x25d)][_0x14ff2b(0x1e4)]({'where':{'unionid':_0xb2f116['unionid'],'saasId':_0x59abb8}})),!_0x303a6d&&(_0x303a6d=await this['userEntity'][_0x14ff2b(0x1e4)]({'where':{'miniOpenId':_0xb2f116[_0x14ff2b(0x1e5)],'saasId':_0x59abb8}})),!_0x303a6d?this[_0x14ff2b(0x2b4)][_0x14ff2b(0x23e)]({'key':redisKey_constant_1[_0x14ff2b(0x2b9)]+_0xb2f116['openid'],'val':_0xb2f116[_0x14ff2b(0x29a)]||null}):(_0x303a6d[_0x14ff2b(0x29a)]=_0xb2f116[_0x14ff2b(0x29a)],_0x303a6d['miniOpenId']=_0xb2f116[_0x14ff2b(0x1e5)],await this[_0x14ff2b(0x207)][_0x14ff2b(0x27c)](_0x303a6d['id'],_0xb2f116['openid'],_0xb2f116['unionid']),_0x58a827[_0x14ff2b(0x2a5)]=this[_0x14ff2b(0x2b1)](_0x303a6d),await this[_0x14ff2b(0x2b4)][_0x14ff2b(0x29f)](_0x303a6d['id'],_0x58a827[_0x14ff2b(0x2a5)])),_0x58a827[_0x14ff2b(0x29a)]=_0xb2f116['unionid'],_0x58a827['openid']=_0xb2f116[_0x14ff2b(0x1e5)],_0x58a827;}catch(_0x2adc75){common_1[_0x14ff2b(0x209)][_0x14ff2b(0x280)](_0x14ff2b(0x2ae),_0x2adc75);throw new common_1[(_0x14ff2b(0x2a1))](_0x2adc75['message'],common_1[_0x14ff2b(0x2bd)][_0x14ff2b(0x1e9)]);}}async['loginWithWechatApp'](_0x2cd5ba){const _0x3e6626=_0x214c48,_0x368a57=new WeAppLogin_vo_1[(_0x3e6626(0x24b))](),_0xaf497c=(0x0,utils_1['getReqSaasId'])(this[_0x3e6626(0x1f0)]);try{const _0x288b8c=await axios_1[_0x3e6626(0x1ce)][_0x3e6626(0x2b3)](_0x3e6626(0x2a7)+store_1[_0x3e6626(0x1d0)][_0x3e6626(0x1d7)]+_0x3e6626(0x22e)+store_1[_0x3e6626(0x1d0)]['WE_APP_APPSECRET']+_0x3e6626(0x217)+_0x2cd5ba+_0x3e6626(0x22a));if(_0x288b8c['data']['errcode'])throw new Error(_0x288b8c[_0x3e6626(0x1ff)]['errmsg']);const _0x55ad77=_0x288b8c[_0x3e6626(0x1ff)];let _0x31b313;return _0x55ad77[_0x3e6626(0x29a)]&&(_0x31b313=await this[_0x3e6626(0x25d)][_0x3e6626(0x1e4)]({'where':{'unionid':_0x55ad77[_0x3e6626(0x29a)],'saasId':_0xaf497c}})),!_0x31b313&&(_0x31b313=await this[_0x3e6626(0x25d)]['findOne']({'where':{'weAppOpenId':_0x55ad77[_0x3e6626(0x1e5)],'saasId':_0xaf497c}})),!_0x31b313?this[_0x3e6626(0x2b4)]['set']({'key':redisKey_constant_1['WE_APP_TEMP_USER']+_0x55ad77['openid'],'val':_0x55ad77['unionid']||null}):(_0x31b313[_0x3e6626(0x29a)]=_0x55ad77[_0x3e6626(0x29a)],_0x31b313[_0x3e6626(0x236)]=_0x55ad77[_0x3e6626(0x1e5)],_0x368a57[_0x3e6626(0x2a5)]=this[_0x3e6626(0x2b1)](_0x31b313),await this[_0x3e6626(0x2b4)][_0x3e6626(0x29f)](_0x31b313['id'],_0x368a57['authToken']),await this[_0x3e6626(0x207)][_0x3e6626(0x1fc)](_0x31b313['id'],_0x55ad77['openid'],_0x55ad77[_0x3e6626(0x29a)])),_0x368a57[_0x3e6626(0x1e5)]=_0x55ad77[_0x3e6626(0x1e5)],_0x368a57[_0x3e6626(0x29a)]=_0x55ad77[_0x3e6626(0x29a)],_0x368a57['accessToken']=_0x55ad77[_0x3e6626(0x1dd)],_0x368a57;}catch(_0x4fc8b7){common_1[_0x3e6626(0x209)][_0x3e6626(0x280)](_0x3e6626(0x237),_0x4fc8b7);throw new common_1[(_0x3e6626(0x2a1))](_0x4fc8b7[_0x3e6626(0x1e6)],common_1[_0x3e6626(0x2bd)][_0x3e6626(0x1e9)]);}}async['activateAccount'](_0x507271,_0x4571e9){const _0x32a8b8=_0x214c48,_0x30aecb=await this['globalConfigService'][_0x32a8b8(0x258)]([_0x32a8b8(0x249),'registerSuccessEmailTeamName',_0x32a8b8(0x2bb),_0x32a8b8(0x266),_0x32a8b8(0x24c)]);try{const _0x2a5335=await this[_0x32a8b8(0x27b)]['verifyCode'](_0x507271,verification_constant_1[_0x32a8b8(0x265)]['Registration']),{type:_0x567b47,userId:_0x1a5909}=_0x2a5335;if(_0x567b47!==verification_constant_1[_0x32a8b8(0x265)][_0x32a8b8(0x284)])throw new common_1[(_0x32a8b8(0x2a1))](_0x32a8b8(0x1e1),common_1[_0x32a8b8(0x2bd)][_0x32a8b8(0x1e9)]);const _0x1f5b22=await this['userService'][_0x32a8b8(0x1fb)](_0x1a5909);if(_0x1f5b22===user_constant_1['UserStatusEnum']['ACTIVE'])throw new common_1[(_0x32a8b8(0x2a1))](_0x32a8b8(0x2bc),common_1[_0x32a8b8(0x2bd)][_0x32a8b8(0x1e9)]);await this[_0x32a8b8(0x207)][_0x32a8b8(0x248)](_0x2a5335[_0x32a8b8(0x22f)],user_constant_1[_0x32a8b8(0x246)][_0x32a8b8(0x27e)]);const _0x336f99=await this[_0x32a8b8(0x207)][_0x32a8b8(0x262)](_0x2a5335[_0x32a8b8(0x22f)]),{username:_0x3ecb2a,email:_0x122ce0,id:_0x4ba152,invitedBy:_0x1ec861}=_0x336f99;let _0x55b3c4;_0x1ec861&&(_0x55b3c4=await this['userService'][_0x32a8b8(0x1f6)](_0x1ec861)),await this['userService']['changeScore4registe'](_0x336f99,_0x55b3c4),_0x4571e9[_0x32a8b8(0x254)](_0x32a8b8(0x2a9)+_0x4ba152['toString']()[_0x32a8b8(0x23d)](0x4,'0')+_0x32a8b8(0x29c)+_0x3ecb2a+_0x32a8b8(0x2b8)+_0x122ce0+_0x32a8b8(0x1e8)+_0x30aecb[_0x32a8b8(0x249)]+_0x32a8b8(0x26c)+_0x30aecb[_0x32a8b8(0x251)]+_0x32a8b8(0x227)+_0x30aecb[_0x32a8b8(0x2bb)]);}catch(_0x5176c4){console[_0x32a8b8(0x2ad)](_0x32a8b8(0x1da),_0x5176c4);const _0x568a63=_0x5176c4[_0x32a8b8(0x278)];_0x4571e9[_0x32a8b8(0x254)](_0x32a8b8(0x20e)+_0x568a63+_0x32a8b8(0x242)+_0x30aecb[_0x32a8b8(0x266)]+_0x32a8b8(0x235)+_0x30aecb[_0x32a8b8(0x24c)]);}}async[_0x214c48(0x26d)](_0x19809b){const _0x4f130e=_0x214c48,_0x505839=await this[_0x4f130e(0x207)]['queryOne']({'id':_0x19809b[_0x4f130e(0x24e)]['id']});let _0x5176ca=![];const _0x2946b0=(0x0,date_1['default'])()['format'](_0x4f130e(0x2ab)),_0xd096f9=await this[_0x4f130e(0x283)][_0x4f130e(0x1e4)]({'where':{'userId':_0x505839['id'],'signInDate':_0x2946b0}});return _0xd096f9&&(_0x5176ca=!![]),{'userInfo':_0x505839,'isSignIn':_0x5176ca};}async[_0x214c48(0x287)](_0x5e0ba7,_0x495c4c){const _0x39c22b=_0x214c48,{id:_0x51c7f6,client:_0x167a90}=_0x5e0ba7[_0x39c22b(0x24e)];if(_0x167a90&&Number(_0x167a90)>0x0)throw new common_1[(_0x39c22b(0x2a1))](_0x39c22b(0x290),common_1['HttpStatus'][_0x39c22b(0x1e9)]);const {oldPassword:_0x417bc9,password:_0x599988}=_0x495c4c,_0x4bb9cb=await this[_0x39c22b(0x25d)][_0x39c22b(0x1e4)]({'where':{'id':_0x51c7f6}});if(_0x4bb9cb[_0x39c22b(0x233)]){if(!_0x417bc9)throw new common_1[(_0x39c22b(0x2a1))](_0x39c22b(0x2a4),common_1['HttpStatus'][_0x39c22b(0x1e9)]);const _0x2db6ad=bcrypt['compareSync'](_0x417bc9,_0x4bb9cb[_0x39c22b(0x233)]);if(!_0x2db6ad)throw new common_1[(_0x39c22b(0x2a1))](_0x39c22b(0x1f4),common_1[_0x39c22b(0x2bd)][_0x39c22b(0x1e9)]);}return _0x4bb9cb['password']=bcrypt['hashSync'](_0x599988,0xa),await this[_0x39c22b(0x25d)]['save'](_0x4bb9cb),'密码修改成功';}async[_0x214c48(0x25e)](_0x4dd4c7,_0x45e10b){const _0x227e87=_0x214c48,_0x27b742=_0x4dd4c7['user']['id'],_0xe74524=await this[_0x227e87(0x25d)][_0x227e87(0x1e4)]({'where':{'email':_0x45e10b[_0x227e87(0x1de)]}});if(_0xe74524)throw new common_1[(_0x227e87(0x2a1))](_0x227e87(0x1fe),axios_1[_0x227e87(0x214)][_0x227e87(0x275)]);const _0x5b2fa5=await this[_0x227e87(0x25d)]['findOne']({'where':{'id':_0x27b742}}),_0x3c998b=await this[_0x227e87(0x220)][_0x227e87(0x258)](['isVerifyEmail','registerBaseUrl',_0x227e87(0x218),_0x227e87(0x22d),_0x227e87(0x20c),_0x227e87(0x223)]);_0x5b2fa5[_0x227e87(0x1de)]=_0x45e10b[_0x227e87(0x1de)];const _0x5e598c=_0x3c998b[_0x227e87(0x223)]?Number(_0x3c998b[_0x227e87(0x223)]):0x1e*0x3c,_0x162287=await this[_0x227e87(0x27b)]['createVerification'](_0x5b2fa5,verification_constant_1[_0x227e87(0x265)]['ChangeEmail'],_0x5e598c),{code:_0x292470,email:_0x4c7aef,id:_0x4aa136}=_0x162287,{registerVerifyEmailFrom:_0x26e832}=_0x3c998b;await this[_0x227e87(0x1f3)][_0x227e87(0x2b6)]({'to':_0x4c7aef,'template':_0x227e87(0x232),'subject':'来自'+_0x26e832+_0x227e87(0x28a),'context':{'id':_0x4aa136,'code':_0x292470,'email':_0x4c7aef,..._0x3c998b,'baseUrl':_0x3c998b['registerBaseUrl']}});}async[_0x214c48(0x21d)](_0x2a2fd7){const _0x400445=_0x214c48,_0x5a2036=await this[_0x400445(0x25d)][_0x400445(0x1d8)]({'where':{'phone':_0x2a2fd7}});return _0x5a2036>0x0;}async[_0x214c48(0x272)](_0x5149de){const _0x57da87=_0x214c48;await this[_0x57da87(0x216)](_0x5149de[_0x57da87(0x279)],_0x5149de[_0x57da87(0x231)]);if(await this[_0x57da87(0x21d)](_0x5149de[_0x57da87(0x279)]))throw new common_1[(_0x57da87(0x2a1))](_0x57da87(0x221),common_1[_0x57da87(0x2bd)][_0x57da87(0x1e9)]);return await this[_0x57da87(0x25d)]['save']({'id':_0x5149de[_0x57da87(0x22f)],'phone':_0x5149de['phone']}),!![];}async[_0x214c48(0x21a)](){const _0x58fed=_0x214c48;try{const _0x45162d=process[_0x58fed(0x23c)]['GOMAXAI_HOST'];if(_0x45162d===_0x58fed(0x1d3)||_0x45162d==='ceshi.qumao518.vip'||_0x45162d===_0x58fed(0x26a)){const _0x41d0c3=await axios_1[_0x58fed(0x1ce)][_0x58fed(0x2b3)]('https://gomaxai.qumao518.vip/api/official/getAccessToken?type=mini');await this['redisCacheService'][_0x58fed(0x23e)]({'key':redisKey_constant_1[_0x58fed(0x1cd)],'val':_0x41d0c3[_0x58fed(0x1ff)]['data']});}else{const _0x49a4f0=await axios_1[_0x58fed(0x1ce)][_0x58fed(0x257)](_0x58fed(0x238),{'grant_type':'client_credential','appid':store_1[_0x58fed(0x1d0)][_0x58fed(0x205)],'secret':store_1['WechatConfig'][_0x58fed(0x2b2)],'force_refresh':![]});await this[_0x58fed(0x2b4)]['set']({'key':redisKey_constant_1[_0x58fed(0x1cd)],'val':_0x49a4f0[_0x58fed(0x1ff)][_0x58fed(0x1dd)]});}}catch(_0x5aeb8d){common_1[_0x58fed(0x209)]['error'](_0x58fed(0x1f2),_0x5aeb8d);}}[_0x214c48(0x274)](_0x4dd375){const _0x35c53f=_0x214c48,_0x118e56={'id':_0x4dd375,'openId':null,'client':null,'role':_0x35c53f(0x245),'username':'游客'+_0x4dd375,'email':_0x4dd375+_0x35c53f(0x24a),'saasId':(0x0,utils_1[_0x35c53f(0x260)])(this[_0x35c53f(0x1f0)])};return this[_0x35c53f(0x2b1)](_0x118e56);}async[_0x214c48(0x1d5)](_0x56fe39,_0x26512b){const _0x116308=_0x214c48,{status:_0x3daa3a}=_0x56fe39;if(_0x3daa3a!==user_constant_1[_0x116308(0x246)][_0x116308(0x27e)])throw new common_1[(_0x116308(0x2a1))](user_constant_1[_0x116308(0x298)][_0x3daa3a],common_1[_0x116308(0x2bd)][_0x116308(0x1e9)]);const _0x443667=(0x0,utils_1[_0x116308(0x25b)])(_0x26512b),_0x2c8dd3=this[_0x116308(0x2b1)](_0x56fe39);return await this['userService'][_0x116308(0x23b)](_0x56fe39['id'],_0x443667),await this[_0x116308(0x2b4)][_0x116308(0x29f)](_0x56fe39['id'],_0x2c8dd3),_0x2c8dd3;}async[_0x214c48(0x216)](_0x2bbd70,_0x4cd0d7){const _0x455072=_0x214c48,_0xae2e91=await this['globalConfigService']['getNamespace'](),_0x50bd86=_0xae2e91+_0x455072(0x2aa)+_0x2bbd70;if(_0x4cd0d7===_0x455072(0x1e2))return;const _0x322f8=await this['redisCacheService'][_0x455072(0x2b3)]({'key':_0x50bd86});if(!_0x322f8)throw new common_1[(_0x455072(0x2a1))](_0x455072(0x204),common_1[_0x455072(0x2bd)][_0x455072(0x1e9)]);if(_0x4cd0d7!==_0x322f8)throw new common_1['HttpException'](_0x455072(0x25a),common_1[_0x455072(0x2bd)][_0x455072(0x1e9)]);}async[_0x214c48(0x2be)](_0x27717c,_0x486a7a){const _0x101193=_0x214c48;let _0x300206;_0x486a7a&&(_0x300206=await this[_0x101193(0x207)]['qureyUserInfoByInviteCode'](_0x486a7a)),await this['userService'][_0x101193(0x229)](_0x27717c,_0x300206);}async[_0x214c48(0x1e3)](_0x3d0f7c,_0x70ab0c,_0x31a8ba){const _0x794473=_0x214c48;await this[_0x794473(0x216)](_0x3d0f7c,_0x70ab0c);const _0x2500f5=await this[_0x794473(0x25d)][_0x794473(0x1e4)]({'where':{'id':_0x31a8ba[_0x794473(0x24e)]['id']}});if(_0x2500f5[_0x794473(0x279)]!==_0x3d0f7c)throw new common_1[(_0x794473(0x2a1))]('手机号错误！',common_1[_0x794473(0x2bd)]['BAD_REQUEST']);return!![];}};function _0x4f46(){const _0x17bd94=['__metadata','&registerSuccessEmailTitle=','BAD_REQUEST','该邮箱已注册！','createRandomCode','../mailer/mailer.service','./vo/Login.vo','loginInMinigin','test','clsService','验证码发送成功、请填写验证码完成注册！','wechat\x20获取access_token\x20失败：','mailerService','旧密码错误、请检查提交','的注册验证','qureyUserInfoByInviteCode','function','decorate','metadata','username','getUserStatus','updateUserAppOpenId','账户不存在，请联系管理员或注册','邮箱已被其他用户使用','data','../signin/signIn.entity','phone_info','createUser','RedisCacheService','验证码已过期、请重新发送！','WE_MiNI_APPID','ClsService','userService','verifyCode','Logger','GlobalConfigService','参数错误！','registerVerifyEmailFrom','JwtService','/api/auth/registerError?message=','verifyCaptcha','/api/auth/changeEmailSuccess?id=','compareSync','getNamespace','typeorm','HttpStatusCode','SigninEntity','validatePhoneCode','&code=','registerVerifyEmailTitle','invitedBy','renewMiniAccessToken','UserEntity','用户名或密码错误！','getPhoneStatus','userInitVip','save','globalConfigService','当前手机号已绑定其他账户！',':CAPTCHA:','registerVerifyExpir','role','27yTlMGH','getPhoneInMini','&registerSuccessEmaileAppend=','Repository','changeScore4registe','&grant_type=authorization_code','965dWUahU','__decorate','registerVerifyEmailDesc','&secret=','userId','秒内不得重复发送短信！','phoneCode','changeEmail','password','bcryptjs','&registerFailEmailTeamName=','weAppOpenId','loginWithWechatApp:\x20','https://api.weixin.qq.com/cgi-bin/stable_token','EMAIL_REGISTE','openId、miniOpenId、weAppOpenId中必须存在一个','savaLoginIp','env','padStart','set','object','../user/role.entity','InjectRepository','&registerFailEmailTitle=','design:paramtypes','avatar','visitor','UserStatusEnum','__esModule','updateUserStatus','registerSuccessEmailTitle','@nine.com','WeAppLoginVO','registerFailEmailTeamName','用户名或密码错误','user','该手机号已被其他账号绑定','text','registerSuccessEmailTeamName','../../common/constants/Role.constant','access:','redirect','用户名格式错误！','loginByPhoneV3','post','getConfigByKeys','createMathExpr','验证码填写错误、请重新输入！','getClientIp','./../verification/verification.service','userEntity','updateEmail','ttl','getReqSaasId','emailVerify','queryUserInfoById','../../common/store','jwtService','VerificationEnum','registerFailEmailTitle','1101688qvhrjB','length','miniOpenId','saas.qumao518.vip','status','&registerSuccessEmailTeamName=','getInfo','AuthService','defineProperty','278151uufsrQ','nickname','bindPhone','bindPhoneInMini','createTokenFromFingerprint','BadRequest','userDefautlAvatar','444726aqyLpt','response','phone','registeByPhone','verificationService','updateUserMiniOpenId','svg-captcha','ACTIVE','2748dpHjMi','error','openId','saasId','signinEntity','Registration','nestjs-cls','loginByAdmin','updatePassword','sendPhoneCode','sign','的邮箱验证','RoleEntity','876228VOfHTd','../../common/constants/redisKey.constant','errmsg','accessLabel','无权此操作、请联系管理员！','../globalConfig/globalConfig.service','https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=','当前用户已注册，请勿重复注册！','hashSync','roleEntity','ERole','captcha','UserStatusErrMsg','MailerService','unionid','captchaId','&username=','168993TsDwVW','ChangeEmail','saveToken','邮箱格式错误！','HttpException','registerBaseUrl','createRandomUid','原密码不可为空','authToken','axios','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','lastLoginIp','/api/auth/registerSuccess?id=',':PHONECODE:','YYYY-MM-DD','../../common/constants/user.constant','log','loginInMinigin:\x20','../../common/constants/verification.constant','@nestjs/typeorm','signToken','WE_MINI_APPSECRET','get','redisCacheService','./../user/user.entity','sendMail','authorization_code','&email=','WE_MINI_TEMP_USER','1913492uAARJH','registerSuccessEmaileAppend','账户已被激活过','HttpStatus','invitationRewards','../../common/utils','WE_MINI_ACCESS_KEY','default','comparePassword','WechatConfig','Injectable','errcode','kaifa.qumao518.vip','#fff','getJwtToken','AGENT','WE_APP_APPID','count','手机号不能为空','error:\x20','@nestjs/common','../user/user.service','access_token','email','purePhoneNumber','验证码不能为空！','验证码类型错误','000000','checkUserOriginalPhone','findOne','openid','message'];_0x4f46=function(){return _0x17bd94;};return _0x4f46();}AuthService=__decorate([(0x0,common_1[_0x214c48(0x1d1)])(),__param(0x0,(0x0,typeorm_1[_0x214c48(0x241)])(user_entity_1[_0x214c48(0x21b)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(role_entity_1[_0x214c48(0x28b)])),__param(0x2,(0x0,typeorm_1[_0x214c48(0x241)])(signIn_entity_1[_0x214c48(0x215)])),__metadata(_0x214c48(0x243),[typeorm_2[_0x214c48(0x228)],typeorm_2[_0x214c48(0x228)],typeorm_2[_0x214c48(0x228)],nestjs_cls_1[_0x214c48(0x206)],jwt_1[_0x214c48(0x20d)],user_service_1['UserService'],mailer_service_1[_0x214c48(0x299)],redisCache_service_1[_0x214c48(0x203)],verification_service_1['VerificationService'],globalConfig_service_1[_0x214c48(0x20a)]])],AuthService),exports[_0x214c48(0x26e)]=AuthService;