'use strict';const _0x9a3de7=_0x3d1b;function _0x26df(){const _0x3ccce5=['createRandomUid','openId','./vo/Login.vo','验证码填写错误、请重新输入！','userInitVip','旧密码错误、请检查提交','authorization_code','purePhoneNumber','roleEntity','typeorm','BadRequest','账户不存在，请联系管理员或注册','registerFailEmailTitle','user','../../common/utils/date','账户已被激活过','321838mwjnFW','getOwnPropertyDescriptor','password','验证码类型错误','test','default','__metadata','../user/role.entity','queryUserInfoById','12WZEUXu','bindPhoneInMini','registerSuccessEmaileAppend','wechat\x20获取access_token\x20失败：','bindPhone','@nestjs/jwt','getConfigByKeys','InjectRepository','sendPhoneCode','env','&registerFailEmailTitle=','../signin/signIn.entity','当前用户已注册，请勿重复注册！','ClsService','ceshi.qumao518.vip','&code=','@nine.com','WE_MINI_ACCESS_KEY','data',':CAPTCHA:','../../common/store','VerificationService','/api/auth/registerSuccess?id=','__decorate','openId、miniOpenId、weAppOpenId中必须存在一个','jwtService','ERole','邮箱格式错误！','svg-captcha','updateUserMiniOpenId','registerVerifyEmailTitle','密码修改成功','https://api.weixin.qq.com/sns/oauth2/access_token?appid=','&registerFailEmailTeamName=','registerVerifyEmailFrom','renewMiniAccessToken','createMathExpr','&registerSuccessEmailTeamName=','WE_APP_APPID','function','AGENT','账号密码或密码错误','phoneWithOpenId4regist','createUser','UserEntity','updateEmail','registerSuccessEmailTitle','changeEmail','registerFailEmailTeamName','EMAIL_REGISTE','MailerService','compareSync','&grant_type=authorization_code','redirect','username','WeAppLoginVO','userEntity','kaifa.qumao518.vip','registerBaseUrl','VerificationEnum','&registerSuccessEmaileAppend=','Registration','getPhoneInMini:\x20','object','role','captcha','./vo/WeAppLogin.vo','GOMAXAI_HOST','getPhoneInMini','status','40oWGQDF','nestjs-cls','queryOne','createTokenFromFingerprint','getNamespace','loginByPhoneV3','set','../../common/constants/verification.constant','signinEntity','的邮箱验证','&registerSuccessEmailTitle=','userService','design:paramtypes','3383493oMBQPC','UserStatusEnum','registerVerifyEmailDesc','verificationService','client_credential','verifyCode','WechatConfig','saveToken','RoleEntity','log','registerSuccessEmailTeamName','2XgnWvx','clsService','getClientIp','loginWithWechatApp','response','角色信息异常！','Logger','getOne','bcryptjs','validatePhoneCode','miniOpenId','saasId','globalConfigService','000000','getJwtToken','YYYY-MM-DD','无权此操作、请联系管理员！','phone_info','qureyUserInfoByInviteCode','WE_APP_APPSECRET','getInfo','27772yeQaXJ','/api/auth/registerError?message=','手机号不能为空','phoneCode','message','HttpStatus','WE_MiNI_APPID','redisCacheService','验证码发送成功、请填写验证码完成注册！','access_token','手机号错误！','https://api.weixin.qq.com/sns/jscode2session','errcode','text','getPhoneStatus','ChangeEmail','的注册验证','comparePassword','checkUserOriginalPhone','length','用户名格式错误！','saas.qumao518.vip','axios','原密码不可为空','authToken','../../common/constants/user.constant','weAppOpenId','sign','getReqSaasId','HttpException','https://api.weixin.qq.com/cgi-bin/stable_token','mailerService','save','registeV3','invitedBy','post','66985jxqgJD','AuthService','count','phone','registerVerifyExpir','14392HCTRnZ','savaLoginIp','秒内不得重复发送短信！','../globalConfig/globalConfig.service','UserStatusErrMsg','2049328fFmPXG','账号注册时密码不能为空！','email','userDefautlAvatar','visitor','../../common/constants/Role.constant','HttpStatusCode','access:','createRandomCode','metadata','defineProperty','decorate','1524YyWRSk','loginInMinigin:\x20','loginInMinigin','findOne','get','&email=','error','用户名或密码错误！','Error','errmsg','27pRLWdu','hashSync','isVerifyEmail','ACTIVE','openid','createVerification','nickname','该邮箱已注册！','changeScore4registe',':PHONECODE:','../../common/utils','invitationRewards','&username=','unionid','用户名或密码错误','BAD_REQUEST','padStart','loginWithWechatApp:\x20','__esModule','@nestjs/typeorm','avatar','../redisCache/redisCache.service','20622276tawnGJ','userId','https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=','registeByPhone','accessToken','@nestjs/common','ttl','emailVerify','signToken'];_0x26df=function(){return _0x3ccce5;};return _0x26df();}(function(_0x4f0141,_0xc4605f){const _0x5bc7ab=_0x3d1b,_0x19f8b3=_0x4f0141();while(!![]){try{const _0x5c8bbe=parseInt(_0x5bc7ab(0x13e))/0x1+parseInt(_0x5bc7ab(0x129))/0x2*(parseInt(_0x5bc7ab(0x11e))/0x3)+parseInt(_0x5bc7ab(0xcb))/0x4*(-parseInt(_0x5bc7ab(0x162))/0x5)+parseInt(_0x5bc7ab(0x178))/0x6*(parseInt(_0x5bc7ab(0x167))/0x7)+-parseInt(_0x5bc7ab(0x16c))/0x8*(-parseInt(_0x5bc7ab(0x182))/0x9)+-parseInt(_0x5bc7ab(0x111))/0xa*(parseInt(_0x5bc7ab(0xc2))/0xb)+-parseInt(_0x5bc7ab(0xa9))/0xc;if(_0x5c8bbe===_0xc4605f)break;else _0x19f8b3['push'](_0x19f8b3['shift']());}catch(_0x3d9475){_0x19f8b3['push'](_0x19f8b3['shift']());}}}(_0x26df,0x8b4d3));var __decorate=this&&this[_0x9a3de7(0xe2)]||function(_0x248c1e,_0x437a2a,_0x226d28,_0x4a8eb8){const _0x261d79=_0x9a3de7;var _0x439fa9=arguments[_0x261d79(0x151)],_0x222709=_0x439fa9<0x3?_0x437a2a:_0x4a8eb8===null?_0x4a8eb8=Object[_0x261d79(0xc3)](_0x437a2a,_0x226d28):_0x4a8eb8,_0x1c0b03;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x261d79(0xf2))_0x222709=Reflect[_0x261d79(0x177)](_0x248c1e,_0x437a2a,_0x226d28,_0x4a8eb8);else{for(var _0x5c5b46=_0x248c1e[_0x261d79(0x151)]-0x1;_0x5c5b46>=0x0;_0x5c5b46--)if(_0x1c0b03=_0x248c1e[_0x5c5b46])_0x222709=(_0x439fa9<0x3?_0x1c0b03(_0x222709):_0x439fa9>0x3?_0x1c0b03(_0x437a2a,_0x226d28,_0x222709):_0x1c0b03(_0x437a2a,_0x226d28))||_0x222709;}return _0x439fa9>0x3&&_0x222709&&Object[_0x261d79(0x176)](_0x437a2a,_0x226d28,_0x222709),_0x222709;},__metadata=this&&this[_0x9a3de7(0xc8)]||function(_0x512bb2,_0x363ee3){const _0x448934=_0x9a3de7;if(typeof Reflect===_0x448934(0x10a)&&typeof Reflect[_0x448934(0x175)]==='function')return Reflect['metadata'](_0x512bb2,_0x363ee3);},__param=this&&this['__param']||function(_0x3feabb,_0x2462bf){return function(_0x2d43f5,_0xcec3a0){_0x2462bf(_0x2d43f5,_0xcec3a0,_0x3feabb);};};Object[_0x9a3de7(0x176)](exports,_0x9a3de7(0xa5),{'value':!![]}),exports['AuthService']=void 0x0;const globalConfig_service_1=require(_0x9a3de7(0x16a)),verification_constant_1=require(_0x9a3de7(0x118)),verification_service_1=require('./../verification/verification.service'),user_entity_1=require('./../user/user.entity'),common_1=require(_0x9a3de7(0xae)),jwt_1=require(_0x9a3de7(0xd0)),user_service_1=require('../user/user.service'),mailer_service_1=require('../mailer/mailer.service'),user_constant_1=require(_0x9a3de7(0x157)),utils_1=require(_0x9a3de7(0x18c)),redisCache_service_1=require(_0x9a3de7(0xa8)),svgCaptcha=require(_0x9a3de7(0xe7)),bcrypt=require(_0x9a3de7(0x131)),store_1=require(_0x9a3de7(0xdf)),axios_1=require(_0x9a3de7(0x154)),redisKey_constant_1=require('../../common/constants/redisKey.constant'),Login_vo_1=require(_0x9a3de7(0xb4)),WeAppLogin_vo_1=require(_0x9a3de7(0x10d)),typeorm_1=require(_0x9a3de7(0xa6)),typeorm_2=require(_0x9a3de7(0xbb)),nestjs_cls_1=require(_0x9a3de7(0x112)),role_entity_1=require(_0x9a3de7(0xc9)),Role_constant_1=require(_0x9a3de7(0x171)),signIn_entity_1=require(_0x9a3de7(0xd6)),date_1=require(_0x9a3de7(0xc0));let AuthService=class AuthService{constructor(_0x4776fe,_0x5aa03e,_0x1b0d8e,_0x3f5522,_0x51e3e7,_0x195527,_0x4d4e69,_0x22a66f,_0x4450d6,_0x3fb726){const _0xe320b4=_0x9a3de7;this[_0xe320b4(0x103)]=_0x4776fe,this[_0xe320b4(0xba)]=_0x5aa03e,this[_0xe320b4(0x119)]=_0x1b0d8e,this[_0xe320b4(0x12a)]=_0x3f5522,this[_0xe320b4(0xe4)]=_0x51e3e7,this[_0xe320b4(0x11c)]=_0x195527,this['mailerService']=_0x4d4e69,this[_0xe320b4(0x145)]=_0x22a66f,this[_0xe320b4(0x121)]=_0x4450d6,this[_0xe320b4(0x135)]=_0x3fb726;}[_0x9a3de7(0xb1)](_0x476f9f){const _0x5ca5bf=_0x9a3de7,{id:_0x3aa552,username:_0x86ffa0,role:_0x548b47,openId:_0x3511c7,email:_0x2a057b,client:_0x48c788,saasId:_0x884366}=_0x476f9f;return this[_0x5ca5bf(0xe4)][_0x5ca5bf(0x159)]({'id':_0x3aa552,'username':_0x86ffa0,'role':_0x548b47,'openId':_0x3511c7,'email':_0x2a057b,'client':_0x48c788,'saasId':_0x884366});}async['loginByAdmin'](_0x307f42){const _0x59ddd7=_0x9a3de7,{username:_0x48ebe0,password:_0x55a1aa}=_0x307f42;if(!_0x48ebe0||!_0x55a1aa)throw new common_1[(_0x59ddd7(0x15b))](_0x59ddd7(0xf4),common_1[_0x59ddd7(0x143)][_0x59ddd7(0xa2)]);const _0x2a0809=await this[_0x59ddd7(0x11c)][_0x59ddd7(0x130)](_0x48ebe0);if(!_0x2a0809)throw new common_1[(_0x59ddd7(0x15b))](_0x59ddd7(0xbd),common_1[_0x59ddd7(0x143)][_0x59ddd7(0xa2)]);if((0x0,utils_1[_0x59ddd7(0x14f)])(_0x55a1aa,_0x2a0809[_0x59ddd7(0xc4)]))throw new common_1[(_0x59ddd7(0x15b))](_0x59ddd7(0xa1),common_1[_0x59ddd7(0x143)][_0x59ddd7(0xa2)]);return this[_0x59ddd7(0xb1)](_0x2a0809);}async['changeEmail'](_0x3944be,_0x42d1ee){const _0x2a0726=_0x9a3de7,_0x3aec59=await this[_0x2a0726(0x135)][_0x2a0726(0xd1)](['registerSuccessEmailTitle',_0x2a0726(0x128),_0x2a0726(0xcd),'registerFailEmailTitle','registerFailEmailTeamName']);try{const _0x28bf7b=await this[_0x2a0726(0x121)][_0x2a0726(0x123)](_0x3944be,verification_constant_1[_0x2a0726(0x106)][_0x2a0726(0x14d)]),{type:_0x8dbba6,userId:_0x95c1be}=_0x28bf7b;if(_0x8dbba6!==verification_constant_1[_0x2a0726(0x106)][_0x2a0726(0x14d)])throw new common_1[(_0x2a0726(0x15b))]('验证码类型错误',common_1[_0x2a0726(0x143)][_0x2a0726(0xa2)]);let _0x2e7558=await this[_0x2a0726(0x103)][_0x2a0726(0x17b)]({'where':{'id':_0x95c1be}});_0x2e7558[_0x2a0726(0x16e)]=_0x3944be[_0x2a0726(0x16e)],_0x2e7558=await this[_0x2a0726(0x103)]['save'](_0x2e7558);const {id:_0xfac379,username:_0x3e7810,email:_0x2dd0e3}=_0x2e7558;_0x42d1ee[_0x2a0726(0x100)]('/api/auth/changeEmailSuccess?id='+_0xfac379['toString']()[_0x2a0726(0xa3)](0x4,'0')+_0x2a0726(0x9f)+_0x3e7810+_0x2a0726(0x17d)+_0x2dd0e3+'&registerSuccessEmailTitle='+_0x3aec59[_0x2a0726(0xf9)]+'&registerSuccessEmailTeamName='+_0x3aec59[_0x2a0726(0x128)]+_0x2a0726(0x107)+_0x3aec59['registerSuccessEmaileAppend']);}catch(_0x5c2dd4){const _0x1583ca=_0x5c2dd4[_0x2a0726(0x12d)];_0x42d1ee['redirect'](_0x2a0726(0x13f)+_0x1583ca+_0x2a0726(0xd5)+_0x3aec59[_0x2a0726(0xbe)]+'&registerFailEmailTeamName='+_0x3aec59['registerFailEmailTeamName']);}}async[_0x9a3de7(0x10c)](_0x322fc){const _0x2acc14=_0x9a3de7,_0xe0c53=await this[_0x2acc14(0x135)][_0x2acc14(0x115)](),{color:color='#fff'}=_0x322fc,_0x2f41f0=svgCaptcha[_0x2acc14(0xef)]({'background':color,'height':0x22,'width':0x78,'noise':0x3}),_0x5b470b=_0x2f41f0[_0x2acc14(0x14b)],_0x337b40=(0x0,utils_1[_0x2acc14(0xb2)])(),_0x360abf=_0xe0c53+_0x2acc14(0xde)+_0x337b40;return await this['redisCacheService'][_0x2acc14(0x117)]({'key':_0x360abf,'val':_0x2f41f0[_0x2acc14(0x14b)]},0x5*0x3c),{'svgCode':_0x2f41f0[_0x2acc14(0xdd)],'code':_0x337b40};}async[_0x9a3de7(0xd3)](_0x14d3d6){const _0xa8f7f5=_0x9a3de7;_0x14d3d6['captchaId']&&await this['verificationService']['verifyCaptcha'](_0x14d3d6);const {phone:_0x3ef268}=_0x14d3d6,_0x50a497=await this[_0xa8f7f5(0x135)]['getNamespace'](),_0x3c8f1b=_0x50a497+_0xa8f7f5(0x18b)+_0x3ef268,_0x353aa7=await this['redisCacheService'][_0xa8f7f5(0xaf)](_0x3c8f1b);if(_0x353aa7&&_0x353aa7>0x0)throw new common_1[(_0xa8f7f5(0x15b))](_0x353aa7+_0xa8f7f5(0x169),common_1[_0xa8f7f5(0x143)][_0xa8f7f5(0xa2)]);const _0x592348=(0x0,utils_1[_0xa8f7f5(0x174)])(),_0x78747a={'phone':_0x3ef268,'code':_0x592348};return await this[_0xa8f7f5(0x121)][_0xa8f7f5(0xd3)](_0x78747a),await this[_0xa8f7f5(0x145)][_0xa8f7f5(0x117)]({'key':_0x3c8f1b,'val':_0x592348},0x1*0x3c),_0xa8f7f5(0x146);}async['sendEmailCode'](_0x550171){const _0x5e7915=_0x9a3de7;try{var _0x939fd8=/^[a-zA-Z0-9]+([_.w-]+[a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-.w-]+[a-zA-Z0-9]+)*.[a-zA-Z0-9]+$/;if(!_0x939fd8[_0x5e7915(0xc6)](_0x550171))throw new Error(_0x5e7915(0xe6));const _0x2d59ee=await this[_0x5e7915(0x103)][_0x5e7915(0x17b)]({'where':{'email':_0x550171}});if(_0x2d59ee)throw new Error(_0x5e7915(0x189));const _0x5e5f08=await this['globalConfigService'][_0x5e7915(0xd1)]([_0x5e7915(0x105),_0x5e7915(0xe9),'registerVerifyEmailDesc','registerVerifyEmailFrom',_0x5e7915(0x166)]),_0x41d16a=(0x0,utils_1['createRandomCode'])(),_0x34b8d1=_0x5e5f08[_0x5e7915(0x166)]?Number(_0x5e5f08[_0x5e7915(0x166)]):0x1e*0x3c;await this[_0x5e7915(0x145)]['set']({'key':redisKey_constant_1[_0x5e7915(0xfc)]+_0x550171,'val':_0x41d16a},_0x34b8d1*0x3c),await this[_0x5e7915(0x15d)]['sendMail']({'to':_0x550171,'template':_0x5e7915(0xb0),'subject':'来自'+_0x5e5f08['registerVerifyEmailFrom']+_0x5e7915(0x14e),'context':{'baseUrl':_0x5e5f08[_0x5e7915(0x105)],'code':_0x41d16a,..._0x5e5f08}});}catch(_0x71482d){throw new common_1[(_0x5e7915(0x15b))](_0x71482d['message'],common_1[_0x5e7915(0x143)]['BAD_REQUEST']);}}async[_0x9a3de7(0x10f)](_0x253fb0){const _0x21cfbf=_0x9a3de7;try{const _0x5d7e2c=await this[_0x21cfbf(0x145)][_0x21cfbf(0x17c)]({'key':redisKey_constant_1[_0x21cfbf(0xdc)]}),_0x229507=await axios_1[_0x21cfbf(0xc7)][_0x21cfbf(0x161)](_0x21cfbf(0xab)+_0x5d7e2c,{'code':_0x253fb0});if(_0x229507[_0x21cfbf(0xdd)][_0x21cfbf(0x14a)])throw new Error(_0x229507['data']['errmsg']);return _0x229507[_0x21cfbf(0xdd)][_0x21cfbf(0x13a)][_0x21cfbf(0xb9)];}catch(_0x111810){common_1['Logger'][_0x21cfbf(0x17e)](_0x21cfbf(0x109),_0x111810);throw new common_1['HttpException'](_0x111810['message'],common_1[_0x21cfbf(0x143)][_0x21cfbf(0xa2)]);}}async[_0x9a3de7(0xcc)](_0x4e2a92,_0x51dbe0){const _0x17b6be=_0x9a3de7,_0x38e860=await this[_0x17b6be(0x10f)](_0x4e2a92),_0x3fc941=await this[_0x17b6be(0x103)][_0x17b6be(0x17b)]({'where':{'phone':_0x38e860}}),_0x5a4e35=await this['userEntity'][_0x17b6be(0x17b)]({'where':{'id':_0x51dbe0['user']['id']}});if(_0x3fc941&&_0x5a4e35&&_0x5a4e35['id']!=_0x3fc941['id'])throw new common_1['HttpException']('该手机号已被其他账号绑定',common_1['HttpStatus'][_0x17b6be(0xa2)]);if(!_0x5a4e35)throw new common_1[(_0x17b6be(0x15b))](_0x17b6be(0x180),common_1[_0x17b6be(0x143)]['BAD_REQUEST']);return _0x5a4e35[_0x17b6be(0x165)]=_0x38e860,await this[_0x17b6be(0x103)]['save'](_0x5a4e35),_0x38e860;}async[_0x9a3de7(0xf5)](_0x251150){const _0x59a039=_0x9a3de7;try{if(!_0x251150[_0x59a039(0xb3)]&&!_0x251150[_0x59a039(0x133)]&&!_0x251150[_0x59a039(0x158)])throw new Error(_0x59a039(0xe3));let _0x38618a=_0x59a039(0xb3),_0x3234ba={};if(_0x251150[_0x59a039(0xb3)])_0x38618a=_0x59a039(0xb3);else _0x251150[_0x59a039(0x133)]?_0x38618a=_0x59a039(0x133):_0x38618a=_0x59a039(0x158);_0x3234ba[_0x38618a]=_0x251150[_0x38618a];const _0x4983ab=await this[_0x59a039(0x103)][_0x59a039(0x17b)]({'where':_0x3234ba});if(_0x4983ab&&_0x4983ab['phone'])return![];const _0x2986f5=await this[_0x59a039(0x103)][_0x59a039(0x17b)]({'where':{'phone':_0x251150['phone']}});if(_0x2986f5)return!_0x2986f5[_0x38618a];return!![];}catch(_0x45c3b0){throw new common_1[(_0x59a039(0x15b))](_0x45c3b0['message'],common_1[_0x59a039(0x143)][_0x59a039(0xa2)]);}}async[_0x9a3de7(0xac)](_0x3d3d3b,_0x49f76e){const _0x4825b5=_0x9a3de7,_0x451be6=(0x0,utils_1[_0x4825b5(0x15a)])(this[_0x4825b5(0x12a)]);try{if(!_0x3d3d3b[_0x4825b5(0x165)])throw new Error(_0x4825b5(0x140));if(!_0x3d3d3b[_0x4825b5(0x141)])throw new Error('验证码不能为空！');let _0x24efaf=null;await this[_0x4825b5(0x132)](_0x3d3d3b['phone'],_0x3d3d3b[_0x4825b5(0x141)]),_0x24efaf=await this[_0x4825b5(0x103)]['findOne']({'where':{'phone':_0x3d3d3b['phone'],'saasId':_0x451be6}});if(_0x24efaf)throw new Error(_0x4825b5(0xd7));const _0x36eec1=new user_entity_1[(_0x4825b5(0xf7))]();for(let _0x4b904b in _0x3d3d3b){_0x3d3d3b[_0x4b904b]&&(_0x36eec1[_0x4b904b]=_0x3d3d3b[_0x4b904b]);}_0x36eec1[_0x4825b5(0xc4)]&&(_0x36eec1['password']=bcrypt[_0x4825b5(0x183)](_0x3d3d3b[_0x4825b5(0xc4)],0xa));_0x36eec1['status']=user_constant_1[_0x4825b5(0x11f)][_0x4825b5(0x185)];!_0x36eec1[_0x4825b5(0x188)]&&(_0x36eec1[_0x4825b5(0x188)]=_0x36eec1[_0x4825b5(0x188)]||'小智');!_0x36eec1[_0x4825b5(0xa7)]&&(_0x36eec1['avatar']=await this[_0x4825b5(0x135)]['getConfigByKeys']([_0x4825b5(0x16f)]));_0x36eec1[_0x4825b5(0x134)]=_0x451be6;const _0x31aa41=await this[_0x4825b5(0x11c)][_0x4825b5(0xf6)](_0x36eec1);this[_0x4825b5(0x18d)](_0x31aa41,_0x3d3d3b[_0x4825b5(0x160)]);const _0x239190=(0x0,utils_1[_0x4825b5(0x12b)])(_0x49f76e),_0x3723fa=this[_0x4825b5(0xb1)](_0x31aa41);return await this[_0x4825b5(0x11c)][_0x4825b5(0x168)](_0x31aa41['id'],_0x239190),await this[_0x4825b5(0x145)][_0x4825b5(0x125)](_0x31aa41['id'],_0x3723fa),_0x3723fa;}catch(_0x4cbdf4){if(_0x4cbdf4 instanceof common_1[_0x4825b5(0x15b)])throw _0x4cbdf4;else throw new common_1['HttpException'](_0x4cbdf4[_0x4825b5(0x142)],common_1['HttpStatus'][_0x4825b5(0xa2)]);}}async[_0x9a3de7(0x15f)](_0x3bf70f,_0x20615e){const _0x1081e7=_0x9a3de7,_0x440dd7=(0x0,utils_1[_0x1081e7(0x15a)])(this[_0x1081e7(0x12a)]);try{if(_0x3bf70f[_0x1081e7(0x101)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/[_0x1081e7(0xc6)](_0x3bf70f[_0x1081e7(0x101)]))throw new Error(_0x1081e7(0x152));if(!_0x3bf70f['password'])throw new Error(_0x1081e7(0x16d));}else{if(!_0x3bf70f[_0x1081e7(0xb3)]&&!_0x3bf70f['miniOpenId']&&!_0x3bf70f['weAppOpenId']&&!_0x3bf70f['unionid'])throw new Error('参数错误！');}if(_0x3bf70f[_0x1081e7(0x165)]&&!_0x3bf70f[_0x1081e7(0x141)])throw new Error('验证码不能为空！');let _0x26b4b4=null;if(_0x3bf70f[_0x1081e7(0x165)])await this[_0x1081e7(0x132)](_0x3bf70f[_0x1081e7(0x165)],_0x3bf70f[_0x1081e7(0x141)]),_0x26b4b4=await this[_0x1081e7(0x103)][_0x1081e7(0x17b)]({'where':{'phone':_0x3bf70f[_0x1081e7(0x165)],'saasId':_0x440dd7}});else{if(_0x3bf70f['openId']||_0x3bf70f[_0x1081e7(0x133)]||_0x3bf70f['weAppOpenId']||_0x3bf70f[_0x1081e7(0xa0)]){let _0x5dbe2b=_0x1081e7(0xb3),_0x40efda={'saasId':_0x440dd7};if(_0x3bf70f['unionid'])_0x5dbe2b='unionid';else{if(_0x3bf70f[_0x1081e7(0xb3)])_0x5dbe2b='openId';else _0x3bf70f[_0x1081e7(0x133)]?_0x5dbe2b=_0x1081e7(0x133):_0x5dbe2b=_0x1081e7(0x158);}_0x40efda[_0x5dbe2b]=_0x3bf70f[_0x5dbe2b],_0x26b4b4=await this[_0x1081e7(0x103)][_0x1081e7(0x17b)]({'where':_0x40efda});if(_0x26b4b4)throw new Error(_0x1081e7(0xd7));}else{_0x26b4b4=await this[_0x1081e7(0x103)][_0x1081e7(0x17b)]({'where':{'username':_0x3bf70f[_0x1081e7(0x101)],'saasId':_0x440dd7}});if(_0x26b4b4)throw new Error(_0x1081e7(0xd7));}}const _0x548d94=new user_entity_1[(_0x1081e7(0xf7))]();for(let _0x1b4983 in _0x3bf70f){_0x3bf70f[_0x1b4983]&&(_0x548d94[_0x1b4983]=_0x3bf70f[_0x1b4983]);}_0x26b4b4?_0x548d94['id']=_0x26b4b4['id']:(_0x548d94[_0x1081e7(0xc4)]&&(_0x548d94[_0x1081e7(0xc4)]=bcrypt[_0x1081e7(0x183)](_0x3bf70f[_0x1081e7(0xc4)],0xa)),_0x548d94[_0x1081e7(0x110)]=user_constant_1[_0x1081e7(0x11f)]['ACTIVE'],!_0x548d94['nickname']&&(_0x548d94[_0x1081e7(0x188)]=_0x548d94['nickname']||'小智'),!_0x548d94[_0x1081e7(0xa7)]&&(_0x548d94[_0x1081e7(0xa7)]=await this['globalConfigService']['getConfigByKeys']([_0x1081e7(0x16f)])));_0x548d94[_0x1081e7(0x134)]=_0x440dd7;const _0x48dc0d=await this[_0x1081e7(0x11c)][_0x1081e7(0xf6)](_0x548d94);!_0x26b4b4&&this[_0x1081e7(0x18d)](_0x48dc0d,_0x3bf70f[_0x1081e7(0x160)]);const _0x560bd7=(0x0,utils_1[_0x1081e7(0x12b)])(_0x20615e),_0x4c0008=this[_0x1081e7(0xb1)](_0x48dc0d);return await this[_0x1081e7(0x11c)][_0x1081e7(0x168)](_0x48dc0d['id'],_0x560bd7),await this[_0x1081e7(0x145)][_0x1081e7(0x125)](_0x48dc0d['id'],_0x4c0008),_0x4c0008;}catch(_0x451916){if(_0x451916 instanceof common_1[_0x1081e7(0x15b)])throw _0x451916;else throw new common_1[(_0x1081e7(0x15b))](_0x451916[_0x1081e7(0x142)],common_1[_0x1081e7(0x143)][_0x1081e7(0xa2)]);}}async[_0x9a3de7(0x116)](_0x2e54e5,_0x111410){const _0x3da328=_0x9a3de7,_0x1e0837=(0x0,utils_1[_0x3da328(0x15a)])(this[_0x3da328(0x12a)]);await this[_0x3da328(0x132)](_0x2e54e5[_0x3da328(0x165)],_0x2e54e5['phoneCode']);let _0x2e4bac=await this[_0x3da328(0x103)][_0x3da328(0x17b)]({'where':{'phone':_0x2e54e5['phone'],'saasId':_0x1e0837}});if(!_0x2e4bac){const _0x95428c=new user_entity_1['UserEntity']();_0x95428c[_0x3da328(0x165)]=_0x2e54e5[_0x3da328(0x165)],_0x95428c[_0x3da328(0x188)]=_0x2e54e5[_0x3da328(0x165)],_0x95428c[_0x3da328(0x110)]=user_constant_1[_0x3da328(0x11f)]['ACTIVE'],_0x95428c[_0x3da328(0xa7)]=await this[_0x3da328(0x135)][_0x3da328(0xd1)]([_0x3da328(0x16f)]),_0x2e4bac=await this[_0x3da328(0x11c)][_0x3da328(0xf6)](_0x95428c),this['invitationRewards'](_0x2e4bac,_0x2e54e5[_0x3da328(0x160)]);}const _0x222044=(0x0,utils_1[_0x3da328(0x12b)])(_0x111410),_0x43d9a6=this['signToken'](_0x2e4bac);return await this[_0x3da328(0x11c)][_0x3da328(0x168)](_0x2e4bac['id'],_0x222044),await this[_0x3da328(0x145)][_0x3da328(0x125)](_0x2e4bac['id'],_0x43d9a6),_0x43d9a6;}async['loginV4'](_0x1bdb00,_0x2cca70){const _0x5760c7=_0x9a3de7;try{const _0x18dd73=(0x0,utils_1[_0x5760c7(0x15a)])(this[_0x5760c7(0x12a)]),_0x14e7f2=await this[_0x5760c7(0x103)][_0x5760c7(0x17b)]({'where':[{'username':_0x1bdb00[_0x5760c7(0x101)],'saasId':_0x18dd73},{'email':_0x1bdb00[_0x5760c7(0x101)],'saasId':_0x18dd73},{'phone':_0x1bdb00['username'],'saasId':_0x18dd73}]});if(!_0x14e7f2)throw new Error(_0x5760c7(0x17f));if(!_0x14e7f2[_0x5760c7(0xc4)])throw new Error(_0x5760c7(0x17f));if(!bcrypt[_0x5760c7(0xfe)](_0x1bdb00[_0x5760c7(0xc4)],_0x14e7f2[_0x5760c7(0xc4)]))throw new Error('用户名或密码错误！');_0x14e7f2[_0x5760c7(0x101)]&&!_0x14e7f2['lastLoginIp']&&await this[_0x5760c7(0x11c)][_0x5760c7(0xb6)](_0x14e7f2);const _0x1dea6a=(0x0,utils_1[_0x5760c7(0x12b)])(_0x2cca70),_0x1347be=this[_0x5760c7(0xb1)](_0x14e7f2);await this['userService'][_0x5760c7(0x168)](_0x14e7f2['id'],_0x1dea6a),await this[_0x5760c7(0x145)][_0x5760c7(0x125)](_0x14e7f2['id'],_0x1347be);if((0x0,utils_1['shouldAccess'])(_0x14e7f2['role'])){let _0x510bd6;_0x14e7f2['role']===Role_constant_1[_0x5760c7(0xe5)][_0x5760c7(0xf3)]?_0x510bd6=await this[_0x5760c7(0xba)][_0x5760c7(0x17b)]({'where':{'code':_0x14e7f2['role']}}):_0x510bd6=await this['roleEntity']['findOne']({'where':{'code':_0x14e7f2[_0x5760c7(0x10b)],'saasId':_0x18dd73}});if(!_0x510bd6)throw new Error(_0x5760c7(0x12e));await this[_0x5760c7(0x145)][_0x5760c7(0x117)]({'key':_0x5760c7(0x173)+_0x14e7f2['id'],'val':_0x510bd6['accessLabel']});}return _0x1347be;}catch(_0x5bcb35){throw new common_1[(_0x5760c7(0x15b))](_0x5bcb35[_0x5760c7(0x142)],common_1[_0x5760c7(0x143)]['BAD_REQUEST']);}}async[_0x9a3de7(0x17a)](_0x5b8ae1){const _0x22c95a=_0x9a3de7;try{const _0x1dd90d=new Login_vo_1['default'](),_0x1dd9ef=(0x0,utils_1[_0x22c95a(0x15a)])(this[_0x22c95a(0x12a)]),_0x47bbcc=await axios_1[_0x22c95a(0xc7)][_0x22c95a(0x17c)](_0x22c95a(0x149),{'params':{'appid':store_1[_0x22c95a(0x124)]['WE_MiNI_APPID'],'secret':store_1[_0x22c95a(0x124)]['WE_MINI_APPSECRET'],'js_code':_0x5b8ae1,'grant_type':_0x22c95a(0xb8)}}),_0x72b1e2=_0x47bbcc[_0x22c95a(0xdd)];if(_0x72b1e2[_0x22c95a(0x14a)])throw new Error(_0x72b1e2[_0x22c95a(0x181)]);let _0x35ad99;return _0x72b1e2['unionid']&&(_0x35ad99=await this['userEntity'][_0x22c95a(0x17b)]({'where':{'unionid':_0x72b1e2[_0x22c95a(0xa0)],'saasId':_0x1dd9ef}})),!_0x35ad99&&(_0x35ad99=await this['userEntity'][_0x22c95a(0x17b)]({'where':{'miniOpenId':_0x72b1e2['openid'],'saasId':_0x1dd9ef}})),!_0x35ad99?this[_0x22c95a(0x145)]['set']({'key':redisKey_constant_1['WE_MINI_TEMP_USER']+_0x72b1e2[_0x22c95a(0x186)],'val':_0x72b1e2[_0x22c95a(0xa0)]||null}):(_0x35ad99['unionid']=_0x72b1e2[_0x22c95a(0xa0)],_0x35ad99[_0x22c95a(0x133)]=_0x72b1e2[_0x22c95a(0x186)],await this[_0x22c95a(0x11c)][_0x22c95a(0xe8)](_0x35ad99['id'],_0x72b1e2[_0x22c95a(0x186)],_0x72b1e2[_0x22c95a(0xa0)]),_0x1dd90d['authToken']=this[_0x22c95a(0xb1)](_0x35ad99),await this[_0x22c95a(0x145)]['saveToken'](_0x35ad99['id'],_0x1dd90d[_0x22c95a(0x156)])),_0x1dd90d[_0x22c95a(0xa0)]=_0x72b1e2[_0x22c95a(0xa0)],_0x1dd90d[_0x22c95a(0x186)]=_0x72b1e2['openid'],_0x1dd90d;}catch(_0x341162){common_1[_0x22c95a(0x12f)][_0x22c95a(0x17e)](_0x22c95a(0x179),_0x341162);throw new common_1['HttpException'](_0x341162[_0x22c95a(0x142)],common_1[_0x22c95a(0x143)][_0x22c95a(0xa2)]);}}async[_0x9a3de7(0x12c)](_0x252d47){const _0x5add0f=_0x9a3de7,_0x1908b4=new WeAppLogin_vo_1[(_0x5add0f(0x102))](),_0x5cf6d8=(0x0,utils_1[_0x5add0f(0x15a)])(this[_0x5add0f(0x12a)]);try{const _0x4eba76=await axios_1['default'][_0x5add0f(0x17c)](_0x5add0f(0xeb)+store_1[_0x5add0f(0x124)][_0x5add0f(0xf1)]+'&secret='+store_1[_0x5add0f(0x124)][_0x5add0f(0x13c)]+_0x5add0f(0xda)+_0x252d47+_0x5add0f(0xff));if(_0x4eba76['data'][_0x5add0f(0x14a)])throw new Error(_0x4eba76[_0x5add0f(0xdd)]['errmsg']);const _0x486afa=_0x4eba76['data'];let _0xf84266;return _0x486afa['unionid']&&(_0xf84266=await this[_0x5add0f(0x103)][_0x5add0f(0x17b)]({'where':{'unionid':_0x486afa[_0x5add0f(0xa0)],'saasId':_0x5cf6d8}})),!_0xf84266&&(_0xf84266=await this['userEntity'][_0x5add0f(0x17b)]({'where':{'weAppOpenId':_0x486afa[_0x5add0f(0x186)],'saasId':_0x5cf6d8}})),!_0xf84266?this[_0x5add0f(0x145)][_0x5add0f(0x117)]({'key':redisKey_constant_1['WE_APP_TEMP_USER']+_0x486afa[_0x5add0f(0x186)],'val':_0x486afa['unionid']||null}):(_0xf84266[_0x5add0f(0xa0)]=_0x486afa[_0x5add0f(0xa0)],_0xf84266[_0x5add0f(0x158)]=_0x486afa[_0x5add0f(0x186)],_0x1908b4[_0x5add0f(0x156)]=this[_0x5add0f(0xb1)](_0xf84266),await this[_0x5add0f(0x145)][_0x5add0f(0x125)](_0xf84266['id'],_0x1908b4[_0x5add0f(0x156)]),await this[_0x5add0f(0x11c)]['updateUserAppOpenId'](_0xf84266['id'],_0x486afa[_0x5add0f(0x186)],_0x486afa[_0x5add0f(0xa0)])),_0x1908b4[_0x5add0f(0x186)]=_0x486afa['openid'],_0x1908b4[_0x5add0f(0xa0)]=_0x486afa[_0x5add0f(0xa0)],_0x1908b4[_0x5add0f(0xad)]=_0x486afa[_0x5add0f(0x147)],_0x1908b4;}catch(_0x3082b2){common_1[_0x5add0f(0x12f)][_0x5add0f(0x17e)](_0x5add0f(0xa4),_0x3082b2);throw new common_1[(_0x5add0f(0x15b))](_0x3082b2[_0x5add0f(0x142)],common_1[_0x5add0f(0x143)][_0x5add0f(0xa2)]);}}async['activateAccount'](_0x4ad9c8,_0x300201){const _0x420b48=_0x9a3de7,_0xd68bde=await this[_0x420b48(0x135)][_0x420b48(0xd1)]([_0x420b48(0xf9),_0x420b48(0x128),'registerSuccessEmaileAppend',_0x420b48(0xbe),_0x420b48(0xfb)]);try{const _0x24fb77=await this['verificationService']['verifyCode'](_0x4ad9c8,verification_constant_1[_0x420b48(0x106)][_0x420b48(0x108)]),{type:_0x7fcab1,userId:_0x1f663a}=_0x24fb77;if(_0x7fcab1!==verification_constant_1[_0x420b48(0x106)][_0x420b48(0x108)])throw new common_1[(_0x420b48(0x15b))](_0x420b48(0xc5),common_1[_0x420b48(0x143)]['BAD_REQUEST']);const _0x2aa3ce=await this[_0x420b48(0x11c)]['getUserStatus'](_0x1f663a);if(_0x2aa3ce===user_constant_1[_0x420b48(0x11f)][_0x420b48(0x185)])throw new common_1['HttpException'](_0x420b48(0xc1),common_1[_0x420b48(0x143)]['BAD_REQUEST']);await this[_0x420b48(0x11c)]['updateUserStatus'](_0x24fb77['userId'],user_constant_1['UserStatusEnum'][_0x420b48(0x185)]);const _0x19d069=await this[_0x420b48(0x11c)][_0x420b48(0xca)](_0x24fb77['userId']),{username:_0x1259de,email:_0x3247bc,id:_0x460ca9,invitedBy:_0x3e7f5a}=_0x19d069;let _0x3a8200;_0x3e7f5a&&(_0x3a8200=await this[_0x420b48(0x11c)][_0x420b48(0x13b)](_0x3e7f5a)),await this[_0x420b48(0x11c)][_0x420b48(0x18a)](_0x19d069,_0x3a8200),_0x300201[_0x420b48(0x100)](_0x420b48(0xe1)+_0x460ca9['toString']()[_0x420b48(0xa3)](0x4,'0')+_0x420b48(0x9f)+_0x1259de+_0x420b48(0x17d)+_0x3247bc+_0x420b48(0x11b)+_0xd68bde[_0x420b48(0xf9)]+_0x420b48(0xf0)+_0xd68bde[_0x420b48(0x128)]+_0x420b48(0x107)+_0xd68bde[_0x420b48(0xcd)]);}catch(_0x6060f5){console[_0x420b48(0x127)]('error:\x20',_0x6060f5);const _0x4606ca=_0x6060f5['response'];_0x300201[_0x420b48(0x100)](_0x420b48(0x13f)+_0x4606ca+_0x420b48(0xd5)+_0xd68bde[_0x420b48(0xbe)]+_0x420b48(0xec)+_0xd68bde[_0x420b48(0xfb)]);}}async[_0x9a3de7(0x13d)](_0x40c106){const _0xc1951b=_0x9a3de7,_0x1ae00c=await this[_0xc1951b(0x11c)][_0xc1951b(0x113)]({'id':_0x40c106[_0xc1951b(0xbf)]['id']});let _0x3b2778=![];const _0xc8c7b4=(0x0,date_1['default'])()['format'](_0xc1951b(0x138)),_0x389333=await this['signinEntity'][_0xc1951b(0x17b)]({'where':{'userId':_0x1ae00c['id'],'signInDate':_0xc8c7b4}});return _0x389333&&(_0x3b2778=!![]),{'userInfo':_0x1ae00c,'isSignIn':_0x3b2778};}async['updatePassword'](_0x424d85,_0x4686a1){const _0x136786=_0x9a3de7,{id:_0x5e8d40,client:_0x125a81}=_0x424d85[_0x136786(0xbf)];if(_0x125a81&&Number(_0x125a81)>0x0)throw new common_1['HttpException'](_0x136786(0x139),common_1[_0x136786(0x143)]['BAD_REQUEST']);const {oldPassword:_0x165135,password:_0x23bd5a}=_0x4686a1,_0x2a64a7=await this[_0x136786(0x103)]['findOne']({'where':{'id':_0x5e8d40}});if(_0x2a64a7[_0x136786(0xc4)]){if(!_0x165135)throw new common_1[(_0x136786(0x15b))](_0x136786(0x155),common_1['HttpStatus'][_0x136786(0xa2)]);const _0x552044=bcrypt['compareSync'](_0x165135,_0x2a64a7['password']);if(!_0x552044)throw new common_1['HttpException'](_0x136786(0xb7),common_1['HttpStatus'][_0x136786(0xa2)]);}return _0x2a64a7[_0x136786(0xc4)]=bcrypt[_0x136786(0x183)](_0x23bd5a,0xa),await this['userEntity']['save'](_0x2a64a7),_0x136786(0xea);}async[_0x9a3de7(0xf8)](_0xcdeb05,_0x50c036){const _0x1c085d=_0x9a3de7,_0x542309=_0xcdeb05[_0x1c085d(0xbf)]['id'],_0x5beb2a=await this[_0x1c085d(0x103)]['findOne']({'where':{'email':_0x50c036['email']}});if(_0x5beb2a)throw new common_1[(_0x1c085d(0x15b))]('邮箱已被其他用户使用',axios_1[_0x1c085d(0x172)][_0x1c085d(0xbc)]);const _0x43019f=await this[_0x1c085d(0x103)][_0x1c085d(0x17b)]({'where':{'id':_0x542309}}),_0x36dfe1=await this[_0x1c085d(0x135)][_0x1c085d(0xd1)]([_0x1c085d(0x184),_0x1c085d(0x105),'registerVerifyEmailTitle',_0x1c085d(0x120),_0x1c085d(0xed),_0x1c085d(0x166)]);_0x43019f[_0x1c085d(0x16e)]=_0x50c036['email'];const _0x235c62=_0x36dfe1[_0x1c085d(0x166)]?Number(_0x36dfe1[_0x1c085d(0x166)]):0x1e*0x3c,_0x1476b8=await this[_0x1c085d(0x121)][_0x1c085d(0x187)](_0x43019f,verification_constant_1[_0x1c085d(0x106)][_0x1c085d(0x14d)],_0x235c62),{code:_0xb56766,email:_0x203c07,id:_0x62a1c4}=_0x1476b8,{registerVerifyEmailFrom:_0x1470fa}=_0x36dfe1;await this[_0x1c085d(0x15d)]['sendMail']({'to':_0x203c07,'template':_0x1c085d(0xfa),'subject':'来自'+_0x1470fa+_0x1c085d(0x11a),'context':{'id':_0x62a1c4,'code':_0xb56766,'email':_0x203c07,..._0x36dfe1,'baseUrl':_0x36dfe1[_0x1c085d(0x105)]}});}async[_0x9a3de7(0x14c)](_0x4f51e7){const _0x455906=_0x9a3de7,_0x2fac74=await this[_0x455906(0x103)][_0x455906(0x164)]({'where':{'phone':_0x4f51e7}});return _0x2fac74>0x0;}async[_0x9a3de7(0xcf)](_0x1e5465){const _0x423388=_0x9a3de7;await this[_0x423388(0x132)](_0x1e5465[_0x423388(0x165)],_0x1e5465[_0x423388(0x141)]);if(await this[_0x423388(0x14c)](_0x1e5465[_0x423388(0x165)]))throw new common_1[(_0x423388(0x15b))]('当前手机号已绑定其他账户！',common_1[_0x423388(0x143)][_0x423388(0xa2)]);return await this[_0x423388(0x103)][_0x423388(0x15e)]({'id':_0x1e5465[_0x423388(0xaa)],'phone':_0x1e5465['phone']}),!![];}async[_0x9a3de7(0xee)](){const _0x297eba=_0x9a3de7;try{const _0x320c36=process[_0x297eba(0xd4)][_0x297eba(0x10e)];if(_0x320c36===_0x297eba(0x104)||_0x320c36===_0x297eba(0xd9)||_0x320c36===_0x297eba(0x153)){const _0x3aadf2=await axios_1[_0x297eba(0xc7)][_0x297eba(0x17c)]('https://gomaxai.qumao518.vip/api/official/getAccessToken?type=mini');await this[_0x297eba(0x145)]['set']({'key':redisKey_constant_1[_0x297eba(0xdc)],'val':_0x3aadf2[_0x297eba(0xdd)]['data']});}else{const _0x350e2a=await axios_1[_0x297eba(0xc7)][_0x297eba(0x161)](_0x297eba(0x15c),{'grant_type':_0x297eba(0x122),'appid':store_1[_0x297eba(0x124)][_0x297eba(0x144)],'secret':store_1[_0x297eba(0x124)]['WE_MINI_APPSECRET'],'force_refresh':![]});await this[_0x297eba(0x145)][_0x297eba(0x117)]({'key':redisKey_constant_1['WE_MINI_ACCESS_KEY'],'val':_0x350e2a['data'][_0x297eba(0x147)]});}}catch(_0x4074){common_1['Logger']['error'](_0x297eba(0xce),_0x4074);}}[_0x9a3de7(0x114)](_0x3336dc){const _0x363e9c=_0x9a3de7,_0x163c0c={'id':_0x3336dc,'openId':null,'client':null,'role':_0x363e9c(0x170),'username':'游客'+_0x3336dc,'email':_0x3336dc+_0x363e9c(0xdb),'saasId':(0x0,utils_1[_0x363e9c(0x15a)])(this[_0x363e9c(0x12a)])};return this[_0x363e9c(0xb1)](_0x163c0c);}async[_0x9a3de7(0x137)](_0x2122e8,_0x10a776){const _0x14de9c=_0x9a3de7,{status:_0x4f0b9a}=_0x2122e8;if(_0x4f0b9a!==user_constant_1[_0x14de9c(0x11f)][_0x14de9c(0x185)])throw new common_1[(_0x14de9c(0x15b))](user_constant_1[_0x14de9c(0x16b)][_0x4f0b9a],common_1[_0x14de9c(0x143)][_0x14de9c(0xa2)]);const _0x1eb3d2=(0x0,utils_1[_0x14de9c(0x12b)])(_0x10a776),_0x2f9110=this['signToken'](_0x2122e8);return await this[_0x14de9c(0x11c)]['savaLoginIp'](_0x2122e8['id'],_0x1eb3d2),await this[_0x14de9c(0x145)][_0x14de9c(0x125)](_0x2122e8['id'],_0x2f9110),_0x2f9110;}async[_0x9a3de7(0x132)](_0x578986,_0x47f898){const _0x37dcc7=_0x9a3de7,_0x196c57=await this[_0x37dcc7(0x135)]['getNamespace'](),_0x2e42c0=_0x196c57+_0x37dcc7(0x18b)+_0x578986;if(_0x47f898===_0x37dcc7(0x136))return;const _0x16a4ce=await this[_0x37dcc7(0x145)][_0x37dcc7(0x17c)]({'key':_0x2e42c0});if(!_0x16a4ce)throw new common_1[(_0x37dcc7(0x15b))]('验证码已过期、请重新发送！',common_1[_0x37dcc7(0x143)][_0x37dcc7(0xa2)]);if(_0x47f898!==_0x16a4ce)throw new common_1['HttpException'](_0x37dcc7(0xb5),common_1[_0x37dcc7(0x143)][_0x37dcc7(0xa2)]);}async['invitationRewards'](_0x31746f,_0x71890){const _0x372df4=_0x9a3de7;let _0x4d3d07;_0x71890&&(_0x4d3d07=await this[_0x372df4(0x11c)]['qureyUserInfoByInviteCode'](_0x71890)),await this[_0x372df4(0x11c)]['changeScore4registe'](_0x31746f,_0x4d3d07);}async[_0x9a3de7(0x150)](_0x44b867,_0x6abccf,_0x388a9d){const _0x4d1d88=_0x9a3de7;await this['validatePhoneCode'](_0x44b867,_0x6abccf);const _0x442b2a=await this[_0x4d1d88(0x103)]['findOne']({'where':{'id':_0x388a9d[_0x4d1d88(0xbf)]['id']}});if(_0x442b2a[_0x4d1d88(0x165)]!==_0x44b867)throw new common_1[(_0x4d1d88(0x15b))](_0x4d1d88(0x148),common_1[_0x4d1d88(0x143)][_0x4d1d88(0xa2)]);return!![];}};function _0x3d1b(_0x438310,_0x5e45bf){const _0x26dfd0=_0x26df();return _0x3d1b=function(_0x3d1b73,_0x30fdea){_0x3d1b73=_0x3d1b73-0x9f;let _0x2491ac=_0x26dfd0[_0x3d1b73];return _0x2491ac;},_0x3d1b(_0x438310,_0x5e45bf);}AuthService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1['UserEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(role_entity_1[_0x9a3de7(0x126)])),__param(0x2,(0x0,typeorm_1[_0x9a3de7(0xd2)])(signIn_entity_1['SigninEntity'])),__metadata(_0x9a3de7(0x11d),[typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2['Repository'],nestjs_cls_1[_0x9a3de7(0xd8)],jwt_1['JwtService'],user_service_1['UserService'],mailer_service_1[_0x9a3de7(0xfd)],redisCache_service_1['RedisCacheService'],verification_service_1[_0x9a3de7(0xe0)],globalConfig_service_1['GlobalConfigService']])],AuthService),exports[_0x9a3de7(0x163)]=AuthService;