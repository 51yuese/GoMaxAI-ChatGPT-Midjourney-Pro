'use strict';function _0x4cc6(_0x156cf0,_0x2f2e5e){const _0xb559df=_0xb559();return _0x4cc6=function(_0x4cc604,_0x58d9c9){_0x4cc604=_0x4cc604-0x15c;let _0x40ddbc=_0xb559df[_0x4cc604];return _0x40ddbc;},_0x4cc6(_0x156cf0,_0x2f2e5e);}const _0x5dd9ce=_0x4cc6;(function(_0x32e593,_0x3e4bf2){const _0x23e6cd=_0x4cc6,_0x3497dd=_0x32e593();while(!![]){try{const _0x40ec1d=-parseInt(_0x23e6cd(0x241))/0x1+-parseInt(_0x23e6cd(0x19a))/0x2+parseInt(_0x23e6cd(0x1a3))/0x3*(parseInt(_0x23e6cd(0x243))/0x4)+parseInt(_0x23e6cd(0x199))/0x5+-parseInt(_0x23e6cd(0x222))/0x6*(-parseInt(_0x23e6cd(0x1a5))/0x7)+-parseInt(_0x23e6cd(0x240))/0x8*(-parseInt(_0x23e6cd(0x179))/0x9)+-parseInt(_0x23e6cd(0x1b7))/0xa*(parseInt(_0x23e6cd(0x215))/0xb);if(_0x40ec1d===_0x3e4bf2)break;else _0x3497dd['push'](_0x3497dd['shift']());}catch(_0x18236){_0x3497dd['push'](_0x3497dd['shift']());}}}(_0xb559,0xe45d1));var __decorate=this&&this[_0x5dd9ce(0x1b2)]||function(_0x5c6dbc,_0x3f07af,_0x2d5606,_0x37aecc){const _0xa2844b=_0x5dd9ce;var _0x453913=arguments[_0xa2844b(0x180)],_0x295d7c=_0x453913<0x3?_0x3f07af:_0x37aecc===null?_0x37aecc=Object['getOwnPropertyDescriptor'](_0x3f07af,_0x2d5606):_0x37aecc,_0x3d5fc6;if(typeof Reflect===_0xa2844b(0x1f7)&&typeof Reflect[_0xa2844b(0x214)]===_0xa2844b(0x1cb))_0x295d7c=Reflect[_0xa2844b(0x214)](_0x5c6dbc,_0x3f07af,_0x2d5606,_0x37aecc);else{for(var _0x57fac4=_0x5c6dbc[_0xa2844b(0x180)]-0x1;_0x57fac4>=0x0;_0x57fac4--)if(_0x3d5fc6=_0x5c6dbc[_0x57fac4])_0x295d7c=(_0x453913<0x3?_0x3d5fc6(_0x295d7c):_0x453913>0x3?_0x3d5fc6(_0x3f07af,_0x2d5606,_0x295d7c):_0x3d5fc6(_0x3f07af,_0x2d5606))||_0x295d7c;}return _0x453913>0x3&&_0x295d7c&&Object[_0xa2844b(0x234)](_0x3f07af,_0x2d5606,_0x295d7c),_0x295d7c;},__metadata=this&&this[_0x5dd9ce(0x161)]||function(_0xb75ea6,_0xd92198){const _0x3f69a8=_0x5dd9ce;if(typeof Reflect==='object'&&typeof Reflect[_0x3f69a8(0x171)]===_0x3f69a8(0x1cb))return Reflect[_0x3f69a8(0x171)](_0xb75ea6,_0xd92198);},__param=this&&this['__param']||function(_0x44f4b6,_0x1e55ba){return function(_0x84fe2a,_0x54f810){_0x1e55ba(_0x84fe2a,_0x54f810,_0x44f4b6);};};Object[_0x5dd9ce(0x234)](exports,_0x5dd9ce(0x1a6),{'value':!![]}),exports['AuthService']=void 0x0;const globalConfig_service_1=require(_0x5dd9ce(0x1eb)),verification_constant_1=require(_0x5dd9ce(0x226)),verification_service_1=require('./../verification/verification.service'),user_entity_1=require('./../user/user.entity'),common_1=require('@nestjs/common'),jwt_1=require(_0x5dd9ce(0x21b)),user_service_1=require(_0x5dd9ce(0x23f)),mailer_service_1=require(_0x5dd9ce(0x23b)),user_constant_1=require(_0x5dd9ce(0x213)),utils_1=require(_0x5dd9ce(0x218)),redisCache_service_1=require(_0x5dd9ce(0x21d)),svgCaptcha=require(_0x5dd9ce(0x1d4)),bcrypt=require(_0x5dd9ce(0x23e)),store_1=require('../../common/store'),axios_1=require(_0x5dd9ce(0x1c4)),redisKey_constant_1=require(_0x5dd9ce(0x22f)),Login_vo_1=require('./vo/Login.vo'),WeAppLogin_vo_1=require('./vo/WeAppLogin.vo'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x5dd9ce(0x181)),nestjs_cls_1=require(_0x5dd9ce(0x1d3)),role_entity_1=require('../user/role.entity'),Role_constant_1=require(_0x5dd9ce(0x203)),signIn_entity_1=require('../signin/signIn.entity'),date_1=require(_0x5dd9ce(0x19b));let AuthService=class AuthService{constructor(_0x4b2eeb,_0x44dd5b,_0x4ff894,_0x2b88f5,_0x52863f,_0x58eba9,_0x14fa4a,_0x359acb,_0x46c34e,_0x58fa4a){const _0x230160=_0x5dd9ce;this[_0x230160(0x15c)]=_0x4b2eeb,this['roleEntity']=_0x44dd5b,this['signinEntity']=_0x4ff894,this['clsService']=_0x2b88f5,this['jwtService']=_0x52863f,this[_0x230160(0x231)]=_0x58eba9,this['mailerService']=_0x14fa4a,this[_0x230160(0x1b0)]=_0x359acb,this[_0x230160(0x1ca)]=_0x46c34e,this[_0x230160(0x230)]=_0x58fa4a;}[_0x5dd9ce(0x18f)](_0x19cdd0){const _0x169d40=_0x5dd9ce,{id:_0x24068f,username:_0x139733,role:_0x3b37b8,openId:_0x26a28c,email:_0x5ca708,client:_0x416bf2,saasId:_0x165d2a}=_0x19cdd0;return this[_0x169d40(0x1a0)][_0x169d40(0x16e)]({'id':_0x24068f,'username':_0x139733,'role':_0x3b37b8,'openId':_0x26a28c,'email':_0x5ca708,'client':_0x416bf2,'saasId':_0x165d2a});}async[_0x5dd9ce(0x228)](_0x54007c){const _0x137883=_0x5dd9ce,{username:_0x29330c,password:_0x2b7240}=_0x54007c;if(!_0x29330c||!_0x2b7240)throw new common_1['HttpException'](_0x137883(0x1c6),common_1[_0x137883(0x189)]['BAD_REQUEST']);const _0x4d1621=await this[_0x137883(0x231)][_0x137883(0x177)](_0x29330c);if(!_0x4d1621)throw new common_1[(_0x137883(0x1ab))](_0x137883(0x1c3),common_1[_0x137883(0x189)][_0x137883(0x1af)]);if((0x0,utils_1[_0x137883(0x1b6)])(_0x2b7240,_0x4d1621['password']))throw new common_1['HttpException'](_0x137883(0x1ec),common_1[_0x137883(0x189)][_0x137883(0x1af)]);return this['signToken'](_0x4d1621);}async[_0x5dd9ce(0x1c8)](_0x41c3fe,_0x37ed7d){const _0x160fa9=_0x5dd9ce,_0x2f4233=await this[_0x160fa9(0x230)]['getConfigByKeys']([_0x160fa9(0x1f1),'registerSuccessEmailTeamName',_0x160fa9(0x1fa),'registerFailEmailTitle',_0x160fa9(0x1fe)]);try{const _0x32f0c6=await this[_0x160fa9(0x1ca)][_0x160fa9(0x188)](_0x41c3fe,verification_constant_1['VerificationEnum']['ChangeEmail']),{type:_0x458263,userId:_0x2a0193}=_0x32f0c6;if(_0x458263!==verification_constant_1['VerificationEnum'][_0x160fa9(0x23d)])throw new common_1[(_0x160fa9(0x1ab))](_0x160fa9(0x1ad),common_1[_0x160fa9(0x189)][_0x160fa9(0x1af)]);let _0x401ea3=await this[_0x160fa9(0x15c)][_0x160fa9(0x18b)]({'where':{'id':_0x2a0193}});_0x401ea3[_0x160fa9(0x1e5)]=_0x41c3fe[_0x160fa9(0x1e5)],_0x401ea3=await this[_0x160fa9(0x15c)][_0x160fa9(0x201)](_0x401ea3);const {id:_0x4f2fea,username:_0x1aa1d8,email:_0x3af084}=_0x401ea3;_0x37ed7d[_0x160fa9(0x238)](_0x160fa9(0x15d)+_0x4f2fea[_0x160fa9(0x1ee)]()['padStart'](0x4,'0')+'&username='+_0x1aa1d8+'&email='+_0x3af084+_0x160fa9(0x1cc)+_0x2f4233[_0x160fa9(0x1f1)]+_0x160fa9(0x229)+_0x2f4233['registerSuccessEmailTeamName']+'&registerSuccessEmaileAppend='+_0x2f4233[_0x160fa9(0x1fa)]);}catch(_0x393e33){const _0x136e11=_0x393e33['response'];_0x37ed7d[_0x160fa9(0x238)](_0x160fa9(0x17a)+_0x136e11+_0x160fa9(0x1db)+_0x2f4233[_0x160fa9(0x1a8)]+'&registerFailEmailTeamName='+_0x2f4233['registerFailEmailTeamName']);}}async[_0x5dd9ce(0x1b5)](_0x104f5e){const _0x518386=_0x5dd9ce,_0x318ac8=await this[_0x518386(0x230)]['getNamespace'](),{color:color=_0x518386(0x1dd)}=_0x104f5e,_0x41b2b8=svgCaptcha[_0x518386(0x1a7)]({'background':color,'height':0x22,'width':0x78,'noise':0x3}),_0x315073=_0x41b2b8[_0x518386(0x18a)],_0x56bfb1=(0x0,utils_1[_0x518386(0x1d1)])(),_0x2dcaae=_0x318ac8+':CAPTCHA:'+_0x56bfb1;return await this['redisCacheService'][_0x518386(0x1b8)]({'key':_0x2dcaae,'val':_0x41b2b8[_0x518386(0x18a)]},0x5*0x3c),{'svgCode':_0x41b2b8['data'],'code':_0x56bfb1};}async[_0x5dd9ce(0x1df)](_0x54c15e){const _0x5705be=_0x5dd9ce;_0x54c15e[_0x5705be(0x1e4)]&&await this[_0x5705be(0x1ca)][_0x5705be(0x1f8)](_0x54c15e);const {phone:_0xbff83d}=_0x54c15e,_0x4fc7d7=await this[_0x5705be(0x230)]['getNamespace'](),_0x3f18ff=_0x4fc7d7+_0x5705be(0x1a2)+_0xbff83d,_0x1fd559=await this[_0x5705be(0x1b0)][_0x5705be(0x1c0)](_0x3f18ff);if(_0x1fd559&&_0x1fd559>0x0)throw new common_1['HttpException'](_0x1fd559+_0x5705be(0x163),common_1[_0x5705be(0x189)][_0x5705be(0x1af)]);const _0x1b4a0c=(0x0,utils_1['createRandomCode'])(),_0x84f6b9={'phone':_0xbff83d,'code':_0x1b4a0c};return await this['verificationService'][_0x5705be(0x1df)](_0x84f6b9),await this[_0x5705be(0x1b0)][_0x5705be(0x1b8)]({'key':_0x3f18ff,'val':_0x1b4a0c},0x1*0x3c),'验证码发送成功、请填写验证码完成注册！';}async['sendEmailCode'](_0xfe2523){const _0x1e1c40=_0x5dd9ce;try{var _0x3a1d65=/^[a-zA-Z0-9]+([_.w-]+[a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-.w-]+[a-zA-Z0-9]+)*.[a-zA-Z0-9]+$/;if(!_0x3a1d65[_0x1e1c40(0x172)](_0xfe2523))throw new Error('邮箱格式错误！');const _0x238201=await this[_0x1e1c40(0x15c)][_0x1e1c40(0x18b)]({'where':{'email':_0xfe2523}});if(_0x238201)throw new Error('该邮箱已注册！');const _0x32dff6=await this['globalConfigService'][_0x1e1c40(0x1c5)]([_0x1e1c40(0x220),_0x1e1c40(0x194),_0x1e1c40(0x17b),_0x1e1c40(0x227),'registerVerifyExpir']),_0x196ce3=(0x0,utils_1['createRandomCode'])(),_0x21f46f=_0x32dff6[_0x1e1c40(0x208)]?Number(_0x32dff6['registerVerifyExpir']):0x1e*0x3c;await this[_0x1e1c40(0x1b0)][_0x1e1c40(0x1b8)]({'key':redisKey_constant_1[_0x1e1c40(0x20f)]+_0xfe2523,'val':_0x196ce3},_0x21f46f*0x3c),await this[_0x1e1c40(0x225)][_0x1e1c40(0x193)]({'to':_0xfe2523,'template':'emailVerify','subject':'来自'+_0x32dff6[_0x1e1c40(0x227)]+'的注册验证','context':{'baseUrl':_0x32dff6[_0x1e1c40(0x220)],'code':_0x196ce3,..._0x32dff6}});}catch(_0x53a5fd){throw new common_1['HttpException'](_0x53a5fd[_0x1e1c40(0x187)],common_1['HttpStatus']['BAD_REQUEST']);}}async['getPhoneInMini'](_0x3258d4){const _0x5b5244=_0x5dd9ce;try{const _0x51a2c7=await this['redisCacheService'][_0x5b5244(0x1f4)]({'key':redisKey_constant_1[_0x5b5244(0x1e3)]}),_0x38db11=await axios_1[_0x5b5244(0x1c7)]['post'](_0x5b5244(0x1da)+_0x51a2c7,{'code':_0x3258d4});if(_0x38db11['data'][_0x5b5244(0x184)])throw new Error(_0x38db11[_0x5b5244(0x1d0)][_0x5b5244(0x22a)]);return _0x38db11[_0x5b5244(0x1d0)][_0x5b5244(0x1b4)]['purePhoneNumber'];}catch(_0x7a83a0){common_1[_0x5b5244(0x1fc)][_0x5b5244(0x237)]('getPhoneInMini:\x20',_0x7a83a0);throw new common_1[(_0x5b5244(0x1ab))](_0x7a83a0[_0x5b5244(0x187)],common_1[_0x5b5244(0x189)][_0x5b5244(0x1af)]);}}async[_0x5dd9ce(0x1bd)](_0x33b76e,_0x31174d){const _0x45b77e=_0x5dd9ce,_0x5d4ac4=await this['getPhoneInMini'](_0x33b76e),_0x290747=await this[_0x45b77e(0x15c)][_0x45b77e(0x18b)]({'where':{'phone':_0x5d4ac4}}),_0xd7fb5b=await this[_0x45b77e(0x15c)][_0x45b77e(0x18b)]({'where':{'id':_0x31174d[_0x45b77e(0x1cd)]['id']}});if(_0x290747&&_0xd7fb5b&&_0xd7fb5b['id']!=_0x290747['id'])throw new common_1[(_0x45b77e(0x1ab))]('该手机号已被其他账号绑定',common_1[_0x45b77e(0x189)][_0x45b77e(0x1af)]);if(!_0xd7fb5b)throw new common_1[(_0x45b77e(0x1ab))](_0x45b77e(0x212),common_1[_0x45b77e(0x189)]['BAD_REQUEST']);return _0xd7fb5b[_0x45b77e(0x1a9)]=_0x5d4ac4,await this[_0x45b77e(0x15c)][_0x45b77e(0x201)](_0xd7fb5b),_0x5d4ac4;}async[_0x5dd9ce(0x236)](_0x467f22){const _0x45bdf1=_0x5dd9ce;try{if(!_0x467f22[_0x45bdf1(0x1e0)]&&!_0x467f22[_0x45bdf1(0x1f0)]&&!_0x467f22[_0x45bdf1(0x242)])throw new Error(_0x45bdf1(0x1be));let _0x526ed2=_0x45bdf1(0x1e0),_0x20903d={};if(_0x467f22[_0x45bdf1(0x1e0)])_0x526ed2=_0x45bdf1(0x1e0);else _0x467f22[_0x45bdf1(0x1f0)]?_0x526ed2=_0x45bdf1(0x1f0):_0x526ed2=_0x45bdf1(0x242);_0x20903d[_0x526ed2]=_0x467f22[_0x526ed2];const _0x54db6f=await this[_0x45bdf1(0x15c)][_0x45bdf1(0x18b)]({'where':_0x20903d});if(_0x54db6f&&_0x54db6f[_0x45bdf1(0x1a9)])return![];const _0x1e349b=await this[_0x45bdf1(0x15c)][_0x45bdf1(0x18b)]({'where':{'phone':_0x467f22[_0x45bdf1(0x1a9)]}});if(_0x1e349b)return!_0x1e349b[_0x526ed2];return!![];}catch(_0x4d92e9){throw new common_1[(_0x45bdf1(0x1ab))](_0x4d92e9[_0x45bdf1(0x187)],common_1[_0x45bdf1(0x189)][_0x45bdf1(0x1af)]);}}async[_0x5dd9ce(0x1b1)](_0x17e134,_0x54b3e9){const _0x5a5065=_0x5dd9ce,_0x5d67dd=(0x0,utils_1['getReqSaasId'])(this[_0x5a5065(0x239)]);try{if(!_0x17e134[_0x5a5065(0x1a9)])throw new Error(_0x5a5065(0x21e));if(!_0x17e134['phoneCode'])throw new Error('验证码不能为空！');let _0x1feea5=null;await this[_0x5a5065(0x22c)](_0x17e134['phone'],_0x17e134[_0x5a5065(0x232)]),_0x1feea5=await this['userEntity']['findOne']({'where':{'phone':_0x17e134[_0x5a5065(0x1a9)],'saasId':_0x5d67dd}});if(_0x1feea5)throw new Error(_0x5a5065(0x1ac));const _0x5a4d3f=new user_entity_1[(_0x5a5065(0x1b3))]();for(let _0x153f2f in _0x17e134){_0x17e134[_0x153f2f]&&(_0x5a4d3f[_0x153f2f]=_0x17e134[_0x153f2f]);}_0x5a4d3f[_0x5a5065(0x1fd)]&&(_0x5a4d3f[_0x5a5065(0x1fd)]=bcrypt[_0x5a5065(0x19e)](_0x17e134[_0x5a5065(0x1fd)],0xa));_0x5a4d3f['status']=user_constant_1['UserStatusEnum']['ACTIVE'];!_0x5a4d3f[_0x5a5065(0x183)]&&(_0x5a4d3f[_0x5a5065(0x183)]=_0x5a4d3f[_0x5a5065(0x183)]||'小智');!_0x5a4d3f[_0x5a5065(0x247)]&&(_0x5a4d3f[_0x5a5065(0x247)]=await this[_0x5a5065(0x230)]['getConfigByKeys']([_0x5a5065(0x20d)]));_0x5a4d3f[_0x5a5065(0x216)]=_0x5d67dd;const _0x29bff4=await this[_0x5a5065(0x231)][_0x5a5065(0x1f2)](_0x5a4d3f);this['invitationRewards'](_0x29bff4,_0x17e134['invitedBy']);const _0x42ffa9=(0x0,utils_1[_0x5a5065(0x244)])(_0x54b3e9),_0x3b1179=this[_0x5a5065(0x18f)](_0x29bff4);return await this['userService'][_0x5a5065(0x1e2)](_0x29bff4['id'],_0x42ffa9),await this[_0x5a5065(0x1b0)]['saveToken'](_0x29bff4['id'],_0x3b1179),_0x3b1179;}catch(_0x4db8a7){if(_0x4db8a7 instanceof common_1[_0x5a5065(0x1ab)])throw _0x4db8a7;else throw new common_1[(_0x5a5065(0x1ab))](_0x4db8a7['message'],common_1[_0x5a5065(0x189)][_0x5a5065(0x1af)]);}}async[_0x5dd9ce(0x209)](_0x55cc12){const _0x6bd6bf=_0x5dd9ce;try{const _0x33e218=await this[_0x6bd6bf(0x230)]['getConfigByKeys'](['wechatAccessToken']),{data:_0x21590c}=await axios_1[_0x6bd6bf(0x1c7)][_0x6bd6bf(0x1f4)](_0x6bd6bf(0x16b)+_0x33e218+'&openid='+_0x55cc12+_0x6bd6bf(0x1e6));return console[_0x6bd6bf(0x191)](_0x6bd6bf(0x205),_0x21590c),_0x21590c?.[_0x6bd6bf(0x192)];}catch(_0x1cb394){}return'';}async[_0x5dd9ce(0x196)](_0x49c91d,_0x2ac509){const _0x45cc6d=_0x5dd9ce,_0x13c4ba=(0x0,utils_1[_0x45cc6d(0x1bc)])(this[_0x45cc6d(0x239)]);try{if(_0x49c91d[_0x45cc6d(0x1d7)]){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/['test'](_0x49c91d[_0x45cc6d(0x1d7)]))throw new Error(_0x45cc6d(0x164));if(!_0x49c91d[_0x45cc6d(0x1fd)])throw new Error(_0x45cc6d(0x207));}else{if(!_0x49c91d['openId']&&!_0x49c91d[_0x45cc6d(0x1f0)]&&!_0x49c91d['weAppOpenId']&&!_0x49c91d[_0x45cc6d(0x192)])throw new Error(_0x45cc6d(0x1d8));}if(_0x49c91d[_0x45cc6d(0x1a9)]&&!_0x49c91d[_0x45cc6d(0x232)])throw new Error(_0x45cc6d(0x1ea));let _0x95358c=null;if(_0x49c91d['phone'])await this[_0x45cc6d(0x22c)](_0x49c91d['phone'],_0x49c91d[_0x45cc6d(0x232)]),_0x95358c=await this[_0x45cc6d(0x15c)]['findOne']({'where':{'phone':_0x49c91d[_0x45cc6d(0x1a9)],'saasId':_0x13c4ba}});else{if(_0x49c91d['openId']||_0x49c91d[_0x45cc6d(0x1f0)]||_0x49c91d[_0x45cc6d(0x242)]||_0x49c91d['unionid']){let _0x4eebeb=_0x45cc6d(0x1e0),_0x414fcc={'saasId':_0x13c4ba},_0x3dc48=_0x49c91d[_0x45cc6d(0x192)];!_0x3dc48&&(_0x3dc48=await this[_0x45cc6d(0x209)](_0x49c91d['openId']),_0x49c91d[_0x45cc6d(0x192)]=_0x3dc48);if(_0x3dc48)_0x4eebeb='unionid';else{if(_0x49c91d['openId'])_0x4eebeb='openId';else _0x49c91d[_0x45cc6d(0x1f0)]?_0x4eebeb=_0x45cc6d(0x1f0):_0x4eebeb=_0x45cc6d(0x242);}_0x414fcc[_0x4eebeb]=_0x49c91d[_0x4eebeb],_0x95358c=await this[_0x45cc6d(0x15c)][_0x45cc6d(0x18b)]({'where':_0x414fcc});}else{_0x95358c=await this['userEntity'][_0x45cc6d(0x18b)]({'where':{'username':_0x49c91d[_0x45cc6d(0x1d7)],'saasId':_0x13c4ba}});if(_0x95358c)throw new Error(_0x45cc6d(0x1ac));}}const _0x3601fe=new user_entity_1[(_0x45cc6d(0x1b3))]();for(let _0x25effc in _0x49c91d){_0x49c91d[_0x25effc]&&(_0x3601fe[_0x25effc]=_0x49c91d[_0x25effc]);}_0x95358c?_0x3601fe['id']=_0x95358c['id']:(_0x3601fe[_0x45cc6d(0x1fd)]&&(_0x3601fe[_0x45cc6d(0x1fd)]=bcrypt[_0x45cc6d(0x19e)](_0x49c91d[_0x45cc6d(0x1fd)],0xa)),_0x3601fe[_0x45cc6d(0x1d9)]=user_constant_1[_0x45cc6d(0x1b9)][_0x45cc6d(0x1d5)],!_0x3601fe[_0x45cc6d(0x183)]&&(_0x3601fe[_0x45cc6d(0x183)]=_0x3601fe[_0x45cc6d(0x183)]||'小智'),!_0x3601fe[_0x45cc6d(0x247)]&&(_0x3601fe[_0x45cc6d(0x247)]=await this[_0x45cc6d(0x230)]['getConfigByKeys']([_0x45cc6d(0x20d)])));_0x3601fe[_0x45cc6d(0x216)]=_0x13c4ba;const _0x21931d=await this['userService'][_0x45cc6d(0x1f2)](_0x3601fe);!_0x95358c&&this[_0x45cc6d(0x1d6)](_0x21931d,_0x49c91d['invitedBy']);const _0x3949c1=(0x0,utils_1[_0x45cc6d(0x244)])(_0x2ac509),_0x14c10b=this[_0x45cc6d(0x18f)](_0x21931d);return await this['userService'][_0x45cc6d(0x1e2)](_0x21931d['id'],_0x3949c1),await this[_0x45cc6d(0x1b0)][_0x45cc6d(0x23c)](_0x21931d['id'],_0x14c10b),_0x14c10b;}catch(_0x3edaa9){if(_0x3edaa9 instanceof common_1[_0x45cc6d(0x1ab)])throw _0x3edaa9;else throw new common_1['HttpException'](_0x3edaa9[_0x45cc6d(0x187)],common_1['HttpStatus'][_0x45cc6d(0x1af)]);}}async[_0x5dd9ce(0x1ae)](_0x3a73a2,_0x4eb57a){const _0x33a8ec=_0x5dd9ce,_0x56ccc2=(0x0,utils_1[_0x33a8ec(0x1bc)])(this[_0x33a8ec(0x239)]);await this[_0x33a8ec(0x22c)](_0x3a73a2[_0x33a8ec(0x1a9)],_0x3a73a2[_0x33a8ec(0x232)]);let _0x245b36=await this['userEntity'][_0x33a8ec(0x18b)]({'where':{'phone':_0x3a73a2[_0x33a8ec(0x1a9)],'saasId':_0x56ccc2}});if(!_0x245b36){const _0x42649f=new user_entity_1['UserEntity']();_0x42649f[_0x33a8ec(0x1a9)]=_0x3a73a2[_0x33a8ec(0x1a9)],_0x42649f[_0x33a8ec(0x183)]=_0x3a73a2[_0x33a8ec(0x1a9)],_0x42649f['status']=user_constant_1[_0x33a8ec(0x1b9)][_0x33a8ec(0x1d5)],_0x42649f[_0x33a8ec(0x247)]=await this[_0x33a8ec(0x230)]['getConfigByKeys']([_0x33a8ec(0x20d)]),_0x245b36=await this['userService'][_0x33a8ec(0x1f2)](_0x42649f),this['invitationRewards'](_0x245b36,_0x3a73a2[_0x33a8ec(0x200)]);}const _0x402ee1=(0x0,utils_1[_0x33a8ec(0x244)])(_0x4eb57a),_0x553836=this[_0x33a8ec(0x18f)](_0x245b36);return await this[_0x33a8ec(0x231)][_0x33a8ec(0x1e2)](_0x245b36['id'],_0x402ee1),await this[_0x33a8ec(0x1b0)][_0x33a8ec(0x23c)](_0x245b36['id'],_0x553836),_0x553836;}async['loginV4'](_0x3ed08e,_0x59cb23){const _0x74be15=_0x5dd9ce;try{const _0x3a4a4b=(0x0,utils_1[_0x74be15(0x1bc)])(this[_0x74be15(0x239)]),_0x214445=await this[_0x74be15(0x15c)][_0x74be15(0x18b)]({'where':[{'username':_0x3ed08e[_0x74be15(0x1d7)],'saasId':_0x3a4a4b},{'email':_0x3ed08e['username'],'saasId':_0x3a4a4b},{'phone':_0x3ed08e[_0x74be15(0x1d7)],'saasId':_0x3a4a4b}]});if(!_0x214445)throw new Error(_0x3a4a4b+_0x74be15(0x24a));if(!_0x214445['password'])throw new Error(_0x74be15(0x17d));if(!bcrypt[_0x74be15(0x1aa)](_0x3ed08e[_0x74be15(0x1fd)],_0x214445[_0x74be15(0x1fd)]))throw new Error(_0x74be15(0x18c));_0x214445['username']&&!_0x214445[_0x74be15(0x20c)]&&await this['userService'][_0x74be15(0x15f)](_0x214445);const _0x55cbdd=(0x0,utils_1[_0x74be15(0x244)])(_0x59cb23),_0x5ea2ea=this[_0x74be15(0x18f)](_0x214445);await this[_0x74be15(0x231)][_0x74be15(0x1e2)](_0x214445['id'],_0x55cbdd),await this[_0x74be15(0x1b0)][_0x74be15(0x23c)](_0x214445['id'],_0x5ea2ea);if((0x0,utils_1['shouldAccess'])(_0x214445[_0x74be15(0x235)])){let _0x274bf9;_0x214445[_0x74be15(0x235)]===Role_constant_1[_0x74be15(0x1c9)][_0x74be15(0x1a4)]?_0x274bf9=await this[_0x74be15(0x198)][_0x74be15(0x18b)]({'where':{'code':_0x214445[_0x74be15(0x235)]}}):_0x274bf9=await this[_0x74be15(0x198)][_0x74be15(0x18b)]({'where':{'code':_0x214445[_0x74be15(0x235)],'saasId':_0x3a4a4b}});if(!_0x274bf9)throw new Error(_0x74be15(0x23a));await this[_0x74be15(0x1b0)][_0x74be15(0x1b8)]({'key':_0x74be15(0x182)+_0x214445['id'],'val':_0x274bf9[_0x74be15(0x202)]});}return _0x5ea2ea;}catch(_0x4c21a9){throw new common_1['HttpException'](_0x4c21a9['message'],common_1[_0x74be15(0x189)]['BAD_REQUEST']);}}async['loginInMinigin'](_0x2899d8){const _0x5140c4=_0x5dd9ce;try{const _0x32028a=new Login_vo_1[(_0x5140c4(0x1c7))](),_0x3996f5=(0x0,utils_1['getReqSaasId'])(this[_0x5140c4(0x239)]),_0x20ef83=await axios_1['default'][_0x5140c4(0x1f4)](_0x5140c4(0x1fb),{'params':{'appid':store_1[_0x5140c4(0x21a)][_0x5140c4(0x1d2)],'secret':store_1[_0x5140c4(0x21a)][_0x5140c4(0x173)],'js_code':_0x2899d8,'grant_type':_0x5140c4(0x175)}}),_0x228bfd=_0x20ef83['data'];if(_0x228bfd[_0x5140c4(0x184)])throw new Error(_0x228bfd[_0x5140c4(0x22a)]);let _0x47869f;return _0x228bfd['unionid']&&(_0x47869f=await this[_0x5140c4(0x15c)][_0x5140c4(0x18b)]({'where':{'unionid':_0x228bfd[_0x5140c4(0x192)],'saasId':_0x3996f5}})),!_0x47869f&&(_0x47869f=await this[_0x5140c4(0x15c)][_0x5140c4(0x18b)]({'where':{'miniOpenId':_0x228bfd[_0x5140c4(0x1ef)],'saasId':_0x3996f5}})),!_0x47869f?this[_0x5140c4(0x1b0)][_0x5140c4(0x1b8)]({'key':redisKey_constant_1[_0x5140c4(0x1bf)]+_0x228bfd[_0x5140c4(0x1ef)],'val':_0x228bfd[_0x5140c4(0x192)]||null}):(_0x47869f[_0x5140c4(0x192)]=_0x228bfd[_0x5140c4(0x192)],_0x47869f[_0x5140c4(0x1f0)]=_0x228bfd['openid'],await this[_0x5140c4(0x231)][_0x5140c4(0x211)](_0x47869f['id'],_0x228bfd[_0x5140c4(0x1ef)],_0x228bfd[_0x5140c4(0x192)]),_0x32028a['authToken']=this[_0x5140c4(0x18f)](_0x47869f),await this['redisCacheService'][_0x5140c4(0x23c)](_0x47869f['id'],_0x32028a['authToken'])),_0x32028a[_0x5140c4(0x192)]=_0x228bfd[_0x5140c4(0x192)],_0x32028a[_0x5140c4(0x1ef)]=_0x228bfd[_0x5140c4(0x1ef)],_0x32028a;}catch(_0x12d0a9){common_1['Logger']['error'](_0x5140c4(0x233),_0x12d0a9);throw new common_1[(_0x5140c4(0x1ab))](_0x12d0a9[_0x5140c4(0x187)],common_1[_0x5140c4(0x189)]['BAD_REQUEST']);}}async['loginWithWechatApp'](_0x3c8a74){const _0x1ce201=_0x5dd9ce,_0x2f80e7=new WeAppLogin_vo_1['WeAppLoginVO'](),_0x13c985=(0x0,utils_1[_0x1ce201(0x1bc)])(this[_0x1ce201(0x239)]);try{const _0x51415e=await axios_1[_0x1ce201(0x1c7)][_0x1ce201(0x1f4)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+store_1['WechatConfig']['WE_APP_APPID']+_0x1ce201(0x210)+store_1[_0x1ce201(0x21a)][_0x1ce201(0x1e9)]+'&code='+_0x3c8a74+'&grant_type=authorization_code');if(_0x51415e[_0x1ce201(0x1d0)][_0x1ce201(0x184)])throw new Error(_0x51415e['data'][_0x1ce201(0x22a)]);const _0x45a559=_0x51415e['data'];let _0x30b0ca;return _0x45a559[_0x1ce201(0x192)]&&(_0x30b0ca=await this['userEntity'][_0x1ce201(0x18b)]({'where':{'unionid':_0x45a559[_0x1ce201(0x192)],'saasId':_0x13c985}})),!_0x30b0ca&&(_0x30b0ca=await this[_0x1ce201(0x15c)]['findOne']({'where':{'weAppOpenId':_0x45a559['openid'],'saasId':_0x13c985}})),!_0x30b0ca?this['redisCacheService'][_0x1ce201(0x1b8)]({'key':redisKey_constant_1[_0x1ce201(0x185)]+_0x45a559[_0x1ce201(0x1ef)],'val':_0x45a559['unionid']||null}):(_0x30b0ca[_0x1ce201(0x192)]=_0x45a559[_0x1ce201(0x192)],_0x30b0ca[_0x1ce201(0x242)]=_0x45a559[_0x1ce201(0x1ef)],_0x2f80e7[_0x1ce201(0x20a)]=this[_0x1ce201(0x18f)](_0x30b0ca),await this['redisCacheService'][_0x1ce201(0x23c)](_0x30b0ca['id'],_0x2f80e7[_0x1ce201(0x20a)]),await this[_0x1ce201(0x231)][_0x1ce201(0x18e)](_0x30b0ca['id'],_0x45a559[_0x1ce201(0x1ef)],_0x45a559[_0x1ce201(0x192)])),_0x2f80e7[_0x1ce201(0x1ef)]=_0x45a559[_0x1ce201(0x1ef)],_0x2f80e7['unionid']=_0x45a559[_0x1ce201(0x192)],_0x2f80e7[_0x1ce201(0x17f)]=_0x45a559[_0x1ce201(0x1f5)],_0x2f80e7;}catch(_0x2654f8){common_1['Logger']['error']('loginWithWechatApp:\x20',_0x2654f8);throw new common_1[(_0x1ce201(0x1ab))](_0x2654f8[_0x1ce201(0x187)],common_1[_0x1ce201(0x189)][_0x1ce201(0x1af)]);}}async['activateAccount'](_0x45f927,_0x260a86){const _0x2ad8c7=_0x5dd9ce,_0x2d33cb=await this[_0x2ad8c7(0x230)]['getConfigByKeys']([_0x2ad8c7(0x1f1),_0x2ad8c7(0x174),'registerSuccessEmaileAppend',_0x2ad8c7(0x1a8),_0x2ad8c7(0x1fe)]);try{const _0x1f9666=await this['verificationService'][_0x2ad8c7(0x188)](_0x45f927,verification_constant_1['VerificationEnum']['Registration']),{type:_0x1840b3,userId:_0x3abe6c}=_0x1f9666;if(_0x1840b3!==verification_constant_1[_0x2ad8c7(0x221)][_0x2ad8c7(0x1dc)])throw new common_1[(_0x2ad8c7(0x1ab))](_0x2ad8c7(0x1ad),common_1[_0x2ad8c7(0x189)][_0x2ad8c7(0x1af)]);const _0x1f4aef=await this[_0x2ad8c7(0x231)][_0x2ad8c7(0x1e8)](_0x3abe6c);if(_0x1f4aef===user_constant_1['UserStatusEnum'][_0x2ad8c7(0x1d5)])throw new common_1[(_0x2ad8c7(0x1ab))](_0x2ad8c7(0x178),common_1['HttpStatus'][_0x2ad8c7(0x1af)]);await this[_0x2ad8c7(0x231)][_0x2ad8c7(0x22e)](_0x1f9666[_0x2ad8c7(0x224)],user_constant_1[_0x2ad8c7(0x1b9)][_0x2ad8c7(0x1d5)]);const _0x5682be=await this[_0x2ad8c7(0x231)][_0x2ad8c7(0x249)](_0x1f9666['userId']),{username:_0x5d405e,email:_0x5cd3c3,id:_0x402ed3,invitedBy:_0x45186a}=_0x5682be;let _0x2aceb3;_0x45186a&&(_0x2aceb3=await this[_0x2ad8c7(0x231)][_0x2ad8c7(0x217)](_0x45186a)),await this[_0x2ad8c7(0x231)][_0x2ad8c7(0x1ed)](_0x5682be,_0x2aceb3),_0x260a86[_0x2ad8c7(0x238)](_0x2ad8c7(0x168)+_0x402ed3['toString']()['padStart'](0x4,'0')+_0x2ad8c7(0x19f)+_0x5d405e+_0x2ad8c7(0x1e7)+_0x5cd3c3+_0x2ad8c7(0x1cc)+_0x2d33cb[_0x2ad8c7(0x1f1)]+_0x2ad8c7(0x229)+_0x2d33cb[_0x2ad8c7(0x174)]+_0x2ad8c7(0x245)+_0x2d33cb[_0x2ad8c7(0x1fa)]);}catch(_0x1a78cd){console[_0x2ad8c7(0x191)](_0x2ad8c7(0x19d),_0x1a78cd);const _0xb55757=_0x1a78cd[_0x2ad8c7(0x1ff)];_0x260a86['redirect'](_0x2ad8c7(0x17a)+_0xb55757+'&registerFailEmailTitle='+_0x2d33cb[_0x2ad8c7(0x1a8)]+'&registerFailEmailTeamName='+_0x2d33cb['registerFailEmailTeamName']);}}async['getInfo'](_0x37c213){const _0x8ac9aa=_0x5dd9ce,_0x27babf=await this[_0x8ac9aa(0x231)][_0x8ac9aa(0x1bb)]({'id':_0x37c213['user']['id']});let _0x1a0dcd=![];const _0x24c7c1=(0x0,date_1[_0x8ac9aa(0x1c7)])()[_0x8ac9aa(0x162)](_0x8ac9aa(0x16a)),_0x1dc2dc=await this['signinEntity'][_0x8ac9aa(0x18b)]({'where':{'userId':_0x27babf['id'],'signInDate':_0x24c7c1}});return _0x1dc2dc&&(_0x1a0dcd=!![]),{'userInfo':_0x27babf,'isSignIn':_0x1a0dcd};}async['updatePassword'](_0x262e18,_0x2a9753){const _0xd9d706=_0x5dd9ce,{id:_0x161e27,client:_0x5d21ca}=_0x262e18[_0xd9d706(0x1cd)];if(_0x5d21ca&&Number(_0x5d21ca)>0x0)throw new common_1['HttpException'](_0xd9d706(0x1e1),common_1[_0xd9d706(0x189)]['BAD_REQUEST']);const {oldPassword:_0x3fd6e5,password:_0x5a2c88}=_0x2a9753,_0x42d2ef=await this[_0xd9d706(0x15c)]['findOne']({'where':{'id':_0x161e27}});if(_0x42d2ef[_0xd9d706(0x1fd)]){if(!_0x3fd6e5)throw new common_1['HttpException']('原密码不可为空',common_1[_0xd9d706(0x189)][_0xd9d706(0x1af)]);const _0x3cab06=bcrypt[_0xd9d706(0x1aa)](_0x3fd6e5,_0x42d2ef['password']);if(!_0x3cab06)throw new common_1[(_0xd9d706(0x1ab))](_0xd9d706(0x160),common_1[_0xd9d706(0x189)][_0xd9d706(0x1af)]);}return _0x42d2ef[_0xd9d706(0x1fd)]=bcrypt[_0xd9d706(0x19e)](_0x5a2c88,0xa),await this['userEntity']['save'](_0x42d2ef),'密码修改成功';}async[_0x5dd9ce(0x1cf)](_0x366409,_0x1ed551){const _0x3c1190=_0x5dd9ce,_0x319f45=_0x366409[_0x3c1190(0x1cd)]['id'],_0x4ae361=await this[_0x3c1190(0x15c)][_0x3c1190(0x18b)]({'where':{'email':_0x1ed551['email']}});if(_0x4ae361)throw new common_1[(_0x3c1190(0x1ab))](_0x3c1190(0x165),axios_1['HttpStatusCode']['BadRequest']);const _0x2d9427=await this[_0x3c1190(0x15c)][_0x3c1190(0x18b)]({'where':{'id':_0x319f45}}),_0x4514ce=await this[_0x3c1190(0x230)][_0x3c1190(0x1c5)]([_0x3c1190(0x17e),_0x3c1190(0x220),_0x3c1190(0x194),_0x3c1190(0x17b),'registerVerifyEmailFrom',_0x3c1190(0x208)]);_0x2d9427['email']=_0x1ed551['email'];const _0x384c3c=_0x4514ce['registerVerifyExpir']?Number(_0x4514ce['registerVerifyExpir']):0x1e*0x3c,_0xe854dc=await this['verificationService'][_0x3c1190(0x21c)](_0x2d9427,verification_constant_1[_0x3c1190(0x221)][_0x3c1190(0x23d)],_0x384c3c),{code:_0x3762c8,email:_0x433f97,id:_0x20dbd2}=_0xe854dc,{registerVerifyEmailFrom:_0x42275d}=_0x4514ce;await this[_0x3c1190(0x225)]['sendMail']({'to':_0x433f97,'template':_0x3c1190(0x1c8),'subject':'来自'+_0x42275d+'的邮箱验证','context':{'id':_0x20dbd2,'code':_0x3762c8,'email':_0x433f97,..._0x4514ce,'baseUrl':_0x4514ce[_0x3c1190(0x220)]}});}async['getPhoneStatus'](_0x14e53e){const _0x2a6829=_0x5dd9ce,_0x7cbc89=await this[_0x2a6829(0x15c)][_0x2a6829(0x246)]({'where':{'phone':_0x14e53e}});return _0x7cbc89>0x0;}async[_0x5dd9ce(0x21f)](_0x14085b){const _0x2b83c4=_0x5dd9ce;await this[_0x2b83c4(0x22c)](_0x14085b['phone'],_0x14085b['phoneCode']);if(await this[_0x2b83c4(0x170)](_0x14085b[_0x2b83c4(0x1a9)]))throw new common_1['HttpException'](_0x2b83c4(0x206),common_1[_0x2b83c4(0x189)]['BAD_REQUEST']);return await this[_0x2b83c4(0x15c)]['save']({'id':_0x14085b[_0x2b83c4(0x224)],'phone':_0x14085b[_0x2b83c4(0x1a9)]}),!![];}async[_0x5dd9ce(0x1a1)](){const _0x1da760=_0x5dd9ce;try{const _0x3f80d5=process[_0x1da760(0x204)][_0x1da760(0x195)];if(_0x3f80d5===_0x1da760(0x20b)||_0x3f80d5===_0x1da760(0x169)||_0x3f80d5===_0x1da760(0x1c2)){const _0x3d7686=await axios_1['default'][_0x1da760(0x1f4)]('https://gomaxai.qumao518.vip/api/official/getAccessToken?type=mini');await this[_0x1da760(0x1b0)][_0x1da760(0x1b8)]({'key':redisKey_constant_1[_0x1da760(0x1e3)],'val':_0x3d7686[_0x1da760(0x1d0)][_0x1da760(0x1d0)]});}else{const _0x186709=await axios_1['default'][_0x1da760(0x1ba)](_0x1da760(0x15e),{'grant_type':_0x1da760(0x1f9),'appid':store_1[_0x1da760(0x21a)][_0x1da760(0x1d2)],'secret':store_1[_0x1da760(0x21a)][_0x1da760(0x173)],'force_refresh':![]});await this['redisCacheService'][_0x1da760(0x1b8)]({'key':redisKey_constant_1[_0x1da760(0x1e3)],'val':_0x186709['data'][_0x1da760(0x1f5)]});}}catch(_0xb321da){common_1[_0x1da760(0x1fc)][_0x1da760(0x237)](_0x1da760(0x16d),_0xb321da);}}[_0x5dd9ce(0x176)](_0x19bf0b){const _0x52440b=_0x5dd9ce,_0x425122={'id':_0x19bf0b,'openId':null,'client':null,'role':_0x52440b(0x22b),'username':'游客'+_0x19bf0b,'email':_0x19bf0b+'@nine.com','saasId':(0x0,utils_1[_0x52440b(0x1bc)])(this[_0x52440b(0x239)])};return this['signToken'](_0x425122);}async[_0x5dd9ce(0x197)](_0x1378d2,_0x4a9a07){const _0x1ae68d=_0x5dd9ce,{status:_0xe01ce0}=_0x1378d2;if(_0xe01ce0!==user_constant_1[_0x1ae68d(0x1b9)][_0x1ae68d(0x1d5)])throw new common_1[(_0x1ae68d(0x1ab))](user_constant_1[_0x1ae68d(0x22d)][_0xe01ce0],common_1[_0x1ae68d(0x189)][_0x1ae68d(0x1af)]);const _0x2a50f1=(0x0,utils_1[_0x1ae68d(0x244)])(_0x4a9a07),_0x54b342=this[_0x1ae68d(0x18f)](_0x1378d2);return await this[_0x1ae68d(0x231)]['savaLoginIp'](_0x1378d2['id'],_0x2a50f1),await this['redisCacheService'][_0x1ae68d(0x23c)](_0x1378d2['id'],_0x54b342),_0x54b342;}async[_0x5dd9ce(0x22c)](_0xe90873,_0x2ae559){const _0x47bfe3=_0x5dd9ce,_0x27ce47=await this[_0x47bfe3(0x230)][_0x47bfe3(0x20e)](),_0x284fe8=_0x27ce47+':PHONECODE:'+_0xe90873;if(_0x2ae559===_0x47bfe3(0x1de))return;const _0x1a0f5a=await this['redisCacheService'][_0x47bfe3(0x1f4)]({'key':_0x284fe8});if(!_0x1a0f5a)throw new common_1['HttpException'](_0x47bfe3(0x1c1),common_1[_0x47bfe3(0x189)][_0x47bfe3(0x1af)]);if(_0x2ae559!==_0x1a0f5a)throw new common_1[(_0x47bfe3(0x1ab))](_0x47bfe3(0x186),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x5dd9ce(0x1d6)](_0xaeff19,_0x4d6b09){const _0x29f982=_0x5dd9ce;let _0x109982;_0x4d6b09&&(_0x109982=await this['userService']['qureyUserInfoByInviteCode'](_0x4d6b09)),await this['userService'][_0x29f982(0x1ed)](_0xaeff19,_0x109982);}async[_0x5dd9ce(0x1f3)](_0x599855,_0x3f5c37,_0x230f0d){const _0xdedffd=_0x5dd9ce;await this[_0xdedffd(0x22c)](_0x599855,_0x3f5c37);const _0x5b1388=await this[_0xdedffd(0x15c)][_0xdedffd(0x18b)]({'where':{'id':_0x230f0d[_0xdedffd(0x1cd)]['id']}});if(_0x5b1388['phone']!==_0x599855)throw new common_1[(_0xdedffd(0x1ab))](_0xdedffd(0x19c),common_1['HttpStatus']['BAD_REQUEST']);return!![];}};function _0xb559(){const _0x7b8414=['UserService','/api/auth/registerSuccess?id=','ceshi.qumao518.vip','YYYY-MM-DD','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20https://api.weixin.qq.com/cgi-bin/user/info?access_token=','SigninEntity','wechat\x20获取access_token\x20失败：','sign','RedisCacheService','getPhoneStatus','metadata','test','WE_MINI_APPSECRET','registerSuccessEmailTeamName','authorization_code','createTokenFromFingerprint','getOne','账户已被激活过','207mlmpaB','/api/auth/registerError?message=','registerVerifyEmailDesc','Repository','密码错误','isVerifyEmail','accessToken','length','typeorm','access:','nickname','errcode','WE_APP_TEMP_USER','验证码填写错误、请重新输入！','message','verifyCode','HttpStatus','text','findOne','密码错误！','GlobalConfigService','updateUserAppOpenId','signToken','VerificationService','log','unionid','sendMail','registerVerifyEmailTitle','GOMAXAI_HOST','registeV3','getJwtToken','roleEntity','2703835kxUPWa','255226oaEjIO','../../common/utils/date','手机号错误！','error:\x20','hashSync','&username=','jwtService','renewMiniAccessToken',':PHONECODE:','5451783IDwTtd','AGENT','2447291HXzKxc','__esModule','createMathExpr','registerFailEmailTitle','phone','compareSync','HttpException','当前用户已注册，请勿重复注册！','验证码类型错误','loginByPhoneV3','BAD_REQUEST','redisCacheService','registeByPhone','__decorate','UserEntity','phone_info','captcha','comparePassword','2888310GwHjva','set','UserStatusEnum','post','queryOne','getReqSaasId','bindPhoneInMini','openId、miniOpenId、weAppOpenId中必须存在一个','WE_MINI_TEMP_USER','ttl','验证码已过期、请重新发送！','saas.qumao518.vip','账户不存在，请联系管理员或注册','axios','getConfigByKeys','账号密码或密码错误','default','changeEmail','ERole','verificationService','function','&registerSuccessEmailTitle=','user','Injectable','updateEmail','data','createRandomUid','WE_MiNI_APPID','nestjs-cls','svg-captcha','ACTIVE','invitationRewards','username','参数错误！','status','https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=','&registerFailEmailTitle=','Registration','#fff','000000','sendPhoneCode','openId','无权此操作、请联系管理员！','savaLoginIp','WE_MINI_ACCESS_KEY','captchaId','email','&lang=zh_CN','&email=','getUserStatus','WE_APP_APPSECRET','验证码不能为空！','../globalConfig/globalConfig.service','用户名或密码错误','changeScore4registe','toString','openid','miniOpenId','registerSuccessEmailTitle','createUser','checkUserOriginalPhone','get','access_token','AuthService','object','verifyCaptcha','client_credential','registerSuccessEmaileAppend','https://api.weixin.qq.com/sns/jscode2session','Logger','password','registerFailEmailTeamName','response','invitedBy','save','accessLabel','../../common/constants/Role.constant','env','获取微信用户信息','当前手机号已绑定其他账户！','账号注册时密码不能为空！','registerVerifyExpir','getUnionId','authToken','kaifa.qumao518.vip','lastLoginIp','userDefautlAvatar','getNamespace','EMAIL_REGISTE','&secret=','updateUserMiniOpenId','Error','../../common/constants/user.constant','decorate','44FVlUWS','saasId','qureyUserInfoByInviteCode','../../common/utils','JwtService','WechatConfig','@nestjs/jwt','createVerification','../redisCache/redisCache.service','手机号不能为空','bindPhone','registerBaseUrl','VerificationEnum','6QLIFzo','RoleEntity','userId','mailerService','../../common/constants/verification.constant','registerVerifyEmailFrom','loginByAdmin','&registerSuccessEmailTeamName=','errmsg','visitor','validatePhoneCode','UserStatusErrMsg','updateUserStatus','../../common/constants/redisKey.constant','globalConfigService','userService','phoneCode','loginInMinigin:\x20','defineProperty','role','phoneWithOpenId4regist','error','redirect','clsService','角色信息异常！','../mailer/mailer.service','saveToken','ChangeEmail','bcryptjs','../user/user.service','430544nXvurl','1727141CKXrgz','weAppOpenId','4gQgpNx','getClientIp','&registerSuccessEmaileAppend=','count','avatar','InjectRepository','queryUserInfoById','用户不存在','userEntity','/api/auth/changeEmailSuccess?id=','https://api.weixin.qq.com/cgi-bin/stable_token','userInitVip','旧密码错误、请检查提交','__metadata','format','秒内不得重复发送短信！','用户名格式错误！','邮箱已被其他用户使用','MailerService'];_0xb559=function(){return _0x7b8414;};return _0xb559();}AuthService=__decorate([(0x0,common_1[_0x5dd9ce(0x1ce)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x5dd9ce(0x1b3)])),__param(0x1,(0x0,typeorm_1[_0x5dd9ce(0x248)])(role_entity_1[_0x5dd9ce(0x223)])),__param(0x2,(0x0,typeorm_1[_0x5dd9ce(0x248)])(signIn_entity_1[_0x5dd9ce(0x16c)])),__metadata('design:paramtypes',[typeorm_2[_0x5dd9ce(0x17c)],typeorm_2[_0x5dd9ce(0x17c)],typeorm_2['Repository'],nestjs_cls_1['ClsService'],jwt_1[_0x5dd9ce(0x219)],user_service_1[_0x5dd9ce(0x167)],mailer_service_1[_0x5dd9ce(0x166)],redisCache_service_1[_0x5dd9ce(0x16f)],verification_service_1[_0x5dd9ce(0x190)],globalConfig_service_1[_0x5dd9ce(0x18d)]])],AuthService),exports[_0x5dd9ce(0x1f6)]=AuthService;