'use strict';const _0x3d5a4e=_0x33b5;(function(_0x5b3409,_0x4ce97e){const _0x175125=_0x33b5,_0x4d7364=_0x5b3409();while(!![]){try{const _0x3e0234=parseInt(_0x175125(0x255))/0x1*(parseInt(_0x175125(0x285))/0x2)+-parseInt(_0x175125(0x2ba))/0x3*(-parseInt(_0x175125(0x2a0))/0x4)+parseInt(_0x175125(0x28e))/0x5+-parseInt(_0x175125(0x20f))/0x6*(parseInt(_0x175125(0x2cd))/0x7)+parseInt(_0x175125(0x239))/0x8+parseInt(_0x175125(0x2a7))/0x9*(-parseInt(_0x175125(0x2b6))/0xa)+-parseInt(_0x175125(0x1f8))/0xb;if(_0x3e0234===_0x4ce97e)break;else _0x4d7364['push'](_0x4d7364['shift']());}catch(_0x4ee1f0){_0x4d7364['push'](_0x4d7364['shift']());}}}(_0x4951,0xd3bed));var __decorate=this&&this[_0x3d5a4e(0x27f)]||function(_0x462956,_0x20cffe,_0x4a5f11,_0x1868df){const _0x442f5c=_0x3d5a4e;var _0x137e5f=arguments[_0x442f5c(0x216)],_0x3d70f0=_0x137e5f<0x3?_0x20cffe:_0x1868df===null?_0x1868df=Object[_0x442f5c(0x231)](_0x20cffe,_0x4a5f11):_0x1868df,_0x309879;if(typeof Reflect===_0x442f5c(0x21d)&&typeof Reflect[_0x442f5c(0x298)]===_0x442f5c(0x238))_0x3d70f0=Reflect[_0x442f5c(0x298)](_0x462956,_0x20cffe,_0x4a5f11,_0x1868df);else{for(var _0x304318=_0x462956[_0x442f5c(0x216)]-0x1;_0x304318>=0x0;_0x304318--)if(_0x309879=_0x462956[_0x304318])_0x3d70f0=(_0x137e5f<0x3?_0x309879(_0x3d70f0):_0x137e5f>0x3?_0x309879(_0x20cffe,_0x4a5f11,_0x3d70f0):_0x309879(_0x20cffe,_0x4a5f11))||_0x3d70f0;}return _0x137e5f>0x3&&_0x3d70f0&&Object['defineProperty'](_0x20cffe,_0x4a5f11,_0x3d70f0),_0x3d70f0;},__metadata=this&&this[_0x3d5a4e(0x22d)]||function(_0x16eb31,_0x12a7b2){const _0x4dc894=_0x3d5a4e;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x4dc894(0x238))return Reflect['metadata'](_0x16eb31,_0x12a7b2);},__param=this&&this[_0x3d5a4e(0x2bc)]||function(_0x13c924,_0x113bcd){return function(_0x1fdf3e,_0x3d2df6){_0x113bcd(_0x1fdf3e,_0x3d2df6,_0x13c924);};};Object[_0x3d5a4e(0x280)](exports,_0x3d5a4e(0x244),{'value':!![]}),exports[_0x3d5a4e(0x270)]=void 0x0;function _0x4951(){const _0x7acf8=['EMAIL_REGISTE','email','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20https://api.weixin.qq.com/cgi-bin/user/info?access_token=','该邮箱已注册！','ceshi.qumao518.vip','ChangeEmail','getPhoneInMini:\x20','saveToken','邮箱已被其他用户使用','weAppOpenId','sendPhoneCode','authToken','count','error','../redisCache/redisCache.service','message','58737fgbVLm','loginByPhoneV3','updateUserAppOpenId','checkUserOriginalPhone','queryOne','save','验证码不能为空！','验证码已过期、请重新发送！','userService','getPhoneStatus','wechatAccessToken','/api/auth/changeEmailSuccess?id=','userDefautlAvatar','../../common/constants/verification.constant','Injectable','Logger','redisCacheService','openId、miniOpenId、weAppOpenId中必须存在一个','getInfo','createRandomCode','账号注册时密码不能为空！','wechat\x20获取access_token\x20失败：','roleEntity','UserStatusEnum','ttl','13583361WXWRDa','error:\x20','createUser','HttpStatusCode','&secret=','getUnionId','registerSuccessEmailTeamName','秒内不得重复发送短信！','text','/api/auth/registerSuccess?id=','nickname','ClsService','compareSync','openId','000000','captcha','set','errmsg','getPhoneInMini','password','WE_APP_APPID','registerBaseUrl','HttpStatus','6GvndPN','SigninEntity','/api/auth/registerError?message=','createTokenFromFingerprint','GOMAXAI_HOST','手机号不能为空','WeAppLoginVO','length','HttpException','loginWithWechatApp','clsService','jwtService','phone','queryUserInfoById','object','密码修改成功','ACTIVE','shouldAccess','access_token','userEntity','env','changeScore4registe','redirect','client_credential','openid','registerFailEmailTeamName','Error','&openid=','../../common/constants/user.constant','bcryptjs','__metadata','errcode','signToken','signinEntity','getOwnPropertyDescriptor','BadRequest','registerSuccessEmailTitle','getReqSaasId','@nestjs/typeorm','verificationService','axios','function','2295816qlGQbq','post','&registerSuccessEmailTitle=','VerificationService','purePhoneNumber','账户不存在，请联系管理员或注册','../signin/signIn.entity','registerFailEmailTitle','&registerSuccessEmailTeamName=','的邮箱验证','参数错误！','__esModule','VerificationEnum','username','verifyCode','registeByPhone','isVerifyEmail','&username=','kaifa.qumao518.vip','&code=','原密码不可为空','nestjs-cls','avatar','该手机号已被其他账号绑定','registeV3','validatePhoneCode','registerSuccessEmaileAppend','WE_MINI_APPSECRET','144023hkBpDF','邮箱格式错误！','updatePassword','role','invitationRewards','invitedBy','../globalConfig/globalConfig.service','密码错误！','emailVerify','comparePassword','../../common/constants/Role.constant','globalConfigService','#fff','saasId','../../common/constants/redisKey.constant','账号密码或密码错误','findOne',':PHONECODE:','loginWithWechatApp:\x20','visitor','unionid','旧密码错误、请检查提交','用户名格式错误！','GlobalConfigService','InjectRepository','WE_MINI_ACCESS_KEY','userInitVip','AuthService','验证码类型错误','data','accessToken','updateUserMiniOpenId',':CAPTCHA:','get','typeorm','accessLabel','当前用户已注册，请勿重复注册！','Repository','padStart','./../user/user.entity','loginByAdmin','log','__decorate','defineProperty','&email=','loginInMinigin','UserEntity','registerVerifyEmailFrom','20ggdsgZ','default','&registerFailEmailTitle=','getNamespace','https://api.weixin.qq.com/cgi-bin/stable_token','&lang=zh_CN','sign','UserService','ERole','8122505qwCkBY','密码错误','&registerFailEmailTeamName=','&grant_type=authorization_code','saas.qumao518.vip','WE_MiNI_APPID','../mailer/mailer.service','&registerSuccessEmaileAppend=','user','userId','decorate','sendEmailCode','RedisCacheService','registerVerifyEmailDesc','@nestjs/jwt','phoneCode','miniOpenId','用户名或密码错误','134588dhyCpW','renewMiniAccessToken','status','registerVerifyEmailTitle','getClientIp','MailerService','getConfigByKeys','14589abSAZi','./../verification/verification.service','hashSync','response','WechatConfig','design:paramtypes','registerVerifyExpir','https://api.weixin.qq.com/sns/jscode2session','BAD_REQUEST','当前手机号已绑定其他账户！','qureyUserInfoByInviteCode','Registration','phoneWithOpenId4regist','mailerService','./vo/WeAppLogin.vo','9940QbwqUk','savaLoginIp','toString','changeEmail','33UEiHXq','format','__param'];_0x4951=function(){return _0x7acf8;};return _0x4951();}const globalConfig_service_1=require(_0x3d5a4e(0x25b)),verification_constant_1=require(_0x3d5a4e(0x1ec)),verification_service_1=require(_0x3d5a4e(0x2a8)),user_entity_1=require(_0x3d5a4e(0x27c)),common_1=require('@nestjs/common'),jwt_1=require(_0x3d5a4e(0x29c)),user_service_1=require('../user/user.service'),mailer_service_1=require(_0x3d5a4e(0x294)),user_constant_1=require(_0x3d5a4e(0x22b)),utils_1=require('../../common/utils'),redisCache_service_1=require(_0x3d5a4e(0x2cb)),svgCaptcha=require('svg-captcha'),bcrypt=require(_0x3d5a4e(0x22c)),store_1=require('../../common/store'),axios_1=require(_0x3d5a4e(0x237)),redisKey_constant_1=require(_0x3d5a4e(0x263)),Login_vo_1=require('./vo/Login.vo'),WeAppLogin_vo_1=require(_0x3d5a4e(0x2b5)),typeorm_1=require(_0x3d5a4e(0x235)),typeorm_2=require(_0x3d5a4e(0x277)),nestjs_cls_1=require(_0x3d5a4e(0x24e)),role_entity_1=require('../user/role.entity'),Role_constant_1=require(_0x3d5a4e(0x25f)),signIn_entity_1=require(_0x3d5a4e(0x23f)),date_1=require('../../common/utils/date');let AuthService=class AuthService{constructor(_0x3406f4,_0x5999db,_0x5b0350,_0x2367be,_0x53503c,_0x5d6ca8,_0x4a1397,_0x1cf6d8,_0x21bdc7,_0x3fb041){const _0x8f7797=_0x3d5a4e;this[_0x8f7797(0x222)]=_0x3406f4,this[_0x8f7797(0x1f5)]=_0x5999db,this[_0x8f7797(0x230)]=_0x5b0350,this[_0x8f7797(0x219)]=_0x2367be,this[_0x8f7797(0x21a)]=_0x53503c,this[_0x8f7797(0x1e7)]=_0x5d6ca8,this[_0x8f7797(0x2b4)]=_0x4a1397,this[_0x8f7797(0x1ef)]=_0x1cf6d8,this[_0x8f7797(0x236)]=_0x21bdc7,this['globalConfigService']=_0x3fb041;}[_0x3d5a4e(0x22f)](_0x4745e8){const _0x40e300=_0x3d5a4e,{id:_0x4c572a,username:_0x41c33d,role:_0x26f0b6,openId:_0x36f17b,email:_0x49fe32,client:_0x306ebf,saasId:_0x1d0eb1}=_0x4745e8;return this[_0x40e300(0x21a)][_0x40e300(0x28b)]({'id':_0x4c572a,'username':_0x41c33d,'role':_0x26f0b6,'openId':_0x36f17b,'email':_0x49fe32,'client':_0x306ebf,'saasId':_0x1d0eb1});}async[_0x3d5a4e(0x27d)](_0x4a2126){const _0x5ba683=_0x3d5a4e,{username:_0x701f4f,password:_0x33d887}=_0x4a2126;if(!_0x701f4f||!_0x33d887)throw new common_1['HttpException'](_0x5ba683(0x264),common_1['HttpStatus'][_0x5ba683(0x2af)]);const _0x4c609d=await this[_0x5ba683(0x1e7)]['getOne'](_0x701f4f);if(!_0x4c609d)throw new common_1[(_0x5ba683(0x217))](_0x5ba683(0x23e),common_1[_0x5ba683(0x20e)][_0x5ba683(0x2af)]);if((0x0,utils_1[_0x5ba683(0x25e)])(_0x33d887,_0x4c609d[_0x5ba683(0x20b)]))throw new common_1[(_0x5ba683(0x217))](_0x5ba683(0x29f),common_1[_0x5ba683(0x20e)][_0x5ba683(0x2af)]);return this[_0x5ba683(0x22f)](_0x4c609d);}async[_0x3d5a4e(0x2b9)](_0x301b12,_0x593cb1){const _0x272db2=_0x3d5a4e,_0x2fc541=await this[_0x272db2(0x260)][_0x272db2(0x2a6)]([_0x272db2(0x233),_0x272db2(0x1fe),_0x272db2(0x253),'registerFailEmailTitle','registerFailEmailTeamName']);try{const _0x130274=await this['verificationService'][_0x272db2(0x247)](_0x301b12,verification_constant_1[_0x272db2(0x245)][_0x272db2(0x2c2)]),{type:_0x161315,userId:_0x450e67}=_0x130274;if(_0x161315!==verification_constant_1['VerificationEnum'][_0x272db2(0x2c2)])throw new common_1['HttpException'](_0x272db2(0x271),common_1[_0x272db2(0x20e)][_0x272db2(0x2af)]);let _0x5368b6=await this['userEntity']['findOne']({'where':{'id':_0x450e67}});_0x5368b6['email']=_0x301b12[_0x272db2(0x2be)],_0x5368b6=await this['userEntity'][_0x272db2(0x1e4)](_0x5368b6);const {id:_0x27f6cc,username:_0x3d112b,email:_0x563d73}=_0x5368b6;_0x593cb1['redirect'](_0x272db2(0x1ea)+_0x27f6cc[_0x272db2(0x2b8)]()[_0x272db2(0x27b)](0x4,'0')+_0x272db2(0x24a)+_0x3d112b+_0x272db2(0x281)+_0x563d73+_0x272db2(0x23b)+_0x2fc541[_0x272db2(0x233)]+_0x272db2(0x241)+_0x2fc541['registerSuccessEmailTeamName']+_0x272db2(0x295)+_0x2fc541[_0x272db2(0x253)]);}catch(_0x7c3f5d){const _0x4e3c7d=_0x7c3f5d[_0x272db2(0x2aa)];_0x593cb1[_0x272db2(0x225)]('/api/auth/registerError?message='+_0x4e3c7d+'&registerFailEmailTitle='+_0x2fc541['registerFailEmailTitle']+_0x272db2(0x290)+_0x2fc541[_0x272db2(0x228)]);}}async[_0x3d5a4e(0x207)](_0x3890f6){const _0x5acc56=_0x3d5a4e,_0x21467f=await this[_0x5acc56(0x260)][_0x5acc56(0x288)](),{color:color=_0x5acc56(0x261)}=_0x3890f6,_0xe09691=svgCaptcha['createMathExpr']({'background':color,'height':0x22,'width':0x78,'noise':0x3}),_0x23699c=_0xe09691[_0x5acc56(0x200)],_0x26ee05=(0x0,utils_1['createRandomUid'])(),_0x16f20d=_0x21467f+_0x5acc56(0x275)+_0x26ee05;return await this[_0x5acc56(0x1ef)][_0x5acc56(0x208)]({'key':_0x16f20d,'val':_0xe09691[_0x5acc56(0x200)]},0x5*0x3c),{'svgCode':_0xe09691['data'],'code':_0x26ee05};}async[_0x3d5a4e(0x2c7)](_0x11047){const _0x745485=_0x3d5a4e;_0x11047['captchaId']&&await this[_0x745485(0x236)]['verifyCaptcha'](_0x11047);const {phone:_0x256870}=_0x11047,_0x110fbd=await this['globalConfigService'][_0x745485(0x288)](),_0x2d97da=_0x110fbd+_0x745485(0x266)+_0x256870,_0x413ed6=await this[_0x745485(0x1ef)][_0x745485(0x1f7)](_0x2d97da);if(_0x413ed6&&_0x413ed6>0x0)throw new common_1[(_0x745485(0x217))](_0x413ed6+_0x745485(0x1ff),common_1[_0x745485(0x20e)][_0x745485(0x2af)]);const _0xb3b873=(0x0,utils_1['createRandomCode'])(),_0x36a8d1={'phone':_0x256870,'code':_0xb3b873};return await this['verificationService'][_0x745485(0x2c7)](_0x36a8d1),await this[_0x745485(0x1ef)][_0x745485(0x208)]({'key':_0x2d97da,'val':_0xb3b873},0x1*0x3c),'验证码发送成功、请填写验证码完成注册！';}async[_0x3d5a4e(0x299)](_0x2b2c31){const _0x38742a=_0x3d5a4e;try{var _0x33e213=/^[a-zA-Z0-9]+([_.w-]+[a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-.w-]+[a-zA-Z0-9]+)*.[a-zA-Z0-9]+$/;if(!_0x33e213['test'](_0x2b2c31))throw new Error(_0x38742a(0x256));const _0x58194e=await this[_0x38742a(0x222)]['findOne']({'where':{'email':_0x2b2c31}});if(_0x58194e)throw new Error(_0x38742a(0x2c0));const _0x88ce1c=await this[_0x38742a(0x260)][_0x38742a(0x2a6)]([_0x38742a(0x20d),_0x38742a(0x2a3),_0x38742a(0x29b),_0x38742a(0x284),_0x38742a(0x2ad)]),_0x3d2381=(0x0,utils_1[_0x38742a(0x1f2)])(),_0x27fac8=_0x88ce1c[_0x38742a(0x2ad)]?Number(_0x88ce1c[_0x38742a(0x2ad)]):0x1e*0x3c;await this['redisCacheService'][_0x38742a(0x208)]({'key':redisKey_constant_1[_0x38742a(0x2bd)]+_0x2b2c31,'val':_0x3d2381},_0x27fac8*0x3c),await this[_0x38742a(0x2b4)]['sendMail']({'to':_0x2b2c31,'template':_0x38742a(0x25d),'subject':'来自'+_0x88ce1c[_0x38742a(0x284)]+'的注册验证','context':{'baseUrl':_0x88ce1c[_0x38742a(0x20d)],'code':_0x3d2381,..._0x88ce1c}});}catch(_0x37d39f){throw new common_1['HttpException'](_0x37d39f[_0x38742a(0x2cc)],common_1[_0x38742a(0x20e)][_0x38742a(0x2af)]);}}async['getPhoneInMini'](_0x25bfa2){const _0x379e87=_0x3d5a4e;try{const _0x298ea1=await this[_0x379e87(0x1ef)]['get']({'key':redisKey_constant_1[_0x379e87(0x26e)]}),_0x25f116=await axios_1[_0x379e87(0x286)][_0x379e87(0x23a)]('https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token='+_0x298ea1,{'code':_0x25bfa2});if(_0x25f116[_0x379e87(0x272)][_0x379e87(0x22e)])throw new Error(_0x25f116[_0x379e87(0x272)][_0x379e87(0x209)]);return _0x25f116[_0x379e87(0x272)]['phone_info'][_0x379e87(0x23d)];}catch(_0x340bf5){common_1[_0x379e87(0x1ee)][_0x379e87(0x2ca)](_0x379e87(0x2c3),_0x340bf5);throw new common_1['HttpException'](_0x340bf5[_0x379e87(0x2cc)],common_1[_0x379e87(0x20e)][_0x379e87(0x2af)]);}}async['bindPhoneInMini'](_0x32adfa,_0x2a21a4){const _0x1d1b64=_0x3d5a4e,_0x58ad94=await this[_0x1d1b64(0x20a)](_0x32adfa),_0x4ffee3=await this[_0x1d1b64(0x222)][_0x1d1b64(0x265)]({'where':{'phone':_0x58ad94}}),_0x1bd400=await this[_0x1d1b64(0x222)][_0x1d1b64(0x265)]({'where':{'id':_0x2a21a4[_0x1d1b64(0x296)]['id']}});if(_0x4ffee3&&_0x1bd400&&_0x1bd400['id']!=_0x4ffee3['id'])throw new common_1['HttpException'](_0x1d1b64(0x250),common_1['HttpStatus'][_0x1d1b64(0x2af)]);if(!_0x1bd400)throw new common_1[(_0x1d1b64(0x217))](_0x1d1b64(0x229),common_1[_0x1d1b64(0x20e)][_0x1d1b64(0x2af)]);return _0x1bd400[_0x1d1b64(0x21b)]=_0x58ad94,await this['userEntity'][_0x1d1b64(0x1e4)](_0x1bd400),_0x58ad94;}async[_0x3d5a4e(0x2b3)](_0x1ce426){const _0x121054=_0x3d5a4e;try{if(!_0x1ce426['openId']&&!_0x1ce426[_0x121054(0x29e)]&&!_0x1ce426[_0x121054(0x2c6)])throw new Error(_0x121054(0x1f0));let _0x24d79d='openId',_0x3c530b={};if(_0x1ce426[_0x121054(0x205)])_0x24d79d='openId';else _0x1ce426[_0x121054(0x29e)]?_0x24d79d=_0x121054(0x29e):_0x24d79d=_0x121054(0x2c6);_0x3c530b[_0x24d79d]=_0x1ce426[_0x24d79d];const _0x464daf=await this[_0x121054(0x222)][_0x121054(0x265)]({'where':_0x3c530b});if(_0x464daf&&_0x464daf[_0x121054(0x21b)])return![];const _0x45874a=await this[_0x121054(0x222)][_0x121054(0x265)]({'where':{'phone':_0x1ce426['phone']}});if(_0x45874a)return!_0x45874a[_0x24d79d];return!![];}catch(_0x309923){throw new common_1[(_0x121054(0x217))](_0x309923[_0x121054(0x2cc)],common_1[_0x121054(0x20e)]['BAD_REQUEST']);}}async[_0x3d5a4e(0x248)](_0x382892,_0x1e6eef){const _0x1314f8=_0x3d5a4e,_0x3c4813=(0x0,utils_1[_0x1314f8(0x234)])(this[_0x1314f8(0x219)]);try{if(!_0x382892[_0x1314f8(0x21b)])throw new Error(_0x1314f8(0x214));if(!_0x382892[_0x1314f8(0x29d)])throw new Error(_0x1314f8(0x1e5));let _0x3c2af9=null;await this[_0x1314f8(0x252)](_0x382892[_0x1314f8(0x21b)],_0x382892['phoneCode']),_0x3c2af9=await this[_0x1314f8(0x222)][_0x1314f8(0x265)]({'where':{'phone':_0x382892[_0x1314f8(0x21b)],'saasId':_0x3c4813}});if(_0x3c2af9)throw new Error(_0x1314f8(0x279));const _0x7503f7=new user_entity_1['UserEntity']();for(let _0x47aee6 in _0x382892){_0x382892[_0x47aee6]&&(_0x7503f7[_0x47aee6]=_0x382892[_0x47aee6]);}_0x7503f7[_0x1314f8(0x20b)]&&(_0x7503f7['password']=bcrypt[_0x1314f8(0x2a9)](_0x382892[_0x1314f8(0x20b)],0xa));_0x7503f7[_0x1314f8(0x2a2)]=user_constant_1[_0x1314f8(0x1f6)]['ACTIVE'];!_0x7503f7[_0x1314f8(0x202)]&&(_0x7503f7[_0x1314f8(0x202)]=_0x7503f7[_0x1314f8(0x202)]||'小智');!_0x7503f7[_0x1314f8(0x24f)]&&(_0x7503f7[_0x1314f8(0x24f)]=await this[_0x1314f8(0x260)][_0x1314f8(0x2a6)]([_0x1314f8(0x1eb)]));_0x7503f7[_0x1314f8(0x262)]=_0x3c4813;const _0x5e038b=await this[_0x1314f8(0x1e7)][_0x1314f8(0x1fa)](_0x7503f7);this['invitationRewards'](_0x5e038b,_0x382892[_0x1314f8(0x25a)]);const _0x24d919=(0x0,utils_1['getClientIp'])(_0x1e6eef),_0x443744=this[_0x1314f8(0x22f)](_0x5e038b);return await this['userService'][_0x1314f8(0x2b7)](_0x5e038b['id'],_0x24d919),await this[_0x1314f8(0x1ef)][_0x1314f8(0x2c4)](_0x5e038b['id'],_0x443744),_0x443744;}catch(_0x4b0264){if(_0x4b0264 instanceof common_1['HttpException'])throw _0x4b0264;else throw new common_1[(_0x1314f8(0x217))](_0x4b0264[_0x1314f8(0x2cc)],common_1[_0x1314f8(0x20e)]['BAD_REQUEST']);}}async['getUnionId'](_0x32ce4b){const _0x3993f4=_0x3d5a4e;try{const _0x19c684=await this[_0x3993f4(0x260)][_0x3993f4(0x2a6)]([_0x3993f4(0x1e9)]),{data:_0x585983}=await axios_1[_0x3993f4(0x286)][_0x3993f4(0x276)](_0x3993f4(0x2bf)+_0x19c684+_0x3993f4(0x22a)+_0x32ce4b+_0x3993f4(0x28a));return console[_0x3993f4(0x27e)]('获取微信用户信息',_0x585983),_0x585983?.[_0x3993f4(0x269)];}catch(_0x4a12c8){}return'';}async[_0x3d5a4e(0x251)](_0xe153f2,_0x59bd87){const _0x500118=_0x3d5a4e,_0x71264c=(0x0,utils_1[_0x500118(0x234)])(this[_0x500118(0x219)]);try{if(_0xe153f2['username']){if(!/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]+$/['test'](_0xe153f2[_0x500118(0x246)]))throw new Error(_0x500118(0x26b));if(!_0xe153f2[_0x500118(0x20b)])throw new Error(_0x500118(0x1f3));}else{if(!_0xe153f2[_0x500118(0x205)]&&!_0xe153f2[_0x500118(0x29e)]&&!_0xe153f2[_0x500118(0x2c6)]&&!_0xe153f2['unionid'])throw new Error(_0x500118(0x243));}if(_0xe153f2[_0x500118(0x21b)]&&!_0xe153f2[_0x500118(0x29d)])throw new Error(_0x500118(0x1e5));let _0x373438=null;if(_0xe153f2['phone'])await this[_0x500118(0x252)](_0xe153f2[_0x500118(0x21b)],_0xe153f2[_0x500118(0x29d)]),_0x373438=await this[_0x500118(0x222)][_0x500118(0x265)]({'where':{'phone':_0xe153f2[_0x500118(0x21b)],'saasId':_0x71264c}});else{if(_0xe153f2[_0x500118(0x205)]||_0xe153f2[_0x500118(0x29e)]||_0xe153f2['weAppOpenId']||_0xe153f2[_0x500118(0x269)]){let _0x5cd9c4=_0x500118(0x205),_0x598f37={'saasId':_0x71264c},_0x4424f1=_0xe153f2[_0x500118(0x269)];!_0x4424f1&&(_0x4424f1=await this[_0x500118(0x1fd)](_0xe153f2[_0x500118(0x205)]),_0xe153f2[_0x500118(0x269)]=_0x4424f1);if(_0x4424f1)_0x5cd9c4=_0x500118(0x269);else{if(_0xe153f2[_0x500118(0x205)])_0x5cd9c4=_0x500118(0x205);else _0xe153f2[_0x500118(0x29e)]?_0x5cd9c4='miniOpenId':_0x5cd9c4=_0x500118(0x2c6);}_0x598f37[_0x5cd9c4]=_0xe153f2[_0x5cd9c4],_0x373438=await this['userEntity'][_0x500118(0x265)]({'where':_0x598f37});}else{_0x373438=await this[_0x500118(0x222)][_0x500118(0x265)]({'where':{'username':_0xe153f2[_0x500118(0x246)],'saasId':_0x71264c}});if(_0x373438)throw new Error(_0x500118(0x279));}}const _0x1a7c81=new user_entity_1[(_0x500118(0x283))]();for(let _0x4c2e29 in _0xe153f2){_0xe153f2[_0x4c2e29]&&(_0x1a7c81[_0x4c2e29]=_0xe153f2[_0x4c2e29]);}_0x373438?_0x1a7c81['id']=_0x373438['id']:(_0x1a7c81[_0x500118(0x20b)]&&(_0x1a7c81[_0x500118(0x20b)]=bcrypt[_0x500118(0x2a9)](_0xe153f2[_0x500118(0x20b)],0xa)),_0x1a7c81[_0x500118(0x2a2)]=user_constant_1['UserStatusEnum'][_0x500118(0x21f)],!_0x1a7c81['nickname']&&(_0x1a7c81['nickname']=_0x1a7c81[_0x500118(0x202)]||'小智'),!_0x1a7c81[_0x500118(0x24f)]&&(_0x1a7c81[_0x500118(0x24f)]=await this[_0x500118(0x260)][_0x500118(0x2a6)]([_0x500118(0x1eb)])));_0x1a7c81[_0x500118(0x262)]=_0x71264c;const _0x4996b2=await this[_0x500118(0x1e7)][_0x500118(0x1fa)](_0x1a7c81);!_0x373438&&this['invitationRewards'](_0x4996b2,_0xe153f2[_0x500118(0x25a)]);const _0xca16c5=(0x0,utils_1[_0x500118(0x2a4)])(_0x59bd87),_0x265ce6=this['signToken'](_0x4996b2);return await this[_0x500118(0x1e7)][_0x500118(0x2b7)](_0x4996b2['id'],_0xca16c5),await this[_0x500118(0x1ef)]['saveToken'](_0x4996b2['id'],_0x265ce6),_0x265ce6;}catch(_0x24e366){if(_0x24e366 instanceof common_1[_0x500118(0x217)])throw _0x24e366;else throw new common_1[(_0x500118(0x217))](_0x24e366[_0x500118(0x2cc)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x3d5a4e(0x1e0)](_0x5bf169,_0x2fc855){const _0xc39d84=_0x3d5a4e,_0x255742=(0x0,utils_1[_0xc39d84(0x234)])(this['clsService']);await this[_0xc39d84(0x252)](_0x5bf169[_0xc39d84(0x21b)],_0x5bf169['phoneCode']);let _0x234f52=await this['userEntity'][_0xc39d84(0x265)]({'where':{'phone':_0x5bf169['phone'],'saasId':_0x255742}});if(!_0x234f52){const _0x5af51d=new user_entity_1['UserEntity']();_0x5af51d[_0xc39d84(0x21b)]=_0x5bf169[_0xc39d84(0x21b)],_0x5af51d[_0xc39d84(0x202)]=_0x5bf169[_0xc39d84(0x21b)],_0x5af51d[_0xc39d84(0x2a2)]=user_constant_1[_0xc39d84(0x1f6)]['ACTIVE'],_0x5af51d['avatar']=await this[_0xc39d84(0x260)]['getConfigByKeys']([_0xc39d84(0x1eb)]),_0x234f52=await this['userService'][_0xc39d84(0x1fa)](_0x5af51d),this[_0xc39d84(0x259)](_0x234f52,_0x5bf169[_0xc39d84(0x25a)]);}const _0x260f74=(0x0,utils_1[_0xc39d84(0x2a4)])(_0x2fc855),_0x22f557=this[_0xc39d84(0x22f)](_0x234f52);return await this[_0xc39d84(0x1e7)]['savaLoginIp'](_0x234f52['id'],_0x260f74),await this[_0xc39d84(0x1ef)][_0xc39d84(0x2c4)](_0x234f52['id'],_0x22f557),_0x22f557;}async['loginV4'](_0x1d4b42,_0x5c1a5c){const _0x417b7e=_0x3d5a4e;try{const _0x590464=(0x0,utils_1[_0x417b7e(0x234)])(this['clsService']),_0x51a43d=await this[_0x417b7e(0x222)][_0x417b7e(0x265)]({'where':[{'username':_0x1d4b42[_0x417b7e(0x246)],'saasId':_0x590464},{'email':_0x1d4b42[_0x417b7e(0x246)],'saasId':_0x590464},{'phone':_0x1d4b42[_0x417b7e(0x246)],'saasId':_0x590464}]});if(!_0x51a43d)throw new Error(_0x590464+'用户不存在');if(!_0x51a43d[_0x417b7e(0x20b)])throw new Error(_0x417b7e(0x28f));if(!bcrypt[_0x417b7e(0x204)](_0x1d4b42[_0x417b7e(0x20b)],_0x51a43d[_0x417b7e(0x20b)]))throw new Error(_0x417b7e(0x25c));_0x51a43d[_0x417b7e(0x246)]&&!_0x51a43d['lastLoginIp']&&await this[_0x417b7e(0x1e7)][_0x417b7e(0x26f)](_0x51a43d);const _0x22af7a=(0x0,utils_1[_0x417b7e(0x2a4)])(_0x5c1a5c),_0x44e558=this['signToken'](_0x51a43d);await this[_0x417b7e(0x1e7)]['savaLoginIp'](_0x51a43d['id'],_0x22af7a),await this[_0x417b7e(0x1ef)][_0x417b7e(0x2c4)](_0x51a43d['id'],_0x44e558);if((0x0,utils_1[_0x417b7e(0x220)])(_0x51a43d[_0x417b7e(0x258)])){let _0x298079;_0x51a43d['role']===Role_constant_1[_0x417b7e(0x28d)]['AGENT']?_0x298079=await this['roleEntity'][_0x417b7e(0x265)]({'where':{'code':_0x51a43d[_0x417b7e(0x258)]}}):_0x298079=await this[_0x417b7e(0x1f5)][_0x417b7e(0x265)]({'where':{'code':_0x51a43d[_0x417b7e(0x258)],'saasId':_0x590464}});if(!_0x298079)throw new Error('角色信息异常！');await this[_0x417b7e(0x1ef)][_0x417b7e(0x208)]({'key':'access:'+_0x51a43d['id'],'val':_0x298079[_0x417b7e(0x278)]});}return _0x44e558;}catch(_0x56b61c){throw new common_1[(_0x417b7e(0x217))](_0x56b61c[_0x417b7e(0x2cc)],common_1[_0x417b7e(0x20e)][_0x417b7e(0x2af)]);}}async[_0x3d5a4e(0x282)](_0xaa5e88){const _0x46a045=_0x3d5a4e;try{const _0x3b3214=new Login_vo_1['default'](),_0x321d8c=(0x0,utils_1['getReqSaasId'])(this['clsService']),_0x43aac2=await axios_1[_0x46a045(0x286)][_0x46a045(0x276)](_0x46a045(0x2ae),{'params':{'appid':store_1[_0x46a045(0x2ab)][_0x46a045(0x293)],'secret':store_1['WechatConfig'][_0x46a045(0x254)],'js_code':_0xaa5e88,'grant_type':'authorization_code'}}),_0x501289=_0x43aac2[_0x46a045(0x272)];if(_0x501289[_0x46a045(0x22e)])throw new Error(_0x501289[_0x46a045(0x209)]);let _0x6a5015;return _0x501289[_0x46a045(0x269)]&&(_0x6a5015=await this[_0x46a045(0x222)][_0x46a045(0x265)]({'where':{'unionid':_0x501289[_0x46a045(0x269)],'saasId':_0x321d8c}})),!_0x6a5015&&(_0x6a5015=await this[_0x46a045(0x222)]['findOne']({'where':{'miniOpenId':_0x501289[_0x46a045(0x227)],'saasId':_0x321d8c}})),!_0x6a5015?this[_0x46a045(0x1ef)]['set']({'key':redisKey_constant_1['WE_MINI_TEMP_USER']+_0x501289[_0x46a045(0x227)],'val':_0x501289[_0x46a045(0x269)]||null}):(_0x6a5015[_0x46a045(0x269)]=_0x501289[_0x46a045(0x269)],_0x6a5015['miniOpenId']=_0x501289[_0x46a045(0x227)],await this['userService'][_0x46a045(0x274)](_0x6a5015['id'],_0x501289['openid'],_0x501289[_0x46a045(0x269)]),_0x3b3214[_0x46a045(0x2c8)]=this[_0x46a045(0x22f)](_0x6a5015),await this['redisCacheService']['saveToken'](_0x6a5015['id'],_0x3b3214[_0x46a045(0x2c8)])),_0x3b3214[_0x46a045(0x269)]=_0x501289[_0x46a045(0x269)],_0x3b3214[_0x46a045(0x227)]=_0x501289[_0x46a045(0x227)],_0x3b3214;}catch(_0x3c16b3){common_1[_0x46a045(0x1ee)][_0x46a045(0x2ca)]('loginInMinigin:\x20',_0x3c16b3);throw new common_1[(_0x46a045(0x217))](_0x3c16b3['message'],common_1[_0x46a045(0x20e)]['BAD_REQUEST']);}}async[_0x3d5a4e(0x218)](_0x167ece){const _0x95782d=_0x3d5a4e,_0x18131b=new WeAppLogin_vo_1[(_0x95782d(0x215))](),_0x36755e=(0x0,utils_1['getReqSaasId'])(this['clsService']);try{const _0x12a61e=await axios_1[_0x95782d(0x286)][_0x95782d(0x276)]('https://api.weixin.qq.com/sns/oauth2/access_token?appid='+store_1['WechatConfig'][_0x95782d(0x20c)]+_0x95782d(0x1fc)+store_1[_0x95782d(0x2ab)]['WE_APP_APPSECRET']+_0x95782d(0x24c)+_0x167ece+_0x95782d(0x291));if(_0x12a61e[_0x95782d(0x272)][_0x95782d(0x22e)])throw new Error(_0x12a61e[_0x95782d(0x272)][_0x95782d(0x209)]);const _0x42f3ea=_0x12a61e[_0x95782d(0x272)];let _0x3545a3;return _0x42f3ea[_0x95782d(0x269)]&&(_0x3545a3=await this[_0x95782d(0x222)][_0x95782d(0x265)]({'where':{'unionid':_0x42f3ea[_0x95782d(0x269)],'saasId':_0x36755e}})),!_0x3545a3&&(_0x3545a3=await this[_0x95782d(0x222)]['findOne']({'where':{'weAppOpenId':_0x42f3ea[_0x95782d(0x227)],'saasId':_0x36755e}})),!_0x3545a3?this['redisCacheService'][_0x95782d(0x208)]({'key':redisKey_constant_1['WE_APP_TEMP_USER']+_0x42f3ea[_0x95782d(0x227)],'val':_0x42f3ea['unionid']||null}):(_0x3545a3[_0x95782d(0x269)]=_0x42f3ea[_0x95782d(0x269)],_0x3545a3[_0x95782d(0x2c6)]=_0x42f3ea['openid'],_0x18131b[_0x95782d(0x2c8)]=this[_0x95782d(0x22f)](_0x3545a3),await this[_0x95782d(0x1ef)]['saveToken'](_0x3545a3['id'],_0x18131b[_0x95782d(0x2c8)]),await this[_0x95782d(0x1e7)][_0x95782d(0x1e1)](_0x3545a3['id'],_0x42f3ea[_0x95782d(0x227)],_0x42f3ea[_0x95782d(0x269)])),_0x18131b[_0x95782d(0x227)]=_0x42f3ea[_0x95782d(0x227)],_0x18131b[_0x95782d(0x269)]=_0x42f3ea['unionid'],_0x18131b[_0x95782d(0x273)]=_0x42f3ea[_0x95782d(0x221)],_0x18131b;}catch(_0x4556a6){common_1[_0x95782d(0x1ee)][_0x95782d(0x2ca)](_0x95782d(0x267),_0x4556a6);throw new common_1[(_0x95782d(0x217))](_0x4556a6[_0x95782d(0x2cc)],common_1[_0x95782d(0x20e)][_0x95782d(0x2af)]);}}async['activateAccount'](_0x540ae1,_0x2a21fd){const _0x53be85=_0x3d5a4e,_0x44128e=await this[_0x53be85(0x260)][_0x53be85(0x2a6)]([_0x53be85(0x233),_0x53be85(0x1fe),_0x53be85(0x253),_0x53be85(0x240),_0x53be85(0x228)]);try{const _0x21094d=await this[_0x53be85(0x236)]['verifyCode'](_0x540ae1,verification_constant_1[_0x53be85(0x245)][_0x53be85(0x2b2)]),{type:_0x40d5da,userId:_0x1909ec}=_0x21094d;if(_0x40d5da!==verification_constant_1[_0x53be85(0x245)][_0x53be85(0x2b2)])throw new common_1['HttpException'](_0x53be85(0x271),common_1[_0x53be85(0x20e)]['BAD_REQUEST']);const _0x5e02c5=await this[_0x53be85(0x1e7)]['getUserStatus'](_0x1909ec);if(_0x5e02c5===user_constant_1[_0x53be85(0x1f6)]['ACTIVE'])throw new common_1[(_0x53be85(0x217))]('账户已被激活过',common_1[_0x53be85(0x20e)]['BAD_REQUEST']);await this['userService']['updateUserStatus'](_0x21094d[_0x53be85(0x297)],user_constant_1[_0x53be85(0x1f6)][_0x53be85(0x21f)]);const _0x5bee3f=await this[_0x53be85(0x1e7)][_0x53be85(0x21c)](_0x21094d[_0x53be85(0x297)]),{username:_0x12a099,email:_0x4eb3eb,id:_0x2b8d16,invitedBy:_0x4d463f}=_0x5bee3f;let _0x53adfa;_0x4d463f&&(_0x53adfa=await this[_0x53be85(0x1e7)][_0x53be85(0x2b1)](_0x4d463f)),await this[_0x53be85(0x1e7)][_0x53be85(0x224)](_0x5bee3f,_0x53adfa),_0x2a21fd[_0x53be85(0x225)](_0x53be85(0x201)+_0x2b8d16[_0x53be85(0x2b8)]()[_0x53be85(0x27b)](0x4,'0')+_0x53be85(0x24a)+_0x12a099+_0x53be85(0x281)+_0x4eb3eb+_0x53be85(0x23b)+_0x44128e[_0x53be85(0x233)]+_0x53be85(0x241)+_0x44128e[_0x53be85(0x1fe)]+_0x53be85(0x295)+_0x44128e['registerSuccessEmaileAppend']);}catch(_0x50f9af){console['log'](_0x53be85(0x1f9),_0x50f9af);const _0x2ac555=_0x50f9af['response'];_0x2a21fd[_0x53be85(0x225)](_0x53be85(0x211)+_0x2ac555+_0x53be85(0x287)+_0x44128e['registerFailEmailTitle']+_0x53be85(0x290)+_0x44128e['registerFailEmailTeamName']);}}async[_0x3d5a4e(0x1f1)](_0x23c793){const _0x17d989=_0x3d5a4e,_0x385f03=await this[_0x17d989(0x1e7)][_0x17d989(0x1e3)]({'id':_0x23c793[_0x17d989(0x296)]['id']});let _0xa6407e=![];const _0x1d42ca=(0x0,date_1[_0x17d989(0x286)])()[_0x17d989(0x2bb)]('YYYY-MM-DD'),_0x36e19a=await this[_0x17d989(0x230)]['findOne']({'where':{'userId':_0x385f03['id'],'signInDate':_0x1d42ca}});return _0x36e19a&&(_0xa6407e=!![]),{'userInfo':_0x385f03,'isSignIn':_0xa6407e};}async[_0x3d5a4e(0x257)](_0x242eb9,_0x6c6eee){const _0x55b3d8=_0x3d5a4e,{id:_0x2a883b,client:_0x62f6de}=_0x242eb9[_0x55b3d8(0x296)];if(_0x62f6de&&Number(_0x62f6de)>0x0)throw new common_1[(_0x55b3d8(0x217))]('无权此操作、请联系管理员！',common_1['HttpStatus'][_0x55b3d8(0x2af)]);const {oldPassword:_0x57b978,password:_0x4f82a8}=_0x6c6eee,_0x394112=await this[_0x55b3d8(0x222)][_0x55b3d8(0x265)]({'where':{'id':_0x2a883b}});if(_0x394112[_0x55b3d8(0x20b)]){if(!_0x57b978)throw new common_1[(_0x55b3d8(0x217))](_0x55b3d8(0x24d),common_1['HttpStatus'][_0x55b3d8(0x2af)]);const _0x14c1a7=bcrypt[_0x55b3d8(0x204)](_0x57b978,_0x394112[_0x55b3d8(0x20b)]);if(!_0x14c1a7)throw new common_1[(_0x55b3d8(0x217))](_0x55b3d8(0x26a),common_1[_0x55b3d8(0x20e)][_0x55b3d8(0x2af)]);}return _0x394112[_0x55b3d8(0x20b)]=bcrypt[_0x55b3d8(0x2a9)](_0x4f82a8,0xa),await this[_0x55b3d8(0x222)][_0x55b3d8(0x1e4)](_0x394112),_0x55b3d8(0x21e);}async['updateEmail'](_0x173d49,_0x3362bb){const _0x508e04=_0x3d5a4e,_0x37d799=_0x173d49[_0x508e04(0x296)]['id'],_0x1d2c66=await this[_0x508e04(0x222)][_0x508e04(0x265)]({'where':{'email':_0x3362bb[_0x508e04(0x2be)]}});if(_0x1d2c66)throw new common_1['HttpException'](_0x508e04(0x2c5),axios_1[_0x508e04(0x1fb)][_0x508e04(0x232)]);const _0x3c6b60=await this[_0x508e04(0x222)][_0x508e04(0x265)]({'where':{'id':_0x37d799}}),_0x15385c=await this[_0x508e04(0x260)][_0x508e04(0x2a6)]([_0x508e04(0x249),'registerBaseUrl',_0x508e04(0x2a3),_0x508e04(0x29b),_0x508e04(0x284),_0x508e04(0x2ad)]);_0x3c6b60['email']=_0x3362bb[_0x508e04(0x2be)];const _0x21f2ac=_0x15385c[_0x508e04(0x2ad)]?Number(_0x15385c[_0x508e04(0x2ad)]):0x1e*0x3c,_0x12caca=await this[_0x508e04(0x236)]['createVerification'](_0x3c6b60,verification_constant_1[_0x508e04(0x245)][_0x508e04(0x2c2)],_0x21f2ac),{code:_0x392988,email:_0x19c57b,id:_0x430a25}=_0x12caca,{registerVerifyEmailFrom:_0x31c37a}=_0x15385c;await this[_0x508e04(0x2b4)]['sendMail']({'to':_0x19c57b,'template':_0x508e04(0x2b9),'subject':'来自'+_0x31c37a+_0x508e04(0x242),'context':{'id':_0x430a25,'code':_0x392988,'email':_0x19c57b,..._0x15385c,'baseUrl':_0x15385c[_0x508e04(0x20d)]}});}async[_0x3d5a4e(0x1e8)](_0x285a59){const _0x406a55=_0x3d5a4e,_0x93cf33=await this[_0x406a55(0x222)][_0x406a55(0x2c9)]({'where':{'phone':_0x285a59}});return _0x93cf33>0x0;}async['bindPhone'](_0xfa755a){const _0xade404=_0x3d5a4e;await this[_0xade404(0x252)](_0xfa755a['phone'],_0xfa755a[_0xade404(0x29d)]);if(await this[_0xade404(0x1e8)](_0xfa755a[_0xade404(0x21b)]))throw new common_1['HttpException'](_0xade404(0x2b0),common_1[_0xade404(0x20e)][_0xade404(0x2af)]);return await this[_0xade404(0x222)][_0xade404(0x1e4)]({'id':_0xfa755a[_0xade404(0x297)],'phone':_0xfa755a['phone']}),!![];}async[_0x3d5a4e(0x2a1)](){const _0x4fbada=_0x3d5a4e;try{const _0x2a5db9=process[_0x4fbada(0x223)][_0x4fbada(0x213)];if(_0x2a5db9===_0x4fbada(0x24b)||_0x2a5db9===_0x4fbada(0x2c1)||_0x2a5db9===_0x4fbada(0x292)){const _0xabf927=await axios_1[_0x4fbada(0x286)][_0x4fbada(0x276)]('https://gomaxai.qumao518.vip/api/official/getAccessToken?type=mini');await this[_0x4fbada(0x1ef)][_0x4fbada(0x208)]({'key':redisKey_constant_1[_0x4fbada(0x26e)],'val':_0xabf927[_0x4fbada(0x272)][_0x4fbada(0x272)]});}else{const _0x4e38e8=await axios_1['default']['post'](_0x4fbada(0x289),{'grant_type':_0x4fbada(0x226),'appid':store_1['WechatConfig']['WE_MiNI_APPID'],'secret':store_1[_0x4fbada(0x2ab)][_0x4fbada(0x254)],'force_refresh':![]});await this[_0x4fbada(0x1ef)][_0x4fbada(0x208)]({'key':redisKey_constant_1[_0x4fbada(0x26e)],'val':_0x4e38e8[_0x4fbada(0x272)]['access_token']});}}catch(_0x5990e3){common_1[_0x4fbada(0x1ee)][_0x4fbada(0x2ca)](_0x4fbada(0x1f4),_0x5990e3);}}[_0x3d5a4e(0x212)](_0x5d6b4d){const _0x68af3d=_0x3d5a4e,_0x5508d5={'id':_0x5d6b4d,'openId':null,'client':null,'role':_0x68af3d(0x268),'username':'游客'+_0x5d6b4d,'email':_0x5d6b4d+'@nine.com','saasId':(0x0,utils_1['getReqSaasId'])(this[_0x68af3d(0x219)])};return this[_0x68af3d(0x22f)](_0x5508d5);}async['getJwtToken'](_0x3eed98,_0x5ec546){const _0x2408f0=_0x3d5a4e,{status:_0x171035}=_0x3eed98;if(_0x171035!==user_constant_1[_0x2408f0(0x1f6)][_0x2408f0(0x21f)])throw new common_1[(_0x2408f0(0x217))](user_constant_1['UserStatusErrMsg'][_0x171035],common_1['HttpStatus']['BAD_REQUEST']);const _0x42c95a=(0x0,utils_1['getClientIp'])(_0x5ec546),_0x49fbe2=this[_0x2408f0(0x22f)](_0x3eed98);return await this[_0x2408f0(0x1e7)][_0x2408f0(0x2b7)](_0x3eed98['id'],_0x42c95a),await this['redisCacheService'][_0x2408f0(0x2c4)](_0x3eed98['id'],_0x49fbe2),_0x49fbe2;}async[_0x3d5a4e(0x252)](_0x1cad5b,_0x126b07){const _0x58fb2c=_0x3d5a4e,_0x3314ef=await this[_0x58fb2c(0x260)]['getNamespace'](),_0x5038ba=_0x3314ef+_0x58fb2c(0x266)+_0x1cad5b;if(_0x126b07===_0x58fb2c(0x206))return;const _0x71318=await this[_0x58fb2c(0x1ef)]['get']({'key':_0x5038ba});if(!_0x71318)throw new common_1[(_0x58fb2c(0x217))](_0x58fb2c(0x1e6),common_1[_0x58fb2c(0x20e)][_0x58fb2c(0x2af)]);if(_0x126b07!==_0x71318)throw new common_1[(_0x58fb2c(0x217))]('验证码填写错误、请重新输入！',common_1[_0x58fb2c(0x20e)][_0x58fb2c(0x2af)]);}async[_0x3d5a4e(0x259)](_0xc1f6fe,_0x43e3c0){const _0x1962a2=_0x3d5a4e;let _0x1656f9;_0x43e3c0&&(_0x1656f9=await this[_0x1962a2(0x1e7)][_0x1962a2(0x2b1)](_0x43e3c0)),await this[_0x1962a2(0x1e7)][_0x1962a2(0x224)](_0xc1f6fe,_0x1656f9);}async[_0x3d5a4e(0x1e2)](_0x4181c5,_0x472034,_0x53e6f6){const _0x3e8cc3=_0x3d5a4e;await this[_0x3e8cc3(0x252)](_0x4181c5,_0x472034);const _0x154195=await this[_0x3e8cc3(0x222)][_0x3e8cc3(0x265)]({'where':{'id':_0x53e6f6[_0x3e8cc3(0x296)]['id']}});if(_0x154195[_0x3e8cc3(0x21b)]!==_0x4181c5)throw new common_1[(_0x3e8cc3(0x217))]('手机号错误！',common_1[_0x3e8cc3(0x20e)][_0x3e8cc3(0x2af)]);return!![];}};function _0x33b5(_0x4bd8d8,_0x52543a){const _0x495161=_0x4951();return _0x33b5=function(_0x33b57a,_0x4bbd34){_0x33b57a=_0x33b57a-0x1e0;let _0x350597=_0x495161[_0x33b57a];return _0x350597;},_0x33b5(_0x4bd8d8,_0x52543a);}AuthService=__decorate([(0x0,common_1[_0x3d5a4e(0x1ed)])(),__param(0x0,(0x0,typeorm_1[_0x3d5a4e(0x26d)])(user_entity_1[_0x3d5a4e(0x283)])),__param(0x1,(0x0,typeorm_1[_0x3d5a4e(0x26d)])(role_entity_1['RoleEntity'])),__param(0x2,(0x0,typeorm_1[_0x3d5a4e(0x26d)])(signIn_entity_1[_0x3d5a4e(0x210)])),__metadata(_0x3d5a4e(0x2ac),[typeorm_2[_0x3d5a4e(0x27a)],typeorm_2['Repository'],typeorm_2[_0x3d5a4e(0x27a)],nestjs_cls_1[_0x3d5a4e(0x203)],jwt_1['JwtService'],user_service_1[_0x3d5a4e(0x28c)],mailer_service_1[_0x3d5a4e(0x2a5)],redisCache_service_1[_0x3d5a4e(0x29a)],verification_service_1[_0x3d5a4e(0x23c)],globalConfig_service_1[_0x3d5a4e(0x26c)]])],AuthService),exports[_0x3d5a4e(0x270)]=AuthService;