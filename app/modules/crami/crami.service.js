'use strict';const _0x1a5e30=_0x309d;(function(_0x3165bd,_0x428941){const _0x18bd07=_0x309d,_0x51536d=_0x3165bd();while(!![]){try{const _0x16ecec=-parseInt(_0x18bd07(0x200))/0x1*(parseInt(_0x18bd07(0x1f8))/0x2)+parseInt(_0x18bd07(0x1aa))/0x3*(-parseInt(_0x18bd07(0x190))/0x4)+parseInt(_0x18bd07(0x1b0))/0x5+-parseInt(_0x18bd07(0x1f7))/0x6*(parseInt(_0x18bd07(0x1eb))/0x7)+parseInt(_0x18bd07(0x194))/0x8*(-parseInt(_0x18bd07(0x1be))/0x9)+-parseInt(_0x18bd07(0x1e5))/0xa+parseInt(_0x18bd07(0x1d6))/0xb;if(_0x16ecec===_0x428941)break;else _0x51536d['push'](_0x51536d['shift']());}catch(_0x3f085b){_0x51536d['push'](_0x51536d['shift']());}}}(_0x3ea3,0x68864));var __decorate=this&&this[_0x1a5e30(0x19c)]||function(_0x4386a8,_0x3048fc,_0x26229d,_0x4511fb){const _0x16abd5=_0x1a5e30;var _0x3d6bd2=arguments[_0x16abd5(0x1f3)],_0x493b9=_0x3d6bd2<0x3?_0x3048fc:_0x4511fb===null?_0x4511fb=Object[_0x16abd5(0x1bd)](_0x3048fc,_0x26229d):_0x4511fb,_0x26c673;if(typeof Reflect===_0x16abd5(0x1d2)&&typeof Reflect['decorate']===_0x16abd5(0x1e1))_0x493b9=Reflect[_0x16abd5(0x1b8)](_0x4386a8,_0x3048fc,_0x26229d,_0x4511fb);else{for(var _0x2eb8af=_0x4386a8[_0x16abd5(0x1f3)]-0x1;_0x2eb8af>=0x0;_0x2eb8af--)if(_0x26c673=_0x4386a8[_0x2eb8af])_0x493b9=(_0x3d6bd2<0x3?_0x26c673(_0x493b9):_0x3d6bd2>0x3?_0x26c673(_0x3048fc,_0x26229d,_0x493b9):_0x26c673(_0x3048fc,_0x26229d))||_0x493b9;}return _0x3d6bd2>0x3&&_0x493b9&&Object[_0x16abd5(0x1fc)](_0x3048fc,_0x26229d,_0x493b9),_0x493b9;},__metadata=this&&this[_0x1a5e30(0x18f)]||function(_0x2e669d,_0xe84452){const _0x1d6f11=_0x1a5e30;if(typeof Reflect==='object'&&typeof Reflect[_0x1d6f11(0x1bf)]===_0x1d6f11(0x1e1))return Reflect[_0x1d6f11(0x1bf)](_0x2e669d,_0xe84452);},__param=this&&this[_0x1a5e30(0x1b7)]||function(_0x1881bf,_0x3a0376){return function(_0x429a5f,_0x3e1b7f){_0x3a0376(_0x429a5f,_0x3e1b7f,_0x1881bf);};};Object[_0x1a5e30(0x1fc)](exports,_0x1a5e30(0x1f0),{'value':!![]}),exports[_0x1a5e30(0x1b9)]=void 0x0;const common_1=require(_0x1a5e30(0x1ca)),crami_entity_1=require(_0x1a5e30(0x19a)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x1a5e30(0x1b3)),cramiPackage_entity_1=require(_0x1a5e30(0x1c2)),utils_1=require(_0x1a5e30(0x1af)),balance_constant_1=require('../../common/constants/balance.constant'),cramiPackageType_entity_1=require('./cramiPackageType.entity'),user_service_1=require(_0x1a5e30(0x1d8));let CramiService=class CramiService{constructor(_0x498862,_0x3c467e,_0x19c057,_0xb867a2,_0x575806){const _0x4e6282=_0x1a5e30;this[_0x4e6282(0x1a1)]=_0x498862,this[_0x4e6282(0x1f2)]=_0x3c467e,this[_0x4e6282(0x1b1)]=_0x19c057,this[_0x4e6282(0x1f9)]=_0xb867a2,this['connection']=_0x575806;}async['queryOnePackage'](_0x1d8c65){const _0x18e7ca=_0x1a5e30;return await this[_0x18e7ca(0x1f2)][_0x18e7ca(0x1bc)]({'where':{'id':_0x1d8c65}});}async['queryAllPackage'](_0x55de81){const _0x510aad=_0x1a5e30;try{const {page:page=0x1,size:size=0xa,name:_0x43dc8e,status:_0x3903d8,type:_0x138685}=_0x55de81,_0x243e4c={};return _0x43dc8e&&Object[_0x510aad(0x1ec)](_0x243e4c,{'name':(0x0,typeorm_2['Like'])('%'+_0x43dc8e+'%')}),_0x3903d8&&Object[_0x510aad(0x1ec)](_0x243e4c,{'status':_0x3903d8}),_0x138685&&(_0x138685>0x0?Object[_0x510aad(0x1ec)](_0x243e4c,{'days':(0x0,typeorm_2[_0x510aad(0x1a2)])(0x0)}):Object['assign'](_0x243e4c,{'days':(0x0,typeorm_2['LessThanOrEqual'])(0x0)})),await this[_0x510aad(0x1f2)][_0x510aad(0x18d)]({'skip':(page-0x1)*size,'take':size,'where':_0x243e4c,'order':{'order':_0x510aad(0x1cf)}})[_0x510aad(0x1ad)](([_0x5089a4,_0xce6cd9])=>({'rows':_0x5089a4||[],'count':_0xce6cd9||0x0}))[_0x510aad(0x198)](_0x238cfd=>{const _0x295c49=_0x510aad;common_1[_0x295c49(0x1a8)][_0x295c49(0x19f)](_0x238cfd);});}catch(_0x6260a1){console[_0x510aad(0x1c3)](_0x510aad(0x1ff),_0x6260a1);}}async[_0x1a5e30(0x1b4)](_0x32b38f){const _0x774324=_0x1a5e30,{name:_0x55ff6c}=_0x32b38f,_0x57d771=await this[_0x774324(0x1b1)][_0x774324(0x18b)]();if(_0x57d771>=0x2)throw new common_1[(_0x774324(0x19b))](_0x774324(0x1ac),common_1[_0x774324(0x192)][_0x774324(0x1e0)]);const _0xfce5ca=await this[_0x774324(0x1b1)][_0x774324(0x1bc)]({'where':{'name':_0x55ff6c}})[_0x774324(0x198)](_0x4df939=>{const _0x4e5795=_0x774324;common_1[_0x4e5795(0x1a8)][_0x4e5795(0x19f)](_0x4df939);});if(_0xfce5ca)throw new common_1['HttpException'](_0x774324(0x1f6),common_1['HttpStatus'][_0x774324(0x1e0)]);try{return await this[_0x774324(0x1b1)][_0x774324(0x1e2)](_0x32b38f)['catch'](_0x60ee0e=>{common_1['Logger']['error'](_0x60ee0e);});}catch(_0x13caf5){console[_0x774324(0x1c3)](_0x774324(0x1ff),_0x13caf5);throw new common_1[(_0x774324(0x19b))](_0x13caf5,common_1[_0x774324(0x192)]['BAD_REQUEST']);}}async[_0x1a5e30(0x1b2)](_0x1e7665){const _0x4ff2af=_0x1a5e30,{id:_0x2ba52d}=_0x1e7665,_0x12ab07=await this[_0x4ff2af(0x1b1)][_0x4ff2af(0x1bc)]({'where':{'id':_0x2ba52d}})[_0x4ff2af(0x198)](_0x7a5e42=>{const _0x5c60b4=_0x4ff2af;common_1['Logger'][_0x5c60b4(0x19f)](_0x7a5e42);});if(!_0x12ab07)throw new common_1[(_0x4ff2af(0x19b))](_0x4ff2af(0x1e4),common_1[_0x4ff2af(0x192)][_0x4ff2af(0x1e0)]);try{const {name:_0x3c25c3,desc:_0x2f21ba,status:_0x1bbb2b,order:_0x31b205,title:_0x49ac98}=_0x1e7665;return await this[_0x4ff2af(0x1b1)][_0x4ff2af(0x1cb)](_0x2ba52d,{'name':_0x3c25c3,'desc':_0x2f21ba,'status':_0x1bbb2b,'order':_0x31b205,'title':_0x49ac98})[_0x4ff2af(0x1ad)](_0x420024=>_0x420024[_0x4ff2af(0x1c9)])[_0x4ff2af(0x198)](_0xaabc44=>{const _0x5250bf=_0x4ff2af;common_1[_0x5250bf(0x1a8)][_0x5250bf(0x19f)](_0xaabc44);});}catch(_0x22b611){console[_0x4ff2af(0x1c3)](_0x4ff2af(0x1ff),_0x22b611);throw new common_1['HttpException'](_0x22b611,common_1[_0x4ff2af(0x192)][_0x4ff2af(0x1e0)]);}}async[_0x1a5e30(0x203)](){const _0x5cd670=_0x1a5e30;return await this['cramiPackageTypeEntity'][_0x5cd670(0x18d)]({'order':{'order':_0x5cd670(0x1cf)}})[_0x5cd670(0x1ad)](([_0x11fae8,_0x342862])=>({'rows':_0x11fae8,'count':_0x342862}))[_0x5cd670(0x198)](_0x886ba7=>{const _0x25059c=_0x5cd670;common_1[_0x25059c(0x1a8)][_0x25059c(0x19f)](_0x886ba7);});}async[_0x1a5e30(0x1e7)](_0xdc5ab7){const _0x22ba56=_0x1a5e30,_0x5a5850=await this[_0x22ba56(0x1f2)][_0x22ba56(0x18b)]({'where':{'typeId':_0xdc5ab7}});if(_0x5a5850>0x0)throw new common_1[(_0x22ba56(0x19b))]('该类型绑定有套餐禁止删除！',common_1[_0x22ba56(0x192)]['BAD_REQUEST']);return await this[_0x22ba56(0x1b1)][_0x22ba56(0x1c0)](_0xdc5ab7)[_0x22ba56(0x1ad)](_0x11adc8=>_0x11adc8[_0x22ba56(0x1c9)]>0x0)[_0x22ba56(0x198)](_0x572ab1=>{const _0x3b21b3=_0x22ba56;common_1[_0x3b21b3(0x1a8)][_0x3b21b3(0x19f)](_0x572ab1);});}async[_0x1a5e30(0x1e3)](_0x188ef2){const _0x4d73cc=_0x1a5e30,{name:_0x7bed02,weight:_0x318eac,typeId:_0x2d1a76}=_0x188ef2,_0x3c9f55=await this[_0x4d73cc(0x1f2)]['findOne']({'where':[{'name':_0x7bed02},{'weight':_0x318eac}]})[_0x4d73cc(0x198)](_0x21ef9a=>{common_1['Logger']['error'](_0x21ef9a);});if(_0x3c9f55)throw new common_1['HttpException'](_0x4d73cc(0x1a7),common_1[_0x4d73cc(0x192)][_0x4d73cc(0x1e0)]);const _0x605d89=await this[_0x4d73cc(0x1b1)][_0x4d73cc(0x1bc)]({'where':{'id':_0x2d1a76}})['then'](_0x280f4d=>_0x280f4d[_0x4d73cc(0x1a0)])[_0x4d73cc(0x198)](_0xbb2b22=>{const _0xf85046=_0x4d73cc;common_1[_0xf85046(0x1a8)]['error'](_0xbb2b22);});if(!_0x605d89)throw new common_1[(_0x4d73cc(0x19b))]('套餐类型错误！',common_1[_0x4d73cc(0x192)][_0x4d73cc(0x1e0)]);try{return await this['cramiPackageEntity'][_0x4d73cc(0x1e2)]({..._0x188ef2,'typeName':_0x605d89})['catch'](_0x445c09=>{const _0x2d572f=_0x4d73cc;common_1[_0x2d572f(0x1a8)]['error'](_0x445c09);});}catch(_0x15bd82){console[_0x4d73cc(0x1c3)](_0x4d73cc(0x1ff),_0x15bd82);throw new common_1[(_0x4d73cc(0x19b))](_0x15bd82,common_1[_0x4d73cc(0x192)][_0x4d73cc(0x1e0)]);}}async[_0x1a5e30(0x1a5)](_0x51e8dd){const _0x87599c=_0x1a5e30,{id:_0x39d1fd,name:_0x25fdc9,typeId:_0x47bbee,weight:_0x2c1600}=_0x51e8dd,_0x39efac=await this[_0x87599c(0x1f2)][_0x87599c(0x1bc)]({'where':{'id':_0x39d1fd}});if(!_0x39efac)throw new common_1['HttpException'](_0x87599c(0x197),common_1['HttpStatus'][_0x87599c(0x1e0)]);const _0x4a7a76=await this[_0x87599c(0x1f2)]['count']({'where':[{'name':_0x25fdc9,'id':(0x0,typeorm_2[_0x87599c(0x1cc)])(_0x39d1fd)},{'weight':_0x2c1600,'id':(0x0,typeorm_2['Not'])(_0x39d1fd)}]})[_0x87599c(0x198)](_0x4aed07=>{const _0x43dbe6=_0x87599c;common_1[_0x43dbe6(0x1a8)]['error'](_0x4aed07);});if(_0x4a7a76)throw new common_1[(_0x87599c(0x19b))]('套餐名称或套餐等级重复、请检查！',common_1[_0x87599c(0x192)]['BAD_REQUEST']);let _0x15ba38='';_0x47bbee&&(_0x15ba38=await this['cramiPackageTypeEntity'][_0x87599c(0x1bc)]({'where':{'id':_0x47bbee}})[_0x87599c(0x1ad)](_0x29aabc=>_0x29aabc['name']||'')['catch'](_0x2e6705=>{const _0xbfaff5=_0x87599c;common_1['Logger'][_0xbfaff5(0x19f)](_0x2e6705);}));const _0xddc5b0=await this[_0x87599c(0x1f2)][_0x87599c(0x1cb)]({'id':_0x39d1fd},{..._0x51e8dd,'typeName':_0x15ba38||''})[_0x87599c(0x198)](_0x23c8dc=>{const _0x4b9023=_0x87599c;common_1[_0x4b9023(0x1a8)][_0x4b9023(0x19f)](_0x23c8dc);});if(_0xddc5b0&&_0xddc5b0[_0x87599c(0x1c9)]>0x0)return _0x87599c(0x1fa);else throw new common_1[(_0x87599c(0x19b))](_0x87599c(0x1da),common_1[_0x87599c(0x192)]['BAD_REQUEST']);}async[_0x1a5e30(0x1f1)](_0x264035){const _0xac1084=_0x1a5e30,{id:_0x8d1342}=_0x264035,_0x15ee1a=await this[_0xac1084(0x1a1)][_0xac1084(0x18b)]({'where':{'packageId':_0x8d1342}})[_0xac1084(0x198)](_0x4f5d3b=>{const _0x13a880=_0xac1084;common_1[_0x13a880(0x1a8)][_0x13a880(0x19f)](_0x4f5d3b);});if(_0x15ee1a)throw new common_1[(_0xac1084(0x19b))]('当前套餐下存在卡密、请先删除卡密后才可删除套餐！',common_1[_0xac1084(0x192)][_0xac1084(0x1e0)]);return await this['cramiPackageEntity'][_0xac1084(0x1c0)]({'id':_0x8d1342})['catch'](_0x24e7b7=>{const _0x55406b=_0xac1084;common_1[_0x55406b(0x1a8)][_0x55406b(0x19f)](_0x24e7b7);});}async[_0x1a5e30(0x1dc)](_0x7a04a){const _0x10f330=_0x1a5e30,{packageId:_0x2ee4e5,score:_0x4897ca,count:count=0x1}=_0x7a04a;try{if(_0x2ee4e5){const _0x277a6b=await this[_0x10f330(0x1f2)][_0x10f330(0x1bc)]({'where':{'id':_0x2ee4e5}})[_0x10f330(0x198)](_0x55a634=>{const _0x26fa20=_0x10f330;common_1[_0x26fa20(0x1a8)][_0x26fa20(0x19f)](_0x55a634);});if(!_0x277a6b)throw new Error('当前套餐不存在、请确认您选择的套餐是否存在！');await this['generateCrami']({'packageId':_0x2ee4e5},count);}else{if(!_0x4897ca)throw new Error('自定义卡密积分余额不为0️零！');await this[_0x10f330(0x1a4)]({'score':_0x4897ca},count);}return!![];}catch(_0x1f2b2c){throw new common_1['HttpException'](_0x1f2b2c[_0x10f330(0x1a6)],common_1[_0x10f330(0x192)][_0x10f330(0x1e0)]);}}async[_0x1a5e30(0x1a4)](_0xa3d64e,_0x1f3e6e){const _0x2c8a62=_0x1a5e30,_0x104978=[];for(let _0xf27bf1=0x0;_0xf27bf1<_0x1f3e6e;_0xf27bf1++){const _0x20aab0=(0x0,utils_1[_0x2c8a62(0x191)])(),_0x11ae2f=this['cramiEntity'][_0x2c8a62(0x196)]({..._0xa3d64e,'code':_0x20aab0});_0x104978['push'](_0x11ae2f);}await this[_0x2c8a62(0x1a1)][_0x2c8a62(0x1e2)](_0x104978);}async['useCrami'](_0x404a5b,_0x1c17bc){const _0x2811f2=_0x1a5e30;return await this['connection'][_0x2811f2(0x1ab)](async()=>{const _0x5677a2=_0x2811f2,_0x28d180=await this[_0x5677a2(0x1f9)][_0x5677a2(0x1a9)](_0x404a5b['user']['id']),_0x430b8e=await this[_0x5677a2(0x1a1)][_0x5677a2(0x1bc)]({'where':{'code':_0x1c17bc[_0x5677a2(0x1d0)]}});if(!_0x430b8e)throw new common_1['HttpException'](_0x5677a2(0x1f4),common_1[_0x5677a2(0x192)]['BAD_REQUEST']);const {status:_0x5191f2,score:_0x2a19a6,packageId:_0x12494a}=_0x430b8e;if(_0x5191f2===0x1)throw new common_1[(_0x5677a2(0x19b))](_0x5677a2(0x18a),common_1['HttpStatus'][_0x5677a2(0x1e0)]);if(_0x12494a){const _0x245770=await this['cramiPackageEntity'][_0x5677a2(0x1bc)]({'where':{'id':_0x12494a,'status':0x1}});if(!_0x245770)throw new common_1[(_0x5677a2(0x19b))](_0x5677a2(0x1ef),common_1['HttpStatus'][_0x5677a2(0x1e0)]);_0x245770['score']>0x0&&await this[_0x5677a2(0x1f9)]['changeScore4Other'](_0x28d180,balance_constant_1[_0x5677a2(0x1dd)][_0x5677a2(0x1ce)],_0x245770[_0x5677a2(0x1ba)],_0x5677a2(0x193)+_0x245770[_0x5677a2(0x1a0)],_0x1c17bc[_0x5677a2(0x1d0)]),_0x245770[_0x5677a2(0x1c5)]!==0x0&&await this['userService'][_0x5677a2(0x1d4)](_0x28d180,balance_constant_1['EChangeType'][_0x5677a2(0x1ce)],_0x245770[_0x5677a2(0x1c5)],_0x5677a2(0x1d5)+_0x245770['name'],_0x1c17bc[_0x5677a2(0x1d0)]);}else await this['userService']['changeScore4Other'](_0x28d180,balance_constant_1['EChangeType'][_0x5677a2(0x1ce)],_0x2a19a6,_0x5677a2(0x1db),_0x1c17bc[_0x5677a2(0x1d0)]);await this['cramiEntity']['update']({'code':_0x1c17bc[_0x5677a2(0x1d0)]},{'useId':_0x28d180['id'],'status':0x1});}),'使用卡密成功';}async[_0x1a5e30(0x1de)](_0xde813c,_0x5d858e){const _0x5caf1=_0x1a5e30,{page:page=0x1,size:size=0xa,status:_0x333dad,useId:_0x1da9cc}=_0xde813c,_0x3bca74={};_0x333dad&&Object[_0x5caf1(0x1ec)](_0x3bca74,{'status':_0x333dad}),_0x1da9cc&&Object[_0x5caf1(0x1ec)](_0x3bca74,{'useId':_0x1da9cc});const _0x8bb17c=await this[_0x5caf1(0x1a1)][_0x5caf1(0x18d)]({'skip':(page-0x1)*size,'take':size,'order':{'createdAt':_0x5caf1(0x1cf)},'where':_0x3bca74})[_0x5caf1(0x1ad)](([_0x5ad216,_0x4eb5b6])=>({'rows':_0x5ad216,'count':_0x4eb5b6}))[_0x5caf1(0x198)](_0x18b52b=>{const _0x473690=_0x5caf1;common_1[_0x473690(0x1a8)][_0x473690(0x19f)](_0x18b52b);});if(!_0x8bb17c)throw new common_1[(_0x5caf1(0x19b))](_0x5caf1(0x1d9),common_1[_0x5caf1(0x192)]['BAD_REQUEST']);const {rows:_0x38c729,count:_0x456c8b}=_0x8bb17c,_0x8db742=_0x38c729['map'](_0x1c1a7b=>_0x1c1a7b[_0x5caf1(0x1e8)]),_0x2c1d7f=_0x38c729['map'](_0x1beda2=>_0x1beda2['packageId']),_0xa5381a=await this[_0x5caf1(0x1f9)]['findByIds'](_0x8db742),_0x19501c=await this[_0x5caf1(0x1f2)][_0x5caf1(0x1bb)]({'where':{'id':(0x0,typeorm_2['In'])(_0x2c1d7f)}});return _0x38c729['forEach'](_0x3d0cb3=>{const _0x2323b2=_0x5caf1,_0x528c8f=_0xa5381a[_0x2323b2(0x1bb)](_0x4a0a2d=>_0x4a0a2d['id']===_0x3d0cb3[_0x2323b2(0x1e8)]);_0x3d0cb3[_0x2323b2(0x1d3)]=_0x528c8f?.[_0x2323b2(0x1d3)],_0x3d0cb3[_0x2323b2(0x1d1)]=_0x528c8f?.[_0x2323b2(0x1d1)],_0x3d0cb3[_0x2323b2(0x1b6)]=_0x19501c[_0x2323b2(0x1bb)](_0x3819a5=>_0x3819a5['id']===_0x3d0cb3['packageId'])?.[_0x2323b2(0x1a0)];}),_0x5d858e[_0x5caf1(0x1c1)][_0x5caf1(0x1fb)]!==_0x5caf1(0x19d)&&_0x38c729[_0x5caf1(0x1ea)](_0x137f76=>{const _0x5023c4=_0x5caf1;_0x137f76[_0x5023c4(0x1d3)]=(0x0,utils_1[_0x5023c4(0x1f5)])(_0x137f76[_0x5023c4(0x1d3)]),_0x137f76[_0x5023c4(0x1df)]=(0x0,utils_1['maskEmail'])(_0x137f76[_0x5023c4(0x1df)]),_0x137f76[_0x5023c4(0x1d0)]=(0x0,utils_1['maskCrami'])(_0x137f76[_0x5023c4(0x1d0)]);}),{'rows':_0x38c729,'count':_0x456c8b};}async[_0x1a5e30(0x1e9)](_0x2ab1e8){const _0x365797=_0x1a5e30,_0x2aefbd=await this[_0x365797(0x1a1)][_0x365797(0x1bc)]({'where':{'id':_0x2ab1e8}})[_0x365797(0x198)](_0x526dc2=>{const _0x325671=_0x365797;common_1[_0x325671(0x1a8)][_0x325671(0x19f)](_0x526dc2);});if(!_0x2aefbd)throw new common_1[(_0x365797(0x19b))](_0x365797(0x18c),common_1[_0x365797(0x192)][_0x365797(0x1e0)]);if(_0x2aefbd['status']===0x1)throw new common_1['HttpException'](_0x365797(0x1c4),common_1[_0x365797(0x192)][_0x365797(0x1e0)]);return await this['cramiEntity']['delete']({'id':_0x2ab1e8})['catch'](_0x45e42a=>{const _0xabae1e=_0x365797;common_1[_0xabae1e(0x1a8)][_0xabae1e(0x19f)](_0x45e42a);});}async[_0x1a5e30(0x202)](_0x1ed463){const _0x1753f2=_0x1a5e30,{ids:_0x5513fb}=_0x1ed463,_0x86d948=await this[_0x1753f2(0x1a1)]['delete'](_0x5513fb)[_0x1753f2(0x198)](_0x4e2231=>{const _0xa4a2ba=_0x1753f2;common_1[_0xa4a2ba(0x1a8)][_0xa4a2ba(0x19f)](_0x4e2231);});if(_0x86d948&&_0x86d948[_0x1753f2(0x1c9)]>0x0)return _0x1753f2(0x1c7);else throw new common_1['HttpException'](_0x1753f2(0x1fe),common_1[_0x1753f2(0x192)]['BAD_REQUEST']);}async[_0x1a5e30(0x1ed)](_0x4aaff2){const _0x11716b=_0x1a5e30;try{if(_0x4aaff2['id']){const _0x44daa2=await this['cramiPackageEntity'][_0x11716b(0x1bc)]({'where':{'id':(0x0,typeorm_2[_0x11716b(0x1cc)])(_0x4aaff2['id']),'name':_0x4aaff2[_0x11716b(0x1a0)],'delFlag':0x0}});if(_0x44daa2)throw new Error(_0x11716b(0x1a3));const _0x505044=await this[_0x11716b(0x1f2)][_0x11716b(0x1bc)]({'where':{'id':_0x4aaff2['id']}});if(_0x4aaff2['type']!==_0x505044[_0x11716b(0x1cd)])throw new Error('套餐类型不可修改！');await this[_0x11716b(0x1f2)][_0x11716b(0x1e2)](_0x4aaff2);}else{const _0x2fca89=await this[_0x11716b(0x1f2)][_0x11716b(0x1e6)]({'where':{'name':_0x4aaff2['name'],'delFlag':0x0}});if(_0x2fca89)throw new Error(_0x11716b(0x1a3));await this[_0x11716b(0x1f2)]['save'](_0x4aaff2);}}catch(_0x329406){throw new common_1[(_0x11716b(0x19b))](_0x329406['message'],common_1[_0x11716b(0x192)][_0x11716b(0x1e0)]);}}async[_0x1a5e30(0x1d7)](_0x2b3fd5){const _0x35c5a9=_0x1a5e30;if(!_0x2b3fd5[_0x35c5a9(0x1b5)])return!![];return await this[_0x35c5a9(0x1f2)][_0x35c5a9(0x1cb)]({'id':(0x0,typeorm_2['In'])(_0x2b3fd5[_0x35c5a9(0x1b5)])},{'delFlag':0x1}),!![];}async['packagePageV2'](_0x45de7d,_0x223578){const _0x38d062=_0x1a5e30,{page:page=0x1,size:size=0x14,name:_0x1aca44,type:_0x5f1bec,status:_0x2cb005}=_0x223578,_0x42802f={'delFlag':0x0};_0x1aca44&&(_0x42802f[_0x38d062(0x1a0)]=(0x0,typeorm_2[_0x38d062(0x195)])('%'+_0x1aca44+'%'));_0x5f1bec&&(_0x42802f[_0x38d062(0x1cd)]=_0x5f1bec);if(_0x45de7d['headers'][_0x38d062(0x18e)])_0x42802f[_0x38d062(0x201)]=0x1;else _0x2cb005&&(_0x42802f[_0x38d062(0x201)]=_0x2cb005);const [_0x1a923f,_0x29cf94]=await this[_0x38d062(0x1f2)][_0x38d062(0x18d)]({'where':_0x42802f,'order':{'order':_0x38d062(0x1cf)},'skip':(page-0x1)*size,'take':size});return{'rows':_0x1a923f,'count':_0x29cf94};}async[_0x1a5e30(0x199)](_0x527e90){const _0x2b9dbd=_0x1a5e30,_0x419ada=await this['cramiPackageEntity'][_0x2b9dbd(0x1bc)]({'where':{'id':_0x527e90}});return _0x419ada;}};function _0x3ea3(){const _0x230be5=['当前卡密已被使用、已使用的卡密禁止删除！','days','Injectable','删除卡密成功！','Repository','affected','@nestjs/common','update','Not','type','CRAMI','DESC','code','username','object','email','updateVipExpire','卡密兑换：','25680116dQmmYF','packageDeleteV2','../user/user.service','查询错误！','更新套餐失败、请重试！','卡密兑换积分','createCrami','EChangeType','queryAllCrami','phone','BAD_REQUEST','function','save','createPackage','套餐类型不存在！','4762490btQbEk','exists','removePackageType','useId','delCrami','forEach','7QVeLLQ','assign','savePackageV2','CramiPackageTypeEntity','当前充值套餐已经停用或已删除！','__esModule','delPackage','cramiPackageEntity','length','当前卡密不存在、请确认您输入的卡密是否正确！','maskEmail','套餐类型名称已存在请检查！','2602092TdCFjl','2kKDlFd','userService','更新套餐成功！','role','defineProperty','CramiPackageEntity','删除卡密失败、请重试！','error:\x20','754981pkxgIc','status','batchDelCrami','queryPackageType','当前卡密已被使用、请确认您输入的卡密是否正确！','count','当前卡密不存在、请确认您要删除的卡密是否存在！','findAndCount','fingerprint','__metadata','120300YmaDti','generateCramiCode','HttpStatus','卡密兑换套餐：','353264FQrlBm','Like','create','当前套餐不存在、请检查你的输入参数！','catch','packageDetailV2','./crami.entity','HttpException','__decorate','super','InjectRepository','error','name','cramiEntity','MoreThan','套餐已存在，请修改套餐名称！','generateCrami','updatePackage','message','套餐名称或套餐等级重复、请检查！','Logger','getUserById','45pkSJbH','transaction','目前只能支持两类套餐！','then','design:paramtypes','../../common/utils','3476755HqfRgX','cramiPackageTypeEntity','updatePackageType','typeorm','createPackageType','ids','packageName','__param','decorate','CramiService','score','find','findOne','getOwnPropertyDescriptor','99qaEpBp','metadata','delete','user','./cramiPackage.entity','log'];_0x3ea3=function(){return _0x230be5;};return _0x3ea3();}function _0x309d(_0x3c9d33,_0x43bd05){const _0x3ea3fc=_0x3ea3();return _0x309d=function(_0x309dc7,_0x33043e){_0x309dc7=_0x309dc7-0x18a;let _0x52310e=_0x3ea3fc[_0x309dc7];return _0x52310e;},_0x309d(_0x3c9d33,_0x43bd05);}CramiService=__decorate([(0x0,common_1[_0x1a5e30(0x1c6)])(),__param(0x0,(0x0,typeorm_1[_0x1a5e30(0x19e)])(crami_entity_1['CramiEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(cramiPackage_entity_1[_0x1a5e30(0x1fd)])),__param(0x2,(0x0,typeorm_1[_0x1a5e30(0x19e)])(cramiPackageType_entity_1[_0x1a5e30(0x1ee)])),__metadata(_0x1a5e30(0x1ae),[typeorm_2[_0x1a5e30(0x1c8)],typeorm_2['Repository'],typeorm_2['Repository'],user_service_1['UserService'],typeorm_2['Connection']])],CramiService),exports['CramiService']=CramiService;