'use strict';function _0x5b5e(){const _0x5cce66=['customSensitiveWords','GlobalConfigService','HttpException','join','function','push','1XdrnFg','includes','word','updateBadWords','您提交的内容中包含','match','__decorate','getUserListByIds','1346943BkUOoq','find','209848mHClSJ','delBadWords','phone','defineProperty','typeOriginCn','stringify','../../common/utils','email','post','nestjs-cls','敏感词检测\x20|\x20','recordUserBadWords','BadwordsService','的信息、我们已对您账号进行标记、请合规使用！','application/x-www-form-urlencoded','nineai','findOne','DESC','./badwords.entity','length','metadata','onModuleInit','添加敏感词成功','NineAi检测','map','userservice','getOwnPropertyDescriptor','getSensitiveConfig','typeorm','addBadWord','delViolation','affected','design:paramtypes','16ouMojT','ids','../user/user.service','queryBadWords','word_list','userId','__param','baiduTextAccessToken','UserService','formarTips','badWords','ClsService','extractContent','updateViolationCount','hideString','nineaiCheckBadWords','HttpStatus','code','敏感词不存在,请检查您的提交信息','update','百度文本检测出现错误、请查看配置信息:\x20','删除敏感词失败','Repository','badWordsEntity','BAD_REQUEST','InjectRepository','2619KZdLxg','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','findAndCount','error:\x20','isSuper','./violationLog.entity','百度云检测','265vYTQOS','log','violationLogEntity','baiduCheckBadWords','axios','97116bZqFiL','object','data','checkBadWordsByConfig','baidu','save','1137190YJitHg','BadWordsEntity','application/json','clsService','检测失败','Like','敏感词已存在,请检查您的提交信息','371ElVMfJ','自定义','@nestjs/common','__metadata','ViolationLogEntity','自定义检测','forEach','decorate','loadBadWords','***','8740uFIuvz','348mfUMNe','default','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','1145517MvQykw','删除敏感词成功','user','4252710NJppas','================================TASK==================================='];_0x5b5e=function(){return _0x5cce66;};return _0x5b5e();}const _0xaa4c76=_0x14ee;(function(_0x24bd93,_0x23e2a3){const _0x20cb7b=_0x14ee,_0x4429f3=_0x24bd93();while(!![]){try{const _0x4f7935=-parseInt(_0x20cb7b(0x142))/0x1*(parseInt(_0x20cb7b(0x122))/0x2)+-parseInt(_0x20cb7b(0x137))/0x3*(-parseInt(_0x20cb7b(0xf6))/0x4)+-parseInt(_0x20cb7b(0x117))/0x5*(-parseInt(_0x20cb7b(0x11c))/0x6)+parseInt(_0x20cb7b(0x129))/0x7*(parseInt(_0x20cb7b(0x14c))/0x8)+-parseInt(_0x20cb7b(0x110))/0x9*(-parseInt(_0x20cb7b(0x133))/0xa)+parseInt(_0x20cb7b(0x13a))/0xb+parseInt(_0x20cb7b(0x134))/0xc*(-parseInt(_0x20cb7b(0x14a))/0xd);if(_0x4f7935===_0x23e2a3)break;else _0x4429f3['push'](_0x4429f3['shift']());}catch(_0xf8cedc){_0x4429f3['push'](_0x4429f3['shift']());}}}(_0x5b5e,0xcdd4f));var __decorate=this&&this[_0xaa4c76(0x148)]||function(_0x191632,_0x27074f,_0x43bb05,_0x40b896){const _0x2bb393=_0xaa4c76;var _0x59ac41=arguments[_0x2bb393(0xe8)],_0x67ff1b=_0x59ac41<0x3?_0x27074f:_0x40b896===null?_0x40b896=Object[_0x2bb393(0xef)](_0x27074f,_0x43bb05):_0x40b896,_0x1b6dc6;if(typeof Reflect===_0x2bb393(0x11d)&&typeof Reflect[_0x2bb393(0x130)]==='function')_0x67ff1b=Reflect[_0x2bb393(0x130)](_0x191632,_0x27074f,_0x43bb05,_0x40b896);else{for(var _0x4aac0f=_0x191632[_0x2bb393(0xe8)]-0x1;_0x4aac0f>=0x0;_0x4aac0f--)if(_0x1b6dc6=_0x191632[_0x4aac0f])_0x67ff1b=(_0x59ac41<0x3?_0x1b6dc6(_0x67ff1b):_0x59ac41>0x3?_0x1b6dc6(_0x27074f,_0x43bb05,_0x67ff1b):_0x1b6dc6(_0x27074f,_0x43bb05))||_0x67ff1b;}return _0x59ac41>0x3&&_0x67ff1b&&Object[_0x2bb393(0x14f)](_0x27074f,_0x43bb05,_0x67ff1b),_0x67ff1b;},__metadata=this&&this[_0xaa4c76(0x12c)]||function(_0x3fac92,_0x5747d0){const _0x5ca30e=_0xaa4c76;if(typeof Reflect==='object'&&typeof Reflect[_0x5ca30e(0xe9)]===_0x5ca30e(0x140))return Reflect[_0x5ca30e(0xe9)](_0x3fac92,_0x5747d0);},__param=this&&this[_0xaa4c76(0xfc)]||function(_0x16a268,_0x49385f){return function(_0x3816ec,_0x4d0ed5){_0x49385f(_0x3816ec,_0x4d0ed5,_0x16a268);};};Object[_0xaa4c76(0x14f)](exports,'__esModule',{'value':!![]}),exports['BadwordsService']=void 0x0;function _0x14ee(_0xed172b,_0xc4ed74){const _0x5b5e79=_0x5b5e();return _0x14ee=function(_0x14ee4b,_0x10afae){_0x14ee4b=_0x14ee4b-0xdc;let _0x1172d3=_0x5b5e79[_0x14ee4b];return _0x1172d3;},_0x14ee(_0xed172b,_0xc4ed74);}const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0xaa4c76(0x12b)),badwords_entity_1=require(_0xaa4c76(0xe7)),typeorm_1=require(_0xaa4c76(0xf1)),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0xaa4c76(0x11b)),violationLog_entity_1=require(_0xaa4c76(0x115)),utils_1=require(_0xaa4c76(0x152)),user_service_1=require(_0xaa4c76(0xf8)),nestjs_cls_1=require(_0xaa4c76(0xde));let BadwordsService=class BadwordsService{constructor(_0xbd0ef7,_0x44273f,_0x12b2ce,_0x54272a,_0x4a8c4d){const _0x259d65=_0xaa4c76;this[_0x259d65(0x10d)]=_0xbd0ef7,this[_0x259d65(0x119)]=_0x44273f,this[_0x259d65(0x125)]=_0x12b2ce,this[_0x259d65(0xee)]=_0x54272a,this['globalConfigService']=_0x4a8c4d,this['badWords']=[];}async[_0xaa4c76(0xea)](){this['loadBadWords']();}async[_0xaa4c76(0x13c)](_0x2c20de,_0x188501){const _0x5e31fb=_0xaa4c76,_0x2b6938=[];for(let _0x2293b1=0x0;_0x2293b1<this[_0x5e31fb(0x100)]['length'];_0x2293b1++){const _0x50ec59=this[_0x5e31fb(0x100)][_0x2293b1];_0x2c20de[_0x5e31fb(0x143)](_0x50ec59)&&_0x2b6938[_0x5e31fb(0x141)](_0x50ec59);}if(_0x2b6938['length']){await this[_0x5e31fb(0xe0)](_0x188501,_0x2c20de,_0x2b6938,[_0x5e31fb(0x12a)],_0x5e31fb(0x12e));const _0x5aa58a=_0x5e31fb(0x111);throw new common_1['HttpException'](_0x5aa58a,common_1[_0x5e31fb(0x106)][_0x5e31fb(0x10e)]);}return!![];}async['checkBadWords'](_0x2f66f3,_0x5c8c1f){const _0x2d0340=_0xaa4c76,_0x2fdd34=await this['globalConfigService'][_0x2d0340(0xf0)]();_0x2fdd34&&await this['checkBadWordsByConfig'](_0x2f66f3,_0x2fdd34,_0x5c8c1f),console[_0x2d0340(0x118)](_0x2d0340(0x13b)),await this['customSensitiveWords'](_0x2f66f3,_0x5c8c1f);}async[_0xaa4c76(0x11f)](_0x561f7d,_0x32ee8c,_0x4008cf){const _0x448354=_0xaa4c76,{useType:_0x3e9e63}=_0x32ee8c;_0x3e9e63===_0x448354(0x120)&&await this[_0x448354(0x11a)](_0x561f7d,_0x32ee8c[_0x448354(0xfd)],_0x4008cf),_0x3e9e63===_0x448354(0xe4)&&await this[_0x448354(0x105)](_0x561f7d,_0x32ee8c,_0x4008cf);}['extractContent'](_0x2fb99a){const _0x24f8d0=_0xaa4c76,_0x3d2c5f=/存在(.*?)不合规/,_0x5ce427=_0x2fb99a[_0x24f8d0(0x147)](_0x3d2c5f);return _0x5ce427?_0x5ce427[0x1]:'';}async[_0xaa4c76(0x11a)](_0x33796a,_0x3b5c9d,_0x291e31){const _0x4195a2=_0xaa4c76;if(!_0x3b5c9d)return;const _0x2a250f=_0x4195a2(0x136)+_0x3b5c9d+'}',_0x5be039={'Content-Type':_0x4195a2(0xe3),'Accept':_0x4195a2(0x124)},_0x172319=await axios_1[_0x4195a2(0x135)]['post'](_0x2a250f,{'text':_0x33796a},{'headers':_0x5be039}),{conclusion:_0x31ea46,error_code:_0x3e2998,error_msg:_0x4384bb,conclusionType:_0xc32cf3,data:_0x5486f0}=_0x172319['data'];_0x3e2998&&console[_0x4195a2(0x118)](_0x4195a2(0x10a),_0x4384bb);if(_0xc32cf3!==0x1){const _0x2b9808=[...new Set(_0x5486f0['map'](_0x5f3476=>this[_0x4195a2(0x102)](_0x5f3476['msg'])))];await this[_0x4195a2(0xe0)](_0x291e31,_0x33796a,[_0x4195a2(0x132)],_0x2b9808,_0x4195a2(0x116));const _0x4cd667='您提交的信息中包含'+_0x2b9808[_0x4195a2(0x13f)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1['HttpException'](_0x4cd667,common_1[_0x4195a2(0x106)][_0x4195a2(0x10e)]);}}async[_0xaa4c76(0x105)](_0x1bf133,_0x267031,_0x3fd788){const _0x34485e=_0xaa4c76,{nineaiBuiltInSensitiveApiBase:_0x10dbc2,nineaiBuiltInSensitiveAuthKey:_0x14b0e1}=_0x267031;if(!_0x10dbc2||!_0x14b0e1)return;const _0x1b88fb=await axios_1[_0x34485e(0x135)][_0x34485e(0xdd)](_0x10dbc2,{'content':_0x1bf133},{'headers':{'Content-Type':_0x34485e(0x124),'Authorization':_0x14b0e1}});if(!_0x1b88fb[_0x34485e(0x11e)])return;if(_0x1b88fb[_0x34485e(0x11e)][_0x34485e(0x107)]!=='0'){const {msg:msg=_0x34485e(0x126)}=_0x1b88fb['data'];throw new common_1['HttpException'](_0x34485e(0xdf)+msg,common_1[_0x34485e(0x106)][_0x34485e(0x10e)]);}if(_0x1b88fb[_0x34485e(0x11e)][_0x34485e(0xfa)]&&_0x1b88fb[_0x34485e(0x11e)][_0x34485e(0xfa)]?.[_0x34485e(0xe8)]){const _0x31a216=[...new Set(_0x1b88fb[_0x34485e(0x11e)][_0x34485e(0xfa)][_0x34485e(0xed)](_0x5a0c3b=>_0x5a0c3b['keyword']))],_0x3e89d4=[...new Set(_0x1b88fb[_0x34485e(0x11e)][_0x34485e(0xfa)][_0x34485e(0xed)](_0x26d5e8=>_0x26d5e8['category']))];await this[_0x34485e(0xe0)](_0x3fd788,_0x1bf133,_0x31a216,_0x3e89d4,_0x34485e(0xec));const _0x2aaa0f=this['formarTips'](_0x1b88fb[_0x34485e(0x11e)][_0x34485e(0xfa)]);throw new common_1[(_0x34485e(0x13e))](_0x2aaa0f,common_1[_0x34485e(0x106)][_0x34485e(0x10e)]);}}[_0xaa4c76(0xff)](_0x16469c){const _0x269ad7=_0xaa4c76,_0x44ba7e=_0x16469c[_0x269ad7(0xed)](_0x1ea4a2=>_0x1ea4a2['category']),_0x55fd46=[...new Set(_0x44ba7e)];return _0x269ad7(0x146)+_0x55fd46[_0x269ad7(0x13f)](',')+_0x269ad7(0xe2);}async[_0xaa4c76(0x131)](){const _0x3df364=_0xaa4c76,_0x194bd9=await this[_0x3df364(0x10d)][_0x3df364(0x14b)]({'where':{'status':0x1},'select':[_0x3df364(0x144)]});this['badWords']=_0x194bd9[_0x3df364(0xed)](_0x293faa=>_0x293faa[_0x3df364(0x144)]);}async[_0xaa4c76(0xf9)](_0xaf1d5){const _0x2f5e74=_0xaa4c76,{page:page=0x1,size:size=0x1f4,word:_0x466154,status:_0x154997}=_0xaf1d5,_0x3c3628={};[0x0,0x1,'0','1']['includes'](_0x154997)&&(_0x3c3628['status']=_0x154997),_0x466154&&(_0x3c3628[_0x2f5e74(0x144)]=(0x0,typeorm_1[_0x2f5e74(0x127)])('%'+_0x466154+'%'));const [_0x53ec5a,_0x188aad]=await this['badWordsEntity'][_0x2f5e74(0x112)]({'where':_0x3c3628,'skip':(page-0x1)*size,'take':size,'order':{'id':'ASC'}});return{'rows':_0x53ec5a,'count':_0x188aad};}async[_0xaa4c76(0x14d)](_0x337ab5){const _0x4a24cb=_0xaa4c76,_0x3bc0eb=await this['badWordsEntity'][_0x4a24cb(0xe5)]({'where':{'id':_0x337ab5['id']}});if(!_0x3bc0eb)throw new common_1[(_0x4a24cb(0x13e))](_0x4a24cb(0x108),common_1['HttpStatus'][_0x4a24cb(0x10e)]);const _0x3da437=await this[_0x4a24cb(0x10d)]['delete']({'id':_0x337ab5['id']});if(_0x3da437[_0x4a24cb(0xf4)]>0x0)return await this[_0x4a24cb(0x131)](),_0x4a24cb(0x138);else throw new common_1[(_0x4a24cb(0x13e))](_0x4a24cb(0x10b),common_1[_0x4a24cb(0x106)][_0x4a24cb(0x10e)]);}async[_0xaa4c76(0x145)](_0x26d61f){const _0x16e588=_0xaa4c76,{id:_0x56a058,word:_0x5bc1c7,status:_0x5df7d2}=_0x26d61f,_0xb4ccca=await this[_0x16e588(0x10d)][_0x16e588(0xe5)]({'where':{'word':_0x5bc1c7}});if(_0xb4ccca)throw new common_1[(_0x16e588(0x13e))]('敏感词已经存在了、请勿重复添加',common_1['HttpStatus'][_0x16e588(0x10e)]);const _0x44158b=await this['badWordsEntity'][_0x16e588(0x109)]({'id':_0x56a058},{'word':_0x5bc1c7,'status':_0x5df7d2});if(_0x44158b[_0x16e588(0xf4)]>0x0)return await this[_0x16e588(0x131)](),'更新敏感词成功';else throw new common_1[(_0x16e588(0x13e))]('更新敏感词失败',common_1[_0x16e588(0x106)][_0x16e588(0x10e)]);}async[_0xaa4c76(0xf2)](_0x4eeda2){const _0x4f878e=_0xaa4c76,{word:_0x559102}=_0x4eeda2,_0x25f985=await this[_0x4f878e(0x10d)]['findOne']({'where':{'word':_0x559102}});if(_0x25f985)throw new common_1[(_0x4f878e(0x13e))](_0x4f878e(0x128),common_1[_0x4f878e(0x106)]['BAD_REQUEST']);return await this[_0x4f878e(0x10d)][_0x4f878e(0x121)]({'word':_0x559102}),await this[_0x4f878e(0x131)](),_0x4f878e(0xeb);}async['recordUserBadWords'](_0x242555,_0xc47a2a,_0x454d46,_0x3e1df4,_0x4e94a7){const _0x464655=_0xaa4c76,_0x24f2ac={'userId':_0x242555,'content':_0xc47a2a,'words':JSON[_0x464655(0x151)](_0x454d46),'typeCn':JSON[_0x464655(0x151)](_0x3e1df4),'typeOriginCn':_0x4e94a7};try{await this[_0x464655(0xee)][_0x464655(0x103)](_0x242555),await this[_0x464655(0x119)][_0x464655(0x121)](_0x24f2ac);}catch(_0x57e40d){console['log'](_0x464655(0x113),_0x57e40d);}}async['violation'](_0x9a00a5,_0x97e964){const _0x4bb4ad=_0xaa4c76,{role:_0x37a001}=_0x9a00a5[_0x4bb4ad(0x139)],{page:page=0x1,size:size=0xa,userId:_0x20f1c9,typeOriginCn:_0x5803ac}=_0x97e964,_0x2cda91={'delFlag':0x0};_0x20f1c9&&(_0x2cda91[_0x4bb4ad(0xfb)]=_0x20f1c9),_0x5803ac&&(_0x2cda91[_0x4bb4ad(0x150)]=_0x5803ac);const [_0x336509,_0x3ab175]=await this[_0x4bb4ad(0x119)][_0x4bb4ad(0x112)]({'where':_0x2cda91,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x4bb4ad(0xe6)}}),_0x2e51f5=[...new Set(_0x336509[_0x4bb4ad(0xed)](_0x1731e3=>_0x1731e3['userId']))],_0x26d701=await this[_0x4bb4ad(0xee)][_0x4bb4ad(0x149)](_0x2e51f5);return _0x336509[_0x4bb4ad(0x12f)](_0x33c396=>{const _0x10960d=_0x4bb4ad,_0x1e98f0=_0x26d701[_0x10960d(0x14b)](_0x17cb49=>_0x17cb49['id']===_0x33c396[_0x10960d(0xfb)]);!(0x0,utils_1[_0x10960d(0x114)])(this[_0x10960d(0x125)])&&(_0x1e98f0[_0x10960d(0xdc)]=(0x0,utils_1['hideString'])(_0x1e98f0[_0x10960d(0xdc)]),_0x1e98f0[_0x10960d(0x14e)]=(0x0,utils_1[_0x10960d(0x104)])(_0x1e98f0[_0x10960d(0x14e)])),_0x33c396['userInfo']=_0x1e98f0;}),{'rows':_0x336509,'count':_0x3ab175};}async[_0xaa4c76(0xf3)](_0x103996){const _0x5bf9d0=_0xaa4c76;if(!_0x103996[_0x5bf9d0(0xf7)][_0x5bf9d0(0xe8)])return!![];return await this[_0x5bf9d0(0x119)][_0x5bf9d0(0x109)]({'id':(0x0,typeorm_1['In'])(_0x103996['ids'])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0xaa4c76(0x10f)])(badwords_entity_1[_0xaa4c76(0x123)])),__param(0x1,(0x0,typeorm_2[_0xaa4c76(0x10f)])(violationLog_entity_1[_0xaa4c76(0x12d)])),__metadata(_0xaa4c76(0xf5),[typeorm_1[_0xaa4c76(0x10c)],typeorm_1[_0xaa4c76(0x10c)],nestjs_cls_1[_0xaa4c76(0x101)],user_service_1[_0xaa4c76(0xfe)],globalConfig_service_1[_0xaa4c76(0x13d)]])],BadwordsService),exports[_0xaa4c76(0xe1)]=BadwordsService;