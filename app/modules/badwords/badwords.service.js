'use strict';const _0x201d84=_0x41f0;(function(_0x4f8c29,_0x362bb4){const _0x2f189f=_0x41f0,_0x28ecde=_0x4f8c29();while(!![]){try{const _0x500492=-parseInt(_0x2f189f(0x166))/0x1*(-parseInt(_0x2f189f(0x132))/0x2)+-parseInt(_0x2f189f(0x14f))/0x3+parseInt(_0x2f189f(0x10c))/0x4*(parseInt(_0x2f189f(0x15f))/0x5)+parseInt(_0x2f189f(0x13e))/0x6*(-parseInt(_0x2f189f(0x176))/0x7)+-parseInt(_0x2f189f(0x150))/0x8+-parseInt(_0x2f189f(0x17f))/0x9+parseInt(_0x2f189f(0x178))/0xa*(parseInt(_0x2f189f(0x130))/0xb);if(_0x500492===_0x362bb4)break;else _0x28ecde['push'](_0x28ecde['shift']());}catch(_0x30af27){_0x28ecde['push'](_0x28ecde['shift']());}}}(_0x1298,0x510bc));var __decorate=this&&this[_0x201d84(0x143)]||function(_0x4a05c9,_0x38d204,_0x276fb5,_0x55003f){const _0x1f8439=_0x201d84;var _0x2ec528=arguments[_0x1f8439(0x159)],_0x3dc138=_0x2ec528<0x3?_0x38d204:_0x55003f===null?_0x55003f=Object[_0x1f8439(0x11d)](_0x38d204,_0x276fb5):_0x55003f,_0x566668;if(typeof Reflect===_0x1f8439(0x164)&&typeof Reflect[_0x1f8439(0x17d)]==='function')_0x3dc138=Reflect['decorate'](_0x4a05c9,_0x38d204,_0x276fb5,_0x55003f);else{for(var _0x62491d=_0x4a05c9[_0x1f8439(0x159)]-0x1;_0x62491d>=0x0;_0x62491d--)if(_0x566668=_0x4a05c9[_0x62491d])_0x3dc138=(_0x2ec528<0x3?_0x566668(_0x3dc138):_0x2ec528>0x3?_0x566668(_0x38d204,_0x276fb5,_0x3dc138):_0x566668(_0x38d204,_0x276fb5))||_0x3dc138;}return _0x2ec528>0x3&&_0x3dc138&&Object['defineProperty'](_0x38d204,_0x276fb5,_0x3dc138),_0x3dc138;},__metadata=this&&this[_0x201d84(0x14b)]||function(_0x40bd3d,_0x41ea63){const _0x100af1=_0x201d84;if(typeof Reflect===_0x100af1(0x164)&&typeof Reflect[_0x100af1(0x11e)]===_0x100af1(0x16d))return Reflect[_0x100af1(0x11e)](_0x40bd3d,_0x41ea63);},__param=this&&this['__param']||function(_0x1e75e7,_0x26b035){return function(_0x521b03,_0xdbf3d){_0x26b035(_0x521b03,_0xdbf3d,_0x1e75e7);};};Object[_0x201d84(0x15a)](exports,_0x201d84(0x115),{'value':!![]}),exports[_0x201d84(0x17b)]=void 0x0;function _0x41f0(_0x1aff11,_0x3c41fe){const _0x129886=_0x1298();return _0x41f0=function(_0x41f048,_0x55cfd0){_0x41f048=_0x41f048-0x10c;let _0x1d9cec=_0x129886[_0x41f048];return _0x1d9cec;},_0x41f0(_0x1aff11,_0x3c41fe);}const globalConfig_service_1=require(_0x201d84(0x154)),common_1=require(_0x201d84(0x128)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require('typeorm'),typeorm_2=require(_0x201d84(0x167)),axios_1=require(_0x201d84(0x12c)),violationLog_entity_1=require('./violationLog.entity'),utils_1=require(_0x201d84(0x16c)),user_service_1=require('../user/user.service'),nestjs_cls_1=require(_0x201d84(0x153));function _0x1298(){const _0x2bb79c=['badWords','onModuleInit','save','的内容、我们已对您的账户进行标记、请合规使用！','440ImXHyz','百度文本检测出现错误、请查看配置信息:\x20','ClsService','application/x-www-form-urlencoded','word','object','customSensitiveWords','78905YcqRFd','@nestjs/typeorm','application/json','updateBadWords','update','map','../../common/utils','function','loadBadWords','ids','log','添加敏感词成功','word_list','您提交的信息中包含','msg','baiduTextAccessToken','3157PilxHA','ViolationLogEntity','1688510UdFWlC','InjectRepository','敏感词不存在,请检查您的提交信息','BadwordsService','baiduCheckBadWords','decorate','自定义','4261374fmrBsV','updateViolationCount','25056VBWQPN','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','design:paramtypes','delViolation','code','删除敏感词成功','checkBadWords','clsService','__esModule','ASC','NineAi检测','findAndCount','userId','getUserListByIds','typeOriginCn','push','getOwnPropertyDescriptor','metadata','stringify','globalConfigService','category','phone','violationLogEntity','join','find','DESC','baidu','@nestjs/common','violation','post','checkBadWordsByConfig','axios','UserService','nineaiCheckBadWords','includes','33TNxlmv','更新敏感词失败','14zBpeoc','***','敏感词已存在,请检查您的提交信息','email','formarTips','match','data','userInfo','user','default','的信息、我们已对您账号进行标记、请合规使用！','自定义检测','7422FFNCUD','更新敏感词成功','敏感词已经存在了、请勿重复添加','queryBadWords','nineai','__decorate','检测失败','hideString','HttpStatus','badWordsEntity','您提交的内容中包含','删除敏感词失败','BAD_REQUEST','__metadata','addBadWord','getSensitiveConfig','HttpException','451767FszPZe','769552camxdV','userservice','recordUserBadWords','nestjs-cls','./../globalConfig/globalConfig.service','Injectable','affected','GlobalConfigService','extractContent','length','defineProperty'];_0x1298=function(){return _0x2bb79c;};return _0x1298();}let BadwordsService=class BadwordsService{constructor(_0x2328df,_0x4fc225,_0x148c23,_0x3b1740,_0x3e6af7){const _0x283c42=_0x201d84;this[_0x283c42(0x147)]=_0x2328df,this['violationLogEntity']=_0x4fc225,this[_0x283c42(0x114)]=_0x148c23,this[_0x283c42(0x151)]=_0x3b1740,this['globalConfigService']=_0x3e6af7,this[_0x283c42(0x15b)]=[];}async[_0x201d84(0x15c)](){this['loadBadWords']();}async[_0x201d84(0x165)](_0x5c9327,_0x2a48ca){const _0x1df9d5=_0x201d84,_0x255ed4=[];for(let _0x9f0324=0x0;_0x9f0324<this['badWords'][_0x1df9d5(0x159)];_0x9f0324++){const _0x9ae006=this['badWords'][_0x9f0324];_0x5c9327[_0x1df9d5(0x12f)](_0x9ae006)&&_0x255ed4[_0x1df9d5(0x11c)](_0x9ae006);}if(_0x255ed4[_0x1df9d5(0x159)]){await this[_0x1df9d5(0x152)](_0x2a48ca,_0x5c9327,_0x255ed4,[_0x1df9d5(0x17e)],_0x1df9d5(0x13d));const _0x1ced78=_0x1df9d5(0x10e);throw new common_1[(_0x1df9d5(0x14e))](_0x1ced78,common_1[_0x1df9d5(0x146)][_0x1df9d5(0x14a)]);}return!![];}async[_0x201d84(0x113)](_0x2f41da,_0x43f4dd){const _0x721ec3=_0x201d84,_0x2d45c6=await this[_0x721ec3(0x120)][_0x721ec3(0x14d)]();_0x2d45c6&&await this['checkBadWordsByConfig'](_0x2f41da,_0x2d45c6,_0x43f4dd),await this[_0x721ec3(0x165)](_0x2f41da,_0x43f4dd);}async[_0x201d84(0x12b)](_0x3ad0b9,_0x4250cb,_0x5ba5bf){const _0x5574ed=_0x201d84,{useType:_0x4f3a54}=_0x4250cb;_0x4f3a54===_0x5574ed(0x127)&&await this[_0x5574ed(0x17c)](_0x3ad0b9,_0x4250cb[_0x5574ed(0x175)],_0x5ba5bf),_0x4f3a54===_0x5574ed(0x142)&&await this[_0x5574ed(0x12e)](_0x3ad0b9,_0x4250cb,_0x5ba5bf);}[_0x201d84(0x158)](_0x1852b7){const _0x447157=_0x201d84,_0x4c1ce8=/存在(.*?)不合规/,_0xc2e856=_0x1852b7[_0x447157(0x137)](_0x4c1ce8);return _0xc2e856?_0xc2e856[0x1]:'';}async[_0x201d84(0x17c)](_0x2a1213,_0x49d548,_0x302440){const _0x22d515=_0x201d84;if(!_0x49d548)return;const _0x169f07=_0x22d515(0x10d)+_0x49d548+'}',_0x372fb8={'Content-Type':_0x22d515(0x162),'Accept':'application/json'},_0x21113c=await axios_1[_0x22d515(0x13b)][_0x22d515(0x12a)](_0x169f07,{'text':_0x2a1213},{'headers':_0x372fb8}),{conclusion:_0x2231da,error_code:_0x8c7278,error_msg:_0x215563,conclusionType:_0x3bc82a,data:_0xd3ce2a}=_0x21113c[_0x22d515(0x138)];_0x8c7278&&console[_0x22d515(0x170)](_0x22d515(0x160),_0x215563);if(_0x3bc82a!==0x1){const _0x42f9a7=[...new Set(_0xd3ce2a[_0x22d515(0x16b)](_0x1ac2af=>this[_0x22d515(0x158)](_0x1ac2af[_0x22d515(0x174)])))];await this[_0x22d515(0x152)](_0x302440,_0x2a1213,[_0x22d515(0x133)],_0x42f9a7,'百度云检测');const _0x554e9c=_0x22d515(0x173)+_0x42f9a7[_0x22d515(0x124)](',')+_0x22d515(0x15e);throw new common_1[(_0x22d515(0x14e))](_0x554e9c,common_1[_0x22d515(0x146)][_0x22d515(0x14a)]);}}async[_0x201d84(0x12e)](_0x3cda89,_0x3defad,_0xe127ae){const _0x5851b8=_0x201d84,{nineaiBuiltInSensitiveApiBase:_0x442087,nineaiBuiltInSensitiveAuthKey:_0x531130}=_0x3defad;if(!_0x442087||!_0x531130)return;const _0x7c874=await axios_1['default'][_0x5851b8(0x12a)](_0x442087,{'content':_0x3cda89},{'headers':{'Content-Type':_0x5851b8(0x168),'Authorization':_0x531130}});if(!_0x7c874['data'])return;if(_0x7c874['data'][_0x5851b8(0x111)]!=='0'){const {msg:msg=_0x5851b8(0x144)}=_0x7c874[_0x5851b8(0x138)];throw new common_1[(_0x5851b8(0x14e))]('敏感词检测\x20|\x20'+msg,common_1[_0x5851b8(0x146)]['BAD_REQUEST']);}if(_0x7c874[_0x5851b8(0x138)][_0x5851b8(0x172)]&&_0x7c874[_0x5851b8(0x138)][_0x5851b8(0x172)]?.[_0x5851b8(0x159)]){const _0x5936c9=[...new Set(_0x7c874[_0x5851b8(0x138)]['word_list']['map'](_0x77bded=>_0x77bded['keyword']))],_0x3c80f6=[...new Set(_0x7c874[_0x5851b8(0x138)][_0x5851b8(0x172)][_0x5851b8(0x16b)](_0x4eb334=>_0x4eb334[_0x5851b8(0x121)]))];await this[_0x5851b8(0x152)](_0xe127ae,_0x3cda89,_0x5936c9,_0x3c80f6,_0x5851b8(0x117));const _0xa51c8b=this['formarTips'](_0x7c874[_0x5851b8(0x138)][_0x5851b8(0x172)]);throw new common_1[(_0x5851b8(0x14e))](_0xa51c8b,common_1[_0x5851b8(0x146)]['BAD_REQUEST']);}}[_0x201d84(0x136)](_0x40f4c7){const _0x5685de=_0x201d84,_0x17192e=_0x40f4c7['map'](_0xf616b3=>_0xf616b3[_0x5685de(0x121)]),_0x1bbd34=[...new Set(_0x17192e)];return _0x5685de(0x148)+_0x1bbd34['join'](',')+_0x5685de(0x13c);}async[_0x201d84(0x16e)](){const _0x46b896=_0x201d84,_0x448806=await this['badWordsEntity'][_0x46b896(0x125)]({'where':{'status':0x1},'select':[_0x46b896(0x163)]});this[_0x46b896(0x15b)]=_0x448806['map'](_0x5ba6f0=>_0x5ba6f0['word']);}async[_0x201d84(0x141)](_0x116bcd){const _0x43d6d9=_0x201d84,{page:page=0x1,size:size=0x1f4,word:_0xd2724c,status:_0x12ae55}=_0x116bcd,_0x2acf8c={};[0x0,0x1,'0','1'][_0x43d6d9(0x12f)](_0x12ae55)&&(_0x2acf8c['status']=_0x12ae55),_0xd2724c&&(_0x2acf8c[_0x43d6d9(0x163)]=(0x0,typeorm_1['Like'])('%'+_0xd2724c+'%'));const [_0x5f39eb,_0xa68297]=await this[_0x43d6d9(0x147)][_0x43d6d9(0x118)]({'where':_0x2acf8c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x43d6d9(0x116)}});return{'rows':_0x5f39eb,'count':_0xa68297};}async['delBadWords'](_0x3b355a){const _0xba54fa=_0x201d84,_0x308b1b=await this[_0xba54fa(0x147)]['findOne']({'where':{'id':_0x3b355a['id']}});if(!_0x308b1b)throw new common_1[(_0xba54fa(0x14e))](_0xba54fa(0x17a),common_1[_0xba54fa(0x146)]['BAD_REQUEST']);const _0x5df4cb=await this[_0xba54fa(0x147)]['delete']({'id':_0x3b355a['id']});if(_0x5df4cb[_0xba54fa(0x156)]>0x0)return await this['loadBadWords'](),_0xba54fa(0x112);else throw new common_1[(_0xba54fa(0x14e))](_0xba54fa(0x149),common_1['HttpStatus'][_0xba54fa(0x14a)]);}async[_0x201d84(0x169)](_0x4c2e8){const _0x64fff7=_0x201d84,{id:_0x574b1f,word:_0x46969f,status:_0x1e5b67}=_0x4c2e8,_0x457e1e=await this[_0x64fff7(0x147)]['findOne']({'where':{'word':_0x46969f}});if(_0x457e1e)throw new common_1[(_0x64fff7(0x14e))](_0x64fff7(0x140),common_1['HttpStatus'][_0x64fff7(0x14a)]);const _0x514322=await this[_0x64fff7(0x147)][_0x64fff7(0x16a)]({'id':_0x574b1f},{'word':_0x46969f,'status':_0x1e5b67});if(_0x514322[_0x64fff7(0x156)]>0x0)return await this[_0x64fff7(0x16e)](),_0x64fff7(0x13f);else throw new common_1[(_0x64fff7(0x14e))](_0x64fff7(0x131),common_1[_0x64fff7(0x146)][_0x64fff7(0x14a)]);}async[_0x201d84(0x14c)](_0x462dae){const _0xd94b23=_0x201d84,{word:_0x5b0d24}=_0x462dae,_0xf15dda=await this[_0xd94b23(0x147)]['findOne']({'where':{'word':_0x5b0d24}});if(_0xf15dda)throw new common_1[(_0xd94b23(0x14e))](_0xd94b23(0x134),common_1['HttpStatus'][_0xd94b23(0x14a)]);return await this['badWordsEntity'][_0xd94b23(0x15d)]({'word':_0x5b0d24}),await this[_0xd94b23(0x16e)](),_0xd94b23(0x171);}async[_0x201d84(0x152)](_0x3f1405,_0x4cc159,_0x1bebc3,_0x390939,_0x1f8c9f){const _0x3edd12=_0x201d84,_0x273bee={'userId':_0x3f1405,'content':_0x4cc159,'words':JSON[_0x3edd12(0x11f)](_0x1bebc3),'typeCn':JSON[_0x3edd12(0x11f)](_0x390939),'typeOriginCn':_0x1f8c9f};try{await this['userservice'][_0x3edd12(0x180)](_0x3f1405),await this['violationLogEntity'][_0x3edd12(0x15d)](_0x273bee);}catch(_0x3686c7){console[_0x3edd12(0x170)]('error:\x20',_0x3686c7);}}async[_0x201d84(0x129)](_0x1080df,_0x3e273c){const _0x2b48bb=_0x201d84,{role:_0x2e96dd}=_0x1080df[_0x2b48bb(0x13a)],{page:page=0x1,size:size=0xa,userId:_0x2ce37d,typeOriginCn:_0x2ea5bb}=_0x3e273c,_0x590767={'delFlag':0x0};_0x2ce37d&&(_0x590767[_0x2b48bb(0x119)]=_0x2ce37d),_0x2ea5bb&&(_0x590767[_0x2b48bb(0x11b)]=_0x2ea5bb);const [_0x45af7e,_0x14d092]=await this[_0x2b48bb(0x123)]['findAndCount']({'where':_0x590767,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x2b48bb(0x126)}}),_0x829a9c=[...new Set(_0x45af7e[_0x2b48bb(0x16b)](_0x5e6ec7=>_0x5e6ec7[_0x2b48bb(0x119)]))],_0xd2c190=await this['userservice'][_0x2b48bb(0x11a)](_0x829a9c);return _0x45af7e['forEach'](_0x27113c=>{const _0x4b0d23=_0x2b48bb,_0x542875=_0xd2c190[_0x4b0d23(0x125)](_0x27220a=>_0x27220a['id']===_0x27113c[_0x4b0d23(0x119)]);!(0x0,utils_1['isSuper'])(this[_0x4b0d23(0x114)])&&(_0x542875['email']=(0x0,utils_1['hideString'])(_0x542875[_0x4b0d23(0x135)]),_0x542875[_0x4b0d23(0x122)]=(0x0,utils_1[_0x4b0d23(0x145)])(_0x542875[_0x4b0d23(0x122)])),_0x27113c[_0x4b0d23(0x139)]=_0x542875;}),{'rows':_0x45af7e,'count':_0x14d092};}async[_0x201d84(0x110)](_0x10f550){const _0x1e040f=_0x201d84;if(!_0x10f550[_0x1e040f(0x16f)][_0x1e040f(0x159)])return!![];return await this[_0x1e040f(0x123)][_0x1e040f(0x16a)]({'id':(0x0,typeorm_1['In'])(_0x10f550[_0x1e040f(0x16f)])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1[_0x201d84(0x155)])(),__param(0x0,(0x0,typeorm_2[_0x201d84(0x179)])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0x201d84(0x179)])(violationLog_entity_1[_0x201d84(0x177)])),__metadata(_0x201d84(0x10f),[typeorm_1['Repository'],typeorm_1['Repository'],nestjs_cls_1[_0x201d84(0x161)],user_service_1[_0x201d84(0x12d)],globalConfig_service_1[_0x201d84(0x157)]])],BadwordsService),exports[_0x201d84(0x17b)]=BadwordsService;