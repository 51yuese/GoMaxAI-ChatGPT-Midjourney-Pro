'use strict';const _0x38f842=_0x3044;(function(_0x34c464,_0x7161e1){const _0x364dc7=_0x3044,_0x3fa9f0=_0x34c464();while(!![]){try{const _0x196e8b=parseInt(_0x364dc7(0x1d4))/0x1*(parseInt(_0x364dc7(0x212))/0x2)+parseInt(_0x364dc7(0x1e8))/0x3+parseInt(_0x364dc7(0x1c8))/0x4+parseInt(_0x364dc7(0x219))/0x5*(-parseInt(_0x364dc7(0x20f))/0x6)+-parseInt(_0x364dc7(0x1f5))/0x7*(-parseInt(_0x364dc7(0x1e1))/0x8)+-parseInt(_0x364dc7(0x1f0))/0x9*(parseInt(_0x364dc7(0x1fb))/0xa)+-parseInt(_0x364dc7(0x1f8))/0xb;if(_0x196e8b===_0x7161e1)break;else _0x3fa9f0['push'](_0x3fa9f0['shift']());}catch(_0x576707){_0x3fa9f0['push'](_0x3fa9f0['shift']());}}}(_0x439c,0xcbe34));var __decorate=this&&this['__decorate']||function(_0x585147,_0x340098,_0xd2126b,_0x3336fc){const _0x1ec55e=_0x3044;var _0x1e8d35=arguments['length'],_0x40e0fc=_0x1e8d35<0x3?_0x340098:_0x3336fc===null?_0x3336fc=Object[_0x1ec55e(0x1cd)](_0x340098,_0xd2126b):_0x3336fc,_0x1e3173;if(typeof Reflect===_0x1ec55e(0x1b5)&&typeof Reflect[_0x1ec55e(0x1bf)]===_0x1ec55e(0x207))_0x40e0fc=Reflect[_0x1ec55e(0x1bf)](_0x585147,_0x340098,_0xd2126b,_0x3336fc);else{for(var _0xcd91e9=_0x585147[_0x1ec55e(0x1bb)]-0x1;_0xcd91e9>=0x0;_0xcd91e9--)if(_0x1e3173=_0x585147[_0xcd91e9])_0x40e0fc=(_0x1e8d35<0x3?_0x1e3173(_0x40e0fc):_0x1e8d35>0x3?_0x1e3173(_0x340098,_0xd2126b,_0x40e0fc):_0x1e3173(_0x340098,_0xd2126b))||_0x40e0fc;}return _0x1e8d35>0x3&&_0x40e0fc&&Object['defineProperty'](_0x340098,_0xd2126b,_0x40e0fc),_0x40e0fc;},__metadata=this&&this[_0x38f842(0x21c)]||function(_0x31a880,_0x32e412){const _0x5924ae=_0x38f842;if(typeof Reflect==='object'&&typeof Reflect[_0x5924ae(0x1dd)]===_0x5924ae(0x207))return Reflect[_0x5924ae(0x1dd)](_0x31a880,_0x32e412);},__param=this&&this[_0x38f842(0x1ce)]||function(_0x2af232,_0x316111){return function(_0x2da30,_0x3d8dd8){_0x316111(_0x2da30,_0x3d8dd8,_0x2af232);};};function _0x439c(){const _0xdb258a=['isSuper','52493NEqhlY','GlobalConfigService','添加敏感词成功','15748524Bxxays','violationLogEntity','@nestjs/common','250ENvyTY','ViolationLogEntity','map','update','UserService','recordUserBadWords','checkBadWords','删除敏感词失败','您提交的信息中包含','push','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','userId','function','default','删除敏感词成功','DESC','match','user','extractContent','BAD_REQUEST','606XzPjZr','Like','clsService','268nIPsRK','更新敏感词成功','HttpStatus','loadBadWords','ClsService','log','findAndCount','37735hDxsPf','globalConfigService','msg','__metadata','typeorm','./violationLog.entity','敏感词已存在,请检查您的提交信息','design:paramtypes','getUserListByIds','stringify','delBadWords','join','object','自定义检测','updateViolationCount','word','getSensitiveConfig','敏感词已经存在了、请勿重复添加','length','检测失败','您提交的内容中包含','data','decorate','defineProperty','__esModule','category','nineaiCheckBadWords','./badwords.entity','axios','userInfo','email','611796bjZAbd','@nestjs/typeorm','***','onModuleInit','更新敏感词失败','getOwnPropertyDescriptor','__param','userservice','word_list','badWords','敏感词不存在,请检查您的提交信息','敏感词检测\x20|\x20','12356xLPaAD','delViolation','../../common/utils','findOne','ASC','Repository','includes','phone','nestjs-cls','metadata','badWordsEntity','affected','application/x-www-form-urlencoded','1416rwSSWO','自定义','post','BadwordsService','application/json','hideString','formarTips','3028587baivPH','NineAi检测','customSensitiveWords','save','error:\x20','HttpException','status','find','401922WAxOrw','的信息、我们已对您账号进行标记、请合规使用！','ids','baiduCheckBadWords'];_0x439c=function(){return _0xdb258a;};return _0x439c();}Object[_0x38f842(0x1c0)](exports,_0x38f842(0x1c1),{'value':!![]}),exports[_0x38f842(0x1e4)]=void 0x0;function _0x3044(_0x43081e,_0x19bdd7){const _0x439c76=_0x439c();return _0x3044=function(_0x304416,_0x8cb791){_0x304416=_0x304416-0x1b1;let _0x53aff1=_0x439c76[_0x304416];return _0x53aff1;},_0x3044(_0x43081e,_0x19bdd7);}const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x38f842(0x1fa)),badwords_entity_1=require(_0x38f842(0x1c4)),typeorm_1=require(_0x38f842(0x21d)),typeorm_2=require(_0x38f842(0x1c9)),axios_1=require(_0x38f842(0x1c5)),violationLog_entity_1=require(_0x38f842(0x21e)),utils_1=require(_0x38f842(0x1d6)),user_service_1=require('../user/user.service'),nestjs_cls_1=require(_0x38f842(0x1dc));let BadwordsService=class BadwordsService{constructor(_0x2672fb,_0x2b1917,_0x38dbd1,_0x2f6deb,_0x48f241){const _0x5d752f=_0x38f842;this['badWordsEntity']=_0x2672fb,this[_0x5d752f(0x1f9)]=_0x2b1917,this[_0x5d752f(0x211)]=_0x38dbd1,this[_0x5d752f(0x1cf)]=_0x2f6deb,this[_0x5d752f(0x21a)]=_0x48f241,this[_0x5d752f(0x1d1)]=[];}async[_0x38f842(0x1cb)](){this['loadBadWords']();}async[_0x38f842(0x1ea)](_0x107458,_0x244616){const _0x2e0a08=_0x38f842,_0xad2e32=[];for(let _0x6ff682=0x0;_0x6ff682<this[_0x2e0a08(0x1d1)]['length'];_0x6ff682++){const _0x33dc1a=this[_0x2e0a08(0x1d1)][_0x6ff682];_0x107458[_0x2e0a08(0x1da)](_0x33dc1a)&&_0xad2e32[_0x2e0a08(0x204)](_0x33dc1a);}if(_0xad2e32[_0x2e0a08(0x1bb)]){await this[_0x2e0a08(0x200)](_0x244616,_0x107458,_0xad2e32,[_0x2e0a08(0x1e2)],_0x2e0a08(0x1b6));const _0x4e6eeb='您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x2e0a08(0x1ed))](_0x4e6eeb,common_1[_0x2e0a08(0x214)][_0x2e0a08(0x20e)]);}return!![];}async[_0x38f842(0x201)](_0x1b6174,_0x3dab38){const _0x52d995=_0x38f842,_0x5a7be3=await this['globalConfigService'][_0x52d995(0x1b9)]();_0x5a7be3&&await this['checkBadWordsByConfig'](_0x1b6174,_0x5a7be3,_0x3dab38),console[_0x52d995(0x217)]('================================TASK==================================='),await this[_0x52d995(0x1ea)](_0x1b6174,_0x3dab38);}async['checkBadWordsByConfig'](_0x163a3e,_0x1af34c,_0x5e36fc){const _0x1cf54e=_0x38f842,{useType:_0x1cb661}=_0x1af34c;_0x1cb661==='baidu'&&await this[_0x1cf54e(0x1f3)](_0x163a3e,_0x1af34c['baiduTextAccessToken'],_0x5e36fc),_0x1cb661==='nineai'&&await this[_0x1cf54e(0x1c3)](_0x163a3e,_0x1af34c,_0x5e36fc);}['extractContent'](_0x51c0c0){const _0x21fbd4=_0x38f842,_0xf972=/存在(.*?)不合规/,_0x812771=_0x51c0c0[_0x21fbd4(0x20b)](_0xf972);return _0x812771?_0x812771[0x1]:'';}async[_0x38f842(0x1f3)](_0x2d95bf,_0x2a9731,_0xe782b8){const _0x58ba1c=_0x38f842;if(!_0x2a9731)return;const _0x180b4d=_0x58ba1c(0x205)+_0x2a9731+'}',_0x570f7f={'Content-Type':_0x58ba1c(0x1e0),'Accept':'application/json'},_0x57931f=await axios_1['default']['post'](_0x180b4d,{'text':_0x2d95bf},{'headers':_0x570f7f}),{conclusion:_0x144f0c,error_code:_0x5604dc,error_msg:_0x5ea236,conclusionType:_0x38de27,data:_0x26c348}=_0x57931f[_0x58ba1c(0x1be)];_0x5604dc&&console[_0x58ba1c(0x217)]('百度文本检测出现错误、请查看配置信息:\x20',_0x5ea236);if(_0x38de27!==0x1){const _0x7695fa=[...new Set(_0x26c348[_0x58ba1c(0x1fd)](_0x5d6a89=>this[_0x58ba1c(0x20d)](_0x5d6a89[_0x58ba1c(0x21b)])))];await this['recordUserBadWords'](_0xe782b8,_0x2d95bf,[_0x58ba1c(0x1ca)],_0x7695fa,'百度云检测');const _0xc242f6=_0x58ba1c(0x203)+_0x7695fa['join'](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x58ba1c(0x1ed))](_0xc242f6,common_1[_0x58ba1c(0x214)]['BAD_REQUEST']);}}async[_0x38f842(0x1c3)](_0x36caab,_0x46682c,_0x585af5){const _0x1e0b3d=_0x38f842,{nineaiBuiltInSensitiveApiBase:_0x373369,nineaiBuiltInSensitiveAuthKey:_0x316b6d}=_0x46682c;if(!_0x373369||!_0x316b6d)return;const _0x1f49cf=await axios_1[_0x1e0b3d(0x208)][_0x1e0b3d(0x1e3)](_0x373369,{'content':_0x36caab},{'headers':{'Content-Type':_0x1e0b3d(0x1e5),'Authorization':_0x316b6d}});if(!_0x1f49cf[_0x1e0b3d(0x1be)])return;if(_0x1f49cf[_0x1e0b3d(0x1be)]['code']!=='0'){const {msg:msg=_0x1e0b3d(0x1bc)}=_0x1f49cf['data'];throw new common_1[(_0x1e0b3d(0x1ed))](_0x1e0b3d(0x1d3)+msg,common_1[_0x1e0b3d(0x214)][_0x1e0b3d(0x20e)]);}if(_0x1f49cf[_0x1e0b3d(0x1be)]['word_list']&&_0x1f49cf[_0x1e0b3d(0x1be)][_0x1e0b3d(0x1d0)]?.['length']){const _0x53d13a=[...new Set(_0x1f49cf[_0x1e0b3d(0x1be)]['word_list']['map'](_0x13755b=>_0x13755b['keyword']))],_0x334012=[...new Set(_0x1f49cf[_0x1e0b3d(0x1be)][_0x1e0b3d(0x1d0)][_0x1e0b3d(0x1fd)](_0xca9164=>_0xca9164[_0x1e0b3d(0x1c2)]))];await this['recordUserBadWords'](_0x585af5,_0x36caab,_0x53d13a,_0x334012,_0x1e0b3d(0x1e9));const _0x4faca1=this[_0x1e0b3d(0x1e7)](_0x1f49cf[_0x1e0b3d(0x1be)][_0x1e0b3d(0x1d0)]);throw new common_1['HttpException'](_0x4faca1,common_1[_0x1e0b3d(0x214)]['BAD_REQUEST']);}}[_0x38f842(0x1e7)](_0x4bf491){const _0x919a44=_0x38f842,_0x175ae4=_0x4bf491[_0x919a44(0x1fd)](_0x3d075f=>_0x3d075f['category']),_0x2612e8=[...new Set(_0x175ae4)];return _0x919a44(0x1bd)+_0x2612e8[_0x919a44(0x1b4)](',')+_0x919a44(0x1f1);}async[_0x38f842(0x215)](){const _0x5004f5=_0x38f842,_0x5182cb=await this[_0x5004f5(0x1de)]['find']({'where':{'status':0x1},'select':[_0x5004f5(0x1b8)]});this['badWords']=_0x5182cb['map'](_0x56bd69=>_0x56bd69['word']);}async['queryBadWords'](_0x2bf358){const _0x159867=_0x38f842,{page:page=0x1,size:size=0x1f4,word:_0x9ad7f4,status:_0x1ef39a}=_0x2bf358,_0x438bc1={};[0x0,0x1,'0','1'][_0x159867(0x1da)](_0x1ef39a)&&(_0x438bc1[_0x159867(0x1ee)]=_0x1ef39a),_0x9ad7f4&&(_0x438bc1[_0x159867(0x1b8)]=(0x0,typeorm_1[_0x159867(0x210)])('%'+_0x9ad7f4+'%'));const [_0x201a62,_0x1ed32a]=await this[_0x159867(0x1de)][_0x159867(0x218)]({'where':_0x438bc1,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x159867(0x1d8)}});return{'rows':_0x201a62,'count':_0x1ed32a};}async[_0x38f842(0x1b3)](_0x3f5cc0){const _0x5e8358=_0x38f842,_0x13beff=await this[_0x5e8358(0x1de)][_0x5e8358(0x1d7)]({'where':{'id':_0x3f5cc0['id']}});if(!_0x13beff)throw new common_1[(_0x5e8358(0x1ed))](_0x5e8358(0x1d2),common_1[_0x5e8358(0x214)][_0x5e8358(0x20e)]);const _0x5ab1b2=await this[_0x5e8358(0x1de)]['delete']({'id':_0x3f5cc0['id']});if(_0x5ab1b2['affected']>0x0)return await this['loadBadWords'](),_0x5e8358(0x209);else throw new common_1[(_0x5e8358(0x1ed))](_0x5e8358(0x202),common_1[_0x5e8358(0x214)][_0x5e8358(0x20e)]);}async['updateBadWords'](_0x3ae2ab){const _0xd0aadc=_0x38f842,{id:_0x3ae2be,word:_0x31aca7,status:_0x33e6ee}=_0x3ae2ab,_0x303c62=await this[_0xd0aadc(0x1de)][_0xd0aadc(0x1d7)]({'where':{'word':_0x31aca7}});if(_0x303c62)throw new common_1[(_0xd0aadc(0x1ed))](_0xd0aadc(0x1ba),common_1[_0xd0aadc(0x214)][_0xd0aadc(0x20e)]);const _0x440a75=await this[_0xd0aadc(0x1de)]['update']({'id':_0x3ae2be},{'word':_0x31aca7,'status':_0x33e6ee});if(_0x440a75[_0xd0aadc(0x1df)]>0x0)return await this[_0xd0aadc(0x215)](),_0xd0aadc(0x213);else throw new common_1[(_0xd0aadc(0x1ed))](_0xd0aadc(0x1cc),common_1[_0xd0aadc(0x214)]['BAD_REQUEST']);}async['addBadWord'](_0xd9a351){const _0x2a2e31=_0x38f842,{word:_0x1c0398}=_0xd9a351,_0x181cae=await this[_0x2a2e31(0x1de)][_0x2a2e31(0x1d7)]({'where':{'word':_0x1c0398}});if(_0x181cae)throw new common_1[(_0x2a2e31(0x1ed))](_0x2a2e31(0x21f),common_1[_0x2a2e31(0x214)][_0x2a2e31(0x20e)]);return await this[_0x2a2e31(0x1de)][_0x2a2e31(0x1eb)]({'word':_0x1c0398}),await this[_0x2a2e31(0x215)](),_0x2a2e31(0x1f7);}async['recordUserBadWords'](_0x4308e2,_0x22f016,_0xb1736a,_0x4372b8,_0x197887){const _0x5d96a3=_0x38f842,_0x166d95={'userId':_0x4308e2,'content':_0x22f016,'words':JSON[_0x5d96a3(0x1b2)](_0xb1736a),'typeCn':JSON[_0x5d96a3(0x1b2)](_0x4372b8),'typeOriginCn':_0x197887};try{await this[_0x5d96a3(0x1cf)][_0x5d96a3(0x1b7)](_0x4308e2),await this['violationLogEntity'][_0x5d96a3(0x1eb)](_0x166d95);}catch(_0x1d8630){console[_0x5d96a3(0x217)](_0x5d96a3(0x1ec),_0x1d8630);}}async['violation'](_0x4d75ab,_0x1f067d){const _0x5135fa=_0x38f842,{role:_0x5e69b0}=_0x4d75ab[_0x5135fa(0x20c)],{page:page=0x1,size:size=0xa,userId:_0x46ab5c,typeOriginCn:_0x5e3142}=_0x1f067d,_0x2f6a56={'delFlag':0x0};_0x46ab5c&&(_0x2f6a56[_0x5135fa(0x206)]=_0x46ab5c),_0x5e3142&&(_0x2f6a56['typeOriginCn']=_0x5e3142);const [_0xca894,_0x36a8af]=await this[_0x5135fa(0x1f9)][_0x5135fa(0x218)]({'where':_0x2f6a56,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5135fa(0x20a)}}),_0x3bfd17=[...new Set(_0xca894['map'](_0x55ca4c=>_0x55ca4c[_0x5135fa(0x206)]))],_0x4f08cd=await this[_0x5135fa(0x1cf)][_0x5135fa(0x1b1)](_0x3bfd17);return _0xca894['forEach'](_0x132e51=>{const _0x177117=_0x5135fa,_0x2ce70c=_0x4f08cd[_0x177117(0x1ef)](_0x18ae39=>_0x18ae39['id']===_0x132e51['userId']);!(0x0,utils_1[_0x177117(0x1f4)])(this['clsService'])&&(_0x2ce70c[_0x177117(0x1c7)]=(0x0,utils_1[_0x177117(0x1e6)])(_0x2ce70c[_0x177117(0x1c7)]),_0x2ce70c[_0x177117(0x1db)]=(0x0,utils_1['hideString'])(_0x2ce70c[_0x177117(0x1db)])),_0x132e51[_0x177117(0x1c6)]=_0x2ce70c;}),{'rows':_0xca894,'count':_0x36a8af};}async[_0x38f842(0x1d5)](_0x25b1c3){const _0x467cea=_0x38f842;if(!_0x25b1c3[_0x467cea(0x1f2)]['length'])return!![];return await this[_0x467cea(0x1f9)][_0x467cea(0x1fe)]({'id':(0x0,typeorm_1['In'])(_0x25b1c3[_0x467cea(0x1f2)])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x38f842(0x1fc)])),__metadata(_0x38f842(0x220),[typeorm_1[_0x38f842(0x1d9)],typeorm_1['Repository'],nestjs_cls_1[_0x38f842(0x216)],user_service_1[_0x38f842(0x1ff)],globalConfig_service_1[_0x38f842(0x1f6)]])],BadwordsService),exports[_0x38f842(0x1e4)]=BadwordsService;