'use strict';const _0x22caa5=_0x130a;(function(_0x36da10,_0x255824){const _0x3c8e51=_0x130a,_0x2a391d=_0x36da10();while(!![]){try{const _0x426902=parseInt(_0x3c8e51(0x19f))/0x1*(parseInt(_0x3c8e51(0x168))/0x2)+-parseInt(_0x3c8e51(0x140))/0x3+parseInt(_0x3c8e51(0x147))/0x4*(-parseInt(_0x3c8e51(0x186))/0x5)+parseInt(_0x3c8e51(0x192))/0x6+-parseInt(_0x3c8e51(0x18d))/0x7+-parseInt(_0x3c8e51(0x12d))/0x8*(parseInt(_0x3c8e51(0x13a))/0x9)+parseInt(_0x3c8e51(0x196))/0xa*(parseInt(_0x3c8e51(0x194))/0xb);if(_0x426902===_0x255824)break;else _0x2a391d['push'](_0x2a391d['shift']());}catch(_0x3435ff){_0x2a391d['push'](_0x2a391d['shift']());}}}(_0x50de,0xa6661));function _0x130a(_0xb20e08,_0xfad220){const _0x50de8b=_0x50de();return _0x130a=function(_0x130a79,_0x2ddee4){_0x130a79=_0x130a79-0x12d;let _0x315cc1=_0x50de8b[_0x130a79];return _0x315cc1;},_0x130a(_0xb20e08,_0xfad220);}function _0x50de(){const _0x4cfbf5=['keyword','find','删除敏感词成功','metadata','decorate','includes','./../globalConfig/globalConfig.service','nineaiCheckBadWords','word','检测失败','typeOriginCn','typeorm','================================TASK===================================','__metadata','baiduTextAccessToken','map','customSensitiveWords','category','formarTips','../user/user.service','-------------BaiduBadWord---------','敏感词不存在,请检查您的提交信息','百度文本检测出现错误、请查看配置信息:\x20','GlobalConfigService','stringify','NineAi检测','HttpException','userId','application/x-www-form-urlencoded','1629638YhgUQL','***','default','email','onModuleInit','violation','的信息、我们已对您账号进行标记、请合规使用！','user','删除敏感词失败','HttpStatus','敏感词已经存在了、请勿重复添加','findAndCount','敏感词检测\x20|\x20','getUserListByIds','BAD_REQUEST','userInfo','baidu','join','Repository','./violationLog.entity','violationLogEntity','log','../../common/utils','forEach','__param','InjectRepository','recordUserBadWords','自定义检测','delBadWords','您提交的信息中包含','35UFhUXm','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','data','save','自定义','checkBadWordsByConfig','post','435372GkAfFk','__esModule','match','updateBadWords','updateViolationCount','2599962kBUAAZ','BadWordsEntity','19969433LwaGOY','hideString','10qznvZJ','findOne','queryBadWords','application/json','extractContent','badWords','nineai','object','BadwordsService','1SyTtCp','ClsService','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','word_list','592BJUcgm','clsService','userservice','badWordsEntity','ids','phone','length','update','Like','axios','的内容、我们已对您的账户进行标记、请合规使用！','./badwords.entity','ASC','110214kdjkMZ','defineProperty','百度云检测','DESC','function','addBadWord','2485959TtydCg','添加敏感词成功','delViolation','globalConfigService','msg','affected','error:\x20','334244VwWRyd','更新敏感词成功','loadBadWords','nestjs-cls'];_0x50de=function(){return _0x4cfbf5;};return _0x50de();}var __decorate=this&&this['__decorate']||function(_0x36d7a8,_0x1655a5,_0x67cb5e,_0x4866b8){const _0x4efe35=_0x130a;var _0x34beff=arguments[_0x4efe35(0x133)],_0xcb3806=_0x34beff<0x3?_0x1655a5:_0x4866b8===null?_0x4866b8=Object['getOwnPropertyDescriptor'](_0x1655a5,_0x67cb5e):_0x4866b8,_0x4aa3b5;if(typeof Reflect===_0x4efe35(0x19d)&&typeof Reflect[_0x4efe35(0x14f)]===_0x4efe35(0x13e))_0xcb3806=Reflect['decorate'](_0x36d7a8,_0x1655a5,_0x67cb5e,_0x4866b8);else{for(var _0x1c856d=_0x36d7a8['length']-0x1;_0x1c856d>=0x0;_0x1c856d--)if(_0x4aa3b5=_0x36d7a8[_0x1c856d])_0xcb3806=(_0x34beff<0x3?_0x4aa3b5(_0xcb3806):_0x34beff>0x3?_0x4aa3b5(_0x1655a5,_0x67cb5e,_0xcb3806):_0x4aa3b5(_0x1655a5,_0x67cb5e))||_0xcb3806;}return _0x34beff>0x3&&_0xcb3806&&Object[_0x4efe35(0x13b)](_0x1655a5,_0x67cb5e,_0xcb3806),_0xcb3806;},__metadata=this&&this[_0x22caa5(0x158)]||function(_0x47bbcf,_0x2a3e94){const _0x482c40=_0x22caa5;if(typeof Reflect===_0x482c40(0x19d)&&typeof Reflect[_0x482c40(0x14e)]===_0x482c40(0x13e))return Reflect[_0x482c40(0x14e)](_0x47bbcf,_0x2a3e94);},__param=this&&this[_0x22caa5(0x180)]||function(_0x41356d,_0x1054b3){return function(_0x3a882b,_0x586e96){_0x1054b3(_0x3a882b,_0x586e96,_0x41356d);};};Object['defineProperty'](exports,_0x22caa5(0x18e),{'value':!![]}),exports[_0x22caa5(0x19e)]=void 0x0;const globalConfig_service_1=require(_0x22caa5(0x151)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x22caa5(0x138)),typeorm_1=require(_0x22caa5(0x156)),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0x22caa5(0x136)),violationLog_entity_1=require(_0x22caa5(0x17b)),utils_1=require(_0x22caa5(0x17e)),user_service_1=require(_0x22caa5(0x15e)),nestjs_cls_1=require(_0x22caa5(0x14a));let BadwordsService=class BadwordsService{constructor(_0x1283ab,_0x2fc9c6,_0x245150,_0xaddcb4,_0x4f7a53){const _0x293c1e=_0x22caa5;this[_0x293c1e(0x130)]=_0x1283ab,this[_0x293c1e(0x17c)]=_0x2fc9c6,this['clsService']=_0x245150,this[_0x293c1e(0x12f)]=_0xaddcb4,this[_0x293c1e(0x143)]=_0x4f7a53,this[_0x293c1e(0x19b)]=[];}async[_0x22caa5(0x16c)](){const _0x309a6b=_0x22caa5;this[_0x309a6b(0x149)]();}async['customSensitiveWords'](_0x167ec8,_0x402f61){const _0xa7ce01=_0x22caa5,_0xce056b=[];for(let _0x35cb6e=0x0;_0x35cb6e<this[_0xa7ce01(0x19b)][_0xa7ce01(0x133)];_0x35cb6e++){const _0x14e953=this[_0xa7ce01(0x19b)][_0x35cb6e];_0x167ec8[_0xa7ce01(0x150)](_0x14e953)&&_0xce056b['push'](_0x14e953);}if(_0xce056b['length']){await this[_0xa7ce01(0x182)](_0x402f61,_0x167ec8,_0xce056b,[_0xa7ce01(0x18a)],_0xa7ce01(0x183));const _0x4c56b8=_0xa7ce01(0x187);throw new common_1[(_0xa7ce01(0x165))](_0x4c56b8,common_1[_0xa7ce01(0x171)][_0xa7ce01(0x176)]);}return!![];}async['checkBadWords'](_0x41b226,_0x1b2df0){const _0x5bba77=_0x22caa5,_0x2b673f=await this[_0x5bba77(0x143)]['getSensitiveConfig']();_0x2b673f&&await this[_0x5bba77(0x18b)](_0x41b226,_0x2b673f,_0x1b2df0),console['log'](_0x5bba77(0x157)),await this[_0x5bba77(0x15b)](_0x41b226,_0x1b2df0);}async[_0x22caa5(0x18b)](_0x437e97,_0x53d8a7,_0x262c7c){const _0x1b6389=_0x22caa5,{useType:_0x492b4e}=_0x53d8a7;_0x492b4e===_0x1b6389(0x178)&&await this['baiduCheckBadWords'](_0x437e97,_0x53d8a7[_0x1b6389(0x159)],_0x262c7c),_0x492b4e===_0x1b6389(0x19c)&&await this[_0x1b6389(0x152)](_0x437e97,_0x53d8a7,_0x262c7c);}[_0x22caa5(0x19a)](_0x3aa4ce){const _0x1f653c=_0x22caa5,_0xb63cc3=/存在(.*?)不合规/,_0x332dab=_0x3aa4ce[_0x1f653c(0x18f)](_0xb63cc3);return _0x332dab?_0x332dab[0x1]:'';}async['baiduCheckBadWords'](_0x14ab2e,_0x38b931,_0x228fd0){const _0x436243=_0x22caa5;if(!_0x38b931)return;const _0x454d66=_0x436243(0x1a1)+_0x38b931+'}',_0x1a30c0={'Content-Type':_0x436243(0x167),'Accept':_0x436243(0x199)},_0x5d0044=await axios_1[_0x436243(0x16a)][_0x436243(0x18c)](_0x454d66,{'text':_0x14ab2e},{'headers':_0x1a30c0}),{conclusion:_0x3ddc5f,error_code:_0x40ca9b,error_msg:_0xd726b6,conclusionType:_0xbb8c8c,data:_0x45f488}=_0x5d0044['data'];console['log'](_0x436243(0x15f),_0x5d0044[_0x436243(0x188)]);if(_0x40ca9b){console['log'](_0x436243(0x161),_0xd726b6);return;}if(_0xbb8c8c!==0x1){const _0x34bf2e=[...new Set(_0x45f488[_0x436243(0x15a)](_0x30e87a=>this[_0x436243(0x19a)](_0x30e87a[_0x436243(0x144)])))];await this[_0x436243(0x182)](_0x228fd0,_0x14ab2e,[_0x436243(0x169)],_0x34bf2e,_0x436243(0x13c));const _0x1c39b8=_0x436243(0x185)+_0x34bf2e['join'](',')+_0x436243(0x137);throw new common_1[(_0x436243(0x165))](_0x1c39b8,common_1[_0x436243(0x171)][_0x436243(0x176)]);}}async[_0x22caa5(0x152)](_0x210c09,_0x4528b2,_0x3e01c2){const _0x5d5d43=_0x22caa5,{nineaiBuiltInSensitiveApiBase:_0x23c1e3,nineaiBuiltInSensitiveAuthKey:_0x1bab1f}=_0x4528b2;if(!_0x23c1e3||!_0x1bab1f)return;const _0x5dd551=await axios_1[_0x5d5d43(0x16a)]['post'](_0x23c1e3,{'content':_0x210c09},{'headers':{'Content-Type':'application/json','Authorization':_0x1bab1f}});if(!_0x5dd551[_0x5d5d43(0x188)])return;if(_0x5dd551[_0x5d5d43(0x188)]['code']!=='0'){const {msg:msg=_0x5d5d43(0x154)}=_0x5dd551[_0x5d5d43(0x188)];throw new common_1[(_0x5d5d43(0x165))](_0x5d5d43(0x174)+msg,common_1[_0x5d5d43(0x171)][_0x5d5d43(0x176)]);}if(_0x5dd551['data'][_0x5d5d43(0x1a2)]&&_0x5dd551[_0x5d5d43(0x188)][_0x5d5d43(0x1a2)]?.[_0x5d5d43(0x133)]){const _0x33f269=[...new Set(_0x5dd551[_0x5d5d43(0x188)][_0x5d5d43(0x1a2)]['map'](_0x5affd4=>_0x5affd4[_0x5d5d43(0x14b)]))],_0x46b2f0=[...new Set(_0x5dd551[_0x5d5d43(0x188)]['word_list'][_0x5d5d43(0x15a)](_0x581375=>_0x581375[_0x5d5d43(0x15c)]))];await this[_0x5d5d43(0x182)](_0x3e01c2,_0x210c09,_0x33f269,_0x46b2f0,_0x5d5d43(0x164));const _0x432312=this[_0x5d5d43(0x15d)](_0x5dd551['data'][_0x5d5d43(0x1a2)]);throw new common_1[(_0x5d5d43(0x165))](_0x432312,common_1[_0x5d5d43(0x171)][_0x5d5d43(0x176)]);}}[_0x22caa5(0x15d)](_0x543419){const _0x327dcc=_0x22caa5,_0x1fc391=_0x543419['map'](_0x48511c=>_0x48511c['category']),_0x284611=[...new Set(_0x1fc391)];return'您提交的内容中包含'+_0x284611[_0x327dcc(0x179)](',')+_0x327dcc(0x16e);}async[_0x22caa5(0x149)](){const _0x1676ba=_0x22caa5,_0x5dca80=await this[_0x1676ba(0x130)]['find']({'where':{'status':0x1},'select':[_0x1676ba(0x153)]});this[_0x1676ba(0x19b)]=_0x5dca80['map'](_0x4925ff=>_0x4925ff[_0x1676ba(0x153)]);}async[_0x22caa5(0x198)](_0x29fcd0){const _0x54977f=_0x22caa5,{page:page=0x1,size:size=0x1f4,word:_0x4be639,status:_0x31ad1d}=_0x29fcd0,_0xb27ce8={};[0x0,0x1,'0','1'][_0x54977f(0x150)](_0x31ad1d)&&(_0xb27ce8['status']=_0x31ad1d),_0x4be639&&(_0xb27ce8[_0x54977f(0x153)]=(0x0,typeorm_1[_0x54977f(0x135)])('%'+_0x4be639+'%'));const [_0x319408,_0x4a0ec2]=await this[_0x54977f(0x130)]['findAndCount']({'where':_0xb27ce8,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x54977f(0x139)}});return{'rows':_0x319408,'count':_0x4a0ec2};}async[_0x22caa5(0x184)](_0x382d38){const _0x45e643=_0x22caa5,_0x31626e=await this[_0x45e643(0x130)][_0x45e643(0x197)]({'where':{'id':_0x382d38['id']}});if(!_0x31626e)throw new common_1['HttpException'](_0x45e643(0x160),common_1['HttpStatus'][_0x45e643(0x176)]);const _0x30316e=await this[_0x45e643(0x130)]['delete']({'id':_0x382d38['id']});if(_0x30316e[_0x45e643(0x145)]>0x0)return await this[_0x45e643(0x149)](),_0x45e643(0x14d);else throw new common_1['HttpException'](_0x45e643(0x170),common_1[_0x45e643(0x171)]['BAD_REQUEST']);}async[_0x22caa5(0x190)](_0x26e35f){const _0x36d9b4=_0x22caa5,{id:_0x5a22c1,word:_0x58e6f2,status:_0x21097d}=_0x26e35f,_0x4b9f71=await this[_0x36d9b4(0x130)][_0x36d9b4(0x197)]({'where':{'word':_0x58e6f2}});if(_0x4b9f71)throw new common_1[(_0x36d9b4(0x165))](_0x36d9b4(0x172),common_1[_0x36d9b4(0x171)][_0x36d9b4(0x176)]);const _0x9bd12f=await this['badWordsEntity'][_0x36d9b4(0x134)]({'id':_0x5a22c1},{'word':_0x58e6f2,'status':_0x21097d});if(_0x9bd12f[_0x36d9b4(0x145)]>0x0)return await this[_0x36d9b4(0x149)](),_0x36d9b4(0x148);else throw new common_1[(_0x36d9b4(0x165))]('更新敏感词失败',common_1[_0x36d9b4(0x171)][_0x36d9b4(0x176)]);}async[_0x22caa5(0x13f)](_0x3dc458){const _0x4aa6ab=_0x22caa5,{word:_0x10334f}=_0x3dc458,_0x2df608=await this[_0x4aa6ab(0x130)]['findOne']({'where':{'word':_0x10334f}});if(_0x2df608)throw new common_1['HttpException']('敏感词已存在,请检查您的提交信息',common_1[_0x4aa6ab(0x171)][_0x4aa6ab(0x176)]);return await this['badWordsEntity'][_0x4aa6ab(0x189)]({'word':_0x10334f}),await this[_0x4aa6ab(0x149)](),_0x4aa6ab(0x141);}async[_0x22caa5(0x182)](_0x350d7d,_0x10fe4e,_0x2a9c60,_0x597f12,_0x3b4b1f){const _0x3e29db=_0x22caa5,_0x5634f6={'userId':_0x350d7d,'content':_0x10fe4e,'words':JSON['stringify'](_0x2a9c60),'typeCn':JSON[_0x3e29db(0x163)](_0x597f12),'typeOriginCn':_0x3b4b1f};try{await this[_0x3e29db(0x12f)][_0x3e29db(0x191)](_0x350d7d),await this['violationLogEntity']['save'](_0x5634f6);}catch(_0x167f04){console[_0x3e29db(0x17d)](_0x3e29db(0x146),_0x167f04);}}async[_0x22caa5(0x16d)](_0x1ae1ed,_0x3ab113){const _0x28de99=_0x22caa5,{role:_0x42b877}=_0x1ae1ed[_0x28de99(0x16f)],{page:page=0x1,size:size=0xa,userId:_0x1ecf57,typeOriginCn:_0x3c6c88}=_0x3ab113,_0x18e8dc={'delFlag':0x0};_0x1ecf57&&(_0x18e8dc[_0x28de99(0x166)]=_0x1ecf57),_0x3c6c88&&(_0x18e8dc[_0x28de99(0x155)]=_0x3c6c88);const [_0x41b5e8,_0x21a34b]=await this[_0x28de99(0x17c)][_0x28de99(0x173)]({'where':_0x18e8dc,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x28de99(0x13d)}}),_0x2e64d0=[...new Set(_0x41b5e8['map'](_0x3224da=>_0x3224da[_0x28de99(0x166)]))],_0x39e1e7=await this[_0x28de99(0x12f)][_0x28de99(0x175)](_0x2e64d0);return _0x41b5e8[_0x28de99(0x17f)](_0x471071=>{const _0x4c2e07=_0x28de99,_0x4acf97=_0x39e1e7[_0x4c2e07(0x14c)](_0x3deb0d=>_0x3deb0d['id']===_0x471071[_0x4c2e07(0x166)]);!(0x0,utils_1['isSuper'])(this[_0x4c2e07(0x12e)])&&(_0x4acf97[_0x4c2e07(0x16b)]=(0x0,utils_1[_0x4c2e07(0x195)])(_0x4acf97[_0x4c2e07(0x16b)]),_0x4acf97['phone']=(0x0,utils_1[_0x4c2e07(0x195)])(_0x4acf97[_0x4c2e07(0x132)])),_0x471071[_0x4c2e07(0x177)]=_0x4acf97;}),{'rows':_0x41b5e8,'count':_0x21a34b};}async[_0x22caa5(0x142)](_0x1f2d10){const _0x2a8c9c=_0x22caa5;if(!_0x1f2d10['ids']['length'])return!![];return await this[_0x2a8c9c(0x17c)]['update']({'id':(0x0,typeorm_1['In'])(_0x1f2d10[_0x2a8c9c(0x131)])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x22caa5(0x181)])(badwords_entity_1[_0x22caa5(0x193)])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1['ViolationLogEntity'])),__metadata('design:paramtypes',[typeorm_1[_0x22caa5(0x17a)],typeorm_1['Repository'],nestjs_cls_1[_0x22caa5(0x1a0)],user_service_1['UserService'],globalConfig_service_1[_0x22caa5(0x162)]])],BadwordsService),exports[_0x22caa5(0x19e)]=BadwordsService;