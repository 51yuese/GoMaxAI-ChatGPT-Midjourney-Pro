'use strict';const _0x842706=_0x3ac3;(function(_0x365bf8,_0xe6f89){const _0xe08ae9=_0x3ac3,_0x20eadc=_0x365bf8();while(!![]){try{const _0x4f3192=parseInt(_0xe08ae9(0x1e2))/0x1+-parseInt(_0xe08ae9(0x1ad))/0x2*(parseInt(_0xe08ae9(0x1fb))/0x3)+parseInt(_0xe08ae9(0x215))/0x4*(-parseInt(_0xe08ae9(0x218))/0x5)+parseInt(_0xe08ae9(0x20b))/0x6*(-parseInt(_0xe08ae9(0x1e6))/0x7)+parseInt(_0xe08ae9(0x1b4))/0x8*(-parseInt(_0xe08ae9(0x20a))/0x9)+-parseInt(_0xe08ae9(0x1d4))/0xa*(-parseInt(_0xe08ae9(0x1aa))/0xb)+parseInt(_0xe08ae9(0x205))/0xc*(parseInt(_0xe08ae9(0x1b5))/0xd);if(_0x4f3192===_0xe6f89)break;else _0x20eadc['push'](_0x20eadc['shift']());}catch(_0x272986){_0x20eadc['push'](_0x20eadc['shift']());}}}(_0xa4fd,0xc79c6));var __decorate=this&&this[_0x842706(0x1ae)]||function(_0x2d188b,_0x53755d,_0x44158b,_0x2a67e3){const _0x3b3583=_0x842706;var _0x1cd471=arguments['length'],_0x1e370f=_0x1cd471<0x3?_0x53755d:_0x2a67e3===null?_0x2a67e3=Object[_0x3b3583(0x1df)](_0x53755d,_0x44158b):_0x2a67e3,_0x5e7547;if(typeof Reflect===_0x3b3583(0x1cf)&&typeof Reflect['decorate']==='function')_0x1e370f=Reflect[_0x3b3583(0x1ab)](_0x2d188b,_0x53755d,_0x44158b,_0x2a67e3);else{for(var _0x4a5f1e=_0x2d188b[_0x3b3583(0x206)]-0x1;_0x4a5f1e>=0x0;_0x4a5f1e--)if(_0x5e7547=_0x2d188b[_0x4a5f1e])_0x1e370f=(_0x1cd471<0x3?_0x5e7547(_0x1e370f):_0x1cd471>0x3?_0x5e7547(_0x53755d,_0x44158b,_0x1e370f):_0x5e7547(_0x53755d,_0x44158b))||_0x1e370f;}return _0x1cd471>0x3&&_0x1e370f&&Object[_0x3b3583(0x1cd)](_0x53755d,_0x44158b,_0x1e370f),_0x1e370f;},__metadata=this&&this['__metadata']||function(_0x4d7552,_0x1da0a3){const _0x247a9b=_0x842706;if(typeof Reflect===_0x247a9b(0x1cf)&&typeof Reflect[_0x247a9b(0x1e4)]===_0x247a9b(0x1d1))return Reflect[_0x247a9b(0x1e4)](_0x4d7552,_0x1da0a3);},__param=this&&this[_0x842706(0x1dc)]||function(_0x55ef76,_0x2c452b){return function(_0x33cd63,_0x48fe9d){_0x2c452b(_0x33cd63,_0x48fe9d,_0x55ef76);};};function _0xa4fd(){const _0x426564=['ids','phone','40340gMZmaf','updateViolationCount','category','365DCDypl','map','find','msg','addBadWord','14333tfQEfB','decorate','includes','243706ilfFIP','__decorate','./../globalConfig/globalConfig.service','================================TASK===================================','删除敏感词失败','删除敏感词成功','百度云检测','120Jvhtee','20761SaUWNq','updateBadWords','delViolation','-------------BaiduBadWord---------','ClsService','findAndCount','更新敏感词成功','__esModule','stringify','检测失败','violation','badWordsEntity','getUserListByIds','ASC','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','clsService','添加敏感词成功','HttpException','BadWordsEntity','UserService','post','recordUserBadWords','的信息、我们已对您账号进行标记、请合规使用！','user','defineProperty','update','object','hideString','function','word','design:paramtypes','5510KMFUIH','email','formarTips','default','customSensitiveWords','save','敏感词已存在,请检查您的提交信息','isSuper','__param','自定义检测','自定义','getOwnPropertyDescriptor','join','百度文本检测出现错误、请查看配置信息:\x20','1396199AjnapI','HttpStatus','metadata','userId','669354MqgIKW','baiduCheckBadWords','application/json','敏感词不存在,请检查您的提交信息','InjectRepository','error:\x20','nineaiCheckBadWords','code','log','typeOriginCn','../../common/utils','checkBadWords','敏感词已经存在了、请勿重复添加','您提交的内容中包含','badWords','word_list','Like','affected','data','Repository','extractContent','12WeiEsz','userInfo','globalConfigService','onModuleInit','***','typeorm','findOne','BadwordsService','axios','./badwords.entity','17904CsSyvw','length','userservice','ViolationLogEntity','forEach','670167wRnsaW','84EVdYPo','violationLogEntity','更新敏感词失败','match','敏感词检测\x20|\x20','BAD_REQUEST','loadBadWords','@nestjs/typeorm'];_0xa4fd=function(){return _0x426564;};return _0xa4fd();}Object[_0x842706(0x1cd)](exports,_0x842706(0x1bc),{'value':!![]}),exports[_0x842706(0x202)]=void 0x0;const globalConfig_service_1=require(_0x842706(0x1af)),common_1=require('@nestjs/common'),badwords_entity_1=require(_0x842706(0x204)),typeorm_1=require(_0x842706(0x200)),typeorm_2=require(_0x842706(0x212)),axios_1=require(_0x842706(0x203)),violationLog_entity_1=require('./violationLog.entity'),utils_1=require(_0x842706(0x1f0)),user_service_1=require('../user/user.service'),nestjs_cls_1=require('nestjs-cls');function _0x3ac3(_0x381c84,_0x5d4470){const _0xa4fdd4=_0xa4fd();return _0x3ac3=function(_0x3ac395,_0x25618e){_0x3ac395=_0x3ac395-0x1a6;let _0x43a42a=_0xa4fdd4[_0x3ac395];return _0x43a42a;},_0x3ac3(_0x381c84,_0x5d4470);}let BadwordsService=class BadwordsService{constructor(_0x5bf573,_0x14f553,_0x5f1d03,_0x4e471d,_0x1c730b){const _0x41eecc=_0x842706;this[_0x41eecc(0x1c0)]=_0x5bf573,this['violationLogEntity']=_0x14f553,this[_0x41eecc(0x1c4)]=_0x5f1d03,this[_0x41eecc(0x207)]=_0x4e471d,this[_0x41eecc(0x1fd)]=_0x1c730b,this[_0x41eecc(0x1f4)]=[];}async[_0x842706(0x1fe)](){this['loadBadWords']();}async[_0x842706(0x1d8)](_0x5b21dd,_0x3d1362){const _0x22316b=_0x842706,_0x2c3a1d=[];for(let _0x2855d8=0x0;_0x2855d8<this[_0x22316b(0x1f4)][_0x22316b(0x206)];_0x2855d8++){const _0x5f329f=this[_0x22316b(0x1f4)][_0x2855d8];_0x5b21dd[_0x22316b(0x1ac)](_0x5f329f)&&_0x2c3a1d['push'](_0x5f329f);}if(_0x2c3a1d[_0x22316b(0x206)]){await this[_0x22316b(0x1ca)](_0x3d1362,_0x5b21dd,_0x2c3a1d,[_0x22316b(0x1de)],_0x22316b(0x1dd));const _0x4f8eca=_0x22316b(0x1c3);throw new common_1[(_0x22316b(0x1c6))](_0x4f8eca,common_1['HttpStatus'][_0x22316b(0x210)]);}return!![];}async[_0x842706(0x1f1)](_0x3384cd,_0x4c8206){const _0x4d6f19=_0x842706,_0x303b24=await this[_0x4d6f19(0x1fd)]['getSensitiveConfig']();_0x303b24&&await this['checkBadWordsByConfig'](_0x3384cd,_0x303b24,_0x4c8206),console['log'](_0x4d6f19(0x1b0)),await this[_0x4d6f19(0x1d8)](_0x3384cd,_0x4c8206);}async['checkBadWordsByConfig'](_0x4be608,_0x3d39a5,_0xde2a65){const _0x2d97ae=_0x842706,{useType:_0x325a3b}=_0x3d39a5;_0x325a3b==='baidu'&&await this[_0x2d97ae(0x1e7)](_0x4be608,_0x3d39a5['baiduTextAccessToken'],_0xde2a65),_0x325a3b==='nineai'&&await this[_0x2d97ae(0x1ec)](_0x4be608,_0x3d39a5,_0xde2a65);}[_0x842706(0x1fa)](_0x50ca99){const _0x290407=_0x842706,_0x3b96d6=/存在(.*?)不合规/,_0x399586=_0x50ca99[_0x290407(0x20e)](_0x3b96d6);return _0x399586?_0x399586[0x1]:'';}async[_0x842706(0x1e7)](_0x430946,_0x51c5c7,_0x48f8e6){const _0x8482e0=_0x842706;if(!_0x51c5c7)return;const _0x1074cb='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x51c5c7+'}',_0x6527b={'Content-Type':'application/x-www-form-urlencoded','Accept':'application/json'},_0x3efb63=await axios_1[_0x8482e0(0x1d7)][_0x8482e0(0x1c9)](_0x1074cb,{'text':_0x430946},{'headers':_0x6527b}),{conclusion:_0x57fddd,error_code:_0x324d2d,error_msg:_0x22fc19,conclusionType:_0x23fa27,data:_0x242388}=_0x3efb63['data'];console[_0x8482e0(0x1ee)](_0x8482e0(0x1b8),_0x3efb63['data']);if(_0x324d2d){console['log'](_0x8482e0(0x1e1),_0x22fc19);return;}if(_0x23fa27!==0x1){const _0x39df6a=[...new Set(_0x242388['map'](_0x310a5a=>this[_0x8482e0(0x1fa)](_0x310a5a[_0x8482e0(0x1a8)])))];await this['recordUserBadWords'](_0x48f8e6,_0x430946,[_0x8482e0(0x1ff)],_0x39df6a,_0x8482e0(0x1b3));const _0x4350dc='您提交的信息中包含'+_0x39df6a[_0x8482e0(0x1e0)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x8482e0(0x1c6))](_0x4350dc,common_1[_0x8482e0(0x1e3)][_0x8482e0(0x210)]);}}async[_0x842706(0x1ec)](_0x6beed2,_0x52bce5,_0x92cc9){const _0x14c696=_0x842706,{nineaiBuiltInSensitiveApiBase:_0x35e15b,nineaiBuiltInSensitiveAuthKey:_0x1c6a56}=_0x52bce5;if(!_0x35e15b||!_0x1c6a56)return;const _0x5f286f=await axios_1['default'][_0x14c696(0x1c9)](_0x35e15b,{'content':_0x6beed2},{'headers':{'Content-Type':_0x14c696(0x1e8),'Authorization':_0x1c6a56}});if(!_0x5f286f[_0x14c696(0x1f8)])return;if(_0x5f286f[_0x14c696(0x1f8)][_0x14c696(0x1ed)]!=='0'){const {msg:msg=_0x14c696(0x1be)}=_0x5f286f['data'];throw new common_1[(_0x14c696(0x1c6))](_0x14c696(0x20f)+msg,common_1[_0x14c696(0x1e3)][_0x14c696(0x210)]);}if(_0x5f286f['data']['word_list']&&_0x5f286f['data']['word_list']?.[_0x14c696(0x206)]){const _0x57ec1c=[...new Set(_0x5f286f['data'][_0x14c696(0x1f5)]['map'](_0x3879ff=>_0x3879ff['keyword']))],_0x52bc60=[...new Set(_0x5f286f['data'][_0x14c696(0x1f5)][_0x14c696(0x1a6)](_0x444f7d=>_0x444f7d['category']))];await this[_0x14c696(0x1ca)](_0x92cc9,_0x6beed2,_0x57ec1c,_0x52bc60,'NineAi检测');const _0x40c40c=this[_0x14c696(0x1d6)](_0x5f286f['data']['word_list']);throw new common_1[(_0x14c696(0x1c6))](_0x40c40c,common_1['HttpStatus'][_0x14c696(0x210)]);}}[_0x842706(0x1d6)](_0x43ede6){const _0x3ec000=_0x842706,_0x2fcd32=_0x43ede6[_0x3ec000(0x1a6)](_0x477aec=>_0x477aec[_0x3ec000(0x217)]),_0x567b98=[...new Set(_0x2fcd32)];return _0x3ec000(0x1f3)+_0x567b98[_0x3ec000(0x1e0)](',')+_0x3ec000(0x1cb);}async['loadBadWords'](){const _0x430b13=_0x842706,_0x31421d=await this[_0x430b13(0x1c0)]['find']({'where':{'status':0x1},'select':[_0x430b13(0x1d2)]});this[_0x430b13(0x1f4)]=_0x31421d[_0x430b13(0x1a6)](_0x89ad58=>_0x89ad58[_0x430b13(0x1d2)]);}async['queryBadWords'](_0x3d394f){const _0x26da24=_0x842706,{page:page=0x1,size:size=0x1f4,word:_0x23a5bc,status:_0x1cd548}=_0x3d394f,_0x5da802={};[0x0,0x1,'0','1']['includes'](_0x1cd548)&&(_0x5da802['status']=_0x1cd548),_0x23a5bc&&(_0x5da802['word']=(0x0,typeorm_1[_0x26da24(0x1f6)])('%'+_0x23a5bc+'%'));const [_0x5e779f,_0x3c11de]=await this['badWordsEntity'][_0x26da24(0x1ba)]({'where':_0x5da802,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x26da24(0x1c2)}});return{'rows':_0x5e779f,'count':_0x3c11de};}async['delBadWords'](_0x2a3397){const _0x5a055b=_0x842706,_0x3086a8=await this[_0x5a055b(0x1c0)][_0x5a055b(0x201)]({'where':{'id':_0x2a3397['id']}});if(!_0x3086a8)throw new common_1[(_0x5a055b(0x1c6))](_0x5a055b(0x1e9),common_1['HttpStatus']['BAD_REQUEST']);const _0x5212bb=await this['badWordsEntity']['delete']({'id':_0x2a3397['id']});if(_0x5212bb[_0x5a055b(0x1f7)]>0x0)return await this[_0x5a055b(0x211)](),_0x5a055b(0x1b2);else throw new common_1[(_0x5a055b(0x1c6))](_0x5a055b(0x1b1),common_1['HttpStatus']['BAD_REQUEST']);}async[_0x842706(0x1b6)](_0x1afa4e){const _0x5b78bf=_0x842706,{id:_0x3bb70b,word:_0x4ef7f7,status:_0x5eb24a}=_0x1afa4e,_0x81eb72=await this[_0x5b78bf(0x1c0)]['findOne']({'where':{'word':_0x4ef7f7}});if(_0x81eb72)throw new common_1[(_0x5b78bf(0x1c6))](_0x5b78bf(0x1f2),common_1[_0x5b78bf(0x1e3)][_0x5b78bf(0x210)]);const _0x4ea0d9=await this[_0x5b78bf(0x1c0)][_0x5b78bf(0x1ce)]({'id':_0x3bb70b},{'word':_0x4ef7f7,'status':_0x5eb24a});if(_0x4ea0d9[_0x5b78bf(0x1f7)]>0x0)return await this[_0x5b78bf(0x211)](),_0x5b78bf(0x1bb);else throw new common_1[(_0x5b78bf(0x1c6))](_0x5b78bf(0x20d),common_1[_0x5b78bf(0x1e3)]['BAD_REQUEST']);}async[_0x842706(0x1a9)](_0x3d9ea7){const _0xa3405f=_0x842706,{word:_0x3e5deb}=_0x3d9ea7,_0x3dc13e=await this[_0xa3405f(0x1c0)][_0xa3405f(0x201)]({'where':{'word':_0x3e5deb}});if(_0x3dc13e)throw new common_1[(_0xa3405f(0x1c6))](_0xa3405f(0x1da),common_1['HttpStatus']['BAD_REQUEST']);return await this[_0xa3405f(0x1c0)][_0xa3405f(0x1d9)]({'word':_0x3e5deb}),await this[_0xa3405f(0x211)](),_0xa3405f(0x1c5);}async[_0x842706(0x1ca)](_0x5a8e26,_0x24528a,_0x2c3f52,_0xf04e15,_0x4a5e81){const _0x53f214=_0x842706,_0x3d9a2d={'userId':_0x5a8e26,'content':_0x24528a,'words':JSON[_0x53f214(0x1bd)](_0x2c3f52),'typeCn':JSON[_0x53f214(0x1bd)](_0xf04e15),'typeOriginCn':_0x4a5e81};try{await this[_0x53f214(0x207)][_0x53f214(0x216)](_0x5a8e26),await this[_0x53f214(0x20c)][_0x53f214(0x1d9)](_0x3d9a2d);}catch(_0x5eb1b0){console[_0x53f214(0x1ee)](_0x53f214(0x1eb),_0x5eb1b0);}}async[_0x842706(0x1bf)](_0x36a432,_0x465eb5){const _0x241444=_0x842706,{role:_0x3c722e}=_0x36a432[_0x241444(0x1cc)],{page:page=0x1,size:size=0xa,userId:_0x2d5bfd,typeOriginCn:_0x16bc53}=_0x465eb5,_0xd1c1ce={'delFlag':0x0};_0x2d5bfd&&(_0xd1c1ce[_0x241444(0x1e5)]=_0x2d5bfd),_0x16bc53&&(_0xd1c1ce[_0x241444(0x1ef)]=_0x16bc53);const [_0x29d1d8,_0x549156]=await this[_0x241444(0x20c)]['findAndCount']({'where':_0xd1c1ce,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x295c3b=[...new Set(_0x29d1d8[_0x241444(0x1a6)](_0x2ed2bb=>_0x2ed2bb[_0x241444(0x1e5)]))],_0x9318af=await this[_0x241444(0x207)][_0x241444(0x1c1)](_0x295c3b);return _0x29d1d8[_0x241444(0x209)](_0x195798=>{const _0x431d3b=_0x241444,_0x433c55=_0x9318af[_0x431d3b(0x1a7)](_0x637f71=>_0x637f71['id']===_0x195798[_0x431d3b(0x1e5)]);!(0x0,utils_1[_0x431d3b(0x1db)])(this[_0x431d3b(0x1c4)])&&(_0x433c55[_0x431d3b(0x1d5)]=(0x0,utils_1[_0x431d3b(0x1d0)])(_0x433c55[_0x431d3b(0x1d5)]),_0x433c55[_0x431d3b(0x214)]=(0x0,utils_1[_0x431d3b(0x1d0)])(_0x433c55['phone'])),_0x195798[_0x431d3b(0x1fc)]=_0x433c55;}),{'rows':_0x29d1d8,'count':_0x549156};}async[_0x842706(0x1b7)](_0x3fc8df){const _0x3f0cd8=_0x842706;if(!_0x3fc8df['ids'][_0x3f0cd8(0x206)])return!![];return await this['violationLogEntity'][_0x3f0cd8(0x1ce)]({'id':(0x0,typeorm_1['In'])(_0x3fc8df[_0x3f0cd8(0x213)])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(badwords_entity_1[_0x842706(0x1c7)])),__param(0x1,(0x0,typeorm_2[_0x842706(0x1ea)])(violationLog_entity_1[_0x842706(0x208)])),__metadata(_0x842706(0x1d3),[typeorm_1[_0x842706(0x1f9)],typeorm_1[_0x842706(0x1f9)],nestjs_cls_1[_0x842706(0x1b9)],user_service_1[_0x842706(0x1c8)],globalConfig_service_1['GlobalConfigService']])],BadwordsService),exports[_0x842706(0x202)]=BadwordsService;