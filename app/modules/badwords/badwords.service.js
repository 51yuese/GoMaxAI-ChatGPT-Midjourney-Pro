'use strict';const _0x3eb7e8=_0x5e07;(function(_0x22b5c8,_0x2f03ae){const _0x2d4ac7=_0x5e07,_0xe72af=_0x22b5c8();while(!![]){try{const _0x32a505=parseInt(_0x2d4ac7(0xeb))/0x1*(parseInt(_0x2d4ac7(0xd8))/0x2)+-parseInt(_0x2d4ac7(0x94))/0x3*(parseInt(_0x2d4ac7(0x96))/0x4)+parseInt(_0x2d4ac7(0xb0))/0x5+parseInt(_0x2d4ac7(0x97))/0x6*(-parseInt(_0x2d4ac7(0xd9))/0x7)+-parseInt(_0x2d4ac7(0xe7))/0x8+parseInt(_0x2d4ac7(0xb5))/0x9*(-parseInt(_0x2d4ac7(0xd4))/0xa)+-parseInt(_0x2d4ac7(0xa0))/0xb*(-parseInt(_0x2d4ac7(0xac))/0xc);if(_0x32a505===_0x2f03ae)break;else _0xe72af['push'](_0xe72af['shift']());}catch(_0x53cb57){_0xe72af['push'](_0xe72af['shift']());}}}(_0x378d,0xe91a5));var __decorate=this&&this[_0x3eb7e8(0xcc)]||function(_0x2b18dd,_0x1b1fd6,_0x4af645,_0x259e12){const _0x161664=_0x3eb7e8;var _0x14c83f=arguments[_0x161664(0xc7)],_0x471e6a=_0x14c83f<0x3?_0x1b1fd6:_0x259e12===null?_0x259e12=Object[_0x161664(0xd3)](_0x1b1fd6,_0x4af645):_0x259e12,_0x116ebc;if(typeof Reflect===_0x161664(0xaa)&&typeof Reflect['decorate']===_0x161664(0xb6))_0x471e6a=Reflect[_0x161664(0xb3)](_0x2b18dd,_0x1b1fd6,_0x4af645,_0x259e12);else{for(var _0x1402e3=_0x2b18dd[_0x161664(0xc7)]-0x1;_0x1402e3>=0x0;_0x1402e3--)if(_0x116ebc=_0x2b18dd[_0x1402e3])_0x471e6a=(_0x14c83f<0x3?_0x116ebc(_0x471e6a):_0x14c83f>0x3?_0x116ebc(_0x1b1fd6,_0x4af645,_0x471e6a):_0x116ebc(_0x1b1fd6,_0x4af645))||_0x471e6a;}return _0x14c83f>0x3&&_0x471e6a&&Object[_0x161664(0xd6)](_0x1b1fd6,_0x4af645,_0x471e6a),_0x471e6a;},__metadata=this&&this[_0x3eb7e8(0xb4)]||function(_0x742764,_0x4171b2){const _0x3b671c=_0x3eb7e8;if(typeof Reflect===_0x3b671c(0xaa)&&typeof Reflect[_0x3b671c(0x87)]===_0x3b671c(0xb6))return Reflect[_0x3b671c(0x87)](_0x742764,_0x4171b2);},__param=this&&this[_0x3eb7e8(0xb8)]||function(_0x2fb6e8,_0x586907){return function(_0x171e3a,_0x53e2ea){_0x586907(_0x171e3a,_0x53e2ea,_0x2fb6e8);};};Object[_0x3eb7e8(0xd6)](exports,'__esModule',{'value':!![]}),exports[_0x3eb7e8(0xc3)]=void 0x0;const globalConfig_service_1=require(_0x3eb7e8(0x9c)),common_1=require('@nestjs/common'),badwords_entity_1=require('./badwords.entity'),typeorm_1=require('typeorm'),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0x3eb7e8(0xc8)),violationLog_entity_1=require(_0x3eb7e8(0xed)),user_entity_1=require(_0x3eb7e8(0x8e)),utils_1=require(_0x3eb7e8(0xef));let BadwordsService=class BadwordsService{constructor(_0x492da8,_0x313a87,_0x6b662d,_0x16bcc3){const _0x48d3c2=_0x3eb7e8;this[_0x48d3c2(0xd0)]=_0x492da8,this[_0x48d3c2(0x7f)]=_0x313a87,this[_0x48d3c2(0xee)]=_0x6b662d,this[_0x48d3c2(0x82)]=_0x16bcc3,this[_0x48d3c2(0x81)]=[];}async[_0x3eb7e8(0xc6)](){const _0x16ddd7=_0x3eb7e8;this[_0x16ddd7(0x86)]();}async[_0x3eb7e8(0xca)](_0x341bc1,_0x2614fe){const _0x1c059b=_0x3eb7e8,_0x466200=[];for(let _0x4d0283=0x0;_0x4d0283<this[_0x1c059b(0x81)]['length'];_0x4d0283++){const _0x44846c=this['badWords'][_0x4d0283];_0x341bc1[_0x1c059b(0x90)](_0x44846c)&&_0x466200[_0x1c059b(0x9f)](_0x44846c);}if(_0x466200[_0x1c059b(0xc7)]){await this[_0x1c059b(0xec)](_0x2614fe,_0x341bc1,_0x466200,[_0x1c059b(0xbf)],_0x1c059b(0xba));const _0x106edd=_0x1c059b(0xd5);throw new common_1['HttpException'](_0x106edd,common_1[_0x1c059b(0x8b)][_0x1c059b(0xe4)]);}return!![];}async['checkBadWords'](_0x2625ac,_0x598bae){const _0x53faae=_0x3eb7e8,_0x5643bc=await this[_0x53faae(0x82)][_0x53faae(0x8d)]();_0x5643bc&&await this[_0x53faae(0x99)](_0x2625ac,_0x5643bc,_0x598bae),await this['customSensitiveWords'](_0x2625ac,_0x598bae);}async['checkBadWordsByConfig'](_0x35f6fb,_0x214126,_0x19ce7a){const _0x475269=_0x3eb7e8,{useType:_0x20d1aa}=_0x214126;_0x20d1aa===_0x475269(0x91)&&await this['baiduCheckBadWords'](_0x35f6fb,_0x214126[_0x475269(0x80)],_0x19ce7a),_0x20d1aa===_0x475269(0x9a)&&await this['nineaiCheckBadWords'](_0x35f6fb,_0x214126,_0x19ce7a);}['extractContent'](_0xbf70ae){const _0x1f0d39=/存在(.*?)不合规/,_0x38be2f=_0xbf70ae['match'](_0x1f0d39);return _0x38be2f?_0x38be2f[0x1]:'';}async[_0x3eb7e8(0xde)](_0x2db0ff,_0x4be378,_0x218310){const _0xd4d833=_0x3eb7e8;if(!_0x4be378)return;const _0x9de84d=_0xd4d833(0x9b)+_0x4be378+'}',_0x5a19e4={'Content-Type':_0xd4d833(0xda),'Accept':_0xd4d833(0xcd)},_0x5aa500=await axios_1['default']['post'](_0x9de84d,{'text':_0x2db0ff},{'headers':_0x5a19e4}),{conclusion:_0x2e989f,error_code:_0x325234,error_msg:_0x416525,conclusionType:_0x54ed91,data:_0x2f0c31}=_0x5aa500[_0xd4d833(0xc9)];_0x325234&&console[_0xd4d833(0xc4)]('百度文本检测出现错误、请查看配置信息:\x20',_0x416525);if(_0x54ed91!==0x1){const _0x36fbf9=[...new Set(_0x2f0c31['map'](_0x4b123c=>this[_0xd4d833(0xd1)](_0x4b123c['msg'])))];await this['recordUserBadWords'](_0x218310,_0x2db0ff,[_0xd4d833(0xdf)],_0x36fbf9,_0xd4d833(0xad));const _0x87dc62='您提交的信息中包含'+_0x36fbf9[_0xd4d833(0x83)](',')+_0xd4d833(0x7e);throw new common_1[(_0xd4d833(0xd2))](_0x87dc62,common_1[_0xd4d833(0x8b)][_0xd4d833(0xe4)]);}}async[_0x3eb7e8(0xc0)](_0x5df139,_0x4e026e,_0x4c61cf){const _0x37d546=_0x3eb7e8,{nineaiBuiltInSensitiveApiBase:_0x6ada9c,nineaiBuiltInSensitiveAuthKey:_0x39b6e2}=_0x4e026e;if(!_0x6ada9c||!_0x39b6e2)return;const _0x4690d7=await axios_1[_0x37d546(0x93)][_0x37d546(0xce)](_0x6ada9c,{'content':_0x5df139},{'headers':{'Content-Type':_0x37d546(0xcd),'Authorization':_0x39b6e2}});if(!_0x4690d7['data'])return;if(_0x4690d7['data'][_0x37d546(0xaf)]!=='0'){const {msg:msg=_0x37d546(0xb7)}=_0x4690d7[_0x37d546(0xc9)];throw new common_1['HttpException'](_0x37d546(0xf0)+msg,common_1['HttpStatus'][_0x37d546(0xe4)]);}if(_0x4690d7[_0x37d546(0xc9)]['word_list']&&_0x4690d7[_0x37d546(0xc9)][_0x37d546(0xd7)]?.[_0x37d546(0xc7)]){const _0xd961de=[...new Set(_0x4690d7[_0x37d546(0xc9)][_0x37d546(0xd7)][_0x37d546(0xae)](_0x26af4b=>_0x26af4b[_0x37d546(0xe0)]))],_0x5443c6=[...new Set(_0x4690d7['data']['word_list'][_0x37d546(0xae)](_0x2f4530=>_0x2f4530[_0x37d546(0xc2)]))];await this[_0x37d546(0xec)](_0x4c61cf,_0x5df139,_0xd961de,_0x5443c6,'NineAi检测');const _0x33649a=this['formarTips'](_0x4690d7[_0x37d546(0xc9)][_0x37d546(0xd7)]);throw new common_1[(_0x37d546(0xd2))](_0x33649a,common_1[_0x37d546(0x8b)][_0x37d546(0xe4)]);}}['formarTips'](_0x509d50){const _0x10f0d5=_0x3eb7e8,_0x46a850=_0x509d50[_0x10f0d5(0xae)](_0x3f8cae=>_0x3f8cae['category']),_0x36ebea=[...new Set(_0x46a850)];return _0x10f0d5(0xb9)+_0x36ebea[_0x10f0d5(0x83)](',')+_0x10f0d5(0xa4);}async[_0x3eb7e8(0x86)](){const _0x457c9a=_0x3eb7e8,_0x42a73f=await this['badWordsEntity'][_0x457c9a(0xe3)]({'where':{'status':0x1},'select':[_0x457c9a(0xcf)]});this['badWords']=_0x42a73f[_0x457c9a(0xae)](_0x18408f=>_0x18408f[_0x457c9a(0xcf)]);}async[_0x3eb7e8(0x88)](_0x2bb946){const _0x22a8e5=_0x3eb7e8,{page:page=0x1,size:size=0x1f4,word:_0x3d6788,status:_0x20e956}=_0x2bb946,_0x1016f0={};[0x0,0x1,'0','1'][_0x22a8e5(0x90)](_0x20e956)&&(_0x1016f0['status']=_0x20e956),_0x3d6788&&(_0x1016f0[_0x22a8e5(0xcf)]=(0x0,typeorm_1[_0x22a8e5(0xa5)])('%'+_0x3d6788+'%'));const [_0x5d82bd,_0xba8d26]=await this[_0x22a8e5(0xd0)]['findAndCount']({'where':_0x1016f0,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x22a8e5(0xc5)}});return{'rows':_0x5d82bd,'count':_0xba8d26};}async[_0x3eb7e8(0xa3)](_0x5025e6){const _0x4c86a1=_0x3eb7e8,_0x2c0770=await this[_0x4c86a1(0xd0)]['findOne']({'where':{'id':_0x5025e6['id']}});if(!_0x2c0770)throw new common_1[(_0x4c86a1(0xd2))](_0x4c86a1(0x9e),common_1[_0x4c86a1(0x8b)][_0x4c86a1(0xe4)]);const _0x2514aa=await this[_0x4c86a1(0xd0)]['delete']({'id':_0x5025e6['id']});if(_0x2514aa[_0x4c86a1(0x7d)]>0x0)return await this['loadBadWords'](),_0x4c86a1(0x85);else throw new common_1[(_0x4c86a1(0xd2))]('删除敏感词失败',common_1['HttpStatus'][_0x4c86a1(0xe4)]);}async[_0x3eb7e8(0xe9)](_0x1d1dc8){const _0x1068c9=_0x3eb7e8,{id:_0x2e9909,word:_0x1a3c93,status:_0x37d081}=_0x1d1dc8,_0xceaade=await this['badWordsEntity'][_0x1068c9(0x95)]({'where':{'word':_0x1a3c93}});if(_0xceaade)throw new common_1[(_0x1068c9(0xd2))]('敏感词已经存在了、请勿重复添加',common_1[_0x1068c9(0x8b)][_0x1068c9(0xe4)]);const _0x4b264f=await this[_0x1068c9(0xd0)][_0x1068c9(0x92)]({'id':_0x2e9909},{'word':_0x1a3c93,'status':_0x37d081});if(_0x4b264f[_0x1068c9(0x7d)]>0x0)return await this['loadBadWords'](),_0x1068c9(0x84);else throw new common_1[(_0x1068c9(0xd2))](_0x1068c9(0xa8),common_1[_0x1068c9(0x8b)][_0x1068c9(0xe4)]);}async[_0x3eb7e8(0xbd)](_0xb35f84){const _0x128ef1=_0x3eb7e8,{word:_0x55a900}=_0xb35f84,_0x326304=await this[_0x128ef1(0xd0)][_0x128ef1(0x95)]({'where':{'word':_0x55a900}});if(_0x326304)throw new common_1[(_0x128ef1(0xd2))](_0x128ef1(0xa9),common_1['HttpStatus']['BAD_REQUEST']);return await this['badWordsEntity'][_0x128ef1(0xb1)]({'word':_0x55a900}),await this[_0x128ef1(0x86)](),_0x128ef1(0xa1);}async[_0x3eb7e8(0xec)](_0x5165a4,_0x24b68c,_0x4e4db0,_0x2cf3c6,_0x5c0024){const _0x1f7ab6=_0x3eb7e8,_0x4c2b41={'userId':_0x5165a4,'content':_0x24b68c,'words':JSON['stringify'](_0x4e4db0),'typeCn':JSON['stringify'](_0x2cf3c6),'typeOriginCn':_0x5c0024};try{await this['userEntity'][_0x1f7ab6(0xdb)]()[_0x1f7ab6(0x92)](user_entity_1[_0x1f7ab6(0xbb)])[_0x1f7ab6(0xab)]({'violationCount':()=>_0x1f7ab6(0x9d)})['where'](_0x1f7ab6(0xa7),{'userId':_0x5165a4})[_0x1f7ab6(0xdd)](),await this['violationLogEntity'][_0x1f7ab6(0xb1)](_0x4c2b41);}catch(_0x491483){console[_0x1f7ab6(0xc4)](_0x1f7ab6(0xea),_0x491483);}}async['violation'](_0x446c5d,_0x4950aa){const _0x471695=_0x3eb7e8,{role:_0x427be2}=_0x446c5d[_0x471695(0x98)],{page:page=0x1,size:size=0xa,userId:_0x322d7d,typeOriginCn:_0x98a5d8}=_0x4950aa,_0x55ef41={'delFlag':0x0};_0x322d7d&&(_0x55ef41[_0x471695(0xc1)]=_0x322d7d),_0x98a5d8&&(_0x55ef41['typeOriginCn']=_0x98a5d8);const [_0x414365,_0x572732]=await this['violationLogEntity'][_0x471695(0x8c)]({'where':_0x55ef41,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x471695(0xe5)}}),_0x17be86=[...new Set(_0x414365['map'](_0x38cfbb=>_0x38cfbb[_0x471695(0xc1)]))],_0x1db248=await this[_0x471695(0xee)][_0x471695(0xe3)]({'where':{'id':(0x0,typeorm_1['In'])(_0x17be86)},'select':['id',_0x471695(0xcb),_0x471695(0x8a),_0x471695(0xb2),'phone',_0x471695(0x89),_0x471695(0xf1),_0x471695(0xbc)]});return _0x414365[_0x471695(0xbe)](_0x25c8fe=>{const _0x3c322a=_0x471695,_0x57fa4c=_0x1db248[_0x3c322a(0xe3)](_0x369c2c=>_0x369c2c['id']===_0x25c8fe[_0x3c322a(0xc1)]);_0x427be2!==_0x3c322a(0xa6)&&(_0x57fa4c[_0x3c322a(0x89)]=(0x0,utils_1[_0x3c322a(0xa2)])(_0x57fa4c[_0x3c322a(0x89)]),_0x57fa4c[_0x3c322a(0xe8)]=(0x0,utils_1['hideString'])(_0x57fa4c[_0x3c322a(0xe8)])),_0x25c8fe['userInfo']=_0x57fa4c;}),{'rows':_0x414365,'count':_0x572732};}async[_0x3eb7e8(0x8f)](_0x24b6b4){const _0x5bc865=_0x3eb7e8;if(!_0x24b6b4['ids'][_0x5bc865(0xc7)])return!![];return await this['violationLogEntity'][_0x5bc865(0x92)]({'id':(0x0,typeorm_1['In'])(_0x24b6b4['ids'])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x3eb7e8(0xe6)])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x3eb7e8(0xe1)])),__param(0x2,(0x0,typeorm_2[_0x3eb7e8(0xe6)])(user_entity_1[_0x3eb7e8(0xbb)])),__metadata('design:paramtypes',[typeorm_1[_0x3eb7e8(0xdc)],typeorm_1['Repository'],typeorm_1[_0x3eb7e8(0xdc)],globalConfig_service_1[_0x3eb7e8(0xe2)]])],BadwordsService),exports[_0x3eb7e8(0xc3)]=BadwordsService;function _0x5e07(_0x251612,_0x36a59d){const _0x378da4=_0x378d();return _0x5e07=function(_0x5e0727,_0x537388){_0x5e0727=_0x5e0727-0x7d;let _0x5a5772=_0x378da4[_0x5e0727];return _0x5a5772;},_0x5e07(_0x251612,_0x36a59d);}function _0x378d(){const _0x30a260=['delViolation','includes','baidu','update','default','195NiITIW','findOne','16828YAaiqC','354LzVZHY','user','checkBadWordsByConfig','nineai','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','./../globalConfig/globalConfig.service','violationCount\x20+\x201','敏感词不存在,请检查您的提交信息','push','68574wSTwhp','添加敏感词成功','hideString','delBadWords','的信息、我们已对您账号进行标记、请合规使用！','Like','super','id\x20=\x20:userId','更新敏感词失败','敏感词已存在,请检查您的提交信息','object','set','4188YnWDJs','百度云检测','map','code','4467200lzFkyK','save','nickname','decorate','__metadata','576CpZBQV','function','检测失败','__param','您提交的内容中包含','自定义检测','UserEntity','status','addBadWord','forEach','自定义','nineaiCheckBadWords','userId','category','BadwordsService','log','ASC','onModuleInit','length','axios','data','customSensitiveWords','avatar','__decorate','application/json','post','word','badWordsEntity','extractContent','HttpException','getOwnPropertyDescriptor','57740aUyimt','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','defineProperty','word_list','387514qUeJan','17612fpRlwG','application/x-www-form-urlencoded','createQueryBuilder','Repository','execute','baiduCheckBadWords','***','keyword','ViolationLogEntity','GlobalConfigService','find','BAD_REQUEST','DESC','InjectRepository','12133112HhwWLk','phone','updateBadWords','error:\x20','1pDtnSV','recordUserBadWords','./violationLog.entity','userEntity','../../common/utils','敏感词检测\x20|\x20','violationCount','affected','的内容、我们已对您的账户进行标记、请合规使用！','violationLogEntity','baiduTextAccessToken','badWords','globalConfigService','join','更新敏感词成功','删除敏感词成功','loadBadWords','metadata','queryBadWords','email','username','HttpStatus','findAndCount','getSensitiveConfig','../user/user.entity'];_0x378d=function(){return _0x30a260;};return _0x378d();}