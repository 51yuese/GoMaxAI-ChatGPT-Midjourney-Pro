'use strict';const _0x2dd67c=_0x2a38;function _0x2a38(_0x26d818,_0x13cb2c){const _0x22781d=_0x2278();return _0x2a38=function(_0x2a3851,_0x4af13b){_0x2a3851=_0x2a3851-0x136;let _0x1f7c1d=_0x22781d[_0x2a3851];return _0x1f7c1d;},_0x2a38(_0x26d818,_0x13cb2c);}(function(_0x5a1229,_0x174b9e){const _0x287304=_0x2a38,_0x416386=_0x5a1229();while(!![]){try{const _0x510f77=parseInt(_0x287304(0x1a0))/0x1*(-parseInt(_0x287304(0x172))/0x2)+parseInt(_0x287304(0x13d))/0x3*(parseInt(_0x287304(0x13b))/0x4)+parseInt(_0x287304(0x19e))/0x5+parseInt(_0x287304(0x13c))/0x6+parseInt(_0x287304(0x16c))/0x7+-parseInt(_0x287304(0x19a))/0x8+-parseInt(_0x287304(0x190))/0x9*(-parseInt(_0x287304(0x1a7))/0xa);if(_0x510f77===_0x174b9e)break;else _0x416386['push'](_0x416386['shift']());}catch(_0x1a749a){_0x416386['push'](_0x416386['shift']());}}}(_0x2278,0x9d3f0));var __decorate=this&&this[_0x2dd67c(0x17c)]||function(_0x1a6ed4,_0x222943,_0x394d64,_0x16ca14){const _0x254a63=_0x2dd67c;var _0x5ed98b=arguments[_0x254a63(0x1a8)],_0x4e569a=_0x5ed98b<0x3?_0x222943:_0x16ca14===null?_0x16ca14=Object['getOwnPropertyDescriptor'](_0x222943,_0x394d64):_0x16ca14,_0x4f4247;if(typeof Reflect===_0x254a63(0x16f)&&typeof Reflect[_0x254a63(0x1a3)]===_0x254a63(0x145))_0x4e569a=Reflect[_0x254a63(0x1a3)](_0x1a6ed4,_0x222943,_0x394d64,_0x16ca14);else{for(var _0x5ca866=_0x1a6ed4[_0x254a63(0x1a8)]-0x1;_0x5ca866>=0x0;_0x5ca866--)if(_0x4f4247=_0x1a6ed4[_0x5ca866])_0x4e569a=(_0x5ed98b<0x3?_0x4f4247(_0x4e569a):_0x5ed98b>0x3?_0x4f4247(_0x222943,_0x394d64,_0x4e569a):_0x4f4247(_0x222943,_0x394d64))||_0x4e569a;}return _0x5ed98b>0x3&&_0x4e569a&&Object[_0x254a63(0x16e)](_0x222943,_0x394d64,_0x4e569a),_0x4e569a;},__metadata=this&&this['__metadata']||function(_0x1d04c3,_0xe71601){const _0x17c8a7=_0x2dd67c;if(typeof Reflect===_0x17c8a7(0x16f)&&typeof Reflect['metadata']===_0x17c8a7(0x145))return Reflect[_0x17c8a7(0x19b)](_0x1d04c3,_0xe71601);},__param=this&&this[_0x2dd67c(0x182)]||function(_0x5d2e7f,_0x158afc){return function(_0x5b024e,_0x3419ba){_0x158afc(_0x5b024e,_0x3419ba,_0x5d2e7f);};};Object[_0x2dd67c(0x16e)](exports,_0x2dd67c(0x151),{'value':!![]}),exports[_0x2dd67c(0x138)]=void 0x0;function _0x2278(){const _0x45f02e=['violationLogEntity','checkBadWordsByConfig','InjectRepository','================================TASK===================================','@nestjs/common','hideString','post','map','6890352MwvZYA','metadata','的内容、我们已对您的账户进行标记、请合规使用！','GlobalConfigService','1916775qSLQCb','百度文本检测出现错误、请查看配置信息:\x20','2eQEOze','ASC','findAndCount','decorate','addBadWord','updateViolationCount','更新敏感词失败','980oCQvcb','length','msg','getSensitiveConfig','nineai','BadWordsEntity','BadwordsService','baiduTextAccessToken','isSuper','4UedgVz','2557494uggMzv','2356689uTWgcA','NineAi检测','category','join','stringify','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','HttpException','save','function','queryBadWords','添加敏感词成功','敏感词已经存在了、请勿重复添加','Repository','typeorm','word_list','敏感词检测\x20|\x20','BAD_REQUEST','Like','default','design:paramtypes','__esModule','findOne','axios','baidu','敏感词不存在,请检查您的提交信息','globalConfigService','../../common/utils','affected','更新敏感词成功','userservice','baiduCheckBadWords','敏感词已存在,请检查您的提交信息','error:\x20','nineaiCheckBadWords','-------------BaiduBadWord---------','loadBadWords','customSensitiveWords','data','email','word','HttpStatus','ClsService','violation','recordUserBadWords','find','您提交的内容中包含','onModuleInit','4684421SKmuQq','includes','defineProperty','object','Injectable','phone','1071420CRyLVi','clsService','getUserListByIds','***','ids','extractContent','log','的信息、我们已对您账号进行标记、请合规使用！','您提交的信息中包含','./../globalConfig/globalConfig.service','__decorate','typeOriginCn','删除敏感词失败','checkBadWords','../user/user.service','formarTips','__param','delete','nestjs-cls','status','userId','application/json','UserService','user','检测失败','forEach','DESC','badWordsEntity','删除敏感词成功','update','28692ZTkion','badWords'];_0x2278=function(){return _0x45f02e;};return _0x2278();}const globalConfig_service_1=require(_0x2dd67c(0x17b)),common_1=require(_0x2dd67c(0x196)),badwords_entity_1=require('./badwords.entity'),typeorm_1=require(_0x2dd67c(0x14a)),typeorm_2=require('@nestjs/typeorm'),axios_1=require(_0x2dd67c(0x153)),violationLog_entity_1=require('./violationLog.entity'),utils_1=require(_0x2dd67c(0x157)),user_service_1=require(_0x2dd67c(0x180)),nestjs_cls_1=require(_0x2dd67c(0x184));let BadwordsService=class BadwordsService{constructor(_0xf78d76,_0x5195d7,_0x542406,_0x229034,_0x47344f){const _0x1b5691=_0x2dd67c;this[_0x1b5691(0x18d)]=_0xf78d76,this['violationLogEntity']=_0x5195d7,this[_0x1b5691(0x173)]=_0x542406,this[_0x1b5691(0x15a)]=_0x229034,this[_0x1b5691(0x156)]=_0x47344f,this[_0x1b5691(0x191)]=[];}async[_0x2dd67c(0x16b)](){const _0x386915=_0x2dd67c;this[_0x386915(0x160)]();}async[_0x2dd67c(0x161)](_0x3063ed,_0xb34e8){const _0x574eb8=_0x2dd67c,_0x234836=[];for(let _0x182326=0x0;_0x182326<this[_0x574eb8(0x191)][_0x574eb8(0x1a8)];_0x182326++){const _0x312f75=this['badWords'][_0x182326];_0x3063ed[_0x574eb8(0x16d)](_0x312f75)&&_0x234836['push'](_0x312f75);}if(_0x234836[_0x574eb8(0x1a8)]){await this[_0x574eb8(0x168)](_0xb34e8,_0x3063ed,_0x234836,['自定义'],'自定义检测');const _0x58a0be=_0x574eb8(0x142);throw new common_1['HttpException'](_0x58a0be,common_1[_0x574eb8(0x165)][_0x574eb8(0x14d)]);}return!![];}async[_0x2dd67c(0x17f)](_0x6fcf35,_0x1ffbe1){const _0x18bf63=_0x2dd67c,_0x22ce80=await this[_0x18bf63(0x156)][_0x18bf63(0x1aa)]();_0x22ce80&&await this[_0x18bf63(0x193)](_0x6fcf35,_0x22ce80,_0x1ffbe1),console['log'](_0x18bf63(0x195)),await this[_0x18bf63(0x161)](_0x6fcf35,_0x1ffbe1);}async[_0x2dd67c(0x193)](_0x43070f,_0x378fe3,_0x2e57f0){const _0x29b066=_0x2dd67c,{useType:_0x46035b}=_0x378fe3;_0x46035b===_0x29b066(0x154)&&await this[_0x29b066(0x15b)](_0x43070f,_0x378fe3[_0x29b066(0x139)],_0x2e57f0),_0x46035b===_0x29b066(0x136)&&await this[_0x29b066(0x15e)](_0x43070f,_0x378fe3,_0x2e57f0);}[_0x2dd67c(0x177)](_0x819659){const _0x3dd259=/存在(.*?)不合规/,_0xb138f7=_0x819659['match'](_0x3dd259);return _0xb138f7?_0xb138f7[0x1]:'';}async[_0x2dd67c(0x15b)](_0x1a3729,_0x1d55d6,_0x537f40){const _0x5f1256=_0x2dd67c;if(!_0x1d55d6)return;const _0x3d76bf='https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token='+_0x1d55d6+'}',_0x242e99={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x5f1256(0x187)},_0x4649d0=await axios_1[_0x5f1256(0x14f)]['post'](_0x3d76bf,{'text':_0x1a3729},{'headers':_0x242e99}),{conclusion:_0x55ad31,error_code:_0x124fe3,error_msg:_0x317749,conclusionType:_0x241974,data:_0x23ab00}=_0x4649d0[_0x5f1256(0x162)];console[_0x5f1256(0x178)](_0x5f1256(0x15f),_0x4649d0[_0x5f1256(0x162)]);if(_0x124fe3){console[_0x5f1256(0x178)](_0x5f1256(0x19f),_0x317749);return;}if(_0x241974!==0x1){const _0x1d7bea=[...new Set(_0x23ab00['map'](_0x27071e=>this[_0x5f1256(0x177)](_0x27071e[_0x5f1256(0x1a9)])))];await this['recordUserBadWords'](_0x537f40,_0x1a3729,[_0x5f1256(0x175)],_0x1d7bea,'百度云检测');const _0x5c5a76=_0x5f1256(0x17a)+_0x1d7bea[_0x5f1256(0x140)](',')+_0x5f1256(0x19c);throw new common_1['HttpException'](_0x5c5a76,common_1[_0x5f1256(0x165)][_0x5f1256(0x14d)]);}}async[_0x2dd67c(0x15e)](_0x34dd4e,_0x117080,_0x291c02){const _0x2396a1=_0x2dd67c,{nineaiBuiltInSensitiveApiBase:_0x581af3,nineaiBuiltInSensitiveAuthKey:_0x1f99fe}=_0x117080;if(!_0x581af3||!_0x1f99fe)return;const _0x38cddb=await axios_1[_0x2396a1(0x14f)][_0x2396a1(0x198)](_0x581af3,{'content':_0x34dd4e},{'headers':{'Content-Type':_0x2396a1(0x187),'Authorization':_0x1f99fe}});if(!_0x38cddb[_0x2396a1(0x162)])return;if(_0x38cddb[_0x2396a1(0x162)]['code']!=='0'){const {msg:msg=_0x2396a1(0x18a)}=_0x38cddb[_0x2396a1(0x162)];throw new common_1['HttpException'](_0x2396a1(0x14c)+msg,common_1[_0x2396a1(0x165)][_0x2396a1(0x14d)]);}if(_0x38cddb[_0x2396a1(0x162)][_0x2396a1(0x14b)]&&_0x38cddb[_0x2396a1(0x162)][_0x2396a1(0x14b)]?.[_0x2396a1(0x1a8)]){const _0x3a18ce=[...new Set(_0x38cddb[_0x2396a1(0x162)][_0x2396a1(0x14b)]['map'](_0x5880a0=>_0x5880a0['keyword']))],_0x234f7c=[...new Set(_0x38cddb[_0x2396a1(0x162)][_0x2396a1(0x14b)]['map'](_0x643e83=>_0x643e83[_0x2396a1(0x13f)]))];await this[_0x2396a1(0x168)](_0x291c02,_0x34dd4e,_0x3a18ce,_0x234f7c,_0x2396a1(0x13e));const _0x1bc03a=this[_0x2396a1(0x181)](_0x38cddb['data'][_0x2396a1(0x14b)]);throw new common_1[(_0x2396a1(0x143))](_0x1bc03a,common_1['HttpStatus'][_0x2396a1(0x14d)]);}}[_0x2dd67c(0x181)](_0x46f86a){const _0xe48a95=_0x2dd67c,_0xc6c63e=_0x46f86a[_0xe48a95(0x199)](_0x41e8ff=>_0x41e8ff[_0xe48a95(0x13f)]),_0x27fa4c=[...new Set(_0xc6c63e)];return _0xe48a95(0x16a)+_0x27fa4c[_0xe48a95(0x140)](',')+_0xe48a95(0x179);}async[_0x2dd67c(0x160)](){const _0x21a243=_0x2dd67c,_0x27a2f7=await this[_0x21a243(0x18d)][_0x21a243(0x169)]({'where':{'status':0x1},'select':[_0x21a243(0x164)]});this[_0x21a243(0x191)]=_0x27a2f7['map'](_0x116b19=>_0x116b19[_0x21a243(0x164)]);}async[_0x2dd67c(0x146)](_0x497768){const _0x5e7cbf=_0x2dd67c,{page:page=0x1,size:size=0x1f4,word:_0x4af81f,status:_0x1f9e8e}=_0x497768,_0x3c9727={};[0x0,0x1,'0','1'][_0x5e7cbf(0x16d)](_0x1f9e8e)&&(_0x3c9727[_0x5e7cbf(0x185)]=_0x1f9e8e),_0x4af81f&&(_0x3c9727[_0x5e7cbf(0x164)]=(0x0,typeorm_1[_0x5e7cbf(0x14e)])('%'+_0x4af81f+'%'));const [_0x5b2eb5,_0x284022]=await this[_0x5e7cbf(0x18d)][_0x5e7cbf(0x1a2)]({'where':_0x3c9727,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x5e7cbf(0x1a1)}});return{'rows':_0x5b2eb5,'count':_0x284022};}async['delBadWords'](_0x953d7){const _0x2b2023=_0x2dd67c,_0x1b52dc=await this[_0x2b2023(0x18d)][_0x2b2023(0x152)]({'where':{'id':_0x953d7['id']}});if(!_0x1b52dc)throw new common_1[(_0x2b2023(0x143))](_0x2b2023(0x155),common_1['HttpStatus'][_0x2b2023(0x14d)]);const _0xbb51e=await this[_0x2b2023(0x18d)][_0x2b2023(0x183)]({'id':_0x953d7['id']});if(_0xbb51e[_0x2b2023(0x158)]>0x0)return await this['loadBadWords'](),_0x2b2023(0x18e);else throw new common_1[(_0x2b2023(0x143))](_0x2b2023(0x17e),common_1['HttpStatus'][_0x2b2023(0x14d)]);}async['updateBadWords'](_0x54d9a1){const _0x414689=_0x2dd67c,{id:_0x28a622,word:_0x1a1efc,status:_0x3b70d9}=_0x54d9a1,_0x41ab2d=await this['badWordsEntity'][_0x414689(0x152)]({'where':{'word':_0x1a1efc}});if(_0x41ab2d)throw new common_1[(_0x414689(0x143))](_0x414689(0x148),common_1[_0x414689(0x165)][_0x414689(0x14d)]);const _0x636f30=await this[_0x414689(0x18d)][_0x414689(0x18f)]({'id':_0x28a622},{'word':_0x1a1efc,'status':_0x3b70d9});if(_0x636f30[_0x414689(0x158)]>0x0)return await this[_0x414689(0x160)](),_0x414689(0x159);else throw new common_1[(_0x414689(0x143))](_0x414689(0x1a6),common_1[_0x414689(0x165)][_0x414689(0x14d)]);}async[_0x2dd67c(0x1a4)](_0x1db189){const _0x9a38b4=_0x2dd67c,{word:_0xbdf839}=_0x1db189,_0x15cddf=await this[_0x9a38b4(0x18d)]['findOne']({'where':{'word':_0xbdf839}});if(_0x15cddf)throw new common_1[(_0x9a38b4(0x143))](_0x9a38b4(0x15c),common_1['HttpStatus'][_0x9a38b4(0x14d)]);return await this[_0x9a38b4(0x18d)][_0x9a38b4(0x144)]({'word':_0xbdf839}),await this[_0x9a38b4(0x160)](),_0x9a38b4(0x147);}async[_0x2dd67c(0x168)](_0x189606,_0x152606,_0x271bc9,_0x430e07,_0x380075){const _0x1e5ce4=_0x2dd67c,_0x31047e={'userId':_0x189606,'content':_0x152606,'words':JSON[_0x1e5ce4(0x141)](_0x271bc9),'typeCn':JSON[_0x1e5ce4(0x141)](_0x430e07),'typeOriginCn':_0x380075};try{await this[_0x1e5ce4(0x15a)][_0x1e5ce4(0x1a5)](_0x189606),await this[_0x1e5ce4(0x192)][_0x1e5ce4(0x144)](_0x31047e);}catch(_0x53eadb){console[_0x1e5ce4(0x178)](_0x1e5ce4(0x15d),_0x53eadb);}}async[_0x2dd67c(0x167)](_0x3dc76d,_0x225c65){const _0x2cea38=_0x2dd67c,{role:_0x47d297}=_0x3dc76d[_0x2cea38(0x189)],{page:page=0x1,size:size=0xa,userId:_0x1ede9c,typeOriginCn:_0x5843ab}=_0x225c65,_0x56b7f5={'delFlag':0x0};_0x1ede9c&&(_0x56b7f5[_0x2cea38(0x186)]=_0x1ede9c),_0x5843ab&&(_0x56b7f5[_0x2cea38(0x17d)]=_0x5843ab);const [_0x3412d1,_0x555d1a]=await this[_0x2cea38(0x192)]['findAndCount']({'where':_0x56b7f5,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x2cea38(0x18c)}}),_0x2b09f4=[...new Set(_0x3412d1[_0x2cea38(0x199)](_0x19ae31=>_0x19ae31[_0x2cea38(0x186)]))],_0x6af415=await this[_0x2cea38(0x15a)][_0x2cea38(0x174)](_0x2b09f4);return _0x3412d1[_0x2cea38(0x18b)](_0x4d4c6f=>{const _0x13633c=_0x2cea38,_0x458610=_0x6af415[_0x13633c(0x169)](_0x547f7a=>_0x547f7a['id']===_0x4d4c6f['userId']);!(0x0,utils_1[_0x13633c(0x13a)])(this['clsService'])&&(_0x458610[_0x13633c(0x163)]=(0x0,utils_1[_0x13633c(0x197)])(_0x458610[_0x13633c(0x163)]),_0x458610[_0x13633c(0x171)]=(0x0,utils_1[_0x13633c(0x197)])(_0x458610[_0x13633c(0x171)])),_0x4d4c6f['userInfo']=_0x458610;}),{'rows':_0x3412d1,'count':_0x555d1a};}async['delViolation'](_0x2f92fc){const _0x4a3b81=_0x2dd67c;if(!_0x2f92fc[_0x4a3b81(0x176)][_0x4a3b81(0x1a8)])return!![];return await this[_0x4a3b81(0x192)]['update']({'id':(0x0,typeorm_1['In'])(_0x2f92fc['ids'])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1[_0x2dd67c(0x170)])(),__param(0x0,(0x0,typeorm_2[_0x2dd67c(0x194)])(badwords_entity_1[_0x2dd67c(0x137)])),__param(0x1,(0x0,typeorm_2[_0x2dd67c(0x194)])(violationLog_entity_1['ViolationLogEntity'])),__metadata(_0x2dd67c(0x150),[typeorm_1[_0x2dd67c(0x149)],typeorm_1[_0x2dd67c(0x149)],nestjs_cls_1[_0x2dd67c(0x166)],user_service_1[_0x2dd67c(0x188)],globalConfig_service_1[_0x2dd67c(0x19d)]])],BadwordsService),exports['BadwordsService']=BadwordsService;