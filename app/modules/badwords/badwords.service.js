'use strict';function _0x56be(){const _0x456679=['error:\x20','nineaiCheckBadWords','default','stringify','formarTips','keyword','DESC','updateViolationCount','__param','affected','violationLogEntity','ids','phone','hideString','word_list','百度文本检测出现错误、请查看配置信息:\x20','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','Repository','11kgCTml','forEach','getUserListByIds','findOne','map','@nestjs/typeorm','design:paramtypes','length','isSuper','828945WacSpX','__decorate','category','log','customSensitiveWords','HttpException','badWords','baidu','word','find','BAD_REQUEST','checkBadWordsByConfig','自定义','百度云检测','HttpStatus','application/json','368086lcVHSZ','recordUserBadWords','BadwordsService','Injectable','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','delViolation','InjectRepository','queryBadWords','8XyVJPu','axios','__esModule','的内容、我们已对您的账户进行标记、请合规使用！','typeOriginCn','userId','BadWordsEntity','@nestjs/common','extractContent','defineProperty','userInfo','敏感词不存在,请检查您的提交信息','更新敏感词失败','violation','update','delete','findAndCount','data','includes','1444adrnLq','addBadWord','typeorm','./../globalConfig/globalConfig.service','code','1AdoGyn','***','onModuleInit','ViolationLogEntity','loadBadWords','敏感词检测\x20|\x20','save','../../common/utils','2664690peIsET','badWordsEntity','msg','================================TASK===================================','UserService','baiduTextAccessToken','NineAi检测','match','clsService','getSensitiveConfig','219ZPjsLB','添加敏感词成功','globalConfigService','./badwords.entity','decorate','更新敏感词成功','GlobalConfigService','2634VuRzkW','84apYPvC','user','nineai','ASC','checkBadWords','Like','敏感词已存在,请检查您的提交信息','baiduCheckBadWords','__metadata','./violationLog.entity','getOwnPropertyDescriptor','2343771nvfRnx','自定义检测','userservice','email','您提交的信息中包含','metadata','object','1260831zRsslJ','3248xyDQWJ','post'];_0x56be=function(){return _0x456679;};return _0x56be();}const _0x65612e=_0x3d0e;(function(_0x37784b,_0x5064cc){const _0x49067f=_0x3d0e,_0x4696fd=_0x37784b();while(!![]){try{const _0x5b14dd=parseInt(_0x49067f(0xd9))/0x1*(-parseInt(_0x49067f(0xb9))/0x2)+parseInt(_0x49067f(0xeb))/0x3*(parseInt(_0x49067f(0xd4))/0x4)+-parseInt(_0x49067f(0xa9))/0x5+-parseInt(_0x49067f(0xf2))/0x6*(parseInt(_0x49067f(0x8c))/0x7)+parseInt(_0x49067f(0xc1))/0x8*(parseInt(_0x49067f(0xfe))/0x9)+-parseInt(_0x49067f(0xe1))/0xa*(parseInt(_0x49067f(0xa0))/0xb)+-parseInt(_0x49067f(0xf3))/0xc*(-parseInt(_0x49067f(0x8b))/0xd);if(_0x5b14dd===_0x5064cc)break;else _0x4696fd['push'](_0x4696fd['shift']());}catch(_0x390ad8){_0x4696fd['push'](_0x4696fd['shift']());}}}(_0x56be,0x23914));var __decorate=this&&this[_0x65612e(0xaa)]||function(_0x54c83f,_0x236afb,_0x4226cc,_0x1b06e0){const _0xc47f1c=_0x65612e;var _0x143e9d=arguments['length'],_0x19e1c4=_0x143e9d<0x3?_0x236afb:_0x1b06e0===null?_0x1b06e0=Object[_0xc47f1c(0xfd)](_0x236afb,_0x4226cc):_0x1b06e0,_0x511bd8;if(typeof Reflect===_0xc47f1c(0x8a)&&typeof Reflect[_0xc47f1c(0xef)]==='function')_0x19e1c4=Reflect[_0xc47f1c(0xef)](_0x54c83f,_0x236afb,_0x4226cc,_0x1b06e0);else{for(var _0x108adb=_0x54c83f['length']-0x1;_0x108adb>=0x0;_0x108adb--)if(_0x511bd8=_0x54c83f[_0x108adb])_0x19e1c4=(_0x143e9d<0x3?_0x511bd8(_0x19e1c4):_0x143e9d>0x3?_0x511bd8(_0x236afb,_0x4226cc,_0x19e1c4):_0x511bd8(_0x236afb,_0x4226cc))||_0x19e1c4;}return _0x143e9d>0x3&&_0x19e1c4&&Object[_0xc47f1c(0xca)](_0x236afb,_0x4226cc,_0x19e1c4),_0x19e1c4;},__metadata=this&&this[_0x65612e(0xfb)]||function(_0x2de4fa,_0x5a2cc8){const _0x2be84f=_0x65612e;if(typeof Reflect===_0x2be84f(0x8a)&&typeof Reflect[_0x2be84f(0x103)]==='function')return Reflect[_0x2be84f(0x103)](_0x2de4fa,_0x5a2cc8);},__param=this&&this[_0x65612e(0x96)]||function(_0x36ab97,_0x1553c8){return function(_0x4b8a0c,_0x5727bf){_0x1553c8(_0x4b8a0c,_0x5727bf,_0x36ab97);};};Object[_0x65612e(0xca)](exports,_0x65612e(0xc3),{'value':!![]}),exports['BadwordsService']=void 0x0;const globalConfig_service_1=require(_0x65612e(0xd7)),common_1=require(_0x65612e(0xc8)),badwords_entity_1=require(_0x65612e(0xee)),typeorm_1=require(_0x65612e(0xd6)),typeorm_2=require(_0x65612e(0xa5)),axios_1=require(_0x65612e(0xc2)),violationLog_entity_1=require(_0x65612e(0xfc)),utils_1=require(_0x65612e(0xe0)),user_service_1=require('../user/user.service'),nestjs_cls_1=require('nestjs-cls');function _0x3d0e(_0x6fef23,_0xf1f1e7){const _0x56bed8=_0x56be();return _0x3d0e=function(_0x3d0ecc,_0x5d08e4){_0x3d0ecc=_0x3d0ecc-0x8a;let _0x2c48e9=_0x56bed8[_0x3d0ecc];return _0x2c48e9;},_0x3d0e(_0x6fef23,_0xf1f1e7);}let BadwordsService=class BadwordsService{constructor(_0x3418be,_0x3748a2,_0x1a59c9,_0x11c89c,_0x26ec01){const _0x5baaaa=_0x65612e;this[_0x5baaaa(0xe2)]=_0x3418be,this[_0x5baaaa(0x98)]=_0x3748a2,this[_0x5baaaa(0xe9)]=_0x1a59c9,this[_0x5baaaa(0x100)]=_0x11c89c,this['globalConfigService']=_0x26ec01,this['badWords']=[];}async[_0x65612e(0xdb)](){const _0x3678ea=_0x65612e;this[_0x3678ea(0xdd)]();}async['customSensitiveWords'](_0x398179,_0x50c681){const _0x52a3ac=_0x65612e,_0x351f39=[];for(let _0xc47b91=0x0;_0xc47b91<this[_0x52a3ac(0xaf)][_0x52a3ac(0xa7)];_0xc47b91++){const _0xf31fbc=this[_0x52a3ac(0xaf)][_0xc47b91];_0x398179[_0x52a3ac(0xd3)](_0xf31fbc)&&_0x351f39['push'](_0xf31fbc);}if(_0x351f39[_0x52a3ac(0xa7)]){await this[_0x52a3ac(0xba)](_0x50c681,_0x398179,_0x351f39,[_0x52a3ac(0xb5)],_0x52a3ac(0xff));const _0x3cb5d8=_0x52a3ac(0xbd);throw new common_1[(_0x52a3ac(0xae))](_0x3cb5d8,common_1[_0x52a3ac(0xb7)][_0x52a3ac(0xb3)]);}return!![];}async[_0x65612e(0xf7)](_0x1be4a0,_0x3ae329){const _0x274878=_0x65612e,_0x325f75=await this[_0x274878(0xed)][_0x274878(0xea)]();_0x325f75&&await this[_0x274878(0xb4)](_0x1be4a0,_0x325f75,_0x3ae329),console['log'](_0x274878(0xe4)),await this[_0x274878(0xad)](_0x1be4a0,_0x3ae329);}async[_0x65612e(0xb4)](_0x2a2862,_0x30ac5e,_0x3952c9){const _0xbb3f75=_0x65612e,{useType:_0x3ec438}=_0x30ac5e;_0x3ec438===_0xbb3f75(0xb0)&&await this['baiduCheckBadWords'](_0x2a2862,_0x30ac5e[_0xbb3f75(0xe6)],_0x3952c9),_0x3ec438===_0xbb3f75(0xf5)&&await this[_0xbb3f75(0x8f)](_0x2a2862,_0x30ac5e,_0x3952c9);}[_0x65612e(0xc9)](_0x4a98fb){const _0x486643=_0x65612e,_0x463136=/存在(.*?)不合规/,_0x569050=_0x4a98fb[_0x486643(0xe8)](_0x463136);return _0x569050?_0x569050[0x1]:'';}async[_0x65612e(0xfa)](_0x400cb2,_0x2acca8,_0x4240d6){const _0x396332=_0x65612e;if(!_0x2acca8)return;const _0x223a11=_0x396332(0x9e)+_0x2acca8+'}',_0x461194={'Content-Type':'application/x-www-form-urlencoded','Accept':_0x396332(0xb8)},_0x2dcc25=await axios_1[_0x396332(0x90)][_0x396332(0x8d)](_0x223a11,{'text':_0x400cb2},{'headers':_0x461194}),{conclusion:_0x50f26c,error_code:_0x1365dc,error_msg:_0x2df2bd,conclusionType:_0x28d3de,data:_0x15eac0}=_0x2dcc25[_0x396332(0xd2)];_0x1365dc&&console[_0x396332(0xac)](_0x396332(0x9d),_0x2df2bd);if(_0x28d3de!==0x1){const _0x536c66=[...new Set(_0x15eac0[_0x396332(0xa4)](_0x229fbe=>this[_0x396332(0xc9)](_0x229fbe[_0x396332(0xe3)])))];await this[_0x396332(0xba)](_0x4240d6,_0x400cb2,[_0x396332(0xda)],_0x536c66,_0x396332(0xb6));const _0x39abfe=_0x396332(0x102)+_0x536c66['join'](',')+_0x396332(0xc4);throw new common_1[(_0x396332(0xae))](_0x39abfe,common_1['HttpStatus'][_0x396332(0xb3)]);}}async['nineaiCheckBadWords'](_0x42495c,_0x373913,_0x55c3c){const _0x74a8cd=_0x65612e,{nineaiBuiltInSensitiveApiBase:_0x6305ee,nineaiBuiltInSensitiveAuthKey:_0x102eb9}=_0x373913;if(!_0x6305ee||!_0x102eb9)return;const _0x230e91=await axios_1[_0x74a8cd(0x90)]['post'](_0x6305ee,{'content':_0x42495c},{'headers':{'Content-Type':_0x74a8cd(0xb8),'Authorization':_0x102eb9}});if(!_0x230e91['data'])return;if(_0x230e91[_0x74a8cd(0xd2)][_0x74a8cd(0xd8)]!=='0'){const {msg:msg='检测失败'}=_0x230e91[_0x74a8cd(0xd2)];throw new common_1[(_0x74a8cd(0xae))](_0x74a8cd(0xde)+msg,common_1[_0x74a8cd(0xb7)][_0x74a8cd(0xb3)]);}if(_0x230e91[_0x74a8cd(0xd2)][_0x74a8cd(0x9c)]&&_0x230e91[_0x74a8cd(0xd2)][_0x74a8cd(0x9c)]?.[_0x74a8cd(0xa7)]){const _0x5a14ea=[...new Set(_0x230e91[_0x74a8cd(0xd2)]['word_list'][_0x74a8cd(0xa4)](_0x1e8f3f=>_0x1e8f3f[_0x74a8cd(0x93)]))],_0x1dfb26=[...new Set(_0x230e91['data'][_0x74a8cd(0x9c)][_0x74a8cd(0xa4)](_0x46bc4f=>_0x46bc4f[_0x74a8cd(0xab)]))];await this[_0x74a8cd(0xba)](_0x55c3c,_0x42495c,_0x5a14ea,_0x1dfb26,_0x74a8cd(0xe7));const _0x14ad3c=this[_0x74a8cd(0x92)](_0x230e91['data']['word_list']);throw new common_1['HttpException'](_0x14ad3c,common_1['HttpStatus'][_0x74a8cd(0xb3)]);}}['formarTips'](_0x234816){const _0x157822=_0x65612e,_0x38a827=_0x234816[_0x157822(0xa4)](_0x564b21=>_0x564b21[_0x157822(0xab)]),_0xa044f5=[...new Set(_0x38a827)];return'您提交的内容中包含'+_0xa044f5['join'](',')+'的信息、我们已对您账号进行标记、请合规使用！';}async[_0x65612e(0xdd)](){const _0x4d785a=_0x65612e,_0x1e4cbc=await this['badWordsEntity'][_0x4d785a(0xb2)]({'where':{'status':0x1},'select':[_0x4d785a(0xb1)]});this[_0x4d785a(0xaf)]=_0x1e4cbc[_0x4d785a(0xa4)](_0xdc6e01=>_0xdc6e01['word']);}async[_0x65612e(0xc0)](_0x91157b){const _0x3d1b74=_0x65612e,{page:page=0x1,size:size=0x1f4,word:_0x395826,status:_0x3b5a66}=_0x91157b,_0x379da9={};[0x0,0x1,'0','1'][_0x3d1b74(0xd3)](_0x3b5a66)&&(_0x379da9['status']=_0x3b5a66),_0x395826&&(_0x379da9[_0x3d1b74(0xb1)]=(0x0,typeorm_1[_0x3d1b74(0xf8)])('%'+_0x395826+'%'));const [_0x5b6215,_0x543e6e]=await this[_0x3d1b74(0xe2)][_0x3d1b74(0xd1)]({'where':_0x379da9,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x3d1b74(0xf6)}});return{'rows':_0x5b6215,'count':_0x543e6e};}async['delBadWords'](_0x56dacd){const _0x41af6c=_0x65612e,_0x586283=await this['badWordsEntity']['findOne']({'where':{'id':_0x56dacd['id']}});if(!_0x586283)throw new common_1[(_0x41af6c(0xae))](_0x41af6c(0xcc),common_1[_0x41af6c(0xb7)][_0x41af6c(0xb3)]);const _0x468207=await this[_0x41af6c(0xe2)][_0x41af6c(0xd0)]({'id':_0x56dacd['id']});if(_0x468207[_0x41af6c(0x97)]>0x0)return await this['loadBadWords'](),'删除敏感词成功';else throw new common_1['HttpException']('删除敏感词失败',common_1['HttpStatus'][_0x41af6c(0xb3)]);}async['updateBadWords'](_0x18575f){const _0x1882be=_0x65612e,{id:_0x376152,word:_0x48f63a,status:_0x4d2260}=_0x18575f,_0x18fbda=await this['badWordsEntity'][_0x1882be(0xa3)]({'where':{'word':_0x48f63a}});if(_0x18fbda)throw new common_1[(_0x1882be(0xae))]('敏感词已经存在了、请勿重复添加',common_1[_0x1882be(0xb7)]['BAD_REQUEST']);const _0x141875=await this[_0x1882be(0xe2)][_0x1882be(0xcf)]({'id':_0x376152},{'word':_0x48f63a,'status':_0x4d2260});if(_0x141875[_0x1882be(0x97)]>0x0)return await this[_0x1882be(0xdd)](),_0x1882be(0xf0);else throw new common_1['HttpException'](_0x1882be(0xcd),common_1[_0x1882be(0xb7)]['BAD_REQUEST']);}async[_0x65612e(0xd5)](_0x14542b){const _0x4c987f=_0x65612e,{word:_0x546dde}=_0x14542b,_0x3654d8=await this['badWordsEntity'][_0x4c987f(0xa3)]({'where':{'word':_0x546dde}});if(_0x3654d8)throw new common_1[(_0x4c987f(0xae))](_0x4c987f(0xf9),common_1[_0x4c987f(0xb7)][_0x4c987f(0xb3)]);return await this[_0x4c987f(0xe2)][_0x4c987f(0xdf)]({'word':_0x546dde}),await this[_0x4c987f(0xdd)](),_0x4c987f(0xec);}async[_0x65612e(0xba)](_0x29c18b,_0xd5ce33,_0x1413d4,_0x76aa7c,_0xc1ac7e){const _0x2dbac9=_0x65612e,_0x117572={'userId':_0x29c18b,'content':_0xd5ce33,'words':JSON[_0x2dbac9(0x91)](_0x1413d4),'typeCn':JSON[_0x2dbac9(0x91)](_0x76aa7c),'typeOriginCn':_0xc1ac7e};try{await this[_0x2dbac9(0x100)][_0x2dbac9(0x95)](_0x29c18b),await this[_0x2dbac9(0x98)][_0x2dbac9(0xdf)](_0x117572);}catch(_0x4d619a){console[_0x2dbac9(0xac)](_0x2dbac9(0x8e),_0x4d619a);}}async[_0x65612e(0xce)](_0x9d9d93,_0x239715){const _0x175597=_0x65612e,{role:_0x47731c}=_0x9d9d93[_0x175597(0xf4)],{page:page=0x1,size:size=0xa,userId:_0xf6a884,typeOriginCn:_0x5786df}=_0x239715,_0x2da26c={'delFlag':0x0};_0xf6a884&&(_0x2da26c['userId']=_0xf6a884),_0x5786df&&(_0x2da26c[_0x175597(0xc5)]=_0x5786df);const [_0x3e8082,_0x3e1ed3]=await this[_0x175597(0x98)]['findAndCount']({'where':_0x2da26c,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x175597(0x94)}}),_0x1b1056=[...new Set(_0x3e8082[_0x175597(0xa4)](_0x55e599=>_0x55e599[_0x175597(0xc6)]))],_0x525ada=await this[_0x175597(0x100)][_0x175597(0xa2)](_0x1b1056);return _0x3e8082[_0x175597(0xa1)](_0x16997c=>{const _0x2bddb3=_0x175597,_0x41bb1a=_0x525ada['find'](_0x12a421=>_0x12a421['id']===_0x16997c[_0x2bddb3(0xc6)]);!(0x0,utils_1[_0x2bddb3(0xa8)])(this['clsService'])&&(_0x41bb1a[_0x2bddb3(0x101)]=(0x0,utils_1[_0x2bddb3(0x9b)])(_0x41bb1a[_0x2bddb3(0x101)]),_0x41bb1a[_0x2bddb3(0x9a)]=(0x0,utils_1['hideString'])(_0x41bb1a['phone'])),_0x16997c[_0x2bddb3(0xcb)]=_0x41bb1a;}),{'rows':_0x3e8082,'count':_0x3e1ed3};}async[_0x65612e(0xbe)](_0x5e24c4){const _0x19f21=_0x65612e;if(!_0x5e24c4['ids'][_0x19f21(0xa7)])return!![];return await this[_0x19f21(0x98)]['update']({'id':(0x0,typeorm_1['In'])(_0x5e24c4[_0x19f21(0x99)])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1[_0x65612e(0xbc)])(),__param(0x0,(0x0,typeorm_2[_0x65612e(0xbf)])(badwords_entity_1[_0x65612e(0xc7)])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(violationLog_entity_1[_0x65612e(0xdc)])),__metadata(_0x65612e(0xa6),[typeorm_1['Repository'],typeorm_1[_0x65612e(0x9f)],nestjs_cls_1['ClsService'],user_service_1[_0x65612e(0xe5)],globalConfig_service_1[_0x65612e(0xf1)]])],BadwordsService),exports[_0x65612e(0xbb)]=BadwordsService;