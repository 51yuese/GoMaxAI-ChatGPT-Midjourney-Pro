'use strict';function _0x1550(_0x419e56,_0x3ca374){const _0x2d721b=_0x2d72();return _0x1550=function(_0x155067,_0x75a750){_0x155067=_0x155067-0x11c;let _0x25ada0=_0x2d721b[_0x155067];return _0x25ada0;},_0x1550(_0x419e56,_0x3ca374);}const _0x437653=_0x1550;(function(_0x3b0402,_0x9afc53){const _0x1f873d=_0x1550,_0x174eae=_0x3b0402();while(!![]){try{const _0x5607de=parseInt(_0x1f873d(0x168))/0x1+parseInt(_0x1f873d(0x188))/0x2*(-parseInt(_0x1f873d(0x164))/0x3)+parseInt(_0x1f873d(0x14a))/0x4*(parseInt(_0x1f873d(0x160))/0x5)+parseInt(_0x1f873d(0x177))/0x6*(parseInt(_0x1f873d(0x14f))/0x7)+parseInt(_0x1f873d(0x18a))/0x8*(parseInt(_0x1f873d(0x185))/0x9)+-parseInt(_0x1f873d(0x125))/0xa*(parseInt(_0x1f873d(0x146))/0xb)+-parseInt(_0x1f873d(0x130))/0xc*(parseInt(_0x1f873d(0x16e))/0xd);if(_0x5607de===_0x9afc53)break;else _0x174eae['push'](_0x174eae['shift']());}catch(_0x5927cc){_0x174eae['push'](_0x174eae['shift']());}}}(_0x2d72,0x6cb0f));var __decorate=this&&this[_0x437653(0x174)]||function(_0x2b7458,_0xb6a956,_0x430e37,_0xe0e66a){const _0x43be7b=_0x437653;var _0x2306a2=arguments[_0x43be7b(0x170)],_0x38b5ac=_0x2306a2<0x3?_0xb6a956:_0xe0e66a===null?_0xe0e66a=Object[_0x43be7b(0x169)](_0xb6a956,_0x430e37):_0xe0e66a,_0x43b7f2;if(typeof Reflect===_0x43be7b(0x13e)&&typeof Reflect['decorate']===_0x43be7b(0x190))_0x38b5ac=Reflect[_0x43be7b(0x184)](_0x2b7458,_0xb6a956,_0x430e37,_0xe0e66a);else{for(var _0x4d8523=_0x2b7458[_0x43be7b(0x170)]-0x1;_0x4d8523>=0x0;_0x4d8523--)if(_0x43b7f2=_0x2b7458[_0x4d8523])_0x38b5ac=(_0x2306a2<0x3?_0x43b7f2(_0x38b5ac):_0x2306a2>0x3?_0x43b7f2(_0xb6a956,_0x430e37,_0x38b5ac):_0x43b7f2(_0xb6a956,_0x430e37))||_0x38b5ac;}return _0x2306a2>0x3&&_0x38b5ac&&Object['defineProperty'](_0xb6a956,_0x430e37,_0x38b5ac),_0x38b5ac;},__metadata=this&&this[_0x437653(0x152)]||function(_0x55890c,_0x39fdff){const _0x5acddf=_0x437653;if(typeof Reflect===_0x5acddf(0x13e)&&typeof Reflect['metadata']===_0x5acddf(0x190))return Reflect[_0x5acddf(0x142)](_0x55890c,_0x39fdff);},__param=this&&this[_0x437653(0x18b)]||function(_0x3a2c5c,_0x2cb6f7){return function(_0x164ab2,_0x2e4dfd){_0x2cb6f7(_0x164ab2,_0x2e4dfd,_0x3a2c5c);};};function _0x2d72(){const _0x1446db=['default','user','extractContent','nineaiCheckBadWords','敏感词已经存在了、请勿重复添加','recordUserBadWords','stringify','violationLogEntity','百度云检测','检测失败','百度文本检测出现错误、请查看配置信息:\x20','object','updateViolationCount','includes','findOne','metadata','您提交的信息中包含违规的内容、我们已对您的账户进行标记、请合规使用！','userservice','addBadWord','7728787JsCCNs','updateBadWords','nineai','application/x-www-form-urlencoded','4JtXqoO','save','affected','__esModule','敏感词检测\x20|\x20','105tgmTZF','find','word_list','__metadata','application/json','baidu','checkBadWordsByConfig','自定义','checkBadWords','status','isSuper','ids','userInfo','HttpStatus','nestjs-cls','design:paramtypes','敏感词不存在,请检查您的提交信息','2166485DSWQXV','badWordsEntity','BadwordsService','更新敏感词失败','2240316BGdUYe','onModuleInit','findAndCount','globalConfigService','595224KuKrOA','getOwnPropertyDescriptor','badWords','BAD_REQUEST','GlobalConfigService','敏感词已存在,请检查您的提交信息','13DaTBLD','data','length','自定义检测','您提交的内容中包含','ViolationLogEntity','__decorate','push','msg','130008UEqXaR','Injectable','更新敏感词成功','keyword','getSensitiveConfig','baiduCheckBadWords','code','./violationLog.entity','join','queryBadWords','您提交的信息中包含','typeOriginCn','https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined?access_token=','decorate','225FyPbxT','forEach','log','2gRsXyz','axios','197328aQblzs','__param','ASC','hideString','userId','getUserListByIds','function','Repository','map','formarTips','baiduTextAccessToken','@nestjs/typeorm','delViolation','clsService','../user/user.service','phone','***','10qIQbpe','删除敏感词失败','的信息、我们已对您账号进行标记、请合规使用！','customSensitiveWords','email','loadBadWords','category','InjectRepository','ClsService','UserService','HttpException','907236dVJKUo','post','defineProperty'];_0x2d72=function(){return _0x1446db;};return _0x2d72();}Object[_0x437653(0x132)](exports,_0x437653(0x14d),{'value':!![]}),exports[_0x437653(0x162)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require('@nestjs/common'),badwords_entity_1=require('./badwords.entity'),typeorm_1=require('typeorm'),typeorm_2=require(_0x437653(0x11f)),axios_1=require(_0x437653(0x189)),violationLog_entity_1=require(_0x437653(0x17e)),utils_1=require('../../common/utils'),user_service_1=require(_0x437653(0x122)),nestjs_cls_1=require(_0x437653(0x15d));let BadwordsService=class BadwordsService{constructor(_0x2f8daf,_0x4fcfa4,_0xba2f77,_0x37daae,_0x1e44ca){const _0x534088=_0x437653;this['badWordsEntity']=_0x2f8daf,this[_0x534088(0x13a)]=_0x4fcfa4,this['clsService']=_0xba2f77,this['userservice']=_0x37daae,this['globalConfigService']=_0x1e44ca,this['badWords']=[];}async[_0x437653(0x165)](){const _0x4ba40f=_0x437653;this[_0x4ba40f(0x12a)]();}async['customSensitiveWords'](_0x52175d,_0x9f0bfe){const _0x1f0a28=_0x437653,_0x45a420=[];for(let _0x15426e=0x0;_0x15426e<this[_0x1f0a28(0x16a)][_0x1f0a28(0x170)];_0x15426e++){const _0x241501=this['badWords'][_0x15426e];_0x52175d[_0x1f0a28(0x140)](_0x241501)&&_0x45a420[_0x1f0a28(0x175)](_0x241501);}if(_0x45a420[_0x1f0a28(0x170)]){await this[_0x1f0a28(0x138)](_0x9f0bfe,_0x52175d,_0x45a420,[_0x1f0a28(0x156)],_0x1f0a28(0x171));const _0x235f91=_0x1f0a28(0x143);throw new common_1[(_0x1f0a28(0x12f))](_0x235f91,common_1[_0x1f0a28(0x15c)][_0x1f0a28(0x16b)]);}return!![];}async[_0x437653(0x157)](_0x5167ae,_0x3e579a){const _0x1821ff=_0x437653,_0x5b27c3=await this[_0x1821ff(0x167)][_0x1821ff(0x17b)]();_0x5b27c3&&await this[_0x1821ff(0x155)](_0x5167ae,_0x5b27c3,_0x3e579a),console[_0x1821ff(0x187)]('================================TASK==================================='),await this[_0x1821ff(0x128)](_0x5167ae,_0x3e579a);}async[_0x437653(0x155)](_0x34ec2c,_0x298743,_0x1fba59){const _0x1d15fd=_0x437653,{useType:_0x5b4320}=_0x298743;_0x5b4320===_0x1d15fd(0x154)&&await this[_0x1d15fd(0x17c)](_0x34ec2c,_0x298743[_0x1d15fd(0x11e)],_0x1fba59),_0x5b4320===_0x1d15fd(0x148)&&await this[_0x1d15fd(0x136)](_0x34ec2c,_0x298743,_0x1fba59);}[_0x437653(0x135)](_0x38c0aa){const _0x523560=/存在(.*?)不合规/,_0x55a6d9=_0x38c0aa['match'](_0x523560);return _0x55a6d9?_0x55a6d9[0x1]:'';}async[_0x437653(0x17c)](_0x459fa3,_0x1464c3,_0x29f1eb){const _0x148eee=_0x437653;if(!_0x1464c3)return;const _0x610059=_0x148eee(0x183)+_0x1464c3+'}',_0x4b5334={'Content-Type':_0x148eee(0x149),'Accept':'application/json'},_0x65e60c=await axios_1[_0x148eee(0x133)][_0x148eee(0x131)](_0x610059,{'text':_0x459fa3},{'headers':_0x4b5334}),{conclusion:_0x4f1549,error_code:_0xa77b86,error_msg:_0xe69eaf,conclusionType:_0x2a0638,data:_0x536f6a}=_0x65e60c[_0x148eee(0x16f)];_0xa77b86&&console[_0x148eee(0x187)](_0x148eee(0x13d),_0xe69eaf);if(_0x2a0638!==0x1){const _0x12e0f3=[...new Set(_0x536f6a['map'](_0x5812fc=>this[_0x148eee(0x135)](_0x5812fc[_0x148eee(0x176)])))];await this['recordUserBadWords'](_0x29f1eb,_0x459fa3,[_0x148eee(0x124)],_0x12e0f3,_0x148eee(0x13b));const _0xdb896d=_0x148eee(0x181)+_0x12e0f3[_0x148eee(0x17f)](',')+'的内容、我们已对您的账户进行标记、请合规使用！';throw new common_1[(_0x148eee(0x12f))](_0xdb896d,common_1[_0x148eee(0x15c)]['BAD_REQUEST']);}}async['nineaiCheckBadWords'](_0xcaf86f,_0x57f008,_0x5c2234){const _0x28c6c7=_0x437653,{nineaiBuiltInSensitiveApiBase:_0x355cd2,nineaiBuiltInSensitiveAuthKey:_0x49b9a1}=_0x57f008;if(!_0x355cd2||!_0x49b9a1)return;const _0x16e8bb=await axios_1[_0x28c6c7(0x133)]['post'](_0x355cd2,{'content':_0xcaf86f},{'headers':{'Content-Type':_0x28c6c7(0x153),'Authorization':_0x49b9a1}});if(!_0x16e8bb[_0x28c6c7(0x16f)])return;if(_0x16e8bb[_0x28c6c7(0x16f)][_0x28c6c7(0x17d)]!=='0'){const {msg:msg=_0x28c6c7(0x13c)}=_0x16e8bb[_0x28c6c7(0x16f)];throw new common_1['HttpException'](_0x28c6c7(0x14e)+msg,common_1['HttpStatus'][_0x28c6c7(0x16b)]);}if(_0x16e8bb['data'][_0x28c6c7(0x151)]&&_0x16e8bb[_0x28c6c7(0x16f)]['word_list']?.[_0x28c6c7(0x170)]){const _0x2f6a18=[...new Set(_0x16e8bb['data']['word_list'][_0x28c6c7(0x11c)](_0xb77f30=>_0xb77f30[_0x28c6c7(0x17a)]))],_0x1a0a48=[...new Set(_0x16e8bb[_0x28c6c7(0x16f)][_0x28c6c7(0x151)][_0x28c6c7(0x11c)](_0x287e64=>_0x287e64[_0x28c6c7(0x12b)]))];await this[_0x28c6c7(0x138)](_0x5c2234,_0xcaf86f,_0x2f6a18,_0x1a0a48,'NineAi检测');const _0x2e88af=this['formarTips'](_0x16e8bb[_0x28c6c7(0x16f)][_0x28c6c7(0x151)]);throw new common_1[(_0x28c6c7(0x12f))](_0x2e88af,common_1[_0x28c6c7(0x15c)][_0x28c6c7(0x16b)]);}}[_0x437653(0x11d)](_0x27aefa){const _0x55936a=_0x437653,_0x3c2965=_0x27aefa['map'](_0x12cdab=>_0x12cdab['category']),_0x514603=[...new Set(_0x3c2965)];return _0x55936a(0x172)+_0x514603[_0x55936a(0x17f)](',')+_0x55936a(0x127);}async[_0x437653(0x12a)](){const _0x532f2a=_0x437653,_0x52fb6a=await this[_0x532f2a(0x161)]['find']({'where':{'status':0x1},'select':['word']});this[_0x532f2a(0x16a)]=_0x52fb6a['map'](_0x2ff75e=>_0x2ff75e['word']);}async[_0x437653(0x180)](_0x49e305){const _0x105999=_0x437653,{page:page=0x1,size:size=0x1f4,word:_0x5a8f95,status:_0x46e09a}=_0x49e305,_0x2fb164={};[0x0,0x1,'0','1']['includes'](_0x46e09a)&&(_0x2fb164[_0x105999(0x158)]=_0x46e09a),_0x5a8f95&&(_0x2fb164['word']=(0x0,typeorm_1['Like'])('%'+_0x5a8f95+'%'));const [_0x7b425e,_0x372e83]=await this['badWordsEntity'][_0x105999(0x166)]({'where':_0x2fb164,'skip':(page-0x1)*size,'take':size,'order':{'id':_0x105999(0x18c)}});return{'rows':_0x7b425e,'count':_0x372e83};}async['delBadWords'](_0x5b403c){const _0x318cda=_0x437653,_0x4e6cbd=await this[_0x318cda(0x161)][_0x318cda(0x141)]({'where':{'id':_0x5b403c['id']}});if(!_0x4e6cbd)throw new common_1[(_0x318cda(0x12f))](_0x318cda(0x15f),common_1['HttpStatus'][_0x318cda(0x16b)]);const _0x44f3ac=await this[_0x318cda(0x161)]['delete']({'id':_0x5b403c['id']});if(_0x44f3ac[_0x318cda(0x14c)]>0x0)return await this[_0x318cda(0x12a)](),'删除敏感词成功';else throw new common_1[(_0x318cda(0x12f))](_0x318cda(0x126),common_1[_0x318cda(0x15c)][_0x318cda(0x16b)]);}async[_0x437653(0x147)](_0x17205f){const _0xd0fbda=_0x437653,{id:_0x509061,word:_0x2c0230,status:_0x30dec0}=_0x17205f,_0x4d646f=await this['badWordsEntity']['findOne']({'where':{'word':_0x2c0230}});if(_0x4d646f)throw new common_1['HttpException'](_0xd0fbda(0x137),common_1['HttpStatus'][_0xd0fbda(0x16b)]);const _0x3868bd=await this[_0xd0fbda(0x161)]['update']({'id':_0x509061},{'word':_0x2c0230,'status':_0x30dec0});if(_0x3868bd['affected']>0x0)return await this[_0xd0fbda(0x12a)](),_0xd0fbda(0x179);else throw new common_1[(_0xd0fbda(0x12f))](_0xd0fbda(0x163),common_1['HttpStatus'][_0xd0fbda(0x16b)]);}async[_0x437653(0x145)](_0x5263a6){const _0x5ee73b=_0x437653,{word:_0x55251e}=_0x5263a6,_0x1b9b42=await this[_0x5ee73b(0x161)][_0x5ee73b(0x141)]({'where':{'word':_0x55251e}});if(_0x1b9b42)throw new common_1[(_0x5ee73b(0x12f))](_0x5ee73b(0x16d),common_1[_0x5ee73b(0x15c)][_0x5ee73b(0x16b)]);return await this[_0x5ee73b(0x161)][_0x5ee73b(0x14b)]({'word':_0x55251e}),await this[_0x5ee73b(0x12a)](),'添加敏感词成功';}async['recordUserBadWords'](_0xfac1af,_0x3b1b4c,_0x5c3ebf,_0x3f870a,_0x33382b){const _0x392885=_0x437653,_0x1b7546={'userId':_0xfac1af,'content':_0x3b1b4c,'words':JSON['stringify'](_0x5c3ebf),'typeCn':JSON[_0x392885(0x139)](_0x3f870a),'typeOriginCn':_0x33382b};try{await this['userservice'][_0x392885(0x13f)](_0xfac1af),await this[_0x392885(0x13a)][_0x392885(0x14b)](_0x1b7546);}catch(_0x32d182){console[_0x392885(0x187)]('error:\x20',_0x32d182);}}async['violation'](_0x16b600,_0x216c0f){const _0x2a5906=_0x437653,{role:_0x1a990b}=_0x16b600[_0x2a5906(0x134)],{page:page=0x1,size:size=0xa,userId:_0x4bbf06,typeOriginCn:_0x101642}=_0x216c0f,_0x2b3d65={'delFlag':0x0};_0x4bbf06&&(_0x2b3d65['userId']=_0x4bbf06),_0x101642&&(_0x2b3d65[_0x2a5906(0x182)]=_0x101642);const [_0x45b714,_0x235ba1]=await this[_0x2a5906(0x13a)][_0x2a5906(0x166)]({'where':_0x2b3d65,'skip':(page-0x1)*size,'take':size,'order':{'id':'DESC'}}),_0x3d9651=[...new Set(_0x45b714[_0x2a5906(0x11c)](_0x4ba701=>_0x4ba701[_0x2a5906(0x18e)]))],_0x2e8a2a=await this[_0x2a5906(0x144)][_0x2a5906(0x18f)](_0x3d9651);return _0x45b714[_0x2a5906(0x186)](_0x1b44d=>{const _0x2adf6c=_0x2a5906,_0x1d3079=_0x2e8a2a[_0x2adf6c(0x150)](_0xe5633a=>_0xe5633a['id']===_0x1b44d[_0x2adf6c(0x18e)]);!(0x0,utils_1[_0x2adf6c(0x159)])(this[_0x2adf6c(0x121)])&&(_0x1d3079[_0x2adf6c(0x129)]=(0x0,utils_1[_0x2adf6c(0x18d)])(_0x1d3079['email']),_0x1d3079['phone']=(0x0,utils_1[_0x2adf6c(0x18d)])(_0x1d3079[_0x2adf6c(0x123)])),_0x1b44d[_0x2adf6c(0x15b)]=_0x1d3079;}),{'rows':_0x45b714,'count':_0x235ba1};}async[_0x437653(0x120)](_0x51fd28){const _0x91cc44=_0x437653;if(!_0x51fd28[_0x91cc44(0x15a)]['length'])return!![];return await this[_0x91cc44(0x13a)]['update']({'id':(0x0,typeorm_1['In'])(_0x51fd28['ids'])},{'delFlag':0x1}),!![];}};BadwordsService=__decorate([(0x0,common_1[_0x437653(0x178)])(),__param(0x0,(0x0,typeorm_2[_0x437653(0x12c)])(badwords_entity_1['BadWordsEntity'])),__param(0x1,(0x0,typeorm_2[_0x437653(0x12c)])(violationLog_entity_1[_0x437653(0x173)])),__metadata(_0x437653(0x15e),[typeorm_1['Repository'],typeorm_1[_0x437653(0x191)],nestjs_cls_1[_0x437653(0x12d)],user_service_1[_0x437653(0x12e)],globalConfig_service_1[_0x437653(0x16c)]])],BadwordsService),exports['BadwordsService']=BadwordsService;