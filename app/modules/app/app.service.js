'use strict';const _0x2b845f=_0x17cc;(function(_0xc08592,_0x4df470){const _0x470c8b=_0x17cc,_0x369a36=_0xc08592();while(!![]){try{const _0x67a69=parseInt(_0x470c8b(0x117))/0x1*(-parseInt(_0x470c8b(0x10c))/0x2)+parseInt(_0x470c8b(0x104))/0x3*(parseInt(_0x470c8b(0x11c))/0x4)+parseInt(_0x470c8b(0x11b))/0x5+parseInt(_0x470c8b(0xf5))/0x6*(-parseInt(_0x470c8b(0xe8))/0x7)+-parseInt(_0x470c8b(0xed))/0x8+parseInt(_0x470c8b(0xee))/0x9*(parseInt(_0x470c8b(0xe6))/0xa)+parseInt(_0x470c8b(0xef))/0xb;if(_0x67a69===_0x4df470)break;else _0x369a36['push'](_0x369a36['shift']());}catch(_0x26cfed){_0x369a36['push'](_0x369a36['shift']());}}}(_0x452d,0x749e5));var __decorate=this&&this['__decorate']||function(_0x2a454f,_0x1dfcba,_0x4e75e3,_0x4ad20d){const _0xfbb21b=_0x17cc;var _0x193630=arguments[_0xfbb21b(0x116)],_0x40ac84=_0x193630<0x3?_0x1dfcba:_0x4ad20d===null?_0x4ad20d=Object[_0xfbb21b(0xf8)](_0x1dfcba,_0x4e75e3):_0x4ad20d,_0x186452;if(typeof Reflect===_0xfbb21b(0x10a)&&typeof Reflect[_0xfbb21b(0xfe)]===_0xfbb21b(0x107))_0x40ac84=Reflect[_0xfbb21b(0xfe)](_0x2a454f,_0x1dfcba,_0x4e75e3,_0x4ad20d);else{for(var _0x3b9ece=_0x2a454f['length']-0x1;_0x3b9ece>=0x0;_0x3b9ece--)if(_0x186452=_0x2a454f[_0x3b9ece])_0x40ac84=(_0x193630<0x3?_0x186452(_0x40ac84):_0x193630>0x3?_0x186452(_0x1dfcba,_0x4e75e3,_0x40ac84):_0x186452(_0x1dfcba,_0x4e75e3))||_0x40ac84;}return _0x193630>0x3&&_0x40ac84&&Object[_0xfbb21b(0x11e)](_0x1dfcba,_0x4e75e3,_0x40ac84),_0x40ac84;},__metadata=this&&this[_0x2b845f(0xfb)]||function(_0x150b09,_0xa75b7b){const _0x112fa2=_0x2b845f;if(typeof Reflect===_0x112fa2(0x10a)&&typeof Reflect[_0x112fa2(0x10b)]==='function')return Reflect['metadata'](_0x150b09,_0xa75b7b);},__param=this&&this[_0x2b845f(0xff)]||function(_0x5cdbee,_0x4b2456){return function(_0x50f5a9,_0x3ed69c){_0x4b2456(_0x50f5a9,_0x3ed69c,_0x5cdbee);};};Object[_0x2b845f(0x11e)](exports,_0x2b845f(0x114),{'value':!![]}),exports[_0x2b845f(0x111)]=void 0x0;const common_1=require(_0x2b845f(0xea)),typeorm_1=require(_0x2b845f(0xf7)),typeorm_2=require(_0x2b845f(0x11d)),userApps_entity_1=require(_0x2b845f(0xf3)),gpts_model_entity_1=require(_0x2b845f(0xec));let AppService=class AppService{constructor(_0xe1a0f7,_0x3b004b,_0x4e7aa5){const _0xccbcd6=_0x2b845f;this[_0xccbcd6(0x11f)]=_0xe1a0f7,this[_0xccbcd6(0xf4)]=_0x3b004b,this[_0xccbcd6(0xe9)]=_0x4e7aa5;}async[_0x2b845f(0x118)](_0x657a7f,_0xedfeb8){const _0x2dc00e=_0x2b845f,{appId:_0x763544}=_0x657a7f,{id:_0x405589}=_0xedfeb8['user'];try{const _0x9bb007=await this['userAppsEntity'][_0x2dc00e(0x102)]({'where':{'appId':_0x763544,'userId':_0x405589}})[_0x2dc00e(0xf2)](_0x304074=>{const _0x524fe0=_0x2dc00e;common_1['Logger'][_0x524fe0(0x10e)](_0x304074);});if(_0x9bb007){const _0x366386=await this[_0x2dc00e(0xf4)][_0x2dc00e(0x120)]({'appId':_0x763544,'userId':_0x405589})[_0x2dc00e(0xf2)](_0x523d0a=>{const _0x530a72=_0x2dc00e;common_1[_0x530a72(0x10d)][_0x530a72(0x10e)](_0x523d0a);});if(!_0x366386||_0x366386[_0x2dc00e(0x110)]<=0x0)throw new common_1['HttpException'](_0x2dc00e(0x11a),common_1[_0x2dc00e(0xfd)][_0x2dc00e(0xf0)]);return _0x2dc00e(0x106);}const _0xf88240=await this[_0x2dc00e(0x11f)][_0x2dc00e(0x102)]({'where':{'id':_0x763544}})[_0x2dc00e(0xf2)](_0x330909=>{const _0x330f98=_0x2dc00e;common_1[_0x330f98(0x10d)][_0x330f98(0x10e)](_0x330909);});if(!_0xf88240)throw new common_1[(_0x2dc00e(0xe7))](_0x2dc00e(0xf6),common_1['HttpStatus'][_0x2dc00e(0xf0)]);const _0x546756={'userId':_0x405589,'appId':_0xf88240['id'],'catId':_0xf88240[_0x2dc00e(0x100)],'appRole':_0x2dc00e(0x109),'public':!![],'status':0x1};return await this[_0x2dc00e(0xf4)][_0x2dc00e(0x119)](_0x546756)[_0x2dc00e(0xf2)](_0x3d2319=>{const _0x21d8dd=_0x2dc00e;common_1[_0x21d8dd(0x10d)][_0x21d8dd(0x10e)](_0x3d2319);}),_0xf88240['collectCount']=_0xf88240[_0x2dc00e(0xf9)]+Math[_0x2dc00e(0x121)](Math['random']()*0xa),await this[_0x2dc00e(0x11f)]['save'](_0xf88240),'已将应用添加到我的应用！';}catch(_0x241a26){console[_0x2dc00e(0x10e)](_0x241a26);}}async[_0x2b845f(0xfa)](_0x93d34a,_0x2221dd={'page':0x1,'size':0x64}){const _0x2948c6=_0x2b845f,{id:_0x5e5045}=_0x93d34a[_0x2948c6(0x122)],{page:page=0x1,size:size=0x64}=_0x2221dd;try{const _0x581b54=await this[_0x2948c6(0xe9)][_0x2948c6(0x112)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_apps\x20ua\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20gpts_models\x20gm\x20ON\x20ua.appId\x20=\x20gm.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20gpts_group\x20gg\x20ON\x20gm.groupId\x20=\x20gg.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ua.userId\x20=\x20'+_0x5e5045+_0x2948c6(0xf1)),_0xf1b104=await this[_0x2948c6(0xe9)]['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gm.*,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20gg.groupName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ua.createdAt\x20AS\x20collectTime\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_apps\x20ua\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20gpts_models\x20gm\x20ON\x20ua.appId\x20=\x20gm.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20gpts_group\x20gg\x20ON\x20gm.groupId\x20=\x20gg.id\x0a\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ua.userId\x20=\x20'+_0x5e5045+'\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20gm.id\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ua.createdAt\x20DESC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20'+size+'\x20OFFSET\x20'+(page-0x1)*size+'\x0a\x20\x20\x20\x20\x20\x20');return{'rows':_0xf1b104,'count':Number(_0x581b54[0x0]?.[_0x2948c6(0x103)]||0x0)};}catch(_0x34cfe1){console[_0x2948c6(0x10e)](_0x34cfe1[_0x2948c6(0x113)]);}}};function _0x17cc(_0x1f9527,_0x132e98){const _0x452dca=_0x452d();return _0x17cc=function(_0x17cc31,_0x46ba55){_0x17cc31=_0x17cc31-0xe6;let _0x2ee0d8=_0x452dca[_0x17cc31];return _0x2ee0d8;},_0x17cc(_0x1f9527,_0x132e98);}function _0x452d(){const _0x173c00=['5046118zYVAge','BAD_REQUEST','\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20gm.id\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20','catch','./userApps.entity','userAppsEntity','2760yCErMt','操作失败！','typeorm','getOwnPropertyDescriptor','collectCount','mineAppsV3','__metadata','UserAppsEntity','HttpStatus','decorate','__param','groupId','InjectRepository','findOne','count','28173uDzqeC','Connection','已将应用移除我的应用!','function','Repository','system','object','metadata','86PEkKFN','Logger','log','GptsModelEntity','affected','AppService','query','message','__esModule','Injectable','length','974fZzmDv','collect','save','取消移除我的应用失败！','1288390DBCtPd','212hqPPxv','@nestjs/typeorm','defineProperty','gptsModelEntity','delete','round','user','201010lDVhmu','HttpException','8974WTUiYq','connection','@nestjs/common','design:paramtypes','../gpts/gpts.model.entity','3090256MANtQG','126JOuYfc'];_0x452d=function(){return _0x173c00;};return _0x452d();}AppService=__decorate([(0x0,common_1[_0x2b845f(0x115)])(),__param(0x0,(0x0,typeorm_2[_0x2b845f(0x101)])(gpts_model_entity_1[_0x2b845f(0x10f)])),__param(0x1,(0x0,typeorm_2[_0x2b845f(0x101)])(userApps_entity_1[_0x2b845f(0xfc)])),__metadata(_0x2b845f(0xeb),[typeorm_1[_0x2b845f(0x108)],typeorm_1[_0x2b845f(0x108)],typeorm_1[_0x2b845f(0x105)]])],AppService),exports[_0x2b845f(0x111)]=AppService;