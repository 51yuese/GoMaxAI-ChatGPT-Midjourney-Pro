'use strict';const _0x29c549=_0x38e5;(function(_0x1540d1,_0x5b51da){const _0x16b2d3=_0x38e5,_0x375fd4=_0x1540d1();while(!![]){try{const _0x45ddfb=parseInt(_0x16b2d3(0x1de))/0x1*(-parseInt(_0x16b2d3(0x1c9))/0x2)+parseInt(_0x16b2d3(0x1e6))/0x3*(-parseInt(_0x16b2d3(0x1ac))/0x4)+-parseInt(_0x16b2d3(0x19d))/0x5*(-parseInt(_0x16b2d3(0x1c5))/0x6)+-parseInt(_0x16b2d3(0x1ce))/0x7*(-parseInt(_0x16b2d3(0x1ab))/0x8)+-parseInt(_0x16b2d3(0x1dc))/0x9+parseInt(_0x16b2d3(0x1a9))/0xa+parseInt(_0x16b2d3(0x1af))/0xb*(parseInt(_0x16b2d3(0x1bf))/0xc);if(_0x45ddfb===_0x5b51da)break;else _0x375fd4['push'](_0x375fd4['shift']());}catch(_0x4e15e0){_0x375fd4['push'](_0x375fd4['shift']());}}}(_0xcdee,0x60c3f));var __decorate=this&&this[_0x29c549(0x1b3)]||function(_0x919da1,_0x5f567e,_0x397fd,_0x480299){const _0x2dbc78=_0x29c549;var _0x2c98e5=arguments[_0x2dbc78(0x1c0)],_0x1c0532=_0x2c98e5<0x3?_0x5f567e:_0x480299===null?_0x480299=Object[_0x2dbc78(0x1df)](_0x5f567e,_0x397fd):_0x480299,_0x3cf837;if(typeof Reflect==='object'&&typeof Reflect[_0x2dbc78(0x1bb)]===_0x2dbc78(0x19f))_0x1c0532=Reflect[_0x2dbc78(0x1bb)](_0x919da1,_0x5f567e,_0x397fd,_0x480299);else{for(var _0x26b6dc=_0x919da1[_0x2dbc78(0x1c0)]-0x1;_0x26b6dc>=0x0;_0x26b6dc--)if(_0x3cf837=_0x919da1[_0x26b6dc])_0x1c0532=(_0x2c98e5<0x3?_0x3cf837(_0x1c0532):_0x2c98e5>0x3?_0x3cf837(_0x5f567e,_0x397fd,_0x1c0532):_0x3cf837(_0x5f567e,_0x397fd))||_0x1c0532;}return _0x2c98e5>0x3&&_0x1c0532&&Object[_0x2dbc78(0x1a6)](_0x5f567e,_0x397fd,_0x1c0532),_0x1c0532;},__metadata=this&&this[_0x29c549(0x1f1)]||function(_0x29def1,_0x4d2db5){const _0xdd88c2=_0x29c549;if(typeof Reflect===_0xdd88c2(0x1e8)&&typeof Reflect[_0xdd88c2(0x1cb)]==='function')return Reflect[_0xdd88c2(0x1cb)](_0x29def1,_0x4d2db5);};Object[_0x29c549(0x1a6)](exports,_0x29c549(0x1b4),{'value':!![]}),exports[_0x29c549(0x1b9)]=void 0x0;const globalConfig_service_1=require(_0x29c549(0x1b1)),common_1=require(_0x29c549(0x1d5)),axios_1=require(_0x29c549(0x1e0)),crypto=require(_0x29c549(0x1b5)),openai_1=require(_0x29c549(0x1be)),utils_1=require('../../common/utils'),models_service_1=require('../models/models.service'),model_constant_1=require(_0x29c549(0x1e4));let FanyiService=class FanyiService{constructor(_0x38f694,_0x445a4a){const _0x4c6224=_0x29c549;this[_0x4c6224(0x1d7)]=_0x38f694,this[_0x4c6224(0x1ef)]=_0x445a4a,this[_0x4c6224(0x1e7)]=_0x4c6224(0x1bc);}[_0x29c549(0x1cf)](){const _0x3c2d79=_0x29c549;this[_0x3c2d79(0x1dd)]=new openai_1[(_0x3c2d79(0x1e3))]({'apiKey':_0x3c2d79(0x1d0),'baseURL':this[_0x3c2d79(0x1e7)]+_0x3c2d79(0x1c3)});}async[_0x29c549(0x1d8)](_0x24af44){const _0xad5a47=_0x29c549;if(!_0x24af44)throw new common_1[(_0xad5a47(0x1db))](_0xad5a47(0x1a0),common_1[_0xad5a47(0x1a3)]['BAD_REQUEST']);const {baiduFanyiAppId:_0x2c904f,baiduFanyiSecret:_0x57dfa3}=await this['globalConfigService'][_0xad5a47(0x1da)](['baiduFanyiAppId',_0xad5a47(0x1ee)]);if(!_0x2c904f||!_0x57dfa3)throw new common_1['HttpException'](_0xad5a47(0x1eb),common_1[_0xad5a47(0x1a3)][_0xad5a47(0x1c2)]);const _0x417bc2=Date[_0xad5a47(0x1ca)]()[_0xad5a47(0x1ed)](),_0x51c9c=crypto[_0xad5a47(0x1aa)](_0xad5a47(0x1d9))[_0xad5a47(0x1ea)](_0x2c904f+_0x24af44+_0x417bc2+_0x57dfa3)[_0xad5a47(0x1a7)](_0xad5a47(0x1e9)),_0x25f6c1=_0xad5a47(0x1d1),_0x88e8b6={'q':_0x24af44['toString'](),'from':_0xad5a47(0x1b8),'to':'en','appid':_0x2c904f,'salt':_0x417bc2,'sign':_0x51c9c},_0x1d7a1b=await axios_1[_0xad5a47(0x1e3)][_0xad5a47(0x1a2)](_0x25f6c1,_0x88e8b6,{'headers':{'Content-Type':_0xad5a47(0x1cd)}}),{from:_0x215e7b,to:_0x11090b,trans_result:_0x5f415f,error_code:_0x186748,error_msg:_0x3e5129}=_0x1d7a1b[_0xad5a47(0x1b6)];if(_0x186748)throw new common_1[(_0xad5a47(0x1db))]('翻译失败['+_0x186748+']['+_0x3e5129+']!',common_1[_0xad5a47(0x1a3)]['BAD_REQUEST']);if(!_0x5f415f||!_0x5f415f[_0xad5a47(0x1c0)])throw new common_1[(_0xad5a47(0x1db))](_0xad5a47(0x1e1)+_0x186748+']['+_0x3e5129+']!',common_1['HttpStatus'][_0xad5a47(0x1c2)]);else return _0x5f415f[0x0][_0xad5a47(0x1c4)];}async[_0x29c549(0x1d2)](_0x514326){const _0x4e993e=_0x29c549,_0xb62fd1=_0x4e993e(0x1a5);let _0x324bd7=await this[_0x4e993e(0x1ef)]['getRandomKey'](model_constant_1[_0x4e993e(0x1d4)]['OTHER']);if(!_0x324bd7)throw new common_1[(_0x4e993e(0x1db))](_0x4e993e(0x1e2),common_1['HttpStatus']['BAD_REQUEST']);const {timeout:_0x3d7b58,model:_0x1d5bf4,key:_0x3901f7,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x44607e}=_0x324bd7;let _0x15df6f=_0x44607e;!_0x44607e&&(_0x15df6f=await this['globalConfigService'][_0x4e993e(0x1da)]([_0x4e993e(0x1ec)]));this[_0x4e993e(0x1dd)][_0x4e993e(0x1c8)]=(0x0,utils_1['removeSpecialCharacters'])(_0x3901f7),this[_0x4e993e(0x1dd)][_0x4e993e(0x1d3)]=(_0x15df6f||this[_0x4e993e(0x1e7)])+_0x4e993e(0x1c3),this[_0x4e993e(0x1dd)][_0x4e993e(0x1ad)]=0x493e0;try{common_1[_0x4e993e(0x1b7)][_0x4e993e(0x1b2)](_0x3901f7,'translate\x20key'),common_1[_0x4e993e(0x1b7)][_0x4e993e(0x1b2)](_0x15df6f,'gpt-fanyi');const _0x706b4d=Date[_0x4e993e(0x1ca)](),_0x238a61=await this[_0x4e993e(0x1dd)]['chat'][_0x4e993e(0x1cc)][_0x4e993e(0x1e5)]({'messages':[{'role':_0x4e993e(0x1a4),'content':_0xb62fd1},{'role':_0x4e993e(0x1b0),'content':_0x514326}],'model':_0x4e993e(0x1f0),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0x4e993e(0x1ae)}})[_0x4e993e(0x1bd)](_0x40966b=>{const _0x41a46a=_0x4e993e;return _0x40966b?.[_0x41a46a(0x1d6)][0x0]?.[_0x41a46a(0x1a8)]['content']||'';})['catch'](_0x2b7bcc=>{return common_1['Logger']['error'](_0x2b7bcc),'';}),_0x32967a=Date[_0x4e993e(0x1ca)](),_0x29ed03=(_0x32967a-_0x706b4d)/0x3e8;return common_1[_0x4e993e(0x1b7)][_0x4e993e(0x1b2)](_0x29ed03,_0x4e993e(0x1a1)),_0x238a61;}catch(_0x4f57fc){console[_0x4e993e(0x1b2)](_0x4e993e(0x1c7),_0x3901f7,_0x4f57fc);throw new common_1[(_0x4e993e(0x1db))](_0x4f57fc['message'],common_1[_0x4e993e(0x1a3)][_0x4e993e(0x1c2)]);}}};function _0xcdee(){const _0x2b139b=['120IskwNc','length','GlobalConfigService','BAD_REQUEST','/v1','dst','966byvLln','design:paramtypes','fanyi-error','apiKey','452550fIuhLi','now','metadata','completions','application/x-www-form-urlencoded','693581EdSgiC','onModuleInit','default-gomaxai-key','https://fanyi-api.baidu.com/api/trans/vip/translate','translateToEnglish','baseURL','EModelType','@nestjs/common','choices','globalConfigService','convertToEnglish','md5','getConfigByKeys','HttpException','5584563DpJPGd','api','1OBVukf','getOwnPropertyDescriptor','axios','翻译失败[','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','default','../../common/constants/model.constant','create','128517jaRnSg','defaultUrl','object','hex','update','当前管理员还未开放翻译服务、请联系管理员开通吧!','openaiBaseUrl','toString','baiduFanyiSecret','modelsService','gpt-4-all','__metadata','345sraoLn','Injectable','function','请输入要翻译的内容!','翻译花费时间\x20%s\x20秒','post','HttpStatus','system','接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！','defineProperty','digest','message','6299780nlgNIt','createHash','48ovSkxP','32unEZUK','timeout','text','385286VDkbCb','user','./../globalConfig/globalConfig.service','log','__decorate','__esModule','crypto','data','Logger','auto','FanyiService','ModelsService','decorate','https://api.openai.com','then','openai'];_0xcdee=function(){return _0x2b139b;};return _0xcdee();}function _0x38e5(_0x3bdebb,_0x5b171f){const _0xcdee0b=_0xcdee();return _0x38e5=function(_0x38e599,_0x404c1d){_0x38e599=_0x38e599-0x19d;let _0x466532=_0xcdee0b[_0x38e599];return _0x466532;},_0x38e5(_0x3bdebb,_0x5b171f);}FanyiService=__decorate([(0x0,common_1[_0x29c549(0x19e)])(),__metadata(_0x29c549(0x1c6),[globalConfig_service_1[_0x29c549(0x1c1)],models_service_1[_0x29c549(0x1ba)]])],FanyiService),exports[_0x29c549(0x1b9)]=FanyiService;