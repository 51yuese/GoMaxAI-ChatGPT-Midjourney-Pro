'use strict';const _0x38c260=_0xb095;function _0x538b(){const _0x6d12b7=['openaiBaseUrl','gpt-4-all','请输入要翻译的内容!','HttpException','getOwnPropertyDescriptor','axios','translate\x20key','api','__decorate','defaultUrl','onModuleInit','677103UaLRKj','14736oJLphC','Logger','design:paramtypes','now','system','HttpStatus','3qbTRiK','ModelsService','log','105VSTYRN','then','apiKey','toString','crypto','timeout','default','618260RCkDHu','24yQRhzW','翻译失败[','baiduFanyiAppId','BAD_REQUEST','digest','error','/v1','post','EModelType','getRandomKey','createHash','GlobalConfigService','globalConfigService','completions','hex','message','54qCIXWB','接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！','237244caVltz','@nestjs/common','application/x-www-form-urlencoded','../../common/utils','当前管理员还未开放翻译服务、请联系管理员开通吧!','getConfigByKeys','../../common/constants/model.constant','翻译花费时间\x20%s\x20秒','object','convertToEnglish','md5','dst','FanyiService','1041544LGTuPH','translateToEnglish','defineProperty','auto','decorate','1104640BybIdV','__metadata','Injectable','modelsService','create','chat','data','https://fanyi-api.baidu.com/api/trans/vip/translate','gpt-fanyi','18095UdGMMu','OTHER','4903176baMyMK','https://api.openai.com','function','../models/models.service'];_0x538b=function(){return _0x6d12b7;};return _0x538b();}(function(_0x498676,_0xdebe1d){const _0x2a5f77=_0xb095,_0x176a9d=_0x498676();while(!![]){try{const _0x58e477=parseInt(_0x2a5f77(0x1d3))/0x1+-parseInt(_0x2a5f77(0x1d8))/0x2*(-parseInt(_0x2a5f77(0x1f9))/0x3)+parseInt(_0x2a5f77(0x1c6))/0x4*(parseInt(_0x2a5f77(0x1fc))/0x5)+-parseInt(_0x2a5f77(0x1e3))/0x6+parseInt(_0x2a5f77(0x1f2))/0x7*(parseInt(_0x2a5f77(0x204))/0x8)+-parseInt(_0x2a5f77(0x1c4))/0x9*(-parseInt(_0x2a5f77(0x203))/0xa)+parseInt(_0x2a5f77(0x1e1))/0xb*(-parseInt(_0x2a5f77(0x1f3))/0xc);if(_0x58e477===_0xdebe1d)break;else _0x176a9d['push'](_0x176a9d['shift']());}catch(_0x36bbce){_0x176a9d['push'](_0x176a9d['shift']());}}}(_0x538b,0xa1ef2));var __decorate=this&&this[_0x38c260(0x1ef)]||function(_0xda4feb,_0x153e63,_0x4c8765,_0x5c77e1){const _0x371672=_0x38c260;var _0x57f9e8=arguments['length'],_0x551e47=_0x57f9e8<0x3?_0x153e63:_0x5c77e1===null?_0x5c77e1=Object[_0x371672(0x1eb)](_0x153e63,_0x4c8765):_0x5c77e1,_0x38467e;if(typeof Reflect===_0x371672(0x1ce)&&typeof Reflect[_0x371672(0x1d7)]===_0x371672(0x1e5))_0x551e47=Reflect[_0x371672(0x1d7)](_0xda4feb,_0x153e63,_0x4c8765,_0x5c77e1);else{for(var _0x301ddc=_0xda4feb['length']-0x1;_0x301ddc>=0x0;_0x301ddc--)if(_0x38467e=_0xda4feb[_0x301ddc])_0x551e47=(_0x57f9e8<0x3?_0x38467e(_0x551e47):_0x57f9e8>0x3?_0x38467e(_0x153e63,_0x4c8765,_0x551e47):_0x38467e(_0x153e63,_0x4c8765))||_0x551e47;}return _0x57f9e8>0x3&&_0x551e47&&Object[_0x371672(0x1d5)](_0x153e63,_0x4c8765,_0x551e47),_0x551e47;},__metadata=this&&this[_0x38c260(0x1d9)]||function(_0xab83c3,_0x6677c5){const _0x246395=_0x38c260;if(typeof Reflect===_0x246395(0x1ce)&&typeof Reflect['metadata']===_0x246395(0x1e5))return Reflect['metadata'](_0xab83c3,_0x6677c5);};Object[_0x38c260(0x1d5)](exports,'__esModule',{'value':!![]}),exports[_0x38c260(0x1d2)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x38c260(0x1c7)),axios_1=require(_0x38c260(0x1ec)),crypto=require(_0x38c260(0x200)),openai_1=require('openai'),utils_1=require(_0x38c260(0x1c9)),models_service_1=require(_0x38c260(0x1e6)),model_constant_1=require(_0x38c260(0x1cc));let FanyiService=class FanyiService{constructor(_0x246369,_0x4c9570){const _0x46da37=_0x38c260;this[_0x46da37(0x210)]=_0x246369,this[_0x46da37(0x1db)]=_0x4c9570,this['defaultUrl']=_0x46da37(0x1e4);}[_0x38c260(0x1f1)](){const _0x473362=_0x38c260;this[_0x473362(0x1ee)]=new openai_1['default']({'apiKey':'default-gomaxai-key','baseURL':this[_0x473362(0x1f0)]+_0x473362(0x20a)});}async[_0x38c260(0x1cf)](_0x35730c){const _0x5d021f=_0x38c260;if(!_0x35730c)throw new common_1[(_0x5d021f(0x1ea))](_0x5d021f(0x1e9),common_1['HttpStatus']['BAD_REQUEST']);const {baiduFanyiAppId:_0xe6c025,baiduFanyiSecret:_0x4b8772}=await this[_0x5d021f(0x210)][_0x5d021f(0x1cb)]([_0x5d021f(0x206),'baiduFanyiSecret']);if(!_0xe6c025||!_0x4b8772)throw new common_1[(_0x5d021f(0x1ea))](_0x5d021f(0x1ca),common_1[_0x5d021f(0x1f8)]['BAD_REQUEST']);const _0x4870b9=Date[_0x5d021f(0x1f6)]()[_0x5d021f(0x1ff)](),_0x430bde=crypto[_0x5d021f(0x20e)](_0x5d021f(0x1d0))['update'](_0xe6c025+_0x35730c+_0x4870b9+_0x4b8772)[_0x5d021f(0x208)](_0x5d021f(0x212)),_0x39735e=_0x5d021f(0x1df),_0x50c9b0={'q':_0x35730c[_0x5d021f(0x1ff)](),'from':_0x5d021f(0x1d6),'to':'en','appid':_0xe6c025,'salt':_0x4870b9,'sign':_0x430bde},_0x7af5bb=await axios_1[_0x5d021f(0x202)][_0x5d021f(0x20b)](_0x39735e,_0x50c9b0,{'headers':{'Content-Type':_0x5d021f(0x1c8)}}),{from:_0x3610e3,to:_0x2ff0b8,trans_result:_0x1602a3,error_code:_0x3784c4,error_msg:_0x1f854d}=_0x7af5bb[_0x5d021f(0x1de)];if(_0x3784c4)throw new common_1[(_0x5d021f(0x1ea))](_0x5d021f(0x205)+_0x3784c4+']['+_0x1f854d+']!',common_1[_0x5d021f(0x1f8)][_0x5d021f(0x207)]);if(!_0x1602a3||!_0x1602a3['length'])throw new common_1[(_0x5d021f(0x1ea))](_0x5d021f(0x205)+_0x3784c4+']['+_0x1f854d+']!',common_1['HttpStatus'][_0x5d021f(0x207)]);else return _0x1602a3[0x0][_0x5d021f(0x1d1)];}async[_0x38c260(0x1d4)](_0x15dbc9){const _0xfb2b7f=_0x38c260,_0x4ccdaf=_0xfb2b7f(0x1c5);let _0x2612bf=await this['modelsService'][_0xfb2b7f(0x20d)](model_constant_1[_0xfb2b7f(0x20c)][_0xfb2b7f(0x1e2)]);if(!_0x2612bf)throw new common_1[(_0xfb2b7f(0x1ea))]('当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！',common_1[_0xfb2b7f(0x1f8)][_0xfb2b7f(0x207)]);const {timeout:_0x585050,model:_0x2df8cb,key:_0x1d045c,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x43391a}=_0x2612bf;let _0x22ef3e=_0x43391a;!_0x43391a&&(_0x22ef3e=await this['globalConfigService']['getConfigByKeys']([_0xfb2b7f(0x1e7)]));this[_0xfb2b7f(0x1ee)][_0xfb2b7f(0x1fe)]=(0x0,utils_1['removeSpecialCharacters'])(_0x1d045c),this[_0xfb2b7f(0x1ee)]['baseURL']=(_0x22ef3e||this[_0xfb2b7f(0x1f0)])+_0xfb2b7f(0x20a),this[_0xfb2b7f(0x1ee)][_0xfb2b7f(0x201)]=0x493e0;try{common_1[_0xfb2b7f(0x1f4)]['log'](_0x1d045c,_0xfb2b7f(0x1ed)),common_1[_0xfb2b7f(0x1f4)][_0xfb2b7f(0x1fb)](_0x22ef3e,_0xfb2b7f(0x1e0));const _0x3826ba=Date[_0xfb2b7f(0x1f6)](),_0x127d56=await this[_0xfb2b7f(0x1ee)][_0xfb2b7f(0x1dd)][_0xfb2b7f(0x211)][_0xfb2b7f(0x1dc)]({'messages':[{'role':_0xfb2b7f(0x1f7),'content':_0x4ccdaf},{'role':'user','content':_0x15dbc9}],'model':_0xfb2b7f(0x1e8),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':'text'}})[_0xfb2b7f(0x1fd)](_0xb69781=>{const _0x503978=_0xfb2b7f;return _0xb69781?.['choices'][0x0]?.[_0x503978(0x213)]['content']||'';})['catch'](_0x5f2f0e=>{const _0x1ff5c=_0xfb2b7f;return common_1[_0x1ff5c(0x1f4)][_0x1ff5c(0x209)](_0x5f2f0e),'';}),_0x3f5cb1=Date[_0xfb2b7f(0x1f6)](),_0x1c4800=(_0x3f5cb1-_0x3826ba)/0x3e8;return common_1[_0xfb2b7f(0x1f4)][_0xfb2b7f(0x1fb)](_0x1c4800,_0xfb2b7f(0x1cd)),_0x127d56;}catch(_0x5d750a){console['log']('fanyi-error',_0x1d045c,_0x5d750a);throw new common_1[(_0xfb2b7f(0x1ea))](_0x5d750a[_0xfb2b7f(0x213)],common_1[_0xfb2b7f(0x1f8)][_0xfb2b7f(0x207)]);}}};function _0xb095(_0x113f83,_0x21586e){const _0x538b99=_0x538b();return _0xb095=function(_0xb095de,_0x101cc4){_0xb095de=_0xb095de-0x1c4;let _0x4a4fe1=_0x538b99[_0xb095de];return _0x4a4fe1;},_0xb095(_0x113f83,_0x21586e);}FanyiService=__decorate([(0x0,common_1[_0x38c260(0x1da)])(),__metadata(_0x38c260(0x1f5),[globalConfig_service_1[_0x38c260(0x20f)],models_service_1[_0x38c260(0x1fa)]])],FanyiService),exports[_0x38c260(0x1d2)]=FanyiService;