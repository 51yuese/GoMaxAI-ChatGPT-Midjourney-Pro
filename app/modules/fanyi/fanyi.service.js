'use strict';const _0x3f0c83=_0x5af6;(function(_0x461c45,_0x19dc78){const _0x330ec2=_0x5af6,_0x1b1df1=_0x461c45();while(!![]){try{const _0x2fc520=parseInt(_0x330ec2(0x1ea))/0x1+parseInt(_0x330ec2(0x207))/0x2+parseInt(_0x330ec2(0x203))/0x3*(parseInt(_0x330ec2(0x211))/0x4)+parseInt(_0x330ec2(0x1fc))/0x5+-parseInt(_0x330ec2(0x1d3))/0x6*(parseInt(_0x330ec2(0x1cf))/0x7)+parseInt(_0x330ec2(0x1d1))/0x8*(parseInt(_0x330ec2(0x20a))/0x9)+parseInt(_0x330ec2(0x205))/0xa*(-parseInt(_0x330ec2(0x1e3))/0xb);if(_0x2fc520===_0x19dc78)break;else _0x1b1df1['push'](_0x1b1df1['shift']());}catch(_0x2e5cbd){_0x1b1df1['push'](_0x1b1df1['shift']());}}}(_0x16e3,0xd79f5));function _0x16e3(){const _0x3e7e44=['./../globalConfig/globalConfig.service','11gRSbfO','EModelType','@nestjs/common','axios','modelsService','create','default','320153VHedBT','globalConfigService','text','fanyi-error','当前管理员还未开放翻译服务、请联系管理员开通吧!','decorate','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','openaiBaseUrl','auto','default-gomaxai-key','completions','post','defineProperty','crypto','onModuleInit','data','choices','now','3550730XwFZOi','dst','message','gpt-fanyi','function','digest','../../common/constants/model.constant','4362990XpylUB','getRandomKey','29284790HTdPKx','__esModule','1165028TLFZvv','error','HttpStatus','9zcBaUH','HttpException','../models/models.service','baiduFanyiAppId','ModelsService','chat','system','4qMOyrZ','content','BAD_REQUEST','defaultUrl','toString','md5','length','FanyiService','翻译失败[','convertToEnglish','5369ymGvDl','translateToEnglish','8649904UKnDWS','getOwnPropertyDescriptor','2634bzIYQy','翻译花费时间\x20%s\x20秒','log','getConfigByKeys','object','design:paramtypes','请输入要翻译的内容!','api','metadata','update','baseURL','__metadata','then','接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！','Logger'];_0x16e3=function(){return _0x3e7e44;};return _0x16e3();}function _0x5af6(_0x30e06c,_0x5c8e66){const _0x16e30b=_0x16e3();return _0x5af6=function(_0x5af608,_0x47cc7c){_0x5af608=_0x5af608-0x1c6;let _0x123f02=_0x16e30b[_0x5af608];return _0x123f02;},_0x5af6(_0x30e06c,_0x5c8e66);}var __decorate=this&&this['__decorate']||function(_0x47dfcd,_0x47cb78,_0x4dbeca,_0x445a1f){const _0x188664=_0x5af6;var _0x24fe7e=arguments[_0x188664(0x1cb)],_0xbfcfa6=_0x24fe7e<0x3?_0x47cb78:_0x445a1f===null?_0x445a1f=Object[_0x188664(0x1d2)](_0x47cb78,_0x4dbeca):_0x445a1f,_0x193e0e;if(typeof Reflect===_0x188664(0x1d7)&&typeof Reflect[_0x188664(0x1ef)]===_0x188664(0x200))_0xbfcfa6=Reflect[_0x188664(0x1ef)](_0x47dfcd,_0x47cb78,_0x4dbeca,_0x445a1f);else{for(var _0x3c48a2=_0x47dfcd[_0x188664(0x1cb)]-0x1;_0x3c48a2>=0x0;_0x3c48a2--)if(_0x193e0e=_0x47dfcd[_0x3c48a2])_0xbfcfa6=(_0x24fe7e<0x3?_0x193e0e(_0xbfcfa6):_0x24fe7e>0x3?_0x193e0e(_0x47cb78,_0x4dbeca,_0xbfcfa6):_0x193e0e(_0x47cb78,_0x4dbeca))||_0xbfcfa6;}return _0x24fe7e>0x3&&_0xbfcfa6&&Object[_0x188664(0x1f6)](_0x47cb78,_0x4dbeca,_0xbfcfa6),_0xbfcfa6;},__metadata=this&&this[_0x3f0c83(0x1de)]||function(_0x19a2ce,_0x4a4c39){const _0x615cc4=_0x3f0c83;if(typeof Reflect==='object'&&typeof Reflect[_0x615cc4(0x1db)]===_0x615cc4(0x200))return Reflect['metadata'](_0x19a2ce,_0x4a4c39);};Object[_0x3f0c83(0x1f6)](exports,_0x3f0c83(0x206),{'value':!![]}),exports[_0x3f0c83(0x1cc)]=void 0x0;const globalConfig_service_1=require(_0x3f0c83(0x1e2)),common_1=require(_0x3f0c83(0x1e5)),axios_1=require(_0x3f0c83(0x1e6)),crypto=require(_0x3f0c83(0x1f7)),openai_1=require('openai'),utils_1=require('../../common/utils'),models_service_1=require(_0x3f0c83(0x20c)),model_constant_1=require(_0x3f0c83(0x202));let FanyiService=class FanyiService{constructor(_0x451cd1,_0x53ae5d){const _0x32d13d=_0x3f0c83;this[_0x32d13d(0x1eb)]=_0x451cd1,this[_0x32d13d(0x1e7)]=_0x53ae5d,this[_0x32d13d(0x1c8)]='https://api.openai.com';}[_0x3f0c83(0x1f8)](){const _0x2acd5d=_0x3f0c83;this['api']=new openai_1['default']({'apiKey':_0x2acd5d(0x1f3),'baseURL':this[_0x2acd5d(0x1c8)]+'/v1'});}async[_0x3f0c83(0x1ce)](_0x26e61f){const _0x2f5f69=_0x3f0c83;if(!_0x26e61f)throw new common_1['HttpException'](_0x2f5f69(0x1d9),common_1['HttpStatus'][_0x2f5f69(0x1c7)]);const {baiduFanyiAppId:_0x893582,baiduFanyiSecret:_0x35b59e}=await this[_0x2f5f69(0x1eb)][_0x2f5f69(0x1d6)]([_0x2f5f69(0x20d),'baiduFanyiSecret']);if(!_0x893582||!_0x35b59e)throw new common_1['HttpException'](_0x2f5f69(0x1ee),common_1[_0x2f5f69(0x209)][_0x2f5f69(0x1c7)]);const _0x167a69=Date['now']()[_0x2f5f69(0x1c9)](),_0x56c1ba=crypto['createHash'](_0x2f5f69(0x1ca))[_0x2f5f69(0x1dc)](_0x893582+_0x26e61f+_0x167a69+_0x35b59e)[_0x2f5f69(0x201)]('hex'),_0x3c8ed3='https://fanyi-api.baidu.com/api/trans/vip/translate',_0xdd57f4={'q':_0x26e61f[_0x2f5f69(0x1c9)](),'from':_0x2f5f69(0x1f2),'to':'en','appid':_0x893582,'salt':_0x167a69,'sign':_0x56c1ba},_0x5134cc=await axios_1[_0x2f5f69(0x1e9)][_0x2f5f69(0x1f5)](_0x3c8ed3,_0xdd57f4,{'headers':{'Content-Type':'application/x-www-form-urlencoded'}}),{from:_0x52d65b,to:_0x1644aa,trans_result:_0x1bd2cf,error_code:_0x32f62c,error_msg:_0x11be9b}=_0x5134cc[_0x2f5f69(0x1f9)];if(_0x32f62c)throw new common_1['HttpException']('翻译失败['+_0x32f62c+']['+_0x11be9b+']!',common_1[_0x2f5f69(0x209)][_0x2f5f69(0x1c7)]);if(!_0x1bd2cf||!_0x1bd2cf[_0x2f5f69(0x1cb)])throw new common_1[(_0x2f5f69(0x20b))](_0x2f5f69(0x1cd)+_0x32f62c+']['+_0x11be9b+']!',common_1[_0x2f5f69(0x209)][_0x2f5f69(0x1c7)]);else return _0x1bd2cf[0x0][_0x2f5f69(0x1fd)];}async[_0x3f0c83(0x1d0)](_0x413840){const _0x1a10d7=_0x3f0c83,_0x1bbfa5=_0x1a10d7(0x1e0);let _0x227705=await this[_0x1a10d7(0x1e7)][_0x1a10d7(0x204)](model_constant_1[_0x1a10d7(0x1e4)]['OTHER']);if(!_0x227705)throw new common_1[(_0x1a10d7(0x20b))](_0x1a10d7(0x1f0),common_1[_0x1a10d7(0x209)][_0x1a10d7(0x1c7)]);const {timeout:_0x56680e,model:_0x28458b,key:_0xd6ba4c,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x1c3ef6}=_0x227705;let _0x1e86eb=_0x1c3ef6;!_0x1c3ef6&&(_0x1e86eb=await this['globalConfigService'][_0x1a10d7(0x1d6)]([_0x1a10d7(0x1f1)]));this[_0x1a10d7(0x1da)]['apiKey']=(0x0,utils_1['removeSpecialCharacters'])(_0xd6ba4c),this[_0x1a10d7(0x1da)][_0x1a10d7(0x1dd)]=(_0x1e86eb||this[_0x1a10d7(0x1c8)])+'/v1',this['api']['timeout']=0x493e0;try{common_1[_0x1a10d7(0x1e1)][_0x1a10d7(0x1d5)](_0xd6ba4c,'translate\x20key'),common_1[_0x1a10d7(0x1e1)][_0x1a10d7(0x1d5)](_0x1e86eb,_0x1a10d7(0x1ff));const _0x39dfc2=Date[_0x1a10d7(0x1fb)](),_0x5c9846=await this[_0x1a10d7(0x1da)][_0x1a10d7(0x20f)][_0x1a10d7(0x1f4)][_0x1a10d7(0x1e8)]({'messages':[{'role':_0x1a10d7(0x210),'content':_0x1bbfa5},{'role':'user','content':_0x413840}],'model':'gpt-4-all','stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0x1a10d7(0x1ec)}})[_0x1a10d7(0x1df)](_0x415fa3=>{const _0x45e451=_0x1a10d7;return _0x415fa3?.[_0x45e451(0x1fa)][0x0]?.[_0x45e451(0x1fe)][_0x45e451(0x1c6)]||'';})['catch'](_0x2b2d45=>{const _0x2965bb=_0x1a10d7;return common_1[_0x2965bb(0x1e1)][_0x2965bb(0x208)](_0x2b2d45),'';}),_0x6ffd63=Date['now'](),_0xeb129e=(_0x6ffd63-_0x39dfc2)/0x3e8;return common_1[_0x1a10d7(0x1e1)][_0x1a10d7(0x1d5)](_0xeb129e,_0x1a10d7(0x1d4)),_0x5c9846;}catch(_0x363656){console[_0x1a10d7(0x1d5)](_0x1a10d7(0x1ed),_0xd6ba4c,_0x363656);throw new common_1['HttpException'](_0x363656[_0x1a10d7(0x1fe)],common_1['HttpStatus'][_0x1a10d7(0x1c7)]);}}};FanyiService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x3f0c83(0x1d8),[globalConfig_service_1['GlobalConfigService'],models_service_1[_0x3f0c83(0x20e)]])],FanyiService),exports[_0x3f0c83(0x1cc)]=FanyiService;