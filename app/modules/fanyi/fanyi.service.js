'use strict';const _0x3a295a=_0x481a;(function(_0x349395,_0x4d6b59){const _0x2e145f=_0x481a,_0x4b8f3a=_0x349395();while(!![]){try{const _0x5c6307=-parseInt(_0x2e145f(0x17f))/0x1*(-parseInt(_0x2e145f(0x1a4))/0x2)+parseInt(_0x2e145f(0x1c8))/0x3*(parseInt(_0x2e145f(0x1a9))/0x4)+parseInt(_0x2e145f(0x1bd))/0x5*(-parseInt(_0x2e145f(0x1a0))/0x6)+parseInt(_0x2e145f(0x181))/0x7+parseInt(_0x2e145f(0x1a8))/0x8+-parseInt(_0x2e145f(0x191))/0x9+parseInt(_0x2e145f(0x1c0))/0xa;if(_0x5c6307===_0x4d6b59)break;else _0x4b8f3a['push'](_0x4b8f3a['shift']());}catch(_0x58c974){_0x4b8f3a['push'](_0x4b8f3a['shift']());}}}(_0x1fa3,0x59d84));var __decorate=this&&this[_0x3a295a(0x1ab)]||function(_0x70b36,_0x1e2c79,_0x52f3a8,_0x3b2e4f){const _0x32197b=_0x3a295a;var _0xff3759=arguments[_0x32197b(0x195)],_0x3b13be=_0xff3759<0x3?_0x1e2c79:_0x3b2e4f===null?_0x3b2e4f=Object['getOwnPropertyDescriptor'](_0x1e2c79,_0x52f3a8):_0x3b2e4f,_0x46a33f;if(typeof Reflect===_0x32197b(0x18a)&&typeof Reflect['decorate']==='function')_0x3b13be=Reflect['decorate'](_0x70b36,_0x1e2c79,_0x52f3a8,_0x3b2e4f);else{for(var _0x197296=_0x70b36['length']-0x1;_0x197296>=0x0;_0x197296--)if(_0x46a33f=_0x70b36[_0x197296])_0x3b13be=(_0xff3759<0x3?_0x46a33f(_0x3b13be):_0xff3759>0x3?_0x46a33f(_0x1e2c79,_0x52f3a8,_0x3b13be):_0x46a33f(_0x1e2c79,_0x52f3a8))||_0x3b13be;}return _0xff3759>0x3&&_0x3b13be&&Object[_0x32197b(0x1a7)](_0x1e2c79,_0x52f3a8,_0x3b13be),_0x3b13be;},__metadata=this&&this[_0x3a295a(0x196)]||function(_0x516e7c,_0x83d1f8){const _0x50bcaa=_0x3a295a;if(typeof Reflect===_0x50bcaa(0x18a)&&typeof Reflect[_0x50bcaa(0x1af)]===_0x50bcaa(0x1b8))return Reflect[_0x50bcaa(0x1af)](_0x516e7c,_0x83d1f8);};function _0x481a(_0x4356a3,_0x19ac0e){const _0x1fa3f5=_0x1fa3();return _0x481a=function(_0x481aec,_0x44b93e){_0x481aec=_0x481aec-0x17b;let _0x3e763f=_0x1fa3f5[_0x481aec];return _0x3e763f;},_0x481a(_0x4356a3,_0x19ac0e);}Object[_0x3a295a(0x1a7)](exports,'__esModule',{'value':!![]}),exports[_0x3a295a(0x1c9)]=void 0x0;const globalConfig_service_1=require(_0x3a295a(0x190)),common_1=require('@nestjs/common'),axios_1=require(_0x3a295a(0x19c)),crypto=require(_0x3a295a(0x193)),openai_1=require(_0x3a295a(0x183)),utils_1=require(_0x3a295a(0x189)),models_service_1=require(_0x3a295a(0x1ac)),model_constant_1=require(_0x3a295a(0x1b0));let FanyiService=class FanyiService{constructor(_0x314d6e,_0x5c3e77){const _0x40c2ac=_0x3a295a;this[_0x40c2ac(0x1c7)]=_0x314d6e,this[_0x40c2ac(0x1b4)]=_0x5c3e77,this[_0x40c2ac(0x17c)]=_0x40c2ac(0x1b9);}['onModuleInit'](){const _0x162921=_0x3a295a;this[_0x162921(0x18d)]=new openai_1['default']({'apiKey':'default-gomaxai-key','baseURL':this[_0x162921(0x17c)]+_0x162921(0x19b)});}async[_0x3a295a(0x187)](_0x50baa0){const _0x4f8acd=_0x3a295a;if(!_0x50baa0)throw new common_1[(_0x4f8acd(0x18c))](_0x4f8acd(0x197),common_1['HttpStatus'][_0x4f8acd(0x1b1)]);const {baiduFanyiAppId:_0x1e0dca,baiduFanyiSecret:_0xf5872e}=await this[_0x4f8acd(0x1c7)]['getConfigByKeys']([_0x4f8acd(0x1c3),_0x4f8acd(0x19d)]);if(!_0x1e0dca||!_0xf5872e)throw new common_1[(_0x4f8acd(0x18c))](_0x4f8acd(0x1a2),common_1[_0x4f8acd(0x1c6)]['BAD_REQUEST']);const _0x3cf730=Date['now']()[_0x4f8acd(0x18e)](),_0x534413=crypto[_0x4f8acd(0x1a3)](_0x4f8acd(0x18f))[_0x4f8acd(0x19a)](_0x1e0dca+_0x50baa0+_0x3cf730+_0xf5872e)[_0x4f8acd(0x1a5)](_0x4f8acd(0x188)),_0x2b3f30=_0x4f8acd(0x1c1),_0x2090d2={'q':_0x50baa0[_0x4f8acd(0x18e)](),'from':_0x4f8acd(0x19f),'to':'en','appid':_0x1e0dca,'salt':_0x3cf730,'sign':_0x534413},_0x3f4133=await axios_1[_0x4f8acd(0x192)]['post'](_0x2b3f30,_0x2090d2,{'headers':{'Content-Type':_0x4f8acd(0x1c4)}}),{from:_0x484c3e,to:_0x5d7138,trans_result:_0x31e88b,error_code:_0x231fe4,error_msg:_0xad76f7}=_0x3f4133[_0x4f8acd(0x199)];if(_0x231fe4)throw new common_1[(_0x4f8acd(0x18c))](_0x4f8acd(0x19e)+_0x231fe4+']['+_0xad76f7+']!',common_1[_0x4f8acd(0x1c6)][_0x4f8acd(0x1b1)]);if(!_0x31e88b||!_0x31e88b[_0x4f8acd(0x195)])throw new common_1[(_0x4f8acd(0x18c))](_0x4f8acd(0x19e)+_0x231fe4+']['+_0xad76f7+']!',common_1[_0x4f8acd(0x1c6)]['BAD_REQUEST']);else return _0x31e88b[0x0][_0x4f8acd(0x17d)];}async[_0x3a295a(0x1b5)](_0x50caba){const _0x4ee958=_0x3a295a,_0x5c7b94='接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！';let _0x5f0c79=await this['modelsService'][_0x4ee958(0x1ba)](model_constant_1[_0x4ee958(0x185)][_0x4ee958(0x1ad)]);if(!_0x5f0c79)throw new common_1[(_0x4ee958(0x18c))]('当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！',common_1[_0x4ee958(0x1c6)][_0x4ee958(0x1b1)]);const {timeout:_0xc06d51,model:_0x5bc378,key:_0x45c3d3,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x3c59ae}=_0x5f0c79;let _0x3553f3=_0x3c59ae;!_0x3c59ae&&(_0x3553f3=await this['globalConfigService'][_0x4ee958(0x182)]([_0x4ee958(0x198)]));this['api']['apiKey']=(0x0,utils_1[_0x4ee958(0x1ae)])(_0x45c3d3),this[_0x4ee958(0x18d)][_0x4ee958(0x1a6)]=(_0x3553f3||this[_0x4ee958(0x17c)])+'/v1',this[_0x4ee958(0x18d)]['timeout']=0x493e0;try{common_1[_0x4ee958(0x1c2)][_0x4ee958(0x1aa)](_0x45c3d3,_0x4ee958(0x17b)),common_1[_0x4ee958(0x1c2)][_0x4ee958(0x1aa)](_0x3553f3,'gpt-fanyi');const _0x15aebe=Date[_0x4ee958(0x1bb)](),_0x520497=await this['api'][_0x4ee958(0x1b6)][_0x4ee958(0x180)][_0x4ee958(0x1be)]({'messages':[{'role':_0x4ee958(0x1c5),'content':_0x5c7b94},{'role':_0x4ee958(0x186),'content':_0x50caba}],'model':'gpt-4-all','stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':'text'}})[_0x4ee958(0x1bc)](_0x59a25c=>{const _0x3cfe61=_0x4ee958;return _0x59a25c?.[_0x3cfe61(0x1b7)][0x0]?.[_0x3cfe61(0x1bf)][_0x3cfe61(0x1a1)]||'';})['catch'](_0x401d48=>{const _0xa52cff=_0x4ee958;return common_1[_0xa52cff(0x1c2)][_0xa52cff(0x1b2)](_0x401d48),'';}),_0xd8a572=Date['now'](),_0x157cef=(_0xd8a572-_0x15aebe)/0x3e8;return common_1[_0x4ee958(0x1c2)][_0x4ee958(0x1aa)](_0x157cef,_0x4ee958(0x1b3)),_0x520497;}catch(_0x2902ae){console[_0x4ee958(0x1aa)](_0x4ee958(0x184),_0x45c3d3,_0x2902ae);throw new common_1[(_0x4ee958(0x18c))](_0x2902ae[_0x4ee958(0x1bf)],common_1[_0x4ee958(0x1c6)][_0x4ee958(0x1b1)]);}}};function _0x1fa3(){const _0x18e4e6=['getConfigByKeys','openai','fanyi-error','EModelType','user','convertToEnglish','hex','../../common/utils','object','ModelsService','HttpException','api','toString','md5','./../globalConfig/globalConfig.service','5944050cobeUs','default','crypto','GlobalConfigService','length','__metadata','请输入要翻译的内容!','openaiBaseUrl','data','update','/v1','axios','baiduFanyiSecret','翻译失败[','auto','731922uxZRKp','content','当前管理员还未开放翻译服务、请联系管理员开通吧!','createHash','2QRPkkR','digest','baseURL','defineProperty','3045920HIoypr','1408kuUjGT','log','__decorate','../models/models.service','OTHER','removeSpecialCharacters','metadata','../../common/constants/model.constant','BAD_REQUEST','error','翻译花费时间\x20%s\x20秒','modelsService','translateToEnglish','chat','choices','function','https://api.openai.com','getRandomKey','now','then','20CeoMjB','create','message','2130140GjqFHk','https://fanyi-api.baidu.com/api/trans/vip/translate','Logger','baiduFanyiAppId','application/x-www-form-urlencoded','system','HttpStatus','globalConfigService','2568DPYJCT','FanyiService','translate\x20key','defaultUrl','dst','Injectable','172589nrqQlK','completions','3141229yEgYZh'];_0x1fa3=function(){return _0x18e4e6;};return _0x1fa3();}FanyiService=__decorate([(0x0,common_1[_0x3a295a(0x17e)])(),__metadata('design:paramtypes',[globalConfig_service_1[_0x3a295a(0x194)],models_service_1[_0x3a295a(0x18b)]])],FanyiService),exports[_0x3a295a(0x1c9)]=FanyiService;