'use strict';function _0x4f93(_0x188742,_0x4022b8){const _0x6409be=_0x6409();return _0x4f93=function(_0x4f93b4,_0x4b2b81){_0x4f93b4=_0x4f93b4-0x16f;let _0x34e9da=_0x6409be[_0x4f93b4];return _0x34e9da;},_0x4f93(_0x188742,_0x4022b8);}const _0x3dc713=_0x4f93;(function(_0x358f46,_0x59b7fc){const _0x43c048=_0x4f93,_0x4c576e=_0x358f46();while(!![]){try{const _0x39e2c6=parseInt(_0x43c048(0x180))/0x1*(parseInt(_0x43c048(0x1b7))/0x2)+parseInt(_0x43c048(0x190))/0x3*(parseInt(_0x43c048(0x1a8))/0x4)+parseInt(_0x43c048(0x1a9))/0x5*(parseInt(_0x43c048(0x1aa))/0x6)+parseInt(_0x43c048(0x18d))/0x7+-parseInt(_0x43c048(0x177))/0x8*(parseInt(_0x43c048(0x188))/0x9)+parseInt(_0x43c048(0x17b))/0xa+-parseInt(_0x43c048(0x189))/0xb*(parseInt(_0x43c048(0x184))/0xc);if(_0x39e2c6===_0x59b7fc)break;else _0x4c576e['push'](_0x4c576e['shift']());}catch(_0x44136b){_0x4c576e['push'](_0x4c576e['shift']());}}}(_0x6409,0x24ed6));function _0x6409(){const _0x396092=['getOwnPropertyDescriptor','defaultUrl','toString','api','接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！','翻译失败[','defineProperty','baseURL','axios','default-gomaxai-key','getRandomKey','getConfigByKeys','/v1','当前管理员还未开放翻译服务、请联系管理员开通吧!','../../common/utils','hex','@nestjs/common','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','auto','./../globalConfig/globalConfig.service','4684xXlxAS','37645gqpJBE','198JNnWWQ','HttpStatus','metadata','decorate','https://fanyi-api.baidu.com/api/trans/vip/translate','createHash','fanyi-error','https://api.openai.com','gpt-4-all','Logger','error','openaiBaseUrl','__decorate','482476Mibsnp','application/x-www-form-urlencoded','content','ModelsService','FanyiService','__metadata','digest','now','data','update','post','default','create','translate\x20key','../models/models.service','md5','BAD_REQUEST','88MJUirj','timeout','message','user','2746510cjHeTb','OTHER','choices','gpt-fanyi','system','1TiXBNc','modelsService','catch','HttpException','1320eTalmu','crypto','apiKey','__esModule','13707wcGwHk','77429VyUXGl','design:paramtypes','object','translateToEnglish','909580zCjKfG','globalConfigService','baiduFanyiAppId','123DAUxGH','EModelType','log','chat'];_0x6409=function(){return _0x396092;};return _0x6409();}var __decorate=this&&this[_0x3dc713(0x1b6)]||function(_0x133ba8,_0x9bde5a,_0x2f0ff0,_0x25498c){const _0x905f53=_0x3dc713;var _0x3cef8b=arguments['length'],_0x2213a7=_0x3cef8b<0x3?_0x9bde5a:_0x25498c===null?_0x25498c=Object[_0x905f53(0x194)](_0x9bde5a,_0x2f0ff0):_0x25498c,_0x4c99fc;if(typeof Reflect===_0x905f53(0x18b)&&typeof Reflect[_0x905f53(0x1ad)]==='function')_0x2213a7=Reflect[_0x905f53(0x1ad)](_0x133ba8,_0x9bde5a,_0x2f0ff0,_0x25498c);else{for(var _0x253865=_0x133ba8['length']-0x1;_0x253865>=0x0;_0x253865--)if(_0x4c99fc=_0x133ba8[_0x253865])_0x2213a7=(_0x3cef8b<0x3?_0x4c99fc(_0x2213a7):_0x3cef8b>0x3?_0x4c99fc(_0x9bde5a,_0x2f0ff0,_0x2213a7):_0x4c99fc(_0x9bde5a,_0x2f0ff0))||_0x2213a7;}return _0x3cef8b>0x3&&_0x2213a7&&Object[_0x905f53(0x19a)](_0x9bde5a,_0x2f0ff0,_0x2213a7),_0x2213a7;},__metadata=this&&this[_0x3dc713(0x1bc)]||function(_0x4f3ee1,_0x182cf1){const _0x528ac3=_0x3dc713;if(typeof Reflect===_0x528ac3(0x18b)&&typeof Reflect[_0x528ac3(0x1ac)]==='function')return Reflect[_0x528ac3(0x1ac)](_0x4f3ee1,_0x182cf1);};Object[_0x3dc713(0x19a)](exports,_0x3dc713(0x187),{'value':!![]}),exports[_0x3dc713(0x1bb)]=void 0x0;const globalConfig_service_1=require(_0x3dc713(0x1a7)),common_1=require(_0x3dc713(0x1a4)),axios_1=require(_0x3dc713(0x19c)),crypto=require(_0x3dc713(0x185)),openai_1=require('openai'),utils_1=require(_0x3dc713(0x1a2)),models_service_1=require(_0x3dc713(0x174)),model_constant_1=require('../../common/constants/model.constant');let FanyiService=class FanyiService{constructor(_0x3f4953,_0x20e7e7){const _0x277d1e=_0x3dc713;this[_0x277d1e(0x18e)]=_0x3f4953,this[_0x277d1e(0x181)]=_0x20e7e7,this[_0x277d1e(0x195)]=_0x277d1e(0x1b1);}['onModuleInit'](){const _0x433741=_0x3dc713;this['api']=new openai_1[(_0x433741(0x171))]({'apiKey':_0x433741(0x19d),'baseURL':this[_0x433741(0x195)]+_0x433741(0x1a0)});}async['convertToEnglish'](_0x4a7c6b){const _0x43cf46=_0x3dc713;if(!_0x4a7c6b)throw new common_1[(_0x43cf46(0x183))]('请输入要翻译的内容!',common_1[_0x43cf46(0x1ab)][_0x43cf46(0x176)]);const {baiduFanyiAppId:_0x220cf9,baiduFanyiSecret:_0x1ce4ef}=await this[_0x43cf46(0x18e)][_0x43cf46(0x19f)]([_0x43cf46(0x18f),'baiduFanyiSecret']);if(!_0x220cf9||!_0x1ce4ef)throw new common_1[(_0x43cf46(0x183))](_0x43cf46(0x1a1),common_1[_0x43cf46(0x1ab)][_0x43cf46(0x176)]);const _0x565800=Date[_0x43cf46(0x1be)]()[_0x43cf46(0x196)](),_0x5ac135=crypto[_0x43cf46(0x1af)](_0x43cf46(0x175))[_0x43cf46(0x16f)](_0x220cf9+_0x4a7c6b+_0x565800+_0x1ce4ef)[_0x43cf46(0x1bd)](_0x43cf46(0x1a3)),_0x5caf93=_0x43cf46(0x1ae),_0xf4bc3c={'q':_0x4a7c6b[_0x43cf46(0x196)](),'from':_0x43cf46(0x1a6),'to':'en','appid':_0x220cf9,'salt':_0x565800,'sign':_0x5ac135},_0x193346=await axios_1[_0x43cf46(0x171)][_0x43cf46(0x170)](_0x5caf93,_0xf4bc3c,{'headers':{'Content-Type':_0x43cf46(0x1b8)}}),{from:_0x12ff06,to:_0x172d3d,trans_result:_0x5bcd13,error_code:_0x5acb91,error_msg:_0x35f5c4}=_0x193346[_0x43cf46(0x1bf)];if(_0x5acb91)throw new common_1[(_0x43cf46(0x183))](_0x43cf46(0x199)+_0x5acb91+']['+_0x35f5c4+']!',common_1[_0x43cf46(0x1ab)][_0x43cf46(0x176)]);if(!_0x5bcd13||!_0x5bcd13['length'])throw new common_1[(_0x43cf46(0x183))](_0x43cf46(0x199)+_0x5acb91+']['+_0x35f5c4+']!',common_1[_0x43cf46(0x1ab)][_0x43cf46(0x176)]);else return _0x5bcd13[0x0]['dst'];}async[_0x3dc713(0x18c)](_0x20b3ce){const _0x55cc00=_0x3dc713,_0x5d0c40=_0x55cc00(0x198);let _0x47a110=await this['modelsService'][_0x55cc00(0x19e)](model_constant_1[_0x55cc00(0x191)][_0x55cc00(0x17c)]);if(!_0x47a110)throw new common_1[(_0x55cc00(0x183))](_0x55cc00(0x1a5),common_1['HttpStatus'][_0x55cc00(0x176)]);const {timeout:_0xfb3fb7,model:_0x3d2a34,key:_0x25bc56,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x7ba792}=_0x47a110;let _0x26f08f=_0x7ba792;!_0x7ba792&&(_0x26f08f=await this['globalConfigService']['getConfigByKeys']([_0x55cc00(0x1b5)]));this['api'][_0x55cc00(0x186)]=(0x0,utils_1['removeSpecialCharacters'])(_0x25bc56),this[_0x55cc00(0x197)][_0x55cc00(0x19b)]=(_0x26f08f||this[_0x55cc00(0x195)])+'/v1',this[_0x55cc00(0x197)][_0x55cc00(0x178)]=0x493e0;try{common_1[_0x55cc00(0x1b3)][_0x55cc00(0x192)](_0x25bc56,_0x55cc00(0x173)),common_1[_0x55cc00(0x1b3)]['log'](_0x26f08f,_0x55cc00(0x17e));const _0x5b90a8=Date[_0x55cc00(0x1be)](),_0xee4a2e=await this['api'][_0x55cc00(0x193)]['completions'][_0x55cc00(0x172)]({'messages':[{'role':_0x55cc00(0x17f),'content':_0x5d0c40},{'role':_0x55cc00(0x17a),'content':_0x20b3ce}],'model':_0x55cc00(0x1b2),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':'text'}})['then'](_0x507d=>{const _0x4557ab=_0x55cc00;return _0x507d?.[_0x4557ab(0x17d)][0x0]?.['message'][_0x4557ab(0x1b9)]||'';})[_0x55cc00(0x182)](_0x326787=>{const _0x219591=_0x55cc00;return common_1[_0x219591(0x1b3)][_0x219591(0x1b4)](_0x326787),'';}),_0x37540c=Date[_0x55cc00(0x1be)](),_0x1eb4be=(_0x37540c-_0x5b90a8)/0x3e8;return common_1['Logger'][_0x55cc00(0x192)](_0x1eb4be,'翻译花费时间\x20%s\x20秒'),_0xee4a2e;}catch(_0x4e44e9){console[_0x55cc00(0x192)](_0x55cc00(0x1b0),_0x25bc56,_0x4e44e9);throw new common_1[(_0x55cc00(0x183))](_0x4e44e9[_0x55cc00(0x179)],common_1[_0x55cc00(0x1ab)][_0x55cc00(0x176)]);}}};FanyiService=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x3dc713(0x18a),[globalConfig_service_1['GlobalConfigService'],models_service_1[_0x3dc713(0x1ba)]])],FanyiService),exports[_0x3dc713(0x1bb)]=FanyiService;