'use strict';const _0x259fe8=_0x46d7;(function(_0x3bef38,_0xc80d6){const _0x5e839=_0x46d7,_0x45fd77=_0x3bef38();while(!![]){try{const _0x8d9bdf=-parseInt(_0x5e839(0xd8))/0x1+-parseInt(_0x5e839(0xa1))/0x2*(parseInt(_0x5e839(0xbe))/0x3)+-parseInt(_0x5e839(0xcc))/0x4*(parseInt(_0x5e839(0xd5))/0x5)+parseInt(_0x5e839(0xc3))/0x6*(parseInt(_0x5e839(0xc1))/0x7)+parseInt(_0x5e839(0x96))/0x8*(-parseInt(_0x5e839(0x9c))/0x9)+-parseInt(_0x5e839(0xab))/0xa+-parseInt(_0x5e839(0xd2))/0xb*(-parseInt(_0x5e839(0xb0))/0xc);if(_0x8d9bdf===_0xc80d6)break;else _0x45fd77['push'](_0x45fd77['shift']());}catch(_0x9d591){_0x45fd77['push'](_0x45fd77['shift']());}}}(_0x3055,0xb24aa));var __decorate=this&&this[_0x259fe8(0xd3)]||function(_0x354d1d,_0x310fa2,_0x229674,_0x502f66){const _0x5e634d=_0x259fe8;var _0x110ab6=arguments[_0x5e634d(0xa7)],_0x14ecc5=_0x110ab6<0x3?_0x310fa2:_0x502f66===null?_0x502f66=Object[_0x5e634d(0xa4)](_0x310fa2,_0x229674):_0x502f66,_0x2347d7;if(typeof Reflect===_0x5e634d(0xdd)&&typeof Reflect['decorate']===_0x5e634d(0xa5))_0x14ecc5=Reflect[_0x5e634d(0xe1)](_0x354d1d,_0x310fa2,_0x229674,_0x502f66);else{for(var _0x1096b1=_0x354d1d[_0x5e634d(0xa7)]-0x1;_0x1096b1>=0x0;_0x1096b1--)if(_0x2347d7=_0x354d1d[_0x1096b1])_0x14ecc5=(_0x110ab6<0x3?_0x2347d7(_0x14ecc5):_0x110ab6>0x3?_0x2347d7(_0x310fa2,_0x229674,_0x14ecc5):_0x2347d7(_0x310fa2,_0x229674))||_0x14ecc5;}return _0x110ab6>0x3&&_0x14ecc5&&Object['defineProperty'](_0x310fa2,_0x229674,_0x14ecc5),_0x14ecc5;},__metadata=this&&this[_0x259fe8(0x9f)]||function(_0x2aecf9,_0x5cbd30){const _0x1d2f15=_0x259fe8;if(typeof Reflect===_0x1d2f15(0xdd)&&typeof Reflect[_0x1d2f15(0xb6)]===_0x1d2f15(0xa5))return Reflect[_0x1d2f15(0xb6)](_0x2aecf9,_0x5cbd30);};function _0x3055(){const _0x24bd4d=['hex','defaultUrl','20316KpESIF','https://api.openai.com','default','FanyiService','user','content','metadata','catch','ModelsService','post','@nestjs/common','auto','EModelType','translateToEnglish','1860147swOpJz','text','/v1','44198YaVOQC','update','1044VRLIvJ','create','翻译失败[','BAD_REQUEST','then','请输入要翻译的内容!','GlobalConfigService','../../common/constants/model.constant','https://fanyi-api.baidu.com/api/trans/vip/translate','4326292WXzlLK','openaiBaseUrl','default-gomaxai-key','HttpStatus','api','gpt-fanyi','21967RfibzJ','__decorate','openai','5xfFaVM','Logger','Injectable','549604jLjCYi','crypto','./../globalConfig/globalConfig.service','fanyi-error','globalConfigService','object','getRandomKey','baiduFanyiAppId','application/x-www-form-urlencoded','decorate','axios','log','createHash','message','1384AYrXYm','onModuleInit','HttpException','toString','../../common/utils','getConfigByKeys','45351FefgJb','translate\x20key','now','__metadata','apiKey','2mbrHwt','data','翻译花费时间\x20%s\x20秒','getOwnPropertyDescriptor','function','baseURL','length','OTHER','design:paramtypes','digest','6263020xAMrFi','../models/models.service','modelsService'];_0x3055=function(){return _0x24bd4d;};return _0x3055();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x259fe8(0xb3)]=void 0x0;const globalConfig_service_1=require(_0x259fe8(0xda)),common_1=require(_0x259fe8(0xba)),axios_1=require(_0x259fe8(0xe2)),crypto=require(_0x259fe8(0xd9)),openai_1=require(_0x259fe8(0xd4)),utils_1=require(_0x259fe8(0x9a)),models_service_1=require(_0x259fe8(0xac)),model_constant_1=require(_0x259fe8(0xca));let FanyiService=class FanyiService{constructor(_0x25c585,_0x2b93d0){const _0x3e50bc=_0x259fe8;this['globalConfigService']=_0x25c585,this[_0x3e50bc(0xad)]=_0x2b93d0,this[_0x3e50bc(0xaf)]=_0x3e50bc(0xb1);}[_0x259fe8(0x97)](){const _0x533db9=_0x259fe8;this[_0x533db9(0xd0)]=new openai_1[(_0x533db9(0xb2))]({'apiKey':_0x533db9(0xce),'baseURL':this['defaultUrl']+'/v1'});}async['convertToEnglish'](_0x33ff80){const _0x446b30=_0x259fe8;if(!_0x33ff80)throw new common_1[(_0x446b30(0x98))](_0x446b30(0xc8),common_1[_0x446b30(0xcf)]['BAD_REQUEST']);const {baiduFanyiAppId:_0x4fa495,baiduFanyiSecret:_0x4b8caa}=await this[_0x446b30(0xdc)][_0x446b30(0x9b)]([_0x446b30(0xdf),'baiduFanyiSecret']);if(!_0x4fa495||!_0x4b8caa)throw new common_1[(_0x446b30(0x98))]('当前管理员还未开放翻译服务、请联系管理员开通吧!',common_1[_0x446b30(0xcf)]['BAD_REQUEST']);const _0x53c8a6=Date[_0x446b30(0x9e)]()['toString'](),_0xce0282=crypto[_0x446b30(0xe4)]('md5')[_0x446b30(0xc2)](_0x4fa495+_0x33ff80+_0x53c8a6+_0x4b8caa)[_0x446b30(0xaa)](_0x446b30(0xae)),_0x4f0763=_0x446b30(0xcb),_0x383fb7={'q':_0x33ff80[_0x446b30(0x99)](),'from':_0x446b30(0xbb),'to':'en','appid':_0x4fa495,'salt':_0x53c8a6,'sign':_0xce0282},_0xa5ee4b=await axios_1[_0x446b30(0xb2)][_0x446b30(0xb9)](_0x4f0763,_0x383fb7,{'headers':{'Content-Type':_0x446b30(0xe0)}}),{from:_0x4275a3,to:_0x1da4db,trans_result:_0x80ac02,error_code:_0x5df860,error_msg:_0x86ef6d}=_0xa5ee4b[_0x446b30(0xa2)];if(_0x5df860)throw new common_1['HttpException'](_0x446b30(0xc5)+_0x5df860+']['+_0x86ef6d+']!',common_1[_0x446b30(0xcf)][_0x446b30(0xc6)]);if(!_0x80ac02||!_0x80ac02['length'])throw new common_1['HttpException'](_0x446b30(0xc5)+_0x5df860+']['+_0x86ef6d+']!',common_1[_0x446b30(0xcf)]['BAD_REQUEST']);else return _0x80ac02[0x0]['dst'];}async[_0x259fe8(0xbd)](_0x339481){const _0xda35e8=_0x259fe8,_0x1f0138='接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！';let _0x1d5a99=await this['modelsService'][_0xda35e8(0xde)](model_constant_1[_0xda35e8(0xbc)][_0xda35e8(0xa8)]);if(!_0x1d5a99)throw new common_1[(_0xda35e8(0x98))]('当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！',common_1[_0xda35e8(0xcf)]['BAD_REQUEST']);const {timeout:_0xe8eee2,model:_0x2f8c6d,key:_0x464c72,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x112c6c}=_0x1d5a99;let _0x47e5a0=_0x112c6c;!_0x112c6c&&(_0x47e5a0=await this[_0xda35e8(0xdc)][_0xda35e8(0x9b)]([_0xda35e8(0xcd)]));this[_0xda35e8(0xd0)][_0xda35e8(0xa0)]=(0x0,utils_1['removeSpecialCharacters'])(_0x464c72),this['api'][_0xda35e8(0xa6)]=(_0x47e5a0||this[_0xda35e8(0xaf)])+_0xda35e8(0xc0),this['api']['timeout']=0x493e0;try{common_1[_0xda35e8(0xd6)][_0xda35e8(0xe3)](_0x464c72,_0xda35e8(0x9d)),common_1[_0xda35e8(0xd6)]['log'](_0x47e5a0,_0xda35e8(0xd1));const _0x4f2b6f=Date[_0xda35e8(0x9e)](),_0x25cf92=await this[_0xda35e8(0xd0)]['chat']['completions'][_0xda35e8(0xc4)]({'messages':[{'role':'system','content':_0x1f0138},{'role':_0xda35e8(0xb4),'content':_0x339481}],'model':'gpt-4-all','stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0xda35e8(0xbf)}})[_0xda35e8(0xc7)](_0x3ebf5a=>{const _0xbe7e52=_0xda35e8;return _0x3ebf5a?.['choices'][0x0]?.[_0xbe7e52(0xe5)][_0xbe7e52(0xb5)]||'';})[_0xda35e8(0xb7)](_0x2f4c0f=>{const _0x5ac4c4=_0xda35e8;return common_1[_0x5ac4c4(0xd6)]['error'](_0x2f4c0f),'';}),_0x5d2783=Date[_0xda35e8(0x9e)](),_0x45fb5d=(_0x5d2783-_0x4f2b6f)/0x3e8;return common_1[_0xda35e8(0xd6)]['log'](_0x45fb5d,_0xda35e8(0xa3)),_0x25cf92;}catch(_0xa99e3f){console[_0xda35e8(0xe3)](_0xda35e8(0xdb),_0x464c72,_0xa99e3f);throw new common_1[(_0xda35e8(0x98))](_0xa99e3f[_0xda35e8(0xe5)],common_1[_0xda35e8(0xcf)]['BAD_REQUEST']);}}};function _0x46d7(_0x5880fa,_0x4e5f94){const _0x3055c7=_0x3055();return _0x46d7=function(_0x46d775,_0x31cc48){_0x46d775=_0x46d775-0x96;let _0x50a4bd=_0x3055c7[_0x46d775];return _0x50a4bd;},_0x46d7(_0x5880fa,_0x4e5f94);}FanyiService=__decorate([(0x0,common_1[_0x259fe8(0xd7)])(),__metadata(_0x259fe8(0xa9),[globalConfig_service_1[_0x259fe8(0xc9)],models_service_1[_0x259fe8(0xb8)]])],FanyiService),exports['FanyiService']=FanyiService;