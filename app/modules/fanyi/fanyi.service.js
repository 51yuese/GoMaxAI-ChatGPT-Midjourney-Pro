'use strict';const _0x368790=_0x2034;function _0x2034(_0x81f58c,_0x387d12){const _0x18a2ff=_0x18a2();return _0x2034=function(_0x2034f,_0x1696be){_0x2034f=_0x2034f-0x1d2;let _0x24adac=_0x18a2ff[_0x2034f];return _0x24adac;},_0x2034(_0x81f58c,_0x387d12);}(function(_0x16eea0,_0x59780f){const _0x3e17bb=_0x2034,_0x446680=_0x16eea0();while(!![]){try{const _0x38d32b=parseInt(_0x3e17bb(0x1e7))/0x1+parseInt(_0x3e17bb(0x1e0))/0x2*(parseInt(_0x3e17bb(0x216))/0x3)+parseInt(_0x3e17bb(0x1ed))/0x4+parseInt(_0x3e17bb(0x1d2))/0x5*(-parseInt(_0x3e17bb(0x1f0))/0x6)+-parseInt(_0x3e17bb(0x1f6))/0x7*(parseInt(_0x3e17bb(0x1d5))/0x8)+-parseInt(_0x3e17bb(0x1df))/0x9+parseInt(_0x3e17bb(0x1ea))/0xa*(-parseInt(_0x3e17bb(0x200))/0xb);if(_0x38d32b===_0x59780f)break;else _0x446680['push'](_0x446680['shift']());}catch(_0x574377){_0x446680['push'](_0x446680['shift']());}}}(_0x18a2,0x26818));function _0x18a2(){const _0x3c7532=['FanyiService','/v1','14jbZCqR','defineProperty','create','__metadata','baiduFanyiAppId','removeSpecialCharacters','user','message','baseURL','__esModule','11ksCsDt','OTHER','HttpException','convertToEnglish','function','content','baiduFanyiSecret','modelsService','md5','defaultUrl','then','api','length','toString','https://fanyi-api.baidu.com/api/trans/vip/translate','globalConfigService','data','chat','接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！','crypto','dst','HttpStatus','2310clLrgE','design:paramtypes','error','log','BAD_REQUEST','ModelsService','25lWoNQg','GlobalConfigService','choices','676184JzjLfS','catch','createHash','fanyi-error','apiKey','当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！','openai','now','post','hex','519507qwkaRN','582BixYem','system','getConfigByKeys','object','text','application/x-www-form-urlencoded','axios','304810jNrGCu','@nestjs/common','Injectable','2736130WdWnia','__decorate','gpt-fanyi','935808nakbJZ','auto','translateToEnglish','125676CmJHyh','decorate','Logger','metadata'];_0x18a2=function(){return _0x3c7532;};return _0x18a2();}var __decorate=this&&this[_0x368790(0x1eb)]||function(_0xa3f498,_0x6b392,_0xd75326,_0x547cec){const _0xd5536e=_0x368790;var _0x288282=arguments['length'],_0x1b03e8=_0x288282<0x3?_0x6b392:_0x547cec===null?_0x547cec=Object['getOwnPropertyDescriptor'](_0x6b392,_0xd75326):_0x547cec,_0x238033;if(typeof Reflect===_0xd5536e(0x1e3)&&typeof Reflect[_0xd5536e(0x1f1)]===_0xd5536e(0x204))_0x1b03e8=Reflect[_0xd5536e(0x1f1)](_0xa3f498,_0x6b392,_0xd75326,_0x547cec);else{for(var _0x1df03e=_0xa3f498[_0xd5536e(0x20c)]-0x1;_0x1df03e>=0x0;_0x1df03e--)if(_0x238033=_0xa3f498[_0x1df03e])_0x1b03e8=(_0x288282<0x3?_0x238033(_0x1b03e8):_0x288282>0x3?_0x238033(_0x6b392,_0xd75326,_0x1b03e8):_0x238033(_0x6b392,_0xd75326))||_0x1b03e8;}return _0x288282>0x3&&_0x1b03e8&&Object[_0xd5536e(0x1f7)](_0x6b392,_0xd75326,_0x1b03e8),_0x1b03e8;},__metadata=this&&this[_0x368790(0x1f9)]||function(_0x386ccd,_0x14e532){const _0x512cb7=_0x368790;if(typeof Reflect==='object'&&typeof Reflect['metadata']==='function')return Reflect[_0x512cb7(0x1f3)](_0x386ccd,_0x14e532);};Object[_0x368790(0x1f7)](exports,_0x368790(0x1ff),{'value':!![]}),exports[_0x368790(0x1f4)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x368790(0x1e8)),axios_1=require(_0x368790(0x1e6)),crypto=require(_0x368790(0x213)),openai_1=require(_0x368790(0x1db)),utils_1=require('../../common/utils'),models_service_1=require('../models/models.service'),model_constant_1=require('../../common/constants/model.constant');let FanyiService=class FanyiService{constructor(_0x345043,_0x28a708){const _0x1a9d25=_0x368790;this[_0x1a9d25(0x20f)]=_0x345043,this['modelsService']=_0x28a708,this['defaultUrl']='https://api.openai.com';}['onModuleInit'](){const _0x3ea7eb=_0x368790;this[_0x3ea7eb(0x20b)]=new openai_1['default']({'apiKey':'default-gomaxai-key','baseURL':this[_0x3ea7eb(0x209)]+_0x3ea7eb(0x1f5)});}async[_0x368790(0x203)](_0x45eb62){const _0x180b28=_0x368790;if(!_0x45eb62)throw new common_1[(_0x180b28(0x202))]('请输入要翻译的内容!',common_1[_0x180b28(0x215)][_0x180b28(0x21a)]);const {baiduFanyiAppId:_0x505c00,baiduFanyiSecret:_0x341f8c}=await this[_0x180b28(0x20f)][_0x180b28(0x1e2)]([_0x180b28(0x1fa),_0x180b28(0x206)]);if(!_0x505c00||!_0x341f8c)throw new common_1[(_0x180b28(0x202))]('当前管理员还未开放翻译服务、请联系管理员开通吧!',common_1[_0x180b28(0x215)]['BAD_REQUEST']);const _0x4ea511=Date[_0x180b28(0x1dc)]()[_0x180b28(0x20d)](),_0x519215=crypto[_0x180b28(0x1d7)](_0x180b28(0x208))['update'](_0x505c00+_0x45eb62+_0x4ea511+_0x341f8c)['digest'](_0x180b28(0x1de)),_0x25c969=_0x180b28(0x20e),_0x402707={'q':_0x45eb62[_0x180b28(0x20d)](),'from':_0x180b28(0x1ee),'to':'en','appid':_0x505c00,'salt':_0x4ea511,'sign':_0x519215},_0x5b232c=await axios_1['default'][_0x180b28(0x1dd)](_0x25c969,_0x402707,{'headers':{'Content-Type':_0x180b28(0x1e5)}}),{from:_0x11abe5,to:_0x8ee656,trans_result:_0x5553c9,error_code:_0x43b38f,error_msg:_0x8ad98a}=_0x5b232c[_0x180b28(0x210)];if(_0x43b38f)throw new common_1[(_0x180b28(0x202))]('翻译失败['+_0x43b38f+']['+_0x8ad98a+']!',common_1[_0x180b28(0x215)][_0x180b28(0x21a)]);if(!_0x5553c9||!_0x5553c9[_0x180b28(0x20c)])throw new common_1[(_0x180b28(0x202))]('翻译失败['+_0x43b38f+']['+_0x8ad98a+']!',common_1[_0x180b28(0x215)][_0x180b28(0x21a)]);else return _0x5553c9[0x0][_0x180b28(0x214)];}async[_0x368790(0x1ef)](_0x120ee9){const _0x10f158=_0x368790,_0x5d58c1=_0x10f158(0x212);let _0xccebb5=await this[_0x10f158(0x207)]['getRandomKey'](model_constant_1['EModelType'][_0x10f158(0x201)]);if(!_0xccebb5)throw new common_1[(_0x10f158(0x202))](_0x10f158(0x1da),common_1['HttpStatus'][_0x10f158(0x21a)]);const {timeout:_0x84ad93,model:_0x360b4b,key:_0x3b8375,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x505579}=_0xccebb5;let _0x30ef8c=_0x505579;!_0x505579&&(_0x30ef8c=await this[_0x10f158(0x20f)]['getConfigByKeys'](['openaiBaseUrl']));this[_0x10f158(0x20b)][_0x10f158(0x1d9)]=(0x0,utils_1[_0x10f158(0x1fb)])(_0x3b8375),this[_0x10f158(0x20b)][_0x10f158(0x1fe)]=(_0x30ef8c||this[_0x10f158(0x209)])+_0x10f158(0x1f5),this[_0x10f158(0x20b)]['timeout']=0x493e0;try{common_1[_0x10f158(0x1f2)][_0x10f158(0x219)](_0x3b8375,'translate\x20key'),common_1[_0x10f158(0x1f2)][_0x10f158(0x219)](_0x30ef8c,_0x10f158(0x1ec));const _0x2e09d9=Date['now'](),_0x538028=await this[_0x10f158(0x20b)][_0x10f158(0x211)]['completions'][_0x10f158(0x1f8)]({'messages':[{'role':_0x10f158(0x1e1),'content':_0x5d58c1},{'role':_0x10f158(0x1fc),'content':_0x120ee9}],'model':'gpt-4-all','stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0x10f158(0x1e4)}})[_0x10f158(0x20a)](_0x230206=>{const _0x4f3dfa=_0x10f158;return _0x230206?.[_0x4f3dfa(0x1d4)][0x0]?.['message'][_0x4f3dfa(0x205)]||'';})[_0x10f158(0x1d6)](_0x99c2df=>{const _0x10b341=_0x10f158;return common_1['Logger'][_0x10b341(0x218)](_0x99c2df),'';}),_0x3c5d56=Date[_0x10f158(0x1dc)](),_0x392db6=(_0x3c5d56-_0x2e09d9)/0x3e8;return common_1['Logger'][_0x10f158(0x219)](_0x392db6,'翻译花费时间\x20%s\x20秒'),_0x538028;}catch(_0x3a184a){console[_0x10f158(0x219)](_0x10f158(0x1d8),_0x3b8375,_0x3a184a);throw new common_1[(_0x10f158(0x202))](_0x3a184a[_0x10f158(0x1fd)],common_1[_0x10f158(0x215)][_0x10f158(0x21a)]);}}};FanyiService=__decorate([(0x0,common_1[_0x368790(0x1e9)])(),__metadata(_0x368790(0x217),[globalConfig_service_1[_0x368790(0x1d3)],models_service_1[_0x368790(0x21b)]])],FanyiService),exports['FanyiService']=FanyiService;