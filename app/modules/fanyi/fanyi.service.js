'use strict';function _0x5f37(){const _0x29525c=['../../common/utils','翻译花费时间\x20%s\x20秒','FanyiService','baseURL','length','default-gomaxai-key','chat','removeSpecialCharacters','HttpStatus','createHash','2740705fSPIvp','update','defaultUrl','__decorate','error','post','text','defineProperty','axios','https://fanyi-api.baidu.com/api/trans/vip/translate','apiKey','60fsQhik','../../common/constants/model.constant','onModuleInit','../models/models.service','接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！','7581GELtNZ','https://api.openai.com','/v1','globalConfigService','content','completions','1964CZtndW','api','decorate','timeout','create','4485140yryAoN','function','toString','now','GlobalConfigService','getConfigByKeys','BAD_REQUEST','metadata','__esModule','default','翻译失败[','fanyi-error','openaiBaseUrl','message','635532AiXjtb','10zXhZqh','choices','63VlcOgS','then','baiduFanyiSecret','9577746UFkNcg','application/x-www-form-urlencoded','gpt-4-all','ModelsService','getRandomKey','@nestjs/common','openai','OTHER','5018456jLfjMt','当前管理员还未开放翻译服务、请联系管理员开通吧!','Injectable','1128xKWqeI','modelsService','data','translateToEnglish','log','Logger','HttpException','getOwnPropertyDescriptor','2zZJdyz','md5','convertToEnglish','object','dst','digest'];_0x5f37=function(){return _0x29525c;};return _0x5f37();}function _0x22d8(_0x223cc7,_0x19006e){const _0x5f3799=_0x5f37();return _0x22d8=function(_0x22d8f4,_0x233f09){_0x22d8f4=_0x22d8f4-0x167;let _0x22fea0=_0x5f3799[_0x22d8f4];return _0x22fea0;},_0x22d8(_0x223cc7,_0x19006e);}const _0x35812d=_0x22d8;(function(_0x15f90d,_0x5c1faf){const _0x162aa2=_0x22d8,_0x1d12a0=_0x15f90d();while(!![]){try{const _0x5c2dc1=-parseInt(_0x162aa2(0x1b3))/0x1*(parseInt(_0x162aa2(0x17a))/0x2)+parseInt(_0x162aa2(0x19a))/0x3*(-parseInt(_0x162aa2(0x1a0))/0x4)+parseInt(_0x162aa2(0x1a5))/0x5+-parseInt(_0x162aa2(0x172))/0x6*(-parseInt(_0x162aa2(0x1b6))/0x7)+-parseInt(_0x162aa2(0x16f))/0x8+parseInt(_0x162aa2(0x167))/0x9*(parseInt(_0x162aa2(0x1b4))/0xa)+-parseInt(_0x162aa2(0x18a))/0xb*(-parseInt(_0x162aa2(0x195))/0xc);if(_0x5c2dc1===_0x5c1faf)break;else _0x1d12a0['push'](_0x1d12a0['shift']());}catch(_0x17b926){_0x1d12a0['push'](_0x1d12a0['shift']());}}}(_0x5f37,0xac245));var __decorate=this&&this[_0x35812d(0x18d)]||function(_0x222c84,_0x4d9586,_0x5deea6,_0x2a1e9d){const _0x307b6c=_0x35812d;var _0x237afa=arguments[_0x307b6c(0x184)],_0x26c2f9=_0x237afa<0x3?_0x4d9586:_0x2a1e9d===null?_0x2a1e9d=Object[_0x307b6c(0x179)](_0x4d9586,_0x5deea6):_0x2a1e9d,_0x16c45d;if(typeof Reflect==='object'&&typeof Reflect[_0x307b6c(0x1a2)]==='function')_0x26c2f9=Reflect[_0x307b6c(0x1a2)](_0x222c84,_0x4d9586,_0x5deea6,_0x2a1e9d);else{for(var _0x35e5b0=_0x222c84['length']-0x1;_0x35e5b0>=0x0;_0x35e5b0--)if(_0x16c45d=_0x222c84[_0x35e5b0])_0x26c2f9=(_0x237afa<0x3?_0x16c45d(_0x26c2f9):_0x237afa>0x3?_0x16c45d(_0x4d9586,_0x5deea6,_0x26c2f9):_0x16c45d(_0x4d9586,_0x5deea6))||_0x26c2f9;}return _0x237afa>0x3&&_0x26c2f9&&Object[_0x307b6c(0x191)](_0x4d9586,_0x5deea6,_0x26c2f9),_0x26c2f9;},__metadata=this&&this['__metadata']||function(_0x4f3b8c,_0x3cc594){const _0xe958db=_0x35812d;if(typeof Reflect===_0xe958db(0x17d)&&typeof Reflect['metadata']===_0xe958db(0x1a6))return Reflect[_0xe958db(0x1ac)](_0x4f3b8c,_0x3cc594);};Object[_0x35812d(0x191)](exports,_0x35812d(0x1ad),{'value':!![]}),exports[_0x35812d(0x182)]=void 0x0;const globalConfig_service_1=require('./../globalConfig/globalConfig.service'),common_1=require(_0x35812d(0x16c)),axios_1=require(_0x35812d(0x192)),crypto=require('crypto'),openai_1=require(_0x35812d(0x16d)),utils_1=require(_0x35812d(0x180)),models_service_1=require(_0x35812d(0x198)),model_constant_1=require(_0x35812d(0x196));let FanyiService=class FanyiService{constructor(_0x5c7dba,_0x350005){const _0x33220f=_0x35812d;this[_0x33220f(0x19d)]=_0x5c7dba,this[_0x33220f(0x173)]=_0x350005,this[_0x33220f(0x18c)]=_0x33220f(0x19b);}[_0x35812d(0x197)](){const _0x45d9dc=_0x35812d;this['api']=new openai_1[(_0x45d9dc(0x1ae))]({'apiKey':_0x45d9dc(0x185),'baseURL':this['defaultUrl']+_0x45d9dc(0x19c)});}async[_0x35812d(0x17c)](_0x3f7387){const _0x594ff9=_0x35812d;if(!_0x3f7387)throw new common_1[(_0x594ff9(0x178))]('请输入要翻译的内容!',common_1[_0x594ff9(0x188)][_0x594ff9(0x1ab)]);const {baiduFanyiAppId:_0x42d301,baiduFanyiSecret:_0x360947}=await this['globalConfigService'][_0x594ff9(0x1aa)](['baiduFanyiAppId',_0x594ff9(0x1b8)]);if(!_0x42d301||!_0x360947)throw new common_1[(_0x594ff9(0x178))](_0x594ff9(0x170),common_1['HttpStatus'][_0x594ff9(0x1ab)]);const _0x2f99e0=Date[_0x594ff9(0x1a8)]()[_0x594ff9(0x1a7)](),_0x293d43=crypto[_0x594ff9(0x189)](_0x594ff9(0x17b))[_0x594ff9(0x18b)](_0x42d301+_0x3f7387+_0x2f99e0+_0x360947)[_0x594ff9(0x17f)]('hex'),_0x261921=_0x594ff9(0x193),_0x6487de={'q':_0x3f7387[_0x594ff9(0x1a7)](),'from':'auto','to':'en','appid':_0x42d301,'salt':_0x2f99e0,'sign':_0x293d43},_0x198900=await axios_1[_0x594ff9(0x1ae)][_0x594ff9(0x18f)](_0x261921,_0x6487de,{'headers':{'Content-Type':_0x594ff9(0x168)}}),{from:_0x3be38d,to:_0x283166,trans_result:_0xc098c4,error_code:_0xa12638,error_msg:_0x124fb5}=_0x198900[_0x594ff9(0x174)];if(_0xa12638)throw new common_1['HttpException'](_0x594ff9(0x1af)+_0xa12638+']['+_0x124fb5+']!',common_1[_0x594ff9(0x188)][_0x594ff9(0x1ab)]);if(!_0xc098c4||!_0xc098c4[_0x594ff9(0x184)])throw new common_1[(_0x594ff9(0x178))](_0x594ff9(0x1af)+_0xa12638+']['+_0x124fb5+']!',common_1['HttpStatus'][_0x594ff9(0x1ab)]);else return _0xc098c4[0x0][_0x594ff9(0x17e)];}async[_0x35812d(0x175)](_0x2509f6){const _0xd0eaf7=_0x35812d,_0xcf8896=_0xd0eaf7(0x199);let _0x4488b5=await this[_0xd0eaf7(0x173)][_0xd0eaf7(0x16b)](model_constant_1['EModelType'][_0xd0eaf7(0x16e)]);if(!_0x4488b5)throw new common_1[(_0xd0eaf7(0x178))]('当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！',common_1['HttpStatus'][_0xd0eaf7(0x1ab)]);const {timeout:_0x1b0880,model:_0x3959ef,key:_0x41853c,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x4724f4}=_0x4488b5;let _0x387a96=_0x4724f4;!_0x4724f4&&(_0x387a96=await this['globalConfigService'][_0xd0eaf7(0x1aa)]([_0xd0eaf7(0x1b1)]));this[_0xd0eaf7(0x1a1)][_0xd0eaf7(0x194)]=(0x0,utils_1[_0xd0eaf7(0x187)])(_0x41853c),this[_0xd0eaf7(0x1a1)][_0xd0eaf7(0x183)]=(_0x387a96||this['defaultUrl'])+_0xd0eaf7(0x19c),this['api'][_0xd0eaf7(0x1a3)]=0x493e0;try{common_1[_0xd0eaf7(0x177)][_0xd0eaf7(0x176)](_0x41853c,'translate\x20key'),common_1['Logger'][_0xd0eaf7(0x176)](_0x387a96,'gpt-fanyi');const _0xfd0e4a=Date[_0xd0eaf7(0x1a8)](),_0x581b0d=await this['api'][_0xd0eaf7(0x186)][_0xd0eaf7(0x19f)][_0xd0eaf7(0x1a4)]({'messages':[{'role':'system','content':_0xcf8896},{'role':'user','content':_0x2509f6}],'model':_0xd0eaf7(0x169),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0xd0eaf7(0x190)}})[_0xd0eaf7(0x1b7)](_0x1af314=>{const _0x38c428=_0xd0eaf7;return _0x1af314?.[_0x38c428(0x1b5)][0x0]?.['message'][_0x38c428(0x19e)]||'';})['catch'](_0x597931=>{const _0x1db05a=_0xd0eaf7;return common_1[_0x1db05a(0x177)][_0x1db05a(0x18e)](_0x597931),'';}),_0x28e749=Date['now'](),_0x404948=(_0x28e749-_0xfd0e4a)/0x3e8;return common_1[_0xd0eaf7(0x177)]['log'](_0x404948,_0xd0eaf7(0x181)),_0x581b0d;}catch(_0x582cc5){console[_0xd0eaf7(0x176)](_0xd0eaf7(0x1b0),_0x41853c,_0x582cc5);throw new common_1[(_0xd0eaf7(0x178))](_0x582cc5[_0xd0eaf7(0x1b2)],common_1['HttpStatus'][_0xd0eaf7(0x1ab)]);}}};FanyiService=__decorate([(0x0,common_1[_0x35812d(0x171)])(),__metadata('design:paramtypes',[globalConfig_service_1[_0x35812d(0x1a9)],models_service_1[_0x35812d(0x16a)]])],FanyiService),exports[_0x35812d(0x182)]=FanyiService;