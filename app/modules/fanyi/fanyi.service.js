'use strict';const _0x2efdb3=_0x22a1;(function(_0x2f5ab3,_0x42d1f9){const _0x416a95=_0x22a1,_0x514578=_0x2f5ab3();while(!![]){try{const _0x8a74fc=-parseInt(_0x416a95(0xfb))/0x1+-parseInt(_0x416a95(0xf6))/0x2*(-parseInt(_0x416a95(0xc7))/0x3)+-parseInt(_0x416a95(0xcc))/0x4*(-parseInt(_0x416a95(0xe3))/0x5)+-parseInt(_0x416a95(0xe6))/0x6*(-parseInt(_0x416a95(0xfd))/0x7)+parseInt(_0x416a95(0x100))/0x8*(-parseInt(_0x416a95(0x10a))/0x9)+parseInt(_0x416a95(0xc8))/0xa*(-parseInt(_0x416a95(0xe8))/0xb)+-parseInt(_0x416a95(0xea))/0xc*(-parseInt(_0x416a95(0x10c))/0xd);if(_0x8a74fc===_0x42d1f9)break;else _0x514578['push'](_0x514578['shift']());}catch(_0xe826f4){_0x514578['push'](_0x514578['shift']());}}}(_0x4f89,0x8d958));var __decorate=this&&this['__decorate']||function(_0x433f1b,_0x2910eb,_0x3990dc,_0x47a9ee){const _0x4caac0=_0x22a1;var _0x51f314=arguments[_0x4caac0(0xee)],_0x1a75ad=_0x51f314<0x3?_0x2910eb:_0x47a9ee===null?_0x47a9ee=Object[_0x4caac0(0xd5)](_0x2910eb,_0x3990dc):_0x47a9ee,_0x10f7fc;if(typeof Reflect===_0x4caac0(0xf8)&&typeof Reflect['decorate']===_0x4caac0(0x101))_0x1a75ad=Reflect[_0x4caac0(0xd4)](_0x433f1b,_0x2910eb,_0x3990dc,_0x47a9ee);else{for(var _0x2a37ec=_0x433f1b[_0x4caac0(0xee)]-0x1;_0x2a37ec>=0x0;_0x2a37ec--)if(_0x10f7fc=_0x433f1b[_0x2a37ec])_0x1a75ad=(_0x51f314<0x3?_0x10f7fc(_0x1a75ad):_0x51f314>0x3?_0x10f7fc(_0x2910eb,_0x3990dc,_0x1a75ad):_0x10f7fc(_0x2910eb,_0x3990dc))||_0x1a75ad;}return _0x51f314>0x3&&_0x1a75ad&&Object[_0x4caac0(0xf4)](_0x2910eb,_0x3990dc,_0x1a75ad),_0x1a75ad;},__metadata=this&&this['__metadata']||function(_0x5a4c36,_0x99275c){const _0x1ce63d=_0x22a1;if(typeof Reflect===_0x1ce63d(0xf8)&&typeof Reflect['metadata']===_0x1ce63d(0x101))return Reflect['metadata'](_0x5a4c36,_0x99275c);};function _0x22a1(_0x5290f3,_0x40323d){const _0x4f89f2=_0x4f89();return _0x22a1=function(_0x22a1e8,_0x58324d){_0x22a1e8=_0x22a1e8-0xc6;let _0x29ae50=_0x4f89f2[_0x22a1e8];return _0x29ae50;},_0x22a1(_0x5290f3,_0x40323d);}function _0x4f89(){const _0x50bec8=['10oCtcLq','baiduFanyiSecret','digest','@nestjs/common','106228dwVyDL','create','defaultUrl','翻译花费时间\x20%s\x20秒','translateToEnglish','GlobalConfigService','dst','onModuleInit','decorate','getOwnPropertyDescriptor','../models/models.service','axios','choices','post','chat','removeSpecialCharacters','请输入要翻译的内容!','globalConfigService','openaiBaseUrl','翻译失败[','createHash','/v1','log','95EKAGfH','gpt-4-all','md5','172914qCHsIV','FanyiService','86339zmMCnS','BAD_REQUEST','348aBXfnZ','application/x-www-form-urlencoded','Logger','fanyi-error','length','hex','text','baiduFanyiAppId','then','modelsService','defineProperty','toString','626242UnazbO','EModelType','object','crypto','HttpStatus','1099300hwduBo','baseURL','7sKgdCv','data','../../common/utils','56qaUZdL','function','now','default-gomaxai-key','https://fanyi-api.baidu.com/api/trans/vip/translate','HttpException','api','Injectable','default','catch','687573iKwhLl','translate\x20key','476164PcBqSY','message','getConfigs','openai','./../globalConfig/globalConfig.service','6kNpZHX'];_0x4f89=function(){return _0x50bec8;};return _0x4f89();}Object[_0x2efdb3(0xf4)](exports,'__esModule',{'value':!![]}),exports[_0x2efdb3(0xe7)]=void 0x0;const globalConfig_service_1=require(_0x2efdb3(0xc6)),common_1=require(_0x2efdb3(0xcb)),axios_1=require(_0x2efdb3(0xd7)),crypto=require(_0x2efdb3(0xf9)),openai_1=require(_0x2efdb3(0x10f)),utils_1=require(_0x2efdb3(0xff)),models_service_1=require(_0x2efdb3(0xd6)),model_constant_1=require('../../common/constants/model.constant');let FanyiService=class FanyiService{constructor(_0x580af8,_0x242db3){const _0x1c95b7=_0x2efdb3;this['globalConfigService']=_0x580af8,this['modelsService']=_0x242db3,this[_0x1c95b7(0xce)]='https://api.openai.com';}[_0x2efdb3(0xd3)](){const _0x2e4bb9=_0x2efdb3;this[_0x2e4bb9(0x106)]=new openai_1[(_0x2e4bb9(0x108))]({'apiKey':_0x2e4bb9(0x103),'baseURL':this[_0x2e4bb9(0xce)]+'/v1'});}async['convertToEnglish'](_0x293bd5){const _0x5ed0ab=_0x2efdb3;if(!_0x293bd5)throw new common_1[(_0x5ed0ab(0x105))](_0x5ed0ab(0xdc),common_1[_0x5ed0ab(0xfa)][_0x5ed0ab(0xe9)]);const {baiduFanyiAppId:_0x3a1a06,baiduFanyiSecret:_0x1a1bbf}=await this[_0x5ed0ab(0xdd)][_0x5ed0ab(0x10e)]([_0x5ed0ab(0xf1),_0x5ed0ab(0xc9)]);if(!_0x3a1a06||!_0x1a1bbf)throw new common_1[(_0x5ed0ab(0x105))]('当前管理员还未开放翻译服务、请联系管理员开通吧!',common_1[_0x5ed0ab(0xfa)][_0x5ed0ab(0xe9)]);const _0x28bf31=Date['now']()[_0x5ed0ab(0xf5)](),_0xc93b9f=crypto[_0x5ed0ab(0xe0)](_0x5ed0ab(0xe5))['update'](_0x3a1a06+_0x293bd5+_0x28bf31+_0x1a1bbf)[_0x5ed0ab(0xca)](_0x5ed0ab(0xef)),_0x5eda2b=_0x5ed0ab(0x104),_0x4e7b62={'q':_0x293bd5[_0x5ed0ab(0xf5)](),'from':'auto','to':'en','appid':_0x3a1a06,'salt':_0x28bf31,'sign':_0xc93b9f},_0xc5f303=await axios_1['default'][_0x5ed0ab(0xd9)](_0x5eda2b,_0x4e7b62,{'headers':{'Content-Type':_0x5ed0ab(0xeb)}}),{from:_0x2e657f,to:_0x2fb304,trans_result:_0x5d568d,error_code:_0x1d83fe,error_msg:_0x318769}=_0xc5f303[_0x5ed0ab(0xfe)];if(_0x1d83fe)throw new common_1['HttpException'](_0x5ed0ab(0xdf)+_0x1d83fe+']['+_0x318769+']!',common_1[_0x5ed0ab(0xfa)]['BAD_REQUEST']);if(!_0x5d568d||!_0x5d568d[_0x5ed0ab(0xee)])throw new common_1['HttpException'](_0x5ed0ab(0xdf)+_0x1d83fe+']['+_0x318769+']!',common_1[_0x5ed0ab(0xfa)][_0x5ed0ab(0xe9)]);else return _0x5d568d[0x0][_0x5ed0ab(0xd2)];}async[_0x2efdb3(0xd0)](_0x5d56a8){const _0x2a9007=_0x2efdb3,_0x5dcc40='接下来我会给你一些内容、我希望你帮我翻译成英文、不管我给你任何语言、你都回复我英文、如果给你了英文、依然回复我更加优化的英文、并且期望你不需要做任何多余的解释、给我英文即可、不要加任何东西、我只需要英文！';let _0x137e93=await this[_0x2a9007(0xf3)]['getRandomKey'](model_constant_1[_0x2a9007(0xf7)]['OTHER']);if(!_0x137e93)throw new common_1['HttpException']('当前流程所需要的模型已被管理员下架、请联系管理员上架专属模型！',common_1[_0x2a9007(0xfa)]['BAD_REQUEST']);const {timeout:_0x46fc5d,model:_0x975c47,key:_0x413538,maxModelTokens:maxModelTokens=0x1f40,proxyUrl:_0x2720dc}=_0x137e93;let _0x44c490=_0x2720dc;!_0x2720dc&&(_0x44c490=await this[_0x2a9007(0xdd)][_0x2a9007(0x10e)]([_0x2a9007(0xde)]));this[_0x2a9007(0x106)]['apiKey']=(0x0,utils_1[_0x2a9007(0xdb)])(_0x413538),this['api'][_0x2a9007(0xfc)]=(_0x44c490||this[_0x2a9007(0xce)])+_0x2a9007(0xe1),this[_0x2a9007(0x106)]['timeout']=0x493e0;try{common_1['Logger']['log'](_0x413538,_0x2a9007(0x10b)),common_1[_0x2a9007(0xec)][_0x2a9007(0xe2)](_0x44c490,'gpt-fanyi');const _0x23c4e6=Date[_0x2a9007(0x102)](),_0x104e86=await this[_0x2a9007(0x106)][_0x2a9007(0xda)]['completions'][_0x2a9007(0xcd)]({'messages':[{'role':'system','content':_0x5dcc40},{'role':'user','content':_0x5d56a8}],'model':_0x2a9007(0xe4),'stream':![],'n':0x1,'max_tokens':maxModelTokens,'response_format':{'type':_0x2a9007(0xf0)}})[_0x2a9007(0xf2)](_0x429cc7=>{const _0x4daeed=_0x2a9007;return _0x429cc7?.[_0x4daeed(0xd8)][0x0]?.[_0x4daeed(0x10d)]['content']||'';})[_0x2a9007(0x109)](_0x9d809c=>{return common_1['Logger']['error'](_0x9d809c),'';}),_0x4fd6da=Date[_0x2a9007(0x102)](),_0x1497bc=(_0x4fd6da-_0x23c4e6)/0x3e8;return common_1[_0x2a9007(0xec)]['log'](_0x1497bc,_0x2a9007(0xcf)),_0x104e86;}catch(_0x548394){console[_0x2a9007(0xe2)](_0x2a9007(0xed),_0x413538,_0x548394);throw new common_1['HttpException'](_0x548394[_0x2a9007(0x10d)],common_1[_0x2a9007(0xfa)][_0x2a9007(0xe9)]);}}};FanyiService=__decorate([(0x0,common_1[_0x2efdb3(0x107)])(),__metadata('design:paramtypes',[globalConfig_service_1[_0x2efdb3(0xd1)],models_service_1['ModelsService']])],FanyiService),exports[_0x2efdb3(0xe7)]=FanyiService;