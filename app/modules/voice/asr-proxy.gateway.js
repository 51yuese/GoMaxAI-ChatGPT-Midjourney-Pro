'use strict';const _0x4ac1f3=_0x5b17;(function(_0xd03365,_0x1fbc82){const _0x2dd5ba=_0x5b17,_0x485bf1=_0xd03365();while(!![]){try{const _0x484f49=parseInt(_0x2dd5ba(0x1df))/0x1+-parseInt(_0x2dd5ba(0x206))/0x2+parseInt(_0x2dd5ba(0x1fb))/0x3+parseInt(_0x2dd5ba(0x1f3))/0x4+-parseInt(_0x2dd5ba(0x1f9))/0x5+parseInt(_0x2dd5ba(0x203))/0x6*(-parseInt(_0x2dd5ba(0x1fe))/0x7)+parseInt(_0x2dd5ba(0x1e1))/0x8*(-parseInt(_0x2dd5ba(0x1e8))/0x9);if(_0x484f49===_0x1fbc82)break;else _0x485bf1['push'](_0x485bf1['shift']());}catch(_0x156121){_0x485bf1['push'](_0x485bf1['shift']());}}}(_0x5018,0x1dbb1));var __decorate=this&&this[_0x4ac1f3(0x20a)]||function(_0x1e364d,_0x2ccbe5,_0x42268a,_0x30c2c0){const _0x30e529=_0x4ac1f3;var _0x3938d6=arguments[_0x30e529(0x202)],_0x316528=_0x3938d6<0x3?_0x2ccbe5:_0x30c2c0===null?_0x30c2c0=Object['getOwnPropertyDescriptor'](_0x2ccbe5,_0x42268a):_0x30c2c0,_0xaa7cea;if(typeof Reflect===_0x30e529(0x1fc)&&typeof Reflect['decorate']==='function')_0x316528=Reflect[_0x30e529(0x1de)](_0x1e364d,_0x2ccbe5,_0x42268a,_0x30c2c0);else{for(var _0x482273=_0x1e364d[_0x30e529(0x202)]-0x1;_0x482273>=0x0;_0x482273--)if(_0xaa7cea=_0x1e364d[_0x482273])_0x316528=(_0x3938d6<0x3?_0xaa7cea(_0x316528):_0x3938d6>0x3?_0xaa7cea(_0x2ccbe5,_0x42268a,_0x316528):_0xaa7cea(_0x2ccbe5,_0x42268a))||_0x316528;}return _0x3938d6>0x3&&_0x316528&&Object['defineProperty'](_0x2ccbe5,_0x42268a,_0x316528),_0x316528;},__metadata=this&&this[_0x4ac1f3(0x1f0)]||function(_0x384d85,_0x49a232){const _0x28860f=_0x4ac1f3;if(typeof Reflect===_0x28860f(0x1fc)&&typeof Reflect[_0x28860f(0x1ef)]===_0x28860f(0x1f1))return Reflect['metadata'](_0x384d85,_0x49a232);},_a;Object[_0x4ac1f3(0x1e5)](exports,_0x4ac1f3(0x1d8),{'value':!![]}),exports['AsrProxyGateway']=void 0x0;const websockets_1=require('@nestjs/websockets'),ws_1=require('ws'),uuid_1=require(_0x4ac1f3(0x1ff)),asr_ws_client_1=require('./asr-ws-client');let AsrProxyGateway=class AsrProxyGateway{constructor(){const _0x340d2f=_0x4ac1f3;this[_0x340d2f(0x1e2)]=new Map();}['handleConnection'](_0x58d1da){const _0x163021=_0x4ac1f3,_0x2ea7ae=(0x0,uuid_1['v4'])();console[_0x163021(0x1d7)]('New\x20client\x20connected:\x20'+_0x2ea7ae),this[_0x163021(0x1e2)]['set'](_0x2ea7ae,{'ws':_0x58d1da}),_0x58d1da['on'](_0x163021(0x1e0),async _0x6e917d=>{const _0xe0097b=_0x163021;try{const _0x1a0641=JSON[_0xe0097b(0x1f7)](_0x6e917d);if(_0x1a0641['type']===_0xe0097b(0x200))await this[_0xe0097b(0x1e7)](_0x2ea7ae,_0x1a0641);else _0x1a0641['type']===_0xe0097b(0x1da)&&await this[_0xe0097b(0x20d)](_0x2ea7ae,_0x1a0641);}catch(_0x478112){console['log'](_0xe0097b(0x204),_0x478112),_0x58d1da[_0xe0097b(0x1fd)](JSON[_0xe0097b(0x1e3)]({'type':'error','message':_0x478112[_0xe0097b(0x1e0)]}));}});}['handleDisconnect'](_0xf06007){const _0xf53de6=_0x4ac1f3;console['log'](_0xf53de6(0x1ee)+_0xf06007);const _0x2def7b=this[_0xf53de6(0x1e2)][_0xf53de6(0x1e6)](_0xf06007);_0x2def7b?.[_0xf53de6(0x1f5)]&&_0x2def7b['asrClient'][_0xf53de6(0x205)](),this['activeClients'][_0xf53de6(0x210)](_0xf06007);}async['handleInit'](_0x343f78,_0x28f44b){const _0x5052c5=_0x4ac1f3,_0x3debda=this[_0x5052c5(0x1e2)][_0x5052c5(0x1e6)](_0x343f78);if(!_0x3debda)throw new Error('Client\x20not\x20found');const {ws:_0x12770f}=_0x3debda,{format:format='wav',sampleRate:sampleRate=0x3e80,language:language=_0x5052c5(0x207)}=_0x28f44b,_0x3685b6=new asr_ws_client_1['AsrWsClient'](_0x5052c5(0x1dc),_0x5052c5(0x1ed),{'appid':_0x5052c5(0x1eb),'token':_0x5052c5(0x1dd),'format':format,'sampleRate':sampleRate,'language':language,'segDuration':0x1f4,'channel':0x1,'bits':0x10});try{await _0x3685b6[_0x5052c5(0x20b)](),_0x3685b6[_0x5052c5(0x201)](_0x1348bb=>{const _0x2c6401=_0x5052c5;_0x12770f[_0x2c6401(0x1fd)](JSON[_0x2c6401(0x1e3)]({'type':_0x2c6401(0x20f),'data':_0x1348bb}));}),this[_0x5052c5(0x1e2)][_0x5052c5(0x1e4)](_0x343f78,{'ws':_0x12770f,'asrClient':_0x3685b6}),_0x12770f[_0x5052c5(0x1fd)](JSON[_0x5052c5(0x1e3)]({'type':_0x5052c5(0x1d9)}));}catch(_0x92f59d){_0x12770f[_0x5052c5(0x1fd)](JSON[_0x5052c5(0x1e3)]({'type':'error','message':_0x5052c5(0x1ea)+_0x92f59d['message']}));}}async[_0x4ac1f3(0x20d)](_0xae8fdd,_0x4296e0){const _0x2637fe=_0x4ac1f3,_0x2e620f=this['activeClients'][_0x2637fe(0x1e6)](_0xae8fdd);if(!_0x2e620f||!_0x2e620f['asrClient'])throw new Error(_0x2637fe(0x208));const {ws:_0xca0e84,asrClient:_0x4005c0}=_0x2e620f,_0x39427d=Buffer[_0x2637fe(0x1f4)](_0x4296e0[_0x2637fe(0x20e)],_0x2637fe(0x1f2));await _0x4005c0[_0x2637fe(0x20c)](_0x39427d,_0x4296e0['isLast']||![]);}};function _0x5018(){const _0x1b29d3=['ASR\x20client\x20not\x20initialized.\x20Call\x20init\x20first.','design:type','__decorate','initConnection','sendAudioChunk','handleAudio','chunk','result','delete','WebSocketGateway','log','__esModule','ready','audio','/voice-ws','dummy','VsrnA2faKbR93YlCeD63hAjbqTuzRgQU','decorate','164768nLrcAQ','message','74448lSZzRE','activeClients','stringify','set','defineProperty','get','handleInit','306wJClqU','server','Failed\x20to\x20initialize\x20ASR\x20connection:\x20','5019635732','prototype','volcengine_streaming_common','Client\x20disconnected:\x20','metadata','__metadata','function','base64','738324wxbQJz','from','asrClient','websocket','parse','AsrProxyGateway','190985pcNEEQ','undefined','392319lhALgB','object','send','147CbXLOG','uuid','init','onResponse','length','1038CPMkGR','Error\x20processing\x20message:','close','222mXaTHm','zh-CN'];_0x5018=function(){return _0x1b29d3;};return _0x5018();}function _0x5b17(_0x5a106e,_0xb17035){const _0x5018c7=_0x5018();return _0x5b17=function(_0x5b17f6,_0x4a514a){_0x5b17f6=_0x5b17f6-0x1d7;let _0x4e9f73=_0x5018c7[_0x5b17f6];return _0x4e9f73;},_0x5b17(_0x5a106e,_0xb17035);}__decorate([(0x0,websockets_1['WebSocketServer'])(),__metadata(_0x4ac1f3(0x209),typeof(_a=typeof ws_1['Server']!==_0x4ac1f3(0x1fa)&&ws_1['Server'])===_0x4ac1f3(0x1f1)?_a:Object)],AsrProxyGateway[_0x4ac1f3(0x1ec)],_0x4ac1f3(0x1e9),void 0x0),AsrProxyGateway=__decorate([(0x0,websockets_1[_0x4ac1f3(0x211)])({'path':_0x4ac1f3(0x1db),'transports':[_0x4ac1f3(0x1f6)],'noServer':!![],'cors':!![]})],AsrProxyGateway),exports[_0x4ac1f3(0x1f8)]=AsrProxyGateway;