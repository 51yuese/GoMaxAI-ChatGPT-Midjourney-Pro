'use strict';const _0x4ee92c=_0x4f4a;(function(_0x2ef2bd,_0x5c1fb4){const _0x3c5da2=_0x4f4a,_0x167b93=_0x2ef2bd();while(!![]){try{const _0x2e740b=parseInt(_0x3c5da2(0x16d))/0x1+-parseInt(_0x3c5da2(0x14a))/0x2+parseInt(_0x3c5da2(0x158))/0x3+-parseInt(_0x3c5da2(0x11d))/0x4+-parseInt(_0x3c5da2(0x12b))/0x5+parseInt(_0x3c5da2(0x15f))/0x6+parseInt(_0x3c5da2(0x13e))/0x7;if(_0x2e740b===_0x5c1fb4)break;else _0x167b93['push'](_0x167b93['shift']());}catch(_0xc1787e){_0x167b93['push'](_0x167b93['shift']());}}}(_0x290e,0x604ef));Object['defineProperty'](exports,_0x4ee92c(0x15a),{'value':!![]}),exports[_0x4ee92c(0x16f)]=void 0x0;function _0x290e(){const _0x4c635c=['payloadMsg','uid','553819nLuoOk','full','streaming_asr_demo','cluster','resultType','JSON\x20parse\x20failed:','floor','sliceData','setUint32','segDuration','subarray','codec','931848maIYCg','showUtterances','wss://openspeech.bytedance.com/api/v2/asr','code','audioType','channel','authMethod','token','parse','signature','\x22;\x20h=\x22','rate','onResponse','constructRequest','1792347VIrPmL','createHmac','__esModule','language','\x22;\x20mac=\x22','message','successCode','2068332riqFys','crypto','isReady','buffer','getUint32','mp3SegSize','audioPath','utf-8','appid','error','secret','pathname','open','payloadSize','614722bEJryw','showLanguage','AsrWsClient','close','gzipSync','stringify','audio_in,resample,partition,vad,fe,decode,itn,nlu_punctuate','wav','3031120PNYHlf','from','send','signatureAuth','Connection\x20not\x20initialized.\x20Call\x20initConnection\x20first.','zh-CN','responseCallback','tokenAuth','digest','gunzipSync','decode','Bearer;\x20','bits','sha256','89135gPjXmY','format','wsUrl','getInt32','split','raw','Custom','seq','base64url','length','Gzip\x20decompression\x20failed:','byteLength','sendAudioChunk','HMAC256;\x20access_token=\x22','workflow','reqid','access_secret'];_0x290e=function(){return _0x4c635c;};return _0x290e();}const WebSocket=require('ws'),crypto_1=require(_0x4ee92c(0x160)),zlib_1=require('zlib'),uuid_1=require('uuid'),PROTOCOL_VERSION=0x1,CLIENT_FULL_REQUEST=0x1,CLIENT_AUDIO_ONLY_REQUEST=0x2,SERVER_FULL_RESPONSE=0x9,SERVER_ACK=0xb,SERVER_ERROR_RESPONSE=0xf,NO_SEQUENCE=0x0,POS_SEQUENCE=0x1,NEG_SEQUENCE=0x2,NO_SERIALIZATION=0x0,JSON_SERIAL=0x1,NO_COMPRESSION=0x0,GZIP=0x1;function generateHeader({version:version=PROTOCOL_VERSION,messageType:messageType=CLIENT_FULL_REQUEST,messageTypeSpecificFlags:messageTypeSpecificFlags=NO_SEQUENCE,serialMethod:serialMethod=JSON_SERIAL,compressionType:compressionType=GZIP,reservedData:reservedData=0x0,extensionHeader:extensionHeader=new Uint8Array()}={}){const _0x507b13=_0x4ee92c,_0x401474=new Uint8Array(0x4+extensionHeader[_0x507b13(0x134)]),_0x3ef95e=Math[_0x507b13(0x144)](extensionHeader[_0x507b13(0x134)]/0x4)+0x1;return _0x401474[0x0]=version<<0x4|_0x3ef95e,_0x401474[0x1]=messageType<<0x4|messageTypeSpecificFlags,_0x401474[0x2]=serialMethod<<0x4|compressionType,_0x401474[0x3]=reservedData,_0x401474['set'](extensionHeader,0x4),_0x401474;}function generateFullDefaultHeader(){return generateHeader();}function _0x4f4a(_0x41e2da,_0x199c83){const _0x290e56=_0x290e();return _0x4f4a=function(_0x4f4ad1,_0x4c1144){_0x4f4ad1=_0x4f4ad1-0x11b;let _0x1dbc2f=_0x290e56[_0x4f4ad1];return _0x1dbc2f;},_0x4f4a(_0x41e2da,_0x199c83);}function generateAudioDefaultHeader(){return generateHeader({'messageType':CLIENT_AUDIO_ONLY_REQUEST});}function generateLastAudioDefaultHeader(){return generateHeader({'messageType':CLIENT_AUDIO_ONLY_REQUEST,'messageTypeSpecificFlags':NEG_SEQUENCE});}function parseResponse(_0x4f8a92){const _0x418a55=_0x4ee92c,_0x203643={},_0x3b656a=new Uint8Array(_0x4f8a92),_0x48d76f=_0x3b656a[0x0]>>0x4,_0x4fdac4=_0x3b656a[0x0]&0xf,_0xaced1c=_0x3b656a[0x1]>>0x4,_0x1edfc2=_0x3b656a[0x1]&0xf,_0x5a57ea=_0x3b656a[0x2]>>0x4,_0x18af02=_0x3b656a[0x2]&0xf,_0x25b876=_0x3b656a[0x3],_0x171f1a=_0x3b656a[_0x418a55(0x148)](0x4,_0x4fdac4*0x4),_0x174644=_0x3b656a[_0x418a55(0x148)](_0x4fdac4*0x4);let _0x1d76af=null,_0x42dafa=0x0;switch(_0xaced1c){case SERVER_FULL_RESPONSE:_0x42dafa=new DataView(_0x174644[_0x418a55(0x162)])[_0x418a55(0x12e)](0x0,![]),_0x1d76af=_0x174644[_0x418a55(0x148)](0x4);break;case SERVER_ACK:const _0xca38a=new DataView(_0x174644['buffer'])[_0x418a55(0x12e)](0x0,![]);_0x203643[_0x418a55(0x132)]=_0xca38a;_0x174644[_0x418a55(0x134)]>=0x8&&(_0x42dafa=new DataView(_0x174644[_0x418a55(0x162)])['getUint32'](0x4,![]),_0x1d76af=_0x174644[_0x418a55(0x148)](0x8));break;case SERVER_ERROR_RESPONSE:const _0xf644b5=new DataView(_0x174644[_0x418a55(0x162)])[_0x418a55(0x163)](0x0,![]);_0x203643[_0x418a55(0x14d)]=_0xf644b5;_0x174644[_0x418a55(0x134)]>=0x8&&(_0x42dafa=new DataView(_0x174644['buffer'])[_0x418a55(0x163)](0x4,![]),_0x1d76af=_0x174644[_0x418a55(0x148)](0x8));break;}if(_0x1d76af){if(_0x18af02===GZIP)try{_0x1d76af=(0x0,zlib_1[_0x418a55(0x126)])(_0x1d76af);}catch(_0x37a355){console['error'](_0x418a55(0x135),_0x37a355);}if(_0x5a57ea===JSON_SERIAL)try{_0x1d76af=JSON[_0x418a55(0x152)](new TextDecoder()[_0x418a55(0x127)](_0x1d76af));}catch(_0x4a1cbd){console[_0x418a55(0x168)](_0x418a55(0x143),_0x4a1cbd);}else _0x5a57ea!==NO_SERIALIZATION&&(_0x1d76af=new TextDecoder()[_0x418a55(0x127)](_0x1d76af));_0x203643[_0x418a55(0x13c)]=_0x1d76af,_0x203643[_0x418a55(0x16c)]=_0x42dafa;}return _0x203643;}const AudioType={'LOCAL':0x1};class AsrWsClient{constructor(_0x330d09,_0x241149,_0x179bd3={}){const _0x4499b8=_0x4ee92c;this['ws']=null,this['isReady']=null,this[_0x4499b8(0x13a)]=null,this[_0x4499b8(0x123)]=null,this[_0x4499b8(0x165)]=_0x330d09,this[_0x4499b8(0x141)]=_0x241149,this[_0x4499b8(0x15e)]=0x3e8,this[_0x4499b8(0x147)]=_0x179bd3['segDuration']||0x3a98,this['nbest']=_0x179bd3['nbest']||0x1,this[_0x4499b8(0x167)]=_0x179bd3[_0x4499b8(0x167)]||'',this[_0x4499b8(0x151)]=_0x179bd3[_0x4499b8(0x151)]||'',this[_0x4499b8(0x12d)]=_0x4499b8(0x14c),this[_0x4499b8(0x13d)]=_0x179bd3[_0x4499b8(0x13d)]||_0x4499b8(0x140),this[_0x4499b8(0x139)]=_0x179bd3[_0x4499b8(0x139)]||_0x4499b8(0x11b),this[_0x4499b8(0x16e)]=_0x179bd3['showLanguage']||![],this[_0x4499b8(0x14b)]=_0x179bd3[_0x4499b8(0x14b)]||![],this[_0x4499b8(0x142)]=_0x179bd3['resultType']||_0x4499b8(0x13f),this['format']=_0x179bd3[_0x4499b8(0x12c)]||_0x4499b8(0x11c),this[_0x4499b8(0x155)]=_0x179bd3['sampleRate']||0x3e80,this[_0x4499b8(0x15b)]=_0x179bd3['language']||_0x4499b8(0x122),this[_0x4499b8(0x129)]=_0x179bd3[_0x4499b8(0x129)]||0x10,this['channel']=_0x179bd3['channel']||0x1,this[_0x4499b8(0x149)]=_0x179bd3[_0x4499b8(0x149)]||_0x4499b8(0x130),this['audioType']=_0x179bd3[_0x4499b8(0x14e)]||AudioType['LOCAL'],this['secret']=_0x179bd3[_0x4499b8(0x169)]||_0x4499b8(0x13b),this[_0x4499b8(0x150)]=_0x179bd3[_0x4499b8(0x150)]||'token',this[_0x4499b8(0x164)]=_0x179bd3['mp3SegSize']||0x2710;}[_0x4ee92c(0x157)](_0x28191e){const _0x5e755f=_0x4ee92c;return{'app':{'appid':this[_0x5e755f(0x167)],'cluster':this[_0x5e755f(0x141)],'token':this['token']},'user':{'uid':this['uid']},'request':{'reqid':_0x28191e,'nbest':this['nbest'],'workflow':this['workflow'],'show_language':this['showLanguage'],'show_utterances':this[_0x5e755f(0x14b)],'result_type':this[_0x5e755f(0x142)],'sequence':0x1},'audio':{'format':this[_0x5e755f(0x12c)],'rate':this['rate'],'language':this[_0x5e755f(0x15b)],'bits':this[_0x5e755f(0x129)],'channel':this[_0x5e755f(0x14f)],'codec':this[_0x5e755f(0x149)]}};}*[_0x4ee92c(0x145)](_0x5ccdd3,_0x1cf632){const _0x197db4=_0x4ee92c,_0x3dc0c6=_0x5ccdd3[_0x197db4(0x136)];let _0x4d4e47=0x0;while(_0x4d4e47+_0x1cf632<_0x3dc0c6){yield{'chunk':_0x5ccdd3[_0x197db4(0x148)](_0x4d4e47,_0x4d4e47+_0x1cf632),'isLast':![]},_0x4d4e47+=_0x1cf632;}yield{'chunk':_0x5ccdd3[_0x197db4(0x148)](_0x4d4e47),'isLast':!![]};}[_0x4ee92c(0x124)](){const _0x2e778a=_0x4ee92c;return{'Authorization':_0x2e778a(0x128)+this[_0x2e778a(0x151)]};}['signatureAuth'](_0x5083ed){const _0x528f14=_0x4ee92c,_0x2183b0={'Custom':'auth_custom'},_0x655f12=new URL(this[_0x528f14(0x12d)]);let _0xb33e68='GET\x20'+_0x655f12[_0x528f14(0x16a)]+'\x20HTTP/1.1\x0a';const _0x394d65=_0x528f14(0x131);for(const _0x2dd35e of _0x394d65[_0x528f14(0x12f)](',')){_0xb33e68+=_0x2183b0[_0x2dd35e]+'\x0a';}const _0x11f611=Buffer['concat']([Buffer['from'](_0xb33e68,_0x528f14(0x166)),Buffer[_0x528f14(0x11e)](_0x5083ed)]),_0x6cf57c=(0x0,crypto_1[_0x528f14(0x159)])(_0x528f14(0x12a),this[_0x528f14(0x169)]);_0x6cf57c['update'](_0x11f611);const _0x2dd1ec=_0x6cf57c[_0x528f14(0x125)](_0x528f14(0x133));return _0x2183b0['Authorization']=_0x528f14(0x138)+this['token']+_0x528f14(0x15c)+_0x2dd1ec+_0x528f14(0x154)+_0x394d65+'\x22',_0x2183b0;}async['initConnection'](){const _0x2fb6c2=_0x4ee92c;if(this['ws']&&this[_0x2fb6c2(0x161)])return this[_0x2fb6c2(0x161)];this[_0x2fb6c2(0x13a)]=(0x0,uuid_1['v4'])();const _0x800cf5=this[_0x2fb6c2(0x157)](this[_0x2fb6c2(0x13a)]),_0x5ea37f=JSON[_0x2fb6c2(0x172)](_0x800cf5),_0xd0d10e=(0x0,zlib_1[_0x2fb6c2(0x171)])(_0x5ea37f),_0x4ad2bf=generateFullDefaultHeader(),_0x7b3c3a=new Uint8Array(0x4);new DataView(_0x7b3c3a[_0x2fb6c2(0x162)])[_0x2fb6c2(0x146)](0x0,_0xd0d10e[_0x2fb6c2(0x134)],![]);const _0x233290=Buffer['concat']([Buffer[_0x2fb6c2(0x11e)](_0x4ad2bf),Buffer[_0x2fb6c2(0x11e)](_0x7b3c3a),Buffer['from'](_0xd0d10e)]);let _0x131c39={};if(this['authMethod']===_0x2fb6c2(0x151))_0x131c39=this['tokenAuth']();else this[_0x2fb6c2(0x150)]===_0x2fb6c2(0x153)&&(_0x131c39=this[_0x2fb6c2(0x120)](_0x233290));return this[_0x2fb6c2(0x161)]=new Promise((_0x473685,_0x17ae2c)=>{const _0x42f956=_0x2fb6c2;this['ws']=new WebSocket(this[_0x42f956(0x12d)],{'headers':_0x131c39}),this['ws']['on'](_0x42f956(0x16b),()=>{const _0x5658d1=_0x42f956;this['ws'][_0x5658d1(0x11f)](_0x233290,_0x4d3fd3=>{if(_0x4d3fd3)_0x17ae2c(_0x4d3fd3);else _0x473685();});}),this['ws']['on']('error',_0x5d460e=>{_0x17ae2c(_0x5d460e);}),this['ws']['on'](_0x42f956(0x15d),_0x589244=>{const _0x1ff558=_0x42f956;if(this[_0x1ff558(0x123)]){const _0x43a6a7=parseResponse(_0x589244);this[_0x1ff558(0x123)](_0x43a6a7);}}),this['ws']['on']('close',()=>{const _0x43fce8=_0x42f956;this['ws']=null,this[_0x43fce8(0x161)]=null,this['reqid']=null;});}),this['isReady'];}async[_0x4ee92c(0x137)](_0x4fe9c0,_0x3de2b0){const _0x51c1ed=_0x4ee92c;if(!this['ws']||!this[_0x51c1ed(0x161)])throw new Error(_0x51c1ed(0x121));await this[_0x51c1ed(0x161)];const _0x596f08=(0x0,zlib_1[_0x51c1ed(0x171)])(_0x4fe9c0),_0x129689=_0x3de2b0?generateLastAudioDefaultHeader():generateAudioDefaultHeader(),_0x49f537=new Uint8Array(0x4);new DataView(_0x49f537[_0x51c1ed(0x162)])[_0x51c1ed(0x146)](0x0,_0x596f08['length'],![]);const _0x31bfb4=Buffer['concat']([Buffer[_0x51c1ed(0x11e)](_0x129689),Buffer[_0x51c1ed(0x11e)](_0x49f537),Buffer[_0x51c1ed(0x11e)](_0x596f08)]);return new Promise((_0x203e88,_0xc68678)=>{this['ws']['send'](_0x31bfb4,_0xf4a8c=>{if(_0xf4a8c)_0xc68678(_0xf4a8c);else _0x203e88();});});}[_0x4ee92c(0x156)](_0xed8026){const _0x341fbb=_0x4ee92c;this[_0x341fbb(0x123)]=_0xed8026;}[_0x4ee92c(0x170)](){const _0x402769=_0x4ee92c;this['ws']&&(this['ws']['close'](),this['ws']=null,this[_0x402769(0x161)]=null,this[_0x402769(0x13a)]=null,this['responseCallback']=null);}}exports[_0x4ee92c(0x16f)]=AsrWsClient;