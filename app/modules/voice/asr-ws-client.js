'use strict';const _0x12f7fd=_0x1e8c;(function(_0x24ef96,_0x183950){const _0x59c56e=_0x1e8c,_0x3bccbe=_0x24ef96();while(!![]){try{const _0x1c97bc=-parseInt(_0x59c56e(0x1c9))/0x1+parseInt(_0x59c56e(0x187))/0x2*(parseInt(_0x59c56e(0x1d2))/0x3)+parseInt(_0x59c56e(0x197))/0x4+-parseInt(_0x59c56e(0x18d))/0x5*(parseInt(_0x59c56e(0x18c))/0x6)+-parseInt(_0x59c56e(0x19f))/0x7+parseInt(_0x59c56e(0x1b2))/0x8+parseInt(_0x59c56e(0x18a))/0x9;if(_0x1c97bc===_0x183950)break;else _0x3bccbe['push'](_0x3bccbe['shift']());}catch(_0x1c2505){_0x3bccbe['push'](_0x3bccbe['shift']());}}}(_0x5b13,0xbde0d));function _0x5b13(){const _0x17666e=['auth_custom','JSON\x20parse\x20failed:','Authorization','zh-CN','crypto','4wDaQUc','length','appid','1775835SywMis','channel','2586zKMZQu','1205YwtNXy','segDuration','signature','uid','payloadSize','open','sendAudioChunk','split','parse','sampleRate','717556aEJIzo','workflow','authMethod','constructRequest','defineProperty','gunzipSync','setUint32','getUint32','5268284zNksgI','AsrWsClient','Connection\x20not\x20initialized.\x20Call\x20initConnection\x20first.','sha256','from','gzipSync','responseCallback','full','utf-8','streaming_asr_demo','cluster','successCode','stringify','__esModule','floor','close','raw','digest','byteLength','4455656ZSmZCP','pathname','secret','audioType','base64url','format','code','send','update','message','codec','\x22;\x20mac=\x22','GET\x20','payloadMsg','reqid','token','sliceData','language','uuid','createHmac','\x20HTTP/1.1\x0a','tokenAuth','wss://openspeech.bytedance.com/api/v2/asr','766955TryaMV','nbest','getInt32','set','Bearer;\x20','Custom','showLanguage','mp3SegSize','concat','2201277LjeKCU','zlib','decode','seq','wsUrl','error','bits','rate','subarray','HMAC256;\x20access_token=\x22','buffer','isReady','LOCAL','wav'];_0x5b13=function(){return _0x17666e;};return _0x5b13();}Object[_0x12f7fd(0x19b)](exports,_0x12f7fd(0x1ac),{'value':!![]}),exports[_0x12f7fd(0x1a0)]=void 0x0;const WebSocket=require('ws'),crypto_1=require(_0x12f7fd(0x186)),zlib_1=require(_0x12f7fd(0x1d3)),uuid_1=require(_0x12f7fd(0x1c4)),PROTOCOL_VERSION=0x1,CLIENT_FULL_REQUEST=0x1,CLIENT_AUDIO_ONLY_REQUEST=0x2,SERVER_FULL_RESPONSE=0x9,SERVER_ACK=0xb,SERVER_ERROR_RESPONSE=0xf,NO_SEQUENCE=0x0,POS_SEQUENCE=0x1,NEG_SEQUENCE=0x2,NO_SERIALIZATION=0x0,JSON_SERIAL=0x1,NO_COMPRESSION=0x0,GZIP=0x1;function generateHeader({version:version=PROTOCOL_VERSION,messageType:messageType=CLIENT_FULL_REQUEST,messageTypeSpecificFlags:messageTypeSpecificFlags=NO_SEQUENCE,serialMethod:serialMethod=JSON_SERIAL,compressionType:compressionType=GZIP,reservedData:reservedData=0x0,extensionHeader:extensionHeader=new Uint8Array()}={}){const _0x2011a3=_0x12f7fd,_0xf7485c=new Uint8Array(0x4+extensionHeader[_0x2011a3(0x188)]),_0x3c71e4=Math[_0x2011a3(0x1ad)](extensionHeader['length']/0x4)+0x1;return _0xf7485c[0x0]=version<<0x4|_0x3c71e4,_0xf7485c[0x1]=messageType<<0x4|messageTypeSpecificFlags,_0xf7485c[0x2]=serialMethod<<0x4|compressionType,_0xf7485c[0x3]=reservedData,_0xf7485c[_0x2011a3(0x1cc)](extensionHeader,0x4),_0xf7485c;}function _0x1e8c(_0x14cdf2,_0x3357aa){const _0x5b135f=_0x5b13();return _0x1e8c=function(_0x1e8c57,_0x5213c3){_0x1e8c57=_0x1e8c57-0x184;let _0x4fec43=_0x5b135f[_0x1e8c57];return _0x4fec43;},_0x1e8c(_0x14cdf2,_0x3357aa);}function generateFullDefaultHeader(){return generateHeader();}function generateAudioDefaultHeader(){return generateHeader({'messageType':CLIENT_AUDIO_ONLY_REQUEST});}function generateLastAudioDefaultHeader(){return generateHeader({'messageType':CLIENT_AUDIO_ONLY_REQUEST,'messageTypeSpecificFlags':NEG_SEQUENCE});}function parseResponse(_0x1113b6){const _0x56c5b0=_0x12f7fd,_0x830407={},_0x3123ce=new Uint8Array(_0x1113b6),_0x556c94=_0x3123ce[0x0]>>0x4,_0x37f805=_0x3123ce[0x0]&0xf,_0x38d39d=_0x3123ce[0x1]>>0x4,_0x2d9aae=_0x3123ce[0x1]&0xf,_0x591445=_0x3123ce[0x2]>>0x4,_0x5f1bd7=_0x3123ce[0x2]&0xf,_0x4549da=_0x3123ce[0x3],_0x1fe9da=_0x3123ce[_0x56c5b0(0x1da)](0x4,_0x37f805*0x4),_0x2677d6=_0x3123ce[_0x56c5b0(0x1da)](_0x37f805*0x4);let _0x537543=null,_0x245bdc=0x0;switch(_0x38d39d){case SERVER_FULL_RESPONSE:_0x245bdc=new DataView(_0x2677d6[_0x56c5b0(0x1dc)])[_0x56c5b0(0x1cb)](0x0,![]),_0x537543=_0x2677d6[_0x56c5b0(0x1da)](0x4);break;case SERVER_ACK:const _0x1d40ee=new DataView(_0x2677d6[_0x56c5b0(0x1dc)])[_0x56c5b0(0x1cb)](0x0,![]);_0x830407[_0x56c5b0(0x1d5)]=_0x1d40ee;_0x2677d6[_0x56c5b0(0x188)]>=0x8&&(_0x245bdc=new DataView(_0x2677d6['buffer'])[_0x56c5b0(0x19e)](0x4,![]),_0x537543=_0x2677d6[_0x56c5b0(0x1da)](0x8));break;case SERVER_ERROR_RESPONSE:const _0x416e01=new DataView(_0x2677d6[_0x56c5b0(0x1dc)])[_0x56c5b0(0x19e)](0x0,![]);_0x830407[_0x56c5b0(0x1b8)]=_0x416e01;_0x2677d6[_0x56c5b0(0x188)]>=0x8&&(_0x245bdc=new DataView(_0x2677d6[_0x56c5b0(0x1dc)])['getUint32'](0x4,![]),_0x537543=_0x2677d6[_0x56c5b0(0x1da)](0x8));break;}if(_0x537543){if(_0x5f1bd7===GZIP)try{_0x537543=(0x0,zlib_1[_0x56c5b0(0x19c)])(_0x537543);}catch(_0x5b55c8){console[_0x56c5b0(0x1d7)]('Gzip\x20decompression\x20failed:',_0x5b55c8);}if(_0x591445===JSON_SERIAL)try{_0x537543=JSON[_0x56c5b0(0x195)](new TextDecoder()[_0x56c5b0(0x1d4)](_0x537543));}catch(_0x20d3bc){console[_0x56c5b0(0x1d7)](_0x56c5b0(0x1e1),_0x20d3bc);}else _0x591445!==NO_SERIALIZATION&&(_0x537543=new TextDecoder()[_0x56c5b0(0x1d4)](_0x537543));_0x830407[_0x56c5b0(0x1bf)]=_0x537543,_0x830407[_0x56c5b0(0x191)]=_0x245bdc;}return _0x830407;}const AudioType={'LOCAL':0x1};class AsrWsClient{constructor(_0x3b297f,_0x1b61e6,_0x16fefe={}){const _0x100cd6=_0x12f7fd;this['ws']=null,this['isReady']=null,this[_0x100cd6(0x1c0)]=null,this[_0x100cd6(0x1a5)]=null,this['audioPath']=_0x3b297f,this[_0x100cd6(0x1a9)]=_0x1b61e6,this[_0x100cd6(0x1aa)]=0x3e8,this[_0x100cd6(0x18e)]=_0x16fefe['segDuration']||0x3a98,this[_0x100cd6(0x1ca)]=_0x16fefe[_0x100cd6(0x1ca)]||0x1,this['appid']=_0x16fefe[_0x100cd6(0x189)]||'',this[_0x100cd6(0x1c1)]=_0x16fefe[_0x100cd6(0x1c1)]||'',this[_0x100cd6(0x1d6)]=_0x100cd6(0x1c8),this['uid']=_0x16fefe[_0x100cd6(0x190)]||_0x100cd6(0x1a8),this['workflow']=_0x16fefe[_0x100cd6(0x198)]||'audio_in,resample,partition,vad,fe,decode,itn,nlu_punctuate',this[_0x100cd6(0x1cf)]=_0x16fefe[_0x100cd6(0x1cf)]||![],this['showUtterances']=_0x16fefe['showUtterances']||![],this['resultType']=_0x16fefe['resultType']||_0x100cd6(0x1a6),this[_0x100cd6(0x1b7)]=_0x16fefe[_0x100cd6(0x1b7)]||_0x100cd6(0x1df),this[_0x100cd6(0x1d9)]=_0x16fefe[_0x100cd6(0x196)]||0x3e80,this['language']=_0x16fefe[_0x100cd6(0x1c3)]||_0x100cd6(0x185),this[_0x100cd6(0x1d8)]=_0x16fefe[_0x100cd6(0x1d8)]||0x10,this[_0x100cd6(0x18b)]=_0x16fefe[_0x100cd6(0x18b)]||0x1,this[_0x100cd6(0x1bc)]=_0x16fefe[_0x100cd6(0x1bc)]||_0x100cd6(0x1af),this[_0x100cd6(0x1b5)]=_0x16fefe[_0x100cd6(0x1b5)]||AudioType[_0x100cd6(0x1de)],this[_0x100cd6(0x1b4)]=_0x16fefe[_0x100cd6(0x1b4)]||'access_secret',this[_0x100cd6(0x199)]=_0x16fefe[_0x100cd6(0x199)]||_0x100cd6(0x1c1),this[_0x100cd6(0x1d0)]=_0x16fefe[_0x100cd6(0x1d0)]||0x2710;}[_0x12f7fd(0x19a)](_0x3bde4f){const _0x3938b9=_0x12f7fd;return{'app':{'appid':this[_0x3938b9(0x189)],'cluster':this[_0x3938b9(0x1a9)],'token':this[_0x3938b9(0x1c1)]},'user':{'uid':this[_0x3938b9(0x190)]},'request':{'reqid':_0x3bde4f,'nbest':this['nbest'],'workflow':this[_0x3938b9(0x198)],'show_language':this[_0x3938b9(0x1cf)],'show_utterances':this['showUtterances'],'result_type':this['resultType'],'sequence':0x1},'audio':{'format':this['format'],'rate':this['rate'],'language':this[_0x3938b9(0x1c3)],'bits':this[_0x3938b9(0x1d8)],'channel':this[_0x3938b9(0x18b)],'codec':this[_0x3938b9(0x1bc)]}};}*[_0x12f7fd(0x1c2)](_0x148850,_0x26f97a){const _0x56ce1e=_0x12f7fd,_0x4b109a=_0x148850[_0x56ce1e(0x1b1)];let _0x5479b6=0x0;while(_0x5479b6+_0x26f97a<_0x4b109a){yield{'chunk':_0x148850[_0x56ce1e(0x1da)](_0x5479b6,_0x5479b6+_0x26f97a),'isLast':![]},_0x5479b6+=_0x26f97a;}yield{'chunk':_0x148850[_0x56ce1e(0x1da)](_0x5479b6),'isLast':!![]};}[_0x12f7fd(0x1c7)](){const _0x265670=_0x12f7fd;return{'Authorization':_0x265670(0x1cd)+this['token']};}['signatureAuth'](_0x5eebcf){const _0x129c33=_0x12f7fd,_0x412ded={'Custom':_0x129c33(0x1e0)},_0x481182=new URL(this[_0x129c33(0x1d6)]);let _0x1aa778=_0x129c33(0x1be)+_0x481182[_0x129c33(0x1b3)]+_0x129c33(0x1c6);const _0x2e3794=_0x129c33(0x1ce);for(const _0x321a25 of _0x2e3794[_0x129c33(0x194)](',')){_0x1aa778+=_0x412ded[_0x321a25]+'\x0a';}const _0x558442=Buffer['concat']([Buffer[_0x129c33(0x1a3)](_0x1aa778,_0x129c33(0x1a7)),Buffer[_0x129c33(0x1a3)](_0x5eebcf)]),_0x2542db=(0x0,crypto_1[_0x129c33(0x1c5)])(_0x129c33(0x1a2),this['secret']);_0x2542db[_0x129c33(0x1ba)](_0x558442);const _0x36ec6a=_0x2542db[_0x129c33(0x1b0)](_0x129c33(0x1b6));return _0x412ded[_0x129c33(0x184)]=_0x129c33(0x1db)+this[_0x129c33(0x1c1)]+_0x129c33(0x1bd)+_0x36ec6a+'\x22;\x20h=\x22'+_0x2e3794+'\x22',_0x412ded;}async['initConnection'](){const _0x59f6dc=_0x12f7fd;if(this['ws']&&this[_0x59f6dc(0x1dd)])return this['isReady'];this[_0x59f6dc(0x1c0)]=(0x0,uuid_1['v4'])();const _0x572a54=this[_0x59f6dc(0x19a)](this[_0x59f6dc(0x1c0)]),_0x3d557a=JSON[_0x59f6dc(0x1ab)](_0x572a54),_0x27aa24=(0x0,zlib_1[_0x59f6dc(0x1a4)])(_0x3d557a),_0x5e32e1=generateFullDefaultHeader(),_0x93a029=new Uint8Array(0x4);new DataView(_0x93a029[_0x59f6dc(0x1dc)])['setUint32'](0x0,_0x27aa24[_0x59f6dc(0x188)],![]);const _0xe01dfd=Buffer['concat']([Buffer[_0x59f6dc(0x1a3)](_0x5e32e1),Buffer[_0x59f6dc(0x1a3)](_0x93a029),Buffer[_0x59f6dc(0x1a3)](_0x27aa24)]);let _0x3ac19b={};if(this[_0x59f6dc(0x199)]==='token')_0x3ac19b=this[_0x59f6dc(0x1c7)]();else this[_0x59f6dc(0x199)]===_0x59f6dc(0x18f)&&(_0x3ac19b=this['signatureAuth'](_0xe01dfd));return this[_0x59f6dc(0x1dd)]=new Promise((_0x2f1916,_0x11c88a)=>{const _0x29d76f=_0x59f6dc;this['ws']=new WebSocket(this['wsUrl'],{'headers':_0x3ac19b}),this['ws']['on'](_0x29d76f(0x192),()=>{const _0x4c5d1e=_0x29d76f;this['ws'][_0x4c5d1e(0x1b9)](_0xe01dfd,_0x15b74a=>{if(_0x15b74a)_0x11c88a(_0x15b74a);else _0x2f1916();});}),this['ws']['on']('error',_0x3e5628=>{_0x11c88a(_0x3e5628);}),this['ws']['on'](_0x29d76f(0x1bb),_0x1cf6eb=>{const _0xfef7a4=_0x29d76f;if(this[_0xfef7a4(0x1a5)]){const _0x38b229=parseResponse(_0x1cf6eb);this[_0xfef7a4(0x1a5)](_0x38b229);}}),this['ws']['on']('close',()=>{const _0x2192ca=_0x29d76f;this['ws']=null,this[_0x2192ca(0x1dd)]=null,this[_0x2192ca(0x1c0)]=null;});}),this[_0x59f6dc(0x1dd)];}async[_0x12f7fd(0x193)](_0x2fa0fe,_0x546955){const _0x5c998a=_0x12f7fd;if(!this['ws']||!this['isReady'])throw new Error(_0x5c998a(0x1a1));await this[_0x5c998a(0x1dd)];const _0xbd870=(0x0,zlib_1[_0x5c998a(0x1a4)])(_0x2fa0fe),_0x28112e=_0x546955?generateLastAudioDefaultHeader():generateAudioDefaultHeader(),_0x58f2e8=new Uint8Array(0x4);new DataView(_0x58f2e8['buffer'])[_0x5c998a(0x19d)](0x0,_0xbd870[_0x5c998a(0x188)],![]);const _0x4e864d=Buffer[_0x5c998a(0x1d1)]([Buffer['from'](_0x28112e),Buffer[_0x5c998a(0x1a3)](_0x58f2e8),Buffer['from'](_0xbd870)]);return new Promise((_0x327fc3,_0x4bb5cd)=>{this['ws']['send'](_0x4e864d,_0x4fb3dc=>{if(_0x4fb3dc)_0x4bb5cd(_0x4fb3dc);else _0x327fc3();});});}['onResponse'](_0x45f0da){const _0x2f8734=_0x12f7fd;this[_0x2f8734(0x1a5)]=_0x45f0da;}['close'](){const _0x568cfa=_0x12f7fd;this['ws']&&(this['ws'][_0x568cfa(0x1ae)](),this['ws']=null,this[_0x568cfa(0x1dd)]=null,this[_0x568cfa(0x1c0)]=null,this[_0x568cfa(0x1a5)]=null);}}exports[_0x12f7fd(0x1a0)]=AsrWsClient;