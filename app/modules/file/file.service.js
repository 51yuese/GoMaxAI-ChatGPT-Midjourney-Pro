'use strict';const _0x5bd7e2=_0x2f3d;(function(_0x4270e8,_0x1269bb){const _0x48f26d=_0x2f3d,_0x35e092=_0x4270e8();while(!![]){try{const _0x2b2064=parseInt(_0x48f26d(0xe5))/0x1*(-parseInt(_0x48f26d(0xd4))/0x2)+-parseInt(_0x48f26d(0xe0))/0x3*(parseInt(_0x48f26d(0xd0))/0x4)+-parseInt(_0x48f26d(0xeb))/0x5*(parseInt(_0x48f26d(0xc0))/0x6)+-parseInt(_0x48f26d(0x113))/0x7*(parseInt(_0x48f26d(0xa7))/0x8)+-parseInt(_0x48f26d(0x102))/0x9+parseInt(_0x48f26d(0x110))/0xa*(parseInt(_0x48f26d(0xac))/0xb)+parseInt(_0x48f26d(0x104))/0xc;if(_0x2b2064===_0x1269bb)break;else _0x35e092['push'](_0x35e092['shift']());}catch(_0x4c6dbb){_0x35e092['push'](_0x35e092['shift']());}}}(_0x2b55,0x53f99));function _0x2b55(){const _0x57823c=['createRandomUid','upload','getOwnPropertyDescriptor','ali-oss','.png','replace','tencentCos','FileService','http','transferImg','fs/promises','任务原始图片获取失败','aliCos','data:image/jpeg;base64,','globalConfigService','originTaskId','上传图片失败[ali]','aliOssAccessKeyId','InjectRepository','arraybuffer','Logger','defineProperty','aliOssAccessKeySecret','post','headers','../../common/constants/redisKey.constant','8feOndS','downFile','transferAndCover\x20error:\x20','toString','redisCacheService','11uWHEqa','../../common/store','axios','transferFile','query','putObject','\x0a\x20\x20\x20\x20\x20\x20','metadata','MJ_IMG_TRANSFER','del','getUploadConfig','response','uploadFileByTencentCos','RedisCacheService','cosRegion','append','message','getConfigByKeys','../../common/utils','https://','24zpdWUo','env','STANDARD','cosBucket','decorate','findOne','\x0a\x20\x20\x20\x20\x20\x20\x20\x20ffmpeg\x20-i\x20','aliOssStatus','join','child_process','MjConfig','chevereto','__esModule','application/json;charset=UTF-8','mkdirSync','BAD_REQUEST','36WMlWoa','webroot','\x20-y\x20-f\x20image2\x20-ss\x202\x20-frames:v\x201\x20-update\x20true\x20','https://$2','14JuQzXQ','tencent','save','aliOssBucket','image','mjNotSaveImg','mj-','default','cosSecretKey','../globalConfig/globalConfig.service','data','上传图片失败[Chevereto|buffer]\x20-->\x20','172167xrerMO','length','error:\x20','HttpStatus','../redisCache/redisCache.service','90580XqoWOe','ali','cheveretoKey','log','rmSync','__param','318610eRgehW','split','getModalImgById','imageUrl','MidjourneyEntity','uploadFileByAliOss','binary','tencentCosStatus','removeSpecialCharacters','上传图片失败[ten]','path','function','key','HttpException','需要转存到云','pop','source','error','url','existsSync','uploadFileByLocal','midjourneyEntity','jpg','2667519CYAEpm','Location','16964292BxjGwB','GOMAXAI_HOST','cos-nodejs-sdk-v5','cwd','@nestjs/typeorm','cheveretoStatus','base64','content-type','uploadFile','transferAndCover','image-size','getCover','6351910meswwm','design:paramtypes','writeHead','21567xYVhiQ','ali\x20开始上传','get','uploadFileByChevereto','.mp4','请先前往后台配置上传图片的方式','lock','上传图片失败[Chevereto]'];_0x2b55=function(){return _0x57823c;};return _0x2b55();}var __decorate=this&&this['__decorate']||function(_0x405f88,_0x59a923,_0x3b20e9,_0x1677c9){const _0x4fc002=_0x2f3d;var _0x6d5f46=arguments[_0x4fc002(0xe1)],_0x1b2fa4=_0x6d5f46<0x3?_0x59a923:_0x1677c9===null?_0x1677c9=Object[_0x4fc002(0x8f)](_0x59a923,_0x3b20e9):_0x1677c9,_0x1eba61;if(typeof Reflect==='object'&&typeof Reflect[_0x4fc002(0xc4)]===_0x4fc002(0xf6))_0x1b2fa4=Reflect[_0x4fc002(0xc4)](_0x405f88,_0x59a923,_0x3b20e9,_0x1677c9);else{for(var _0x498aee=_0x405f88['length']-0x1;_0x498aee>=0x0;_0x498aee--)if(_0x1eba61=_0x405f88[_0x498aee])_0x1b2fa4=(_0x6d5f46<0x3?_0x1eba61(_0x1b2fa4):_0x6d5f46>0x3?_0x1eba61(_0x59a923,_0x3b20e9,_0x1b2fa4):_0x1eba61(_0x59a923,_0x3b20e9))||_0x1b2fa4;}return _0x6d5f46>0x3&&_0x1b2fa4&&Object[_0x4fc002(0xa2)](_0x59a923,_0x3b20e9,_0x1b2fa4),_0x1b2fa4;},__metadata=this&&this['__metadata']||function(_0x13bf7a,_0x4be9ac){const _0x330740=_0x2f3d;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x330740(0xf6))return Reflect[_0x330740(0xb3)](_0x13bf7a,_0x4be9ac);},__param=this&&this[_0x5bd7e2(0xea)]||function(_0x2427b9,_0x4b8fbf){return function(_0x4380dd,_0x1f44bd){_0x4b8fbf(_0x4380dd,_0x1f44bd,_0x2427b9);};};Object[_0x5bd7e2(0xa2)](exports,_0x5bd7e2(0xcc),{'value':!![]}),exports['FileService']=void 0x0;const common_1=require('@nestjs/common'),TENCENTCOS=require(_0x5bd7e2(0x106)),ALIOSS=require(_0x5bd7e2(0x90)),axios_1=require(_0x5bd7e2(0xae)),image_size_1=require(_0x5bd7e2(0x10e)),utils_1=require(_0x5bd7e2(0xbe)),globalConfig_service_1=require(_0x5bd7e2(0xdd)),FormData=require('form-data'),midjourney_entity_1=require('../midjourney/midjourney.entity'),typeorm_1=require(_0x5bd7e2(0x108)),typeorm_2=require('typeorm'),redisKey_constant_1=require(_0x5bd7e2(0xa6)),redisCache_service_1=require(_0x5bd7e2(0xe4)),store_1=require(_0x5bd7e2(0xad)),path_1=require(_0x5bd7e2(0xf5)),promises_1=require(_0x5bd7e2(0x97)),fs_1=require('fs'),child_process_1=require(_0x5bd7e2(0xc9));function _0x2f3d(_0x520599,_0x3378b7){const _0x2b5530=_0x2b55();return _0x2f3d=function(_0x2f3dab,_0x1a14e3){_0x2f3dab=_0x2f3dab-0x8b;let _0x17287f=_0x2b5530[_0x2f3dab];return _0x17287f;},_0x2f3d(_0x520599,_0x3378b7);}let FileService=class FileService{constructor(_0x3f7bc5,_0x6840b9,_0x27eb58){const _0xf52e20=_0x5bd7e2;this[_0xf52e20(0x100)]=_0x3f7bc5,this[_0xf52e20(0x9b)]=_0x6840b9,this['redisCacheService']=_0x27eb58;}async['onModuleInit'](){const _0x285ebb=_0x5bd7e2,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService']['getConfigByKeys']([_0x285ebb(0xf2),_0x285ebb(0xc7),_0x285ebb(0x109)]);!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus)&&common_1['Logger'][_0x285ebb(0xfc)](_0x285ebb(0x118));if(Number(tencentCosStatus)===0x1){const {SecretId:_0xac9971,SecretKey:_0x3be4ae}=await this[_0x285ebb(0xb6)](_0x285ebb(0xd5));this['tencentCos']=new TENCENTCOS({'SecretId':_0xac9971,'SecretKey':_0x3be4ae,'FileParallelLimit':0xa});}if(Number(aliOssStatus)===0x1){const {region:_0x1359bd,bucket:_0x541a53,accessKeyId:_0x51af12,accessKeySecret:_0x30f48b}=await this['getUploadConfig'](_0x285ebb(0xe6));this['aliCos']=new ALIOSS({'region':(0x0,utils_1['removeSpecialCharacters'])(_0x1359bd),'accessKeyId':_0x51af12,'accessKeySecret':_0x30f48b,'bucket':(0x0,utils_1[_0x285ebb(0xf3)])(_0x541a53)});}}async['getUploadConfig'](_0x2ae4cc){const _0x3aeafa=_0x5bd7e2;if(_0x2ae4cc==='ali'){const {aliOssRegion:_0x1bc782,aliOssBucket:_0xd07193,aliOssAccessKeyId:_0x3a637b,aliOssAccessKeySecret:_0x23c76d}=await this[_0x3aeafa(0x9b)][_0x3aeafa(0xbd)](['aliOssRegion',_0x3aeafa(0xd7),_0x3aeafa(0x9e),_0x3aeafa(0xa3)]);return{'region':_0x1bc782,'bucket':_0xd07193,'accessKeyId':_0x3a637b,'accessKeySecret':_0x23c76d};}if(_0x2ae4cc===_0x3aeafa(0xd5)){const {cosBucket:_0x29baad,cosRegion:_0x1b4575,cosSecretId:_0x477b0b,cosSecretKey:_0x5f1f09,tencentCosAcceleratedDomain:_0x125d78}=await this[_0x3aeafa(0x9b)][_0x3aeafa(0xbd)]([_0x3aeafa(0xc3),_0x3aeafa(0xba),'cosSecretId',_0x3aeafa(0xdc),'tencentCosAcceleratedDomain']);return{'Bucket':_0x29baad,'Region':_0x1b4575,'SecretId':_0x477b0b,'SecretKey':_0x5f1f09,'acceleratedDomain':_0x125d78};}if(_0x2ae4cc===_0x3aeafa(0xcb)){const {cheveretoKey:_0x101699,cheveretoUploadPath:_0x2f2e9e}=await this['globalConfigService'][_0x3aeafa(0xbd)]([_0x3aeafa(0xe7),'cheveretoUploadPath']);return{'key':_0x101699,'uploadPath':_0x2f2e9e};}}async[_0x5bd7e2(0x10c)](_0x5176b7){const _0x4bf661=_0x5bd7e2,{filename:_0x113c79,buffer:_0x419f7a,dir:dir='ai'}=_0x5176b7,{aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x4bf661(0x9b)]['getConfigByKeys']([_0x4bf661(0xf2),'aliOssStatus',_0x4bf661(0x109)]);if(Number(tencentCosStatus)===0x1)return this[_0x4bf661(0xb8)]({'filename':_0x113c79,'buffer':_0x419f7a,'dir':dir});if(Number(aliOssStatus)===0x1)return this[_0x4bf661(0xf0)]({'filename':_0x113c79,'buffer':_0x419f7a,'dir':dir});if(Number(cheveretoStatus)){const {filename:_0x54c3da,buffer:_0x58da4e,dir:_0x145f24}=_0x5176b7;return this[_0x4bf661(0x116)]({'filename':_0x54c3da,'buffer':_0x58da4e[_0x4bf661(0xaa)](_0x4bf661(0x10a)),'dir':_0x145f24});}const [_0x983f7d,_0x10539e]=await this[_0x4bf661(0xff)]({'filename':_0x113c79,'buffer':_0x419f7a,'dir':dir});return _0x983f7d;}async['upload2Local'](_0x589a1c){const _0x1c84f1=_0x5bd7e2,{filename:_0x1dc33e,buffer:_0x45c08b,dir:dir='ai'}=_0x589a1c,[_0x15c28c,_0x558ebf]=await this[_0x1c84f1(0xff)]({'filename':_0x1dc33e,'buffer':_0x45c08b,'dir':dir});return _0x15c28c;}async[_0x5bd7e2(0xb8)]({filename:_0xa8412c,buffer:_0x40cc73,dir:_0x2e0de9}){const _0x1043f3=_0x5bd7e2;try{const {Bucket:_0x43a6e3,Region:_0x3c9499,SecretId:_0x3a31ae,SecretKey:_0x34f160}=await this[_0x1043f3(0xb6)](_0x1043f3(0xd5));!this[_0x1043f3(0x93)]&&(this[_0x1043f3(0x93)]=new TENCENTCOS({'SecretId':_0x3a31ae,'SecretKey':_0x34f160,'FileParallelLimit':0xa}));const _0x5882a8=await this['tencentCos'][_0x1043f3(0xb1)]({'Bucket':(0x0,utils_1[_0x1043f3(0xf3)])(_0x43a6e3),'Region':(0x0,utils_1['removeSpecialCharacters'])(_0x3c9499),'Key':_0x2e0de9+'/'+(_0xa8412c||(0x0,utils_1['createRandomUid'])()+_0x1043f3(0x91)),'StorageClass':_0x1043f3(0xc2),'Body':_0x40cc73});let _0x540a55=_0x5882a8[_0x1043f3(0x103)]['replace'](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x1043f3(0xd3));const {acceleratedDomain:_0x1db0be}=await this['getUploadConfig'](_0x1043f3(0xd5));return _0x1db0be&&(_0x540a55=_0x540a55['replace'](/^(https:\/\/[^/]+)(\/.*)$/,_0x1043f3(0xbf)+_0x1db0be+'$2'),console[_0x1043f3(0xe8)]('当前已开启全球加速----------------->',_0x540a55)),_0x540a55;}catch(_0x4a084c){console[_0x1043f3(0xe8)](_0x1043f3(0xe2),_0x4a084c);throw new common_1[(_0x1043f3(0xf8))](_0x1043f3(0xf4),common_1[_0x1043f3(0xe3)][_0x1043f3(0xcf)]);}}async[_0x5bd7e2(0xf0)]({filename:_0x57b7ca,buffer:_0x3bbd4c,dir:_0x5abf52}){const _0x3216e2=_0x5bd7e2;if(!this[_0x3216e2(0x99)]){const {region:_0x3ba8b6,bucket:_0x3ca8b7,accessKeyId:_0x22a374,accessKeySecret:_0x196030}=await this[_0x3216e2(0xb6)]('ali');this[_0x3216e2(0x99)]=new ALIOSS({'region':(0x0,utils_1['removeSpecialCharacters'])(_0x3ba8b6),'accessKeyId':_0x22a374,'accessKeySecret':_0x196030,'bucket':(0x0,utils_1[_0x3216e2(0xf3)])(_0x3ca8b7)});}try{console['log'](_0x3216e2(0x114));const _0x447d1e=await this[_0x3216e2(0x99)]['put'](_0x5abf52+'/'+(_0x57b7ca||(0x0,utils_1[_0x3216e2(0x8d)])()+_0x3216e2(0x91)),_0x3bbd4c);return _0x447d1e[_0x3216e2(0xfd)];}catch(_0x143415){throw new common_1['HttpException'](_0x3216e2(0x9d),common_1[_0x3216e2(0xe3)][_0x3216e2(0xcf)]);}}async[_0x5bd7e2(0x116)]({filename:filename='',buffer:_0x3f14bd,dir:dir='ai'}){const _0x495747=_0x5bd7e2,{key:_0x31cdb0,uploadPath:_0x58657e}=await this[_0x495747(0xb6)](_0x495747(0xcb)),_0x334821=new FormData();_0x334821[_0x495747(0xbb)](_0x495747(0xfb),_0x3f14bd['toString'](_0x495747(0x10a))),_0x334821[_0x495747(0xbb)](_0x495747(0xf7),_0x31cdb0);try{const _0x3b42a8=await axios_1['default'][_0x495747(0xa4)](_0x58657e,_0x334821,{'headers':{'X-API-Key':_0x31cdb0},'timeout':0xa*0x3c*0x3e8});if(_0x3b42a8?.['status']===0xc8)return _0x3b42a8[_0x495747(0xde)][_0x495747(0xd8)][_0x495747(0xfd)];else{common_1[_0x495747(0xa1)]['error']('上传图片失败[Chevereto]',JSON['stringify'](_0x3b42a8[_0x495747(0xde)]));throw new Error(_0x495747(0x8c));}}catch(_0x42239c){console['log'](_0x495747(0xe2),_0x42239c[_0x495747(0xb7)]);throw new common_1[(_0x495747(0xf8))](_0x495747(0xdf)+_0x42239c[_0x495747(0xb7)]?.[_0x495747(0xde)][_0x495747(0xfc)][_0x495747(0xbc)],common_1[_0x495747(0xe3)][_0x495747(0xcf)]);}}async[_0x5bd7e2(0xff)]({filename:_0x511f3c,buffer:_0x4e0c9d,dir:_0x1f7e23}){const _0x598fb8=_0x5bd7e2;let _0x2b90a=(0x0,path_1[_0x598fb8(0xc8)])(process[_0x598fb8(0x107)](),_0x598fb8(0xd1),_0x598fb8(0x8e)),_0x66643c='/upload',_0x339a8c='';_0x1f7e23&&(_0x2b90a=(0x0,path_1[_0x598fb8(0xc8)])(_0x2b90a,_0x1f7e23),_0x66643c='/upload/'+_0x1f7e23);_0x66643c=_0x66643c+'/'+_0x511f3c;!(0x0,fs_1[_0x598fb8(0xfe)])(_0x2b90a)&&(0x0,fs_1[_0x598fb8(0xce)])(_0x2b90a,{'recursive':!![]});_0x2b90a=(0x0,path_1[_0x598fb8(0xc8)])(_0x2b90a,_0x511f3c),await(0x0,promises_1['writeFile'])(_0x2b90a,_0x4e0c9d);let _0x3ca27a=process[_0x598fb8(0xc1)][_0x598fb8(0x105)];return _0x3ca27a['startsWith'](_0x598fb8(0x95))?_0x339a8c=_0x3ca27a+_0x66643c:_0x339a8c=_0x598fb8(0xbf)+_0x3ca27a+_0x66643c,[_0x339a8c,_0x2b90a];}async[_0x5bd7e2(0xa8)](_0x38fc69,_0x57b7af,_0x4a254a){const _0x213776=_0x5bd7e2;try{const _0x2eea0a=_0x38fc69[_0x213776(0xec)]('/')['pop'](),_0x95913=await(0x0,axios_1['default'])(_0x38fc69,{'headers':{'Content-Type':_0x213776(0xcd)},'responseType':'arraybuffer','timeout':0x493e0});_0x4a254a[_0x213776(0x112)](0xc8,{'Content-Type':_0x95913[_0x213776(0xa5)][_0x213776(0x10b)],'Content-Disposition':_0x2eea0a}),_0x4a254a['end'](_0x95913[_0x213776(0xde)],_0x213776(0xf1));}catch(_0x1eb4ff){throw new common_1[(_0x213776(0xf8))](_0x1eb4ff['message'],common_1[_0x213776(0xe3)][_0x213776(0xcf)]);}}async[_0x5bd7e2(0xed)](_0x5ae8df){const _0x28eb47=_0x5bd7e2;try{const _0x5d7fc1=await this[_0x28eb47(0x100)]['findOne']({'where':{'id':Number(_0x5ae8df[_0x28eb47(0xb0)]['taskId'])}});let _0x1e5e04;if(_0x5d7fc1[_0x28eb47(0xee)])_0x1e5e04=_0x5d7fc1[_0x28eb47(0xee)];else{const _0x2e7784=await this[_0x28eb47(0x100)][_0x28eb47(0xc5)]({'where':{'id':Number(_0x5d7fc1[_0x28eb47(0x9c)])}});_0x1e5e04=_0x2e7784['imageUrl'];}if(!_0x1e5e04)throw new Error(_0x28eb47(0x98));const _0x240cb1=await axios_1[_0x28eb47(0xdb)][_0x28eb47(0x115)](_0x1e5e04,{'responseType':_0x28eb47(0xa0)}),_0x176520=Buffer['from'](_0x240cb1[_0x28eb47(0xde)])[_0x28eb47(0xaa)](_0x28eb47(0x10a));return _0x28eb47(0x9a)+_0x176520;}catch(_0xfaa499){throw new common_1[(_0x28eb47(0xf8))](_0xfaa499[_0x28eb47(0xbc)],common_1[_0x28eb47(0xe3)][_0x28eb47(0xcf)]);}}async[_0x5bd7e2(0xaf)](_0x445205){const _0x4bf978=_0x5bd7e2;try{const _0x408eb2=await axios_1[_0x4bf978(0xdb)][_0x4bf978(0x115)](_0x445205,{'responseType':'arraybuffer'}),_0xa65765=_0x445205[_0x4bf978(0xec)]('/')[_0x4bf978(0xfa)]()['split']('?')[0x0],_0x1b101c=await this[_0x4bf978(0x10c)]({'filename':_0xa65765,'buffer':_0x408eb2['data']});return _0x1b101c;}catch(_0x164eb0){return common_1[_0x4bf978(0xa1)][_0x4bf978(0xfc)]('transferFile\x20error:\x20',_0x164eb0),null;}}async['getCover'](_0x370213){return new Promise((_0x54ef31,_0x2058e5)=>{const _0x3f4cd7=_0x2f3d,_0x40f0e7=_0x370213[_0x3f4cd7(0x92)](_0x3f4cd7(0x117),'.jpg');(0x0,child_process_1['exec'])(_0x3f4cd7(0xc6)+_0x370213+_0x3f4cd7(0xd2)+_0x40f0e7+_0x3f4cd7(0xb2),function(_0x1d0edf,_0x3e6a83,_0x363836){const _0x4268d3=_0x3f4cd7;_0x1d0edf?(console[_0x4268d3(0xe8)](_0x363836),_0x2058e5(_0x1d0edf)):_0x54ef31(_0x40f0e7);});});}async[_0x5bd7e2(0x10d)](_0x4b8efa){const _0xb5070b=_0x5bd7e2;let _0x478eff=null,_0x5f2a08=null;try{const _0x5ee6a1=await axios_1[_0xb5070b(0xdb)][_0xb5070b(0x115)](_0x4b8efa,{'responseType':_0xb5070b(0xa0)}),_0x5c4437=_0x4b8efa[_0xb5070b(0xec)]('/')[_0xb5070b(0xfa)](),[_0x260026,_0x189a84]=await this[_0xb5070b(0xff)]({'filename':_0x5c4437,'buffer':_0x5ee6a1[_0xb5070b(0xde)],'dir':'ai'}),_0x3421d8=await this[_0xb5070b(0x10f)](_0x189a84);let {aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0xb5070b(0x9b)][_0xb5070b(0xbd)]([_0xb5070b(0xf2),'aliOssStatus',_0xb5070b(0x109)]);aliOssStatus=Number(aliOssStatus),cheveretoStatus=Number(cheveretoStatus),tencentCosStatus=Number(tencentCosStatus);if(aliOssStatus||cheveretoStatus||tencentCosStatus){console[_0xb5070b(0xe8)](_0xb5070b(0xf9)),_0x478eff=await this[_0xb5070b(0x10c)]({'filename':_0x5c4437,'buffer':_0x5ee6a1[_0xb5070b(0xde)]});const _0x8ed78e=(0x0,fs_1['readFileSync'])(_0x3421d8);_0x5f2a08=await this[_0xb5070b(0x10c)]({'filename':_0x5c4437[_0xb5070b(0x92)](/mp4$/,_0xb5070b(0x101)),'buffer':_0x8ed78e}),(0x0,fs_1[_0xb5070b(0xe9)])(_0x189a84),(0x0,fs_1[_0xb5070b(0xe9)])(_0x3421d8);}else _0x478eff=_0x260026,_0x5f2a08=_0x260026[_0xb5070b(0x92)](_0xb5070b(0x117),'.jpg');return[_0x478eff,_0x5f2a08];}catch(_0x1d8f1f){return common_1['Logger'][_0xb5070b(0xfc)](_0xb5070b(0xa9),_0x1d8f1f),[null,null];}}async[_0x5bd7e2(0x96)](_0x19aae0,_0x7cf729){const _0x4fc582=_0x5bd7e2,_0xc2078c=redisKey_constant_1[_0x4fc582(0xb4)]+_0x19aae0;try{const _0x39102c=await this[_0x4fc582(0xab)]['get']({'key':_0xc2078c});if(_0x39102c)return;this[_0x4fc582(0xab)]['set']({'key':_0xc2078c,'val':_0x4fc582(0x8b)});const _0x5a003b=await axios_1['default']['get'](_0x7cf729,{'responseType':_0x4fc582(0xa0)}),{width:_0x16bd15,height:_0x2d90a4}=await(0x0,image_size_1[_0x4fc582(0xdb)])(_0x5a003b[_0x4fc582(0xde)]);!store_1[_0x4fc582(0xca)][_0x4fc582(0xd9)]&&(_0x7cf729=await this['uploadFile']({'filename':_0x4fc582(0xda)+_0x19aae0+_0x4fc582(0x91),'buffer':_0x5a003b[_0x4fc582(0xde)]})),await this[_0x4fc582(0x100)][_0x4fc582(0xd6)]({'id':_0x19aae0,'imageUrl':_0x7cf729,'fileInfo':JSON['stringify']({'width':_0x16bd15,'height':_0x2d90a4})});}catch(_0x30cc00){common_1[_0x4fc582(0xa1)][_0x4fc582(0xfc)](_0xc2078c,'：',_0x30cc00);}finally{this[_0x4fc582(0xab)][_0x4fc582(0xb5)]({'key':_0xc2078c});}}};FileService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x5bd7e2(0x9f)])(midjourney_entity_1[_0x5bd7e2(0xef)])),__metadata(_0x5bd7e2(0x111),[typeorm_2['Repository'],globalConfig_service_1['GlobalConfigService'],redisCache_service_1[_0x5bd7e2(0xb9)]])],FileService),exports[_0x5bd7e2(0x94)]=FileService;