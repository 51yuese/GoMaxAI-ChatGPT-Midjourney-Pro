'use strict';const _0x569ea0=_0x5bf1;(function(_0x2ff385,_0x4fc64a){const _0x912363=_0x5bf1,_0x1eda81=_0x2ff385();while(!![]){try{const _0x1cf72b=-parseInt(_0x912363(0x163))/0x1+parseInt(_0x912363(0x183))/0x2*(-parseInt(_0x912363(0x1b2))/0x3)+-parseInt(_0x912363(0x188))/0x4+parseInt(_0x912363(0x1cf))/0x5+parseInt(_0x912363(0x160))/0x6*(-parseInt(_0x912363(0x1cd))/0x7)+-parseInt(_0x912363(0x1a9))/0x8+-parseInt(_0x912363(0x1c4))/0x9*(-parseInt(_0x912363(0x184))/0xa);if(_0x1cf72b===_0x4fc64a)break;else _0x1eda81['push'](_0x1eda81['shift']());}catch(_0x20c83c){_0x1eda81['push'](_0x1eda81['shift']());}}}(_0x524b,0x32bc3));function _0x524b(){const _0x213799=['../midjourney/midjourney.entity','existsSync','InjectRepository','../redisCache/redisCache.service','globalConfigService','message','cosRegion','927624fgZgSD','http','cheveretoStatus','__param','uploadFileByAliOss','Repository','exec','get','base64','split','axios','transferImg','putObject','GlobalConfigService','binary','status','cos-nodejs-sdk-v5','transferFile\x20error:\x20','11911896WdqyzL','put','query','Injectable','default','MjConfig','HttpException','arraybuffer','RedisCacheService','73801lhTrmu','mjNotSaveImg','675620wgKLTN','mkdirSync','join','STANDARD','uploadFileByTencentCos','path','aliOssAccessKeySecret','ali','application/json;charset=UTF-8','ffmpeg\x20-i\x20','post','当前已开启全球加速----------------->','----------------获取视频时长失败--------------','from','object','Location','imageUrl','uuid','image-size','data:image/jpeg;base64,','GOMAXAI_HOST','__esModule','transferAndCover','tencentCosStatus','chevereto','\x20-ss\x20999999\x20-vframes\x201\x20-f\x20null\x20-','.mp4','url','任务原始图片获取失败','rmSync','aliOssAccessKeyId','.png','HttpStatus','jpg','replace','MidjourneyEntity','需要转存到云','content-type','image','126giLXJc','\x0a\x20\x20\x20\x20\x20\x20','.jpg','316320fWLkAG','getCover','removeSpecialCharacters','uploadFile','transferFile','toString','-----------------------ERRROR______________________________','@nestjs/common','transferAndCover\x20error:\x20','上传图片失败[Chevereto|buffer]\x20-->\x20','originTaskId','__decorate','\x20-y\x20-f\x20image2\x20-ss\x202\x20-frames:v\x201\x20-update\x20true\x20','typeorm','set','Logger','tencentCos','上传图片失败[ten]','../../common/constants/redisKey.constant','key','getUploadConfig','aliCos','error:\x20','response','upload2Local','downFile','writeFile','../../common/store','design:paramtypes','aliOssStatus','function','error','2VhbrCI','10yngUJp','redisCacheService','readFileSync','getConfigByKeys','234360rhLSai','cheveretoUploadPath','log','midjourneyEntity','uploadFileByChevereto','https://$2','end','上传图片失败[Chevereto]','请先前往后台配置上传图片的方式','createRandomUid','../../common/utils','metadata','BAD_REQUEST','../globalConfig/globalConfig.service','\x0a\x20\x20\x20\x20\x20\x20\x20\x20ffmpeg\x20-i\x20','append','getVideoDurationByFFmpeg','findOne','pop','无法从输出中提取时长信息','length','tencent','startsWith','/upload','aliOssBucket','decorate','https://','getModalImgById','match','save','data','defineProperty','uploadFileByLocal','2762688ktWrde','tencentCosAcceleratedDomain'];_0x524b=function(){return _0x213799;};return _0x524b();}function _0x5bf1(_0x516084,_0x42265){const _0x524bbc=_0x524b();return _0x5bf1=function(_0x5bf18d,_0x43812e){_0x5bf18d=_0x5bf18d-0x154;let _0x2ae651=_0x524bbc[_0x5bf18d];return _0x2ae651;},_0x5bf1(_0x516084,_0x42265);}var __decorate=this&&this[_0x569ea0(0x16e)]||function(_0x1cfa5a,_0xa34b69,_0x45274d,_0x3fbadd){const _0x4dc642=_0x569ea0;var _0x2a0715=arguments['length'],_0x8e2aa3=_0x2a0715<0x3?_0xa34b69:_0x3fbadd===null?_0x3fbadd=Object['getOwnPropertyDescriptor'](_0xa34b69,_0x45274d):_0x3fbadd,_0x1a2cb8;if(typeof Reflect===_0x4dc642(0x1dd)&&typeof Reflect[_0x4dc642(0x1a1)]===_0x4dc642(0x181))_0x8e2aa3=Reflect[_0x4dc642(0x1a1)](_0x1cfa5a,_0xa34b69,_0x45274d,_0x3fbadd);else{for(var _0x3ca4f4=_0x1cfa5a[_0x4dc642(0x19c)]-0x1;_0x3ca4f4>=0x0;_0x3ca4f4--)if(_0x1a2cb8=_0x1cfa5a[_0x3ca4f4])_0x8e2aa3=(_0x2a0715<0x3?_0x1a2cb8(_0x8e2aa3):_0x2a0715>0x3?_0x1a2cb8(_0xa34b69,_0x45274d,_0x8e2aa3):_0x1a2cb8(_0xa34b69,_0x45274d))||_0x8e2aa3;}return _0x2a0715>0x3&&_0x8e2aa3&&Object[_0x4dc642(0x1a7)](_0xa34b69,_0x45274d,_0x8e2aa3),_0x8e2aa3;},__metadata=this&&this['__metadata']||function(_0x324480,_0x32d87d){const _0x5f2c91=_0x569ea0;if(typeof Reflect===_0x5f2c91(0x1dd)&&typeof Reflect['metadata']===_0x5f2c91(0x181))return Reflect[_0x5f2c91(0x193)](_0x324480,_0x32d87d);},__param=this&&this[_0x569ea0(0x1b5)]||function(_0x2227e8,_0x1116bb){return function(_0xdfc255,_0x4d442e){_0x1116bb(_0xdfc255,_0x4d442e,_0x2227e8);};};Object[_0x569ea0(0x1a7)](exports,_0x569ea0(0x1e4),{'value':!![]}),exports['FileService']=void 0x0;const common_1=require(_0x569ea0(0x16a)),TENCENTCOS=require(_0x569ea0(0x1c2)),ALIOSS=require('ali-oss'),axios_1=require(_0x569ea0(0x1bc)),image_size_1=require(_0x569ea0(0x1e1)),utils_1=require(_0x569ea0(0x192)),globalConfig_service_1=require(_0x569ea0(0x195)),FormData=require('form-data'),midjourney_entity_1=require(_0x569ea0(0x1ab)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x569ea0(0x170)),redisKey_constant_1=require(_0x569ea0(0x175)),redisCache_service_1=require(_0x569ea0(0x1ae)),store_1=require(_0x569ea0(0x17e)),path_1=require(_0x569ea0(0x1d4)),promises_1=require('fs/promises'),fs_1=require('fs'),child_process_1=require('child_process'),uuid_1=require(_0x569ea0(0x1e0));let FileService=class FileService{constructor(_0x5ec349,_0x13caf1,_0x458924){const _0x28adb7=_0x569ea0;this[_0x28adb7(0x18b)]=_0x5ec349,this[_0x28adb7(0x1af)]=_0x13caf1,this['redisCacheService']=_0x458924;}async['onModuleInit'](){const _0x5b312c=_0x569ea0,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this[_0x5b312c(0x1af)][_0x5b312c(0x187)]([_0x5b312c(0x1e6),_0x5b312c(0x180),_0x5b312c(0x1b4)]);!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus)&&common_1[_0x5b312c(0x172)][_0x5b312c(0x182)](_0x5b312c(0x190));if(Number(tencentCosStatus)===0x1){const {SecretId:_0xf16142,SecretKey:_0x361382}=await this[_0x5b312c(0x177)]('tencent');this[_0x5b312c(0x173)]=new TENCENTCOS({'SecretId':_0xf16142,'SecretKey':_0x361382,'FileParallelLimit':0xa});}if(Number(aliOssStatus)===0x1){const {region:_0x3df86b,bucket:_0x3b979f,accessKeyId:_0x7a7625,accessKeySecret:_0x110524}=await this[_0x5b312c(0x177)](_0x5b312c(0x1d6));this[_0x5b312c(0x178)]=new ALIOSS({'region':(0x0,utils_1[_0x5b312c(0x165)])(_0x3df86b),'accessKeyId':_0x7a7625,'accessKeySecret':_0x110524,'bucket':(0x0,utils_1[_0x5b312c(0x165)])(_0x3b979f)});}}async[_0x569ea0(0x177)](_0x3abf11){const _0x2cfb54=_0x569ea0;if(_0x3abf11===_0x2cfb54(0x1d6)){const {aliOssRegion:_0x49df2e,aliOssBucket:_0x16f701,aliOssAccessKeyId:_0x6f3ba2,aliOssAccessKeySecret:_0x5e6392}=await this['globalConfigService'][_0x2cfb54(0x187)](['aliOssRegion',_0x2cfb54(0x1a0),_0x2cfb54(0x157),_0x2cfb54(0x1d5)]);return{'region':_0x49df2e,'bucket':_0x16f701,'accessKeyId':_0x6f3ba2,'accessKeySecret':_0x5e6392};}if(_0x3abf11==='tencent'){const {cosBucket:_0x36aa42,cosRegion:_0x22d3eb,cosSecretId:_0x56623b,cosSecretKey:_0x34e857,tencentCosAcceleratedDomain:_0x2fc676}=await this[_0x2cfb54(0x1af)][_0x2cfb54(0x187)](['cosBucket',_0x2cfb54(0x1b1),'cosSecretId','cosSecretKey',_0x2cfb54(0x1aa)]);return{'Bucket':_0x36aa42,'Region':_0x22d3eb,'SecretId':_0x56623b,'SecretKey':_0x34e857,'acceleratedDomain':_0x2fc676};}if(_0x3abf11==='chevereto'){const {cheveretoKey:_0x2a5ceb,cheveretoUploadPath:_0x190df5}=await this[_0x2cfb54(0x1af)]['getConfigByKeys'](['cheveretoKey',_0x2cfb54(0x189)]);return{'key':_0x2a5ceb,'uploadPath':_0x190df5};}}async['uploadFile'](_0x3b2f75){const _0x5607f3=_0x569ea0,{filename:_0x37129c,buffer:_0x551acc,dir:dir='ai'}=_0x3b2f75,{aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x5607f3(0x1af)][_0x5607f3(0x187)]([_0x5607f3(0x1e6),_0x5607f3(0x180),_0x5607f3(0x1b4)]);if(Number(tencentCosStatus)===0x1)return this[_0x5607f3(0x1d3)]({'filename':_0x37129c,'buffer':_0x551acc,'dir':dir});if(Number(aliOssStatus)===0x1)return this[_0x5607f3(0x1b6)]({'filename':_0x37129c,'buffer':_0x551acc,'dir':dir});if(Number(cheveretoStatus)){const {filename:_0x3c9b83,buffer:_0x544bc3,dir:_0x564d2a}=_0x3b2f75;return this[_0x5607f3(0x18c)]({'filename':_0x3c9b83,'buffer':_0x544bc3['toString']('base64'),'dir':_0x564d2a});}const [_0x21daad,_0x42844c]=await this[_0x5607f3(0x1a8)]({'filename':_0x37129c,'buffer':_0x551acc,'dir':dir});return _0x21daad;}async[_0x569ea0(0x17b)](_0x475983){const {filename:_0x127afa,buffer:_0x407f8f,dir:dir='ai'}=_0x475983,[_0x4f1738,_0x5665da]=await this['uploadFileByLocal']({'filename':_0x127afa,'buffer':_0x407f8f,'dir':dir});return _0x4f1738;}async[_0x569ea0(0x1d3)]({filename:_0x4bafea,buffer:_0x172e34,dir:_0x50532a}){const _0x15535f=_0x569ea0;try{const {Bucket:_0x4fb8b9,Region:_0x3c04ca,SecretId:_0x398801,SecretKey:_0x3e1263}=await this[_0x15535f(0x177)](_0x15535f(0x19d));!this[_0x15535f(0x173)]&&(this[_0x15535f(0x173)]=new TENCENTCOS({'SecretId':_0x398801,'SecretKey':_0x3e1263,'FileParallelLimit':0xa}));const _0x502871=await this['tencentCos'][_0x15535f(0x1be)]({'Bucket':(0x0,utils_1[_0x15535f(0x165)])(_0x4fb8b9),'Region':(0x0,utils_1[_0x15535f(0x165)])(_0x3c04ca),'Key':_0x50532a+'/'+(_0x4bafea||(0x0,utils_1[_0x15535f(0x191)])()+_0x15535f(0x158)),'StorageClass':_0x15535f(0x1d2),'Body':_0x172e34});let _0x17c158=_0x502871[_0x15535f(0x1de)][_0x15535f(0x15b)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x15535f(0x18d));const {acceleratedDomain:_0x59a32f}=await this[_0x15535f(0x177)](_0x15535f(0x19d));return _0x59a32f&&(_0x17c158=_0x17c158[_0x15535f(0x15b)](/^(https:\/\/[^/]+)(\/.*)$/,_0x15535f(0x1a2)+_0x59a32f+'$2'),console['log'](_0x15535f(0x1da),_0x17c158)),_0x17c158;}catch(_0x4babfa){console['log'](_0x15535f(0x179),_0x4babfa);throw new common_1[(_0x15535f(0x1ca))](_0x15535f(0x174),common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x569ea0(0x1b6)]({filename:_0x5318ea,buffer:_0x321044,dir:_0x4370fa}){const _0x39fcf6=_0x569ea0;if(!this['aliCos']){const {region:_0x553413,bucket:_0xc79002,accessKeyId:_0x234161,accessKeySecret:_0x1736a0}=await this['getUploadConfig']('ali');this[_0x39fcf6(0x178)]=new ALIOSS({'region':(0x0,utils_1[_0x39fcf6(0x165)])(_0x553413),'accessKeyId':_0x234161,'accessKeySecret':_0x1736a0,'bucket':(0x0,utils_1[_0x39fcf6(0x165)])(_0xc79002)});}try{console[_0x39fcf6(0x18a)]('ali\x20开始上传');const _0xca1ad4=await this['aliCos'][_0x39fcf6(0x1c5)](_0x4370fa+'/'+(_0x5318ea||(0x0,utils_1[_0x39fcf6(0x191)])()+'.png'),_0x321044);return _0xca1ad4['url'];}catch(_0x3afdd6){throw new common_1[(_0x39fcf6(0x1ca))]('上传图片失败[ali]',common_1['HttpStatus'][_0x39fcf6(0x194)]);}}async[_0x569ea0(0x18c)]({filename:filename='',buffer:_0x513c74,dir:dir='ai'}){const _0x30cb13=_0x569ea0,{key:_0x142e29,uploadPath:_0x129674}=await this[_0x30cb13(0x177)](_0x30cb13(0x1e7)),_0x2beccc=new FormData();_0x2beccc['append']('source',_0x513c74[_0x30cb13(0x168)](_0x30cb13(0x1ba))),_0x2beccc[_0x30cb13(0x197)](_0x30cb13(0x176),_0x142e29);try{const _0x2ed51d=await axios_1['default'][_0x30cb13(0x1d9)](_0x129674,_0x2beccc,{'headers':{'X-API-Key':_0x142e29},'timeout':0xa*0x3c*0x3e8});if(_0x2ed51d?.[_0x30cb13(0x1c1)]===0xc8)return _0x2ed51d[_0x30cb13(0x1a6)][_0x30cb13(0x15f)][_0x30cb13(0x154)];else{common_1[_0x30cb13(0x172)][_0x30cb13(0x182)](_0x30cb13(0x18f),JSON['stringify'](_0x2ed51d['data']));throw new Error(_0x30cb13(0x18f));}}catch(_0xc1b003){console['log']('error:\x20',_0xc1b003[_0x30cb13(0x17a)]);throw new common_1[(_0x30cb13(0x1ca))](_0x30cb13(0x16c)+_0xc1b003[_0x30cb13(0x17a)]?.[_0x30cb13(0x1a6)][_0x30cb13(0x182)][_0x30cb13(0x1b0)],common_1['HttpStatus'][_0x30cb13(0x194)]);}}async[_0x569ea0(0x1a8)]({filename:_0x256acb,buffer:_0x48ca46,dir:_0x3a8e4b}){const _0x2af57e=_0x569ea0;let _0x688b0=(0x0,path_1[_0x2af57e(0x1d1)])(process['cwd'](),'webroot','upload'),_0x4b134b=_0x2af57e(0x19f),_0x480ec2='';_0x3a8e4b&&(_0x688b0=(0x0,path_1['join'])(_0x688b0,_0x3a8e4b),_0x4b134b='/upload/'+_0x3a8e4b);_0x4b134b=_0x4b134b+'/'+_0x256acb;!(0x0,fs_1[_0x2af57e(0x1ac)])(_0x688b0)&&(0x0,fs_1[_0x2af57e(0x1d0)])(_0x688b0,{'recursive':!![]});_0x688b0=(0x0,path_1[_0x2af57e(0x1d1)])(_0x688b0,_0x256acb),await(0x0,promises_1[_0x2af57e(0x17d)])(_0x688b0,_0x48ca46);let _0x3165e2=process['env'][_0x2af57e(0x1e3)];return _0x3165e2[_0x2af57e(0x19e)](_0x2af57e(0x1b3))?_0x480ec2=_0x3165e2+_0x4b134b:_0x480ec2=_0x2af57e(0x1a2)+_0x3165e2+_0x4b134b,[_0x480ec2,_0x688b0];}async[_0x569ea0(0x17c)](_0x5e89a1,_0x48bdd0,_0x5ce653){const _0x46dd9d=_0x569ea0;try{const _0x2a0378=_0x5e89a1[_0x46dd9d(0x1bb)]('/')[_0x46dd9d(0x19a)](),_0x4d0ecc=await(0x0,axios_1[_0x46dd9d(0x1c8)])(_0x5e89a1,{'headers':{'Content-Type':_0x46dd9d(0x1d7)},'responseType':'arraybuffer','timeout':0x493e0});_0x5ce653['writeHead'](0xc8,{'Content-Type':_0x4d0ecc['headers'][_0x46dd9d(0x15e)],'Content-Disposition':_0x2a0378}),_0x5ce653[_0x46dd9d(0x18e)](_0x4d0ecc['data'],_0x46dd9d(0x1c0));}catch(_0xb61118){throw new common_1[(_0x46dd9d(0x1ca))](_0xb61118['message'],common_1[_0x46dd9d(0x159)]['BAD_REQUEST']);}}async[_0x569ea0(0x1a3)](_0x208176){const _0x2d7322=_0x569ea0;try{const _0x5111e5=await this['midjourneyEntity'][_0x2d7322(0x199)]({'where':{'id':Number(_0x208176[_0x2d7322(0x1c6)]['taskId'])}});let _0x5e91d0;if(_0x5111e5[_0x2d7322(0x1df)])_0x5e91d0=_0x5111e5['imageUrl'];else{const _0x2ec6c0=await this['midjourneyEntity']['findOne']({'where':{'id':Number(_0x5111e5[_0x2d7322(0x16d)])}});_0x5e91d0=_0x2ec6c0[_0x2d7322(0x1df)];}if(!_0x5e91d0)throw new Error(_0x2d7322(0x155));const _0x558157=await axios_1['default'][_0x2d7322(0x1b9)](_0x5e91d0,{'responseType':_0x2d7322(0x1cb)}),_0x137dc6=Buffer[_0x2d7322(0x1dc)](_0x558157[_0x2d7322(0x1a6)])['toString']('base64');return _0x2d7322(0x1e2)+_0x137dc6;}catch(_0x2175b1){throw new common_1[(_0x2d7322(0x1ca))](_0x2175b1[_0x2d7322(0x1b0)],common_1[_0x2d7322(0x159)][_0x2d7322(0x194)]);}}async[_0x569ea0(0x167)](_0x3be9bc){const _0x247c03=_0x569ea0;try{const _0x2efcfd=await axios_1[_0x247c03(0x1c8)][_0x247c03(0x1b9)](_0x3be9bc,{'responseType':_0x247c03(0x1cb)}),_0xcfea56=_0x3be9bc['split']('/')['pop']()[_0x247c03(0x1bb)]('?')[0x0],_0x40a927=await this['uploadFile']({'filename':_0xcfea56,'buffer':_0x2efcfd['data']});return _0x40a927;}catch(_0x1363ee){return common_1[_0x247c03(0x172)]['error'](_0x247c03(0x1c3),_0x1363ee),null;}}async[_0x569ea0(0x164)](_0x20b484){return new Promise((_0x1a75b2,_0x8a28bf)=>{const _0x1e1f15=_0x5bf1,_0x4e501b=_0x20b484[_0x1e1f15(0x15b)]('.mp4',_0x1e1f15(0x162));(0x0,child_process_1[_0x1e1f15(0x1b8)])(_0x1e1f15(0x196)+_0x20b484+_0x1e1f15(0x16f)+_0x4e501b+_0x1e1f15(0x161),function(_0x5f46dd,_0x2edd84,_0x4ea419){const _0x102ae1=_0x1e1f15;_0x5f46dd?(console[_0x102ae1(0x18a)](_0x4ea419),_0x8a28bf(_0x5f46dd)):_0x1a75b2(_0x4e501b);});});}async[_0x569ea0(0x198)](_0x2bb9a6){return new Promise((_0x45bbc3,_0x1da3be)=>{const _0x3ac01c=_0x5bf1;(0x0,child_process_1[_0x3ac01c(0x1b8)])(_0x3ac01c(0x1d8)+_0x2bb9a6+_0x3ac01c(0x1e8),function(_0x4a0f6c,_0xf9ffae,_0x10df20){const _0x6ebab6=_0x3ac01c;if(_0x4a0f6c)console[_0x6ebab6(0x18a)](_0x6ebab6(0x1db),_0x10df20),_0x1da3be(_0x4a0f6c);else{const _0x1558b5=_0x10df20[_0x6ebab6(0x1a4)](/Duration: (\d+:\d+:\d+\.\d+)/);if(!_0x1558b5)_0x1da3be(_0x6ebab6(0x19b));else{const _0x7a7649=_0x1558b5[0x1][_0x6ebab6(0x1bb)](':'),_0x55f18b=parseInt(_0x7a7649[0x0],0xa),_0xabea12=parseInt(_0x7a7649[0x1],0xa),_0xccd903=parseFloat(_0x7a7649[0x2]);console[_0x6ebab6(0x18a)]('-------------------获取视频时长-----------------',_0x55f18b*0xe10+_0xabea12*0x3c+_0xccd903),_0x45bbc3(_0x55f18b*0xe10+_0xabea12*0x3c+_0xccd903);}}});});}async[_0x569ea0(0x1e5)](_0x53165f){const _0x1c4c9a=_0x569ea0;let _0x1cb096=null,_0x27e3f7=null;try{const _0x48eec0=await axios_1['default'][_0x1c4c9a(0x1b9)](_0x53165f,{'responseType':_0x1c4c9a(0x1cb)});let _0x45a209=(0x0,uuid_1['v4'])(),_0x21d1b1=_0x45a209[_0x1c4c9a(0x15b)](/-/g,'')+_0x1c4c9a(0x1e9);const [_0x14c66f,_0x49be79]=await this[_0x1c4c9a(0x1a8)]({'filename':_0x21d1b1,'buffer':_0x48eec0[_0x1c4c9a(0x1a6)],'dir':'ai'}),_0x1d426d=await this[_0x1c4c9a(0x164)](_0x49be79);let {aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x1c4c9a(0x1af)][_0x1c4c9a(0x187)]([_0x1c4c9a(0x1e6),_0x1c4c9a(0x180),_0x1c4c9a(0x1b4)]);aliOssStatus=Number(aliOssStatus),cheveretoStatus=Number(cheveretoStatus),tencentCosStatus=Number(tencentCosStatus);if(aliOssStatus||cheveretoStatus||tencentCosStatus){console['log'](_0x1c4c9a(0x15d)),_0x1cb096=await this['uploadFile']({'filename':_0x21d1b1,'buffer':_0x48eec0[_0x1c4c9a(0x1a6)]});const _0x448dc=(0x0,fs_1[_0x1c4c9a(0x186)])(_0x1d426d);_0x27e3f7=await this[_0x1c4c9a(0x166)]({'filename':_0x21d1b1['replace'](/mp4$/,_0x1c4c9a(0x15a)),'buffer':_0x448dc}),(0x0,fs_1[_0x1c4c9a(0x156)])(_0x49be79),(0x0,fs_1[_0x1c4c9a(0x156)])(_0x1d426d);}else _0x1cb096=_0x14c66f,_0x27e3f7=_0x14c66f[_0x1c4c9a(0x15b)](_0x1c4c9a(0x1e9),_0x1c4c9a(0x162));return[_0x1cb096,_0x27e3f7];}catch(_0x5a3248){return console['log'](_0x1c4c9a(0x169),_0x5a3248),common_1['Logger']['error'](_0x1c4c9a(0x16b),_0x5a3248),[null,null];}}async[_0x569ea0(0x1bd)](_0xe0e49a,_0x334129){const _0x2926be=_0x569ea0,_0x658434=redisKey_constant_1['MJ_IMG_TRANSFER']+_0xe0e49a;try{const _0x4f3517=await this[_0x2926be(0x185)][_0x2926be(0x1b9)]({'key':_0x658434});if(_0x4f3517)return;this[_0x2926be(0x185)][_0x2926be(0x171)]({'key':_0x658434,'val':'lock'});const _0x8817b1=await axios_1[_0x2926be(0x1c8)][_0x2926be(0x1b9)](_0x334129,{'responseType':_0x2926be(0x1cb)}),{width:_0x34cb91,height:_0x279da8}=await(0x0,image_size_1[_0x2926be(0x1c8)])(_0x8817b1[_0x2926be(0x1a6)]);!store_1[_0x2926be(0x1c9)][_0x2926be(0x1ce)]&&(_0x334129=await this[_0x2926be(0x166)]({'filename':'mj-'+_0xe0e49a+_0x2926be(0x158),'buffer':_0x8817b1[_0x2926be(0x1a6)]})),await this[_0x2926be(0x18b)][_0x2926be(0x1a5)]({'id':_0xe0e49a,'imageUrl':_0x334129,'fileInfo':JSON['stringify']({'width':_0x34cb91,'height':_0x279da8})});}catch(_0x4e4092){common_1[_0x2926be(0x172)][_0x2926be(0x182)](_0x658434,'：',_0x4e4092);}finally{this[_0x2926be(0x185)]['del']({'key':_0x658434});}}};FileService=__decorate([(0x0,common_1[_0x569ea0(0x1c7)])(),__param(0x0,(0x0,typeorm_1[_0x569ea0(0x1ad)])(midjourney_entity_1[_0x569ea0(0x15c)])),__metadata(_0x569ea0(0x17f),[typeorm_2[_0x569ea0(0x1b7)],globalConfig_service_1[_0x569ea0(0x1bf)],redisCache_service_1[_0x569ea0(0x1cc)]])],FileService),exports['FileService']=FileService;