'use strict';const _0x411e48=_0x1f53;(function(_0x267f48,_0x49dd03){const _0x50cf64=_0x1f53,_0x48a498=_0x267f48();while(!![]){try{const _0x1c269e=parseInt(_0x50cf64(0x200))/0x1+-parseInt(_0x50cf64(0x224))/0x2*(-parseInt(_0x50cf64(0x235))/0x3)+-parseInt(_0x50cf64(0x1f5))/0x4+-parseInt(_0x50cf64(0x228))/0x5*(parseInt(_0x50cf64(0x252))/0x6)+parseInt(_0x50cf64(0x1eb))/0x7*(-parseInt(_0x50cf64(0x245))/0x8)+-parseInt(_0x50cf64(0x1dd))/0x9+-parseInt(_0x50cf64(0x1f1))/0xa*(-parseInt(_0x50cf64(0x21b))/0xb);if(_0x1c269e===_0x49dd03)break;else _0x48a498['push'](_0x48a498['shift']());}catch(_0x1c1fd4){_0x48a498['push'](_0x48a498['shift']());}}}(_0x15e0,0xdf871));function _0x15e0(){const _0x1b39cf=['key','object','aliOssRegion','replace','../../common/store','function','append','ali','exec','../midjourney/midjourney.entity','196TCgymy','上传图片失败[Chevereto]','../../common/constants/redisKey.constant','cheveretoStatus','uploadFileByChevereto','../redisCache/redisCache.service','20581160XfcRXI','image-size','rmSync','上传图片失败[ten]','3968132KMaYuV','__esModule','putObject','originTaskId','当前已开启全球加速----------------->','\x0a\x20\x20\x20\x20\x20\x20\x20\x20ffmpeg\x20-i\x20','path','downFile','error','cosSecretId','cosRegion','74840ukUULX','metadata','decorate','arraybuffer','readFileSync','findOne','createRandomUid','transferAndCover','mkdirSync','cheveretoKey','design:paramtypes','BAD_REQUEST','error:\x20','midjourneyEntity','HttpException','MJ_IMG_TRANSFER','ali\x20开始上传','axios','content-type','@nestjs/common','GlobalConfigService','response','taskId','removeSpecialCharacters','form-data','transferAndCover\x20error:\x20','uploadFileByAliOss','22jRGEzt','/upload','../globalConfig/globalConfig.service','tencentCos','uploadFileByTencentCos','stringify','cosSecretKey','length','HttpStatus','3494oCRgdB','url','\x0a\x20\x20\x20\x20\x20\x20','cosBucket','1655vAcEuw','.jpg','Logger','headers','getModalImgById','FileService','toString','default','data','MidjourneyEntity','cheveretoUploadPath','请先前往后台配置上传图片的方式','MjConfig','567nWlafb','jpg','pop','Repository','.mp4','.png','cwd','tencentCosAcceleratedDomain','InjectRepository','startsWith','@nestjs/typeorm','imageUrl','defineProperty','aliOssAccessKeySecret','getConfigByKeys','del','209584xmqLjx','transferFile','message','globalConfigService','GOMAXAI_HOST','lock','base64','mjNotSaveImg','set','aliCos','env','uploadFileByLocal','Location','15954avHTrb','aliOssAccessKeyId','join','mj-','https://','uploadFile','getOwnPropertyDescriptor','getCover','log','existsSync','上传图片失败[Chevereto|buffer]\x20-->\x20','aliOssStatus','binary','from','upload2Local','__param','http','redisCacheService','tencent','Injectable','getUploadConfig','typeorm','get','tencentCosStatus','需要转存到云','aliOssBucket','data:image/jpeg;base64,','transferImg','save','split','writeFile','__metadata','8999820dXYwUv','STANDARD','writeHead','https://$2'];_0x15e0=function(){return _0x1b39cf;};return _0x15e0();}function _0x1f53(_0x44e33e,_0x2a18aa){const _0x15e06c=_0x15e0();return _0x1f53=function(_0x1f530e,_0xe9a840){_0x1f530e=_0x1f530e-0x1d4;let _0x496f0d=_0x15e06c[_0x1f530e];return _0x496f0d;},_0x1f53(_0x44e33e,_0x2a18aa);}var __decorate=this&&this['__decorate']||function(_0x321a7d,_0x1ff57a,_0x49b1c6,_0x48e9c4){const _0x5e57e7=_0x1f53;var _0x21c406=arguments[_0x5e57e7(0x222)],_0x21cc3d=_0x21c406<0x3?_0x1ff57a:_0x48e9c4===null?_0x48e9c4=Object[_0x5e57e7(0x258)](_0x1ff57a,_0x49b1c6):_0x48e9c4,_0x4890da;if(typeof Reflect===_0x5e57e7(0x1e2)&&typeof Reflect[_0x5e57e7(0x202)]===_0x5e57e7(0x1e6))_0x21cc3d=Reflect[_0x5e57e7(0x202)](_0x321a7d,_0x1ff57a,_0x49b1c6,_0x48e9c4);else{for(var _0x4f3df7=_0x321a7d['length']-0x1;_0x4f3df7>=0x0;_0x4f3df7--)if(_0x4890da=_0x321a7d[_0x4f3df7])_0x21cc3d=(_0x21c406<0x3?_0x4890da(_0x21cc3d):_0x21c406>0x3?_0x4890da(_0x1ff57a,_0x49b1c6,_0x21cc3d):_0x4890da(_0x1ff57a,_0x49b1c6))||_0x21cc3d;}return _0x21c406>0x3&&_0x21cc3d&&Object[_0x5e57e7(0x241)](_0x1ff57a,_0x49b1c6,_0x21cc3d),_0x21cc3d;},__metadata=this&&this[_0x411e48(0x1dc)]||function(_0x1c92e8,_0x51fad2){const _0x23fd12=_0x411e48;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x23fd12(0x1e6))return Reflect[_0x23fd12(0x201)](_0x1c92e8,_0x51fad2);},__param=this&&this[_0x411e48(0x261)]||function(_0x244e41,_0x57a459){return function(_0x1659a0,_0x2aa966){_0x57a459(_0x1659a0,_0x2aa966,_0x244e41);};};Object['defineProperty'](exports,_0x411e48(0x1f6),{'value':!![]}),exports[_0x411e48(0x22d)]=void 0x0;const common_1=require(_0x411e48(0x213)),TENCENTCOS=require('cos-nodejs-sdk-v5'),ALIOSS=require('ali-oss'),axios_1=require(_0x411e48(0x211)),image_size_1=require(_0x411e48(0x1f2)),utils_1=require('../../common/utils'),globalConfig_service_1=require(_0x411e48(0x21d)),FormData=require(_0x411e48(0x218)),midjourney_entity_1=require(_0x411e48(0x1ea)),typeorm_1=require(_0x411e48(0x23f)),typeorm_2=require(_0x411e48(0x267)),redisKey_constant_1=require(_0x411e48(0x1ed)),redisCache_service_1=require(_0x411e48(0x1f0)),store_1=require(_0x411e48(0x1e5)),path_1=require(_0x411e48(0x1fb)),promises_1=require('fs/promises'),fs_1=require('fs'),child_process_1=require('child_process');let FileService=class FileService{constructor(_0x178a3a,_0x308437,_0x7a9e7f){const _0x49a891=_0x411e48;this[_0x49a891(0x20d)]=_0x178a3a,this[_0x49a891(0x248)]=_0x308437,this[_0x49a891(0x263)]=_0x7a9e7f;}async['onModuleInit'](){const _0x3fa6dd=_0x411e48,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService']['getConfigByKeys']([_0x3fa6dd(0x1d4),_0x3fa6dd(0x25d),_0x3fa6dd(0x1ee)]);!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus)&&common_1['Logger'][_0x3fa6dd(0x1fd)](_0x3fa6dd(0x233));if(Number(tencentCosStatus)===0x1){const {SecretId:_0x343186,SecretKey:_0x315d04}=await this[_0x3fa6dd(0x266)](_0x3fa6dd(0x264));this[_0x3fa6dd(0x21e)]=new TENCENTCOS({'SecretId':_0x343186,'SecretKey':_0x315d04,'FileParallelLimit':0xa});}if(Number(aliOssStatus)===0x1){const {region:_0x187e2f,bucket:_0x1b9843,accessKeyId:_0x56706d,accessKeySecret:_0xd4e7b6}=await this['getUploadConfig']('ali');this[_0x3fa6dd(0x24e)]=new ALIOSS({'region':(0x0,utils_1[_0x3fa6dd(0x217)])(_0x187e2f),'accessKeyId':_0x56706d,'accessKeySecret':_0xd4e7b6,'bucket':(0x0,utils_1[_0x3fa6dd(0x217)])(_0x1b9843)});}}async['getUploadConfig'](_0x3519f1){const _0x16a816=_0x411e48;if(_0x3519f1===_0x16a816(0x1e8)){const {aliOssRegion:_0x384871,aliOssBucket:_0x53a407,aliOssAccessKeyId:_0x3468b7,aliOssAccessKeySecret:_0x403b49}=await this[_0x16a816(0x248)][_0x16a816(0x243)]([_0x16a816(0x1e3),_0x16a816(0x1d6),_0x16a816(0x253),_0x16a816(0x242)]);return{'region':_0x384871,'bucket':_0x53a407,'accessKeyId':_0x3468b7,'accessKeySecret':_0x403b49};}if(_0x3519f1==='tencent'){const {cosBucket:_0x1754d6,cosRegion:_0x2bf4a0,cosSecretId:_0x51ed24,cosSecretKey:_0x2a6522,tencentCosAcceleratedDomain:_0xc33f3e}=await this[_0x16a816(0x248)][_0x16a816(0x243)]([_0x16a816(0x227),_0x16a816(0x1ff),_0x16a816(0x1fe),_0x16a816(0x221),_0x16a816(0x23c)]);return{'Bucket':_0x1754d6,'Region':_0x2bf4a0,'SecretId':_0x51ed24,'SecretKey':_0x2a6522,'acceleratedDomain':_0xc33f3e};}if(_0x3519f1==='chevereto'){const {cheveretoKey:_0xf0434c,cheveretoUploadPath:_0x13b541}=await this[_0x16a816(0x248)]['getConfigByKeys']([_0x16a816(0x209),_0x16a816(0x232)]);return{'key':_0xf0434c,'uploadPath':_0x13b541};}}async[_0x411e48(0x257)](_0x5e7f17){const _0x283cb5=_0x411e48,{filename:_0x23afa3,buffer:_0xe10cbd,dir:dir='ai'}=_0x5e7f17,{aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x283cb5(0x248)][_0x283cb5(0x243)]([_0x283cb5(0x1d4),_0x283cb5(0x25d),_0x283cb5(0x1ee)]);if(Number(tencentCosStatus)===0x1)return this[_0x283cb5(0x21f)]({'filename':_0x23afa3,'buffer':_0xe10cbd,'dir':dir});if(Number(aliOssStatus)===0x1)return this[_0x283cb5(0x21a)]({'filename':_0x23afa3,'buffer':_0xe10cbd,'dir':dir});if(Number(cheveretoStatus)){const {filename:_0xb3f339,buffer:_0x32a2d0,dir:_0x14fe9c}=_0x5e7f17;return this[_0x283cb5(0x1ef)]({'filename':_0xb3f339,'buffer':_0x32a2d0[_0x283cb5(0x22e)]('base64'),'dir':_0x14fe9c});}const [_0x38effd,_0x243633]=await this[_0x283cb5(0x250)]({'filename':_0x23afa3,'buffer':_0xe10cbd,'dir':dir});return _0x38effd;}async[_0x411e48(0x260)](_0x5afc6e){const _0x3ef883=_0x411e48,{filename:_0x50564a,buffer:_0x3dfa49,dir:dir='ai'}=_0x5afc6e,[_0x577474,_0x1ae832]=await this[_0x3ef883(0x250)]({'filename':_0x50564a,'buffer':_0x3dfa49,'dir':dir});return _0x577474;}async['uploadFileByTencentCos']({filename:_0xda9530,buffer:_0x5672c3,dir:_0x771880}){const _0x1413f0=_0x411e48;try{const {Bucket:_0xd4ab0e,Region:_0x3e982e,SecretId:_0x426f4c,SecretKey:_0x14e2b0}=await this[_0x1413f0(0x266)](_0x1413f0(0x264));!this[_0x1413f0(0x21e)]&&(this[_0x1413f0(0x21e)]=new TENCENTCOS({'SecretId':_0x426f4c,'SecretKey':_0x14e2b0,'FileParallelLimit':0xa}));const _0x2eb10a=await this[_0x1413f0(0x21e)][_0x1413f0(0x1f7)]({'Bucket':(0x0,utils_1[_0x1413f0(0x217)])(_0xd4ab0e),'Region':(0x0,utils_1[_0x1413f0(0x217)])(_0x3e982e),'Key':_0x771880+'/'+(_0xda9530||(0x0,utils_1[_0x1413f0(0x206)])()+_0x1413f0(0x23a)),'StorageClass':_0x1413f0(0x1de),'Body':_0x5672c3});let _0x1648b3=_0x2eb10a[_0x1413f0(0x251)][_0x1413f0(0x1e4)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x1413f0(0x1e0));const {acceleratedDomain:_0x2d366d}=await this[_0x1413f0(0x266)](_0x1413f0(0x264));return _0x2d366d&&(_0x1648b3=_0x1648b3['replace'](/^(https:\/\/[^/]+)(\/.*)$/,_0x1413f0(0x256)+_0x2d366d+'$2'),console[_0x1413f0(0x25a)](_0x1413f0(0x1f9),_0x1648b3)),_0x1648b3;}catch(_0xcdc363){console['log'](_0x1413f0(0x20c),_0xcdc363);throw new common_1[(_0x1413f0(0x20e))](_0x1413f0(0x1f4),common_1[_0x1413f0(0x223)][_0x1413f0(0x20b)]);}}async['uploadFileByAliOss']({filename:_0x34dcc9,buffer:_0x42cd65,dir:_0xcb82f5}){const _0x1d71f1=_0x411e48;if(!this[_0x1d71f1(0x24e)]){const {region:_0x3700d7,bucket:_0x547fcd,accessKeyId:_0x4b7859,accessKeySecret:_0x4a3f83}=await this[_0x1d71f1(0x266)](_0x1d71f1(0x1e8));this[_0x1d71f1(0x24e)]=new ALIOSS({'region':(0x0,utils_1[_0x1d71f1(0x217)])(_0x3700d7),'accessKeyId':_0x4b7859,'accessKeySecret':_0x4a3f83,'bucket':(0x0,utils_1['removeSpecialCharacters'])(_0x547fcd)});}try{console[_0x1d71f1(0x25a)](_0x1d71f1(0x210));const _0x29049c=await this[_0x1d71f1(0x24e)]['put'](_0xcb82f5+'/'+(_0x34dcc9||(0x0,utils_1[_0x1d71f1(0x206)])()+_0x1d71f1(0x23a)),_0x42cd65);return _0x29049c[_0x1d71f1(0x225)];}catch(_0x2d8b25){throw new common_1[(_0x1d71f1(0x20e))]('上传图片失败[ali]',common_1[_0x1d71f1(0x223)][_0x1d71f1(0x20b)]);}}async['uploadFileByChevereto']({filename:filename='',buffer:_0x54ea38,dir:dir='ai'}){const _0x21cc24=_0x411e48,{key:_0x3ce553,uploadPath:_0x5aa830}=await this[_0x21cc24(0x266)]('chevereto'),_0x5a376d=new FormData();_0x5a376d['append']('source',_0x54ea38[_0x21cc24(0x22e)](_0x21cc24(0x24b))),_0x5a376d[_0x21cc24(0x1e7)](_0x21cc24(0x1e1),_0x3ce553);try{const _0x8ed63c=await axios_1[_0x21cc24(0x22f)]['post'](_0x5aa830,_0x5a376d,{'headers':{'X-API-Key':_0x3ce553},'timeout':0xa*0x3c*0x3e8});if(_0x8ed63c?.['status']===0xc8)return _0x8ed63c['data']['image']['url'];else{common_1[_0x21cc24(0x22a)]['error'](_0x21cc24(0x1ec),JSON[_0x21cc24(0x220)](_0x8ed63c['data']));throw new Error(_0x21cc24(0x1ec));}}catch(_0x33aed4){console['log']('error:\x20',_0x33aed4[_0x21cc24(0x215)]);throw new common_1['HttpException'](_0x21cc24(0x25c)+_0x33aed4[_0x21cc24(0x215)]?.[_0x21cc24(0x230)][_0x21cc24(0x1fd)][_0x21cc24(0x247)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x411e48(0x250)]({filename:_0xd0daa6,buffer:_0x3dbf15,dir:_0x8cc83a}){const _0x12acfc=_0x411e48;let _0x306f88=(0x0,path_1['join'])(process[_0x12acfc(0x23b)](),'webroot','upload'),_0xef1ebe=_0x12acfc(0x21c),_0x186d08='';_0x8cc83a&&(_0x306f88=(0x0,path_1[_0x12acfc(0x254)])(_0x306f88,_0x8cc83a),_0xef1ebe='/upload/'+_0x8cc83a);_0xef1ebe=_0xef1ebe+'/'+_0xd0daa6;!(0x0,fs_1[_0x12acfc(0x25b)])(_0x306f88)&&(0x0,fs_1[_0x12acfc(0x208)])(_0x306f88,{'recursive':!![]});_0x306f88=(0x0,path_1[_0x12acfc(0x254)])(_0x306f88,_0xd0daa6),await(0x0,promises_1[_0x12acfc(0x1db)])(_0x306f88,_0x3dbf15);let _0x2b2a32=process[_0x12acfc(0x24f)][_0x12acfc(0x249)];return _0x2b2a32[_0x12acfc(0x23e)](_0x12acfc(0x262))?_0x186d08=_0x2b2a32+_0xef1ebe:_0x186d08=_0x12acfc(0x256)+_0x2b2a32+_0xef1ebe,[_0x186d08,_0x306f88];}async[_0x411e48(0x1fc)](_0x3d8cbd,_0x11e53d,_0x40b8e2){const _0x348b1a=_0x411e48;try{const _0xfbbc06=_0x3d8cbd[_0x348b1a(0x1da)]('/')['pop'](),_0x3100be=await(0x0,axios_1[_0x348b1a(0x22f)])(_0x3d8cbd,{'headers':{'Content-Type':'application/json;charset=UTF-8'},'responseType':_0x348b1a(0x203),'timeout':0x493e0});_0x40b8e2[_0x348b1a(0x1df)](0xc8,{'Content-Type':_0x3100be[_0x348b1a(0x22b)][_0x348b1a(0x212)],'Content-Disposition':_0xfbbc06}),_0x40b8e2['end'](_0x3100be['data'],_0x348b1a(0x25e));}catch(_0x250a71){throw new common_1[(_0x348b1a(0x20e))](_0x250a71['message'],common_1[_0x348b1a(0x223)][_0x348b1a(0x20b)]);}}async[_0x411e48(0x22c)](_0x1173f1){const _0x4d4c52=_0x411e48;try{const _0x3563d7=await this['midjourneyEntity']['findOne']({'where':{'id':Number(_0x1173f1['query'][_0x4d4c52(0x216)])}});let _0x44c9b4;if(_0x3563d7[_0x4d4c52(0x240)])_0x44c9b4=_0x3563d7[_0x4d4c52(0x240)];else{const _0x1ef3b9=await this[_0x4d4c52(0x20d)][_0x4d4c52(0x205)]({'where':{'id':Number(_0x3563d7[_0x4d4c52(0x1f8)])}});_0x44c9b4=_0x1ef3b9[_0x4d4c52(0x240)];}if(!_0x44c9b4)throw new Error('任务原始图片获取失败');const _0x45d2dd=await axios_1[_0x4d4c52(0x22f)]['get'](_0x44c9b4,{'responseType':_0x4d4c52(0x203)}),_0x301f6b=Buffer[_0x4d4c52(0x25f)](_0x45d2dd[_0x4d4c52(0x230)])[_0x4d4c52(0x22e)](_0x4d4c52(0x24b));return _0x4d4c52(0x1d7)+_0x301f6b;}catch(_0x2e1a2e){throw new common_1['HttpException'](_0x2e1a2e[_0x4d4c52(0x247)],common_1[_0x4d4c52(0x223)][_0x4d4c52(0x20b)]);}}async[_0x411e48(0x246)](_0x5b2566){const _0x267895=_0x411e48;try{const _0x3efd91=await axios_1[_0x267895(0x22f)][_0x267895(0x268)](_0x5b2566,{'responseType':'arraybuffer'}),_0x2f9e56=_0x5b2566[_0x267895(0x1da)]('/')[_0x267895(0x237)]()[_0x267895(0x1da)]('?')[0x0],_0x4c1924=await this['uploadFile']({'filename':_0x2f9e56,'buffer':_0x3efd91[_0x267895(0x230)]});return _0x4c1924;}catch(_0x260948){return common_1[_0x267895(0x22a)]['error']('transferFile\x20error:\x20',_0x260948),null;}}async[_0x411e48(0x259)](_0x5f2ce9){return new Promise((_0x580f94,_0x10032e)=>{const _0x234b31=_0x1f53,_0x1be75a=_0x5f2ce9[_0x234b31(0x1e4)](_0x234b31(0x239),_0x234b31(0x229));(0x0,child_process_1[_0x234b31(0x1e9)])(_0x234b31(0x1fa)+_0x5f2ce9+'\x20-y\x20-f\x20image2\x20-ss\x202\x20-frames:v\x201\x20-update\x20true\x20'+_0x1be75a+_0x234b31(0x226),function(_0x64a150,_0x55f7b3,_0x524aa6){const _0x4623ae=_0x234b31;_0x64a150?(console[_0x4623ae(0x25a)](_0x524aa6),_0x10032e(_0x64a150)):_0x580f94(_0x1be75a);});});}async[_0x411e48(0x207)](_0x35247b){const _0x2602cc=_0x411e48;let _0x3f7d6e=null,_0x327d3=null;try{const _0x3d156f=await axios_1['default'][_0x2602cc(0x268)](_0x35247b,{'responseType':_0x2602cc(0x203)}),_0x14d0ed=_0x35247b[_0x2602cc(0x1da)]('/')[_0x2602cc(0x237)](),[_0x21111f,_0x5cc5ed]=await this[_0x2602cc(0x250)]({'filename':_0x14d0ed,'buffer':_0x3d156f['data'],'dir':'ai'}),_0x50c3b3=await this['getCover'](_0x5cc5ed);let {aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this['globalConfigService'][_0x2602cc(0x243)](['tencentCosStatus','aliOssStatus','cheveretoStatus']);aliOssStatus=Number(aliOssStatus),cheveretoStatus=Number(cheveretoStatus),tencentCosStatus=Number(tencentCosStatus);if(aliOssStatus||cheveretoStatus||tencentCosStatus){console[_0x2602cc(0x25a)](_0x2602cc(0x1d5)),_0x3f7d6e=await this['uploadFile']({'filename':_0x14d0ed,'buffer':_0x3d156f[_0x2602cc(0x230)]});const _0x3b5e4a=(0x0,fs_1[_0x2602cc(0x204)])(_0x50c3b3);_0x327d3=await this[_0x2602cc(0x257)]({'filename':_0x14d0ed['replace'](/mp4$/,_0x2602cc(0x236)),'buffer':_0x3b5e4a}),(0x0,fs_1[_0x2602cc(0x1f3)])(_0x5cc5ed),(0x0,fs_1['rmSync'])(_0x50c3b3);}else _0x3f7d6e=_0x21111f,_0x327d3=_0x21111f[_0x2602cc(0x1e4)](_0x2602cc(0x239),_0x2602cc(0x229));return[_0x3f7d6e,_0x327d3];}catch(_0x1c6a9e){return common_1[_0x2602cc(0x22a)][_0x2602cc(0x1fd)](_0x2602cc(0x219),_0x1c6a9e),[null,null];}}async[_0x411e48(0x1d8)](_0x55f282,_0x57d42f){const _0x2e27c6=_0x411e48,_0x5d6a47=redisKey_constant_1[_0x2e27c6(0x20f)]+_0x55f282;try{const _0x2004fa=await this[_0x2e27c6(0x263)][_0x2e27c6(0x268)]({'key':_0x5d6a47});if(_0x2004fa)return;this[_0x2e27c6(0x263)][_0x2e27c6(0x24d)]({'key':_0x5d6a47,'val':_0x2e27c6(0x24a)});const _0x4903f3=await axios_1['default'][_0x2e27c6(0x268)](_0x57d42f,{'responseType':_0x2e27c6(0x203)}),{width:_0x5f245e,height:_0x839bb}=await(0x0,image_size_1['default'])(_0x4903f3[_0x2e27c6(0x230)]);!store_1[_0x2e27c6(0x234)][_0x2e27c6(0x24c)]&&(_0x57d42f=await this['uploadFile']({'filename':_0x2e27c6(0x255)+_0x55f282+_0x2e27c6(0x23a),'buffer':_0x4903f3[_0x2e27c6(0x230)]})),await this['midjourneyEntity'][_0x2e27c6(0x1d9)]({'id':_0x55f282,'imageUrl':_0x57d42f,'fileInfo':JSON['stringify']({'width':_0x5f245e,'height':_0x839bb})});}catch(_0x5ad51e){common_1['Logger'][_0x2e27c6(0x1fd)](_0x5d6a47,'：',_0x5ad51e);}finally{this[_0x2e27c6(0x263)][_0x2e27c6(0x244)]({'key':_0x5d6a47});}}};FileService=__decorate([(0x0,common_1[_0x411e48(0x265)])(),__param(0x0,(0x0,typeorm_1[_0x411e48(0x23d)])(midjourney_entity_1[_0x411e48(0x231)])),__metadata(_0x411e48(0x20a),[typeorm_2[_0x411e48(0x238)],globalConfig_service_1[_0x411e48(0x214)],redisCache_service_1['RedisCacheService']])],FileService),exports[_0x411e48(0x22d)]=FileService;