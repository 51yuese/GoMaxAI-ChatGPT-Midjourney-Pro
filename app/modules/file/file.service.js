'use strict';const _0x3d2d1d=_0xb91c;function _0x3953(){const _0x56f509=['mjNotSaveImg','path','query','pop','RedisCacheService','getModalImgById','function','removeSpecialCharacters','append','tencentCosStatus','aliOssAccessKeySecret','error','ali-oss','ali','402RlYrIQ','162215AYDSWP','end','transferImg','length','stringify','axios','https://$2','readFileSync','transferFile\x20error:\x20','HttpException','putObject','Location','uploadFile','616PvuCsD','445150murpSd','arraybuffer','getUploadConfig','\x0a\x20\x20\x20\x20\x20\x20\x20\x20ffmpeg\x20-i\x20','writeFile','8sAweJm','error:\x20','@nestjs/common','base64','616080NMljCk','uploadFileByTencentCos','env','headers','InjectRepository','rmSync','put','replace','url','writeHead','Repository','midjourneyEntity','originTaskId','data','Logger','cosBucket','save','decorate','/upload/','key','toString','response','__esModule','image','binary','status','existsSync','child_process','message','ali\x20开始上传','transferAndCover','__param','lock','GlobalConfigService','14371CgBcES','MidjourneyEntity','uploadFileByAliOss','tencentCos','imageUrl','__decorate','findOne','metadata','请先前往后台配置上传图片的方式','createRandomUid','13050wZbDVV','set','aliOssStatus','上传图片失败[Chevereto|buffer]\x20-->\x20','aliOssBucket','http','https://','tencent','getConfigByKeys','上传图片失败[ali]','.mp4','uploadFileByChevereto','../../common/constants/redisKey.constant','@nestjs/typeorm','.jpg','image-size','application/json;charset=UTF-8','STANDARD','onModuleInit','MjConfig','fs/promises','/upload','chevereto','uploadFileByLocal','aliCos','post','上传图片失败[Chevereto]','downFile','29592UmJQIt','138216ANvWXI','mj-','upload2Local','cheveretoStatus','log','cheveretoKey','globalConfigService','getCover','FileService','cwd','aliOssAccessKeyId','cosSecretKey','需要转存到云','BAD_REQUEST','split','taskId','getOwnPropertyDescriptor','join','234ZMfggZ','default','HttpStatus','tencentCosAcceleratedDomain','../../common/utils','__metadata','jpg','cosSecretId','get','Injectable','transferAndCover\x20error:\x20','defineProperty','../redisCache/redisCache.service','.png','80BdGJsT','object','redisCacheService'];_0x3953=function(){return _0x56f509;};return _0x3953();}(function(_0x109150,_0xe9322c){const _0x2d6449=_0xb91c,_0x2074d1=_0x109150();while(!![]){try{const _0x3c1bde=-parseInt(_0x2d6449(0x1b5))/0x1*(parseInt(_0x2d6449(0x1c8))/0x2)+parseInt(_0x2d6449(0x13a))/0x3+-parseInt(_0x2d6449(0x1a3))/0x4*(-parseInt(_0x2d6449(0x166))/0x5)+-parseInt(_0x2d6449(0x1b4))/0x6*(-parseInt(_0x2d6449(0x15c))/0x7)+-parseInt(_0x2d6449(0x182))/0x8*(parseInt(_0x2d6449(0x195))/0x9)+parseInt(_0x2d6449(0x1c3))/0xa+parseInt(_0x2d6449(0x1c2))/0xb*(parseInt(_0x2d6449(0x183))/0xc);if(_0x3c1bde===_0xe9322c)break;else _0x2074d1['push'](_0x2074d1['shift']());}catch(_0x37ccbe){_0x2074d1['push'](_0x2074d1['shift']());}}}(_0x3953,0x52e90));var __decorate=this&&this[_0x3d2d1d(0x161)]||function(_0x144687,_0x1a4d2d,_0xd9f25f,_0x2aa223){const _0x43d62d=_0x3d2d1d;var _0x15d407=arguments['length'],_0xcb8f96=_0x15d407<0x3?_0x1a4d2d:_0x2aa223===null?_0x2aa223=Object[_0x43d62d(0x193)](_0x1a4d2d,_0xd9f25f):_0x2aa223,_0x13bd0e;if(typeof Reflect===_0x43d62d(0x1a4)&&typeof Reflect[_0x43d62d(0x14b)]===_0x43d62d(0x1ac))_0xcb8f96=Reflect[_0x43d62d(0x14b)](_0x144687,_0x1a4d2d,_0xd9f25f,_0x2aa223);else{for(var _0x2ba4f2=_0x144687[_0x43d62d(0x1b8)]-0x1;_0x2ba4f2>=0x0;_0x2ba4f2--)if(_0x13bd0e=_0x144687[_0x2ba4f2])_0xcb8f96=(_0x15d407<0x3?_0x13bd0e(_0xcb8f96):_0x15d407>0x3?_0x13bd0e(_0x1a4d2d,_0xd9f25f,_0xcb8f96):_0x13bd0e(_0x1a4d2d,_0xd9f25f))||_0xcb8f96;}return _0x15d407>0x3&&_0xcb8f96&&Object['defineProperty'](_0x1a4d2d,_0xd9f25f,_0xcb8f96),_0xcb8f96;},__metadata=this&&this[_0x3d2d1d(0x19a)]||function(_0x20b340,_0x33332b){const _0x13296c=_0x3d2d1d;if(typeof Reflect==='object'&&typeof Reflect[_0x13296c(0x163)]===_0x13296c(0x1ac))return Reflect[_0x13296c(0x163)](_0x20b340,_0x33332b);},__param=this&&this[_0x3d2d1d(0x159)]||function(_0x1859a6,_0x21cd4b){return function(_0x14cb35,_0x23ffd0){_0x21cd4b(_0x14cb35,_0x23ffd0,_0x1859a6);};};Object[_0x3d2d1d(0x1a0)](exports,_0x3d2d1d(0x150),{'value':!![]}),exports[_0x3d2d1d(0x18b)]=void 0x0;function _0xb91c(_0x4528dc,_0x58c036){const _0x395372=_0x3953();return _0xb91c=function(_0xb91cc4,_0x10e5b3){_0xb91cc4=_0xb91cc4-0x137;let _0x3730c0=_0x395372[_0xb91cc4];return _0x3730c0;},_0xb91c(_0x4528dc,_0x58c036);}const common_1=require(_0x3d2d1d(0x138)),TENCENTCOS=require('cos-nodejs-sdk-v5'),ALIOSS=require(_0x3d2d1d(0x1b2)),axios_1=require(_0x3d2d1d(0x1ba)),image_size_1=require(_0x3d2d1d(0x175)),utils_1=require(_0x3d2d1d(0x199)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),FormData=require('form-data'),midjourney_entity_1=require('../midjourney/midjourney.entity'),typeorm_1=require(_0x3d2d1d(0x173)),typeorm_2=require('typeorm'),redisKey_constant_1=require(_0x3d2d1d(0x172)),redisCache_service_1=require(_0x3d2d1d(0x1a1)),store_1=require('../../common/store'),path_1=require(_0x3d2d1d(0x1a7)),promises_1=require(_0x3d2d1d(0x17a)),fs_1=require('fs'),child_process_1=require(_0x3d2d1d(0x155));let FileService=class FileService{constructor(_0x4f6a7c,_0x3316e1,_0x4d4920){const _0x59d1e1=_0x3d2d1d;this[_0x59d1e1(0x145)]=_0x4f6a7c,this[_0x59d1e1(0x189)]=_0x3316e1,this[_0x59d1e1(0x1a5)]=_0x4d4920;}async[_0x3d2d1d(0x178)](){const _0x50ca66=_0x3d2d1d,{tencentCosStatus:tencentCosStatus=0x0,aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0}=await this['globalConfigService'][_0x50ca66(0x16e)]([_0x50ca66(0x1af),_0x50ca66(0x168),_0x50ca66(0x186)]);!Number(tencentCosStatus)&&!Number(aliOssStatus)&&!Number(cheveretoStatus)&&common_1['Logger']['error'](_0x50ca66(0x164));if(Number(tencentCosStatus)===0x1){const {SecretId:_0xf91f3a,SecretKey:_0x80c5f9}=await this[_0x50ca66(0x1c5)]('tencent');this['tencentCos']=new TENCENTCOS({'SecretId':_0xf91f3a,'SecretKey':_0x80c5f9,'FileParallelLimit':0xa});}if(Number(aliOssStatus)===0x1){const {region:_0x35db9a,bucket:_0x51f2ff,accessKeyId:_0x3b3244,accessKeySecret:_0x187e52}=await this[_0x50ca66(0x1c5)](_0x50ca66(0x1b3));this[_0x50ca66(0x17e)]=new ALIOSS({'region':(0x0,utils_1[_0x50ca66(0x1ad)])(_0x35db9a),'accessKeyId':_0x3b3244,'accessKeySecret':_0x187e52,'bucket':(0x0,utils_1[_0x50ca66(0x1ad)])(_0x51f2ff)});}}async[_0x3d2d1d(0x1c5)](_0x5b2a1f){const _0x27d22d=_0x3d2d1d;if(_0x5b2a1f===_0x27d22d(0x1b3)){const {aliOssRegion:_0x82a8,aliOssBucket:_0xd69021,aliOssAccessKeyId:_0x1ebceb,aliOssAccessKeySecret:_0x5bdfea}=await this[_0x27d22d(0x189)]['getConfigByKeys'](['aliOssRegion',_0x27d22d(0x16a),_0x27d22d(0x18d),_0x27d22d(0x1b0)]);return{'region':_0x82a8,'bucket':_0xd69021,'accessKeyId':_0x1ebceb,'accessKeySecret':_0x5bdfea};}if(_0x5b2a1f===_0x27d22d(0x16d)){const {cosBucket:_0x3d4586,cosRegion:_0x3209a1,cosSecretId:_0x7d5e09,cosSecretKey:_0x13ce38,tencentCosAcceleratedDomain:_0x4b6a34}=await this[_0x27d22d(0x189)][_0x27d22d(0x16e)]([_0x27d22d(0x149),'cosRegion',_0x27d22d(0x19c),_0x27d22d(0x18e),_0x27d22d(0x198)]);return{'Bucket':_0x3d4586,'Region':_0x3209a1,'SecretId':_0x7d5e09,'SecretKey':_0x13ce38,'acceleratedDomain':_0x4b6a34};}if(_0x5b2a1f===_0x27d22d(0x17c)){const {cheveretoKey:_0x3177c8,cheveretoUploadPath:_0x4e6ed9}=await this[_0x27d22d(0x189)][_0x27d22d(0x16e)]([_0x27d22d(0x188),'cheveretoUploadPath']);return{'key':_0x3177c8,'uploadPath':_0x4e6ed9};}}async[_0x3d2d1d(0x1c1)](_0x2f3a9d){const _0x46121d=_0x3d2d1d,{filename:_0x12482d,buffer:_0x35aa9d,dir:dir='ai'}=_0x2f3a9d,{aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this['globalConfigService'][_0x46121d(0x16e)](['tencentCosStatus',_0x46121d(0x168),'cheveretoStatus']);if(Number(tencentCosStatus)===0x1)return this[_0x46121d(0x13b)]({'filename':_0x12482d,'buffer':_0x35aa9d,'dir':dir});if(Number(aliOssStatus)===0x1)return this[_0x46121d(0x15e)]({'filename':_0x12482d,'buffer':_0x35aa9d,'dir':dir});if(Number(cheveretoStatus)){const {filename:_0x179ecb,buffer:_0x44ab37,dir:_0x2ba031}=_0x2f3a9d;return this[_0x46121d(0x171)]({'filename':_0x179ecb,'buffer':_0x44ab37[_0x46121d(0x14e)](_0x46121d(0x139)),'dir':_0x2ba031});}const [_0x2e8ff5,_0x33ec93]=await this['uploadFileByLocal']({'filename':_0x12482d,'buffer':_0x35aa9d,'dir':dir});return _0x2e8ff5;}async[_0x3d2d1d(0x185)](_0x15baca){const _0x166a8c=_0x3d2d1d,{filename:_0x3a5573,buffer:_0x5b59f4,dir:dir='ai'}=_0x15baca,[_0x305542,_0xce92a0]=await this[_0x166a8c(0x17d)]({'filename':_0x3a5573,'buffer':_0x5b59f4,'dir':dir});return _0x305542;}async[_0x3d2d1d(0x13b)]({filename:_0xbe6ba2,buffer:_0x5e5eab,dir:_0x5d3ba5}){const _0x255a23=_0x3d2d1d;try{const {Bucket:_0x2f8d0c,Region:_0x3b42cc,SecretId:_0x400776,SecretKey:_0x3418a6}=await this[_0x255a23(0x1c5)](_0x255a23(0x16d));!this[_0x255a23(0x15f)]&&(this[_0x255a23(0x15f)]=new TENCENTCOS({'SecretId':_0x400776,'SecretKey':_0x3418a6,'FileParallelLimit':0xa}));const _0x42eeba=await this[_0x255a23(0x15f)][_0x255a23(0x1bf)]({'Bucket':(0x0,utils_1[_0x255a23(0x1ad)])(_0x2f8d0c),'Region':(0x0,utils_1[_0x255a23(0x1ad)])(_0x3b42cc),'Key':_0x5d3ba5+'/'+(_0xbe6ba2||(0x0,utils_1[_0x255a23(0x165)])()+_0x255a23(0x1a2)),'StorageClass':_0x255a23(0x177),'Body':_0x5e5eab});let _0x4ba181=_0x42eeba[_0x255a23(0x1c0)][_0x255a23(0x141)](/^(http:\/\/|https:\/\/|\/\/|)(.*)/,_0x255a23(0x1bb));const {acceleratedDomain:_0x1a0c15}=await this[_0x255a23(0x1c5)](_0x255a23(0x16d));return _0x1a0c15&&(_0x4ba181=_0x4ba181[_0x255a23(0x141)](/^(https:\/\/[^/]+)(\/.*)$/,'https://'+_0x1a0c15+'$2'),console[_0x255a23(0x187)]('当前已开启全球加速----------------->',_0x4ba181)),_0x4ba181;}catch(_0x1a6026){console[_0x255a23(0x187)]('error:\x20',_0x1a6026);throw new common_1[(_0x255a23(0x1be))]('上传图片失败[ten]',common_1[_0x255a23(0x197)][_0x255a23(0x190)]);}}async[_0x3d2d1d(0x15e)]({filename:_0x4ec1cf,buffer:_0x4b2257,dir:_0x43edee}){const _0x57868c=_0x3d2d1d;if(!this['aliCos']){const {region:_0x51d7ef,bucket:_0x1fe3bd,accessKeyId:_0x25165a,accessKeySecret:_0x4992fb}=await this[_0x57868c(0x1c5)](_0x57868c(0x1b3));this['aliCos']=new ALIOSS({'region':(0x0,utils_1[_0x57868c(0x1ad)])(_0x51d7ef),'accessKeyId':_0x25165a,'accessKeySecret':_0x4992fb,'bucket':(0x0,utils_1['removeSpecialCharacters'])(_0x1fe3bd)});}try{console['log'](_0x57868c(0x157));const _0x61a747=await this[_0x57868c(0x17e)][_0x57868c(0x140)](_0x43edee+'/'+(_0x4ec1cf||(0x0,utils_1[_0x57868c(0x165)])()+'.png'),_0x4b2257);return _0x61a747[_0x57868c(0x142)];}catch(_0x4264b4){throw new common_1[(_0x57868c(0x1be))](_0x57868c(0x16f),common_1['HttpStatus'][_0x57868c(0x190)]);}}async[_0x3d2d1d(0x171)]({filename:filename='',buffer:_0xeb0109,dir:dir='ai'}){const _0x288ee6=_0x3d2d1d,{key:_0x2e75d9,uploadPath:_0x22001a}=await this['getUploadConfig'](_0x288ee6(0x17c)),_0x9b1e2c=new FormData();_0x9b1e2c['append']('source',_0xeb0109[_0x288ee6(0x14e)]('base64')),_0x9b1e2c[_0x288ee6(0x1ae)](_0x288ee6(0x14d),_0x2e75d9);try{const _0x2e68ed=await axios_1[_0x288ee6(0x196)][_0x288ee6(0x17f)](_0x22001a,_0x9b1e2c,{'headers':{'X-API-Key':_0x2e75d9},'timeout':0xa*0x3c*0x3e8});if(_0x2e68ed?.[_0x288ee6(0x153)]===0xc8)return _0x2e68ed[_0x288ee6(0x147)][_0x288ee6(0x151)][_0x288ee6(0x142)];else{common_1[_0x288ee6(0x148)]['error']('上传图片失败[Chevereto]',JSON[_0x288ee6(0x1b9)](_0x2e68ed[_0x288ee6(0x147)]));throw new Error(_0x288ee6(0x180));}}catch(_0x5b1d1a){console['log'](_0x288ee6(0x137),_0x5b1d1a['response']);throw new common_1[(_0x288ee6(0x1be))](_0x288ee6(0x169)+_0x5b1d1a[_0x288ee6(0x14f)]?.[_0x288ee6(0x147)][_0x288ee6(0x1b1)][_0x288ee6(0x156)],common_1[_0x288ee6(0x197)][_0x288ee6(0x190)]);}}async[_0x3d2d1d(0x17d)]({filename:_0x40391a,buffer:_0x19efc,dir:_0x3bbd4d}){const _0x1613ab=_0x3d2d1d;let _0x572f30=(0x0,path_1[_0x1613ab(0x194)])(process[_0x1613ab(0x18c)](),'webroot','upload'),_0x290337=_0x1613ab(0x17b),_0xb5753='';_0x3bbd4d&&(_0x572f30=(0x0,path_1[_0x1613ab(0x194)])(_0x572f30,_0x3bbd4d),_0x290337=_0x1613ab(0x14c)+_0x3bbd4d);_0x290337=_0x290337+'/'+_0x40391a;!(0x0,fs_1[_0x1613ab(0x154)])(_0x572f30)&&(0x0,fs_1['mkdirSync'])(_0x572f30,{'recursive':!![]});_0x572f30=(0x0,path_1['join'])(_0x572f30,_0x40391a),await(0x0,promises_1[_0x1613ab(0x1c7)])(_0x572f30,_0x19efc);let _0x1e7c7a=process[_0x1613ab(0x13c)]['GOMAXAI_HOST'];return _0x1e7c7a['startsWith'](_0x1613ab(0x16b))?_0xb5753=_0x1e7c7a+_0x290337:_0xb5753=_0x1613ab(0x16c)+_0x1e7c7a+_0x290337,[_0xb5753,_0x572f30];}async[_0x3d2d1d(0x181)](_0x3cb39e,_0xb1fa97,_0x38f45f){const _0xc42f84=_0x3d2d1d;try{const _0xb3a602=_0x3cb39e[_0xc42f84(0x191)]('/')['pop'](),_0x3911ea=await(0x0,axios_1[_0xc42f84(0x196)])(_0x3cb39e,{'headers':{'Content-Type':_0xc42f84(0x176)},'responseType':_0xc42f84(0x1c4),'timeout':0x493e0});_0x38f45f[_0xc42f84(0x143)](0xc8,{'Content-Type':_0x3911ea[_0xc42f84(0x13d)]['content-type'],'Content-Disposition':_0xb3a602}),_0x38f45f[_0xc42f84(0x1b6)](_0x3911ea[_0xc42f84(0x147)],_0xc42f84(0x152));}catch(_0x1e5c18){throw new common_1[(_0xc42f84(0x1be))](_0x1e5c18[_0xc42f84(0x156)],common_1[_0xc42f84(0x197)][_0xc42f84(0x190)]);}}async[_0x3d2d1d(0x1ab)](_0x3b1348){const _0x168b97=_0x3d2d1d;try{const _0x1370e1=await this[_0x168b97(0x145)][_0x168b97(0x162)]({'where':{'id':Number(_0x3b1348[_0x168b97(0x1a8)][_0x168b97(0x192)])}});let _0x160ba9;if(_0x1370e1[_0x168b97(0x160)])_0x160ba9=_0x1370e1[_0x168b97(0x160)];else{const _0x3dd279=await this[_0x168b97(0x145)]['findOne']({'where':{'id':Number(_0x1370e1[_0x168b97(0x146)])}});_0x160ba9=_0x3dd279[_0x168b97(0x160)];}if(!_0x160ba9)throw new Error('任务原始图片获取失败');const _0x4a33ff=await axios_1[_0x168b97(0x196)][_0x168b97(0x19d)](_0x160ba9,{'responseType':'arraybuffer'}),_0x57fed6=Buffer['from'](_0x4a33ff[_0x168b97(0x147)])[_0x168b97(0x14e)](_0x168b97(0x139));return'data:image/jpeg;base64,'+_0x57fed6;}catch(_0x3ee885){throw new common_1[(_0x168b97(0x1be))](_0x3ee885[_0x168b97(0x156)],common_1[_0x168b97(0x197)][_0x168b97(0x190)]);}}async['transferFile'](_0xb793f0){const _0x1869ee=_0x3d2d1d;try{const _0x48d1ca=await axios_1[_0x1869ee(0x196)][_0x1869ee(0x19d)](_0xb793f0,{'responseType':_0x1869ee(0x1c4)}),_0x52c040=_0xb793f0[_0x1869ee(0x191)]('/')['pop']()[_0x1869ee(0x191)]('?')[0x0],_0x125371=await this[_0x1869ee(0x1c1)]({'filename':_0x52c040,'buffer':_0x48d1ca['data']});return _0x125371;}catch(_0x41fdc1){return common_1[_0x1869ee(0x148)][_0x1869ee(0x1b1)](_0x1869ee(0x1bd),_0x41fdc1),null;}}async['getCover'](_0x4a973a){return new Promise((_0x55d4e5,_0x231b14)=>{const _0x1a14f1=_0xb91c,_0x2c2637=_0x4a973a[_0x1a14f1(0x141)](_0x1a14f1(0x170),_0x1a14f1(0x174));(0x0,child_process_1['exec'])(_0x1a14f1(0x1c6)+_0x4a973a+'\x20-y\x20-f\x20image2\x20-ss\x202\x20-frames:v\x201\x20-update\x20true\x20'+_0x2c2637+'\x0a\x20\x20\x20\x20\x20\x20',function(_0x6b5173,_0x258a30,_0x543e82){_0x6b5173?(console['log'](_0x543e82),_0x231b14(_0x6b5173)):_0x55d4e5(_0x2c2637);});});}async[_0x3d2d1d(0x158)](_0x5af140){const _0x4920d1=_0x3d2d1d;let _0x1775b7=null,_0x4f91b5=null;try{const _0x335f26=await axios_1[_0x4920d1(0x196)][_0x4920d1(0x19d)](_0x5af140,{'responseType':_0x4920d1(0x1c4)}),_0x17cfde=_0x5af140[_0x4920d1(0x191)]('/')[_0x4920d1(0x1a9)](),[_0x5678c2,_0x40c976]=await this[_0x4920d1(0x17d)]({'filename':_0x17cfde,'buffer':_0x335f26['data'],'dir':'ai'}),_0x4ec970=await this[_0x4920d1(0x18a)](_0x40c976);let {aliOssStatus:aliOssStatus=0x0,cheveretoStatus:cheveretoStatus=0x0,tencentCosStatus:tencentCosStatus=0x0}=await this[_0x4920d1(0x189)]['getConfigByKeys']([_0x4920d1(0x1af),_0x4920d1(0x168),'cheveretoStatus']);aliOssStatus=Number(aliOssStatus),cheveretoStatus=Number(cheveretoStatus),tencentCosStatus=Number(tencentCosStatus);if(aliOssStatus||cheveretoStatus||tencentCosStatus){console[_0x4920d1(0x187)](_0x4920d1(0x18f)),_0x1775b7=await this['uploadFile']({'filename':_0x17cfde,'buffer':_0x335f26['data']});const _0x3e5df5=(0x0,fs_1[_0x4920d1(0x1bc)])(_0x4ec970);_0x4f91b5=await this['uploadFile']({'filename':_0x17cfde[_0x4920d1(0x141)](/mp4$/,_0x4920d1(0x19b)),'buffer':_0x3e5df5}),(0x0,fs_1[_0x4920d1(0x13f)])(_0x40c976),(0x0,fs_1[_0x4920d1(0x13f)])(_0x4ec970);}else _0x1775b7=_0x5678c2,_0x4f91b5=_0x5678c2['replace'](_0x4920d1(0x170),_0x4920d1(0x174));return[_0x1775b7,_0x4f91b5];}catch(_0x32e694){return common_1[_0x4920d1(0x148)][_0x4920d1(0x1b1)](_0x4920d1(0x19f),_0x32e694),[null,null];}}async[_0x3d2d1d(0x1b7)](_0x2f2158,_0x3746d6){const _0xe4d9c3=_0x3d2d1d,_0x3b824c=redisKey_constant_1['MJ_IMG_TRANSFER']+_0x2f2158;try{const _0x87b03d=await this[_0xe4d9c3(0x1a5)]['get']({'key':_0x3b824c});if(_0x87b03d)return;this[_0xe4d9c3(0x1a5)][_0xe4d9c3(0x167)]({'key':_0x3b824c,'val':_0xe4d9c3(0x15a)});const _0x1290b8=await axios_1[_0xe4d9c3(0x196)][_0xe4d9c3(0x19d)](_0x3746d6,{'responseType':_0xe4d9c3(0x1c4)}),{width:_0x282dad,height:_0x3de8ca}=await(0x0,image_size_1['default'])(_0x1290b8['data']);!store_1[_0xe4d9c3(0x179)][_0xe4d9c3(0x1a6)]&&(_0x3746d6=await this[_0xe4d9c3(0x1c1)]({'filename':_0xe4d9c3(0x184)+_0x2f2158+_0xe4d9c3(0x1a2),'buffer':_0x1290b8[_0xe4d9c3(0x147)]})),await this['midjourneyEntity'][_0xe4d9c3(0x14a)]({'id':_0x2f2158,'imageUrl':_0x3746d6,'fileInfo':JSON[_0xe4d9c3(0x1b9)]({'width':_0x282dad,'height':_0x3de8ca})});}catch(_0x729a21){common_1[_0xe4d9c3(0x148)][_0xe4d9c3(0x1b1)](_0x3b824c,'：',_0x729a21);}finally{this[_0xe4d9c3(0x1a5)]['del']({'key':_0x3b824c});}}};FileService=__decorate([(0x0,common_1[_0x3d2d1d(0x19e)])(),__param(0x0,(0x0,typeorm_1[_0x3d2d1d(0x13e)])(midjourney_entity_1[_0x3d2d1d(0x15d)])),__metadata('design:paramtypes',[typeorm_2[_0x3d2d1d(0x144)],globalConfig_service_1[_0x3d2d1d(0x15b)],redisCache_service_1[_0x3d2d1d(0x1aa)]])],FileService),exports[_0x3d2d1d(0x18b)]=FileService;