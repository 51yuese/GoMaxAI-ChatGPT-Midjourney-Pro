'use strict';function _0x351e(_0x54d051,_0x1d23c5){const _0x50bf50=_0x50bf();return _0x351e=function(_0x351ebe,_0x401d0a){_0x351ebe=_0x351ebe-0xef;let _0x1a9062=_0x50bf50[_0x351ebe];return _0x1a9062;},_0x351e(_0x54d051,_0x1d23c5);}const _0x487d0a=_0x351e;(function(_0x3e3200,_0x17beb1){const _0x596ec1=_0x351e,_0x221ec1=_0x3e3200();while(!![]){try{const _0xbf7791=-parseInt(_0x596ec1(0xf4))/0x1+-parseInt(_0x596ec1(0x129))/0x2*(-parseInt(_0x596ec1(0x165))/0x3)+-parseInt(_0x596ec1(0x13d))/0x4*(-parseInt(_0x596ec1(0x15f))/0x5)+parseInt(_0x596ec1(0x143))/0x6+parseInt(_0x596ec1(0x128))/0x7*(parseInt(_0x596ec1(0xf8))/0x8)+-parseInt(_0x596ec1(0x182))/0x9*(-parseInt(_0x596ec1(0x15c))/0xa)+parseInt(_0x596ec1(0x13f))/0xb*(-parseInt(_0x596ec1(0xf5))/0xc);if(_0xbf7791===_0x17beb1)break;else _0x221ec1['push'](_0x221ec1['shift']());}catch(_0xeb00b6){_0x221ec1['push'](_0x221ec1['shift']());}}}(_0x50bf,0x99e51));var __decorate=this&&this[_0x487d0a(0x15b)]||function(_0x5660f5,_0x33b426,_0x4905aa,_0x6c915e){const _0x373748=_0x487d0a;var _0x17d415=arguments['length'],_0x2f082b=_0x17d415<0x3?_0x33b426:_0x6c915e===null?_0x6c915e=Object['getOwnPropertyDescriptor'](_0x33b426,_0x4905aa):_0x6c915e,_0x6190cb;if(typeof Reflect===_0x373748(0x11e)&&typeof Reflect['decorate']===_0x373748(0x16a))_0x2f082b=Reflect[_0x373748(0x135)](_0x5660f5,_0x33b426,_0x4905aa,_0x6c915e);else{for(var _0x2c7a3f=_0x5660f5[_0x373748(0x150)]-0x1;_0x2c7a3f>=0x0;_0x2c7a3f--)if(_0x6190cb=_0x5660f5[_0x2c7a3f])_0x2f082b=(_0x17d415<0x3?_0x6190cb(_0x2f082b):_0x17d415>0x3?_0x6190cb(_0x33b426,_0x4905aa,_0x2f082b):_0x6190cb(_0x33b426,_0x4905aa))||_0x2f082b;}return _0x17d415>0x3&&_0x2f082b&&Object[_0x373748(0x132)](_0x33b426,_0x4905aa,_0x2f082b),_0x2f082b;},__metadata=this&&this[_0x487d0a(0x114)]||function(_0x2893c9,_0x3ffbe5){const _0x32d622=_0x487d0a;if(typeof Reflect===_0x32d622(0x11e)&&typeof Reflect[_0x32d622(0x152)]===_0x32d622(0x16a))return Reflect[_0x32d622(0x152)](_0x2893c9,_0x3ffbe5);},__param=this&&this[_0x487d0a(0x184)]||function(_0xea1a56,_0x4aa887){return function(_0x5aee95,_0x15c0af){_0x4aa887(_0x5aee95,_0x15c0af,_0xea1a56);};};function _0x50bf(){const _0x3e5b53=['../user/user.service','redisCacheService','key','findAndCount','then','keyPoolIndexMap','sort','length','__esModule','metadata','error:\x20','find','/v1/models','deepthink','HttpException','VIP_FREE','lifetimeVip','keyType','__decorate','5156530BKSHBU','getAccessToken','log','1795MFVDPa','saveUseLog','keyList','proxyUrl','set','Bearer\x20sk-bSm3FROxNJ1oIkmd5dDc9b582d3d48E09d12E86eF7FfC0C4','6fUKBPR','delete','error','./models.entity','./modelquick.entity','function','modelMaps','ModelsService','缺失必要参数！','keyPoolMap','design:paramtypes','map','secret','../../common/constants/status.constant','https://apiv.chatgpt-3.vip','HttpStatus','nestjs-cls','forEach','hideString','initCalcKey','暂未配置相关模型，请联系管理员！','modelDel','createQueryBuilder','model','quickIds','clsService','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','modelName','split','9mVWVGn','userService','__param','当前未指定语音对话模型KEY、前往后台设置把！','getModelById','execute','save','useCount\x20+\x201','996238iqbGbz','456osFzMR','modelType','canUpload','5410904PCILqz','getAllKey','DESC','useToken\x20+\x20','../redisCache/redisCache.service','findOne','ClsService','名称已存在，请修改名称','modelsEntity','暂未配置音乐模型，请联系管理员','deepClone','floor','data','getUserId','toString','MUSIC','../../common/utils','isQuick','getModelByName','lockKey','Repository','quickList','push','getModelByKeyType','当前调用模型已经被移除、请重新选择模型！','getModelsByModelType','update','RedisCacheService','__metadata','ModelsMapCn','Like','where','getRole','getMusicModel','getUserById','get','message','BAD_REQUEST','object','当前未指定特殊模型KEY、前往后台设置！','front','displaySort','includes','getModelByModel','val','typeorm','vipExpire','Logger','7WzmhXf','492026BogMwn','getCurrentModelKeyInfo','UserService','Not','isSuper','../chatgpt/baidu','json','recommend','random','defineProperty','getRandomKey','getModelByType','decorate','modelsList','ModelQuickEntity','modelQuickEntity','getModel','ModelsEntity','getRandomAudioKey','refreshBaiduAccesstoken','2876GrZNRK','@nestjs/typeorm','433103pPfuSS','key:\x20','setModel','keys','7083612lsPnyf','filter','status','modelTypes','keyStatus','id\x20=\x20:id'];_0x50bf=function(){return _0x3e5b53;};return _0x50bf();}Object[_0x487d0a(0x132)](exports,_0x487d0a(0x151),{'value':!![]}),exports[_0x487d0a(0x16c)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x487d0a(0x13e)),typeorm_2=require(_0x487d0a(0x125)),models_entity_1=require(_0x487d0a(0x168)),status_constant_1=require(_0x487d0a(0x172)),baidu_1=require(_0x487d0a(0x12e)),utils_1=require(_0x487d0a(0x108)),model_constant_1=require('../../common/constants/model.constant'),redisCache_service_1=require(_0x487d0a(0xfc)),user_service_1=require(_0x487d0a(0x149)),redisKey_constant_1=require('../../common/constants/redisKey.constant'),nestjs_cls_1=require(_0x487d0a(0x175)),modelquick_entity_1=require(_0x487d0a(0x169));let ModelsService=class ModelsService{constructor(_0x2b0d3b,_0x52cfbe,_0x2999ca,_0xa33ecc,_0x3f80a9){const _0x196f86=_0x487d0a;this['modelsEntity']=_0x2b0d3b,this[_0x196f86(0x138)]=_0x52cfbe,this['clsService']=_0x2999ca,this[_0x196f86(0x183)]=_0xa33ecc,this[_0x196f86(0x14a)]=_0x3f80a9,this['modelTypes']=[],this['modelMaps']={},this[_0x196f86(0x161)]={},this[_0x196f86(0x16e)]={},this[_0x196f86(0x14e)]={};}async['onModuleInit'](){const _0x1ad027=_0x487d0a;await this[_0x1ad027(0x178)](),await this[_0x1ad027(0x13c)]();}async['getOfficialModels'](){const _0x397283=_0x487d0a,_0x3c5b9f=_0x397283(0x173),_0x5cd1a6=_0x3c5b9f+_0x397283(0x155);return await fetch(_0x5cd1a6,{'method':_0x397283(0x11b),'headers':{'Authorization':_0x397283(0x164)}})[_0x397283(0x14d)](async _0x2b8576=>{const _0x20a7c5=_0x397283,_0x51f7c7=await _0x2b8576[_0x20a7c5(0x12f)]();return _0x51f7c7[_0x20a7c5(0x104)];});}async[_0x487d0a(0x178)](){const _0x4f20f4=_0x487d0a;this[_0x4f20f4(0x16e)]={},this[_0x4f20f4(0x14e)]={},this[_0x4f20f4(0x161)]={},this[_0x4f20f4(0x16b)]={},this[_0x4f20f4(0x146)]=[];const _0x3ca4ee=await this[_0x4f20f4(0x100)]['find']({'where':{'status':!![]}}),_0x56028d=await this[_0x4f20f4(0x138)][_0x4f20f4(0x154)]({'where':{'isRelease':0x1}}),_0x482346=_0x3ca4ee['reduce']((_0x103167,_0x247080)=>{const _0x56e84d=_0x4f20f4,_0xd2af2={..._0x247080};return _0xd2af2[_0x56e84d(0x10d)]=[],_0x247080[_0x56e84d(0x109)]===0x1&&_0x247080['quickIds']&&_0x247080[_0x56e84d(0x17d)][_0x56e84d(0x150)]&&(_0xd2af2['quickList']=_0x56028d['filter'](_0x3576ed=>_0x247080[_0x56e84d(0x17d)]['split'](',')['includes'](_0x3576ed['id'][_0x56e84d(0x106)]()))),!_0x103167[_0xd2af2[_0x56e84d(0x15a)]]?_0x103167[_0xd2af2['keyType']]=[_0xd2af2]:_0x103167[_0xd2af2['keyType']]['push'](_0xd2af2),_0x103167;},{});this[_0x4f20f4(0x146)]=Object[_0x4f20f4(0x142)](_0x482346)[_0x4f20f4(0x170)](_0x2dd97c=>{const _0xd8c637=_0x4f20f4;return{'label':status_constant_1[_0xd8c637(0x115)][_0x2dd97c],'val':_0x2dd97c};}),this['modelMaps']=_0x482346,this[_0x4f20f4(0x161)]={},_0x3ca4ee['forEach'](_0x2c45b5=>{const _0x125d7d=_0x4f20f4,{keyType:_0x294555,model:_0xbc6fad,keyWeight:_0x157a6a}=_0x2c45b5;if(!this[_0x125d7d(0x16e)][_0xbc6fad])this[_0x125d7d(0x16e)][_0xbc6fad]=[];for(let _0x4e29fb=0x0;_0x4e29fb<_0x157a6a;_0x4e29fb++){this[_0x125d7d(0x16e)][_0xbc6fad][_0x125d7d(0x10e)](_0x2c45b5);}if(!this[_0x125d7d(0x14e)][_0xbc6fad])this[_0x125d7d(0x14e)][_0xbc6fad]=0x0;if(!this[_0x125d7d(0x161)][_0x294555])this[_0x125d7d(0x161)][_0x294555]={};if(!this['keyList'][_0x294555][_0xbc6fad])this[_0x125d7d(0x161)][_0x294555][_0xbc6fad]=[];this[_0x125d7d(0x161)][_0x294555][_0xbc6fad][_0x125d7d(0x10e)](_0x2c45b5);});}async[_0x487d0a(0x10b)](_0x267581,_0x4e15ef,_0x5d9e8b=-0x1){const _0x18ddc6=_0x487d0a,_0x36067c=await this[_0x18ddc6(0x100)]['update']({'id':_0x267581},{'status':![],'keyStatus':_0x5d9e8b,'remark':_0x4e15ef});common_1[_0x18ddc6(0x127)][_0x18ddc6(0x167)](_0x18ddc6(0x140)+_0x267581+_0x18ddc6(0x17f)),await this[_0x18ddc6(0x178)]();}async[_0x487d0a(0x10a)](_0x283d1a){const _0x5bae38=_0x487d0a;return this[_0x5bae38(0x100)][_0x5bae38(0xfd)]({'where':{'modelName':_0x283d1a}});}async[_0x487d0a(0x123)](_0x1e268b){const _0x290e45=_0x487d0a;return this[_0x290e45(0x100)][_0x290e45(0xfd)]({'where':{'model':_0x1e268b}});}async[_0x487d0a(0x10f)](_0x424ccf,_0x4d3189){const _0x20b40f=_0x487d0a;return this['modelsEntity'][_0x20b40f(0xfd)]({'where':{'modelType':_0x424ccf,'keyType':_0x4d3189}});}async['getModelByKeyModel'](_0x3a7f1b,_0x5067d3){const _0x500c55=_0x487d0a;return this[_0x500c55(0x100)]['findOne']({'where':{'modelType':_0x3a7f1b,'model':_0x5067d3}});}async[_0x487d0a(0x12a)](_0xf9196a){const _0x3b1d9e=_0x487d0a;if(!this['keyPoolMap'][_0xf9196a])throw new common_1['HttpException'](_0x3b1d9e(0x110),common_1['HttpStatus'][_0x3b1d9e(0x11d)]);this[_0x3b1d9e(0x14e)][_0xf9196a]++;const _0x4993ff=this[_0x3b1d9e(0x14e)][_0xf9196a];if(_0x4993ff>=this[_0x3b1d9e(0x16e)][_0xf9196a][_0x3b1d9e(0x150)])this[_0x3b1d9e(0x14e)][_0xf9196a]=0x0;return this['keyPoolMap'][_0xf9196a][this[_0x3b1d9e(0x14e)][_0xf9196a]];}async['getModelInfoByKeyType'](_0x2d72a7,_0x1b127e){const _0x196209=_0x487d0a,_0x5c0a51={'modelType':_0x2d72a7,'status':!![],'keyStatus':0x1};_0x1b127e&&(_0x5c0a51['keyType']=parseInt(_0x1b127e));const _0x1aa58e=await this['modelsEntity'][_0x196209(0x154)]({'where':_0x5c0a51,'order':{'displaySort':_0x196209(0xfa)}});if(!_0x1aa58e[_0x196209(0x150)])throw new Error(_0x196209(0x179));const _0x3a571c=_0x1aa58e[0x0],_0x247df1=this[_0x196209(0x146)][_0x196209(0x154)](_0x33c344=>Number(_0x33c344[_0x196209(0x124)])===_0x3a571c['keyType']);return{'modelTypeInfo':_0x247df1,'modelInfo':{..._0x3a571c,'topN':0.8,'systemMessage':'','rounds':0x8}};}async[_0x487d0a(0x134)](_0x1f799e,_0x8acf1){const _0x24dc84=_0x487d0a,_0x30b74f={'modelType':_0x1f799e,'status':!![],'keyStatus':0x1};_0x8acf1&&(_0x30b74f['model']=_0x8acf1);const _0x536d65=await this[_0x24dc84(0x100)][_0x24dc84(0x154)]({'where':_0x30b74f,'order':{'displaySort':_0x24dc84(0xfa)}});if(!_0x536d65['length'])throw new Error(_0x24dc84(0x179));const _0x4d0379=_0x536d65[0x0],_0x806f2f=this[_0x24dc84(0x146)]['find'](_0x3218dc=>Number(_0x3218dc['val'])===_0x4d0379[_0x24dc84(0x15a)]);return{'modelTypeInfo':_0x806f2f,'modelInfo':{..._0x4d0379,'topN':0.8,'systemMessage':'','rounds':0x8}};}async[_0x487d0a(0x141)](_0x1ee65b){const _0x5ab46c=_0x487d0a;try{return await this['modelSave'](_0x1ee65b),await this[_0x5ab46c(0x178)](),_0x1ee65b[_0x5ab46c(0x15a)]===0x2&&this[_0x5ab46c(0x13c)](),!![];}catch(_0x49bb69){console[_0x5ab46c(0x15e)](_0x5ab46c(0x153),_0x49bb69);throw new common_1[(_0x5ab46c(0x157))](_0x49bb69[_0x5ab46c(0x11c)],common_1[_0x5ab46c(0x174)]['BAD_REQUEST']);}}async['modelSave'](_0x4cce72){const _0x58a9a0=_0x487d0a;_0x4cce72['status']&&(_0x4cce72[_0x58a9a0(0x147)]=0x1);if(_0x4cce72['id']){const _0x530a9f=await this[_0x58a9a0(0x100)][_0x58a9a0(0xfd)]({'where':{'id':(0x0,typeorm_2[_0x58a9a0(0x12c)])(_0x4cce72['id']),'modelName':_0x4cce72[_0x58a9a0(0x180)],'modelType':_0x4cce72[_0x58a9a0(0xf6)]}});if(_0x530a9f)throw new Error(_0x58a9a0(0xff));await this['modelsEntity'][_0x58a9a0(0x112)]({'id':_0x4cce72['id']},_0x4cce72);}else{const _0x358ccd=await this['modelsEntity'][_0x58a9a0(0xfd)]({'where':{'modelName':_0x4cce72[_0x58a9a0(0x180)],'modelType':_0x4cce72[_0x58a9a0(0xf6)]}});if(_0x358ccd)throw new Error(_0x58a9a0(0xff));await this[_0x58a9a0(0x100)][_0x58a9a0(0xf2)](_0x4cce72);}}async['delModel']({id:_0x198175}){const _0x148d82=_0x487d0a;if(!_0x198175)throw new common_1['HttpException'](_0x148d82(0x16d),common_1[_0x148d82(0x174)][_0x148d82(0x11d)]);return await this[_0x148d82(0x17a)]([_0x198175]),await this[_0x148d82(0x178)](),!![];}async[_0x487d0a(0x139)]({id:_0x79dc3f}){const _0x473520=_0x487d0a;if(!_0x79dc3f)throw new common_1[(_0x473520(0x157))](_0x473520(0x16d),common_1[_0x473520(0x174)][_0x473520(0x11d)]);return await this[_0x473520(0x100)]['findOne']({'where':{'id':_0x79dc3f}});}async['modelDel'](_0x409c87){const _0x434876=_0x487d0a;if(!_0x409c87||!_0x409c87[_0x434876(0x150)])return!![];return await this[_0x434876(0x100)][_0x434876(0x166)]({'id':(0x0,typeorm_2['In'])(_0x409c87)}),!![];}async['queryModels'](_0x2af1ad,_0xd267d8){const _0x32d8e8=_0x487d0a;try{const _0x22710d=(0x0,utils_1[_0x32d8e8(0x118)])(this['clsService']),_0x66ac93=(0x0,utils_1[_0x32d8e8(0x105)])(this[_0x32d8e8(0x17e)]),{keyType:_0x21d3e6,key:_0x447e5d,status:_0x212bb2,model:_0x4910c3,modelName:_0x345024,modelType:_0x3f5e1d,page:page=0x1,size:size=0xa,upload:_0x259be0,isAdmin:_0x33616e,deepthink:_0x12a58b,recommend:_0x1ece1c}=_0xd267d8;let _0x42739a={};_0x4910c3&&(_0x42739a[_0x32d8e8(0x17c)]=_0x4910c3);_0x1ece1c&&(_0x42739a[_0x32d8e8(0x130)]=!![]);_0x447e5d&&(_0x42739a[_0x32d8e8(0x14b)]=(0x0,typeorm_2['Like'])('%'+_0x447e5d+'%'));_0x21d3e6&&(_0x42739a[_0x32d8e8(0x15a)]=_0x21d3e6);_0x3f5e1d&&(_0x42739a['modelType']=_0x3f5e1d);_0x33616e==0x1?_0x212bb2!==undefined&&(_0x42739a[_0x32d8e8(0x145)]=_0x212bb2):_0x42739a[_0x32d8e8(0x145)]=!![];_0x345024&&(_0x42739a[_0x32d8e8(0x180)]=(0x0,typeorm_2[_0x32d8e8(0x116)])('%'+_0x345024+'%'));_0x259be0!==undefined&&(_0x42739a[_0x32d8e8(0xf7)]=Boolean(_0x259be0));_0x12a58b>-0x1&&(_0x42739a[_0x32d8e8(0x156)]=_0x12a58b);!(0x0,utils_1[_0x32d8e8(0x12d)])(this['clsService'])&&(_0x42739a[_0x32d8e8(0x120)]=!![],_0x42739a[_0x32d8e8(0x145)]=!![]);const [_0x18be62,_0x13eb78]=await this[_0x32d8e8(0x100)][_0x32d8e8(0x14c)]({'where':_0x42739a,'skip':(page-0x1)*size,'take':size,'order':{'displaySort':_0x32d8e8(0xfa),'createdAt':_0x32d8e8(0xfa)}}),_0x3b3c67=_0x18be62,_0x121ed4=await this[_0x32d8e8(0x138)][_0x32d8e8(0x154)]({'where':{'isRelease':0x1}});_0x3b3c67[_0x32d8e8(0x176)](_0x3e90fc=>{const _0xa21b98=_0x32d8e8;_0x3e90fc[_0xa21b98(0x10d)]=[],_0x3e90fc[_0xa21b98(0x109)]===0x1&&_0x3e90fc[_0xa21b98(0x17d)]&&_0x3e90fc[_0xa21b98(0x17d)][_0xa21b98(0x150)]&&(_0x3e90fc[_0xa21b98(0x10d)]=_0x121ed4[_0xa21b98(0x144)](_0x210fb1=>_0x3e90fc[_0xa21b98(0x17d)][_0xa21b98(0x181)](',')[_0xa21b98(0x122)](_0x210fb1['id'][_0xa21b98(0x106)]())));});!(0x0,utils_1[_0x32d8e8(0x12d)])(this[_0x32d8e8(0x17e)])&&_0x3b3c67[_0x32d8e8(0x176)](_0x128567=>{const _0x1019c8=_0x32d8e8;_0x128567[_0x1019c8(0x14b)]=(0x0,utils_1['hideString'])(_0x128567[_0x1019c8(0x14b)]),_0x128567[_0x1019c8(0x171)]=(0x0,utils_1['hideString'])(_0x128567[_0x1019c8(0x171)]),_0x128567[_0x1019c8(0x162)]=(0x0,utils_1[_0x1019c8(0x177)])(_0x128567[_0x1019c8(0x162)]);});if(_0x66ac93){const _0x2db5ee=await this[_0x32d8e8(0x183)][_0x32d8e8(0x11a)](_0x66ac93);if(_0x2db5ee[_0x32d8e8(0x126)]||_0x2db5ee[_0x32d8e8(0x159)]){const _0x50c8a7=[];for(let _0x692b76=0x0;_0x692b76<_0x3b3c67['length'];_0x692b76++){const _0x24a89a=_0x3b3c67[_0x692b76],_0x5f24bd=redisKey_constant_1[_0x32d8e8(0x158)]+'-'+_0x66ac93+'-'+_0x24a89a['id'],_0x5a3095=await await this['redisCacheService'][_0x32d8e8(0x11b)]({'key':_0x5f24bd});_0x50c8a7['push'](Object['assign']({},_0x24a89a,{'used':_0x5a3095||0x0}));}return{'rows':_0x50c8a7,'count':_0x13eb78};}}return{'rows':_0x3b3c67,'count':_0x13eb78};}catch(_0x28479c){return console[_0x32d8e8(0x15e)]('----------------------------------------ERR--------',_0x28479c),_0x28479c;}}[_0x487d0a(0xf0)](_0x1f0575){const _0x4e58a9=_0x487d0a;return this[_0x4e58a9(0x100)]['findOne']({'where':{'id':_0x1f0575}});}['getModelByIds'](_0x46f36f){const _0x44abd4=_0x487d0a;return this['modelsEntity'][_0x44abd4(0x154)]({'where':{'id':(0x0,typeorm_2['In'])(_0x46f36f)}});}[_0x487d0a(0x111)](_0x2b55e3){const _0xd59bbf=_0x487d0a;return this[_0xd59bbf(0x100)][_0xd59bbf(0x154)]({'where':{'modelType':_0x2b55e3}});}async[_0x487d0a(0x136)](_0x496957=0x0){const _0x363fde=_0x487d0a,_0x2231c3=(0x0,utils_1[_0x363fde(0x102)])(this[_0x363fde(0x16b)]);return Object[_0x363fde(0x142)](_0x2231c3)[_0x363fde(0x176)](_0x3321eb=>{const _0x233515=_0x363fde;let _0x2de528=_0x2231c3[_0x3321eb];if(_0x496957===0x0)_0x2de528=_0x2de528['filter'](_0x46bae7=>Boolean(_0x46bae7[_0x233515(0x120)]))[_0x233515(0x14f)]((_0x154123,_0x421c35)=>_0x421c35[_0x233515(0x121)]-_0x154123[_0x233515(0x121)]);else _0x496957===0x2&&(_0x2de528=_0x2de528['filter'](_0x42d402=>!Boolean(_0x42d402[_0x233515(0x120)]))['sort']((_0x20051f,_0x56cb59)=>_0x56cb59[_0x233515(0x121)]-_0x20051f[_0x233515(0x121)]));_0x2231c3[_0x3321eb]=_0x2de528[_0x233515(0x170)](_0x50ec27=>{return Object['assign']({},_0x50ec27);});}),{'modelTypeList':this[_0x363fde(0x146)],'modelMaps':_0x2231c3};}async[_0x487d0a(0x160)](_0x35516f,_0x4fc01e){const _0x2f902d=_0x487d0a;await this['modelsEntity'][_0x2f902d(0x17b)]()[_0x2f902d(0x112)](models_entity_1[_0x2f902d(0x13a)])[_0x2f902d(0x163)]({'useCount':()=>_0x2f902d(0xf3),'useToken':()=>_0x2f902d(0xfb)+_0x4fc01e})[_0x2f902d(0x117)](_0x2f902d(0x148),{'id':_0x35516f})[_0x2f902d(0xf1)]();}async[_0x487d0a(0x13c)](){const _0x3afea3=_0x487d0a,_0x36f6a7=await this[_0x3afea3(0x100)][_0x3afea3(0x154)]({'where':{'keyType':0x2}}),_0x265fd3={};_0x36f6a7['forEach'](_0x223dde=>{const _0x2b4905=_0x3afea3,{key:_0x3f1e1,secret:_0x1212a8}=_0x223dde;!_0x265fd3[_0x2b4905(0x14b)]?_0x265fd3[_0x3f1e1]=[{'keyInfo':_0x223dde}]:_0x265fd3[_0x3f1e1]['push'](_0x223dde);}),Object[_0x3afea3(0x142)](_0x265fd3)[_0x3afea3(0x176)](async _0x3d3b1c=>{const _0x5dfe19=_0x3afea3,{secret:_0x51fb4e,id:_0x26ac0d}=_0x265fd3[_0x3d3b1c][0x0]['keyInfo'],_0x4ad254=await(0x0,baidu_1[_0x5dfe19(0x15d)])(_0x3d3b1c,_0x51fb4e);await this[_0x5dfe19(0x100)][_0x5dfe19(0x112)]({'key':_0x3d3b1c},{'accessToken':_0x4ad254});}),setTimeout(()=>{const _0x5d8a20=_0x3afea3;this[_0x5d8a20(0x178)]();},0x3e8);}async[_0x487d0a(0x133)](_0x4b0a2b,_0x5a273d=''){const _0x836e40=_0x487d0a;let _0x16034c;_0x5a273d?_0x16034c=await this[_0x836e40(0x100)]['find']({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x4b0a2b,'model':_0x5a273d},'order':{'displaySort':_0x836e40(0xfa)}}):_0x16034c=await this[_0x836e40(0x100)]['find']({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x4b0a2b},'order':{'displaySort':_0x836e40(0xfa)}});if(!_0x16034c['length'])throw new common_1[(_0x836e40(0x157))](_0x836e40(0x11f),common_1[_0x836e40(0x174)][_0x836e40(0x11d)]);return _0x16034c[0x0];}async['getRandomKeyForKeyType'](_0x32795e,_0x364bfd){const _0x19eed3=_0x487d0a;let _0x4662c4=await this[_0x19eed3(0x100)][_0x19eed3(0x154)]({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x32795e,'keyType':_0x364bfd},'order':{'displaySort':_0x19eed3(0xfa)}});if(!_0x4662c4[_0x19eed3(0x150)])throw new common_1[(_0x19eed3(0x157))](_0x19eed3(0x11f),common_1[_0x19eed3(0x174)][_0x19eed3(0x11d)]);return _0x4662c4[0x0];}async[_0x487d0a(0x13b)](){const _0x9eed59=_0x487d0a,_0x25b467=await this[_0x9eed59(0x100)][_0x9eed59(0x154)]({'where':{'status':!![],'keyStatus':0x1,'canAudio':!![]}});if(!_0x25b467[_0x9eed59(0x150)])throw new common_1[(_0x9eed59(0x157))](_0x9eed59(0xef),common_1[_0x9eed59(0x174)][_0x9eed59(0x11d)]);return _0x25b467[0x0];}async[_0x487d0a(0xf9)](){const _0x51f0b6=_0x487d0a;return await this[_0x51f0b6(0x100)][_0x51f0b6(0x154)]();}async[_0x487d0a(0x119)](){const _0x2371e2=_0x487d0a;try{const _0x245fe1=await this[_0x2371e2(0x100)][_0x2371e2(0x154)]({'where':{'status':!![],'keyStatus':0x1,'modelType':model_constant_1['EModelType'][_0x2371e2(0x107)]}});if(_0x245fe1[_0x2371e2(0x150)]===0x0)throw new Error(_0x2371e2(0x101));return _0x245fe1[Math[_0x2371e2(0x103)](Math[_0x2371e2(0x131)]()*_0x245fe1[_0x2371e2(0x150)])];}catch(_0x1c1f4a){throw new common_1[(_0x2371e2(0x157))](_0x1c1f4a[_0x2371e2(0x11c)],common_1[_0x2371e2(0x174)][_0x2371e2(0x11d)]);}}};ModelsService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(models_entity_1[_0x487d0a(0x13a)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(modelquick_entity_1[_0x487d0a(0x137)])),__metadata(_0x487d0a(0x16f),[typeorm_2[_0x487d0a(0x10c)],typeorm_2[_0x487d0a(0x10c)],nestjs_cls_1[_0x487d0a(0xfe)],user_service_1[_0x487d0a(0x12b)],redisCache_service_1[_0x487d0a(0x113)]])],ModelsService),exports[_0x487d0a(0x16c)]=ModelsService;