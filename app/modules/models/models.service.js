'use strict';const _0x5e4822=_0x256a;(function(_0x3a4b5,_0x41c13b){const _0xb03ebe=_0x256a,_0x2fefbf=_0x3a4b5();while(!![]){try{const _0x3f61f7=parseInt(_0xb03ebe(0x10c))/0x1+parseInt(_0xb03ebe(0xfb))/0x2*(-parseInt(_0xb03ebe(0x189))/0x3)+parseInt(_0xb03ebe(0x15d))/0x4+parseInt(_0xb03ebe(0x147))/0x5*(parseInt(_0xb03ebe(0x18b))/0x6)+parseInt(_0xb03ebe(0x154))/0x7+parseInt(_0xb03ebe(0x18c))/0x8*(parseInt(_0xb03ebe(0x161))/0x9)+parseInt(_0xb03ebe(0x128))/0xa*(-parseInt(_0xb03ebe(0x16d))/0xb);if(_0x3f61f7===_0x41c13b)break;else _0x2fefbf['push'](_0x2fefbf['shift']());}catch(_0x507c23){_0x2fefbf['push'](_0x2fefbf['shift']());}}}(_0xc414,0x56919));function _0x256a(_0x1623de,_0x2a5dbe){const _0xc414ff=_0xc414();return _0x256a=function(_0x256ab3,_0x15cc19){_0x256ab3=_0x256ab3-0xf7;let _0x433a5f=_0xc414ff[_0x256ab3];return _0x433a5f;},_0x256a(_0x1623de,_0x2a5dbe);}function _0xc414(){const _0x562602=['getRandomKey','getModelByType','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','value','modelsEntity','userType','displaySort','keys','key','json','toString','ModelsMapCn','VIP_FREE','proxyUrl','hideString','缺失必要参数！','ClsService','modelId','design:paramtypes','model','keyPoolMap','名称已存在，请修改名称','modelTypes','MUSIC','redisCacheService','quickIds','HttpException','10DMDiDf','initCalcKey','defineProperty','./modelquick.entity','../../common/constants/model.constant','getModelByKeyModel','front','keyPoolIndexMap','reduce','当前调用模型已经被移除、请重新选择模型！','modelName','nestjs-cls','find','length','delModel','keyInfo','modelMaps','data','lockKey','getModelByKeyType','getMusicModel','https://apiv.chatgpt-3.vip','keyList','val','deepthink','getUserById','暂未配置音乐模型，请联系管理员','vipExpire','floor','Injectable','Not','1484675kNxHOm','getUserId','children','object','message','includes','modelQuickEntity','getModelByModel','getAllKey','getRole','HttpStatus','vipFreeNum','get','1416583WShVqW','queryModels','split','delete','keyStatus','InjectRepository','isVipUsed','userService','recommend','794104IlaXtD','isQuick','getModelById','暂未配置相关模型，请联系管理员！','9VnfIfK','modelSave','ModelsEntity','secret','log','update','getModelsByModelType','isSuper','status','forEach','BAD_REQUEST','ModelQuickEntity','9729918BrEHlw','当前未指定特殊模型KEY、前往后台设置！','ModelsService','modelsList','set','getCurrentModelKeyInfo','getOwnPropertyDescriptor','Logger','filter','----------------------------------------ERR--------','deepClone','assign','key:\x20','findOne','../user/user.service','UserService','modelType','metadata','deduct','mergeModelsByName','getModelByName','__decorate','../chatgpt/baidu','../../common/constants/status.constant','getModelChild','flat','modelInfo','RedisCacheService','3YIfpXM','refreshBaiduAccesstoken','6fYKXPH','5109880JjMApg','quickList','sort','__esModule','Repository','EModelType','../redisCache/redisCache.service','getModel','DESC','221084mDlfCA','getModelByIds','getRandomKeyForKeyType','decorate','getRandomAudioKey','function','id\x20=\x20:id','error:\x20','clsService','keyType','label','then','save','modelDel','map','../../common/utils','push','13100xVbzot'];_0xc414=function(){return _0x562602;};return _0xc414();}var __decorate=this&&this[_0x5e4822(0x182)]||function(_0x2f478a,_0x5427e1,_0x5e9442,_0x9d503d){const _0x3914ee=_0x5e4822;var _0x55b38e=arguments['length'],_0x5ace00=_0x55b38e<0x3?_0x5427e1:_0x9d503d===null?_0x9d503d=Object[_0x3914ee(0x173)](_0x5427e1,_0x5e9442):_0x9d503d,_0x4bd54d;if(typeof Reflect===_0x3914ee(0x14a)&&typeof Reflect[_0x3914ee(0xfe)]===_0x3914ee(0x100))_0x5ace00=Reflect['decorate'](_0x2f478a,_0x5427e1,_0x5e9442,_0x9d503d);else{for(var _0x454171=_0x2f478a[_0x3914ee(0x135)]-0x1;_0x454171>=0x0;_0x454171--)if(_0x4bd54d=_0x2f478a[_0x454171])_0x5ace00=(_0x55b38e<0x3?_0x4bd54d(_0x5ace00):_0x55b38e>0x3?_0x4bd54d(_0x5427e1,_0x5e9442,_0x5ace00):_0x4bd54d(_0x5427e1,_0x5e9442))||_0x5ace00;}return _0x55b38e>0x3&&_0x5ace00&&Object['defineProperty'](_0x5427e1,_0x5e9442,_0x5ace00),_0x5ace00;},__metadata=this&&this['__metadata']||function(_0x3a9863,_0x248d6e){const _0x3e6937=_0x5e4822;if(typeof Reflect==='object'&&typeof Reflect[_0x3e6937(0x17e)]===_0x3e6937(0x100))return Reflect[_0x3e6937(0x17e)](_0x3a9863,_0x248d6e);},__param=this&&this['__param']||function(_0x222314,_0x1b639f){return function(_0x5645a6,_0x4ac984){_0x1b639f(_0x5645a6,_0x4ac984,_0x222314);};};Object[_0x5e4822(0x12a)](exports,_0x5e4822(0x18f),{'value':!![]}),exports[_0x5e4822(0x16f)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require('typeorm'),models_entity_1=require('./models.entity'),status_constant_1=require(_0x5e4822(0x184)),baidu_1=require(_0x5e4822(0x183)),utils_1=require(_0x5e4822(0x10a)),model_constant_1=require(_0x5e4822(0x12c)),redisCache_service_1=require(_0x5e4822(0xf8)),user_service_1=require(_0x5e4822(0x17b)),redisKey_constant_1=require('../../common/constants/redisKey.constant'),nestjs_cls_1=require(_0x5e4822(0x133)),modelquick_entity_1=require(_0x5e4822(0x12b));let ModelsService=class ModelsService{constructor(_0x1349ad,_0x1d88f5,_0x53de85,_0x50a73f,_0x5523af){const _0x1c3755=_0x5e4822;this[_0x1c3755(0x111)]=_0x1349ad,this[_0x1c3755(0x14d)]=_0x1d88f5,this[_0x1c3755(0x103)]=_0x53de85,this['userService']=_0x50a73f,this[_0x1c3755(0x125)]=_0x5523af,this[_0x1c3755(0x123)]=[],this[_0x1c3755(0x138)]={},this[_0x1c3755(0x13e)]={},this['keyPoolMap']={},this['keyPoolIndexMap']={};}async['onModuleInit'](){const _0x591068=_0x5e4822;await this[_0x591068(0x129)](),await this[_0x591068(0x18a)]();}async['getOfficialModels'](){const _0x17e78f=_0x5e4822,_0x369a58=_0x17e78f(0x13d),_0x44c81e=_0x369a58+'/v1/models';return await fetch(_0x44c81e,{'method':_0x17e78f(0x153),'headers':{'Authorization':'Bearer\x20sk-bSm3FROxNJ1oIkmd5dDc9b582d3d48E09d12E86eF7FfC0C4'}})[_0x17e78f(0x106)](async _0x44cddd=>{const _0xcc444c=_0x17e78f,_0x542784=await _0x44cddd[_0xcc444c(0x116)]();return _0x542784[_0xcc444c(0x139)];});}async[_0x5e4822(0x129)](){const _0xa86170=_0x5e4822;this[_0xa86170(0x121)]={},this[_0xa86170(0x12f)]={},this[_0xa86170(0x13e)]={},this[_0xa86170(0x138)]={},this[_0xa86170(0x123)]=[];const _0x5605f3=await this['modelsEntity']['find']({'where':{'status':!![]}}),_0x30309c=await this[_0xa86170(0x14d)]['find']({'where':{'isRelease':0x1}}),_0x139a90=_0x5605f3[_0xa86170(0x130)]((_0xf3122b,_0x2c4f53)=>{const _0x23850d=_0xa86170,_0x3f03ed={..._0x2c4f53};return _0x3f03ed['quickList']=[],_0x2c4f53[_0x23850d(0x15e)]===0x1&&_0x2c4f53[_0x23850d(0x126)]&&_0x2c4f53['quickIds'][_0x23850d(0x135)]&&(_0x3f03ed[_0x23850d(0x18d)]=_0x30309c[_0x23850d(0x175)](_0x410df8=>_0x2c4f53[_0x23850d(0x126)][_0x23850d(0x156)](',')[_0x23850d(0x14c)](_0x410df8['id'][_0x23850d(0x117)]()))),!_0xf3122b[_0x3f03ed[_0x23850d(0x104)]]?_0xf3122b[_0x3f03ed[_0x23850d(0x104)]]=[_0x3f03ed]:_0xf3122b[_0x3f03ed['keyType']]['push'](_0x3f03ed),_0xf3122b;},{});this[_0xa86170(0x123)]=Object[_0xa86170(0x114)](_0x139a90)[_0xa86170(0x109)](_0xeb8dba=>{const _0x28ae95=_0xa86170;return{'label':status_constant_1[_0x28ae95(0x118)][_0xeb8dba],'val':_0xeb8dba};}),this['modelMaps']=_0x139a90,this[_0xa86170(0x13e)]={},_0x5605f3[_0xa86170(0x16a)](_0x12a20d=>{const _0x23bbea=_0xa86170,{keyType:_0x5a2cd2,model:_0x1d908a,keyWeight:_0x530b85}=_0x12a20d;if(!this[_0x23bbea(0x121)][_0x1d908a])this[_0x23bbea(0x121)][_0x1d908a]=[];for(let _0x15e61e=0x0;_0x15e61e<_0x530b85;_0x15e61e++){this['keyPoolMap'][_0x1d908a][_0x23bbea(0x10b)](_0x12a20d);}if(!this[_0x23bbea(0x12f)][_0x1d908a])this[_0x23bbea(0x12f)][_0x1d908a]=0x0;if(!this['keyList'][_0x5a2cd2])this[_0x23bbea(0x13e)][_0x5a2cd2]={};if(!this[_0x23bbea(0x13e)][_0x5a2cd2][_0x1d908a])this[_0x23bbea(0x13e)][_0x5a2cd2][_0x1d908a]=[];this[_0x23bbea(0x13e)][_0x5a2cd2][_0x1d908a][_0x23bbea(0x10b)](_0x12a20d);});}async[_0x5e4822(0x13a)](_0x2a67c8,_0x35cf0b,_0x15ac0c=-0x1){const _0x19159e=_0x5e4822,_0x46f167=await this[_0x19159e(0x111)][_0x19159e(0x166)]({'id':_0x2a67c8},{'status':![],'keyStatus':_0x15ac0c,'remark':_0x35cf0b});common_1[_0x19159e(0x174)]['error'](_0x19159e(0x179)+_0x2a67c8+_0x19159e(0x10f)),await this['initCalcKey']();}async[_0x5e4822(0x181)](_0x58268c){const _0x13fdd6=_0x5e4822;return this[_0x13fdd6(0x111)][_0x13fdd6(0x17a)]({'where':{'modelName':_0x58268c}});}async[_0x5e4822(0x14e)](_0x5d05d4){const _0x56bac9=_0x5e4822;return this['modelsEntity'][_0x56bac9(0x17a)]({'where':{'model':_0x5d05d4}});}async[_0x5e4822(0x13b)](_0x4dfa00,_0x5a8bf6){const _0xca290d=_0x5e4822;return this[_0xca290d(0x111)]['findOne']({'where':{'modelType':_0x4dfa00,'keyType':_0x5a8bf6}});}async[_0x5e4822(0x12d)](_0x402884,_0x4440b3){const _0x42601e=_0x5e4822;return this[_0x42601e(0x111)][_0x42601e(0x17a)]({'where':{'modelType':_0x402884,'model':_0x4440b3}});}async[_0x5e4822(0x172)](_0x355996){const _0x59bad4=_0x5e4822;if(!this[_0x59bad4(0x121)][_0x355996])throw new common_1[(_0x59bad4(0x127))](_0x59bad4(0x131),common_1['HttpStatus']['BAD_REQUEST']);this[_0x59bad4(0x12f)][_0x355996]++;const _0x51959a=this[_0x59bad4(0x12f)][_0x355996];if(_0x51959a>=this['keyPoolMap'][_0x355996][_0x59bad4(0x135)])this['keyPoolIndexMap'][_0x355996]=0x0;return this['keyPoolMap'][_0x355996][this[_0x59bad4(0x12f)][_0x355996]];}async['getModelInfoByKeyType'](_0x37d379,_0x7111eb){const _0xaf846b=_0x5e4822,_0x1e81bf={'modelType':_0x37d379,'status':!![],'keyStatus':0x1};_0x7111eb&&(_0x1e81bf['keyType']=parseInt(_0x7111eb));const _0x35cafe=await this[_0xaf846b(0x111)][_0xaf846b(0x134)]({'where':_0x1e81bf,'order':{'displaySort':_0xaf846b(0xfa)}});if(!_0x35cafe['length'])throw new Error(_0xaf846b(0x160));const _0x5f5272=_0x35cafe[0x0],_0x6ab199=this['modelTypes'][_0xaf846b(0x134)](_0x28c23e=>Number(_0x28c23e[_0xaf846b(0x13f)])===_0x5f5272['keyType']);return{'modelTypeInfo':_0x6ab199,'modelInfo':{..._0x5f5272,'topN':0.8,'systemMessage':'','rounds':0x8}};}async[_0x5e4822(0x10e)](_0x499878,_0x231031){const _0x1d1024=_0x5e4822,_0x4d4d99={'modelType':_0x499878,'status':!![],'keyStatus':0x1};_0x231031&&(_0x4d4d99['model']=_0x231031);const _0x3c3b9b=await this[_0x1d1024(0x111)]['find']({'where':_0x4d4d99,'order':{'displaySort':'DESC'}});if(!_0x3c3b9b[_0x1d1024(0x135)])throw new Error(_0x1d1024(0x160));const _0x1ea3dd=_0x3c3b9b[0x0],_0x4002c5=this[_0x1d1024(0x123)]['find'](_0xc044e9=>Number(_0xc044e9[_0x1d1024(0x13f)])===_0x1ea3dd[_0x1d1024(0x104)]);return{'modelTypeInfo':_0x4002c5,'modelInfo':{..._0x1ea3dd,'topN':0.8,'systemMessage':'','rounds':0x8}};}async['setModel'](_0x443a5d){const _0x3790d6=_0x5e4822;try{return await this[_0x3790d6(0x162)](_0x443a5d),await this[_0x3790d6(0x129)](),_0x443a5d[_0x3790d6(0x104)]===0x2&&this[_0x3790d6(0x18a)](),!![];}catch(_0x62c70b){console[_0x3790d6(0x165)](_0x3790d6(0x102),_0x62c70b);throw new common_1[(_0x3790d6(0x127))](_0x62c70b[_0x3790d6(0x14b)],common_1[_0x3790d6(0x151)][_0x3790d6(0x16b)]);}}async[_0x5e4822(0x162)](_0x40b805){const _0x173003=_0x5e4822;_0x40b805['status']&&(_0x40b805[_0x173003(0x158)]=0x1);if(_0x40b805['id']){const _0x5285e4=await this[_0x173003(0x111)][_0x173003(0x17a)]({'where':{'id':(0x0,typeorm_2[_0x173003(0x146)])(_0x40b805['id']),'modelName':_0x40b805[_0x173003(0x132)],'modelType':_0x40b805[_0x173003(0x17d)]}});if(_0x5285e4)throw new Error(_0x173003(0x122));await this[_0x173003(0x111)][_0x173003(0x166)]({'id':_0x40b805['id']},_0x40b805);}else{const _0x7011a6=await this[_0x173003(0x111)][_0x173003(0x17a)]({'where':{'modelName':_0x40b805[_0x173003(0x132)],'modelType':_0x40b805[_0x173003(0x17d)]}});if(_0x7011a6)throw new Error('名称已存在，请修改名称');await this[_0x173003(0x111)][_0x173003(0x107)](_0x40b805);}}async[_0x5e4822(0x136)]({id:_0x5dcacc}){const _0x1aed69=_0x5e4822;if(!_0x5dcacc)throw new common_1['HttpException'](_0x1aed69(0x11c),common_1[_0x1aed69(0x151)][_0x1aed69(0x16b)]);return await this[_0x1aed69(0x108)]([_0x5dcacc]),await this[_0x1aed69(0x129)](),!![];}async[_0x5e4822(0xf9)]({id:_0x28fdf4}){const _0x151908=_0x5e4822;if(!_0x28fdf4)throw new common_1[(_0x151908(0x127))](_0x151908(0x11c),common_1['HttpStatus'][_0x151908(0x16b)]);return await this['modelsEntity'][_0x151908(0x17a)]({'where':{'id':_0x28fdf4}});}async[_0x5e4822(0x108)](_0x4fb1cd){const _0x1c1323=_0x5e4822;if(!_0x4fb1cd||!_0x4fb1cd['length'])return!![];return await this[_0x1c1323(0x111)][_0x1c1323(0x157)]({'id':(0x0,typeorm_2['In'])(_0x4fb1cd)}),!![];}async[_0x5e4822(0x155)](_0x28f398,_0x1320cd){const _0x2c9168=_0x5e4822;try{const _0x24751f=(0x0,utils_1[_0x2c9168(0x150)])(this[_0x2c9168(0x103)]),_0x370796=(0x0,utils_1[_0x2c9168(0x148)])(this[_0x2c9168(0x103)]),{keyType:_0x1112fd,key:_0x1b7f10,status:_0x3f6249,model:_0x133c33,modelName:_0x16b485,modelType:_0x397e83,page:page=0x1,size:size=0xa,upload:_0x152204,isAdmin:_0x311c5c,deepthink:_0x36d2b1,recommend:_0x59991f}=_0x1320cd;let _0x468715={};_0x133c33&&(_0x468715[_0x2c9168(0x120)]=_0x133c33);_0x59991f&&(_0x468715[_0x2c9168(0x15c)]=!![]);_0x1b7f10&&(_0x468715[_0x2c9168(0x115)]=(0x0,typeorm_2['Like'])('%'+_0x1b7f10+'%'));_0x1112fd&&(_0x468715[_0x2c9168(0x104)]=_0x1112fd);_0x397e83&&(_0x468715[_0x2c9168(0x17d)]=_0x397e83);_0x311c5c==0x1?_0x3f6249!==undefined&&(_0x468715['status']=_0x3f6249):_0x468715['status']=!![];_0x16b485&&(_0x468715[_0x2c9168(0x132)]=(0x0,typeorm_2['Like'])('%'+_0x16b485+'%'));_0x152204!==undefined&&(_0x468715['canUpload']=Boolean(_0x152204));_0x36d2b1>-0x1&&(_0x468715[_0x2c9168(0x140)]=_0x36d2b1);!(0x0,utils_1[_0x2c9168(0x168)])(this[_0x2c9168(0x103)])&&(_0x468715[_0x2c9168(0x12e)]=!![],_0x468715[_0x2c9168(0x169)]=!![]);const [_0x4183d7,_0x3cc8ba]=await this[_0x2c9168(0x111)]['findAndCount']({'where':_0x468715,'skip':(page-0x1)*size,'take':size,'order':{'displaySort':_0x2c9168(0xfa),'createdAt':_0x2c9168(0xfa)}}),_0x651a21=_0x4183d7,_0x5dfff9=await this[_0x2c9168(0x14d)]['find']({'where':{'isRelease':0x1}});_0x651a21[_0x2c9168(0x16a)](_0x3df87d=>{const _0x455f77=_0x2c9168;_0x3df87d[_0x455f77(0x18d)]=[],_0x3df87d['isQuick']===0x1&&_0x3df87d[_0x455f77(0x126)]&&_0x3df87d['quickIds'][_0x455f77(0x135)]&&(_0x3df87d[_0x455f77(0x18d)]=_0x5dfff9[_0x455f77(0x175)](_0x17498a=>_0x3df87d[_0x455f77(0x126)][_0x455f77(0x156)](',')[_0x455f77(0x14c)](_0x17498a['id'][_0x455f77(0x117)]()))),_0x3df87d[_0x455f77(0x15a)]=_0x3df87d[_0x455f77(0x112)]?!![]:![];});!(0x0,utils_1[_0x2c9168(0x168)])(this[_0x2c9168(0x103)])&&_0x651a21['forEach'](_0x293dd0=>{const _0x2930bd=_0x2c9168;_0x293dd0['key']=(0x0,utils_1[_0x2930bd(0x11b)])(_0x293dd0[_0x2930bd(0x115)]),_0x293dd0[_0x2930bd(0x164)]=(0x0,utils_1[_0x2930bd(0x11b)])(_0x293dd0[_0x2930bd(0x164)]),_0x293dd0['proxyUrl']=(0x0,utils_1[_0x2930bd(0x11b)])(_0x293dd0[_0x2930bd(0x11a)]);});if(_0x370796){const _0x433080=await this[_0x2c9168(0x15b)][_0x2c9168(0x141)](_0x370796);if(_0x433080[_0x2c9168(0x143)]||_0x433080['lifetimeVip']){const _0x176ce0=[];for(let _0x6784de=0x0;_0x6784de<_0x651a21[_0x2c9168(0x135)];_0x6784de++){const _0xabaab=_0x651a21[_0x6784de],_0x1f6289=redisKey_constant_1[_0x2c9168(0x119)]+'-'+_0x370796+'-'+_0xabaab['id'],_0x1ffb83=await await this[_0x2c9168(0x125)]['get']({'key':_0x1f6289});_0x176ce0[_0x2c9168(0x10b)](Object[_0x2c9168(0x178)]({},_0xabaab,{'used':_0x1ffb83||0x0}));}return{'rows':_0x176ce0,'count':_0x3cc8ba};}}return{'rows':_0x651a21,'count':_0x3cc8ba};}catch(_0x4fde9c){return console[_0x2c9168(0x165)](_0x2c9168(0x176),_0x4fde9c),_0x4fde9c;}}[_0x5e4822(0x15f)](_0x1e4722){const _0x1b496f=_0x5e4822;return this[_0x1b496f(0x111)]['findOne']({'where':{'id':_0x1e4722}});}[_0x5e4822(0xfc)](_0x21fa5f){const _0x57d6df=_0x5e4822;return this[_0x57d6df(0x111)][_0x57d6df(0x134)]({'where':{'id':(0x0,typeorm_2['In'])(_0x21fa5f)}});}[_0x5e4822(0x167)](_0x3bb6e0){const _0x4a0d37=_0x5e4822;return this[_0x4a0d37(0x111)][_0x4a0d37(0x134)]({'where':{'modelType':_0x3bb6e0}});}async[_0x5e4822(0x170)](_0x31a92e=0x0){const _0x3179d9=_0x5e4822,_0x2178f3=(0x0,utils_1[_0x3179d9(0x177)])(this[_0x3179d9(0x138)]);return Object[_0x3179d9(0x114)](_0x2178f3)[_0x3179d9(0x16a)](_0x40d406=>{const _0x49c57f=_0x3179d9;let _0x265532=_0x2178f3[_0x40d406];if(_0x31a92e===0x0)_0x265532=_0x265532['filter'](_0x199557=>Boolean(_0x199557[_0x49c57f(0x12e)]))['sort']((_0x42147e,_0x5b45ab)=>_0x5b45ab[_0x49c57f(0x113)]-_0x42147e[_0x49c57f(0x113)]);else _0x31a92e===0x2&&(_0x265532=_0x265532['filter'](_0x4780dd=>!Boolean(_0x4780dd[_0x49c57f(0x12e)]))[_0x49c57f(0x18e)]((_0x2eff6d,_0x5308a0)=>_0x5308a0[_0x49c57f(0x113)]-_0x2eff6d[_0x49c57f(0x113)]));_0x2178f3[_0x40d406]=_0x265532[_0x49c57f(0x109)](_0x23d143=>{const _0x106370=_0x49c57f;return Object[_0x106370(0x178)]({},_0x23d143);});}),{'modelTypeList':this[_0x3179d9(0x123)],'modelMaps':_0x2178f3};}async['saveUseLog'](_0x13d118,_0x518746){const _0x44ad72=_0x5e4822;await this['modelsEntity']['createQueryBuilder']()[_0x44ad72(0x166)](models_entity_1[_0x44ad72(0x163)])[_0x44ad72(0x171)]({'useCount':()=>'useCount\x20+\x201','useToken':()=>'useToken\x20+\x20'+_0x518746})['where'](_0x44ad72(0x101),{'id':_0x13d118})['execute']();}async[_0x5e4822(0x18a)](){const _0xb6256c=_0x5e4822,_0x3e7b67=await this['modelsEntity'][_0xb6256c(0x134)]({'where':{'keyType':0x2}}),_0x2f1f79={};_0x3e7b67[_0xb6256c(0x16a)](_0x3d3d0c=>{const _0x303c0b=_0xb6256c,{key:_0xc93e96,secret:_0x1640ff}=_0x3d3d0c;!_0x2f1f79['key']?_0x2f1f79[_0xc93e96]=[{'keyInfo':_0x3d3d0c}]:_0x2f1f79[_0xc93e96][_0x303c0b(0x10b)](_0x3d3d0c);}),Object[_0xb6256c(0x114)](_0x2f1f79)['forEach'](async _0x2159c2=>{const _0x4cf51c=_0xb6256c,{secret:_0x185e93,id:_0x2e51dd}=_0x2f1f79[_0x2159c2][0x0][_0x4cf51c(0x137)],_0x3a6111=await(0x0,baidu_1['getAccessToken'])(_0x2159c2,_0x185e93);await this[_0x4cf51c(0x111)][_0x4cf51c(0x166)]({'key':_0x2159c2},{'accessToken':_0x3a6111});}),setTimeout(()=>{this['initCalcKey']();},0x3e8);}async[_0x5e4822(0x10d)](_0x1fbb5c,_0x27149b=''){const _0x4f2bf4=_0x5e4822;let _0x3a14ca;_0x27149b?_0x3a14ca=await this[_0x4f2bf4(0x111)][_0x4f2bf4(0x134)]({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x1fbb5c,'model':_0x27149b},'order':{'displaySort':_0x4f2bf4(0xfa)}}):_0x3a14ca=await this['modelsEntity']['find']({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x1fbb5c},'order':{'displaySort':_0x4f2bf4(0xfa)}});if(!_0x3a14ca[_0x4f2bf4(0x135)])throw new common_1[(_0x4f2bf4(0x127))]('当前未指定特殊模型KEY、前往后台设置！',common_1[_0x4f2bf4(0x151)][_0x4f2bf4(0x16b)]);return _0x3a14ca[0x0];}async[_0x5e4822(0x185)](_0x16a8a8,_0x277e7a=''){const _0x5d54f0=_0x5e4822;let _0x13d3df=[];_0x13d3df=await this[_0x5d54f0(0x111)][_0x5d54f0(0x134)]({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x16a8a8},'order':{'displaySort':_0x5d54f0(0xfa)}});if(!_0x13d3df['length'])throw new common_1[(_0x5d54f0(0x127))](_0x5d54f0(0x16e),common_1['HttpStatus'][_0x5d54f0(0x16b)]);const _0xbabb55=_0x13d3df[_0x5d54f0(0x134)](_0x355075=>_0x355075[_0x5d54f0(0x149)]&&_0x355075[_0x5d54f0(0x149)]['find'](_0x444ec9=>_0x444ec9[_0x5d54f0(0x110)]==_0x277e7a));if(!_0xbabb55)throw new common_1[(_0x5d54f0(0x127))](_0x5d54f0(0x16e),common_1['HttpStatus']['BAD_REQUEST']);const _0x22377e=_0xbabb55?.['children'][_0x5d54f0(0x134)](_0x2bc883=>_0x2bc883[_0x5d54f0(0x110)]==_0x277e7a);return{'model':_0x22377e[_0x5d54f0(0x110)],'name':_0x22377e[_0x5d54f0(0x105)],'vipFreeNum':_0x22377e[_0x5d54f0(0x152)],'deduct':_0x22377e[_0x5d54f0(0x17f)],'userType':_0xbabb55[_0x5d54f0(0x112)],'proxyUrl':_0xbabb55[_0x5d54f0(0x11a)],'key':_0xbabb55[_0x5d54f0(0x115)],'id':_0xbabb55['id'],'keyType':_0xbabb55[_0x5d54f0(0x104)],'secret':_0xbabb55[_0x5d54f0(0x164)]};}async[_0x5e4822(0xfd)](_0x254216,_0x426a07){const _0x92beec=_0x5e4822;let _0x129140=await this['modelsEntity'][_0x92beec(0x134)]({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x254216,'keyType':_0x426a07},'order':{'displaySort':_0x92beec(0xfa)}});if(!_0x129140[_0x92beec(0x135)])throw new common_1[(_0x92beec(0x127))]('当前未指定特殊模型KEY、前往后台设置！',common_1[_0x92beec(0x151)][_0x92beec(0x16b)]);return _0x129140[0x0];}async[_0x5e4822(0xff)](){const _0x18cbf3=_0x5e4822,_0x322068=await this[_0x18cbf3(0x111)][_0x18cbf3(0x134)]({'where':{'status':!![],'keyStatus':0x1,'canAudio':!![]}});if(!_0x322068[_0x18cbf3(0x135)])throw new common_1['HttpException']('当前未指定语音对话模型KEY、前往后台设置把！',common_1[_0x18cbf3(0x151)][_0x18cbf3(0x16b)]);return _0x322068[0x0];}async['mergeModels'](_0x397fd3,_0x5cf871=_0x5e4822(0x11e)){const _0x5b3ef9=_0x5e4822,_0x528236=_0x397fd3['map'](_0x56b61d=>_0x56b61d[_0x5cf871]),_0x4123c8=await this[_0x5b3ef9(0x111)][_0x5b3ef9(0x134)]({'where':{'id':(0x0,typeorm_2['In'])(_0x528236)}});return _0x397fd3[_0x5b3ef9(0x16a)](_0x2e3b46=>{const _0x5bd855=_0x5b3ef9;let _0x28dd30=_0x4123c8[_0x5bd855(0x134)](_0x284d6b=>_0x2e3b46[_0x5cf871]==_0x284d6b['id']);_0x2e3b46[_0x5bd855(0x187)]=_0x28dd30[_0x5bd855(0x149)]?.[_0x5bd855(0x134)](_0x1d4e8a=>_0x1d4e8a['value']==_0x2e3b46['model']);}),_0x397fd3;}async[_0x5e4822(0x180)](_0x1444a1,_0x103835,_0xdb99ec=_0x5e4822(0x120)){const _0x4a9743=_0x5e4822,_0x18c2b4=await this[_0x4a9743(0x111)][_0x4a9743(0x134)]({'where':{'modelType':_0x103835}}),_0x5b361f=_0x18c2b4[_0x4a9743(0x109)](_0x595bf3=>_0x595bf3[_0x4a9743(0x149)])[_0x4a9743(0x186)]();return _0x1444a1[_0x4a9743(0x16a)](_0x53086b=>{const _0x256627=_0x4a9743;_0x53086b[_0x256627(0x187)]=_0x5b361f?.['find'](_0x29cf08=>_0x29cf08[_0x256627(0x110)]==_0x53086b[_0xdb99ec]);}),_0x1444a1;}async[_0x5e4822(0x14f)](){const _0x300416=_0x5e4822;return await this[_0x300416(0x111)][_0x300416(0x134)]();}async[_0x5e4822(0x13c)](){const _0x444f4a=_0x5e4822;try{const _0x1bcc74=await this[_0x444f4a(0x111)][_0x444f4a(0x134)]({'where':{'status':!![],'keyStatus':0x1,'modelType':model_constant_1[_0x444f4a(0xf7)][_0x444f4a(0x124)]}});if(_0x1bcc74[_0x444f4a(0x135)]===0x0)throw new Error(_0x444f4a(0x142));return _0x1bcc74[Math[_0x444f4a(0x144)](Math['random']()*_0x1bcc74[_0x444f4a(0x135)])];}catch(_0x53f83d){throw new common_1['HttpException'](_0x53f83d[_0x444f4a(0x14b)],common_1[_0x444f4a(0x151)][_0x444f4a(0x16b)]);}}};ModelsService=__decorate([(0x0,common_1[_0x5e4822(0x145)])(),__param(0x0,(0x0,typeorm_1[_0x5e4822(0x159)])(models_entity_1[_0x5e4822(0x163)])),__param(0x1,(0x0,typeorm_1[_0x5e4822(0x159)])(modelquick_entity_1[_0x5e4822(0x16c)])),__metadata(_0x5e4822(0x11f),[typeorm_2[_0x5e4822(0x190)],typeorm_2[_0x5e4822(0x190)],nestjs_cls_1[_0x5e4822(0x11d)],user_service_1[_0x5e4822(0x17c)],redisCache_service_1[_0x5e4822(0x188)]])],ModelsService),exports['ModelsService']=ModelsService;