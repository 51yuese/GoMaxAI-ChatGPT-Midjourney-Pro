'use strict';const _0x1dfd10=_0x3f0b;(function(_0x1d6cdb,_0x54fc11){const _0x501af0=_0x3f0b,_0x50da50=_0x1d6cdb();while(!![]){try{const _0x106050=parseInt(_0x501af0(0x1bf))/0x1*(parseInt(_0x501af0(0x18c))/0x2)+parseInt(_0x501af0(0x1a1))/0x3+parseInt(_0x501af0(0x1b2))/0x4+-parseInt(_0x501af0(0x1e4))/0x5+-parseInt(_0x501af0(0x18f))/0x6*(parseInt(_0x501af0(0x1b6))/0x7)+parseInt(_0x501af0(0x1b8))/0x8+-parseInt(_0x501af0(0x1d9))/0x9*(parseInt(_0x501af0(0x16a))/0xa);if(_0x106050===_0x54fc11)break;else _0x50da50['push'](_0x50da50['shift']());}catch(_0xe0dbd6){_0x50da50['push'](_0x50da50['shift']());}}}(_0x9e1e,0x77217));function _0x3f0b(_0x3b6135,_0x33309c){const _0x9e1e26=_0x9e1e();return _0x3f0b=function(_0x3f0b1b,_0x25493c){_0x3f0b1b=_0x3f0b1b-0x160;let _0x5ba1a9=_0x9e1e26[_0x3f0b1b];return _0x5ba1a9;},_0x3f0b(_0x3b6135,_0x33309c);}var __decorate=this&&this[_0x1dfd10(0x1b4)]||function(_0x2d3858,_0x287450,_0x22be2d,_0x2a0417){const _0x55e975=_0x1dfd10;var _0x10c66e=arguments['length'],_0x2b3c12=_0x10c66e<0x3?_0x287450:_0x2a0417===null?_0x2a0417=Object[_0x55e975(0x1cf)](_0x287450,_0x22be2d):_0x2a0417,_0x358d06;if(typeof Reflect==='object'&&typeof Reflect[_0x55e975(0x17c)]==='function')_0x2b3c12=Reflect[_0x55e975(0x17c)](_0x2d3858,_0x287450,_0x22be2d,_0x2a0417);else{for(var _0x2ed1f0=_0x2d3858['length']-0x1;_0x2ed1f0>=0x0;_0x2ed1f0--)if(_0x358d06=_0x2d3858[_0x2ed1f0])_0x2b3c12=(_0x10c66e<0x3?_0x358d06(_0x2b3c12):_0x10c66e>0x3?_0x358d06(_0x287450,_0x22be2d,_0x2b3c12):_0x358d06(_0x287450,_0x22be2d))||_0x2b3c12;}return _0x10c66e>0x3&&_0x2b3c12&&Object[_0x55e975(0x16d)](_0x287450,_0x22be2d,_0x2b3c12),_0x2b3c12;},__metadata=this&&this[_0x1dfd10(0x1e6)]||function(_0x4ab2ba,_0x37e02c){const _0x5764a5=_0x1dfd10;if(typeof Reflect===_0x5764a5(0x1a6)&&typeof Reflect['metadata']===_0x5764a5(0x166))return Reflect['metadata'](_0x4ab2ba,_0x37e02c);},__param=this&&this[_0x1dfd10(0x1bb)]||function(_0xf3c09a,_0x468c5f){return function(_0x523490,_0x357b65){_0x468c5f(_0x523490,_0x357b65,_0xf3c09a);};};function _0x9e1e(){const _0x1b6460=['update','getOwnPropertyDescriptor','lifetimeVip','getRandomKeyForKeyType','length','modelSave','getUserById','forEach','push','当前调用模型已经被移除、请重新选择模型！','keyStatus','90DCQspe','keyPoolMap','@nestjs/typeorm','lockKey','typeorm','modelTypes','getModelByIds','modelsList','Not','modelType','sort','2031945YbaQsd','isVipUsed','__metadata','front','useCount\x20+\x201','../../common/constants/redisKey.constant','./modelquick.entity','design:paramtypes','modelsEntity','filter','getUserId','缺失必要参数！','quickList','map','includes','getModelByModel','proxyUrl','getModelInfoByKeyType','function','split','model','refreshBaiduAccesstoken','668710dHosjG','DESC','onModuleInit','defineProperty','getModelsByModelType','当前未指定特殊模型KEY、前往后台设置！','./models.entity','key','BAD_REQUEST','ModelsEntity','val','execute','keyList','redisCacheService','getModelById','error','HttpException','__esModule','decorate','../user/user.service','initCalcKey','hideString','floor','https://apiv.chatgpt-3.vip','Like','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','ModelQuickEntity','getModel','displaySort','delModel','findOne','当前未指定语音对话模型KEY、前往后台设置把！','status','keyPoolIndexMap','100124FWmHFV','toString','quickIds','2748DaCJIN','getModelByKeyModel','getModelByKeyType','getModelByName','名称已存在，请修改名称','saveUseLog','getRole','log','delete','getAllKey','/v1/models','clsService','modelMaps','isSuper','find','userService','ModelsService','userType','383424fgCpir','keyInfo','deepClone','暂未配置相关模型，请联系管理员！','keys','object','error:\x20','secret','Bearer\x20sk-bSm3FROxNJ1oIkmd5dDc9b582d3d48E09d12E86eF7FfC0C4','InjectRepository','useToken\x20+\x20','../../common/utils','getCurrentModelKeyInfo','getRandomAudioKey','ModelsMapCn','Injectable','../chatgpt/baidu','538048apOKMQ','save','__decorate','isQuick','2744FMSWaK','----------------------------------------ERR--------','5033760JQbDWq','message','modelQuickEntity','__param','get','assign','findAndCount','17UAnrOQ','deepthink','Repository','modelName','HttpStatus','queryModels','@nestjs/common','id\x20=\x20:id','json','Logger','../../common/constants/model.constant','keyType','canUpload','data','setModel'];_0x9e1e=function(){return _0x1b6460;};return _0x9e1e();}Object[_0x1dfd10(0x16d)](exports,_0x1dfd10(0x17b),{'value':!![]}),exports[_0x1dfd10(0x19f)]=void 0x0;const common_1=require(_0x1dfd10(0x1c5)),typeorm_1=require(_0x1dfd10(0x1db)),typeorm_2=require(_0x1dfd10(0x1dd)),models_entity_1=require(_0x1dfd10(0x170)),status_constant_1=require('../../common/constants/status.constant'),baidu_1=require(_0x1dfd10(0x1b1)),utils_1=require(_0x1dfd10(0x1ac)),model_constant_1=require(_0x1dfd10(0x1c9)),redisCache_service_1=require('../redisCache/redisCache.service'),user_service_1=require(_0x1dfd10(0x17d)),redisKey_constant_1=require(_0x1dfd10(0x1e9)),nestjs_cls_1=require('nestjs-cls'),modelquick_entity_1=require(_0x1dfd10(0x1ea));let ModelsService=class ModelsService{constructor(_0x20ac9d,_0x206da9,_0x3d4b80,_0x58a00,_0x5aa0b0){const _0x11035f=_0x1dfd10;this[_0x11035f(0x1ec)]=_0x20ac9d,this['modelQuickEntity']=_0x206da9,this[_0x11035f(0x19a)]=_0x3d4b80,this[_0x11035f(0x19e)]=_0x58a00,this[_0x11035f(0x177)]=_0x5aa0b0,this[_0x11035f(0x1de)]=[],this[_0x11035f(0x19b)]={},this[_0x11035f(0x176)]={},this[_0x11035f(0x1da)]={},this['keyPoolIndexMap']={};}async[_0x1dfd10(0x16c)](){await this['initCalcKey'](),await this['refreshBaiduAccesstoken']();}async['getOfficialModels'](){const _0xad5699=_0x1dfd10,_0x15a5c7=_0xad5699(0x181),_0x4e8a77=_0x15a5c7+_0xad5699(0x199);return await fetch(_0x4e8a77,{'method':'get','headers':{'Authorization':_0xad5699(0x1a9)}})['then'](async _0x5bf382=>{const _0x4a9102=_0xad5699,_0x407bc0=await _0x5bf382[_0x4a9102(0x1c7)]();return _0x407bc0[_0x4a9102(0x1cc)];});}async[_0x1dfd10(0x17e)](){const _0x20fec3=_0x1dfd10;this['keyPoolMap']={},this['keyPoolIndexMap']={},this[_0x20fec3(0x176)]={},this['modelMaps']={},this['modelTypes']=[];const _0x5f1d9d=await this[_0x20fec3(0x1ec)][_0x20fec3(0x19d)]({'where':{'status':!![]}}),_0x41ab2f=await this[_0x20fec3(0x1ba)][_0x20fec3(0x19d)]({'where':{'isRelease':0x1}}),_0x16b527=_0x5f1d9d['reduce']((_0x564da7,_0x56149d)=>{const _0x122285=_0x20fec3,_0x277d13={..._0x56149d};return _0x277d13['quickList']=[],_0x56149d[_0x122285(0x1b5)]===0x1&&_0x56149d[_0x122285(0x18e)]&&_0x56149d[_0x122285(0x18e)]['length']&&(_0x277d13['quickList']=_0x41ab2f[_0x122285(0x1ed)](_0x428c44=>_0x56149d[_0x122285(0x18e)][_0x122285(0x167)](',')['includes'](_0x428c44['id']['toString']()))),!_0x564da7[_0x277d13[_0x122285(0x1ca)]]?_0x564da7[_0x277d13[_0x122285(0x1ca)]]=[_0x277d13]:_0x564da7[_0x277d13[_0x122285(0x1ca)]]['push'](_0x277d13),_0x564da7;},{});this[_0x20fec3(0x1de)]=Object['keys'](_0x16b527)['map'](_0x5f559a=>{const _0x4a5e30=_0x20fec3;return{'label':status_constant_1[_0x4a5e30(0x1af)][_0x5f559a],'val':_0x5f559a};}),this[_0x20fec3(0x19b)]=_0x16b527,this[_0x20fec3(0x176)]={},_0x5f1d9d[_0x20fec3(0x1d5)](_0x415d8b=>{const _0x2c3226=_0x20fec3,{keyType:_0x349550,model:_0x292049,keyWeight:_0x26d805}=_0x415d8b;if(!this[_0x2c3226(0x1da)][_0x292049])this[_0x2c3226(0x1da)][_0x292049]=[];for(let _0x500879=0x0;_0x500879<_0x26d805;_0x500879++){this[_0x2c3226(0x1da)][_0x292049][_0x2c3226(0x1d6)](_0x415d8b);}if(!this[_0x2c3226(0x18b)][_0x292049])this[_0x2c3226(0x18b)][_0x292049]=0x0;if(!this[_0x2c3226(0x176)][_0x349550])this[_0x2c3226(0x176)][_0x349550]={};if(!this[_0x2c3226(0x176)][_0x349550][_0x292049])this['keyList'][_0x349550][_0x292049]=[];this[_0x2c3226(0x176)][_0x349550][_0x292049][_0x2c3226(0x1d6)](_0x415d8b);});}async[_0x1dfd10(0x1dc)](_0x3d8159,_0x4100f4,_0x3f7ca0=-0x1){const _0x37a94a=_0x1dfd10,_0xec3640=await this['modelsEntity'][_0x37a94a(0x1ce)]({'id':_0x3d8159},{'status':![],'keyStatus':_0x3f7ca0,'remark':_0x4100f4});common_1[_0x37a94a(0x1c8)][_0x37a94a(0x179)]('key:\x20'+_0x3d8159+_0x37a94a(0x183)),await this[_0x37a94a(0x17e)]();}async[_0x1dfd10(0x192)](_0x1d5255){const _0x4e81d7=_0x1dfd10;return this[_0x4e81d7(0x1ec)][_0x4e81d7(0x188)]({'where':{'modelName':_0x1d5255}});}async[_0x1dfd10(0x163)](_0x4c789d){const _0x39ca6c=_0x1dfd10;return this['modelsEntity'][_0x39ca6c(0x188)]({'where':{'model':_0x4c789d}});}async[_0x1dfd10(0x191)](_0x4494f1,_0x2a8673){const _0x56a562=_0x1dfd10;return this['modelsEntity'][_0x56a562(0x188)]({'where':{'modelType':_0x4494f1,'keyType':_0x2a8673}});}async[_0x1dfd10(0x190)](_0x214608,_0x4c5fac){const _0xf233cc=_0x1dfd10;return this[_0xf233cc(0x1ec)][_0xf233cc(0x188)]({'where':{'modelType':_0x214608,'model':_0x4c5fac}});}async[_0x1dfd10(0x1ad)](_0x775e2a){const _0x16a2f1=_0x1dfd10;if(!this[_0x16a2f1(0x1da)][_0x775e2a])throw new common_1[(_0x16a2f1(0x17a))](_0x16a2f1(0x1d7),common_1[_0x16a2f1(0x1c3)][_0x16a2f1(0x172)]);this[_0x16a2f1(0x18b)][_0x775e2a]++;const _0x136482=this['keyPoolIndexMap'][_0x775e2a];if(_0x136482>=this[_0x16a2f1(0x1da)][_0x775e2a]['length'])this[_0x16a2f1(0x18b)][_0x775e2a]=0x0;return this[_0x16a2f1(0x1da)][_0x775e2a][this['keyPoolIndexMap'][_0x775e2a]];}async[_0x1dfd10(0x165)](_0x2b3645,_0x872c3d){const _0x88fe1e=_0x1dfd10,_0x2f9311={'modelType':_0x2b3645,'status':!![],'keyStatus':0x1};_0x872c3d&&(_0x2f9311[_0x88fe1e(0x1ca)]=parseInt(_0x872c3d));const _0x1e0f6f=await this[_0x88fe1e(0x1ec)][_0x88fe1e(0x19d)]({'where':_0x2f9311,'order':{'displaySort':_0x88fe1e(0x16b)}});if(!_0x1e0f6f[_0x88fe1e(0x1d2)])throw new Error(_0x88fe1e(0x1a4));const _0x4afbbe=_0x1e0f6f[0x0],_0x152cdb=this[_0x88fe1e(0x1de)]['find'](_0x38d97b=>Number(_0x38d97b[_0x88fe1e(0x174)])===_0x4afbbe['keyType']);return{'modelTypeInfo':_0x152cdb,'modelInfo':{..._0x4afbbe,'topN':0.8,'systemMessage':'','rounds':0x8}};}async['getModelByType'](_0x27e42a,_0x404346){const _0x28e15c=_0x1dfd10,_0x262f13={'modelType':_0x27e42a,'status':!![],'keyStatus':0x1};_0x404346&&(_0x262f13[_0x28e15c(0x168)]=_0x404346);const _0x22915a=await this[_0x28e15c(0x1ec)][_0x28e15c(0x19d)]({'where':_0x262f13,'order':{'displaySort':'DESC'}});if(!_0x22915a['length'])throw new Error(_0x28e15c(0x1a4));const _0x52f1c7=_0x22915a[0x0],_0x3e2b38=this['modelTypes'][_0x28e15c(0x19d)](_0x187b8b=>Number(_0x187b8b[_0x28e15c(0x174)])===_0x52f1c7['keyType']);return{'modelTypeInfo':_0x3e2b38,'modelInfo':{..._0x52f1c7,'topN':0.8,'systemMessage':'','rounds':0x8}};}async[_0x1dfd10(0x1cd)](_0xc0aa25){const _0x5095d4=_0x1dfd10;try{return await this[_0x5095d4(0x1d3)](_0xc0aa25),await this[_0x5095d4(0x17e)](),_0xc0aa25[_0x5095d4(0x1ca)]===0x2&&this[_0x5095d4(0x169)](),!![];}catch(_0x130097){console[_0x5095d4(0x196)](_0x5095d4(0x1a7),_0x130097);throw new common_1[(_0x5095d4(0x17a))](_0x130097[_0x5095d4(0x1b9)],common_1[_0x5095d4(0x1c3)][_0x5095d4(0x172)]);}}async[_0x1dfd10(0x1d3)](_0x2a2444){const _0x5de18d=_0x1dfd10;_0x2a2444['status']&&(_0x2a2444[_0x5de18d(0x1d8)]=0x1);if(_0x2a2444['id']){const _0x5c5edd=await this[_0x5de18d(0x1ec)]['findOne']({'where':{'id':(0x0,typeorm_2[_0x5de18d(0x1e1)])(_0x2a2444['id']),'modelName':_0x2a2444['modelName'],'modelType':_0x2a2444[_0x5de18d(0x1e2)]}});if(_0x5c5edd)throw new Error(_0x5de18d(0x193));await this[_0x5de18d(0x1ec)][_0x5de18d(0x1ce)]({'id':_0x2a2444['id']},_0x2a2444);}else{const _0x5cfdf6=await this[_0x5de18d(0x1ec)][_0x5de18d(0x188)]({'where':{'modelName':_0x2a2444[_0x5de18d(0x1c2)],'modelType':_0x2a2444[_0x5de18d(0x1e2)]}});if(_0x5cfdf6)throw new Error('名称已存在，请修改名称');await this[_0x5de18d(0x1ec)][_0x5de18d(0x1b3)](_0x2a2444);}}async[_0x1dfd10(0x187)]({id:_0xa8eaeb}){const _0x2cab84=_0x1dfd10;if(!_0xa8eaeb)throw new common_1[(_0x2cab84(0x17a))](_0x2cab84(0x1ef),common_1['HttpStatus']['BAD_REQUEST']);return await this['modelDel']([_0xa8eaeb]),await this[_0x2cab84(0x17e)](),!![];}async[_0x1dfd10(0x185)]({id:_0x5a7490}){const _0x497a81=_0x1dfd10;if(!_0x5a7490)throw new common_1[(_0x497a81(0x17a))]('缺失必要参数！',common_1['HttpStatus']['BAD_REQUEST']);return await this[_0x497a81(0x1ec)][_0x497a81(0x188)]({'where':{'id':_0x5a7490}});}async['modelDel'](_0x14a2b8){const _0x229a98=_0x1dfd10;if(!_0x14a2b8||!_0x14a2b8[_0x229a98(0x1d2)])return!![];return await this['modelsEntity'][_0x229a98(0x197)]({'id':(0x0,typeorm_2['In'])(_0x14a2b8)}),!![];}async[_0x1dfd10(0x1c4)](_0x5e309e,_0x4ad80a){const _0x3b1c00=_0x1dfd10;try{const _0x54d0cf=(0x0,utils_1[_0x3b1c00(0x195)])(this[_0x3b1c00(0x19a)]),_0x6a24ee=(0x0,utils_1[_0x3b1c00(0x1ee)])(this[_0x3b1c00(0x19a)]),{keyType:_0x5a8b34,key:_0x228770,status:_0x59b29e,model:_0x5563c8,modelName:_0x48ff4f,modelType:_0x3cb326,page:page=0x1,size:size=0xa,upload:_0xa62aaa,isAdmin:_0xaa9260,deepthink:_0x2aadd7,recommend:_0x12671d}=_0x4ad80a;let _0x273653={};_0x5563c8&&(_0x273653[_0x3b1c00(0x168)]=_0x5563c8);_0x12671d&&(_0x273653['recommend']=!![]);_0x228770&&(_0x273653[_0x3b1c00(0x171)]=(0x0,typeorm_2['Like'])('%'+_0x228770+'%'));_0x5a8b34&&(_0x273653[_0x3b1c00(0x1ca)]=_0x5a8b34);_0x3cb326&&(_0x273653[_0x3b1c00(0x1e2)]=_0x3cb326);_0xaa9260==0x1?_0x59b29e!==undefined&&(_0x273653[_0x3b1c00(0x18a)]=_0x59b29e):_0x273653['status']=!![];_0x48ff4f&&(_0x273653[_0x3b1c00(0x1c2)]=(0x0,typeorm_2[_0x3b1c00(0x182)])('%'+_0x48ff4f+'%'));_0xa62aaa!==undefined&&(_0x273653[_0x3b1c00(0x1cb)]=Boolean(_0xa62aaa));_0x2aadd7>-0x1&&(_0x273653[_0x3b1c00(0x1c0)]=_0x2aadd7);!(0x0,utils_1[_0x3b1c00(0x19c)])(this[_0x3b1c00(0x19a)])&&(_0x273653[_0x3b1c00(0x1e7)]=!![],_0x273653[_0x3b1c00(0x18a)]=!![]);const [_0x45e366,_0x452d88]=await this['modelsEntity'][_0x3b1c00(0x1be)]({'where':_0x273653,'skip':(page-0x1)*size,'take':size,'order':{'displaySort':_0x3b1c00(0x16b),'createdAt':_0x3b1c00(0x16b)}}),_0x1b0ef3=_0x45e366,_0x5447d4=await this[_0x3b1c00(0x1ba)][_0x3b1c00(0x19d)]({'where':{'isRelease':0x1}});_0x1b0ef3[_0x3b1c00(0x1d5)](_0x1c9f5a=>{const _0x20582b=_0x3b1c00;_0x1c9f5a[_0x20582b(0x160)]=[],_0x1c9f5a[_0x20582b(0x1b5)]===0x1&&_0x1c9f5a[_0x20582b(0x18e)]&&_0x1c9f5a['quickIds'][_0x20582b(0x1d2)]&&(_0x1c9f5a[_0x20582b(0x160)]=_0x5447d4[_0x20582b(0x1ed)](_0x5847c1=>_0x1c9f5a['quickIds']['split'](',')[_0x20582b(0x162)](_0x5847c1['id'][_0x20582b(0x18d)]()))),_0x1c9f5a[_0x20582b(0x1e5)]=_0x1c9f5a[_0x20582b(0x1a0)]?!![]:![];});!(0x0,utils_1[_0x3b1c00(0x19c)])(this[_0x3b1c00(0x19a)])&&_0x1b0ef3[_0x3b1c00(0x1d5)](_0x5f2140=>{const _0x339d69=_0x3b1c00;_0x5f2140[_0x339d69(0x171)]=(0x0,utils_1[_0x339d69(0x17f)])(_0x5f2140[_0x339d69(0x171)]),_0x5f2140[_0x339d69(0x1a8)]=(0x0,utils_1[_0x339d69(0x17f)])(_0x5f2140['secret']),_0x5f2140[_0x339d69(0x164)]=(0x0,utils_1[_0x339d69(0x17f)])(_0x5f2140[_0x339d69(0x164)]);});if(_0x6a24ee){const _0x395fe9=await this[_0x3b1c00(0x19e)][_0x3b1c00(0x1d4)](_0x6a24ee);if(_0x395fe9['vipExpire']||_0x395fe9[_0x3b1c00(0x1d0)]){const _0xe988a5=[];for(let _0x5eefd4=0x0;_0x5eefd4<_0x1b0ef3[_0x3b1c00(0x1d2)];_0x5eefd4++){const _0x130941=_0x1b0ef3[_0x5eefd4],_0xe22ad5=redisKey_constant_1['VIP_FREE']+'-'+_0x6a24ee+'-'+_0x130941['id'],_0x266ceb=await await this[_0x3b1c00(0x177)][_0x3b1c00(0x1bc)]({'key':_0xe22ad5});_0xe988a5[_0x3b1c00(0x1d6)](Object[_0x3b1c00(0x1bd)]({},_0x130941,{'used':_0x266ceb||0x0}));}return{'rows':_0xe988a5,'count':_0x452d88};}}return{'rows':_0x1b0ef3,'count':_0x452d88};}catch(_0x36662d){return console[_0x3b1c00(0x196)](_0x3b1c00(0x1b7),_0x36662d),_0x36662d;}}[_0x1dfd10(0x178)](_0x2f584b){const _0x500ec4=_0x1dfd10;return this[_0x500ec4(0x1ec)][_0x500ec4(0x188)]({'where':{'id':_0x2f584b}});}[_0x1dfd10(0x1df)](_0x262dd4){const _0x16afde=_0x1dfd10;return this[_0x16afde(0x1ec)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x262dd4)}});}[_0x1dfd10(0x16e)](_0x4b311d){const _0x17ebff=_0x1dfd10;return this[_0x17ebff(0x1ec)]['find']({'where':{'modelType':_0x4b311d}});}async[_0x1dfd10(0x1e0)](_0x5fd7a5=0x0){const _0x3ceac2=_0x1dfd10,_0x2db3e3=(0x0,utils_1[_0x3ceac2(0x1a3)])(this[_0x3ceac2(0x19b)]);return Object[_0x3ceac2(0x1a5)](_0x2db3e3)[_0x3ceac2(0x1d5)](_0x63eaba=>{const _0x733681=_0x3ceac2;let _0x457735=_0x2db3e3[_0x63eaba];if(_0x5fd7a5===0x0)_0x457735=_0x457735[_0x733681(0x1ed)](_0x107007=>Boolean(_0x107007[_0x733681(0x1e7)]))[_0x733681(0x1e3)]((_0x5e3011,_0x3cc123)=>_0x3cc123[_0x733681(0x186)]-_0x5e3011[_0x733681(0x186)]);else _0x5fd7a5===0x2&&(_0x457735=_0x457735[_0x733681(0x1ed)](_0x4759c1=>!Boolean(_0x4759c1[_0x733681(0x1e7)]))['sort']((_0x578b60,_0x2c28c8)=>_0x2c28c8['displaySort']-_0x578b60[_0x733681(0x186)]));_0x2db3e3[_0x63eaba]=_0x457735[_0x733681(0x161)](_0xe26f86=>{const _0x28d8fd=_0x733681;return Object[_0x28d8fd(0x1bd)]({},_0xe26f86);});}),{'modelTypeList':this[_0x3ceac2(0x1de)],'modelMaps':_0x2db3e3};}async[_0x1dfd10(0x194)](_0x33ead2,_0x67d606){const _0x27dd34=_0x1dfd10;await this[_0x27dd34(0x1ec)]['createQueryBuilder']()[_0x27dd34(0x1ce)](models_entity_1[_0x27dd34(0x173)])['set']({'useCount':()=>_0x27dd34(0x1e8),'useToken':()=>_0x27dd34(0x1ab)+_0x67d606})['where'](_0x27dd34(0x1c6),{'id':_0x33ead2})[_0x27dd34(0x175)]();}async[_0x1dfd10(0x169)](){const _0x1e7654=_0x1dfd10,_0x28444a=await this['modelsEntity']['find']({'where':{'keyType':0x2}}),_0x4230fb={};_0x28444a[_0x1e7654(0x1d5)](_0xcce996=>{const _0x1c4b23=_0x1e7654,{key:_0x2b3ed5,secret:_0x81d235}=_0xcce996;!_0x4230fb[_0x1c4b23(0x171)]?_0x4230fb[_0x2b3ed5]=[{'keyInfo':_0xcce996}]:_0x4230fb[_0x2b3ed5]['push'](_0xcce996);}),Object[_0x1e7654(0x1a5)](_0x4230fb)[_0x1e7654(0x1d5)](async _0x2e23e6=>{const _0x480ff3=_0x1e7654,{secret:_0x4ac396,id:_0x553473}=_0x4230fb[_0x2e23e6][0x0][_0x480ff3(0x1a2)],_0x487ac7=await(0x0,baidu_1['getAccessToken'])(_0x2e23e6,_0x4ac396);await this[_0x480ff3(0x1ec)][_0x480ff3(0x1ce)]({'key':_0x2e23e6},{'accessToken':_0x487ac7});}),setTimeout(()=>{const _0x39fecf=_0x1e7654;this[_0x39fecf(0x17e)]();},0x3e8);}async['getRandomKey'](_0x36cb6e,_0xef888c=''){const _0x4de405=_0x1dfd10;let _0x10926a;_0xef888c?_0x10926a=await this[_0x4de405(0x1ec)][_0x4de405(0x19d)]({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x36cb6e,'model':_0xef888c},'order':{'displaySort':_0x4de405(0x16b)}}):_0x10926a=await this[_0x4de405(0x1ec)][_0x4de405(0x19d)]({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x36cb6e},'order':{'displaySort':_0x4de405(0x16b)}});if(!_0x10926a[_0x4de405(0x1d2)])throw new common_1[(_0x4de405(0x17a))](_0x4de405(0x16f),common_1[_0x4de405(0x1c3)][_0x4de405(0x172)]);return _0x10926a[0x0];}async[_0x1dfd10(0x1d1)](_0x5346b0,_0x2e37fb){const _0x292e6a=_0x1dfd10;let _0x1bc21b=await this[_0x292e6a(0x1ec)]['find']({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x5346b0,'keyType':_0x2e37fb},'order':{'displaySort':_0x292e6a(0x16b)}});if(!_0x1bc21b[_0x292e6a(0x1d2)])throw new common_1['HttpException']('当前未指定特殊模型KEY、前往后台设置！',common_1[_0x292e6a(0x1c3)][_0x292e6a(0x172)]);return _0x1bc21b[0x0];}async[_0x1dfd10(0x1ae)](){const _0x29ca9c=_0x1dfd10,_0x1a10e6=await this['modelsEntity']['find']({'where':{'status':!![],'keyStatus':0x1,'canAudio':!![]}});if(!_0x1a10e6[_0x29ca9c(0x1d2)])throw new common_1[(_0x29ca9c(0x17a))](_0x29ca9c(0x189),common_1[_0x29ca9c(0x1c3)][_0x29ca9c(0x172)]);return _0x1a10e6[0x0];}async[_0x1dfd10(0x198)](){const _0x433ae6=_0x1dfd10;return await this['modelsEntity'][_0x433ae6(0x19d)]();}async['getMusicModel'](){const _0x41a2d2=_0x1dfd10;try{const _0x1f6120=await this[_0x41a2d2(0x1ec)]['find']({'where':{'status':!![],'keyStatus':0x1,'modelType':model_constant_1['EModelType']['MUSIC']}});if(_0x1f6120['length']===0x0)throw new Error('暂未配置音乐模型，请联系管理员');return _0x1f6120[Math[_0x41a2d2(0x180)](Math['random']()*_0x1f6120[_0x41a2d2(0x1d2)])];}catch(_0x2f9681){throw new common_1[(_0x41a2d2(0x17a))](_0x2f9681['message'],common_1[_0x41a2d2(0x1c3)][_0x41a2d2(0x172)]);}}};ModelsService=__decorate([(0x0,common_1[_0x1dfd10(0x1b0)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(models_entity_1[_0x1dfd10(0x173)])),__param(0x1,(0x0,typeorm_1[_0x1dfd10(0x1aa)])(modelquick_entity_1[_0x1dfd10(0x184)])),__metadata(_0x1dfd10(0x1eb),[typeorm_2['Repository'],typeorm_2[_0x1dfd10(0x1c1)],nestjs_cls_1['ClsService'],user_service_1['UserService'],redisCache_service_1['RedisCacheService']])],ModelsService),exports[_0x1dfd10(0x19f)]=ModelsService;