'use strict';const _0x28212a=_0x58f9;(function(_0x24ebb5,_0x32f808){const _0x46514e=_0x58f9,_0x348c57=_0x24ebb5();while(!![]){try{const _0x513345=parseInt(_0x46514e(0xb7))/0x1+parseInt(_0x46514e(0x79))/0x2*(parseInt(_0x46514e(0xc4))/0x3)+-parseInt(_0x46514e(0xf7))/0x4+-parseInt(_0x46514e(0xf5))/0x5+parseInt(_0x46514e(0x96))/0x6*(parseInt(_0x46514e(0x89))/0x7)+-parseInt(_0x46514e(0xe8))/0x8*(-parseInt(_0x46514e(0x94))/0x9)+parseInt(_0x46514e(0xf1))/0xa;if(_0x513345===_0x32f808)break;else _0x348c57['push'](_0x348c57['shift']());}catch(_0x122898){_0x348c57['push'](_0x348c57['shift']());}}}(_0x55b3,0x2741a));var __decorate=this&&this[_0x28212a(0xe6)]||function(_0xca2316,_0x283caf,_0xcce45d,_0xe3135a){const _0x49677c=_0x28212a;var _0x5b1aa9=arguments[_0x49677c(0xaf)],_0xdde1c6=_0x5b1aa9<0x3?_0x283caf:_0xe3135a===null?_0xe3135a=Object[_0x49677c(0x8b)](_0x283caf,_0xcce45d):_0xe3135a,_0x3eeebc;if(typeof Reflect===_0x49677c(0x93)&&typeof Reflect[_0x49677c(0xf3)]===_0x49677c(0x102))_0xdde1c6=Reflect[_0x49677c(0xf3)](_0xca2316,_0x283caf,_0xcce45d,_0xe3135a);else{for(var _0x2f10f3=_0xca2316[_0x49677c(0xaf)]-0x1;_0x2f10f3>=0x0;_0x2f10f3--)if(_0x3eeebc=_0xca2316[_0x2f10f3])_0xdde1c6=(_0x5b1aa9<0x3?_0x3eeebc(_0xdde1c6):_0x5b1aa9>0x3?_0x3eeebc(_0x283caf,_0xcce45d,_0xdde1c6):_0x3eeebc(_0x283caf,_0xcce45d))||_0xdde1c6;}return _0x5b1aa9>0x3&&_0xdde1c6&&Object['defineProperty'](_0x283caf,_0xcce45d,_0xdde1c6),_0xdde1c6;},__metadata=this&&this['__metadata']||function(_0x46924f,_0x4d9e1f){const _0x43988b=_0x28212a;if(typeof Reflect===_0x43988b(0x93)&&typeof Reflect[_0x43988b(0xaa)]===_0x43988b(0x102))return Reflect[_0x43988b(0xaa)](_0x46924f,_0x4d9e1f);},__param=this&&this[_0x28212a(0xd9)]||function(_0x381754,_0xf99e2c){return function(_0x4f18c9,_0x377d52){_0xf99e2c(_0x4f18c9,_0x377d52,_0x381754);};};function _0x58f9(_0x95ac41,_0x55abde){const _0x55b364=_0x55b3();return _0x58f9=function(_0x58f944,_0x5e911c){_0x58f944=_0x58f944-0x77;let _0x362011=_0x55b364[_0x58f944];return _0x362011;},_0x58f9(_0x95ac41,_0x55abde);}Object[_0x28212a(0x8d)](exports,_0x28212a(0x7f),{'value':!![]}),exports['ModelsService']=void 0x0;const common_1=require(_0x28212a(0xf6)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x28212a(0xb3)),models_entity_1=require(_0x28212a(0xd7)),status_constant_1=require('../../common/constants/status.constant'),baidu_1=require(_0x28212a(0x85)),utils_1=require(_0x28212a(0x81)),model_constant_1=require('../../common/constants/model.constant'),redisCache_service_1=require(_0x28212a(0x98)),user_service_1=require('../user/user.service'),redisKey_constant_1=require('../../common/constants/redisKey.constant'),nestjs_cls_1=require('nestjs-cls'),modelquick_entity_1=require(_0x28212a(0xfc));function _0x55b3(){const _0xa9b941=['function','queryModels','EModelType','saveUseLog','model','getAccessToken','userService','36098HIcxMg','getUserById','forEach','secret','refreshBaiduAccesstoken','set','__esModule','getCurrentModelKeyInfo','../../common/utils','modelName','getRandomKeyForKeyType','getModelByIds','../chatgpt/baidu','keyPoolMap','当前未指定语音对话模型KEY、前往后台设置把！','random','509201RVkHFx','BAD_REQUEST','getOwnPropertyDescriptor','ModelsMapCn','defineProperty','modelType','push','isSuper','deepthink','Repository','object','207LmrlPW','https://apiv.chatgpt-3.vip','6phSsuW','getRandomKey','../redisCache/redisCache.service','deepClone','getModelInfoByKeyType','Logger','key','lockKey','filter','keyType','log','HttpStatus','keyStatus','initCalcKey','data','当前调用模型已经被移除、请重新选择模型！','getModelByModel','getModelById','RedisCacheService','getModelsByModelType','metadata','quickList','findAndCount','canUpload','split','length','DESC','key:\x20','execute','typeorm','keyPoolIndexMap','modelSave','InjectRepository','171779KWHDFD','UserService','includes','vipExpire','当前未指定特殊模型KEY、前往后台设置！','ModelQuickEntity','assign','status','modelMaps','getAllKey','isQuick','Injectable','floor','9GLLcXT','error:\x20','displaySort','toString','onModuleInit','暂未配置相关模型，请联系管理员！','getOfficialModels','update','modelDel','createQueryBuilder','quickIds','ModelsService','keyInfo','keys','modelsList','modelQuickEntity','save','modelsEntity','getUserId','./models.entity','VIP_FREE','__param','----------------------------------------ERR--------','getModelByKeyModel','map','lifetimeVip','Like','getMusicModel','Bearer\x20sk-bSm3FROxNJ1oIkmd5dDc9b582d3d48E09d12E86eF7FfC0C4','get','where','clsService','HttpException','名称已存在，请修改名称','__decorate','front','79496PQBhjr','json','hideString','useCount\x20+\x201','message','useToken\x20+\x20','find','暂未配置音乐模型，请联系管理员','\x20欠费或被官方封禁导致不可用，已被系统自动锁定','79930fNuKdm','proxyUrl','decorate','redisCacheService','749345cpKtnN','@nestjs/common','898200LcktZX','keyList','delete','sort','modelTypes','./modelquick.entity','findOne','/v1/models','getModelByKeyType','getModelByName','id\x20=\x20:id'];_0x55b3=function(){return _0xa9b941;};return _0x55b3();}let ModelsService=class ModelsService{constructor(_0x8dae81,_0x4cd887,_0x327298,_0x14151d,_0x276a9f){const _0x8ce339=_0x28212a;this[_0x8ce339(0xd5)]=_0x8dae81,this[_0x8ce339(0xd3)]=_0x4cd887,this['clsService']=_0x327298,this[_0x8ce339(0x78)]=_0x14151d,this[_0x8ce339(0xf4)]=_0x276a9f,this[_0x8ce339(0xfb)]=[],this[_0x8ce339(0xbf)]={},this[_0x8ce339(0xf8)]={},this[_0x8ce339(0x86)]={},this['keyPoolIndexMap']={};}async[_0x28212a(0xc8)](){await this['initCalcKey'](),await this['refreshBaiduAccesstoken']();}async[_0x28212a(0xca)](){const _0x1b0761=_0x28212a,_0x23e591=_0x1b0761(0x95),_0xb2d6a=_0x23e591+_0x1b0761(0xfe);return await fetch(_0xb2d6a,{'method':_0x1b0761(0xe1),'headers':{'Authorization':_0x1b0761(0xe0)}})['then'](async _0x1f1786=>{const _0x1c4850=_0x1b0761,_0x1e26bb=await _0x1f1786[_0x1c4850(0xe9)]();return _0x1e26bb[_0x1c4850(0xa4)];});}async[_0x28212a(0xa3)](){const _0x15314c=_0x28212a;this['keyPoolMap']={},this['keyPoolIndexMap']={},this[_0x15314c(0xf8)]={},this[_0x15314c(0xbf)]={},this[_0x15314c(0xfb)]=[];const _0x19281f=await this[_0x15314c(0xd5)][_0x15314c(0xee)]({'where':{'status':!![]}}),_0x1cfe8f=await this[_0x15314c(0xd3)]['find']({'where':{'isRelease':0x1}}),_0x13ab5d=_0x19281f['reduce']((_0x3e0953,_0x184c9a)=>{const _0x31c775=_0x15314c,_0x349e55={..._0x184c9a};return _0x349e55['quickList']=[],_0x184c9a[_0x31c775(0xc1)]===0x1&&_0x184c9a[_0x31c775(0xce)]&&_0x184c9a[_0x31c775(0xce)][_0x31c775(0xaf)]&&(_0x349e55[_0x31c775(0xab)]=_0x1cfe8f[_0x31c775(0x9e)](_0x3cb52a=>_0x184c9a['quickIds'][_0x31c775(0xae)](',')[_0x31c775(0xb9)](_0x3cb52a['id'][_0x31c775(0xc7)]()))),!_0x3e0953[_0x349e55['keyType']]?_0x3e0953[_0x349e55[_0x31c775(0x9f)]]=[_0x349e55]:_0x3e0953[_0x349e55[_0x31c775(0x9f)]][_0x31c775(0x8f)](_0x349e55),_0x3e0953;},{});this[_0x15314c(0xfb)]=Object['keys'](_0x13ab5d)[_0x15314c(0xdc)](_0x1f594e=>{const _0xf406a8=_0x15314c;return{'label':status_constant_1[_0xf406a8(0x8c)][_0x1f594e],'val':_0x1f594e};}),this['modelMaps']=_0x13ab5d,this['keyList']={},_0x19281f[_0x15314c(0x7b)](_0x4ab1c6=>{const _0x467d1c=_0x15314c,{keyType:_0x59958f,model:_0x4c6e79,keyWeight:_0x1238f6}=_0x4ab1c6;if(!this[_0x467d1c(0x86)][_0x4c6e79])this['keyPoolMap'][_0x4c6e79]=[];for(let _0x18b7a7=0x0;_0x18b7a7<_0x1238f6;_0x18b7a7++){this[_0x467d1c(0x86)][_0x4c6e79][_0x467d1c(0x8f)](_0x4ab1c6);}if(!this[_0x467d1c(0xb4)][_0x4c6e79])this[_0x467d1c(0xb4)][_0x4c6e79]=0x0;if(!this[_0x467d1c(0xf8)][_0x59958f])this[_0x467d1c(0xf8)][_0x59958f]={};if(!this[_0x467d1c(0xf8)][_0x59958f][_0x4c6e79])this[_0x467d1c(0xf8)][_0x59958f][_0x4c6e79]=[];this['keyList'][_0x59958f][_0x4c6e79][_0x467d1c(0x8f)](_0x4ab1c6);});}async[_0x28212a(0x9d)](_0xf2f80e,_0x52ce43,_0x3c0c7f=-0x1){const _0x5c337d=_0x28212a,_0x1be738=await this['modelsEntity'][_0x5c337d(0xcb)]({'id':_0xf2f80e},{'status':![],'keyStatus':_0x3c0c7f,'remark':_0x52ce43});common_1[_0x5c337d(0x9b)]['error'](_0x5c337d(0xb1)+_0xf2f80e+_0x5c337d(0xf0)),await this[_0x5c337d(0xa3)]();}async[_0x28212a(0x100)](_0x3c8eda){const _0x30b19f=_0x28212a;return this[_0x30b19f(0xd5)][_0x30b19f(0xfd)]({'where':{'modelName':_0x3c8eda}});}async[_0x28212a(0xa6)](_0x1e3d65){const _0x13e9ec=_0x28212a;return this[_0x13e9ec(0xd5)][_0x13e9ec(0xfd)]({'where':{'model':_0x1e3d65}});}async[_0x28212a(0xff)](_0x4dc64f,_0xe0d647){const _0x12bd2b=_0x28212a;return this[_0x12bd2b(0xd5)][_0x12bd2b(0xfd)]({'where':{'modelType':_0x4dc64f,'keyType':_0xe0d647}});}async[_0x28212a(0xdb)](_0x99fe84,_0x3d5ce8){return this['modelsEntity']['findOne']({'where':{'modelType':_0x99fe84,'model':_0x3d5ce8}});}async[_0x28212a(0x80)](_0x1c3d8b){const _0x28043f=_0x28212a;if(!this['keyPoolMap'][_0x1c3d8b])throw new common_1[(_0x28043f(0xe4))](_0x28043f(0xa5),common_1[_0x28043f(0xa1)][_0x28043f(0x8a)]);this[_0x28043f(0xb4)][_0x1c3d8b]++;const _0x134b94=this['keyPoolIndexMap'][_0x1c3d8b];if(_0x134b94>=this[_0x28043f(0x86)][_0x1c3d8b][_0x28043f(0xaf)])this[_0x28043f(0xb4)][_0x1c3d8b]=0x0;return this[_0x28043f(0x86)][_0x1c3d8b][this[_0x28043f(0xb4)][_0x1c3d8b]];}async[_0x28212a(0x9a)](_0x50140c,_0x22db49){const _0x41024e=_0x28212a,_0x3184e4={'modelType':_0x50140c,'status':!![],'keyStatus':0x1};_0x22db49&&(_0x3184e4[_0x41024e(0x9f)]=parseInt(_0x22db49));const _0x4a9654=await this[_0x41024e(0xd5)][_0x41024e(0xee)]({'where':_0x3184e4,'order':{'displaySort':'DESC'}});if(!_0x4a9654[_0x41024e(0xaf)])throw new Error(_0x41024e(0xc9));const _0x375f1c=_0x4a9654[0x0],_0x579da9=this[_0x41024e(0xfb)][_0x41024e(0xee)](_0x11eb8f=>Number(_0x11eb8f['val'])===_0x375f1c[_0x41024e(0x9f)]);return{'modelTypeInfo':_0x579da9,'modelInfo':{..._0x375f1c,'topN':0.8,'systemMessage':'','rounds':0x8}};}async['getModelByType'](_0x5b268d,_0x1f3afe){const _0x598766=_0x28212a,_0x25abbb={'modelType':_0x5b268d,'status':!![],'keyStatus':0x1};_0x1f3afe&&(_0x25abbb[_0x598766(0x106)]=_0x1f3afe);const _0x2a6040=await this[_0x598766(0xd5)][_0x598766(0xee)]({'where':_0x25abbb,'order':{'displaySort':_0x598766(0xb0)}});if(!_0x2a6040[_0x598766(0xaf)])throw new Error(_0x598766(0xc9));const _0x310a31=_0x2a6040[0x0],_0x579517=this[_0x598766(0xfb)][_0x598766(0xee)](_0xf91a13=>Number(_0xf91a13['val'])===_0x310a31[_0x598766(0x9f)]);return{'modelTypeInfo':_0x579517,'modelInfo':{..._0x310a31,'topN':0.8,'systemMessage':'','rounds':0x8}};}async['setModel'](_0x4bc1ea){const _0x65b603=_0x28212a;try{return await this[_0x65b603(0xb5)](_0x4bc1ea),await this[_0x65b603(0xa3)](),_0x4bc1ea[_0x65b603(0x9f)]===0x2&&this[_0x65b603(0x7d)](),!![];}catch(_0x3332ba){console[_0x65b603(0xa0)](_0x65b603(0xc5),_0x3332ba);throw new common_1['HttpException'](_0x3332ba['message'],common_1[_0x65b603(0xa1)][_0x65b603(0x8a)]);}}async['modelSave'](_0x34a6c5){const _0x13c4aa=_0x28212a;_0x34a6c5[_0x13c4aa(0xbe)]&&(_0x34a6c5[_0x13c4aa(0xa2)]=0x1);if(_0x34a6c5['id']){const _0x35aa56=await this[_0x13c4aa(0xd5)][_0x13c4aa(0xfd)]({'where':{'id':(0x0,typeorm_2['Not'])(_0x34a6c5['id']),'modelName':_0x34a6c5[_0x13c4aa(0x82)],'modelType':_0x34a6c5['modelType']}});if(_0x35aa56)throw new Error(_0x13c4aa(0xe5));await this[_0x13c4aa(0xd5)][_0x13c4aa(0xcb)]({'id':_0x34a6c5['id']},_0x34a6c5);}else{const _0x4f2ef7=await this[_0x13c4aa(0xd5)][_0x13c4aa(0xfd)]({'where':{'modelName':_0x34a6c5[_0x13c4aa(0x82)],'modelType':_0x34a6c5[_0x13c4aa(0x8e)]}});if(_0x4f2ef7)throw new Error(_0x13c4aa(0xe5));await this[_0x13c4aa(0xd5)][_0x13c4aa(0xd4)](_0x34a6c5);}}async['delModel']({id:_0x2cda4e}){const _0x1b76f5=_0x28212a;if(!_0x2cda4e)throw new common_1[(_0x1b76f5(0xe4))]('缺失必要参数！',common_1[_0x1b76f5(0xa1)][_0x1b76f5(0x8a)]);return await this[_0x1b76f5(0xcc)]([_0x2cda4e]),await this[_0x1b76f5(0xa3)](),!![];}async['modelDel'](_0x3a19a1){const _0x3c0aaf=_0x28212a;if(!_0x3a19a1||!_0x3a19a1['length'])return!![];return await this[_0x3c0aaf(0xd5)][_0x3c0aaf(0xf9)]({'id':(0x0,typeorm_2['In'])(_0x3a19a1)}),!![];}async[_0x28212a(0x103)](_0x4234ff,_0x1d425f){const _0x3d2d47=_0x28212a;try{const _0x4f1e35=(0x0,utils_1['getRole'])(this[_0x3d2d47(0xe3)]),_0x3d3c7d=(0x0,utils_1[_0x3d2d47(0xd6)])(this['clsService']),{keyType:_0x21a5ea,key:_0xaef618,status:_0x425e3d,model:_0x11ed1f,modelName:_0x1a5acf,modelType:_0x27452a,page:page=0x1,size:size=0xa,upload:_0x149f52,isAdmin:_0x2fb496,deepthink:_0x200737}=_0x1d425f;let _0x5f0449={};_0x11ed1f&&(_0x5f0449[_0x3d2d47(0x106)]=_0x11ed1f);_0xaef618&&(_0x5f0449[_0x3d2d47(0x9c)]=(0x0,typeorm_2[_0x3d2d47(0xde)])('%'+_0xaef618+'%'));_0x21a5ea&&(_0x5f0449[_0x3d2d47(0x9f)]=_0x21a5ea);_0x27452a&&(_0x5f0449[_0x3d2d47(0x8e)]=_0x27452a);_0x2fb496==0x1?_0x425e3d!==undefined&&(_0x5f0449[_0x3d2d47(0xbe)]=_0x425e3d):_0x5f0449['status']=!![];_0x1a5acf&&(_0x5f0449[_0x3d2d47(0x82)]=(0x0,typeorm_2[_0x3d2d47(0xde)])('%'+_0x1a5acf+'%'));_0x149f52!==undefined&&(_0x5f0449[_0x3d2d47(0xad)]=Boolean(_0x149f52));_0x200737>-0x1&&(_0x5f0449[_0x3d2d47(0x91)]=_0x200737);!(0x0,utils_1[_0x3d2d47(0x90)])(this['clsService'])&&(_0x5f0449['front']=!![],_0x5f0449[_0x3d2d47(0xbe)]=!![]);const [_0x130751,_0x4fe997]=await this[_0x3d2d47(0xd5)][_0x3d2d47(0xac)]({'where':_0x5f0449,'skip':(page-0x1)*size,'take':size,'order':{'displaySort':_0x3d2d47(0xb0),'createdAt':'DESC'}}),_0x1dd128=_0x130751,_0x4b950a=await this[_0x3d2d47(0xd3)][_0x3d2d47(0xee)]({'where':{'isRelease':0x1}});_0x1dd128['forEach'](_0x565e63=>{const _0x31df44=_0x3d2d47;_0x565e63[_0x31df44(0xab)]=[],_0x565e63[_0x31df44(0xc1)]===0x1&&_0x565e63[_0x31df44(0xce)]&&_0x565e63[_0x31df44(0xce)][_0x31df44(0xaf)]&&(_0x565e63[_0x31df44(0xab)]=_0x4b950a[_0x31df44(0x9e)](_0x41e182=>_0x565e63['quickIds'][_0x31df44(0xae)](',')['includes'](_0x41e182['id']['toString']())));});!(0x0,utils_1[_0x3d2d47(0x90)])(this[_0x3d2d47(0xe3)])&&_0x1dd128['forEach'](_0xe0d9f8=>{const _0x5b9c53=_0x3d2d47;_0xe0d9f8[_0x5b9c53(0x9c)]=(0x0,utils_1[_0x5b9c53(0xea)])(_0xe0d9f8[_0x5b9c53(0x9c)]),_0xe0d9f8[_0x5b9c53(0x7c)]=(0x0,utils_1[_0x5b9c53(0xea)])(_0xe0d9f8[_0x5b9c53(0x7c)]),_0xe0d9f8[_0x5b9c53(0xf2)]=(0x0,utils_1[_0x5b9c53(0xea)])(_0xe0d9f8[_0x5b9c53(0xf2)]);});if(_0x3d3c7d){const _0x44273c=await this['userService'][_0x3d2d47(0x7a)](_0x3d3c7d);if(_0x44273c[_0x3d2d47(0xba)]||_0x44273c[_0x3d2d47(0xdd)]){const _0x1548bf=[];for(let _0x583220=0x0;_0x583220<_0x1dd128['length'];_0x583220++){const _0x18a7ea=_0x1dd128[_0x583220],_0x530b3b=redisKey_constant_1[_0x3d2d47(0xd8)]+'-'+_0x3d3c7d+'-'+_0x18a7ea['id'],_0x5a1626=await await this[_0x3d2d47(0xf4)][_0x3d2d47(0xe1)]({'key':_0x530b3b});_0x1548bf[_0x3d2d47(0x8f)](Object[_0x3d2d47(0xbd)]({},_0x18a7ea,{'used':_0x5a1626||0x0}));}return{'rows':_0x1548bf,'count':_0x4fe997};}}return{'rows':_0x1dd128,'count':_0x4fe997};}catch(_0x5bc7a2){return console[_0x3d2d47(0xa0)](_0x3d2d47(0xda),_0x5bc7a2),_0x5bc7a2;}}[_0x28212a(0xa7)](_0x2f806a){const _0xfe1d9d=_0x28212a;return this['modelsEntity'][_0xfe1d9d(0xfd)]({'where':{'id':_0x2f806a}});}[_0x28212a(0x84)](_0xf97962){const _0x41b7fd=_0x28212a;return this['modelsEntity'][_0x41b7fd(0xee)]({'where':{'id':(0x0,typeorm_2['In'])(_0xf97962)}});}[_0x28212a(0xa9)](_0x3f237e){const _0x186991=_0x28212a;return this[_0x186991(0xd5)][_0x186991(0xee)]({'where':{'modelType':_0x3f237e}});}async[_0x28212a(0xd2)](_0x35027a=0x0){const _0x5952e5=_0x28212a,_0x28cc90=(0x0,utils_1[_0x5952e5(0x99)])(this[_0x5952e5(0xbf)]);return Object[_0x5952e5(0xd1)](_0x28cc90)[_0x5952e5(0x7b)](_0x35cddd=>{const _0x5574c5=_0x5952e5;let _0x35beb4=_0x28cc90[_0x35cddd];if(_0x35027a===0x0)_0x35beb4=_0x35beb4['filter'](_0x238432=>Boolean(_0x238432[_0x5574c5(0xe7)]))[_0x5574c5(0xfa)]((_0x40d341,_0x97451a)=>_0x97451a[_0x5574c5(0xc6)]-_0x40d341[_0x5574c5(0xc6)]);else _0x35027a===0x2&&(_0x35beb4=_0x35beb4['filter'](_0x255842=>!Boolean(_0x255842[_0x5574c5(0xe7)]))[_0x5574c5(0xfa)]((_0x21b658,_0x9707e6)=>_0x9707e6[_0x5574c5(0xc6)]-_0x21b658[_0x5574c5(0xc6)]));_0x28cc90[_0x35cddd]=_0x35beb4[_0x5574c5(0xdc)](_0x15d4bc=>{const _0x407d87=_0x5574c5;return Object[_0x407d87(0xbd)]({},_0x15d4bc);});}),{'modelTypeList':this[_0x5952e5(0xfb)],'modelMaps':_0x28cc90};}async[_0x28212a(0x105)](_0x9afcb8,_0x57d6b2){const _0x3946df=_0x28212a;await this[_0x3946df(0xd5)][_0x3946df(0xcd)]()[_0x3946df(0xcb)](models_entity_1['ModelsEntity'])[_0x3946df(0x7e)]({'useCount':()=>_0x3946df(0xeb),'useToken':()=>_0x3946df(0xed)+_0x57d6b2})[_0x3946df(0xe2)](_0x3946df(0x101),{'id':_0x9afcb8})[_0x3946df(0xb2)]();}async['refreshBaiduAccesstoken'](){const _0x144d51=_0x28212a,_0x2f6a1c=await this[_0x144d51(0xd5)][_0x144d51(0xee)]({'where':{'keyType':0x2}}),_0xbd8528={};_0x2f6a1c[_0x144d51(0x7b)](_0x43d435=>{const _0x2cc529=_0x144d51,{key:_0x5f30af,secret:_0x4801f4}=_0x43d435;!_0xbd8528[_0x2cc529(0x9c)]?_0xbd8528[_0x5f30af]=[{'keyInfo':_0x43d435}]:_0xbd8528[_0x5f30af]['push'](_0x43d435);}),Object['keys'](_0xbd8528)['forEach'](async _0xa05965=>{const _0x196b7e=_0x144d51,{secret:_0x1ab035,id:_0x267c6b}=_0xbd8528[_0xa05965][0x0][_0x196b7e(0xd0)],_0x541448=await(0x0,baidu_1[_0x196b7e(0x77)])(_0xa05965,_0x1ab035);await this[_0x196b7e(0xd5)]['update']({'key':_0xa05965},{'accessToken':_0x541448});}),setTimeout(()=>{this['initCalcKey']();},0x3e8);}async[_0x28212a(0x97)](_0x400021,_0x5cca61=''){const _0x399bbc=_0x28212a;let _0x151ded;_0x5cca61?_0x151ded=await this['modelsEntity']['find']({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x400021,'model':_0x5cca61},'order':{'displaySort':'DESC'}}):_0x151ded=await this[_0x399bbc(0xd5)][_0x399bbc(0xee)]({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x400021},'order':{'displaySort':'DESC'}});if(!_0x151ded[_0x399bbc(0xaf)])throw new common_1[(_0x399bbc(0xe4))](_0x399bbc(0xbb),common_1[_0x399bbc(0xa1)]['BAD_REQUEST']);return _0x151ded[0x0];}async[_0x28212a(0x83)](_0x45198c,_0x481bc8){const _0xdc7ea=_0x28212a;let _0x4bcf15=await this[_0xdc7ea(0xd5)]['find']({'where':{'status':!![],'keyStatus':0x1,'modelType':_0x45198c,'keyType':_0x481bc8},'order':{'displaySort':_0xdc7ea(0xb0)}});if(!_0x4bcf15[_0xdc7ea(0xaf)])throw new common_1['HttpException'](_0xdc7ea(0xbb),common_1[_0xdc7ea(0xa1)]['BAD_REQUEST']);return _0x4bcf15[0x0];}async['getRandomAudioKey'](){const _0x25fce7=_0x28212a,_0x500fa7=await this[_0x25fce7(0xd5)][_0x25fce7(0xee)]({'where':{'status':!![],'keyStatus':0x1,'canAudio':!![]}});if(!_0x500fa7[_0x25fce7(0xaf)])throw new common_1[(_0x25fce7(0xe4))](_0x25fce7(0x87),common_1[_0x25fce7(0xa1)][_0x25fce7(0x8a)]);return _0x500fa7[0x0];}async[_0x28212a(0xc0)](){const _0x2bdbdd=_0x28212a;return await this[_0x2bdbdd(0xd5)][_0x2bdbdd(0xee)]();}async[_0x28212a(0xdf)](){const _0x56c524=_0x28212a;try{const _0x50a00c=await this[_0x56c524(0xd5)][_0x56c524(0xee)]({'where':{'status':!![],'keyStatus':0x1,'modelType':model_constant_1[_0x56c524(0x104)]['MUSIC']}});if(_0x50a00c[_0x56c524(0xaf)]===0x0)throw new Error(_0x56c524(0xef));return _0x50a00c[Math[_0x56c524(0xc3)](Math[_0x56c524(0x88)]()*_0x50a00c[_0x56c524(0xaf)])];}catch(_0x1bedcf){throw new common_1['HttpException'](_0x1bedcf[_0x56c524(0xec)],common_1[_0x56c524(0xa1)][_0x56c524(0x8a)]);}}};ModelsService=__decorate([(0x0,common_1[_0x28212a(0xc2)])(),__param(0x0,(0x0,typeorm_1[_0x28212a(0xb6)])(models_entity_1['ModelsEntity'])),__param(0x1,(0x0,typeorm_1[_0x28212a(0xb6)])(modelquick_entity_1[_0x28212a(0xbc)])),__metadata('design:paramtypes',[typeorm_2['Repository'],typeorm_2[_0x28212a(0x92)],nestjs_cls_1['ClsService'],user_service_1[_0x28212a(0xb8)],redisCache_service_1[_0x28212a(0xa8)]])],ModelsService),exports[_0x28212a(0xcf)]=ModelsService;