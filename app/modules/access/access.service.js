'use strict';const _0x1d5c57=_0x280c;(function(_0x21d0bf,_0x4b053b){const _0x37c17a=_0x280c,_0x2a58b6=_0x21d0bf();while(!![]){try{const _0x3e51d7=parseInt(_0x37c17a(0x126))/0x1+-parseInt(_0x37c17a(0x151))/0x2+parseInt(_0x37c17a(0x14a))/0x3*(parseInt(_0x37c17a(0x16f))/0x4)+parseInt(_0x37c17a(0x15b))/0x5+parseInt(_0x37c17a(0x15d))/0x6+parseInt(_0x37c17a(0x13d))/0x7+-parseInt(_0x37c17a(0x138))/0x8;if(_0x3e51d7===_0x4b053b)break;else _0x2a58b6['push'](_0x2a58b6['shift']());}catch(_0x3017a0){_0x2a58b6['push'](_0x2a58b6['shift']());}}}(_0x5c7e,0xcdabe));var __decorate=this&&this[_0x1d5c57(0x170)]||function(_0x4b467c,_0xf35539,_0x6d5fc9,_0x3920f2){const _0x3a4f9e=_0x1d5c57;var _0x412bc9=arguments[_0x3a4f9e(0x14b)],_0x5356b6=_0x412bc9<0x3?_0xf35539:_0x3920f2===null?_0x3920f2=Object['getOwnPropertyDescriptor'](_0xf35539,_0x6d5fc9):_0x3920f2,_0x4d73a2;if(typeof Reflect==='object'&&typeof Reflect['decorate']==='function')_0x5356b6=Reflect['decorate'](_0x4b467c,_0xf35539,_0x6d5fc9,_0x3920f2);else{for(var _0x394d4c=_0x4b467c[_0x3a4f9e(0x14b)]-0x1;_0x394d4c>=0x0;_0x394d4c--)if(_0x4d73a2=_0x4b467c[_0x394d4c])_0x5356b6=(_0x412bc9<0x3?_0x4d73a2(_0x5356b6):_0x412bc9>0x3?_0x4d73a2(_0xf35539,_0x6d5fc9,_0x5356b6):_0x4d73a2(_0xf35539,_0x6d5fc9))||_0x5356b6;}return _0x412bc9>0x3&&_0x5356b6&&Object[_0x3a4f9e(0x15c)](_0xf35539,_0x6d5fc9,_0x5356b6),_0x5356b6;},__metadata=this&&this[_0x1d5c57(0x164)]||function(_0x5b34de,_0x4e34c7){const _0x4cf962=_0x1d5c57;if(typeof Reflect==='object'&&typeof Reflect[_0x4cf962(0x127)]===_0x4cf962(0x12e))return Reflect[_0x4cf962(0x127)](_0x5b34de,_0x4e34c7);},__param=this&&this[_0x1d5c57(0x163)]||function(_0x3fa2a6,_0xd16a90){return function(_0x34f653,_0x15068d){_0xd16a90(_0x34f653,_0x15068d,_0x3fa2a6);};};Object['defineProperty'](exports,_0x1d5c57(0x171),{'value':!![]}),exports[_0x1d5c57(0x162)]=void 0x0;const common_1=require(_0x1d5c57(0x156)),typeorm_1=require('@nestjs/typeorm'),access_entity_1=require(_0x1d5c57(0x142)),typeorm_2=require(_0x1d5c57(0x12f)),user_service_1=require(_0x1d5c57(0x167)),utils_1=require(_0x1d5c57(0x14d));function _0x280c(_0x3277ee,_0x416150){const _0x5c7e9f=_0x5c7e();return _0x280c=function(_0x280c34,_0x43cca9){_0x280c34=_0x280c34-0x123;let _0x6bb263=_0x5c7e9f[_0x280c34];return _0x6bb263;},_0x280c(_0x3277ee,_0x416150);}let AccessService=class AccessService{constructor(_0x1e2cd0,_0x5cbf10){const _0x3ef3c4=_0x1d5c57;this['accessEntity']=_0x1e2cd0,this['userService']=_0x5cbf10,this['userMap']=new Map(),this[_0x3ef3c4(0x145)][_0x3ef3c4(0x137)]();}async['getOne'](_0x137d42){const _0x350ddb=_0x1d5c57;return await this[_0x350ddb(0x141)][_0x350ddb(0x165)]({'where':{'userId':_0x137d42}});}async[_0x1d5c57(0x172)](_0x1d4b29){const _0x48878e=_0x1d5c57,{id:_0x1df1b9}=_0x1d4b29;if(!_0x1df1b9)throw new common_1['HttpException']('参数错误',common_1[_0x48878e(0x130)][_0x48878e(0x13a)]);const _0x277c28=await this[_0x48878e(0x15a)][_0x48878e(0x173)](_0x1df1b9);if(!_0x277c28)throw new common_1['HttpException']('用户不存在',common_1[_0x48878e(0x130)][_0x48878e(0x13a)]);const _0x5c5bdc=await this[_0x48878e(0x141)]['findOne']({'where':{'userId':_0x277c28['id']}});if(!_0x5c5bdc)throw new common_1['HttpException'](_0x48878e(0x135),common_1['HttpStatus']['BAD_REQUEST']);const {role:_0x283aa0,username:_0x3d4b42}=_0x277c28;return{..._0x5c5bdc,'role':_0x283aa0,'password':_0x277c28[_0x48878e(0x14c)],'username':_0x3d4b42,'id':_0x277c28['id']};}async[_0x1d5c57(0x139)](_0x4a2537,_0x28d815){const _0x148291=_0x1d5c57,{page:page=0x1,size:size=0xa,username:_0x5a9117,status:_0x43812e,phone:_0x14dc6e}=_0x4a2537;if(!page||!size)throw new common_1[(_0x148291(0x155))](_0x148291(0x13b),0x190);const _0x6399b6={'userType':0x1};if(_0x5a9117){const {rows:_0x4b85ff}=await this['userService']['queryByPage']({'page':page,'size':size,'username':_0x5a9117,'email':'','status':0x0,'keyword':'','phone':_0x14dc6e}),_0x3793d6=_0x4b85ff[_0x148291(0x174)](_0x5b7106=>_0x5b7106['id']),_0xaa0bfd=await this[_0x148291(0x141)]['findBy']({'userId':(0x0,typeorm_2['In'])(_0x3793d6)}),_0x2c54ff=new Map();_0x4b85ff[_0x148291(0x13e)](_0x1b220c=>{const _0x4e9059=_0x148291;_0x2c54ff[_0x4e9059(0x15e)](_0x1b220c['id'],_0x1b220c);});const _0x22de3c=_0xaa0bfd[_0x148291(0x174)](_0x3d97d5=>Object[_0x148291(0x148)]({},_0x3d97d5,_0x2c54ff[_0x148291(0x16b)](_0x3d97d5[_0x148291(0x143)])));let _0x34ef47=_0x43812e>0x0?_0x22de3c[_0x148291(0x157)](_0x1decc8=>_0x1decc8[_0x148291(0x16c)]===_0x43812e):_0x22de3c;return{'rows':_0x34ef47||[],'count':_0x34ef47[_0x148291(0x14b)]||0x0};}[0x1,0x2,'1','2']['includes'](_0x43812e)&&(_0x6399b6[_0x148291(0x16c)]=_0x43812e);const [_0x2b468b,_0x1e8d1d]=await this['accessEntity'][_0x148291(0x147)]({'skip':(page-0x1)*size,'where':_0x6399b6,'take':size,'order':{'createdAt':_0x148291(0x152)},'cache':!![],'select':['managerStatus','userId',_0x148291(0x168),'id']}),_0x3394d7=_0x2b468b[_0x148291(0x174)](_0x59141f=>_0x59141f['userId']),_0x218134=await this[_0x148291(0x15a)][_0x148291(0x153)](_0x3394d7);_0x218134['forEach'](_0x48840f=>this[_0x148291(0x145)][_0x148291(0x15e)](_0x48840f['id'],_0x48840f));const _0x4fcf7c=_0x2b468b['map'](_0x8e6da8=>{const _0x14ad73=_0x148291,_0x2d936c=this[_0x14ad73(0x145)][_0x14ad73(0x16b)](_0x8e6da8['userId']);return Object[_0x14ad73(0x148)]({},_0x2d936c,_0x8e6da8);});return{'rows':_0x4fcf7c||[],'count':_0x1e8d1d||0x0};}async['queryAccessByIds'](_0x2539d5){const _0x38c7df=_0x1d5c57;return await this[_0x38c7df(0x141)][_0x38c7df(0x16d)]({'where':{'userId':(0x0,typeorm_2['In'])(_0x2539d5)},'select':['id',_0x38c7df(0x168),_0x38c7df(0x12c),_0x38c7df(0x143)]});}async[_0x1d5c57(0x159)](){return await this['accessEntity']['count']();}async[_0x1d5c57(0x124)](_0x3eeb1c){const _0x36fd7e=_0x1d5c57,{id:_0x4196cb}=_0x3eeb1c,_0x360965=await this[_0x36fd7e(0x141)][_0x36fd7e(0x165)]({'where':{'id':_0x4196cb}}),_0x511621=await this['userService'][_0x36fd7e(0x144)]({'id':_0x360965[_0x36fd7e(0x143)],'moreId':0x0});if(_0x511621)return this['accessEntity'][_0x36fd7e(0x160)]({'id':_0x4196cb});return![];}async[_0x1d5c57(0x166)](_0x48ba26){const _0x3b5ba2=_0x1d5c57,{username:_0x8905,access:_0x40337a,role:_0x34d995,password:_0x349677}=_0x48ba26,_0x14951a=await this[_0x3b5ba2(0x15a)]['queryUserByUsername'](_0x8905);if(_0x14951a&&(0x0,utils_1[_0x3b5ba2(0x146)])(_0x8905,_0x14951a[_0x3b5ba2(0x14c)]))throw new common_1[(_0x3b5ba2(0x155))](_0x3b5ba2(0x125),common_1['HttpStatus']['BAD_REQUEST']);const _0x287e65=(0x0,utils_1[_0x3b5ba2(0x12b)])(_0x349677),_0x2c5b02=(0x0,utils_1[_0x3b5ba2(0x161)])()+_0x3b5ba2(0x123),_0x3c61b2=await this['userService'][_0x3b5ba2(0x16a)]({'email':_0x2c5b02,'username':_0x8905,'status':0x1,'password':_0x287e65,'sex':0x1,'role':_0x34d995});if(!_0x3c61b2)throw new common_1[(_0x3b5ba2(0x155))](_0x3b5ba2(0x12d),common_1['HttpStatus'][_0x3b5ba2(0x13a)]);try{const _0x112ee9=_0x40337a['length']&&JSON[_0x3b5ba2(0x132)](_0x40337a)[_0x3b5ba2(0x174)](_0x1440fd=>_0x1440fd[_0x3b5ba2(0x14e)])[_0x3b5ba2(0x131)](),_0x53ffe9=await this[_0x3b5ba2(0x15f)]({'userType':0x1,'access':_0x40337a,'userId':_0x3c61b2['id'],'accessLabel':_0x112ee9['length']?_0x112ee9:''});return!!_0x53ffe9;}catch(_0x52997c){console['log'](_0x3b5ba2(0x158),_0x52997c);throw new common_1['HttpException'](_0x52997c,common_1[_0x3b5ba2(0x130)][_0x3b5ba2(0x13a)]);}}async[_0x1d5c57(0x15f)](_0x1f2c34){const _0x498923=_0x1d5c57,{userType:_0x1692f4,access:_0x5e71c1,userId:_0x305261,accessLabel:_0x531da5}=_0x1f2c34;return await this[_0x498923(0x141)][_0x498923(0x134)]({'userType':_0x1692f4,'access':_0x5e71c1,'userId':_0x305261,'accessLabel':_0x531da5&&JSON['stringify'](_0x531da5)||''});}async[_0x1d5c57(0x149)](_0x191d80){const _0x25a3c2=_0x1d5c57,{id:_0x5861f5,userId:_0x473554,access:_0x5f0397}=_0x191d80,_0x4b88f9=await this[_0x25a3c2(0x15a)][_0x25a3c2(0x136)]({'id':_0x473554});if(!_0x4b88f9)throw new common_1[(_0x25a3c2(0x155))](_0x25a3c2(0x169),common_1[_0x25a3c2(0x130)][_0x25a3c2(0x13c)]);try{const _0x3dc6bb=_0x5f0397[_0x25a3c2(0x14b)]&&JSON[_0x25a3c2(0x132)](_0x5f0397)[_0x25a3c2(0x174)](_0x1ea648=>_0x1ea648[_0x25a3c2(0x14e)])['flat'](),_0x3de419=await this[_0x25a3c2(0x141)]['update']({'userId':_0x4b88f9['id']},{'userId':_0x473554,'access':_0x5f0397,'accessLabel':_0x3dc6bb&&JSON['stringify'](_0x3dc6bb)||''})['catch'](_0xb0eac5=>{throw _0xb0eac5;});return!!_0x3de419;}catch(_0x27c16d){return console[_0x25a3c2(0x140)](_0x27c16d),![];}}async[_0x1d5c57(0x129)](_0x834913){const _0x4d2bb2=_0x1d5c57,{id:_0x405929,status:_0x483a73}=_0x834913,_0x4d327f=await this[_0x4d2bb2(0x141)][_0x4d2bb2(0x150)](_0x405929,{'managerStatus':_0x483a73});return _0x4d327f['affected']>0x0;}async[_0x1d5c57(0x13f)](_0x242a1d){const _0x555979=_0x1d5c57,{id:_0x479686}=_0x242a1d,_0x268026=_0x555979(0x154),_0x396375=await this[_0x555979(0x141)][_0x555979(0x165)]({'where':{'id':_0x479686}});return this[_0x555979(0x15a)][_0x555979(0x12a)](_0x396375[_0x555979(0x143)],_0x268026);}};AccessService=__decorate([(0x0,common_1[_0x1d5c57(0x128)])(),__param(0x0,(0x0,typeorm_1[_0x1d5c57(0x16e)])(access_entity_1['AccessEntity'])),__metadata(_0x1d5c57(0x14f),[typeorm_2['Repository'],user_service_1[_0x1d5c57(0x133)]])],AccessService),exports['AccessService']=AccessService;function _0x5c7e(){const _0x4d14fe=['findAndCount','assign','handleManagerUpdate','393561xBNdiM','length','password','../../common/utils','checked','design:paramtypes','update','2858696AHaLDi','DESC','queryUserInfoByIds','123456','HttpException','@nestjs/common','filter','error:\x20','queryAccessCount','userService','3413955wUQMmD','defineProperty','7964064hmWNON','set','handleSaveAccess','delete','createRandomUid','AccessService','__param','__metadata','findOne','handleManagerAdd','../user/user.service','accessLabel','管理员不存在，请核对','createUser','get','managerStatus','find','InjectRepository','16eRaKcG','__decorate','__esModule','getManagerAccess','getUserById','map','@manager.com','setManagerDelete','管理员已存在','1481057JECYru','metadata','Injectable','handleUpdateStatus','updateUserPassword','createPsd','createdAt','添加管理员失败','function','typeorm','HttpStatus','flat','parse','UserService','save','管理员不存在','queryOne','clear','23544080CtYCyS','queryManagerAccess','BAD_REQUEST','分页参数错误','GONE','8391936QaVRjI','forEach','handleResetPassword','log','accessEntity','./access.entity','userId','delUser','userMap','comparePassword'];_0x5c7e=function(){return _0x4d14fe;};return _0x5c7e();}