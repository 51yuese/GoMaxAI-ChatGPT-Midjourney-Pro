'use strict';const _0x8bbc3e=_0x30e4;function _0x4e85(){const _0x5262d8=['countTodayCollection','object','../../common/utils/date','data','day','countInviteUsersTotal','请先配置百度统计accessToken','overview/getTimeTrendRpt','DeductionKey','百度授权码过期','__decorate','metadata','8680296YSBujg','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','endTime','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','&site_id=','map','startOf','4111280oxkhyd','typeorm','midjourneyEntity','countNewMidhourneysToday','diff','countNewDrawsToday','globalConfigService','../order/order.entity','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27','value','../../common/utils','query','countMjDrawsByTimeRange','count','toFixed','date','&start_date=','subtract','createQueryBuilder','ClsService','Repository','default','StatisticService','getChatStatistic','HttpStatus','userEntity','getReqSaasId','../../common/constants/midjourney.constant','sum','1380990bRwMZR','function','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','CHAT_TYPE','toDate','countDrawsByTimeRange','price','baiduSiteId','countNewChatsToday','57741948CjSIRH','1329grbdaU','countNewOrdersToday','__param','formatDate','clsService','orderBy','countTotalMusic','countTodayMusic','276892MKxQrM','nestjs-cls','result','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','connection','M.DD','countInviteUsersToday','2885644XqHcYT','BAD_REQUEST','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','baiduToken','../user/user.entity','272AkUhyU','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','midjourney.createdAt\x20>=\x20:startDate','midjourney.saasId\x20=\x20:saasId','InjectRepository','getConfigByKeys','OrderEntity','saasId','UserEntity','getBaseStatistic','../../common/constants/model.constant','MidjourneyStatusEnum','select','push','countChatsByTimeRange','chatlog.type\x20=\x20:type','chatlog','../../common/constants/balance.constant','orderEntity','getRawMany','andWhere','countDraws','where','getDate','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','../globalConfig/globalConfig.service','MUSIC','chatLogEntity','7052hyyFmK','Not','PAINT_TYPE','chatlog.saasId\x20=\x20:saasId','Between','../chatLog/entity/chatLog.entity','Injectable','startTime','endOf','@nestjs/typeorm','setDate','length','../midjourney/midjourney.entity','EModelType','chatlog.createdAt\x20>=\x20:startDate','getBaiduStatistics','countTotalCollection','axios','GlobalConfigService','DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','countChats','YYYYMMDD','HttpException','find'];_0x4e85=function(){return _0x5262d8;};return _0x4e85();}(function(_0x2fbca8,_0x26dabb){const _0xefba0=_0x30e4,_0xdac369=_0x2fbca8();while(!![]){try{const _0x8bff05=-parseInt(_0xefba0(0x133))/0x1+-parseInt(_0xefba0(0x14c))/0x2+parseInt(_0xefba0(0x13d))/0x3*(-parseInt(_0xefba0(0x16d))/0x4)+parseInt(_0xefba0(0x198))/0x5+-parseInt(_0xefba0(0x191))/0x6+-parseInt(_0xefba0(0x145))/0x7*(parseInt(_0xefba0(0x151))/0x8)+parseInt(_0xefba0(0x13c))/0x9;if(_0x8bff05===_0x26dabb)break;else _0xdac369['push'](_0xdac369['shift']());}catch(_0x121eb0){_0xdac369['push'](_0xdac369['shift']());}}}(_0x4e85,0xcd773));var __decorate=this&&this[_0x8bbc3e(0x18f)]||function(_0x583f16,_0x10e813,_0x14af72,_0x51dd64){const _0xb3ba6d=_0x8bbc3e;var _0x230b67=arguments['length'],_0x353a62=_0x230b67<0x3?_0x10e813:_0x51dd64===null?_0x51dd64=Object['getOwnPropertyDescriptor'](_0x10e813,_0x14af72):_0x51dd64,_0x3d5044;if(typeof Reflect===_0xb3ba6d(0x186)&&typeof Reflect['decorate']===_0xb3ba6d(0x134))_0x353a62=Reflect['decorate'](_0x583f16,_0x10e813,_0x14af72,_0x51dd64);else{for(var _0x6f22dc=_0x583f16[_0xb3ba6d(0x178)]-0x1;_0x6f22dc>=0x0;_0x6f22dc--)if(_0x3d5044=_0x583f16[_0x6f22dc])_0x353a62=(_0x230b67<0x3?_0x3d5044(_0x353a62):_0x230b67>0x3?_0x3d5044(_0x10e813,_0x14af72,_0x353a62):_0x3d5044(_0x10e813,_0x14af72))||_0x353a62;}return _0x230b67>0x3&&_0x353a62&&Object['defineProperty'](_0x10e813,_0x14af72,_0x353a62),_0x353a62;},__metadata=this&&this['__metadata']||function(_0xacd388,_0x5843b5){const _0x20e18d=_0x8bbc3e;if(typeof Reflect===_0x20e18d(0x186)&&typeof Reflect[_0x20e18d(0x190)]==='function')return Reflect[_0x20e18d(0x190)](_0xacd388,_0x5843b5);},__param=this&&this[_0x8bbc3e(0x13f)]||function(_0x4a548b,_0x16c756){return function(_0x2efce4,_0x5a7ff8){_0x16c756(_0x2efce4,_0x5a7ff8,_0x4a548b);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x8bbc3e(0x12c)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x8bbc3e(0x176)),user_entity_1=require(_0x8bbc3e(0x150)),typeorm_2=require(_0x8bbc3e(0x199)),chatLog_entity_1=require(_0x8bbc3e(0x172)),balance_constant_1=require(_0x8bbc3e(0x162)),date_1=require(_0x8bbc3e(0x187)),axios_1=require(_0x8bbc3e(0x17e)),order_entity_1=require(_0x8bbc3e(0x19f)),midjourney_entity_1=require(_0x8bbc3e(0x179)),midjourney_constant_1=require(_0x8bbc3e(0x131)),model_constant_1=require(_0x8bbc3e(0x15b)),globalConfig_service_1=require(_0x8bbc3e(0x16a)),nestjs_cls_1=require(_0x8bbc3e(0x146)),utils_1=require(_0x8bbc3e(0x1a2));function _0x30e4(_0x279683,_0x4aa86c){const _0x4e85af=_0x4e85();return _0x30e4=function(_0x30e401,_0x3f32f8){_0x30e401=_0x30e401-0x121;let _0x24e0be=_0x4e85af[_0x30e401];return _0x24e0be;},_0x30e4(_0x279683,_0x4aa86c);}let StatisticService=class StatisticService{constructor(_0x3ec65e,_0x48fc65,_0xcbe814,_0x45e005,_0x33d3c9,_0x1ac7c9,_0x20f6e8){const _0x4de90e=_0x8bbc3e;this[_0x4de90e(0x12f)]=_0x3ec65e,this[_0x4de90e(0x16c)]=_0x48fc65,this[_0x4de90e(0x163)]=_0xcbe814,this[_0x4de90e(0x19a)]=_0x45e005,this[_0x4de90e(0x19e)]=_0x33d3c9,this[_0x4de90e(0x141)]=_0x1ac7c9,this[_0x4de90e(0x149)]=_0x20f6e8;}async[_0x8bbc3e(0x15a)](_0x57ca06){const _0x104b07=_0x8bbc3e,_0x1f5b94=(0x0,utils_1[_0x104b07(0x130)])(this[_0x104b07(0x141)]);_0x1f5b94!==0x0&&(_0x57ca06=_0x1f5b94);const _0x27895c=await this['countUsers'](_0x57ca06),_0x3ec9f9=await this['countNewUsersToday'](_0x57ca06),_0x1655f7=await this[_0x104b07(0x181)](_0x57ca06),_0x165a57=await this[_0x104b07(0x13b)](_0x57ca06),_0x2455ab=await this['countDraws'](_0x57ca06),_0x167556=await this[_0x104b07(0x19d)](_0x57ca06),_0x3b8c76=await this[_0x104b07(0x19b)](_0x57ca06),_0x3fa5c5=await this['countOrders'](_0x57ca06),_0x2205c5=await this[_0x104b07(0x13e)](_0x57ca06),_0x2ffa7a=await this[_0x104b07(0x185)](_0x57ca06),_0x4bd337=await this['countTotalCollection'](_0x57ca06),_0x57e5f5=await this[_0x104b07(0x144)](_0x57ca06),_0x54d7b0=await this[_0x104b07(0x143)](_0x57ca06),_0x8742ee=await this[_0x104b07(0x14b)](_0x57ca06),_0x26646e=await this['countInviteUsersTotal'](_0x57ca06);return{'userCount':_0x27895c,'newUserCount':_0x3ec9f9,'chatCount':_0x1655f7,'newChatCount':_0x165a57,'drawCount':_0x2455ab,'newDrawCount':_0x3b8c76+_0x167556,'orderCount':_0x3fa5c5,'newOrderCount':_0x2205c5,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x2ffa7a,'totalCollection':_0x4bd337,'todayMusic':_0x57e5f5,'totalMusic':_0x54d7b0,'todayVideo':0x0,'totalVideo':0x0,'todayInviteCount':_0x8742ee,'totalInviteCount':_0x26646e};}async['countUsers'](_0x12804b){const _0x5ae752=_0x8bbc3e,_0x5672ca={};_0x12804b!==undefined&&(_0x5672ca[_0x5ae752(0x158)]=_0x12804b);const _0x2eb677=await this[_0x5ae752(0x12f)][_0x5ae752(0x123)]({'where':_0x5672ca});return _0x2eb677;}async[_0x8bbc3e(0x18a)](_0x347bb4){const _0x511576=_0x8bbc3e,_0x22879a={'inviteCode':(0x0,typeorm_2[_0x511576(0x16e)])('')};_0x347bb4!==undefined&&(_0x22879a[_0x511576(0x158)]=_0x347bb4);const _0x45a4da=await this[_0x511576(0x12f)][_0x511576(0x123)]({'where':_0x22879a});return _0x45a4da;}async[_0x8bbc3e(0x14b)](_0x1190e7){const _0x3ea0d3=_0x8bbc3e,_0x113de8=(0x0,date_1[_0x3ea0d3(0x12b)])()[_0x3ea0d3(0x197)]('d')[_0x3ea0d3(0x137)](),_0x4ab044=(0x0,date_1['default'])()[_0x3ea0d3(0x175)]('d')[_0x3ea0d3(0x137)](),_0xb4c29b={'createdAt':(0x0,typeorm_2['Between'])(_0x113de8,_0x4ab044),'inviteCode':(0x0,typeorm_2['Not'])('')};_0x1190e7!==undefined&&(_0xb4c29b[_0x3ea0d3(0x158)]=_0x1190e7);const _0x1aa2cb=await this['userEntity'][_0x3ea0d3(0x123)]({'where':_0xb4c29b});return _0x1aa2cb;}async['countNewUsersToday'](_0x5ec4da){const _0x2a4efb=_0x8bbc3e,_0x5d6a57=(0x0,date_1[_0x2a4efb(0x12b)])()[_0x2a4efb(0x197)]('d')['toDate'](),_0x74fd79=(0x0,date_1['default'])()[_0x2a4efb(0x175)]('d')[_0x2a4efb(0x137)](),_0xbb27d2={'createdAt':(0x0,typeorm_2[_0x2a4efb(0x171)])(_0x5d6a57,_0x74fd79)};_0x5ec4da!==undefined&&(_0xbb27d2['saasId']=_0x5ec4da);const _0x33639d=await this[_0x2a4efb(0x12f)][_0x2a4efb(0x123)]({'where':_0xbb27d2});return _0x33639d;}async[_0x8bbc3e(0x181)](_0x49a9b1){const _0x2f6546=_0x8bbc3e,_0x38f9d9={'type':balance_constant_1[_0x2f6546(0x18d)][_0x2f6546(0x136)]};_0x49a9b1!==undefined&&(_0x38f9d9[_0x2f6546(0x158)]=_0x49a9b1);const _0x15c787=await this['chatLogEntity'][_0x2f6546(0x123)]({'where':_0x38f9d9});return _0x15c787;}async[_0x8bbc3e(0x13b)](_0x22e715){const _0x12fa88=_0x8bbc3e,_0x17123d=(0x0,date_1[_0x12fa88(0x12b)])()[_0x12fa88(0x197)]('d')['toDate'](),_0x148b10=(0x0,date_1[_0x12fa88(0x12b)])()[_0x12fa88(0x175)]('d')[_0x12fa88(0x137)](),_0x740ad0={'type':balance_constant_1[_0x12fa88(0x18d)][_0x12fa88(0x136)],'createdAt':(0x0,typeorm_2[_0x12fa88(0x171)])(_0x17123d,_0x148b10)};_0x22e715!==undefined&&(_0x740ad0[_0x12fa88(0x158)]=_0x22e715);const _0x2c58e1=await this[_0x12fa88(0x16c)][_0x12fa88(0x123)]({'where':_0x740ad0});return _0x2c58e1;}async[_0x8bbc3e(0x166)](_0x458c73){const _0x532af1=_0x8bbc3e,_0x453aaa={'type':balance_constant_1['DeductionKey'][_0x532af1(0x16f)]};_0x458c73!==undefined&&(_0x453aaa[_0x532af1(0x158)]=_0x458c73);const _0x240899=await this['chatLogEntity'][_0x532af1(0x123)]({'where':_0x453aaa});return _0x240899;}async[_0x8bbc3e(0x19d)](_0x1d6bb6){const _0x4c0dbc=_0x8bbc3e,_0x10f2d2=(0x0,date_1[_0x4c0dbc(0x12b)])()[_0x4c0dbc(0x197)]('d')[_0x4c0dbc(0x137)](),_0x582877=(0x0,date_1[_0x4c0dbc(0x12b)])()[_0x4c0dbc(0x175)]('d')['toDate'](),_0xe3efd6={'type':balance_constant_1[_0x4c0dbc(0x18d)]['PAINT_TYPE'],'createdAt':(0x0,typeorm_2['Between'])(_0x10f2d2,_0x582877)};_0x1d6bb6!==undefined&&(_0xe3efd6[_0x4c0dbc(0x158)]=_0x1d6bb6);const _0x109f46=await this[_0x4c0dbc(0x16c)][_0x4c0dbc(0x123)]({'where':_0xe3efd6});return _0x109f46;}async['countNewMidhourneysToday'](_0x130858){const _0x38ad3a=_0x8bbc3e,_0x2bc53c=(0x0,date_1['default'])()[_0x38ad3a(0x197)]('d')[_0x38ad3a(0x137)](),_0x20a4d7=(0x0,date_1[_0x38ad3a(0x12b)])()['endOf']('d')[_0x38ad3a(0x137)](),_0x30126f={'createdAt':(0x0,typeorm_2[_0x38ad3a(0x171)])(_0x2bc53c,_0x20a4d7)};_0x130858!==undefined&&(_0x30126f[_0x38ad3a(0x158)]=_0x130858);const _0x16c5bd=await this['midjourneyEntity'][_0x38ad3a(0x123)]({'where':_0x30126f});return _0x16c5bd;}async['countOrders'](_0x4f43d9){const _0x10e55c=_0x8bbc3e,_0x26b0a6={};_0x4f43d9!==undefined&&(_0x26b0a6[_0x10e55c(0x158)]=_0x4f43d9);const _0x2e6469=await this[_0x10e55c(0x163)]['count']({'where':_0x26b0a6});return _0x2e6469;}async['countNewOrdersToday'](_0x3bc935){const _0x249984=_0x8bbc3e,_0x3ea8ed=(0x0,date_1[_0x249984(0x12b)])()['startOf']('d')[_0x249984(0x137)](),_0x4c2fcd=(0x0,date_1[_0x249984(0x12b)])()[_0x249984(0x175)]('d')[_0x249984(0x137)](),_0x162314={'createdAt':(0x0,typeorm_2['Between'])(_0x3ea8ed,_0x4c2fcd),'status':0x1};_0x3bc935!==undefined&&(_0x162314[_0x249984(0x158)]=_0x3bc935);const _0x31cb7d=await this[_0x249984(0x163)][_0x249984(0x123)]({'where':_0x162314});return _0x31cb7d;}async[_0x8bbc3e(0x144)](_0x2eea6e){const _0x539fd3=_0x8bbc3e,_0x1cf3fc=(0x0,date_1[_0x539fd3(0x12b)])()[_0x539fd3(0x197)]('d')[_0x539fd3(0x137)](),_0x45948a=(0x0,date_1[_0x539fd3(0x12b)])()[_0x539fd3(0x175)]('d')[_0x539fd3(0x137)](),_0x441276={'answer':(0x0,typeorm_2[_0x539fd3(0x16e)])((0x0,typeorm_2['IsNull'])()),'modelType':model_constant_1['EModelType'][_0x539fd3(0x16b)],'createdAt':(0x0,typeorm_2[_0x539fd3(0x171)])(_0x1cf3fc,_0x45948a)};_0x2eea6e!==undefined&&(_0x441276[_0x539fd3(0x158)]=_0x2eea6e);const _0xac9f89=await this['chatLogEntity'][_0x539fd3(0x123)]({'where':_0x441276});return _0xac9f89;}async[_0x8bbc3e(0x143)](_0x5b93bd){const _0x24e110=_0x8bbc3e,_0x402b94={'answer':(0x0,typeorm_2[_0x24e110(0x16e)])((0x0,typeorm_2['IsNull'])()),'modelType':model_constant_1[_0x24e110(0x17a)][_0x24e110(0x16b)]};_0x5b93bd!==undefined&&(_0x402b94[_0x24e110(0x158)]=_0x5b93bd);const _0x12e839=await this['chatLogEntity'][_0x24e110(0x123)]({'where':_0x402b94});return _0x12e839;}async[_0x8bbc3e(0x185)](_0xd4a5ae){const _0x36fd6a=_0x8bbc3e,_0x21e07a=(0x0,date_1[_0x36fd6a(0x12b)])()[_0x36fd6a(0x197)]('d')[_0x36fd6a(0x137)](),_0x314da3=(0x0,date_1[_0x36fd6a(0x12b)])()[_0x36fd6a(0x175)]('d')[_0x36fd6a(0x137)](),_0x34d093={'status':0x1,'updatedAt':(0x0,typeorm_2[_0x36fd6a(0x171)])(_0x21e07a,_0x314da3)};_0xd4a5ae!==undefined&&(_0x34d093['saasId']=_0xd4a5ae);const _0x43e2d8=await this[_0x36fd6a(0x163)][_0x36fd6a(0x132)](_0x36fd6a(0x139),_0x34d093)||0x0;return _0x43e2d8['toFixed'](0x2);}async[_0x8bbc3e(0x17d)](_0x4917c9){const _0x2b6259=_0x8bbc3e,_0x501a72={'status':0x1};_0x4917c9!==undefined&&(_0x501a72[_0x2b6259(0x158)]=_0x4917c9);const _0x411ce8=await this['orderEntity'][_0x2b6259(0x132)](_0x2b6259(0x139),_0x501a72)||0x0;return _0x411ce8[_0x2b6259(0x124)](0x2);}async[_0x8bbc3e(0x12d)]({days:days=0x7,saasId:_0x1528e6}){const _0x25e458=_0x8bbc3e,_0x33c7c6=(0x0,utils_1[_0x25e458(0x130)])(this[_0x25e458(0x141)]);_0x33c7c6!==0x0&&(_0x1528e6=_0x33c7c6);const _0x4c9f52=await this[_0x25e458(0x15f)](days,_0x1528e6),_0xcbe737=await this[_0x25e458(0x138)](days,_0x1528e6),_0x2d38cf=await this[_0x25e458(0x122)](days,_0x1528e6);return{'date':_0x4c9f52['map'](_0xf46c53=>_0xf46c53['date']),'chat':_0x4c9f52[_0x25e458(0x196)](_0x2b1199=>_0x2b1199[_0x25e458(0x1a1)]),'draw':_0xcbe737['map']((_0x5d0cf0,_0x298eb6)=>{const _0x1d4f8d=_0x25e458;return _0x5d0cf0[_0x1d4f8d(0x1a1)]+_0x2d38cf[_0x298eb6]['value'];})};}async[_0x8bbc3e(0x15f)](_0x9f53a4,_0x489f7e){const _0x144415=_0x8bbc3e,_0x279396=(0x0,date_1['default'])()[_0x144415(0x127)](_0x9f53a4,'d')[_0x144415(0x197)]('d')['toDate'](),_0x11ae87=this[_0x144415(0x16c)]['createQueryBuilder'](_0x144415(0x161))['select'](_0x144415(0x194))[_0x144415(0x167)](_0x144415(0x160),{'type':balance_constant_1[_0x144415(0x18d)][_0x144415(0x136)]})[_0x144415(0x165)](_0x144415(0x17b),{'startDate':_0x279396});_0x489f7e!==undefined&&_0x11ae87['andWhere'](_0x144415(0x170),{'saasId':_0x489f7e});_0x11ae87['groupBy']('date')[_0x144415(0x142)](_0x144415(0x125));const _0xa18d56=await _0x11ae87[_0x144415(0x164)](),_0x213bd3=[],_0x5c66a3=_0x279396;for(let _0x37f5cc=0x0;_0x37f5cc<_0x9f53a4;_0x37f5cc++){const _0x1fc4ae=(0x0,date_1[_0x144415(0x140)])(new Date(_0x5c66a3),_0x144415(0x14a)),_0xe70946=_0xa18d56[_0x144415(0x184)](_0x37ffb8=>(0x0,date_1['formatDate'])(new Date(_0x37ffb8[_0x144415(0x125)]),_0x144415(0x14a))===_0x1fc4ae)?.[_0x144415(0x123)]??0x0;_0xe70946>0x0?_0x213bd3['push']({'date':_0x1fc4ae,'value':Number(_0xe70946)}):_0x213bd3[_0x144415(0x15e)]({'date':_0x1fc4ae,'value':0x0}),_0x5c66a3[_0x144415(0x177)](_0x5c66a3['getDate']()+0x1);}return _0x213bd3;}async['countDrawsByTimeRange'](_0x749557,_0x431a0b){const _0x5091d0=_0x8bbc3e,_0x21120a=(0x0,date_1['default'])()['subtract'](_0x749557,'d')[_0x5091d0(0x197)]('d')[_0x5091d0(0x137)](),_0x5d1971=this[_0x5091d0(0x16c)][_0x5091d0(0x128)](_0x5091d0(0x161))[_0x5091d0(0x15d)](_0x5091d0(0x194))[_0x5091d0(0x167)](_0x5091d0(0x160),{'type':balance_constant_1['DeductionKey'][_0x5091d0(0x16f)]})['andWhere'](_0x5091d0(0x17b),{'startDate':_0x21120a});_0x431a0b!==undefined&&_0x5d1971[_0x5091d0(0x165)](_0x5091d0(0x170),{'saasId':_0x431a0b});_0x5d1971['groupBy'](_0x5091d0(0x125))[_0x5091d0(0x142)](_0x5091d0(0x125));const _0x100dfa=await _0x5d1971[_0x5091d0(0x164)](),_0x46fffb=[],_0x483083=_0x21120a;for(let _0x3434db=0x0;_0x3434db<_0x749557;_0x3434db++){const _0x53296e=(0x0,date_1['formatDate'])(new Date(_0x483083),'M.DD'),_0x520936=_0x100dfa[_0x5091d0(0x184)](_0x329c40=>(0x0,date_1[_0x5091d0(0x140)])(new Date(_0x329c40[_0x5091d0(0x125)]),_0x5091d0(0x14a))===_0x53296e)?.[_0x5091d0(0x123)]??0x0;_0x520936>0x0?_0x46fffb['push']({'date':_0x53296e,'value':Number(_0x520936)}):_0x46fffb[_0x5091d0(0x15e)]({'date':_0x53296e,'value':0x0}),_0x483083[_0x5091d0(0x177)](_0x483083[_0x5091d0(0x168)]()+0x1);}return _0x46fffb;}async[_0x8bbc3e(0x122)](_0x2d7b72,_0x55cbd6){const _0x5f0f50=_0x8bbc3e,_0x121395=(0x0,date_1[_0x5f0f50(0x12b)])()['subtract'](_0x2d7b72,'d')[_0x5f0f50(0x197)]('d')[_0x5f0f50(0x137)](),_0x3f888f=this['midjourneyEntity'][_0x5f0f50(0x128)]('midjourney')[_0x5f0f50(0x15d)](_0x5f0f50(0x180))[_0x5f0f50(0x167)]('midjourney.status\x20=\x20:status',{'status':midjourney_constant_1[_0x5f0f50(0x15c)]['DRAWED']})[_0x5f0f50(0x165)](_0x5f0f50(0x153),{'startDate':_0x121395});_0x55cbd6!==undefined&&_0x3f888f[_0x5f0f50(0x165)](_0x5f0f50(0x154),{'saasId':_0x55cbd6});_0x3f888f['groupBy'](_0x5f0f50(0x125))[_0x5f0f50(0x142)](_0x5f0f50(0x125));const _0x1c080f=await _0x3f888f['getRawMany'](),_0x4658e4=[],_0x30c1b2=_0x121395;for(let _0x3c2ba2=0x0;_0x3c2ba2<_0x2d7b72;_0x3c2ba2++){const _0x3c5ce6=(0x0,date_1[_0x5f0f50(0x140)])(new Date(_0x30c1b2),'M.DD'),_0x478e18=_0x1c080f[_0x5f0f50(0x184)](_0x91293a=>(0x0,date_1[_0x5f0f50(0x140)])(new Date(_0x91293a['date']),_0x5f0f50(0x14a))===_0x3c5ce6)?.[_0x5f0f50(0x123)]??0x0;_0x478e18>0x0?_0x4658e4['push']({'date':_0x3c5ce6,'value':Number(_0x478e18)}):_0x4658e4[_0x5f0f50(0x15e)]({'date':_0x3c5ce6,'value':0x0}),_0x30c1b2[_0x5f0f50(0x177)](_0x30c1b2[_0x5f0f50(0x168)]()+0x1);}return _0x4658e4;}async[_0x8bbc3e(0x17c)](_0x46b467){const _0x40f4c8=_0x8bbc3e,_0xc4bec7=(0x0,date_1[_0x40f4c8(0x140)])(new Date(),_0x40f4c8(0x182)),_0x22a52b=(0x0,date_1['formatDate'])(new Date(Date['now']()-Number(_0x46b467-0x1)*0x18*0x3c*0x3c*0x3e8),_0x40f4c8(0x182)),_0x1e0490=_0x40f4c8(0x14e),_0x4720be=_0x40f4c8(0x18c),_0x24b43b=await this[_0x40f4c8(0x19e)][_0x40f4c8(0x156)]([_0x40f4c8(0x14f),_0x40f4c8(0x13a)]),_0x3c7467=_0x24b43b[_0x40f4c8(0x13a)],_0x451a82=_0x24b43b[_0x40f4c8(0x14f)];if(!_0x3c7467||!_0x451a82)return[];if(!_0x3c7467)throw new common_1[(_0x40f4c8(0x183))]('请先配置百度统计siteId',common_1[_0x40f4c8(0x12e)][_0x40f4c8(0x14d)]);if(!_0x451a82)throw new common_1[(_0x40f4c8(0x183))](_0x40f4c8(0x18b),common_1[_0x40f4c8(0x12e)][_0x40f4c8(0x14d)]);const _0x498731=_0x40f4c8(0x152)+_0x451a82+_0x40f4c8(0x195)+_0x3c7467+'&method='+_0x4720be+_0x40f4c8(0x126)+_0x22a52b+'&end_date='+_0xc4bec7+'&metrics='+_0x1e0490,_0x27e918=await axios_1[_0x40f4c8(0x12b)]['get'](_0x498731),{error_code:_0x29d81b,message:_0x4adb97}=_0x27e918[_0x40f4c8(0x188)];if(_0x29d81b===0x6f)throw new common_1[(_0x40f4c8(0x183))](_0x4adb97||_0x40f4c8(0x18e),common_1['HttpStatus'][_0x40f4c8(0x14d)]);if(_0x29d81b&&_0x29d81b!==0xc8)throw new common_1['HttpException'](_0x4adb97||'获取百度统计数据失败',common_1[_0x40f4c8(0x12e)][_0x40f4c8(0x14d)]);return _0x27e918[_0x40f4c8(0x188)][_0x40f4c8(0x147)];}async['modelUse'](_0x537a44){const _0xe04f0f=_0x8bbc3e,_0xe21410=await this[_0xe04f0f(0x149)][_0xe04f0f(0x121)](_0xe04f0f(0x148)+_0x537a44['startTime']+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27'+_0x537a44[_0xe04f0f(0x193)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20'),_0xef5df9=(0x0,date_1[_0xe04f0f(0x12b)])(_0x537a44[_0xe04f0f(0x174)])[_0xe04f0f(0x19c)]((0x0,date_1['default'])(_0x537a44[_0xe04f0f(0x193)]),_0xe04f0f(0x189)),_0x23b810=_0xef5df9===0x0?'%Y-%m-%d\x20%H:00':'%Y-%m-%d',_0x5d10f5=await this['connection']['query'](_0xe04f0f(0x1a0)+_0x23b810+_0xe04f0f(0x169)+_0x537a44[_0xe04f0f(0x174)]+_0xe04f0f(0x192)+_0x537a44[_0xe04f0f(0x193)]+_0xe04f0f(0x135));return{'pie':_0xe21410,'line':_0x5d10f5};}};StatisticService=__decorate([(0x0,common_1[_0x8bbc3e(0x173)])(),__param(0x0,(0x0,typeorm_1[_0x8bbc3e(0x155)])(user_entity_1[_0x8bbc3e(0x159)])),__param(0x1,(0x0,typeorm_1[_0x8bbc3e(0x155)])(chatLog_entity_1['ChatLogEntity'])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(order_entity_1[_0x8bbc3e(0x157)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1['MidjourneyEntity'])),__metadata('design:paramtypes',[typeorm_2[_0x8bbc3e(0x12a)],typeorm_2[_0x8bbc3e(0x12a)],typeorm_2[_0x8bbc3e(0x12a)],typeorm_2['Repository'],globalConfig_service_1[_0x8bbc3e(0x17f)],nestjs_cls_1[_0x8bbc3e(0x129)],typeorm_2['Connection']])],StatisticService),exports['StatisticService']=StatisticService;