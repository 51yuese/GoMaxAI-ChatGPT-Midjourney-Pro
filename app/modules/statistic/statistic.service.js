'use strict';const _0x1b129a=_0x497d;(function(_0x3131f4,_0x2baed7){const _0x42bb47=_0x497d,_0x17d6f5=_0x3131f4();while(!![]){try{const _0x31f1d4=-parseInt(_0x42bb47(0x1ac))/0x1*(-parseInt(_0x42bb47(0x1d9))/0x2)+parseInt(_0x42bb47(0x1d2))/0x3*(parseInt(_0x42bb47(0x1a9))/0x4)+-parseInt(_0x42bb47(0x1eb))/0x5+-parseInt(_0x42bb47(0x202))/0x6*(parseInt(_0x42bb47(0x213))/0x7)+parseInt(_0x42bb47(0x1ef))/0x8*(parseInt(_0x42bb47(0x203))/0x9)+parseInt(_0x42bb47(0x1e1))/0xa*(parseInt(_0x42bb47(0x1b4))/0xb)+parseInt(_0x42bb47(0x1e5))/0xc*(-parseInt(_0x42bb47(0x1ea))/0xd);if(_0x31f1d4===_0x2baed7)break;else _0x17d6f5['push'](_0x17d6f5['shift']());}catch(_0xa8f549){_0x17d6f5['push'](_0x17d6f5['shift']());}}}(_0x2039,0x78527));var __decorate=this&&this[_0x1b129a(0x20e)]||function(_0x5b6b3b,_0x1d3aa1,_0x1b71dc,_0x5483c5){const _0x492d67=_0x1b129a;var _0x5182c4=arguments[_0x492d67(0x1e8)],_0x5ecded=_0x5182c4<0x3?_0x1d3aa1:_0x5483c5===null?_0x5483c5=Object[_0x492d67(0x19b)](_0x1d3aa1,_0x1b71dc):_0x5483c5,_0x411db1;if(typeof Reflect==='object'&&typeof Reflect[_0x492d67(0x1ca)]===_0x492d67(0x1b6))_0x5ecded=Reflect[_0x492d67(0x1ca)](_0x5b6b3b,_0x1d3aa1,_0x1b71dc,_0x5483c5);else{for(var _0x2f357a=_0x5b6b3b[_0x492d67(0x1e8)]-0x1;_0x2f357a>=0x0;_0x2f357a--)if(_0x411db1=_0x5b6b3b[_0x2f357a])_0x5ecded=(_0x5182c4<0x3?_0x411db1(_0x5ecded):_0x5182c4>0x3?_0x411db1(_0x1d3aa1,_0x1b71dc,_0x5ecded):_0x411db1(_0x1d3aa1,_0x1b71dc))||_0x5ecded;}return _0x5182c4>0x3&&_0x5ecded&&Object['defineProperty'](_0x1d3aa1,_0x1b71dc,_0x5ecded),_0x5ecded;},__metadata=this&&this[_0x1b129a(0x1cc)]||function(_0x4e00de,_0x426e42){const _0x3e641d=_0x1b129a;if(typeof Reflect===_0x3e641d(0x1fb)&&typeof Reflect[_0x3e641d(0x1a3)]===_0x3e641d(0x1b6))return Reflect[_0x3e641d(0x1a3)](_0x4e00de,_0x426e42);},__param=this&&this[_0x1b129a(0x1a1)]||function(_0x3dfde2,_0x4dc535){return function(_0x5f3398,_0x734fa6){_0x4dc535(_0x5f3398,_0x734fa6,_0x3dfde2);};};Object[_0x1b129a(0x1f0)](exports,_0x1b129a(0x1ae),{'value':!![]}),exports[_0x1b129a(0x1e4)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require('@nestjs/typeorm'),user_entity_1=require(_0x1b129a(0x1d7)),typeorm_2=require(_0x1b129a(0x1cd)),chatLog_entity_1=require(_0x1b129a(0x1e0)),balance_constant_1=require(_0x1b129a(0x209)),date_1=require(_0x1b129a(0x1bd)),axios_1=require(_0x1b129a(0x20c)),order_entity_1=require('../order/order.entity'),midjourney_entity_1=require(_0x1b129a(0x1ab)),midjourney_constant_1=require(_0x1b129a(0x22c)),model_constant_1=require(_0x1b129a(0x1e2)),globalConfig_service_1=require(_0x1b129a(0x221)),nestjs_cls_1=require('nestjs-cls'),utils_1=require(_0x1b129a(0x201));let StatisticService=class StatisticService{constructor(_0x18ae52,_0x101b6a,_0x28495c,_0x47ab36,_0x1eb96c,_0x5e289e,_0xeef2ab){const _0x5c8a8d=_0x1b129a;this[_0x5c8a8d(0x1dd)]=_0x18ae52,this[_0x5c8a8d(0x229)]=_0x101b6a,this['orderEntity']=_0x28495c,this['midjourneyEntity']=_0x47ab36,this[_0x5c8a8d(0x21e)]=_0x1eb96c,this['clsService']=_0x5e289e,this[_0x5c8a8d(0x214)]=_0xeef2ab;}async['getBaseStatistic'](_0x14d6f7){const _0x59283b=_0x1b129a,_0x14b199=(0x0,utils_1[_0x59283b(0x1d5)])(this[_0x59283b(0x1e3)]);_0x14b199!==0x0&&(_0x14d6f7=_0x14b199);const _0x5174aa=await this[_0x59283b(0x1c8)](_0x14d6f7),_0x30977a=await this[_0x59283b(0x1a6)](_0x14d6f7),_0x5c9aa4=await this[_0x59283b(0x1f9)](_0x14d6f7),_0xe6fec6=await this[_0x59283b(0x19d)](_0x14d6f7),_0x50eda5=await this[_0x59283b(0x218)](_0x14d6f7),_0x5c8fab=await this[_0x59283b(0x19c)](_0x14d6f7),_0x26a89e=await this[_0x59283b(0x204)](_0x14d6f7),_0x3befc4=await this['countOrders'](_0x14d6f7),_0x28eb65=await this['countNewOrdersToday'](_0x14d6f7),_0x46868f=await this[_0x59283b(0x1c4)](_0x14d6f7),_0x7c8a87=await this['countTotalCollection'](_0x14d6f7),_0x3ca59e=await this[_0x59283b(0x1bf)](_0x14d6f7),_0x524ef9=await this[_0x59283b(0x1dc)](_0x14d6f7),_0xfa70be=await this[_0x59283b(0x1aa)](_0x14d6f7),_0x3e2c27=await this['countInviteUsersTotal'](_0x14d6f7);return{'userCount':_0x5174aa,'newUserCount':_0x30977a,'chatCount':_0x5c9aa4,'newChatCount':_0xe6fec6,'drawCount':_0x50eda5,'newDrawCount':_0x26a89e+_0x5c8fab,'orderCount':_0x3befc4,'newOrderCount':_0x28eb65,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x46868f,'totalCollection':_0x7c8a87,'todayMusic':_0x3ca59e,'totalMusic':_0x524ef9,'todayVideo':0x0,'totalVideo':0x0,'todayInviteCount':_0xfa70be,'totalInviteCount':_0x3e2c27};}async[_0x1b129a(0x1c8)](_0x3f636f){const _0x4b2ce1=_0x1b129a,_0x1d3217={};_0x3f636f!==undefined&&(_0x1d3217[_0x4b2ce1(0x1c6)]=_0x3f636f);const _0x4ed451=await this[_0x4b2ce1(0x1dd)][_0x4b2ce1(0x1ce)]({'where':_0x1d3217});return _0x4ed451;}async[_0x1b129a(0x1a7)](_0x4b9c92){const _0x418fc3=_0x1b129a,_0x4ce43a={'inviteCode':(0x0,typeorm_2['Not'])('')};_0x4b9c92!==undefined&&(_0x4ce43a[_0x418fc3(0x1c6)]=_0x4b9c92);const _0x6550cc=await this[_0x418fc3(0x1dd)][_0x418fc3(0x1ce)]({'where':_0x4ce43a});return _0x6550cc;}async[_0x1b129a(0x1aa)](_0x5ce941){const _0x33c7ce=_0x1b129a,_0xa7b5e6=(0x0,date_1[_0x33c7ce(0x1bb)])()[_0x33c7ce(0x22d)]('d')[_0x33c7ce(0x1c2)](),_0xa19288=(0x0,date_1[_0x33c7ce(0x1bb)])()['endOf']('d')[_0x33c7ce(0x1c2)](),_0x2f3b84={'createdAt':(0x0,typeorm_2['Between'])(_0xa7b5e6,_0xa19288),'inviteCode':(0x0,typeorm_2[_0x33c7ce(0x22e)])('')};_0x5ce941!==undefined&&(_0x2f3b84[_0x33c7ce(0x1c6)]=_0x5ce941);const _0x224a8d=await this[_0x33c7ce(0x1dd)][_0x33c7ce(0x1ce)]({'where':_0x2f3b84});return _0x224a8d;}async[_0x1b129a(0x1a6)](_0x1fe3eb){const _0x414c16=_0x1b129a,_0x479003=(0x0,date_1[_0x414c16(0x1bb)])()['startOf']('d')[_0x414c16(0x1c2)](),_0x17f32f=(0x0,date_1[_0x414c16(0x1bb)])()[_0x414c16(0x1d8)]('d')[_0x414c16(0x1c2)](),_0x4aafb4={'createdAt':(0x0,typeorm_2[_0x414c16(0x1a5)])(_0x479003,_0x17f32f)};_0x1fe3eb!==undefined&&(_0x4aafb4['saasId']=_0x1fe3eb);const _0x326c69=await this[_0x414c16(0x1dd)][_0x414c16(0x1ce)]({'where':_0x4aafb4});return _0x326c69;}async['countChats'](_0x3c3baf){const _0x523fc0=_0x1b129a,_0x29d1f6={'type':balance_constant_1[_0x523fc0(0x19a)][_0x523fc0(0x1f3)]};_0x3c3baf!==undefined&&(_0x29d1f6[_0x523fc0(0x1c6)]=_0x3c3baf);const _0x4c6118=await this[_0x523fc0(0x229)]['count']({'where':_0x29d1f6});return _0x4c6118;}async[_0x1b129a(0x19d)](_0x55f66a){const _0xf535d1=_0x1b129a,_0x504dd0=(0x0,date_1[_0xf535d1(0x1bb)])()[_0xf535d1(0x22d)]('d')['toDate'](),_0x247b02=(0x0,date_1[_0xf535d1(0x1bb)])()[_0xf535d1(0x1d8)]('d')[_0xf535d1(0x1c2)](),_0x2eeaff={'type':balance_constant_1[_0xf535d1(0x19a)][_0xf535d1(0x1f3)],'createdAt':(0x0,typeorm_2['Between'])(_0x504dd0,_0x247b02)};_0x55f66a!==undefined&&(_0x2eeaff[_0xf535d1(0x1c6)]=_0x55f66a);const _0x434cee=await this['chatLogEntity']['count']({'where':_0x2eeaff});return _0x434cee;}async['countDraws'](_0x117374){const _0x32ea44=_0x1b129a,_0x385d02={'type':balance_constant_1[_0x32ea44(0x19a)][_0x32ea44(0x22b)]};_0x117374!==undefined&&(_0x385d02[_0x32ea44(0x1c6)]=_0x117374);const _0x14c1b2=await this[_0x32ea44(0x229)][_0x32ea44(0x1ce)]({'where':_0x385d02});return _0x14c1b2;}async['countNewDrawsToday'](_0x4561d0){const _0x424491=_0x1b129a,_0x497a73=(0x0,date_1[_0x424491(0x1bb)])()[_0x424491(0x22d)]('d')[_0x424491(0x1c2)](),_0x17bd3c=(0x0,date_1[_0x424491(0x1bb)])()['endOf']('d')['toDate'](),_0x212d8e={'type':balance_constant_1[_0x424491(0x19a)][_0x424491(0x22b)],'createdAt':(0x0,typeorm_2[_0x424491(0x1a5)])(_0x497a73,_0x17bd3c)};_0x4561d0!==undefined&&(_0x212d8e[_0x424491(0x1c6)]=_0x4561d0);const _0x3da1ef=await this[_0x424491(0x229)]['count']({'where':_0x212d8e});return _0x3da1ef;}async[_0x1b129a(0x204)](_0x2bcc52){const _0x54569d=_0x1b129a,_0x386247=(0x0,date_1[_0x54569d(0x1bb)])()[_0x54569d(0x22d)]('d')[_0x54569d(0x1c2)](),_0xe2b5ae=(0x0,date_1[_0x54569d(0x1bb)])()[_0x54569d(0x1d8)]('d')['toDate'](),_0x3afcdc={'createdAt':(0x0,typeorm_2['Between'])(_0x386247,_0xe2b5ae)};_0x2bcc52!==undefined&&(_0x3afcdc[_0x54569d(0x1c6)]=_0x2bcc52);const _0x49d43c=await this[_0x54569d(0x22a)]['count']({'where':_0x3afcdc});return _0x49d43c;}async['countOrders'](_0x2a5b2a){const _0x463eb5=_0x1b129a,_0x421752={};_0x2a5b2a!==undefined&&(_0x421752['saasId']=_0x2a5b2a);const _0x17dfc7=await this[_0x463eb5(0x19f)][_0x463eb5(0x1ce)]({'where':_0x421752});return _0x17dfc7;}async[_0x1b129a(0x1d4)](_0xef6ea9){const _0xacd4ed=_0x1b129a,_0x38f18b=(0x0,date_1[_0xacd4ed(0x1bb)])()[_0xacd4ed(0x22d)]('d')[_0xacd4ed(0x1c2)](),_0x299f46=(0x0,date_1[_0xacd4ed(0x1bb)])()['endOf']('d')[_0xacd4ed(0x1c2)](),_0x5adf9c={'createdAt':(0x0,typeorm_2[_0xacd4ed(0x1a5)])(_0x38f18b,_0x299f46),'status':0x1};_0xef6ea9!==undefined&&(_0x5adf9c[_0xacd4ed(0x1c6)]=_0xef6ea9);const _0x652de8=await this[_0xacd4ed(0x19f)][_0xacd4ed(0x1ce)]({'where':_0x5adf9c});return _0x652de8;}async[_0x1b129a(0x1bf)](_0xb4f322){const _0x51dd5f=_0x1b129a,_0x5b58fe=(0x0,date_1[_0x51dd5f(0x1bb)])()['startOf']('d')[_0x51dd5f(0x1c2)](),_0x2fe054=(0x0,date_1['default'])()[_0x51dd5f(0x1d8)]('d')[_0x51dd5f(0x1c2)](),_0x53d881={'answer':(0x0,typeorm_2[_0x51dd5f(0x22e)])((0x0,typeorm_2[_0x51dd5f(0x1fe)])()),'modelType':model_constant_1[_0x51dd5f(0x1fc)][_0x51dd5f(0x1e6)],'createdAt':(0x0,typeorm_2[_0x51dd5f(0x1a5)])(_0x5b58fe,_0x2fe054)};_0xb4f322!==undefined&&(_0x53d881[_0x51dd5f(0x1c6)]=_0xb4f322);const _0x4fd05c=await this[_0x51dd5f(0x229)][_0x51dd5f(0x1ce)]({'where':_0x53d881});return _0x4fd05c;}async[_0x1b129a(0x1dc)](_0x3e53c1){const _0x3f2f85=_0x1b129a,_0x32a34d={'answer':(0x0,typeorm_2[_0x3f2f85(0x22e)])((0x0,typeorm_2[_0x3f2f85(0x1fe)])()),'modelType':model_constant_1[_0x3f2f85(0x1fc)][_0x3f2f85(0x1e6)]};_0x3e53c1!==undefined&&(_0x32a34d['saasId']=_0x3e53c1);const _0x2275b6=await this[_0x3f2f85(0x229)]['count']({'where':_0x32a34d});return _0x2275b6;}async[_0x1b129a(0x1c4)](_0x5a2dc6){const _0x3a2ae8=_0x1b129a,_0x2cc7f5=(0x0,date_1[_0x3a2ae8(0x1bb)])()[_0x3a2ae8(0x22d)]('d')['toDate'](),_0x49e448=(0x0,date_1[_0x3a2ae8(0x1bb)])()['endOf']('d')['toDate'](),_0xc97415={'status':0x1,'updatedAt':(0x0,typeorm_2['Between'])(_0x2cc7f5,_0x49e448)};_0x5a2dc6!==undefined&&(_0xc97415[_0x3a2ae8(0x1c6)]=_0x5a2dc6);const _0x322c1e=await this[_0x3a2ae8(0x19f)][_0x3a2ae8(0x206)]('price',_0xc97415)||0x0;return _0x322c1e['toFixed'](0x2);}async['countTotalCollection'](_0x15f8ca){const _0x4a0b00=_0x1b129a,_0x11461c={'status':0x1};_0x15f8ca!==undefined&&(_0x11461c['saasId']=_0x15f8ca);const _0x24b2c9=await this[_0x4a0b00(0x19f)]['sum']('price',_0x11461c)||0x0;return _0x24b2c9[_0x4a0b00(0x1b9)](0x2);}async[_0x1b129a(0x1f7)]({days:days=0x7,saasId:_0x43d624}){const _0x24fc39=_0x1b129a,_0x666abe=(0x0,utils_1[_0x24fc39(0x1d5)])(this[_0x24fc39(0x1e3)]);_0x666abe!==0x0&&(_0x43d624=_0x666abe);const _0x1c3e80=await this[_0x24fc39(0x222)](days,_0x43d624),_0x1b44bf=await this[_0x24fc39(0x1db)](days,_0x43d624),_0x1f1c98=await this[_0x24fc39(0x1f5)](days,_0x43d624);return{'date':_0x1c3e80[_0x24fc39(0x1af)](_0x43616e=>_0x43616e['date']),'chat':_0x1c3e80['map'](_0x309d51=>_0x309d51[_0x24fc39(0x212)]),'draw':_0x1b44bf[_0x24fc39(0x1af)]((_0x1bbbef,_0x3baac1)=>{const _0x499f00=_0x24fc39;return _0x1bbbef['value']+_0x1f1c98[_0x3baac1][_0x499f00(0x212)];})};}async['countChatsByTimeRange'](_0x37a03c,_0x19fa70){const _0x52b9b8=_0x1b129a,_0x5b16e9=(0x0,date_1[_0x52b9b8(0x1bb)])()[_0x52b9b8(0x20b)](_0x37a03c,'d')[_0x52b9b8(0x22d)]('d')[_0x52b9b8(0x1c2)](),_0x333874=this[_0x52b9b8(0x229)][_0x52b9b8(0x226)]('chatlog')[_0x52b9b8(0x200)](_0x52b9b8(0x1c3))[_0x52b9b8(0x1b0)](_0x52b9b8(0x1b8),{'type':balance_constant_1[_0x52b9b8(0x19a)][_0x52b9b8(0x1f3)]})[_0x52b9b8(0x1e9)](_0x52b9b8(0x211),{'startDate':_0x5b16e9});_0x19fa70!==undefined&&_0x333874[_0x52b9b8(0x1e9)](_0x52b9b8(0x1ec),{'saasId':_0x19fa70});_0x333874[_0x52b9b8(0x20d)](_0x52b9b8(0x1ba))[_0x52b9b8(0x217)](_0x52b9b8(0x1ba));const _0x544471=await _0x333874[_0x52b9b8(0x20a)](),_0x49d1c1=[],_0x3933ea=_0x5b16e9;for(let _0x2953d2=0x0;_0x2953d2<_0x37a03c;_0x2953d2++){const _0x4811ad=(0x0,date_1['formatDate'])(new Date(_0x3933ea),_0x52b9b8(0x216)),_0x2bf959=_0x544471[_0x52b9b8(0x1da)](_0x3bd916=>(0x0,date_1['formatDate'])(new Date(_0x3bd916[_0x52b9b8(0x1ba)]),_0x52b9b8(0x216))===_0x4811ad)?.['count']??0x0;_0x2bf959>0x0?_0x49d1c1[_0x52b9b8(0x1f1)]({'date':_0x4811ad,'value':Number(_0x2bf959)}):_0x49d1c1['push']({'date':_0x4811ad,'value':0x0}),_0x3933ea['setDate'](_0x3933ea[_0x52b9b8(0x1df)]()+0x1);}return _0x49d1c1;}async[_0x1b129a(0x1db)](_0x50ee0e,_0x307108){const _0x286ae1=_0x1b129a,_0x4c6874=(0x0,date_1[_0x286ae1(0x1bb)])()['subtract'](_0x50ee0e,'d')[_0x286ae1(0x22d)]('d')[_0x286ae1(0x1c2)](),_0x76f309=this[_0x286ae1(0x229)][_0x286ae1(0x226)]('chatlog')[_0x286ae1(0x200)](_0x286ae1(0x1c3))[_0x286ae1(0x1b0)](_0x286ae1(0x1b8),{'type':balance_constant_1[_0x286ae1(0x19a)][_0x286ae1(0x22b)]})[_0x286ae1(0x1e9)]('chatlog.createdAt\x20>=\x20:startDate',{'startDate':_0x4c6874});_0x307108!==undefined&&_0x76f309[_0x286ae1(0x1e9)](_0x286ae1(0x1ec),{'saasId':_0x307108});_0x76f309[_0x286ae1(0x20d)]('date')[_0x286ae1(0x217)](_0x286ae1(0x1ba));const _0x17f47f=await _0x76f309[_0x286ae1(0x20a)](),_0x5b132a=[],_0x52087f=_0x4c6874;for(let _0x2a0bd8=0x0;_0x2a0bd8<_0x50ee0e;_0x2a0bd8++){const _0x29fbac=(0x0,date_1[_0x286ae1(0x1cb)])(new Date(_0x52087f),_0x286ae1(0x216)),_0x5ecf58=_0x17f47f[_0x286ae1(0x1da)](_0x4b4eaf=>(0x0,date_1[_0x286ae1(0x1cb)])(new Date(_0x4b4eaf[_0x286ae1(0x1ba)]),_0x286ae1(0x216))===_0x29fbac)?.[_0x286ae1(0x1ce)]??0x0;_0x5ecf58>0x0?_0x5b132a[_0x286ae1(0x1f1)]({'date':_0x29fbac,'value':Number(_0x5ecf58)}):_0x5b132a[_0x286ae1(0x1f1)]({'date':_0x29fbac,'value':0x0}),_0x52087f[_0x286ae1(0x1a4)](_0x52087f[_0x286ae1(0x1df)]()+0x1);}return _0x5b132a;}async[_0x1b129a(0x1f5)](_0x70c30f,_0x3d3ceb){const _0x28ee62=_0x1b129a,_0x5d72f4=(0x0,date_1[_0x28ee62(0x1bb)])()[_0x28ee62(0x20b)](_0x70c30f,'d')[_0x28ee62(0x22d)]('d')[_0x28ee62(0x1c2)](),_0x3b76b4=this[_0x28ee62(0x22a)][_0x28ee62(0x226)](_0x28ee62(0x1c9))['select'](_0x28ee62(0x1cf))['where'](_0x28ee62(0x1d6),{'status':midjourney_constant_1[_0x28ee62(0x210)][_0x28ee62(0x1fa)]})[_0x28ee62(0x1e9)](_0x28ee62(0x208),{'startDate':_0x5d72f4});_0x3d3ceb!==undefined&&_0x3b76b4['andWhere'](_0x28ee62(0x1bc),{'saasId':_0x3d3ceb});_0x3b76b4[_0x28ee62(0x20d)](_0x28ee62(0x1ba))['orderBy'](_0x28ee62(0x1ba));const _0x49f0b0=await _0x3b76b4[_0x28ee62(0x20a)](),_0x7e44b3=[],_0x27b2c4=_0x5d72f4;for(let _0x4eb84e=0x0;_0x4eb84e<_0x70c30f;_0x4eb84e++){const _0x57c192=(0x0,date_1[_0x28ee62(0x1cb)])(new Date(_0x27b2c4),_0x28ee62(0x216)),_0x7933=_0x49f0b0[_0x28ee62(0x1da)](_0x2d86d5=>(0x0,date_1[_0x28ee62(0x1cb)])(new Date(_0x2d86d5['date']),_0x28ee62(0x216))===_0x57c192)?.['count']??0x0;_0x7933>0x0?_0x7e44b3['push']({'date':_0x57c192,'value':Number(_0x7933)}):_0x7e44b3[_0x28ee62(0x1f1)]({'date':_0x57c192,'value':0x0}),_0x27b2c4[_0x28ee62(0x1a4)](_0x27b2c4['getDate']()+0x1);}return _0x7e44b3;}async[_0x1b129a(0x1a8)](_0x274567){const _0x2190ac=_0x1b129a,_0x5e8564=(0x0,date_1[_0x2190ac(0x1cb)])(new Date(),_0x2190ac(0x220)),_0x4184e9=(0x0,date_1['formatDate'])(new Date(Date[_0x2190ac(0x1f6)]()-Number(_0x274567-0x1)*0x18*0x3c*0x3c*0x3e8),'YYYYMMDD'),_0x5cd730=_0x2190ac(0x1fd),_0x1a131b=_0x2190ac(0x1b5),_0x1c0271=await this['globalConfigService'][_0x2190ac(0x1ee)]([_0x2190ac(0x21d),_0x2190ac(0x21b)]),_0x2236c8=_0x1c0271[_0x2190ac(0x21b)],_0x49d33a=_0x1c0271['baiduToken'];if(!_0x2236c8||!_0x49d33a)return[];if(!_0x2236c8)throw new common_1['HttpException'](_0x2190ac(0x21c),common_1[_0x2190ac(0x1f8)][_0x2190ac(0x227)]);if(!_0x49d33a)throw new common_1[(_0x2190ac(0x1b3))](_0x2190ac(0x223),common_1[_0x2190ac(0x1f8)][_0x2190ac(0x227)]);const _0xc23249=_0x2190ac(0x1a2)+_0x49d33a+_0x2190ac(0x1be)+_0x2236c8+_0x2190ac(0x1de)+_0x1a131b+_0x2190ac(0x1d3)+_0x4184e9+'&end_date='+_0x5e8564+_0x2190ac(0x1d0)+_0x5cd730,_0x3a7664=await axios_1[_0x2190ac(0x1bb)][_0x2190ac(0x207)](_0xc23249),{error_code:_0x44df24,message:_0x5ebf89}=_0x3a7664[_0x2190ac(0x225)];if(_0x44df24===0x6f)throw new common_1[(_0x2190ac(0x1b3))](_0x5ebf89||_0x2190ac(0x1c1),common_1[_0x2190ac(0x1f8)][_0x2190ac(0x227)]);if(_0x44df24&&_0x44df24!==0xc8)throw new common_1[(_0x2190ac(0x1b3))](_0x5ebf89||_0x2190ac(0x228),common_1['HttpStatus'][_0x2190ac(0x227)]);return _0x3a7664[_0x2190ac(0x225)][_0x2190ac(0x1b1)];}async[_0x1b129a(0x1f4)](_0x3f6d3c){const _0x3970a9=_0x1b129a,_0x3248b7=await this['connection']['query'](_0x3970a9(0x1ad)+_0x3f6d3c['startTime']+_0x3970a9(0x224)+_0x3f6d3c[_0x3970a9(0x19e)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20'),_0x9ba2df=(0x0,date_1[_0x3970a9(0x1bb)])(_0x3f6d3c[_0x3970a9(0x20f)])[_0x3970a9(0x1ff)]((0x0,date_1[_0x3970a9(0x1bb)])(_0x3f6d3c[_0x3970a9(0x19e)]),'day'),_0x5b5e67=_0x9ba2df===0x0?'%Y-%m-%d\x20%H:00':_0x3970a9(0x219),_0x5741e9=await this[_0x3970a9(0x214)][_0x3970a9(0x1f2)](_0x3970a9(0x1b2)+_0x5b5e67+_0x3970a9(0x1a0)+_0x3f6d3c['startTime']+_0x3970a9(0x224)+_0x3f6d3c['endTime']+_0x3970a9(0x1c5));return{'pie':_0x3248b7,'line':_0x5741e9};}};function _0x497d(_0x4e1050,_0x218afd){const _0x2039ef=_0x2039();return _0x497d=function(_0x497d65,_0x3a794c){_0x497d65=_0x497d65-0x19a;let _0x37ff60=_0x2039ef[_0x497d65];return _0x37ff60;},_0x497d(_0x4e1050,_0x218afd);}function _0x2039(){const _0x30efae=['result','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27','HttpException','209arHfFD','overview/getTimeTrendRpt','function','Connection','chatlog.type\x20=\x20:type','toFixed','date','default','midjourney.saasId\x20=\x20:saasId','../../common/utils/date','&site_id=','countTodayMusic','OrderEntity','百度授权码过期','toDate','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','countTodayCollection','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','saasId','UserEntity','countUsers','midjourney','decorate','formatDate','__metadata','typeorm','count','DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','&metrics=','design:paramtypes','436398KLWykI','&start_date=','countNewOrdersToday','getReqSaasId','midjourney.status\x20=\x20:status','../user/user.entity','endOf','3530TpbYxA','find','countDrawsByTimeRange','countTotalMusic','userEntity','&method=','getDate','../chatLog/entity/chatLog.entity','81890oBLDbN','../../common/constants/model.constant','clsService','StatisticService','9168URgVff','MUSIC','GlobalConfigService','length','andWhere','1976lsnVHi','2244715ROdLjV','chatlog.saasId\x20=\x20:saasId','MidjourneyEntity','getConfigByKeys','6558072JGXstD','defineProperty','push','query','CHAT_TYPE','modelUse','countMjDrawsByTimeRange','now','getChatStatistic','HttpStatus','countChats','DRAWED','object','EModelType','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','IsNull','diff','select','../../common/utils','12162uCJxEK','9gHkfxM','countNewMidhourneysToday','InjectRepository','sum','get','midjourney.createdAt\x20>=\x20:startDate','../../common/constants/balance.constant','getRawMany','subtract','axios','groupBy','__decorate','startTime','MidjourneyStatusEnum','chatlog.createdAt\x20>=\x20:startDate','value','266hNTOaP','connection','Repository','M.DD','orderBy','countDraws','%Y-%m-%d','ClsService','baiduSiteId','请先配置百度统计siteId','baiduToken','globalConfigService','ChatLogEntity','YYYYMMDD','../globalConfig/globalConfig.service','countChatsByTimeRange','请先配置百度统计accessToken','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','data','createQueryBuilder','BAD_REQUEST','获取百度统计数据失败','chatLogEntity','midjourneyEntity','PAINT_TYPE','../../common/constants/midjourney.constant','startOf','Not','Injectable','DeductionKey','getOwnPropertyDescriptor','countNewDrawsToday','countNewChatsToday','endTime','orderEntity','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','__param','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','metadata','setDate','Between','countNewUsersToday','countInviteUsersTotal','getBaiduStatistics','4pxAJrk','countInviteUsersToday','../midjourney/midjourney.entity','8Isibmr','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','__esModule','map','where'];_0x2039=function(){return _0x30efae;};return _0x2039();}StatisticService=__decorate([(0x0,common_1[_0x1b129a(0x22f)])(),__param(0x0,(0x0,typeorm_1[_0x1b129a(0x205)])(user_entity_1[_0x1b129a(0x1c7)])),__param(0x1,(0x0,typeorm_1[_0x1b129a(0x205)])(chatLog_entity_1[_0x1b129a(0x21f)])),__param(0x2,(0x0,typeorm_1[_0x1b129a(0x205)])(order_entity_1[_0x1b129a(0x1c0)])),__param(0x3,(0x0,typeorm_1[_0x1b129a(0x205)])(midjourney_entity_1[_0x1b129a(0x1ed)])),__metadata(_0x1b129a(0x1d1),[typeorm_2[_0x1b129a(0x215)],typeorm_2['Repository'],typeorm_2['Repository'],typeorm_2[_0x1b129a(0x215)],globalConfig_service_1[_0x1b129a(0x1e7)],nestjs_cls_1[_0x1b129a(0x21a)],typeorm_2[_0x1b129a(0x1b7)]])],StatisticService),exports[_0x1b129a(0x1e4)]=StatisticService;