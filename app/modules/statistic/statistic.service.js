'use strict';function _0x38f6(){const _0x3d6082=['Not','orderBy','YYYYMMDD','countMjDrawsByTimeRange','startTime','M.DD','../user/user.entity','map','InjectRepository','Repository','sum','../../common/utils','PAINT_TYPE','EModelType','countNewDrawsToday','ChatLogEntity','DRAWED','@nestjs/common','countInviteUsersTotal','countChatsByTimeRange','price','../chatLog/entity/chatLog.entity','toFixed','../globalConfig/globalConfig.service','getDate','请先配置百度统计accessToken','chatLogEntity','countDraws','midjourneyEntity','HttpStatus','../../common/constants/balance.constant','value','midjourney.status\x20=\x20:status','getBaseStatistic','../../common/constants/midjourney.constant','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','date','find','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','midjourney.createdAt\x20>=\x20:startDate','getReqSaasId','MidjourneyEntity','startOf','3554435GynVIz','getBaiduStatistics','chatlog.createdAt\x20>=\x20:startDate','&end_date=','OrderEntity','GlobalConfigService','countTodayCollection','请先配置百度统计siteId','38050GxeCSt','436583UhHduj','endOf','../../common/utils/date','Connection','object','&site_id=','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27','globalConfigService','baiduSiteId','midjourney','groupBy','Between','countNewUsersToday','andWhere','function','7891144KJRbFM','createQueryBuilder','608637CDkWnk','getChatStatistic','../midjourney/midjourney.entity','day','3JaVxII','getOwnPropertyDescriptor','push','select','countNewOrdersToday','chatlog','CHAT_TYPE','countTotalMusic','length','__decorate','获取百度统计数据失败','IsNull','MidjourneyStatusEnum','countTotalCollection','chatlog.saasId\x20=\x20:saasId','ClsService','countNewMidhourneysToday','setDate','toDate','../../common/constants/model.constant','design:paramtypes','countUsers','count','countNewChatsToday','HttpException','clsService','now','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','where','DeductionKey','defineProperty','&metrics=','countDrawsByTimeRange','countTodayMusic','412314bVWDuB','metadata','chatlog.type\x20=\x20:type','%Y-%m-%d\x20%H:00','typeorm','connection','639WjxkBU','userEntity','3312968ZqdzRF','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','axios','../order/order.entity','data','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','overview/getTimeTrendRpt','&start_date=','getRawMany','54npLHTH','formatDate','MUSIC','endTime','orderEntity','nestjs-cls','baiduToken','countOrders','query','saasId','__esModule','default','subtract','get','diff','decorate','StatisticService','BAD_REQUEST','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time'];_0x38f6=function(){return _0x3d6082;};return _0x38f6();}const _0x373b75=_0x32c6;(function(_0x4fdbe3,_0x41d2f0){const _0x227e7f=_0x32c6,_0x2049da=_0x4fdbe3();while(!![]){try{const _0x2fa508=-parseInt(_0x227e7f(0x155))/0x1+-parseInt(_0x227e7f(0x17b))/0x2+parseInt(_0x227e7f(0x159))/0x3*(parseInt(_0x227e7f(0x183))/0x4)+-parseInt(_0x227e7f(0x13b))/0x5+-parseInt(_0x227e7f(0x18c))/0x6*(-parseInt(_0x227e7f(0x144))/0x7)+parseInt(_0x227e7f(0x153))/0x8+-parseInt(_0x227e7f(0x181))/0x9*(parseInt(_0x227e7f(0x143))/0xa);if(_0x2fa508===_0x41d2f0)break;else _0x2049da['push'](_0x2049da['shift']());}catch(_0x24f3a7){_0x2049da['push'](_0x2049da['shift']());}}}(_0x38f6,0x8da18));var __decorate=this&&this[_0x373b75(0x162)]||function(_0x581c06,_0x4c34db,_0x32fd43,_0x4e7fb9){const _0x49deb0=_0x373b75;var _0x3608c6=arguments[_0x49deb0(0x161)],_0x49f607=_0x3608c6<0x3?_0x4c34db:_0x4e7fb9===null?_0x4e7fb9=Object[_0x49deb0(0x15a)](_0x4c34db,_0x32fd43):_0x4e7fb9,_0x4fe046;if(typeof Reflect===_0x49deb0(0x148)&&typeof Reflect[_0x49deb0(0x19b)]===_0x49deb0(0x152))_0x49f607=Reflect['decorate'](_0x581c06,_0x4c34db,_0x32fd43,_0x4e7fb9);else{for(var _0x1b0aee=_0x581c06['length']-0x1;_0x1b0aee>=0x0;_0x1b0aee--)if(_0x4fe046=_0x581c06[_0x1b0aee])_0x49f607=(_0x3608c6<0x3?_0x4fe046(_0x49f607):_0x3608c6>0x3?_0x4fe046(_0x4c34db,_0x32fd43,_0x49f607):_0x4fe046(_0x4c34db,_0x32fd43))||_0x49f607;}return _0x3608c6>0x3&&_0x49f607&&Object['defineProperty'](_0x4c34db,_0x32fd43,_0x49f607),_0x49f607;},__metadata=this&&this['__metadata']||function(_0x3bf246,_0x17a126){const _0x417a7d=_0x373b75;if(typeof Reflect===_0x417a7d(0x148)&&typeof Reflect[_0x417a7d(0x17c)]===_0x417a7d(0x152))return Reflect[_0x417a7d(0x17c)](_0x3bf246,_0x17a126);},__param=this&&this['__param']||function(_0x48b9f0,_0x59d4db){return function(_0x1de149,_0x49028c){_0x59d4db(_0x1de149,_0x49028c,_0x48b9f0);};};Object[_0x373b75(0x177)](exports,_0x373b75(0x196),{'value':!![]}),exports[_0x373b75(0x19c)]=void 0x0;const common_1=require(_0x373b75(0x1b0)),typeorm_1=require('@nestjs/typeorm'),user_entity_1=require(_0x373b75(0x1a5)),typeorm_2=require(_0x373b75(0x17f)),chatLog_entity_1=require(_0x373b75(0x1b4)),balance_constant_1=require(_0x373b75(0x12e)),date_1=require(_0x373b75(0x146)),axios_1=require(_0x373b75(0x185)),order_entity_1=require(_0x373b75(0x186)),midjourney_entity_1=require(_0x373b75(0x157)),midjourney_constant_1=require(_0x373b75(0x132)),model_constant_1=require(_0x373b75(0x16c)),globalConfig_service_1=require(_0x373b75(0x1b6)),nestjs_cls_1=require(_0x373b75(0x191)),utils_1=require(_0x373b75(0x1aa));function _0x32c6(_0x57b916,_0x849fdd){const _0x38f6f4=_0x38f6();return _0x32c6=function(_0x32c660,_0x121472){_0x32c660=_0x32c660-0x12a;let _0x4b69cc=_0x38f6f4[_0x32c660];return _0x4b69cc;},_0x32c6(_0x57b916,_0x849fdd);}let StatisticService=class StatisticService{constructor(_0x16ea40,_0x2b0670,_0x3ae905,_0x4b56c4,_0x1c4924,_0x6d5b97,_0x47e13e){const _0x11e23a=_0x373b75;this[_0x11e23a(0x182)]=_0x16ea40,this[_0x11e23a(0x12a)]=_0x2b0670,this[_0x11e23a(0x190)]=_0x3ae905,this['midjourneyEntity']=_0x4b56c4,this[_0x11e23a(0x14b)]=_0x1c4924,this[_0x11e23a(0x172)]=_0x6d5b97,this[_0x11e23a(0x180)]=_0x47e13e;}async[_0x373b75(0x131)](_0x21a20){const _0x42b83f=_0x373b75,_0x1457d6=(0x0,utils_1[_0x42b83f(0x138)])(this['clsService']);_0x1457d6!==0x0&&(_0x21a20=_0x1457d6);const _0xd6afef=await this['countUsers'](_0x21a20),_0x495ec0=await this['countNewUsersToday'](_0x21a20),_0x28cffd=await this['countChats'](_0x21a20),_0x3d9278=await this[_0x42b83f(0x170)](_0x21a20),_0x38ff74=await this[_0x42b83f(0x12b)](_0x21a20),_0x3193a3=await this[_0x42b83f(0x1ad)](_0x21a20),_0x3e8114=await this[_0x42b83f(0x169)](_0x21a20),_0x2d2429=await this['countOrders'](_0x21a20),_0x5833fb=await this[_0x42b83f(0x15d)](_0x21a20),_0x250abb=await this[_0x42b83f(0x141)](_0x21a20),_0x477635=await this[_0x42b83f(0x166)](_0x21a20),_0x901126=await this[_0x42b83f(0x17a)](_0x21a20),_0x4f88c5=await this[_0x42b83f(0x160)](_0x21a20),_0x5f22de=await this['countInviteUsersToday'](_0x21a20),_0x49a87c=await this[_0x42b83f(0x1b1)](_0x21a20);return{'userCount':_0xd6afef,'newUserCount':_0x495ec0,'chatCount':_0x28cffd,'newChatCount':_0x3d9278,'drawCount':_0x38ff74,'newDrawCount':_0x3e8114+_0x3193a3,'orderCount':_0x2d2429,'newOrderCount':_0x5833fb,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x250abb,'totalCollection':_0x477635,'todayMusic':_0x901126,'totalMusic':_0x4f88c5,'todayVideo':0x0,'totalVideo':0x0,'todayInviteCount':_0x5f22de,'totalInviteCount':_0x49a87c};}async[_0x373b75(0x16e)](_0x3d2c9f){const _0x264ff9=_0x373b75,_0x1ba00b={};_0x3d2c9f!==undefined&&(_0x1ba00b['saasId']=_0x3d2c9f);const _0x21a9ba=await this[_0x264ff9(0x182)][_0x264ff9(0x16f)]({'where':_0x1ba00b});return _0x21a9ba;}async[_0x373b75(0x1b1)](_0x24e772){const _0x29071a=_0x373b75,_0x4798d8={'inviteCode':(0x0,typeorm_2[_0x29071a(0x19f)])('')};_0x24e772!==undefined&&(_0x4798d8[_0x29071a(0x195)]=_0x24e772);const _0x828791=await this[_0x29071a(0x182)][_0x29071a(0x16f)]({'where':_0x4798d8});return _0x828791;}async['countInviteUsersToday'](_0x590671){const _0x49612e=_0x373b75,_0x527b66=(0x0,date_1[_0x49612e(0x197)])()[_0x49612e(0x13a)]('d')[_0x49612e(0x16b)](),_0x28e32c=(0x0,date_1[_0x49612e(0x197)])()[_0x49612e(0x145)]('d')[_0x49612e(0x16b)](),_0x349813={'createdAt':(0x0,typeorm_2[_0x49612e(0x14f)])(_0x527b66,_0x28e32c),'inviteCode':(0x0,typeorm_2[_0x49612e(0x19f)])('')};_0x590671!==undefined&&(_0x349813[_0x49612e(0x195)]=_0x590671);const _0x1345fa=await this[_0x49612e(0x182)][_0x49612e(0x16f)]({'where':_0x349813});return _0x1345fa;}async[_0x373b75(0x150)](_0x2a21ac){const _0x2c22a2=_0x373b75,_0xc0bf79=(0x0,date_1[_0x2c22a2(0x197)])()[_0x2c22a2(0x13a)]('d')[_0x2c22a2(0x16b)](),_0x4ab30f=(0x0,date_1['default'])()[_0x2c22a2(0x145)]('d')[_0x2c22a2(0x16b)](),_0x50956e={'createdAt':(0x0,typeorm_2[_0x2c22a2(0x14f)])(_0xc0bf79,_0x4ab30f)};_0x2a21ac!==undefined&&(_0x50956e[_0x2c22a2(0x195)]=_0x2a21ac);const _0x4056c5=await this['userEntity'][_0x2c22a2(0x16f)]({'where':_0x50956e});return _0x4056c5;}async['countChats'](_0x5dbbba){const _0x671296=_0x373b75,_0x10b16f={'type':balance_constant_1['DeductionKey'][_0x671296(0x15f)]};_0x5dbbba!==undefined&&(_0x10b16f[_0x671296(0x195)]=_0x5dbbba);const _0x472266=await this['chatLogEntity'][_0x671296(0x16f)]({'where':_0x10b16f});return _0x472266;}async[_0x373b75(0x170)](_0x14e836){const _0x4ad74d=_0x373b75,_0x5bcae0=(0x0,date_1[_0x4ad74d(0x197)])()[_0x4ad74d(0x13a)]('d')[_0x4ad74d(0x16b)](),_0x35e683=(0x0,date_1[_0x4ad74d(0x197)])()[_0x4ad74d(0x145)]('d')[_0x4ad74d(0x16b)](),_0x4c89ac={'type':balance_constant_1[_0x4ad74d(0x176)][_0x4ad74d(0x15f)],'createdAt':(0x0,typeorm_2[_0x4ad74d(0x14f)])(_0x5bcae0,_0x35e683)};_0x14e836!==undefined&&(_0x4c89ac[_0x4ad74d(0x195)]=_0x14e836);const _0x1e926f=await this[_0x4ad74d(0x12a)][_0x4ad74d(0x16f)]({'where':_0x4c89ac});return _0x1e926f;}async[_0x373b75(0x12b)](_0x38f7a4){const _0x18b278=_0x373b75,_0x15dfe8={'type':balance_constant_1[_0x18b278(0x176)][_0x18b278(0x1ab)]};_0x38f7a4!==undefined&&(_0x15dfe8[_0x18b278(0x195)]=_0x38f7a4);const _0x548966=await this[_0x18b278(0x12a)][_0x18b278(0x16f)]({'where':_0x15dfe8});return _0x548966;}async[_0x373b75(0x1ad)](_0x2444f7){const _0x4dfc2d=_0x373b75,_0x423430=(0x0,date_1[_0x4dfc2d(0x197)])()[_0x4dfc2d(0x13a)]('d')[_0x4dfc2d(0x16b)](),_0x4ce000=(0x0,date_1['default'])()[_0x4dfc2d(0x145)]('d')[_0x4dfc2d(0x16b)](),_0x2cc2f2={'type':balance_constant_1[_0x4dfc2d(0x176)]['PAINT_TYPE'],'createdAt':(0x0,typeorm_2[_0x4dfc2d(0x14f)])(_0x423430,_0x4ce000)};_0x2444f7!==undefined&&(_0x2cc2f2[_0x4dfc2d(0x195)]=_0x2444f7);const _0x2221e7=await this[_0x4dfc2d(0x12a)]['count']({'where':_0x2cc2f2});return _0x2221e7;}async['countNewMidhourneysToday'](_0x317035){const _0x48b27f=_0x373b75,_0x27cdca=(0x0,date_1[_0x48b27f(0x197)])()[_0x48b27f(0x13a)]('d')['toDate'](),_0x3e8871=(0x0,date_1['default'])()[_0x48b27f(0x145)]('d')[_0x48b27f(0x16b)](),_0x3222c9={'createdAt':(0x0,typeorm_2['Between'])(_0x27cdca,_0x3e8871)};_0x317035!==undefined&&(_0x3222c9['saasId']=_0x317035);const _0x9a66bc=await this[_0x48b27f(0x12c)][_0x48b27f(0x16f)]({'where':_0x3222c9});return _0x9a66bc;}async[_0x373b75(0x193)](_0xfce937){const _0x8e29f6=_0x373b75,_0x170a2e={};_0xfce937!==undefined&&(_0x170a2e[_0x8e29f6(0x195)]=_0xfce937);const _0x52611d=await this[_0x8e29f6(0x190)][_0x8e29f6(0x16f)]({'where':_0x170a2e});return _0x52611d;}async[_0x373b75(0x15d)](_0x4a007b){const _0x54041b=_0x373b75,_0x524d6e=(0x0,date_1[_0x54041b(0x197)])()[_0x54041b(0x13a)]('d')[_0x54041b(0x16b)](),_0x627aea=(0x0,date_1[_0x54041b(0x197)])()[_0x54041b(0x145)]('d')[_0x54041b(0x16b)](),_0x44f66a={'createdAt':(0x0,typeorm_2[_0x54041b(0x14f)])(_0x524d6e,_0x627aea),'status':0x1};_0x4a007b!==undefined&&(_0x44f66a[_0x54041b(0x195)]=_0x4a007b);const _0x30c903=await this[_0x54041b(0x190)][_0x54041b(0x16f)]({'where':_0x44f66a});return _0x30c903;}async['countTodayMusic'](_0x4ff132){const _0x5c8e10=_0x373b75,_0x1e7274=(0x0,date_1[_0x5c8e10(0x197)])()['startOf']('d')['toDate'](),_0x13e086=(0x0,date_1[_0x5c8e10(0x197)])()[_0x5c8e10(0x145)]('d')[_0x5c8e10(0x16b)](),_0x5de9f4={'answer':(0x0,typeorm_2[_0x5c8e10(0x19f)])((0x0,typeorm_2[_0x5c8e10(0x164)])()),'modelType':model_constant_1[_0x5c8e10(0x1ac)]['MUSIC'],'createdAt':(0x0,typeorm_2[_0x5c8e10(0x14f)])(_0x1e7274,_0x13e086)};_0x4ff132!==undefined&&(_0x5de9f4[_0x5c8e10(0x195)]=_0x4ff132);const _0x258154=await this[_0x5c8e10(0x12a)][_0x5c8e10(0x16f)]({'where':_0x5de9f4});return _0x258154;}async['countTotalMusic'](_0x55106e){const _0x55b4e2=_0x373b75,_0x5a525e={'answer':(0x0,typeorm_2[_0x55b4e2(0x19f)])((0x0,typeorm_2[_0x55b4e2(0x164)])()),'modelType':model_constant_1['EModelType'][_0x55b4e2(0x18e)]};_0x55106e!==undefined&&(_0x5a525e[_0x55b4e2(0x195)]=_0x55106e);const _0x4eb64e=await this[_0x55b4e2(0x12a)][_0x55b4e2(0x16f)]({'where':_0x5a525e});return _0x4eb64e;}async[_0x373b75(0x141)](_0x17b52b){const _0x122a68=_0x373b75,_0x2e4d21=(0x0,date_1[_0x122a68(0x197)])()['startOf']('d')[_0x122a68(0x16b)](),_0x194832=(0x0,date_1[_0x122a68(0x197)])()[_0x122a68(0x145)]('d')[_0x122a68(0x16b)](),_0x23568f={'status':0x1,'updatedAt':(0x0,typeorm_2[_0x122a68(0x14f)])(_0x2e4d21,_0x194832)};_0x17b52b!==undefined&&(_0x23568f[_0x122a68(0x195)]=_0x17b52b);const _0x4c7a15=await this[_0x122a68(0x190)][_0x122a68(0x1a9)]('price',_0x23568f)||0x0;return _0x4c7a15[_0x122a68(0x1b5)](0x2);}async[_0x373b75(0x166)](_0x73638f){const _0x443dc4=_0x373b75,_0x1cd51e={'status':0x1};_0x73638f!==undefined&&(_0x1cd51e[_0x443dc4(0x195)]=_0x73638f);const _0x43bc9d=await this[_0x443dc4(0x190)][_0x443dc4(0x1a9)](_0x443dc4(0x1b3),_0x1cd51e)||0x0;return _0x43bc9d['toFixed'](0x2);}async[_0x373b75(0x156)]({days:days=0x7,saasId:_0x274e12}){const _0x168695=_0x373b75,_0xe8abbf=(0x0,utils_1['getReqSaasId'])(this[_0x168695(0x172)]);_0xe8abbf!==0x0&&(_0x274e12=_0xe8abbf);const _0x1af3a3=await this[_0x168695(0x1b2)](days,_0x274e12),_0x1aa598=await this[_0x168695(0x179)](days,_0x274e12),_0x15dc60=await this[_0x168695(0x1a2)](days,_0x274e12);return{'date':_0x1af3a3[_0x168695(0x1a6)](_0x2e9edd=>_0x2e9edd[_0x168695(0x134)]),'chat':_0x1af3a3[_0x168695(0x1a6)](_0x5a430e=>_0x5a430e['value']),'draw':_0x1aa598[_0x168695(0x1a6)]((_0x514345,_0xdebe5a)=>{const _0x1f7192=_0x168695;return _0x514345[_0x1f7192(0x12f)]+_0x15dc60[_0xdebe5a][_0x1f7192(0x12f)];})};}async[_0x373b75(0x1b2)](_0x393ed7,_0x32d59f){const _0x35e724=_0x373b75,_0x300c2b=(0x0,date_1[_0x35e724(0x197)])()['subtract'](_0x393ed7,'d')['startOf']('d')[_0x35e724(0x16b)](),_0x368295=this[_0x35e724(0x12a)][_0x35e724(0x154)](_0x35e724(0x15e))[_0x35e724(0x15c)](_0x35e724(0x136))[_0x35e724(0x175)](_0x35e724(0x17d),{'type':balance_constant_1[_0x35e724(0x176)][_0x35e724(0x15f)]})['andWhere']('chatlog.createdAt\x20>=\x20:startDate',{'startDate':_0x300c2b});_0x32d59f!==undefined&&_0x368295[_0x35e724(0x151)](_0x35e724(0x167),{'saasId':_0x32d59f});_0x368295[_0x35e724(0x14e)](_0x35e724(0x134))[_0x35e724(0x1a0)](_0x35e724(0x134));const _0x56776c=await _0x368295[_0x35e724(0x18b)](),_0x5022d0=[],_0x1051ac=_0x300c2b;for(let _0x58fcda=0x0;_0x58fcda<_0x393ed7;_0x58fcda++){const _0x2de26f=(0x0,date_1[_0x35e724(0x18d)])(new Date(_0x1051ac),_0x35e724(0x1a4)),_0x1733c7=_0x56776c['find'](_0x6d8fed=>(0x0,date_1[_0x35e724(0x18d)])(new Date(_0x6d8fed[_0x35e724(0x134)]),'M.DD')===_0x2de26f)?.[_0x35e724(0x16f)]??0x0;_0x1733c7>0x0?_0x5022d0[_0x35e724(0x15b)]({'date':_0x2de26f,'value':Number(_0x1733c7)}):_0x5022d0[_0x35e724(0x15b)]({'date':_0x2de26f,'value':0x0}),_0x1051ac[_0x35e724(0x16a)](_0x1051ac['getDate']()+0x1);}return _0x5022d0;}async[_0x373b75(0x179)](_0x2dfb73,_0x497036){const _0x9b7fbb=_0x373b75,_0x2cd5ef=(0x0,date_1[_0x9b7fbb(0x197)])()[_0x9b7fbb(0x198)](_0x2dfb73,'d')['startOf']('d')[_0x9b7fbb(0x16b)](),_0x6662e6=this[_0x9b7fbb(0x12a)][_0x9b7fbb(0x154)](_0x9b7fbb(0x15e))['select'](_0x9b7fbb(0x136))['where'](_0x9b7fbb(0x17d),{'type':balance_constant_1[_0x9b7fbb(0x176)][_0x9b7fbb(0x1ab)]})[_0x9b7fbb(0x151)](_0x9b7fbb(0x13d),{'startDate':_0x2cd5ef});_0x497036!==undefined&&_0x6662e6[_0x9b7fbb(0x151)](_0x9b7fbb(0x167),{'saasId':_0x497036});_0x6662e6['groupBy']('date')[_0x9b7fbb(0x1a0)](_0x9b7fbb(0x134));const _0x181635=await _0x6662e6[_0x9b7fbb(0x18b)](),_0x15a063=[],_0x4dd8e4=_0x2cd5ef;for(let _0x32276f=0x0;_0x32276f<_0x2dfb73;_0x32276f++){const _0x469dd5=(0x0,date_1[_0x9b7fbb(0x18d)])(new Date(_0x4dd8e4),_0x9b7fbb(0x1a4)),_0x3e2a23=_0x181635[_0x9b7fbb(0x135)](_0x1ca824=>(0x0,date_1[_0x9b7fbb(0x18d)])(new Date(_0x1ca824[_0x9b7fbb(0x134)]),_0x9b7fbb(0x1a4))===_0x469dd5)?.[_0x9b7fbb(0x16f)]??0x0;_0x3e2a23>0x0?_0x15a063['push']({'date':_0x469dd5,'value':Number(_0x3e2a23)}):_0x15a063[_0x9b7fbb(0x15b)]({'date':_0x469dd5,'value':0x0}),_0x4dd8e4['setDate'](_0x4dd8e4[_0x9b7fbb(0x1b7)]()+0x1);}return _0x15a063;}async['countMjDrawsByTimeRange'](_0x4d980d,_0x1d16c6){const _0x222e72=_0x373b75,_0x35ec5d=(0x0,date_1[_0x222e72(0x197)])()[_0x222e72(0x198)](_0x4d980d,'d')[_0x222e72(0x13a)]('d')['toDate'](),_0x576bed=this[_0x222e72(0x12c)][_0x222e72(0x154)](_0x222e72(0x14d))[_0x222e72(0x15c)]('DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')[_0x222e72(0x175)](_0x222e72(0x130),{'status':midjourney_constant_1[_0x222e72(0x165)][_0x222e72(0x1af)]})[_0x222e72(0x151)](_0x222e72(0x137),{'startDate':_0x35ec5d});_0x1d16c6!==undefined&&_0x576bed[_0x222e72(0x151)]('midjourney.saasId\x20=\x20:saasId',{'saasId':_0x1d16c6});_0x576bed[_0x222e72(0x14e)](_0x222e72(0x134))[_0x222e72(0x1a0)](_0x222e72(0x134));const _0x1b9432=await _0x576bed[_0x222e72(0x18b)](),_0x444592=[],_0x2d62da=_0x35ec5d;for(let _0x2a2c61=0x0;_0x2a2c61<_0x4d980d;_0x2a2c61++){const _0x53c38d=(0x0,date_1[_0x222e72(0x18d)])(new Date(_0x2d62da),_0x222e72(0x1a4)),_0x17e403=_0x1b9432['find'](_0x396344=>(0x0,date_1[_0x222e72(0x18d)])(new Date(_0x396344[_0x222e72(0x134)]),_0x222e72(0x1a4))===_0x53c38d)?.[_0x222e72(0x16f)]??0x0;_0x17e403>0x0?_0x444592[_0x222e72(0x15b)]({'date':_0x53c38d,'value':Number(_0x17e403)}):_0x444592[_0x222e72(0x15b)]({'date':_0x53c38d,'value':0x0}),_0x2d62da[_0x222e72(0x16a)](_0x2d62da[_0x222e72(0x1b7)]()+0x1);}return _0x444592;}async[_0x373b75(0x13c)](_0x10ee38){const _0x2a37a5=_0x373b75,_0x53a149=(0x0,date_1[_0x2a37a5(0x18d)])(new Date(),_0x2a37a5(0x1a1)),_0x6a9f1=(0x0,date_1[_0x2a37a5(0x18d)])(new Date(Date[_0x2a37a5(0x173)]()-Number(_0x10ee38-0x1)*0x18*0x3c*0x3c*0x3e8),'YYYYMMDD'),_0x376d6d=_0x2a37a5(0x19e),_0x38733e=_0x2a37a5(0x189),_0x5c099a=await this[_0x2a37a5(0x14b)]['getConfigByKeys']([_0x2a37a5(0x192),_0x2a37a5(0x14c)]),_0x215c5f=_0x5c099a[_0x2a37a5(0x14c)],_0x35206f=_0x5c099a[_0x2a37a5(0x192)];if(!_0x215c5f||!_0x35206f)return[];if(!_0x215c5f)throw new common_1[(_0x2a37a5(0x171))](_0x2a37a5(0x142),common_1[_0x2a37a5(0x12d)][_0x2a37a5(0x19d)]);if(!_0x35206f)throw new common_1['HttpException'](_0x2a37a5(0x1b8),common_1[_0x2a37a5(0x12d)][_0x2a37a5(0x19d)]);const _0x12312d=_0x2a37a5(0x184)+_0x35206f+_0x2a37a5(0x149)+_0x215c5f+'&method='+_0x38733e+_0x2a37a5(0x18a)+_0x6a9f1+_0x2a37a5(0x13e)+_0x53a149+_0x2a37a5(0x178)+_0x376d6d,_0x339413=await axios_1[_0x2a37a5(0x197)][_0x2a37a5(0x199)](_0x12312d),{error_code:_0x57c7e9,message:_0x2aa8b2}=_0x339413[_0x2a37a5(0x187)];if(_0x57c7e9===0x6f)throw new common_1[(_0x2a37a5(0x171))](_0x2aa8b2||'百度授权码过期',common_1[_0x2a37a5(0x12d)]['BAD_REQUEST']);if(_0x57c7e9&&_0x57c7e9!==0xc8)throw new common_1[(_0x2a37a5(0x171))](_0x2aa8b2||_0x2a37a5(0x163),common_1[_0x2a37a5(0x12d)]['BAD_REQUEST']);return _0x339413[_0x2a37a5(0x187)]['result'];}async['modelUse'](_0x469e0c){const _0x3cf5a6=_0x373b75,_0x2f17fd=await this['connection'][_0x3cf5a6(0x194)](_0x3cf5a6(0x188)+_0x469e0c['startTime']+_0x3cf5a6(0x174)+_0x469e0c[_0x3cf5a6(0x18f)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20'),_0x257f7e=(0x0,date_1['default'])(_0x469e0c[_0x3cf5a6(0x1a3)])[_0x3cf5a6(0x19a)]((0x0,date_1['default'])(_0x469e0c[_0x3cf5a6(0x18f)]),_0x3cf5a6(0x158)),_0x457be8=_0x257f7e===0x0?_0x3cf5a6(0x17e):'%Y-%m-%d',_0x5540c3=await this[_0x3cf5a6(0x180)]['query'](_0x3cf5a6(0x14a)+_0x457be8+'\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27'+_0x469e0c[_0x3cf5a6(0x1a3)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27'+_0x469e0c[_0x3cf5a6(0x18f)]+_0x3cf5a6(0x133));return{'pie':_0x2f17fd,'line':_0x5540c3};}};StatisticService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x373b75(0x1a7)])(user_entity_1['UserEntity'])),__param(0x1,(0x0,typeorm_1[_0x373b75(0x1a7)])(chatLog_entity_1[_0x373b75(0x1ae)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(order_entity_1[_0x373b75(0x13f)])),__param(0x3,(0x0,typeorm_1[_0x373b75(0x1a7)])(midjourney_entity_1[_0x373b75(0x139)])),__metadata(_0x373b75(0x16d),[typeorm_2[_0x373b75(0x1a8)],typeorm_2[_0x373b75(0x1a8)],typeorm_2[_0x373b75(0x1a8)],typeorm_2[_0x373b75(0x1a8)],globalConfig_service_1[_0x373b75(0x140)],nestjs_cls_1[_0x373b75(0x168)],typeorm_2[_0x373b75(0x147)]])],StatisticService),exports['StatisticService']=StatisticService;