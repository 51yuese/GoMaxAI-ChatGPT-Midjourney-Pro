'use strict';function _0x1f05(_0x19187f,_0x1a9e63){const _0x48285e=_0x4828();return _0x1f05=function(_0x1f055d,_0x92f997){_0x1f055d=_0x1f055d-0x125;let _0x3d3f7f=_0x48285e[_0x1f055d];return _0x3d3f7f;},_0x1f05(_0x19187f,_0x1a9e63);}const _0x4ddcc1=_0x1f05;(function(_0x2037fa,_0x7e1ab4){const _0x31f835=_0x1f05,_0x3735d0=_0x2037fa();while(!![]){try{const _0x3a87ea=-parseInt(_0x31f835(0x137))/0x1+parseInt(_0x31f835(0x144))/0x2*(parseInt(_0x31f835(0x14a))/0x3)+-parseInt(_0x31f835(0x12c))/0x4*(-parseInt(_0x31f835(0x16f))/0x5)+parseInt(_0x31f835(0x145))/0x6+parseInt(_0x31f835(0x128))/0x7+-parseInt(_0x31f835(0x175))/0x8+-parseInt(_0x31f835(0x143))/0x9*(-parseInt(_0x31f835(0x132))/0xa);if(_0x3a87ea===_0x7e1ab4)break;else _0x3735d0['push'](_0x3735d0['shift']());}catch(_0x45ef40){_0x3735d0['push'](_0x3735d0['shift']());}}}(_0x4828,0xd8c69));function _0x4828(){const _0x4b70ac=['startTime','countNewMidhourneysToday','PAINT_TYPE','find','clsService','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','midjourneyEntity','../user/user.entity','__esModule','__decorate','EModelType','chatlog','countTodayMusic','YYYYMMDD','请先配置百度统计siteId','midjourney.saasId\x20=\x20:saasId','chatlog.saasId\x20=\x20:saasId','%Y-%m-%d','countDraws','midjourney.status\x20=\x20:status','Between','countChatsByTimeRange','orderEntity','getOwnPropertyDescriptor','countTodayCollection','typeorm','endTime','countDrawsByTimeRange','push','andWhere','M.DD','DeductionKey','5chbePE','__metadata','toDate','getBaseStatistic','length','getChatStatistic','11579320ksdhop','select','decorate','baiduSiteId','Repository','data','countTotalMusic','chatLogEntity','sum','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','object','chatlog.createdAt\x20>=\x20:startDate','price','diff','countNewUsersToday','saasId','baiduToken','result','metadata','CHAT_TYPE','day','UserEntity','HttpStatus','toFixed','BAD_REQUEST','default','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','MUSIC','subtract','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','createQueryBuilder','defineProperty','countTotalCollection','chatlog.type\x20=\x20:type','value','百度授权码过期','IsNull','__param','globalConfigService','HttpException','../chatLog/chatLog.entity','midjourney','countOrders','countChats','&method=','getDate','Not','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','startOf','connection','../order/order.entity','function','../../common/constants/model.constant','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','query','modelUse','4144000gkPgTc','getConfigByKeys','getBaiduStatistics','getRawMany','6673148NUCIpg','%Y-%m-%d\x20%H:00','orderBy','StatisticService','countNewDrawsToday','endOf','10qKdJxv','getReqSaasId','InjectRepository','DRAWED','axios','1193785FTWVcM','nestjs-cls','@nestjs/common','countNewChatsToday','formatDate','OrderEntity','../../common/utils/date','midjourney.createdAt\x20>=\x20:startDate','groupBy','countMjDrawsByTimeRange','count','get','3419325bRcwSH','1369670bEEkaZ','1224396KvaJvs','ClsService','where','&end_date=','countUsers','3ICFlqg','map','../../common/utils','date','setDate'];_0x4828=function(){return _0x4b70ac;};return _0x4828();}var __decorate=this&&this[_0x4ddcc1(0x158)]||function(_0x5a9b7f,_0x32ecf7,_0x35ab8c,_0x5baff7){const _0x5f3e3a=_0x4ddcc1;var _0x1eb1e3=arguments[_0x5f3e3a(0x173)],_0x29dc18=_0x1eb1e3<0x3?_0x32ecf7:_0x5baff7===null?_0x5baff7=Object[_0x5f3e3a(0x166)](_0x32ecf7,_0x35ab8c):_0x5baff7,_0x9b51cc;if(typeof Reflect===_0x5f3e3a(0x17f)&&typeof Reflect[_0x5f3e3a(0x177)]==='function')_0x29dc18=Reflect[_0x5f3e3a(0x177)](_0x5a9b7f,_0x32ecf7,_0x35ab8c,_0x5baff7);else{for(var _0x1d62f6=_0x5a9b7f[_0x5f3e3a(0x173)]-0x1;_0x1d62f6>=0x0;_0x1d62f6--)if(_0x9b51cc=_0x5a9b7f[_0x1d62f6])_0x29dc18=(_0x1eb1e3<0x3?_0x9b51cc(_0x29dc18):_0x1eb1e3>0x3?_0x9b51cc(_0x32ecf7,_0x35ab8c,_0x29dc18):_0x9b51cc(_0x32ecf7,_0x35ab8c))||_0x29dc18;}return _0x1eb1e3>0x3&&_0x29dc18&&Object[_0x5f3e3a(0x194)](_0x32ecf7,_0x35ab8c,_0x29dc18),_0x29dc18;},__metadata=this&&this[_0x4ddcc1(0x170)]||function(_0x101ee0,_0x5106e7){const _0x456faf=_0x4ddcc1;if(typeof Reflect===_0x456faf(0x17f)&&typeof Reflect[_0x456faf(0x187)]===_0x456faf(0x1a8))return Reflect[_0x456faf(0x187)](_0x101ee0,_0x5106e7);},__param=this&&this[_0x4ddcc1(0x19a)]||function(_0x5d1eb8,_0x1d7a82){return function(_0x152661,_0x1be339){_0x1d7a82(_0x152661,_0x1be339,_0x5d1eb8);};};Object['defineProperty'](exports,_0x4ddcc1(0x157),{'value':!![]}),exports[_0x4ddcc1(0x12f)]=void 0x0;const common_1=require(_0x4ddcc1(0x139)),typeorm_1=require('@nestjs/typeorm'),user_entity_1=require(_0x4ddcc1(0x156)),typeorm_2=require(_0x4ddcc1(0x168)),chatLog_entity_1=require(_0x4ddcc1(0x19d)),balance_constant_1=require('../../common/constants/balance.constant'),date_1=require(_0x4ddcc1(0x13d)),axios_1=require(_0x4ddcc1(0x136)),order_entity_1=require(_0x4ddcc1(0x1a7)),midjourney_entity_1=require('../midjourney/midjourney.entity'),midjourney_constant_1=require('../../common/constants/midjourney.constant'),model_constant_1=require(_0x4ddcc1(0x1a9)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),nestjs_cls_1=require(_0x4ddcc1(0x138)),utils_1=require(_0x4ddcc1(0x14c));let StatisticService=class StatisticService{constructor(_0x5eb62b,_0x4f6fb7,_0x31444d,_0x15c59c,_0x52fdb8,_0x40c63c,_0x55f2aa){const _0x260700=_0x4ddcc1;this['userEntity']=_0x5eb62b,this['chatLogEntity']=_0x4f6fb7,this['orderEntity']=_0x31444d,this[_0x260700(0x155)]=_0x15c59c,this[_0x260700(0x19b)]=_0x52fdb8,this[_0x260700(0x153)]=_0x40c63c,this[_0x260700(0x1a6)]=_0x55f2aa;}async[_0x4ddcc1(0x172)](_0xe88183){const _0x44521a=_0x4ddcc1,_0x46d57e=(0x0,utils_1[_0x44521a(0x133)])(this['clsService']);_0x46d57e!==0x0&&(_0xe88183=_0x46d57e);const _0x4ff2c9=await this[_0x44521a(0x149)](_0xe88183),_0x43fc5c=await this[_0x44521a(0x183)](_0xe88183),_0x23cd02=await this[_0x44521a(0x1a0)](_0xe88183),_0x306e32=await this[_0x44521a(0x13a)](_0xe88183),_0x187a4e=await this[_0x44521a(0x161)](_0xe88183),_0x316daf=await this[_0x44521a(0x130)](_0xe88183),_0x4f99f2=await this[_0x44521a(0x150)](_0xe88183),_0xb9575b=await this[_0x44521a(0x19f)](_0xe88183),_0x112b18=await this['countNewOrdersToday'](_0xe88183),_0x59442a=await this[_0x44521a(0x167)](_0xe88183),_0x10dae8=await this[_0x44521a(0x195)](_0xe88183),_0x15f5d6=await this[_0x44521a(0x15b)](_0xe88183),_0x313593=await this[_0x44521a(0x17b)](_0xe88183);return{'userCount':_0x4ff2c9,'newUserCount':_0x43fc5c,'chatCount':_0x23cd02,'newChatCount':_0x306e32,'drawCount':_0x187a4e,'newDrawCount':_0x4f99f2+_0x316daf,'orderCount':_0xb9575b,'newOrderCount':_0x112b18,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x59442a,'totalCollection':_0x10dae8,'todayMusic':_0x15f5d6,'totalMusic':_0x313593,'todayVideo':0x0,'totalVideo':0x0};}async[_0x4ddcc1(0x149)](_0x452189){const _0x8415d5=_0x4ddcc1,_0x26ab1a={};_0x452189!==undefined&&(_0x26ab1a[_0x8415d5(0x184)]=_0x452189);const _0x3f3cde=await this['userEntity'][_0x8415d5(0x141)]({'where':_0x26ab1a});return _0x3f3cde;}async[_0x4ddcc1(0x183)](_0x54251f){const _0x10f146=_0x4ddcc1,_0x22b9c3=(0x0,date_1[_0x10f146(0x18e)])()[_0x10f146(0x1a5)]('d')['toDate'](),_0x340b6e=(0x0,date_1[_0x10f146(0x18e)])()['endOf']('d')[_0x10f146(0x171)](),_0x3a1471={'createdAt':(0x0,typeorm_2[_0x10f146(0x163)])(_0x22b9c3,_0x340b6e)};_0x54251f!==undefined&&(_0x3a1471[_0x10f146(0x184)]=_0x54251f);const _0x5d88c2=await this['userEntity'][_0x10f146(0x141)]({'where':_0x3a1471});return _0x5d88c2;}async[_0x4ddcc1(0x1a0)](_0x1ce265){const _0x3b76c7=_0x4ddcc1,_0x178fe0={'type':balance_constant_1['DeductionKey'][_0x3b76c7(0x188)]};_0x1ce265!==undefined&&(_0x178fe0[_0x3b76c7(0x184)]=_0x1ce265);const _0x2029cf=await this[_0x3b76c7(0x17c)][_0x3b76c7(0x141)]({'where':_0x178fe0});return _0x2029cf;}async[_0x4ddcc1(0x13a)](_0x2cccc6){const _0x433e7a=_0x4ddcc1,_0x421e37=(0x0,date_1['default'])()[_0x433e7a(0x1a5)]('d')[_0x433e7a(0x171)](),_0x4d0739=(0x0,date_1['default'])()[_0x433e7a(0x131)]('d')['toDate'](),_0x239e08={'type':balance_constant_1[_0x433e7a(0x16e)][_0x433e7a(0x188)],'createdAt':(0x0,typeorm_2['Between'])(_0x421e37,_0x4d0739)};_0x2cccc6!==undefined&&(_0x239e08['saasId']=_0x2cccc6);const _0x3cd671=await this[_0x433e7a(0x17c)][_0x433e7a(0x141)]({'where':_0x239e08});return _0x3cd671;}async['countDraws'](_0x227e09){const _0x143eb5=_0x4ddcc1,_0x5205f6={'type':balance_constant_1[_0x143eb5(0x16e)][_0x143eb5(0x151)]};_0x227e09!==undefined&&(_0x5205f6[_0x143eb5(0x184)]=_0x227e09);const _0x2e057b=await this[_0x143eb5(0x17c)][_0x143eb5(0x141)]({'where':_0x5205f6});return _0x2e057b;}async[_0x4ddcc1(0x130)](_0x304740){const _0xe423e0=_0x4ddcc1,_0x4ea8c0=(0x0,date_1['default'])()['startOf']('d')[_0xe423e0(0x171)](),_0x9691d5=(0x0,date_1[_0xe423e0(0x18e)])()[_0xe423e0(0x131)]('d')[_0xe423e0(0x171)](),_0x222386={'type':balance_constant_1[_0xe423e0(0x16e)][_0xe423e0(0x151)],'createdAt':(0x0,typeorm_2[_0xe423e0(0x163)])(_0x4ea8c0,_0x9691d5)};_0x304740!==undefined&&(_0x222386[_0xe423e0(0x184)]=_0x304740);const _0x4f7b8e=await this[_0xe423e0(0x17c)][_0xe423e0(0x141)]({'where':_0x222386});return _0x4f7b8e;}async[_0x4ddcc1(0x150)](_0xf3320d){const _0x4eab79=_0x4ddcc1,_0x23f70f=(0x0,date_1[_0x4eab79(0x18e)])()[_0x4eab79(0x1a5)]('d')['toDate'](),_0x4beee9=(0x0,date_1[_0x4eab79(0x18e)])()['endOf']('d')[_0x4eab79(0x171)](),_0xda42e2={'createdAt':(0x0,typeorm_2[_0x4eab79(0x163)])(_0x23f70f,_0x4beee9)};_0xf3320d!==undefined&&(_0xda42e2[_0x4eab79(0x184)]=_0xf3320d);const _0x2509ca=await this[_0x4eab79(0x155)][_0x4eab79(0x141)]({'where':_0xda42e2});return _0x2509ca;}async[_0x4ddcc1(0x19f)](_0x2c02c8){const _0x53623f=_0x4ddcc1,_0x1fa901={};_0x2c02c8!==undefined&&(_0x1fa901[_0x53623f(0x184)]=_0x2c02c8);const _0x1437fc=await this['orderEntity']['count']({'where':_0x1fa901});return _0x1437fc;}async['countNewOrdersToday'](_0x75b2d6){const _0xaae985=_0x4ddcc1,_0x3eddd1=(0x0,date_1[_0xaae985(0x18e)])()[_0xaae985(0x1a5)]('d')['toDate'](),_0x3f50ea=(0x0,date_1[_0xaae985(0x18e)])()[_0xaae985(0x131)]('d')[_0xaae985(0x171)](),_0x12405a={'createdAt':(0x0,typeorm_2[_0xaae985(0x163)])(_0x3eddd1,_0x3f50ea)};_0x75b2d6!==undefined&&(_0x12405a[_0xaae985(0x184)]=_0x75b2d6);const _0x571f56=await this[_0xaae985(0x165)][_0xaae985(0x141)]({'where':_0x12405a});return _0x571f56;}async['countTodayMusic'](_0x300656){const _0x4603bb=_0x4ddcc1,_0x36a4b2=(0x0,date_1['default'])()[_0x4603bb(0x1a5)]('d')[_0x4603bb(0x171)](),_0x54796d=(0x0,date_1['default'])()[_0x4603bb(0x131)]('d')['toDate'](),_0x43c304={'answer':(0x0,typeorm_2[_0x4603bb(0x1a3)])((0x0,typeorm_2[_0x4603bb(0x199)])()),'modelType':model_constant_1['EModelType'][_0x4603bb(0x190)],'createdAt':(0x0,typeorm_2[_0x4603bb(0x163)])(_0x36a4b2,_0x54796d)};_0x300656!==undefined&&(_0x43c304[_0x4603bb(0x184)]=_0x300656);const _0x5da628=await this[_0x4603bb(0x17c)]['count']({'where':_0x43c304});return _0x5da628;}async[_0x4ddcc1(0x17b)](_0x2537da){const _0x521c52=_0x4ddcc1,_0xc40832={'answer':(0x0,typeorm_2[_0x521c52(0x1a3)])((0x0,typeorm_2[_0x521c52(0x199)])()),'modelType':model_constant_1[_0x521c52(0x159)][_0x521c52(0x190)]};_0x2537da!==undefined&&(_0xc40832[_0x521c52(0x184)]=_0x2537da);const _0x1c0b91=await this[_0x521c52(0x17c)]['count']({'where':_0xc40832});return _0x1c0b91;}async['countTodayCollection'](_0x35ffea){const _0x246959=_0x4ddcc1,_0x54eebb=(0x0,date_1['default'])()[_0x246959(0x1a5)]('d')[_0x246959(0x171)](),_0x43f035=(0x0,date_1['default'])()[_0x246959(0x131)]('d')[_0x246959(0x171)](),_0x33b0a9={'status':0x1,'updatedAt':(0x0,typeorm_2['Between'])(_0x54eebb,_0x43f035)};_0x35ffea!==undefined&&(_0x33b0a9['saasId']=_0x35ffea);const _0x679827=await this[_0x246959(0x165)][_0x246959(0x17d)](_0x246959(0x181),_0x33b0a9)||0x0;return _0x679827['toFixed'](0x2);}async['countTotalCollection'](_0xd23f6d){const _0x246ee4=_0x4ddcc1,_0x1b6189={'status':0x1};_0xd23f6d!==undefined&&(_0x1b6189[_0x246ee4(0x184)]=_0xd23f6d);const _0x6ba37d=await this['orderEntity'][_0x246ee4(0x17d)](_0x246ee4(0x181),_0x1b6189)||0x0;return _0x6ba37d[_0x246ee4(0x18c)](0x2);}async[_0x4ddcc1(0x174)]({days:days=0x7,saasId:_0x3788c7}){const _0x4285c7=_0x4ddcc1,_0x861ed2=(0x0,utils_1[_0x4285c7(0x133)])(this[_0x4285c7(0x153)]);_0x861ed2!==0x0&&(_0x3788c7=_0x861ed2);const _0x48031a=await this[_0x4285c7(0x164)](days,_0x3788c7),_0x4a7356=await this[_0x4285c7(0x16a)](days,_0x3788c7),_0x40633e=await this['countMjDrawsByTimeRange'](days,_0x3788c7);return{'date':_0x48031a[_0x4285c7(0x14b)](_0x2bbb43=>_0x2bbb43[_0x4285c7(0x14d)]),'chat':_0x48031a[_0x4285c7(0x14b)](_0xacc44e=>_0xacc44e[_0x4285c7(0x197)]),'draw':_0x4a7356[_0x4285c7(0x14b)]((_0x7c1920,_0x155d70)=>{const _0x1853ec=_0x4285c7;return _0x7c1920['value']+_0x40633e[_0x155d70][_0x1853ec(0x197)];})};}async[_0x4ddcc1(0x164)](_0x5d5b72,_0xa0622a){const _0x47b7f4=_0x4ddcc1,_0x313054=(0x0,date_1[_0x47b7f4(0x18e)])()['subtract'](_0x5d5b72,'d')[_0x47b7f4(0x1a5)]('d')[_0x47b7f4(0x171)](),_0x1aa84c=this[_0x47b7f4(0x17c)]['createQueryBuilder'](_0x47b7f4(0x15a))[_0x47b7f4(0x176)]('DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')['where'](_0x47b7f4(0x196),{'type':balance_constant_1[_0x47b7f4(0x16e)]['CHAT_TYPE']})[_0x47b7f4(0x16c)](_0x47b7f4(0x180),{'startDate':_0x313054});_0xa0622a!==undefined&&_0x1aa84c[_0x47b7f4(0x16c)](_0x47b7f4(0x15f),{'saasId':_0xa0622a});_0x1aa84c[_0x47b7f4(0x13f)]('date')[_0x47b7f4(0x12e)](_0x47b7f4(0x14d));const _0x141ff3=await _0x1aa84c[_0x47b7f4(0x12b)](),_0x4e8e24=[],_0x195c0d=_0x313054;for(let _0x1613d4=0x0;_0x1613d4<_0x5d5b72;_0x1613d4++){const _0x43c8f7=(0x0,date_1[_0x47b7f4(0x13b)])(new Date(_0x195c0d),_0x47b7f4(0x16d)),_0x5cd134=_0x141ff3[_0x47b7f4(0x152)](_0xf9b2db=>(0x0,date_1[_0x47b7f4(0x13b)])(new Date(_0xf9b2db['date']),_0x47b7f4(0x16d))===_0x43c8f7)?.[_0x47b7f4(0x141)]??0x0;_0x5cd134>0x0?_0x4e8e24['push']({'date':_0x43c8f7,'value':Number(_0x5cd134)}):_0x4e8e24[_0x47b7f4(0x16b)]({'date':_0x43c8f7,'value':0x0}),_0x195c0d[_0x47b7f4(0x14e)](_0x195c0d[_0x47b7f4(0x1a2)]()+0x1);}return _0x4e8e24;}async[_0x4ddcc1(0x16a)](_0x18ea9c,_0x322ef7){const _0x29835c=_0x4ddcc1,_0x23c687=(0x0,date_1['default'])()[_0x29835c(0x191)](_0x18ea9c,'d')[_0x29835c(0x1a5)]('d')['toDate'](),_0x1312a5=this['chatLogEntity'][_0x29835c(0x193)]('chatlog')[_0x29835c(0x176)](_0x29835c(0x192))[_0x29835c(0x147)](_0x29835c(0x196),{'type':balance_constant_1['DeductionKey'][_0x29835c(0x151)]})[_0x29835c(0x16c)](_0x29835c(0x180),{'startDate':_0x23c687});_0x322ef7!==undefined&&_0x1312a5[_0x29835c(0x16c)](_0x29835c(0x15f),{'saasId':_0x322ef7});_0x1312a5['groupBy'](_0x29835c(0x14d))[_0x29835c(0x12e)](_0x29835c(0x14d));const _0x164af1=await _0x1312a5[_0x29835c(0x12b)](),_0x1a43bc=[],_0x326b53=_0x23c687;for(let _0x589aa7=0x0;_0x589aa7<_0x18ea9c;_0x589aa7++){const _0x57397f=(0x0,date_1[_0x29835c(0x13b)])(new Date(_0x326b53),_0x29835c(0x16d)),_0xf81a1b=_0x164af1['find'](_0x8366f2=>(0x0,date_1[_0x29835c(0x13b)])(new Date(_0x8366f2[_0x29835c(0x14d)]),'M.DD')===_0x57397f)?.[_0x29835c(0x141)]??0x0;_0xf81a1b>0x0?_0x1a43bc[_0x29835c(0x16b)]({'date':_0x57397f,'value':Number(_0xf81a1b)}):_0x1a43bc['push']({'date':_0x57397f,'value':0x0}),_0x326b53['setDate'](_0x326b53[_0x29835c(0x1a2)]()+0x1);}return _0x1a43bc;}async[_0x4ddcc1(0x140)](_0x2eec76,_0x25baa1){const _0x40859b=_0x4ddcc1,_0x480f99=(0x0,date_1['default'])()[_0x40859b(0x191)](_0x2eec76,'d')[_0x40859b(0x1a5)]('d')['toDate'](),_0x48a78d=this[_0x40859b(0x155)]['createQueryBuilder'](_0x40859b(0x19e))[_0x40859b(0x176)]('DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')['where'](_0x40859b(0x162),{'status':midjourney_constant_1['MidjourneyStatusEnum'][_0x40859b(0x135)]})[_0x40859b(0x16c)](_0x40859b(0x13e),{'startDate':_0x480f99});_0x25baa1!==undefined&&_0x48a78d['andWhere'](_0x40859b(0x15e),{'saasId':_0x25baa1});_0x48a78d[_0x40859b(0x13f)](_0x40859b(0x14d))[_0x40859b(0x12e)](_0x40859b(0x14d));const _0x19a74a=await _0x48a78d['getRawMany'](),_0x3d63b3=[],_0xaa8961=_0x480f99;for(let _0x35a608=0x0;_0x35a608<_0x2eec76;_0x35a608++){const _0x553268=(0x0,date_1[_0x40859b(0x13b)])(new Date(_0xaa8961),_0x40859b(0x16d)),_0x9906f1=_0x19a74a[_0x40859b(0x152)](_0x106e32=>(0x0,date_1['formatDate'])(new Date(_0x106e32[_0x40859b(0x14d)]),'M.DD')===_0x553268)?.[_0x40859b(0x141)]??0x0;_0x9906f1>0x0?_0x3d63b3[_0x40859b(0x16b)]({'date':_0x553268,'value':Number(_0x9906f1)}):_0x3d63b3[_0x40859b(0x16b)]({'date':_0x553268,'value':0x0}),_0xaa8961[_0x40859b(0x14e)](_0xaa8961[_0x40859b(0x1a2)]()+0x1);}return _0x3d63b3;}async[_0x4ddcc1(0x12a)](_0x2b4b31){const _0x2388e7=_0x4ddcc1,_0x2525f2=(0x0,date_1[_0x2388e7(0x13b)])(new Date(),_0x2388e7(0x15c)),_0x89a79d=(0x0,date_1[_0x2388e7(0x13b)])(new Date(Date['now']()-Number(_0x2b4b31-0x1)*0x18*0x3c*0x3c*0x3e8),_0x2388e7(0x15c)),_0x3e2763=_0x2388e7(0x154),_0x4187c5='overview/getTimeTrendRpt',_0xdaf8fa=await this[_0x2388e7(0x19b)][_0x2388e7(0x129)]([_0x2388e7(0x185),'baiduSiteId']),_0x388bf7=_0xdaf8fa[_0x2388e7(0x178)],_0x219e5f=_0xdaf8fa['baiduToken'];if(!_0x388bf7||!_0x219e5f)return[];if(!_0x388bf7)throw new common_1[(_0x2388e7(0x19c))](_0x2388e7(0x15d),common_1[_0x2388e7(0x18b)][_0x2388e7(0x18d)]);if(!_0x219e5f)throw new common_1[(_0x2388e7(0x19c))]('请先配置百度统计accessToken',common_1[_0x2388e7(0x18b)][_0x2388e7(0x18d)]);const _0x991a1=_0x2388e7(0x1a4)+_0x219e5f+'&site_id='+_0x388bf7+_0x2388e7(0x1a1)+_0x4187c5+'&start_date='+_0x89a79d+_0x2388e7(0x148)+_0x2525f2+'&metrics='+_0x3e2763,_0x2f3188=await axios_1[_0x2388e7(0x18e)][_0x2388e7(0x142)](_0x991a1),{error_code:_0x4bcd81,message:_0x4e44b6}=_0x2f3188[_0x2388e7(0x17a)];if(_0x4bcd81===0x6f)throw new common_1[(_0x2388e7(0x19c))](_0x4e44b6||_0x2388e7(0x198),common_1[_0x2388e7(0x18b)][_0x2388e7(0x18d)]);if(_0x4bcd81&&_0x4bcd81!==0xc8)throw new common_1[(_0x2388e7(0x19c))](_0x4e44b6||'获取百度统计数据失败',common_1['HttpStatus'][_0x2388e7(0x18d)]);return _0x2f3188[_0x2388e7(0x17a)][_0x2388e7(0x186)];}async[_0x4ddcc1(0x127)](_0x1ace09){const _0x2d4002=_0x4ddcc1,_0x2a94ab=await this[_0x2d4002(0x1a6)]['query']('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27'+_0x1ace09[_0x2d4002(0x14f)]+_0x2d4002(0x18f)+_0x1ace09[_0x2d4002(0x169)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20'),_0x3b0542=(0x0,date_1[_0x2d4002(0x18e)])(_0x1ace09[_0x2d4002(0x14f)])[_0x2d4002(0x182)]((0x0,date_1[_0x2d4002(0x18e)])(_0x1ace09[_0x2d4002(0x169)]),_0x2d4002(0x189)),_0x489aed=_0x3b0542===0x0?_0x2d4002(0x12d):_0x2d4002(0x160),_0x199fd7=await this[_0x2d4002(0x1a6)][_0x2d4002(0x126)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27'+_0x489aed+_0x2d4002(0x17e)+_0x1ace09[_0x2d4002(0x14f)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27'+_0x1ace09['endTime']+_0x2d4002(0x125));return{'pie':_0x2a94ab,'line':_0x199fd7};}};StatisticService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x4ddcc1(0x134)])(user_entity_1[_0x4ddcc1(0x18a)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(chatLog_entity_1['ChatLogEntity'])),__param(0x2,(0x0,typeorm_1[_0x4ddcc1(0x134)])(order_entity_1[_0x4ddcc1(0x13c)])),__param(0x3,(0x0,typeorm_1[_0x4ddcc1(0x134)])(midjourney_entity_1['MidjourneyEntity'])),__metadata('design:paramtypes',[typeorm_2[_0x4ddcc1(0x179)],typeorm_2[_0x4ddcc1(0x179)],typeorm_2['Repository'],typeorm_2[_0x4ddcc1(0x179)],globalConfig_service_1['GlobalConfigService'],nestjs_cls_1[_0x4ddcc1(0x146)],typeorm_2['Connection']])],StatisticService),exports[_0x4ddcc1(0x12f)]=StatisticService;