'use strict';const _0x272a1f=_0x1222;(function(_0x11bad9,_0x43c7ff){const _0x9f3670=_0x1222,_0x1e7dde=_0x11bad9();while(!![]){try{const _0x37e495=parseInt(_0x9f3670(0x15e))/0x1*(parseInt(_0x9f3670(0x13b))/0x2)+parseInt(_0x9f3670(0x13a))/0x3+parseInt(_0x9f3670(0x14d))/0x4+parseInt(_0x9f3670(0x16a))/0x5+parseInt(_0x9f3670(0x136))/0x6+parseInt(_0x9f3670(0x199))/0x7+-parseInt(_0x9f3670(0x1a5))/0x8;if(_0x37e495===_0x43c7ff)break;else _0x1e7dde['push'](_0x1e7dde['shift']());}catch(_0x35d513){_0x1e7dde['push'](_0x1e7dde['shift']());}}}(_0x5d62,0x685a6));function _0x5d62(){const _0x2c2e14=['EModelType','countNewUsersToday','getChatStatistic','select','countNewDrawsToday','请先配置百度统计siteId','map','../midjourney/midjourney.entity','chatlog.createdAt\x20>=\x20:startDate','YYYYMMDD','getReqSaasId','countDrawsByTimeRange','defineProperty','subtract','countInviteUsersTotal','getDate','InjectRepository','DRAWED','getRawMany','midjourney','default','endTime','countNewOrdersToday','baiduToken','countTotalCollection','price','&start_date=','&end_date=','midjourneyEntity','BAD_REQUEST','GlobalConfigService','toFixed','chatlog','push','object','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20','countTodayMusic','2497579hUiZJZ','DeductionKey','ClsService','ChatLogEntity','userEntity','Repository','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','IsNull','data','countChats','__metadata','MidjourneyStatusEnum','22524312MJLjYb','__decorate','../../common/constants/balance.constant','../../common/utils/date','endOf','startOf','date','clsService','UserEntity','StatisticService','countTodayCollection','&metrics=','function','globalConfigService','orderEntity','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','countOrders','where','getBaseStatistic','formatDate','axios','HttpStatus','startTime','@nestjs/common','4663404AwFOPY','countNewMidhourneysToday','&method=','sum','614547DfDKgw','79358EzeADl','groupBy','getOwnPropertyDescriptor','design:paramtypes','../order/order.entity','getBaiduStatistics','百度授权码过期','MUSIC','connection','query','decorate','countInviteUsersToday','length','orderBy','HttpException','M.DD','Not','midjourney.saasId\x20=\x20:saasId','2812440TYBaqd','../globalConfig/globalConfig.service','countChatsByTimeRange','countTotalMusic','__param','countDraws','count','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','value','PAINT_TYPE','chatlog.type\x20=\x20:type','../../common/utils','saasId','setDate','Injectable','countUsers','find','9FFEzdi','Between','metadata','%Y-%m-%d\x20%H:00','andWhere','countNewChatsToday','countMjDrawsByTimeRange','CHAT_TYPE','overview/getTimeTrendRpt','chatLogEntity','get','toDate','4219340SWJDJu','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','baiduSiteId','../../common/constants/midjourney.constant','chatlog.saasId\x20=\x20:saasId','day','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','__esModule','createQueryBuilder','midjourney.status\x20=\x20:status'];_0x5d62=function(){return _0x2c2e14;};return _0x5d62();}var __decorate=this&&this[_0x272a1f(0x1a6)]||function(_0x2e9553,_0x333fa3,_0x20c0b,_0x14a615){const _0xa2caa0=_0x272a1f;var _0xd31881=arguments[_0xa2caa0(0x147)],_0x3d697f=_0xd31881<0x3?_0x333fa3:_0x14a615===null?_0x14a615=Object[_0xa2caa0(0x13d)](_0x333fa3,_0x20c0b):_0x14a615,_0x252ecd;if(typeof Reflect===_0xa2caa0(0x196)&&typeof Reflect[_0xa2caa0(0x145)]===_0xa2caa0(0x12a))_0x3d697f=Reflect['decorate'](_0x2e9553,_0x333fa3,_0x20c0b,_0x14a615);else{for(var _0x568c7e=_0x2e9553[_0xa2caa0(0x147)]-0x1;_0x568c7e>=0x0;_0x568c7e--)if(_0x252ecd=_0x2e9553[_0x568c7e])_0x3d697f=(_0xd31881<0x3?_0x252ecd(_0x3d697f):_0xd31881>0x3?_0x252ecd(_0x333fa3,_0x20c0b,_0x3d697f):_0x252ecd(_0x333fa3,_0x20c0b))||_0x3d697f;}return _0xd31881>0x3&&_0x3d697f&&Object['defineProperty'](_0x333fa3,_0x20c0b,_0x3d697f),_0x3d697f;},__metadata=this&&this[_0x272a1f(0x1a3)]||function(_0x3cc84b,_0x1fc984){const _0x2c71da=_0x272a1f;if(typeof Reflect===_0x2c71da(0x196)&&typeof Reflect[_0x2c71da(0x160)]===_0x2c71da(0x12a))return Reflect[_0x2c71da(0x160)](_0x3cc84b,_0x1fc984);},__param=this&&this[_0x272a1f(0x151)]||function(_0x1e27e4,_0x5228ff){return function(_0x101900,_0x234db8){_0x5228ff(_0x101900,_0x234db8,_0x1e27e4);};};function _0x1222(_0x15833b,_0x54b78e){const _0x5d6288=_0x5d62();return _0x1222=function(_0x1222aa,_0x51c493){_0x1222aa=_0x1222aa-0x124;let _0x5907f1=_0x5d6288[_0x1222aa];return _0x5907f1;},_0x1222(_0x15833b,_0x54b78e);}Object[_0x272a1f(0x180)](exports,_0x272a1f(0x171),{'value':!![]}),exports[_0x272a1f(0x127)]=void 0x0;const common_1=require(_0x272a1f(0x135)),typeorm_1=require('@nestjs/typeorm'),user_entity_1=require('../user/user.entity'),typeorm_2=require('typeorm'),chatLog_entity_1=require('../chatLog/entity/chatLog.entity'),balance_constant_1=require(_0x272a1f(0x1a7)),date_1=require(_0x272a1f(0x1a8)),axios_1=require(_0x272a1f(0x132)),order_entity_1=require(_0x272a1f(0x13f)),midjourney_entity_1=require(_0x272a1f(0x17b)),midjourney_constant_1=require(_0x272a1f(0x16d)),model_constant_1=require('../../common/constants/model.constant'),globalConfig_service_1=require(_0x272a1f(0x14e)),nestjs_cls_1=require('nestjs-cls'),utils_1=require(_0x272a1f(0x158));let StatisticService=class StatisticService{constructor(_0x25fe02,_0x1fa859,_0x4f4880,_0x21c496,_0x296471,_0x3e8f21,_0x201d8c){const _0x440c26=_0x272a1f;this['userEntity']=_0x25fe02,this['chatLogEntity']=_0x1fa859,this[_0x440c26(0x12c)]=_0x4f4880,this[_0x440c26(0x190)]=_0x21c496,this[_0x440c26(0x12b)]=_0x296471,this[_0x440c26(0x125)]=_0x3e8f21,this['connection']=_0x201d8c;}async[_0x272a1f(0x130)](_0x31ea6f){const _0x403565=_0x272a1f,_0x1bebee=(0x0,utils_1['getReqSaasId'])(this[_0x403565(0x125)]);_0x1bebee!==0x0&&(_0x31ea6f=_0x1bebee);const _0x408d9d=await this[_0x403565(0x15c)](_0x31ea6f),_0x109dea=await this[_0x403565(0x175)](_0x31ea6f),_0x44e59c=await this[_0x403565(0x1a2)](_0x31ea6f),_0x13ba15=await this['countNewChatsToday'](_0x31ea6f),_0x2d82c7=await this[_0x403565(0x152)](_0x31ea6f),_0x2ef775=await this[_0x403565(0x178)](_0x31ea6f),_0x592c24=await this[_0x403565(0x137)](_0x31ea6f),_0x3b958f=await this[_0x403565(0x12e)](_0x31ea6f),_0x2b95f0=await this[_0x403565(0x18a)](_0x31ea6f),_0xb945e3=await this[_0x403565(0x128)](_0x31ea6f),_0x211be3=await this[_0x403565(0x18c)](_0x31ea6f),_0x572ae0=await this[_0x403565(0x198)](_0x31ea6f),_0x150e8f=await this[_0x403565(0x150)](_0x31ea6f),_0xbd7fc=await this['countInviteUsersToday'](_0x31ea6f),_0x320983=await this[_0x403565(0x182)](_0x31ea6f);return{'userCount':_0x408d9d,'newUserCount':_0x109dea,'chatCount':_0x44e59c,'newChatCount':_0x13ba15,'drawCount':_0x2d82c7,'newDrawCount':_0x592c24+_0x2ef775,'orderCount':_0x3b958f,'newOrderCount':_0x2b95f0,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0xb945e3,'totalCollection':_0x211be3,'todayMusic':_0x572ae0,'totalMusic':_0x150e8f,'todayVideo':0x0,'totalVideo':0x0,'todayInviteCount':_0xbd7fc,'totalInviteCount':_0x320983};}async[_0x272a1f(0x15c)](_0x5c345b){const _0x49ff15=_0x272a1f,_0x177a42={};_0x5c345b!==undefined&&(_0x177a42['saasId']=_0x5c345b);const _0x2a9684=await this[_0x49ff15(0x19d)][_0x49ff15(0x153)]({'where':_0x177a42});return _0x2a9684;}async[_0x272a1f(0x182)](_0x19c66a){const _0x15775a=_0x272a1f,_0x387a8f={'inviteCode':(0x0,typeorm_2[_0x15775a(0x14b)])('')};_0x19c66a!==undefined&&(_0x387a8f['saasId']=_0x19c66a);const _0x2327f6=await this['userEntity'][_0x15775a(0x153)]({'where':_0x387a8f});return _0x2327f6;}async[_0x272a1f(0x146)](_0xa27725){const _0x97fef9=_0x272a1f,_0x345e82=(0x0,date_1[_0x97fef9(0x188)])()[_0x97fef9(0x1aa)]('d')[_0x97fef9(0x169)](),_0x181a8a=(0x0,date_1['default'])()[_0x97fef9(0x1a9)]('d')[_0x97fef9(0x169)](),_0x59939e={'createdAt':(0x0,typeorm_2[_0x97fef9(0x15f)])(_0x345e82,_0x181a8a),'inviteCode':(0x0,typeorm_2[_0x97fef9(0x14b)])('')};_0xa27725!==undefined&&(_0x59939e[_0x97fef9(0x159)]=_0xa27725);const _0x4dc9bf=await this[_0x97fef9(0x19d)][_0x97fef9(0x153)]({'where':_0x59939e});return _0x4dc9bf;}async[_0x272a1f(0x175)](_0x47d752){const _0x27eaf6=_0x272a1f,_0x353718=(0x0,date_1[_0x27eaf6(0x188)])()['startOf']('d')[_0x27eaf6(0x169)](),_0xfd5135=(0x0,date_1['default'])()[_0x27eaf6(0x1a9)]('d')[_0x27eaf6(0x169)](),_0x2f9e59={'createdAt':(0x0,typeorm_2[_0x27eaf6(0x15f)])(_0x353718,_0xfd5135)};_0x47d752!==undefined&&(_0x2f9e59[_0x27eaf6(0x159)]=_0x47d752);const _0x525383=await this[_0x27eaf6(0x19d)][_0x27eaf6(0x153)]({'where':_0x2f9e59});return _0x525383;}async[_0x272a1f(0x1a2)](_0x542b77){const _0x2b1907=_0x272a1f,_0x35d14e={'type':balance_constant_1['DeductionKey'][_0x2b1907(0x165)]};_0x542b77!==undefined&&(_0x35d14e[_0x2b1907(0x159)]=_0x542b77);const _0x17c1ef=await this['chatLogEntity'][_0x2b1907(0x153)]({'where':_0x35d14e});return _0x17c1ef;}async[_0x272a1f(0x163)](_0x433b04){const _0x46c5ff=_0x272a1f,_0x340019=(0x0,date_1[_0x46c5ff(0x188)])()['startOf']('d')['toDate'](),_0x34115b=(0x0,date_1['default'])()[_0x46c5ff(0x1a9)]('d')[_0x46c5ff(0x169)](),_0x42393b={'type':balance_constant_1[_0x46c5ff(0x19a)][_0x46c5ff(0x165)],'createdAt':(0x0,typeorm_2[_0x46c5ff(0x15f)])(_0x340019,_0x34115b)};_0x433b04!==undefined&&(_0x42393b[_0x46c5ff(0x159)]=_0x433b04);const _0x24386b=await this[_0x46c5ff(0x167)][_0x46c5ff(0x153)]({'where':_0x42393b});return _0x24386b;}async['countDraws'](_0x18c773){const _0x4aa6b3=_0x272a1f,_0x36c9c9={'type':balance_constant_1['DeductionKey'][_0x4aa6b3(0x156)]};_0x18c773!==undefined&&(_0x36c9c9[_0x4aa6b3(0x159)]=_0x18c773);const _0x31fbfb=await this[_0x4aa6b3(0x167)]['count']({'where':_0x36c9c9});return _0x31fbfb;}async['countNewDrawsToday'](_0x5bc462){const _0x3ae841=_0x272a1f,_0x54fc23=(0x0,date_1[_0x3ae841(0x188)])()[_0x3ae841(0x1aa)]('d')['toDate'](),_0x277a9d=(0x0,date_1[_0x3ae841(0x188)])()[_0x3ae841(0x1a9)]('d')[_0x3ae841(0x169)](),_0x4c6450={'type':balance_constant_1[_0x3ae841(0x19a)][_0x3ae841(0x156)],'createdAt':(0x0,typeorm_2[_0x3ae841(0x15f)])(_0x54fc23,_0x277a9d)};_0x5bc462!==undefined&&(_0x4c6450['saasId']=_0x5bc462);const _0x1a1bbe=await this[_0x3ae841(0x167)]['count']({'where':_0x4c6450});return _0x1a1bbe;}async[_0x272a1f(0x137)](_0x39232f){const _0x10b94b=_0x272a1f,_0x87b7ab=(0x0,date_1['default'])()[_0x10b94b(0x1aa)]('d')[_0x10b94b(0x169)](),_0x2bf7ee=(0x0,date_1[_0x10b94b(0x188)])()[_0x10b94b(0x1a9)]('d')[_0x10b94b(0x169)](),_0xa305e={'createdAt':(0x0,typeorm_2[_0x10b94b(0x15f)])(_0x87b7ab,_0x2bf7ee)};_0x39232f!==undefined&&(_0xa305e['saasId']=_0x39232f);const _0x7fe9dd=await this[_0x10b94b(0x190)][_0x10b94b(0x153)]({'where':_0xa305e});return _0x7fe9dd;}async['countOrders'](_0x1bbf76){const _0x8c83b9=_0x272a1f,_0x101c88={};_0x1bbf76!==undefined&&(_0x101c88[_0x8c83b9(0x159)]=_0x1bbf76);const _0x2a4169=await this[_0x8c83b9(0x12c)][_0x8c83b9(0x153)]({'where':_0x101c88});return _0x2a4169;}async[_0x272a1f(0x18a)](_0x5ee92c){const _0x2c53ea=_0x272a1f,_0x3e16ae=(0x0,date_1['default'])()[_0x2c53ea(0x1aa)]('d')[_0x2c53ea(0x169)](),_0x4622c6=(0x0,date_1['default'])()[_0x2c53ea(0x1a9)]('d')[_0x2c53ea(0x169)](),_0x52fe0a={'createdAt':(0x0,typeorm_2['Between'])(_0x3e16ae,_0x4622c6),'status':0x1};_0x5ee92c!==undefined&&(_0x52fe0a[_0x2c53ea(0x159)]=_0x5ee92c);const _0x2d8bbb=await this['orderEntity'][_0x2c53ea(0x153)]({'where':_0x52fe0a});return _0x2d8bbb;}async[_0x272a1f(0x198)](_0x20a879){const _0x282ae7=_0x272a1f,_0x39e3cc=(0x0,date_1[_0x282ae7(0x188)])()['startOf']('d')[_0x282ae7(0x169)](),_0x36a49e=(0x0,date_1[_0x282ae7(0x188)])()[_0x282ae7(0x1a9)]('d')[_0x282ae7(0x169)](),_0x26f331={'answer':(0x0,typeorm_2[_0x282ae7(0x14b)])((0x0,typeorm_2[_0x282ae7(0x1a0)])()),'modelType':model_constant_1[_0x282ae7(0x174)]['MUSIC'],'createdAt':(0x0,typeorm_2[_0x282ae7(0x15f)])(_0x39e3cc,_0x36a49e)};_0x20a879!==undefined&&(_0x26f331['saasId']=_0x20a879);const _0x3943f9=await this[_0x282ae7(0x167)][_0x282ae7(0x153)]({'where':_0x26f331});return _0x3943f9;}async[_0x272a1f(0x150)](_0x2a1697){const _0x2280a0=_0x272a1f,_0x54db93={'answer':(0x0,typeorm_2[_0x2280a0(0x14b)])((0x0,typeorm_2[_0x2280a0(0x1a0)])()),'modelType':model_constant_1[_0x2280a0(0x174)][_0x2280a0(0x142)]};_0x2a1697!==undefined&&(_0x54db93['saasId']=_0x2a1697);const _0x430716=await this[_0x2280a0(0x167)][_0x2280a0(0x153)]({'where':_0x54db93});return _0x430716;}async[_0x272a1f(0x128)](_0x53dac4){const _0x1bd358=_0x272a1f,_0x47e57e=(0x0,date_1[_0x1bd358(0x188)])()[_0x1bd358(0x1aa)]('d')[_0x1bd358(0x169)](),_0x106048=(0x0,date_1[_0x1bd358(0x188)])()[_0x1bd358(0x1a9)]('d')[_0x1bd358(0x169)](),_0x28ae3d={'status':0x1,'updatedAt':(0x0,typeorm_2[_0x1bd358(0x15f)])(_0x47e57e,_0x106048)};_0x53dac4!==undefined&&(_0x28ae3d[_0x1bd358(0x159)]=_0x53dac4);const _0x2c95a8=await this['orderEntity'][_0x1bd358(0x139)]('price',_0x28ae3d)||0x0;return _0x2c95a8[_0x1bd358(0x193)](0x2);}async[_0x272a1f(0x18c)](_0xf0de18){const _0x4147e3=_0x272a1f,_0xcb8b55={'status':0x1};_0xf0de18!==undefined&&(_0xcb8b55[_0x4147e3(0x159)]=_0xf0de18);const _0x5de444=await this[_0x4147e3(0x12c)][_0x4147e3(0x139)](_0x4147e3(0x18d),_0xcb8b55)||0x0;return _0x5de444['toFixed'](0x2);}async[_0x272a1f(0x176)]({days:days=0x7,saasId:_0x122f9e}){const _0x4588fe=_0x272a1f,_0x3df5fc=(0x0,utils_1[_0x4588fe(0x17e)])(this[_0x4588fe(0x125)]);_0x3df5fc!==0x0&&(_0x122f9e=_0x3df5fc);const _0x59306d=await this[_0x4588fe(0x14f)](days,_0x122f9e),_0x476f6c=await this['countDrawsByTimeRange'](days,_0x122f9e),_0xc0f04a=await this[_0x4588fe(0x164)](days,_0x122f9e);return{'date':_0x59306d['map'](_0x3efac3=>_0x3efac3['date']),'chat':_0x59306d[_0x4588fe(0x17a)](_0x51b863=>_0x51b863[_0x4588fe(0x155)]),'draw':_0x476f6c['map']((_0x445d36,_0x3576c7)=>{const _0x413108=_0x4588fe;return _0x445d36[_0x413108(0x155)]+_0xc0f04a[_0x3576c7][_0x413108(0x155)];})};}async['countChatsByTimeRange'](_0x24c586,_0x1020a3){const _0x4a3c3a=_0x272a1f,_0x3ddaeb=(0x0,date_1[_0x4a3c3a(0x188)])()[_0x4a3c3a(0x181)](_0x24c586,'d')[_0x4a3c3a(0x1aa)]('d')[_0x4a3c3a(0x169)](),_0x5a4128=this[_0x4a3c3a(0x167)]['createQueryBuilder'](_0x4a3c3a(0x194))['select']('DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')[_0x4a3c3a(0x12f)](_0x4a3c3a(0x157),{'type':balance_constant_1[_0x4a3c3a(0x19a)][_0x4a3c3a(0x165)]})['andWhere'](_0x4a3c3a(0x17c),{'startDate':_0x3ddaeb});_0x1020a3!==undefined&&_0x5a4128[_0x4a3c3a(0x162)](_0x4a3c3a(0x16e),{'saasId':_0x1020a3});_0x5a4128[_0x4a3c3a(0x13c)](_0x4a3c3a(0x124))[_0x4a3c3a(0x148)](_0x4a3c3a(0x124));const _0x352651=await _0x5a4128[_0x4a3c3a(0x186)](),_0x30659c=[],_0x1b2632=_0x3ddaeb;for(let _0x398207=0x0;_0x398207<_0x24c586;_0x398207++){const _0x3583b8=(0x0,date_1[_0x4a3c3a(0x131)])(new Date(_0x1b2632),_0x4a3c3a(0x14a)),_0x2a9b80=_0x352651[_0x4a3c3a(0x15d)](_0x591f5d=>(0x0,date_1['formatDate'])(new Date(_0x591f5d[_0x4a3c3a(0x124)]),_0x4a3c3a(0x14a))===_0x3583b8)?.[_0x4a3c3a(0x153)]??0x0;_0x2a9b80>0x0?_0x30659c[_0x4a3c3a(0x195)]({'date':_0x3583b8,'value':Number(_0x2a9b80)}):_0x30659c[_0x4a3c3a(0x195)]({'date':_0x3583b8,'value':0x0}),_0x1b2632[_0x4a3c3a(0x15a)](_0x1b2632['getDate']()+0x1);}return _0x30659c;}async[_0x272a1f(0x17f)](_0x256c09,_0x2a389b){const _0x20a497=_0x272a1f,_0x23e858=(0x0,date_1[_0x20a497(0x188)])()[_0x20a497(0x181)](_0x256c09,'d')[_0x20a497(0x1aa)]('d')[_0x20a497(0x169)](),_0x417e27=this['chatLogEntity'][_0x20a497(0x172)](_0x20a497(0x194))[_0x20a497(0x177)](_0x20a497(0x12d))[_0x20a497(0x12f)](_0x20a497(0x157),{'type':balance_constant_1[_0x20a497(0x19a)][_0x20a497(0x156)]})['andWhere'](_0x20a497(0x17c),{'startDate':_0x23e858});_0x2a389b!==undefined&&_0x417e27[_0x20a497(0x162)](_0x20a497(0x16e),{'saasId':_0x2a389b});_0x417e27[_0x20a497(0x13c)](_0x20a497(0x124))[_0x20a497(0x148)](_0x20a497(0x124));const _0x3aa4a7=await _0x417e27[_0x20a497(0x186)](),_0x38a7c3=[],_0x5681a5=_0x23e858;for(let _0x45254d=0x0;_0x45254d<_0x256c09;_0x45254d++){const _0x3ba831=(0x0,date_1[_0x20a497(0x131)])(new Date(_0x5681a5),_0x20a497(0x14a)),_0x26d2b1=_0x3aa4a7[_0x20a497(0x15d)](_0x19baa0=>(0x0,date_1['formatDate'])(new Date(_0x19baa0['date']),_0x20a497(0x14a))===_0x3ba831)?.[_0x20a497(0x153)]??0x0;_0x26d2b1>0x0?_0x38a7c3[_0x20a497(0x195)]({'date':_0x3ba831,'value':Number(_0x26d2b1)}):_0x38a7c3['push']({'date':_0x3ba831,'value':0x0}),_0x5681a5[_0x20a497(0x15a)](_0x5681a5[_0x20a497(0x183)]()+0x1);}return _0x38a7c3;}async[_0x272a1f(0x164)](_0x4c8c36,_0xd9334d){const _0x40ef8e=_0x272a1f,_0x375ce2=(0x0,date_1['default'])()[_0x40ef8e(0x181)](_0x4c8c36,'d')[_0x40ef8e(0x1aa)]('d')[_0x40ef8e(0x169)](),_0x622d7f=this[_0x40ef8e(0x190)][_0x40ef8e(0x172)](_0x40ef8e(0x187))['select']('DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')[_0x40ef8e(0x12f)](_0x40ef8e(0x173),{'status':midjourney_constant_1[_0x40ef8e(0x1a4)][_0x40ef8e(0x185)]})[_0x40ef8e(0x162)]('midjourney.createdAt\x20>=\x20:startDate',{'startDate':_0x375ce2});_0xd9334d!==undefined&&_0x622d7f[_0x40ef8e(0x162)](_0x40ef8e(0x14c),{'saasId':_0xd9334d});_0x622d7f[_0x40ef8e(0x13c)](_0x40ef8e(0x124))['orderBy'](_0x40ef8e(0x124));const _0x1712ce=await _0x622d7f[_0x40ef8e(0x186)](),_0x326bc0=[],_0xcefb9a=_0x375ce2;for(let _0x327c7b=0x0;_0x327c7b<_0x4c8c36;_0x327c7b++){const _0x42a5ce=(0x0,date_1[_0x40ef8e(0x131)])(new Date(_0xcefb9a),'M.DD'),_0x18a867=_0x1712ce[_0x40ef8e(0x15d)](_0x43aed7=>(0x0,date_1[_0x40ef8e(0x131)])(new Date(_0x43aed7[_0x40ef8e(0x124)]),_0x40ef8e(0x14a))===_0x42a5ce)?.[_0x40ef8e(0x153)]??0x0;_0x18a867>0x0?_0x326bc0['push']({'date':_0x42a5ce,'value':Number(_0x18a867)}):_0x326bc0[_0x40ef8e(0x195)]({'date':_0x42a5ce,'value':0x0}),_0xcefb9a[_0x40ef8e(0x15a)](_0xcefb9a['getDate']()+0x1);}return _0x326bc0;}async[_0x272a1f(0x140)](_0x357aee){const _0x403d8c=_0x272a1f,_0x1d117e=(0x0,date_1['formatDate'])(new Date(),'YYYYMMDD'),_0x1b0bfb=(0x0,date_1[_0x403d8c(0x131)])(new Date(Date['now']()-Number(_0x357aee-0x1)*0x18*0x3c*0x3c*0x3e8),_0x403d8c(0x17d)),_0x77444a=_0x403d8c(0x19f),_0x347e5a=_0x403d8c(0x166),_0x2c9681=await this[_0x403d8c(0x12b)]['getConfigByKeys']([_0x403d8c(0x18b),_0x403d8c(0x16c)]),_0x4a5fd8=_0x2c9681[_0x403d8c(0x16c)],_0x1adbcc=_0x2c9681[_0x403d8c(0x18b)];if(!_0x4a5fd8||!_0x1adbcc)return[];if(!_0x4a5fd8)throw new common_1[(_0x403d8c(0x149))](_0x403d8c(0x179),common_1[_0x403d8c(0x133)][_0x403d8c(0x191)]);if(!_0x1adbcc)throw new common_1['HttpException']('请先配置百度统计accessToken',common_1[_0x403d8c(0x133)]['BAD_REQUEST']);const _0x5e2d18='https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token='+_0x1adbcc+'&site_id='+_0x4a5fd8+_0x403d8c(0x138)+_0x347e5a+_0x403d8c(0x18e)+_0x1b0bfb+_0x403d8c(0x18f)+_0x1d117e+_0x403d8c(0x129)+_0x77444a,_0xb48d21=await axios_1[_0x403d8c(0x188)][_0x403d8c(0x168)](_0x5e2d18),{error_code:_0x5d243d,message:_0x4b2048}=_0xb48d21['data'];if(_0x5d243d===0x6f)throw new common_1[(_0x403d8c(0x149))](_0x4b2048||_0x403d8c(0x141),common_1[_0x403d8c(0x133)][_0x403d8c(0x191)]);if(_0x5d243d&&_0x5d243d!==0xc8)throw new common_1[(_0x403d8c(0x149))](_0x4b2048||'获取百度统计数据失败',common_1[_0x403d8c(0x133)][_0x403d8c(0x191)]);return _0xb48d21[_0x403d8c(0x1a1)]['result'];}async['modelUse'](_0x568c84){const _0x2c76e0=_0x272a1f,_0x828537=await this[_0x2c76e0(0x143)][_0x2c76e0(0x144)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27'+_0x568c84[_0x2c76e0(0x134)]+_0x2c76e0(0x154)+_0x568c84[_0x2c76e0(0x189)]+_0x2c76e0(0x197)),_0x2ee19a=(0x0,date_1[_0x2c76e0(0x188)])(_0x568c84[_0x2c76e0(0x134)])['diff']((0x0,date_1['default'])(_0x568c84[_0x2c76e0(0x189)]),_0x2c76e0(0x16f)),_0x2d53d8=_0x2ee19a===0x0?_0x2c76e0(0x161):'%Y-%m-%d',_0x11e96c=await this['connection'][_0x2c76e0(0x144)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27'+_0x2d53d8+_0x2c76e0(0x170)+_0x568c84['startTime']+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27'+_0x568c84['endTime']+_0x2c76e0(0x16b));return{'pie':_0x828537,'line':_0x11e96c};}};StatisticService=__decorate([(0x0,common_1[_0x272a1f(0x15b)])(),__param(0x0,(0x0,typeorm_1[_0x272a1f(0x184)])(user_entity_1[_0x272a1f(0x126)])),__param(0x1,(0x0,typeorm_1[_0x272a1f(0x184)])(chatLog_entity_1[_0x272a1f(0x19c)])),__param(0x2,(0x0,typeorm_1[_0x272a1f(0x184)])(order_entity_1['OrderEntity'])),__param(0x3,(0x0,typeorm_1[_0x272a1f(0x184)])(midjourney_entity_1['MidjourneyEntity'])),__metadata(_0x272a1f(0x13e),[typeorm_2[_0x272a1f(0x19e)],typeorm_2[_0x272a1f(0x19e)],typeorm_2[_0x272a1f(0x19e)],typeorm_2[_0x272a1f(0x19e)],globalConfig_service_1[_0x272a1f(0x192)],nestjs_cls_1[_0x272a1f(0x19b)],typeorm_2['Connection']])],StatisticService),exports[_0x272a1f(0x127)]=StatisticService;