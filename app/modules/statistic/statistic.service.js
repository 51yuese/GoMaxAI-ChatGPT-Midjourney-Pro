'use strict';const _0x2f97b1=_0x49d1;(function(_0x311198,_0x48c837){const _0x599469=_0x49d1,_0x1f8ecc=_0x311198();while(!![]){try{const _0x178e22=parseInt(_0x599469(0x22f))/0x1*(parseInt(_0x599469(0x21b))/0x2)+parseInt(_0x599469(0x222))/0x3+parseInt(_0x599469(0x1e3))/0x4*(parseInt(_0x599469(0x226))/0x5)+-parseInt(_0x599469(0x22c))/0x6+-parseInt(_0x599469(0x1d8))/0x7*(parseInt(_0x599469(0x212))/0x8)+-parseInt(_0x599469(0x1e7))/0x9*(parseInt(_0x599469(0x1ea))/0xa)+parseInt(_0x599469(0x205))/0xb*(parseInt(_0x599469(0x230))/0xc);if(_0x178e22===_0x48c837)break;else _0x1f8ecc['push'](_0x1f8ecc['shift']());}catch(_0x44572c){_0x1f8ecc['push'](_0x1f8ecc['shift']());}}}(_0x5c5f,0x75455));function _0x5c5f(){const _0x209a02=['598914TCPMUg','getBaiduStatistics','请先配置百度统计siteId','60MUJOrH','connection','andWhere','countNewMidhourneysToday','countChatsByTimeRange','EModelType','MidjourneyStatusEnum','chatlog.createdAt\x20>=\x20:startDate','CHAT_TYPE','Connection','MUSIC','../../common/constants/model.constant','IsNull','&metrics=','midjourney.status\x20=\x20:status','PAINT_TYPE','getBaseStatistic','Injectable','count','OrderEntity','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','countNewUsersToday','saasId','startTime','chatlog','toDate','55gtOiZE','countUsers','length','countNewOrdersToday','groupBy','endTime','setDate','__param','baiduSiteId','price','%Y-%m-%d\x20%H:00','function','userEntity','11616ymklmy','countDrawsByTimeRange','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20','Repository','query','chatlog.type\x20=\x20:type','&end_date=','M.DD','countTotalCollection','38pgVnQk','../order/order.entity','countOrders','getRawMany','../chatLog/entity/chatLog.entity','value','typeorm','17226MaSqOw','day','../../common/utils','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','40RmGlLR','HttpStatus','../../common/constants/midjourney.constant','__metadata','midjourney','get','2816262WteNKf','@nestjs/typeorm','获取百度统计数据失败','3566bjQIgg','4509384WEtJqm','defineProperty','InjectRepository','&start_date=','overview/getTimeTrendRpt','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','createQueryBuilder','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','countMjDrawsByTimeRange','Not','sum','subtract','StatisticService','orderEntity','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','data','decorate','%Y-%m-%d','countTodayMusic','getConfigByKeys','design:paramtypes','map','where','DeductionKey','chatLogEntity','baiduToken','HttpException','getReqSaasId','ChatLogEntity','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','countNewDrawsToday','now','metadata','../user/user.entity','YYYYMMDD','object','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27','globalConfigService','countChats','endOf','select','BAD_REQUEST','@nestjs/common','MidjourneyEntity','countTotalMusic','../../common/constants/balance.constant','UserEntity','startOf','toFixed','date','clsService','2933oxyHIK','find','orderBy','getDate','countTodayCollection','default','chatlog.saasId\x20=\x20:saasId','GlobalConfigService','Between','formatDate','请先配置百度统计accessToken','2488KbobXL','midjourneyEntity','push','countDraws'];_0x5c5f=function(){return _0x209a02;};return _0x5c5f();}function _0x49d1(_0x344f2a,_0x234230){const _0x5c5fa8=_0x5c5f();return _0x49d1=function(_0x49d15c,_0x5aee46){_0x49d15c=_0x49d15c-0x1d2;let _0x3e909e=_0x5c5fa8[_0x49d15c];return _0x3e909e;},_0x49d1(_0x344f2a,_0x234230);}var __decorate=this&&this['__decorate']||function(_0x125e21,_0x2b6018,_0x25ed0e,_0x1f2966){const _0xad4c46=_0x49d1;var _0x544586=arguments[_0xad4c46(0x207)],_0x551f8c=_0x544586<0x3?_0x2b6018:_0x1f2966===null?_0x1f2966=Object['getOwnPropertyDescriptor'](_0x2b6018,_0x25ed0e):_0x1f2966,_0x3b616c;if(typeof Reflect===_0xad4c46(0x253)&&typeof Reflect['decorate']===_0xad4c46(0x210))_0x551f8c=Reflect[_0xad4c46(0x240)](_0x125e21,_0x2b6018,_0x25ed0e,_0x1f2966);else{for(var _0x258258=_0x125e21[_0xad4c46(0x207)]-0x1;_0x258258>=0x0;_0x258258--)if(_0x3b616c=_0x125e21[_0x258258])_0x551f8c=(_0x544586<0x3?_0x3b616c(_0x551f8c):_0x544586>0x3?_0x3b616c(_0x2b6018,_0x25ed0e,_0x551f8c):_0x3b616c(_0x2b6018,_0x25ed0e))||_0x551f8c;}return _0x544586>0x3&&_0x551f8c&&Object['defineProperty'](_0x2b6018,_0x25ed0e,_0x551f8c),_0x551f8c;},__metadata=this&&this[_0x2f97b1(0x229)]||function(_0x37a72a,_0x3919db){const _0x22589a=_0x2f97b1;if(typeof Reflect===_0x22589a(0x253)&&typeof Reflect[_0x22589a(0x250)]===_0x22589a(0x210))return Reflect['metadata'](_0x37a72a,_0x3919db);},__param=this&&this[_0x2f97b1(0x20c)]||function(_0x347569,_0x248a9e){return function(_0x2c445e,_0x3f1b4d){_0x248a9e(_0x2c445e,_0x3f1b4d,_0x347569);};};Object[_0x2f97b1(0x231)](exports,'__esModule',{'value':!![]}),exports[_0x2f97b1(0x23c)]=void 0x0;const common_1=require(_0x2f97b1(0x25a)),typeorm_1=require(_0x2f97b1(0x22d)),user_entity_1=require(_0x2f97b1(0x251)),typeorm_2=require(_0x2f97b1(0x221)),chatLog_entity_1=require(_0x2f97b1(0x21f)),balance_constant_1=require(_0x2f97b1(0x1d2)),date_1=require('../../common/utils/date'),axios_1=require('axios'),order_entity_1=require(_0x2f97b1(0x21c)),midjourney_entity_1=require('../midjourney/midjourney.entity'),midjourney_constant_1=require(_0x2f97b1(0x228)),model_constant_1=require(_0x2f97b1(0x1f5)),globalConfig_service_1=require('../globalConfig/globalConfig.service'),nestjs_cls_1=require('nestjs-cls'),utils_1=require(_0x2f97b1(0x224));let StatisticService=class StatisticService{constructor(_0x18d899,_0x1d5329,_0x2fa8e3,_0xefa202,_0x556e81,_0x58642c,_0x32ab8a){const _0x3b7bad=_0x2f97b1;this[_0x3b7bad(0x211)]=_0x18d899,this[_0x3b7bad(0x248)]=_0x1d5329,this['orderEntity']=_0x2fa8e3,this[_0x3b7bad(0x1e4)]=_0xefa202,this[_0x3b7bad(0x255)]=_0x556e81,this[_0x3b7bad(0x1d7)]=_0x58642c,this['connection']=_0x32ab8a;}async[_0x2f97b1(0x1fa)](_0x57cbf8){const _0xaf217e=_0x2f97b1,_0x2f5f25=(0x0,utils_1[_0xaf217e(0x24b)])(this[_0xaf217e(0x1d7)]);_0x2f5f25!==0x0&&(_0x57cbf8=_0x2f5f25);const _0x980452=await this[_0xaf217e(0x206)](_0x57cbf8),_0x258636=await this[_0xaf217e(0x200)](_0x57cbf8),_0x3f62ed=await this['countChats'](_0x57cbf8),_0x88cc0e=await this['countNewChatsToday'](_0x57cbf8),_0x85c914=await this[_0xaf217e(0x1e6)](_0x57cbf8),_0x458f80=await this[_0xaf217e(0x24e)](_0x57cbf8),_0x51799d=await this[_0xaf217e(0x1ed)](_0x57cbf8),_0x740c60=await this['countOrders'](_0x57cbf8),_0x127197=await this[_0xaf217e(0x208)](_0x57cbf8),_0x3b70bd=await this[_0xaf217e(0x1dc)](_0x57cbf8),_0x364d87=await this[_0xaf217e(0x21a)](_0x57cbf8),_0x448854=await this[_0xaf217e(0x242)](_0x57cbf8),_0x5bf4ca=await this[_0xaf217e(0x25c)](_0x57cbf8);return{'userCount':_0x980452,'newUserCount':_0x258636,'chatCount':_0x3f62ed,'newChatCount':_0x88cc0e,'drawCount':_0x85c914,'newDrawCount':_0x51799d+_0x458f80,'orderCount':_0x740c60,'newOrderCount':_0x127197,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x3b70bd,'totalCollection':_0x364d87,'todayMusic':_0x448854,'totalMusic':_0x5bf4ca,'todayVideo':0x0,'totalVideo':0x0};}async[_0x2f97b1(0x206)](_0x14660b){const _0x355f40=_0x2f97b1,_0x46320c={};_0x14660b!==undefined&&(_0x46320c[_0x355f40(0x201)]=_0x14660b);const _0x5c874b=await this[_0x355f40(0x211)][_0x355f40(0x1fc)]({'where':_0x46320c});return _0x5c874b;}async['countNewUsersToday'](_0x641748){const _0x31fd3a=_0x2f97b1,_0x4a100c=(0x0,date_1['default'])()[_0x31fd3a(0x1d4)]('d')[_0x31fd3a(0x204)](),_0xa6edd9=(0x0,date_1['default'])()[_0x31fd3a(0x257)]('d')['toDate'](),_0x3c8c4d={'createdAt':(0x0,typeorm_2[_0x31fd3a(0x1e0)])(_0x4a100c,_0xa6edd9)};_0x641748!==undefined&&(_0x3c8c4d[_0x31fd3a(0x201)]=_0x641748);const _0x3862fe=await this[_0x31fd3a(0x211)][_0x31fd3a(0x1fc)]({'where':_0x3c8c4d});return _0x3862fe;}async[_0x2f97b1(0x256)](_0x4b505a){const _0x1451a3=_0x2f97b1,_0x5cb69e={'type':balance_constant_1[_0x1451a3(0x247)][_0x1451a3(0x1f2)]};_0x4b505a!==undefined&&(_0x5cb69e[_0x1451a3(0x201)]=_0x4b505a);const _0x35598f=await this[_0x1451a3(0x248)][_0x1451a3(0x1fc)]({'where':_0x5cb69e});return _0x35598f;}async['countNewChatsToday'](_0x2ae1a3){const _0x525557=_0x2f97b1,_0x351e60=(0x0,date_1['default'])()[_0x525557(0x1d4)]('d')[_0x525557(0x204)](),_0x31a69b=(0x0,date_1[_0x525557(0x1dd)])()[_0x525557(0x257)]('d')[_0x525557(0x204)](),_0x6d574c={'type':balance_constant_1['DeductionKey'][_0x525557(0x1f2)],'createdAt':(0x0,typeorm_2[_0x525557(0x1e0)])(_0x351e60,_0x31a69b)};_0x2ae1a3!==undefined&&(_0x6d574c[_0x525557(0x201)]=_0x2ae1a3);const _0x3445bd=await this['chatLogEntity'][_0x525557(0x1fc)]({'where':_0x6d574c});return _0x3445bd;}async[_0x2f97b1(0x1e6)](_0x291db6){const _0x1935a2=_0x2f97b1,_0x41af5b={'type':balance_constant_1['DeductionKey']['PAINT_TYPE']};_0x291db6!==undefined&&(_0x41af5b[_0x1935a2(0x201)]=_0x291db6);const _0xdc96e8=await this[_0x1935a2(0x248)][_0x1935a2(0x1fc)]({'where':_0x41af5b});return _0xdc96e8;}async[_0x2f97b1(0x24e)](_0x41efa3){const _0x5a1254=_0x2f97b1,_0x7f8503=(0x0,date_1[_0x5a1254(0x1dd)])()[_0x5a1254(0x1d4)]('d')[_0x5a1254(0x204)](),_0x2798fe=(0x0,date_1[_0x5a1254(0x1dd)])()[_0x5a1254(0x257)]('d')[_0x5a1254(0x204)](),_0x1ecd2a={'type':balance_constant_1[_0x5a1254(0x247)][_0x5a1254(0x1f9)],'createdAt':(0x0,typeorm_2['Between'])(_0x7f8503,_0x2798fe)};_0x41efa3!==undefined&&(_0x1ecd2a[_0x5a1254(0x201)]=_0x41efa3);const _0x55e180=await this[_0x5a1254(0x248)][_0x5a1254(0x1fc)]({'where':_0x1ecd2a});return _0x55e180;}async[_0x2f97b1(0x1ed)](_0x20b859){const _0x42dc32=_0x2f97b1,_0x6a5c9b=(0x0,date_1[_0x42dc32(0x1dd)])()['startOf']('d')[_0x42dc32(0x204)](),_0x38b1b4=(0x0,date_1[_0x42dc32(0x1dd)])()[_0x42dc32(0x257)]('d')[_0x42dc32(0x204)](),_0x121d61={'createdAt':(0x0,typeorm_2[_0x42dc32(0x1e0)])(_0x6a5c9b,_0x38b1b4)};_0x20b859!==undefined&&(_0x121d61[_0x42dc32(0x201)]=_0x20b859);const _0x40489a=await this[_0x42dc32(0x1e4)][_0x42dc32(0x1fc)]({'where':_0x121d61});return _0x40489a;}async[_0x2f97b1(0x21d)](_0x2fae97){const _0x5469a5=_0x2f97b1,_0x249062={};_0x2fae97!==undefined&&(_0x249062[_0x5469a5(0x201)]=_0x2fae97);const _0x16097c=await this[_0x5469a5(0x23d)][_0x5469a5(0x1fc)]({'where':_0x249062});return _0x16097c;}async[_0x2f97b1(0x208)](_0x34f985){const _0x2e3eb2=_0x2f97b1,_0xd4eaac=(0x0,date_1[_0x2e3eb2(0x1dd)])()[_0x2e3eb2(0x1d4)]('d')['toDate'](),_0x1e7c2b=(0x0,date_1['default'])()[_0x2e3eb2(0x257)]('d')[_0x2e3eb2(0x204)](),_0x51d0ff={'createdAt':(0x0,typeorm_2[_0x2e3eb2(0x1e0)])(_0xd4eaac,_0x1e7c2b)};_0x34f985!==undefined&&(_0x51d0ff[_0x2e3eb2(0x201)]=_0x34f985);const _0x12beb0=await this[_0x2e3eb2(0x23d)][_0x2e3eb2(0x1fc)]({'where':_0x51d0ff});return _0x12beb0;}async[_0x2f97b1(0x242)](_0x366fea){const _0x12de62=_0x2f97b1,_0x5d0009=(0x0,date_1[_0x12de62(0x1dd)])()[_0x12de62(0x1d4)]('d')[_0x12de62(0x204)](),_0x2d174f=(0x0,date_1['default'])()['endOf']('d')[_0x12de62(0x204)](),_0x2db49d={'answer':(0x0,typeorm_2[_0x12de62(0x239)])((0x0,typeorm_2['IsNull'])()),'modelType':model_constant_1[_0x12de62(0x1ef)]['MUSIC'],'createdAt':(0x0,typeorm_2[_0x12de62(0x1e0)])(_0x5d0009,_0x2d174f)};_0x366fea!==undefined&&(_0x2db49d[_0x12de62(0x201)]=_0x366fea);const _0x4791b5=await this['chatLogEntity'][_0x12de62(0x1fc)]({'where':_0x2db49d});return _0x4791b5;}async[_0x2f97b1(0x25c)](_0x3b86ef){const _0x49efd1=_0x2f97b1,_0x55efe3={'answer':(0x0,typeorm_2[_0x49efd1(0x239)])((0x0,typeorm_2[_0x49efd1(0x1f6)])()),'modelType':model_constant_1[_0x49efd1(0x1ef)][_0x49efd1(0x1f4)]};_0x3b86ef!==undefined&&(_0x55efe3[_0x49efd1(0x201)]=_0x3b86ef);const _0x245c0b=await this[_0x49efd1(0x248)][_0x49efd1(0x1fc)]({'where':_0x55efe3});return _0x245c0b;}async[_0x2f97b1(0x1dc)](_0xa31983){const _0xf93774=_0x2f97b1,_0x46bbfb=(0x0,date_1[_0xf93774(0x1dd)])()[_0xf93774(0x1d4)]('d')[_0xf93774(0x204)](),_0x190ccf=(0x0,date_1['default'])()[_0xf93774(0x257)]('d')[_0xf93774(0x204)](),_0x28d27c={'status':0x1,'updatedAt':(0x0,typeorm_2['Between'])(_0x46bbfb,_0x190ccf)};_0xa31983!==undefined&&(_0x28d27c[_0xf93774(0x201)]=_0xa31983);const _0x4d12cf=await this['orderEntity'][_0xf93774(0x23a)](_0xf93774(0x20e),_0x28d27c)||0x0;return _0x4d12cf[_0xf93774(0x1d5)](0x2);}async[_0x2f97b1(0x21a)](_0x157755){const _0xf6af43=_0x2f97b1,_0x38a170={'status':0x1};_0x157755!==undefined&&(_0x38a170['saasId']=_0x157755);const _0x2fb839=await this[_0xf6af43(0x23d)]['sum'](_0xf6af43(0x20e),_0x38a170)||0x0;return _0x2fb839['toFixed'](0x2);}async['getChatStatistic']({days:days=0x7,saasId:_0x1ba7ca}){const _0x49b562=_0x2f97b1,_0xce8d4c=(0x0,utils_1[_0x49b562(0x24b)])(this[_0x49b562(0x1d7)]);_0xce8d4c!==0x0&&(_0x1ba7ca=_0xce8d4c);const _0x9d022b=await this[_0x49b562(0x1ee)](days,_0x1ba7ca),_0x503b9c=await this[_0x49b562(0x213)](days,_0x1ba7ca),_0x412a09=await this[_0x49b562(0x238)](days,_0x1ba7ca);return{'date':_0x9d022b[_0x49b562(0x245)](_0x42bd09=>_0x42bd09[_0x49b562(0x1d6)]),'chat':_0x9d022b[_0x49b562(0x245)](_0x5d3162=>_0x5d3162[_0x49b562(0x220)]),'draw':_0x503b9c[_0x49b562(0x245)]((_0x3d73cc,_0x4bfb83)=>{const _0x2a8228=_0x49b562;return _0x3d73cc[_0x2a8228(0x220)]+_0x412a09[_0x4bfb83][_0x2a8228(0x220)];})};}async[_0x2f97b1(0x1ee)](_0x55e2dc,_0x5e1428){const _0x1beaa8=_0x2f97b1,_0x233e46=(0x0,date_1[_0x1beaa8(0x1dd)])()[_0x1beaa8(0x23b)](_0x55e2dc,'d')['startOf']('d')[_0x1beaa8(0x204)](),_0x3884ad=this[_0x1beaa8(0x248)][_0x1beaa8(0x236)]('chatlog')[_0x1beaa8(0x258)](_0x1beaa8(0x225))['where'](_0x1beaa8(0x217),{'type':balance_constant_1[_0x1beaa8(0x247)][_0x1beaa8(0x1f2)]})['andWhere'](_0x1beaa8(0x1f1),{'startDate':_0x233e46});_0x5e1428!==undefined&&_0x3884ad[_0x1beaa8(0x1ec)](_0x1beaa8(0x1de),{'saasId':_0x5e1428});_0x3884ad['groupBy'](_0x1beaa8(0x1d6))[_0x1beaa8(0x1da)]('date');const _0x19024b=await _0x3884ad[_0x1beaa8(0x21e)](),_0x135013=[],_0x58ac54=_0x233e46;for(let _0x4ecae0=0x0;_0x4ecae0<_0x55e2dc;_0x4ecae0++){const _0x546621=(0x0,date_1['formatDate'])(new Date(_0x58ac54),'M.DD'),_0x158f6a=_0x19024b[_0x1beaa8(0x1d9)](_0x45e700=>(0x0,date_1[_0x1beaa8(0x1e1)])(new Date(_0x45e700[_0x1beaa8(0x1d6)]),_0x1beaa8(0x219))===_0x546621)?.[_0x1beaa8(0x1fc)]??0x0;_0x158f6a>0x0?_0x135013[_0x1beaa8(0x1e5)]({'date':_0x546621,'value':Number(_0x158f6a)}):_0x135013[_0x1beaa8(0x1e5)]({'date':_0x546621,'value':0x0}),_0x58ac54[_0x1beaa8(0x20b)](_0x58ac54[_0x1beaa8(0x1db)]()+0x1);}return _0x135013;}async[_0x2f97b1(0x213)](_0x262fd8,_0x17ce6b){const _0x10711d=_0x2f97b1,_0x4dc4b7=(0x0,date_1[_0x10711d(0x1dd)])()['subtract'](_0x262fd8,'d')[_0x10711d(0x1d4)]('d')[_0x10711d(0x204)](),_0x5ae540=this['chatLogEntity'][_0x10711d(0x236)](_0x10711d(0x203))[_0x10711d(0x258)](_0x10711d(0x225))[_0x10711d(0x246)](_0x10711d(0x217),{'type':balance_constant_1['DeductionKey']['PAINT_TYPE']})[_0x10711d(0x1ec)]('chatlog.createdAt\x20>=\x20:startDate',{'startDate':_0x4dc4b7});_0x17ce6b!==undefined&&_0x5ae540[_0x10711d(0x1ec)](_0x10711d(0x1de),{'saasId':_0x17ce6b});_0x5ae540[_0x10711d(0x209)]('date')[_0x10711d(0x1da)]('date');const _0x106239=await _0x5ae540[_0x10711d(0x21e)](),_0x2ce1cb=[],_0x264481=_0x4dc4b7;for(let _0x29f4b0=0x0;_0x29f4b0<_0x262fd8;_0x29f4b0++){const _0x366662=(0x0,date_1['formatDate'])(new Date(_0x264481),_0x10711d(0x219)),_0x1aeca0=_0x106239['find'](_0x26e16d=>(0x0,date_1['formatDate'])(new Date(_0x26e16d[_0x10711d(0x1d6)]),_0x10711d(0x219))===_0x366662)?.[_0x10711d(0x1fc)]??0x0;_0x1aeca0>0x0?_0x2ce1cb[_0x10711d(0x1e5)]({'date':_0x366662,'value':Number(_0x1aeca0)}):_0x2ce1cb[_0x10711d(0x1e5)]({'date':_0x366662,'value':0x0}),_0x264481[_0x10711d(0x20b)](_0x264481[_0x10711d(0x1db)]()+0x1);}return _0x2ce1cb;}async[_0x2f97b1(0x238)](_0x43cb28,_0x2f106f){const _0x3c2e78=_0x2f97b1,_0x3877ae=(0x0,date_1['default'])()['subtract'](_0x43cb28,'d')['startOf']('d')['toDate'](),_0xd52fa5=this[_0x3c2e78(0x1e4)][_0x3c2e78(0x236)](_0x3c2e78(0x22a))[_0x3c2e78(0x258)]('DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')[_0x3c2e78(0x246)](_0x3c2e78(0x1f8),{'status':midjourney_constant_1[_0x3c2e78(0x1f0)]['DRAWED']})[_0x3c2e78(0x1ec)]('midjourney.createdAt\x20>=\x20:startDate',{'startDate':_0x3877ae});_0x2f106f!==undefined&&_0xd52fa5['andWhere']('midjourney.saasId\x20=\x20:saasId',{'saasId':_0x2f106f});_0xd52fa5[_0x3c2e78(0x209)](_0x3c2e78(0x1d6))[_0x3c2e78(0x1da)](_0x3c2e78(0x1d6));const _0x1a080b=await _0xd52fa5[_0x3c2e78(0x21e)](),_0x549cd0=[],_0x515997=_0x3877ae;for(let _0x3a3211=0x0;_0x3a3211<_0x43cb28;_0x3a3211++){const _0x492319=(0x0,date_1['formatDate'])(new Date(_0x515997),'M.DD'),_0x6ff169=_0x1a080b['find'](_0x7bf324=>(0x0,date_1['formatDate'])(new Date(_0x7bf324[_0x3c2e78(0x1d6)]),_0x3c2e78(0x219))===_0x492319)?.['count']??0x0;_0x6ff169>0x0?_0x549cd0[_0x3c2e78(0x1e5)]({'date':_0x492319,'value':Number(_0x6ff169)}):_0x549cd0[_0x3c2e78(0x1e5)]({'date':_0x492319,'value':0x0}),_0x515997[_0x3c2e78(0x20b)](_0x515997[_0x3c2e78(0x1db)]()+0x1);}return _0x549cd0;}async[_0x2f97b1(0x1e8)](_0x237657){const _0x56a680=_0x2f97b1,_0x28fd19=(0x0,date_1[_0x56a680(0x1e1)])(new Date(),_0x56a680(0x252)),_0x22b43c=(0x0,date_1[_0x56a680(0x1e1)])(new Date(Date[_0x56a680(0x24f)]()-Number(_0x237657-0x1)*0x18*0x3c*0x3c*0x3e8),_0x56a680(0x252)),_0xf3469b=_0x56a680(0x24d),_0x40fa23=_0x56a680(0x234),_0x4440de=await this[_0x56a680(0x255)][_0x56a680(0x243)]([_0x56a680(0x249),_0x56a680(0x20d)]),_0x3be034=_0x4440de[_0x56a680(0x20d)],_0x2ecef1=_0x4440de[_0x56a680(0x249)];if(!_0x3be034||!_0x2ecef1)return[];if(!_0x3be034)throw new common_1[(_0x56a680(0x24a))](_0x56a680(0x1e9),common_1['HttpStatus'][_0x56a680(0x259)]);if(!_0x2ecef1)throw new common_1[(_0x56a680(0x24a))](_0x56a680(0x1e2),common_1['HttpStatus'][_0x56a680(0x259)]);const _0x2fc444=_0x56a680(0x235)+_0x2ecef1+'&site_id='+_0x3be034+'&method='+_0x40fa23+_0x56a680(0x233)+_0x22b43c+_0x56a680(0x218)+_0x28fd19+_0x56a680(0x1f7)+_0xf3469b,_0x41b17b=await axios_1['default'][_0x56a680(0x22b)](_0x2fc444),{error_code:_0x2ad0f0,message:_0x40b8f8}=_0x41b17b[_0x56a680(0x23f)];if(_0x2ad0f0===0x6f)throw new common_1[(_0x56a680(0x24a))](_0x40b8f8||'百度授权码过期',common_1[_0x56a680(0x227)][_0x56a680(0x259)]);if(_0x2ad0f0&&_0x2ad0f0!==0xc8)throw new common_1[(_0x56a680(0x24a))](_0x40b8f8||_0x56a680(0x22e),common_1[_0x56a680(0x227)][_0x56a680(0x259)]);return _0x41b17b[_0x56a680(0x23f)]['result'];}async['modelUse'](_0x4e9616){const _0x2a015c=_0x2f97b1,_0x3b958e=await this[_0x2a015c(0x1eb)][_0x2a015c(0x216)](_0x2a015c(0x237)+_0x4e9616[_0x2a015c(0x202)]+_0x2a015c(0x1fe)+_0x4e9616[_0x2a015c(0x20a)]+_0x2a015c(0x214)),_0x33f1ef=(0x0,date_1['default'])(_0x4e9616[_0x2a015c(0x202)])['diff']((0x0,date_1['default'])(_0x4e9616[_0x2a015c(0x20a)]),_0x2a015c(0x223)),_0x4eed48=_0x33f1ef===0x0?_0x2a015c(0x20f):_0x2a015c(0x241),_0x3e8046=await this['connection']['query'](_0x2a015c(0x254)+_0x4eed48+_0x2a015c(0x23e)+_0x4e9616['startTime']+_0x2a015c(0x1fe)+_0x4e9616['endTime']+_0x2a015c(0x1ff));return{'pie':_0x3b958e,'line':_0x3e8046};}};StatisticService=__decorate([(0x0,common_1[_0x2f97b1(0x1fb)])(),__param(0x0,(0x0,typeorm_1[_0x2f97b1(0x232)])(user_entity_1[_0x2f97b1(0x1d3)])),__param(0x1,(0x0,typeorm_1[_0x2f97b1(0x232)])(chatLog_entity_1[_0x2f97b1(0x24c)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(order_entity_1[_0x2f97b1(0x1fd)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1[_0x2f97b1(0x25b)])),__metadata(_0x2f97b1(0x244),[typeorm_2[_0x2f97b1(0x215)],typeorm_2[_0x2f97b1(0x215)],typeorm_2[_0x2f97b1(0x215)],typeorm_2['Repository'],globalConfig_service_1[_0x2f97b1(0x1df)],nestjs_cls_1['ClsService'],typeorm_2[_0x2f97b1(0x1f3)]])],StatisticService),exports[_0x2f97b1(0x23c)]=StatisticService;