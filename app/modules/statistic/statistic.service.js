'use strict';function _0x949c(_0x2de595,_0x1ce4b4){const _0x44d881=_0x44d8();return _0x949c=function(_0x949c73,_0x4e0bc4){_0x949c73=_0x949c73-0x179;let _0x3327d7=_0x44d881[_0x949c73];return _0x3327d7;},_0x949c(_0x2de595,_0x1ce4b4);}const _0x4e10e3=_0x949c;(function(_0x165c9e,_0x409638){const _0x31713c=_0x949c,_0x1f8d9f=_0x165c9e();while(!![]){try{const _0x358aea=-parseInt(_0x31713c(0x194))/0x1*(parseInt(_0x31713c(0x1d5))/0x2)+parseInt(_0x31713c(0x1c3))/0x3*(parseInt(_0x31713c(0x1cf))/0x4)+parseInt(_0x31713c(0x1c1))/0x5*(parseInt(_0x31713c(0x1c6))/0x6)+parseInt(_0x31713c(0x1d4))/0x7+-parseInt(_0x31713c(0x182))/0x8*(-parseInt(_0x31713c(0x186))/0x9)+parseInt(_0x31713c(0x1a9))/0xa*(parseInt(_0x31713c(0x1ef))/0xb)+-parseInt(_0x31713c(0x17b))/0xc*(parseInt(_0x31713c(0x1b3))/0xd);if(_0x358aea===_0x409638)break;else _0x1f8d9f['push'](_0x1f8d9f['shift']());}catch(_0x29ff64){_0x1f8d9f['push'](_0x1f8d9f['shift']());}}}(_0x44d8,0x640df));var __decorate=this&&this[_0x4e10e3(0x206)]||function(_0x5cad5a,_0x1133cb,_0x2e0196,_0x5c5fb8){const _0x42154f=_0x4e10e3;var _0x52c0fa=arguments['length'],_0x2dc0d8=_0x52c0fa<0x3?_0x1133cb:_0x5c5fb8===null?_0x5c5fb8=Object[_0x42154f(0x204)](_0x1133cb,_0x2e0196):_0x5c5fb8,_0x5d77ad;if(typeof Reflect===_0x42154f(0x19b)&&typeof Reflect[_0x42154f(0x1c9)]===_0x42154f(0x1b6))_0x2dc0d8=Reflect['decorate'](_0x5cad5a,_0x1133cb,_0x2e0196,_0x5c5fb8);else{for(var _0x418c35=_0x5cad5a[_0x42154f(0x192)]-0x1;_0x418c35>=0x0;_0x418c35--)if(_0x5d77ad=_0x5cad5a[_0x418c35])_0x2dc0d8=(_0x52c0fa<0x3?_0x5d77ad(_0x2dc0d8):_0x52c0fa>0x3?_0x5d77ad(_0x1133cb,_0x2e0196,_0x2dc0d8):_0x5d77ad(_0x1133cb,_0x2e0196))||_0x2dc0d8;}return _0x52c0fa>0x3&&_0x2dc0d8&&Object[_0x42154f(0x179)](_0x1133cb,_0x2e0196,_0x2dc0d8),_0x2dc0d8;},__metadata=this&&this[_0x4e10e3(0x1ae)]||function(_0x994091,_0x523df0){const _0x4f477a=_0x4e10e3;if(typeof Reflect==='object'&&typeof Reflect[_0x4f477a(0x193)]===_0x4f477a(0x1b6))return Reflect[_0x4f477a(0x193)](_0x994091,_0x523df0);},__param=this&&this[_0x4e10e3(0x1f9)]||function(_0x4122eb,_0x28f4a2){return function(_0x50d318,_0x5acda8){_0x28f4a2(_0x50d318,_0x5acda8,_0x4122eb);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports['StatisticService']=void 0x0;const common_1=require(_0x4e10e3(0x18f)),typeorm_1=require('@nestjs/typeorm'),user_entity_1=require(_0x4e10e3(0x19a)),typeorm_2=require(_0x4e10e3(0x19f)),chatLog_entity_1=require('../chatLog/entity/chatLog.entity'),balance_constant_1=require(_0x4e10e3(0x1fe)),date_1=require(_0x4e10e3(0x198)),axios_1=require(_0x4e10e3(0x1c4)),order_entity_1=require('../order/order.entity'),midjourney_entity_1=require('../midjourney/midjourney.entity'),midjourney_constant_1=require(_0x4e10e3(0x1f1)),model_constant_1=require(_0x4e10e3(0x188)),globalConfig_service_1=require(_0x4e10e3(0x195)),nestjs_cls_1=require(_0x4e10e3(0x1ac)),utils_1=require(_0x4e10e3(0x1da));let StatisticService=class StatisticService{constructor(_0x58dbb3,_0x510c9d,_0x5b7809,_0x5cfbfe,_0x59fd3a,_0x3504ca,_0x3b1a81){const _0x5d0f46=_0x4e10e3;this[_0x5d0f46(0x1f5)]=_0x58dbb3,this[_0x5d0f46(0x1d7)]=_0x510c9d,this[_0x5d0f46(0x191)]=_0x5b7809,this[_0x5d0f46(0x1a2)]=_0x5cfbfe,this[_0x5d0f46(0x18e)]=_0x59fd3a,this[_0x5d0f46(0x1b9)]=_0x3504ca,this[_0x5d0f46(0x1b0)]=_0x3b1a81;}async[_0x4e10e3(0x185)](_0xa3e645){const _0xe07f47=_0x4e10e3,_0x2eeb76=(0x0,utils_1[_0xe07f47(0x1a7)])(this[_0xe07f47(0x1b9)]);_0x2eeb76!==0x0&&(_0xa3e645=_0x2eeb76);const _0x177da7=await this['countUsers'](_0xa3e645),_0xe7ebec=await this['countNewUsersToday'](_0xa3e645),_0x4ed301=await this[_0xe07f47(0x1ee)](_0xa3e645),_0x48f4aa=await this[_0xe07f47(0x1fb)](_0xa3e645),_0x70838c=await this[_0xe07f47(0x1ca)](_0xa3e645),_0x1a0165=await this['countNewDrawsToday'](_0xa3e645),_0x3e242a=await this[_0xe07f47(0x1d8)](_0xa3e645),_0x22c62f=await this[_0xe07f47(0x183)](_0xa3e645),_0x5c75fc=await this['countNewOrdersToday'](_0xa3e645),_0x5874e0=await this[_0xe07f47(0x1a5)](_0xa3e645),_0x4bf0f7=await this[_0xe07f47(0x1d1)](_0xa3e645),_0x554932=await this[_0xe07f47(0x1d0)](_0xa3e645),_0x310fca=await this[_0xe07f47(0x1cc)](_0xa3e645),_0x440e35=await this[_0xe07f47(0x17d)](_0xa3e645),_0x15b43c=await this[_0xe07f47(0x1eb)](_0xa3e645);return{'userCount':_0x177da7,'newUserCount':_0xe7ebec,'chatCount':_0x4ed301,'newChatCount':_0x48f4aa,'drawCount':_0x70838c,'newDrawCount':_0x3e242a+_0x1a0165,'orderCount':_0x22c62f,'newOrderCount':_0x5c75fc,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x5874e0,'totalCollection':_0x4bf0f7,'todayMusic':_0x554932,'totalMusic':_0x310fca,'todayVideo':0x0,'totalVideo':0x0,'todayInviteCount':_0x440e35,'totalInviteCount':_0x15b43c};}async[_0x4e10e3(0x1b4)](_0x14dada){const _0x75f001=_0x4e10e3,_0x4dccea={};_0x14dada!==undefined&&(_0x4dccea[_0x75f001(0x1a3)]=_0x14dada);const _0x2370cc=await this[_0x75f001(0x1f5)][_0x75f001(0x1f0)]({'where':_0x4dccea});return _0x2370cc;}async[_0x4e10e3(0x1eb)](_0x3fc951){const _0x1ed38c={'inviteCode':(0x0,typeorm_2['Not'])('')};_0x3fc951!==undefined&&(_0x1ed38c['saasId']=_0x3fc951);const _0x4bcb4c=await this['userEntity']['count']({'where':_0x1ed38c});return _0x4bcb4c;}async['countInviteUsersToday'](_0x411d5d){const _0xa7e517=_0x4e10e3,_0x5ca3eb=(0x0,date_1['default'])()[_0xa7e517(0x190)]('d')[_0xa7e517(0x1f8)](),_0x31263f=(0x0,date_1['default'])()[_0xa7e517(0x1be)]('d')['toDate'](),_0x2b9dea={'createdAt':(0x0,typeorm_2[_0xa7e517(0x1e6)])(_0x5ca3eb,_0x31263f),'inviteCode':(0x0,typeorm_2[_0xa7e517(0x19e)])('')};_0x411d5d!==undefined&&(_0x2b9dea[_0xa7e517(0x1a3)]=_0x411d5d);const _0x380d6b=await this[_0xa7e517(0x1f5)][_0xa7e517(0x1f0)]({'where':_0x2b9dea});return _0x380d6b;}async[_0x4e10e3(0x1d2)](_0x31dc55){const _0x5778e1=_0x4e10e3,_0x4483c2=(0x0,date_1[_0x5778e1(0x1db)])()[_0x5778e1(0x190)]('d')['toDate'](),_0x3cc9d4=(0x0,date_1[_0x5778e1(0x1db)])()[_0x5778e1(0x1be)]('d')['toDate'](),_0x3b72b7={'createdAt':(0x0,typeorm_2[_0x5778e1(0x1e6)])(_0x4483c2,_0x3cc9d4)};_0x31dc55!==undefined&&(_0x3b72b7[_0x5778e1(0x1a3)]=_0x31dc55);const _0xf28590=await this[_0x5778e1(0x1f5)][_0x5778e1(0x1f0)]({'where':_0x3b72b7});return _0xf28590;}async[_0x4e10e3(0x1ee)](_0x587f79){const _0x4749f8=_0x4e10e3,_0x4aa546={'type':balance_constant_1[_0x4749f8(0x180)][_0x4749f8(0x1ad)]};_0x587f79!==undefined&&(_0x4aa546[_0x4749f8(0x1a3)]=_0x587f79);const _0x5e0745=await this[_0x4749f8(0x1d7)]['count']({'where':_0x4aa546});return _0x5e0745;}async[_0x4e10e3(0x1fb)](_0x5a0311){const _0x5cc9d7=_0x4e10e3,_0x18a289=(0x0,date_1['default'])()[_0x5cc9d7(0x190)]('d')[_0x5cc9d7(0x1f8)](),_0x4d4665=(0x0,date_1[_0x5cc9d7(0x1db)])()[_0x5cc9d7(0x1be)]('d')[_0x5cc9d7(0x1f8)](),_0x57e177={'type':balance_constant_1[_0x5cc9d7(0x180)][_0x5cc9d7(0x1ad)],'createdAt':(0x0,typeorm_2[_0x5cc9d7(0x1e6)])(_0x18a289,_0x4d4665)};_0x5a0311!==undefined&&(_0x57e177[_0x5cc9d7(0x1a3)]=_0x5a0311);const _0x6dcd4=await this[_0x5cc9d7(0x1d7)][_0x5cc9d7(0x1f0)]({'where':_0x57e177});return _0x6dcd4;}async[_0x4e10e3(0x1ca)](_0x478d60){const _0x17f75b=_0x4e10e3,_0x8de850={'type':balance_constant_1[_0x17f75b(0x180)][_0x17f75b(0x1b1)]};_0x478d60!==undefined&&(_0x8de850[_0x17f75b(0x1a3)]=_0x478d60);const _0x5c1af1=await this['chatLogEntity'][_0x17f75b(0x1f0)]({'where':_0x8de850});return _0x5c1af1;}async['countNewDrawsToday'](_0x4e011d){const _0x1d01ca=_0x4e10e3,_0x4b8e99=(0x0,date_1[_0x1d01ca(0x1db)])()[_0x1d01ca(0x190)]('d')[_0x1d01ca(0x1f8)](),_0x34d959=(0x0,date_1['default'])()[_0x1d01ca(0x1be)]('d')[_0x1d01ca(0x1f8)](),_0x376276={'type':balance_constant_1[_0x1d01ca(0x180)][_0x1d01ca(0x1b1)],'createdAt':(0x0,typeorm_2[_0x1d01ca(0x1e6)])(_0x4b8e99,_0x34d959)};_0x4e011d!==undefined&&(_0x376276[_0x1d01ca(0x1a3)]=_0x4e011d);const _0x11b627=await this[_0x1d01ca(0x1d7)]['count']({'where':_0x376276});return _0x11b627;}async[_0x4e10e3(0x1d8)](_0xb304e1){const _0x5dc929=_0x4e10e3,_0x10b8d0=(0x0,date_1[_0x5dc929(0x1db)])()['startOf']('d')[_0x5dc929(0x1f8)](),_0x5812eb=(0x0,date_1[_0x5dc929(0x1db)])()[_0x5dc929(0x1be)]('d')[_0x5dc929(0x1f8)](),_0x5d0feb={'createdAt':(0x0,typeorm_2[_0x5dc929(0x1e6)])(_0x10b8d0,_0x5812eb)};_0xb304e1!==undefined&&(_0x5d0feb[_0x5dc929(0x1a3)]=_0xb304e1);const _0x6f1f07=await this[_0x5dc929(0x1a2)][_0x5dc929(0x1f0)]({'where':_0x5d0feb});return _0x6f1f07;}async[_0x4e10e3(0x183)](_0x4739ff){const _0x20e157=_0x4e10e3,_0xe4b084={};_0x4739ff!==undefined&&(_0xe4b084['saasId']=_0x4739ff);const _0x2fec41=await this[_0x20e157(0x191)][_0x20e157(0x1f0)]({'where':_0xe4b084});return _0x2fec41;}async['countNewOrdersToday'](_0x3c7de1){const _0x242d9c=_0x4e10e3,_0x40cff7=(0x0,date_1[_0x242d9c(0x1db)])()[_0x242d9c(0x190)]('d')['toDate'](),_0x2fb17e=(0x0,date_1['default'])()[_0x242d9c(0x1be)]('d')[_0x242d9c(0x1f8)](),_0x554821={'createdAt':(0x0,typeorm_2[_0x242d9c(0x1e6)])(_0x40cff7,_0x2fb17e),'status':0x1};_0x3c7de1!==undefined&&(_0x554821[_0x242d9c(0x1a3)]=_0x3c7de1);const _0x2b3689=await this['orderEntity'][_0x242d9c(0x1f0)]({'where':_0x554821});return _0x2b3689;}async[_0x4e10e3(0x1d0)](_0x36a12c){const _0x50f0c6=_0x4e10e3,_0x417e4a=(0x0,date_1[_0x50f0c6(0x1db)])()[_0x50f0c6(0x190)]('d')['toDate'](),_0x426996=(0x0,date_1[_0x50f0c6(0x1db)])()[_0x50f0c6(0x1be)]('d')[_0x50f0c6(0x1f8)](),_0x265636={'answer':(0x0,typeorm_2[_0x50f0c6(0x19e)])((0x0,typeorm_2[_0x50f0c6(0x1ea)])()),'modelType':model_constant_1[_0x50f0c6(0x1e8)]['MUSIC'],'createdAt':(0x0,typeorm_2[_0x50f0c6(0x1e6)])(_0x417e4a,_0x426996)};_0x36a12c!==undefined&&(_0x265636[_0x50f0c6(0x1a3)]=_0x36a12c);const _0x24c5d8=await this[_0x50f0c6(0x1d7)]['count']({'where':_0x265636});return _0x24c5d8;}async[_0x4e10e3(0x1cc)](_0x233758){const _0x2c0591=_0x4e10e3,_0x3bdd2d={'answer':(0x0,typeorm_2[_0x2c0591(0x19e)])((0x0,typeorm_2[_0x2c0591(0x1ea)])()),'modelType':model_constant_1[_0x2c0591(0x1e8)][_0x2c0591(0x196)]};_0x233758!==undefined&&(_0x3bdd2d[_0x2c0591(0x1a3)]=_0x233758);const _0x231b78=await this[_0x2c0591(0x1d7)][_0x2c0591(0x1f0)]({'where':_0x3bdd2d});return _0x231b78;}async['countTodayCollection'](_0x381e58){const _0x4bd1bd=_0x4e10e3,_0x8ba4f=(0x0,date_1['default'])()['startOf']('d')['toDate'](),_0x1705b6=(0x0,date_1[_0x4bd1bd(0x1db)])()[_0x4bd1bd(0x1be)]('d')[_0x4bd1bd(0x1f8)](),_0x4c5ddd={'status':0x1,'updatedAt':(0x0,typeorm_2[_0x4bd1bd(0x1e6)])(_0x8ba4f,_0x1705b6)};_0x381e58!==undefined&&(_0x4c5ddd[_0x4bd1bd(0x1a3)]=_0x381e58);const _0x54fae4=await this[_0x4bd1bd(0x191)][_0x4bd1bd(0x1ec)](_0x4bd1bd(0x1de),_0x4c5ddd)||0x0;return _0x54fae4[_0x4bd1bd(0x201)](0x2);}async['countTotalCollection'](_0x244bfd){const _0x305d7d=_0x4e10e3,_0x17de54={'status':0x1};_0x244bfd!==undefined&&(_0x17de54[_0x305d7d(0x1a3)]=_0x244bfd);const _0x130b8e=await this[_0x305d7d(0x191)][_0x305d7d(0x1ec)](_0x305d7d(0x1de),_0x17de54)||0x0;return _0x130b8e[_0x305d7d(0x201)](0x2);}async[_0x4e10e3(0x19c)]({days:days=0x7,saasId:_0x22abb2}){const _0x1e68ef=_0x4e10e3,_0x3fdc7a=(0x0,utils_1[_0x1e68ef(0x1a7)])(this[_0x1e68ef(0x1b9)]);_0x3fdc7a!==0x0&&(_0x22abb2=_0x3fdc7a);const _0x470588=await this['countChatsByTimeRange'](days,_0x22abb2),_0x48159b=await this['countDrawsByTimeRange'](days,_0x22abb2),_0x161545=await this['countMjDrawsByTimeRange'](days,_0x22abb2);return{'date':_0x470588['map'](_0x496c7e=>_0x496c7e[_0x1e68ef(0x1bc)]),'chat':_0x470588['map'](_0xd23eb6=>_0xd23eb6['value']),'draw':_0x48159b[_0x1e68ef(0x205)]((_0x27430,_0x4fe1d4)=>{const _0x180f86=_0x1e68ef;return _0x27430[_0x180f86(0x1aa)]+_0x161545[_0x4fe1d4][_0x180f86(0x1aa)];})};}async['countChatsByTimeRange'](_0x4d3db4,_0x1fe7cb){const _0x22a88e=_0x4e10e3,_0x463345=(0x0,date_1['default'])()[_0x22a88e(0x1e2)](_0x4d3db4,'d')[_0x22a88e(0x190)]('d')[_0x22a88e(0x1f8)](),_0x28b651=this[_0x22a88e(0x1d7)][_0x22a88e(0x1e5)](_0x22a88e(0x1fc))[_0x22a88e(0x1a0)](_0x22a88e(0x1ed))['where'](_0x22a88e(0x18d),{'type':balance_constant_1[_0x22a88e(0x180)]['CHAT_TYPE']})[_0x22a88e(0x1bd)](_0x22a88e(0x1e7),{'startDate':_0x463345});_0x1fe7cb!==undefined&&_0x28b651[_0x22a88e(0x1bd)](_0x22a88e(0x189),{'saasId':_0x1fe7cb});_0x28b651[_0x22a88e(0x1e9)](_0x22a88e(0x1bc))[_0x22a88e(0x1f7)]('date');const _0x5dc63b=await _0x28b651[_0x22a88e(0x1ce)](),_0x3a0a98=[],_0x526233=_0x463345;for(let _0x577462=0x0;_0x577462<_0x4d3db4;_0x577462++){const _0x6df1a5=(0x0,date_1[_0x22a88e(0x19d)])(new Date(_0x526233),'M.DD'),_0x1fe2cd=_0x5dc63b['find'](_0x21213b=>(0x0,date_1[_0x22a88e(0x19d)])(new Date(_0x21213b[_0x22a88e(0x1bc)]),_0x22a88e(0x1a4))===_0x6df1a5)?.[_0x22a88e(0x1f0)]??0x0;_0x1fe2cd>0x0?_0x3a0a98['push']({'date':_0x6df1a5,'value':Number(_0x1fe2cd)}):_0x3a0a98['push']({'date':_0x6df1a5,'value':0x0}),_0x526233[_0x22a88e(0x203)](_0x526233[_0x22a88e(0x1e0)]()+0x1);}return _0x3a0a98;}async[_0x4e10e3(0x184)](_0x196062,_0x396102){const _0x173874=_0x4e10e3,_0x2c894f=(0x0,date_1['default'])()['subtract'](_0x196062,'d')[_0x173874(0x190)]('d')[_0x173874(0x1f8)](),_0x3e75a0=this['chatLogEntity']['createQueryBuilder']('chatlog')[_0x173874(0x1a0)]('DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')['where'](_0x173874(0x18d),{'type':balance_constant_1[_0x173874(0x180)][_0x173874(0x1b1)]})['andWhere'](_0x173874(0x1e7),{'startDate':_0x2c894f});_0x396102!==undefined&&_0x3e75a0['andWhere'](_0x173874(0x189),{'saasId':_0x396102});_0x3e75a0[_0x173874(0x1e9)]('date')[_0x173874(0x1f7)](_0x173874(0x1bc));const _0x4d35f7=await _0x3e75a0[_0x173874(0x1ce)](),_0x1d4901=[],_0x7fcf0=_0x2c894f;for(let _0x383805=0x0;_0x383805<_0x196062;_0x383805++){const _0x151b2c=(0x0,date_1['formatDate'])(new Date(_0x7fcf0),_0x173874(0x1a4)),_0x5ae56c=_0x4d35f7[_0x173874(0x1c7)](_0x5545e2=>(0x0,date_1[_0x173874(0x19d)])(new Date(_0x5545e2['date']),_0x173874(0x1a4))===_0x151b2c)?.['count']??0x0;_0x5ae56c>0x0?_0x1d4901[_0x173874(0x1cb)]({'date':_0x151b2c,'value':Number(_0x5ae56c)}):_0x1d4901['push']({'date':_0x151b2c,'value':0x0}),_0x7fcf0[_0x173874(0x203)](_0x7fcf0[_0x173874(0x1e0)]()+0x1);}return _0x1d4901;}async[_0x4e10e3(0x1df)](_0x14e8a5,_0x1f1cda){const _0x3224c1=_0x4e10e3,_0x5bbaf3=(0x0,date_1['default'])()[_0x3224c1(0x1e2)](_0x14e8a5,'d')[_0x3224c1(0x190)]('d')['toDate'](),_0x1436d1=this[_0x3224c1(0x1a2)][_0x3224c1(0x1e5)](_0x3224c1(0x1a6))['select']('DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count')[_0x3224c1(0x1d9)](_0x3224c1(0x1b7),{'status':midjourney_constant_1[_0x3224c1(0x1e3)][_0x3224c1(0x1bb)]})[_0x3224c1(0x1bd)](_0x3224c1(0x199),{'startDate':_0x5bbaf3});_0x1f1cda!==undefined&&_0x1436d1[_0x3224c1(0x1bd)]('midjourney.saasId\x20=\x20:saasId',{'saasId':_0x1f1cda});_0x1436d1[_0x3224c1(0x1e9)]('date')[_0x3224c1(0x1f7)]('date');const _0x56dc4b=await _0x1436d1[_0x3224c1(0x1ce)](),_0x3d0d66=[],_0x2c4643=_0x5bbaf3;for(let _0x30b97a=0x0;_0x30b97a<_0x14e8a5;_0x30b97a++){const _0x8c5183=(0x0,date_1['formatDate'])(new Date(_0x2c4643),_0x3224c1(0x1a4)),_0x32aea3=_0x56dc4b[_0x3224c1(0x1c7)](_0x5adb13=>(0x0,date_1[_0x3224c1(0x19d)])(new Date(_0x5adb13[_0x3224c1(0x1bc)]),'M.DD')===_0x8c5183)?.['count']??0x0;_0x32aea3>0x0?_0x3d0d66['push']({'date':_0x8c5183,'value':Number(_0x32aea3)}):_0x3d0d66[_0x3224c1(0x1cb)]({'date':_0x8c5183,'value':0x0}),_0x2c4643[_0x3224c1(0x203)](_0x2c4643['getDate']()+0x1);}return _0x3d0d66;}async[_0x4e10e3(0x1ba)](_0x1232d5){const _0x7198c=_0x4e10e3,_0x4307c7=(0x0,date_1['formatDate'])(new Date(),_0x7198c(0x1c0)),_0x1b566e=(0x0,date_1['formatDate'])(new Date(Date[_0x7198c(0x1b8)]()-Number(_0x1232d5-0x1)*0x18*0x3c*0x3c*0x3e8),_0x7198c(0x1c0)),_0x1cb048=_0x7198c(0x1dc),_0x4da075=_0x7198c(0x1a1),_0x5a769a=await this[_0x7198c(0x18e)][_0x7198c(0x1b5)]([_0x7198c(0x1e4),_0x7198c(0x1dd)]),_0x3dd900=_0x5a769a[_0x7198c(0x1dd)],_0x309f0a=_0x5a769a[_0x7198c(0x1e4)];if(!_0x3dd900||!_0x309f0a)return[];if(!_0x3dd900)throw new common_1[(_0x7198c(0x1cd))](_0x7198c(0x197),common_1[_0x7198c(0x1f2)][_0x7198c(0x207)]);if(!_0x309f0a)throw new common_1[(_0x7198c(0x1cd))](_0x7198c(0x1b2),common_1['HttpStatus'][_0x7198c(0x207)]);const _0x51da10=_0x7198c(0x1c8)+_0x309f0a+_0x7198c(0x1f6)+_0x3dd900+_0x7198c(0x181)+_0x4da075+'&start_date='+_0x1b566e+_0x7198c(0x18b)+_0x4307c7+'&metrics='+_0x1cb048,_0x51c882=await axios_1[_0x7198c(0x1db)]['get'](_0x51da10),{error_code:_0x32d4ef,message:_0x584679}=_0x51c882[_0x7198c(0x1fd)];if(_0x32d4ef===0x6f)throw new common_1[(_0x7198c(0x1cd))](_0x584679||'百度授权码过期',common_1[_0x7198c(0x1f2)][_0x7198c(0x207)]);if(_0x32d4ef&&_0x32d4ef!==0xc8)throw new common_1['HttpException'](_0x584679||_0x7198c(0x1f4),common_1[_0x7198c(0x1f2)][_0x7198c(0x207)]);return _0x51c882['data'][_0x7198c(0x1a8)];}async[_0x4e10e3(0x17e)](_0x400cc6){const _0x537b0a=_0x4e10e3,_0x425c8f=await this[_0x537b0a(0x1b0)][_0x537b0a(0x1f3)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27'+_0x400cc6['startTime']+_0x537b0a(0x1d3)+_0x400cc6['endTime']+_0x537b0a(0x17f)),_0x1dfb6a=(0x0,date_1[_0x537b0a(0x1db)])(_0x400cc6[_0x537b0a(0x17a)])[_0x537b0a(0x1bf)]((0x0,date_1[_0x537b0a(0x1db)])(_0x400cc6[_0x537b0a(0x18a)]),_0x537b0a(0x1fa)),_0x12b0b5=_0x1dfb6a===0x0?_0x537b0a(0x1ff):_0x537b0a(0x18c),_0x100485=await this[_0x537b0a(0x1b0)][_0x537b0a(0x1f3)](_0x537b0a(0x1ab)+_0x12b0b5+_0x537b0a(0x17c)+_0x400cc6[_0x537b0a(0x17a)]+_0x537b0a(0x1d3)+_0x400cc6[_0x537b0a(0x18a)]+'\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20');return{'pie':_0x425c8f,'line':_0x100485};}};function _0x44d8(){const _0x4f6b2c=['chatLogEntity','countNewMidhourneysToday','where','../../common/utils','default','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','baiduSiteId','price','countMjDrawsByTimeRange','getDate','Repository','subtract','MidjourneyStatusEnum','baiduToken','createQueryBuilder','Between','chatlog.createdAt\x20>=\x20:startDate','EModelType','groupBy','IsNull','countInviteUsersTotal','sum','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','countChats','281171uusYlD','count','../../common/constants/midjourney.constant','HttpStatus','query','获取百度统计数据失败','userEntity','&site_id=','orderBy','toDate','__param','day','countNewChatsToday','chatlog','data','../../common/constants/balance.constant','%Y-%m-%d\x20%H:00','UserEntity','toFixed','OrderEntity','setDate','getOwnPropertyDescriptor','map','__decorate','BAD_REQUEST','defineProperty','startTime','228WNOpSn','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','countInviteUsersToday','modelUse','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20','DeductionKey','&method=','152sOjnzx','countOrders','countDrawsByTimeRange','getBaseStatistic','249678gYhNox','GlobalConfigService','../../common/constants/model.constant','chatlog.saasId\x20=\x20:saasId','endTime','&end_date=','%Y-%m-%d','chatlog.type\x20=\x20:type','globalConfigService','@nestjs/common','startOf','orderEntity','length','metadata','502704uILRWu','../globalConfig/globalConfig.service','MUSIC','请先配置百度统计siteId','../../common/utils/date','midjourney.createdAt\x20>=\x20:startDate','../user/user.entity','object','getChatStatistic','formatDate','Not','typeorm','select','overview/getTimeTrendRpt','midjourneyEntity','saasId','M.DD','countTodayCollection','midjourney','getReqSaasId','result','50iTSnCG','value','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27','nestjs-cls','CHAT_TYPE','__metadata','design:paramtypes','connection','PAINT_TYPE','请先配置百度统计accessToken','845819CfFXuY','countUsers','getConfigByKeys','function','midjourney.status\x20=\x20:status','now','clsService','getBaiduStatistics','DRAWED','date','andWhere','endOf','diff','YYYYMMDD','67025shtFAY','ClsService','180tdUyxs','axios','InjectRepository','258cdXBoT','find','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','decorate','countDraws','push','countTotalMusic','HttpException','getRawMany','51812WufgOX','countTodayMusic','countTotalCollection','countNewUsersToday','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','981582uNAbVu','2FwMbFJ','Injectable'];_0x44d8=function(){return _0x4f6b2c;};return _0x44d8();}StatisticService=__decorate([(0x0,common_1[_0x4e10e3(0x1d6)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(user_entity_1[_0x4e10e3(0x200)])),__param(0x1,(0x0,typeorm_1[_0x4e10e3(0x1c5)])(chatLog_entity_1['ChatLogEntity'])),__param(0x2,(0x0,typeorm_1[_0x4e10e3(0x1c5)])(order_entity_1[_0x4e10e3(0x202)])),__param(0x3,(0x0,typeorm_1[_0x4e10e3(0x1c5)])(midjourney_entity_1['MidjourneyEntity'])),__metadata(_0x4e10e3(0x1af),[typeorm_2[_0x4e10e3(0x1e1)],typeorm_2[_0x4e10e3(0x1e1)],typeorm_2[_0x4e10e3(0x1e1)],typeorm_2['Repository'],globalConfig_service_1[_0x4e10e3(0x187)],nestjs_cls_1[_0x4e10e3(0x1c2)],typeorm_2['Connection']])],StatisticService),exports['StatisticService']=StatisticService;