'use strict';const _0x5a6122=_0x1873;(function(_0x319ac9,_0x47a4e5){const _0x51c2e0=_0x1873,_0x51bfb9=_0x319ac9();while(!![]){try{const _0x4e9f54=parseInt(_0x51c2e0(0x22e))/0x1+-parseInt(_0x51c2e0(0x23e))/0x2+-parseInt(_0x51c2e0(0x1eb))/0x3+-parseInt(_0x51c2e0(0x214))/0x4+parseInt(_0x51c2e0(0x238))/0x5*(-parseInt(_0x51c2e0(0x248))/0x6)+-parseInt(_0x51c2e0(0x1ff))/0x7*(parseInt(_0x51c2e0(0x1f0))/0x8)+parseInt(_0x51c2e0(0x229))/0x9*(parseInt(_0x51c2e0(0x1f5))/0xa);if(_0x4e9f54===_0x47a4e5)break;else _0x51bfb9['push'](_0x51bfb9['shift']());}catch(_0x247b15){_0x51bfb9['push'](_0x51bfb9['shift']());}}}(_0xcbc5,0x26d32));var __decorate=this&&this['__decorate']||function(_0x47137a,_0x291414,_0x30dd72,_0x292928){const _0xb7ecfa=_0x1873;var _0x50755a=arguments[_0xb7ecfa(0x240)],_0x1137d4=_0x50755a<0x3?_0x291414:_0x292928===null?_0x292928=Object[_0xb7ecfa(0x202)](_0x291414,_0x30dd72):_0x292928,_0xcb86ae;if(typeof Reflect===_0xb7ecfa(0x204)&&typeof Reflect[_0xb7ecfa(0x1f3)]===_0xb7ecfa(0x21a))_0x1137d4=Reflect[_0xb7ecfa(0x1f3)](_0x47137a,_0x291414,_0x30dd72,_0x292928);else{for(var _0x78fcf7=_0x47137a[_0xb7ecfa(0x240)]-0x1;_0x78fcf7>=0x0;_0x78fcf7--)if(_0xcb86ae=_0x47137a[_0x78fcf7])_0x1137d4=(_0x50755a<0x3?_0xcb86ae(_0x1137d4):_0x50755a>0x3?_0xcb86ae(_0x291414,_0x30dd72,_0x1137d4):_0xcb86ae(_0x291414,_0x30dd72))||_0x1137d4;}return _0x50755a>0x3&&_0x1137d4&&Object[_0xb7ecfa(0x25f)](_0x291414,_0x30dd72,_0x1137d4),_0x1137d4;},__metadata=this&&this[_0x5a6122(0x1fc)]||function(_0x1fc1ff,_0x558226){const _0x35c34b=_0x5a6122;if(typeof Reflect==='object'&&typeof Reflect[_0x35c34b(0x245)]===_0x35c34b(0x21a))return Reflect['metadata'](_0x1fc1ff,_0x558226);},__param=this&&this[_0x5a6122(0x21c)]||function(_0x355410,_0x233fe0){return function(_0x5a7da5,_0x3dc93b){_0x233fe0(_0x5a7da5,_0x3dc93b,_0x355410);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x5a6122(0x207)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x5a6122(0x22f)),user_entity_1=require(_0x5a6122(0x255)),typeorm_2=require(_0x5a6122(0x220)),chatLog_entity_1=require(_0x5a6122(0x217)),balance_constant_1=require(_0x5a6122(0x24f)),date_1=require('../../common/utils/date'),axios_1=require(_0x5a6122(0x20c)),order_entity_1=require('../order/order.entity'),midjourney_entity_1=require('../midjourney/midjourney.entity'),midjourney_constant_1=require('../../common/constants/midjourney.constant'),model_constant_1=require('../../common/constants/model.constant'),globalConfig_service_1=require(_0x5a6122(0x250)),nestjs_cls_1=require(_0x5a6122(0x25e)),utils_1=require(_0x5a6122(0x26a));function _0x1873(_0x2dcae7,_0x4359fe){const _0xcbc55c=_0xcbc5();return _0x1873=function(_0x187308,_0x13bd20){_0x187308=_0x187308-0x1e1;let _0x2b7603=_0xcbc55c[_0x187308];return _0x2b7603;},_0x1873(_0x2dcae7,_0x4359fe);}function _0xcbc5(){const _0x3e3fdc=['subtract','object','countDrawsByTimeRange','UserEntity','StatisticService','value','overview/getTimeTrendRpt','count','DeductionKey','axios','chatlog','BAD_REQUEST','\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20<=\x20\x27','请先配置百度统计accessToken','diff','countNewDrawsToday','OrderEntity','1034896ouXZqd','EModelType','HttpStatus','../chatLog/entity/chatLog.entity','price','Repository','function','date','__param','midjourneyEntity','baiduToken','default','typeorm','countInviteUsersTotal','countChatsByTimeRange','ChatLogEntity','baiduSiteId','modelUse','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x20\x0a\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName;\x0a\x20\x20\x20\x20','GlobalConfigService','push','22347WCtHxt','get','\x27\x20)\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27','userEntity','countTotalCollection','67721MtvHMn','@nestjs/typeorm','&site_id=','MidjourneyEntity','countTodayCollection','orderBy','setDate','countChats','&start_date=','countTotalMusic','1571215oHhveo','sum','pv_count,visitor_count,ip_count,bounce_ratio,avg_visit_time','chatlog.createdAt\x20>=\x20:startDate','MUSIC','&end_date=','235192HJKePC','midjourney','length','countNewOrdersToday','andWhere','createQueryBuilder','where','metadata','orderEntity','%Y-%m-%d\x20%H:00','6ivJTSm','saasId','countDraws','chatLogEntity','PAINT_TYPE','countNewChatsToday','getBaseStatistic','../../common/constants/balance.constant','../globalConfig/globalConfig.service','getChatStatistic','\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20DATE_FORMAT(\x20createdAt,\x20\x27','getBaiduStatistics','query','../user/user.entity','&metrics=','https://openapi.baidu.com/rest/2.0/tongji/report/getData?access_token=','Between','select','countUsers','getReqSaasId','countMjDrawsByTimeRange','HttpException','nestjs-cls','defineProperty','formatDate','InjectRepository','chatlog.type\x20=\x20:type','midjourney.status\x20=\x20:status','getRawMany','data','MidjourneyStatusEnum','find','startOf','countOrders','../../common/utils','countTodayMusic','getDate','startTime','CHAT_TYPE','map','countNewUsersToday','ClsService','globalConfigService','Not','endTime','YYYYMMDD','IsNull','endOf','百度授权码过期','clsService','248895pwhcIG','countInviteUsersToday','result','day','countNewMidhourneysToday','880952mLlPBO','M.DD','groupBy','decorate','midjourney.saasId\x20=\x20:saasId','4370csloQH','DATE(chatlog.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','getConfigByKeys','midjourney.createdAt\x20>=\x20:startDate','\x27\x20\x0a\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20groupeName\x0a\x20\x20\x20\x20','toDate','DATE(midjourney.createdAt)\x20as\x20date,\x20COUNT(*)\x20as\x20count','__metadata','Injectable','toFixed','14BeVqYC','Connection','connection','getOwnPropertyDescriptor'];_0xcbc5=function(){return _0x3e3fdc;};return _0xcbc5();}let StatisticService=class StatisticService{constructor(_0x48e4a7,_0x52957a,_0x24ea8a,_0x4a5190,_0x5b67f4,_0x3ecb75,_0xf28b0b){const _0x2b7d7e=_0x5a6122;this['userEntity']=_0x48e4a7,this[_0x2b7d7e(0x24b)]=_0x52957a,this[_0x2b7d7e(0x246)]=_0x24ea8a,this[_0x2b7d7e(0x21d)]=_0x4a5190,this['globalConfigService']=_0x5b67f4,this[_0x2b7d7e(0x1ea)]=_0x3ecb75,this['connection']=_0xf28b0b;}async[_0x5a6122(0x24e)](_0x599879){const _0x31fe5c=_0x5a6122,_0x1c5a79=(0x0,utils_1['getReqSaasId'])(this[_0x31fe5c(0x1ea)]);_0x1c5a79!==0x0&&(_0x599879=_0x1c5a79);const _0x224093=await this[_0x31fe5c(0x25a)](_0x599879),_0x58340b=await this[_0x31fe5c(0x1e1)](_0x599879),_0x8a53bb=await this[_0x31fe5c(0x235)](_0x599879),_0x3b5412=await this['countNewChatsToday'](_0x599879),_0x284793=await this[_0x31fe5c(0x24a)](_0x599879),_0x2df6fe=await this['countNewDrawsToday'](_0x599879),_0x42dcfb=await this[_0x31fe5c(0x1ef)](_0x599879),_0x3d62ef=await this[_0x31fe5c(0x269)](_0x599879),_0x19d738=await this[_0x31fe5c(0x241)](_0x599879),_0x5a3f0f=await this[_0x31fe5c(0x232)](_0x599879),_0x5e9f4f=await this[_0x31fe5c(0x22d)](_0x599879),_0x45bf6a=await this[_0x31fe5c(0x26b)](_0x599879),_0x6dbc83=await this[_0x31fe5c(0x237)](_0x599879),_0x8c33e8=await this[_0x31fe5c(0x1ec)](_0x599879),_0x46093e=await this['countInviteUsersTotal'](_0x599879);return{'userCount':_0x224093,'newUserCount':_0x58340b,'chatCount':_0x8a53bb,'newChatCount':_0x3b5412,'drawCount':_0x284793,'newDrawCount':_0x42dcfb+_0x2df6fe,'orderCount':_0x3d62ef,'newOrderCount':_0x19d738,'todayBrokerage':0x0,'totalBrokerage':0x0,'todayCollection':_0x5a3f0f,'totalCollection':_0x5e9f4f,'todayMusic':_0x45bf6a,'totalMusic':_0x6dbc83,'todayVideo':0x0,'totalVideo':0x0,'todayInviteCount':_0x8c33e8,'totalInviteCount':_0x46093e};}async[_0x5a6122(0x25a)](_0xb19924){const _0x45519a=_0x5a6122,_0x177e78={};_0xb19924!==undefined&&(_0x177e78[_0x45519a(0x249)]=_0xb19924);const _0x2ab1ee=await this['userEntity'][_0x45519a(0x20a)]({'where':_0x177e78});return _0x2ab1ee;}async[_0x5a6122(0x221)](_0x347c08){const _0x452933=_0x5a6122,_0x254f17={'inviteCode':(0x0,typeorm_2[_0x452933(0x1e4)])('')};_0x347c08!==undefined&&(_0x254f17[_0x452933(0x249)]=_0x347c08);const _0x5962e6=await this[_0x452933(0x22c)]['count']({'where':_0x254f17});return _0x5962e6;}async[_0x5a6122(0x1ec)](_0xc9b8de){const _0x25239a=_0x5a6122,_0x252a9b=(0x0,date_1['default'])()[_0x25239a(0x268)]('d')[_0x25239a(0x1fa)](),_0x25216c=(0x0,date_1[_0x25239a(0x21f)])()[_0x25239a(0x1e8)]('d')[_0x25239a(0x1fa)](),_0x22191e={'createdAt':(0x0,typeorm_2[_0x25239a(0x258)])(_0x252a9b,_0x25216c),'inviteCode':(0x0,typeorm_2[_0x25239a(0x1e4)])('')};_0xc9b8de!==undefined&&(_0x22191e[_0x25239a(0x249)]=_0xc9b8de);const _0x1658d3=await this['userEntity'][_0x25239a(0x20a)]({'where':_0x22191e});return _0x1658d3;}async['countNewUsersToday'](_0x10262a){const _0x183beb=_0x5a6122,_0xb41da8=(0x0,date_1[_0x183beb(0x21f)])()[_0x183beb(0x268)]('d')[_0x183beb(0x1fa)](),_0x47fa62=(0x0,date_1[_0x183beb(0x21f)])()[_0x183beb(0x1e8)]('d')[_0x183beb(0x1fa)](),_0x11c9c9={'createdAt':(0x0,typeorm_2[_0x183beb(0x258)])(_0xb41da8,_0x47fa62)};_0x10262a!==undefined&&(_0x11c9c9[_0x183beb(0x249)]=_0x10262a);const _0x17ea20=await this[_0x183beb(0x22c)][_0x183beb(0x20a)]({'where':_0x11c9c9});return _0x17ea20;}async['countChats'](_0x55adfc){const _0x464abf=_0x5a6122,_0x5ce75b={'type':balance_constant_1[_0x464abf(0x20b)][_0x464abf(0x26e)]};_0x55adfc!==undefined&&(_0x5ce75b[_0x464abf(0x249)]=_0x55adfc);const _0x20033d=await this[_0x464abf(0x24b)]['count']({'where':_0x5ce75b});return _0x20033d;}async[_0x5a6122(0x24d)](_0x2caed6){const _0x521a17=_0x5a6122,_0x12fd32=(0x0,date_1[_0x521a17(0x21f)])()[_0x521a17(0x268)]('d')['toDate'](),_0xc99ca4=(0x0,date_1[_0x521a17(0x21f)])()[_0x521a17(0x1e8)]('d')['toDate'](),_0x2fb69d={'type':balance_constant_1[_0x521a17(0x20b)]['CHAT_TYPE'],'createdAt':(0x0,typeorm_2[_0x521a17(0x258)])(_0x12fd32,_0xc99ca4)};_0x2caed6!==undefined&&(_0x2fb69d[_0x521a17(0x249)]=_0x2caed6);const _0x2f87d0=await this['chatLogEntity']['count']({'where':_0x2fb69d});return _0x2f87d0;}async['countDraws'](_0x4be855){const _0x22960a=_0x5a6122,_0x5ef68d={'type':balance_constant_1[_0x22960a(0x20b)]['PAINT_TYPE']};_0x4be855!==undefined&&(_0x5ef68d[_0x22960a(0x249)]=_0x4be855);const _0xcce6a9=await this[_0x22960a(0x24b)][_0x22960a(0x20a)]({'where':_0x5ef68d});return _0xcce6a9;}async[_0x5a6122(0x212)](_0x1b0ec8){const _0x388501=_0x5a6122,_0x3b91bb=(0x0,date_1[_0x388501(0x21f)])()[_0x388501(0x268)]('d')[_0x388501(0x1fa)](),_0x3043c4=(0x0,date_1[_0x388501(0x21f)])()['endOf']('d')[_0x388501(0x1fa)](),_0x2ea709={'type':balance_constant_1[_0x388501(0x20b)][_0x388501(0x24c)],'createdAt':(0x0,typeorm_2['Between'])(_0x3b91bb,_0x3043c4)};_0x1b0ec8!==undefined&&(_0x2ea709['saasId']=_0x1b0ec8);const _0x3064a1=await this[_0x388501(0x24b)][_0x388501(0x20a)]({'where':_0x2ea709});return _0x3064a1;}async[_0x5a6122(0x1ef)](_0x4333ba){const _0xa90fa9=_0x5a6122,_0xc720c2=(0x0,date_1[_0xa90fa9(0x21f)])()['startOf']('d')[_0xa90fa9(0x1fa)](),_0x3ad0ac=(0x0,date_1['default'])()['endOf']('d')['toDate'](),_0x49c79f={'createdAt':(0x0,typeorm_2[_0xa90fa9(0x258)])(_0xc720c2,_0x3ad0ac)};_0x4333ba!==undefined&&(_0x49c79f[_0xa90fa9(0x249)]=_0x4333ba);const _0x508482=await this[_0xa90fa9(0x21d)]['count']({'where':_0x49c79f});return _0x508482;}async['countOrders'](_0x11726f){const _0x35033d=_0x5a6122,_0x1d95a4={};_0x11726f!==undefined&&(_0x1d95a4[_0x35033d(0x249)]=_0x11726f);const _0x1f4ff0=await this['orderEntity'][_0x35033d(0x20a)]({'where':_0x1d95a4});return _0x1f4ff0;}async[_0x5a6122(0x241)](_0x2dad15){const _0x54b9dd=_0x5a6122,_0x20351f=(0x0,date_1['default'])()[_0x54b9dd(0x268)]('d')[_0x54b9dd(0x1fa)](),_0x189b30=(0x0,date_1[_0x54b9dd(0x21f)])()[_0x54b9dd(0x1e8)]('d')[_0x54b9dd(0x1fa)](),_0x1c3274={'createdAt':(0x0,typeorm_2[_0x54b9dd(0x258)])(_0x20351f,_0x189b30),'status':0x1};_0x2dad15!==undefined&&(_0x1c3274[_0x54b9dd(0x249)]=_0x2dad15);const _0x501f41=await this[_0x54b9dd(0x246)]['count']({'where':_0x1c3274});return _0x501f41;}async[_0x5a6122(0x26b)](_0x5aee6d){const _0x5e7cd8=_0x5a6122,_0x274955=(0x0,date_1['default'])()[_0x5e7cd8(0x268)]('d')['toDate'](),_0x43cfb4=(0x0,date_1[_0x5e7cd8(0x21f)])()[_0x5e7cd8(0x1e8)]('d')['toDate'](),_0x3e4c79={'answer':(0x0,typeorm_2[_0x5e7cd8(0x1e4)])((0x0,typeorm_2[_0x5e7cd8(0x1e7)])()),'modelType':model_constant_1[_0x5e7cd8(0x215)][_0x5e7cd8(0x23c)],'createdAt':(0x0,typeorm_2[_0x5e7cd8(0x258)])(_0x274955,_0x43cfb4)};_0x5aee6d!==undefined&&(_0x3e4c79[_0x5e7cd8(0x249)]=_0x5aee6d);const _0x35b9cb=await this[_0x5e7cd8(0x24b)][_0x5e7cd8(0x20a)]({'where':_0x3e4c79});return _0x35b9cb;}async[_0x5a6122(0x237)](_0x4bae0e){const _0x297e10=_0x5a6122,_0x4f2bca={'answer':(0x0,typeorm_2[_0x297e10(0x1e4)])((0x0,typeorm_2[_0x297e10(0x1e7)])()),'modelType':model_constant_1[_0x297e10(0x215)][_0x297e10(0x23c)]};_0x4bae0e!==undefined&&(_0x4f2bca[_0x297e10(0x249)]=_0x4bae0e);const _0x45a389=await this[_0x297e10(0x24b)][_0x297e10(0x20a)]({'where':_0x4f2bca});return _0x45a389;}async['countTodayCollection'](_0xe191fc){const _0x1aa28c=_0x5a6122,_0x52b94f=(0x0,date_1['default'])()[_0x1aa28c(0x268)]('d')[_0x1aa28c(0x1fa)](),_0x4979d6=(0x0,date_1['default'])()[_0x1aa28c(0x1e8)]('d')[_0x1aa28c(0x1fa)](),_0x14881b={'status':0x1,'updatedAt':(0x0,typeorm_2[_0x1aa28c(0x258)])(_0x52b94f,_0x4979d6)};_0xe191fc!==undefined&&(_0x14881b[_0x1aa28c(0x249)]=_0xe191fc);const _0x3423a5=await this[_0x1aa28c(0x246)][_0x1aa28c(0x239)](_0x1aa28c(0x218),_0x14881b)||0x0;return _0x3423a5[_0x1aa28c(0x1fe)](0x2);}async[_0x5a6122(0x22d)](_0x430c05){const _0x266665=_0x5a6122,_0x707ce3={'status':0x1};_0x430c05!==undefined&&(_0x707ce3[_0x266665(0x249)]=_0x430c05);const _0x50c9a5=await this[_0x266665(0x246)][_0x266665(0x239)](_0x266665(0x218),_0x707ce3)||0x0;return _0x50c9a5['toFixed'](0x2);}async[_0x5a6122(0x251)]({days:days=0x7,saasId:_0x1deb7d}){const _0x841649=_0x5a6122,_0x3549e2=(0x0,utils_1[_0x841649(0x25b)])(this['clsService']);_0x3549e2!==0x0&&(_0x1deb7d=_0x3549e2);const _0x251c2e=await this[_0x841649(0x222)](days,_0x1deb7d),_0x539852=await this[_0x841649(0x205)](days,_0x1deb7d),_0x393106=await this[_0x841649(0x25c)](days,_0x1deb7d);return{'date':_0x251c2e['map'](_0x1b70f2=>_0x1b70f2[_0x841649(0x21b)]),'chat':_0x251c2e[_0x841649(0x26f)](_0x1d92ac=>_0x1d92ac[_0x841649(0x208)]),'draw':_0x539852[_0x841649(0x26f)]((_0x68d848,_0x15e6ad)=>{const _0x11732f=_0x841649;return _0x68d848[_0x11732f(0x208)]+_0x393106[_0x15e6ad][_0x11732f(0x208)];})};}async['countChatsByTimeRange'](_0x40f9d1,_0x5ab2c6){const _0x582d99=_0x5a6122,_0x46d60a=(0x0,date_1['default'])()[_0x582d99(0x203)](_0x40f9d1,'d')[_0x582d99(0x268)]('d')[_0x582d99(0x1fa)](),_0x199210=this[_0x582d99(0x24b)][_0x582d99(0x243)](_0x582d99(0x20d))[_0x582d99(0x259)](_0x582d99(0x1f6))['where'](_0x582d99(0x262),{'type':balance_constant_1['DeductionKey']['CHAT_TYPE']})['andWhere']('chatlog.createdAt\x20>=\x20:startDate',{'startDate':_0x46d60a});_0x5ab2c6!==undefined&&_0x199210[_0x582d99(0x242)]('chatlog.saasId\x20=\x20:saasId',{'saasId':_0x5ab2c6});_0x199210['groupBy'](_0x582d99(0x21b))[_0x582d99(0x233)]('date');const _0x3f852c=await _0x199210['getRawMany'](),_0xeb9e35=[],_0x20f668=_0x46d60a;for(let _0x3a3576=0x0;_0x3a3576<_0x40f9d1;_0x3a3576++){const _0x138b49=(0x0,date_1['formatDate'])(new Date(_0x20f668),'M.DD'),_0x5e20fd=_0x3f852c['find'](_0x409509=>(0x0,date_1[_0x582d99(0x260)])(new Date(_0x409509[_0x582d99(0x21b)]),'M.DD')===_0x138b49)?.['count']??0x0;_0x5e20fd>0x0?_0xeb9e35[_0x582d99(0x228)]({'date':_0x138b49,'value':Number(_0x5e20fd)}):_0xeb9e35['push']({'date':_0x138b49,'value':0x0}),_0x20f668[_0x582d99(0x234)](_0x20f668[_0x582d99(0x26c)]()+0x1);}return _0xeb9e35;}async[_0x5a6122(0x205)](_0x159f2c,_0x13f5de){const _0x4ce78b=_0x5a6122,_0x5d3b54=(0x0,date_1[_0x4ce78b(0x21f)])()[_0x4ce78b(0x203)](_0x159f2c,'d')[_0x4ce78b(0x268)]('d')['toDate'](),_0x4283c0=this[_0x4ce78b(0x24b)][_0x4ce78b(0x243)](_0x4ce78b(0x20d))[_0x4ce78b(0x259)](_0x4ce78b(0x1f6))['where']('chatlog.type\x20=\x20:type',{'type':balance_constant_1[_0x4ce78b(0x20b)][_0x4ce78b(0x24c)]})[_0x4ce78b(0x242)](_0x4ce78b(0x23b),{'startDate':_0x5d3b54});_0x13f5de!==undefined&&_0x4283c0[_0x4ce78b(0x242)]('chatlog.saasId\x20=\x20:saasId',{'saasId':_0x13f5de});_0x4283c0[_0x4ce78b(0x1f2)](_0x4ce78b(0x21b))[_0x4ce78b(0x233)](_0x4ce78b(0x21b));const _0x22197e=await _0x4283c0['getRawMany'](),_0x68d1c3=[],_0x28ab2d=_0x5d3b54;for(let _0x3a39f4=0x0;_0x3a39f4<_0x159f2c;_0x3a39f4++){const _0x1456d0=(0x0,date_1[_0x4ce78b(0x260)])(new Date(_0x28ab2d),'M.DD'),_0xc96400=_0x22197e[_0x4ce78b(0x267)](_0x1ae00d=>(0x0,date_1[_0x4ce78b(0x260)])(new Date(_0x1ae00d[_0x4ce78b(0x21b)]),_0x4ce78b(0x1f1))===_0x1456d0)?.['count']??0x0;_0xc96400>0x0?_0x68d1c3[_0x4ce78b(0x228)]({'date':_0x1456d0,'value':Number(_0xc96400)}):_0x68d1c3[_0x4ce78b(0x228)]({'date':_0x1456d0,'value':0x0}),_0x28ab2d['setDate'](_0x28ab2d['getDate']()+0x1);}return _0x68d1c3;}async[_0x5a6122(0x25c)](_0x2caf6a,_0x171f82){const _0x6910cc=_0x5a6122,_0x256145=(0x0,date_1['default'])()['subtract'](_0x2caf6a,'d')['startOf']('d')[_0x6910cc(0x1fa)](),_0xc566e8=this['midjourneyEntity']['createQueryBuilder'](_0x6910cc(0x23f))[_0x6910cc(0x259)](_0x6910cc(0x1fb))[_0x6910cc(0x244)](_0x6910cc(0x263),{'status':midjourney_constant_1[_0x6910cc(0x266)]['DRAWED']})[_0x6910cc(0x242)](_0x6910cc(0x1f8),{'startDate':_0x256145});_0x171f82!==undefined&&_0xc566e8[_0x6910cc(0x242)](_0x6910cc(0x1f4),{'saasId':_0x171f82});_0xc566e8[_0x6910cc(0x1f2)](_0x6910cc(0x21b))['orderBy']('date');const _0x2ea4c5=await _0xc566e8[_0x6910cc(0x264)](),_0x40e163=[],_0x2db17a=_0x256145;for(let _0x44542d=0x0;_0x44542d<_0x2caf6a;_0x44542d++){const _0x5b1f9d=(0x0,date_1[_0x6910cc(0x260)])(new Date(_0x2db17a),_0x6910cc(0x1f1)),_0x3e6c78=_0x2ea4c5['find'](_0x4b3c29=>(0x0,date_1[_0x6910cc(0x260)])(new Date(_0x4b3c29[_0x6910cc(0x21b)]),'M.DD')===_0x5b1f9d)?.[_0x6910cc(0x20a)]??0x0;_0x3e6c78>0x0?_0x40e163['push']({'date':_0x5b1f9d,'value':Number(_0x3e6c78)}):_0x40e163[_0x6910cc(0x228)]({'date':_0x5b1f9d,'value':0x0}),_0x2db17a[_0x6910cc(0x234)](_0x2db17a['getDate']()+0x1);}return _0x40e163;}async[_0x5a6122(0x253)](_0x8a1226){const _0x2e5439=_0x5a6122,_0x32b196=(0x0,date_1[_0x2e5439(0x260)])(new Date(),_0x2e5439(0x1e6)),_0x2e3133=(0x0,date_1[_0x2e5439(0x260)])(new Date(Date['now']()-Number(_0x8a1226-0x1)*0x18*0x3c*0x3c*0x3e8),'YYYYMMDD'),_0x554057=_0x2e5439(0x23a),_0x331505=_0x2e5439(0x209),_0x4da387=await this[_0x2e5439(0x1e3)][_0x2e5439(0x1f7)]([_0x2e5439(0x21e),_0x2e5439(0x224)]),_0x440072=_0x4da387['baiduSiteId'],_0x216aa8=_0x4da387[_0x2e5439(0x21e)];if(!_0x440072||!_0x216aa8)return[];if(!_0x440072)throw new common_1['HttpException']('请先配置百度统计siteId',common_1[_0x2e5439(0x216)][_0x2e5439(0x20e)]);if(!_0x216aa8)throw new common_1['HttpException'](_0x2e5439(0x210),common_1[_0x2e5439(0x216)][_0x2e5439(0x20e)]);const _0x55b549=_0x2e5439(0x257)+_0x216aa8+_0x2e5439(0x230)+_0x440072+'&method='+_0x331505+_0x2e5439(0x236)+_0x2e3133+_0x2e5439(0x23d)+_0x32b196+_0x2e5439(0x256)+_0x554057,_0x2d7352=await axios_1[_0x2e5439(0x21f)][_0x2e5439(0x22a)](_0x55b549),{error_code:_0x2720e0,message:_0x345b3c}=_0x2d7352[_0x2e5439(0x265)];if(_0x2720e0===0x6f)throw new common_1['HttpException'](_0x345b3c||_0x2e5439(0x1e9),common_1[_0x2e5439(0x216)][_0x2e5439(0x20e)]);if(_0x2720e0&&_0x2720e0!==0xc8)throw new common_1[(_0x2e5439(0x25d))](_0x345b3c||'获取百度统计数据失败',common_1[_0x2e5439(0x216)][_0x2e5439(0x20e)]);return _0x2d7352[_0x2e5439(0x265)][_0x2e5439(0x1ed)];}async[_0x5a6122(0x225)](_0x1189a6){const _0x1e9dd4=_0x5a6122,_0x2bcd0d=await this[_0x1e9dd4(0x201)][_0x1e9dd4(0x254)]('\x0a\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20model\x20AS\x20groupeName,\x0a\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20chatlog\x20\x0a\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20role\x20=\x20\x27user\x27\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20AND\x20createdAt\x20>=\x20\x27'+_0x1189a6[_0x1e9dd4(0x26d)]+_0x1e9dd4(0x20f)+_0x1189a6[_0x1e9dd4(0x1e5)]+_0x1e9dd4(0x1f9)),_0x27d06e=(0x0,date_1[_0x1e9dd4(0x21f)])(_0x1189a6[_0x1e9dd4(0x26d)])[_0x1e9dd4(0x211)]((0x0,date_1[_0x1e9dd4(0x21f)])(_0x1189a6[_0x1e9dd4(0x1e5)]),_0x1e9dd4(0x1ee)),_0x2b1958=_0x27d06e===0x0?_0x1e9dd4(0x247):'%Y-%m-%d',_0x48f8b7=await this[_0x1e9dd4(0x201)][_0x1e9dd4(0x254)](_0x1e9dd4(0x252)+_0x2b1958+_0x1e9dd4(0x22b)+_0x1189a6['startTime']+_0x1e9dd4(0x20f)+_0x1189a6[_0x1e9dd4(0x1e5)]+_0x1e9dd4(0x226));return{'pie':_0x2bcd0d,'line':_0x48f8b7};}};StatisticService=__decorate([(0x0,common_1[_0x5a6122(0x1fd)])(),__param(0x0,(0x0,typeorm_1[_0x5a6122(0x261)])(user_entity_1[_0x5a6122(0x206)])),__param(0x1,(0x0,typeorm_1[_0x5a6122(0x261)])(chatLog_entity_1[_0x5a6122(0x223)])),__param(0x2,(0x0,typeorm_1[_0x5a6122(0x261)])(order_entity_1[_0x5a6122(0x213)])),__param(0x3,(0x0,typeorm_1[_0x5a6122(0x261)])(midjourney_entity_1[_0x5a6122(0x231)])),__metadata('design:paramtypes',[typeorm_2[_0x5a6122(0x219)],typeorm_2[_0x5a6122(0x219)],typeorm_2[_0x5a6122(0x219)],typeorm_2[_0x5a6122(0x219)],globalConfig_service_1[_0x5a6122(0x227)],nestjs_cls_1[_0x5a6122(0x1e2)],typeorm_2[_0x5a6122(0x200)]])],StatisticService),exports[_0x5a6122(0x207)]=StatisticService;