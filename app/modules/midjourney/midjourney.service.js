'use strict';function _0x1982(_0x4e381b,_0x22dfc6){const _0x30b17e=_0x30b1();return _0x1982=function(_0x198232,_0x384b52){_0x198232=_0x198232-0x6f;let _0xc02189=_0x30b17e[_0x198232];return _0xc02189;},_0x1982(_0x4e381b,_0x22dfc6);}function _0x30b1(){const _0x1e0d2a=['任务已达最大并发数，请等待其他任务完成后再提交新任务！','user','globalConfigService','userService','push','getOneDraw','EFavorite','account','mjpId','isPlatform','./dto/addDrawQueue.dto','壁纸绘画','transaction','要使用MJ绘画功能，至少需要配置一个MJ账号,并且启用该账号','actionTask','aiLogService','sdTaskSubmit','length','findOneBy','MODAL','syncMjTask','log','notifyWF','convertMode4Transfer','replace','workflowForm','join','mjLimitCount','concurrentLimit','AiLogService','../../common/store','workflowModelDetail','decorate','syncWorkFlowDict','\x20--sref\x20','connection','findAndCount','FaceSwap','filter','queryMjIncantationAll','syncTaskInfo','绘画制作','files','isChinese','HttpException','非法操作！','deduct','IMAGE_ACTION','3688IrkSxd','aiTaskDetail','Logger','触站::运用领域、风格画风、作用主体、作用类别字典同步失败','imageUrl','mjModel','getByRelateId','metadata','durationSpent','mjIncantationEntity','\x20--iw\x20','__decorate','Repository','findOne','../api/mjpAccount.service','Custom\x20Zoom','触站::模型信息同步完成','id不能为空！','delLog','notifySD','dictType','deductBalance4SD','addMjAccount','string','TEXT_TO_IMAGE','CZTaskService','syncModelsByTag','modelName','pageCount','effectCategory','./mjPrompts.entity','updateReconnect','HttpStatus','workflowModelUpdate','all','guildId','syncMjpAccountManual','小工具已禁用！','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','freeUsed','FileService','turbo','applicationFields','推荐关键词已存在，不可重复添加','query','findBy','../user/user.service','fileInfo','isSuper','fast_vip_free','getUserListByIds','extraParam','url','SD任务通知内容：','application_fields','./mjSuggestWord.entity','turbo_vip_free','handleImagesUploadTask','mjParamEntity','effectCategoryName','RELAX','mjProxy','workflowDetail','InjectRepository','failReason','查询灵感分类失败','ids','phone','customId','workflowDicts','FanyiService','mjSuggestWordEntity','map','avatar','MEGA','applicationFieldsName','绘制的任务不存在！','inputs','__metadata','setting','查询咒语失败','fastRemainTime','version','createdAt','4485324EOuQdL','design:paramtypes','type','copyAccountInfo','renewDate','MjInspireClassifyEntity','set','cover','botType','fast','../redisCache/redisCache.service','syncTask','vipFreeUsed','Blend','当前图片不存在！','prompt包含敏感词','EModelType','object','description','value','MidjourneyService','rows','visitNum','./dto/DrawTaskPage.dto','syncWfTask','del','queryMjIncantationClassify','updatedAt','fileService','getMjIncantationClassify','./mjIncantation.entity','initInspireData','validateBalance4MJ','queryMjIncantationByClassify','Not','isManage','timeoutMinutes','mjpAccountService','userId','vipExpire','\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20','名称不能重复','checkBadWords','saveSuggestWords','imagine','fetch','../aiLog/aiLog.service','modifyMjAccount','lifetimeUsage','describe','midjourneyEntity','MjConfig','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','1699170CVMZha','Like','账号不存在','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27','modelDel','queryMjIncantationClassifyAllByLevel','getMjInspireClassify','../models/models.service','Modal已处理，无需更新','versionId','../../common/constants/midjourney.constant','page','modifyMjIncantationClassify','DESC','modelVersion','modelPage','workflowTaskDetail','workflowRun','没有满足条件的MJ账号，请联系管理员！','mjpTaskId','syncModels','未查询到咒语一级分类','clsService','modifyMjInspireClassify','setImageFavorite','username','removeMjAccount','MjIncantationClassifyEntity','dictService','不需要灵感广场分类','agreeNum','\x20OFFSET\x20','notify','wfTaskUpdateJob:\x20','BAD_REQUEST','分页参数错误','triggerWords','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.createdAt\x20DESC\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','fanyiService','getReqSaasId','https://cdn.discordapp.com','enable','3uccEzj','forEach','../fanyi/fanyi.service','触站::运用领域、风格画风、作用主体、作用类别字典同步完成','totalTime','@nestjs/common','../file/file.service','\x20--sw\x20','MjpTaskService','addMjInspireClassify','lifetimeVip','aiDraw','state','info','\x20--cw\x20','key','mjProxyImgUrl','触站工作流任务通知异常:\x20','绘制中的图片任务、禁止删除！','initHasAccount','level','paintingSign','relax_vip_free','mjTaskUpdateJob:\x20','fullPrompt','querySuggestWords','effectMainBody','\x20--cref\x20','形象设计','parse','删除成功！','874896wToSvp','find','../dict/dict.service','recDraw','checkIsActionDone','MjParamEntity','Injectable','taskId','subscribePlan','getUserById','values','提交动作失败','isDefined','CzStateMap','operated','workflowDel','checkUserStatus','workflowSave','imageSeed','cancel','MjModelEntity','removeMjInspireClassify','drawTaskList','hideString','timeout','11gGjdLB','https://cdn.discordapp.com%','classifyName','function','trubo','model','Mj任务通知异常:\x20','error','list4workflow','modalTask','favoriteListByTypeAndIds','MjIncantationEntity','get','queryMjAccountList','useCount','dictName','result','UserService','Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','IsNull','8676yDYPye','development','自动同步账号信息失败：','DRAW','update','finally','createRandomUid','workflowPage','BadwordsService','get4workflow','PRO','nestjs-cls','../api/mjpTask.service','disabled','style','MidjourneyEntity','@nestjs/typeorm','无绘图记录','MjpAccountService','modelsService','queryMjInspireClassify','../badwords/badwords.service','EBotType','toString','czTaskService','add','assign','originPrompt','任务类型错误','2oNhFZq','queryModels','buffer','effect_category','finalPrompt','初始化灵感广场分类成功','datas','weight','删除记录失败！','FAST','relax','styleName','lock','orderPlan','remark','mode','convertToEnglish','name','finishTime','parseMjStatus','has','mjModelEntity','Modal\x20状态\x20手动同步任务信息','env','queryMjIncantation','当前图片已经执行过相同指令！','AddDrawQueueDto','userInfo','MidJourneyDrawEnum','nickname','action','drawSquarePage','saasId','status','删除失败！','getAgreeByRelateId','mjNotSaveImg','insightFace','syncMjpAccountAutomatic','触站::模型信息同步失败','删除推荐关键词失败','message','vipFreeNum','ENV','WORKFLOW','创建图混图任务失败','\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.createdAt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','创建图生文任务失败','商拍摄影','affected','精选分享','deductBalance4MJ','save4workflow','动漫漫画','MJ_TASK_UPDATE','properties','save','modelSave','prompt','./mjIncantationClassify.entity','SUCCESS','typeorm','onModuleInit','syncMjpAccount','buttons','badwordsService','../../common/utils','MjPromptsEntity','mjInspireClassifyEntity','dictValue','getConfigByKeys','code','Connection','transferImg','aiInpaint','channelId','remix','MID_JOURNEY','DRAWING','getModelById','../globalConfig/globalConfig.service','触站工作流任务通知内容：','mjpId:\x20','removeMjIncantation','progress','handleAddDrawTask','syncSdTask','concat','workflowId','authorization','split','denoisingStrength','addMjIncantation','modifyMjIncantation','36876FsBFIa','135ZcOeTd','relateId','stringify','rec','effect_main_body','../../common/constants/redisKey.constant','原始任务不存在！','blend','listByCondition','distributeAccount','emoji','MidjourneyStatusEnum','addDrawQueue','catch','from','deductBalance4WorkFlow','DESCRIBE','IMAGE_TO_TEXT','startTime','displaySort','../../common/constants/user.constant','195924ePFBeU','Imagine\x20all','IMAGE_MIX_IMAGE','redisCacheService','TURBO','Imagine','modal','getDetailByIds','VIP_FREE','setMjAccountEnable','size','defineProperty','推荐关键词不存在','jobIds','mjPromptsEntity','label','incantationCn','squareType','delete','addRefer','getMjAccount','队列已满，请稍后尝试','mjpTaskService','count','DrawSpeed','pid','getUserId','mjIncantationClassifyEntity','then','5180945tYIuYk'];_0x30b1=function(){return _0x1e0d2a;};return _0x30b1();}const _0x5ee26c=_0x1982;(function(_0x1a26d2,_0x62e3e4){const _0x129b4f=_0x1982,_0x1234e8=_0x1a26d2();while(!![]){try{const _0x4f9bab=parseInt(_0x129b4f(0x215))/0x1*(parseInt(_0x129b4f(0x81))/0x2)+-parseInt(_0x129b4f(0x1f6))/0x3*(-parseInt(_0x129b4f(0xf5))/0x4)+-parseInt(_0x129b4f(0xe0))/0x5*(-parseInt(_0x129b4f(0xdf))/0x6)+parseInt(_0x129b4f(0x112))/0x7+parseInt(_0x129b4f(0x143))/0x8*(-parseInt(_0x129b4f(0x242))/0x9)+-parseInt(_0x129b4f(0x1cc))/0xa+-parseInt(_0x129b4f(0x22e))/0xb*(parseInt(_0x129b4f(0x197))/0xc);if(_0x4f9bab===_0x62e3e4)break;else _0x1234e8['push'](_0x1234e8['shift']());}catch(_0x4a09b7){_0x1234e8['push'](_0x1234e8['shift']());}}}(_0x30b1,0xcd880));var __decorate=this&&this[_0x5ee26c(0x14e)]||function(_0x41a3a2,_0x12fb27,_0xa39373,_0x5ed660){const _0x4fc498=_0x5ee26c;var _0x2f6a80=arguments[_0x4fc498(0x124)],_0x2e0e39=_0x2f6a80<0x3?_0x12fb27:_0x5ed660===null?_0x5ed660=Object['getOwnPropertyDescriptor'](_0x12fb27,_0xa39373):_0x5ed660,_0x135c5f;if(typeof Reflect===_0x4fc498(0x1a8)&&typeof Reflect[_0x4fc498(0x133)]===_0x4fc498(0x231))_0x2e0e39=Reflect[_0x4fc498(0x133)](_0x41a3a2,_0x12fb27,_0xa39373,_0x5ed660);else{for(var _0x484179=_0x41a3a2['length']-0x1;_0x484179>=0x0;_0x484179--)if(_0x135c5f=_0x41a3a2[_0x484179])_0x2e0e39=(_0x2f6a80<0x3?_0x135c5f(_0x2e0e39):_0x2f6a80>0x3?_0x135c5f(_0x12fb27,_0xa39373,_0x2e0e39):_0x135c5f(_0x12fb27,_0xa39373))||_0x2e0e39;}return _0x2f6a80>0x3&&_0x2e0e39&&Object[_0x4fc498(0x100)](_0x12fb27,_0xa39373,_0x2e0e39),_0x2e0e39;},__metadata=this&&this[_0x5ee26c(0x191)]||function(_0x12bfe2,_0x21a2c1){const _0x63a628=_0x5ee26c;if(typeof Reflect===_0x63a628(0x1a8)&&typeof Reflect[_0x63a628(0x14a)]===_0x63a628(0x231))return Reflect[_0x63a628(0x14a)](_0x12bfe2,_0x21a2c1);},__param=this&&this['__param']||function(_0x35de47,_0x566483){return function(_0x164a4f,_0x1a14bc){_0x566483(_0x164a4f,_0x1a14bc,_0x35de47);};};Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x5ee26c(0x1ab)]=void 0x0;const common_1=require(_0x5ee26c(0x1fb)),typeorm_1=require(_0x5ee26c(0x74)),midjourney_entity_1=require('./midjourney.entity'),typeorm_2=require(_0x5ee26c(0xbe)),globalConfig_service_1=require(_0x5ee26c(0xd1)),midjourney_constant_1=require(_0x5ee26c(0x1d6)),file_service_1=require(_0x5ee26c(0x1fc)),badwords_service_1=require(_0x5ee26c(0x79)),utils_1=require(_0x5ee26c(0xc3)),mjPrompts_entity_1=require(_0x5ee26c(0x161)),mjParam_entity_1=require('./mjParam.entity'),mjIncantationClassify_entity_1=require(_0x5ee26c(0xbc)),mjInspireClassify_entity_1=require('./mjInspireClassify.entity'),mjIncantation_entity_1=require(_0x5ee26c(0x1b5)),fanyi_service_1=require(_0x5ee26c(0x1f8)),mjSuggestWord_entity_1=require(_0x5ee26c(0x17a)),user_service_1=require(_0x5ee26c(0x171)),redisCache_service_1=require(_0x5ee26c(0x1a1)),mjpAccount_service_1=require(_0x5ee26c(0x151)),mjpTask_service_1=require(_0x5ee26c(0x70)),addDrawQueue_dto_1=require(_0x5ee26c(0x11d)),store_1=require(_0x5ee26c(0x131)),redisKey_constant_1=require(_0x5ee26c(0xe5)),aiLog_service_1=require(_0x5ee26c(0x1c5)),model_constant_1=require('../../common/constants/model.constant'),nestjs_cls_1=require(_0x5ee26c(0x6f)),czTask_service_1=require('../api/czTask.service'),models_service_1=require(_0x5ee26c(0x1d3)),DrawTaskPage_dto_1=require(_0x5ee26c(0x1ae)),user_constant_1=require(_0x5ee26c(0xf4)),dict_service_1=require(_0x5ee26c(0x217)),mjModel_entity_1=require('./mjModel.entity');let MidjourneyService=class MidjourneyService{constructor(_0x5c9f91,_0x550753,_0x2ba517,_0x47e932,_0x323ad9,_0x11a1bc,_0xfa476d,_0x2d2663,_0x2bf3dd,_0x2272ed,_0x5cf046,_0x5aa730,_0x5d36e8,_0x3b354c,_0x5e6733,_0xba0f6a,_0x4c7ac7,_0x46305c,_0x4fb4f2,_0x2790e8,_0x10451c,_0x4ab563){const _0x4d7af6=_0x5ee26c;this['mjModelEntity']=_0x5c9f91,this[_0x4d7af6(0x17d)]=_0x550753,this[_0x4d7af6(0x103)]=_0x2ba517,this[_0x4d7af6(0x1c9)]=_0x47e932,this[_0x4d7af6(0x18a)]=_0x323ad9,this[_0x4d7af6(0x14c)]=_0x11a1bc,this[_0x4d7af6(0xc5)]=_0xfa476d,this[_0x4d7af6(0x110)]=_0x2d2663,this['clsService']=_0x2bf3dd,this[_0x4d7af6(0x1e8)]=_0x2272ed,this[_0x4d7af6(0x116)]=_0x5cf046,this[_0x4d7af6(0x1b3)]=_0x5aa730,this[_0x4d7af6(0x1f2)]=_0x5d36e8,this[_0x4d7af6(0x122)]=_0x3b354c,this[_0x4d7af6(0x77)]=_0x5e6733,this[_0x4d7af6(0x7c)]=_0xba0f6a,this['mjpTaskService']=_0x4c7ac7,this['badwordsService']=_0x46305c,this[_0x4d7af6(0xf8)]=_0x4fb4f2,this[_0x4d7af6(0x1bc)]=_0x2790e8,this[_0x4d7af6(0x115)]=_0x10451c,this['connection']=_0x4ab563;}async[_0x5ee26c(0xbf)](){const _0x29c501=_0x5ee26c;await this[_0x29c501(0x1b6)](),await this[_0x29c501(0x209)]();}async[_0x5ee26c(0x209)](){const _0x37c8c5=_0x5ee26c,_0x448323=await this['mjParamEntity']['count']({'where':{'enable':0x1},'order':{'weight':_0x37c8c5(0x1d9)}});_0x448323===0x0&&common_1[_0x37c8c5(0x145)][_0x37c8c5(0x235)](_0x37c8c5(0x120));}async[_0x5ee26c(0x1b6)](){const _0x22fdb4=_0x5ee26c,_0x2a0269=await this[_0x22fdb4(0xc5)][_0x22fdb4(0x10c)]();if(_0x2a0269===0x0){const _0x5cee61=[{'name':_0x22fdb4(0x13c),'value':0x1},{'name':'摄影拍照','value':0x2},{'name':'头像制作','value':0x3},{'name':'美女形象','value':0x4},{'name':_0x22fdb4(0xb6),'value':0x5},{'name':_0x22fdb4(0x11e),'value':0x6},{'name':'艺术设计','value':0x7},{'name':_0x22fdb4(0xb1),'value':0x8},{'name':_0x22fdb4(0x212),'value':0x9},{'name':_0x22fdb4(0xb3),'value':0xa}][_0x22fdb4(0x18b)](_0x4936cc=>{const _0x1166f3=_0x22fdb4;return{'name':_0x4936cc['name'],'value':_0x4936cc[_0x1166f3(0x1aa)]+'','inner':0x1};});await this['mjInspireClassifyEntity']['save'](_0x5cee61)[_0x22fdb4(0xed)](()=>{const _0x4a0d15=_0x22fdb4;common_1[_0x4a0d15(0x145)][_0x4a0d15(0x235)]('初始化灵感广场分类失败');}),common_1[_0x22fdb4(0x145)][_0x22fdb4(0x128)](_0x22fdb4(0x86));}common_1[_0x22fdb4(0x145)][_0x22fdb4(0x128)](_0x22fdb4(0x1e9));}async[_0x5ee26c(0x159)](_0x3fb5a7){const _0xfd12f7=_0x5ee26c;try{const {guildId:_0x3072e0,account:_0x2e07ed,authorization:_0x4ea38d,mode:_0x4dc310,timeout:_0x2b2874,channelId:_0x152942,remark:_0x131dca,mjBotChannelId:_0x24fc2b,nijiBotChannelId:_0x4a9ba1}=_0x3fb5a7;var _0x2f34dc=await this['mjpAccountService']['create']({'data':{'channelId':_0x152942,'coreSize':0x3,'guildId':_0x3072e0,'mjBotChannelId':_0x24fc2b||'','nijiBotChannelId':_0x4a9ba1||'','queueSize':0xa,'remark':_0x131dca,'remixAutoSubmit':![],'timeoutMinutes':_0x2b2874,'userAgent':_0xfd12f7(0x240),'userToken':_0x4ea38d}});if(_0x2f34dc[_0xfd12f7(0xc8)]!==0x1)throw new Error(_0x2f34dc['description']);const _0x402b98=await this[_0xfd12f7(0x17d)][_0xfd12f7(0xb9)]({'account':_0x2e07ed,'authorization':_0x4ea38d,'mode':_0x4dc310,'timeout':_0x2b2874,'channelId':_0x152942,'guildId':_0x3072e0,'remark':_0x131dca,'mjpId':_0x2f34dc[_0xfd12f7(0x23e)],'mjBotChannelId':_0x24fc2b||'','nijiBotChannelId':_0x4a9ba1||''});return await this[_0xfd12f7(0xc0)](_0x2f34dc[_0xfd12f7(0x23e)]),!!_0x402b98;}catch(_0x326fb3){common_1[_0xfd12f7(0x145)][_0xfd12f7(0x235)](_0x326fb3);throw new common_1[(_0xfd12f7(0x13f))](_0x326fb3['message'],common_1[_0xfd12f7(0x163)][_0xfd12f7(0x1ee)]);}}async[_0x5ee26c(0x1c6)](_0x89e6e5){const _0x51cfd3=_0x5ee26c,{id:_0x1c15eb,account:_0x502f41,authorization:_0x5ca4fb,mode:_0x2d3bcb,guildId:_0x338fcf,remark:_0x32ea7b,channelId:_0x3369f6,timeout:_0x141380,enable:_0x59b198,mjBotChannelId:_0x4fabfc,nijiBotChannelId:_0x209b92}=_0x89e6e5;try{const _0x37a13f=await this[_0x51cfd3(0x17d)][_0x51cfd3(0x125)]({'id':Number(_0x1c15eb)});var _0x1f2d6f=await this['mjpAccountService'][_0x51cfd3(0x162)]({'data':{'channelId':_0x3369f6,'coreSize':0x3,'guildId':_0x338fcf,'mjBotChannelId':_0x4fabfc||'','nijiBotChannelId':_0x209b92||'','queueSize':0xa,'remark':_0x32ea7b,'remixAutoSubmit':![],'timeoutMinutes':_0x141380,'userAgent':'Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','userToken':_0x5ca4fb,'enable':Boolean(_0x59b198)}},_0x37a13f[_0x51cfd3(0x11b)]);if(_0x1f2d6f[_0x51cfd3(0xc8)]!==0x1)throw new Error(_0x1f2d6f[_0x51cfd3(0x1a9)]);return await this[_0x51cfd3(0x17d)]['update'](_0x1c15eb,{'account':_0x502f41,'authorization':_0x5ca4fb,'mode':_0x2d3bcb,'guildId':_0x338fcf,'remark':_0x32ea7b,'channelId':_0x3369f6,'timeout':_0x141380,'mjBotChannelId':_0x4fabfc||'','nijiBotChannelId':_0x209b92||''});}catch(_0x431782){common_1[_0x51cfd3(0x145)][_0x51cfd3(0x235)](_0x431782);throw new common_1['HttpException'](_0x431782[_0x51cfd3(0xaa)],common_1[_0x51cfd3(0x163)][_0x51cfd3(0x1ee)]);}}async[_0x5ee26c(0x19a)](_0xbd6caf,_0x1f5a3d){const _0x28ea28=_0x5ee26c;_0xbd6caf['mjVersion']=_0x1f5a3d[_0x28ea28(0x195)];if(_0x1f5a3d[_0x28ea28(0x90)]===_0x28ea28(0x8a))_0xbd6caf['mode']=midjourney_constant_1['DrawSpeed'][_0x28ea28(0x1a0)];else{if(_0x1f5a3d[_0x28ea28(0x90)]===_0x28ea28(0x17f))_0xbd6caf[_0x28ea28(0x90)]=midjourney_constant_1[_0x28ea28(0x10d)][_0x28ea28(0x8b)];else _0x1f5a3d[_0x28ea28(0x90)]===_0x28ea28(0xf9)&&(_0xbd6caf[_0x28ea28(0x90)]=midjourney_constant_1['DrawSpeed'][_0x28ea28(0x16c)]);}_0xbd6caf[_0x28ea28(0x194)]=_0x1f5a3d['fastTimeRemaining'],_0xbd6caf[_0x28ea28(0x1fa)]=_0x1f5a3d['fastTimeRemaining'],_0xbd6caf[_0x28ea28(0x1c7)]=_0x1f5a3d[_0x28ea28(0x1c7)],_0xbd6caf['relaxedUsage']=_0x1f5a3d['relaxedUsage'],_0xbd6caf[_0x28ea28(0xcd)]=Number(_0x1f5a3d[_0x28ea28(0xcd)]);if(_0x1f5a3d[_0x28ea28(0x21d)]==='BASIC')_0xbd6caf[_0x28ea28(0x8e)]=0x1;else{if(_0x1f5a3d[_0x28ea28(0x21d)]==='STANDARD')_0xbd6caf[_0x28ea28(0x8e)]=0x2;else{if(_0x1f5a3d['subscribePlan']===_0x28ea28(0x24c))_0xbd6caf[_0x28ea28(0x8e)]=0x3;else _0x1f5a3d['subscribePlan']===_0x28ea28(0x18d)&&(_0xbd6caf[_0x28ea28(0x8e)]=0x4);}}_0xbd6caf['renewDate']=_0x1f5a3d[_0x28ea28(0x19b)],_0xbd6caf[_0x28ea28(0x22d)]=_0x1f5a3d[_0x28ea28(0x1bb)],_0xbd6caf[_0x28ea28(0x192)]=JSON[_0x28ea28(0xe2)](_0x1f5a3d['buttons']),_0xbd6caf[_0x28ea28(0x203)]=JSON['stringify'](_0x1f5a3d['versionSelector']),await this[_0x28ea28(0x17d)]['save'](_0xbd6caf);}async[_0x5ee26c(0xc0)](_0x1cd1a3){const _0x1f165e=_0x5ee26c;try{if(store_1[_0x1f165e(0x1ca)][_0x1f165e(0x148)]!==_0x1f165e(0x180))return;const _0x3074dc=await this[_0x1f165e(0x1bc)][_0x1f165e(0x1c4)]({},_0x1cd1a3);if(!_0x3074dc)return;const _0x8fb6e=await this['mjParamEntity'][_0x1f165e(0x150)]({'where':{'mjpId':_0x1cd1a3}});await this[_0x1f165e(0x19a)](_0x8fb6e,_0x3074dc);}catch(_0x40c6bd){common_1[_0x1f165e(0x145)][_0x1f165e(0x235)](_0x1f165e(0x244),_0x40c6bd);}}async[_0x5ee26c(0xa7)](){const _0x130e33=_0x5ee26c,_0x36a242=await this[_0x130e33(0x17d)][_0x130e33(0x216)]();if(!_0x36a242[_0x130e33(0x124)])return;for(let _0x2004c3=0x0;_0x2004c3<_0x36a242[_0x130e33(0x124)];_0x2004c3++){this['syncMjpAccount'](_0x36a242[_0x2004c3][_0x130e33(0x11b)]);}}async[_0x5ee26c(0x167)]({id:_0x4be914}){const _0x557be3=_0x5ee26c;try{const _0x7ab942=await this[_0x557be3(0x17d)]['findOneBy']({'id':Number(_0x4be914)}),_0x5399b7=await this[_0x557be3(0x1bc)]['syncInfo']({},_0x7ab942['mjpId']);if(_0x5399b7[_0x557be3(0xc8)]!==0x1)throw new Error(_0x5399b7[_0x557be3(0x1a9)]);await this[_0x557be3(0x19a)](_0x7ab942,_0x5399b7['result']);}catch(_0x2ec18e){throw new common_1[(_0x557be3(0x13f))](_0x2ec18e['message'],common_1[_0x557be3(0x163)][_0x557be3(0x1ee)]);}}async['changeVersion'](_0x1afd29){const _0x8b88a5=_0x5ee26c;try{const _0x473ff2=await this[_0x8b88a5(0x17d)]['findOneBy']({'id':Number(_0x1afd29['id'])}),_0x334a15=await this['mjpAccountService']['changeVersion']({'data':_0x1afd29},_0x473ff2[_0x8b88a5(0x11b)]);if(_0x334a15[_0x8b88a5(0xc8)]!==0x1)throw new Error(_0x334a15[_0x8b88a5(0x1a9)]);return _0x473ff2['mjVersion']=_0x1afd29[_0x8b88a5(0x195)],await this[_0x8b88a5(0x17d)][_0x8b88a5(0xb9)](_0x473ff2),!![];}catch(_0x1edaaa){throw new common_1[(_0x8b88a5(0x13f))](_0x1edaaa[_0x8b88a5(0xaa)],common_1[_0x8b88a5(0x163)][_0x8b88a5(0x1ee)]);}}async[_0x5ee26c(0x9f)](_0x2316a4){const _0x260b17=_0x5ee26c;try{const _0x2b98a3=await this[_0x260b17(0x17d)][_0x260b17(0x125)]({'id':Number(_0x2316a4['id'])}),_0x20eb32=await this[_0x260b17(0x1bc)][_0x260b17(0x9f)]({'data':_0x2316a4},_0x2b98a3[_0x260b17(0x11b)]);if(_0x20eb32[_0x260b17(0xc8)]!==0x1)throw new Error(_0x20eb32['description']);return!![];}catch(_0x1ab9a3){throw new common_1[(_0x260b17(0x13f))](_0x1ab9a3['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x5ee26c(0x1e6)](_0x500345){const _0x13da83=_0x5ee26c,{id:_0x19273d}=_0x500345;try{const _0x1efa8f=await this[_0x13da83(0x17d)][_0x13da83(0x150)]({'where':{'id':Number(_0x19273d)}});if(!_0x1efa8f)throw new Error(_0x13da83(0x1ce));common_1[_0x13da83(0x145)][_0x13da83(0x235)](_0x13da83(0xd3),_0x1efa8f[_0x13da83(0x11b)]);const _0x43ee9d=await this['mjpAccountService'][_0x13da83(0x107)]({},_0x1efa8f[_0x13da83(0x11b)]);if(_0x43ee9d[_0x13da83(0xc8)]!==0x1)throw new Error(_0x43ee9d[_0x13da83(0x1a9)]);const _0x580d57=await this[_0x13da83(0x17d)][_0x13da83(0x107)]({'id':_0x19273d});return _0x580d57['affected'];}catch(_0x1b5ca5){throw new common_1[(_0x13da83(0x13f))](_0x1b5ca5['message'],common_1[_0x13da83(0x163)][_0x13da83(0x1ee)]);}}async[_0x5ee26c(0xfe)](_0x2194b7){const _0x3f8c49=_0x5ee26c,{id:_0x5910a3,enable:_0x24bc77}=_0x2194b7;return await this[_0x3f8c49(0x17d)][_0x3f8c49(0x246)](_0x5910a3,{'enable':_0x24bc77})[_0x3f8c49(0x111)](_0x3cdb92=>_0x3cdb92[_0x3f8c49(0xb2)]>0x0);}async[_0x5ee26c(0x109)](_0xb70756,_0x128762){const _0x172ddf=_0x5ee26c,_0x12bf47=(0x0,utils_1['isSuper'])(this[_0x172ddf(0x1e2)]),{id:_0x359061}=_0xb70756;let _0x8ae0a6=null;try{const _0x23cf2a=await this[_0x172ddf(0x17d)][_0x172ddf(0x150)]({'where':{'id':_0x359061}});return _0x12bf47&&(_0x8ae0a6=await this[_0x172ddf(0x1bc)][_0x172ddf(0x1c4)]({},_0x23cf2a[_0x172ddf(0x11b)])),{..._0x23cf2a,'mjpAccountInfo':_0x8ae0a6,'authorization':_0x12bf47?_0x23cf2a[_0x172ddf(0xda)]:(0x0,utils_1[_0x172ddf(0x22c)])(_0x23cf2a[_0x172ddf(0xda)]),'guildId':_0x12bf47?_0x23cf2a[_0x172ddf(0x166)]:(0x0,utils_1[_0x172ddf(0x22c)])(_0x23cf2a['guildId']),'channelId':_0x12bf47?_0x23cf2a['channelId']:(0x0,utils_1[_0x172ddf(0x22c)])(_0x23cf2a['channelId'])};}catch(_0x2edaaf){throw new common_1['HttpException'](_0x2edaaf,common_1[_0x172ddf(0x163)][_0x172ddf(0x1ee)]);}}async[_0x5ee26c(0x23b)](_0x383427,_0x24d2e8){const _0x462958=_0x5ee26c,{page:page=0x1,size:size=0x14,account:_0x46d67c,channelId:_0x2c7e93,enable:_0x1c4acc}=_0x383427;if(!page||!size)throw new common_1[(_0x462958(0x13f))](_0x462958(0x1ef),common_1[_0x462958(0x163)][_0x462958(0x1ee)]);const _0x2e8ca4={};_0x46d67c&&Object['assign'](_0x2e8ca4,{'account':(0x0,typeorm_2['Like'])('%'+_0x46d67c+'%')}),_0x2c7e93&&Object[_0x462958(0x7e)](_0x2e8ca4,{'channelId':(0x0,typeorm_2[_0x462958(0x1cd)])('%'+_0x2c7e93+'%')}),_0x1c4acc>0x0&&Object[_0x462958(0x7e)](_0x2e8ca4,{'enable':_0x1c4acc});const [_0x177454,_0x4e9c35]=await this[_0x462958(0x17d)][_0x462958(0x137)]({'skip':(page-0x1)*size,'where':_0x2e8ca4,'take':size,'order':{'createdAt':_0x462958(0x1d9)},'cache':!![],'select':['id',_0x462958(0x166),_0x462958(0xcc),'authorization',_0x462958(0x11a),_0x462958(0x88),_0x462958(0x1f5),_0x462958(0x194),_0x462958(0x8e),_0x462958(0x19b),_0x462958(0x196),_0x462958(0x90)]});return(0x0,utils_1[_0x462958(0x173)])(this['clsService'])?{'rows':_0x177454||[],'count':_0x4e9c35||0x0}:{'rows':_0x177454['map'](_0x3935f1=>({..._0x3935f1,'authorization':(0x0,utils_1[_0x462958(0x22c)])(_0x3935f1[_0x462958(0xda)]),'guildId':(0x0,utils_1[_0x462958(0x22c)])(_0x3935f1[_0x462958(0x166)]),'channelId':(0x0,utils_1[_0x462958(0x22c)])(_0x3935f1['channelId'])}))||[],'count':_0x4e9c35||0x0};}async['drawTaskList'](_0x4986bc,_0x250776){const _0x2a74cf=_0x5ee26c;try{const _0x388699=(0x0,utils_1[_0x2a74cf(0x1f3)])(this['clsService']),{page:page=0x1,size:size=0x14,botType:_0xd5ec68,action:_0x393832,keyword:_0x5382a2,userId:_0x49a1b3,rec:_0x179d9f,status:_0x136986,squareType:_0x5af923,workflowId:_0x216065,saasId:_0x36cce7}=_0x4986bc,_0x1cd8de={};_0xd5ec68&&_0xd5ec68['length']&&(_0x1cd8de[_0x2a74cf(0x19f)]=(0x0,typeorm_2['In'])(_0xd5ec68));_0x393832&&(_0x1cd8de[_0x2a74cf(0x9f)]=_0x393832);_0x5382a2&&(_0x1cd8de[_0x2a74cf(0x7f)]=(0x0,typeorm_2[_0x2a74cf(0x1cd)])('%'+_0x5382a2+'%'));_0x49a1b3&&(_0x1cd8de[_0x2a74cf(0x1bd)]=_0x49a1b3);_0x5af923&&(_0x1cd8de[_0x2a74cf(0x106)]=_0x5af923);_0x216065&&(_0x1cd8de[_0x2a74cf(0xd9)]=_0x216065);_0x179d9f!==null&&_0x179d9f!==undefined&&(_0x1cd8de['rec']=_0x179d9f);_0x179d9f!==null&&_0x136986!==undefined&&(_0x1cd8de[_0x2a74cf(0xa2)]=_0x136986);(0x0,utils_1['isPlatform'])(this[_0x2a74cf(0x1e2)])?(0x0,utils_1[_0x2a74cf(0x221)])(_0x36cce7)&&(_0x1cd8de[_0x2a74cf(0xa1)]=_0x36cce7):_0x1cd8de[_0x2a74cf(0xa1)]=_0x388699;const [_0x28194d,_0x53dbab]=await this['midjourneyEntity'][_0x2a74cf(0x137)]({'where':_0x1cd8de,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x2a74cf(0x1d9)}}),_0x3fb4fa=new Map(),_0x4d517b=_0x28194d['map'](_0x1a66b4=>_0x1a66b4[_0x2a74cf(0xd9)])[_0x2a74cf(0x139)](_0x656d06=>Boolean(_0x656d06));if(_0x4d517b[_0x2a74cf(0x124)]){const _0x523db4=await this[_0x2a74cf(0x77)]['getModelByIds'](_0x4d517b);_0x523db4[_0x2a74cf(0x1f7)](_0x544838=>_0x3fb4fa['set'](_0x544838['id'],_0x544838));}const _0x3b36c4=_0x28194d[_0x2a74cf(0x18b)](_0x388cf8=>{const _0x8f642e=_0x2a74cf;return{..._0x388cf8,'workflowName':_0x3fb4fa[_0x8f642e(0x23a)](_0x388cf8['workflowId'])?.[_0x8f642e(0x15e)]||''};});if(_0x250776){const _0x3da2fc=_0x3b36c4[_0x2a74cf(0x18b)](_0x354d48=>_0x354d48[_0x2a74cf(0x1bd)]),_0x4dba6d=await this[_0x2a74cf(0x116)][_0x2a74cf(0x175)](_0x3da2fc);_0x3b36c4[_0x2a74cf(0x1f7)](_0x389d58=>{const _0x135cd5=_0x2a74cf,_0x5632dc=_0x4dba6d['find'](_0x338925=>_0x338925['id']===_0x389d58[_0x135cd5(0x1bd)]);!(0x0,utils_1['isSuper'])(this[_0x135cd5(0x1e2)])&&(_0x5632dc['email']=(0x0,utils_1[_0x135cd5(0x22c)])(_0x5632dc['email']),_0x5632dc['phone']=(0x0,utils_1[_0x135cd5(0x22c)])(_0x5632dc[_0x135cd5(0x186)])),_0x389d58[_0x135cd5(0x9c)]=_0x5632dc;});}return{'rows':_0x3b36c4,'count':_0x53dbab};}catch(_0x3b31c7){throw new common_1[(_0x2a74cf(0x13f))](_0x3b31c7['message'],common_1['HttpStatus'][_0x2a74cf(0x1ee)]);}}async[_0x5ee26c(0x12f)](_0x836fde){const _0x21f615=_0x5ee26c,_0x39a5d1=await this[_0x21f615(0x115)][_0x21f615(0xc7)]([_0x21f615(0x12e)]),_0x55369f=Number(_0x39a5d1||0x0);if(_0x55369f===0x0)return!![];const _0x1068d0=await this[_0x21f615(0x1c9)]['count']({'where':{'userId':_0x836fde,'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6])}});if(_0x1068d0<_0x55369f)return!![];else throw new Error(_0x21f615(0x113));}async[_0x5ee26c(0xe9)](_0x314f1d){const _0x442e07=_0x5ee26c;if(store_1[_0x442e07(0x1ca)][_0x442e07(0x148)]!=='mjProxy')return new mjParam_entity_1[(_0x442e07(0x21a))]();const _0x321cb5=await this[_0x442e07(0x17d)]['find']({'where':{'enable':0x1,'mode':_0x314f1d,'fastRemainTime':(0x0,typeorm_2[_0x442e07(0x1b9)])((0x0,typeorm_2[_0x442e07(0x241)])())},'order':{'weight':_0x442e07(0x1d9)}});if(!_0x321cb5[_0x442e07(0x124)])throw new Error(_0x442e07(0x1de));const [_0x320404]=await this[_0x442e07(0x136)][_0x442e07(0x16f)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20*\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count(*)\x20AS\x20count,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mjpId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20midjourney\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20action\x20IN\x20(\x201,\x202,\x203,\x2022\x20)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20DATE\x20(\x20createdAt\x20)\x20=\x20CURDATE()\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20GROUP\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20mjpId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x20t\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.mjpId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20count\x20ASC\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20');if(!_0x320404)return _0x321cb5[0x0];else{const _0x2d20ea=_0x321cb5[_0x442e07(0x216)](_0x32e060=>_0x32e060[_0x442e07(0x11b)]===_0x320404['mjpId']);if(!_0x2d20ea)throw new Error('没有满足条件的MJ账号，请联系管理员！');return _0x2d20ea;}}async[_0x5ee26c(0x219)](_0xcd3f67,_0x238e40){const _0x2f5517=_0x5ee26c,_0x26e2ae=await this[_0x2f5517(0x1c9)]['count']({'where':{'originTaskId':String(_0xcd3f67),'customId':_0x238e40}});if(_0x26e2ae>0x0)throw new common_1[(_0x2f5517(0x13f))](_0x2f5517(0x9a),common_1[_0x2f5517(0x163)][_0x2f5517(0x1ee)]);return![];}async['addDrawQueue'](_0x160edb){const _0x5bb65a=_0x5ee26c,_0x494407=new addDrawQueue_dto_1['AddDrawQueueDto'](_0x160edb);await this[_0x5bb65a(0xc2)][_0x5bb65a(0x1c1)](_0x494407[_0x5bb65a(0x20e)],_0x494407['userId']);const _0x25657=(0x0,utils_1[_0x5bb65a(0x1f3)])(this[_0x5bb65a(0x1e2)]);_0x494407[_0x5bb65a(0xa1)]=_0x25657;const _0x2663be=await this[_0x5bb65a(0x1c9)]['save'](_0x494407);return _0x2663be;}async['imagine'](_0x4cf814,_0x39f3d6){const _0x5cef96=_0x5ee26c;let _0x3574f0,{botType:_0xfc593b,prompt:_0x56d51c,extend:_0x53906e,action:_0x20961f,mode:_0x474c72,translate:_0x1d8ba9,base64Array:_0x3f1c31,mats:mats=[],iw:_0x2566c0,roles:roles=[],cw:_0x4d5788,styles:styles=[],sw:_0x5f23ec}=_0x39f3d6;await this[_0x5cef96(0x116)]['validateBalance4MJ'](_0x4cf814[_0x5cef96(0x114)]['id'],_0x474c72,_0x5cef96(0xfa));const _0x541afb=_0x56d51c,_0xc14874=await this['distributeAccount'](_0x474c72);_0x56d51c&&await this[_0x5cef96(0xc2)][_0x5cef96(0x1c1)](_0x56d51c,_0x4cf814['user']['id']),_0x56d51c=_0x1d8ba9===0x1&&(0x0,utils_1[_0x5cef96(0x13e)])(_0x56d51c)?await this[_0x5cef96(0x1f2)][_0x5cef96(0x91)](_0x56d51c):_0x56d51c;let _0x594211=_0x56d51c;mats[_0x5cef96(0x124)]&&(_0x594211=mats[_0x5cef96(0x12d)]('\x20')+'\x20'+_0x594211);_0x2566c0&&(_0x594211=_0x594211+_0x5cef96(0x14d)+_0x2566c0);styles['length']&&(_0x594211=_0x594211+_0x5cef96(0x135)+styles[_0x5cef96(0x12d)]('\x20'));roles[_0x5cef96(0x124)]&&(_0x594211=_0x594211+_0x5cef96(0x211)+roles[_0x5cef96(0x12d)]('\x20'));_0x4d5788&&(_0x594211=_0x594211+_0x5cef96(0x204)+_0x4d5788);_0x5f23ec&&(_0x594211=_0x594211+_0x5cef96(0x1fd)+_0x5f23ec);_0x53906e&&(_0x594211=_0x594211+'\x20'+_0x53906e);const _0x462c5f=await this['mjpTaskService'][_0x5cef96(0x1c3)]({'data':{'mode':this[_0x5cef96(0x12a)](_0x474c72),'prompt':_0x594211,'botType':_0xfc593b||_0x5cef96(0xce),'base64Array':_0x3f1c31,'accountFilter':{'instanceId':_0xc14874['mjpId']}}});if(_0x462c5f[_0x5cef96(0xc8)]===0x17)throw new Error('队列已满，请稍后尝试');if(_0x462c5f[_0x5cef96(0xc8)]===0x18)throw new Error(_0x5cef96(0x1a6));if(_0x462c5f[_0x5cef96(0xc8)]!==0x1&&_0x462c5f['code']!==0x16)throw new Error(_0x462c5f[_0x5cef96(0x1a9)]);return _0x3574f0=await this[_0x5cef96(0x136)]['transaction'](async()=>{const _0x35357b=_0x5cef96,_0x119118={'mode':_0x474c72,'prompt':_0x56d51c,'action':_0x20961f,'translate':_0x1d8ba9,'fullPrompt':_0x594211,'originPrompt':_0x541afb,'extraParam':_0x53906e,'userId':_0x4cf814[_0x35357b(0x114)]['id'],'mjpId':_0xc14874[_0x35357b(0x11b)],'mjpTaskId':_0x462c5f[_0x35357b(0x23e)],'botType':_0xfc593b||'MID_JOURNEY'},_0x425e16=await this[_0x35357b(0xec)](_0x119118);if(!_0x425e16)throw new Error('添加绘图任务失败');return await this[_0x35357b(0x116)][_0x35357b(0xb4)](_0x4cf814[_0x35357b(0x114)]['id'],_0x474c72,_0x35357b(0xfa),_0x425e16['id']),_0x425e16;}),_0x3574f0;}async[_0x5ee26c(0x121)](_0x3f72be,_0x2e4c90){const _0x118e31=_0x5ee26c;let _0x393b30;const {action:_0xaf0ace,taskId:_0x565c38,customId:_0x5440cd,prompt:_0x4859a0,mask:_0x28e16e}=_0x2e4c90;await this[_0x118e31(0x219)](_0x565c38,_0x5440cd);const _0x104053=await this[_0x118e31(0x1c9)][_0x118e31(0x150)]({'where':{'id':_0x565c38}});if(!_0x104053)throw new Error(_0x118e31(0x75));await this[_0x118e31(0x116)]['validateBalance4MJ'](_0x3f72be['user']['id'],_0x104053[_0x118e31(0x90)],_0x5440cd);const _0xdc97f5=await this[_0x118e31(0x10b)][_0x118e31(0x9f)]({'data':{'customId':_0x5440cd,'taskId':_0x104053[_0x118e31(0x1df)],'accountFilter':{'instanceId':_0x104053[_0x118e31(0x11b)]},'mode':this[_0x118e31(0x12a)](_0x104053['mode'])}});if(_0xdc97f5['code']===0x17)throw new Error(_0x118e31(0x10a));else{if(_0xdc97f5[_0x118e31(0xc8)]===0x18)throw new Error(_0x118e31(0x1a6));else{if(_0xdc97f5[_0x118e31(0xc8)]===0x15)setTimeout(()=>this[_0x118e31(0x13b)](_0xdc97f5[_0x118e31(0x23e)]));else{if(_0xdc97f5[_0x118e31(0xc8)]!==0x1&&_0xdc97f5[_0x118e31(0xc8)]!==0x16)throw new Error(_0xdc97f5['description']);}}}return _0x393b30=await this['connection'][_0x118e31(0x11f)](async()=>{const _0x4cef54=_0x118e31,_0x2bb355={'action':_0xaf0ace,'customId':_0x5440cd,'userId':_0x3f72be[_0x4cef54(0x114)]['id'],'mjpTaskId':_0xdc97f5[_0x4cef54(0x23e)],'originTaskId':String(_0x565c38),'mode':_0x104053['mode'],'mjpId':_0x104053[_0x4cef54(0x11b)],'prompt':_0x104053[_0x4cef54(0xbb)],'botType':_0x104053[_0x4cef54(0x19f)],'extraParam':_0x104053[_0x4cef54(0x176)],'fullPrompt':_0x104053['fullPrompt'],'originPrompt':_0x104053[_0x4cef54(0x7f)]},_0x4134a7=await this[_0x4cef54(0xec)](_0x2bb355);if(!_0x4134a7)throw new Error(_0x4cef54(0x220));const _0x4d4e6c=_0x104053[_0x4cef54(0xc1)];return _0x104053['buttons'][_0x4cef54(0x1f7)](_0xd73b5=>{const _0x1f4e2e=_0x4cef54;_0xd73b5[_0x1f4e2e(0x187)]===_0x2e4c90['customId']&&(_0xd73b5[_0x1f4e2e(0x223)]=!![]);}),await this[_0x4cef54(0x1c9)][_0x4cef54(0xb9)](_0x104053),await this[_0x4cef54(0x116)][_0x4cef54(0xb4)](_0x3f72be[_0x4cef54(0x114)]['id'],_0x104053[_0x4cef54(0x90)],_0x5440cd,_0x4134a7['id']),_0x4134a7;}),_0x393b30;}async[_0x5ee26c(0x237)](_0x5bba0b,_0x5ba91e){const _0x2e7224=_0x5ee26c;let _0x5cb208,{action:_0x3fb240,taskId:_0x4e68e6,customId:_0x4cd9c6,prompt:_0x3b1f80,mask:_0x5f25c1}=_0x5ba91e;const _0x2e2c51=await this[_0x2e7224(0x1c9)]['findOne']({'where':{'id':_0x4e68e6}});if(!_0x2e2c51)throw new Error(_0x2e7224(0x75));const _0x56ca93=_0x3b1f80;_0x3b1f80&&await this[_0x2e7224(0xc2)][_0x2e7224(0x1c1)](_0x3b1f80,_0x5bba0b[_0x2e7224(0x114)]['id']),_0x3b1f80=(0x0,utils_1['isChinese'])(_0x3b1f80)?await this[_0x2e7224(0x1f2)][_0x2e7224(0x91)](_0x3b1f80):_0x3b1f80;const _0x58bd86=await this[_0x2e7224(0x10b)][_0x2e7224(0xfb)]({'data':{'prompt':_0x3b1f80,'maskBase64':_0x5f25c1,'taskId':_0x2e2c51[_0x2e7224(0x1df)]}});if(_0x58bd86[_0x2e7224(0xc8)]!==0x1&&_0x58bd86[_0x2e7224(0xc8)]!==0x16)throw new Error(_0x58bd86[_0x2e7224(0x1a9)]);_0x5cb208=await this['midjourneyEntity'][_0x2e7224(0xb9)]({'id':_0x4e68e6,'prompt':_0x3b1f80,'status':0x1,'originPrompt':_0x56ca93,'messageFlags':0x1});for(let _0x2cd5f3 in _0x5cb208){_0x5cb208[_0x2cd5f3]&&(_0x2e2c51[_0x2cd5f3]=_0x5cb208[_0x2cd5f3]);}return _0x2e2c51;}async[_0x5ee26c(0xd6)](_0x395994,_0x81dd54){const _0x432244=_0x5ee26c;let _0x532a5d,_0x50de39;try{let {type:_0x167e4d,params:_0x26afb3}=_0x395994;await this[_0x432244(0x116)]['checkUserStatus'](_0x81dd54[_0x432244(0x114)]),await this['concurrentLimit'](_0x81dd54['user']['id']);if(_0x167e4d===midjourney_constant_1[_0x432244(0x9d)][_0x432244(0x15b)])_0x50de39=await this[_0x432244(0x1c3)](_0x81dd54,_0x26afb3),_0x532a5d=_0x50de39[_0x432244(0x1df)];else{if(_0x167e4d===midjourney_constant_1[_0x432244(0x9d)][_0x432244(0x142)])_0x26afb3=_0x26afb3,_0x26afb3[_0x432244(0x187)]?(_0x50de39=await this[_0x432244(0x121)](_0x81dd54,_0x26afb3),_0x26afb3[_0x432244(0xbb)]&&(_0x26afb3[_0x432244(0x21c)]=_0x50de39['id'],_0x50de39=await this[_0x432244(0x237)](_0x81dd54,_0x26afb3))):_0x50de39=await this[_0x432244(0x237)](_0x81dd54,_0x26afb3),_0x532a5d=_0x50de39[_0x432244(0x1df)];else return new common_1[(_0x432244(0x13f))]('任务类型错误',common_1[_0x432244(0x163)][_0x432244(0x1ee)]);}return _0x50de39;}catch(_0x155ecb){if(_0x155ecb instanceof common_1[_0x432244(0x13f)])throw _0x155ecb;else{_0x532a5d&&await this[_0x432244(0x10b)][_0x432244(0x228)]({},_0x532a5d);throw new common_1['HttpException'](_0x155ecb['message'],common_1[_0x432244(0x163)]['BAD_REQUEST']);}}}async[_0x5ee26c(0x17c)](_0x3ac19b,_0x455082){const _0x2e77ee=_0x5ee26c;let _0x5379af,_0x324602;try{const {type:_0x608cd3,botType:_0x2c4ba6,files:_0x17245b,mode:_0x53b7e7,action:_0x62672c,size:_0x2fb15c,base64Array:base64Array=[]}=_0x3ac19b;await this['userService']['checkUserStatus'](_0x455082[_0x2e77ee(0x114)]),await this[_0x2e77ee(0x12f)](_0x455082[_0x2e77ee(0x114)]['id']);let _0x3f1ea3='';if(Number(_0x608cd3)===midjourney_constant_1[_0x2e77ee(0x9d)][_0x2e77ee(0xf7)])_0x3f1ea3=_0x2e77ee(0x1a4);else Number(_0x608cd3)===midjourney_constant_1[_0x2e77ee(0x9d)][_0x2e77ee(0xf1)]&&(_0x3f1ea3='Describe');await this[_0x2e77ee(0x116)]['validateBalance4MJ'](_0x455082[_0x2e77ee(0x114)]['id'],_0x53b7e7,_0x3f1ea3);const _0x2af4d7=await this['distributeAccount'](_0x53b7e7);if(!base64Array[_0x2e77ee(0x124)])for(let _0x4bfeba=0x0;_0x4bfeba<_0x17245b[_0x2e77ee(0x124)];_0x4bfeba++){base64Array['push']('data:image/png;base64,'+_0x17245b[_0x4bfeba][_0x2e77ee(0x83)][_0x2e77ee(0x7b)]('base64'));}if(Number(_0x608cd3)===midjourney_constant_1[_0x2e77ee(0x9d)][_0x2e77ee(0xf7)]){if(base64Array[_0x2e77ee(0x124)]<0x2)throw new Error('图混图任务至少需要两张图片');const _0x256498=await this[_0x2e77ee(0x10b)][_0x2e77ee(0xe7)]({'data':{'mode':this[_0x2e77ee(0x12a)](_0x53b7e7),'dimensions':_0x2fb15c,'botType':_0x2e77ee(0xce),'base64Array':base64Array,'accountFilter':{'instanceId':_0x2af4d7['mjpId']}}});if(_0x256498[_0x2e77ee(0xc8)]===0x17)throw new Error(_0x2e77ee(0x10a));if(_0x256498[_0x2e77ee(0xc8)]!==0x1&&_0x256498[_0x2e77ee(0xc8)]!==0x16)throw new Error(_0x256498[_0x2e77ee(0x1a9)]);_0x5379af=_0x256498['result'],_0x324602=await this[_0x2e77ee(0x136)]['transaction'](async()=>{const _0x1f7e8f=_0x2e77ee,_0x5e14b4={'mode':_0x53b7e7,'action':_0x62672c,'userId':_0x455082[_0x1f7e8f(0x114)]['id'],'jobId':(0x0,utils_1['createRandomUid'])(),'botType':_0x2c4ba6||_0x1f7e8f(0xce),'extraParam':JSON['stringify']({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x256498[_0x1f7e8f(0x23e)]},_0x31f34b=await this[_0x1f7e8f(0xec)](_0x5e14b4);if(!_0x31f34b)throw new Error(_0x1f7e8f(0xae));return await this[_0x1f7e8f(0x116)][_0x1f7e8f(0xb4)](_0x455082['user']['id'],_0x53b7e7,_0x3f1ea3,_0x31f34b['id']),_0x31f34b;});}else{if(Number(_0x608cd3)===midjourney_constant_1[_0x2e77ee(0x9d)][_0x2e77ee(0xf1)]){const _0x5ac6d7=await this[_0x2e77ee(0x10b)][_0x2e77ee(0x1c8)]({'data':{'mode':this[_0x2e77ee(0x12a)](_0x53b7e7),'botType':'MID_JOURNEY','base64':base64Array[0x0],'accountFilter':{'instanceId':_0x2af4d7[_0x2e77ee(0x11b)]}}});if(_0x5ac6d7[_0x2e77ee(0xc8)]===0x17)throw new Error(_0x2e77ee(0x10a));if(_0x5ac6d7[_0x2e77ee(0xc8)]!==0x1&&_0x5ac6d7[_0x2e77ee(0xc8)]!==0x16)throw new Error(_0x5ac6d7['description']);_0x5379af=_0x5ac6d7[_0x2e77ee(0x23e)],_0x324602=await this[_0x2e77ee(0x136)][_0x2e77ee(0x11f)](async()=>{const _0x58d90c=_0x2e77ee,_0x638fb7={'mode':_0x53b7e7,'action':_0x62672c,'userId':_0x455082['user']['id'],'jobId':(0x0,utils_1[_0x58d90c(0x248)])(),'botType':_0x2c4ba6||_0x58d90c(0xce),'extraParam':JSON['stringify']({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x5ac6d7['result']},_0x1ed8a9=await this[_0x58d90c(0xec)](_0x638fb7);if(!_0x1ed8a9)throw new Error(_0x58d90c(0xb0));return await this[_0x58d90c(0x116)][_0x58d90c(0xb4)](_0x455082['user']['id'],_0x53b7e7,_0x3f1ea3,_0x1ed8a9['id']),_0x1ed8a9;})[_0x2e77ee(0xed)](async _0x1a4c2f=>{const _0x4fa490=_0x2e77ee;await this[_0x4fa490(0x10b)][_0x4fa490(0x228)]({},_0x5ac6d7['result']);throw _0x1a4c2f;});}else return new common_1['HttpException'](_0x2e77ee(0x80),common_1[_0x2e77ee(0x163)]['BAD_REQUEST']);}return _0x324602;}catch(_0x44717a){if(_0x44717a instanceof common_1[_0x2e77ee(0x13f)])throw _0x44717a;else{_0x5379af&&await this['mjpTaskService'][_0x2e77ee(0x228)]({},_0x5379af);throw new common_1['HttpException'](_0x44717a[_0x2e77ee(0xaa)],common_1[_0x2e77ee(0x163)][_0x2e77ee(0x1ee)]);}}}async[_0x5ee26c(0xa6)](_0xa04aaa,_0x3c620a){const _0x260407=_0x5ee26c;let _0x4009e1;try{const {params:_0x4e8ba8}=_0xa04aaa,{mode:_0x218669,botType:_0x41f4f5,action:_0x21455e,extend:_0x15840f,sourceBase64:_0xe6dc73,targetBase64:_0x13243d}=_0x4e8ba8;await this[_0x260407(0x116)][_0x260407(0x225)](_0x3c620a[_0x260407(0x114)]),await this['concurrentLimit'](_0x3c620a[_0x260407(0x114)]['id']),await this['userService'][_0x260407(0x1b7)](_0x3c620a[_0x260407(0x114)]['id'],_0x218669,_0x260407(0x138));const _0x95561=await this[_0x260407(0xe9)](_0x218669),_0x2e4775=await this[_0x260407(0x10b)]['swap']({'data':{'sourceBase64':_0xe6dc73,'targetBase64':_0x13243d,'state':_0x15840f,'mode':this['convertMode4Transfer'](_0x218669),'accountFilter':{'instanceId':_0x95561['mjpId']}}});if(_0x2e4775['code']===0x17)throw new Error(_0x260407(0x10a));if(_0x2e4775[_0x260407(0xc8)]===0x18)throw new Error(_0x260407(0x1a6));if(_0x2e4775[_0x260407(0xc8)]!==0x1&&_0x2e4775[_0x260407(0xc8)]!==0x16)throw new Error(_0x2e4775[_0x260407(0x1a9)]);return _0x4009e1=await this[_0x260407(0x136)][_0x260407(0x11f)](async()=>{const _0x5a1f83=_0x260407,_0x29b7eb={'mode':_0x218669,'action':_0x21455e,'prompt':null,'extraParam':_0x15840f,'originPrompt':null,'userId':_0x3c620a[_0x5a1f83(0x114)]['id'],'mjpId':_0x95561[_0x5a1f83(0x11b)],'mjpTaskId':_0x2e4775[_0x5a1f83(0x23e)],'botType':_0x41f4f5||_0x5a1f83(0xce)},_0x3662f0=new addDrawQueue_dto_1[(_0x5a1f83(0x9b))](_0x29b7eb),_0x1891b4=(0x0,utils_1[_0x5a1f83(0x1f3)])(this[_0x5a1f83(0x1e2)]);_0x3662f0[_0x5a1f83(0xa1)]=_0x1891b4;const _0x1726d8=await this[_0x5a1f83(0x1c9)][_0x5a1f83(0xb9)](_0x3662f0);if(!_0x1726d8)throw new Error('添加绘图任务失败');return await this[_0x5a1f83(0x116)][_0x5a1f83(0xb4)](_0x3c620a['user']['id'],_0x218669,_0x5a1f83(0x138),_0x1726d8['id']),_0x1726d8;}),_0x4009e1;}catch(_0x1c369f){if(_0x1c369f instanceof common_1[_0x260407(0x13f)])throw _0x1c369f;else throw new common_1[(_0x260407(0x13f))](_0x1c369f[_0x260407(0xaa)],common_1[_0x260407(0x163)][_0x260407(0x1ee)]);}}async[_0x5ee26c(0x108)](_0x5c72ec,_0x1bb01b){const _0x1aa208=_0x5ee26c,_0x49dce6=(0x0,utils_1[_0x1aa208(0x1f3)])(this[_0x1aa208(0x1e2)]),_0x8ece6c={'userId':_0x1bb01b[_0x1aa208(0x114)]['id'],'jobId':(0x0,utils_1['createRandomUid'])(),'mode':0x1,'translate':0x0,'prompt':'','progress':0x64,'durationSpent':0x0,'status':0x3,'fullPrompt':_0x5c72ec['prompt'],'originPrompt':_0x5c72ec[_0x1aa208(0xbb)],'fileInfo':_0x5c72ec[_0x1aa208(0x172)],'botType':_0x5c72ec[_0x1aa208(0x19f)],'imageUrl':_0x5c72ec['imageUrl'],'buttons':[],'saasId':_0x49dce6},_0x41e5f3=await this[_0x1aa208(0x1c9)]['save'](_0x8ece6c);return _0x41e5f3;}async[_0x5ee26c(0x227)](_0x22fc22){const _0x500780=_0x5ee26c;try{const _0x279c20=await this[_0x500780(0x1c9)][_0x500780(0x150)]({'where':{'jobId':_0x22fc22}});if(!_0x279c20)throw new Error('任务不存在！');const _0x1e9896=await this['mjpTaskService'][_0x500780(0x227)]({},_0x279c20[_0x500780(0x1df)]);if(_0x1e9896[_0x500780(0xc8)]!==0x1)throw new Error(_0x1e9896[_0x500780(0x1a9)]);return _0x1e9896[_0x500780(0x23e)];}catch(_0x406664){throw new common_1[(_0x500780(0x13f))](_0x406664['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x5ee26c(0x118)](_0x2f92b9,_0x518b1c){const _0x534bae=_0x5ee26c;try{let _0x108528,_0x43b752,_0x503f24,_0x1f3624;const {jobId:_0x3ad30d,detail:_0x46b7ef}=_0x518b1c,_0x34a75a=(0x0,utils_1[_0x534bae(0x10f)])(this[_0x534bae(0x1e2)]),_0x28f1fd=await this[_0x534bae(0x1c9)][_0x534bae(0x150)]({'where':{'jobId':_0x3ad30d}});if(_0x28f1fd[_0x534bae(0xd9)]){const _0x4024ab=await this[_0x534bae(0x77)][_0x534bae(0xd0)](_0x28f1fd['workflowId']);_0x1f3624=_0x4024ab[_0x534bae(0x15e)];}return _0x46b7ef&&(this[_0x534bae(0x122)]['increaseVisit'](model_constant_1['EModelType'][_0x534bae(0x245)],_0x28f1fd['id']),_0x108528=await this['userService'][_0x534bae(0x21e)](_0x28f1fd['userId']),_0x43b752=await this[_0x534bae(0x122)][_0x534bae(0x149)](model_constant_1[_0x534bae(0x1a7)][_0x534bae(0x245)],_0x28f1fd['id']),_0x34a75a&&(_0x503f24=await this[_0x534bae(0x122)][_0x534bae(0xa4)](model_constant_1[_0x534bae(0x1a7)][_0x534bae(0x245)],_0x28f1fd['id']))),{..._0x28f1fd,'workflowName':_0x1f3624,'avatar':_0x108528?_0x108528[_0x534bae(0x18c)]:null,'username':_0x108528?_0x108528[_0x534bae(0x1e5)]:null,'nickname':_0x108528?_0x108528[_0x534bae(0x9e)]:null,'visitNum':_0x43b752?_0x43b752[_0x534bae(0x1ad)]:0x0,'agreeNum':_0x43b752?_0x43b752[_0x534bae(0x1ea)]:0x0,'agree':_0x503f24?_0x503f24[_0x534bae(0x9f)]:null};}catch(_0x46c00b){throw new common_1[(_0x534bae(0x13f))](_0x46c00b['message'],common_1[_0x534bae(0x163)][_0x534bae(0x1ee)]);}}async[_0x5ee26c(0xfc)](_0x46f23d,_0x342a5e){const _0x5d5847=_0x5ee26c;try{if(!_0x342a5e[_0x5d5847(0x102)]||!_0x342a5e[_0x5d5847(0x102)]['length'])return[];const _0xfc3770=_0x342a5e['jobIds'][_0x5d5847(0xdb)](','),_0xbb8829=await this[_0x5d5847(0x1c9)][_0x5d5847(0x216)]({'where':{'jobId':(0x0,typeorm_2['In'])(_0xfc3770)}}),_0x529bf2=new Map(),_0x55dff5=_0xbb8829[_0x5d5847(0x18b)](_0x47bb42=>_0x47bb42[_0x5d5847(0xd9)])[_0x5d5847(0x139)](_0x41003f=>Boolean(_0x41003f));if(_0x55dff5[_0x5d5847(0x124)]){const _0x91a207=await this[_0x5d5847(0x77)]['getModelByIds'](_0x55dff5);_0x91a207[_0x5d5847(0x1f7)](_0x2bca25=>_0x529bf2[_0x5d5847(0x19d)](_0x2bca25['id'],_0x2bca25));}return _0xbb8829[_0x5d5847(0x18b)](_0x1f640d=>{const _0x3582ff=_0x5d5847;return{..._0x1f640d,'workflowName':_0x529bf2[_0x3582ff(0x23a)](_0x1f640d[_0x3582ff(0xd9)])?.[_0x3582ff(0x15e)]||''};});}catch(_0x1a7db2){throw new common_1[(_0x5d5847(0x13f))](_0x1a7db2['message'],common_1[_0x5d5847(0x163)][_0x5d5847(0x1ee)]);}}async[_0x5ee26c(0x218)](_0x386daf){const _0x187ac0=_0x5ee26c,{id:_0x328bb9,squareType:_0x201e73}=_0x386daf,_0x331ca7=await this['midjourneyEntity'][_0x187ac0(0x150)]({'where':{'id':_0x328bb9,'status':midjourney_constant_1['MidjourneyStatusEnum']['DRAWED']}});if(!_0x331ca7)throw new common_1['HttpException'](_0x187ac0(0x1a5),common_1['HttpStatus'][_0x187ac0(0x1ee)]);const _0x60c74=await this[_0x187ac0(0x1c9)][_0x187ac0(0x246)]({'id':_0x328bb9},{'rec':0x1,'squareType':_0x201e73})[_0x187ac0(0xed)](_0xac9b1a=>{const _0x413a9d=_0x187ac0;throw new common_1['HttpException'](_0xac9b1a,common_1['HttpStatus'][_0x413a9d(0x1ee)]);});if(_0x60c74[_0x187ac0(0xb2)]<=0x0)throw new common_1['HttpException']('操作失败！',common_1[_0x187ac0(0x163)][_0x187ac0(0x1ee)]);return await this[_0x187ac0(0xf8)][_0x187ac0(0x1b0)]({'key':'squire-images'}),!![];}async[_0x5ee26c(0x12c)](_0x73b7d7,_0xd0e8cc){const _0x416007=_0x5ee26c;return this[_0x416007(0x7c)][_0x416007(0x181)]({'data':{'workflowId':_0x73b7d7,'versionId':_0xd0e8cc}});}async[_0x5ee26c(0x249)](_0x44c436,_0x4889be){const _0xc96337=_0x5ee26c;try{const _0x526640={'page':_0x4889be[_0xc96337(0x1d7)],'size':_0x4889be[_0xc96337(0xff)],'modelName':_0x4889be['keyword'],'modelType':model_constant_1[_0xc96337(0x1a7)]['WORKFLOW']};(0x0,utils_1[_0xc96337(0x1ba)])(this['clsService'])?_0x4889be[_0xc96337(0xa2)]!==undefined&&(_0x526640[_0xc96337(0xa2)]=Boolean(_0x4889be[_0xc96337(0xa2)])):_0x526640[_0xc96337(0xa2)]=!![];const _0x5b57d6=await this[_0xc96337(0x77)][_0xc96337(0x82)](_0x44c436,_0x526640);let _0x21b17b=[];if(_0x5b57d6[_0xc96337(0x1ac)][_0xc96337(0x124)]){const _0x39c2cb=new Set(),_0x422044=(0x0,utils_1[_0xc96337(0x10f)])(this[_0xc96337(0x1e2)]),_0x37bfd0=_0x5b57d6[_0xc96337(0x1ac)][_0xc96337(0x18b)](_0x284989=>_0x284989['id']);if(_0x37bfd0[_0xc96337(0x124)]&&_0x422044){const _0x5e263e=await this[_0xc96337(0x116)][_0xc96337(0x238)](_0x422044,user_constant_1[_0xc96337(0x119)]['WORKFLOW'],_0x37bfd0);_0x5e263e[_0xc96337(0x1f7)](_0x2be793=>_0x39c2cb[_0xc96337(0x7d)](Number(_0x2be793[_0xc96337(0xe1)])));}_0x21b17b=_0x5b57d6['rows'][_0xc96337(0x18b)](_0x348a78=>{const _0x234bd1=_0xc96337,_0x1a3d8a={'id':_0x348a78['id'],'cover':_0x348a78[_0x234bd1(0x19e)],'name':_0x348a78[_0x234bd1(0x15e)],'workflowId':_0x348a78[_0x234bd1(0x233)],'versionId':Number(_0x348a78[_0x234bd1(0x205)]),'deduct':_0x348a78[_0x234bd1(0x141)],'vipFreeNum':_0x348a78[_0x234bd1(0xab)],'displaySort':_0x348a78[_0x234bd1(0xf3)],'description':_0x348a78['description'],'status':_0x348a78[_0x234bd1(0xa2)],'createdAt':_0x348a78['createdAt'],'updatedAt':_0x348a78[_0x234bd1(0x1b2)],'useCount':_0x348a78[_0x234bd1(0x23c)],'tutorial':_0x348a78[_0x234bd1(0x8f)],'freeUsed':_0x348a78['use'],'favorite':_0x39c2cb[_0x234bd1(0x95)](_0x348a78['id'])};return _0x1a3d8a;});}return{'count':_0x5b57d6[_0xc96337(0x10c)],'rows':_0x21b17b};}catch(_0x59dad3){throw new common_1[(_0xc96337(0x13f))](_0x59dad3[_0xc96337(0xaa)],common_1[_0xc96337(0x163)][_0xc96337(0x1ee)]);}}async['workflowDetail'](_0x3e64d1,_0x44b415){const _0x3bef2f=_0x5ee26c;try{let _0x40794e;const _0x186ae1=(0x0,utils_1[_0x3bef2f(0x10f)])(this[_0x3bef2f(0x1e2)]),_0xcc3157=new Set(),_0x592c16=await this['modelsService'][_0x3bef2f(0xd0)](_0x44b415);if(!_0x592c16)throw new common_1[(_0x3bef2f(0x13f))]('工作流（小工具）不存在',common_1[_0x3bef2f(0x163)][_0x3bef2f(0x1ee)]);if(_0x186ae1){const _0x514a03=await this['userService']['getUserById'](_0x186ae1);if(_0x514a03[_0x3bef2f(0x1be)]||_0x514a03[_0x3bef2f(0x200)]){const _0xe78d3b=redisKey_constant_1['VIP_FREE']+'-'+_0x186ae1+'-'+_0x592c16['id'];_0x40794e=await await this[_0x3bef2f(0xf8)][_0x3bef2f(0x23a)]({'key':_0xe78d3b});}const _0x156a66=await this[_0x3bef2f(0x116)]['favoriteListByTypeAndIds'](_0x186ae1,user_constant_1['EFavorite'][_0x3bef2f(0xad)],[_0x592c16['id']]);_0x156a66[_0x3bef2f(0x1f7)](_0x2c3099=>_0xcc3157['add'](Number(_0x2c3099[_0x3bef2f(0xe1)])));}const _0x317046={'id':_0x592c16['id'],'cover':_0x592c16[_0x3bef2f(0x19e)],'name':_0x592c16[_0x3bef2f(0x15e)],'workflowId':_0x592c16[_0x3bef2f(0x233)],'versionId':Number(_0x592c16[_0x3bef2f(0x205)]),'deduct':_0x592c16[_0x3bef2f(0x141)],'vipFreeNum':_0x592c16['vipFreeNum'],'displaySort':_0x592c16[_0x3bef2f(0xf3)],'description':_0x592c16[_0x3bef2f(0x1a9)],'status':_0x592c16['status'],'createdAt':_0x592c16[_0x3bef2f(0x196)],'updatedAt':_0x592c16[_0x3bef2f(0x1b2)],'useCount':_0x592c16[_0x3bef2f(0x23c)],'tutorial':_0x592c16['remark'],'freeUsed':Number(_0x40794e),'favorite':_0xcc3157[_0x3bef2f(0x95)](_0x592c16['id'])};return _0x317046;}catch(_0x6fea44){throw new common_1[(_0x3bef2f(0x13f))](_0x6fea44['message'],common_1[_0x3bef2f(0x163)][_0x3bef2f(0x1ee)]);}}async[_0x5ee26c(0x226)](_0x242b4c){const _0x24e9a1=_0x5ee26c;try{const _0x533ae7={'id':_0x242b4c['id'],'keyType':0x5,'modelType':model_constant_1[_0x24e9a1(0x1a7)][_0x24e9a1(0xad)],'cover':_0x242b4c['cover'],'modelName':_0x242b4c[_0x24e9a1(0x92)],'model':_0x242b4c[_0x24e9a1(0xd9)],'key':'','deduct':_0x242b4c[_0x24e9a1(0x141)],'vipFreeNum':_0x242b4c['vipFreeNum'],'displaySort':_0x242b4c['displaySort'],'description':_0x242b4c[_0x24e9a1(0x1a9)],'status':_0x242b4c[_0x24e9a1(0xa2)],'remark':_0x242b4c['tutorial']};return _0x242b4c[_0x24e9a1(0x1d5)]&&(_0x533ae7[_0x24e9a1(0x205)]=String(_0x242b4c[_0x24e9a1(0x1d5)])),await this[_0x24e9a1(0x77)][_0x24e9a1(0xba)](_0x533ae7),!![];}catch(_0x16f3d2){throw new common_1[(_0x24e9a1(0x13f))](_0x16f3d2['message'],common_1[_0x24e9a1(0x163)]['BAD_REQUEST']);}}async[_0x5ee26c(0x224)](_0x397c7a){const _0x1050d9=_0x5ee26c;return this[_0x1050d9(0x77)][_0x1050d9(0x1d0)](_0x397c7a[_0x1050d9(0x185)]);}async['workflowDicts'](){const _0x2605fb=_0x5ee26c,_0x2998c8=await this[_0x2605fb(0x1e8)]['list4workflow'](_0x2605fb(0x72)),_0x1f530b=await this[_0x2605fb(0x1e8)]['list4workflow'](_0x2605fb(0x84)),_0x2f15e8=await this[_0x2605fb(0x1e8)][_0x2605fb(0x236)](_0x2605fb(0xe4)),_0x7db0a8=await this['dictService'][_0x2605fb(0x236)](_0x2605fb(0x179));return{'style':_0x2998c8,'effect_category':_0x1f530b,'effect_main_body':_0x2f15e8,'application_fields':_0x7db0a8};}async['workflowModelPage'](_0x25a496){const _0x3bbbb2=_0x5ee26c;try{const {page:page=0x1,size:size=0x14,keyword:_0x5e0318,type:_0x2148db,version:_0x42beec,style:_0x1995b9,effectCategory:_0x41e9f6,effectMainBody:_0x4a72d6,applicationFields:_0x2b0c36,disabled:_0x33555c}=_0x25a496,_0x5f16f9={};_0x5e0318&&(_0x5f16f9[_0x3bbbb2(0x92)]=(0x0,typeorm_2[_0x3bbbb2(0x1cd)])('%'+_0x5e0318+'%'));_0x2148db&&(_0x5f16f9[_0x3bbbb2(0x199)]=_0x2148db);_0x42beec&&(_0x5f16f9[_0x3bbbb2(0x195)]=_0x42beec);_0x1995b9&&(_0x5f16f9[_0x3bbbb2(0x72)]=_0x1995b9);_0x41e9f6&&(_0x5f16f9['effectCategory']=_0x41e9f6);_0x4a72d6&&(_0x5f16f9[_0x3bbbb2(0x210)]=_0x4a72d6);_0x2b0c36&&(_0x5f16f9[_0x3bbbb2(0x16d)]=_0x2b0c36);(0x0,utils_1[_0x3bbbb2(0x1ba)])(this[_0x3bbbb2(0x1e2)])?(0x0,utils_1[_0x3bbbb2(0x221)])(_0x33555c)&&(_0x5f16f9[_0x3bbbb2(0x71)]=_0x33555c):_0x5f16f9['disabled']=0x0;const [_0x2e31c2,_0xde152d]=await this['mjModelEntity'][_0x3bbbb2(0x137)]({'where':_0x5f16f9,'take':size,'skip':(page-0x1)*size,'order':{'id':'ASC'}});return{'rows':_0x2e31c2,'count':_0xde152d};}catch(_0x32924a){throw new common_1[(_0x3bbbb2(0x13f))](_0x32924a[_0x3bbbb2(0xaa)],common_1[_0x3bbbb2(0x163)][_0x3bbbb2(0x1ee)]);}}async[_0x5ee26c(0x164)](_0x326f4c){const _0x12aee1=_0x5ee26c;try{const {id:_0x1e59cd,name:_0x5def82,cover:_0x2f93a9,description:_0x2eaae0,disabled:_0xe7fe12}=_0x326f4c,_0x41d866={};return _0x5def82&&(_0x41d866[_0x12aee1(0x92)]=_0x5def82),_0x2f93a9&&(_0x41d866['cover']=_0x2f93a9),_0x2eaae0&&(_0x41d866['description']=_0x2eaae0),_0xe7fe12&&(_0x41d866['disabled']=_0xe7fe12),await this['mjModelEntity'][_0x12aee1(0x246)]({'id':_0x1e59cd},_0x41d866),!![];}catch(_0xf25922){throw new common_1[(_0x12aee1(0x13f))](_0xf25922[_0x12aee1(0xaa)],common_1[_0x12aee1(0x163)][_0x12aee1(0x1ee)]);}}async[_0x5ee26c(0x132)](_0x556b1a){const _0x210358=_0x5ee26c,_0x36eb42=_0x556b1a[_0x210358(0xdb)](',');if(!_0x556b1a['length'])throw new common_1[(_0x210358(0x13f))](_0x210358(0x154),common_1['HttpStatus'][_0x210358(0x1ee)]);return this['mjModelEntity']['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x36eb42),'disabled':0x0}});}async['workflowTaskSubmit'](_0x18b36a,_0x5dc896){const _0x1bd885=_0x5ee26c;try{const _0x27ad46=await this[_0x1bd885(0x77)][_0x1bd885(0xd0)](_0x5dc896['workflowId']);if(!_0x27ad46[_0x1bd885(0xa2)])throw new Error(_0x1bd885(0x168));let _0x31c109;const _0x1de48b=(0x0,utils_1[_0x1bd885(0x1f3)])(this['clsService']);return await this[_0x1bd885(0x136)][_0x1bd885(0x11f)](async()=>{const _0x255c34=_0x1bd885;_0x31c109=await this[_0x255c34(0xec)]({'originPrompt':'','saasId':_0x1de48b,'userId':_0x18b36a[_0x255c34(0x114)]['id'],'mode':midjourney_constant_1[_0x255c34(0x10d)][_0x255c34(0x1a0)],'botType':DrawTaskPage_dto_1[_0x255c34(0x7a)]['WORKFLOW'],'workflowId':_0x5dc896[_0x255c34(0xd9)],'fullPrompt':JSON[_0x255c34(0xe2)](_0x5dc896[_0x255c34(0x190)])}),await this['userService'][_0x255c34(0xef)](_0x18b36a[_0x255c34(0x114)]['id'],_0x27ad46,_0x31c109['id']);const _0x5b53ae=await this[_0x255c34(0x7c)][_0x255c34(0x1dd)]({'data':{'workflowId':Number(_0x27ad46[_0x255c34(0x233)]),'versionId':Number(_0x27ad46[_0x255c34(0x205)]),'inputs':_0x5dc896['inputs']}});_0x31c109['mjpTaskId']=_0x5b53ae['taskId'],await this[_0x255c34(0x1c9)][_0x255c34(0x246)]({'id':_0x31c109['id']},{'mjpTaskId':_0x5b53ae[_0x255c34(0x21c)]});}),_0x31c109;}catch(_0x43d6b7){throw new common_1[(_0x1bd885(0x13f))](_0x43d6b7[_0x1bd885(0xaa)],common_1[_0x1bd885(0x163)][_0x1bd885(0x1ee)]);}}async['workflowUsedPage'](_0x134428,_0x544bc2){const _0x47bcf4=_0x5ee26c,{page:page=0x1,size:size=0x14}=_0x544bc2,[_0x58517b]=await this[_0x47bcf4(0x136)]['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20'+_0x134428[_0x47bcf4(0x114)]['id']+_0x47bcf4(0x1bf)),_0x46eb17=await this[_0x47bcf4(0x136)]['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.used\x20AS\x20used\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20'+_0x134428['user']['id']+_0x47bcf4(0xaf)+size+_0x47bcf4(0x1eb)+(page-0x1)*size+_0x47bcf4(0x1cb));return{'rows':_0x46eb17,'count':Number(_0x58517b?.[_0x47bcf4(0x10c)]||0x0)};}async['workflowFavorite'](_0x12da10,_0x1d7f9e){const _0x58d65f=_0x5ee26c,_0x143ca6=_0x12da10[_0x58d65f(0x114)]['id'],{page:page=0x1,size:size=0x14}=_0x1d7f9e,[_0x236952]=await this[_0x58d65f(0x136)][_0x58d65f(0x16f)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27'+_0x12da10[_0x58d65f(0x114)]['id']+_0x58d65f(0x1cf)+user_constant_1[_0x58d65f(0x119)][_0x58d65f(0xad)]+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x138893=await this['connection'][_0x58d65f(0x16f)](_0x58d65f(0x169)+_0x12da10[_0x58d65f(0x114)]['id']+_0x58d65f(0x1cf)+user_constant_1[_0x58d65f(0x119)]['WORKFLOW']+_0x58d65f(0x1f1)+size+_0x58d65f(0x1eb)+(page-0x1)*size+_0x58d65f(0x1cb));if(_0x12da10[_0x58d65f(0x114)]['id']){const _0x1ba30d=await this['userService'][_0x58d65f(0x21e)](_0x143ca6);if(_0x1ba30d[_0x58d65f(0x1be)]||_0x1ba30d[_0x58d65f(0x200)])for(let _0x2877c8=0x0;_0x2877c8<_0x138893[_0x58d65f(0x124)];_0x2877c8++){const _0xa2a933=_0x138893[_0x2877c8],_0x159bb2=redisKey_constant_1['VIP_FREE']+'-'+_0x143ca6+'-'+_0xa2a933['id'],_0x31414d=await await this['redisCacheService'][_0x58d65f(0x23a)]({'key':_0x159bb2});_0xa2a933[_0x58d65f(0x16a)]=Number(_0x31414d||0x0);}}return{'rows':_0x138893,'count':_0x236952?.[_0x58d65f(0x10c)]||0x0};}async[_0x5ee26c(0x123)](_0x15fb37,_0x1907f4){const _0x24985a=_0x5ee26c;try{let _0xaef970;const _0x1dcba3=(0x0,utils_1['getReqSaasId'])(this[_0x24985a(0x1e2)]);return await this['connection'][_0x24985a(0x11f)](async()=>{const _0x25a48c=_0x24985a;_0xaef970=await this[_0x25a48c(0xec)]({'saasId':_0x1dcba3,'userId':_0x15fb37[_0x25a48c(0x114)]['id'],'mode':midjourney_constant_1[_0x25a48c(0x10d)][_0x25a48c(0x1a0)],'botType':DrawTaskPage_dto_1[_0x25a48c(0x7a)]['SD'],'originPrompt':_0x1907f4[_0x25a48c(0xbb)],'fullPrompt':JSON[_0x25a48c(0xe2)](_0x1907f4)}),await this['userService'][_0x25a48c(0x158)](_0x15fb37[_0x25a48c(0x114)]['id'],_0xaef970['id']);const _0x5958df=await this[_0x25a48c(0x7c)][_0x25a48c(0x201)]({'data':_0x1907f4});_0xaef970[_0x25a48c(0x1df)]=_0x5958df['paintingSign'],await this[_0x25a48c(0x1c9)][_0x25a48c(0x246)]({'id':_0xaef970['id']},{'mjpTaskId':_0x5958df['paintingSign']});}),_0xaef970;}catch(_0x36dba4){throw new common_1[(_0x24985a(0x13f))](_0x36dba4[_0x24985a(0xaa)],common_1[_0x24985a(0x163)]['BAD_REQUEST']);}}async['sdTaskInpaint'](_0x2b0f7d,_0x2e784f){const _0x4ddd9d=_0x5ee26c;try{const _0x1ad6fe=await this[_0x4ddd9d(0x1c9)][_0x4ddd9d(0x150)]({'where':{'id':Number(_0x2e784f[_0x4ddd9d(0x21c)])}});if(!_0x1ad6fe)throw new Error(_0x4ddd9d(0xe6));let _0x5ce7a6;const _0x299a15=(0x0,utils_1['getReqSaasId'])(this[_0x4ddd9d(0x1e2)]);return await this[_0x4ddd9d(0x136)][_0x4ddd9d(0x11f)](async()=>{const _0x30e0e6=_0x4ddd9d;_0x5ce7a6=await this[_0x30e0e6(0xec)]({'saasId':_0x299a15,'userId':_0x2b0f7d[_0x30e0e6(0x114)]['id'],'mode':midjourney_constant_1['DrawSpeed'][_0x30e0e6(0x1a0)],'botType':DrawTaskPage_dto_1[_0x30e0e6(0x7a)]['SD'],'originPrompt':_0x2e784f[_0x30e0e6(0xbb)],'originTaskId':_0x2e784f[_0x30e0e6(0x21c)],'fullPrompt':JSON['stringify'](_0x2e784f)}),await this['userService'][_0x30e0e6(0x158)](_0x2b0f7d['user']['id'],_0x5ce7a6['id']);const _0x9a9e2d=await this[_0x30e0e6(0x7c)][_0x30e0e6(0xcb)]({'data':{'mask':_0x2e784f['mask'],'prompt':_0x2e784f['prompt'],'taskId':_0x1ad6fe[_0x30e0e6(0x1df)],'denoisingStrength':_0x2e784f[_0x30e0e6(0xdc)]}});_0x5ce7a6[_0x30e0e6(0x1df)]=_0x9a9e2d[_0x30e0e6(0x20b)],await this[_0x30e0e6(0x1c9)]['update']({'id':_0x5ce7a6['id']},{'mjpTaskId':_0x9a9e2d[_0x30e0e6(0x20b)]});}),_0x5ce7a6;}catch(_0x3e261f){throw new common_1[(_0x4ddd9d(0x13f))](_0x3e261f[_0x4ddd9d(0xaa)],common_1[_0x4ddd9d(0x163)][_0x4ddd9d(0x1ee)]);}}async[_0x5ee26c(0x1e4)](_0x39ed6f){const _0x20f260=_0x5ee26c,{id:_0x33a2c7,favorite:_0x111591}=_0x39ed6f,_0x45bff=await this[_0x20f260(0x1c9)][_0x20f260(0x150)]({'where':{'id':_0x33a2c7}})[_0x20f260(0xed)](_0x4fbe04=>{const _0x4285b1=_0x20f260;common_1[_0x4285b1(0x145)]['error'](_0x4fbe04);});if(!_0x45bff)throw new common_1['HttpException'](_0x20f260(0x1a5),common_1[_0x20f260(0x163)]['BAD_REQUEST']);const _0x3a3890=await this[_0x20f260(0x1c9)][_0x20f260(0x246)]({'id':_0x33a2c7},{'favorite':_0x111591});if(_0x3a3890['affected']<=0x0)throw new common_1[(_0x20f260(0x13f))]('操作失败！',common_1[_0x20f260(0x163)][_0x20f260(0x1ee)]);return!![];}async['deleteDraw'](_0x16f4a8,_0x127514){const _0xc93bc=_0x5ee26c;try{const _0x6a67b3=await this['midjourneyEntity']['findOne']({'where':{'id':_0x16f4a8,'userId':_0x127514['user']['id']}});if(!_0x6a67b3)throw new Error(_0xc93bc(0x18f));if(_0x6a67b3['status']===midjourney_constant_1[_0xc93bc(0xeb)][_0xc93bc(0xcf)])throw new Error(_0xc93bc(0x208));await this[_0xc93bc(0x10b)]['cancel'](null,_0x6a67b3[_0xc93bc(0x1df)]);const _0x227c2e=await this['midjourneyEntity'][_0xc93bc(0x107)]({'id':_0x16f4a8});if(_0x227c2e[_0xc93bc(0xb2)]>0x0)return _0xc93bc(0x214);else throw new Error(_0xc93bc(0xa3));}catch(_0x130985){throw new common_1[(_0xc93bc(0x13f))](_0x130985['message'],common_1[_0xc93bc(0x163)]['BAD_REQUEST']);}}async[_0x5ee26c(0x155)](_0x5cc92a,_0x4075f7){const _0x40356d=_0x5ee26c,{id:_0x3c09fe}=_0x4075f7;if(!_0x3c09fe)throw new common_1[(_0x40356d(0x13f))](_0x40356d(0x140),common_1['HttpStatus'][_0x40356d(0x1ee)]);const _0x1bef7a=await this[_0x40356d(0x1c9)]['delete']({'id':_0x3c09fe});if(_0x1bef7a[_0x40356d(0xb2)]<=0x0)throw new common_1[(_0x40356d(0x13f))](_0x40356d(0x89),common_1[_0x40356d(0x163)][_0x40356d(0x1ee)]);return!![];}async['setPrompt'](_0x1aebef,_0x5240b5){const _0x509f2d=_0x5ee26c;try{const {prompt:_0x1696f3,status:_0x2bdb68,isCarryParams:_0x3eb4f5,imageUrl:_0x25236a,title:_0x3c523e,order:_0x3d8748,id:_0x1ffae1,aspect:_0x267f5e}=_0x5240b5;if(_0x1ffae1)return await this[_0x509f2d(0x103)][_0x509f2d(0x246)]({'id':_0x1ffae1},{'title':_0x3c523e,'prompt':_0x1696f3,'imageUrl':_0x25236a,'status':_0x2bdb68,'isCarryParams':_0x3eb4f5,'order':_0x3d8748,'aspect':_0x267f5e})[_0x509f2d(0x111)](_0x1176b6=>!!_0x1176b6);else{const _0x213720=(0x0,utils_1['getReqSaasId'])(this[_0x509f2d(0x1e2)]);return await this[_0x509f2d(0x103)][_0x509f2d(0xb9)]({'prompt':_0x1696f3,'status':_0x2bdb68,'imageUrl':_0x25236a,'isCarryParams':_0x3eb4f5,'title':_0x3c523e,'order':_0x3d8748,'aspect':_0x267f5e,'saasId':_0x213720})[_0x509f2d(0x111)](_0x4d3dd0=>!!_0x4d3dd0);}}catch(_0x4636c1){console[_0x509f2d(0x128)]('error:\x20',_0x4636c1);}}async['delPrompt'](_0x41bc37,_0x109f96){const _0x50672a=_0x5ee26c,{id:_0x3c1fae}=_0x109f96;if(!_0x3c1fae)throw new common_1[(_0x50672a(0x13f))]('非法操作！',common_1['HttpStatus'][_0x50672a(0x1ee)]);return await this['mjPromptsEntity'][_0x50672a(0x107)]({'id':_0x3c1fae});}async['queryAllPrompt'](){const _0x1a8add=_0x5ee26c,_0x3eea1a=(0x0,utils_1[_0x1a8add(0x1f3)])(this['clsService']);return await this[_0x1a8add(0x103)][_0x1a8add(0x216)]({'where':{'saasId':_0x3eea1a},'order':{'order':_0x1a8add(0x1d9)}})[_0x1a8add(0x111)](_0x4b455c=>_0x4b455c||[])[_0x1a8add(0xed)](_0x2eb830=>{const _0x1dec8d=_0x1a8add;common_1['Logger'][_0x1dec8d(0x235)](_0x2eb830);});}async['promptsPage'](_0x3c6a8d){const _0x2d015=_0x5ee26c;try{const {page:_0x2904a3,size:_0x4eaf0b,keyword:_0x4c691b,saasId:_0x2b4872}=_0x3c6a8d,_0x20b0a4=(0x0,utils_1['getReqSaasId'])(this[_0x2d015(0x1e2)]),_0x26b985={'status':!![]};(0x0,utils_1[_0x2d015(0x11c)])(this[_0x2d015(0x1e2)])?(0x0,utils_1[_0x2d015(0x221)])(_0x2b4872)&&(_0x26b985['saasId']=_0x2b4872):_0x26b985[_0x2d015(0xa1)]=_0x20b0a4;const [_0x2817f2,_0x3b07a4]=await this[_0x2d015(0x103)]['findAndCount']({'where':[{..._0x26b985,'title':(0x0,typeorm_2[_0x2d015(0x1cd)])('%'+_0x4c691b+'%')},{..._0x26b985,'prompt':(0x0,typeorm_2[_0x2d015(0x1cd)])('%'+_0x4c691b+'%')}],'take':_0x4eaf0b,'skip':(_0x2904a3-0x1)*_0x4eaf0b,'order':{'order':_0x2d015(0x1d9)}});return{'rows':_0x2817f2,'count':_0x3b07a4};}catch(_0x21801b){throw new common_1['HttpException'](_0x21801b[_0x2d015(0xaa)],common_1[_0x2d015(0x163)]['BAD_REQUEST']);}}async[_0x5ee26c(0x1ff)](_0x397274){const _0x3f5e36=_0x5ee26c;try{const {name:_0x4eb826,value:_0xead629}=_0x397274,_0x50eecc=(0x0,utils_1['getReqSaasId'])(this[_0x3f5e36(0x1e2)]),_0x1b9266=await this[_0x3f5e36(0xc5)][_0x3f5e36(0x125)]({'name':_0x4eb826,'saasId':_0x50eecc});if(_0x1b9266)throw new common_1[(_0x3f5e36(0x13f))](_0x3f5e36(0x1c0),common_1['HttpStatus']['BAD_REQUEST']);return await this['mjInspireClassifyEntity'][_0x3f5e36(0xb9)]({'name':_0x4eb826,'value':_0xead629,'saasId':_0x50eecc})['then'](_0x511a27=>!!_0x511a27)['catch'](_0x33a405=>{const _0x664c52=_0x3f5e36;console[_0x664c52(0x128)](_0x33a405);throw new common_1['HttpException'](_0x33a405,common_1['HttpStatus'][_0x664c52(0x1ee)]);});}catch(_0x2341c7){return![];}}async[_0x5ee26c(0x1e3)](_0x34fba6){const _0x6d966e=_0x5ee26c,{id:_0x1dc2f0,name:_0x45a6b7,value:_0x27fa0b}=_0x34fba6;return await this[_0x6d966e(0xc5)][_0x6d966e(0x246)](_0x1dc2f0,{'name':_0x45a6b7,'value':_0x27fa0b})['then'](_0x140e48=>!!_0x140e48);}async[_0x5ee26c(0x22a)](_0x3da067){const _0xed86ff=_0x5ee26c,{id:_0x561222}=_0x3da067;return await this[_0xed86ff(0xc5)][_0xed86ff(0x107)]({'id':_0x561222})[_0xed86ff(0xed)](_0x5129a6=>{const _0x1ff398=_0xed86ff;throw new common_1[(_0x1ff398(0x13f))](_0x5129a6,common_1[_0x1ff398(0x163)]['BAD_REQUEST']);});}async[_0x5ee26c(0x78)](_0x332006){const _0x273dc1=_0x5ee26c,{size:_0x120e7b,page:_0x3c7ad0,saasId:_0x31fd8a}=_0x332006,_0x20d28c=(0x0,utils_1[_0x273dc1(0x1f3)])(this[_0x273dc1(0x1e2)]),_0x4f5610={};(0x0,utils_1[_0x273dc1(0x11c)])(this[_0x273dc1(0x1e2)])?(0x0,utils_1[_0x273dc1(0x221)])(_0x31fd8a)&&(_0x4f5610[_0x273dc1(0xa1)]=_0x31fd8a):_0x4f5610[_0x273dc1(0xa1)]=_0x20d28c;const _0x510236=await this[_0x273dc1(0xc5)][_0x273dc1(0x137)]({'where':_0x4f5610,'order':{'createdAt':'DESC'},'take':_0x120e7b,'skip':(_0x3c7ad0-0x1)*_0x120e7b})[_0x273dc1(0xed)](_0x52cbb2=>{const _0x55e3b0=_0x273dc1;throw new common_1[(_0x55e3b0(0x13f))](_0x52cbb2,common_1['HttpStatus'][_0x55e3b0(0x1ee)]);});if(!_0x510236)throw new common_1[(_0x273dc1(0x13f))](_0x273dc1(0x184),common_1[_0x273dc1(0x163)]['BAD_REQUEST']);const [_0xf46391,_0x3d0c0c]=_0x510236;return{'rows':_0xf46391,'count':_0x3d0c0c};}async[_0x5ee26c(0x1d2)](_0x197de9){const _0x4c1c11=_0x5ee26c,{id:_0x50609f}=_0x197de9;return await this[_0x4c1c11(0xc5)][_0x4c1c11(0x150)]({'where':{'id':_0x50609f}});}async['addMjIncantationClassify'](_0x516498){const _0x2d447b=_0x5ee26c;try{const _0x741872=(0x0,utils_1[_0x2d447b(0x1f3)])(this[_0x2d447b(0x1e2)]),{classifyName:_0x3e7ab2,level:_0x477369,type:_0x252ac7,pid:pid=0x0}=_0x516498;return await this[_0x2d447b(0x110)][_0x2d447b(0xb9)]({'classifyName':_0x3e7ab2,'level':_0x477369,'type':_0x252ac7,'pid':pid,'saasId':_0x741872})[_0x2d447b(0x111)](_0xaf574f=>!!_0xaf574f)['catch'](_0x1d7b84=>{const _0x4960d8=_0x2d447b;console[_0x4960d8(0x128)](_0x1d7b84);throw new common_1[(_0x4960d8(0x13f))](_0x1d7b84,common_1[_0x4960d8(0x163)][_0x4960d8(0x1ee)]);});}catch(_0x1e96e6){return![];}}async[_0x5ee26c(0x1d8)](_0x41e85a){const _0x2de817=_0x5ee26c,{id:_0x506993,classifyName:_0x3ba5fd,level:_0x1981de,type:_0x31d756,pid:_0x2abc07}=_0x41e85a;return this[_0x2de817(0x136)][_0x2de817(0x11f)](async()=>{const _0x51065f=_0x2de817,_0x18c448=await this[_0x51065f(0x110)][_0x51065f(0x150)]({'where':{'id':_0x506993}});_0x18c448[_0x51065f(0x199)]!==_0x31d756&&await this['mjIncantationClassifyEntity'][_0x51065f(0x246)]({'pid':_0x506993},{'type':_0x31d756}),await this[_0x51065f(0x110)][_0x51065f(0x246)](_0x506993,{'classifyName':_0x3ba5fd,'level':_0x1981de,'type':_0x31d756,'pid':_0x2abc07});}),!![];}async['removeMjIncantationClassify'](_0x234af9){const _0x3f2994=_0x5ee26c,{id:_0x735070}=_0x234af9;return await this[_0x3f2994(0x110)][_0x3f2994(0x107)]({'id':_0x735070})[_0x3f2994(0x111)](_0x3e3b2d=>_0x3e3b2d[_0x3f2994(0xb2)]>0x0);}async[_0x5ee26c(0x1b4)](_0x81c56d){const _0x45cd00=_0x5ee26c,{id:_0x35d6cb}=_0x81c56d;return await this[_0x45cd00(0x110)][_0x45cd00(0x150)]({'where':{'id':_0x35d6cb}});}async['queryTopMjIncantationClassify'](){const _0x58cede=_0x5ee26c,_0x37a9c2=(0x0,utils_1[_0x58cede(0x1f3)])(this[_0x58cede(0x1e2)]);return this[_0x58cede(0x110)][_0x58cede(0x216)]({'where':{'level':0x1,'saasId':_0x37a9c2}});}async[_0x5ee26c(0x1b1)](_0x1d64a0){const _0x46caf3=_0x5ee26c,{size:_0x1809d5,page:_0x22b9b2,type:_0x378f81,keyword:_0x412309,level:_0x4c86aa,saasId:_0x48cb55}=_0x1d64a0,_0x532ebf=(0x0,utils_1[_0x46caf3(0x1f3)])(this[_0x46caf3(0x1e2)]);let _0x40bfe3={};_0x4c86aa>0x0&&(_0x40bfe3[_0x46caf3(0x20a)]=_0x4c86aa);_0x378f81&&(_0x40bfe3[_0x46caf3(0x199)]=_0x378f81);_0x412309&&(_0x40bfe3[_0x46caf3(0x230)]=(0x0,typeorm_2[_0x46caf3(0x1cd)])('%'+_0x412309+'%'));(0x0,utils_1[_0x46caf3(0x11c)])(this['clsService'])?(0x0,utils_1[_0x46caf3(0x221)])(_0x48cb55)&&(_0x40bfe3['saasId']=_0x48cb55):_0x40bfe3['saasId']=_0x532ebf;const _0x39f1c9=await this['mjIncantationClassifyEntity'][_0x46caf3(0x137)]({'order':{'createdAt':_0x46caf3(0x1d9)},'where':_0x40bfe3,'take':_0x1809d5,'skip':(_0x22b9b2-0x1)*_0x1809d5})[_0x46caf3(0xed)](_0x446db5=>{const _0x4d2cad=_0x46caf3;console[_0x4d2cad(0x128)](_0x446db5);});if(!_0x39f1c9)throw new common_1[(_0x46caf3(0x13f))]('查询咒语分类失败',common_1[_0x46caf3(0x163)][_0x46caf3(0x1ee)]);const [_0x4e7627,_0x1baf01]=_0x39f1c9;return{'rows':_0x4e7627,'count':_0x1baf01};}async[_0x5ee26c(0x1d1)](_0xae9dba){const _0x3225cd=_0x5ee26c,{level:_0x297b1e,type:_0x44a250,saasId:_0x4d9604}=_0xae9dba,_0x53c5b8=(0x0,utils_1[_0x3225cd(0x1f3)])(this[_0x3225cd(0x1e2)]),_0x500975={};_0x297b1e===0x0?_0x500975[_0x3225cd(0x20a)]=(0x0,typeorm_2['MoreThan'])(_0x297b1e):_0x500975[_0x3225cd(0x20a)]=_0x297b1e;_0x44a250&&(_0x500975['type']=_0x44a250);(0x0,utils_1[_0x3225cd(0x11c)])(this[_0x3225cd(0x1e2)])?(0x0,utils_1[_0x3225cd(0x221)])(_0x4d9604)&&(_0x500975[_0x3225cd(0xa1)]=_0x4d9604):_0x500975['saasId']=_0x53c5b8;const _0x75340f=await this[_0x3225cd(0x110)][_0x3225cd(0x170)](_0x500975)[_0x3225cd(0xed)](_0x4ce92b=>{const _0x452a71=_0x3225cd;console[_0x452a71(0x128)](_0x4ce92b);});if(!_0x75340f)throw new common_1[(_0x3225cd(0x13f))]('查询咒语分类失败',common_1[_0x3225cd(0x163)][_0x3225cd(0x1ee)]);if(_0x297b1e===0x0)return{'level1':_0x75340f[_0x3225cd(0x139)](_0x287d49=>_0x287d49[_0x3225cd(0x20a)]===0x1),'level2':_0x75340f[_0x3225cd(0x139)](_0x3d6c8b=>_0x3d6c8b['level']===0x2)};return _0x75340f;}async[_0x5ee26c(0xdd)](_0x5638a4){const _0x2e58d7=_0x5ee26c;try{const _0x5e6e23=(0x0,utils_1[_0x2e58d7(0x1f3)])(this[_0x2e58d7(0x1e2)]),{incantationEn:_0x14b943,incantationCn:_0x1b078a,img:_0x1f71ff,pid:_0x47bd93}=_0x5638a4;return await this[_0x2e58d7(0x14c)][_0x2e58d7(0xb9)]({'incantationEn':_0x14b943,'incantationCn':_0x1b078a,'img':_0x1f71ff,'pid':_0x47bd93,'saasId':_0x5e6e23})[_0x2e58d7(0x111)](_0xcc5a3c=>!!_0xcc5a3c)[_0x2e58d7(0xed)](_0x2ffb51=>{throw _0x2ffb51;});}catch(_0x3c2047){return console[_0x2e58d7(0x128)](_0x3c2047),![];}}async[_0x5ee26c(0xde)](_0x4d5df0){const _0x7a3352=_0x5ee26c,{id:_0x572715,incantationEn:_0x404576,incantationCn:_0x30a06f,img:_0x5c48d5,pid:_0xdb1efa}=_0x4d5df0;return await this[_0x7a3352(0x14c)][_0x7a3352(0x246)](_0x572715,{'incantationCn':_0x30a06f,'incantationEn':_0x404576,'img':_0x5c48d5,'pid':_0xdb1efa});}async[_0x5ee26c(0xd4)](_0x409dc3){const _0x34dc42=_0x5ee26c,{id:_0x258729}=_0x409dc3;return await this[_0x34dc42(0x14c)]['delete']({'id':_0x258729})['then'](_0x48d8d5=>_0x48d8d5['affected']>0x0);}async['getMjIncantation'](_0x25e7e8){const _0x2d9fce=_0x5ee26c,{id:_0x4c0f6c}=_0x25e7e8;return await this['mjIncantationEntity'][_0x2d9fce(0x150)]({'where':{'id':_0x4c0f6c}});}async[_0x5ee26c(0x99)](_0x11f6f3){const _0x3a6367=_0x5ee26c,_0x20368a=(0x0,utils_1[_0x3a6367(0x1f3)])(this[_0x3a6367(0x1e2)]),{size:_0x34992a,page:_0xa377f3,keyword:_0x1dd883,pid:_0x11f37d,saasId:_0x19a173}=_0x11f6f3;let _0x3116f={};_0x11f37d>0x0&&(_0x3116f['pid']=_0x11f37d);_0x1dd883&&(_0x3116f[_0x3a6367(0x105)]=(0x0,typeorm_2[_0x3a6367(0x1cd)])('%'+_0x1dd883+'%'));(0x0,utils_1[_0x3a6367(0x11c)])(this[_0x3a6367(0x1e2)])?(0x0,utils_1[_0x3a6367(0x221)])(_0x19a173)&&(_0x3116f['saasId']=_0x19a173):_0x3116f[_0x3a6367(0xa1)]=_0x20368a;const _0xf82035=await this[_0x3a6367(0x14c)][_0x3a6367(0x137)]({'order':{'createdAt':_0x3a6367(0x1d9)},'where':_0x3116f,'take':_0x34992a,'skip':(_0xa377f3-0x1)*_0x34992a})[_0x3a6367(0xed)](_0x3b708a=>{console['log'](_0x3b708a);});if(!_0xf82035)throw new common_1[(_0x3a6367(0x13f))](_0x3a6367(0x193),common_1[_0x3a6367(0x163)][_0x3a6367(0x1ee)]);const [_0x1924fe,_0x249a90]=_0xf82035;return{'rows':_0x1924fe,'count':_0x249a90};}async[_0x5ee26c(0x1b8)](_0x56191c){const _0x61b2be=_0x5ee26c,{id:_0x178b6c}=_0x56191c,_0x52a742=await this[_0x61b2be(0x110)][_0x61b2be(0x150)]({'where':{'level':0x1,'id':_0x178b6c}})['catch'](_0x1d4738=>{const _0x2b138f=_0x61b2be;common_1[_0x2b138f(0x145)][_0x2b138f(0x235)](_0x1d4738);});if(!_0x52a742)throw new common_1['HttpException'](_0x61b2be(0x1e1),common_1[_0x61b2be(0x163)][_0x61b2be(0x1ee)]);const _0x2937e6=await this[_0x61b2be(0x110)]['find']({'where':{'level':0x2,'pid':_0x52a742['id']}})[_0x61b2be(0xed)](_0x54ffb9=>{const _0x52ec10=_0x61b2be;common_1[_0x52ec10(0x145)]['error'](_0x54ffb9);});if(!_0x2937e6||_0x2937e6[_0x61b2be(0x124)]===0x0)return{'rows':[]};const _0xc9ed32=_0x2937e6[_0x61b2be(0x18b)](_0x8db60f=>_0x8db60f['id']),_0x7251a3=await this[_0x61b2be(0x14c)][_0x61b2be(0x216)]({'where':{'pid':(0x0,typeorm_2['In'])(_0xc9ed32)}})['catch'](_0x1ea8e5=>{const _0x4d56a7=_0x61b2be;common_1['Logger'][_0x4d56a7(0x235)](_0x1ea8e5);});if(!_0x7251a3)throw new common_1[(_0x61b2be(0x13f))](_0x61b2be(0x193),common_1[_0x61b2be(0x163)]['BAD_REQUEST']);const _0x47af15=_0x2937e6['map'](_0xdb5039=>{const _0x9f48c4=_0x61b2be;return{'children':_0x7251a3['filter'](_0xfb8e47=>_0xfb8e47[_0x9f48c4(0x10e)]===_0xdb5039['id'])||[],..._0xdb5039};});return{'rows':_0x47af15};}async[_0x5ee26c(0x13a)](){const _0x4e2d57=_0x5ee26c,_0x3941ac=(0x0,utils_1[_0x4e2d57(0x1f3)])(this['clsService']),_0x37b7ea=await this[_0x4e2d57(0x14c)][_0x4e2d57(0x216)]({'where':{'saasId':_0x3941ac},'order':{'createdAt':_0x4e2d57(0x1d9)}})[_0x4e2d57(0xed)](_0x19c3db=>{const _0x1c196b=_0x4e2d57;console[_0x1c196b(0x128)](_0x19c3db);});if(!_0x37b7ea)throw new common_1[(_0x4e2d57(0x13f))]('查询咒语失败',common_1[_0x4e2d57(0x163)][_0x4e2d57(0x1ee)]);return _0x37b7ea;}async[_0x5ee26c(0x1c2)](_0x36aa0d){const _0x371785=_0x5ee26c,_0x5076c9=(0x0,utils_1[_0x371785(0x1f3)])(this[_0x371785(0x1e2)]),{id:_0x11650f,suggestCn:_0x48a4a3,suggestEn:_0x520c60,order:_0x54e0a2,image:_0xaaddc3}=_0x36aa0d,_0x1d49b6=await this[_0x371785(0x18a)][_0x371785(0x150)]({'where':{'suggestCn':_0x48a4a3,'saasId':_0x5076c9}});if(_0x11650f){if(_0x1d49b6&&_0x1d49b6['id']!==_0x11650f)throw new common_1[(_0x371785(0x13f))](_0x371785(0x16e),common_1[_0x371785(0x163)][_0x371785(0x1ee)]);}else{if(_0x1d49b6)throw new common_1[(_0x371785(0x13f))](_0x371785(0x16e),common_1['HttpStatus'][_0x371785(0x1ee)]);}const _0x2493a8=await this[_0x371785(0x18a)][_0x371785(0xb9)]({'id':_0x11650f,'suggestCn':_0x48a4a3,'suggestEn':_0x520c60,'order':_0x54e0a2||0x64,'image':_0xaaddc3||'','saasId':_0x5076c9})[_0x371785(0x111)](_0x2f69f9=>!!_0x2f69f9['id'])[_0x371785(0xed)](_0x1d1c13=>{const _0x308517=_0x371785;console[_0x308517(0x128)](_0x1d1c13);});if(!_0x2493a8)throw new common_1[(_0x371785(0x13f))]('保存推荐关键词',common_1[_0x371785(0x163)][_0x371785(0x1ee)]);return _0x2493a8;}async['removeSuggestWords'](_0x37b667){const _0x589d18=_0x5ee26c,{id:_0x3f811f}=_0x37b667,_0x1d8ee6=await this['mjSuggestWordEntity']['exist']({'where':{'id':_0x3f811f}});if(!_0x1d8ee6)throw new common_1['HttpException'](_0x589d18(0x101),common_1[_0x589d18(0x163)][_0x589d18(0x1ee)]);const _0x26cfcc=await this[_0x589d18(0x18a)][_0x589d18(0x107)](_0x3f811f)[_0x589d18(0x111)](_0x168a10=>_0x168a10['affected']>0x0)[_0x589d18(0xed)](_0x57a086=>{const _0x33ad30=_0x589d18;console[_0x33ad30(0x128)](_0x57a086);});if(!_0x26cfcc)throw new common_1[(_0x589d18(0x13f))](_0x589d18(0xa9),common_1[_0x589d18(0x163)][_0x589d18(0x1ee)]);return _0x26cfcc;}async[_0x5ee26c(0x20f)](_0x316d3c){const _0x5c0641=_0x5ee26c;let _0x1e51be={};const {page:_0x3e9e7c,size:_0x50bca8,saasId:_0x5cdb26}=_0x316d3c,_0x1893f9=(0x0,utils_1[_0x5c0641(0x1f3)])(this[_0x5c0641(0x1e2)]);(0x0,utils_1[_0x5c0641(0x11c)])(this[_0x5c0641(0x1e2)])?(0x0,utils_1['isDefined'])(_0x5cdb26)&&(_0x1e51be['saasId']=_0x5cdb26):_0x1e51be[_0x5c0641(0xa1)]=_0x1893f9;const _0x29c738=await this[_0x5c0641(0x18a)][_0x5c0641(0x137)]({'where':_0x1e51be,'take':_0x50bca8,'skip':(_0x3e9e7c-0x1)*_0x50bca8,'order':{'order':_0x5c0641(0x1d9)}})[_0x5c0641(0x111)](([_0x192a80,_0x545b35])=>({'rows':_0x192a80,'count':_0x545b35}))[_0x5c0641(0xed)](_0x35fcfd=>{const _0x2b1579=_0x5c0641;console[_0x2b1579(0x128)](_0x35fcfd);});if(!_0x29c738)throw new common_1['HttpException']('查询推荐关键词失败',common_1[_0x5c0641(0x163)]['BAD_REQUEST']);return _0x29c738;}async[_0x5ee26c(0xa0)](_0x11e599){const _0x1c88d0=_0x5ee26c,_0x1aa3d2=await this[_0x1c88d0(0x22b)]({'rec':_0x11e599[_0x1c88d0(0xe3)],'page':_0x11e599[_0x1c88d0(0x1d7)],'size':_0x11e599[_0x1c88d0(0xff)],'status':_0x11e599['status'],'keyword':_0x11e599['keyword'],'squareType':_0x11e599[_0x1c88d0(0x106)]});return _0x1aa3d2[_0x1c88d0(0x1ac)][_0x1c88d0(0x1f7)](_0x5168ec=>{const _0x513d16=_0x1c88d0;_0x5168ec['fileInfo']=_0x5168ec[_0x513d16(0x172)]?JSON[_0x513d16(0x213)](_0x5168ec[_0x513d16(0x172)]):{};}),_0x1aa3d2;}[_0x5ee26c(0x12a)](_0x20f3ea){const _0x23a9f4=_0x5ee26c;if(!_0x20f3ea)return _0x23a9f4(0x1a0);if(_0x20f3ea===midjourney_constant_1['DrawSpeed'][_0x23a9f4(0x1a0)])return _0x23a9f4(0x1a0);if(_0x20f3ea===midjourney_constant_1[_0x23a9f4(0x10d)][_0x23a9f4(0x8b)])return _0x23a9f4(0x8b);if(_0x20f3ea===midjourney_constant_1[_0x23a9f4(0x10d)][_0x23a9f4(0x16c)])return'turbo';return _0x23a9f4(0x1a0);}async[_0x5ee26c(0x134)](){const _0x17e129=_0x5ee26c;if(process[_0x17e129(0x98)][_0x17e129(0xac)]===_0x17e129(0x243))return;try{const _0x40c7f3=await this[_0x17e129(0x7c)][_0x17e129(0x188)]({});for(let _0x48730b in _0x40c7f3){let _0x23d8ee=_0x48730b;for(let _0x4b2a44=0x0;_0x4b2a44<_0x40c7f3[_0x48730b][_0x17e129(0x124)];_0x4b2a44++){const _0x246bfb=_0x40c7f3[_0x48730b][_0x4b2a44];let _0x239a34=await this['dictService'][_0x17e129(0x24b)](_0x23d8ee,String(_0x246bfb['id']));_0x239a34?(_0x239a34[_0x17e129(0x157)]=_0x23d8ee,_0x239a34[_0x17e129(0x23d)]=_0x246bfb['name'],_0x239a34[_0x17e129(0xc6)]=String(_0x246bfb['id'])):_0x239a34={'dictType':_0x23d8ee,'dictName':_0x246bfb[_0x17e129(0x92)],'dictValue':String(_0x246bfb['id'])},await this['dictService'][_0x17e129(0xb5)](_0x239a34);}}common_1[_0x17e129(0x145)]['log'](_0x17e129(0x1f9));}catch(_0x40793d){common_1[_0x17e129(0x145)][_0x17e129(0x235)](_0x40793d,_0x17e129(0x146));}}async[_0x5ee26c(0x15d)](_0x1e0b13){const _0x5e0410=_0x5ee26c;let _0x40ff43=[];try{const _0x6b0cb6=await this[_0x5e0410(0x7c)]['modelPage']({'data':{'size':0x32,'index':0x1,'tagIds':[_0x1e0b13]}});_0x40ff43=_0x40ff43[_0x5e0410(0xd8)](_0x6b0cb6[_0x5e0410(0x87)]);for(let _0x5dde74=0x2;_0x5dde74<=_0x6b0cb6[_0x5e0410(0x15f)];_0x5dde74++){const _0x4eedf3=await this[_0x5e0410(0x7c)][_0x5e0410(0x1db)]({'data':{'index':_0x5dde74,'size':0x32,'tagIds':[_0x1e0b13]}});_0x40ff43=_0x40ff43[_0x5e0410(0xd8)](_0x4eedf3[_0x5e0410(0x87)]);}return _0x40ff43;}catch(_0x587635){return common_1[_0x5e0410(0x145)][_0x5e0410(0x235)](_0x587635,_0x5e0410(0xa8)),[];}}async[_0x5ee26c(0x1e0)](){const _0x51bbc6=_0x5ee26c;if(process['env'][_0x51bbc6(0xac)]===_0x51bbc6(0x243))return;try{const _0x57ec9f=await this[_0x51bbc6(0x1e8)]['list4dictTypes']([_0x51bbc6(0x72),_0x51bbc6(0x84),_0x51bbc6(0xe4),'application_fields']),_0x1fd704=new Map(),_0x3a70fa=await this[_0x51bbc6(0x96)][_0x51bbc6(0x216)]();_0x3a70fa[_0x51bbc6(0x1f7)](_0x5319f3=>_0x1fd704[_0x51bbc6(0x19d)](_0x5319f3['id'],_0x5319f3));for(let _0x5efb5d=0x0;_0x5efb5d<_0x57ec9f['length'];_0x5efb5d++){const _0xf4a3b=_0x57ec9f[_0x5efb5d]['dictName'],_0x40d0d9=Number(_0x57ec9f[_0x5efb5d][_0x51bbc6(0xc6)]),_0x368b89=await this[_0x51bbc6(0x15d)](_0x40d0d9);_0x368b89[_0x51bbc6(0x1f7)](_0x5db1cf=>{const _0x102dad=_0x51bbc6,_0xa61093=String(_0x5db1cf['id']);!_0x1fd704[_0x102dad(0x95)](_0xa61093)&&_0x1fd704['set'](_0xa61093,{'id':_0xa61093,'type':_0x5db1cf['modelType'],'name':_0x5db1cf[_0x102dad(0x92)],'cover':'https://img2.huashi6.com/'+_0x5db1cf['coverImageUrl'],'version':_0x5db1cf[_0x102dad(0x1da)],'description':'','triggerWords':_0x5db1cf[_0x102dad(0x1f0)]});const _0x20594c=_0x1fd704[_0x102dad(0x23a)](_0xa61093);_0x57ec9f[_0x5efb5d][_0x102dad(0x157)]===_0x102dad(0x72)&&(_0x20594c[_0x102dad(0x72)]=_0x40d0d9,_0x20594c[_0x102dad(0x8c)]=_0xf4a3b),_0x57ec9f[_0x5efb5d][_0x102dad(0x157)]==='effect_category'&&(_0x20594c[_0x102dad(0x160)]=_0x40d0d9,_0x20594c[_0x102dad(0x17e)]=_0xf4a3b),_0x57ec9f[_0x5efb5d][_0x102dad(0x157)]==='effect_main_body'&&(_0x20594c[_0x102dad(0x210)]=_0x40d0d9,_0x20594c['effectMainBodyName']=_0xf4a3b),_0x57ec9f[_0x5efb5d][_0x102dad(0x157)]==='application_fields'&&(_0x20594c[_0x102dad(0x16d)]=_0x40d0d9,_0x20594c[_0x102dad(0x18e)]=_0xf4a3b);});}await this[_0x51bbc6(0x96)][_0x51bbc6(0xb9)](Array[_0x51bbc6(0xee)](_0x1fd704[_0x51bbc6(0x21f)]())),common_1['Logger']['log'](_0x51bbc6(0x153));}catch(_0x42d266){common_1[_0x51bbc6(0x145)]['error'](_0x42d266,_0x51bbc6(0xa8));}}async[_0x5ee26c(0x13b)](_0x459efc){const _0x454c90=_0x5ee26c,_0x1f13ba=await this['mjpTaskService'][_0x454c90(0xe8)]({'data':{'ids':[_0x459efc]}});common_1[_0x454c90(0x145)][_0x454c90(0x128)](_0x454c90(0x97)),this[_0x454c90(0x1ec)](_0x1f13ba[0x0]);}async[_0x5ee26c(0x1a3)](_0x1bf3d6){const _0x41326f=_0x5ee26c,_0x1b5f3a=await this[_0x41326f(0x116)][_0x41326f(0x21e)](_0x1bf3d6[_0x41326f(0x114)]['id']),_0xbe0570={'fast':0x0,'relax':0x0,'trubo':0x0};let _0x23a3e7=redisKey_constant_1[_0x41326f(0xfd)]+'-'+_0x1b5f3a['id']+'-';if(_0x1b5f3a[_0x41326f(0x1be)]||_0x1b5f3a[_0x41326f(0x200)]){const [_0x324853,_0x5634e1,_0x35b59f]=await Promise[_0x41326f(0x165)]([this[_0x41326f(0xf8)]['get']({'key':_0x23a3e7+_0x41326f(0x174)}),this[_0x41326f(0xf8)][_0x41326f(0x23a)]({'key':_0x23a3e7+_0x41326f(0x20c)}),this[_0x41326f(0xf8)][_0x41326f(0x23a)]({'key':_0x23a3e7+_0x41326f(0x17b)})]);_0xbe0570['fast']=Number(_0x324853||0x0),_0xbe0570[_0x41326f(0x8b)]=Number(_0x5634e1||0x0),_0xbe0570[_0x41326f(0x232)]=Number(_0x35b59f||0x0);}return _0xbe0570;}['parseMjStatus'](_0x33deec){const _0x13b6c5=_0x5ee26c;if(typeof _0x33deec===_0x13b6c5(0x15a))return midjourney_constant_1['MjpStateMap']['get'](_0x33deec);if(typeof _0x33deec==='number')return midjourney_constant_1['MjpStateIndexMap']['get'](_0x33deec);}async[_0x5ee26c(0x1ec)](_0x1f7cfc){const _0x15549b=_0x5ee26c;common_1[_0x15549b(0x145)][_0x15549b(0x128)](_0x1f7cfc,'MJ\x20通知内容：');try{let _0x8b83a1=[];const _0x560db5=this[_0x15549b(0x94)](_0x1f7cfc[_0x15549b(0xa2)]),_0x1b45b1=_0x1f7cfc[_0x15549b(0xd5)]?parseFloat(_0x1f7cfc[_0x15549b(0xd5)]):null;let _0x818b47=await this[_0x15549b(0x1c9)][_0x15549b(0x150)]({'where':{'mjpTaskId':_0x1f7cfc['id']}});if(_0x1f7cfc[_0x15549b(0xa2)]===_0x15549b(0x126)&&_0x818b47['messageFlags']){common_1[_0x15549b(0x145)]['log'](_0x15549b(0x1d4),'Mj\x20Modal\x20通知');return;}_0x1f7cfc[_0x15549b(0xc1)]&&(_0x8b83a1=_0x1f7cfc['buttons'][_0x15549b(0x139)](_0x1202c5=>_0x1202c5['label']!==_0x15549b(0x152)&&_0x1202c5[_0x15549b(0x104)]!==_0x15549b(0xf6)&&_0x1202c5[_0x15549b(0xea)]!=='❤️'));store_1[_0x15549b(0x1ca)]['mjProxyImgUrl']&&_0x1f7cfc['imageUrl']&&(_0x1f7cfc[_0x15549b(0x147)]=_0x1f7cfc[_0x15549b(0x147)][_0x15549b(0x12b)](_0x15549b(0x1f4),store_1[_0x15549b(0x1ca)][_0x15549b(0x206)]));const _0x2d0468={'id':_0x818b47['id'],'status':_0x560db5,'progress':_0x1b45b1,'buttons':_0x8b83a1,'durationSpent':null,'imageUrl':_0x1f7cfc[_0x15549b(0x147)],'failReason':_0x1f7cfc[_0x15549b(0x183)]};return(_0x1f7cfc['action']===_0x15549b(0xf0)||_0x1f7cfc['action']===0x4)&&(_0x2d0468[_0x15549b(0xbb)]=_0x1f7cfc[_0x15549b(0x85)]||_0x1f7cfc[_0x15549b(0xb8)]?.[_0x15549b(0x85)],_0x2d0468[_0x15549b(0x20e)]=_0x1f7cfc[_0x15549b(0x85)]||_0x1f7cfc[_0x15549b(0xb8)]?.['finalPrompt']),_0x1f7cfc[_0x15549b(0x93)]&&_0x1f7cfc[_0x15549b(0xf2)]&&(_0x2d0468['durationSpent']=(_0x1f7cfc[_0x15549b(0x93)]-_0x1f7cfc[_0x15549b(0xf2)])/0x3e8),_0x818b47=await this['midjourneyEntity'][_0x15549b(0xb9)](_0x2d0468),_0x1f7cfc[_0x15549b(0xa2)]===_0x15549b(0xbd)&&_0x1f7cfc[_0x15549b(0x147)]&&this['fileService'][_0x15549b(0xca)](_0x818b47['id'],_0x818b47[_0x15549b(0x147)]),null;}catch(_0x7f216d){common_1['Logger'][_0x15549b(0x235)](_0x15549b(0x234),_0x7f216d);}}async[_0x5ee26c(0x129)](_0x1936d9){const _0x1ef30c=_0x5ee26c;common_1[_0x1ef30c(0x145)]['log'](_0x1936d9,_0x1ef30c(0xd2));try{const _0xa1079a=midjourney_constant_1[_0x1ef30c(0x222)][_0x1ef30c(0x23a)](_0x1936d9[_0x1ef30c(0x202)]),_0xdf6f99=Number(_0x1936d9['progress'])*0x64;let _0x1bb127=await this[_0x1ef30c(0x1c9)]['findOne']({'where':{'mjpTaskId':_0x1936d9[_0x1ef30c(0x21c)]}});const _0x4c4ed5={'id':_0x1bb127['id'],'status':_0xa1079a,'progress':_0xdf6f99,'imageUrl':_0x1936d9[_0x1ef30c(0x13d)]?.['map'](_0x19ec27=>_0x19ec27[_0x1ef30c(0x177)])['join']('↢↣')};return _0x1bb127=await this[_0x1ef30c(0x1c9)][_0x1ef30c(0xb9)](_0x4c4ed5),_0x1bb127[_0x1ef30c(0xa2)]===0x3&&_0x1bb127[_0x1ef30c(0x147)]&&this[_0x1ef30c(0x1b3)][_0x1ef30c(0xca)](_0x1bb127['id'],_0x1bb127[_0x1ef30c(0x147)]),null;}catch(_0xf622a9){common_1['Logger'][_0x1ef30c(0x235)](_0x1ef30c(0x207),_0xf622a9);}}async[_0x5ee26c(0x156)](_0x34924e){const _0x4d8419=_0x5ee26c;common_1['Logger'][_0x4d8419(0x128)](_0x34924e,_0x4d8419(0x178));try{const _0x1aedea=midjourney_constant_1[_0x4d8419(0x222)][_0x4d8419(0x23a)](_0x34924e['state']),_0x2fe25d=Number(_0x34924e[_0x4d8419(0xd5)])*0x64;let _0x1e5d51=await this[_0x4d8419(0x1c9)][_0x4d8419(0x150)]({'where':{'mjpTaskId':_0x34924e[_0x4d8419(0x21c)]}});const _0x1cc0ed={'id':_0x1e5d51['id'],'status':_0x1aedea,'progress':_0x2fe25d,'imageUrl':_0x34924e['images']?.[_0x4d8419(0x18b)](_0xcc2aff=>_0xcc2aff[_0x4d8419(0x147)])[_0x4d8419(0x12d)]('↢↣')};return _0x1e5d51=await this['midjourneyEntity'][_0x4d8419(0xb9)](_0x1cc0ed),_0x1e5d51[_0x4d8419(0xa2)]===0x3&&_0x1e5d51['imageUrl']&&this[_0x4d8419(0x1b3)][_0x4d8419(0xca)](_0x1e5d51['id'],_0x1e5d51[_0x4d8419(0x147)]),null;}catch(_0x50dc36){common_1[_0x4d8419(0x145)][_0x4d8419(0x235)]('触站工作流任务通知异常:\x20',_0x50dc36);}}async[_0x5ee26c(0x1a2)](){const _0x4655dd=_0x5ee26c;this[_0x4655dd(0x127)](),this[_0x4655dd(0x1af)](),this[_0x4655dd(0xd7)]();}async[_0x5ee26c(0x127)](){const _0x1abdf8=_0x5ee26c;try{const _0x293478=await this[_0x1abdf8(0x1c9)][_0x1abdf8(0x216)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6]),'botType':(0x0,typeorm_2['In'])([DrawTaskPage_dto_1[_0x1abdf8(0x7a)][_0x1abdf8(0xce)],DrawTaskPage_dto_1[_0x1abdf8(0x7a)]['NIJI_JOURNEY']])}});if(_0x293478['length'])for(let _0x448f36=0x0;_0x448f36<_0x293478['length'];_0x448f36++){const _0x4cbb19=redisKey_constant_1[_0x1abdf8(0xb7)]+_0x293478[_0x448f36][_0x1abdf8(0x1df)],_0x4dba58=await this[_0x1abdf8(0xf8)][_0x1abdf8(0x23a)]({'key':_0x4cbb19});if(_0x4dba58)continue;else this[_0x1abdf8(0xf8)][_0x1abdf8(0x19d)]({'key':_0x4cbb19,'val':_0x1abdf8(0x8d)}),this[_0x1abdf8(0x10b)]['listByCondition']({'data':{'ids':[_0x293478[_0x448f36][_0x1abdf8(0x1df)]]}})['then'](async _0xf22af2=>{const _0x1753ee=_0x1abdf8,_0x5857a2=_0xf22af2[0x0],_0x21151c=_0x293478[_0x448f36],_0x596d71=this[_0x1753ee(0x94)](_0x5857a2[_0x1753ee(0xa2)]),_0x4f55f9=_0x5857a2[_0x1753ee(0xd5)]?parseFloat(_0x5857a2[_0x1753ee(0xd5)]):null;if(_0x21151c['progress']===_0x4f55f9&&_0x21151c[_0x1753ee(0xa2)]===_0x596d71){}else{const _0x3703df=_0x5857a2[_0x1753ee(0xc1)][_0x1753ee(0x139)](_0x3d50ff=>_0x3d50ff[_0x1753ee(0x104)]!==_0x1753ee(0x152)&&_0x3d50ff[_0x1753ee(0x104)]!==_0x1753ee(0xf6)&&_0x3d50ff[_0x1753ee(0xea)]!=='❤️'),_0xa7c19f={'id':_0x21151c['id'],'mjpTaskId':_0x5857a2['id'],'status':_0x596d71,'progress':_0x4f55f9,'buttons':_0x3703df,'durationSpent':null,'imageUrl':_0x5857a2[_0x1753ee(0x147)],'failReason':_0x5857a2[_0x1753ee(0x183)]};store_1[_0x1753ee(0x1ca)]['mjProxyImgUrl']&&_0xa7c19f['imageUrl']&&(_0xa7c19f[_0x1753ee(0x147)]=_0xa7c19f['imageUrl'][_0x1753ee(0x12b)](_0x1753ee(0x1f4),store_1['MjConfig']['mjProxyImgUrl'])),(_0x5857a2[_0x1753ee(0x9f)]==='DESCRIBE'||_0x5857a2[_0x1753ee(0x9f)]===0x4)&&(_0xa7c19f[_0x1753ee(0xbb)]=_0x5857a2[_0x1753ee(0x85)]||_0x5857a2['properties']?.[_0x1753ee(0x85)],_0xa7c19f[_0x1753ee(0x20e)]=_0x5857a2['finalPrompt']||_0x5857a2[_0x1753ee(0xb8)]?.[_0x1753ee(0x85)]),_0x5857a2['finishTime']&&_0x5857a2['startTime']&&(_0xa7c19f[_0x1753ee(0x14b)]=(_0x5857a2[_0x1753ee(0x93)]-_0x5857a2[_0x1753ee(0xf2)])/0x3e8),await this[_0x1753ee(0x1c9)][_0x1753ee(0xb9)](_0xa7c19f);}})['catch'](_0x1c1294=>{const _0x53bd71=_0x1abdf8;common_1[_0x53bd71(0x145)]['error'](_0x53bd71(0x20d),_0x1c1294);})[_0x1abdf8(0x247)](()=>{const _0x65b7df=_0x1abdf8;this[_0x65b7df(0xf8)][_0x65b7df(0x1b0)]({'key':_0x4cbb19});});}}catch(_0xd937b0){}}async[_0x5ee26c(0x1af)](){const _0x3cc22a=_0x5ee26c;try{const _0x25b5e7=await this[_0x3cc22a(0x1c9)][_0x3cc22a(0x216)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'mjpTaskId':(0x0,typeorm_2[_0x3cc22a(0x1b9)])((0x0,typeorm_2['IsNull'])()),'botType':DrawTaskPage_dto_1[_0x3cc22a(0x7a)][_0x3cc22a(0xad)]}});if(_0x25b5e7[_0x3cc22a(0x124)])for(let _0x207aea=0x0;_0x207aea<_0x25b5e7[_0x3cc22a(0x124)];_0x207aea++){const _0x422af8=redisKey_constant_1[_0x3cc22a(0xb7)]+_0x25b5e7[_0x207aea][_0x3cc22a(0x1df)],_0x3aa3e5=await this['redisCacheService']['get']({'key':_0x422af8});if(_0x3aa3e5)continue;else{this[_0x3cc22a(0xf8)][_0x3cc22a(0x19d)]({'key':_0x422af8,'val':_0x3cc22a(0x8d)});try{const _0x52d47a=await this[_0x3cc22a(0x7c)][_0x3cc22a(0x1dc)]({'data':{'taskId':_0x25b5e7[_0x207aea][_0x3cc22a(0x1df)]}});this[_0x3cc22a(0x129)](_0x52d47a);}catch(_0x1ff08e){common_1[_0x3cc22a(0x145)][_0x3cc22a(0x235)](_0x3cc22a(0x1ed),_0x1ff08e);}finally{this[_0x3cc22a(0xf8)][_0x3cc22a(0x1b0)]({'key':_0x422af8});}}}}catch(_0x2529f3){}}async[_0x5ee26c(0xd7)](){const _0x409f03=_0x5ee26c;try{const _0x5f419c=await this[_0x409f03(0x1c9)][_0x409f03(0x216)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'botType':DrawTaskPage_dto_1[_0x409f03(0x7a)]['SD']}});if(_0x5f419c[_0x409f03(0x124)])for(let _0x5878c5=0x0;_0x5878c5<_0x5f419c[_0x409f03(0x124)];_0x5878c5++){const _0x51686b=redisKey_constant_1[_0x409f03(0xb7)]+_0x5f419c[_0x5878c5]['mjpTaskId'],_0xd57905=await this[_0x409f03(0xf8)][_0x409f03(0x23a)]({'key':_0x51686b});if(_0xd57905)continue;else{this['redisCacheService'][_0x409f03(0x19d)]({'key':_0x51686b,'val':'lock'});try{const _0x43e201=await this['czTaskService'][_0x409f03(0x144)]({'data':{'taskId':_0x5f419c[_0x5878c5]['mjpTaskId']}});this[_0x409f03(0x156)](_0x43e201);}catch(_0x1d1821){common_1[_0x409f03(0x145)][_0x409f03(0x235)]('sdTaskUpdateJob:\x20',_0x1d1821);}finally{this['redisCacheService'][_0x409f03(0x1b0)]({'key':_0x51686b});}}}}catch(_0x58688a){}}async['syncMjImg'](){const _0x4f32fd=_0x5ee26c;if(store_1['MjConfig'][_0x4f32fd(0xa5)])return;try{const _0x4f6048=[{'status':0x3,'imageUrl':(0x0,typeorm_2[_0x4f32fd(0x1cd)])(_0x4f32fd(0x22f))}];store_1[_0x4f32fd(0x1ca)][_0x4f32fd(0x206)]&&_0x4f6048[_0x4f32fd(0x117)]({'status':0x3,'imageUrl':(0x0,typeorm_2[_0x4f32fd(0x1cd)])(store_1['MjConfig'][_0x4f32fd(0x206)]+'%')});const _0x56db1a=await this[_0x4f32fd(0x1c9)][_0x4f32fd(0x216)]({'where':_0x4f6048});if(_0x56db1a[_0x4f32fd(0x124)])for(let _0x9e6853=0x0;_0x9e6853<_0x56db1a[_0x4f32fd(0x124)];_0x9e6853++){let {id:_0x416f68,imageUrl:_0x2bd3cd}=_0x56db1a[_0x9e6853];this[_0x4f32fd(0x1b3)]['transferImg'](_0x416f68,_0x2bd3cd);}}catch(_0x51e4e6){common_1[_0x4f32fd(0x145)][_0x4f32fd(0x235)](_0x51e4e6);}}};MidjourneyService=__decorate([(0x0,common_1[_0x5ee26c(0x21b)])(),__param(0x0,(0x0,typeorm_1[_0x5ee26c(0x182)])(mjModel_entity_1[_0x5ee26c(0x229)])),__param(0x1,(0x0,typeorm_1[_0x5ee26c(0x182)])(mjParam_entity_1[_0x5ee26c(0x21a)])),__param(0x2,(0x0,typeorm_1[_0x5ee26c(0x182)])(mjPrompts_entity_1[_0x5ee26c(0xc4)])),__param(0x3,(0x0,typeorm_1[_0x5ee26c(0x182)])(midjourney_entity_1[_0x5ee26c(0x73)])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(mjSuggestWord_entity_1['MjSuggestWordEntity'])),__param(0x5,(0x0,typeorm_1['InjectRepository'])(mjIncantation_entity_1[_0x5ee26c(0x239)])),__param(0x6,(0x0,typeorm_1[_0x5ee26c(0x182)])(mjInspireClassify_entity_1[_0x5ee26c(0x19c)])),__param(0x7,(0x0,typeorm_1[_0x5ee26c(0x182)])(mjIncantationClassify_entity_1[_0x5ee26c(0x1e7)])),__metadata(_0x5ee26c(0x198),[typeorm_2[_0x5ee26c(0x14f)],typeorm_2['Repository'],typeorm_2[_0x5ee26c(0x14f)],typeorm_2[_0x5ee26c(0x14f)],typeorm_2[_0x5ee26c(0x14f)],typeorm_2[_0x5ee26c(0x14f)],typeorm_2[_0x5ee26c(0x14f)],typeorm_2[_0x5ee26c(0x14f)],nestjs_cls_1['ClsService'],dict_service_1['DictService'],user_service_1[_0x5ee26c(0x23f)],file_service_1[_0x5ee26c(0x16b)],fanyi_service_1[_0x5ee26c(0x189)],aiLog_service_1[_0x5ee26c(0x130)],models_service_1['ModelsService'],czTask_service_1[_0x5ee26c(0x15c)],mjpTask_service_1[_0x5ee26c(0x1fe)],badwords_service_1[_0x5ee26c(0x24a)],redisCache_service_1['RedisCacheService'],mjpAccount_service_1[_0x5ee26c(0x76)],globalConfig_service_1['GlobalConfigService'],typeorm_2[_0x5ee26c(0xc9)]])],MidjourneyService),exports[_0x5ee26c(0x1ab)]=MidjourneyService;