'use strict';const _0x1fa71c=_0x5735;(function(_0x4b8cf8,_0x44186b){const _0x54ca7a=_0x5735,_0x3536f3=_0x4b8cf8();while(!![]){try{const _0x5a6b8a=-parseInt(_0x54ca7a(0x278))/0x1+-parseInt(_0x54ca7a(0x159))/0x2*(-parseInt(_0x54ca7a(0x144))/0x3)+-parseInt(_0x54ca7a(0x287))/0x4+parseInt(_0x54ca7a(0x240))/0x5+parseInt(_0x54ca7a(0x17b))/0x6+-parseInt(_0x54ca7a(0x18b))/0x7+parseInt(_0x54ca7a(0x188))/0x8;if(_0x5a6b8a===_0x44186b)break;else _0x3536f3['push'](_0x3536f3['shift']());}catch(_0x38f40e){_0x3536f3['push'](_0x3536f3['shift']());}}}(_0x49ee,0xe7410));function _0x5735(_0x2ccdef,_0xc8021d){const _0x49ee25=_0x49ee();return _0x5735=function(_0x57356b,_0x89481c){_0x57356b=_0x57356b-0xf7;let _0xe326a9=_0x49ee25[_0x57356b];return _0xe326a9;},_0x5735(_0x2ccdef,_0xc8021d);}var __decorate=this&&this['__decorate']||function(_0x3519d8,_0x591188,_0x17d745,_0x23f2aa){const _0xb10e51=_0x5735;var _0x6c5649=arguments['length'],_0x32b9b9=_0x6c5649<0x3?_0x591188:_0x23f2aa===null?_0x23f2aa=Object[_0xb10e51(0x1b5)](_0x591188,_0x17d745):_0x23f2aa,_0x4fd3e9;if(typeof Reflect===_0xb10e51(0x104)&&typeof Reflect[_0xb10e51(0x14f)]===_0xb10e51(0x229))_0x32b9b9=Reflect['decorate'](_0x3519d8,_0x591188,_0x17d745,_0x23f2aa);else{for(var _0x745f16=_0x3519d8[_0xb10e51(0x171)]-0x1;_0x745f16>=0x0;_0x745f16--)if(_0x4fd3e9=_0x3519d8[_0x745f16])_0x32b9b9=(_0x6c5649<0x3?_0x4fd3e9(_0x32b9b9):_0x6c5649>0x3?_0x4fd3e9(_0x591188,_0x17d745,_0x32b9b9):_0x4fd3e9(_0x591188,_0x17d745))||_0x32b9b9;}return _0x6c5649>0x3&&_0x32b9b9&&Object['defineProperty'](_0x591188,_0x17d745,_0x32b9b9),_0x32b9b9;},__metadata=this&&this['__metadata']||function(_0x33caeb,_0xc2ab68){const _0x11277a=_0x5735;if(typeof Reflect===_0x11277a(0x104)&&typeof Reflect['metadata']==='function')return Reflect[_0x11277a(0x20e)](_0x33caeb,_0xc2ab68);},__param=this&&this[_0x1fa71c(0x2d1)]||function(_0x97856b,_0x2334c4){return function(_0x27b51b,_0x247012){_0x2334c4(_0x27b51b,_0x247012,_0x97856b);};};Object[_0x1fa71c(0x247)](exports,_0x1fa71c(0x1e6),{'value':!![]}),exports[_0x1fa71c(0x1db)]=void 0x0;const common_1=require('@nestjs/common'),typeorm_1=require(_0x1fa71c(0x28d)),midjourney_entity_1=require('./midjourney.entity'),typeorm_2=require('typeorm'),globalConfig_service_1=require('../globalConfig/globalConfig.service'),midjourney_constant_1=require('../../common/constants/midjourney.constant'),file_service_1=require(_0x1fa71c(0x174)),badwords_service_1=require(_0x1fa71c(0x139)),utils_1=require(_0x1fa71c(0x1e3)),mjPrompts_entity_1=require(_0x1fa71c(0x18c)),mjParam_entity_1=require(_0x1fa71c(0x16d)),mjIncantationClassify_entity_1=require(_0x1fa71c(0x1a9)),mjInspireClassify_entity_1=require(_0x1fa71c(0xfd)),mjIncantation_entity_1=require(_0x1fa71c(0x1ee)),fanyi_service_1=require(_0x1fa71c(0x238)),mjSuggestWord_entity_1=require('./mjSuggestWord.entity'),user_service_1=require(_0x1fa71c(0x204)),redisCache_service_1=require(_0x1fa71c(0x2a5)),mjpAccount_service_1=require(_0x1fa71c(0x224)),mjpTask_service_1=require(_0x1fa71c(0x1ca)),addDrawQueue_dto_1=require(_0x1fa71c(0x1d7)),store_1=require(_0x1fa71c(0x213)),redisKey_constant_1=require(_0x1fa71c(0x25c)),aiLog_service_1=require(_0x1fa71c(0x29f)),model_constant_1=require(_0x1fa71c(0x1ab)),nestjs_cls_1=require(_0x1fa71c(0x1bf)),czTask_service_1=require(_0x1fa71c(0x160)),models_service_1=require(_0x1fa71c(0x1fb)),DrawTaskPage_dto_1=require(_0x1fa71c(0x103)),user_constant_1=require(_0x1fa71c(0x196)),dict_service_1=require('../dict/dict.service'),mjModel_entity_1=require(_0x1fa71c(0x1ef));function _0x49ee(){const _0xbe7691=['SD任务通知内容：','swap','删除成功！','modelSave','mjParamEntity','getByRelateId','MjIncantationEntity','notify','syncMjImg','syncMjpAccountManual','prompt','MjpAccountService','phone','value','count','\x20OFFSET\x20','channelId','initHasAccount','instanceId','handleImagesUploadTask','remark','relax_vip_free','filter','../badwords/badwords.service','getModelById','ids','MJ\x20通知内容：','getUserListByIds','findOne','艺术设计','values','workflowSave','cover','InjectRepository','5377737Focmls','enable','paintingSign','drawTaskList','modalTask','use','https://cdn.discordapp.com','getMjAccount','VIP_FREE','customId','MjPromptsEntity','decorate','affected','clsService','username','getAgreeByRelateId','denoisingStrength','query','modifyMjIncantationClassify','development','queryAllPrompt','2IxITPU','modelsService','workflowRun','mjModel','UserService','queryMjIncantationByClassify','transaction','../api/czTask.service','TEXT_TO_IMAGE','toString','removeMjIncantation','versionSelector','触站工作流任务通知异常:\x20','checkIsActionDone','updateReconnect','buffer','type','deleteDraw','非法操作！','Modal已处理，无需更新','./mjParam.entity','MjpStateIndexMap','durationSpent','FanyiService','length','mjIncantationClassifyEntity','buttons','../file/file.service','Modal\x20状态\x20手动同步任务信息','czTaskService','orderPlan','map','绘制的任务不存在！','getUserId','313230BQIFju','EModelType','checkBadWords','workflowTaskDetail','syncModelsByTag','convertMode4Transfer','startTime','level','account','IsNull','rows','syncSdTask','querySuggestWords','12332336DNXlCb','无绘图记录','findAndCount','10371403paGplb','./mjPrompts.entity','sdTaskInpaint','isDefined','ENV','finishTime','setting','info','fast','推荐关键词已存在，不可重复添加','aiDraw','../../common/constants/user.constant','queryMjIncantationAll','favoriteListByTypeAndIds','timeout','get4workflow','imagine','getOneDraw','avatar','applicationFieldsName','查询咒语失败','mjPromptsEntity','concurrentLimit','workflowModelUpdate','pageCount','convertToEnglish','effect_category','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','redisCacheService','set','./mjIncantationClassify.entity','PRO','../../common/constants/model.constant','string','MJ_TASK_UPDATE','删除记录失败！','add','getReqSaasId','imageUrl','MODAL','error','find','getOwnPropertyDescriptor','fastRemainTime','addMjInspireClassify','relaxedUsage','totalTime','syncMjpAccount','MidjourneyStatusEnum','MjpStateMap','查询咒语分类失败','查询推荐关键词失败','nestjs-cls','insightFace','userId','addMjIncantation','lifetimeVip','DESCRIBE','mjModelEntity','NIJI_JOURNEY','modifyMjAccount','removeMjIncantationClassify','disabled','../api/mjpTask.service','turbo','queryMjIncantationClassifyAllByLevel','MjModelEntity','prompt包含敏感词','catch','removeMjInspireClassify','keyword','freeUsed','env','AiLogService','hideString','\x20--sw\x20','./dto/addDrawQueue.dto','update','originPrompt','syncWfTask','MidjourneyService','pid','摄影拍照','头像制作','Custom\x20Zoom','actionTask','\x20--iw\x20','STANDARD','../../common/utils','parseMjStatus','queryTopMjIncantationClassify','__esModule','Imagine','fileInfo','当前图片已经执行过相同指令！','datas','effect_main_body','https://cdn.discordapp.com%','创建图混图任务失败','./mjIncantation.entity','./mjModel.entity','model','https://img2.huashi6.com/','extraParam','wfTaskUpdateJob:\x20','effectCategory','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.used\x20AS\x20used\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','failReason','connection','getMjIncantationClassify','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','RedisCacheService','../models/models.service','setPrompt','findBy','workflowUsedPage','versionId','dictService','CZTaskService','relateId','FileService','../user/user.service','IMAGE_ACTION','BAD_REQUEST','save4workflow','promptsPage','rec','getMjInspireClassify','addDrawQueue','key','notifyWF','metadata','初始化灵感广场分类失败','queryMjIncantation','midjourneyEntity','state','../../common/store','mjpAccountService','changeVersion','exist','自动同步账号信息失败：','syncMjTask','timeoutMinutes','modal','isPlatform','distributeAccount','Mj\x20Modal\x20通知','\x20--cref\x20','has','商拍摄影','MjParamEntity','EBotType','mjpTaskService','../api/mjpAccount.service','Logger','addRefer','FaceSwap','FAST','function','coverImageUrl','split','initInspireData','deductBalance4WorkFlow','触站::模型信息同步失败','createdAt','useCount','turbo_vip_free','description','replace','MidjourneyEntity','modelName','vipFreeNum','isSuper','../fanyi/fanyi.service','HttpStatus','任务已达最大并发数，请等待其他任务完成后再提交新任务！','IMAGE_TO_TEXT','base64','workflowId','create','size','6864425UogtAt','modelType','mjLimitCount','fullPrompt','syncInfo','初始化灵感广场分类成功','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20','defineProperty','mjInspireClassifyEntity','addMjAccount','renewDate','fastTimeRemaining','deduct','effectCategoryName','mjpId','Injectable','files','emoji','finally','syncTask','userService','保存推荐关键词','addMjIncantationClassify','properties','syncWorkFlowDict','workflowDel','subscribePlan','onModuleInit','../../common/constants/redisKey.constant','favoritePage','绘制中的图片任务、禁止删除！','finalPrompt','触站::运用领域、风格画风、作用主体、作用类别字典同步失败','分页参数错误','messageFlags','authorization','fanyiService','relax','now','MjIncantationClassifyEntity','mjSuggestWordEntity','globalConfigService','label','mjpTaskId','DESC','del','validateBalance4MJ','queryMjIncantationClassify','ClsService','name','ASC','mjProxyImgUrl','visitNum','userInfo','cancel','MEGA','1180744FTBTon','action','squire-images','workflowDetail','message','design:paramtypes','dictName','isManage','图混图任务至少需要两张图片','mjTimeoutMs','fileService','syncTaskInfo','小工具已禁用！','get','触站工作流任务通知内容：','4598488fFljxE','describe','workflowModelDetail','result','vipFreeUsed','推荐关键词不存在','@nestjs/typeorm','removeSuggestWords','\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.createdAt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','fast_vip_free','incantationCn','delPrompt','添加绘图任务失败','imageSeed','当前图片不存在！','DictService','fetch','GlobalConfigService','data:image/png;base64,','\x20--cw\x20','Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','mode','动漫漫画','aiLogService','../aiLog/aiLog.service','findOneBy','checkUserStatus','displaySort','botType','Mj任务通知异常:\x20','../redisCache/redisCache.service','error:\x20','isChinese','mjVersion','saasId','list4dictTypes','user','queryMjAccountList','nickname','Describe','createRandomUid','delete','MID_JOURNEY','syncMjpAccountAutomatic','队列已满，请稍后尝试','DrawSpeed','taskId','code','transferImg','EFavorite','MjpTaskService','queryMjInspireClassify','guildId','inputs','jobIds','不需要灵感广场分类','dictValue','Like','copyAccountInfo','MjConfig','tutorial','WORKFLOW','workflowPage','refundBalance4MJ','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','page','操作失败！','mjIncantationEntity','TURBO','increaseVisit','application_fields','forEach','remix','push','__param','lifetimeUsage','RELAX','任务类型错误','save','then','Imagine\x20all','deductBalance4MJ','ModelsService','\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20','BASIC','email','MjInspireClassifyEntity','删除失败！','queryModels','CzStateMap','effectMainBodyName','mjProxy','deductBalance4SD','workflowFavorite','syncModels','saveSuggestWords','stringify','aiTaskDetail','style','./mjInspireClassify.entity','assign','HttpException','DRAW','DRAWING','DRAWED','./dto/DrawTaskPage.dto','object','getUserById','notifySD','applicationFields','账号不存在','MidJourneyDrawEnum','url','concat','weight','workflowModelPage','dictType','status','badwordsService','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27','join','触站::运用领域、风格画风、作用主体、作用类别字典同步完成','aiInpaint','log','setImageFavorite','classifyName','handleAddDrawTask','list4workflow','Repository','lock','getModelByIds','drawSquarePage','sdTaskUpdateJob:\x20','progress','vipExpire','id不能为空！'];_0x49ee=function(){return _0xbe7691;};return _0x49ee();}let MidjourneyService=class MidjourneyService{constructor(_0x490b2c,_0x3a2cd5,_0x5e24a2,_0x1c2b67,_0x44ab70,_0x36f649,_0xe76424,_0x3e3b02,_0x281b44,_0x309b88,_0x3cc3aa,_0xeb2de8,_0x28f70c,_0x5b574b,_0x1c4545,_0x5159b0,_0x2acd07,_0x49b4c1,_0x53734b,_0x48d85f,_0x18851c,_0x5de727){const _0x544ab7=_0x1fa71c;this[_0x544ab7(0x1c5)]=_0x490b2c,this[_0x544ab7(0x126)]=_0x3a2cd5,this[_0x544ab7(0x1a0)]=_0x5e24a2,this['midjourneyEntity']=_0x1c2b67,this[_0x544ab7(0x268)]=_0x44ab70,this[_0x544ab7(0x2ca)]=_0x36f649,this['mjInspireClassifyEntity']=_0xe76424,this[_0x544ab7(0x172)]=_0x3e3b02,this[_0x544ab7(0x151)]=_0x281b44,this['dictService']=_0x309b88,this[_0x544ab7(0x254)]=_0x3cc3aa,this[_0x544ab7(0x282)]=_0xeb2de8,this[_0x544ab7(0x264)]=_0x28f70c,this['aiLogService']=_0x5b574b,this[_0x544ab7(0x15a)]=_0x1c4545,this['czTaskService']=_0x5159b0,this[_0x544ab7(0x223)]=_0x2acd07,this[_0x544ab7(0x110)]=_0x49b4c1,this[_0x544ab7(0x1a7)]=_0x53734b,this[_0x544ab7(0x214)]=_0x48d85f,this['globalConfigService']=_0x18851c,this[_0x544ab7(0x1f7)]=_0x5de727;}async[_0x1fa71c(0x25b)](){const _0x2ae6dc=_0x1fa71c;await this['initInspireData'](),await this[_0x2ae6dc(0x133)]();}async[_0x1fa71c(0x133)](){const _0x43cf13=_0x1fa71c,_0x5d89f0=await this[_0x43cf13(0x126)][_0x43cf13(0x130)]({'where':{'enable':0x1},'order':{'weight':_0x43cf13(0x26c)}});_0x5d89f0===0x0&&common_1['Logger']['error']('要使用MJ绘画功能，至少需要配置一个MJ账号,并且启用该账号');}async[_0x1fa71c(0x22c)](){const _0x20a219=_0x1fa71c,_0x515b55=await this[_0x20a219(0x248)]['count']();if(_0x515b55===0x0){const _0x4cf9af=[{'name':'绘画制作','value':0x1},{'name':_0x20a219(0x1dd),'value':0x2},{'name':_0x20a219(0x1de),'value':0x3},{'name':'美女形象','value':0x4},{'name':_0x20a219(0x29d),'value':0x5},{'name':'壁纸绘画','value':0x6},{'name':_0x20a219(0x13f),'value':0x7},{'name':_0x20a219(0x220),'value':0x8},{'name':'形象设计','value':0x9},{'name':'精选分享','value':0xa}][_0x20a219(0x178)](_0x191c32=>{const _0x48c272=_0x20a219;return{'name':_0x191c32[_0x48c272(0x271)],'value':_0x191c32[_0x48c272(0x12f)]+'','inner':0x1};});await this[_0x20a219(0x248)][_0x20a219(0x2d5)](_0x4cf9af)[_0x20a219(0x1cf)](()=>{const _0xfc6c43=_0x20a219;common_1[_0xfc6c43(0x225)][_0xfc6c43(0x1b3)](_0xfc6c43(0x20f));}),common_1['Logger'][_0x20a219(0x115)](_0x20a219(0x245));}common_1[_0x20a219(0x225)][_0x20a219(0x115)](_0x20a219(0x2be));}async[_0x1fa71c(0x249)](_0x543a9e){const _0x52c503=_0x1fa71c;try{const {guildId:_0x2394f9,account:_0x43b027,authorization:_0x310a03,mode:_0xd801c0,timeout:_0x5c846e,channelId:_0x581452,remark:_0x59dfc1,mjBotChannelId:_0xfdcd2d,nijiBotChannelId:_0xe349be}=_0x543a9e;var _0x19dee3=await this[_0x52c503(0x214)][_0x52c503(0x23e)]({'data':{'channelId':_0x581452,'coreSize':0x3,'guildId':_0x2394f9,'mjBotChannelId':_0xfdcd2d||'','nijiBotChannelId':_0xe349be||'','queueSize':0xa,'remark':_0x59dfc1,'remixAutoSubmit':![],'timeoutMinutes':_0x5c846e,'userAgent':_0x52c503(0x29b),'userToken':_0x310a03}});if(_0x19dee3[_0x52c503(0x2b6)]!==0x1)throw new Error(_0x19dee3[_0x52c503(0x232)]);const _0x158a22=await this['mjParamEntity'][_0x52c503(0x2d5)]({'account':_0x43b027,'authorization':_0x310a03,'mode':_0xd801c0,'timeout':_0x5c846e,'channelId':_0x581452,'guildId':_0x2394f9,'remark':_0x59dfc1,'mjpId':_0x19dee3[_0x52c503(0x28a)],'mjBotChannelId':_0xfdcd2d||'','nijiBotChannelId':_0xe349be||''});return await this['syncMjpAccount'](_0x19dee3[_0x52c503(0x28a)]),!!_0x158a22;}catch(_0x1a0be3){common_1[_0x52c503(0x225)][_0x52c503(0x1b3)](_0x1a0be3);throw new common_1[(_0x52c503(0xff))](_0x1a0be3[_0x52c503(0x27c)],common_1[_0x52c503(0x239)]['BAD_REQUEST']);}}async[_0x1fa71c(0x1c7)](_0xe59ab8){const _0x2870f7=_0x1fa71c,{id:_0x436127,account:_0xc96eef,authorization:_0x1bfe12,mode:_0x3cbd85,guildId:_0xbc7506,remark:_0x20f175,channelId:_0x2df15d,timeout:_0x2fbc43,enable:_0x17dac6,mjBotChannelId:_0xd53c51,nijiBotChannelId:_0x27ade3}=_0xe59ab8;try{const _0x23556d=await this[_0x2870f7(0x126)]['findOneBy']({'id':Number(_0x436127)});var _0xe09df5=await this['mjpAccountService'][_0x2870f7(0x167)]({'data':{'channelId':_0x2df15d,'coreSize':0x3,'guildId':_0xbc7506,'mjBotChannelId':_0xd53c51||'','nijiBotChannelId':_0x27ade3||'','queueSize':0xa,'remark':_0x20f175,'remixAutoSubmit':![],'timeoutMinutes':_0x2fbc43,'userAgent':_0x2870f7(0x29b),'userToken':_0x1bfe12,'enable':Boolean(_0x17dac6)}},_0x23556d[_0x2870f7(0x24e)]);if(_0xe09df5[_0x2870f7(0x2b6)]!==0x1)throw new Error(_0xe09df5[_0x2870f7(0x232)]);return await this[_0x2870f7(0x126)][_0x2870f7(0x1d8)](_0x436127,{'account':_0xc96eef,'authorization':_0x1bfe12,'mode':_0x3cbd85,'guildId':_0xbc7506,'remark':_0x20f175,'channelId':_0x2df15d,'timeout':_0x2fbc43,'mjBotChannelId':_0xd53c51||'','nijiBotChannelId':_0x27ade3||''});}catch(_0x3a2998){common_1[_0x2870f7(0x225)][_0x2870f7(0x1b3)](_0x3a2998);throw new common_1['HttpException'](_0x3a2998[_0x2870f7(0x27c)],common_1[_0x2870f7(0x239)][_0x2870f7(0x206)]);}}async['copyAccountInfo'](_0x2bfe04,_0x5191ee){const _0x43513f=_0x1fa71c;_0x2bfe04[_0x43513f(0x2a8)]=_0x5191ee['version'];if(_0x5191ee['mode']===_0x43513f(0x228))_0x2bfe04[_0x43513f(0x29c)]=midjourney_constant_1['DrawSpeed'][_0x43513f(0x193)];else{if(_0x5191ee[_0x43513f(0x29c)]===_0x43513f(0x2d3))_0x2bfe04['mode']=midjourney_constant_1[_0x43513f(0x2b4)][_0x43513f(0x265)];else _0x5191ee[_0x43513f(0x29c)]===_0x43513f(0x2cb)&&(_0x2bfe04[_0x43513f(0x29c)]=midjourney_constant_1[_0x43513f(0x2b4)]['turbo']);}_0x2bfe04[_0x43513f(0x1b6)]=_0x5191ee[_0x43513f(0x24b)],_0x2bfe04[_0x43513f(0x1b9)]=_0x5191ee[_0x43513f(0x24b)],_0x2bfe04['lifetimeUsage']=_0x5191ee[_0x43513f(0x2d2)],_0x2bfe04[_0x43513f(0x1b8)]=_0x5191ee[_0x43513f(0x1b8)],_0x2bfe04['remix']=Number(_0x5191ee[_0x43513f(0x2cf)]);if(_0x5191ee[_0x43513f(0x25a)]===_0x43513f(0x2db))_0x2bfe04[_0x43513f(0x177)]=0x1;else{if(_0x5191ee['subscribePlan']===_0x43513f(0x1e2))_0x2bfe04[_0x43513f(0x177)]=0x2;else{if(_0x5191ee[_0x43513f(0x25a)]===_0x43513f(0x1aa))_0x2bfe04[_0x43513f(0x177)]=0x3;else _0x5191ee[_0x43513f(0x25a)]===_0x43513f(0x277)&&(_0x2bfe04[_0x43513f(0x177)]=0x4);}}_0x2bfe04['renewDate']=_0x5191ee[_0x43513f(0x24a)],_0x2bfe04[_0x43513f(0x199)]=_0x5191ee[_0x43513f(0x219)],_0x2bfe04[_0x43513f(0x191)]=JSON['stringify'](_0x5191ee[_0x43513f(0x173)]),_0x2bfe04[_0x43513f(0x192)]=JSON[_0x43513f(0xfa)](_0x5191ee[_0x43513f(0x164)]),await this[_0x43513f(0x126)]['save'](_0x2bfe04);}async[_0x1fa71c(0x1ba)](_0x27276a){const _0x12449e=_0x1fa71c;try{if(store_1[_0x12449e(0x2c2)]['mjModel']!==_0x12449e(0x2e2))return;const _0x3541ca=await this[_0x12449e(0x214)][_0x12449e(0x297)]({},_0x27276a);if(!_0x3541ca)return;const _0xadd8df=await this[_0x12449e(0x126)][_0x12449e(0x13e)]({'where':{'mjpId':_0x27276a}});await this['copyAccountInfo'](_0xadd8df,_0x3541ca);}catch(_0x581245){common_1['Logger'][_0x12449e(0x1b3)](_0x12449e(0x217),_0x581245);}}async[_0x1fa71c(0x2b2)](){const _0xcd6780=_0x1fa71c,_0x8105c5=await this[_0xcd6780(0x126)]['find']();if(!_0x8105c5['length'])return;for(let _0x53ef86=0x0;_0x53ef86<_0x8105c5[_0xcd6780(0x171)];_0x53ef86++){this['syncMjpAccount'](_0x8105c5[_0x53ef86]['mjpId']);}}async[_0x1fa71c(0x12b)]({id:_0x4dc792}){const _0x23a99a=_0x1fa71c;try{const _0x45eb6c=await this[_0x23a99a(0x126)][_0x23a99a(0x2a0)]({'id':Number(_0x4dc792)}),_0x54fe65=await this['mjpAccountService'][_0x23a99a(0x244)]({},_0x45eb6c[_0x23a99a(0x24e)]);if(_0x54fe65['code']!==0x1)throw new Error(_0x54fe65[_0x23a99a(0x232)]);await this[_0x23a99a(0x2c1)](_0x45eb6c,_0x54fe65[_0x23a99a(0x28a)]);}catch(_0x2ad185){throw new common_1['HttpException'](_0x2ad185[_0x23a99a(0x27c)],common_1[_0x23a99a(0x239)][_0x23a99a(0x206)]);}}async['changeVersion'](_0x414aa7){const _0x558598=_0x1fa71c;try{const _0x3c66e2=await this['mjParamEntity'][_0x558598(0x2a0)]({'id':Number(_0x414aa7['id'])}),_0x1405c7=await this[_0x558598(0x214)][_0x558598(0x215)]({'data':_0x414aa7},_0x3c66e2[_0x558598(0x24e)]);if(_0x1405c7[_0x558598(0x2b6)]!==0x1)throw new Error(_0x1405c7['description']);return _0x3c66e2[_0x558598(0x2a8)]=_0x414aa7['version'],await this[_0x558598(0x126)][_0x558598(0x2d5)](_0x3c66e2),!![];}catch(_0x3d07a0){throw new common_1['HttpException'](_0x3d07a0[_0x558598(0x27c)],common_1['HttpStatus']['BAD_REQUEST']);}}async['action'](_0x1c7ae0){const _0x33e810=_0x1fa71c;try{const _0x5b9892=await this[_0x33e810(0x126)][_0x33e810(0x2a0)]({'id':Number(_0x1c7ae0['id'])}),_0x54d49f=await this[_0x33e810(0x214)][_0x33e810(0x279)]({'data':_0x1c7ae0},_0x5b9892[_0x33e810(0x24e)]);if(_0x54d49f[_0x33e810(0x2b6)]!==0x1)throw new Error(_0x54d49f['description']);return!![];}catch(_0x207d90){throw new common_1['HttpException'](_0x207d90['message'],common_1[_0x33e810(0x239)][_0x33e810(0x206)]);}}async['removeMjAccount'](_0x14db69){const _0x2f9928=_0x1fa71c,{id:_0x1556f2}=_0x14db69;try{const _0x59e880=await this[_0x2f9928(0x126)][_0x2f9928(0x13e)]({'where':{'id':Number(_0x1556f2)}});if(!_0x59e880)throw new Error(_0x2f9928(0x108));common_1[_0x2f9928(0x225)][_0x2f9928(0x1b3)]('mjpId:\x20',_0x59e880['mjpId']);const _0x344126=await this[_0x2f9928(0x214)][_0x2f9928(0x2b0)]({},_0x59e880[_0x2f9928(0x24e)]);if(_0x344126[_0x2f9928(0x2b6)]!==0x1)throw new Error(_0x344126['description']);const _0x5e12aa=await this['mjParamEntity']['delete']({'id':_0x1556f2});return _0x5e12aa[_0x2f9928(0x150)];}catch(_0x52fb8d){throw new common_1[(_0x2f9928(0xff))](_0x52fb8d[_0x2f9928(0x27c)],common_1['HttpStatus'][_0x2f9928(0x206)]);}}async['setMjAccountEnable'](_0x2bae64){const _0x5b3c82=_0x1fa71c,{id:_0x61a879,enable:_0x484786}=_0x2bae64;return await this['mjParamEntity'][_0x5b3c82(0x1d8)](_0x61a879,{'enable':_0x484786})[_0x5b3c82(0x2d6)](_0x34a9e7=>_0x34a9e7[_0x5b3c82(0x150)]>0x0);}async[_0x1fa71c(0x14b)](_0x700c8f,_0x47624d){const _0x537ab7=_0x1fa71c,_0x3d5c75=(0x0,utils_1[_0x537ab7(0x237)])(this['clsService']),{id:_0x58eff9}=_0x700c8f;let _0x287016=null;try{const _0x5ba375=await this['mjParamEntity'][_0x537ab7(0x13e)]({'where':{'id':_0x58eff9}});return _0x3d5c75&&(_0x287016=await this[_0x537ab7(0x214)][_0x537ab7(0x297)]({},_0x5ba375['mjpId'])),{..._0x5ba375,'mjpAccountInfo':_0x287016,'authorization':_0x3d5c75?_0x5ba375[_0x537ab7(0x263)]:(0x0,utils_1[_0x537ab7(0x1d5)])(_0x5ba375[_0x537ab7(0x263)]),'guildId':_0x3d5c75?_0x5ba375[_0x537ab7(0x2bb)]:(0x0,utils_1[_0x537ab7(0x1d5)])(_0x5ba375[_0x537ab7(0x2bb)]),'channelId':_0x3d5c75?_0x5ba375[_0x537ab7(0x132)]:(0x0,utils_1[_0x537ab7(0x1d5)])(_0x5ba375[_0x537ab7(0x132)])};}catch(_0x4b627a){throw new common_1[(_0x537ab7(0xff))](_0x4b627a,common_1[_0x537ab7(0x239)][_0x537ab7(0x206)]);}}async[_0x1fa71c(0x2ac)](_0x5c6567,_0x32f27f){const _0x381a88=_0x1fa71c,{page:page=0x1,size:size=0x14,account:_0x3b1c77,channelId:_0x2f21f6,enable:_0x1a886}=_0x5c6567;if(!page||!size)throw new common_1['HttpException'](_0x381a88(0x261),common_1[_0x381a88(0x239)][_0x381a88(0x206)]);const _0x36f415={};_0x3b1c77&&Object[_0x381a88(0xfe)](_0x36f415,{'account':(0x0,typeorm_2[_0x381a88(0x2c0)])('%'+_0x3b1c77+'%')}),_0x2f21f6&&Object[_0x381a88(0xfe)](_0x36f415,{'channelId':(0x0,typeorm_2[_0x381a88(0x2c0)])('%'+_0x2f21f6+'%')}),_0x1a886>0x0&&Object[_0x381a88(0xfe)](_0x36f415,{'enable':_0x1a886});const [_0x172a68,_0x46c9c5]=await this[_0x381a88(0x126)][_0x381a88(0x18a)]({'skip':(page-0x1)*size,'where':_0x36f415,'take':size,'order':{'createdAt':_0x381a88(0x26c)},'cache':!![],'select':['id',_0x381a88(0x2bb),'channelId','authorization',_0x381a88(0x183),_0x381a88(0x10c),_0x381a88(0x145),_0x381a88(0x1b6),_0x381a88(0x177),_0x381a88(0x24a),_0x381a88(0x22f),_0x381a88(0x29c)]});return(0x0,utils_1['isSuper'])(this['clsService'])?{'rows':_0x172a68||[],'count':_0x46c9c5||0x0}:{'rows':_0x172a68[_0x381a88(0x178)](_0x31faf1=>({..._0x31faf1,'authorization':(0x0,utils_1[_0x381a88(0x1d5)])(_0x31faf1[_0x381a88(0x263)]),'guildId':(0x0,utils_1[_0x381a88(0x1d5)])(_0x31faf1[_0x381a88(0x2bb)]),'channelId':(0x0,utils_1[_0x381a88(0x1d5)])(_0x31faf1[_0x381a88(0x132)])}))||[],'count':_0x46c9c5||0x0};}async[_0x1fa71c(0x147)](_0x4ad58c,_0x93bcbe){const _0x23cd75=_0x1fa71c;try{const _0x4eb189=(0x0,utils_1[_0x23cd75(0x1b0)])(this[_0x23cd75(0x151)]),{page:page=0x1,size:size=0x14,botType:_0x554946,action:_0x4fc2e6,keyword:_0x1897a6,userId:_0x54db1b,rec:_0x259282,status:_0x1364ce,squareType:_0x4e3e4b,workflowId:_0x2c887e,saasId:_0x20ba7d}=_0x4ad58c,_0x461fd9={};_0x554946&&_0x554946[_0x23cd75(0x171)]&&(_0x461fd9[_0x23cd75(0x2a3)]=(0x0,typeorm_2['In'])(_0x554946));_0x4fc2e6&&(_0x461fd9[_0x23cd75(0x279)]=_0x4fc2e6);_0x1897a6&&(_0x461fd9[_0x23cd75(0x1d9)]=(0x0,typeorm_2[_0x23cd75(0x2c0)])('%'+_0x1897a6+'%'));_0x54db1b&&(_0x461fd9[_0x23cd75(0x1c1)]=_0x54db1b);_0x4e3e4b&&(_0x461fd9['squareType']=_0x4e3e4b);_0x2c887e&&(_0x461fd9[_0x23cd75(0x23d)]=_0x2c887e);_0x259282!==null&&_0x259282!==undefined&&(_0x461fd9[_0x23cd75(0x209)]=_0x259282);_0x259282!==null&&_0x1364ce!==undefined&&(_0x461fd9[_0x23cd75(0x10f)]=_0x1364ce);(0x0,utils_1[_0x23cd75(0x21b)])(this[_0x23cd75(0x151)])?(0x0,utils_1['isDefined'])(_0x20ba7d)&&(_0x461fd9['saasId']=_0x20ba7d):_0x461fd9['saasId']=_0x4eb189;const [_0x28ed69,_0x3736ed]=await this[_0x23cd75(0x211)][_0x23cd75(0x18a)]({'where':_0x461fd9,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x23cd75(0x26c)}}),_0x40b8d4=new Map(),_0x2d66b0=_0x28ed69[_0x23cd75(0x178)](_0x54fa69=>_0x54fa69[_0x23cd75(0x23d)])[_0x23cd75(0x138)](_0x5884e4=>Boolean(_0x5884e4));if(_0x2d66b0[_0x23cd75(0x171)]){const _0x5343bb=await this['modelsService'][_0x23cd75(0x11c)](_0x2d66b0);_0x5343bb[_0x23cd75(0x2ce)](_0x3551ad=>_0x40b8d4[_0x23cd75(0x1a8)](_0x3551ad['id'],_0x3551ad));}const _0x516eee=_0x28ed69[_0x23cd75(0x178)](_0x1d0656=>{const _0x823054=_0x23cd75;return{..._0x1d0656,'workflowName':_0x40b8d4[_0x823054(0x285)](_0x1d0656['workflowId'])?.[_0x823054(0x235)]||''};});if(_0x93bcbe){const _0x5a7313=_0x516eee[_0x23cd75(0x178)](_0x3838b5=>_0x3838b5['userId']),_0x363752=await this[_0x23cd75(0x254)][_0x23cd75(0x13d)](_0x5a7313);_0x516eee['forEach'](_0x1a7149=>{const _0x163ced=_0x23cd75,_0x2ecc58=_0x363752[_0x163ced(0x1b4)](_0x11a00e=>_0x11a00e['id']===_0x1a7149[_0x163ced(0x1c1)]);!(0x0,utils_1[_0x163ced(0x237)])(this[_0x163ced(0x151)])&&(_0x2ecc58['email']=(0x0,utils_1[_0x163ced(0x1d5)])(_0x2ecc58[_0x163ced(0x2dc)]),_0x2ecc58[_0x163ced(0x12e)]=(0x0,utils_1['hideString'])(_0x2ecc58['phone'])),_0x1a7149[_0x163ced(0x275)]=_0x2ecc58;});}return{'rows':_0x516eee,'count':_0x3736ed};}catch(_0x7dd749){throw new common_1['HttpException'](_0x7dd749[_0x23cd75(0x27c)],common_1[_0x23cd75(0x239)][_0x23cd75(0x206)]);}}async[_0x1fa71c(0x1a1)](_0x26aef8){const _0x567a67=_0x1fa71c,_0x2bfb68=await this[_0x567a67(0x269)]['getConfigByKeys']([_0x567a67(0x242)]),_0x3ad4a8=Number(_0x2bfb68||0x0);if(_0x3ad4a8===0x0)return!![];const _0x572dde=await this['midjourneyEntity'][_0x567a67(0x130)]({'where':{'userId':_0x26aef8,'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6])}});if(_0x572dde<_0x3ad4a8)return!![];else throw new Error(_0x567a67(0x23a));}async['distributeAccount'](_0x2af701){const _0x52da9b=_0x1fa71c;if(store_1[_0x52da9b(0x2c2)][_0x52da9b(0x15c)]!==_0x52da9b(0x2e2))return null;return null;}async[_0x1fa71c(0x166)](_0x489167,_0x2e71c1){const _0xd83ab5=_0x1fa71c,_0x3b6bac=await this[_0xd83ab5(0x211)][_0xd83ab5(0x130)]({'where':{'originTaskId':String(_0x489167),'customId':_0x2e71c1}});if(_0x3b6bac>0x0)throw new common_1[(_0xd83ab5(0xff))](_0xd83ab5(0x1e9),common_1[_0xd83ab5(0x239)][_0xd83ab5(0x206)]);return![];}async[_0x1fa71c(0x20b)](_0x30d2de){const _0x5acd97=_0x1fa71c,_0x3ed57c=new addDrawQueue_dto_1['AddDrawQueueDto'](_0x30d2de);await this[_0x5acd97(0x110)][_0x5acd97(0x17d)](_0x3ed57c[_0x5acd97(0x243)],_0x3ed57c[_0x5acd97(0x1c1)]);const _0x39023d=(0x0,utils_1['getReqSaasId'])(this['clsService']);_0x3ed57c[_0x5acd97(0x2a9)]=_0x39023d;const _0xfe4f23=await this[_0x5acd97(0x211)][_0x5acd97(0x2d5)](_0x3ed57c);return _0xfe4f23;}async['imagine'](_0x37f51c,_0xc6b57){const _0x52ba8f=_0x1fa71c;let _0x3616e5,{botType:_0xb0af94,prompt:_0x51bf08,extend:_0xbf96a5,action:_0x5a4ab1,mode:_0x155747,translate:_0x54f6ab,base64Array:_0x33bcf5,mats:mats=[],iw:_0x8e3a21,roles:roles=[],cw:_0x31ac20,styles:styles=[],sw:_0x553346}=_0xc6b57;_0x155747=await this['userService'][_0x52ba8f(0x26e)](_0x37f51c[_0x52ba8f(0x2ab)]['id'],_0x155747,'Imagine');const _0x38b3fe=_0x51bf08,_0x21539c=await this['distributeAccount'](_0x155747);_0x51bf08&&await this[_0x52ba8f(0x110)][_0x52ba8f(0x17d)](_0x51bf08,_0x37f51c['user']['id']),_0x51bf08=_0x54f6ab===0x1&&(0x0,utils_1['isChinese'])(_0x51bf08)?await this[_0x52ba8f(0x264)][_0x52ba8f(0x1a4)](_0x51bf08):_0x51bf08;let _0x3b55fd=_0x51bf08;mats['length']&&(_0x3b55fd=mats[_0x52ba8f(0x112)]('\x20')+'\x20'+_0x3b55fd);_0x8e3a21&&(_0x3b55fd=_0x3b55fd+_0x52ba8f(0x1e1)+_0x8e3a21);styles[_0x52ba8f(0x171)]&&(_0x3b55fd=_0x3b55fd+'\x20--sref\x20'+styles['join']('\x20'));roles[_0x52ba8f(0x171)]&&(_0x3b55fd=_0x3b55fd+_0x52ba8f(0x21e)+roles['join']('\x20'));_0x31ac20&&(_0x3b55fd=_0x3b55fd+_0x52ba8f(0x29a)+_0x31ac20);_0x553346&&(_0x3b55fd=_0x3b55fd+_0x52ba8f(0x1d6)+_0x553346);_0xbf96a5&&(_0x3b55fd=_0x3b55fd+'\x20'+_0xbf96a5);const _0x5199e3=await this[_0x52ba8f(0x223)][_0x52ba8f(0x19b)]({'data':{'mode':this[_0x52ba8f(0x180)](_0x155747),'prompt':_0x3b55fd,'botType':_0xb0af94||_0x52ba8f(0x2b1),'base64Array':_0x33bcf5,'accountFilter':_0x21539c}});if(_0x5199e3[_0x52ba8f(0x2b6)]===0x17)throw new Error(_0x52ba8f(0x2b3));if(_0x5199e3[_0x52ba8f(0x2b6)]===0x18)throw new Error('prompt包含敏感词');if(_0x5199e3['code']!==0x1&&_0x5199e3[_0x52ba8f(0x2b6)]!==0x16)throw new Error(_0x5199e3[_0x52ba8f(0x232)]);return _0x3616e5=await this[_0x52ba8f(0x1f7)][_0x52ba8f(0x15f)](async()=>{const _0x3e7af6=_0x52ba8f,_0x1d6d4e={'mode':_0x155747,'prompt':_0x51bf08,'action':_0x5a4ab1,'translate':_0x54f6ab,'fullPrompt':_0x3b55fd,'originPrompt':_0x38b3fe,'extraParam':_0xbf96a5,'userId':_0x37f51c[_0x3e7af6(0x2ab)]['id'],'mjpId':_0x21539c?.[_0x3e7af6(0x134)],'mjpTaskId':_0x5199e3[_0x3e7af6(0x28a)],'botType':_0xb0af94||_0x3e7af6(0x2b1)},_0x137531=await this[_0x3e7af6(0x20b)](_0x1d6d4e);if(!_0x137531)throw new Error(_0x3e7af6(0x293));return await this[_0x3e7af6(0x254)][_0x3e7af6(0x2d8)](_0x37f51c[_0x3e7af6(0x2ab)]['id'],_0x155747,_0x3e7af6(0x1e7),_0x137531['id']),_0x137531;}),_0x3616e5;}async[_0x1fa71c(0x1e0)](_0x5e599c,_0x406095){const _0x2c4da4=_0x1fa71c;let _0x50a34a;const {action:_0x3f6612,taskId:_0x58cdab,customId:_0x5032d3,prompt:_0x17e112,mask:_0x53be0a,enableRemix:_0x548828}=_0x406095;await this[_0x2c4da4(0x166)](_0x58cdab,_0x5032d3);const _0x5b39f3=await this['midjourneyEntity'][_0x2c4da4(0x13e)]({'where':{'id':_0x58cdab}});if(!_0x5b39f3)throw new Error('无绘图记录');let _0x326c24=await this[_0x2c4da4(0x254)][_0x2c4da4(0x26e)](_0x5e599c[_0x2c4da4(0x2ab)]['id'],_0x5b39f3[_0x2c4da4(0x29c)],_0x5032d3);const _0x1966af=await this[_0x2c4da4(0x223)][_0x2c4da4(0x279)]({'data':{'customId':_0x5032d3,'taskId':_0x5b39f3['mjpTaskId'],'accountFilter':{'instanceId':_0x5b39f3[_0x2c4da4(0x24e)]},'mode':this[_0x2c4da4(0x180)](_0x326c24),'enableRemix':_0x548828===undefined?!![]:_0x548828}});if(_0x1966af[_0x2c4da4(0x2b6)]===0x17)throw new Error(_0x2c4da4(0x2b3));else{if(_0x1966af[_0x2c4da4(0x2b6)]===0x18)throw new Error(_0x2c4da4(0x1ce));else{if(_0x1966af['code']===0x15)setTimeout(()=>this[_0x2c4da4(0x283)](_0x1966af['result']));else{if(_0x1966af[_0x2c4da4(0x2b6)]!==0x1&&_0x1966af['code']!==0x16)throw new Error(_0x1966af[_0x2c4da4(0x232)]);}}}return _0x50a34a=await this[_0x2c4da4(0x1f7)][_0x2c4da4(0x15f)](async()=>{const _0x1ac549=_0x2c4da4,_0x36bda2={'action':_0x3f6612,'customId':_0x5032d3,'userId':_0x5e599c[_0x1ac549(0x2ab)]['id'],'mjpTaskId':_0x1966af[_0x1ac549(0x28a)],'originTaskId':String(_0x58cdab),'mode':_0x326c24,'mjpId':_0x5b39f3[_0x1ac549(0x24e)],'prompt':_0x5b39f3['prompt'],'botType':_0x5b39f3[_0x1ac549(0x2a3)],'extraParam':_0x5b39f3[_0x1ac549(0x1f2)],'fullPrompt':_0x5b39f3['fullPrompt'],'originPrompt':_0x5b39f3[_0x1ac549(0x1d9)]},_0xe42c63=await this[_0x1ac549(0x20b)](_0x36bda2);if(!_0xe42c63)throw new Error('提交动作失败');const _0xbf55e5=_0x5b39f3[_0x1ac549(0x173)];return _0x5b39f3[_0x1ac549(0x173)][_0x1ac549(0x2ce)](_0x4fb2f9=>{const _0x16e6c7=_0x1ac549;_0x4fb2f9['customId']===_0x406095[_0x16e6c7(0x14d)]&&(_0x4fb2f9['operated']=!![]);}),await this[_0x1ac549(0x211)]['save'](_0x5b39f3),await this['userService'][_0x1ac549(0x2d8)](_0x5e599c[_0x1ac549(0x2ab)]['id'],_0x326c24,_0x5032d3,_0xe42c63['id']),_0xe42c63;}),_0x50a34a;}async['modalTask'](_0x7661cf,_0x328841){const _0x4354f4=_0x1fa71c;let _0x468fbf,{action:_0x30f8c5,taskId:_0xdbad5,customId:_0x1fbbd5,prompt:_0x52bb51,mask:_0x2fb342}=_0x328841;const _0x54ac22=await this[_0x4354f4(0x211)][_0x4354f4(0x13e)]({'where':{'id':_0xdbad5}});if(!_0x54ac22)throw new Error(_0x4354f4(0x189));const _0x460dee=_0x52bb51;_0x52bb51&&await this[_0x4354f4(0x110)]['checkBadWords'](_0x52bb51,_0x7661cf[_0x4354f4(0x2ab)]['id']),_0x52bb51=(0x0,utils_1[_0x4354f4(0x2a7)])(_0x52bb51)?await this[_0x4354f4(0x264)]['convertToEnglish'](_0x52bb51):_0x52bb51;const _0x350297={'taskId':_0x54ac22[_0x4354f4(0x26b)]};_0x52bb51&&(_0x350297['prompt']=_0x52bb51);_0x2fb342&&(_0x350297['maskBase64']=_0x2fb342);const _0x35447f=await this['mjpTaskService'][_0x4354f4(0x21a)]({'data':_0x350297});if(_0x35447f[_0x4354f4(0x2b6)]!==0x1&&_0x35447f[_0x4354f4(0x2b6)]!==0x16)throw new Error(_0x35447f[_0x4354f4(0x232)]);_0x468fbf=await this[_0x4354f4(0x211)][_0x4354f4(0x2d5)]({'id':_0xdbad5,'prompt':_0x52bb51,'status':0x1,'originPrompt':_0x460dee,'messageFlags':0x1});for(let _0x3aa5bf in _0x468fbf){_0x468fbf[_0x3aa5bf]&&(_0x54ac22[_0x3aa5bf]=_0x468fbf[_0x3aa5bf]);}return _0x54ac22;}async[_0x1fa71c(0x118)](_0x4e271d,_0x5ba79f){const _0x2bcef2=_0x1fa71c;let _0x1cf8a9,_0x5452a8;try{let {type:_0x5dfcee,params:_0x15c551}=_0x4e271d;await this[_0x2bcef2(0x254)]['checkUserStatus'](_0x5ba79f[_0x2bcef2(0x2ab)]),await this[_0x2bcef2(0x1a1)](_0x5ba79f[_0x2bcef2(0x2ab)]['id']);if(_0x5dfcee===midjourney_constant_1[_0x2bcef2(0x109)][_0x2bcef2(0x161)])_0x5452a8=await this['imagine'](_0x5ba79f,_0x15c551),_0x1cf8a9=_0x5452a8[_0x2bcef2(0x26b)];else{if(_0x5dfcee===midjourney_constant_1[_0x2bcef2(0x109)][_0x2bcef2(0x205)])_0x15c551=_0x15c551,_0x15c551[_0x2bcef2(0x14d)]?(_0x5452a8=await this[_0x2bcef2(0x1e0)](_0x5ba79f,_0x15c551),_0x15c551[_0x2bcef2(0x12c)]&&(_0x15c551[_0x2bcef2(0x2b5)]=_0x5452a8['id'],_0x5452a8=await this[_0x2bcef2(0x148)](_0x5ba79f,_0x15c551))):_0x5452a8=await this[_0x2bcef2(0x148)](_0x5ba79f,_0x15c551),_0x1cf8a9=_0x5452a8[_0x2bcef2(0x26b)];else return new common_1[(_0x2bcef2(0xff))](_0x2bcef2(0x2d4),common_1[_0x2bcef2(0x239)][_0x2bcef2(0x206)]);}return _0x5452a8;}catch(_0x94d557){if(_0x94d557 instanceof common_1[_0x2bcef2(0xff)])throw _0x94d557;else{_0x1cf8a9&&await this[_0x2bcef2(0x223)][_0x2bcef2(0x276)]({},_0x1cf8a9);throw new common_1[(_0x2bcef2(0xff))](_0x94d557['message'],common_1['HttpStatus'][_0x2bcef2(0x206)]);}}}async[_0x1fa71c(0x135)](_0xa72167,_0x54bd20){const _0x45a6c2=_0x1fa71c;let _0x2a4ef7,_0x38138c;try{let {type:_0x33c8f5,botType:_0x2414cc,files:_0x540b1f,mode:_0x160494,action:_0x356dd0,size:_0x2071c0,base64Array:base64Array=[]}=_0xa72167;await this[_0x45a6c2(0x254)][_0x45a6c2(0x2a1)](_0x54bd20[_0x45a6c2(0x2ab)]),await this[_0x45a6c2(0x1a1)](_0x54bd20[_0x45a6c2(0x2ab)]['id']);let _0x3510cc='';if(Number(_0x33c8f5)===midjourney_constant_1['MidJourneyDrawEnum']['IMAGE_MIX_IMAGE'])_0x3510cc='Blend';else Number(_0x33c8f5)===midjourney_constant_1[_0x45a6c2(0x109)][_0x45a6c2(0x23b)]&&(_0x3510cc=_0x45a6c2(0x2ae));_0x160494=await this['userService'][_0x45a6c2(0x26e)](_0x54bd20[_0x45a6c2(0x2ab)]['id'],_0x160494,_0x3510cc);const _0x364e7a=await this[_0x45a6c2(0x21c)](_0x160494);if(!base64Array['length'])for(let _0x38448e=0x0;_0x38448e<_0x540b1f[_0x45a6c2(0x171)];_0x38448e++){base64Array[_0x45a6c2(0x2d0)](_0x45a6c2(0x299)+_0x540b1f[_0x38448e][_0x45a6c2(0x168)][_0x45a6c2(0x162)](_0x45a6c2(0x23c)));}if(Number(_0x33c8f5)===midjourney_constant_1[_0x45a6c2(0x109)]['IMAGE_MIX_IMAGE']){if(base64Array['length']<0x2)throw new Error(_0x45a6c2(0x280));const _0x1ab16d=await this['mjpTaskService']['blend']({'data':{'mode':this['convertMode4Transfer'](_0x160494),'dimensions':_0x2071c0,'botType':_0x45a6c2(0x2b1),'base64Array':base64Array,'accountFilter':_0x364e7a}});if(_0x1ab16d[_0x45a6c2(0x2b6)]===0x17)throw new Error(_0x45a6c2(0x2b3));if(_0x1ab16d['code']!==0x1&&_0x1ab16d[_0x45a6c2(0x2b6)]!==0x16)throw new Error(_0x1ab16d[_0x45a6c2(0x232)]);_0x2a4ef7=_0x1ab16d[_0x45a6c2(0x28a)],_0x38138c=await this[_0x45a6c2(0x1f7)]['transaction'](async()=>{const _0x4d85ea=_0x45a6c2,_0x58e034={'mode':_0x160494,'action':_0x356dd0,'userId':_0x54bd20[_0x4d85ea(0x2ab)]['id'],'jobId':(0x0,utils_1[_0x4d85ea(0x2af)])(),'botType':_0x2414cc||'MID_JOURNEY','extraParam':JSON[_0x4d85ea(0xfa)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x1ab16d[_0x4d85ea(0x28a)]},_0x5ec770=await this[_0x4d85ea(0x20b)](_0x58e034);if(!_0x5ec770)throw new Error(_0x4d85ea(0x1ed));return await this[_0x4d85ea(0x254)][_0x4d85ea(0x2d8)](_0x54bd20[_0x4d85ea(0x2ab)]['id'],_0x160494,_0x3510cc,_0x5ec770['id']),_0x5ec770;});}else{if(Number(_0x33c8f5)===midjourney_constant_1[_0x45a6c2(0x109)]['IMAGE_TO_TEXT']){const _0x340ca5=await this[_0x45a6c2(0x223)][_0x45a6c2(0x288)]({'data':{'mode':this[_0x45a6c2(0x180)](_0x160494),'botType':_0x45a6c2(0x2b1),'base64':base64Array[0x0],'accountFilter':_0x364e7a}});if(_0x340ca5['code']===0x17)throw new Error(_0x45a6c2(0x2b3));if(_0x340ca5[_0x45a6c2(0x2b6)]!==0x1&&_0x340ca5[_0x45a6c2(0x2b6)]!==0x16)throw new Error(_0x340ca5[_0x45a6c2(0x232)]);_0x2a4ef7=_0x340ca5[_0x45a6c2(0x28a)],_0x38138c=await this[_0x45a6c2(0x1f7)]['transaction'](async()=>{const _0x198cb8=_0x45a6c2,_0x4f2763={'mode':_0x160494,'action':_0x356dd0,'userId':_0x54bd20[_0x198cb8(0x2ab)]['id'],'jobId':(0x0,utils_1[_0x198cb8(0x2af)])(),'botType':_0x2414cc||_0x198cb8(0x2b1),'extraParam':JSON[_0x198cb8(0xfa)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x340ca5['result']},_0xec7f1c=await this['addDrawQueue'](_0x4f2763);if(!_0xec7f1c)throw new Error('创建图生文任务失败');return await this[_0x198cb8(0x254)][_0x198cb8(0x2d8)](_0x54bd20[_0x198cb8(0x2ab)]['id'],_0x160494,_0x3510cc,_0xec7f1c['id']),_0xec7f1c;})[_0x45a6c2(0x1cf)](async _0x4e20a2=>{const _0xae81f0=_0x45a6c2;await this[_0xae81f0(0x223)][_0xae81f0(0x276)]({},_0x340ca5[_0xae81f0(0x28a)]);throw _0x4e20a2;});}else return new common_1[(_0x45a6c2(0xff))](_0x45a6c2(0x2d4),common_1[_0x45a6c2(0x239)][_0x45a6c2(0x206)]);}return _0x38138c;}catch(_0x1d3c3f){if(_0x1d3c3f instanceof common_1[_0x45a6c2(0xff)])throw _0x1d3c3f;else{_0x2a4ef7&&await this[_0x45a6c2(0x223)][_0x45a6c2(0x276)]({},_0x2a4ef7);throw new common_1[(_0x45a6c2(0xff))](_0x1d3c3f[_0x45a6c2(0x27c)],common_1['HttpStatus']['BAD_REQUEST']);}}}async[_0x1fa71c(0x1c0)](_0x6b0bda,_0x14cb96){const _0x47841c=_0x1fa71c;let _0x14e3f6;try{const {params:_0x1be60f}=_0x6b0bda;let {mode:_0x524c89,botType:_0x112f57,action:_0x351c7e,extend:_0x37190d,sourceBase64:_0xb6b2a3,targetBase64:_0x475055}=_0x1be60f;await this[_0x47841c(0x254)][_0x47841c(0x2a1)](_0x14cb96[_0x47841c(0x2ab)]),await this[_0x47841c(0x1a1)](_0x14cb96[_0x47841c(0x2ab)]['id']),_0x524c89=await this[_0x47841c(0x254)][_0x47841c(0x26e)](_0x14cb96[_0x47841c(0x2ab)]['id'],_0x524c89,_0x47841c(0x227));const _0xef3c69=await this['distributeAccount'](_0x524c89),_0x1fa926=await this['mjpTaskService'][_0x47841c(0x123)]({'data':{'sourceBase64':_0xb6b2a3,'targetBase64':_0x475055,'state':_0x37190d,'mode':this['convertMode4Transfer'](_0x524c89),'accountFilter':_0xef3c69}});if(_0x1fa926['code']===0x17)throw new Error('队列已满，请稍后尝试');if(_0x1fa926[_0x47841c(0x2b6)]===0x18)throw new Error('prompt包含敏感词');if(_0x1fa926[_0x47841c(0x2b6)]!==0x1&&_0x1fa926[_0x47841c(0x2b6)]!==0x16)throw new Error(_0x1fa926['description']);return _0x14e3f6=await this[_0x47841c(0x1f7)]['transaction'](async()=>{const _0x153bef=_0x47841c,_0x120aff={'mode':_0x524c89,'action':_0x351c7e,'prompt':null,'extraParam':_0x37190d,'originPrompt':null,'userId':_0x14cb96['user']['id'],'mjpId':_0xef3c69?.[_0x153bef(0x134)],'mjpTaskId':_0x1fa926['result'],'botType':_0x112f57||_0x153bef(0x2b1)},_0x5d99ae=new addDrawQueue_dto_1['AddDrawQueueDto'](_0x120aff),_0x2b1a3a=(0x0,utils_1[_0x153bef(0x1b0)])(this[_0x153bef(0x151)]);_0x5d99ae[_0x153bef(0x2a9)]=_0x2b1a3a;const _0x46cea5=await this['midjourneyEntity'][_0x153bef(0x2d5)](_0x5d99ae);if(!_0x46cea5)throw new Error(_0x153bef(0x293));return await this[_0x153bef(0x254)][_0x153bef(0x2d8)](_0x14cb96[_0x153bef(0x2ab)]['id'],_0x524c89,_0x153bef(0x227),_0x46cea5['id']),_0x46cea5;}),_0x14e3f6;}catch(_0x1c97f6){if(_0x1c97f6 instanceof common_1['HttpException'])throw _0x1c97f6;else throw new common_1[(_0x47841c(0xff))](_0x1c97f6[_0x47841c(0x27c)],common_1[_0x47841c(0x239)][_0x47841c(0x206)]);}}async[_0x1fa71c(0x226)](_0x3362c3,_0x40da8a){const _0x53816f=_0x1fa71c,_0x826b7f=(0x0,utils_1[_0x53816f(0x1b0)])(this['clsService']),_0x2b8b80={'userId':_0x40da8a[_0x53816f(0x2ab)]['id'],'jobId':(0x0,utils_1[_0x53816f(0x2af)])(),'mode':0x1,'translate':0x0,'prompt':'','progress':0x64,'durationSpent':0x0,'status':0x3,'fullPrompt':_0x3362c3[_0x53816f(0x12c)],'originPrompt':_0x3362c3['prompt'],'fileInfo':_0x3362c3[_0x53816f(0x1e8)],'botType':_0x3362c3[_0x53816f(0x2a3)],'imageUrl':_0x3362c3[_0x53816f(0x1b1)],'buttons':[],'saasId':_0x826b7f},_0x589a06=await this[_0x53816f(0x211)]['save'](_0x2b8b80);return _0x589a06;}async[_0x1fa71c(0x294)](_0x438ba9){const _0x21a1d0=_0x1fa71c;try{const _0x2dd6a0=await this[_0x21a1d0(0x211)][_0x21a1d0(0x13e)]({'where':{'jobId':_0x438ba9}});if(!_0x2dd6a0)throw new Error('任务不存在！');const _0xa3ef1=await this['mjpTaskService']['imageSeed']({},_0x2dd6a0[_0x21a1d0(0x26b)]);if(_0xa3ef1[_0x21a1d0(0x2b6)]!==0x1)throw new Error(_0xa3ef1[_0x21a1d0(0x232)]);return _0xa3ef1[_0x21a1d0(0x28a)];}catch(_0x1e9910){throw new common_1[(_0x21a1d0(0xff))](_0x1e9910[_0x21a1d0(0x27c)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x1fa71c(0x19c)](_0x14229b,_0x468237){const _0x13d4d2=_0x1fa71c;try{let _0x1f081a,_0x4f377c,_0x57a78e,_0x3e8a32;const {jobId:_0x4541ae,detail:_0x562440}=_0x468237,_0x30776b=(0x0,utils_1[_0x13d4d2(0x17a)])(this[_0x13d4d2(0x151)]),_0x2836f6=await this['midjourneyEntity'][_0x13d4d2(0x13e)]({'where':{'jobId':_0x4541ae}});if(_0x2836f6[_0x13d4d2(0x23d)]){const _0x594e89=await this['modelsService'][_0x13d4d2(0x13a)](_0x2836f6[_0x13d4d2(0x23d)]);_0x3e8a32=_0x594e89[_0x13d4d2(0x235)];}return _0x562440&&(this['aiLogService'][_0x13d4d2(0x2cc)](model_constant_1['EModelType'][_0x13d4d2(0x100)],_0x2836f6['id']),_0x1f081a=await this[_0x13d4d2(0x254)][_0x13d4d2(0x105)](_0x2836f6[_0x13d4d2(0x1c1)]),_0x4f377c=await this[_0x13d4d2(0x29e)][_0x13d4d2(0x127)](model_constant_1['EModelType'][_0x13d4d2(0x100)],_0x2836f6['id']),_0x30776b&&(_0x57a78e=await this[_0x13d4d2(0x29e)][_0x13d4d2(0x153)](model_constant_1['EModelType'][_0x13d4d2(0x100)],_0x2836f6['id']))),{..._0x2836f6,'workflowName':_0x3e8a32,'avatar':_0x1f081a?_0x1f081a[_0x13d4d2(0x19d)]:null,'username':_0x1f081a?_0x1f081a[_0x13d4d2(0x152)]:null,'nickname':_0x1f081a?_0x1f081a[_0x13d4d2(0x2ad)]:null,'visitNum':_0x4f377c?_0x4f377c[_0x13d4d2(0x274)]:0x0,'agreeNum':_0x4f377c?_0x4f377c['agreeNum']:0x0,'agree':_0x57a78e?_0x57a78e[_0x13d4d2(0x279)]:null};}catch(_0x1589b7){throw new common_1['HttpException'](_0x1589b7[_0x13d4d2(0x27c)],common_1[_0x13d4d2(0x239)][_0x13d4d2(0x206)]);}}async['getDetailByIds'](_0x48b8bf,_0x5e424e){const _0x350ebc=_0x1fa71c;try{if(!_0x5e424e['jobIds']||!_0x5e424e[_0x350ebc(0x2bd)][_0x350ebc(0x171)])return[];const _0x4353eb=_0x5e424e[_0x350ebc(0x2bd)][_0x350ebc(0x22b)](','),_0x1ba686=await this[_0x350ebc(0x211)][_0x350ebc(0x1b4)]({'where':{'jobId':(0x0,typeorm_2['In'])(_0x4353eb)}}),_0x3daf25=new Map(),_0x7f35d3=_0x1ba686[_0x350ebc(0x178)](_0x4e7d8d=>_0x4e7d8d[_0x350ebc(0x23d)])['filter'](_0x2feb46=>Boolean(_0x2feb46));if(_0x7f35d3[_0x350ebc(0x171)]){const _0x33831a=await this[_0x350ebc(0x15a)][_0x350ebc(0x11c)](_0x7f35d3);_0x33831a['forEach'](_0x487056=>_0x3daf25['set'](_0x487056['id'],_0x487056));}return _0x1ba686['map'](_0x80e79=>{const _0x279fba=_0x350ebc;return{..._0x80e79,'workflowName':_0x3daf25[_0x279fba(0x285)](_0x80e79[_0x279fba(0x23d)])?.[_0x279fba(0x235)]||''};});}catch(_0x48f371){throw new common_1['HttpException'](_0x48f371['message'],common_1['HttpStatus'][_0x350ebc(0x206)]);}}async['recDraw'](_0x4556d8){const _0x311ebd=_0x1fa71c,{id:_0x7be128,squareType:_0x852aad}=_0x4556d8,_0x33267a=await this[_0x311ebd(0x211)][_0x311ebd(0x13e)]({'where':{'id':_0x7be128,'status':midjourney_constant_1[_0x311ebd(0x1bb)][_0x311ebd(0x102)]}});if(!_0x33267a)throw new common_1[(_0x311ebd(0xff))](_0x311ebd(0x295),common_1['HttpStatus'][_0x311ebd(0x206)]);const _0x51bcbd=await this['midjourneyEntity']['update']({'id':_0x7be128},{'rec':0x1,'squareType':_0x852aad})[_0x311ebd(0x1cf)](_0x242a53=>{const _0xe2c5b9=_0x311ebd;throw new common_1[(_0xe2c5b9(0xff))](_0x242a53,common_1[_0xe2c5b9(0x239)][_0xe2c5b9(0x206)]);});if(_0x51bcbd[_0x311ebd(0x150)]<=0x0)throw new common_1['HttpException']('操作失败！',common_1['HttpStatus'][_0x311ebd(0x206)]);return await this[_0x311ebd(0x1a7)][_0x311ebd(0x26d)]({'key':_0x311ebd(0x27a)}),!![];}async['workflowForm'](_0x296c11,_0x2ca176){const _0x2dde9a=_0x1fa71c;return this[_0x2dde9a(0x176)][_0x2dde9a(0x27b)]({'data':{'workflowId':_0x296c11,'versionId':_0x2ca176}});}async[_0x1fa71c(0x2c5)](_0x1409fe,_0x34fa00){const _0x31488d=_0x1fa71c;try{const _0x20a2a0={'page':_0x34fa00[_0x31488d(0x2c8)],'size':_0x34fa00[_0x31488d(0x23f)],'modelName':_0x34fa00[_0x31488d(0x1d1)],'modelType':model_constant_1[_0x31488d(0x17c)][_0x31488d(0x2c4)]};(0x0,utils_1[_0x31488d(0x27f)])(this[_0x31488d(0x151)])?_0x34fa00[_0x31488d(0x10f)]!==undefined&&(_0x20a2a0[_0x31488d(0x10f)]=Boolean(_0x34fa00[_0x31488d(0x10f)])):_0x20a2a0[_0x31488d(0x10f)]=!![];const _0x7095be=await this[_0x31488d(0x15a)][_0x31488d(0x2df)](_0x1409fe,_0x20a2a0);let _0xa8a928=[];if(_0x7095be[_0x31488d(0x185)][_0x31488d(0x171)]){const _0x1e8a43=new Set(),_0xe9df86=(0x0,utils_1[_0x31488d(0x17a)])(this[_0x31488d(0x151)]),_0x1c16ee=_0x7095be[_0x31488d(0x185)][_0x31488d(0x178)](_0x466506=>_0x466506['id']);if(_0x1c16ee[_0x31488d(0x171)]&&_0xe9df86){const _0x452187=await this[_0x31488d(0x254)][_0x31488d(0x198)](_0xe9df86,user_constant_1[_0x31488d(0x2b8)][_0x31488d(0x2c4)],_0x1c16ee);_0x452187['forEach'](_0x48566c=>_0x1e8a43[_0x31488d(0x1af)](Number(_0x48566c[_0x31488d(0x202)])));}_0xa8a928=_0x7095be[_0x31488d(0x185)]['map'](_0x3b90ed=>{const _0x29e002=_0x31488d,_0x16a806={'id':_0x3b90ed['id'],'cover':_0x3b90ed[_0x29e002(0x142)],'name':_0x3b90ed[_0x29e002(0x235)],'workflowId':_0x3b90ed[_0x29e002(0x1f0)],'versionId':Number(_0x3b90ed[_0x29e002(0x20c)]),'deduct':_0x3b90ed[_0x29e002(0x24c)],'vipFreeNum':_0x3b90ed[_0x29e002(0x236)],'displaySort':_0x3b90ed[_0x29e002(0x2a2)],'description':_0x3b90ed['description'],'status':_0x3b90ed[_0x29e002(0x10f)],'createdAt':_0x3b90ed[_0x29e002(0x22f)],'updatedAt':_0x3b90ed['updatedAt'],'useCount':_0x3b90ed[_0x29e002(0x230)],'tutorial':_0x3b90ed['remark'],'freeUsed':_0x3b90ed[_0x29e002(0x149)],'favorite':_0x1e8a43[_0x29e002(0x21f)](_0x3b90ed['id'])};return _0x16a806;});}return{'count':_0x7095be[_0x31488d(0x130)],'rows':_0xa8a928};}catch(_0x122ab0){throw new common_1[(_0x31488d(0xff))](_0x122ab0['message'],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x1fa71c(0x27b)](_0x4f1723,_0x5bca3d){const _0x257c39=_0x1fa71c;try{let _0x30002d;const _0x22804a=(0x0,utils_1[_0x257c39(0x17a)])(this[_0x257c39(0x151)]),_0x3aacc8=new Set(),_0x37a760=await this[_0x257c39(0x15a)][_0x257c39(0x13a)](_0x5bca3d);if(!_0x37a760)throw new common_1[(_0x257c39(0xff))]('工作流（小工具）不存在',common_1['HttpStatus'][_0x257c39(0x206)]);if(_0x22804a){const _0x1d86f3=await this['userService'][_0x257c39(0x105)](_0x22804a);if(_0x1d86f3[_0x257c39(0x120)]||_0x1d86f3[_0x257c39(0x1c3)]){const _0x25a726=redisKey_constant_1[_0x257c39(0x14c)]+'-'+_0x22804a+'-'+_0x37a760['id'];_0x30002d=await await this[_0x257c39(0x1a7)]['get']({'key':_0x25a726});}const _0x5dc9c9=await this[_0x257c39(0x254)][_0x257c39(0x198)](_0x22804a,user_constant_1[_0x257c39(0x2b8)][_0x257c39(0x2c4)],[_0x37a760['id']]);_0x5dc9c9[_0x257c39(0x2ce)](_0x524dd4=>_0x3aacc8['add'](Number(_0x524dd4['relateId'])));}const _0x413c75={'id':_0x37a760['id'],'cover':_0x37a760[_0x257c39(0x142)],'name':_0x37a760[_0x257c39(0x235)],'workflowId':_0x37a760[_0x257c39(0x1f0)],'versionId':Number(_0x37a760[_0x257c39(0x20c)]),'deduct':_0x37a760['deduct'],'vipFreeNum':_0x37a760[_0x257c39(0x236)],'displaySort':_0x37a760[_0x257c39(0x2a2)],'description':_0x37a760[_0x257c39(0x232)],'status':_0x37a760[_0x257c39(0x10f)],'createdAt':_0x37a760['createdAt'],'updatedAt':_0x37a760['updatedAt'],'useCount':_0x37a760['useCount'],'tutorial':_0x37a760[_0x257c39(0x136)],'freeUsed':Number(_0x30002d),'favorite':_0x3aacc8[_0x257c39(0x21f)](_0x37a760['id'])};return _0x413c75;}catch(_0x322c24){throw new common_1[(_0x257c39(0xff))](_0x322c24['message'],common_1[_0x257c39(0x239)][_0x257c39(0x206)]);}}async[_0x1fa71c(0x141)](_0x3911b9){const _0xe83fd1=_0x1fa71c;try{const _0x2e3aa2={'id':_0x3911b9['id'],'keyType':0x5,'modelType':model_constant_1['EModelType'][_0xe83fd1(0x2c4)],'cover':_0x3911b9[_0xe83fd1(0x142)],'modelName':_0x3911b9[_0xe83fd1(0x271)],'model':_0x3911b9[_0xe83fd1(0x23d)],'key':'','deduct':_0x3911b9[_0xe83fd1(0x24c)],'vipFreeNum':_0x3911b9['vipFreeNum'],'displaySort':_0x3911b9[_0xe83fd1(0x2a2)],'description':_0x3911b9[_0xe83fd1(0x232)],'status':_0x3911b9[_0xe83fd1(0x10f)],'remark':_0x3911b9[_0xe83fd1(0x2c3)]};return _0x3911b9[_0xe83fd1(0x1ff)]&&(_0x2e3aa2[_0xe83fd1(0x20c)]=String(_0x3911b9[_0xe83fd1(0x1ff)])),await this[_0xe83fd1(0x15a)][_0xe83fd1(0x125)](_0x2e3aa2),!![];}catch(_0x59cf92){throw new common_1[(_0xe83fd1(0xff))](_0x59cf92[_0xe83fd1(0x27c)],common_1[_0xe83fd1(0x239)]['BAD_REQUEST']);}}async[_0x1fa71c(0x259)](_0x1a9fec){const _0x545af1=_0x1fa71c;return this[_0x545af1(0x15a)]['modelDel'](_0x1a9fec[_0x545af1(0x13b)]);}async['workflowDicts'](){const _0x52bce8=_0x1fa71c,_0x2e618d=await this['dictService'][_0x52bce8(0x119)](_0x52bce8(0xfc)),_0x527616=await this[_0x52bce8(0x200)][_0x52bce8(0x119)]('effect_category'),_0x278dea=await this[_0x52bce8(0x200)]['list4workflow'](_0x52bce8(0x1eb)),_0xe1f093=await this[_0x52bce8(0x200)][_0x52bce8(0x119)](_0x52bce8(0x2cd));return{'style':_0x2e618d,'effect_category':_0x527616,'effect_main_body':_0x278dea,'application_fields':_0xe1f093};}async[_0x1fa71c(0x10d)](_0x33798c){const _0x2e4693=_0x1fa71c;try{const {page:page=0x1,size:size=0x14,keyword:_0x3fc0ea,type:_0x48ff72,version:_0x1553fd,style:_0x4ef697,effectCategory:_0x18b8e2,effectMainBody:_0x41ec3c,applicationFields:_0x4ad54a,disabled:_0x25c9fe}=_0x33798c,_0x4abd8c={};_0x3fc0ea&&(_0x4abd8c[_0x2e4693(0x271)]=(0x0,typeorm_2[_0x2e4693(0x2c0)])('%'+_0x3fc0ea+'%'));_0x48ff72&&(_0x4abd8c[_0x2e4693(0x169)]=_0x48ff72);_0x1553fd&&(_0x4abd8c['version']=_0x1553fd);_0x4ef697&&(_0x4abd8c[_0x2e4693(0xfc)]=_0x4ef697);_0x18b8e2&&(_0x4abd8c['effectCategory']=_0x18b8e2);_0x41ec3c&&(_0x4abd8c['effectMainBody']=_0x41ec3c);_0x4ad54a&&(_0x4abd8c[_0x2e4693(0x107)]=_0x4ad54a);(0x0,utils_1[_0x2e4693(0x27f)])(this[_0x2e4693(0x151)])?(0x0,utils_1[_0x2e4693(0x18e)])(_0x25c9fe)&&(_0x4abd8c[_0x2e4693(0x1c9)]=_0x25c9fe):_0x4abd8c[_0x2e4693(0x1c9)]=0x0;const [_0x2bf596,_0x97badd]=await this['mjModelEntity']['findAndCount']({'where':_0x4abd8c,'take':size,'skip':(page-0x1)*size,'order':{'id':_0x2e4693(0x272)}});return{'rows':_0x2bf596,'count':_0x97badd};}catch(_0x3035aa){throw new common_1[(_0x2e4693(0xff))](_0x3035aa[_0x2e4693(0x27c)],common_1[_0x2e4693(0x239)][_0x2e4693(0x206)]);}}async[_0x1fa71c(0x1a2)](_0x360c9c){const _0x293a8d=_0x1fa71c;try{const {id:_0x5d974e,name:_0xaa81fd,cover:_0x4f6758,description:_0xe3690b,disabled:_0x4bce4a}=_0x360c9c,_0x42c4c6={};return _0xaa81fd&&(_0x42c4c6['name']=_0xaa81fd),_0x4f6758&&(_0x42c4c6['cover']=_0x4f6758),_0xe3690b&&(_0x42c4c6['description']=_0xe3690b),_0x4bce4a&&(_0x42c4c6[_0x293a8d(0x1c9)]=_0x4bce4a),await this[_0x293a8d(0x1c5)][_0x293a8d(0x1d8)]({'id':_0x5d974e},_0x42c4c6),!![];}catch(_0xfe7560){throw new common_1[(_0x293a8d(0xff))](_0xfe7560[_0x293a8d(0x27c)],common_1[_0x293a8d(0x239)][_0x293a8d(0x206)]);}}async[_0x1fa71c(0x289)](_0x1aed06){const _0x4843ab=_0x1fa71c,_0x40c855=_0x1aed06[_0x4843ab(0x22b)](',');if(!_0x1aed06[_0x4843ab(0x171)])throw new common_1[(_0x4843ab(0xff))](_0x4843ab(0x121),common_1[_0x4843ab(0x239)][_0x4843ab(0x206)]);return this['mjModelEntity'][_0x4843ab(0x1b4)]({'where':{'id':(0x0,typeorm_2['In'])(_0x40c855),'disabled':0x0}});}async['workflowTaskSubmit'](_0x1d829a,_0x3a7d92){const _0xf80235=_0x1fa71c;try{const _0xc1b8f2=await this['modelsService'][_0xf80235(0x13a)](_0x3a7d92[_0xf80235(0x23d)]);if(!_0xc1b8f2[_0xf80235(0x10f)])throw new Error(_0xf80235(0x284));let _0xc7074c;const _0x2b731e=(0x0,utils_1[_0xf80235(0x1b0)])(this[_0xf80235(0x151)]);return await this[_0xf80235(0x1f7)][_0xf80235(0x15f)](async()=>{const _0xe42528=_0xf80235;_0xc7074c=await this[_0xe42528(0x20b)]({'originPrompt':'','saasId':_0x2b731e,'userId':_0x1d829a[_0xe42528(0x2ab)]['id'],'mode':midjourney_constant_1['DrawSpeed']['fast'],'botType':DrawTaskPage_dto_1[_0xe42528(0x222)][_0xe42528(0x2c4)],'workflowId':_0x3a7d92[_0xe42528(0x23d)],'fullPrompt':JSON[_0xe42528(0xfa)](_0x3a7d92[_0xe42528(0x2bc)])}),await this['userService'][_0xe42528(0x22d)](_0x1d829a['user']['id'],_0xc1b8f2,_0xc7074c['id']);const _0x5b7db2=await this[_0xe42528(0x176)][_0xe42528(0x15b)]({'data':{'workflowId':Number(_0xc1b8f2['model']),'versionId':Number(_0xc1b8f2[_0xe42528(0x20c)]),'inputs':_0x3a7d92[_0xe42528(0x2bc)]}});_0xc7074c[_0xe42528(0x26b)]=_0x5b7db2['taskId'],await this[_0xe42528(0x211)][_0xe42528(0x1d8)]({'id':_0xc7074c['id']},{'mjpTaskId':_0x5b7db2[_0xe42528(0x2b5)]});}),_0xc7074c;}catch(_0x18538d){throw new common_1[(_0xf80235(0xff))](_0x18538d[_0xf80235(0x27c)],common_1[_0xf80235(0x239)][_0xf80235(0x206)]);}}async[_0x1fa71c(0x1fe)](_0x39abc1,_0x4088e9){const _0x6e728b=_0x1fa71c,{page:page=0x1,size:size=0x14}=_0x4088e9,[_0x1f62aa]=await this[_0x6e728b(0x1f7)][_0x6e728b(0x155)](_0x6e728b(0x2c7)+_0x39abc1[_0x6e728b(0x2ab)]['id']+_0x6e728b(0x2da)),_0x33f8fe=await this[_0x6e728b(0x1f7)]['query'](_0x6e728b(0x1f5)+_0x39abc1[_0x6e728b(0x2ab)]['id']+_0x6e728b(0x28f)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x6e728b(0x1f9));return{'rows':_0x33f8fe,'count':Number(_0x1f62aa?.[_0x6e728b(0x130)]||0x0)};}async[_0x1fa71c(0xf7)](_0x5ba05c,_0x100647){const _0x2d6650=_0x1fa71c,_0x10dc16=_0x5ba05c['user']['id'],{page:page=0x1,size:size=0x14}=_0x100647,[_0x41cd56]=await this[_0x2d6650(0x1f7)][_0x2d6650(0x155)](_0x2d6650(0x1a6)+_0x5ba05c[_0x2d6650(0x2ab)]['id']+_0x2d6650(0x111)+user_constant_1[_0x2d6650(0x2b8)][_0x2d6650(0x2c4)]+_0x2d6650(0x246)),_0x3acc1c=await this['connection'][_0x2d6650(0x155)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27'+_0x5ba05c[_0x2d6650(0x2ab)]['id']+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27'+user_constant_1[_0x2d6650(0x2b8)][_0x2d6650(0x2c4)]+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.createdAt\x20DESC\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+size+_0x2d6650(0x131)+(page-0x1)*size+_0x2d6650(0x1f9));if(_0x5ba05c[_0x2d6650(0x2ab)]['id']){const _0x44bf02=await this[_0x2d6650(0x254)][_0x2d6650(0x105)](_0x10dc16);if(_0x44bf02[_0x2d6650(0x120)]||_0x44bf02[_0x2d6650(0x1c3)])for(let _0x20428b=0x0;_0x20428b<_0x3acc1c[_0x2d6650(0x171)];_0x20428b++){const _0x27d644=_0x3acc1c[_0x20428b],_0x44eb3e=redisKey_constant_1[_0x2d6650(0x14c)]+'-'+_0x10dc16+'-'+_0x27d644['id'],_0x4bc412=await await this[_0x2d6650(0x1a7)][_0x2d6650(0x285)]({'key':_0x44eb3e});_0x27d644[_0x2d6650(0x1d2)]=Number(_0x4bc412||0x0);}}return{'rows':_0x3acc1c,'count':_0x41cd56?.[_0x2d6650(0x130)]||0x0};}async['sdTaskSubmit'](_0x135d74,_0x4d8576){const _0x72de42=_0x1fa71c;try{let _0x1e7dec;const _0x3bc7d3=(0x0,utils_1[_0x72de42(0x1b0)])(this[_0x72de42(0x151)]);return await this[_0x72de42(0x1f7)][_0x72de42(0x15f)](async()=>{const _0xd59c1d=_0x72de42;_0x1e7dec=await this[_0xd59c1d(0x20b)]({'saasId':_0x3bc7d3,'userId':_0x135d74['user']['id'],'mode':midjourney_constant_1[_0xd59c1d(0x2b4)][_0xd59c1d(0x193)],'botType':DrawTaskPage_dto_1[_0xd59c1d(0x222)]['SD'],'originPrompt':_0x4d8576[_0xd59c1d(0x12c)],'fullPrompt':JSON[_0xd59c1d(0xfa)](_0x4d8576)}),await this[_0xd59c1d(0x254)][_0xd59c1d(0x2e3)](_0x135d74[_0xd59c1d(0x2ab)]['id'],_0x1e7dec['id']);const _0x1e0268=await this['czTaskService'][_0xd59c1d(0x195)]({'data':_0x4d8576});_0x1e7dec[_0xd59c1d(0x26b)]=_0x1e0268[_0xd59c1d(0x146)],await this[_0xd59c1d(0x211)]['update']({'id':_0x1e7dec['id']},{'mjpTaskId':_0x1e0268[_0xd59c1d(0x146)]});}),_0x1e7dec;}catch(_0x146da8){throw new common_1[(_0x72de42(0xff))](_0x146da8[_0x72de42(0x27c)],common_1[_0x72de42(0x239)]['BAD_REQUEST']);}}async[_0x1fa71c(0x18d)](_0x22cc92,_0x3a3c5b){const _0x1d73c4=_0x1fa71c;try{const _0x281822=await this[_0x1d73c4(0x211)][_0x1d73c4(0x13e)]({'where':{'id':Number(_0x3a3c5b[_0x1d73c4(0x2b5)])}});if(!_0x281822)throw new Error('原始任务不存在！');let _0x5ace13;const _0x65d6cc=(0x0,utils_1[_0x1d73c4(0x1b0)])(this[_0x1d73c4(0x151)]);return await this[_0x1d73c4(0x1f7)][_0x1d73c4(0x15f)](async()=>{const _0x4a0cab=_0x1d73c4;_0x5ace13=await this[_0x4a0cab(0x20b)]({'saasId':_0x65d6cc,'userId':_0x22cc92['user']['id'],'mode':midjourney_constant_1[_0x4a0cab(0x2b4)][_0x4a0cab(0x193)],'botType':DrawTaskPage_dto_1[_0x4a0cab(0x222)]['SD'],'originPrompt':_0x3a3c5b[_0x4a0cab(0x12c)],'originTaskId':_0x3a3c5b[_0x4a0cab(0x2b5)],'fullPrompt':JSON[_0x4a0cab(0xfa)](_0x3a3c5b)}),await this['userService']['deductBalance4SD'](_0x22cc92['user']['id'],_0x5ace13['id']);const _0x59fe85=await this[_0x4a0cab(0x176)][_0x4a0cab(0x114)]({'data':{'mask':_0x3a3c5b['mask'],'prompt':_0x3a3c5b[_0x4a0cab(0x12c)],'taskId':_0x281822[_0x4a0cab(0x26b)],'denoisingStrength':_0x3a3c5b[_0x4a0cab(0x154)]}});_0x5ace13['mjpTaskId']=_0x59fe85['paintingSign'],await this['midjourneyEntity']['update']({'id':_0x5ace13['id']},{'mjpTaskId':_0x59fe85[_0x4a0cab(0x146)]});}),_0x5ace13;}catch(_0x14f8e5){throw new common_1[(_0x1d73c4(0xff))](_0x14f8e5[_0x1d73c4(0x27c)],common_1[_0x1d73c4(0x239)][_0x1d73c4(0x206)]);}}async[_0x1fa71c(0x116)](_0x144161){const _0x534182=_0x1fa71c,{id:_0x5b0477,favorite:_0x37e17d}=_0x144161,_0x1cac76=await this['midjourneyEntity'][_0x534182(0x13e)]({'where':{'id':_0x5b0477}})[_0x534182(0x1cf)](_0xd66453=>{const _0xe24cff=_0x534182;common_1[_0xe24cff(0x225)][_0xe24cff(0x1b3)](_0xd66453);});if(!_0x1cac76)throw new common_1['HttpException']('当前图片不存在！',common_1[_0x534182(0x239)][_0x534182(0x206)]);const _0x43eb65=await this[_0x534182(0x211)][_0x534182(0x1d8)]({'id':_0x5b0477},{'favorite':_0x37e17d});if(_0x43eb65[_0x534182(0x150)]<=0x0)throw new common_1[(_0x534182(0xff))](_0x534182(0x2c9),common_1[_0x534182(0x239)][_0x534182(0x206)]);return!![];}async[_0x1fa71c(0x25d)](_0x45a5a5,_0x7165c8){const _0x17360b=_0x1fa71c,{page:page=0x1,size:size=0x14}=_0x45a5a5,[_0x1f8d8f,_0x5dd53c]=await this[_0x17360b(0x211)][_0x17360b(0x18a)]({'where':{'userId':_0x7165c8[_0x17360b(0x2ab)]['id'],'favorite':0x1},'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x17360b(0x26c)}});return{'rows':_0x1f8d8f,'count':_0x5dd53c};}async[_0x1fa71c(0x16a)](_0x1da486,_0x1994dd){const _0x2f91ae=_0x1fa71c;try{const _0x458de5=await this[_0x2f91ae(0x211)][_0x2f91ae(0x13e)]({'where':{'id':_0x1da486,'userId':_0x1994dd[_0x2f91ae(0x2ab)]['id']}});if(!_0x458de5)throw new Error(_0x2f91ae(0x179));if(_0x458de5[_0x2f91ae(0x10f)]===midjourney_constant_1[_0x2f91ae(0x1bb)][_0x2f91ae(0x101)])throw new Error(_0x2f91ae(0x25e));await this[_0x2f91ae(0x223)]['cancel'](null,_0x458de5[_0x2f91ae(0x26b)]);const _0x57edbe=await this[_0x2f91ae(0x211)][_0x2f91ae(0x2b0)]({'id':_0x1da486});if(_0x57edbe[_0x2f91ae(0x150)]>0x0)return _0x2f91ae(0x124);else throw new Error(_0x2f91ae(0x2de));}catch(_0x351c84){throw new common_1[(_0x2f91ae(0xff))](_0x351c84[_0x2f91ae(0x27c)],common_1[_0x2f91ae(0x239)]['BAD_REQUEST']);}}async['delLog'](_0x1a606a,_0x24e1a8){const _0x558b0a=_0x1fa71c,{id:_0x1867a5}=_0x24e1a8;if(!_0x1867a5)throw new common_1[(_0x558b0a(0xff))](_0x558b0a(0x16b),common_1[_0x558b0a(0x239)][_0x558b0a(0x206)]);const _0x445c62=await this[_0x558b0a(0x211)][_0x558b0a(0x2b0)]({'id':_0x1867a5});if(_0x445c62[_0x558b0a(0x150)]<=0x0)throw new common_1[(_0x558b0a(0xff))](_0x558b0a(0x1ae),common_1[_0x558b0a(0x239)][_0x558b0a(0x206)]);return!![];}async[_0x1fa71c(0x1fc)](_0x379123,_0x3ac1d8){const _0x1b758e=_0x1fa71c;try{const {prompt:_0x58f5a4,status:_0x3934c0,isCarryParams:_0x3b7174,imageUrl:_0x37b226,title:_0x313215,order:_0x3357be,id:_0x5d3f8f,aspect:_0x55b79c}=_0x3ac1d8;if(_0x5d3f8f)return await this[_0x1b758e(0x1a0)]['update']({'id':_0x5d3f8f},{'title':_0x313215,'prompt':_0x58f5a4,'imageUrl':_0x37b226,'status':_0x3934c0,'isCarryParams':_0x3b7174,'order':_0x3357be,'aspect':_0x55b79c})[_0x1b758e(0x2d6)](_0x56a864=>!!_0x56a864);else{const _0xd4528a=(0x0,utils_1[_0x1b758e(0x1b0)])(this[_0x1b758e(0x151)]);return await this[_0x1b758e(0x1a0)][_0x1b758e(0x2d5)]({'prompt':_0x58f5a4,'status':_0x3934c0,'imageUrl':_0x37b226,'isCarryParams':_0x3b7174,'title':_0x313215,'order':_0x3357be,'aspect':_0x55b79c,'saasId':_0xd4528a})[_0x1b758e(0x2d6)](_0x4f2f0f=>!!_0x4f2f0f);}}catch(_0x2be69a){console[_0x1b758e(0x115)](_0x1b758e(0x2a6),_0x2be69a);}}async[_0x1fa71c(0x292)](_0x2fa7fa,_0x223e6c){const _0x752bab=_0x1fa71c,{id:_0x38fca8}=_0x223e6c;if(!_0x38fca8)throw new common_1[(_0x752bab(0xff))](_0x752bab(0x16b),common_1[_0x752bab(0x239)][_0x752bab(0x206)]);return await this['mjPromptsEntity'][_0x752bab(0x2b0)]({'id':_0x38fca8});}async[_0x1fa71c(0x158)](){const _0xb9a98b=_0x1fa71c,_0x514244=(0x0,utils_1[_0xb9a98b(0x1b0)])(this[_0xb9a98b(0x151)]);return await this[_0xb9a98b(0x1a0)][_0xb9a98b(0x1b4)]({'where':{'saasId':_0x514244},'order':{'order':_0xb9a98b(0x26c)}})[_0xb9a98b(0x2d6)](_0x469ed3=>_0x469ed3||[])[_0xb9a98b(0x1cf)](_0x224378=>{const _0x6e2286=_0xb9a98b;common_1[_0x6e2286(0x225)][_0x6e2286(0x1b3)](_0x224378);});}async[_0x1fa71c(0x208)](_0x583973){const _0x446a99=_0x1fa71c;try{const {page:_0x48e569,size:_0xe0b39,keyword:_0x152591,saasId:_0x3723ac}=_0x583973,_0x37aaf2=(0x0,utils_1[_0x446a99(0x1b0)])(this['clsService']),_0x24fb7d={'status':!![]};(0x0,utils_1[_0x446a99(0x21b)])(this[_0x446a99(0x151)])?(0x0,utils_1[_0x446a99(0x18e)])(_0x3723ac)&&(_0x24fb7d[_0x446a99(0x2a9)]=_0x3723ac):_0x24fb7d[_0x446a99(0x2a9)]=_0x37aaf2;const [_0x3e276e,_0x38eac1]=await this[_0x446a99(0x1a0)]['findAndCount']({'where':[{..._0x24fb7d,'title':(0x0,typeorm_2['Like'])('%'+_0x152591+'%')},{..._0x24fb7d,'prompt':(0x0,typeorm_2[_0x446a99(0x2c0)])('%'+_0x152591+'%')}],'take':_0xe0b39,'skip':(_0x48e569-0x1)*_0xe0b39,'order':{'order':_0x446a99(0x26c)}});return{'rows':_0x3e276e,'count':_0x38eac1};}catch(_0x24056a){throw new common_1[(_0x446a99(0xff))](_0x24056a[_0x446a99(0x27c)],common_1[_0x446a99(0x239)][_0x446a99(0x206)]);}}async[_0x1fa71c(0x1b7)](_0x15abbc){const _0x279f41=_0x1fa71c;try{const {name:_0x1d2fc8,value:_0x531065}=_0x15abbc,_0x396ebe=(0x0,utils_1[_0x279f41(0x1b0)])(this[_0x279f41(0x151)]),_0x375645=await this[_0x279f41(0x248)]['findOneBy']({'name':_0x1d2fc8,'saasId':_0x396ebe});if(_0x375645)throw new common_1[(_0x279f41(0xff))]('名称不能重复',common_1['HttpStatus']['BAD_REQUEST']);return await this[_0x279f41(0x248)][_0x279f41(0x2d5)]({'name':_0x1d2fc8,'value':_0x531065,'saasId':_0x396ebe})[_0x279f41(0x2d6)](_0x3ee66b=>!!_0x3ee66b)[_0x279f41(0x1cf)](_0x5e98dc=>{const _0x39b409=_0x279f41;console[_0x39b409(0x115)](_0x5e98dc);throw new common_1[(_0x39b409(0xff))](_0x5e98dc,common_1[_0x39b409(0x239)][_0x39b409(0x206)]);});}catch(_0x3b58d0){return![];}}async['modifyMjInspireClassify'](_0x2a2954){const _0x94e12c=_0x1fa71c,{id:_0x2f10de,name:_0x535186,value:_0x112f80}=_0x2a2954;return await this[_0x94e12c(0x248)][_0x94e12c(0x1d8)](_0x2f10de,{'name':_0x535186,'value':_0x112f80})[_0x94e12c(0x2d6)](_0x576b94=>!!_0x576b94);}async[_0x1fa71c(0x1d0)](_0x1c2039){const _0x53e004=_0x1fa71c,{id:_0x5ceffe}=_0x1c2039;return await this[_0x53e004(0x248)][_0x53e004(0x2b0)]({'id':_0x5ceffe})[_0x53e004(0x1cf)](_0x8e5793=>{const _0x4cb6d4=_0x53e004;throw new common_1['HttpException'](_0x8e5793,common_1[_0x4cb6d4(0x239)]['BAD_REQUEST']);});}async[_0x1fa71c(0x2ba)](_0x31e486){const _0x405681=_0x1fa71c,{size:_0x12d753,page:_0x28525a,saasId:_0x44fba8}=_0x31e486,_0x169553=(0x0,utils_1['getReqSaasId'])(this['clsService']),_0x3136dc={};(0x0,utils_1['isPlatform'])(this[_0x405681(0x151)])?(0x0,utils_1[_0x405681(0x18e)])(_0x44fba8)&&(_0x3136dc['saasId']=_0x44fba8):_0x3136dc[_0x405681(0x2a9)]=_0x169553;const _0xa847d5=await this[_0x405681(0x248)][_0x405681(0x18a)]({'where':_0x3136dc,'order':{'createdAt':_0x405681(0x26c)},'take':_0x12d753,'skip':(_0x28525a-0x1)*_0x12d753})['catch'](_0x553456=>{const _0x2b9fac=_0x405681;throw new common_1['HttpException'](_0x553456,common_1[_0x2b9fac(0x239)][_0x2b9fac(0x206)]);});if(!_0xa847d5)throw new common_1[(_0x405681(0xff))]('查询灵感分类失败',common_1['HttpStatus'][_0x405681(0x206)]);const [_0x125d90,_0x2194ef]=_0xa847d5;return{'rows':_0x125d90,'count':_0x2194ef};}async[_0x1fa71c(0x20a)](_0x391459){const _0x513d0d=_0x1fa71c,{id:_0x239fc9}=_0x391459;return await this[_0x513d0d(0x248)][_0x513d0d(0x13e)]({'where':{'id':_0x239fc9}});}async[_0x1fa71c(0x256)](_0x241bdb){const _0x3eb8a5=_0x1fa71c;try{const _0x6aaf2c=(0x0,utils_1[_0x3eb8a5(0x1b0)])(this['clsService']),{classifyName:_0x7a3e98,level:_0x26fac0,type:_0x35b932,pid:pid=0x0}=_0x241bdb;return await this[_0x3eb8a5(0x172)][_0x3eb8a5(0x2d5)]({'classifyName':_0x7a3e98,'level':_0x26fac0,'type':_0x35b932,'pid':pid,'saasId':_0x6aaf2c})[_0x3eb8a5(0x2d6)](_0x42077f=>!!_0x42077f)[_0x3eb8a5(0x1cf)](_0x36cf91=>{const _0x29ef5a=_0x3eb8a5;console['log'](_0x36cf91);throw new common_1[(_0x29ef5a(0xff))](_0x36cf91,common_1['HttpStatus'][_0x29ef5a(0x206)]);});}catch(_0x2428aa){return![];}}async[_0x1fa71c(0x156)](_0x5e4767){const _0x4a23b3=_0x1fa71c,{id:_0x1fdb31,classifyName:_0x58d9a6,level:_0x2831f2,type:_0x2fb517,pid:_0x14b61f}=_0x5e4767;return this[_0x4a23b3(0x1f7)]['transaction'](async()=>{const _0x453d52=_0x4a23b3,_0x23e9f2=await this[_0x453d52(0x172)][_0x453d52(0x13e)]({'where':{'id':_0x1fdb31}});_0x23e9f2['type']!==_0x2fb517&&await this[_0x453d52(0x172)][_0x453d52(0x1d8)]({'pid':_0x1fdb31},{'type':_0x2fb517}),await this[_0x453d52(0x172)]['update'](_0x1fdb31,{'classifyName':_0x58d9a6,'level':_0x2831f2,'type':_0x2fb517,'pid':_0x14b61f});}),!![];}async[_0x1fa71c(0x1c8)](_0xe672c0){const _0xff792e=_0x1fa71c,{id:_0x390030}=_0xe672c0;return await this[_0xff792e(0x172)][_0xff792e(0x2b0)]({'id':_0x390030})[_0xff792e(0x2d6)](_0x1b44e9=>_0x1b44e9[_0xff792e(0x150)]>0x0);}async[_0x1fa71c(0x1f8)](_0x541ad7){const _0x49a217=_0x1fa71c,{id:_0x23b635}=_0x541ad7;return await this[_0x49a217(0x172)][_0x49a217(0x13e)]({'where':{'id':_0x23b635}});}async[_0x1fa71c(0x1e5)](){const _0x589e18=_0x1fa71c,_0x2414ee=(0x0,utils_1['getReqSaasId'])(this[_0x589e18(0x151)]);return this['mjIncantationClassifyEntity'][_0x589e18(0x1b4)]({'where':{'level':0x1,'saasId':_0x2414ee}});}async[_0x1fa71c(0x26f)](_0x31c1fa){const _0x38a78d=_0x1fa71c,{size:_0xdf63c1,page:_0x510383,type:_0x18004c,keyword:_0xd29c3a,level:_0x4bec5b,saasId:_0x2b5c86}=_0x31c1fa,_0x8569de=(0x0,utils_1[_0x38a78d(0x1b0)])(this[_0x38a78d(0x151)]);let _0x1c320a={};_0x4bec5b>0x0&&(_0x1c320a['level']=_0x4bec5b);_0x18004c&&(_0x1c320a[_0x38a78d(0x169)]=_0x18004c);_0xd29c3a&&(_0x1c320a[_0x38a78d(0x117)]=(0x0,typeorm_2[_0x38a78d(0x2c0)])('%'+_0xd29c3a+'%'));(0x0,utils_1[_0x38a78d(0x21b)])(this[_0x38a78d(0x151)])?(0x0,utils_1[_0x38a78d(0x18e)])(_0x2b5c86)&&(_0x1c320a['saasId']=_0x2b5c86):_0x1c320a['saasId']=_0x8569de;const _0x56dcd7=await this[_0x38a78d(0x172)]['findAndCount']({'order':{'createdAt':_0x38a78d(0x26c)},'where':_0x1c320a,'take':_0xdf63c1,'skip':(_0x510383-0x1)*_0xdf63c1})[_0x38a78d(0x1cf)](_0x2b818b=>{const _0x2f2c8c=_0x38a78d;console[_0x2f2c8c(0x115)](_0x2b818b);});if(!_0x56dcd7)throw new common_1[(_0x38a78d(0xff))](_0x38a78d(0x1bd),common_1[_0x38a78d(0x239)][_0x38a78d(0x206)]);const [_0x5c36a0,_0x28d71c]=_0x56dcd7;return{'rows':_0x5c36a0,'count':_0x28d71c};}async[_0x1fa71c(0x1cc)](_0x956ab0){const _0x638507=_0x1fa71c,{level:_0x29f2fa,type:_0x4d509e,saasId:_0x48afa0}=_0x956ab0,_0x447620=(0x0,utils_1[_0x638507(0x1b0)])(this[_0x638507(0x151)]),_0x238043={};_0x29f2fa===0x0?_0x238043[_0x638507(0x182)]=(0x0,typeorm_2['MoreThan'])(_0x29f2fa):_0x238043[_0x638507(0x182)]=_0x29f2fa;_0x4d509e&&(_0x238043[_0x638507(0x169)]=_0x4d509e);(0x0,utils_1[_0x638507(0x21b)])(this[_0x638507(0x151)])?(0x0,utils_1[_0x638507(0x18e)])(_0x48afa0)&&(_0x238043[_0x638507(0x2a9)]=_0x48afa0):_0x238043['saasId']=_0x447620;const _0x3041a8=await this[_0x638507(0x172)][_0x638507(0x1fd)](_0x238043)[_0x638507(0x1cf)](_0x3f6efb=>{const _0x34ea8c=_0x638507;console[_0x34ea8c(0x115)](_0x3f6efb);});if(!_0x3041a8)throw new common_1[(_0x638507(0xff))](_0x638507(0x1bd),common_1[_0x638507(0x239)][_0x638507(0x206)]);if(_0x29f2fa===0x0)return{'level1':_0x3041a8[_0x638507(0x138)](_0x374d79=>_0x374d79[_0x638507(0x182)]===0x1),'level2':_0x3041a8[_0x638507(0x138)](_0x8146df=>_0x8146df['level']===0x2)};return _0x3041a8;}async[_0x1fa71c(0x1c2)](_0x193285){const _0x3fa2fc=_0x1fa71c;try{const _0x2c40b5=(0x0,utils_1[_0x3fa2fc(0x1b0)])(this[_0x3fa2fc(0x151)]),{incantationEn:_0x4e9c13,incantationCn:_0x19b151,img:_0x38ccf1,pid:_0x49d92a}=_0x193285;return await this[_0x3fa2fc(0x2ca)][_0x3fa2fc(0x2d5)]({'incantationEn':_0x4e9c13,'incantationCn':_0x19b151,'img':_0x38ccf1,'pid':_0x49d92a,'saasId':_0x2c40b5})[_0x3fa2fc(0x2d6)](_0x33f40d=>!!_0x33f40d)[_0x3fa2fc(0x1cf)](_0x9c71b4=>{throw _0x9c71b4;});}catch(_0x33cf5d){return console[_0x3fa2fc(0x115)](_0x33cf5d),![];}}async['modifyMjIncantation'](_0x527c61){const _0x20e536=_0x1fa71c,{id:_0x2bc52b,incantationEn:_0x166bbe,incantationCn:_0x47742d,img:_0x5929bb,pid:_0x2155d3}=_0x527c61;return await this[_0x20e536(0x2ca)]['update'](_0x2bc52b,{'incantationCn':_0x47742d,'incantationEn':_0x166bbe,'img':_0x5929bb,'pid':_0x2155d3});}async[_0x1fa71c(0x163)](_0x205163){const _0x50a1c0=_0x1fa71c,{id:_0x2ccaf9}=_0x205163;return await this[_0x50a1c0(0x2ca)]['delete']({'id':_0x2ccaf9})[_0x50a1c0(0x2d6)](_0x18c34e=>_0x18c34e[_0x50a1c0(0x150)]>0x0);}async['getMjIncantation'](_0x147542){const _0x80ad26=_0x1fa71c,{id:_0x541c86}=_0x147542;return await this['mjIncantationEntity'][_0x80ad26(0x13e)]({'where':{'id':_0x541c86}});}async[_0x1fa71c(0x210)](_0x264554){const _0x3ed87e=_0x1fa71c,_0x41d887=(0x0,utils_1[_0x3ed87e(0x1b0)])(this[_0x3ed87e(0x151)]),{size:_0x3d3165,page:_0x4669a5,keyword:_0x53c961,pid:_0x8a7636,saasId:_0x4e7694}=_0x264554;let _0x4caece={};_0x8a7636>0x0&&(_0x4caece[_0x3ed87e(0x1dc)]=_0x8a7636);_0x53c961&&(_0x4caece[_0x3ed87e(0x291)]=(0x0,typeorm_2[_0x3ed87e(0x2c0)])('%'+_0x53c961+'%'));(0x0,utils_1[_0x3ed87e(0x21b)])(this[_0x3ed87e(0x151)])?(0x0,utils_1[_0x3ed87e(0x18e)])(_0x4e7694)&&(_0x4caece[_0x3ed87e(0x2a9)]=_0x4e7694):_0x4caece[_0x3ed87e(0x2a9)]=_0x41d887;const _0x57b2c6=await this[_0x3ed87e(0x2ca)][_0x3ed87e(0x18a)]({'order':{'createdAt':_0x3ed87e(0x26c)},'where':_0x4caece,'take':_0x3d3165,'skip':(_0x4669a5-0x1)*_0x3d3165})[_0x3ed87e(0x1cf)](_0xf906e4=>{console['log'](_0xf906e4);});if(!_0x57b2c6)throw new common_1[(_0x3ed87e(0xff))]('查询咒语失败',common_1[_0x3ed87e(0x239)][_0x3ed87e(0x206)]);const [_0x5e0883,_0x1a384f]=_0x57b2c6;return{'rows':_0x5e0883,'count':_0x1a384f};}async[_0x1fa71c(0x15e)](_0x28de06){const _0x5cd87a=_0x1fa71c,{id:_0x2b2bd9}=_0x28de06,_0x582c91=await this[_0x5cd87a(0x172)][_0x5cd87a(0x13e)]({'where':{'level':0x1,'id':_0x2b2bd9}})[_0x5cd87a(0x1cf)](_0x56ce50=>{const _0x92a885=_0x5cd87a;common_1[_0x92a885(0x225)][_0x92a885(0x1b3)](_0x56ce50);});if(!_0x582c91)throw new common_1[(_0x5cd87a(0xff))]('未查询到咒语一级分类',common_1[_0x5cd87a(0x239)]['BAD_REQUEST']);const _0x7644b2=await this['mjIncantationClassifyEntity']['find']({'where':{'level':0x2,'pid':_0x582c91['id']}})[_0x5cd87a(0x1cf)](_0x47d7ca=>{const _0xb69311=_0x5cd87a;common_1['Logger'][_0xb69311(0x1b3)](_0x47d7ca);});if(!_0x7644b2||_0x7644b2[_0x5cd87a(0x171)]===0x0)return{'rows':[]};const _0x1bee8f=_0x7644b2[_0x5cd87a(0x178)](_0x50521f=>_0x50521f['id']),_0x368c84=await this[_0x5cd87a(0x2ca)][_0x5cd87a(0x1b4)]({'where':{'pid':(0x0,typeorm_2['In'])(_0x1bee8f)}})['catch'](_0x213359=>{const _0x808891=_0x5cd87a;common_1[_0x808891(0x225)][_0x808891(0x1b3)](_0x213359);});if(!_0x368c84)throw new common_1[(_0x5cd87a(0xff))](_0x5cd87a(0x19f),common_1[_0x5cd87a(0x239)][_0x5cd87a(0x206)]);const _0x511b68=_0x7644b2[_0x5cd87a(0x178)](_0x3d7d2d=>{const _0x486aa7=_0x5cd87a;return{'children':_0x368c84[_0x486aa7(0x138)](_0x4e50f0=>_0x4e50f0[_0x486aa7(0x1dc)]===_0x3d7d2d['id'])||[],..._0x3d7d2d};});return{'rows':_0x511b68};}async[_0x1fa71c(0x197)](){const _0x6d1535=_0x1fa71c,_0x450400=(0x0,utils_1['getReqSaasId'])(this[_0x6d1535(0x151)]),_0x417dab=await this[_0x6d1535(0x2ca)][_0x6d1535(0x1b4)]({'where':{'saasId':_0x450400},'order':{'createdAt':_0x6d1535(0x26c)}})['catch'](_0x2f51d3=>{console['log'](_0x2f51d3);});if(!_0x417dab)throw new common_1[(_0x6d1535(0xff))](_0x6d1535(0x19f),common_1[_0x6d1535(0x239)]['BAD_REQUEST']);return _0x417dab;}async[_0x1fa71c(0xf9)](_0x38d48c){const _0x55598a=_0x1fa71c,_0x3cbed0=(0x0,utils_1[_0x55598a(0x1b0)])(this[_0x55598a(0x151)]),{id:_0x5b503e,suggestCn:_0x3b1df8,suggestEn:_0x4cf75c,order:_0x4dec03,image:_0x50504f}=_0x38d48c,_0x29e339=await this[_0x55598a(0x268)][_0x55598a(0x13e)]({'where':{'suggestCn':_0x3b1df8,'saasId':_0x3cbed0}});if(_0x5b503e){if(_0x29e339&&_0x29e339['id']!==_0x5b503e)throw new common_1['HttpException']('推荐关键词已存在，不可重复添加',common_1[_0x55598a(0x239)][_0x55598a(0x206)]);}else{if(_0x29e339)throw new common_1[(_0x55598a(0xff))](_0x55598a(0x194),common_1[_0x55598a(0x239)][_0x55598a(0x206)]);}const _0x48a915=await this[_0x55598a(0x268)]['save']({'id':_0x5b503e,'suggestCn':_0x3b1df8,'suggestEn':_0x4cf75c,'order':_0x4dec03||0x64,'image':_0x50504f||'','saasId':_0x3cbed0})['then'](_0x1d6109=>!!_0x1d6109['id'])[_0x55598a(0x1cf)](_0x20abb1=>{const _0x18fb2e=_0x55598a;console[_0x18fb2e(0x115)](_0x20abb1);});if(!_0x48a915)throw new common_1[(_0x55598a(0xff))](_0x55598a(0x255),common_1[_0x55598a(0x239)][_0x55598a(0x206)]);return _0x48a915;}async[_0x1fa71c(0x28e)](_0xce34f2){const _0xa2bee7=_0x1fa71c,{id:_0x57c319}=_0xce34f2,_0x3940b0=await this[_0xa2bee7(0x268)][_0xa2bee7(0x216)]({'where':{'id':_0x57c319}});if(!_0x3940b0)throw new common_1['HttpException'](_0xa2bee7(0x28c),common_1[_0xa2bee7(0x239)]['BAD_REQUEST']);const _0x2c91ef=await this[_0xa2bee7(0x268)][_0xa2bee7(0x2b0)](_0x57c319)['then'](_0x57f424=>_0x57f424[_0xa2bee7(0x150)]>0x0)[_0xa2bee7(0x1cf)](_0x25c9e4=>{const _0xb82562=_0xa2bee7;console[_0xb82562(0x115)](_0x25c9e4);});if(!_0x2c91ef)throw new common_1[(_0xa2bee7(0xff))]('删除推荐关键词失败',common_1[_0xa2bee7(0x239)]['BAD_REQUEST']);return _0x2c91ef;}async[_0x1fa71c(0x187)](_0x441f98){const _0x44fd9e=_0x1fa71c;let _0x289e92={};const {page:_0x470c68,size:_0x3b3e3c,saasId:_0x4f8ca8}=_0x441f98,_0x24d622=(0x0,utils_1[_0x44fd9e(0x1b0)])(this[_0x44fd9e(0x151)]);(0x0,utils_1[_0x44fd9e(0x21b)])(this[_0x44fd9e(0x151)])?(0x0,utils_1[_0x44fd9e(0x18e)])(_0x4f8ca8)&&(_0x289e92[_0x44fd9e(0x2a9)]=_0x4f8ca8):_0x289e92[_0x44fd9e(0x2a9)]=_0x24d622;const _0x122736=await this[_0x44fd9e(0x268)][_0x44fd9e(0x18a)]({'where':_0x289e92,'take':_0x3b3e3c,'skip':(_0x470c68-0x1)*_0x3b3e3c,'order':{'order':_0x44fd9e(0x26c)}})[_0x44fd9e(0x2d6)](([_0xbf8941,_0x335dbc])=>({'rows':_0xbf8941,'count':_0x335dbc}))[_0x44fd9e(0x1cf)](_0x41c45e=>{console['log'](_0x41c45e);});if(!_0x122736)throw new common_1[(_0x44fd9e(0xff))](_0x44fd9e(0x1be),common_1[_0x44fd9e(0x239)][_0x44fd9e(0x206)]);return _0x122736;}async[_0x1fa71c(0x11d)](_0x19198e){const _0x954b69=_0x1fa71c,_0x4d1e2d=await this[_0x954b69(0x147)]({'rec':_0x19198e[_0x954b69(0x209)],'page':_0x19198e[_0x954b69(0x2c8)],'size':_0x19198e[_0x954b69(0x23f)],'status':_0x19198e[_0x954b69(0x10f)],'keyword':_0x19198e[_0x954b69(0x1d1)],'squareType':_0x19198e['squareType']});return _0x4d1e2d[_0x954b69(0x185)]['forEach'](_0x38568a=>{const _0x40298c=_0x954b69;_0x38568a[_0x40298c(0x1e8)]=_0x38568a['fileInfo']?JSON['parse'](_0x38568a[_0x40298c(0x1e8)]):{};}),_0x4d1e2d;}[_0x1fa71c(0x180)](_0x2cf228){const _0x3457fb=_0x1fa71c;if(!_0x2cf228)return'fast';if(_0x2cf228===midjourney_constant_1['DrawSpeed'][_0x3457fb(0x193)])return _0x3457fb(0x193);if(_0x2cf228===midjourney_constant_1[_0x3457fb(0x2b4)][_0x3457fb(0x265)])return _0x3457fb(0x265);if(_0x2cf228===midjourney_constant_1['DrawSpeed'][_0x3457fb(0x1cb)])return _0x3457fb(0x1cb);return _0x3457fb(0x193);}async[_0x1fa71c(0x258)](){const _0x46b855=_0x1fa71c;if(process[_0x46b855(0x1d3)][_0x46b855(0x18f)]===_0x46b855(0x157))return;try{const _0x619af4=await this[_0x46b855(0x176)]['workflowDicts']({});for(let _0x1f7807 in _0x619af4){let _0xb58061=_0x1f7807;for(let _0x42cdef=0x0;_0x42cdef<_0x619af4[_0x1f7807][_0x46b855(0x171)];_0x42cdef++){const _0x3129b8=_0x619af4[_0x1f7807][_0x42cdef];let _0x3d4d8b=await this[_0x46b855(0x200)][_0x46b855(0x19a)](_0xb58061,String(_0x3129b8['id']));_0x3d4d8b?(_0x3d4d8b['dictType']=_0xb58061,_0x3d4d8b['dictName']=_0x3129b8['name'],_0x3d4d8b[_0x46b855(0x2bf)]=String(_0x3129b8['id'])):_0x3d4d8b={'dictType':_0xb58061,'dictName':_0x3129b8[_0x46b855(0x271)],'dictValue':String(_0x3129b8['id'])},await this[_0x46b855(0x200)][_0x46b855(0x207)](_0x3d4d8b);}}common_1[_0x46b855(0x225)][_0x46b855(0x115)](_0x46b855(0x113));}catch(_0x405060){common_1[_0x46b855(0x225)][_0x46b855(0x1b3)](_0x405060,_0x46b855(0x260));}}async['syncModelsByTag'](_0xd0aaf8){const _0x4dd4f2=_0x1fa71c;let _0x1a89c2=[];try{const _0x41191e=await this['czTaskService']['modelPage']({'data':{'size':0x32,'index':0x1,'tagIds':[_0xd0aaf8]}});_0x1a89c2=_0x1a89c2[_0x4dd4f2(0x10b)](_0x41191e[_0x4dd4f2(0x1ea)]);for(let _0x5279c6=0x2;_0x5279c6<=_0x41191e[_0x4dd4f2(0x1a3)];_0x5279c6++){const _0x12fa12=await this[_0x4dd4f2(0x176)]['modelPage']({'data':{'index':_0x5279c6,'size':0x32,'tagIds':[_0xd0aaf8]}});_0x1a89c2=_0x1a89c2[_0x4dd4f2(0x10b)](_0x12fa12['datas']);}return _0x1a89c2;}catch(_0x530c8e){return common_1[_0x4dd4f2(0x225)]['error'](_0x530c8e,_0x4dd4f2(0x22e)),[];}}async[_0x1fa71c(0xf8)](){const _0xe033fb=_0x1fa71c;if(process[_0xe033fb(0x1d3)]['ENV']===_0xe033fb(0x157))return;try{const _0x5d3aae=await this[_0xe033fb(0x200)][_0xe033fb(0x2aa)]([_0xe033fb(0xfc),_0xe033fb(0x1a5),_0xe033fb(0x1eb),_0xe033fb(0x2cd)]),_0x6908e0=new Map(),_0x16d0a6=await this[_0xe033fb(0x1c5)][_0xe033fb(0x1b4)]();_0x16d0a6['forEach'](_0x3f3e75=>_0x6908e0[_0xe033fb(0x1a8)](_0x3f3e75['id'],_0x3f3e75));for(let _0x5046c7=0x0;_0x5046c7<_0x5d3aae[_0xe033fb(0x171)];_0x5046c7++){const _0x76ca5f=_0x5d3aae[_0x5046c7][_0xe033fb(0x27e)],_0x1bed30=Number(_0x5d3aae[_0x5046c7][_0xe033fb(0x2bf)]),_0x1e8ca0=await this[_0xe033fb(0x17f)](_0x1bed30);_0x1e8ca0[_0xe033fb(0x2ce)](_0x479ffb=>{const _0x167346=_0xe033fb,_0x5cd70d=String(_0x479ffb['id']);!_0x6908e0[_0x167346(0x21f)](_0x5cd70d)&&_0x6908e0[_0x167346(0x1a8)](_0x5cd70d,{'id':_0x5cd70d,'type':_0x479ffb[_0x167346(0x241)],'name':_0x479ffb[_0x167346(0x271)],'cover':_0x167346(0x1f1)+_0x479ffb[_0x167346(0x22a)],'version':_0x479ffb['modelVersion'],'description':'','triggerWords':_0x479ffb['triggerWords']});const _0x1ddd11=_0x6908e0[_0x167346(0x285)](_0x5cd70d);_0x5d3aae[_0x5046c7][_0x167346(0x10e)]===_0x167346(0xfc)&&(_0x1ddd11[_0x167346(0xfc)]=_0x1bed30,_0x1ddd11['styleName']=_0x76ca5f),_0x5d3aae[_0x5046c7][_0x167346(0x10e)]==='effect_category'&&(_0x1ddd11[_0x167346(0x1f4)]=_0x1bed30,_0x1ddd11[_0x167346(0x24d)]=_0x76ca5f),_0x5d3aae[_0x5046c7]['dictType']===_0x167346(0x1eb)&&(_0x1ddd11['effectMainBody']=_0x1bed30,_0x1ddd11[_0x167346(0x2e1)]=_0x76ca5f),_0x5d3aae[_0x5046c7]['dictType']===_0x167346(0x2cd)&&(_0x1ddd11[_0x167346(0x107)]=_0x1bed30,_0x1ddd11[_0x167346(0x19e)]=_0x76ca5f);});}await this[_0xe033fb(0x1c5)][_0xe033fb(0x2d5)](Array['from'](_0x6908e0[_0xe033fb(0x140)]())),common_1[_0xe033fb(0x225)][_0xe033fb(0x115)]('触站::模型信息同步完成');}catch(_0x5f2c85){common_1[_0xe033fb(0x225)][_0xe033fb(0x1b3)](_0x5f2c85,'触站::模型信息同步失败');}}async['syncTaskInfo'](_0x1d9b91){const _0x7a30c2=_0x1fa71c,_0x4583c3=await this[_0x7a30c2(0x223)]['listByCondition']({'data':{'ids':[_0x1d9b91]}});common_1[_0x7a30c2(0x225)][_0x7a30c2(0x115)](_0x7a30c2(0x175)),this[_0x7a30c2(0x129)](_0x4583c3[0x0]);}async[_0x1fa71c(0x28b)](_0x1292b0){const _0x9dc547=_0x1fa71c,_0x17caf4=await this['userService'][_0x9dc547(0x105)](_0x1292b0['user']['id']),_0x2e16e8={'fast':0x0,'relax':0x0,'trubo':0x0};let _0x13d660=redisKey_constant_1[_0x9dc547(0x14c)]+'-'+_0x17caf4['id']+'-';if(_0x17caf4['vipExpire']||_0x17caf4[_0x9dc547(0x1c3)]){const [_0x56a7dc,_0x567d9c,_0xbc5f87]=await Promise['all']([this[_0x9dc547(0x1a7)]['get']({'key':_0x13d660+_0x9dc547(0x290)}),this[_0x9dc547(0x1a7)][_0x9dc547(0x285)]({'key':_0x13d660+_0x9dc547(0x137)}),this['redisCacheService'][_0x9dc547(0x285)]({'key':_0x13d660+_0x9dc547(0x231)})]);_0x2e16e8[_0x9dc547(0x193)]=Number(_0x56a7dc||0x0),_0x2e16e8[_0x9dc547(0x265)]=Number(_0x567d9c||0x0),_0x2e16e8['trubo']=Number(_0xbc5f87||0x0);}return _0x2e16e8;}['parseMjStatus'](_0x219735){const _0x2b5052=_0x1fa71c;if(typeof _0x219735===_0x2b5052(0x1ac))return midjourney_constant_1[_0x2b5052(0x1bc)][_0x2b5052(0x285)](_0x219735);if(typeof _0x219735==='number')return midjourney_constant_1[_0x2b5052(0x16e)][_0x2b5052(0x285)](_0x219735);}async[_0x1fa71c(0x129)](_0x2f7b2a){const _0x4ef2a5=_0x1fa71c;common_1['Logger'][_0x4ef2a5(0x115)](_0x2f7b2a,_0x4ef2a5(0x13c));try{let _0x560190=[];const _0x4b0096=this[_0x4ef2a5(0x1e4)](_0x2f7b2a[_0x4ef2a5(0x10f)]),_0x2706fc=_0x2f7b2a[_0x4ef2a5(0x11f)]?parseFloat(_0x2f7b2a['progress']):null;let _0x57b86a=await this['midjourneyEntity'][_0x4ef2a5(0x13e)]({'where':{'mjpTaskId':_0x2f7b2a['id']}});if(_0x2f7b2a[_0x4ef2a5(0x10f)]===_0x4ef2a5(0x1b2)&&_0x57b86a[_0x4ef2a5(0x262)]){common_1[_0x4ef2a5(0x225)][_0x4ef2a5(0x115)](_0x4ef2a5(0x16c),_0x4ef2a5(0x21d));return;}_0x2f7b2a[_0x4ef2a5(0x173)]&&(_0x560190=_0x2f7b2a[_0x4ef2a5(0x173)][_0x4ef2a5(0x138)](_0x12e042=>_0x12e042[_0x4ef2a5(0x26a)]!==_0x4ef2a5(0x2d7)&&_0x12e042[_0x4ef2a5(0x251)]!=='❤️'));store_1[_0x4ef2a5(0x2c2)]['mjProxyImgUrl']&&_0x2f7b2a[_0x4ef2a5(0x1b1)]&&(_0x2f7b2a[_0x4ef2a5(0x1b1)]=_0x2f7b2a[_0x4ef2a5(0x1b1)][_0x4ef2a5(0x233)](_0x4ef2a5(0x14a),store_1[_0x4ef2a5(0x2c2)][_0x4ef2a5(0x273)]));const _0x375112={'id':_0x57b86a['id'],'status':_0x4b0096,'progress':_0x2706fc,'buttons':_0x560190,'durationSpent':null,'imageUrl':_0x2f7b2a[_0x4ef2a5(0x1b1)],'failReason':_0x2f7b2a['failReason']};return(_0x2f7b2a[_0x4ef2a5(0x279)]===_0x4ef2a5(0x1c4)||_0x2f7b2a[_0x4ef2a5(0x279)]===0x4)&&(_0x375112[_0x4ef2a5(0x12c)]=_0x2f7b2a[_0x4ef2a5(0x25f)]||_0x2f7b2a[_0x4ef2a5(0x257)]?.[_0x4ef2a5(0x25f)],_0x375112[_0x4ef2a5(0x243)]=_0x2f7b2a[_0x4ef2a5(0x25f)]||_0x2f7b2a['properties']?.[_0x4ef2a5(0x25f)]),_0x2f7b2a['finishTime']&&_0x2f7b2a[_0x4ef2a5(0x181)]&&(_0x375112[_0x4ef2a5(0x16f)]=(_0x2f7b2a[_0x4ef2a5(0x190)]-_0x2f7b2a[_0x4ef2a5(0x181)])/0x3e8),_0x57b86a=await this[_0x4ef2a5(0x211)][_0x4ef2a5(0x2d5)](_0x375112),_0x2f7b2a[_0x4ef2a5(0x10f)]==='SUCCESS'&&_0x57b86a['imageUrl']&&this[_0x4ef2a5(0x282)][_0x4ef2a5(0x2b7)](_0x57b86a['id'],_0x57b86a[_0x4ef2a5(0x1b1)]),null;}catch(_0x4e6301){common_1[_0x4ef2a5(0x225)][_0x4ef2a5(0x1b3)](_0x4ef2a5(0x2a4),_0x4e6301);}}async[_0x1fa71c(0x20d)](_0x2585ec){const _0x51d041=_0x1fa71c;common_1[_0x51d041(0x225)][_0x51d041(0x115)](_0x2585ec,_0x51d041(0x286));try{const _0x1b1f52=midjourney_constant_1[_0x51d041(0x2e0)]['get'](_0x2585ec['state']),_0x2a3e77=Number(_0x2585ec[_0x51d041(0x11f)])*0x64;let _0x4d9894=await this['midjourneyEntity']['findOne']({'where':{'mjpTaskId':_0x2585ec[_0x51d041(0x2b5)]}});const _0x469f3c={'id':_0x4d9894['id'],'status':_0x1b1f52,'progress':_0x2a3e77,'imageUrl':_0x2585ec[_0x51d041(0x250)]?.['map'](_0x4b2e21=>_0x4b2e21[_0x51d041(0x10a)])[_0x51d041(0x112)]('↢↣')};return _0x4d9894=await this[_0x51d041(0x211)][_0x51d041(0x2d5)](_0x469f3c),_0x4d9894[_0x51d041(0x10f)]===0x3&&_0x4d9894[_0x51d041(0x1b1)]&&this[_0x51d041(0x282)][_0x51d041(0x2b7)](_0x4d9894['id'],_0x4d9894[_0x51d041(0x1b1)]),null;}catch(_0x179d78){common_1['Logger'][_0x51d041(0x1b3)](_0x51d041(0x165),_0x179d78);}}async['notifySD'](_0x2bcb21){const _0x303dee=_0x1fa71c;common_1[_0x303dee(0x225)][_0x303dee(0x115)](_0x2bcb21,_0x303dee(0x122));try{const _0x16be08=midjourney_constant_1[_0x303dee(0x2e0)][_0x303dee(0x285)](_0x2bcb21[_0x303dee(0x212)]),_0x16b755=Number(_0x2bcb21[_0x303dee(0x11f)])*0x64;let _0x334e25=await this[_0x303dee(0x211)][_0x303dee(0x13e)]({'where':{'mjpTaskId':_0x2bcb21[_0x303dee(0x2b5)]}});const _0x36c40b={'id':_0x334e25['id'],'status':_0x16be08,'progress':_0x16b755,'imageUrl':_0x2bcb21['images']?.['map'](_0x525e41=>_0x525e41['imageUrl'])[_0x303dee(0x112)]('↢↣')};return _0x334e25=await this[_0x303dee(0x211)][_0x303dee(0x2d5)](_0x36c40b),_0x334e25[_0x303dee(0x10f)]===0x3&&_0x334e25[_0x303dee(0x1b1)]&&this['fileService'][_0x303dee(0x2b7)](_0x334e25['id'],_0x334e25['imageUrl']),null;}catch(_0x46fbaf){common_1[_0x303dee(0x225)][_0x303dee(0x1b3)](_0x303dee(0x165),_0x46fbaf);}}async[_0x1fa71c(0x253)](){const _0xb06ae=_0x1fa71c;this['syncMjTask'](),this[_0xb06ae(0x1da)](),this[_0xb06ae(0x186)]();}async[_0x1fa71c(0x218)](){const _0x4f9c30=_0x1fa71c;try{const _0x209c72=await this[_0x4f9c30(0x211)][_0x4f9c30(0x1b4)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6]),'botType':(0x0,typeorm_2['In'])([DrawTaskPage_dto_1['EBotType'][_0x4f9c30(0x2b1)],DrawTaskPage_dto_1[_0x4f9c30(0x222)][_0x4f9c30(0x1c6)]])}});if(_0x209c72['length'])for(let _0x4893c5=0x0;_0x4893c5<_0x209c72[_0x4f9c30(0x171)];_0x4893c5++){const _0x52a6c5=redisKey_constant_1[_0x4f9c30(0x1ad)]+_0x209c72[_0x4893c5][_0x4f9c30(0x26b)],_0x41be28=await this[_0x4f9c30(0x1a7)][_0x4f9c30(0x285)]({'key':_0x52a6c5});if(_0x41be28)continue;else this[_0x4f9c30(0x1a7)][_0x4f9c30(0x1a8)]({'key':_0x52a6c5,'val':_0x4f9c30(0x11b)}),this[_0x4f9c30(0x223)]['listByCondition']({'data':{'ids':[_0x209c72[_0x4893c5][_0x4f9c30(0x26b)]]}})['then'](async _0x4bebe7=>{const _0x2a52d1=_0x4f9c30,_0x55773c=_0x4bebe7[0x0],_0xa81754=_0x209c72[_0x4893c5],_0xbbb852=this[_0x2a52d1(0x1e4)](_0x55773c[_0x2a52d1(0x10f)]),_0xf3b4ed=_0x55773c[_0x2a52d1(0x11f)]?parseFloat(_0x55773c[_0x2a52d1(0x11f)]):null;if(_0xa81754['progress']===_0xf3b4ed&&_0xa81754[_0x2a52d1(0x10f)]===_0xbbb852){}else{const _0x2d0c95=_0x55773c[_0x2a52d1(0x173)][_0x2a52d1(0x138)](_0xb73525=>_0xb73525[_0x2a52d1(0x26a)]!==_0x2a52d1(0x1df)&&_0xb73525[_0x2a52d1(0x26a)]!==_0x2a52d1(0x2d7)&&_0xb73525[_0x2a52d1(0x251)]!=='❤️'),_0x18564b={'id':_0xa81754['id'],'mjpTaskId':_0x55773c['id'],'status':_0xbbb852,'progress':_0xf3b4ed,'buttons':_0x2d0c95,'durationSpent':null,'imageUrl':_0x55773c[_0x2a52d1(0x1b1)],'failReason':_0x55773c[_0x2a52d1(0x1f6)]};store_1[_0x2a52d1(0x2c2)]['mjProxyImgUrl']&&_0x18564b['imageUrl']&&(_0x18564b['imageUrl']=_0x18564b['imageUrl'][_0x2a52d1(0x233)]('https://cdn.discordapp.com',store_1[_0x2a52d1(0x2c2)][_0x2a52d1(0x273)])),(_0x55773c['action']==='DESCRIBE'||_0x55773c[_0x2a52d1(0x279)]===0x4)&&(_0x18564b[_0x2a52d1(0x12c)]=_0x55773c['finalPrompt']||_0x55773c[_0x2a52d1(0x257)]?.[_0x2a52d1(0x25f)],_0x18564b[_0x2a52d1(0x243)]=_0x55773c['finalPrompt']||_0x55773c[_0x2a52d1(0x257)]?.['finalPrompt']),_0x55773c[_0x2a52d1(0x190)]&&_0x55773c[_0x2a52d1(0x181)]&&(_0x18564b['durationSpent']=(_0x55773c[_0x2a52d1(0x190)]-_0x55773c[_0x2a52d1(0x181)])/0x3e8),await this[_0x2a52d1(0x211)]['save'](_0x18564b);}})[_0x4f9c30(0x1cf)](_0x321446=>{const _0x41ded9=_0x4f9c30;common_1[_0x41ded9(0x225)][_0x41ded9(0x1b3)]('mjTaskUpdateJob:\x20',_0x321446);})[_0x4f9c30(0x252)](()=>{this['redisCacheService']['del']({'key':_0x52a6c5});});}}catch(_0x1922de){}}async[_0x1fa71c(0x1da)](){const _0x197fe5=_0x1fa71c;try{const _0x169641=await this['midjourneyEntity']['find']({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'mjpTaskId':(0x0,typeorm_2['Not'])((0x0,typeorm_2[_0x197fe5(0x184)])()),'botType':DrawTaskPage_dto_1['EBotType'][_0x197fe5(0x2c4)]}});if(_0x169641[_0x197fe5(0x171)])for(let _0x55dac5=0x0;_0x55dac5<_0x169641[_0x197fe5(0x171)];_0x55dac5++){const _0x4ec569=redisKey_constant_1['MJ_TASK_UPDATE']+_0x169641[_0x55dac5]['mjpTaskId'],_0x2c59c3=await this[_0x197fe5(0x1a7)][_0x197fe5(0x285)]({'key':_0x4ec569});if(_0x2c59c3)continue;else{this[_0x197fe5(0x1a7)][_0x197fe5(0x1a8)]({'key':_0x4ec569,'val':_0x197fe5(0x11b)});try{const _0x904e52=await this[_0x197fe5(0x176)][_0x197fe5(0x17e)]({'data':{'taskId':_0x169641[_0x55dac5][_0x197fe5(0x26b)]}});this[_0x197fe5(0x20d)](_0x904e52);}catch(_0x216ff0){common_1[_0x197fe5(0x225)][_0x197fe5(0x1b3)](_0x197fe5(0x1f3),_0x216ff0);}finally{this[_0x197fe5(0x1a7)][_0x197fe5(0x26d)]({'key':_0x4ec569});}}}}catch(_0x263e12){}}async[_0x1fa71c(0x186)](){const _0x5bacb5=_0x1fa71c;try{const _0x30bd03=await this['midjourneyEntity'][_0x5bacb5(0x1b4)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'botType':DrawTaskPage_dto_1[_0x5bacb5(0x222)]['SD']}});if(_0x30bd03[_0x5bacb5(0x171)])for(let _0x24b42b=0x0;_0x24b42b<_0x30bd03[_0x5bacb5(0x171)];_0x24b42b++){const _0x2b9e87=redisKey_constant_1[_0x5bacb5(0x1ad)]+_0x30bd03[_0x24b42b][_0x5bacb5(0x26b)],_0x4df862=await this[_0x5bacb5(0x1a7)]['get']({'key':_0x2b9e87});if(_0x4df862)continue;else{this[_0x5bacb5(0x1a7)]['set']({'key':_0x2b9e87,'val':_0x5bacb5(0x11b)});try{const _0x1b35ef=await this['czTaskService'][_0x5bacb5(0xfb)]({'data':{'taskId':_0x30bd03[_0x24b42b]['mjpTaskId']}});this[_0x5bacb5(0x106)](_0x1b35ef);}catch(_0x6f969d){common_1[_0x5bacb5(0x225)]['error'](_0x5bacb5(0x11e),_0x6f969d);}finally{this[_0x5bacb5(0x1a7)][_0x5bacb5(0x26d)]({'key':_0x2b9e87});}}}}catch(_0x2793f6){}}async[_0x1fa71c(0x12a)](){const _0x257551=_0x1fa71c;if(store_1[_0x257551(0x2c2)]['mjNotSaveImg'])return;try{const _0x4af4e5=[{'status':0x3,'imageUrl':(0x0,typeorm_2['Like'])(_0x257551(0x1ec))}];store_1[_0x257551(0x2c2)][_0x257551(0x273)]&&_0x4af4e5['push']({'status':0x3,'imageUrl':(0x0,typeorm_2[_0x257551(0x2c0)])(store_1[_0x257551(0x2c2)][_0x257551(0x273)]+'%')});const _0x5aac26=await this[_0x257551(0x211)][_0x257551(0x1b4)]({'where':_0x4af4e5});if(_0x5aac26[_0x257551(0x171)])for(let _0x144ce3=0x0;_0x144ce3<_0x5aac26[_0x257551(0x171)];_0x144ce3++){let {id:_0x426e80,imageUrl:_0x58f23e}=_0x5aac26[_0x144ce3];this['fileService'][_0x257551(0x2b7)](_0x426e80,_0x58f23e);}}catch(_0x258bf8){common_1[_0x257551(0x225)][_0x257551(0x1b3)](_0x258bf8);}}async['batchTaskResult'](){const _0x33d9f2=_0x1fa71c;try{const _0x248c8d=store_1['MjConfig'][_0x33d9f2(0x281)]||0x5,_0x594c4d=[{'status':0x2,'progress':0x0,'updatedAt':(0x0,typeorm_2['LessThan'])(new Date(Date[_0x33d9f2(0x266)]()-_0x248c8d*0x3c*0x3e8))}],_0x32f179=await this[_0x33d9f2(0x211)][_0x33d9f2(0x1b4)]({'where':_0x594c4d});_0x32f179[_0x33d9f2(0x2ce)](_0x3eae22=>{const _0x5be13d=_0x33d9f2;_0x3eae22[_0x5be13d(0x1f6)]=_0x5be13d(0x199),_0x3eae22[_0x5be13d(0x10f)]=0x4,this[_0x5be13d(0x211)][_0x5be13d(0x2d5)](_0x3eae22),this[_0x5be13d(0x254)][_0x5be13d(0x2c6)](_0x3eae22[_0x5be13d(0x1c1)],_0x3eae22[_0x5be13d(0x29c)],_0x3eae22[_0x5be13d(0x14d)]||_0x5be13d(0x1e7),_0x3eae22['id']);});}catch(_0x470d8b){common_1[_0x33d9f2(0x225)][_0x33d9f2(0x1b3)](_0x470d8b);}}};MidjourneyService=__decorate([(0x0,common_1[_0x1fa71c(0x24f)])(),__param(0x0,(0x0,typeorm_1[_0x1fa71c(0x143)])(mjModel_entity_1[_0x1fa71c(0x1cd)])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(mjParam_entity_1[_0x1fa71c(0x221)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(mjPrompts_entity_1[_0x1fa71c(0x14e)])),__param(0x3,(0x0,typeorm_1[_0x1fa71c(0x143)])(midjourney_entity_1[_0x1fa71c(0x234)])),__param(0x4,(0x0,typeorm_1[_0x1fa71c(0x143)])(mjSuggestWord_entity_1['MjSuggestWordEntity'])),__param(0x5,(0x0,typeorm_1['InjectRepository'])(mjIncantation_entity_1[_0x1fa71c(0x128)])),__param(0x6,(0x0,typeorm_1['InjectRepository'])(mjInspireClassify_entity_1[_0x1fa71c(0x2dd)])),__param(0x7,(0x0,typeorm_1[_0x1fa71c(0x143)])(mjIncantationClassify_entity_1[_0x1fa71c(0x267)])),__metadata(_0x1fa71c(0x27d),[typeorm_2[_0x1fa71c(0x11a)],typeorm_2[_0x1fa71c(0x11a)],typeorm_2[_0x1fa71c(0x11a)],typeorm_2['Repository'],typeorm_2[_0x1fa71c(0x11a)],typeorm_2['Repository'],typeorm_2[_0x1fa71c(0x11a)],typeorm_2[_0x1fa71c(0x11a)],nestjs_cls_1[_0x1fa71c(0x270)],dict_service_1[_0x1fa71c(0x296)],user_service_1[_0x1fa71c(0x15d)],file_service_1[_0x1fa71c(0x203)],fanyi_service_1[_0x1fa71c(0x170)],aiLog_service_1[_0x1fa71c(0x1d4)],models_service_1[_0x1fa71c(0x2d9)],czTask_service_1[_0x1fa71c(0x201)],mjpTask_service_1[_0x1fa71c(0x2b9)],badwords_service_1['BadwordsService'],redisCache_service_1[_0x1fa71c(0x1fa)],mjpAccount_service_1[_0x1fa71c(0x12d)],globalConfig_service_1[_0x1fa71c(0x298)],typeorm_2['Connection']])],MidjourneyService),exports[_0x1fa71c(0x1db)]=MidjourneyService;