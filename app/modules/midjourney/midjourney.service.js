'use strict';const _0x26bd78=_0x4e88;(function(_0x3b5149,_0x1f0d7d){const _0x476db5=_0x4e88,_0x116f1c=_0x3b5149();while(!![]){try{const _0x52d8d8=-parseInt(_0x476db5(0x234))/0x1+parseInt(_0x476db5(0x1bf))/0x2*(parseInt(_0x476db5(0x12d))/0x3)+-parseInt(_0x476db5(0x243))/0x4*(parseInt(_0x476db5(0x1cd))/0x5)+parseInt(_0x476db5(0x285))/0x6*(parseInt(_0x476db5(0x295))/0x7)+parseInt(_0x476db5(0x205))/0x8*(parseInt(_0x476db5(0x16e))/0x9)+-parseInt(_0x476db5(0x21f))/0xa*(-parseInt(_0x476db5(0x21d))/0xb)+-parseInt(_0x476db5(0x2f3))/0xc;if(_0x52d8d8===_0x1f0d7d)break;else _0x116f1c['push'](_0x116f1c['shift']());}catch(_0x12606a){_0x116f1c['push'](_0x116f1c['shift']());}}}(_0x1d71,0xdcb79));var __decorate=this&&this[_0x26bd78(0x1bc)]||function(_0x2be469,_0x591e0b,_0x1a247a,_0x13b265){const _0x2caca8=_0x26bd78;var _0x9eee42=arguments['length'],_0x54e04a=_0x9eee42<0x3?_0x591e0b:_0x13b265===null?_0x13b265=Object[_0x2caca8(0x1ec)](_0x591e0b,_0x1a247a):_0x13b265,_0x161c95;if(typeof Reflect===_0x2caca8(0x1a5)&&typeof Reflect['decorate']==='function')_0x54e04a=Reflect['decorate'](_0x2be469,_0x591e0b,_0x1a247a,_0x13b265);else{for(var _0x2f83d5=_0x2be469[_0x2caca8(0x2a8)]-0x1;_0x2f83d5>=0x0;_0x2f83d5--)if(_0x161c95=_0x2be469[_0x2f83d5])_0x54e04a=(_0x9eee42<0x3?_0x161c95(_0x54e04a):_0x9eee42>0x3?_0x161c95(_0x591e0b,_0x1a247a,_0x54e04a):_0x161c95(_0x591e0b,_0x1a247a))||_0x54e04a;}return _0x9eee42>0x3&&_0x54e04a&&Object[_0x2caca8(0x1a4)](_0x591e0b,_0x1a247a,_0x54e04a),_0x54e04a;},__metadata=this&&this[_0x26bd78(0x12b)]||function(_0x293149,_0x416459){const _0xae7824=_0x26bd78;if(typeof Reflect===_0xae7824(0x1a5)&&typeof Reflect['metadata']===_0xae7824(0x146))return Reflect['metadata'](_0x293149,_0x416459);},__param=this&&this[_0x26bd78(0x1e0)]||function(_0xec7b5d,_0x2fffe8){return function(_0x5ccd0e,_0x47fc7b){_0x2fffe8(_0x5ccd0e,_0x47fc7b,_0xec7b5d);};};Object[_0x26bd78(0x1a4)](exports,'__esModule',{'value':!![]}),exports[_0x26bd78(0x24c)]=void 0x0;function _0x4e88(_0x359552,_0x1bea3e){const _0x1d71aa=_0x1d71();return _0x4e88=function(_0x4e887b,_0x4a247f){_0x4e887b=_0x4e887b-0x123;let _0x335f24=_0x1d71aa[_0x4e887b];return _0x335f24;},_0x4e88(_0x359552,_0x1bea3e);}const common_1=require('@nestjs/common'),typeorm_1=require(_0x26bd78(0x152)),midjourney_entity_1=require(_0x26bd78(0x144)),typeorm_2=require(_0x26bd78(0x2a6)),globalConfig_service_1=require(_0x26bd78(0x217)),midjourney_constant_1=require(_0x26bd78(0x179)),file_service_1=require(_0x26bd78(0x298)),badwords_service_1=require(_0x26bd78(0x1ed)),utils_1=require(_0x26bd78(0x27f)),mjPrompts_entity_1=require(_0x26bd78(0x2e6)),mjParam_entity_1=require('./mjParam.entity'),mjIncantationClassify_entity_1=require(_0x26bd78(0x18f)),mjInspireClassify_entity_1=require('./mjInspireClassify.entity'),mjIncantation_entity_1=require('./mjIncantation.entity'),fanyi_service_1=require(_0x26bd78(0x1c6)),mjSuggestWord_entity_1=require(_0x26bd78(0x2fe)),user_service_1=require('../user/user.service'),redisCache_service_1=require('../redisCache/redisCache.service'),mjpAccount_service_1=require(_0x26bd78(0x131)),mjpTask_service_1=require('../api/mjpTask.service'),addDrawQueue_dto_1=require('./dto/addDrawQueue.dto'),store_1=require(_0x26bd78(0x2b9)),redisKey_constant_1=require(_0x26bd78(0x163)),aiLog_service_1=require(_0x26bd78(0x1f5)),model_constant_1=require(_0x26bd78(0x2f8)),nestjs_cls_1=require(_0x26bd78(0x27e)),czTask_service_1=require('../api/czTask.service'),models_service_1=require(_0x26bd78(0x18a)),DrawTaskPage_dto_1=require(_0x26bd78(0x2c4)),user_constant_1=require(_0x26bd78(0x148)),dict_service_1=require('../dict/dict.service'),mjModel_entity_1=require('./mjModel.entity');let MidjourneyService=class MidjourneyService{constructor(_0x3431ff,_0x429c67,_0x32bebb,_0x340adf,_0x55a778,_0xc00cc8,_0x4fb60e,_0x54abfb,_0x31fe38,_0x27d64b,_0x384071,_0x15326e,_0x21eb47,_0x6945b7,_0x2fd64e,_0x3554e0,_0x461bf5,_0x3ff827,_0x527668,_0x221134,_0x2fd79e,_0x3edc7d){const _0x2e84be=_0x26bd78;this[_0x2e84be(0x247)]=_0x3431ff,this[_0x2e84be(0x1b1)]=_0x429c67,this[_0x2e84be(0x254)]=_0x32bebb,this['midjourneyEntity']=_0x340adf,this[_0x2e84be(0x268)]=_0x55a778,this['mjIncantationEntity']=_0xc00cc8,this['mjInspireClassifyEntity']=_0x4fb60e,this[_0x2e84be(0x1b5)]=_0x54abfb,this[_0x2e84be(0x2aa)]=_0x31fe38,this[_0x2e84be(0x12e)]=_0x27d64b,this['userService']=_0x384071,this[_0x2e84be(0x16a)]=_0x15326e,this[_0x2e84be(0x1ba)]=_0x21eb47,this['aiLogService']=_0x6945b7,this[_0x2e84be(0x2bb)]=_0x2fd64e,this[_0x2e84be(0x19e)]=_0x3554e0,this[_0x2e84be(0x196)]=_0x461bf5,this[_0x2e84be(0x23c)]=_0x3ff827,this[_0x2e84be(0x236)]=_0x527668,this[_0x2e84be(0x26f)]=_0x221134,this['globalConfigService']=_0x2fd79e,this[_0x2e84be(0x2b7)]=_0x3edc7d;}async[_0x26bd78(0x2af)](){const _0x1bf1ef=_0x26bd78;await this[_0x1bf1ef(0x292)](),await this['initHasAccount']();}async[_0x26bd78(0x2c8)](){const _0x2fccda=_0x26bd78,_0x47e7ac=await this['mjParamEntity'][_0x2fccda(0x124)]({'where':{'enable':0x1},'order':{'weight':_0x2fccda(0x1b7)}});_0x47e7ac===0x0&&common_1['Logger'][_0x2fccda(0x2b4)](_0x2fccda(0x2c7));}async[_0x26bd78(0x292)](){const _0x23e880=_0x26bd78,_0xdf882d=await this['mjInspireClassifyEntity'][_0x23e880(0x124)]();if(_0xdf882d===0x0){const _0x3903c2=[{'name':_0x23e880(0x1e3),'value':0x1},{'name':_0x23e880(0x283),'value':0x2},{'name':'头像制作','value':0x3},{'name':'美女形象','value':0x4},{'name':_0x23e880(0x29d),'value':0x5},{'name':_0x23e880(0x213),'value':0x6},{'name':_0x23e880(0x123),'value':0x7},{'name':_0x23e880(0x245),'value':0x8},{'name':_0x23e880(0x168),'value':0x9},{'name':_0x23e880(0x17e),'value':0xa}]['map'](_0x2dfd88=>{const _0x146d02=_0x23e880;return{'name':_0x2dfd88[_0x146d02(0x1d2)],'value':_0x2dfd88[_0x146d02(0x274)]+'','inner':0x1};});await this[_0x23e880(0x12f)][_0x23e880(0x1f6)](_0x3903c2)[_0x23e880(0x20c)](()=>{const _0x29672a=_0x23e880;common_1[_0x29672a(0x301)][_0x29672a(0x2b4)]('初始化灵感广场分类失败');}),common_1['Logger']['log'](_0x23e880(0x2d1));}common_1[_0x23e880(0x301)][_0x23e880(0x1c5)]('不需要灵感广场分类');}async['addMjAccount'](_0x36b066){const _0x9734ed=_0x26bd78;try{const {guildId:_0x59c2ca,account:_0x4e2a67,authorization:_0x191de8,mode:_0x27df83,timeout:_0x210be1,channelId:_0xaf72bd,remark:_0x116105,mjBotChannelId:_0x495261,nijiBotChannelId:_0x4654e9}=_0x36b066;var _0x3e83ab=await this['mjpAccountService'][_0x9734ed(0x1e1)]({'data':{'channelId':_0xaf72bd,'coreSize':0x3,'guildId':_0x59c2ca,'mjBotChannelId':_0x495261||'','nijiBotChannelId':_0x4654e9||'','queueSize':0xa,'remark':_0x116105,'remixAutoSubmit':![],'timeoutMinutes':_0x210be1,'userAgent':_0x9734ed(0x17a),'userToken':_0x191de8}});if(_0x3e83ab[_0x9734ed(0x1ac)]!==0x1)throw new Error(_0x3e83ab['description']);const _0x47c50b=await this[_0x9734ed(0x1b1)][_0x9734ed(0x1f6)]({'account':_0x4e2a67,'authorization':_0x191de8,'mode':_0x27df83,'timeout':_0x210be1,'channelId':_0xaf72bd,'guildId':_0x59c2ca,'remark':_0x116105,'mjpId':_0x3e83ab['result'],'mjBotChannelId':_0x495261||'','nijiBotChannelId':_0x4654e9||''});return await this[_0x9734ed(0x2ac)](_0x3e83ab['result']),!!_0x47c50b;}catch(_0x3f71c7){common_1[_0x9734ed(0x301)][_0x9734ed(0x2b4)](_0x3f71c7);throw new common_1[(_0x9734ed(0x1e8))](_0x3f71c7[_0x9734ed(0x183)],common_1[_0x9734ed(0x210)][_0x9734ed(0x218)]);}}async[_0x26bd78(0x136)](_0x46d86d){const _0xa3863f=_0x26bd78,{id:_0x409019,account:_0x548aac,authorization:_0x520212,mode:_0x41c8b5,guildId:_0x520feb,remark:_0x201c20,channelId:_0x31198a,timeout:_0x9e50ab,enable:_0x55042f,mjBotChannelId:_0x4e03ba,nijiBotChannelId:_0x408801}=_0x46d86d;try{const _0x36cdbd=await this['mjParamEntity'][_0xa3863f(0x2f0)]({'id':Number(_0x409019)});var _0x2594c9=await this[_0xa3863f(0x26f)][_0xa3863f(0x150)]({'data':{'channelId':_0x31198a,'coreSize':0x3,'guildId':_0x520feb,'mjBotChannelId':_0x4e03ba||'','nijiBotChannelId':_0x408801||'','queueSize':0xa,'remark':_0x201c20,'remixAutoSubmit':![],'timeoutMinutes':_0x9e50ab,'userAgent':'Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','userToken':_0x520212,'enable':Boolean(_0x55042f)}},_0x36cdbd['mjpId']);if(_0x2594c9[_0xa3863f(0x1ac)]!==0x1)throw new Error(_0x2594c9['description']);return await this[_0xa3863f(0x1b1)][_0xa3863f(0x27d)](_0x409019,{'account':_0x548aac,'authorization':_0x520212,'mode':_0x41c8b5,'guildId':_0x520feb,'remark':_0x201c20,'channelId':_0x31198a,'timeout':_0x9e50ab,'mjBotChannelId':_0x4e03ba||'','nijiBotChannelId':_0x408801||''});}catch(_0x34831d){common_1[_0xa3863f(0x301)][_0xa3863f(0x2b4)](_0x34831d);throw new common_1[(_0xa3863f(0x1e8))](_0x34831d[_0xa3863f(0x183)],common_1[_0xa3863f(0x210)]['BAD_REQUEST']);}}async[_0x26bd78(0x273)](_0x37c849,_0x2f701f){const _0x4a073d=_0x26bd78;_0x37c849[_0x4a073d(0x1ee)]=_0x2f701f[_0x4a073d(0x29f)];if(_0x2f701f[_0x4a073d(0x15e)]===_0x4a073d(0x17d))_0x37c849[_0x4a073d(0x15e)]=midjourney_constant_1[_0x4a073d(0x25c)][_0x4a073d(0x223)];else{if(_0x2f701f[_0x4a073d(0x15e)]===_0x4a073d(0x13c))_0x37c849[_0x4a073d(0x15e)]=midjourney_constant_1[_0x4a073d(0x25c)][_0x4a073d(0x176)];else _0x2f701f[_0x4a073d(0x15e)]===_0x4a073d(0x281)&&(_0x37c849[_0x4a073d(0x15e)]=midjourney_constant_1[_0x4a073d(0x25c)][_0x4a073d(0x1fc)]);}_0x37c849[_0x4a073d(0x1f0)]=_0x2f701f[_0x4a073d(0x187)],_0x37c849[_0x4a073d(0x2d6)]=_0x2f701f['fastTimeRemaining'],_0x37c849[_0x4a073d(0x249)]=_0x2f701f[_0x4a073d(0x249)],_0x37c849['relaxedUsage']=_0x2f701f['relaxedUsage'],_0x37c849[_0x4a073d(0x166)]=Number(_0x2f701f['remix']);if(_0x2f701f[_0x4a073d(0x17f)]==='BASIC')_0x37c849[_0x4a073d(0x13b)]=0x1;else{if(_0x2f701f[_0x4a073d(0x17f)]===_0x4a073d(0x215))_0x37c849[_0x4a073d(0x13b)]=0x2;else{if(_0x2f701f[_0x4a073d(0x17f)]===_0x4a073d(0x2d3))_0x37c849['orderPlan']=0x3;else _0x2f701f[_0x4a073d(0x17f)]===_0x4a073d(0x2f1)&&(_0x37c849[_0x4a073d(0x13b)]=0x4);}}_0x37c849[_0x4a073d(0x300)]=_0x2f701f[_0x4a073d(0x300)],_0x37c849[_0x4a073d(0x2be)]=_0x2f701f['timeoutMinutes'],_0x37c849[_0x4a073d(0x1f4)]=JSON[_0x4a073d(0x133)](_0x2f701f['buttons']),_0x37c849['info']=JSON[_0x4a073d(0x133)](_0x2f701f['versionSelector']),await this[_0x4a073d(0x1b1)][_0x4a073d(0x1f6)](_0x37c849);}async['syncMjpAccount'](_0x38d771){const _0x256dc=_0x26bd78;try{if(store_1[_0x256dc(0x156)][_0x256dc(0x1b8)]!==_0x256dc(0x24a))return;const _0x347272=await this[_0x256dc(0x26f)]['fetch']({},_0x38d771);if(!_0x347272)return;const _0x403dce=await this[_0x256dc(0x1b1)][_0x256dc(0x14e)]({'where':{'mjpId':_0x38d771}});await this[_0x256dc(0x273)](_0x403dce,_0x347272);}catch(_0x56070d){common_1[_0x256dc(0x301)][_0x256dc(0x2b4)](_0x256dc(0x12a),_0x56070d);}}async[_0x26bd78(0x201)](){const _0x12ba33=_0x26bd78,_0x2ab5e4=await this[_0x12ba33(0x1b1)][_0x12ba33(0x2f9)]();if(!_0x2ab5e4['length'])return;for(let _0x42a41e=0x0;_0x42a41e<_0x2ab5e4[_0x12ba33(0x2a8)];_0x42a41e++){this['syncMjpAccount'](_0x2ab5e4[_0x42a41e][_0x12ba33(0x24b)]);}}async[_0x26bd78(0x228)]({id:_0x127795}){const _0x3ebda6=_0x26bd78;try{const _0x2a9fd6=await this[_0x3ebda6(0x1b1)][_0x3ebda6(0x2f0)]({'id':Number(_0x127795)}),_0x2d25e2=await this[_0x3ebda6(0x26f)]['syncInfo']({},_0x2a9fd6[_0x3ebda6(0x24b)]);if(_0x2d25e2['code']!==0x1)throw new Error(_0x2d25e2['description']);await this['copyAccountInfo'](_0x2a9fd6,_0x2d25e2['result']);}catch(_0x4f5644){throw new common_1[(_0x3ebda6(0x1e8))](_0x4f5644[_0x3ebda6(0x183)],common_1['HttpStatus'][_0x3ebda6(0x218)]);}}async[_0x26bd78(0x238)](_0x28289f){const _0xaae874=_0x26bd78;try{const _0xe590c6=await this[_0xaae874(0x1b1)][_0xaae874(0x2f0)]({'id':Number(_0x28289f['id'])}),_0xa3a905=await this[_0xaae874(0x26f)][_0xaae874(0x238)]({'data':_0x28289f},_0xe590c6[_0xaae874(0x24b)]);if(_0xa3a905[_0xaae874(0x1ac)]!==0x1)throw new Error(_0xa3a905[_0xaae874(0x1a7)]);return _0xe590c6['mjVersion']=_0x28289f['version'],await this[_0xaae874(0x1b1)][_0xaae874(0x1f6)](_0xe590c6),!![];}catch(_0x4e3ab0){throw new common_1[(_0xaae874(0x1e8))](_0x4e3ab0[_0xaae874(0x183)],common_1['HttpStatus'][_0xaae874(0x218)]);}}async['action'](_0x339c9c){const _0x1a3983=_0x26bd78;try{const _0x22ef5b=await this[_0x1a3983(0x1b1)]['findOneBy']({'id':Number(_0x339c9c['id'])}),_0x303107=await this[_0x1a3983(0x26f)]['action']({'data':_0x339c9c},_0x22ef5b[_0x1a3983(0x24b)]);if(_0x303107[_0x1a3983(0x1ac)]!==0x1)throw new Error(_0x303107['description']);return!![];}catch(_0x11fc29){throw new common_1['HttpException'](_0x11fc29[_0x1a3983(0x183)],common_1[_0x1a3983(0x210)][_0x1a3983(0x218)]);}}async['removeMjAccount'](_0x5d2505){const _0x216373=_0x26bd78,{id:_0x599b2f}=_0x5d2505;try{const _0x43f880=await this[_0x216373(0x1b1)][_0x216373(0x14e)]({'where':{'id':Number(_0x599b2f)}});if(!_0x43f880)throw new Error(_0x216373(0x231));common_1['Logger']['error']('mjpId:\x20',_0x43f880[_0x216373(0x24b)]);const _0x5dcd20=await this[_0x216373(0x26f)][_0x216373(0x1d1)]({},_0x43f880[_0x216373(0x24b)]);if(_0x5dcd20[_0x216373(0x1ac)]!==0x1)throw new Error(_0x5dcd20[_0x216373(0x1a7)]);const _0x13fbed=await this[_0x216373(0x1b1)]['delete']({'id':_0x599b2f});return _0x13fbed['affected'];}catch(_0x46c7bc){throw new common_1['HttpException'](_0x46c7bc[_0x216373(0x183)],common_1[_0x216373(0x210)][_0x216373(0x218)]);}}async['setMjAccountEnable'](_0x3b9e6b){const _0x1964f0=_0x26bd78,{id:_0x44185a,enable:_0xd341d7}=_0x3b9e6b;return await this[_0x1964f0(0x1b1)][_0x1964f0(0x27d)](_0x44185a,{'enable':_0xd341d7})[_0x1964f0(0x2dc)](_0x249001=>_0x249001['affected']>0x0);}async[_0x26bd78(0x2a3)](_0x1ebff1,_0x1e9c34){const _0x146c6c=_0x26bd78,_0x58b661=(0x0,utils_1['isSuper'])(this[_0x146c6c(0x2aa)]),{id:_0x4d49a7}=_0x1ebff1;let _0x2bc679=null;try{const _0x2d639c=await this[_0x146c6c(0x1b1)][_0x146c6c(0x14e)]({'where':{'id':_0x4d49a7}});return _0x58b661&&(_0x2bc679=await this[_0x146c6c(0x26f)][_0x146c6c(0x145)]({},_0x2d639c[_0x146c6c(0x24b)])),{..._0x2d639c,'mjpAccountInfo':_0x2bc679,'authorization':_0x58b661?_0x2d639c[_0x146c6c(0x182)]:(0x0,utils_1[_0x146c6c(0x1fd)])(_0x2d639c[_0x146c6c(0x182)]),'guildId':_0x58b661?_0x2d639c[_0x146c6c(0x1a3)]:(0x0,utils_1['hideString'])(_0x2d639c[_0x146c6c(0x1a3)]),'channelId':_0x58b661?_0x2d639c['channelId']:(0x0,utils_1[_0x146c6c(0x1fd)])(_0x2d639c[_0x146c6c(0x14f)])};}catch(_0x354087){throw new common_1[(_0x146c6c(0x1e8))](_0x354087,common_1[_0x146c6c(0x210)]['BAD_REQUEST']);}}async[_0x26bd78(0x261)](_0x2373a1,_0x3d0825){const _0xe4b529=_0x26bd78,{page:page=0x1,size:size=0x14,account:_0x2ad77e,channelId:_0xc0c4ed,enable:_0x3632ef}=_0x2373a1;if(!page||!size)throw new common_1[(_0xe4b529(0x1e8))]('分页参数错误',common_1[_0xe4b529(0x210)][_0xe4b529(0x218)]);const _0x2262ba={};_0x2ad77e&&Object[_0xe4b529(0x171)](_0x2262ba,{'account':(0x0,typeorm_2['Like'])('%'+_0x2ad77e+'%')}),_0xc0c4ed&&Object[_0xe4b529(0x171)](_0x2262ba,{'channelId':(0x0,typeorm_2[_0xe4b529(0x2d8)])('%'+_0xc0c4ed+'%')}),_0x3632ef>0x0&&Object[_0xe4b529(0x171)](_0x2262ba,{'enable':_0x3632ef});const [_0x46d2e7,_0x48ea7f]=await this[_0xe4b529(0x1b1)][_0xe4b529(0x26a)]({'skip':(page-0x1)*size,'where':_0x2262ba,'take':size,'order':{'createdAt':_0xe4b529(0x1b7)},'cache':!![],'select':['id',_0xe4b529(0x1a3),_0xe4b529(0x14f),'authorization',_0xe4b529(0x262),_0xe4b529(0x162),'enable',_0xe4b529(0x1f0),_0xe4b529(0x13b),_0xe4b529(0x300),_0xe4b529(0x2ad),'mode']});return(0x0,utils_1['isSuper'])(this['clsService'])?{'rows':_0x46d2e7||[],'count':_0x48ea7f||0x0}:{'rows':_0x46d2e7[_0xe4b529(0x1b6)](_0x1ef7d1=>({..._0x1ef7d1,'authorization':(0x0,utils_1[_0xe4b529(0x1fd)])(_0x1ef7d1[_0xe4b529(0x182)]),'guildId':(0x0,utils_1[_0xe4b529(0x1fd)])(_0x1ef7d1[_0xe4b529(0x1a3)]),'channelId':(0x0,utils_1['hideString'])(_0x1ef7d1['channelId'])}))||[],'count':_0x48ea7f||0x0};}async['drawTaskList'](_0x1bef95,_0x5a9c7b){const _0x31eb3f=_0x26bd78;try{const _0x3a94af=(0x0,utils_1[_0x31eb3f(0x14b)])(this[_0x31eb3f(0x2aa)]),{page:page=0x1,size:size=0x14,botType:_0xed781,action:_0x339eb2,keyword:_0xbfacb0,userId:_0xc2749d,rec:_0xb52288,status:_0x51b8d7,squareType:_0x5896d2,workflowId:_0x34a528,saasId:_0x25bb16}=_0x1bef95,_0x406a39={};_0xed781&&_0xed781[_0x31eb3f(0x2a8)]&&(_0x406a39[_0x31eb3f(0x1b3)]=(0x0,typeorm_2['In'])(_0xed781));_0x339eb2&&(_0x406a39[_0x31eb3f(0x195)]=_0x339eb2);_0xbfacb0&&(_0x406a39[_0x31eb3f(0x19a)]=(0x0,typeorm_2[_0x31eb3f(0x2d8)])('%'+_0xbfacb0+'%'));_0xc2749d&&(_0x406a39['userId']=_0xc2749d);_0x5896d2&&(_0x406a39[_0x31eb3f(0x221)]=_0x5896d2);_0x34a528&&(_0x406a39[_0x31eb3f(0x290)]=_0x34a528);_0xb52288!==null&&_0xb52288!==undefined&&(_0x406a39['rec']=_0xb52288);_0xb52288!==null&&_0x51b8d7!==undefined&&(_0x406a39[_0x31eb3f(0x22d)]=_0x51b8d7);(0x0,utils_1[_0x31eb3f(0x127)])(this[_0x31eb3f(0x2aa)])?(0x0,utils_1[_0x31eb3f(0x20a)])(_0x25bb16)&&(_0x406a39[_0x31eb3f(0x2a7)]=_0x25bb16):_0x406a39['saasId']=_0x3a94af;const [_0x85bc32,_0x192980]=await this[_0x31eb3f(0x299)][_0x31eb3f(0x26a)]({'where':_0x406a39,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x31eb3f(0x1b7)}}),_0x2044d3=new Map(),_0x301a9b=_0x85bc32[_0x31eb3f(0x1b6)](_0x425bcf=>_0x425bcf[_0x31eb3f(0x290)])[_0x31eb3f(0x246)](_0x319ec3=>Boolean(_0x319ec3));if(_0x301a9b[_0x31eb3f(0x2a8)]){const _0x4f353c=await this[_0x31eb3f(0x2bb)][_0x31eb3f(0x1bb)](_0x301a9b);_0x4f353c[_0x31eb3f(0x24e)](_0x1884ac=>_0x2044d3['set'](_0x1884ac['id'],_0x1884ac));}const _0x44447e=_0x85bc32[_0x31eb3f(0x1b6)](_0x1adb1f=>{const _0x484508=_0x31eb3f;return{..._0x1adb1f,'workflowName':_0x2044d3[_0x484508(0x2a0)](_0x1adb1f[_0x484508(0x290)])?.[_0x484508(0x29e)]||''};});if(_0x5a9c7b){const _0x12e95d=_0x44447e[_0x31eb3f(0x1b6)](_0x4a3ca7=>_0x4a3ca7[_0x31eb3f(0x220)]),_0x3dc870=await this[_0x31eb3f(0x16c)][_0x31eb3f(0x129)](_0x12e95d);_0x44447e['forEach'](_0x526683=>{const _0x1b0699=_0x31eb3f,_0x301a8f=_0x3dc870['find'](_0x58fbe4=>_0x58fbe4['id']===_0x526683['userId']);!(0x0,utils_1['isSuper'])(this['clsService'])&&(_0x301a8f['email']=(0x0,utils_1['hideString'])(_0x301a8f['email']),_0x301a8f[_0x1b0699(0x23a)]=(0x0,utils_1[_0x1b0699(0x1fd)])(_0x301a8f['phone'])),_0x526683[_0x1b0699(0x1d7)]=_0x301a8f;});}else{const _0x1f5ff7=_0x44447e[_0x31eb3f(0x1b6)](_0x3ac53f=>_0x3ac53f[_0x31eb3f(0x220)]),_0x248d1b=await this[_0x31eb3f(0x16c)][_0x31eb3f(0x129)](_0x1f5ff7);_0x44447e[_0x31eb3f(0x24e)](_0x11ec94=>{const _0x3159cc=_0x31eb3f,_0x54f7c2=_0x248d1b[_0x3159cc(0x2f9)](_0x339bed=>_0x339bed['id']===_0x11ec94['userId']);if(_0x54f7c2){const _0x3699fb={'nickname':_0x54f7c2?.[_0x3159cc(0x206)],'avatar':_0x54f7c2?.[_0x3159cc(0x2ff)]};_0x11ec94[_0x3159cc(0x1d7)]=_0x3699fb;}});}return{'rows':_0x44447e,'count':_0x192980};}catch(_0x544746){throw new common_1[(_0x31eb3f(0x1e8))](_0x544746[_0x31eb3f(0x183)],common_1[_0x31eb3f(0x210)][_0x31eb3f(0x218)]);}}async[_0x26bd78(0x2e8)](_0x73239d){const _0x5a602f=_0x26bd78,_0x5952ee=await this[_0x5a602f(0x15d)][_0x5a602f(0x2b3)](['mjLimitCount']),_0x63ae13=Number(_0x5952ee||0x0);if(_0x63ae13===0x0)return!![];const _0x5f182d=await this['midjourneyEntity'][_0x5a602f(0x124)]({'where':{'userId':_0x73239d,'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6])}});if(_0x5f182d<_0x63ae13)return!![];else throw new Error(_0x5a602f(0x279));}async[_0x26bd78(0x271)](_0x1cb359){const _0x5999e9=_0x26bd78;if(store_1[_0x5999e9(0x156)][_0x5999e9(0x1b8)]!==_0x5999e9(0x24a))return null;return null;}async[_0x26bd78(0x204)](_0x5ac76d,_0x530ab3){const _0x8be56=_0x26bd78,_0x1608b6=await this[_0x8be56(0x299)][_0x8be56(0x124)]({'where':{'originTaskId':String(_0x5ac76d),'customId':_0x530ab3}});if(_0x1608b6>0x0)throw new common_1[(_0x8be56(0x1e8))](_0x8be56(0x2b1),common_1[_0x8be56(0x210)]['BAD_REQUEST']);return![];}async[_0x26bd78(0x1e5)](_0x3e1626){const _0x1e231c=_0x26bd78,_0x5efa38=new addDrawQueue_dto_1[(_0x1e231c(0x16f))](_0x3e1626);await this[_0x1e231c(0x23c)][_0x1e231c(0x2b5)](_0x5efa38[_0x1e231c(0x1b2)],_0x5efa38[_0x1e231c(0x220)]);const _0xcc4a2a=(0x0,utils_1[_0x1e231c(0x14b)])(this[_0x1e231c(0x2aa)]);_0x5efa38['saasId']=_0xcc4a2a;const _0x158e64=await this[_0x1e231c(0x299)][_0x1e231c(0x1f6)](_0x5efa38);return _0x158e64;}[_0x26bd78(0x2cc)](_0x598e37){const _0x1128c0=_0x26bd78,_0x529bb4=_0x598e37[_0x1128c0(0x159)](),_0x46057e=_0x529bb4[_0x1128c0(0x287)]('\x20'),_0x2b5980={};for(let _0xbd46fe=0x0;_0xbd46fe<_0x46057e['length'];_0xbd46fe++){_0x46057e[_0xbd46fe]['startsWith']('--')&&(_0xbd46fe+0x1<_0x46057e[_0x1128c0(0x2a8)]&&!_0x46057e[_0xbd46fe+0x1]['startsWith']('--')?(_0x2b5980[_0x46057e[_0xbd46fe]]=_0x46057e[_0xbd46fe+0x1],_0xbd46fe++):_0x2b5980[_0x46057e[_0xbd46fe]]=_0x46057e[_0xbd46fe]);}return _0x2b5980;}async[_0x26bd78(0x2fa)](_0x54721c,_0xc4ca79){const _0x66d58=_0x26bd78;let _0x20bd1a,{botType:_0x59b0b5,prompt:_0x444e3e,extend:_0x3d670f,action:_0x4aaf03,mode:_0x350c22,translate:_0x4c5310,base64Array:_0x22d9dd,mats:mats=[],iw:_0x214b56,roles:roles=[],cw:_0x143db5,styles:styles=[],sw:_0x5ee2e6}=_0xc4ca79;_0x350c22=await this[_0x66d58(0x16c)][_0x66d58(0x135)](_0x54721c[_0x66d58(0x2de)]['id'],_0x350c22,'Imagine');const _0x55d7ce=_0x444e3e,_0x2de602=await this['distributeAccount'](_0x350c22);_0x444e3e&&await this[_0x66d58(0x23c)][_0x66d58(0x2b5)](_0x444e3e,_0x54721c[_0x66d58(0x2de)]['id']),_0x444e3e=_0x4c5310===0x1&&(0x0,utils_1[_0x66d58(0x25a)])(_0x444e3e)?await this['fanyiService']['convertToEnglish'](_0x444e3e):_0x444e3e;let _0x254979=_0x444e3e;mats[_0x66d58(0x2a8)]&&(_0x254979=mats['join']('\x20')+'\x20'+_0x254979);_0x214b56&&_0x444e3e['indexOf']('--iw')==-0x1&&(_0x254979=_0x254979+_0x66d58(0x193)+_0x214b56);styles['length']&&_0x444e3e[_0x66d58(0x288)](_0x66d58(0x276))==-0x1&&(_0x254979=_0x254979+_0x66d58(0x1dd)+styles[_0x66d58(0x190)]('\x20'));roles[_0x66d58(0x2a8)]&&_0x444e3e['indexOf'](_0x66d58(0x26b))==-0x1&&(_0x254979=_0x254979+'\x20--cref\x20'+roles[_0x66d58(0x190)]('\x20'));_0x143db5&&_0x444e3e[_0x66d58(0x288)](_0x66d58(0x2e0))==-0x1&&(_0x254979=_0x254979+_0x66d58(0x272)+_0x143db5);_0x5ee2e6&&_0x444e3e[_0x66d58(0x288)](_0x66d58(0x2ec))==-0x1&&(_0x254979=_0x254979+_0x66d58(0x1bd)+_0x5ee2e6);if(_0x3d670f){const _0x4c62e7=this[_0x66d58(0x2cc)](_0x3d670f);Object[_0x66d58(0x13a)](_0x4c62e7)[_0x66d58(0x24e)](_0x351949=>{_0x444e3e['indexOf'](_0x351949)==-0x1&&(_0x351949!=_0x4c62e7[_0x351949]?_0x254979+='\x20'+_0x351949+'\x20'+_0x4c62e7[_0x351949]:_0x254979+='\x20'+_0x351949);});}const _0x43643f=await this[_0x66d58(0x196)]['imagine']({'data':{'mode':this[_0x66d58(0x209)](_0x350c22),'prompt':_0x254979,'botType':_0x59b0b5||_0x66d58(0x208),'base64Array':_0x22d9dd,'accountFilter':_0x2de602}});if(_0x43643f['code']===0x17)throw new Error(_0x66d58(0x286));if(_0x43643f[_0x66d58(0x1ac)]===0x18)throw new Error(_0x66d58(0x138));if(_0x43643f[_0x66d58(0x1ac)]!==0x1&&_0x43643f['code']!==0x16)throw new Error(_0x43643f[_0x66d58(0x1a7)]);return _0x20bd1a=await this[_0x66d58(0x2b7)][_0x66d58(0x20e)](async()=>{const _0x4f43df=_0x66d58,_0x2683b4={'mode':_0x350c22,'prompt':_0x444e3e,'action':_0x4aaf03,'translate':_0x4c5310,'fullPrompt':_0x254979,'originPrompt':_0x55d7ce,'extraParam':_0x3d670f,'userId':_0x54721c[_0x4f43df(0x2de)]['id'],'mjpId':_0x2de602?.[_0x4f43df(0x1c3)],'mjpTaskId':_0x43643f[_0x4f43df(0x180)],'botType':_0x59b0b5||_0x4f43df(0x208)},_0x368703=await this[_0x4f43df(0x1e5)](_0x2683b4);if(!_0x368703)throw new Error(_0x4f43df(0x2b0));return await this['userService']['deductBalance4MJ'](_0x54721c[_0x4f43df(0x2de)]['id'],_0x350c22,_0x4f43df(0x2a9),_0x368703['id']),_0x368703;}),_0x20bd1a;}async['actionTask'](_0xdaccf2,_0x3b1e4d){const _0x1b35ba=_0x26bd78;let _0x319690;const {action:_0x36b16c,taskId:_0x1290b0,customId:_0x2c6e8e,prompt:_0x323112,mask:_0xa498fe,enableRemix:_0x4799a0}=_0x3b1e4d,_0x1b617e=await this[_0x1b35ba(0x299)]['findOne']({'where':{'id':_0x1290b0}});if(!_0x1b617e)throw new Error(_0x1b35ba(0x1d4));let _0x5a7f11=await this[_0x1b35ba(0x16c)]['validateBalance4MJ'](_0xdaccf2[_0x1b35ba(0x2de)]['id'],_0x1b617e[_0x1b35ba(0x15e)],_0x2c6e8e);const _0x51c2a0=await this[_0x1b35ba(0x196)][_0x1b35ba(0x195)]({'data':{'customId':_0x2c6e8e,'taskId':_0x1b617e[_0x1b35ba(0x2fb)],'accountFilter':{'instanceId':_0x1b617e[_0x1b35ba(0x24b)]},'mode':this[_0x1b35ba(0x209)](_0x5a7f11),'enableRemix':_0x4799a0===undefined?!![]:_0x4799a0}});if(_0x51c2a0[_0x1b35ba(0x1ac)]===0x17)throw new Error(_0x1b35ba(0x286));else{if(_0x51c2a0[_0x1b35ba(0x1ac)]===0x18)throw new Error(_0x1b35ba(0x138));else{if(_0x51c2a0[_0x1b35ba(0x1ac)]===0x15)setTimeout(()=>this[_0x1b35ba(0x2d4)](_0x51c2a0[_0x1b35ba(0x180)]));else{if(_0x51c2a0[_0x1b35ba(0x1ac)]!==0x1&&_0x51c2a0['code']!==0x16)throw new Error(_0x51c2a0[_0x1b35ba(0x1a7)]);}}}return _0x319690=await this['connection'][_0x1b35ba(0x20e)](async()=>{const _0x548618=_0x1b35ba,_0x531bb5={'action':_0x36b16c,'customId':_0x2c6e8e,'userId':_0xdaccf2[_0x548618(0x2de)]['id'],'mjpTaskId':_0x51c2a0[_0x548618(0x180)],'originTaskId':String(_0x1290b0),'mode':_0x5a7f11,'mjpId':_0x1b617e[_0x548618(0x24b)],'prompt':_0x1b617e[_0x548618(0x2ba)],'botType':_0x1b617e['botType'],'extraParam':_0x1b617e['extraParam'],'fullPrompt':_0x1b617e['fullPrompt'],'originPrompt':_0x1b617e[_0x548618(0x19a)]},_0x3ce79e=await this[_0x548618(0x1e5)](_0x531bb5);if(!_0x3ce79e)throw new Error(_0x548618(0x1ff));const _0x33742f=_0x1b617e[_0x548618(0x2ca)];return _0x1b617e[_0x548618(0x2ca)]['forEach'](_0x35ac4a=>{const _0x5a8a02=_0x548618;_0x35ac4a['customId']===_0x3b1e4d['customId']&&(_0x35ac4a[_0x5a8a02(0x16b)]=!![]);}),await this[_0x548618(0x299)]['save'](_0x1b617e),await this['userService'][_0x548618(0x15b)](_0xdaccf2['user']['id'],_0x5a7f11,_0x2c6e8e,_0x3ce79e['id']),_0x3ce79e;}),_0x319690;}async[_0x26bd78(0x289)](_0x39966b,_0x98ec49){const _0x67000=_0x26bd78;let _0x22ffc1,{action:_0x4476fc,taskId:_0x465cf0,customId:_0x324808,prompt:_0x5df51b,mask:_0x5b0402}=_0x98ec49;const _0x234d5d=await this['midjourneyEntity']['findOne']({'where':{'id':_0x465cf0}});if(!_0x234d5d)throw new Error(_0x67000(0x1d4));const _0x50ba54=_0x5df51b;_0x5df51b&&await this[_0x67000(0x23c)][_0x67000(0x2b5)](_0x5df51b,_0x39966b[_0x67000(0x2de)]['id']),_0x5df51b=(0x0,utils_1[_0x67000(0x25a)])(_0x5df51b)?await this[_0x67000(0x1ba)][_0x67000(0x229)](_0x5df51b):_0x5df51b;const _0x348ec4={'taskId':_0x234d5d[_0x67000(0x2fb)]};_0x5df51b&&(_0x348ec4[_0x67000(0x2ba)]=_0x5df51b);_0x5b0402&&(_0x348ec4[_0x67000(0x2a2)]=_0x5b0402);const _0x131a83=await this[_0x67000(0x196)][_0x67000(0x1ea)]({'data':_0x348ec4});if(_0x131a83[_0x67000(0x1ac)]!==0x1&&_0x131a83['code']!==0x16)throw new Error(_0x131a83[_0x67000(0x1a7)]);_0x22ffc1=await this[_0x67000(0x299)][_0x67000(0x1f6)]({'id':_0x465cf0,'prompt':_0x5df51b,'status':0x1,'originPrompt':_0x50ba54,'messageFlags':0x1});for(let _0x2a1754 in _0x22ffc1){_0x22ffc1[_0x2a1754]&&(_0x234d5d[_0x2a1754]=_0x22ffc1[_0x2a1754]);}return _0x234d5d;}async['handleAddDrawTask'](_0x41f185,_0x365b4c){const _0x1ac09f=_0x26bd78;let _0x433e45,_0x1ff0ce;try{let {type:_0x378f64,params:_0xeff728}=_0x41f185;await this['userService'][_0x1ac09f(0x2da)](_0x365b4c[_0x1ac09f(0x2de)]),await this[_0x1ac09f(0x2e8)](_0x365b4c[_0x1ac09f(0x2de)]['id']);if(_0x378f64===midjourney_constant_1[_0x1ac09f(0x250)][_0x1ac09f(0x278)])_0x1ff0ce=await this[_0x1ac09f(0x2fa)](_0x365b4c,_0xeff728),_0x433e45=_0x1ff0ce[_0x1ac09f(0x2fb)];else{if(_0x378f64===midjourney_constant_1[_0x1ac09f(0x250)][_0x1ac09f(0x27a)])_0xeff728=_0xeff728,_0xeff728[_0x1ac09f(0x214)]?(_0x1ff0ce=await this[_0x1ac09f(0x2fc)](_0x365b4c,_0xeff728),_0xeff728[_0x1ac09f(0x2ba)]&&(_0xeff728[_0x1ac09f(0x2c2)]=_0x1ff0ce['id'],_0x1ff0ce=await this['modalTask'](_0x365b4c,_0xeff728))):_0x1ff0ce=await this[_0x1ac09f(0x289)](_0x365b4c,_0xeff728),_0x433e45=_0x1ff0ce['mjpTaskId'];else return new common_1[(_0x1ac09f(0x1e8))](_0x1ac09f(0x28b),common_1[_0x1ac09f(0x210)][_0x1ac09f(0x218)]);}return _0x1ff0ce;}catch(_0x30c265){if(_0x30c265 instanceof common_1[_0x1ac09f(0x1e8)])throw _0x30c265;else{_0x433e45&&await this[_0x1ac09f(0x196)][_0x1ac09f(0x2f5)]({},_0x433e45);throw new common_1[(_0x1ac09f(0x1e8))](_0x30c265[_0x1ac09f(0x183)],common_1[_0x1ac09f(0x210)]['BAD_REQUEST']);}}}async['handleImagesUploadTask'](_0x1a20a3,_0x4fa327){const _0x197db0=_0x26bd78;let _0x5c37fc,_0x386dd6;try{let {type:_0xd4c415,botType:_0x3a4492,files:_0x4ac5ed,mode:_0x129ecc,action:_0x2dae0d,size:_0x5cd050,base64Array:base64Array=[]}=_0x1a20a3;await this[_0x197db0(0x16c)][_0x197db0(0x2da)](_0x4fa327[_0x197db0(0x2de)]),await this[_0x197db0(0x2e8)](_0x4fa327[_0x197db0(0x2de)]['id']);let _0x41c38='';if(Number(_0xd4c415)===midjourney_constant_1['MidJourneyDrawEnum'][_0x197db0(0x25d)])_0x41c38=_0x197db0(0x2d2);else Number(_0xd4c415)===midjourney_constant_1[_0x197db0(0x250)][_0x197db0(0x207)]&&(_0x41c38='Describe');_0x129ecc=await this[_0x197db0(0x16c)]['validateBalance4MJ'](_0x4fa327[_0x197db0(0x2de)]['id'],_0x129ecc,_0x41c38);const _0x3aec0c=await this[_0x197db0(0x271)](_0x129ecc);if(!base64Array[_0x197db0(0x2a8)])for(let _0x37e64e=0x0;_0x37e64e<_0x4ac5ed[_0x197db0(0x2a8)];_0x37e64e++){base64Array[_0x197db0(0x186)](_0x197db0(0x137)+_0x4ac5ed[_0x37e64e]['buffer'][_0x197db0(0x2df)](_0x197db0(0x1d5)));}if(Number(_0xd4c415)===midjourney_constant_1[_0x197db0(0x250)][_0x197db0(0x25d)]){if(base64Array['length']<0x2)throw new Error('图混图任务至少需要两张图片');const _0x4a05ed=await this[_0x197db0(0x196)][_0x197db0(0x225)]({'data':{'mode':this[_0x197db0(0x209)](_0x129ecc),'dimensions':_0x5cd050,'botType':_0x197db0(0x208),'base64Array':base64Array,'accountFilter':_0x3aec0c}});if(_0x4a05ed[_0x197db0(0x1ac)]===0x17)throw new Error(_0x197db0(0x286));if(_0x4a05ed[_0x197db0(0x1ac)]!==0x1&&_0x4a05ed[_0x197db0(0x1ac)]!==0x16)throw new Error(_0x4a05ed[_0x197db0(0x1a7)]);_0x5c37fc=_0x4a05ed[_0x197db0(0x180)],_0x386dd6=await this['connection'][_0x197db0(0x20e)](async()=>{const _0x4aaeb4=_0x197db0,_0x30d665={'mode':_0x129ecc,'action':_0x2dae0d,'userId':_0x4fa327['user']['id'],'jobId':(0x0,utils_1[_0x4aaeb4(0x2d5)])(),'botType':_0x3a4492||'MID_JOURNEY','extraParam':JSON[_0x4aaeb4(0x133)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x4a05ed[_0x4aaeb4(0x180)]},_0x44a2f3=await this[_0x4aaeb4(0x1e5)](_0x30d665);if(!_0x44a2f3)throw new Error('创建图混图任务失败');return await this['userService'][_0x4aaeb4(0x15b)](_0x4fa327[_0x4aaeb4(0x2de)]['id'],_0x129ecc,_0x41c38,_0x44a2f3['id']),_0x44a2f3;});}else{if(Number(_0xd4c415)===midjourney_constant_1[_0x197db0(0x250)]['IMAGE_TO_TEXT']){const _0x4f5126=await this[_0x197db0(0x196)]['describe']({'data':{'mode':this[_0x197db0(0x209)](_0x129ecc),'botType':_0x197db0(0x208),'base64':base64Array[0x0],'accountFilter':_0x3aec0c}});if(_0x4f5126[_0x197db0(0x1ac)]===0x17)throw new Error(_0x197db0(0x286));if(_0x4f5126[_0x197db0(0x1ac)]!==0x1&&_0x4f5126[_0x197db0(0x1ac)]!==0x16)throw new Error(_0x4f5126['description']);_0x5c37fc=_0x4f5126[_0x197db0(0x180)],_0x386dd6=await this[_0x197db0(0x2b7)][_0x197db0(0x20e)](async()=>{const _0x699ea2=_0x197db0,_0x349136={'mode':_0x129ecc,'action':_0x2dae0d,'userId':_0x4fa327[_0x699ea2(0x2de)]['id'],'jobId':(0x0,utils_1[_0x699ea2(0x2d5)])(),'botType':_0x3a4492||_0x699ea2(0x208),'extraParam':JSON[_0x699ea2(0x133)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x4f5126[_0x699ea2(0x180)]},_0x5f3778=await this['addDrawQueue'](_0x349136);if(!_0x5f3778)throw new Error(_0x699ea2(0x18b));return await this[_0x699ea2(0x16c)][_0x699ea2(0x15b)](_0x4fa327[_0x699ea2(0x2de)]['id'],_0x129ecc,_0x41c38,_0x5f3778['id']),_0x5f3778;})[_0x197db0(0x20c)](async _0x17d351=>{const _0x166289=_0x197db0;await this[_0x166289(0x196)][_0x166289(0x2f5)]({},_0x4f5126[_0x166289(0x180)]);throw _0x17d351;});}else return new common_1[(_0x197db0(0x1e8))](_0x197db0(0x28b),common_1['HttpStatus'][_0x197db0(0x218)]);}return _0x386dd6;}catch(_0x5d94ff){if(_0x5d94ff instanceof common_1['HttpException'])throw _0x5d94ff;else{_0x5c37fc&&await this[_0x197db0(0x196)][_0x197db0(0x2f5)]({},_0x5c37fc);throw new common_1[(_0x197db0(0x1e8))](_0x5d94ff['message'],common_1[_0x197db0(0x210)][_0x197db0(0x218)]);}}}async[_0x26bd78(0x1ce)](_0x5753b6,_0x2092fc){const _0x37d063=_0x26bd78;let _0x620b30;try{const {params:_0x30f39c}=_0x5753b6;let {mode:_0x5bcfbd,botType:_0x38dad9,action:_0x53cf99,extend:_0x5098fa,sourceBase64:_0x3b1a5b,targetBase64:_0x307a91}=_0x30f39c;await this[_0x37d063(0x16c)]['checkUserStatus'](_0x2092fc[_0x37d063(0x2de)]),await this[_0x37d063(0x2e8)](_0x2092fc[_0x37d063(0x2de)]['id']),_0x5bcfbd=await this[_0x37d063(0x16c)][_0x37d063(0x135)](_0x2092fc[_0x37d063(0x2de)]['id'],_0x5bcfbd,_0x37d063(0x1a2));const _0x59836a=await this[_0x37d063(0x271)](_0x5bcfbd),_0x5d5a8d=await this[_0x37d063(0x196)]['swap']({'data':{'sourceBase64':_0x3b1a5b,'targetBase64':_0x307a91,'state':_0x5098fa,'mode':this[_0x37d063(0x209)](_0x5bcfbd),'accountFilter':_0x59836a}});if(_0x5d5a8d[_0x37d063(0x1ac)]===0x17)throw new Error(_0x37d063(0x286));if(_0x5d5a8d[_0x37d063(0x1ac)]===0x18)throw new Error('prompt包含敏感词');if(_0x5d5a8d[_0x37d063(0x1ac)]!==0x1&&_0x5d5a8d[_0x37d063(0x1ac)]!==0x16)throw new Error(_0x5d5a8d[_0x37d063(0x1a7)]);return _0x620b30=await this['connection']['transaction'](async()=>{const _0x2967a5=_0x37d063,_0x2e4ac1={'mode':_0x5bcfbd,'action':_0x53cf99,'prompt':null,'extraParam':_0x5098fa,'originPrompt':null,'userId':_0x2092fc[_0x2967a5(0x2de)]['id'],'mjpId':_0x59836a?.[_0x2967a5(0x1c3)],'mjpTaskId':_0x5d5a8d[_0x2967a5(0x180)],'botType':_0x38dad9||_0x2967a5(0x208)},_0x5605aa=new addDrawQueue_dto_1[(_0x2967a5(0x16f))](_0x2e4ac1),_0x5bb298=(0x0,utils_1[_0x2967a5(0x14b)])(this[_0x2967a5(0x2aa)]);_0x5605aa['saasId']=_0x5bb298;const _0x5896cb=await this['midjourneyEntity'][_0x2967a5(0x1f6)](_0x5605aa);if(!_0x5896cb)throw new Error(_0x2967a5(0x2b0));return await this['userService'][_0x2967a5(0x15b)](_0x2092fc[_0x2967a5(0x2de)]['id'],_0x5bcfbd,_0x2967a5(0x1a2),_0x5896cb['id']),_0x5896cb;}),_0x620b30;}catch(_0x57f681){if(_0x57f681 instanceof common_1['HttpException'])throw _0x57f681;else throw new common_1[(_0x37d063(0x1e8))](_0x57f681[_0x37d063(0x183)],common_1[_0x37d063(0x210)][_0x37d063(0x218)]);}}async['addRefer'](_0x54ce08,_0x580683){const _0x326219=_0x26bd78,_0x5468e3=(0x0,utils_1[_0x326219(0x14b)])(this[_0x326219(0x2aa)]),_0x7eded9={'userId':_0x580683[_0x326219(0x2de)]['id'],'jobId':(0x0,utils_1[_0x326219(0x2d5)])(),'mode':0x1,'translate':0x0,'prompt':'','progress':0x64,'durationSpent':0x0,'status':0x3,'fullPrompt':_0x54ce08[_0x326219(0x2ba)],'originPrompt':_0x54ce08['prompt'],'fileInfo':_0x54ce08[_0x326219(0x1c8)],'botType':_0x54ce08[_0x326219(0x1b3)],'imageUrl':_0x54ce08[_0x326219(0x2e9)],'buttons':[],'saasId':_0x5468e3},_0x52beef=await this[_0x326219(0x299)][_0x326219(0x1f6)](_0x7eded9);return _0x52beef;}async[_0x26bd78(0x185)](_0x48f0de){const _0x29acde=_0x26bd78;try{const _0x4d1654=await this[_0x29acde(0x299)][_0x29acde(0x14e)]({'where':{'jobId':_0x48f0de}});if(!_0x4d1654)throw new Error(_0x29acde(0x158));const _0x2ae816=await this[_0x29acde(0x196)][_0x29acde(0x185)]({},_0x4d1654[_0x29acde(0x2fb)]);if(_0x2ae816[_0x29acde(0x1ac)]!==0x1)throw new Error(_0x2ae816[_0x29acde(0x1a7)]);return _0x2ae816[_0x29acde(0x180)];}catch(_0x269ce0){throw new common_1[(_0x29acde(0x1e8))](_0x269ce0['message'],common_1[_0x29acde(0x210)][_0x29acde(0x218)]);}}async[_0x26bd78(0x2ef)](_0x3f33ef,_0x115f18){const _0x6c341b=_0x26bd78;try{let _0xcdd4f0,_0x119df3,_0x26a94f,_0x36bef4;const {jobId:_0xd38c69,detail:_0x5236bc}=_0x115f18,_0x2510f4=(0x0,utils_1['getUserId'])(this[_0x6c341b(0x2aa)]),_0x2040b7=await this[_0x6c341b(0x299)][_0x6c341b(0x14e)]({'where':{'jobId':_0xd38c69}});if(_0x2040b7[_0x6c341b(0x290)]){const _0x3497ce=await this[_0x6c341b(0x2bb)][_0x6c341b(0x29b)](_0x2040b7[_0x6c341b(0x290)]);_0x36bef4=_0x3497ce[_0x6c341b(0x29e)];}return _0x5236bc&&(this[_0x6c341b(0x2e7)]['increaseVisit'](model_constant_1[_0x6c341b(0x21a)][_0x6c341b(0x2ce)],_0x2040b7['id']),_0xcdd4f0=await this[_0x6c341b(0x16c)][_0x6c341b(0x26c)](_0x2040b7['userId']),_0x119df3=await this['aiLogService'][_0x6c341b(0x18d)](model_constant_1[_0x6c341b(0x21a)][_0x6c341b(0x2ce)],_0x2040b7['id']),_0x2510f4&&(_0x26a94f=await this[_0x6c341b(0x2e7)][_0x6c341b(0x1d9)](model_constant_1[_0x6c341b(0x21a)][_0x6c341b(0x2ce)],_0x2040b7['id']))),{..._0x2040b7,'workflowName':_0x36bef4,'avatar':_0xcdd4f0?_0xcdd4f0[_0x6c341b(0x2ff)]:null,'username':_0xcdd4f0?_0xcdd4f0['username']:null,'nickname':_0xcdd4f0?_0xcdd4f0[_0x6c341b(0x206)]:null,'visitNum':_0x119df3?_0x119df3[_0x6c341b(0x172)]:0x0,'agreeNum':_0x119df3?_0x119df3[_0x6c341b(0x1f1)]:0x0,'agree':_0x26a94f?_0x26a94f[_0x6c341b(0x195)]:null};}catch(_0x4eb2e2){throw new common_1[(_0x6c341b(0x1e8))](_0x4eb2e2[_0x6c341b(0x183)],common_1[_0x6c341b(0x210)]['BAD_REQUEST']);}}async[_0x26bd78(0x15a)](_0x27e927,_0xbb2d32){const _0x422697=_0x26bd78;try{if(!_0xbb2d32[_0x422697(0x202)]||!_0xbb2d32[_0x422697(0x202)]['length'])return[];const _0x59c16c=_0xbb2d32[_0x422697(0x202)]['split'](','),_0x322a4f=await this['midjourneyEntity'][_0x422697(0x2f9)]({'where':{'jobId':(0x0,typeorm_2['In'])(_0x59c16c)}}),_0xc7686d=new Map(),_0xa5fa4b=_0x322a4f[_0x422697(0x1b6)](_0x59506e=>_0x59506e[_0x422697(0x290)])[_0x422697(0x246)](_0x589e11=>Boolean(_0x589e11));if(_0xa5fa4b['length']){const _0x4e5474=await this[_0x422697(0x2bb)][_0x422697(0x1bb)](_0xa5fa4b);_0x4e5474[_0x422697(0x24e)](_0x26fd67=>_0xc7686d['set'](_0x26fd67['id'],_0x26fd67));}return _0x322a4f['map'](_0x3af6cd=>{const _0x4c18cf=_0x422697;return{..._0x3af6cd,'workflowName':_0xc7686d['get'](_0x3af6cd[_0x4c18cf(0x290)])?.['modelName']||''};});}catch(_0x47ba98){throw new common_1[(_0x422697(0x1e8))](_0x47ba98['message'],common_1['HttpStatus'][_0x422697(0x218)]);}}async[_0x26bd78(0x12c)](_0x272ccc){const _0x5512c7=_0x26bd78,{id:_0x4a7bbf,squareType:_0x4f3562,rec:_0x39b687}=_0x272ccc,_0x3b6daf=await this['midjourneyEntity'][_0x5512c7(0x14e)]({'where':{'id':_0x4a7bbf,'status':midjourney_constant_1[_0x5512c7(0x203)]['DRAWED']}});if(!_0x3b6daf)throw new common_1['HttpException']('当前图片不存在！',common_1[_0x5512c7(0x210)][_0x5512c7(0x218)]);const _0x5803f6=await this[_0x5512c7(0x299)][_0x5512c7(0x27d)]({'id':_0x4a7bbf},{'rec':_0x39b687,'squareType':_0x4f3562})[_0x5512c7(0x20c)](_0x31d209=>{const _0x1118bd=_0x5512c7;throw new common_1[(_0x1118bd(0x1e8))](_0x31d209,common_1['HttpStatus'][_0x1118bd(0x218)]);});if(_0x5803f6['affected']<=0x0)throw new common_1[(_0x5512c7(0x1e8))]('操作失败！',common_1[_0x5512c7(0x210)]['BAD_REQUEST']);return await this[_0x5512c7(0x236)][_0x5512c7(0x23f)]({'key':_0x5512c7(0x28c)}),!![];}async[_0x26bd78(0x17b)](_0x20cabc,_0x1aff3b){const _0x10c3d7=_0x26bd78;return this[_0x10c3d7(0x19e)][_0x10c3d7(0x143)]({'data':{'workflowId':_0x20cabc,'versionId':_0x1aff3b}});}async[_0x26bd78(0x252)](_0x4eaff3,_0x35d3f1){const _0x632c92=_0x26bd78;try{const _0x1cf3f1={'page':_0x35d3f1[_0x632c92(0x164)],'size':_0x35d3f1[_0x632c92(0x1cb)],'modelName':_0x35d3f1[_0x632c92(0x1da)],'modelType':model_constant_1[_0x632c92(0x21a)]['WORKFLOW']};(0x0,utils_1[_0x632c92(0x26d)])(this[_0x632c92(0x2aa)])?_0x35d3f1[_0x632c92(0x22d)]!==undefined&&(_0x1cf3f1['status']=Boolean(_0x35d3f1[_0x632c92(0x22d)])):_0x1cf3f1['status']=!![];const _0x333347=await this['modelsService']['queryModels'](_0x4eaff3,_0x1cf3f1);let _0x358cde=[];if(_0x333347['rows'][_0x632c92(0x2a8)]){const _0x58bbf2=new Set(),_0x1fd459=(0x0,utils_1[_0x632c92(0x212)])(this[_0x632c92(0x2aa)]),_0x31fbc3=_0x333347['rows'][_0x632c92(0x1b6)](_0x21395d=>_0x21395d['id']);if(_0x31fbc3[_0x632c92(0x2a8)]&&_0x1fd459){const _0x459720=await this[_0x632c92(0x16c)]['favoriteListByTypeAndIds'](_0x1fd459,user_constant_1['EFavorite'][_0x632c92(0x2a4)],_0x31fbc3);_0x459720[_0x632c92(0x24e)](_0x3694f7=>_0x58bbf2[_0x632c92(0x2d0)](Number(_0x3694f7[_0x632c92(0x2b2)])));}_0x358cde=_0x333347['rows'][_0x632c92(0x1b6)](_0x23521a=>{const _0x1b45c9=_0x632c92,_0x3bd1a6={'id':_0x23521a['id'],'cover':_0x23521a[_0x1b45c9(0x134)],'name':_0x23521a[_0x1b45c9(0x29e)],'workflowId':_0x23521a['model'],'versionId':Number(_0x23521a[_0x1b45c9(0x153)]),'deduct':_0x23521a[_0x1b45c9(0x15c)],'vipFreeNum':_0x23521a[_0x1b45c9(0x291)],'displaySort':_0x23521a[_0x1b45c9(0x297)],'description':_0x23521a[_0x1b45c9(0x1a7)],'status':_0x23521a[_0x1b45c9(0x22d)],'createdAt':_0x23521a[_0x1b45c9(0x2ad)],'updatedAt':_0x23521a[_0x1b45c9(0x20b)],'useCount':_0x23521a[_0x1b45c9(0x222)],'tutorial':_0x23521a[_0x1b45c9(0x264)],'freeUsed':_0x23521a['use'],'favorite':_0x58bbf2['has'](_0x23521a['id'])};return _0x3bd1a6;});}return{'count':_0x333347[_0x632c92(0x124)],'rows':_0x358cde};}catch(_0x92cf86){throw new common_1[(_0x632c92(0x1e8))](_0x92cf86[_0x632c92(0x183)],common_1['HttpStatus'][_0x632c92(0x218)]);}}async[_0x26bd78(0x143)](_0x558f07,_0x49d134){const _0x718088=_0x26bd78;try{let _0x958b04;const _0x1ddc08=(0x0,utils_1[_0x718088(0x212)])(this[_0x718088(0x2aa)]),_0x540a65=new Set(),_0x5160c1=await this['modelsService'][_0x718088(0x29b)](_0x49d134);if(!_0x5160c1)throw new common_1[(_0x718088(0x1e8))](_0x718088(0x19f),common_1[_0x718088(0x210)][_0x718088(0x218)]);if(_0x1ddc08){const _0xa68b59=await this[_0x718088(0x16c)][_0x718088(0x26c)](_0x1ddc08);if(_0xa68b59[_0x718088(0x200)]||_0xa68b59[_0x718088(0x258)]){const _0x5a2ad7=redisKey_constant_1['VIP_FREE']+'-'+_0x1ddc08+'-'+_0x5160c1['id'];_0x958b04=await await this[_0x718088(0x236)][_0x718088(0x2a0)]({'key':_0x5a2ad7});}const _0x5a0b79=await this['userService'][_0x718088(0x1fe)](_0x1ddc08,user_constant_1[_0x718088(0x194)]['WORKFLOW'],[_0x5160c1['id']]);_0x5a0b79[_0x718088(0x24e)](_0x3ce18f=>_0x540a65[_0x718088(0x2d0)](Number(_0x3ce18f['relateId'])));}const _0x21a2df={'id':_0x5160c1['id'],'cover':_0x5160c1[_0x718088(0x134)],'name':_0x5160c1[_0x718088(0x29e)],'workflowId':_0x5160c1[_0x718088(0x13d)],'versionId':Number(_0x5160c1[_0x718088(0x153)]),'deduct':_0x5160c1[_0x718088(0x15c)],'vipFreeNum':_0x5160c1['vipFreeNum'],'displaySort':_0x5160c1['displaySort'],'description':_0x5160c1['description'],'status':_0x5160c1[_0x718088(0x22d)],'createdAt':_0x5160c1[_0x718088(0x2ad)],'updatedAt':_0x5160c1[_0x718088(0x20b)],'useCount':_0x5160c1['useCount'],'tutorial':_0x5160c1[_0x718088(0x264)],'freeUsed':Number(_0x958b04),'favorite':_0x540a65[_0x718088(0x267)](_0x5160c1['id'])};return _0x21a2df;}catch(_0x3e2148){throw new common_1[(_0x718088(0x1e8))](_0x3e2148[_0x718088(0x183)],common_1[_0x718088(0x210)][_0x718088(0x218)]);}}async[_0x26bd78(0x178)](_0x21a70a){const _0x187eb7=_0x26bd78;try{const _0x1f49af={'id':_0x21a70a['id'],'keyType':0x5,'modelType':model_constant_1[_0x187eb7(0x21a)][_0x187eb7(0x2a4)],'cover':_0x21a70a[_0x187eb7(0x134)],'modelName':_0x21a70a[_0x187eb7(0x1d2)],'model':_0x21a70a[_0x187eb7(0x290)],'key':'','deduct':_0x21a70a['deduct'],'vipFreeNum':_0x21a70a['vipFreeNum'],'displaySort':_0x21a70a['displaySort'],'description':_0x21a70a['description'],'status':_0x21a70a[_0x187eb7(0x22d)],'remark':_0x21a70a[_0x187eb7(0x1c7)]};return _0x21a70a[_0x187eb7(0x1c0)]&&(_0x1f49af[_0x187eb7(0x153)]=String(_0x21a70a[_0x187eb7(0x1c0)])),await this[_0x187eb7(0x2bb)][_0x187eb7(0x239)](_0x1f49af),!![];}catch(_0x36bacf){throw new common_1[(_0x187eb7(0x1e8))](_0x36bacf[_0x187eb7(0x183)],common_1[_0x187eb7(0x210)][_0x187eb7(0x218)]);}}async[_0x26bd78(0x1e4)](_0x6c07e8){const _0x252112=_0x26bd78;return this[_0x252112(0x2bb)][_0x252112(0x173)](_0x6c07e8['ids']);}async[_0x26bd78(0x18e)](){const _0x1fca6b=_0x26bd78,_0x29a14c=await this[_0x1fca6b(0x12e)]['list4workflow'](_0x1fca6b(0x28d)),_0x364366=await this[_0x1fca6b(0x12e)][_0x1fca6b(0x265)](_0x1fca6b(0x2ee)),_0x4d71a8=await this[_0x1fca6b(0x12e)][_0x1fca6b(0x265)](_0x1fca6b(0x157)),_0x2b8b4f=await this[_0x1fca6b(0x12e)][_0x1fca6b(0x265)](_0x1fca6b(0x1aa));return{'style':_0x29a14c,'effect_category':_0x364366,'effect_main_body':_0x4d71a8,'application_fields':_0x2b8b4f};}async[_0x26bd78(0x259)](_0x264942){const _0x4d414f=_0x26bd78;try{const {page:page=0x1,size:size=0x14,keyword:_0x4459d0,type:_0x498d5e,version:_0x9018e8,style:_0x324da7,effectCategory:_0x1a269b,effectMainBody:_0x27963e,applicationFields:_0x1a5d18,disabled:_0x55e868}=_0x264942,_0x1ae109={};_0x4459d0&&(_0x1ae109['name']=(0x0,typeorm_2[_0x4d414f(0x2d8)])('%'+_0x4459d0+'%'));_0x498d5e&&(_0x1ae109['type']=_0x498d5e);_0x9018e8&&(_0x1ae109['version']=_0x9018e8);_0x324da7&&(_0x1ae109[_0x4d414f(0x28d)]=_0x324da7);_0x1a269b&&(_0x1ae109[_0x4d414f(0x1de)]=_0x1a269b);_0x27963e&&(_0x1ae109['effectMainBody']=_0x27963e);_0x1a5d18&&(_0x1ae109[_0x4d414f(0x2e2)]=_0x1a5d18);(0x0,utils_1[_0x4d414f(0x26d)])(this[_0x4d414f(0x2aa)])?(0x0,utils_1[_0x4d414f(0x20a)])(_0x55e868)&&(_0x1ae109['disabled']=_0x55e868):_0x1ae109[_0x4d414f(0x1e6)]=0x0;const [_0x425994,_0x59ee89]=await this['mjModelEntity'][_0x4d414f(0x26a)]({'where':_0x1ae109,'take':size,'skip':(page-0x1)*size,'order':{'id':_0x4d414f(0x22f)}});return{'rows':_0x425994,'count':_0x59ee89};}catch(_0x50212e){throw new common_1[(_0x4d414f(0x1e8))](_0x50212e[_0x4d414f(0x183)],common_1[_0x4d414f(0x210)][_0x4d414f(0x218)]);}}async[_0x26bd78(0x22a)](_0x5d3895){const _0x384260=_0x26bd78;try{const {id:_0x392bc5,name:_0x401c86,cover:_0x4bb0cc,description:_0x3a5c9c,disabled:_0x10c864}=_0x5d3895,_0x587f4c={};return _0x401c86&&(_0x587f4c[_0x384260(0x1d2)]=_0x401c86),_0x4bb0cc&&(_0x587f4c[_0x384260(0x134)]=_0x4bb0cc),_0x3a5c9c&&(_0x587f4c[_0x384260(0x1a7)]=_0x3a5c9c),_0x10c864&&(_0x587f4c[_0x384260(0x1e6)]=_0x10c864),await this[_0x384260(0x247)][_0x384260(0x27d)]({'id':_0x392bc5},_0x587f4c),!![];}catch(_0x598445){throw new common_1['HttpException'](_0x598445['message'],common_1[_0x384260(0x210)][_0x384260(0x218)]);}}async[_0x26bd78(0x2d9)](_0x433efd){const _0x23eff1=_0x26bd78,_0x3008f3=_0x433efd['split'](',');if(!_0x433efd['length'])throw new common_1[(_0x23eff1(0x1e8))](_0x23eff1(0x1db),common_1[_0x23eff1(0x210)][_0x23eff1(0x218)]);return this[_0x23eff1(0x247)][_0x23eff1(0x2f9)]({'where':{'id':(0x0,typeorm_2['In'])(_0x3008f3),'disabled':0x0}});}async[_0x26bd78(0x2cf)](_0x3b1c2d,_0x2d3407){const _0x2154c4=_0x26bd78;try{const _0x248151=await this[_0x2154c4(0x2bb)]['getModelById'](_0x2d3407[_0x2154c4(0x290)]);if(!_0x248151['status'])throw new Error(_0x2154c4(0x19b));let _0x603f6a;const _0x16aa4a=(0x0,utils_1['getReqSaasId'])(this[_0x2154c4(0x2aa)]);return await this[_0x2154c4(0x2b7)]['transaction'](async()=>{const _0x32f712=_0x2154c4;_0x603f6a=await this['addDrawQueue']({'originPrompt':'','saasId':_0x16aa4a,'userId':_0x3b1c2d[_0x32f712(0x2de)]['id'],'mode':midjourney_constant_1[_0x32f712(0x25c)][_0x32f712(0x223)],'botType':DrawTaskPage_dto_1['EBotType'][_0x32f712(0x2a4)],'workflowId':_0x2d3407[_0x32f712(0x290)],'fullPrompt':JSON[_0x32f712(0x133)](_0x2d3407[_0x32f712(0x1c4)])}),await this[_0x32f712(0x16c)]['deductBalance4WorkFlow'](_0x3b1c2d[_0x32f712(0x2de)]['id'],_0x248151,_0x603f6a['id']);const _0x31f1d3=await this[_0x32f712(0x19e)][_0x32f712(0x1f3)]({'data':{'workflowId':Number(_0x248151['model']),'versionId':Number(_0x248151[_0x32f712(0x153)]),'inputs':_0x2d3407[_0x32f712(0x1c4)]}});_0x603f6a[_0x32f712(0x2fb)]=_0x31f1d3[_0x32f712(0x2c2)],await this[_0x32f712(0x299)][_0x32f712(0x27d)]({'id':_0x603f6a['id']},{'mjpTaskId':_0x31f1d3['taskId']});}),_0x603f6a;}catch(_0x32244a){throw new common_1[(_0x2154c4(0x1e8))](_0x32244a[_0x2154c4(0x183)],common_1[_0x2154c4(0x210)][_0x2154c4(0x218)]);}}async[_0x26bd78(0x260)](_0x24ee39,_0x12509f){const _0x1f0ec0=_0x26bd78,{page:page=0x1,size:size=0x14}=_0x12509f,[_0x493c33]=await this['connection']['query'](_0x1f0ec0(0x296)+_0x24ee39[_0x1f0ec0(0x2de)]['id']+_0x1f0ec0(0x184)),_0x573787=await this[_0x1f0ec0(0x2b7)][_0x1f0ec0(0x188)](_0x1f0ec0(0x165)+_0x24ee39[_0x1f0ec0(0x2de)]['id']+'\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.createdAt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+size+_0x1f0ec0(0x189)+(page-0x1)*size+_0x1f0ec0(0x1d6));return{'rows':_0x573787,'count':Number(_0x493c33?.[_0x1f0ec0(0x124)]||0x0)};}async['workflowFavorite'](_0x2d3fba,_0xd6e845){const _0x254936=_0x26bd78,_0x2ab4ac=_0x2d3fba[_0x254936(0x2de)]['id'],{page:page=0x1,size:size=0x14}=_0xd6e845,[_0x46de3e]=await this[_0x254936(0x2b7)][_0x254936(0x188)](_0x254936(0x174)+_0x2d3fba[_0x254936(0x2de)]['id']+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27'+user_constant_1['EFavorite'][_0x254936(0x2a4)]+_0x254936(0x1af)),_0x5c65a8=await this[_0x254936(0x2b7)][_0x254936(0x188)](_0x254936(0x240)+_0x2d3fba[_0x254936(0x2de)]['id']+_0x254936(0x2e1)+user_constant_1[_0x254936(0x194)][_0x254936(0x2a4)]+_0x254936(0x169)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x254936(0x1d6));if(_0x2d3fba['user']['id']){const _0x3f239a=await this['userService'][_0x254936(0x26c)](_0x2ab4ac);if(_0x3f239a['vipExpire']||_0x3f239a['lifetimeVip'])for(let _0x3b8b54=0x0;_0x3b8b54<_0x5c65a8['length'];_0x3b8b54++){const _0x52be9b=_0x5c65a8[_0x3b8b54],_0x486160=redisKey_constant_1[_0x254936(0x2dd)]+'-'+_0x2ab4ac+'-'+_0x52be9b['id'],_0x1f7714=await await this[_0x254936(0x236)][_0x254936(0x2a0)]({'key':_0x486160});_0x52be9b['freeUsed']=Number(_0x1f7714||0x0);}}return{'rows':_0x5c65a8,'count':_0x46de3e?.[_0x254936(0x124)]||0x0};}async['sdTaskSubmit'](_0x5a15fd,_0x1b00d0){const _0x4912f3=_0x26bd78;try{let _0x27f9e6;const _0x291e31=(0x0,utils_1[_0x4912f3(0x14b)])(this[_0x4912f3(0x2aa)]);return await this[_0x4912f3(0x2b7)][_0x4912f3(0x20e)](async()=>{const _0xa7e1e1=_0x4912f3;_0x27f9e6=await this['addDrawQueue']({'saasId':_0x291e31,'userId':_0x5a15fd[_0xa7e1e1(0x2de)]['id'],'mode':midjourney_constant_1['DrawSpeed'][_0xa7e1e1(0x223)],'botType':DrawTaskPage_dto_1['EBotType']['SD'],'originPrompt':_0x1b00d0['prompt'],'fullPrompt':JSON[_0xa7e1e1(0x133)](_0x1b00d0)}),await this[_0xa7e1e1(0x16c)][_0xa7e1e1(0x257)](_0x5a15fd[_0xa7e1e1(0x2de)]['id'],_0x27f9e6['id']);const _0x4bd7ac=await this[_0xa7e1e1(0x19e)][_0xa7e1e1(0x1c9)]({'data':_0x1b00d0});_0x27f9e6[_0xa7e1e1(0x2fb)]=_0x4bd7ac[_0xa7e1e1(0x2cb)],await this['midjourneyEntity'][_0xa7e1e1(0x27d)]({'id':_0x27f9e6['id']},{'mjpTaskId':_0x4bd7ac[_0xa7e1e1(0x2cb)]});}),_0x27f9e6;}catch(_0x200e3f){throw new common_1[(_0x4912f3(0x1e8))](_0x200e3f[_0x4912f3(0x183)],common_1[_0x4912f3(0x210)][_0x4912f3(0x218)]);}}async[_0x26bd78(0x2a5)](_0x443793,_0x2d3056){const _0x24b59f=_0x26bd78;try{const _0x3a3e7b=await this[_0x24b59f(0x299)][_0x24b59f(0x14e)]({'where':{'id':Number(_0x2d3056['taskId'])}});if(!_0x3a3e7b)throw new Error('原始任务不存在！');let _0x315180;const _0x353b18=(0x0,utils_1[_0x24b59f(0x14b)])(this[_0x24b59f(0x2aa)]);return await this[_0x24b59f(0x2b7)][_0x24b59f(0x20e)](async()=>{const _0x4a2aef=_0x24b59f;_0x315180=await this['addDrawQueue']({'saasId':_0x353b18,'userId':_0x443793[_0x4a2aef(0x2de)]['id'],'mode':midjourney_constant_1[_0x4a2aef(0x25c)][_0x4a2aef(0x223)],'botType':DrawTaskPage_dto_1[_0x4a2aef(0x224)]['SD'],'originPrompt':_0x2d3056[_0x4a2aef(0x2ba)],'originTaskId':_0x2d3056[_0x4a2aef(0x2c2)],'fullPrompt':JSON[_0x4a2aef(0x133)](_0x2d3056)}),await this[_0x4a2aef(0x16c)][_0x4a2aef(0x257)](_0x443793['user']['id'],_0x315180['id']);const _0x262cac=await this[_0x4a2aef(0x19e)][_0x4a2aef(0x20d)]({'data':{'mask':_0x2d3056[_0x4a2aef(0x27c)],'prompt':_0x2d3056[_0x4a2aef(0x2ba)],'taskId':_0x3a3e7b[_0x4a2aef(0x2fb)],'denoisingStrength':_0x2d3056[_0x4a2aef(0x2f4)]}});_0x315180[_0x4a2aef(0x2fb)]=_0x262cac[_0x4a2aef(0x2cb)],await this[_0x4a2aef(0x299)][_0x4a2aef(0x27d)]({'id':_0x315180['id']},{'mjpTaskId':_0x262cac[_0x4a2aef(0x2cb)]});}),_0x315180;}catch(_0x3ab215){throw new common_1[(_0x24b59f(0x1e8))](_0x3ab215[_0x24b59f(0x183)],common_1[_0x24b59f(0x210)][_0x24b59f(0x218)]);}}async[_0x26bd78(0x1a1)](_0x4bb59c){const _0x1f0edf=_0x26bd78,{id:_0x2bf5d9,favorite:_0x44fb51}=_0x4bb59c,_0x2dab6b=await this[_0x1f0edf(0x299)]['findOne']({'where':{'id':_0x2bf5d9}})[_0x1f0edf(0x20c)](_0x1a9647=>{const _0x31627e=_0x1f0edf;common_1[_0x31627e(0x301)][_0x31627e(0x2b4)](_0x1a9647);});if(!_0x2dab6b)throw new common_1['HttpException']('当前图片不存在！',common_1[_0x1f0edf(0x210)]['BAD_REQUEST']);const _0x411d96=await this[_0x1f0edf(0x299)][_0x1f0edf(0x27d)]({'id':_0x2bf5d9},{'favorite':_0x44fb51});if(_0x411d96[_0x1f0edf(0x1a8)]<=0x0)throw new common_1['HttpException'](_0x1f0edf(0x280),common_1[_0x1f0edf(0x210)]['BAD_REQUEST']);return!![];}async[_0x26bd78(0x2bc)](_0x5cd8c2,_0x2ade66){const _0x46a92f=_0x26bd78,{page:page=0x1,size:size=0x14}=_0x5cd8c2,[_0x34c6d9,_0x40c748]=await this[_0x46a92f(0x299)][_0x46a92f(0x26a)]({'where':{'userId':_0x2ade66[_0x46a92f(0x2de)]['id'],'favorite':0x1},'take':size,'skip':(page-0x1)*size,'order':{'createdAt':'DESC'}});return{'rows':_0x34c6d9,'count':_0x40c748};}async[_0x26bd78(0x161)](_0x2d984e,_0x4922d7){const _0x3b1a7c=_0x26bd78;try{const _0x589bc4=await this['midjourneyEntity']['findOne']({'where':{'id':_0x2d984e,'userId':_0x4922d7[_0x3b1a7c(0x2de)]['id']}});if(!_0x589bc4)throw new Error(_0x3b1a7c(0x233));if(_0x589bc4[_0x3b1a7c(0x22d)]===midjourney_constant_1[_0x3b1a7c(0x203)][_0x3b1a7c(0x1d8)])throw new Error('绘制中的图片任务、禁止删除！');await this[_0x3b1a7c(0x196)][_0x3b1a7c(0x2f5)](null,_0x589bc4[_0x3b1a7c(0x2fb)]);const _0x5e81f9=await this[_0x3b1a7c(0x299)][_0x3b1a7c(0x1d1)]({'id':_0x2d984e});if(_0x5e81f9[_0x3b1a7c(0x1a8)]>0x0)return _0x3b1a7c(0x2c5);else throw new Error('删除失败！');}catch(_0x13bea8){throw new common_1['HttpException'](_0x13bea8[_0x3b1a7c(0x183)],common_1[_0x3b1a7c(0x210)]['BAD_REQUEST']);}}async[_0x26bd78(0x192)](_0x38dbc8,_0x5210d6){const _0x4c0b6d=_0x26bd78,{id:_0x4a7559}=_0x5210d6;if(!_0x4a7559)throw new common_1[(_0x4c0b6d(0x1e8))]('非法操作！',common_1[_0x4c0b6d(0x210)][_0x4c0b6d(0x218)]);const _0x40fc6d=await this['midjourneyEntity']['delete']({'id':_0x4a7559});if(_0x40fc6d[_0x4c0b6d(0x1a8)]<=0x0)throw new common_1['HttpException'](_0x4c0b6d(0x177),common_1[_0x4c0b6d(0x210)][_0x4c0b6d(0x218)]);return!![];}async[_0x26bd78(0x1f9)](_0x518c22,_0x5b356d){const _0x554486=_0x26bd78;try{const {prompt:_0x885c31,status:_0x5cdc13,isCarryParams:_0x41eef7,imageUrl:_0x32b691,title:_0xe9cdc9,order:_0x1ba309,id:_0x4b21d8,aspect:_0x335911}=_0x5b356d;if(_0x4b21d8)return await this[_0x554486(0x254)]['update']({'id':_0x4b21d8},{'title':_0xe9cdc9,'prompt':_0x885c31,'imageUrl':_0x32b691,'status':_0x5cdc13,'isCarryParams':_0x41eef7,'order':_0x1ba309,'aspect':_0x335911})[_0x554486(0x2dc)](_0x34de82=>!!_0x34de82);else{const _0x12efb8=(0x0,utils_1['getReqSaasId'])(this[_0x554486(0x2aa)]);return await this['mjPromptsEntity'][_0x554486(0x1f6)]({'prompt':_0x885c31,'status':_0x5cdc13,'imageUrl':_0x32b691,'isCarryParams':_0x41eef7,'title':_0xe9cdc9,'order':_0x1ba309,'aspect':_0x335911,'saasId':_0x12efb8})[_0x554486(0x2dc)](_0x6dbfa0=>!!_0x6dbfa0);}}catch(_0x173340){console[_0x554486(0x1c5)](_0x554486(0x2b8),_0x173340);}}async[_0x26bd78(0x1c2)](_0x25841e,_0x33d205){const _0x380946=_0x26bd78,{id:_0x426d58}=_0x33d205;if(!_0x426d58)throw new common_1[(_0x380946(0x1e8))](_0x380946(0x2fd),common_1[_0x380946(0x210)][_0x380946(0x218)]);return await this[_0x380946(0x254)][_0x380946(0x1d1)]({'id':_0x426d58});}async[_0x26bd78(0x22b)](){const _0x232a45=_0x26bd78,_0x18215b=(0x0,utils_1[_0x232a45(0x14b)])(this['clsService']);return await this[_0x232a45(0x254)][_0x232a45(0x2f9)]({'where':{'saasId':_0x18215b},'order':{'order':_0x232a45(0x1b7)}})[_0x232a45(0x2dc)](_0x6db8d7=>_0x6db8d7||[])[_0x232a45(0x20c)](_0x39841d=>{common_1['Logger']['error'](_0x39841d);});}async[_0x26bd78(0x2e5)](_0x391c0d){const _0x4ea0fd=_0x26bd78;try{const {page:_0x391a22,size:_0x2617f0,keyword:_0x531963,saasId:_0x346aec}=_0x391c0d,_0x34a672=(0x0,utils_1['getReqSaasId'])(this[_0x4ea0fd(0x2aa)]),_0x426f35={'status':!![]};(0x0,utils_1[_0x4ea0fd(0x127)])(this['clsService'])?(0x0,utils_1['isDefined'])(_0x346aec)&&(_0x426f35[_0x4ea0fd(0x2a7)]=_0x346aec):_0x426f35[_0x4ea0fd(0x2a7)]=_0x34a672;const [_0x3abd41,_0x1ca3bf]=await this['mjPromptsEntity'][_0x4ea0fd(0x26a)]({'where':[{..._0x426f35,'title':(0x0,typeorm_2[_0x4ea0fd(0x2d8)])('%'+_0x531963+'%')},{..._0x426f35,'prompt':(0x0,typeorm_2[_0x4ea0fd(0x2d8)])('%'+_0x531963+'%')}],'take':_0x2617f0,'skip':(_0x391a22-0x1)*_0x2617f0,'order':{'order':_0x4ea0fd(0x1b7)}});return{'rows':_0x3abd41,'count':_0x1ca3bf};}catch(_0x8bba29){throw new common_1[(_0x4ea0fd(0x1e8))](_0x8bba29[_0x4ea0fd(0x183)],common_1[_0x4ea0fd(0x210)][_0x4ea0fd(0x218)]);}}async['addMjInspireClassify'](_0x2c356d){const _0x87b764=_0x26bd78;try{const {name:_0x221e13,value:_0x1dd738}=_0x2c356d,_0xf56c39=(0x0,utils_1['getReqSaasId'])(this['clsService']),_0x1d862f=await this['mjInspireClassifyEntity'][_0x87b764(0x2f0)]({'name':_0x221e13,'saasId':_0xf56c39});if(_0x1d862f)throw new common_1[(_0x87b764(0x1e8))](_0x87b764(0x235),common_1[_0x87b764(0x210)]['BAD_REQUEST']);return await this[_0x87b764(0x12f)][_0x87b764(0x1f6)]({'name':_0x221e13,'value':_0x1dd738,'saasId':_0xf56c39})[_0x87b764(0x2dc)](_0x1541f0=>!!_0x1541f0)['catch'](_0x31fdcd=>{const _0x3c351d=_0x87b764;console[_0x3c351d(0x1c5)](_0x31fdcd);throw new common_1[(_0x3c351d(0x1e8))](_0x31fdcd,common_1['HttpStatus'][_0x3c351d(0x218)]);});}catch(_0xd69411){return![];}}async[_0x26bd78(0x2ab)](_0x1413a9){const _0xb637c=_0x26bd78,{id:_0x54fb85,name:_0xe1ba88,value:_0x57a752}=_0x1413a9;return await this['mjInspireClassifyEntity']['update'](_0x54fb85,{'name':_0xe1ba88,'value':_0x57a752})[_0xb637c(0x2dc)](_0x1fac08=>!!_0x1fac08);}async[_0x26bd78(0x15f)](_0x4fd458){const _0x14c75e=_0x26bd78,{id:_0x529a78}=_0x4fd458;return await this[_0x14c75e(0x12f)]['delete']({'id':_0x529a78})[_0x14c75e(0x20c)](_0xa43527=>{const _0x56460a=_0x14c75e;throw new common_1['HttpException'](_0xa43527,common_1[_0x56460a(0x210)]['BAD_REQUEST']);});}async[_0x26bd78(0x198)](_0x1bc4b7){const _0x33da34=_0x26bd78,{size:_0x43639d,page:_0x1aa92e,saasId:_0x52e7c0}=_0x1bc4b7,_0x3abe97=(0x0,utils_1['getReqSaasId'])(this[_0x33da34(0x2aa)]),_0x30c814={};(0x0,utils_1[_0x33da34(0x127)])(this['clsService'])?(0x0,utils_1[_0x33da34(0x20a)])(_0x52e7c0)&&(_0x30c814[_0x33da34(0x2a7)]=_0x52e7c0):_0x30c814['saasId']=_0x3abe97;const _0x4fb905=await this['mjInspireClassifyEntity'][_0x33da34(0x26a)]({'where':_0x30c814,'order':{'createdAt':_0x33da34(0x1b7)},'take':_0x43639d,'skip':(_0x1aa92e-0x1)*_0x43639d})[_0x33da34(0x20c)](_0x581e57=>{const _0x5e3527=_0x33da34;throw new common_1[(_0x5e3527(0x1e8))](_0x581e57,common_1[_0x5e3527(0x210)][_0x5e3527(0x218)]);});if(!_0x4fb905)throw new common_1[(_0x33da34(0x1e8))](_0x33da34(0x230),common_1[_0x33da34(0x210)][_0x33da34(0x218)]);const [_0x13223f,_0x3256a3]=_0x4fb905;return{'rows':_0x13223f,'count':_0x3256a3};}async[_0x26bd78(0x2f7)](_0x1e7aad){const _0x3af390=_0x26bd78,{id:_0x233faa}=_0x1e7aad;return await this[_0x3af390(0x12f)][_0x3af390(0x14e)]({'where':{'id':_0x233faa}});}async[_0x26bd78(0x269)](_0x372f8f){const _0xfe5e6d=_0x26bd78;try{const _0x4edfb0=(0x0,utils_1[_0xfe5e6d(0x14b)])(this[_0xfe5e6d(0x2aa)]),{classifyName:_0x58a68f,level:_0x4db0b8,type:_0x17ba13,pid:pid=0x0}=_0x372f8f;return await this[_0xfe5e6d(0x1b5)]['save']({'classifyName':_0x58a68f,'level':_0x4db0b8,'type':_0x17ba13,'pid':pid,'saasId':_0x4edfb0})[_0xfe5e6d(0x2dc)](_0x3bdcc5=>!!_0x3bdcc5)[_0xfe5e6d(0x20c)](_0x3080b6=>{const _0x313ce2=_0xfe5e6d;console[_0x313ce2(0x1c5)](_0x3080b6);throw new common_1['HttpException'](_0x3080b6,common_1[_0x313ce2(0x210)][_0x313ce2(0x218)]);});}catch(_0x1b2e1d){return![];}}async[_0x26bd78(0x24d)](_0x18bea8){const _0x10c1b9=_0x26bd78,{id:_0x2e4218,classifyName:_0x975e76,level:_0x4824cd,type:_0x4cf776,pid:_0x4c7182}=_0x18bea8;return this[_0x10c1b9(0x2b7)][_0x10c1b9(0x20e)](async()=>{const _0x562ebe=_0x10c1b9,_0x21b44e=await this[_0x562ebe(0x1b5)][_0x562ebe(0x14e)]({'where':{'id':_0x2e4218}});_0x21b44e['type']!==_0x4cf776&&await this[_0x562ebe(0x1b5)][_0x562ebe(0x27d)]({'pid':_0x2e4218},{'type':_0x4cf776}),await this['mjIncantationClassifyEntity'][_0x562ebe(0x27d)](_0x2e4218,{'classifyName':_0x975e76,'level':_0x4824cd,'type':_0x4cf776,'pid':_0x4c7182});}),!![];}async[_0x26bd78(0x227)](_0x324884){const _0x1ff7bc=_0x26bd78,{id:_0x3fae48}=_0x324884;return await this[_0x1ff7bc(0x1b5)][_0x1ff7bc(0x1d1)]({'id':_0x3fae48})[_0x1ff7bc(0x2dc)](_0xe97ea0=>_0xe97ea0[_0x1ff7bc(0x1a8)]>0x0);}async['getMjIncantationClassify'](_0x5c9256){const _0x3bfbbb=_0x26bd78,{id:_0x4d6f2c}=_0x5c9256;return await this[_0x3bfbbb(0x1b5)]['findOne']({'where':{'id':_0x4d6f2c}});}async[_0x26bd78(0x2c0)](){const _0x422ca3=_0x26bd78,_0x29927b=(0x0,utils_1[_0x422ca3(0x14b)])(this[_0x422ca3(0x2aa)]);return this[_0x422ca3(0x1b5)][_0x422ca3(0x2f9)]({'where':{'level':0x1,'saasId':_0x29927b}});}async[_0x26bd78(0x282)](_0xbdc76f){const _0x17807f=_0x26bd78,{size:_0x5ce339,page:_0x3ef93d,type:_0x5db55e,keyword:_0x5bc633,level:_0x39fa14,saasId:_0x2194b0}=_0xbdc76f,_0x466fc8=(0x0,utils_1[_0x17807f(0x14b)])(this[_0x17807f(0x2aa)]);let _0x142504={};_0x39fa14>0x0&&(_0x142504[_0x17807f(0x1e7)]=_0x39fa14);_0x5db55e&&(_0x142504[_0x17807f(0x1a9)]=_0x5db55e);_0x5bc633&&(_0x142504[_0x17807f(0x151)]=(0x0,typeorm_2[_0x17807f(0x2d8)])('%'+_0x5bc633+'%'));(0x0,utils_1[_0x17807f(0x127)])(this['clsService'])?(0x0,utils_1[_0x17807f(0x20a)])(_0x2194b0)&&(_0x142504['saasId']=_0x2194b0):_0x142504['saasId']=_0x466fc8;const _0x27128c=await this[_0x17807f(0x1b5)][_0x17807f(0x26a)]({'order':{'createdAt':'DESC'},'where':_0x142504,'take':_0x5ce339,'skip':(_0x3ef93d-0x1)*_0x5ce339})['catch'](_0xd78f68=>{console['log'](_0xd78f68);});if(!_0x27128c)throw new common_1[(_0x17807f(0x1e8))](_0x17807f(0x2e3),common_1['HttpStatus'][_0x17807f(0x218)]);const [_0x8f6f9,_0x2dbb6b]=_0x27128c;return{'rows':_0x8f6f9,'count':_0x2dbb6b};}async['queryMjIncantationClassifyAllByLevel'](_0x3babb8){const _0x190a81=_0x26bd78,{level:_0x205f66,type:_0x5b7505,saasId:_0x146782}=_0x3babb8,_0xfdea7e=(0x0,utils_1[_0x190a81(0x14b)])(this[_0x190a81(0x2aa)]),_0x18b4af={};_0x205f66===0x0?_0x18b4af[_0x190a81(0x1e7)]=(0x0,typeorm_2['MoreThan'])(_0x205f66):_0x18b4af[_0x190a81(0x1e7)]=_0x205f66;_0x5b7505&&(_0x18b4af[_0x190a81(0x1a9)]=_0x5b7505);(0x0,utils_1[_0x190a81(0x127)])(this[_0x190a81(0x2aa)])?(0x0,utils_1[_0x190a81(0x20a)])(_0x146782)&&(_0x18b4af['saasId']=_0x146782):_0x18b4af[_0x190a81(0x2a7)]=_0xfdea7e;const _0x33f8fc=await this['mjIncantationClassifyEntity'][_0x190a81(0x19c)](_0x18b4af)[_0x190a81(0x20c)](_0x9bfc21=>{console['log'](_0x9bfc21);});if(!_0x33f8fc)throw new common_1['HttpException'](_0x190a81(0x2e3),common_1[_0x190a81(0x210)][_0x190a81(0x218)]);if(_0x205f66===0x0)return{'level1':_0x33f8fc[_0x190a81(0x246)](_0x100717=>_0x100717[_0x190a81(0x1e7)]===0x1),'level2':_0x33f8fc['filter'](_0x2f16b4=>_0x2f16b4[_0x190a81(0x1e7)]===0x2)};return _0x33f8fc;}async[_0x26bd78(0x23b)](_0x30020b){const _0x47dde2=_0x26bd78;try{const _0x12d90f=(0x0,utils_1['getReqSaasId'])(this[_0x47dde2(0x2aa)]),{incantationEn:_0x5e5afc,incantationCn:_0x34caa4,img:_0x479a8a,pid:_0x24e884}=_0x30020b;return await this[_0x47dde2(0x2ed)]['save']({'incantationEn':_0x5e5afc,'incantationCn':_0x34caa4,'img':_0x479a8a,'pid':_0x24e884,'saasId':_0x12d90f})[_0x47dde2(0x2dc)](_0x591a26=>!!_0x591a26)['catch'](_0x36dcdb=>{throw _0x36dcdb;});}catch(_0xfd0b8){return console['log'](_0xfd0b8),![];}}async[_0x26bd78(0x24f)](_0x46553c){const _0x4a7144=_0x26bd78,{id:_0x33fa55,incantationEn:_0xbd40d2,incantationCn:_0x1e48d8,img:_0x495c71,pid:_0x154d63}=_0x46553c;return await this[_0x4a7144(0x2ed)]['update'](_0x33fa55,{'incantationCn':_0x1e48d8,'incantationEn':_0xbd40d2,'img':_0x495c71,'pid':_0x154d63});}async[_0x26bd78(0x22c)](_0x58f4de){const _0xd0e1ab=_0x26bd78,{id:_0x151c49}=_0x58f4de;return await this['mjIncantationEntity'][_0xd0e1ab(0x1d1)]({'id':_0x151c49})[_0xd0e1ab(0x2dc)](_0x4255bc=>_0x4255bc[_0xd0e1ab(0x1a8)]>0x0);}async[_0x26bd78(0x20f)](_0x393dee){const _0x46cbc2=_0x26bd78,{id:_0xb10d72}=_0x393dee;return await this[_0x46cbc2(0x2ed)]['findOne']({'where':{'id':_0xb10d72}});}async['queryMjIncantation'](_0x2ddd96){const _0x1eb9f6=_0x26bd78,_0x22eb54=(0x0,utils_1[_0x1eb9f6(0x14b)])(this[_0x1eb9f6(0x2aa)]),{size:_0x599fe7,page:_0x5a3f4d,keyword:_0x3e5a25,pid:_0x5c8370,saasId:_0x17d011}=_0x2ddd96;let _0x2f18c2={};_0x5c8370>0x0&&(_0x2f18c2[_0x1eb9f6(0x149)]=_0x5c8370);_0x3e5a25&&(_0x2f18c2['incantationCn']=(0x0,typeorm_2[_0x1eb9f6(0x2d8)])('%'+_0x3e5a25+'%'));(0x0,utils_1['isPlatform'])(this[_0x1eb9f6(0x2aa)])?(0x0,utils_1['isDefined'])(_0x17d011)&&(_0x2f18c2[_0x1eb9f6(0x2a7)]=_0x17d011):_0x2f18c2[_0x1eb9f6(0x2a7)]=_0x22eb54;const _0x325f44=await this[_0x1eb9f6(0x2ed)][_0x1eb9f6(0x26a)]({'order':{'createdAt':_0x1eb9f6(0x1b7)},'where':_0x2f18c2,'take':_0x599fe7,'skip':(_0x5a3f4d-0x1)*_0x599fe7})[_0x1eb9f6(0x20c)](_0x43c35b=>{console['log'](_0x43c35b);});if(!_0x325f44)throw new common_1[(_0x1eb9f6(0x1e8))]('查询咒语失败',common_1[_0x1eb9f6(0x210)][_0x1eb9f6(0x218)]);const [_0x563c64,_0x7448c5]=_0x325f44;return{'rows':_0x563c64,'count':_0x7448c5};}async[_0x26bd78(0x2e4)](_0x247407){const _0x20799e=_0x26bd78,{id:_0x88c63d}=_0x247407,_0x3ac438=await this[_0x20799e(0x1b5)][_0x20799e(0x14e)]({'where':{'level':0x1,'id':_0x88c63d}})[_0x20799e(0x20c)](_0x3dbe75=>{const _0x32ef06=_0x20799e;common_1['Logger'][_0x32ef06(0x2b4)](_0x3dbe75);});if(!_0x3ac438)throw new common_1[(_0x20799e(0x1e8))](_0x20799e(0x28e),common_1[_0x20799e(0x210)][_0x20799e(0x218)]);const _0x3ef2fd=await this[_0x20799e(0x1b5)][_0x20799e(0x2f9)]({'where':{'level':0x2,'pid':_0x3ac438['id']}})[_0x20799e(0x20c)](_0xb2dde1=>{const _0x133b5f=_0x20799e;common_1[_0x133b5f(0x301)][_0x133b5f(0x2b4)](_0xb2dde1);});if(!_0x3ef2fd||_0x3ef2fd[_0x20799e(0x2a8)]===0x0)return{'rows':[]};const _0x46639f=_0x3ef2fd[_0x20799e(0x1b6)](_0x594350=>_0x594350['id']),_0x4d0df7=await this[_0x20799e(0x2ed)][_0x20799e(0x2f9)]({'where':{'pid':(0x0,typeorm_2['In'])(_0x46639f)}})[_0x20799e(0x20c)](_0x80b09a=>{const _0x43f62f=_0x20799e;common_1[_0x43f62f(0x301)][_0x43f62f(0x2b4)](_0x80b09a);});if(!_0x4d0df7)throw new common_1[(_0x20799e(0x1e8))](_0x20799e(0x1df),common_1[_0x20799e(0x210)][_0x20799e(0x218)]);const _0x1a89c9=_0x3ef2fd[_0x20799e(0x1b6)](_0x3e33c6=>{const _0x3fed0b=_0x20799e;return{'children':_0x4d0df7[_0x3fed0b(0x246)](_0x7f224c=>_0x7f224c[_0x3fed0b(0x149)]===_0x3e33c6['id'])||[],..._0x3e33c6};});return{'rows':_0x1a89c9};}async[_0x26bd78(0x2cd)](){const _0x10ca5c=_0x26bd78,_0x40bbb5=(0x0,utils_1[_0x10ca5c(0x14b)])(this[_0x10ca5c(0x2aa)]),_0x5ab9b6=await this['mjIncantationEntity'][_0x10ca5c(0x2f9)]({'where':{'saasId':_0x40bbb5},'order':{'createdAt':'DESC'}})[_0x10ca5c(0x20c)](_0x2f712f=>{const _0x293f9f=_0x10ca5c;console[_0x293f9f(0x1c5)](_0x2f712f);});if(!_0x5ab9b6)throw new common_1['HttpException'](_0x10ca5c(0x1df),common_1[_0x10ca5c(0x210)][_0x10ca5c(0x218)]);return _0x5ab9b6;}async[_0x26bd78(0x28a)](_0x5846a7){const _0xc1747=_0x26bd78,_0x416072=(0x0,utils_1[_0xc1747(0x14b)])(this[_0xc1747(0x2aa)]),{id:_0x33dc9d,suggestCn:_0x1f56c6,suggestEn:_0x21f5dc,order:_0x118d24,image:_0x340e86}=_0x5846a7,_0xabaaca=await this[_0xc1747(0x268)][_0xc1747(0x14e)]({'where':{'suggestCn':_0x1f56c6,'saasId':_0x416072}});if(_0x33dc9d){if(_0xabaaca&&_0xabaaca['id']!==_0x33dc9d)throw new common_1[(_0xc1747(0x1e8))](_0xc1747(0x27b),common_1['HttpStatus'][_0xc1747(0x218)]);}else{if(_0xabaaca)throw new common_1[(_0xc1747(0x1e8))](_0xc1747(0x27b),common_1[_0xc1747(0x210)]['BAD_REQUEST']);}const _0x167027=await this['mjSuggestWordEntity'][_0xc1747(0x1f6)]({'id':_0x33dc9d,'suggestCn':_0x1f56c6,'suggestEn':_0x21f5dc,'order':_0x118d24||0x64,'image':_0x340e86||'','saasId':_0x416072})['then'](_0x59fd8e=>!!_0x59fd8e['id'])['catch'](_0x72857c=>{const _0x2925be=_0xc1747;console[_0x2925be(0x1c5)](_0x72857c);});if(!_0x167027)throw new common_1[(_0xc1747(0x1e8))](_0xc1747(0x26e),common_1[_0xc1747(0x210)][_0xc1747(0x218)]);return _0x167027;}async['removeSuggestWords'](_0x86847a){const _0x6dc4cc=_0x26bd78,{id:_0x5bd623}=_0x86847a,_0x51c963=await this[_0x6dc4cc(0x268)][_0x6dc4cc(0x2b6)]({'where':{'id':_0x5bd623}});if(!_0x51c963)throw new common_1[(_0x6dc4cc(0x1e8))](_0x6dc4cc(0x22e),common_1[_0x6dc4cc(0x210)]['BAD_REQUEST']);const _0x24b9b5=await this[_0x6dc4cc(0x268)][_0x6dc4cc(0x1d1)](_0x5bd623)['then'](_0x1d651e=>_0x1d651e[_0x6dc4cc(0x1a8)]>0x0)[_0x6dc4cc(0x20c)](_0x5a7a76=>{console['log'](_0x5a7a76);});if(!_0x24b9b5)throw new common_1[(_0x6dc4cc(0x1e8))](_0x6dc4cc(0x1a0),common_1[_0x6dc4cc(0x210)][_0x6dc4cc(0x218)]);return _0x24b9b5;}async['querySuggestWords'](_0x2a6267){const _0x19660d=_0x26bd78;let _0x507f61={};const {page:_0x50ebd0,size:_0x4b36c8,saasId:_0x374633}=_0x2a6267,_0x40edb8=(0x0,utils_1['getReqSaasId'])(this[_0x19660d(0x2aa)]);(0x0,utils_1[_0x19660d(0x127)])(this['clsService'])?(0x0,utils_1[_0x19660d(0x20a)])(_0x374633)&&(_0x507f61[_0x19660d(0x2a7)]=_0x374633):_0x507f61[_0x19660d(0x2a7)]=_0x40edb8;const _0x1f0622=await this['mjSuggestWordEntity'][_0x19660d(0x26a)]({'where':_0x507f61,'take':_0x4b36c8,'skip':(_0x50ebd0-0x1)*_0x4b36c8,'order':{'order':_0x19660d(0x1b7)}})[_0x19660d(0x2dc)](([_0x4c8f88,_0x1712d9])=>({'rows':_0x4c8f88,'count':_0x1712d9}))['catch'](_0x544135=>{console['log'](_0x544135);});if(!_0x1f0622)throw new common_1[(_0x19660d(0x1e8))](_0x19660d(0x17c),common_1[_0x19660d(0x210)][_0x19660d(0x218)]);return _0x1f0622;}async['drawSquarePage'](_0x965d29){const _0x11d3c7=_0x26bd78,_0x40d4f7=await this[_0x11d3c7(0x1a6)]({'rec':_0x965d29[_0x11d3c7(0x2d7)],'page':_0x965d29[_0x11d3c7(0x164)],'size':_0x965d29['size'],'status':_0x965d29[_0x11d3c7(0x22d)],'keyword':_0x965d29[_0x11d3c7(0x1da)],'squareType':_0x965d29['squareType']});return _0x40d4f7[_0x11d3c7(0x2c6)][_0x11d3c7(0x24e)](_0x6cef5a=>{const _0x2a0f53=_0x11d3c7;_0x6cef5a[_0x2a0f53(0x1c8)]=_0x6cef5a['fileInfo']?JSON[_0x2a0f53(0x1e2)](_0x6cef5a[_0x2a0f53(0x1c8)]):{};}),_0x40d4f7;}[_0x26bd78(0x209)](_0x245049){const _0x59fb9e=_0x26bd78;if(!_0x245049)return _0x59fb9e(0x223);if(_0x245049===midjourney_constant_1[_0x59fb9e(0x25c)][_0x59fb9e(0x223)])return'fast';if(_0x245049===midjourney_constant_1[_0x59fb9e(0x25c)][_0x59fb9e(0x176)])return'relax';if(_0x245049===midjourney_constant_1[_0x59fb9e(0x25c)]['turbo'])return _0x59fb9e(0x1fc);return'fast';}async[_0x26bd78(0x28f)](){const _0x27c29c=_0x26bd78;if(process[_0x27c29c(0x1f7)][_0x27c29c(0x155)]==='development')return;try{const _0x12c446=await this[_0x27c29c(0x19e)][_0x27c29c(0x18e)]({});for(let _0x7a47f9 in _0x12c446){let _0x4077ce=_0x7a47f9;for(let _0x176ce5=0x0;_0x176ce5<_0x12c446[_0x7a47f9][_0x27c29c(0x2a8)];_0x176ce5++){const _0x88db07=_0x12c446[_0x7a47f9][_0x176ce5];let _0xcc69fc=await this[_0x27c29c(0x12e)][_0x27c29c(0x1fa)](_0x4077ce,String(_0x88db07['id']));_0xcc69fc?(_0xcc69fc[_0x27c29c(0x13e)]=_0x4077ce,_0xcc69fc[_0x27c29c(0x13f)]=_0x88db07[_0x27c29c(0x1d2)],_0xcc69fc['dictValue']=String(_0x88db07['id'])):_0xcc69fc={'dictType':_0x4077ce,'dictName':_0x88db07[_0x27c29c(0x1d2)],'dictValue':String(_0x88db07['id'])},await this[_0x27c29c(0x12e)][_0x27c29c(0x14c)](_0xcc69fc);}}common_1[_0x27c29c(0x301)][_0x27c29c(0x1c5)]('触站::运用领域、风格画风、作用主体、作用类别字典同步完成');}catch(_0x4d0e88){common_1['Logger'][_0x27c29c(0x2b4)](_0x4d0e88,'触站::运用领域、风格画风、作用主体、作用类别字典同步失败');}}async[_0x26bd78(0x2f6)](_0x50ef20){const _0x16949e=_0x26bd78;let _0x1a1878=[];try{const _0x282f5e=await this[_0x16949e(0x19e)][_0x16949e(0x197)]({'data':{'size':0x32,'index':0x1,'tagIds':[_0x50ef20]}});_0x1a1878=_0x1a1878[_0x16949e(0x211)](_0x282f5e[_0x16949e(0x275)]);for(let _0x5a68d6=0x2;_0x5a68d6<=_0x282f5e[_0x16949e(0x2c3)];_0x5a68d6++){const _0x2e6547=await this[_0x16949e(0x19e)][_0x16949e(0x197)]({'data':{'index':_0x5a68d6,'size':0x32,'tagIds':[_0x50ef20]}});_0x1a1878=_0x1a1878[_0x16949e(0x211)](_0x2e6547[_0x16949e(0x275)]);}return _0x1a1878;}catch(_0x223679){return common_1[_0x16949e(0x301)][_0x16949e(0x2b4)](_0x223679,'触站::模型信息同步失败'),[];}}async[_0x26bd78(0x21c)](){const _0x410ac3=_0x26bd78;if(process[_0x410ac3(0x1f7)][_0x410ac3(0x155)]==='development')return;try{const _0x9ef609=await this[_0x410ac3(0x12e)][_0x410ac3(0x244)]([_0x410ac3(0x28d),'effect_category',_0x410ac3(0x157),'application_fields']),_0xb9232d=new Map(),_0x3eeff7=await this[_0x410ac3(0x247)][_0x410ac3(0x2f9)]();_0x3eeff7[_0x410ac3(0x24e)](_0x440a3a=>_0xb9232d[_0x410ac3(0x23d)](_0x440a3a['id'],_0x440a3a));for(let _0x21a35a=0x0;_0x21a35a<_0x9ef609[_0x410ac3(0x2a8)];_0x21a35a++){const _0x134556=_0x9ef609[_0x21a35a][_0x410ac3(0x13f)],_0x572b55=Number(_0x9ef609[_0x21a35a]['dictValue']),_0xa6ffeb=await this['syncModelsByTag'](_0x572b55);_0xa6ffeb[_0x410ac3(0x24e)](_0x3f58d2=>{const _0x3ed6ab=_0x410ac3,_0x158f13=String(_0x3f58d2['id']);!_0xb9232d['has'](_0x158f13)&&_0xb9232d[_0x3ed6ab(0x23d)](_0x158f13,{'id':_0x158f13,'type':_0x3f58d2['modelType'],'name':_0x3f58d2[_0x3ed6ab(0x1d2)],'cover':'https://img2.huashi6.com/'+_0x3f58d2[_0x3ed6ab(0x219)],'version':_0x3f58d2['modelVersion'],'description':'','triggerWords':_0x3f58d2[_0x3ed6ab(0x2c9)]});const _0x3f40ce=_0xb9232d[_0x3ed6ab(0x2a0)](_0x158f13);_0x9ef609[_0x21a35a][_0x3ed6ab(0x13e)]==='style'&&(_0x3f40ce[_0x3ed6ab(0x28d)]=_0x572b55,_0x3f40ce[_0x3ed6ab(0x1e9)]=_0x134556),_0x9ef609[_0x21a35a]['dictType']===_0x3ed6ab(0x2ee)&&(_0x3f40ce[_0x3ed6ab(0x1de)]=_0x572b55,_0x3f40ce[_0x3ed6ab(0x1b9)]=_0x134556),_0x9ef609[_0x21a35a][_0x3ed6ab(0x13e)]===_0x3ed6ab(0x157)&&(_0x3f40ce[_0x3ed6ab(0x14d)]=_0x572b55,_0x3f40ce[_0x3ed6ab(0x1f8)]=_0x134556),_0x9ef609[_0x21a35a]['dictType']===_0x3ed6ab(0x1aa)&&(_0x3f40ce[_0x3ed6ab(0x2e2)]=_0x572b55,_0x3f40ce[_0x3ed6ab(0x199)]=_0x134556);});}await this[_0x410ac3(0x247)][_0x410ac3(0x1f6)](Array['from'](_0xb9232d['values']())),common_1['Logger']['log'](_0x410ac3(0x294));}catch(_0x58d3db){common_1[_0x410ac3(0x301)]['error'](_0x58d3db,'触站::模型信息同步失败');}}async[_0x26bd78(0x2d4)](_0x65d4e3){const _0x41053f=_0x26bd78,_0x4a7e63=await this[_0x41053f(0x196)]['listByCondition']({'data':{'ids':[_0x65d4e3]}});common_1['Logger'][_0x41053f(0x1c5)]('Modal\x20状态\x20手动同步任务信息'),this[_0x41053f(0x256)](_0x4a7e63[0x0]);}async['vipFreeUsed'](_0x5b3a56){const _0x22b4de=_0x26bd78,_0xaddcf7=await this[_0x22b4de(0x16c)]['getUserById'](_0x5b3a56[_0x22b4de(0x2de)]['id']),_0x281d6c={'fast':0x0,'relax':0x0,'trubo':0x0};let _0xc73e17=redisKey_constant_1['VIP_FREE']+'-'+_0xaddcf7['id']+'-';if(_0xaddcf7['vipExpire']||_0xaddcf7[_0x22b4de(0x258)]){const [_0x2ac079,_0x4a4ee1,_0x5e6ca6]=await Promise['all']([this[_0x22b4de(0x236)][_0x22b4de(0x2a0)]({'key':_0xc73e17+_0x22b4de(0x2c1)}),this[_0x22b4de(0x236)][_0x22b4de(0x2a0)]({'key':_0xc73e17+_0x22b4de(0x241)}),this['redisCacheService'][_0x22b4de(0x2a0)]({'key':_0xc73e17+'turbo_vip_free'})]);_0x281d6c['fast']=Number(_0x2ac079||0x0),_0x281d6c['relax']=Number(_0x4a4ee1||0x0),_0x281d6c[_0x22b4de(0x1ef)]=Number(_0x5e6ca6||0x0);}return _0x281d6c;}[_0x26bd78(0x277)](_0x50beff){const _0x4e8f53=_0x26bd78;if(typeof _0x50beff===_0x4e8f53(0x160))return midjourney_constant_1[_0x4e8f53(0x1ca)][_0x4e8f53(0x2a0)](_0x50beff);if(typeof _0x50beff===_0x4e8f53(0x237))return midjourney_constant_1['MjpStateIndexMap'][_0x4e8f53(0x2a0)](_0x50beff);}async[_0x26bd78(0x256)](_0x54451c){const _0x36911a=_0x26bd78;common_1['Logger'][_0x36911a(0x1c5)](_0x54451c,_0x36911a(0x1b0));try{let _0x53c55c=[];const _0x31a7d7=this[_0x36911a(0x277)](_0x54451c['status']),_0x91b9e7=_0x54451c[_0x36911a(0x170)]?parseFloat(_0x54451c[_0x36911a(0x170)]):null;let _0x57bba1=await this[_0x36911a(0x299)]['findOne']({'where':{'mjpTaskId':_0x54451c['id']}});if(_0x54451c[_0x36911a(0x22d)]==='MODAL'&&_0x57bba1[_0x36911a(0x255)]){common_1[_0x36911a(0x301)][_0x36911a(0x1c5)](_0x36911a(0x128),_0x36911a(0x1ae));return;}_0x54451c[_0x36911a(0x2ca)]&&(_0x53c55c=_0x54451c[_0x36911a(0x2ca)]['filter'](_0x41fc3f=>_0x41fc3f[_0x36911a(0x25b)]!==_0x36911a(0x29a)&&_0x41fc3f[_0x36911a(0x2bd)]!=='❤️'));store_1[_0x36911a(0x156)]['mjProxyImgUrl']&&_0x54451c['imageUrl']&&(_0x54451c[_0x36911a(0x2e9)]=_0x54451c[_0x36911a(0x2e9)][_0x36911a(0x226)](_0x36911a(0x16d),store_1[_0x36911a(0x156)]['mjProxyImgUrl']));const _0x32812f={'id':_0x57bba1['id'],'status':_0x31a7d7,'progress':_0x91b9e7,'buttons':_0x53c55c,'durationSpent':null,'imageUrl':_0x54451c[_0x36911a(0x2e9)],'failReason':_0x54451c[_0x36911a(0x14a)]};return(_0x54451c[_0x36911a(0x195)]===_0x36911a(0x270)||_0x54451c[_0x36911a(0x195)]===0x4)&&(_0x32812f['prompt']=_0x54451c[_0x36911a(0x141)]||_0x54451c[_0x36911a(0x2ea)]?.[_0x36911a(0x141)],_0x32812f['fullPrompt']=_0x54451c[_0x36911a(0x141)]||_0x54451c['properties']?.[_0x36911a(0x141)]),_0x54451c[_0x36911a(0x242)]&&_0x54451c[_0x36911a(0x191)]&&(_0x32812f[_0x36911a(0x142)]=(_0x54451c[_0x36911a(0x242)]-_0x54451c[_0x36911a(0x191)])/0x3e8),_0x57bba1=await this['midjourneyEntity']['save'](_0x32812f),_0x54451c[_0x36911a(0x22d)]===_0x36911a(0x1d0)&&_0x57bba1[_0x36911a(0x2e9)]&&this[_0x36911a(0x16a)][_0x36911a(0x1cf)](_0x57bba1['id'],_0x57bba1[_0x36911a(0x2e9)]),null;}catch(_0x582b01){common_1[_0x36911a(0x301)][_0x36911a(0x2b4)]('Mj任务通知异常:\x20',_0x582b01);}}async[_0x26bd78(0x19d)](_0x97bc5d){const _0x15a928=_0x26bd78;common_1[_0x15a928(0x301)][_0x15a928(0x1c5)](_0x97bc5d,_0x15a928(0x253));try{const _0x53362f=midjourney_constant_1[_0x15a928(0x251)][_0x15a928(0x2a0)](_0x97bc5d[_0x15a928(0x1c1)]),_0x495e29=Number(_0x97bc5d[_0x15a928(0x170)])*0x64;let _0x32af33=await this[_0x15a928(0x299)][_0x15a928(0x14e)]({'where':{'mjpTaskId':_0x97bc5d[_0x15a928(0x2c2)]}});const _0x2bf5fc={'id':_0x32af33['id'],'status':_0x53362f,'progress':_0x495e29,'imageUrl':_0x97bc5d['files']?.['map'](_0x24f5f6=>_0x24f5f6['url'])[_0x15a928(0x190)]('↢↣')};return _0x32af33=await this[_0x15a928(0x299)][_0x15a928(0x1f6)](_0x2bf5fc),_0x32af33[_0x15a928(0x22d)]===0x3&&_0x32af33[_0x15a928(0x2e9)]&&this['fileService'][_0x15a928(0x1cf)](_0x32af33['id'],_0x32af33[_0x15a928(0x2e9)]),null;}catch(_0x3c9865){common_1[_0x15a928(0x301)][_0x15a928(0x2b4)]('触站工作流任务通知异常:\x20',_0x3c9865);}}async[_0x26bd78(0x1eb)](_0x5590b0){const _0x3d4313=_0x26bd78;common_1[_0x3d4313(0x301)][_0x3d4313(0x1c5)](_0x5590b0,_0x3d4313(0x181));try{const _0x4f344c=midjourney_constant_1[_0x3d4313(0x251)][_0x3d4313(0x2a0)](_0x5590b0[_0x3d4313(0x1c1)]),_0x5316e7=Number(_0x5590b0[_0x3d4313(0x170)])*0x64;let _0x2775c9=await this[_0x3d4313(0x299)]['findOne']({'where':{'mjpTaskId':_0x5590b0[_0x3d4313(0x2c2)]}});const _0x1c1c00={'id':_0x2775c9['id'],'status':_0x4f344c,'progress':_0x5316e7,'imageUrl':_0x5590b0[_0x3d4313(0x18c)]?.['map'](_0x58e915=>_0x58e915['imageUrl'])['join']('↢↣')};return _0x2775c9=await this['midjourneyEntity']['save'](_0x1c1c00),_0x2775c9[_0x3d4313(0x22d)]===0x3&&_0x2775c9[_0x3d4313(0x2e9)]&&this['fileService'][_0x3d4313(0x1cf)](_0x2775c9['id'],_0x2775c9[_0x3d4313(0x2e9)]),null;}catch(_0x155aad){common_1[_0x3d4313(0x301)][_0x3d4313(0x2b4)](_0x3d4313(0x23e),_0x155aad);}}async[_0x26bd78(0x25e)](){const _0xab4c97=_0x26bd78;this[_0xab4c97(0x2a1)](),this[_0xab4c97(0x284)](),this['syncSdTask']();}async[_0x26bd78(0x2a1)](){const _0x2b7fe3=_0x26bd78;try{const _0x37c8fc=await this[_0x2b7fe3(0x299)]['find']({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6]),'botType':(0x0,typeorm_2['In'])([DrawTaskPage_dto_1[_0x2b7fe3(0x224)][_0x2b7fe3(0x208)],DrawTaskPage_dto_1[_0x2b7fe3(0x224)][_0x2b7fe3(0x126)]])}});if(_0x37c8fc[_0x2b7fe3(0x2a8)])for(let _0x20f684=0x0;_0x20f684<_0x37c8fc[_0x2b7fe3(0x2a8)];_0x20f684++){const _0x326299=redisKey_constant_1[_0x2b7fe3(0x1ad)]+_0x37c8fc[_0x20f684][_0x2b7fe3(0x2fb)],_0x3eaa11=await this[_0x2b7fe3(0x236)]['get']({'key':_0x326299});if(_0x3eaa11)continue;else this[_0x2b7fe3(0x236)][_0x2b7fe3(0x23d)]({'key':_0x326299,'val':_0x2b7fe3(0x232)}),this[_0x2b7fe3(0x196)]['listByCondition']({'data':{'ids':[_0x37c8fc[_0x20f684][_0x2b7fe3(0x2fb)]]}})['then'](async _0x1ef0a2=>{const _0x5a37d9=_0x2b7fe3,_0x43b7cd=_0x1ef0a2[0x0],_0x35c433=_0x37c8fc[_0x20f684],_0x1ba9ff=this[_0x5a37d9(0x277)](_0x43b7cd[_0x5a37d9(0x22d)]),_0xd73e92=_0x43b7cd[_0x5a37d9(0x170)]?parseFloat(_0x43b7cd[_0x5a37d9(0x170)]):null;if(_0x35c433[_0x5a37d9(0x170)]===_0xd73e92&&_0x35c433[_0x5a37d9(0x22d)]===_0x1ba9ff){}else{const _0x5a3f94=_0x43b7cd[_0x5a37d9(0x2ca)][_0x5a37d9(0x246)](_0x408c29=>_0x408c29['label']!==_0x5a37d9(0x2bf)&&_0x408c29[_0x5a37d9(0x25b)]!==_0x5a37d9(0x29a)&&_0x408c29[_0x5a37d9(0x2bd)]!=='❤️'),_0x125290={'id':_0x35c433['id'],'mjpTaskId':_0x43b7cd['id'],'status':_0x1ba9ff,'progress':_0xd73e92,'buttons':_0x5a3f94,'durationSpent':null,'imageUrl':_0x43b7cd['imageUrl'],'failReason':_0x43b7cd[_0x5a37d9(0x14a)]};store_1[_0x5a37d9(0x156)]['mjProxyImgUrl']&&_0x125290[_0x5a37d9(0x2e9)]&&(_0x125290['imageUrl']=_0x125290[_0x5a37d9(0x2e9)]['replace'](_0x5a37d9(0x16d),store_1[_0x5a37d9(0x156)][_0x5a37d9(0x2ae)])),(_0x43b7cd['action']==='DESCRIBE'||_0x43b7cd['action']===0x4)&&(_0x125290[_0x5a37d9(0x2ba)]=_0x43b7cd[_0x5a37d9(0x141)]||_0x43b7cd[_0x5a37d9(0x2ea)]?.[_0x5a37d9(0x141)],_0x125290[_0x5a37d9(0x1b2)]=_0x43b7cd['finalPrompt']||_0x43b7cd[_0x5a37d9(0x2ea)]?.['finalPrompt']),_0x43b7cd[_0x5a37d9(0x242)]&&_0x43b7cd[_0x5a37d9(0x191)]&&(_0x125290[_0x5a37d9(0x142)]=(_0x43b7cd[_0x5a37d9(0x242)]-_0x43b7cd['startTime'])/0x3e8),await this[_0x5a37d9(0x299)][_0x5a37d9(0x1f6)](_0x125290);}})[_0x2b7fe3(0x20c)](_0x9953c5=>{const _0x5b916b=_0x2b7fe3;common_1[_0x5b916b(0x301)]['error'](_0x5b916b(0x140),_0x9953c5);})['finally'](()=>{const _0x54ab0d=_0x2b7fe3;this[_0x54ab0d(0x236)]['del']({'key':_0x326299});});}}catch(_0x571ee8){}}async[_0x26bd78(0x284)](){const _0x2ed504=_0x26bd78;try{const _0x29bebe=await this[_0x2ed504(0x299)][_0x2ed504(0x2f9)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'mjpTaskId':(0x0,typeorm_2[_0x2ed504(0x1be)])((0x0,typeorm_2[_0x2ed504(0x154)])()),'botType':DrawTaskPage_dto_1['EBotType'][_0x2ed504(0x2a4)]}});if(_0x29bebe['length'])for(let _0x1a4ee6=0x0;_0x1a4ee6<_0x29bebe[_0x2ed504(0x2a8)];_0x1a4ee6++){const _0x851a00=redisKey_constant_1[_0x2ed504(0x1ad)]+_0x29bebe[_0x1a4ee6][_0x2ed504(0x2fb)],_0x2e99f3=await this[_0x2ed504(0x236)][_0x2ed504(0x2a0)]({'key':_0x851a00});if(_0x2e99f3)continue;else{this['redisCacheService'][_0x2ed504(0x23d)]({'key':_0x851a00,'val':'lock'});try{const _0x13767b=await this[_0x2ed504(0x19e)][_0x2ed504(0x1cc)]({'data':{'taskId':_0x29bebe[_0x1a4ee6][_0x2ed504(0x2fb)]}});this['notifyWF'](_0x13767b);}catch(_0x5a07e4){common_1[_0x2ed504(0x301)][_0x2ed504(0x2b4)](_0x2ed504(0x21e),_0x5a07e4);}finally{this[_0x2ed504(0x236)]['del']({'key':_0x851a00});}}}}catch(_0x1ae6f5){}}async['syncSdTask'](){const _0x23b59b=_0x26bd78;try{const _0x38e9bc=await this[_0x23b59b(0x299)][_0x23b59b(0x2f9)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'botType':DrawTaskPage_dto_1[_0x23b59b(0x224)]['SD']}});if(_0x38e9bc[_0x23b59b(0x2a8)])for(let _0x5ae6f8=0x0;_0x5ae6f8<_0x38e9bc['length'];_0x5ae6f8++){const _0x13680c=redisKey_constant_1[_0x23b59b(0x1ad)]+_0x38e9bc[_0x5ae6f8][_0x23b59b(0x2fb)],_0x276734=await this[_0x23b59b(0x236)][_0x23b59b(0x2a0)]({'key':_0x13680c});if(_0x276734)continue;else{this[_0x23b59b(0x236)][_0x23b59b(0x23d)]({'key':_0x13680c,'val':_0x23b59b(0x232)});try{const _0x4f9b4c=await this[_0x23b59b(0x19e)][_0x23b59b(0x2f2)]({'data':{'taskId':_0x38e9bc[_0x5ae6f8][_0x23b59b(0x2fb)]}});this[_0x23b59b(0x1eb)](_0x4f9b4c);}catch(_0x14aa6f){common_1[_0x23b59b(0x301)][_0x23b59b(0x2b4)](_0x23b59b(0x1f2),_0x14aa6f);}finally{this['redisCacheService'][_0x23b59b(0x23f)]({'key':_0x13680c});}}}}catch(_0x5e00b8){}}async[_0x26bd78(0x1fb)](){const _0x271acb=_0x26bd78;if(store_1[_0x271acb(0x156)]['mjNotSaveImg'])return;try{const _0x14f6a7=[{'status':0x3,'imageUrl':(0x0,typeorm_2['Like'])(_0x271acb(0x29c))}];store_1[_0x271acb(0x156)][_0x271acb(0x2ae)]&&_0x14f6a7['push']({'status':0x3,'imageUrl':(0x0,typeorm_2[_0x271acb(0x2d8)])(store_1[_0x271acb(0x156)][_0x271acb(0x2ae)]+'%')});const _0x19be1c=await this[_0x271acb(0x299)][_0x271acb(0x2f9)]({'where':_0x14f6a7});if(_0x19be1c['length'])for(let _0x61a9d2=0x0;_0x61a9d2<_0x19be1c[_0x271acb(0x2a8)];_0x61a9d2++){let {id:_0x24fe66,imageUrl:_0x2b98cc}=_0x19be1c[_0x61a9d2];this[_0x271acb(0x16a)][_0x271acb(0x1cf)](_0x24fe66,_0x2b98cc);}}catch(_0x8faea7){common_1['Logger']['error'](_0x8faea7);}}async[_0x26bd78(0x147)](){const _0x396241=_0x26bd78;try{const _0x13cf22=store_1[_0x396241(0x156)][_0x396241(0x2db)]||0x5,_0x2db1b9=[{'status':(0x0,typeorm_2['In'])([0x2,0x4]),'isRefund':0x0,'updatedAt':(0x0,typeorm_2['LessThan'])(new Date(Date[_0x396241(0x216)]()-_0x13cf22*0x3c*0x3e8))}],_0x2bf038=await this[_0x396241(0x299)][_0x396241(0x2f9)]({'where':_0x2db1b9});_0x2bf038[_0x396241(0x24e)](_0x5a5901=>{const _0x4536df=_0x396241;_0x5a5901[_0x4536df(0x22d)]=0x4,_0x5a5901[_0x4536df(0x14a)]=_0x5a5901[_0x4536df(0x14a)]||_0x4536df(0x2be),_0x5a5901[_0x4536df(0x248)]=0x1,this[_0x4536df(0x299)][_0x4536df(0x1f6)](_0x5a5901),this[_0x4536df(0x16c)]['refundBalance4MJ'](_0x5a5901[_0x4536df(0x220)],_0x5a5901[_0x4536df(0x15e)],_0x5a5901[_0x4536df(0x214)]||_0x4536df(0x2a9),_0x5a5901['id']);});}catch(_0x59c40c){common_1[_0x396241(0x301)][_0x396241(0x2b4)](_0x59c40c);}}};MidjourneyService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x26bd78(0x266)])(mjModel_entity_1['MjModelEntity'])),__param(0x1,(0x0,typeorm_1['InjectRepository'])(mjParam_entity_1[_0x26bd78(0x167)])),__param(0x2,(0x0,typeorm_1[_0x26bd78(0x266)])(mjPrompts_entity_1['MjPromptsEntity'])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1[_0x26bd78(0x125)])),__param(0x4,(0x0,typeorm_1[_0x26bd78(0x266)])(mjSuggestWord_entity_1['MjSuggestWordEntity'])),__param(0x5,(0x0,typeorm_1[_0x26bd78(0x266)])(mjIncantation_entity_1['MjIncantationEntity'])),__param(0x6,(0x0,typeorm_1[_0x26bd78(0x266)])(mjInspireClassify_entity_1['MjInspireClassifyEntity'])),__param(0x7,(0x0,typeorm_1[_0x26bd78(0x266)])(mjIncantationClassify_entity_1[_0x26bd78(0x21b)])),__metadata(_0x26bd78(0x132),[typeorm_2['Repository'],typeorm_2[_0x26bd78(0x25f)],typeorm_2[_0x26bd78(0x25f)],typeorm_2[_0x26bd78(0x25f)],typeorm_2[_0x26bd78(0x25f)],typeorm_2[_0x26bd78(0x25f)],typeorm_2[_0x26bd78(0x25f)],typeorm_2[_0x26bd78(0x25f)],nestjs_cls_1[_0x26bd78(0x139)],dict_service_1[_0x26bd78(0x2eb)],user_service_1['UserService'],file_service_1['FileService'],fanyi_service_1[_0x26bd78(0x1d3)],aiLog_service_1[_0x26bd78(0x1b4)],models_service_1[_0x26bd78(0x293)],czTask_service_1[_0x26bd78(0x1ab)],mjpTask_service_1[_0x26bd78(0x1dc)],badwords_service_1['BadwordsService'],redisCache_service_1[_0x26bd78(0x130)],mjpAccount_service_1['MjpAccountService'],globalConfig_service_1[_0x26bd78(0x175)],typeorm_2[_0x26bd78(0x263)]])],MidjourneyService),exports['MidjourneyService']=MidjourneyService;function _0x1d71(){const _0x2c020b=['queryMjInspireClassify','applicationFieldsName','originPrompt','小工具已禁用！','findBy','notifyWF','czTaskService','工作流（小工具）不存在','删除推荐关键词失败','setImageFavorite','FaceSwap','guildId','defineProperty','object','drawTaskList','description','affected','type','application_fields','CZTaskService','code','MJ_TASK_UPDATE','Mj\x20Modal\x20通知','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20','MJ\x20通知内容：','mjParamEntity','fullPrompt','botType','AiLogService','mjIncantationClassifyEntity','map','DESC','mjModel','effectCategoryName','fanyiService','getModelByIds','__decorate','\x20--sw\x20','Not','3259186SRaSdF','versionId','state','delPrompt','instanceId','inputs','log','../fanyi/fanyi.service','tutorial','fileInfo','aiDraw','MjpStateMap','size','workflowTaskDetail','5XiDXOe','insightFace','transferImg','SUCCESS','delete','name','FanyiService','无绘图记录','base64','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','userInfo','DRAWING','getAgreeByRelateId','keyword','id不能为空！','MjpTaskService','\x20--sref\x20','effectCategory','查询咒语失败','__param','create','parse','绘画制作','workflowDel','addDrawQueue','disabled','level','HttpException','styleName','modal','notifySD','getOwnPropertyDescriptor','../badwords/badwords.service','mjVersion','trubo','fastRemainTime','agreeNum','sdTaskUpdateJob:\x20','workflowRun','setting','../aiLog/aiLog.service','save','env','effectMainBodyName','setPrompt','get4workflow','syncMjImg','turbo','hideString','favoriteListByTypeAndIds','提交动作失败','vipExpire','syncMjpAccountAutomatic','jobIds','MidjourneyStatusEnum','checkIsActionDone','719688TuMVPv','nickname','IMAGE_TO_TEXT','MID_JOURNEY','convertMode4Transfer','isDefined','updatedAt','catch','aiInpaint','transaction','getMjIncantation','HttpStatus','concat','getUserId','壁纸绘画','customId','STANDARD','now','../globalConfig/globalConfig.service','BAD_REQUEST','coverImageUrl','EModelType','MjIncantationClassifyEntity','syncModels','11143FnZAEA','wfTaskUpdateJob:\x20','5810PNXiHz','userId','squareType','useCount','fast','EBotType','blend','replace','removeMjIncantationClassify','syncMjpAccountManual','convertToEnglish','workflowModelUpdate','queryAllPrompt','removeMjIncantation','status','推荐关键词不存在','ASC','查询灵感分类失败','账号不存在','lock','绘制的任务不存在！','1270775kqXbZs','名称不能重复','redisCacheService','number','changeVersion','modelSave','phone','addMjIncantation','badwordsService','set','触站工作流任务通知异常:\x20','del','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','relax_vip_free','finishTime','4741376zbmBeN','list4dictTypes','商拍摄影','filter','mjModelEntity','isRefund','lifetimeUsage','mjProxy','mjpId','MidjourneyService','modifyMjIncantationClassify','forEach','modifyMjIncantation','MidJourneyDrawEnum','CzStateMap','workflowPage','触站工作流任务通知内容：','mjPromptsEntity','messageFlags','notify','deductBalance4SD','lifetimeVip','workflowModelPage','isChinese','label','DrawSpeed','IMAGE_MIX_IMAGE','syncTask','Repository','workflowUsedPage','queryMjAccountList','account','Connection','remark','list4workflow','InjectRepository','has','mjSuggestWordEntity','addMjIncantationClassify','findAndCount','--cref','getUserById','isManage','保存推荐关键词','mjpAccountService','DESCRIBE','distributeAccount','\x20--cw\x20','copyAccountInfo','value','datas','--sref','parseMjStatus','TEXT_TO_IMAGE','任务已达最大并发数，请等待其他任务完成后再提交新任务！','IMAGE_ACTION','推荐关键词已存在，不可重复添加','mask','update','nestjs-cls','../../common/utils','操作失败！','TURBO','queryMjIncantationClassify','摄影拍照','syncWfTask','306SvOuHW','队列已满，请稍后尝试','split','indexOf','modalTask','saveSuggestWords','任务类型错误','squire-images','style','未查询到咒语一级分类','syncWorkFlowDict','workflowId','vipFreeNum','initInspireData','ModelsService','触站::模型信息同步完成','113169OJIpLR','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','displaySort','../file/file.service','midjourneyEntity','Imagine\x20all','getModelById','https://cdn.discordapp.com%','动漫漫画','modelName','version','get','syncMjTask','maskBase64','getMjAccount','WORKFLOW','sdTaskInpaint','typeorm','saasId','length','Imagine','clsService','modifyMjInspireClassify','syncMjpAccount','createdAt','mjProxyImgUrl','onModuleInit','添加绘图任务失败','当前图片已经执行过相同指令！','relateId','getConfigByKeys','error','checkBadWords','exist','connection','error:\x20','../../common/store','prompt','modelsService','favoritePage','emoji','timeout','Custom\x20Zoom','queryTopMjIncantationClassify','fast_vip_free','taskId','pageCount','./dto/DrawTaskPage.dto','删除成功！','rows','要使用MJ绘画功能，至少需要配置一个MJ账号,并且启用该账号','initHasAccount','triggerWords','buttons','paintingSign','parseExtendArgs','queryMjIncantationAll','DRAW','workflowTaskSubmit','add','初始化灵感广场分类成功','Blend','PRO','syncTaskInfo','createRandomUid','totalTime','rec','Like','workflowModelDetail','checkUserStatus','mjTimeoutMs','then','VIP_FREE','user','toString','--cw','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27','applicationFields','查询咒语分类失败','queryMjIncantationByClassify','promptsPage','./mjPrompts.entity','aiLogService','concurrentLimit','imageUrl','properties','DictService','--sw','mjIncantationEntity','effect_category','getOneDraw','findOneBy','MEGA','aiTaskDetail','5905632SugjQD','denoisingStrength','cancel','syncModelsByTag','getMjInspireClassify','../../common/constants/model.constant','find','imagine','mjpTaskId','actionTask','非法操作！','./mjSuggestWord.entity','avatar','renewDate','Logger','艺术设计','count','MidjourneyEntity','NIJI_JOURNEY','isPlatform','Modal已处理，无需更新','getUserListByIds','自动同步账号信息失败：','__metadata','recDraw','3JvxYRa','dictService','mjInspireClassifyEntity','RedisCacheService','../api/mjpAccount.service','design:paramtypes','stringify','cover','validateBalance4MJ','modifyMjAccount','data:image/png;base64,','prompt包含敏感词','ClsService','keys','orderPlan','RELAX','model','dictType','dictName','mjTaskUpdateJob:\x20','finalPrompt','durationSpent','workflowDetail','./midjourney.entity','fetch','function','batchTaskResult','../../common/constants/user.constant','pid','failReason','getReqSaasId','save4workflow','effectMainBody','findOne','channelId','updateReconnect','classifyName','@nestjs/typeorm','key','IsNull','ENV','MjConfig','effect_main_body','任务不存在！','trim','getDetailByIds','deductBalance4MJ','deduct','globalConfigService','mode','removeMjInspireClassify','string','deleteDraw','weight','../../common/constants/redisKey.constant','page','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.used\x20AS\x20used\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','remix','MjParamEntity','形象设计','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.createdAt\x20DESC\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','fileService','operated','userService','https://cdn.discordapp.com','81MtPdty','AddDrawQueueDto','progress','assign','visitNum','modelDel','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','GlobalConfigService','relax','删除记录失败！','workflowSave','../../common/constants/midjourney.constant','Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','workflowForm','查询推荐关键词失败','FAST','精选分享','subscribePlan','result','SD任务通知内容：','authorization','message','\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20','imageSeed','push','fastTimeRemaining','query','\x20OFFSET\x20','../models/models.service','创建图生文任务失败','images','getByRelateId','workflowDicts','./mjIncantationClassify.entity','join','startTime','delLog','\x20--iw\x20','EFavorite','action','mjpTaskService','modelPage'];_0x1d71=function(){return _0x2c020b;};return _0x1d71();}