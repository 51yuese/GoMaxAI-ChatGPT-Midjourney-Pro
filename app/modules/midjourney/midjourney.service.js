'use strict';const _0x49a3b4=_0x4db7;(function(_0x3312bb,_0x32b946){const _0x104601=_0x4db7,_0x58a9ff=_0x3312bb();while(!![]){try{const _0x2429b8=-parseInt(_0x104601(0x12c))/0x1+parseInt(_0x104601(0x20c))/0x2*(parseInt(_0x104601(0x230))/0x3)+parseInt(_0x104601(0xf9))/0x4*(-parseInt(_0x104601(0xae))/0x5)+parseInt(_0x104601(0x1af))/0x6*(parseInt(_0x104601(0x25d))/0x7)+-parseInt(_0x104601(0xfe))/0x8+parseInt(_0x104601(0x214))/0x9*(-parseInt(_0x104601(0xee))/0xa)+-parseInt(_0x104601(0x273))/0xb*(-parseInt(_0x104601(0x17f))/0xc);if(_0x2429b8===_0x32b946)break;else _0x58a9ff['push'](_0x58a9ff['shift']());}catch(_0x3ae768){_0x58a9ff['push'](_0x58a9ff['shift']());}}}(_0x2f91,0x713ed));function _0x4db7(_0x5c3921,_0x336dde){const _0x2f91cb=_0x2f91();return _0x4db7=function(_0x4db779,_0x34b977){_0x4db779=_0x4db779-0x9d;let _0x5324b5=_0x2f91cb[_0x4db779];return _0x5324b5;},_0x4db7(_0x5c3921,_0x336dde);}function _0x2f91(){const _0x554da2=['形象设计','updateReconnect','fileInfo','LessThan','jobIds','TURBO','base64','../aiLog/aiLog.service','账号不存在','syncTask','workflowSave','then','concurrentLimit','checkBadWords','incantationCn','queryMjIncantationAll','create','648zcRzCV','query','originPrompt','effectMainBodyName','mjpId','querySuggestWords','action','list4workflow','../../common/constants/midjourney.constant','STANDARD','\x20--cref\x20','mjpId:\x20','removeSuggestWords','vipExpire','查询推荐关键词失败','IMAGE_ACTION','非法操作！','分页参数错误','saasId','maskBase64','update','mjVersion','uncollect','actionTask','applicationFields','syncMjTask','key','value','changeVersion','stringify','cancel','deleteDraw','workflowDicts','isDefined','./mjPrompts.entity','exist','SD任务通知内容：','setPrompt','Mj\x20Modal\x20通知','推荐关键词已存在，不可重复添加','MjInspireClassifyEntity','无绘图记录','TEXT_TO_IMAGE','fullPrompt','from','notifySD','mjModelEntity','channelId','imageSeed','validateBalance4MJ','czTaskService','nestjs-cls','Modal\x20状态\x20手动同步任务信息','tutorial','trubo','values','DESCRIBE','MidjourneyEntity','vipFreeNum','info','mjInspireClassifyEntity','squire-images','account','https://img2.huashi6.com/','get','prompt','MidjourneyService','rows','头像制作','badwordsService','object','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20','datas','paintingSign','disabled','__metadata','delete','MoreThan','drawSquarePage','email','progress','userService','DESC','mask','modifyMjInspireClassify','isPlatform','MjpTaskService','modelPage','workflowTaskDetail','version','dictName','fastRemainTime','getByRelateId','2646lKbLTj','failReason','effect_category','status','use','indexOf','Logger','collect','1020249PiJapR','MODAL','../globalConfig/globalConfig.service','Imagine\x20all','setting','nickname','Like','parseMjStatus','useCount','classifyName','getAgreeMap','DRAW','instanceId','trim','fast','finishTime','触站::模型信息同步完成','recommend','aiLogService','addRefer','mergeCollectDataForUserId','队列已满，请稍后尝试','DrawSpeed','cover','effectMainBody','prompt包含敏感词','subscribePlan','添加绘图任务失败','2055MrTOZK','./midjourney.entity','queryMjIncantationClassify','model','queryAllPrompt','mjTimeoutMs','notifyWF','触站工作流任务通知异常:\x20','MidjourneyStatusEnum','dictValue','lock','workflowModelPage','affected','workflowFavorite','mjModel','getConfigByKeys','remix','inputs','pid','aiInpaint','concat','mjProxy','type','FanyiService','--sw','userId','保存推荐关键词','distributeAccount','lifetimeUsage','forEach','function','count','fileService','../models/models.service','动漫漫画','handleImagesUploadTask','page','Describe','swap','../../common/constants/redisKey.constant','code','dictService','HttpException','Injectable','modelName','28301imIRBE','error','@nestjs/common','sdTaskSubmit','set','VIP_FREE','copyAccountInfo','MjConfig','replace','error:\x20','\x20--sref\x20','mjProxyImgUrl','商拍摄影','mjLimitCount','@nestjs/typeorm','Modal已处理，无需更新','images','\x0a\x20\x20\x20\x20\x20\x20\x20\x20','推荐关键词不存在','modalTask','config','keyword','26609HkDviu','workflowDetail','imagine','DictService','../fanyi/fanyi.service','syncMjpAccount','queryMjInspireClassify','../file/file.service','AiLogService','modifyMjIncantationClassify','getMjIncantationClassify','findAndCount','syncMjImg','ASC','connection','buttons','MjIncantationEntity','\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.createdAt\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','isChinese','https://cdn.discordapp.com','convertMode4Transfer','length','modelsService','parseExtendArgs','taskId','deductBalance4SD','MID_JOURNEY','mjIncantationClassifyEntity','EModelType','delPrompt','Repository','rec','user','lifetimeVip','删除成功！','工作流（小工具）不存在','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','botType','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.used\x20AS\x20used\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20models\x20m\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20(\x20SELECT\x20workflowId,\x20count(workflowId)\x20AS\x20used,\x20MAX(\x20createdAt\x20)\x20AS\x20createdAt\x20FROM\x20midjourney\x20WHERE\x20workflowId\x20IS\x20NOT\x20NULL\x20AND\x20userId\x20=\x20','saveSuggestWords','workflowId','查询咒语失败','phone','EBotType','ModelsService','design:paramtypes','level','agree','queryMjIncantationClassifyAllByLevel','turbo_vip_free','transaction','enable','../api/mjpAccount.service','fanyiService','不需要灵感广场分类','toString','modelDel','AddDrawQueueDto','815uFtlIe','modifyMjAccount','development','applicationFieldsName','id不能为空！','getMjInspireClassify','图混图任务至少需要两张图片','IsNull','transferImg','InjectRepository','初始化灵感广场分类成功','operated','mjNotSaveImg','IMAGE_MIX_IMAGE','MjpStateIndexMap','workflowForm','vipFreeUsed','sdTaskUpdateJob:\x20','./dto/DrawTaskPage.dto','modelVersion','自动同步账号信息失败：','IMAGE_TO_TEXT','FaceSwap','触站::模型信息同步失败','删除失败！','relateId','metadata','remark','buffer','listByCondition','save4workflow','map','getOneDraw','UserCollectType','mjSuggestWordEntity','timeout','displaySort','mergeCollectData','dictType','checkIsActionDone','refundBalance4MJ','原始任务不存在！','filter','totalTime','./mjModel.entity','getDetailByIds','mode','./mjIncantation.entity','aiTaskDetail','data:image/png;base64,','queryMjIncantationByClassify','collectPage','\x20OFFSET\x20','description','style','finally','url','presetId','userInfo','effectCategory','dataType','isSuper','deductBalance4MJ','MjPromptsEntity','20YCdKij','findOneBy','createdAt','relax_vip_free','split','orderPlan','\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ORDER\x20BY\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.createdAt\x20DESC\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LIMIT\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','--cw','操作失败！','fast_vip_free','redisCacheService','12980QKVqfI','avatar','log','message','relId','501200sgkRgG','mjIncantationEntity','assign','查询灵感分类失败','\x20--sw\x20','findOne','checkUserStatus','promptsPage','创建图混图任务失败','触站::运用领域、风格画风、作用主体、作用类别字典同步完成','SUCCESS','getReqSaasId','catch','HttpStatus','hideString','convertToEnglish','isManage','mjpTaskId','getAgreeByRelateId','recDraw','fastTimeRemaining','decorate','queryMjIncantation','removeMjIncantation','deduct','versionSelector','createRandomUid','getModelByIds','squareType','当前图片已经执行过相同指令！','get4workflow','./dto/addDrawQueue.dto','EFavorite','files','WORKFLOW','blend','syncTaskInfo','getMjAccount','syncWorkFlowDict','../redisCache/redisCache.service','MJ_TASK_UPDATE','查询咒语分类失败','任务类型错误','guildId','MidJourneyDrawEnum','modal','309896YGOyWy','艺术设计','CzStateMap','initHasAccount','label','effectCategoryName','effect_main_body','startTime','relax','parse','../api/czTask.service','MjModelEntity','__esModule','properties','触站工作流任务通知内容：','name','state','getUserById','isRefund','env','要使用MJ绘画功能，至少需要配置一个MJ账号,并且启用该账号','Mozilla/5.0\x20(Macintosh;\x20Intel\x20Mac\x20OS\x20X\x2010_15_7)\x20AppleWebKit/537.36\x20(KHTML,\x20like\x20Gecko)\x20Chrome/112.0.0.0\x20Safari/537.36','MjParamEntity','绘制中的图片任务、禁止删除！','--sref','size','add','has','aiDraw','删除记录失败！','wfTaskUpdateJob:\x20','result','pageCount','mjpAccountService','push','Connection','BAD_REQUEST','mjTaskUpdateJob:\x20','绘画制作','syncModelsByTag','GlobalConfigService','syncInfo','notify','imageUrl','join','keys','CZTaskService','PRO','ENV','defineProperty','初始化灵感广场分类失败','emoji','\x20--cw\x20','getUserId','favoriteListByTypeAndIds','save','../../common/constants/user.constant','getModelById','../dict/dict.service','NIJI_JOURNEY','MEGA','drawTaskList','clsService','名称不能重复','versionId','authorization','mjpTaskService','RELAX','modifyMjIncantation','startsWith','queryModels','./mjSuggestWord.entity','initInspireData','triggerWords','customId','finalPrompt','addMjIncantation','find','renewDate','styleName','addDrawQueue','workflowDel','typeorm','1236SAVAhu','updatedAt','midjourneyEntity','extraParam','agreeNum','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.id,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.cover,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.modelName\x20AS\x20name,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.model\x20AS\x20workflowId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.key\x20AS\x20versionId,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.deduct,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.vip_free_num\x20AS\x20vipFreeNum,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.displaySort,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.description,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.status,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.createdAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.updatedAt,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.useCount,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20m.remark\x20AS\x20tutorial\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27','../badwords/badwords.service','del','mjParamEntity','mergeCollectCountData','mjPromptsEntity','./mjIncantationClassify.entity','turbo','durationSpent','favoritePage','application_fields','MJ\x20通知内容：','../user/user.service','Imagine','coverImageUrl','denoisingStrength','删除推荐关键词失败','BadwordsService','syncModels','\x20--iw\x20','创建图生文任务失败','workflowTaskSubmit','fetch','syncWfTask','batchTaskResult','小工具已禁用！'];_0x2f91=function(){return _0x554da2;};return _0x2f91();}var __decorate=this&&this['__decorate']||function(_0x505c3f,_0x32f724,_0x3435c3,_0xf0d607){const _0x5a6314=_0x4db7;var _0x170a15=arguments['length'],_0x1c65b1=_0x170a15<0x3?_0x32f724:_0xf0d607===null?_0xf0d607=Object['getOwnPropertyDescriptor'](_0x32f724,_0x3435c3):_0xf0d607,_0x392bd8;if(typeof Reflect===_0x5a6314(0x1f5)&&typeof Reflect[_0x5a6314(0x113)]===_0x5a6314(0x24e))_0x1c65b1=Reflect[_0x5a6314(0x113)](_0x505c3f,_0x32f724,_0x3435c3,_0xf0d607);else{for(var _0x32b65d=_0x505c3f[_0x5a6314(0x288)]-0x1;_0x32b65d>=0x0;_0x32b65d--)if(_0x392bd8=_0x505c3f[_0x32b65d])_0x1c65b1=(_0x170a15<0x3?_0x392bd8(_0x1c65b1):_0x170a15>0x3?_0x392bd8(_0x32f724,_0x3435c3,_0x1c65b1):_0x392bd8(_0x32f724,_0x3435c3))||_0x1c65b1;}return _0x170a15>0x3&&_0x1c65b1&&Object[_0x5a6314(0x15d)](_0x32f724,_0x3435c3,_0x1c65b1),_0x1c65b1;},__metadata=this&&this[_0x49a3b4(0x1fa)]||function(_0xc493b4,_0x13af8a){const _0x2a4d8f=_0x49a3b4;if(typeof Reflect===_0x2a4d8f(0x1f5)&&typeof Reflect[_0x2a4d8f(0xc8)]===_0x2a4d8f(0x24e))return Reflect[_0x2a4d8f(0xc8)](_0xc493b4,_0x13af8a);},__param=this&&this['__param']||function(_0x572877,_0xfb1677){return function(_0x3f60e3,_0x29e87d){_0xfb1677(_0x3f60e3,_0x29e87d,_0x572877);};};Object[_0x49a3b4(0x15d)](exports,_0x49a3b4(0x138),{'value':!![]}),exports[_0x49a3b4(0x1f1)]=void 0x0;const common_1=require(_0x49a3b4(0x25f)),typeorm_1=require(_0x49a3b4(0x26b)),midjourney_entity_1=require(_0x49a3b4(0x231)),typeorm_2=require(_0x49a3b4(0x17e)),globalConfig_service_1=require(_0x49a3b4(0x216)),midjourney_constant_1=require(_0x49a3b4(0x1b7)),file_service_1=require(_0x49a3b4(0x27a)),badwords_service_1=require(_0x49a3b4(0x185)),utils_1=require('../../common/utils'),mjPrompts_entity_1=require(_0x49a3b4(0x1d1)),mjParam_entity_1=require('./mjParam.entity'),mjIncantationClassify_entity_1=require(_0x49a3b4(0x18a)),mjInspireClassify_entity_1=require('./mjInspireClassify.entity'),mjIncantation_entity_1=require(_0x49a3b4(0xdd)),fanyi_service_1=require(_0x49a3b4(0x277)),mjSuggestWord_entity_1=require(_0x49a3b4(0x173)),user_service_1=require(_0x49a3b4(0x190)),redisCache_service_1=require(_0x49a3b4(0x125)),mjpAccount_service_1=require(_0x49a3b4(0xa8)),mjpTask_service_1=require('../api/mjpTask.service'),addDrawQueue_dto_1=require(_0x49a3b4(0x11d)),store_1=require('../../common/store'),redisKey_constant_1=require(_0x49a3b4(0x257)),aiLog_service_1=require(_0x49a3b4(0x1a5)),model_constant_1=require('../../common/constants/model.constant'),nestjs_cls_1=require(_0x49a3b4(0x1e2)),czTask_service_1=require(_0x49a3b4(0x136)),models_service_1=require(_0x49a3b4(0x251)),DrawTaskPage_dto_1=require(_0x49a3b4(0xc0)),user_constant_1=require(_0x49a3b4(0x164)),dict_service_1=require(_0x49a3b4(0x166)),mjModel_entity_1=require(_0x49a3b4(0xda)),collectType_constant_1=require('../../common/constants/collectType.constant');let MidjourneyService=class MidjourneyService{constructor(_0x53e4d4,_0x3c1911,_0x1412da,_0x596b61,_0x56deee,_0x519e74,_0x302d6e,_0x60da51,_0x2f7880,_0x3d5532,_0x50ed41,_0x187f51,_0x1566d5,_0x5b2fe6,_0x46f911,_0x4eb959,_0xfc9744,_0x191243,_0xeb5876,_0x492eb6,_0x14d8b3,_0x8e7b90){const _0x93103a=_0x49a3b4;this[_0x93103a(0x1dd)]=_0x53e4d4,this['mjParamEntity']=_0x3c1911,this[_0x93103a(0x189)]=_0x1412da,this['midjourneyEntity']=_0x596b61,this[_0x93103a(0xd0)]=_0x56deee,this[_0x93103a(0xff)]=_0x519e74,this[_0x93103a(0x1eb)]=_0x302d6e,this['mjIncantationClassifyEntity']=_0x60da51,this[_0x93103a(0x16a)]=_0x2f7880,this[_0x93103a(0x259)]=_0x3d5532,this[_0x93103a(0x200)]=_0x50ed41,this['fileService']=_0x187f51,this['fanyiService']=_0x1566d5,this[_0x93103a(0x226)]=_0x5b2fe6,this[_0x93103a(0x289)]=_0x46f911,this[_0x93103a(0x1e1)]=_0x4eb959,this[_0x93103a(0x16e)]=_0xfc9744,this[_0x93103a(0x1f4)]=_0x191243,this[_0x93103a(0xf8)]=_0xeb5876,this[_0x93103a(0x14d)]=_0x492eb6,this['globalConfigService']=_0x14d8b3,this[_0x93103a(0x281)]=_0x8e7b90;}async['onModuleInit'](){const _0x440eb9=_0x49a3b4;await this[_0x440eb9(0x174)](),await this[_0x440eb9(0x12f)]();}async[_0x49a3b4(0x12f)](){const _0x57c11d=_0x49a3b4,_0x3a513b=await this[_0x57c11d(0x187)][_0x57c11d(0x24f)]({'where':{'enable':0x1},'order':{'weight':_0x57c11d(0x201)}});_0x3a513b===0x0&&common_1[_0x57c11d(0x212)][_0x57c11d(0x25e)](_0x57c11d(0x140));}async[_0x49a3b4(0x174)](){const _0xdc7632=_0x49a3b4,_0xf61410=await this[_0xdc7632(0x1eb)]['count']();if(_0xf61410===0x0){const _0x3bf410=[{'name':_0xdc7632(0x152),'value':0x1},{'name':'摄影拍照','value':0x2},{'name':_0xdc7632(0x1f3),'value':0x3},{'name':'美女形象','value':0x4},{'name':_0xdc7632(0x252),'value':0x5},{'name':'壁纸绘画','value':0x6},{'name':_0xdc7632(0x12d),'value':0x7},{'name':_0xdc7632(0x269),'value':0x8},{'name':_0xdc7632(0x19e),'value':0x9},{'name':'精选分享','value':0xa}][_0xdc7632(0xcd)](_0x5219ae=>{const _0x40921f=_0xdc7632;return{'name':_0x5219ae['name'],'value':_0x5219ae[_0x40921f(0x1ca)]+'','inner':0x1};});await this['mjInspireClassifyEntity'][_0xdc7632(0x163)](_0x3bf410)['catch'](()=>{const _0xd9608a=_0xdc7632;common_1[_0xd9608a(0x212)][_0xd9608a(0x25e)](_0xd9608a(0x15e));}),common_1['Logger']['log'](_0xdc7632(0xb8));}common_1['Logger'][_0xdc7632(0xfb)](_0xdc7632(0xaa));}async['addMjAccount'](_0x21e12d){const _0x30705f=_0x49a3b4;try{const {guildId:_0x4dbce3,account:_0x4f2a77,authorization:_0xc05421,mode:_0x240538,timeout:_0x40ad0c,channelId:_0x24153e,remark:_0x5b3ee6,mjBotChannelId:_0x35f2c6,nijiBotChannelId:_0x798033}=_0x21e12d;var _0x20d004=await this['mjpAccountService'][_0x30705f(0x1ae)]({'data':{'channelId':_0x24153e,'coreSize':0x3,'guildId':_0x4dbce3,'mjBotChannelId':_0x35f2c6||'','nijiBotChannelId':_0x798033||'','queueSize':0xa,'remark':_0x5b3ee6,'remixAutoSubmit':![],'timeoutMinutes':_0x40ad0c,'userAgent':_0x30705f(0x141),'userToken':_0xc05421}});if(_0x20d004['code']!==0x1)throw new Error(_0x20d004['description']);const _0xfe5dd3=await this[_0x30705f(0x187)][_0x30705f(0x163)]({'account':_0x4f2a77,'authorization':_0xc05421,'mode':_0x240538,'timeout':_0x40ad0c,'channelId':_0x24153e,'guildId':_0x4dbce3,'remark':_0x5b3ee6,'mjpId':_0x20d004[_0x30705f(0x14b)],'mjBotChannelId':_0x35f2c6||'','nijiBotChannelId':_0x798033||''});return await this[_0x30705f(0x278)](_0x20d004[_0x30705f(0x14b)]),!!_0xfe5dd3;}catch(_0x5995b3){common_1['Logger']['error'](_0x5995b3);throw new common_1[(_0x30705f(0x25a))](_0x5995b3[_0x30705f(0xfc)],common_1[_0x30705f(0x10b)][_0x30705f(0x150)]);}}async[_0x49a3b4(0xaf)](_0xdacb05){const _0x1be768=_0x49a3b4,{id:_0x27df2a,account:_0x3cf09d,authorization:_0x2adc5b,mode:_0x5d5412,guildId:_0x1250f8,remark:_0x43cce5,channelId:_0x52f17d,timeout:_0x13d56c,enable:_0x5e45dd,mjBotChannelId:_0x7d980e,nijiBotChannelId:_0xc75179}=_0xdacb05;try{const _0x423f8d=await this[_0x1be768(0x187)][_0x1be768(0xef)]({'id':Number(_0x27df2a)});var _0x3e8194=await this[_0x1be768(0x14d)][_0x1be768(0x19f)]({'data':{'channelId':_0x52f17d,'coreSize':0x3,'guildId':_0x1250f8,'mjBotChannelId':_0x7d980e||'','nijiBotChannelId':_0xc75179||'','queueSize':0xa,'remark':_0x43cce5,'remixAutoSubmit':![],'timeoutMinutes':_0x13d56c,'userAgent':_0x1be768(0x141),'userToken':_0x2adc5b,'enable':Boolean(_0x5e45dd)}},_0x423f8d[_0x1be768(0x1b3)]);if(_0x3e8194[_0x1be768(0x258)]!==0x1)throw new Error(_0x3e8194[_0x1be768(0xe3)]);return await this[_0x1be768(0x187)][_0x1be768(0x1c3)](_0x27df2a,{'account':_0x3cf09d,'authorization':_0x2adc5b,'mode':_0x5d5412,'guildId':_0x1250f8,'remark':_0x43cce5,'channelId':_0x52f17d,'timeout':_0x13d56c,'mjBotChannelId':_0x7d980e||'','nijiBotChannelId':_0xc75179||''});}catch(_0x56e9f1){common_1[_0x1be768(0x212)][_0x1be768(0x25e)](_0x56e9f1);throw new common_1[(_0x1be768(0x25a))](_0x56e9f1['message'],common_1[_0x1be768(0x10b)][_0x1be768(0x150)]);}}async[_0x49a3b4(0x263)](_0x211fb8,_0x20c45b){const _0x357438=_0x49a3b4;_0x211fb8[_0x357438(0x1c4)]=_0x20c45b[_0x357438(0x208)];if(_0x20c45b['mode']==='FAST')_0x211fb8[_0x357438(0xdc)]=midjourney_constant_1[_0x357438(0x22a)][_0x357438(0x222)];else{if(_0x20c45b['mode']===_0x357438(0x16f))_0x211fb8[_0x357438(0xdc)]=midjourney_constant_1[_0x357438(0x22a)]['relax'];else _0x20c45b['mode']===_0x357438(0x1a3)&&(_0x211fb8['mode']=midjourney_constant_1[_0x357438(0x22a)][_0x357438(0x18b)]);}_0x211fb8['fastRemainTime']=_0x20c45b[_0x357438(0x112)],_0x211fb8[_0x357438(0xd9)]=_0x20c45b['fastTimeRemaining'],_0x211fb8[_0x357438(0x24c)]=_0x20c45b[_0x357438(0x24c)],_0x211fb8['relaxedUsage']=_0x20c45b['relaxedUsage'],_0x211fb8[_0x357438(0x240)]=Number(_0x20c45b['remix']);if(_0x20c45b['subscribePlan']==='BASIC')_0x211fb8[_0x357438(0xf3)]=0x1;else{if(_0x20c45b['subscribePlan']===_0x357438(0x1b8))_0x211fb8[_0x357438(0xf3)]=0x2;else{if(_0x20c45b[_0x357438(0x22e)]===_0x357438(0x15b))_0x211fb8[_0x357438(0xf3)]=0x3;else _0x20c45b[_0x357438(0x22e)]===_0x357438(0x168)&&(_0x211fb8['orderPlan']=0x4);}}_0x211fb8[_0x357438(0x17a)]=_0x20c45b['renewDate'],_0x211fb8[_0x357438(0xd1)]=_0x20c45b['timeoutMinutes'],_0x211fb8[_0x357438(0x218)]=JSON['stringify'](_0x20c45b[_0x357438(0x282)]),_0x211fb8[_0x357438(0x1ea)]=JSON['stringify'](_0x20c45b[_0x357438(0x117)]),await this[_0x357438(0x187)][_0x357438(0x163)](_0x211fb8);}async[_0x49a3b4(0x278)](_0x3d70c8){const _0x321a8e=_0x49a3b4;try{if(store_1[_0x321a8e(0x264)][_0x321a8e(0x23e)]!==_0x321a8e(0x245))return;const _0x5d1d5f=await this[_0x321a8e(0x14d)][_0x321a8e(0x19a)]({},_0x3d70c8);if(!_0x5d1d5f)return;const _0x21143b=await this[_0x321a8e(0x187)]['findOne']({'where':{'mjpId':_0x3d70c8}});await this[_0x321a8e(0x263)](_0x21143b,_0x5d1d5f);}catch(_0x67d160){common_1[_0x321a8e(0x212)][_0x321a8e(0x25e)](_0x321a8e(0xc2),_0x67d160);}}async['syncMjpAccountAutomatic'](){const _0x13435a=_0x49a3b4,_0x5a2f92=await this[_0x13435a(0x187)][_0x13435a(0x179)]();if(!_0x5a2f92[_0x13435a(0x288)])return;for(let _0x5ed719=0x0;_0x5ed719<_0x5a2f92[_0x13435a(0x288)];_0x5ed719++){this['syncMjpAccount'](_0x5a2f92[_0x5ed719][_0x13435a(0x1b3)]);}}async['syncMjpAccountManual']({id:_0x2b3f89}){const _0x43e7ed=_0x49a3b4;try{const _0x571acb=await this[_0x43e7ed(0x187)][_0x43e7ed(0xef)]({'id':Number(_0x2b3f89)}),_0x17cc5d=await this[_0x43e7ed(0x14d)][_0x43e7ed(0x155)]({},_0x571acb[_0x43e7ed(0x1b3)]);if(_0x17cc5d[_0x43e7ed(0x258)]!==0x1)throw new Error(_0x17cc5d[_0x43e7ed(0xe3)]);await this[_0x43e7ed(0x263)](_0x571acb,_0x17cc5d['result']);}catch(_0x3c5b3a){throw new common_1['HttpException'](_0x3c5b3a[_0x43e7ed(0xfc)],common_1[_0x43e7ed(0x10b)]['BAD_REQUEST']);}}async[_0x49a3b4(0x1cb)](_0x10f229){const _0x23a856=_0x49a3b4;try{const _0x45ba89=await this['mjParamEntity'][_0x23a856(0xef)]({'id':Number(_0x10f229['id'])}),_0x26e3dd=await this[_0x23a856(0x14d)][_0x23a856(0x1cb)]({'data':_0x10f229},_0x45ba89[_0x23a856(0x1b3)]);if(_0x26e3dd[_0x23a856(0x258)]!==0x1)throw new Error(_0x26e3dd[_0x23a856(0xe3)]);return _0x45ba89['mjVersion']=_0x10f229[_0x23a856(0x208)],await this[_0x23a856(0x187)][_0x23a856(0x163)](_0x45ba89),!![];}catch(_0x5c6d2d){throw new common_1['HttpException'](_0x5c6d2d[_0x23a856(0xfc)],common_1[_0x23a856(0x10b)]['BAD_REQUEST']);}}async[_0x49a3b4(0x1b5)](_0x4f5408){const _0x5bc739=_0x49a3b4;try{const _0x1809d6=await this[_0x5bc739(0x187)]['findOneBy']({'id':Number(_0x4f5408['id'])}),_0x2ae327=await this[_0x5bc739(0x14d)][_0x5bc739(0x1b5)]({'data':_0x4f5408},_0x1809d6[_0x5bc739(0x1b3)]);if(_0x2ae327[_0x5bc739(0x258)]!==0x1)throw new Error(_0x2ae327['description']);return!![];}catch(_0x3efc70){throw new common_1[(_0x5bc739(0x25a))](_0x3efc70[_0x5bc739(0xfc)],common_1[_0x5bc739(0x10b)][_0x5bc739(0x150)]);}}async['removeMjAccount'](_0x1d37ae){const _0xa8908c=_0x49a3b4,{id:_0x545ff9}=_0x1d37ae;try{const _0x42a249=await this[_0xa8908c(0x187)][_0xa8908c(0x103)]({'where':{'id':Number(_0x545ff9)}});if(!_0x42a249)throw new Error(_0xa8908c(0x1a6));common_1[_0xa8908c(0x212)][_0xa8908c(0x25e)](_0xa8908c(0x1ba),_0x42a249['mjpId']);const _0x4d451f=await this[_0xa8908c(0x14d)][_0xa8908c(0x1fb)]({},_0x42a249[_0xa8908c(0x1b3)]);if(_0x4d451f[_0xa8908c(0x258)]!==0x1)throw new Error(_0x4d451f['description']);const _0x50554d=await this[_0xa8908c(0x187)][_0xa8908c(0x1fb)]({'id':_0x545ff9});return _0x50554d[_0xa8908c(0x23c)];}catch(_0xb0dc23){throw new common_1['HttpException'](_0xb0dc23[_0xa8908c(0xfc)],common_1[_0xa8908c(0x10b)]['BAD_REQUEST']);}}async['setMjAccountEnable'](_0x3da322){const _0x558037=_0x49a3b4,{id:_0x467128,enable:_0x3b1899}=_0x3da322;return await this[_0x558037(0x187)]['update'](_0x467128,{'enable':_0x3b1899})[_0x558037(0x1a9)](_0x3c8e57=>_0x3c8e57[_0x558037(0x23c)]>0x0);}async[_0x49a3b4(0x123)](_0x2ce73d,_0x54c49d){const _0x512980=_0x49a3b4,_0x3bc769=(0x0,utils_1[_0x512980(0xeb)])(this[_0x512980(0x16a)]),{id:_0x416949}=_0x2ce73d;let _0x3fe1ff=null;try{const _0x6e280c=await this[_0x512980(0x187)][_0x512980(0x103)]({'where':{'id':_0x416949}});return _0x3bc769&&(_0x3fe1ff=await this['mjpAccountService'][_0x512980(0x19a)]({},_0x6e280c[_0x512980(0x1b3)])),{..._0x6e280c,'mjpAccountInfo':_0x3fe1ff,'authorization':_0x3bc769?_0x6e280c['authorization']:(0x0,utils_1[_0x512980(0x10c)])(_0x6e280c['authorization']),'guildId':_0x3bc769?_0x6e280c[_0x512980(0x129)]:(0x0,utils_1[_0x512980(0x10c)])(_0x6e280c[_0x512980(0x129)]),'channelId':_0x3bc769?_0x6e280c[_0x512980(0x1de)]:(0x0,utils_1[_0x512980(0x10c)])(_0x6e280c[_0x512980(0x1de)])};}catch(_0x40108c){throw new common_1['HttpException'](_0x40108c,common_1[_0x512980(0x10b)]['BAD_REQUEST']);}}async['queryMjAccountList'](_0x1e78ce,_0xa2f9fc){const _0x364f45=_0x49a3b4,{page:page=0x1,size:size=0x14,account:_0x2bda69,channelId:_0x5149c3,enable:_0x4790ba}=_0x1e78ce;if(!page||!size)throw new common_1[(_0x364f45(0x25a))](_0x364f45(0x1c0),common_1[_0x364f45(0x10b)][_0x364f45(0x150)]);const _0x5c62d0={};_0x2bda69&&Object[_0x364f45(0x100)](_0x5c62d0,{'account':(0x0,typeorm_2['Like'])('%'+_0x2bda69+'%')}),_0x5149c3&&Object[_0x364f45(0x100)](_0x5c62d0,{'channelId':(0x0,typeorm_2[_0x364f45(0x21a)])('%'+_0x5149c3+'%')}),_0x4790ba>0x0&&Object[_0x364f45(0x100)](_0x5c62d0,{'enable':_0x4790ba});const [_0x1be9fa,_0x316f6c]=await this[_0x364f45(0x187)]['findAndCount']({'skip':(page-0x1)*size,'where':_0x5c62d0,'take':size,'order':{'createdAt':'DESC'},'cache':!![],'select':['id',_0x364f45(0x129),_0x364f45(0x1de),_0x364f45(0x16d),_0x364f45(0x1ed),'weight',_0x364f45(0xa7),_0x364f45(0x20a),_0x364f45(0xf3),_0x364f45(0x17a),_0x364f45(0xf0),_0x364f45(0xdc)]});return(0x0,utils_1[_0x364f45(0xeb)])(this[_0x364f45(0x16a)])?{'rows':_0x1be9fa||[],'count':_0x316f6c||0x0}:{'rows':_0x1be9fa[_0x364f45(0xcd)](_0x113418=>({..._0x113418,'authorization':(0x0,utils_1[_0x364f45(0x10c)])(_0x113418[_0x364f45(0x16d)]),'guildId':(0x0,utils_1[_0x364f45(0x10c)])(_0x113418['guildId']),'channelId':(0x0,utils_1[_0x364f45(0x10c)])(_0x113418['channelId'])}))||[],'count':_0x316f6c||0x0};}async[_0x49a3b4(0x169)](_0x394d09,_0x5ae7a1,_0x97d8df){const _0x1adafb=_0x49a3b4;try{const _0x2a72d6=(0x0,utils_1['getReqSaasId'])(this[_0x1adafb(0x16a)]),{page:page=0x1,size:size=0x14,botType:_0x2ce616,action:_0x48d0f9,keyword:_0x186f34,userId:_0x5b1128,rec:_0x11cdd4,status:_0x389bf5,squareType:_0x508a13,workflowId:_0x3d0934,saasId:_0x344da5}=_0x394d09,_0x190821={};_0x2ce616&&_0x2ce616[_0x1adafb(0x288)]&&(_0x190821[_0x1adafb(0x298)]=(0x0,typeorm_2['In'])(_0x2ce616));_0x48d0f9&&(_0x190821[_0x1adafb(0x1b5)]=_0x48d0f9);_0x186f34&&(_0x190821[_0x1adafb(0x1b1)]=(0x0,typeorm_2['Like'])('%'+_0x186f34+'%'));_0x97d8df&&_0x5b1128&&(_0x190821[_0x1adafb(0x249)]=_0x5b1128);_0x5ae7a1&&_0x5ae7a1[_0x1adafb(0x293)]?.['id']&&(_0x190821[_0x1adafb(0x249)]=_0x5ae7a1['user']['id']);_0x508a13&&(_0x190821[_0x1adafb(0x11a)]=_0x508a13);_0x3d0934&&(_0x190821[_0x1adafb(0x29b)]=_0x3d0934);_0x11cdd4!==null&&_0x11cdd4!==undefined&&(_0x190821[_0x1adafb(0x292)]=_0x11cdd4);_0x11cdd4!==null&&_0x389bf5!==undefined&&(_0x190821['status']=_0x389bf5);(0x0,utils_1[_0x1adafb(0x204)])(this['clsService'])?(0x0,utils_1[_0x1adafb(0x1d0)])(_0x344da5)&&(_0x190821[_0x1adafb(0x1c1)]=_0x344da5):_0x190821[_0x1adafb(0x1c1)]=_0x2a72d6;const [_0x5335cb,_0x220990]=await this[_0x1adafb(0x181)][_0x1adafb(0x27e)]({'where':_0x190821,'take':size,'skip':(page-0x1)*size,'order':{'createdAt':_0x1adafb(0x201)}}),_0xd3775c=new Map(),_0x4b5e8f=_0x5335cb[_0x1adafb(0xcd)](_0x462efa=>_0x462efa[_0x1adafb(0x29b)])[_0x1adafb(0xd8)](_0x122ba3=>Boolean(_0x122ba3));if(_0x4b5e8f[_0x1adafb(0x288)]){const _0x1471d0=await this[_0x1adafb(0x289)]['getModelByIds'](_0x4b5e8f);_0x1471d0[_0x1adafb(0x24d)](_0x2526bd=>_0xd3775c[_0x1adafb(0x261)](_0x2526bd['id'],_0x2526bd));}const _0x1a5f74=_0x5335cb['map'](_0x5046a4=>{const _0x2f868f=_0x1adafb;return{..._0x5046a4,'workflowName':_0xd3775c[_0x2f868f(0x1ef)](_0x5046a4[_0x2f868f(0x29b)])?.['modelName']||''};});if(_0x97d8df){const _0x23577f=_0x1a5f74[_0x1adafb(0xcd)](_0x693093=>_0x693093[_0x1adafb(0x249)]),_0x32b72c=await this[_0x1adafb(0x200)]['getUserListByIds'](_0x23577f);_0x1a5f74[_0x1adafb(0x24d)](_0x1e4e19=>{const _0x2e3bd8=_0x1adafb,_0x4a0b21=_0x32b72c[_0x2e3bd8(0x179)](_0x4b29c7=>_0x4b29c7['id']===_0x1e4e19[_0x2e3bd8(0x249)]);!(0x0,utils_1[_0x2e3bd8(0xeb)])(this[_0x2e3bd8(0x16a)])&&(_0x4a0b21[_0x2e3bd8(0x1fe)]=(0x0,utils_1[_0x2e3bd8(0x10c)])(_0x4a0b21[_0x2e3bd8(0x1fe)]),_0x4a0b21[_0x2e3bd8(0x9e)]=(0x0,utils_1[_0x2e3bd8(0x10c)])(_0x4a0b21[_0x2e3bd8(0x9e)])),_0x1e4e19['userInfo']=_0x4a0b21;});}else{const _0x5e7afa=_0x1a5f74['map'](_0x223ede=>_0x223ede['userId']),_0x56e865=await this[_0x1adafb(0x200)]['getUserListByIds'](_0x5e7afa);_0x1a5f74[_0x1adafb(0x24d)](_0x34120e=>{const _0x1d2f48=_0x1adafb,_0x12a267=_0x56e865['find'](_0x11c4c5=>_0x11c4c5['id']===_0x34120e['userId']);if(_0x12a267){const _0x27489b={'nickname':_0x12a267?.[_0x1d2f48(0x219)],'avatar':_0x12a267?.['avatar']};_0x34120e[_0x1d2f48(0xe8)]=_0x27489b;}});}const _0x21cc64=_0x5ae7a1?this['userService']['getUserInfoFromHeader'](_0x5ae7a1):null,_0xa1403e=_0x21cc64?.['id'],_0x27a173=_0x5335cb[_0x1adafb(0xcd)](_0xb580ac=>_0xb580ac['id']),_0x423ef7=await this['aiLogService'][_0x1adafb(0x21e)](_0xa1403e,_0x27a173,model_constant_1[_0x1adafb(0x28f)][_0x1adafb(0x21f)]),_0x531f47=new Map(),_0x4a10d0=_0x5335cb['map'](_0x1783f3=>_0x1783f3[_0x1adafb(0x249)])[_0x1adafb(0xd8)](_0x2288d0=>_0x2288d0);if(_0x4a10d0[_0x1adafb(0x288)]){const _0x3e2014=(await this[_0x1adafb(0x200)]['getUserListByIds'](_0x4a10d0))[_0x1adafb(0xcd)](_0x84cfa3=>{const _0x36c323=_0x1adafb;return{'id':_0x84cfa3['id'],'nickname':_0x84cfa3[_0x36c323(0x219)],'avatar':_0x84cfa3[_0x36c323(0xfa)]};});_0x3e2014[_0x1adafb(0x24d)](_0x4031bb=>_0x531f47[_0x1adafb(0x261)](_0x4031bb['id'],_0x4031bb));}const _0x34e393=await this['aiLogService']['getExtByRelate'](_0x27a173,model_constant_1[_0x1adafb(0x28f)][_0x1adafb(0x21f)]);_0x1a5f74[_0x1adafb(0x24d)](_0x385cfc=>{const _0x3f111e=_0x1adafb,_0x2f6ad8=_0x34e393[_0x3f111e(0x1ef)](_0x385cfc['id']);_0x385cfc[_0x3f111e(0xa3)]=_0x423ef7[_0x3f111e(0x1ef)](_0x385cfc['id'])||null,_0x385cfc[_0x3f111e(0xe8)]=_0x531f47[_0x3f111e(0x1ef)](_0x385cfc[_0x3f111e(0x249)]),_0x385cfc[_0x3f111e(0x183)]=_0x2f6ad8?.['agreeNum']||0x0;});let _0x1cba37=await this[_0x1adafb(0x200)][_0x1adafb(0x228)](_0x5335cb,_0xa1403e,collectType_constant_1[_0x1adafb(0xcf)]['MJ']);return _0x1cba37=await this[_0x1adafb(0x200)][_0x1adafb(0x188)](_0x5335cb,collectType_constant_1['UserCollectType']['MJ']),{'rows':_0x1cba37,'count':_0x220990};}catch(_0x2a4f5b){throw new common_1[(_0x1adafb(0x25a))](_0x2a4f5b['message'],common_1[_0x1adafb(0x10b)][_0x1adafb(0x150)]);}}async[_0x49a3b4(0x1aa)](_0x18668b){const _0x550117=_0x49a3b4,_0x986dd5=await this['globalConfigService'][_0x550117(0x23f)]([_0x550117(0x26a)]),_0x153d70=Number(_0x986dd5||0x0);if(_0x153d70===0x0)return!![];const _0x273033=await this['midjourneyEntity'][_0x550117(0x24f)]({'where':{'userId':_0x18668b,'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6])}});if(_0x273033<_0x153d70)return!![];else throw new Error('任务已达最大并发数，请等待其他任务完成后再提交新任务！');}async[_0x49a3b4(0x24b)](_0x5c3705){const _0x572f42=_0x49a3b4;if(store_1['MjConfig'][_0x572f42(0x23e)]!=='mjProxy')return null;return null;}async[_0x49a3b4(0xd5)](_0x44d0d1,_0x9c7767){const _0x177b57=_0x49a3b4,_0x2109dc=await this[_0x177b57(0x181)][_0x177b57(0x24f)]({'where':{'originTaskId':String(_0x44d0d1),'customId':_0x9c7767}});if(_0x2109dc>0x0)throw new common_1['HttpException'](_0x177b57(0x11b),common_1[_0x177b57(0x10b)]['BAD_REQUEST']);return![];}async[_0x49a3b4(0x17c)](_0x2b28fc){const _0x51374d=_0x49a3b4,_0xfa8e01=new addDrawQueue_dto_1[(_0x51374d(0xad))](_0x2b28fc);await this[_0x51374d(0x1f4)]['checkBadWords'](_0xfa8e01['fullPrompt'],_0xfa8e01[_0x51374d(0x249)]);const _0x5c183e=(0x0,utils_1[_0x51374d(0x109)])(this[_0x51374d(0x16a)]);_0xfa8e01[_0x51374d(0x1c1)]=_0x5c183e;const _0x39762e=await this['midjourneyEntity'][_0x51374d(0x163)](_0xfa8e01);return _0x39762e;}[_0x49a3b4(0x28a)](_0x3d3d42){const _0x2a1206=_0x49a3b4,_0x1a6f00=_0x3d3d42[_0x2a1206(0x221)](),_0x46efbe=_0x1a6f00['split']('\x20'),_0x46dddd={};for(let _0x341ed2=0x0;_0x341ed2<_0x46efbe['length'];_0x341ed2++){_0x46efbe[_0x341ed2][_0x2a1206(0x171)]('--')&&(_0x341ed2+0x1<_0x46efbe['length']&&!_0x46efbe[_0x341ed2+0x1][_0x2a1206(0x171)]('--')?(_0x46dddd[_0x46efbe[_0x341ed2]]=_0x46efbe[_0x341ed2+0x1],_0x341ed2++):_0x46dddd[_0x46efbe[_0x341ed2]]=_0x46efbe[_0x341ed2]);}return _0x46dddd;}async[_0x49a3b4(0x275)](_0x276571,_0xc90b4d){const _0x4ef43d=_0x49a3b4;let _0x5b6f81,{botType:_0x4c13a0,prompt:_0x4e9bcd,extend:_0x3be20b,action:_0x5a5dfa,mode:_0x3c3647,translate:_0x100dc0,base64Array:_0x5b374c,mats:mats=[],iw:_0x33acff,roles:roles=[],cw:_0x1ae798,styles:styles=[],sw:_0xb07089}=_0xc90b4d;_0x3c3647=await this[_0x4ef43d(0x200)][_0x4ef43d(0x1e0)](_0x276571[_0x4ef43d(0x293)]['id'],_0x3c3647,_0x4ef43d(0x191));const _0x1a104d=_0x4e9bcd,_0xce733e=await this[_0x4ef43d(0x24b)](_0x3c3647);_0x4e9bcd&&await this[_0x4ef43d(0x1f4)]['checkBadWords'](_0x4e9bcd,_0x276571[_0x4ef43d(0x293)]['id']),_0x4e9bcd=_0x100dc0===0x1&&(0x0,utils_1[_0x4ef43d(0x285)])(_0x4e9bcd)?await this['fanyiService'][_0x4ef43d(0x10d)](_0x4e9bcd):_0x4e9bcd;let _0x54a7e8=_0x4e9bcd;mats['length']&&(_0x54a7e8=mats[_0x4ef43d(0x158)]('\x20')+'\x20'+_0x54a7e8);_0x33acff&&_0x4e9bcd[_0x4ef43d(0x211)]('--iw')==-0x1&&(_0x54a7e8=_0x54a7e8+_0x4ef43d(0x197)+_0x33acff);styles[_0x4ef43d(0x288)]&&_0x4e9bcd[_0x4ef43d(0x211)](_0x4ef43d(0x144))==-0x1&&(_0x54a7e8=_0x54a7e8+_0x4ef43d(0x267)+styles['join']('\x20'));roles[_0x4ef43d(0x288)]&&_0x4e9bcd[_0x4ef43d(0x211)]('--cref')==-0x1&&(_0x54a7e8=_0x54a7e8+_0x4ef43d(0x1b9)+roles[_0x4ef43d(0x158)]('\x20'));_0x1ae798&&_0x4e9bcd['indexOf'](_0x4ef43d(0xf5))==-0x1&&(_0x54a7e8=_0x54a7e8+_0x4ef43d(0x160)+_0x1ae798);_0xb07089&&_0x4e9bcd['indexOf'](_0x4ef43d(0x248))==-0x1&&(_0x54a7e8=_0x54a7e8+_0x4ef43d(0x102)+_0xb07089);if(_0x3be20b){const _0x4f9600=this[_0x4ef43d(0x28a)](_0x3be20b);Object[_0x4ef43d(0x159)](_0x4f9600)[_0x4ef43d(0x24d)](_0xe9acdd=>{const _0x1ade37=_0x4ef43d;_0x4e9bcd[_0x1ade37(0x211)](_0xe9acdd)==-0x1&&(_0xe9acdd!=_0x4f9600[_0xe9acdd]?_0x54a7e8+='\x20'+_0xe9acdd+'\x20'+_0x4f9600[_0xe9acdd]:_0x54a7e8+='\x20'+_0xe9acdd);});}const _0x3e3e90=await this[_0x4ef43d(0x16e)][_0x4ef43d(0x275)]({'data':{'mode':this['convertMode4Transfer'](_0x3c3647),'prompt':_0x54a7e8,'botType':_0x4c13a0||_0x4ef43d(0x28d),'base64Array':_0x5b374c,'accountFilter':_0xce733e}});if(_0x3e3e90['code']===0x17)throw new Error(_0x4ef43d(0x229));if(_0x3e3e90[_0x4ef43d(0x258)]===0x18)throw new Error(_0x4ef43d(0x22d));if(_0x3e3e90[_0x4ef43d(0x258)]!==0x1&&_0x3e3e90[_0x4ef43d(0x258)]!==0x16)throw new Error(_0x3e3e90['description']);return _0x5b6f81=await this[_0x4ef43d(0x281)]['transaction'](async()=>{const _0x492dc5=_0x4ef43d,_0x3e01c3={'mode':_0x3c3647,'prompt':_0x4e9bcd,'action':_0x5a5dfa,'translate':_0x100dc0,'fullPrompt':_0x54a7e8,'originPrompt':_0x1a104d,'extraParam':_0x3be20b,'userId':_0x276571[_0x492dc5(0x293)]['id'],'mjpId':_0xce733e?.[_0x492dc5(0x220)],'mjpTaskId':_0x3e3e90[_0x492dc5(0x14b)],'botType':_0x4c13a0||_0x492dc5(0x28d),'requestParams':_0xc90b4d},_0xe0af1d=await this['addDrawQueue'](_0x3e01c3);if(!_0xe0af1d)throw new Error(_0x492dc5(0x22f));return await this[_0x492dc5(0x200)][_0x492dc5(0xec)](_0x276571[_0x492dc5(0x293)]['id'],_0x3c3647,_0x492dc5(0x191),_0xe0af1d['id']),_0xe0af1d;}),_0x5b6f81;}async[_0x49a3b4(0x1c6)](_0x2c866b,_0x49c3b7){const _0x31656b=_0x49a3b4;let _0x1e7be6;const {action:_0x24c9df,taskId:_0x3287a2,customId:_0x535d58,prompt:_0x29462d,mask:_0x52ba20,enableRemix:_0x19275b}=_0x49c3b7,_0x27a31f=await this[_0x31656b(0x181)][_0x31656b(0x103)]({'where':{'id':_0x3287a2}});if(!_0x27a31f)throw new Error(_0x31656b(0x1d8));let _0x3d027c=await this['userService']['validateBalance4MJ'](_0x2c866b[_0x31656b(0x293)]['id'],_0x27a31f[_0x31656b(0xdc)],_0x535d58);const _0x30d9f4=await this[_0x31656b(0x16e)][_0x31656b(0x1b5)]({'data':{'customId':_0x535d58,'taskId':_0x27a31f[_0x31656b(0x10f)],'accountFilter':{'instanceId':_0x27a31f[_0x31656b(0x1b3)]},'mode':this['convertMode4Transfer'](_0x3d027c),'enableRemix':_0x19275b===undefined?!![]:_0x19275b}});if(_0x30d9f4[_0x31656b(0x258)]===0x17)throw new Error(_0x31656b(0x229));else{if(_0x30d9f4['code']===0x18)throw new Error(_0x31656b(0x22d));else{if(_0x30d9f4[_0x31656b(0x258)]===0x15)setTimeout(()=>this[_0x31656b(0x122)](_0x30d9f4[_0x31656b(0x14b)]));else{if(_0x30d9f4[_0x31656b(0x258)]!==0x1&&_0x30d9f4['code']!==0x16)throw new Error(_0x30d9f4[_0x31656b(0xe3)]);}}}return _0x1e7be6=await this[_0x31656b(0x281)][_0x31656b(0xa6)](async()=>{const _0x4c7a8c=_0x31656b,_0x4dfbd7={'action':_0x24c9df,'customId':_0x535d58,'userId':_0x2c866b[_0x4c7a8c(0x293)]['id'],'mjpTaskId':_0x30d9f4[_0x4c7a8c(0x14b)],'originTaskId':String(_0x3287a2),'mode':_0x3d027c,'mjpId':_0x27a31f[_0x4c7a8c(0x1b3)],'prompt':_0x27a31f[_0x4c7a8c(0x1f0)],'botType':_0x27a31f['botType'],'extraParam':_0x27a31f[_0x4c7a8c(0x182)],'fullPrompt':_0x27a31f[_0x4c7a8c(0x1da)],'originPrompt':_0x27a31f['originPrompt']},_0x40fcbc=await this[_0x4c7a8c(0x17c)](_0x4dfbd7);if(!_0x40fcbc)throw new Error('提交动作失败');const _0x2832b9=_0x27a31f[_0x4c7a8c(0x282)];return _0x27a31f['buttons'][_0x4c7a8c(0x24d)](_0x281785=>{const _0x1ee594=_0x4c7a8c;_0x281785[_0x1ee594(0x176)]===_0x49c3b7['customId']&&(_0x281785[_0x1ee594(0xb9)]=!![]);}),await this[_0x4c7a8c(0x181)][_0x4c7a8c(0x163)](_0x27a31f),await this['userService'][_0x4c7a8c(0xec)](_0x2c866b[_0x4c7a8c(0x293)]['id'],_0x3d027c,_0x535d58,_0x40fcbc['id']),_0x40fcbc;}),_0x1e7be6;}async[_0x49a3b4(0x270)](_0x50e17f,_0x2f544c){const _0x29f8b=_0x49a3b4;let _0x3441c0,{action:_0x5b8bb1,taskId:_0x4c7ff5,customId:_0x2ee83f,prompt:_0x23be86,mask:_0x481f95}=_0x2f544c;const _0x20ac55=await this[_0x29f8b(0x181)][_0x29f8b(0x103)]({'where':{'id':_0x4c7ff5}});if(!_0x20ac55)throw new Error('无绘图记录');const _0x5809c2=_0x23be86;_0x23be86&&await this[_0x29f8b(0x1f4)][_0x29f8b(0x1ab)](_0x23be86,_0x50e17f['user']['id']),_0x23be86=(0x0,utils_1[_0x29f8b(0x285)])(_0x23be86)?await this[_0x29f8b(0xa9)]['convertToEnglish'](_0x23be86):_0x23be86;const _0x2089b4={'taskId':_0x20ac55[_0x29f8b(0x10f)]};_0x23be86&&(_0x2089b4['prompt']=_0x23be86);_0x481f95&&(_0x2089b4[_0x29f8b(0x1c2)]=_0x481f95);const _0x2e8d5d=await this[_0x29f8b(0x16e)][_0x29f8b(0x12b)]({'data':_0x2089b4});if(_0x2e8d5d[_0x29f8b(0x258)]!==0x1&&_0x2e8d5d[_0x29f8b(0x258)]!==0x16)throw new Error(_0x2e8d5d['description']);_0x3441c0=await this[_0x29f8b(0x181)][_0x29f8b(0x163)]({'id':_0x4c7ff5,'prompt':_0x23be86,'status':0x1,'originPrompt':_0x5809c2,'messageFlags':0x1,'requestParams':_0x2f544c});for(let _0x232da9 in _0x3441c0){_0x3441c0[_0x232da9]&&(_0x20ac55[_0x232da9]=_0x3441c0[_0x232da9]);}return _0x20ac55;}async['handleAddDrawTask'](_0x453708,_0x4d4b54){const _0x4852dd=_0x49a3b4;let _0x3821c1,_0x523ce4;try{let {type:_0x2786c8,params:_0x4120e1}=_0x453708;await this[_0x4852dd(0x200)]['checkUserStatus'](_0x4d4b54[_0x4852dd(0x293)]),await this['concurrentLimit'](_0x4d4b54[_0x4852dd(0x293)]['id']);if(_0x2786c8===midjourney_constant_1[_0x4852dd(0x12a)][_0x4852dd(0x1d9)])_0x523ce4=await this[_0x4852dd(0x275)](_0x4d4b54,_0x4120e1),_0x3821c1=_0x523ce4['mjpTaskId'];else{if(_0x2786c8===midjourney_constant_1[_0x4852dd(0x12a)][_0x4852dd(0x1be)])_0x4120e1=_0x4120e1,_0x4120e1[_0x4852dd(0x176)]?(_0x523ce4=await this[_0x4852dd(0x1c6)](_0x4d4b54,_0x4120e1),_0x4120e1['prompt']&&(_0x4120e1[_0x4852dd(0x28b)]=_0x523ce4['id'],_0x523ce4=await this[_0x4852dd(0x270)](_0x4d4b54,_0x4120e1))):_0x523ce4=await this[_0x4852dd(0x270)](_0x4d4b54,_0x4120e1),_0x3821c1=_0x523ce4[_0x4852dd(0x10f)];else return new common_1[(_0x4852dd(0x25a))](_0x4852dd(0x128),common_1['HttpStatus'][_0x4852dd(0x150)]);}return _0x523ce4;}catch(_0x237990){if(_0x237990 instanceof common_1[_0x4852dd(0x25a)])throw _0x237990;else{_0x3821c1&&await this[_0x4852dd(0x16e)]['cancel']({},_0x3821c1);throw new common_1['HttpException'](_0x237990[_0x4852dd(0xfc)],common_1[_0x4852dd(0x10b)][_0x4852dd(0x150)]);}}}async[_0x49a3b4(0x253)](_0x427d45,_0x573ea1){const _0x5787fc=_0x49a3b4;let _0xd82ecb,_0x131a63;try{let {type:_0x281d7b,botType:_0x5cc571,files:_0x42aed7,mode:_0x9277,action:_0x51f975,size:_0xc2b766,base64Array:base64Array=[]}=_0x427d45;await this[_0x5787fc(0x200)][_0x5787fc(0x104)](_0x573ea1[_0x5787fc(0x293)]),await this[_0x5787fc(0x1aa)](_0x573ea1['user']['id']);let _0x295fc5='';if(Number(_0x281d7b)===midjourney_constant_1[_0x5787fc(0x12a)][_0x5787fc(0xbb)])_0x295fc5='Blend';else Number(_0x281d7b)===midjourney_constant_1[_0x5787fc(0x12a)][_0x5787fc(0xc3)]&&(_0x295fc5=_0x5787fc(0x255));_0x9277=await this['userService']['validateBalance4MJ'](_0x573ea1[_0x5787fc(0x293)]['id'],_0x9277,_0x295fc5);const _0x71a57f=await this[_0x5787fc(0x24b)](_0x9277);if(!base64Array[_0x5787fc(0x288)])for(let _0x950e02=0x0;_0x950e02<_0x42aed7[_0x5787fc(0x288)];_0x950e02++){base64Array[_0x5787fc(0x14e)](_0x5787fc(0xdf)+_0x42aed7[_0x950e02][_0x5787fc(0xca)][_0x5787fc(0xab)](_0x5787fc(0x1a4)));}if(Number(_0x281d7b)===midjourney_constant_1[_0x5787fc(0x12a)][_0x5787fc(0xbb)]){if(base64Array[_0x5787fc(0x288)]<0x2)throw new Error(_0x5787fc(0xb4));const _0x1f84b1=await this['mjpTaskService'][_0x5787fc(0x121)]({'data':{'mode':this[_0x5787fc(0x287)](_0x9277),'dimensions':_0xc2b766,'botType':'MID_JOURNEY','base64Array':base64Array,'accountFilter':_0x71a57f}});if(_0x1f84b1[_0x5787fc(0x258)]===0x17)throw new Error(_0x5787fc(0x229));if(_0x1f84b1['code']!==0x1&&_0x1f84b1[_0x5787fc(0x258)]!==0x16)throw new Error(_0x1f84b1[_0x5787fc(0xe3)]);_0xd82ecb=_0x1f84b1[_0x5787fc(0x14b)],_0x131a63=await this['connection'][_0x5787fc(0xa6)](async()=>{const _0x49a4d9=_0x5787fc,_0x135dea={'mode':_0x9277,'action':_0x51f975,'userId':_0x573ea1[_0x49a4d9(0x293)]['id'],'jobId':(0x0,utils_1[_0x49a4d9(0x118)])(),'botType':_0x5cc571||_0x49a4d9(0x28d),'extraParam':JSON[_0x49a4d9(0x1cc)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x1f84b1['result']},_0xc3a836=await this[_0x49a4d9(0x17c)](_0x135dea);if(!_0xc3a836)throw new Error(_0x49a4d9(0x106));return await this[_0x49a4d9(0x200)][_0x49a4d9(0xec)](_0x573ea1[_0x49a4d9(0x293)]['id'],_0x9277,_0x295fc5,_0xc3a836['id']),_0xc3a836;});}else{if(Number(_0x281d7b)===midjourney_constant_1['MidJourneyDrawEnum']['IMAGE_TO_TEXT']){const _0x3ebc1b=await this[_0x5787fc(0x16e)]['describe']({'data':{'mode':this[_0x5787fc(0x287)](_0x9277),'botType':_0x5787fc(0x28d),'base64':base64Array[0x0],'accountFilter':_0x71a57f}});if(_0x3ebc1b['code']===0x17)throw new Error('队列已满，请稍后尝试');if(_0x3ebc1b[_0x5787fc(0x258)]!==0x1&&_0x3ebc1b[_0x5787fc(0x258)]!==0x16)throw new Error(_0x3ebc1b[_0x5787fc(0xe3)]);_0xd82ecb=_0x3ebc1b[_0x5787fc(0x14b)],_0x131a63=await this[_0x5787fc(0x281)][_0x5787fc(0xa6)](async()=>{const _0x3fe2af=_0x5787fc,_0x5f4334={'mode':_0x9277,'action':_0x51f975,'userId':_0x573ea1[_0x3fe2af(0x293)]['id'],'jobId':(0x0,utils_1[_0x3fe2af(0x118)])(),'botType':_0x5cc571||_0x3fe2af(0x28d),'extraParam':JSON[_0x3fe2af(0x1cc)]({'attachments':[]}),'originPrompt':'','mjpTaskId':_0x3ebc1b[_0x3fe2af(0x14b)]},_0x4e01bd=await this['addDrawQueue'](_0x5f4334);if(!_0x4e01bd)throw new Error(_0x3fe2af(0x198));return await this[_0x3fe2af(0x200)][_0x3fe2af(0xec)](_0x573ea1['user']['id'],_0x9277,_0x295fc5,_0x4e01bd['id']),_0x4e01bd;})['catch'](async _0x1c1683=>{const _0x7e2d64=_0x5787fc;await this[_0x7e2d64(0x16e)]['cancel']({},_0x3ebc1b[_0x7e2d64(0x14b)]);throw _0x1c1683;});}else return new common_1['HttpException'](_0x5787fc(0x128),common_1[_0x5787fc(0x10b)][_0x5787fc(0x150)]);}return _0x131a63;}catch(_0x49397a){if(_0x49397a instanceof common_1[_0x5787fc(0x25a)])throw _0x49397a;else{_0xd82ecb&&await this['mjpTaskService']['cancel']({},_0xd82ecb);throw new common_1[(_0x5787fc(0x25a))](_0x49397a[_0x5787fc(0xfc)],common_1[_0x5787fc(0x10b)][_0x5787fc(0x150)]);}}}async['insightFace'](_0x5a9943,_0x4ec2c8){const _0x24b97e=_0x49a3b4;let _0x3463a6;try{const {params:_0x22734f}=_0x5a9943;let {mode:_0x58a9cc,botType:_0x5bf1f5,action:_0x1fe0d1,extend:_0x1a873c,sourceBase64:_0x1a1b8b,targetBase64:_0x3e12d2}=_0x22734f;await this[_0x24b97e(0x200)][_0x24b97e(0x104)](_0x4ec2c8[_0x24b97e(0x293)]),await this['concurrentLimit'](_0x4ec2c8['user']['id']),_0x58a9cc=await this[_0x24b97e(0x200)][_0x24b97e(0x1e0)](_0x4ec2c8['user']['id'],_0x58a9cc,'FaceSwap');const _0x532759=await this['distributeAccount'](_0x58a9cc),_0x20436a=await this[_0x24b97e(0x16e)][_0x24b97e(0x256)]({'data':{'sourceBase64':_0x1a1b8b,'targetBase64':_0x3e12d2,'state':_0x1a873c,'mode':this[_0x24b97e(0x287)](_0x58a9cc),'accountFilter':_0x532759}});if(_0x20436a['code']===0x17)throw new Error(_0x24b97e(0x229));if(_0x20436a['code']===0x18)throw new Error(_0x24b97e(0x22d));if(_0x20436a[_0x24b97e(0x258)]!==0x1&&_0x20436a['code']!==0x16)throw new Error(_0x20436a[_0x24b97e(0xe3)]);return _0x3463a6=await this[_0x24b97e(0x281)][_0x24b97e(0xa6)](async()=>{const _0x276139=_0x24b97e,_0x1e0e16={'mode':_0x58a9cc,'action':_0x1fe0d1,'prompt':null,'extraParam':_0x1a873c,'originPrompt':null,'userId':_0x4ec2c8['user']['id'],'mjpId':_0x532759?.[_0x276139(0x220)],'mjpTaskId':_0x20436a[_0x276139(0x14b)],'botType':_0x5bf1f5||_0x276139(0x28d)},_0x326179=new addDrawQueue_dto_1[(_0x276139(0xad))](_0x1e0e16),_0x3577e5=(0x0,utils_1[_0x276139(0x109)])(this[_0x276139(0x16a)]);_0x326179[_0x276139(0x1c1)]=_0x3577e5;const _0x236962=await this['midjourneyEntity']['save'](_0x326179);if(!_0x236962)throw new Error(_0x276139(0x22f));return await this[_0x276139(0x200)][_0x276139(0xec)](_0x4ec2c8['user']['id'],_0x58a9cc,_0x276139(0xc4),_0x236962['id']),_0x236962;}),_0x3463a6;}catch(_0x4fe670){if(_0x4fe670 instanceof common_1[_0x24b97e(0x25a)])throw _0x4fe670;else throw new common_1[(_0x24b97e(0x25a))](_0x4fe670[_0x24b97e(0xfc)],common_1[_0x24b97e(0x10b)][_0x24b97e(0x150)]);}}async[_0x49a3b4(0x227)](_0x74b505,_0x2d3513){const _0x29d6f4=_0x49a3b4,_0xacdcbf=(0x0,utils_1[_0x29d6f4(0x109)])(this[_0x29d6f4(0x16a)]),_0x3ff2cf={'userId':_0x2d3513[_0x29d6f4(0x293)]['id'],'jobId':(0x0,utils_1[_0x29d6f4(0x118)])(),'mode':0x1,'translate':0x0,'prompt':'','progress':0x64,'durationSpent':0x0,'status':0x3,'fullPrompt':_0x74b505[_0x29d6f4(0x1f0)],'originPrompt':_0x74b505[_0x29d6f4(0x1f0)],'fileInfo':_0x74b505[_0x29d6f4(0x1a0)],'botType':_0x74b505[_0x29d6f4(0x298)],'imageUrl':_0x74b505['imageUrl'],'buttons':[],'saasId':_0xacdcbf},_0x137291=await this['midjourneyEntity']['save'](_0x3ff2cf);return _0x137291;}async[_0x49a3b4(0x1df)](_0x1280c7){const _0x4622b0=_0x49a3b4;try{const _0x567160=await this[_0x4622b0(0x181)][_0x4622b0(0x103)]({'where':{'jobId':_0x1280c7}});if(!_0x567160)throw new Error('任务不存在！');const _0x1f0f84=await this['mjpTaskService'][_0x4622b0(0x1df)]({},_0x567160[_0x4622b0(0x10f)]);if(_0x1f0f84[_0x4622b0(0x258)]!==0x1)throw new Error(_0x1f0f84[_0x4622b0(0xe3)]);return _0x1f0f84[_0x4622b0(0x14b)];}catch(_0x1add35){throw new common_1[(_0x4622b0(0x25a))](_0x1add35[_0x4622b0(0xfc)],common_1[_0x4622b0(0x10b)][_0x4622b0(0x150)]);}}async[_0x49a3b4(0xce)](_0x6f1bf5,_0x6c9704){const _0x22101b=_0x49a3b4;try{let _0x2f5482,_0x8bf053,_0x3afa48,_0x541af0;const {jobId:_0x3da11b,detail:_0x4ccdc8}=_0x6c9704,_0xd60c2f=(0x0,utils_1[_0x22101b(0x161)])(this[_0x22101b(0x16a)]),_0x226898=await this['midjourneyEntity'][_0x22101b(0x103)]({'where':{'jobId':_0x3da11b}});if(_0x226898['workflowId']){const _0x450c0b=await this[_0x22101b(0x289)][_0x22101b(0x165)](_0x226898[_0x22101b(0x29b)]);_0x541af0=_0x450c0b['modelName'];}return _0x4ccdc8&&(this[_0x22101b(0x226)]['increaseVisit'](model_constant_1[_0x22101b(0x28f)][_0x22101b(0x21f)],_0x226898['id']),_0x2f5482=await this['userService']['getUserById'](_0x226898[_0x22101b(0x249)]),_0x8bf053=await this[_0x22101b(0x226)][_0x22101b(0x20b)](model_constant_1[_0x22101b(0x28f)][_0x22101b(0x21f)],_0x226898['id']),_0xd60c2f&&(_0x3afa48=await this['aiLogService'][_0x22101b(0x110)](model_constant_1[_0x22101b(0x28f)][_0x22101b(0x21f)],_0x226898['id']))),{..._0x226898,'workflowName':_0x541af0,'avatar':_0x2f5482?_0x2f5482[_0x22101b(0xfa)]:null,'username':_0x2f5482?_0x2f5482['username']:null,'nickname':_0x2f5482?_0x2f5482[_0x22101b(0x219)]:null,'visitNum':_0x8bf053?_0x8bf053['visitNum']:0x0,'agreeNum':_0x8bf053?_0x8bf053['agreeNum']:0x0,'agree':_0x3afa48?_0x3afa48[_0x22101b(0x1b5)]:null};}catch(_0x31bb3b){throw new common_1['HttpException'](_0x31bb3b[_0x22101b(0xfc)],common_1[_0x22101b(0x10b)][_0x22101b(0x150)]);}}async[_0x49a3b4(0xdb)](_0x2a31cd,_0x467515){const _0x16cee9=_0x49a3b4;try{if(!_0x467515[_0x16cee9(0x1a2)]||!_0x467515['jobIds'][_0x16cee9(0x288)])return[];const _0x1a9d50=_0x467515[_0x16cee9(0x1a2)][_0x16cee9(0xf2)](','),_0x2d7b60=await this['midjourneyEntity'][_0x16cee9(0x179)]({'where':{'jobId':(0x0,typeorm_2['In'])(_0x1a9d50)}}),_0x328196=new Map(),_0x3acf7b=new Map(),_0x44d4f2=_0x2d7b60[_0x16cee9(0xcd)](_0x3bc665=>_0x3bc665['workflowId'])[_0x16cee9(0xd8)](_0x32a49f=>Boolean(_0x32a49f)),_0x3a9571=_0x2d7b60['map'](_0x2a8f1a=>_0x2a8f1a[_0x16cee9(0x249)])[_0x16cee9(0xd8)](_0x1d17cd=>_0x1d17cd);if(_0x44d4f2[_0x16cee9(0x288)]){const _0x52de90=await this['modelsService'][_0x16cee9(0x119)](_0x44d4f2);_0x52de90[_0x16cee9(0x24d)](_0x2933cf=>_0x328196[_0x16cee9(0x261)](_0x2933cf['id'],_0x2933cf));}if(_0x3a9571[_0x16cee9(0x288)]){const _0x10f02f=(await this[_0x16cee9(0x200)]['getUserListByIds'](_0x3a9571))['map'](_0x489b7f=>{const _0x18fe16=_0x16cee9;return{'id':_0x489b7f['id'],'nickname':_0x489b7f[_0x18fe16(0x219)],'avatar':_0x489b7f[_0x18fe16(0xfa)]};});_0x10f02f[_0x16cee9(0x24d)](_0x2e5d7b=>_0x3acf7b[_0x16cee9(0x261)](_0x2e5d7b['id'],_0x2e5d7b));}return _0x2d7b60[_0x16cee9(0xcd)](_0x54737d=>{const _0x3f00c5=_0x16cee9;return{..._0x54737d,'userInfo':_0x3acf7b[_0x3f00c5(0x1ef)](_0x54737d[_0x3f00c5(0x249)]),'workflowName':_0x328196['get'](_0x54737d[_0x3f00c5(0x29b)])?.['modelName']||''};});}catch(_0x160cf2){throw new common_1['HttpException'](_0x160cf2[_0x16cee9(0xfc)],common_1[_0x16cee9(0x10b)][_0x16cee9(0x150)]);}}async[_0x49a3b4(0x111)](_0xaaa350){const _0x38149d=_0x49a3b4,{id:_0xdb1797,squareType:_0x36d48f,rec:_0x579206}=_0xaaa350,_0x3ff47f=await this[_0x38149d(0x181)][_0x38149d(0x103)]({'where':{'id':_0xdb1797,'status':midjourney_constant_1[_0x38149d(0x238)]['DRAWED']}});if(!_0x3ff47f)throw new common_1[(_0x38149d(0x25a))]('当前图片不存在！',common_1['HttpStatus'][_0x38149d(0x150)]);const _0x11c893=await this[_0x38149d(0x181)][_0x38149d(0x1c3)]({'id':_0xdb1797},{'rec':_0x579206,'squareType':_0x36d48f})[_0x38149d(0x10a)](_0x1fee78=>{const _0x39fe51=_0x38149d;throw new common_1[(_0x39fe51(0x25a))](_0x1fee78,common_1[_0x39fe51(0x10b)][_0x39fe51(0x150)]);});if(_0x11c893[_0x38149d(0x23c)]<=0x0)throw new common_1[(_0x38149d(0x25a))](_0x38149d(0xf6),common_1['HttpStatus'][_0x38149d(0x150)]);return await this['redisCacheService'][_0x38149d(0x186)]({'key':_0x38149d(0x1ec)}),!![];}async[_0x49a3b4(0xbd)](_0x2b54b7,_0x311ca5){const _0x282bdf=_0x49a3b4;return this[_0x282bdf(0x1e1)][_0x282bdf(0x274)]({'data':{'workflowId':_0x2b54b7,'versionId':_0x311ca5}});}async['workflowPage'](_0x5e8d5a,_0x50c22d){const _0x4acb4b=_0x49a3b4;try{const _0x379818={'page':_0x50c22d[_0x4acb4b(0x254)],'size':_0x50c22d[_0x4acb4b(0x145)],'recommend':_0x50c22d[_0x4acb4b(0x225)],'modelName':_0x50c22d[_0x4acb4b(0x272)],'modelType':model_constant_1[_0x4acb4b(0x28f)][_0x4acb4b(0x120)]};(0x0,utils_1['isManage'])(this['clsService'])?_0x50c22d[_0x4acb4b(0x20f)]!==undefined&&(_0x379818[_0x4acb4b(0x20f)]=Boolean(_0x50c22d[_0x4acb4b(0x20f)])):_0x379818['status']=!![];const _0x9a0cc8=await this[_0x4acb4b(0x289)][_0x4acb4b(0x172)](_0x5e8d5a,_0x379818);let _0x289875=[];if(_0x9a0cc8[_0x4acb4b(0x1f2)]['length']){const _0x9adec2=new Set(),_0x27d311=(0x0,utils_1[_0x4acb4b(0x161)])(this[_0x4acb4b(0x16a)]),_0x3e92fd=_0x9a0cc8[_0x4acb4b(0x1f2)]['map'](_0x5e3613=>_0x5e3613['id']);if(_0x3e92fd['length']&&_0x27d311){const _0x58511e=await this[_0x4acb4b(0x200)][_0x4acb4b(0x162)](_0x27d311,user_constant_1['EFavorite']['WORKFLOW'],_0x3e92fd);_0x58511e[_0x4acb4b(0x24d)](_0xf61685=>_0x9adec2[_0x4acb4b(0x146)](Number(_0xf61685[_0x4acb4b(0xc7)])));}_0x289875=_0x9a0cc8[_0x4acb4b(0x1f2)][_0x4acb4b(0xcd)](_0x316323=>{const _0x124ff0=_0x4acb4b,_0x535a9b={'id':_0x316323['id'],'cover':_0x316323[_0x124ff0(0x22b)],'name':_0x316323['modelName'],'workflowId':_0x316323[_0x124ff0(0x233)],'config':_0x316323[_0x124ff0(0x271)],'recommend':_0x316323[_0x124ff0(0x225)],'versionId':Number(_0x316323['key']),'deduct':_0x316323[_0x124ff0(0x116)],'vipFreeNum':_0x316323[_0x124ff0(0x1e9)],'displaySort':_0x316323[_0x124ff0(0xd2)],'description':_0x316323['description'],'status':_0x316323[_0x124ff0(0x20f)],'createdAt':_0x316323[_0x124ff0(0xf0)],'updatedAt':_0x316323[_0x124ff0(0x180)],'useCount':_0x316323[_0x124ff0(0x21c)],'tutorial':_0x316323[_0x124ff0(0xc9)],'freeUsed':_0x316323[_0x124ff0(0x210)],'favorite':_0x9adec2[_0x124ff0(0x147)](_0x316323['id'])};return _0x535a9b;});}return{'count':_0x9a0cc8[_0x4acb4b(0x24f)],'rows':_0x289875};}catch(_0x5094c2){throw new common_1[(_0x4acb4b(0x25a))](_0x5094c2['message'],common_1['HttpStatus'][_0x4acb4b(0x150)]);}}async[_0x49a3b4(0x274)](_0x48eb19,_0x4b11af){const _0x5a963a=_0x49a3b4;try{let _0x51465d;const _0x32da49=(0x0,utils_1[_0x5a963a(0x161)])(this[_0x5a963a(0x16a)]),_0x4bbe2f=new Set(),_0x556462=await this['modelsService'][_0x5a963a(0x165)](_0x4b11af);if(!_0x556462)throw new common_1[(_0x5a963a(0x25a))](_0x5a963a(0x296),common_1['HttpStatus']['BAD_REQUEST']);if(_0x32da49){const _0x46c18f=await this[_0x5a963a(0x200)][_0x5a963a(0x13d)](_0x32da49);if(_0x46c18f[_0x5a963a(0x1bc)]||_0x46c18f[_0x5a963a(0x294)]){const _0x5d284a=redisKey_constant_1[_0x5a963a(0x262)]+'-'+_0x32da49+'-'+_0x556462['id'];_0x51465d=await await this['redisCacheService'][_0x5a963a(0x1ef)]({'key':_0x5d284a});}const _0x25bbdc=await this['userService'][_0x5a963a(0x162)](_0x32da49,user_constant_1[_0x5a963a(0x11e)][_0x5a963a(0x120)],[_0x556462['id']]);_0x25bbdc[_0x5a963a(0x24d)](_0x2f41b2=>_0x4bbe2f[_0x5a963a(0x146)](Number(_0x2f41b2[_0x5a963a(0xc7)])));}const _0x29d300={'id':_0x556462['id'],'cover':_0x556462[_0x5a963a(0x22b)],'name':_0x556462[_0x5a963a(0x25c)],'workflowId':_0x556462[_0x5a963a(0x233)],'config':_0x556462[_0x5a963a(0x271)],'versionId':Number(_0x556462[_0x5a963a(0x1c9)]),'deduct':_0x556462[_0x5a963a(0x116)],'vipFreeNum':_0x556462[_0x5a963a(0x1e9)],'displaySort':_0x556462[_0x5a963a(0xd2)],'description':_0x556462[_0x5a963a(0xe3)],'status':_0x556462[_0x5a963a(0x20f)],'createdAt':_0x556462[_0x5a963a(0xf0)],'updatedAt':_0x556462[_0x5a963a(0x180)],'useCount':_0x556462['useCount'],'tutorial':_0x556462[_0x5a963a(0xc9)],'freeUsed':Number(_0x51465d),'favorite':_0x4bbe2f[_0x5a963a(0x147)](_0x556462['id'])};return _0x29d300;}catch(_0x2b6686){throw new common_1[(_0x5a963a(0x25a))](_0x2b6686[_0x5a963a(0xfc)],common_1[_0x5a963a(0x10b)][_0x5a963a(0x150)]);}}async[_0x49a3b4(0x1a8)](_0x5f5966){const _0x507655=_0x49a3b4;try{const _0x4049fd={'id':_0x5f5966['id'],'keyType':0x5,'modelType':model_constant_1['EModelType']['WORKFLOW'],'cover':_0x5f5966[_0x507655(0x22b)],'modelName':_0x5f5966[_0x507655(0x13b)],'model':_0x5f5966[_0x507655(0x29b)],'key':'','config':_0x5f5966[_0x507655(0x271)],'deduct':_0x5f5966['deduct'],'vipFreeNum':_0x5f5966[_0x507655(0x1e9)],'displaySort':_0x5f5966[_0x507655(0xd2)],'description':_0x5f5966[_0x507655(0xe3)],'status':_0x5f5966['status'],'remark':_0x5f5966[_0x507655(0x1e4)],'recommend':_0x5f5966['recommend']};return _0x5f5966[_0x507655(0x16c)]&&(_0x4049fd[_0x507655(0x1c9)]=String(_0x5f5966[_0x507655(0x16c)])),await this[_0x507655(0x289)]['modelSave'](_0x4049fd),!![];}catch(_0x4a55b6){throw new common_1[(_0x507655(0x25a))](_0x4a55b6[_0x507655(0xfc)],common_1['HttpStatus'][_0x507655(0x150)]);}}async[_0x49a3b4(0x17d)](_0x1f5831){const _0x39b024=_0x49a3b4;return this[_0x39b024(0x289)][_0x39b024(0xac)](_0x1f5831['ids']);}async[_0x49a3b4(0x1cf)](){const _0x44ce10=_0x49a3b4,_0x49f755=await this['dictService'][_0x44ce10(0x1b6)](_0x44ce10(0xe4)),_0x118947=await this[_0x44ce10(0x259)][_0x44ce10(0x1b6)](_0x44ce10(0x20e)),_0x576b6f=await this['dictService'][_0x44ce10(0x1b6)]('effect_main_body'),_0x35f176=await this[_0x44ce10(0x259)]['list4workflow']('application_fields');return{'style':_0x49f755,'effect_category':_0x118947,'effect_main_body':_0x576b6f,'application_fields':_0x35f176};}async[_0x49a3b4(0x23b)](_0x1aaeb9){const _0x39aec8=_0x49a3b4;try{const {page:page=0x1,size:size=0x14,keyword:_0x270065,type:_0x460f3d,version:_0x5a4cac,style:_0x473e67,effectCategory:_0x4be65d,effectMainBody:_0x1bd4e5,applicationFields:_0x469bf1,disabled:_0x5c870c}=_0x1aaeb9,_0x54dec7={};_0x270065&&(_0x54dec7['name']=(0x0,typeorm_2['Like'])('%'+_0x270065+'%'));_0x460f3d&&(_0x54dec7[_0x39aec8(0x246)]=_0x460f3d);_0x5a4cac&&(_0x54dec7[_0x39aec8(0x208)]=_0x5a4cac);_0x473e67&&(_0x54dec7['style']=_0x473e67);_0x4be65d&&(_0x54dec7[_0x39aec8(0xe9)]=_0x4be65d);_0x1bd4e5&&(_0x54dec7[_0x39aec8(0x22c)]=_0x1bd4e5);_0x469bf1&&(_0x54dec7['applicationFields']=_0x469bf1);(0x0,utils_1[_0x39aec8(0x10e)])(this[_0x39aec8(0x16a)])?(0x0,utils_1[_0x39aec8(0x1d0)])(_0x5c870c)&&(_0x54dec7[_0x39aec8(0x1f9)]=_0x5c870c):_0x54dec7[_0x39aec8(0x1f9)]=0x0;const [_0x304cf9,_0x1c2a08]=await this[_0x39aec8(0x1dd)][_0x39aec8(0x27e)]({'where':_0x54dec7,'take':size,'skip':(page-0x1)*size,'order':{'id':_0x39aec8(0x280)}});return{'rows':_0x304cf9,'count':_0x1c2a08};}catch(_0x41cc8f){throw new common_1[(_0x39aec8(0x25a))](_0x41cc8f[_0x39aec8(0xfc)],common_1[_0x39aec8(0x10b)][_0x39aec8(0x150)]);}}async['workflowModelUpdate'](_0x9ca86e){const _0x104460=_0x49a3b4;try{const {id:_0x1dce0c,name:_0x57e434,cover:_0x575b24,description:_0x5500bf,disabled:_0x107f83}=_0x9ca86e,_0x1dd20f={};return _0x57e434&&(_0x1dd20f[_0x104460(0x13b)]=_0x57e434),_0x575b24&&(_0x1dd20f[_0x104460(0x22b)]=_0x575b24),_0x5500bf&&(_0x1dd20f[_0x104460(0xe3)]=_0x5500bf),_0x107f83&&(_0x1dd20f[_0x104460(0x1f9)]=_0x107f83),await this[_0x104460(0x1dd)][_0x104460(0x1c3)]({'id':_0x1dce0c},_0x1dd20f),!![];}catch(_0xfa9f86){throw new common_1[(_0x104460(0x25a))](_0xfa9f86[_0x104460(0xfc)],common_1[_0x104460(0x10b)]['BAD_REQUEST']);}}async['workflowModelDetail'](_0x87964b){const _0x3330e3=_0x49a3b4,_0x2e832b=_0x87964b[_0x3330e3(0xf2)](',');if(!_0x87964b['length'])throw new common_1[(_0x3330e3(0x25a))](_0x3330e3(0xb2),common_1[_0x3330e3(0x10b)][_0x3330e3(0x150)]);return this[_0x3330e3(0x1dd)]['find']({'where':{'id':(0x0,typeorm_2['In'])(_0x2e832b),'disabled':0x0}});}async[_0x49a3b4(0x199)](_0x1eb7b2,_0x26a8fc){const _0x5e3743=_0x49a3b4;try{const _0x272060=await this['modelsService']['getModelById'](_0x26a8fc[_0x5e3743(0x29b)]);if(!_0x272060['status'])throw new Error(_0x5e3743(0x19d));let _0x5a2e1c;const _0x460414=(0x0,utils_1[_0x5e3743(0x109)])(this['clsService']);return await this[_0x5e3743(0x281)][_0x5e3743(0xa6)](async()=>{const _0x3d3073=_0x5e3743;_0x5a2e1c=await this['addDrawQueue']({'originPrompt':'','saasId':_0x460414,'userId':_0x1eb7b2['user']['id'],'mode':midjourney_constant_1[_0x3d3073(0x22a)][_0x3d3073(0x222)],'botType':DrawTaskPage_dto_1['EBotType'][_0x3d3073(0x120)],'workflowId':_0x26a8fc['workflowId'],'fullPrompt':JSON[_0x3d3073(0x1cc)](_0x26a8fc[_0x3d3073(0x241)])}),await this['userService']['deductBalance4WorkFlow'](_0x1eb7b2[_0x3d3073(0x293)]['id'],_0x272060,_0x5a2e1c['id']);const _0x144ab7=await this['czTaskService']['workflowRun']({'data':{'workflowId':Number(_0x272060['model']),'versionId':Number(_0x272060[_0x3d3073(0x1c9)]),'presetId':_0x26a8fc[_0x3d3073(0xe7)],'inputs':_0x26a8fc['inputs']}});_0x5a2e1c[_0x3d3073(0x10f)]=_0x144ab7[_0x3d3073(0x28b)],await this[_0x3d3073(0x181)][_0x3d3073(0x1c3)]({'id':_0x5a2e1c['id']},{'mjpTaskId':_0x144ab7[_0x3d3073(0x28b)]});}),_0x5a2e1c;}catch(_0x5dbcba){throw new common_1['HttpException'](_0x5dbcba[_0x5e3743(0xfc)],common_1[_0x5e3743(0x10b)][_0x5e3743(0x150)]);}}async['workflowUsedPage'](_0x3d394b,_0x4b0455){const _0x2a835a=_0x49a3b4,{page:page=0x1,size:size=0x14}=_0x4b0455,[_0x48ddf9]=await this[_0x2a835a(0x281)][_0x2a835a(0x1b0)](_0x2a835a(0x297)+_0x3d394b[_0x2a835a(0x293)]['id']+'\x20GROUP\x20BY\x20workflowId\x20)\x20t\x20ON\x20t.workflowId\x20=\x20m.id\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.workflowId\x20IS\x20NOT\x20NULL\x0a\x20\x20\x20\x20\x20\x20\x20\x20'),_0x28c421=await this[_0x2a835a(0x281)][_0x2a835a(0x1b0)](_0x2a835a(0x299)+_0x3d394b['user']['id']+_0x2a835a(0x284)+size+'\x20OFFSET\x20'+(page-0x1)*size+_0x2a835a(0x26e));return{'rows':_0x28c421,'count':Number(_0x48ddf9?.[_0x2a835a(0x24f)]||0x0)};}async[_0x49a3b4(0x23d)](_0x289cfa,_0x3c8d1a){const _0x33af58=_0x49a3b4,_0x481885=_0x289cfa[_0x33af58(0x293)]['id'],{page:page=0x1,size:size=0x14}=_0x3c8d1a,[_0x56240e]=await this['connection']['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(m.id)\x20AS\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user_favorite\x20uf\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20LEFT\x20JOIN\x20models\x20m\x20ON\x20m.id\x20=\x20uf.relateId\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uf.userId\x20=\x20\x27'+_0x289cfa[_0x33af58(0x293)]['id']+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27'+user_constant_1['EFavorite']['WORKFLOW']+_0x33af58(0x1f6)),_0x5edd5c=await this[_0x33af58(0x281)][_0x33af58(0x1b0)](_0x33af58(0x184)+_0x289cfa[_0x33af58(0x293)]['id']+'\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20AND\x20uf.relateType\x20=\x20\x27'+user_constant_1[_0x33af58(0x11e)][_0x33af58(0x120)]+_0x33af58(0xf4)+size+_0x33af58(0xe2)+(page-0x1)*size+_0x33af58(0x26e));if(_0x289cfa['user']['id']){const _0x4f3691=await this[_0x33af58(0x200)][_0x33af58(0x13d)](_0x481885);if(_0x4f3691[_0x33af58(0x1bc)]||_0x4f3691[_0x33af58(0x294)])for(let _0x336e44=0x0;_0x336e44<_0x5edd5c['length'];_0x336e44++){const _0x5e20fd=_0x5edd5c[_0x336e44],_0x2d232f=redisKey_constant_1[_0x33af58(0x262)]+'-'+_0x481885+'-'+_0x5e20fd['id'],_0x3a7b59=await await this[_0x33af58(0xf8)][_0x33af58(0x1ef)]({'key':_0x2d232f});_0x5e20fd['freeUsed']=Number(_0x3a7b59||0x0);}}return{'rows':_0x5edd5c,'count':_0x56240e?.['count']||0x0};}async[_0x49a3b4(0x260)](_0x3a9125,_0x50db79){const _0x497782=_0x49a3b4;try{let _0x525d55;const _0x262a52=(0x0,utils_1[_0x497782(0x109)])(this[_0x497782(0x16a)]);return await this[_0x497782(0x281)][_0x497782(0xa6)](async()=>{const _0x5ca3d8=_0x497782;_0x525d55=await this[_0x5ca3d8(0x17c)]({'saasId':_0x262a52,'userId':_0x3a9125[_0x5ca3d8(0x293)]['id'],'mode':midjourney_constant_1[_0x5ca3d8(0x22a)][_0x5ca3d8(0x222)],'botType':DrawTaskPage_dto_1[_0x5ca3d8(0x9f)]['SD'],'originPrompt':_0x50db79[_0x5ca3d8(0x1f0)],'fullPrompt':JSON[_0x5ca3d8(0x1cc)](_0x50db79)}),await this[_0x5ca3d8(0x200)][_0x5ca3d8(0x28c)](_0x3a9125[_0x5ca3d8(0x293)]['id'],_0x525d55['id']);const _0x9d8c98=await this[_0x5ca3d8(0x1e1)][_0x5ca3d8(0x148)]({'data':_0x50db79});_0x525d55[_0x5ca3d8(0x10f)]=_0x9d8c98[_0x5ca3d8(0x1f8)],await this[_0x5ca3d8(0x181)][_0x5ca3d8(0x1c3)]({'id':_0x525d55['id']},{'mjpTaskId':_0x9d8c98[_0x5ca3d8(0x1f8)]});}),_0x525d55;}catch(_0x4d3dd6){throw new common_1['HttpException'](_0x4d3dd6['message'],common_1[_0x497782(0x10b)][_0x497782(0x150)]);}}async['sdTaskInpaint'](_0x2d4905,_0x30925e){const _0x16552f=_0x49a3b4;try{const _0x5047ad=await this[_0x16552f(0x181)][_0x16552f(0x103)]({'where':{'id':Number(_0x30925e[_0x16552f(0x28b)])}});if(!_0x5047ad)throw new Error(_0x16552f(0xd7));let _0x1bc149;const _0x5b4713=(0x0,utils_1['getReqSaasId'])(this[_0x16552f(0x16a)]);return await this[_0x16552f(0x281)][_0x16552f(0xa6)](async()=>{const _0x59be72=_0x16552f;_0x1bc149=await this[_0x59be72(0x17c)]({'saasId':_0x5b4713,'userId':_0x2d4905['user']['id'],'mode':midjourney_constant_1[_0x59be72(0x22a)][_0x59be72(0x222)],'botType':DrawTaskPage_dto_1[_0x59be72(0x9f)]['SD'],'originPrompt':_0x30925e[_0x59be72(0x1f0)],'originTaskId':_0x30925e[_0x59be72(0x28b)],'fullPrompt':JSON['stringify'](_0x30925e)}),await this[_0x59be72(0x200)][_0x59be72(0x28c)](_0x2d4905[_0x59be72(0x293)]['id'],_0x1bc149['id']);const _0x40ea55=await this[_0x59be72(0x1e1)][_0x59be72(0x243)]({'data':{'mask':_0x30925e[_0x59be72(0x202)],'prompt':_0x30925e[_0x59be72(0x1f0)],'taskId':_0x5047ad[_0x59be72(0x10f)],'denoisingStrength':_0x30925e[_0x59be72(0x193)]}});_0x1bc149['mjpTaskId']=_0x40ea55[_0x59be72(0x1f8)],await this[_0x59be72(0x181)][_0x59be72(0x1c3)]({'id':_0x1bc149['id']},{'mjpTaskId':_0x40ea55['paintingSign']});}),_0x1bc149;}catch(_0x5c6e85){throw new common_1[(_0x16552f(0x25a))](_0x5c6e85['message'],common_1[_0x16552f(0x10b)][_0x16552f(0x150)]);}}async['setImageFavorite'](_0x3d36b1,_0x32463c){const _0x11a2cf=_0x49a3b4,{id:_0x1f6bb6,favorite:_0x183f13}=_0x3d36b1;if(_0x183f13==0x1)return await this[_0x11a2cf(0x200)][_0x11a2cf(0x213)](_0x32463c[_0x11a2cf(0x293)]['id'],_0x1f6bb6,collectType_constant_1['UserCollectType']['MJ']),!![];return await this['userService'][_0x11a2cf(0x1c5)](_0x32463c[_0x11a2cf(0x293)]['id'],_0x1f6bb6,collectType_constant_1[_0x11a2cf(0xcf)]['MJ']),!![];}async[_0x49a3b4(0x18d)](_0x40a92d,_0xd32189){const _0x106629=_0x49a3b4,{page:page=0x1,size:size=0x14}=_0x40a92d,{rows:_0x219260,count:_0x44aa4b}=await this['userService'][_0x106629(0xe1)](page,size,_0xd32189['user']['id'],collectType_constant_1['UserCollectType']['MJ']),_0x3aa4fd=await this['midjourneyEntity'][_0x106629(0x179)]({'where':{'userId':_0xd32189['user']['id'],'id':(0x0,typeorm_2['In'])(_0x219260[_0x106629(0xcd)](_0x40067f=>_0x40067f[_0x106629(0xfd)]))}});let _0x1d31c1=await this[_0x106629(0x200)][_0x106629(0xd3)](_0x3aa4fd,_0xd32189,collectType_constant_1['UserCollectType']['MJ']);return _0x1d31c1=await this[_0x106629(0x200)]['mergeCollectCountData'](_0x3aa4fd,collectType_constant_1[_0x106629(0xcf)]['MJ']),{'rows':_0x1d31c1,'count':_0x44aa4b};}async[_0x49a3b4(0x1ce)](_0x2efb35,_0x40cafd){const _0x280a73=_0x49a3b4;try{const _0x740244=await this[_0x280a73(0x181)][_0x280a73(0x103)]({'where':{'id':_0x2efb35,'userId':_0x40cafd[_0x280a73(0x293)]['id']}});if(!_0x740244)throw new Error('绘制的任务不存在！');if(_0x740244[_0x280a73(0x20f)]===midjourney_constant_1[_0x280a73(0x238)]['DRAWING'])throw new Error(_0x280a73(0x143));await this[_0x280a73(0x16e)][_0x280a73(0x1cd)](null,_0x740244['mjpTaskId']);const _0x319c6d=await this[_0x280a73(0x181)]['delete']({'id':_0x2efb35});if(_0x319c6d[_0x280a73(0x23c)]>0x0)return _0x280a73(0x295);else throw new Error(_0x280a73(0xc6));}catch(_0x132b3d){throw new common_1['HttpException'](_0x132b3d[_0x280a73(0xfc)],common_1['HttpStatus']['BAD_REQUEST']);}}async['delLog'](_0x36d6a3,_0x1a1733){const _0x4b8cc0=_0x49a3b4,{id:_0x4654b2}=_0x1a1733;if(!_0x4654b2)throw new common_1[(_0x4b8cc0(0x25a))](_0x4b8cc0(0x1bf),common_1['HttpStatus'][_0x4b8cc0(0x150)]);const _0xf960e3=await this[_0x4b8cc0(0x181)][_0x4b8cc0(0x1fb)]({'id':_0x4654b2});if(_0xf960e3[_0x4b8cc0(0x23c)]<=0x0)throw new common_1['HttpException'](_0x4b8cc0(0x149),common_1[_0x4b8cc0(0x10b)][_0x4b8cc0(0x150)]);return!![];}async[_0x49a3b4(0x1d4)](_0x206dbd,_0x1c3bbb){const _0x5b7e6a=_0x49a3b4;try{const {prompt:_0x2daae8,status:_0x58bb18,isCarryParams:_0x2bc14b,imageUrl:_0x2deaf0,title:_0x36f3c4,order:_0x26ac87,id:_0x2d3621,aspect:_0x4c5ba5,type:_0x1c1ef6}=_0x1c3bbb;if(_0x2d3621)return await this[_0x5b7e6a(0x189)][_0x5b7e6a(0x1c3)]({'id':_0x2d3621},{'title':_0x36f3c4,'prompt':_0x2daae8,'imageUrl':_0x2deaf0,'status':_0x58bb18,'isCarryParams':_0x2bc14b,'order':_0x26ac87,'aspect':_0x4c5ba5,'type':_0x1c1ef6})[_0x5b7e6a(0x1a9)](_0x1b4465=>!!_0x1b4465);else{const _0x53b778=(0x0,utils_1[_0x5b7e6a(0x109)])(this[_0x5b7e6a(0x16a)]);return await this[_0x5b7e6a(0x189)]['save']({'prompt':_0x2daae8,'status':_0x58bb18,'imageUrl':_0x2deaf0,'isCarryParams':_0x2bc14b,'title':_0x36f3c4,'order':_0x26ac87,'aspect':_0x4c5ba5,'type':_0x1c1ef6,'saasId':_0x53b778})[_0x5b7e6a(0x1a9)](_0x4efc7e=>!!_0x4efc7e);}}catch(_0x3d11c6){console[_0x5b7e6a(0xfb)](_0x5b7e6a(0x266),_0x3d11c6);}}async[_0x49a3b4(0x290)](_0x73002e,_0x4fcc75){const _0x20a0a3=_0x49a3b4,{id:_0x353cca}=_0x4fcc75;if(!_0x353cca)throw new common_1[(_0x20a0a3(0x25a))](_0x20a0a3(0x1bf),common_1[_0x20a0a3(0x10b)][_0x20a0a3(0x150)]);return await this[_0x20a0a3(0x189)][_0x20a0a3(0x1fb)]({'id':_0x353cca});}async[_0x49a3b4(0x234)](_0x5433db=0x0){const _0x45e069=_0x49a3b4,_0x56906f=(0x0,utils_1[_0x45e069(0x109)])(this[_0x45e069(0x16a)]);return await this[_0x45e069(0x189)][_0x45e069(0x179)]({'where':{'saasId':_0x56906f,'type':_0x5433db||0x0},'order':{'order':_0x45e069(0x201)}})[_0x45e069(0x1a9)](_0xee8f5b=>_0xee8f5b||[])[_0x45e069(0x10a)](_0x4044ee=>{const _0x48af7a=_0x45e069;common_1[_0x48af7a(0x212)][_0x48af7a(0x25e)](_0x4044ee);});}async[_0x49a3b4(0x105)](_0x392239){const _0x253bf2=_0x49a3b4;try{const {page:_0xc7c4a,size:_0x3b940b,keyword:_0x1f766b,saasId:_0x37352c,type:_0x4fea1e}=_0x392239,_0x202ebd=(0x0,utils_1[_0x253bf2(0x109)])(this['clsService']),_0xccd06f={'status':!![],'type':_0x4fea1e||0x0};(0x0,utils_1[_0x253bf2(0x204)])(this['clsService'])?(0x0,utils_1['isDefined'])(_0x37352c)&&(_0xccd06f[_0x253bf2(0x1c1)]=_0x37352c):_0xccd06f['saasId']=_0x202ebd;const [_0x4c1d47,_0x54fe4b]=await this['mjPromptsEntity']['findAndCount']({'where':[{..._0xccd06f,'title':(0x0,typeorm_2[_0x253bf2(0x21a)])('%'+_0x1f766b+'%')},{..._0xccd06f,'prompt':(0x0,typeorm_2[_0x253bf2(0x21a)])('%'+_0x1f766b+'%')}],'take':_0x3b940b,'skip':(_0xc7c4a-0x1)*_0x3b940b,'order':{'order':_0x253bf2(0x201)}});return{'rows':_0x4c1d47,'count':_0x54fe4b};}catch(_0x1732de){throw new common_1[(_0x253bf2(0x25a))](_0x1732de[_0x253bf2(0xfc)],common_1['HttpStatus']['BAD_REQUEST']);}}async['addMjInspireClassify'](_0x5adf01){const _0x1d7159=_0x49a3b4;try{const {name:_0x97b0b1,value:_0x5355e1,dataType:_0x174df8}=_0x5adf01,_0x4d80e0=(0x0,utils_1[_0x1d7159(0x109)])(this[_0x1d7159(0x16a)]),_0x18f462=await this[_0x1d7159(0x1eb)]['findOneBy']({'name':_0x97b0b1,'saasId':_0x4d80e0});if(_0x18f462)throw new common_1[(_0x1d7159(0x25a))](_0x1d7159(0x16b),common_1['HttpStatus']['BAD_REQUEST']);return await this[_0x1d7159(0x1eb)]['save']({'name':_0x97b0b1,'value':_0x5355e1,'dataType':_0x174df8,'saasId':_0x4d80e0})[_0x1d7159(0x1a9)](_0x500725=>!!_0x500725)['catch'](_0x2d8085=>{const _0x5af320=_0x1d7159;console[_0x5af320(0xfb)](_0x2d8085);throw new common_1[(_0x5af320(0x25a))](_0x2d8085,common_1[_0x5af320(0x10b)][_0x5af320(0x150)]);});}catch(_0x34b338){return![];}}async[_0x49a3b4(0x203)](_0x121456){const _0x31338e=_0x49a3b4,{id:_0x11ee08,name:_0x3fc9b2,value:_0x3e51a1}=_0x121456;return await this[_0x31338e(0x1eb)][_0x31338e(0x1c3)](_0x11ee08,{'name':_0x3fc9b2,'value':_0x3e51a1})[_0x31338e(0x1a9)](_0x248664=>!!_0x248664);}async['removeMjInspireClassify'](_0x1a6c52){const _0x45a70e=_0x49a3b4,{id:_0x466b4f}=_0x1a6c52;return await this['mjInspireClassifyEntity']['delete']({'id':_0x466b4f})[_0x45a70e(0x10a)](_0x220035=>{const _0x312d62=_0x45a70e;throw new common_1[(_0x312d62(0x25a))](_0x220035,common_1[_0x312d62(0x10b)][_0x312d62(0x150)]);});}async[_0x49a3b4(0x279)](_0x301e09){const _0x4a7403=_0x49a3b4,{size:_0x449420,page:_0x21feaf,saasId:_0x1a25bd}=_0x301e09,_0xbe793f=(0x0,utils_1[_0x4a7403(0x109)])(this[_0x4a7403(0x16a)]),_0xc1c1aa={};_0x301e09['dataType']==0x1?_0xc1c1aa['dataType']=0x1:_0xc1c1aa[_0x4a7403(0xea)]=0x0;(0x0,utils_1[_0x4a7403(0x204)])(this['clsService'])?(0x0,utils_1['isDefined'])(_0x1a25bd)&&(_0xc1c1aa[_0x4a7403(0x1c1)]=_0x1a25bd):_0xc1c1aa[_0x4a7403(0x1c1)]=_0xbe793f;const _0x23b959=await this[_0x4a7403(0x1eb)][_0x4a7403(0x27e)]({'where':_0xc1c1aa,'order':{'createdAt':'DESC'},'take':_0x449420,'skip':(_0x21feaf-0x1)*_0x449420})[_0x4a7403(0x10a)](_0x238d1c=>{const _0x3ee4b4=_0x4a7403;throw new common_1[(_0x3ee4b4(0x25a))](_0x238d1c,common_1[_0x3ee4b4(0x10b)][_0x3ee4b4(0x150)]);});if(!_0x23b959)throw new common_1[(_0x4a7403(0x25a))](_0x4a7403(0x101),common_1[_0x4a7403(0x10b)][_0x4a7403(0x150)]);const [_0x5ee860,_0x6d8bdf]=_0x23b959;return{'rows':_0x5ee860,'count':_0x6d8bdf};}async[_0x49a3b4(0xb3)](_0x5152ec){const _0x406815=_0x49a3b4,{id:_0x259970}=_0x5152ec;return await this[_0x406815(0x1eb)][_0x406815(0x103)]({'where':{'id':_0x259970}});}async['addMjIncantationClassify'](_0x2e59d0){const _0x5b2c1f=_0x49a3b4;try{const _0x71f68e=(0x0,utils_1[_0x5b2c1f(0x109)])(this[_0x5b2c1f(0x16a)]),{classifyName:_0x2d59f9,level:_0x574c05,type:_0x21d805,pid:pid=0x0,dataType:_0x3ace4e}=_0x2e59d0;return await this[_0x5b2c1f(0x28e)][_0x5b2c1f(0x163)]({'classifyName':_0x2d59f9,'level':_0x574c05,'type':_0x21d805,'pid':pid,'dataType':_0x3ace4e,'saasId':_0x71f68e})[_0x5b2c1f(0x1a9)](_0x139952=>!!_0x139952)[_0x5b2c1f(0x10a)](_0xc6c559=>{const _0x498150=_0x5b2c1f;console[_0x498150(0xfb)](_0xc6c559);throw new common_1['HttpException'](_0xc6c559,common_1[_0x498150(0x10b)]['BAD_REQUEST']);});}catch(_0xbe102e){return![];}}async[_0x49a3b4(0x27c)](_0x3135f8){const _0x365709=_0x49a3b4,{id:_0xa0052d,classifyName:_0x73e11e,level:_0x24fb56,type:_0x566bda,pid:_0x24bfbc}=_0x3135f8;return this[_0x365709(0x281)][_0x365709(0xa6)](async()=>{const _0x339a2a=_0x365709,_0x433b4c=await this['mjIncantationClassifyEntity'][_0x339a2a(0x103)]({'where':{'id':_0xa0052d}});_0x433b4c[_0x339a2a(0x246)]!==_0x566bda&&await this['mjIncantationClassifyEntity'][_0x339a2a(0x1c3)]({'pid':_0xa0052d},{'type':_0x566bda}),await this['mjIncantationClassifyEntity'][_0x339a2a(0x1c3)](_0xa0052d,{'classifyName':_0x73e11e,'level':_0x24fb56,'type':_0x566bda,'pid':_0x24bfbc});}),!![];}async['removeMjIncantationClassify'](_0x8ab7a9){const _0x344a5b=_0x49a3b4,{id:_0x19f9b7}=_0x8ab7a9;return await this[_0x344a5b(0x28e)][_0x344a5b(0x1fb)]({'id':_0x19f9b7})[_0x344a5b(0x1a9)](_0x3b29ed=>_0x3b29ed['affected']>0x0);}async[_0x49a3b4(0x27d)](_0x16dcb3){const _0x5e4590=_0x49a3b4,{id:_0x5554de}=_0x16dcb3;return await this[_0x5e4590(0x28e)][_0x5e4590(0x103)]({'where':{'id':_0x5554de}});}async['queryTopMjIncantationClassify'](_0x11bffa=0x0){const _0x1d9a15=_0x49a3b4,_0x485aae=(0x0,utils_1['getReqSaasId'])(this['clsService']);return this['mjIncantationClassifyEntity'][_0x1d9a15(0x179)]({'where':{'level':0x1,'saasId':_0x485aae,'dataType':_0x11bffa==0x1?0x1:0x0}});}async[_0x49a3b4(0x232)](_0x22495c){const _0x21d652=_0x49a3b4,{size:_0xf81403,page:_0x19162e,type:_0x7188d0,keyword:_0x1b2f21,level:_0x50d595,saasId:_0x386f42}=_0x22495c,_0x5417a4=(0x0,utils_1[_0x21d652(0x109)])(this[_0x21d652(0x16a)]);let _0x484481={};_0x22495c[_0x21d652(0xea)]==0x1?_0x484481['dataType']=0x1:_0x484481[_0x21d652(0xea)]=0x0;_0x50d595>0x0&&(_0x484481[_0x21d652(0xa2)]=_0x50d595);_0x7188d0&&(_0x484481['type']=_0x7188d0);_0x1b2f21&&(_0x484481[_0x21d652(0x21d)]=(0x0,typeorm_2[_0x21d652(0x21a)])('%'+_0x1b2f21+'%'));(0x0,utils_1['isPlatform'])(this[_0x21d652(0x16a)])?(0x0,utils_1[_0x21d652(0x1d0)])(_0x386f42)&&(_0x484481[_0x21d652(0x1c1)]=_0x386f42):_0x484481[_0x21d652(0x1c1)]=_0x5417a4;const _0x35dad8=await this[_0x21d652(0x28e)][_0x21d652(0x27e)]({'order':{'createdAt':'DESC'},'where':_0x484481,'take':_0xf81403,'skip':(_0x19162e-0x1)*_0xf81403})[_0x21d652(0x10a)](_0x5bc13a=>{const _0x28d4a8=_0x21d652;console[_0x28d4a8(0xfb)](_0x5bc13a);});if(!_0x35dad8)throw new common_1[(_0x21d652(0x25a))](_0x21d652(0x127),common_1[_0x21d652(0x10b)]['BAD_REQUEST']);const [_0x34c858,_0x41bcd6]=_0x35dad8;return{'rows':_0x34c858,'count':_0x41bcd6};}async[_0x49a3b4(0xa4)](_0x3f4810){const _0x8d11f4=_0x49a3b4,{level:_0x4f6de0,type:_0x38570f,saasId:_0x447dd5}=_0x3f4810,_0x4f9538=(0x0,utils_1[_0x8d11f4(0x109)])(this[_0x8d11f4(0x16a)]),_0x1711b4={};_0x4f6de0===0x0?_0x1711b4['level']=(0x0,typeorm_2[_0x8d11f4(0x1fc)])(_0x4f6de0):_0x1711b4[_0x8d11f4(0xa2)]=_0x4f6de0;_0x38570f&&(_0x1711b4['type']=_0x38570f);_0x3f4810[_0x8d11f4(0xea)]==0x1?_0x1711b4[_0x8d11f4(0xea)]=0x1:_0x1711b4[_0x8d11f4(0xea)]=0x0;(0x0,utils_1[_0x8d11f4(0x204)])(this[_0x8d11f4(0x16a)])?(0x0,utils_1[_0x8d11f4(0x1d0)])(_0x447dd5)&&(_0x1711b4['saasId']=_0x447dd5):_0x1711b4[_0x8d11f4(0x1c1)]=_0x4f9538;const _0x1a6a1e=await this[_0x8d11f4(0x28e)]['findBy'](_0x1711b4)['catch'](_0x3b1f45=>{const _0x227c2b=_0x8d11f4;console[_0x227c2b(0xfb)](_0x3b1f45);});if(!_0x1a6a1e)throw new common_1[(_0x8d11f4(0x25a))]('查询咒语分类失败',common_1[_0x8d11f4(0x10b)][_0x8d11f4(0x150)]);if(_0x4f6de0===0x0)return{'level1':_0x1a6a1e['filter'](_0x5a5e36=>_0x5a5e36['level']===0x1),'level2':_0x1a6a1e[_0x8d11f4(0xd8)](_0x2ed5bc=>_0x2ed5bc['level']===0x2)};return _0x1a6a1e;}async[_0x49a3b4(0x178)](_0x45963b){const _0x42beb6=_0x49a3b4;try{const _0x5fefb7=(0x0,utils_1['getReqSaasId'])(this['clsService']),{incantationEn:_0x4e403e,incantationCn:_0x23ed8b,img:_0xd8c6aa,pid:_0x51b30f,dataType:_0x5a2291}=_0x45963b;return await this[_0x42beb6(0xff)][_0x42beb6(0x163)]({'incantationEn':_0x4e403e,'incantationCn':_0x23ed8b,'img':_0xd8c6aa,'pid':_0x51b30f,'dataType':_0x5a2291,'saasId':_0x5fefb7})['then'](_0x31eea0=>!!_0x31eea0)['catch'](_0x19c918=>{throw _0x19c918;});}catch(_0x3d8804){return console[_0x42beb6(0xfb)](_0x3d8804),![];}}async[_0x49a3b4(0x170)](_0x5090dc){const _0x585473=_0x49a3b4,{id:_0x1bb058,incantationEn:_0x3f68bb,incantationCn:_0x5df791,img:_0x171059,pid:_0x913f80}=_0x5090dc;return await this[_0x585473(0xff)][_0x585473(0x1c3)](_0x1bb058,{'incantationCn':_0x5df791,'incantationEn':_0x3f68bb,'img':_0x171059,'pid':_0x913f80});}async[_0x49a3b4(0x115)](_0x1f0c06){const _0x367619=_0x49a3b4,{id:_0x16b75a}=_0x1f0c06;return await this[_0x367619(0xff)][_0x367619(0x1fb)]({'id':_0x16b75a})[_0x367619(0x1a9)](_0x2dc4a6=>_0x2dc4a6[_0x367619(0x23c)]>0x0);}async['getMjIncantation'](_0x4bae7a){const _0x52f4c2=_0x49a3b4,{id:_0x80ea3a}=_0x4bae7a;return await this[_0x52f4c2(0xff)][_0x52f4c2(0x103)]({'where':{'id':_0x80ea3a}});}async[_0x49a3b4(0x114)](_0x2c82a3){const _0x52e204=_0x49a3b4,_0x1a7a25=(0x0,utils_1['getReqSaasId'])(this['clsService']),{size:_0x469d0f,page:_0x265bc7,keyword:_0x518e74,pid:_0x334269,saasId:_0x47d726}=_0x2c82a3;let _0x1376c5={};_0x2c82a3['dataType']==0x1?_0x1376c5[_0x52e204(0xea)]=0x1:_0x1376c5[_0x52e204(0xea)]=0x0;_0x334269>0x0&&(_0x1376c5[_0x52e204(0x242)]=_0x334269);_0x518e74&&(_0x1376c5[_0x52e204(0x1ac)]=(0x0,typeorm_2[_0x52e204(0x21a)])('%'+_0x518e74+'%'));(0x0,utils_1['isPlatform'])(this[_0x52e204(0x16a)])?(0x0,utils_1[_0x52e204(0x1d0)])(_0x47d726)&&(_0x1376c5[_0x52e204(0x1c1)]=_0x47d726):_0x1376c5['saasId']=_0x1a7a25;const _0x194905=await this['mjIncantationEntity']['findAndCount']({'order':{'createdAt':_0x52e204(0x201)},'where':_0x1376c5,'take':_0x469d0f,'skip':(_0x265bc7-0x1)*_0x469d0f})[_0x52e204(0x10a)](_0x35d402=>{const _0x4f1559=_0x52e204;console[_0x4f1559(0xfb)](_0x35d402);});if(!_0x194905)throw new common_1[(_0x52e204(0x25a))](_0x52e204(0x9d),common_1[_0x52e204(0x10b)][_0x52e204(0x150)]);const [_0x30e76e,_0x55b5dd]=_0x194905;return{'rows':_0x30e76e,'count':_0x55b5dd};}async[_0x49a3b4(0xe0)](_0x258467){const _0x191847=_0x49a3b4,{id:_0x3cfa44}=_0x258467,_0x4b6c14=await this[_0x191847(0x28e)]['findOne']({'where':{'level':0x1,'id':_0x3cfa44}})['catch'](_0x8987be=>{const _0x44b0a3=_0x191847;common_1[_0x44b0a3(0x212)][_0x44b0a3(0x25e)](_0x8987be);});if(!_0x4b6c14)throw new common_1[(_0x191847(0x25a))]('未查询到咒语一级分类',common_1[_0x191847(0x10b)][_0x191847(0x150)]);const _0x5f0ff7=await this['mjIncantationClassifyEntity']['find']({'where':{'level':0x2,'pid':_0x4b6c14['id']}})[_0x191847(0x10a)](_0x227cf5=>{const _0x116084=_0x191847;common_1[_0x116084(0x212)][_0x116084(0x25e)](_0x227cf5);});if(!_0x5f0ff7||_0x5f0ff7[_0x191847(0x288)]===0x0)return{'rows':[]};const _0x5d9f94=_0x5f0ff7[_0x191847(0xcd)](_0x2c77e8=>_0x2c77e8['id']),_0x373e6f=await this[_0x191847(0xff)][_0x191847(0x179)]({'where':{'pid':(0x0,typeorm_2['In'])(_0x5d9f94)}})[_0x191847(0x10a)](_0x527040=>{const _0x12dc8d=_0x191847;common_1[_0x12dc8d(0x212)][_0x12dc8d(0x25e)](_0x527040);});if(!_0x373e6f)throw new common_1[(_0x191847(0x25a))](_0x191847(0x9d),common_1[_0x191847(0x10b)][_0x191847(0x150)]);const _0xc54e85=_0x5f0ff7['map'](_0x49dc7e=>{const _0x5f0638=_0x191847;return{'children':_0x373e6f[_0x5f0638(0xd8)](_0x14a647=>_0x14a647['pid']===_0x49dc7e['id'])||[],..._0x49dc7e};});return{'rows':_0xc54e85};}async[_0x49a3b4(0x1ad)](){const _0x4ddf1a=_0x49a3b4,_0x56b448=(0x0,utils_1[_0x4ddf1a(0x109)])(this[_0x4ddf1a(0x16a)]),_0x215c13=await this['mjIncantationEntity']['find']({'where':{'saasId':_0x56b448},'order':{'createdAt':_0x4ddf1a(0x201)}})[_0x4ddf1a(0x10a)](_0x1cfd73=>{const _0x29d2d0=_0x4ddf1a;console[_0x29d2d0(0xfb)](_0x1cfd73);});if(!_0x215c13)throw new common_1['HttpException'](_0x4ddf1a(0x9d),common_1[_0x4ddf1a(0x10b)][_0x4ddf1a(0x150)]);return _0x215c13;}async[_0x49a3b4(0x29a)](_0x3995fa){const _0x69f380=_0x49a3b4,_0xbcf7d6=(0x0,utils_1[_0x69f380(0x109)])(this[_0x69f380(0x16a)]),{id:_0x2414b8,suggestCn:_0x49934d,suggestEn:_0x2e5d4e,order:_0x8ff211,image:_0x50f527}=_0x3995fa,_0x260ecf=await this[_0x69f380(0xd0)][_0x69f380(0x103)]({'where':{'suggestCn':_0x49934d,'saasId':_0xbcf7d6}});if(_0x2414b8){if(_0x260ecf&&_0x260ecf['id']!==_0x2414b8)throw new common_1[(_0x69f380(0x25a))](_0x69f380(0x1d6),common_1[_0x69f380(0x10b)]['BAD_REQUEST']);}else{if(_0x260ecf)throw new common_1[(_0x69f380(0x25a))](_0x69f380(0x1d6),common_1['HttpStatus']['BAD_REQUEST']);}const _0x533115=await this[_0x69f380(0xd0)][_0x69f380(0x163)]({'id':_0x2414b8,'suggestCn':_0x49934d,'suggestEn':_0x2e5d4e,'order':_0x8ff211||0x64,'image':_0x50f527||'','saasId':_0xbcf7d6})[_0x69f380(0x1a9)](_0x53fe95=>!!_0x53fe95['id'])[_0x69f380(0x10a)](_0x284afd=>{console['log'](_0x284afd);});if(!_0x533115)throw new common_1['HttpException'](_0x69f380(0x24a),common_1[_0x69f380(0x10b)][_0x69f380(0x150)]);return _0x533115;}async[_0x49a3b4(0x1bb)](_0x3c3ea4){const _0x58eda0=_0x49a3b4,{id:_0x251c29}=_0x3c3ea4,_0x3cab7f=await this['mjSuggestWordEntity'][_0x58eda0(0x1d2)]({'where':{'id':_0x251c29}});if(!_0x3cab7f)throw new common_1[(_0x58eda0(0x25a))](_0x58eda0(0x26f),common_1['HttpStatus'][_0x58eda0(0x150)]);const _0x12ba96=await this[_0x58eda0(0xd0)][_0x58eda0(0x1fb)](_0x251c29)[_0x58eda0(0x1a9)](_0x3656c7=>_0x3656c7['affected']>0x0)[_0x58eda0(0x10a)](_0x4e9b76=>{const _0x185339=_0x58eda0;console[_0x185339(0xfb)](_0x4e9b76);});if(!_0x12ba96)throw new common_1['HttpException'](_0x58eda0(0x194),common_1[_0x58eda0(0x10b)]['BAD_REQUEST']);return _0x12ba96;}async[_0x49a3b4(0x1b4)](_0x5daa01){const _0xc875de=_0x49a3b4;let _0x1f9cdb={};const {page:_0x35b925,size:_0x3a3298,saasId:_0x3c5bb3}=_0x5daa01,_0x2a94f1=(0x0,utils_1[_0xc875de(0x109)])(this['clsService']);(0x0,utils_1[_0xc875de(0x204)])(this[_0xc875de(0x16a)])?(0x0,utils_1[_0xc875de(0x1d0)])(_0x3c5bb3)&&(_0x1f9cdb['saasId']=_0x3c5bb3):_0x1f9cdb[_0xc875de(0x1c1)]=_0x2a94f1;const _0x2064e3=await this[_0xc875de(0xd0)][_0xc875de(0x27e)]({'where':_0x1f9cdb,'take':_0x3a3298,'skip':(_0x35b925-0x1)*_0x3a3298,'order':{'order':_0xc875de(0x201)}})['then'](([_0x4977ce,_0xb49b64])=>({'rows':_0x4977ce,'count':_0xb49b64}))['catch'](_0x4667c9=>{const _0x219493=_0xc875de;console[_0x219493(0xfb)](_0x4667c9);});if(!_0x2064e3)throw new common_1[(_0xc875de(0x25a))](_0xc875de(0x1bd),common_1['HttpStatus']['BAD_REQUEST']);return _0x2064e3;}async[_0x49a3b4(0x1fd)](_0x42f81a,_0x856318){const _0xc2e585=_0x49a3b4,_0x49aa93=await this['drawTaskList']({'rec':_0x42f81a[_0xc2e585(0x292)],'page':_0x42f81a[_0xc2e585(0x254)],'size':_0x42f81a[_0xc2e585(0x145)],'status':_0x42f81a['status'],'keyword':_0x42f81a[_0xc2e585(0x272)],'squareType':_0x42f81a['squareType']},_0x856318);return _0x49aa93[_0xc2e585(0x1f2)]['forEach'](_0x27129c=>{const _0x456f45=_0xc2e585;_0x27129c['fileInfo']=_0x27129c[_0x456f45(0x1a0)]?JSON[_0x456f45(0x135)](_0x27129c[_0x456f45(0x1a0)]):{};}),_0x49aa93;}[_0x49a3b4(0x287)](_0x3ea540){const _0x51bf42=_0x49a3b4;if(!_0x3ea540)return _0x51bf42(0x222);if(_0x3ea540===midjourney_constant_1[_0x51bf42(0x22a)][_0x51bf42(0x222)])return _0x51bf42(0x222);if(_0x3ea540===midjourney_constant_1[_0x51bf42(0x22a)]['relax'])return _0x51bf42(0x134);if(_0x3ea540===midjourney_constant_1[_0x51bf42(0x22a)]['turbo'])return _0x51bf42(0x18b);return _0x51bf42(0x222);}async[_0x49a3b4(0x124)](){const _0x4b2f58=_0x49a3b4;if(process[_0x4b2f58(0x13f)][_0x4b2f58(0x15c)]==='development')return;try{const _0x5eee2e=await this[_0x4b2f58(0x1e1)][_0x4b2f58(0x1cf)]({});for(let _0x36556e in _0x5eee2e){let _0xdb06b9=_0x36556e;for(let _0x7ef335=0x0;_0x7ef335<_0x5eee2e[_0x36556e][_0x4b2f58(0x288)];_0x7ef335++){const _0x2a9de0=_0x5eee2e[_0x36556e][_0x7ef335];let _0x3083af=await this[_0x4b2f58(0x259)][_0x4b2f58(0x11c)](_0xdb06b9,String(_0x2a9de0['id']));_0x3083af?(_0x3083af[_0x4b2f58(0xd4)]=_0xdb06b9,_0x3083af[_0x4b2f58(0x209)]=_0x2a9de0[_0x4b2f58(0x13b)],_0x3083af[_0x4b2f58(0x239)]=String(_0x2a9de0['id'])):_0x3083af={'dictType':_0xdb06b9,'dictName':_0x2a9de0[_0x4b2f58(0x13b)],'dictValue':String(_0x2a9de0['id'])},await this['dictService'][_0x4b2f58(0xcc)](_0x3083af);}}common_1['Logger']['log'](_0x4b2f58(0x107));}catch(_0x313d99){common_1[_0x4b2f58(0x212)][_0x4b2f58(0x25e)](_0x313d99,'触站::运用领域、风格画风、作用主体、作用类别字典同步失败');}}async[_0x49a3b4(0x153)](_0x8e2bdc){const _0xa9d24a=_0x49a3b4;let _0x5a9fc4=[];try{const _0x48cfc2=await this[_0xa9d24a(0x1e1)][_0xa9d24a(0x206)]({'data':{'size':0x32,'index':0x1,'tagIds':[_0x8e2bdc]}});_0x5a9fc4=_0x5a9fc4[_0xa9d24a(0x244)](_0x48cfc2[_0xa9d24a(0x1f7)]);for(let _0x3e4670=0x2;_0x3e4670<=_0x48cfc2[_0xa9d24a(0x14c)];_0x3e4670++){const _0x3ec82f=await this['czTaskService'][_0xa9d24a(0x206)]({'data':{'index':_0x3e4670,'size':0x32,'tagIds':[_0x8e2bdc]}});_0x5a9fc4=_0x5a9fc4['concat'](_0x3ec82f[_0xa9d24a(0x1f7)]);}return _0x5a9fc4;}catch(_0x23f17f){return common_1[_0xa9d24a(0x212)][_0xa9d24a(0x25e)](_0x23f17f,_0xa9d24a(0xc5)),[];}}async[_0x49a3b4(0x196)](){const _0x32818a=_0x49a3b4;if(process[_0x32818a(0x13f)][_0x32818a(0x15c)]===_0x32818a(0xb0))return;try{const _0x37fa56=await this[_0x32818a(0x259)]['list4dictTypes']([_0x32818a(0xe4),_0x32818a(0x20e),_0x32818a(0x132),_0x32818a(0x18e)]),_0x5bf438=new Map(),_0x2d2224=await this[_0x32818a(0x1dd)][_0x32818a(0x179)]();_0x2d2224['forEach'](_0x4f1b97=>_0x5bf438[_0x32818a(0x261)](_0x4f1b97['id'],_0x4f1b97));for(let _0x486212=0x0;_0x486212<_0x37fa56[_0x32818a(0x288)];_0x486212++){const _0x1541c9=_0x37fa56[_0x486212][_0x32818a(0x209)],_0x41dde3=Number(_0x37fa56[_0x486212][_0x32818a(0x239)]),_0x39f578=await this[_0x32818a(0x153)](_0x41dde3);_0x39f578['forEach'](_0x1636df=>{const _0x5ec19f=_0x32818a,_0x354cba=String(_0x1636df['id']);!_0x5bf438[_0x5ec19f(0x147)](_0x354cba)&&_0x5bf438[_0x5ec19f(0x261)](_0x354cba,{'id':_0x354cba,'type':_0x1636df['modelType'],'name':_0x1636df[_0x5ec19f(0x13b)],'cover':_0x5ec19f(0x1ee)+_0x1636df[_0x5ec19f(0x192)],'version':_0x1636df[_0x5ec19f(0xc1)],'description':'','triggerWords':_0x1636df[_0x5ec19f(0x175)]});const _0x103f72=_0x5bf438[_0x5ec19f(0x1ef)](_0x354cba);_0x37fa56[_0x486212][_0x5ec19f(0xd4)]===_0x5ec19f(0xe4)&&(_0x103f72[_0x5ec19f(0xe4)]=_0x41dde3,_0x103f72[_0x5ec19f(0x17b)]=_0x1541c9),_0x37fa56[_0x486212][_0x5ec19f(0xd4)]===_0x5ec19f(0x20e)&&(_0x103f72['effectCategory']=_0x41dde3,_0x103f72[_0x5ec19f(0x131)]=_0x1541c9),_0x37fa56[_0x486212][_0x5ec19f(0xd4)]==='effect_main_body'&&(_0x103f72[_0x5ec19f(0x22c)]=_0x41dde3,_0x103f72[_0x5ec19f(0x1b2)]=_0x1541c9),_0x37fa56[_0x486212][_0x5ec19f(0xd4)]===_0x5ec19f(0x18e)&&(_0x103f72[_0x5ec19f(0x1c7)]=_0x41dde3,_0x103f72[_0x5ec19f(0xb1)]=_0x1541c9);});}await this[_0x32818a(0x1dd)][_0x32818a(0x163)](Array[_0x32818a(0x1db)](_0x5bf438[_0x32818a(0x1e6)]())),common_1[_0x32818a(0x212)]['log'](_0x32818a(0x224));}catch(_0x46693e){common_1[_0x32818a(0x212)][_0x32818a(0x25e)](_0x46693e,_0x32818a(0xc5));}}async[_0x49a3b4(0x122)](_0x1124dc){const _0x14ada4=_0x49a3b4,_0x3891fb=await this[_0x14ada4(0x16e)]['listByCondition']({'data':{'ids':[_0x1124dc]}});common_1[_0x14ada4(0x212)][_0x14ada4(0xfb)](_0x14ada4(0x1e3)),this[_0x14ada4(0x156)](_0x3891fb[0x0]);}async[_0x49a3b4(0xbe)](_0x1c5931){const _0x235e55=_0x49a3b4,_0x7ab26=await this['userService'][_0x235e55(0x13d)](_0x1c5931[_0x235e55(0x293)]['id']),_0xd812a3={'fast':0x0,'relax':0x0,'trubo':0x0};let _0x24e6cf=redisKey_constant_1[_0x235e55(0x262)]+'-'+_0x7ab26['id']+'-';if(_0x7ab26[_0x235e55(0x1bc)]||_0x7ab26['lifetimeVip']){const [_0x23b726,_0x13eabc,_0x5d5d0a]=await Promise['all']([this[_0x235e55(0xf8)]['get']({'key':_0x24e6cf+_0x235e55(0xf7)}),this[_0x235e55(0xf8)][_0x235e55(0x1ef)]({'key':_0x24e6cf+_0x235e55(0xf1)}),this[_0x235e55(0xf8)]['get']({'key':_0x24e6cf+_0x235e55(0xa5)})]);_0xd812a3[_0x235e55(0x222)]=Number(_0x23b726||0x0),_0xd812a3['relax']=Number(_0x13eabc||0x0),_0xd812a3[_0x235e55(0x1e5)]=Number(_0x5d5d0a||0x0);}return _0xd812a3;}[_0x49a3b4(0x21b)](_0x37256f){const _0x2b071c=_0x49a3b4;if(typeof _0x37256f==='string')return midjourney_constant_1['MjpStateMap'][_0x2b071c(0x1ef)](_0x37256f);if(typeof _0x37256f==='number')return midjourney_constant_1[_0x2b071c(0xbc)]['get'](_0x37256f);}async[_0x49a3b4(0x156)](_0xb7f134){const _0xaf4ce2=_0x49a3b4;common_1[_0xaf4ce2(0x212)][_0xaf4ce2(0xfb)](_0xb7f134,_0xaf4ce2(0x18f));try{let _0x26cf39=[];const _0x300751=this['parseMjStatus'](_0xb7f134[_0xaf4ce2(0x20f)]),_0xd67c15=_0xb7f134[_0xaf4ce2(0x1ff)]?parseFloat(_0xb7f134[_0xaf4ce2(0x1ff)]):null;let _0x57d1ad=await this['midjourneyEntity'][_0xaf4ce2(0x103)]({'where':{'mjpTaskId':_0xb7f134['id']}});if(_0xb7f134[_0xaf4ce2(0x20f)]===_0xaf4ce2(0x215)&&_0x57d1ad['messageFlags']){common_1[_0xaf4ce2(0x212)][_0xaf4ce2(0xfb)](_0xaf4ce2(0x26c),_0xaf4ce2(0x1d5));return;}_0xb7f134['buttons']&&(_0x26cf39=_0xb7f134[_0xaf4ce2(0x282)][_0xaf4ce2(0xd8)](_0x3ccc5b=>_0x3ccc5b[_0xaf4ce2(0x130)]!==_0xaf4ce2(0x217)&&_0x3ccc5b[_0xaf4ce2(0x15f)]!=='❤️'));store_1[_0xaf4ce2(0x264)]['mjProxyImgUrl']&&_0xb7f134[_0xaf4ce2(0x157)]&&(_0xb7f134[_0xaf4ce2(0x157)]=_0xb7f134['imageUrl']['replace'](_0xaf4ce2(0x286),store_1[_0xaf4ce2(0x264)][_0xaf4ce2(0x268)]));const _0x5dfae9={'id':_0x57d1ad['id'],'status':_0x300751,'progress':_0xd67c15,'buttons':_0x26cf39,'durationSpent':null,'imageUrl':_0xb7f134[_0xaf4ce2(0x157)],'failReason':_0xb7f134['failReason']};return(_0xb7f134[_0xaf4ce2(0x1b5)]===_0xaf4ce2(0x1e7)||_0xb7f134['action']===0x4)&&(_0x5dfae9[_0xaf4ce2(0x1f0)]=_0xb7f134[_0xaf4ce2(0x177)]||_0xb7f134[_0xaf4ce2(0x139)]?.[_0xaf4ce2(0x177)],_0x5dfae9[_0xaf4ce2(0x1da)]=_0xb7f134[_0xaf4ce2(0x177)]||_0xb7f134['properties']?.[_0xaf4ce2(0x177)]),_0xb7f134[_0xaf4ce2(0x223)]&&_0xb7f134[_0xaf4ce2(0x133)]&&(_0x5dfae9[_0xaf4ce2(0x18c)]=(_0xb7f134['finishTime']-_0xb7f134[_0xaf4ce2(0x133)])/0x3e8),_0x57d1ad=await this['midjourneyEntity']['save'](_0x5dfae9),_0xb7f134[_0xaf4ce2(0x20f)]===_0xaf4ce2(0x108)&&_0x57d1ad[_0xaf4ce2(0x157)]&&this['fileService'][_0xaf4ce2(0xb6)](_0x57d1ad['id'],_0x57d1ad[_0xaf4ce2(0x157)]),null;}catch(_0x2ed347){common_1[_0xaf4ce2(0x212)]['error']('Mj任务通知异常:\x20',_0x2ed347);}}async['notifyWF'](_0x389dac){const _0x1b6059=_0x49a3b4;common_1[_0x1b6059(0x212)]['log'](_0x389dac,_0x1b6059(0x13a));try{const _0x501c01=midjourney_constant_1[_0x1b6059(0x12e)][_0x1b6059(0x1ef)](_0x389dac[_0x1b6059(0x13c)]),_0x226c01=Number(_0x389dac['progress'])*0x64;let _0x4712cd=await this[_0x1b6059(0x181)]['findOne']({'where':{'mjpTaskId':_0x389dac[_0x1b6059(0x28b)]}});const _0x5649a9={'id':_0x4712cd['id'],'status':_0x501c01,'progress':_0x226c01,'imageUrl':_0x389dac[_0x1b6059(0x11f)]?.[_0x1b6059(0xcd)](_0x553413=>_0x553413[_0x1b6059(0xe6)])[_0x1b6059(0x158)]('↢↣')};return _0x4712cd=await this[_0x1b6059(0x181)][_0x1b6059(0x163)](_0x5649a9),_0x4712cd[_0x1b6059(0x20f)]===0x3&&_0x4712cd[_0x1b6059(0x157)]&&this['fileService']['transferImg'](_0x4712cd['id'],_0x4712cd['imageUrl']),null;}catch(_0x1fe66e){common_1[_0x1b6059(0x212)]['error'](_0x1b6059(0x237),_0x1fe66e);}}async[_0x49a3b4(0x1dc)](_0x59808f){const _0x46c373=_0x49a3b4;common_1['Logger'][_0x46c373(0xfb)](_0x59808f,_0x46c373(0x1d3));try{const _0x25f28b=midjourney_constant_1[_0x46c373(0x12e)][_0x46c373(0x1ef)](_0x59808f[_0x46c373(0x13c)]),_0x169863=Number(_0x59808f[_0x46c373(0x1ff)])*0x64;let _0x25bc23=await this[_0x46c373(0x181)][_0x46c373(0x103)]({'where':{'mjpTaskId':_0x59808f[_0x46c373(0x28b)]}});const _0xf6c1ae={'id':_0x25bc23['id'],'status':_0x25f28b,'progress':_0x169863,'imageUrl':_0x59808f[_0x46c373(0x26d)]?.['map'](_0x243533=>_0x243533[_0x46c373(0x157)])[_0x46c373(0x158)]('↢↣')};return _0x25bc23=await this[_0x46c373(0x181)][_0x46c373(0x163)](_0xf6c1ae),_0x25bc23['status']===0x3&&_0x25bc23[_0x46c373(0x157)]&&this[_0x46c373(0x250)]['transferImg'](_0x25bc23['id'],_0x25bc23['imageUrl']),null;}catch(_0x379e59){common_1[_0x46c373(0x212)]['error'](_0x46c373(0x237),_0x379e59);}}async[_0x49a3b4(0x1a7)](){const _0x121674=_0x49a3b4;this[_0x121674(0x1c8)](),this[_0x121674(0x19b)](),this['syncSdTask']();}async[_0x49a3b4(0x1c8)](){const _0x4d2b73=_0x49a3b4;try{const _0xf17127=await this['midjourneyEntity'][_0x4d2b73(0x179)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2,0x6]),'botType':(0x0,typeorm_2['In'])([DrawTaskPage_dto_1[_0x4d2b73(0x9f)][_0x4d2b73(0x28d)],DrawTaskPage_dto_1[_0x4d2b73(0x9f)][_0x4d2b73(0x167)]])}});if(_0xf17127[_0x4d2b73(0x288)])for(let _0x57fadd=0x0;_0x57fadd<_0xf17127[_0x4d2b73(0x288)];_0x57fadd++){const _0x180037=redisKey_constant_1[_0x4d2b73(0x126)]+_0xf17127[_0x57fadd]['mjpTaskId'],_0x274055=await this[_0x4d2b73(0xf8)][_0x4d2b73(0x1ef)]({'key':_0x180037});if(_0x274055)continue;else this['redisCacheService'][_0x4d2b73(0x261)]({'key':_0x180037,'val':_0x4d2b73(0x23a)}),this[_0x4d2b73(0x16e)][_0x4d2b73(0xcb)]({'data':{'ids':[_0xf17127[_0x57fadd][_0x4d2b73(0x10f)]]}})[_0x4d2b73(0x1a9)](async _0x464df3=>{const _0x58848d=_0x4d2b73;if(_0x464df3&&_0x464df3[_0x58848d(0x288)]){const _0x4cce35=_0x464df3[0x0],_0x913bea=_0xf17127[_0x57fadd],_0x396733=this[_0x58848d(0x21b)](_0x4cce35[_0x58848d(0x20f)]),_0x5d4052=_0x4cce35[_0x58848d(0x1ff)]?parseFloat(_0x4cce35[_0x58848d(0x1ff)]):null;if(_0x913bea[_0x58848d(0x1ff)]===_0x5d4052&&_0x913bea[_0x58848d(0x20f)]===_0x396733){}else{const _0x55dad0=_0x4cce35[_0x58848d(0x282)][_0x58848d(0xd8)](_0x4de9f2=>_0x4de9f2[_0x58848d(0x130)]!=='Custom\x20Zoom'&&_0x4de9f2[_0x58848d(0x130)]!=='Imagine\x20all'&&_0x4de9f2[_0x58848d(0x15f)]!=='❤️'),_0xb2819f={'id':_0x913bea['id'],'mjpTaskId':_0x4cce35['id'],'status':_0x396733,'progress':_0x5d4052,'buttons':_0x55dad0,'durationSpent':null,'imageUrl':_0x4cce35[_0x58848d(0x157)],'failReason':_0x4cce35[_0x58848d(0x20d)]};store_1['MjConfig'][_0x58848d(0x268)]&&_0xb2819f[_0x58848d(0x157)]&&(_0xb2819f[_0x58848d(0x157)]=_0xb2819f[_0x58848d(0x157)][_0x58848d(0x265)](_0x58848d(0x286),store_1[_0x58848d(0x264)][_0x58848d(0x268)])),(_0x4cce35[_0x58848d(0x1b5)]===_0x58848d(0x1e7)||_0x4cce35[_0x58848d(0x1b5)]===0x4)&&(_0xb2819f[_0x58848d(0x1f0)]=_0x4cce35[_0x58848d(0x177)]||_0x4cce35[_0x58848d(0x139)]?.[_0x58848d(0x177)],_0xb2819f['fullPrompt']=_0x4cce35[_0x58848d(0x177)]||_0x4cce35[_0x58848d(0x139)]?.['finalPrompt']),_0x4cce35['finishTime']&&_0x4cce35[_0x58848d(0x133)]&&(_0xb2819f[_0x58848d(0x18c)]=(_0x4cce35['finishTime']-_0x4cce35['startTime'])/0x3e8),await this[_0x58848d(0x181)][_0x58848d(0x163)](_0xb2819f);}}})[_0x4d2b73(0x10a)](_0x42910f=>{const _0x4bb223=_0x4d2b73;common_1[_0x4bb223(0x212)][_0x4bb223(0x25e)](_0x4bb223(0x151),_0x42910f);})[_0x4d2b73(0xe5)](()=>{const _0x4311dd=_0x4d2b73;this[_0x4311dd(0xf8)][_0x4311dd(0x186)]({'key':_0x180037});});}}catch(_0x1d86e4){}}async[_0x49a3b4(0x19b)](){const _0x1ec84e=_0x49a3b4;try{const _0x534c86=await this[_0x1ec84e(0x181)]['find']({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'mjpTaskId':(0x0,typeorm_2['Not'])((0x0,typeorm_2[_0x1ec84e(0xb5)])()),'botType':DrawTaskPage_dto_1[_0x1ec84e(0x9f)]['WORKFLOW']}});if(_0x534c86['length'])for(let _0x1beb18=0x0;_0x1beb18<_0x534c86[_0x1ec84e(0x288)];_0x1beb18++){const _0x23fc62=redisKey_constant_1[_0x1ec84e(0x126)]+_0x534c86[_0x1beb18][_0x1ec84e(0x10f)],_0x5255fe=await this[_0x1ec84e(0xf8)][_0x1ec84e(0x1ef)]({'key':_0x23fc62});if(_0x5255fe)continue;else{this['redisCacheService'][_0x1ec84e(0x261)]({'key':_0x23fc62,'val':'lock'});try{const _0xf79f08=await this[_0x1ec84e(0x1e1)][_0x1ec84e(0x207)]({'data':{'taskId':_0x534c86[_0x1beb18]['mjpTaskId']}});this[_0x1ec84e(0x236)](_0xf79f08);}catch(_0x3ad82e){common_1[_0x1ec84e(0x212)]['error'](_0x1ec84e(0x14a),_0x3ad82e);}finally{this[_0x1ec84e(0xf8)][_0x1ec84e(0x186)]({'key':_0x23fc62});}}}}catch(_0x1e2dba){}}async['syncSdTask'](){const _0x42d60a=_0x49a3b4;try{const _0x32fd6d=await this[_0x42d60a(0x181)][_0x42d60a(0x179)]({'where':{'status':(0x0,typeorm_2['In'])([0x1,0x2]),'botType':DrawTaskPage_dto_1[_0x42d60a(0x9f)]['SD']}});if(_0x32fd6d[_0x42d60a(0x288)])for(let _0xec5dc6=0x0;_0xec5dc6<_0x32fd6d[_0x42d60a(0x288)];_0xec5dc6++){const _0x59cbaa=redisKey_constant_1[_0x42d60a(0x126)]+_0x32fd6d[_0xec5dc6]['mjpTaskId'],_0x99aab7=await this[_0x42d60a(0xf8)][_0x42d60a(0x1ef)]({'key':_0x59cbaa});if(_0x99aab7)continue;else{this[_0x42d60a(0xf8)]['set']({'key':_0x59cbaa,'val':_0x42d60a(0x23a)});try{const _0x4c5ebf=await this[_0x42d60a(0x1e1)][_0x42d60a(0xde)]({'data':{'taskId':_0x32fd6d[_0xec5dc6]['mjpTaskId']}});this[_0x42d60a(0x1dc)](_0x4c5ebf);}catch(_0x2b31e){common_1[_0x42d60a(0x212)][_0x42d60a(0x25e)](_0x42d60a(0xbf),_0x2b31e);}finally{this['redisCacheService'][_0x42d60a(0x186)]({'key':_0x59cbaa});}}}}catch(_0x1fdbeb){}}async[_0x49a3b4(0x27f)](){const _0x1c21dd=_0x49a3b4;if(store_1[_0x1c21dd(0x264)][_0x1c21dd(0xba)])return;try{const _0x393e26=[{'status':0x3,'imageUrl':(0x0,typeorm_2[_0x1c21dd(0x21a)])('https://cdn.discordapp.com%')}];store_1['MjConfig']['mjProxyImgUrl']&&_0x393e26[_0x1c21dd(0x14e)]({'status':0x3,'imageUrl':(0x0,typeorm_2[_0x1c21dd(0x21a)])(store_1[_0x1c21dd(0x264)]['mjProxyImgUrl']+'%')});const _0x3fd22d=await this[_0x1c21dd(0x181)][_0x1c21dd(0x179)]({'where':_0x393e26});if(_0x3fd22d[_0x1c21dd(0x288)])for(let _0x79a642=0x0;_0x79a642<_0x3fd22d[_0x1c21dd(0x288)];_0x79a642++){let {id:_0x286b38,imageUrl:_0x29035b}=_0x3fd22d[_0x79a642];this[_0x1c21dd(0x250)][_0x1c21dd(0xb6)](_0x286b38,_0x29035b);}}catch(_0x21fc73){common_1[_0x1c21dd(0x212)][_0x1c21dd(0x25e)](_0x21fc73);}}async[_0x49a3b4(0x19c)](){const _0x4ff978=_0x49a3b4;try{const _0x3b31c7=store_1[_0x4ff978(0x264)][_0x4ff978(0x235)]||0x5,_0x56c37c=[{'status':(0x0,typeorm_2['In'])([0x2,0x4]),'isRefund':0x0,'updatedAt':(0x0,typeorm_2[_0x4ff978(0x1a1)])(new Date(Date['now']()-_0x3b31c7*0x3c*0x3e8))}],_0x204c73=await this[_0x4ff978(0x181)]['find']({'where':_0x56c37c});_0x204c73[_0x4ff978(0x24d)](_0x385a96=>{const _0x2fcc35=_0x4ff978;_0x385a96[_0x2fcc35(0x20f)]=0x4,_0x385a96[_0x2fcc35(0x20d)]=_0x385a96[_0x2fcc35(0x20d)]||_0x2fcc35(0xd1),_0x385a96[_0x2fcc35(0x13e)]=0x1,this[_0x2fcc35(0x181)][_0x2fcc35(0x163)](_0x385a96),this[_0x2fcc35(0x200)][_0x2fcc35(0xd6)](_0x385a96[_0x2fcc35(0x249)],_0x385a96[_0x2fcc35(0xdc)],_0x385a96[_0x2fcc35(0x176)]||'Imagine',_0x385a96['id']);});}catch(_0x16e44b){common_1[_0x4ff978(0x212)][_0x4ff978(0x25e)](_0x16e44b);}}};MidjourneyService=__decorate([(0x0,common_1[_0x49a3b4(0x25b)])(),__param(0x0,(0x0,typeorm_1[_0x49a3b4(0xb7)])(mjModel_entity_1[_0x49a3b4(0x137)])),__param(0x1,(0x0,typeorm_1[_0x49a3b4(0xb7)])(mjParam_entity_1[_0x49a3b4(0x142)])),__param(0x2,(0x0,typeorm_1['InjectRepository'])(mjPrompts_entity_1[_0x49a3b4(0xed)])),__param(0x3,(0x0,typeorm_1['InjectRepository'])(midjourney_entity_1[_0x49a3b4(0x1e8)])),__param(0x4,(0x0,typeorm_1[_0x49a3b4(0xb7)])(mjSuggestWord_entity_1['MjSuggestWordEntity'])),__param(0x5,(0x0,typeorm_1['InjectRepository'])(mjIncantation_entity_1[_0x49a3b4(0x283)])),__param(0x6,(0x0,typeorm_1[_0x49a3b4(0xb7)])(mjInspireClassify_entity_1[_0x49a3b4(0x1d7)])),__param(0x7,(0x0,typeorm_1[_0x49a3b4(0xb7)])(mjIncantationClassify_entity_1['MjIncantationClassifyEntity'])),__metadata(_0x49a3b4(0xa1),[typeorm_2[_0x49a3b4(0x291)],typeorm_2[_0x49a3b4(0x291)],typeorm_2[_0x49a3b4(0x291)],typeorm_2[_0x49a3b4(0x291)],typeorm_2['Repository'],typeorm_2[_0x49a3b4(0x291)],typeorm_2['Repository'],typeorm_2[_0x49a3b4(0x291)],nestjs_cls_1['ClsService'],dict_service_1[_0x49a3b4(0x276)],user_service_1['UserService'],file_service_1['FileService'],fanyi_service_1[_0x49a3b4(0x247)],aiLog_service_1[_0x49a3b4(0x27b)],models_service_1[_0x49a3b4(0xa0)],czTask_service_1[_0x49a3b4(0x15a)],mjpTask_service_1[_0x49a3b4(0x205)],badwords_service_1[_0x49a3b4(0x195)],redisCache_service_1['RedisCacheService'],mjpAccount_service_1['MjpAccountService'],globalConfig_service_1[_0x49a3b4(0x154)],typeorm_2[_0x49a3b4(0x14f)]])],MidjourneyService),exports['MidjourneyService']=MidjourneyService;