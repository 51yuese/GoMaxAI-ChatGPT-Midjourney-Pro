'use strict';const _0x2e8a09=_0x5030;function _0xef09(){const _0x499136=['metadata','playNum','transaction','5022018cLarEs','__metadata','findOne','__esModule','481584OWQFQp','find','relateType','object','730261lmexpX','action','forEach','agreeNum','1692400mKlVkc','relateId','length','function','Connection','getAgreeMap','getAgreeByRelateId','201436vJGuNS','defineProperty','InjectRepository','increaseVisit','getExtByRelate','Injectable','30hwFnXY','random','70tzziIo','Repository','./aiLogExt.entity','visitNum','typeorm','171298znKXLG','aiAgreeLogEntity','@nestjs/typeorm','HttpException','round','connection','agree','save','AiLogService','623135EUNYay','decorate','set','aiLogExtEntity','user','HttpStatus','AiLogExtEntity','play'];_0xef09=function(){return _0x499136;};return _0xef09();}(function(_0x46802e,_0x28b24c){const _0x55bbd7=_0x5030,_0x18c3d7=_0x46802e();while(!![]){try{const _0x412615=-parseInt(_0x55bbd7(0x17d))/0x1+parseInt(_0x55bbd7(0x174))/0x2+parseInt(_0x55bbd7(0x158))/0x3+-parseInt(_0x55bbd7(0x167))/0x4*(-parseInt(_0x55bbd7(0x16f))/0x5)+parseInt(_0x55bbd7(0x16d))/0x6*(-parseInt(_0x55bbd7(0x15c))/0x7)+parseInt(_0x55bbd7(0x160))/0x8+parseInt(_0x55bbd7(0x154))/0x9;if(_0x412615===_0x28b24c)break;else _0x18c3d7['push'](_0x18c3d7['shift']());}catch(_0x376864){_0x18c3d7['push'](_0x18c3d7['shift']());}}}(_0xef09,0x8ca05));function _0x5030(_0x152e8e,_0x13e68c){const _0xef09e7=_0xef09();return _0x5030=function(_0x503028,_0x5dc621){_0x503028=_0x503028-0x151;let _0x1a363f=_0xef09e7[_0x503028];return _0x1a363f;},_0x5030(_0x152e8e,_0x13e68c);}var __decorate=this&&this['__decorate']||function(_0x2055e4,_0x2daf66,_0x10b345,_0x448b08){const _0x439fc3=_0x5030;var _0x21b799=arguments[_0x439fc3(0x162)],_0x20351e=_0x21b799<0x3?_0x2daf66:_0x448b08===null?_0x448b08=Object['getOwnPropertyDescriptor'](_0x2daf66,_0x10b345):_0x448b08,_0x40e2aa;if(typeof Reflect===_0x439fc3(0x15b)&&typeof Reflect[_0x439fc3(0x17e)]===_0x439fc3(0x163))_0x20351e=Reflect['decorate'](_0x2055e4,_0x2daf66,_0x10b345,_0x448b08);else{for(var _0x2d1465=_0x2055e4['length']-0x1;_0x2d1465>=0x0;_0x2d1465--)if(_0x40e2aa=_0x2055e4[_0x2d1465])_0x20351e=(_0x21b799<0x3?_0x40e2aa(_0x20351e):_0x21b799>0x3?_0x40e2aa(_0x2daf66,_0x10b345,_0x20351e):_0x40e2aa(_0x2daf66,_0x10b345))||_0x20351e;}return _0x21b799>0x3&&_0x20351e&&Object[_0x439fc3(0x168)](_0x2daf66,_0x10b345,_0x20351e),_0x20351e;},__metadata=this&&this[_0x2e8a09(0x155)]||function(_0x494bff,_0x25678b){const _0x472b88=_0x2e8a09;if(typeof Reflect===_0x472b88(0x15b)&&typeof Reflect[_0x472b88(0x151)]===_0x472b88(0x163))return Reflect[_0x472b88(0x151)](_0x494bff,_0x25678b);},__param=this&&this['__param']||function(_0x56a565,_0x250c07){return function(_0x5a3210,_0x13f953){_0x250c07(_0x5a3210,_0x13f953,_0x56a565);};};Object[_0x2e8a09(0x168)](exports,_0x2e8a09(0x157),{'value':!![]}),exports[_0x2e8a09(0x17c)]=void 0x0;const typeorm_1=require(_0x2e8a09(0x173)),common_1=require('@nestjs/common'),typeorm_2=require(_0x2e8a09(0x176)),aiLogExt_entity_1=require(_0x2e8a09(0x171)),aiAgreeLog_entity_1=require('./aiAgreeLog.entity');let AiLogService=class AiLogService{constructor(_0x1e4be9,_0x2703eb,_0xfd9fe6){const _0x39245c=_0x2e8a09;this[_0x39245c(0x180)]=_0x1e4be9,this[_0x39245c(0x175)]=_0x2703eb,this[_0x39245c(0x179)]=_0xfd9fe6;}async[_0x2e8a09(0x166)](_0x258c10,_0x3f4de8){const _0x17e4e9=_0x2e8a09,_0x34dd85=await this[_0x17e4e9(0x175)][_0x17e4e9(0x156)]({'where':{'relateId':_0x3f4de8,'relateType':_0x258c10}});return _0x34dd85;}async[_0x2e8a09(0x165)](_0x24394f,_0x1fd098,_0x3107e3){const _0x24326e=_0x2e8a09,_0xba6928=new Map();if(!_0x1fd098[_0x24326e(0x162)])return _0xba6928;const _0x2a22e1=await this[_0x24326e(0x175)][_0x24326e(0x159)]({'where':{'userId':_0x24394f,'relateType':_0x3107e3,'relateId':(0x0,typeorm_1['In'])(_0x1fd098)}});return _0x2a22e1[_0x24326e(0x15e)](_0x4a011e=>{const _0x3bbabf=_0x24326e;_0xba6928['set'](_0x4a011e[_0x3bbabf(0x161)],_0x4a011e[_0x3bbabf(0x15d)]);}),_0xba6928;}async[_0x2e8a09(0x16b)](_0x4e79d5,_0x3beb5e){const _0x44ec5c=_0x2e8a09,_0x554749=new Map();if(!_0x4e79d5[_0x44ec5c(0x162)])return _0x554749;const _0x4fae83=await this[_0x44ec5c(0x180)]['find']({'where':{'relateId':(0x0,typeorm_1['In'])(_0x4e79d5),'relateType':_0x3beb5e}});return _0x4fae83[_0x44ec5c(0x15e)](_0x5408c8=>{const _0x5bf61a=_0x44ec5c;_0x554749[_0x5bf61a(0x17f)](_0x5408c8['relateId'],_0x5408c8);}),_0x554749;}async[_0x2e8a09(0x17a)](_0x3a5f95,_0x13a42f){const _0x5fd37=_0x2e8a09;try{const _0x538825=_0x3a5f95[_0x5fd37(0x181)]['id'],_0x100136=await this[_0x5fd37(0x175)]['findOne']({'where':{'userId':_0x538825,'relateId':_0x13a42f[_0x5fd37(0x161)],'relateType':_0x13a42f[_0x5fd37(0x15a)]}});return await this[_0x5fd37(0x179)][_0x5fd37(0x153)](async()=>{const _0x3e23f4=_0x5fd37;if(_0x100136&&_0x100136[_0x3e23f4(0x15d)]===_0x13a42f[_0x3e23f4(0x15d)])await this[_0x3e23f4(0x175)]['delete']({'id':_0x100136['id']});else{const _0x497677={..._0x13a42f,'userId':_0x538825,'relateId':_0x13a42f[_0x3e23f4(0x161)],'relateType':_0x13a42f[_0x3e23f4(0x15a)],'id':_0x100136?_0x100136['id']:null};await this[_0x3e23f4(0x175)]['save'](_0x497677);}let _0x5619c5=await this[_0x3e23f4(0x180)][_0x3e23f4(0x156)]({'where':{'relateId':_0x13a42f[_0x3e23f4(0x161)]}});!_0x5619c5&&(_0x5619c5=new aiLogExt_entity_1[(_0x3e23f4(0x183))](),_0x5619c5[_0x3e23f4(0x161)]=_0x13a42f[_0x3e23f4(0x161)],_0x5619c5[_0x3e23f4(0x15a)]=_0x13a42f[_0x3e23f4(0x15a)],_0x5619c5['agreeNum']=0x0),_0x100136&&_0x100136[_0x3e23f4(0x15d)]===_0x13a42f[_0x3e23f4(0x15d)]?_0x13a42f['action']===_0x3e23f4(0x17a)?_0x5619c5[_0x3e23f4(0x15f)]=_0x5619c5['agreeNum']-0x1:_0x5619c5[_0x3e23f4(0x15f)]=_0x5619c5[_0x3e23f4(0x15f)]+0x1:_0x13a42f[_0x3e23f4(0x15d)]===_0x3e23f4(0x17a)?_0x5619c5[_0x3e23f4(0x15f)]=_0x5619c5[_0x3e23f4(0x15f)]+Math[_0x3e23f4(0x178)](Math['random']()*0x14):_0x5619c5[_0x3e23f4(0x15f)]=_0x5619c5[_0x3e23f4(0x15f)]-0x1,_0x5619c5[_0x3e23f4(0x15f)]=_0x5619c5['agreeNum']<0x0?0x0:_0x5619c5['agreeNum'],await this[_0x3e23f4(0x180)][_0x3e23f4(0x17b)](_0x5619c5);}),!![];}catch(_0x814460){throw new common_1[(_0x5fd37(0x177))](_0x814460['message'],common_1[_0x5fd37(0x182)]['BAD_REQUEST']);}}async['getByRelateId'](_0x3f180b,_0x1580b0){const _0x1c0246=_0x2e8a09,_0x30b043=await this[_0x1c0246(0x180)]['findOne']({'where':{'relateId':_0x1580b0,'relateType':_0x3f180b}});return _0x30b043;}async[_0x2e8a09(0x184)](_0x3d0f77,_0x4c4c07){const _0x1143bb=_0x2e8a09;let _0x447893=await this[_0x1143bb(0x180)][_0x1143bb(0x156)]({'where':{'relateId':_0x3d0f77,'relateType':_0x4c4c07}});!_0x447893&&(_0x447893=new aiLogExt_entity_1[(_0x1143bb(0x183))](),_0x447893['relateId']=_0x3d0f77,_0x447893[_0x1143bb(0x15a)]=_0x4c4c07),_0x447893[_0x1143bb(0x152)]=_0x447893[_0x1143bb(0x152)]+Math[_0x1143bb(0x178)](Math[_0x1143bb(0x16e)]()*0x14),await this['aiLogExtEntity'][_0x1143bb(0x17b)](_0x447893);}async[_0x2e8a09(0x16a)](_0x50c96c,_0x574e0f){const _0x4107c6=_0x2e8a09;let _0x596ea2=await this[_0x4107c6(0x180)][_0x4107c6(0x156)]({'where':{'relateId':_0x574e0f,'relateType':_0x50c96c}});!_0x596ea2&&(_0x596ea2=new aiLogExt_entity_1[(_0x4107c6(0x183))](),_0x596ea2[_0x4107c6(0x161)]=_0x574e0f,_0x596ea2[_0x4107c6(0x15a)]=_0x50c96c),_0x596ea2[_0x4107c6(0x172)]=_0x596ea2[_0x4107c6(0x172)]+Math[_0x4107c6(0x178)](Math[_0x4107c6(0x16e)]()*0x14),await this[_0x4107c6(0x180)]['save'](_0x596ea2);}};AiLogService=__decorate([(0x0,common_1[_0x2e8a09(0x16c)])(),__param(0x0,(0x0,typeorm_2[_0x2e8a09(0x169)])(aiLogExt_entity_1[_0x2e8a09(0x183)])),__param(0x1,(0x0,typeorm_2[_0x2e8a09(0x169)])(aiAgreeLog_entity_1['AiAgreeLogEntity'])),__metadata('design:paramtypes',[typeorm_1[_0x2e8a09(0x170)],typeorm_1[_0x2e8a09(0x170)],typeorm_1[_0x2e8a09(0x164)]])],AiLogService),exports['AiLogService']=AiLogService;