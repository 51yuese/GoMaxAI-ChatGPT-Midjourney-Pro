'use strict';const _0x2d0fc1=_0x59b8;function _0x59b8(_0x2cbdb6,_0x282ea7){const _0x2f776a=_0x2f77();return _0x59b8=function(_0x59b86e,_0x29e341){_0x59b86e=_0x59b86e-0x11d;let _0x50ec39=_0x2f776a[_0x59b86e];return _0x50ec39;},_0x59b8(_0x2cbdb6,_0x282ea7);}(function(_0x45c181,_0x4b3660){const _0x51d1d2=_0x59b8,_0x57ffb9=_0x45c181();while(!![]){try{const _0x4659b1=-parseInt(_0x51d1d2(0x15c))/0x1+-parseInt(_0x51d1d2(0x122))/0x2*(parseInt(_0x51d1d2(0x13d))/0x3)+-parseInt(_0x51d1d2(0x130))/0x4*(-parseInt(_0x51d1d2(0x159))/0x5)+-parseInt(_0x51d1d2(0x120))/0x6+-parseInt(_0x51d1d2(0x151))/0x7+parseInt(_0x51d1d2(0x121))/0x8*(-parseInt(_0x51d1d2(0x142))/0x9)+-parseInt(_0x51d1d2(0x149))/0xa*(-parseInt(_0x51d1d2(0x134))/0xb);if(_0x4659b1===_0x4b3660)break;else _0x57ffb9['push'](_0x57ffb9['shift']());}catch(_0xc8936c){_0x57ffb9['push'](_0x57ffb9['shift']());}}}(_0x2f77,0x45e33));var __decorate=this&&this['__decorate']||function(_0x297eea,_0x201c70,_0x536072,_0x59386f){const _0x5abdcf=_0x59b8;var _0x23e6fb=arguments[_0x5abdcf(0x14a)],_0x3a041d=_0x23e6fb<0x3?_0x201c70:_0x59386f===null?_0x59386f=Object[_0x5abdcf(0x13f)](_0x201c70,_0x536072):_0x59386f,_0xe720d2;if(typeof Reflect===_0x5abdcf(0x136)&&typeof Reflect['decorate']===_0x5abdcf(0x128))_0x3a041d=Reflect[_0x5abdcf(0x12f)](_0x297eea,_0x201c70,_0x536072,_0x59386f);else{for(var _0x448248=_0x297eea[_0x5abdcf(0x14a)]-0x1;_0x448248>=0x0;_0x448248--)if(_0xe720d2=_0x297eea[_0x448248])_0x3a041d=(_0x23e6fb<0x3?_0xe720d2(_0x3a041d):_0x23e6fb>0x3?_0xe720d2(_0x201c70,_0x536072,_0x3a041d):_0xe720d2(_0x201c70,_0x536072))||_0x3a041d;}return _0x23e6fb>0x3&&_0x3a041d&&Object[_0x5abdcf(0x14c)](_0x201c70,_0x536072,_0x3a041d),_0x3a041d;},__metadata=this&&this[_0x2d0fc1(0x14e)]||function(_0x3f875e,_0x511e46){const _0x11ee5d=_0x2d0fc1;if(typeof Reflect===_0x11ee5d(0x136)&&typeof Reflect[_0x11ee5d(0x126)]===_0x11ee5d(0x128))return Reflect['metadata'](_0x3f875e,_0x511e46);},__param=this&&this[_0x2d0fc1(0x131)]||function(_0x4b617a,_0x39568c){return function(_0x8603ff,_0x71849){_0x39568c(_0x8603ff,_0x71849,_0x4b617a);};};Object['defineProperty'](exports,_0x2d0fc1(0x157),{'value':!![]}),exports['AiLogService']=void 0x0;function _0x2f77(){const _0x1c06ac=['11145SBcgAP','query','getOwnPropertyDescriptor','round','action','27iHNoml','model','message','increaseVisit','playNum','@nestjs/common','aiLogExtEntity','10oWzqwV','length','play','defineProperty','typeorm','__metadata','HttpStatus','getAgreeCountMap','2913974SooZvI','save','./aiLogExt.entity','relateType','set','\x27\x20AND\x20relate_id=','__esModule','findOne','5wefDhw','Connection','connection','22534PnqEyy','\x27\x20\x20and\x20action=\x27agree\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','InjectRepository','getAgreeByRelateIdWithModel','design:paramtypes','2228850EWNQRw','576608cFXeEE','228iGfClZ','random','AiLogExtEntity','agree','metadata','relateId','function','Repository','./aiAgreeLog.entity','forEach','getAgreeMap','agreeNum','\x20\x20and\x20action=\x27agree\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','decorate','353508lZuajE','__param','find','getExtByRelateWithModel','18127021uzvcFT','aiAgreeLogEntity','object','getByRelateIdWithModel','HttpException','user','getByRelateId','AiAgreeLogEntity','visitNum'];_0x2f77=function(){return _0x1c06ac;};return _0x2f77();}const typeorm_1=require(_0x2d0fc1(0x14d)),common_1=require(_0x2d0fc1(0x147)),typeorm_2=require('@nestjs/typeorm'),aiLogExt_entity_1=require(_0x2d0fc1(0x153)),aiAgreeLog_entity_1=require(_0x2d0fc1(0x12a));let AiLogService=class AiLogService{constructor(_0x5702ce,_0x56bc12,_0x116745){const _0xe051c9=_0x2d0fc1;this['aiLogExtEntity']=_0x5702ce,this[_0xe051c9(0x135)]=_0x56bc12,this['connection']=_0x116745;}async['getAgreeByRelateId'](_0x1c0719,_0x2678a1){const _0x29a570=_0x2d0fc1;return await this[_0x29a570(0x15b)]['query']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20count(0)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ai_agree_log\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relate_type=\x27'+_0x1c0719+_0x29a570(0x156)+_0x2678a1+_0x29a570(0x12e));}async[_0x2d0fc1(0x11e)](_0x2d9e58,_0x1926cb,_0x45de34){const _0x1e219a=_0x2d0fc1;return await this['connection'][_0x1e219a(0x13e)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20count(0)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ai_agree_log\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relate_type=\x27'+_0x2d9e58+_0x1e219a(0x156)+_0x1926cb+'\x20AND\x20model=\x27'+_0x45de34+_0x1e219a(0x15d));}async[_0x2d0fc1(0x12c)](_0x5de028,_0x2e1629,_0x4239b8){const _0x3bce25=_0x2d0fc1,_0x5640f2=new Map();if(!_0x2e1629[_0x3bce25(0x14a)])return _0x5640f2;const _0x763438=await this['aiAgreeLogEntity'][_0x3bce25(0x132)]({'where':{'userId':_0x5de028,'relateType':_0x4239b8,'relateId':(0x0,typeorm_1['In'])(_0x2e1629)}});return _0x763438[_0x3bce25(0x12b)](_0x114b34=>{const _0x377df4=_0x3bce25;_0x5640f2[_0x377df4(0x155)](_0x114b34[_0x377df4(0x127)],_0x114b34[_0x377df4(0x141)]);}),_0x5640f2;}async['getAgreeMapWithModel'](_0x98955b,_0x3551d3,_0x1eaa1d){const _0x22988d=_0x2d0fc1,_0x481f59=new Map();if(!_0x3551d3[_0x22988d(0x14a)])return _0x481f59;const _0x4025af=await this['aiAgreeLogEntity'][_0x22988d(0x132)]({'where':{'userId':_0x98955b,'relateType':_0x1eaa1d,'relateId':(0x0,typeorm_1['In'])(_0x3551d3)}});return _0x4025af[_0x22988d(0x12b)](_0x487fd6=>{const _0x8196e2=_0x22988d;_0x481f59[_0x8196e2(0x155)](_0x487fd6[_0x8196e2(0x127)]+_0x487fd6['model'],_0x487fd6[_0x8196e2(0x141)]);}),_0x481f59;}async[_0x2d0fc1(0x150)](_0x3716eb,_0x4dcdcc){const _0xfc5e36=_0x2d0fc1,_0x327f29=new Map();if(!_0x3716eb['length'])return _0x327f29;const _0x8f0301=await this[_0xfc5e36(0x135)]['find']({'where':{'relateType':_0x4dcdcc,'relateId':(0x0,typeorm_1['In'])(_0x3716eb)}});return _0x8f0301[_0xfc5e36(0x12b)](_0xb0fb31=>{const _0x10811f=_0xfc5e36;_0x327f29[_0x10811f(0x155)](_0xb0fb31[_0x10811f(0x127)],_0xb0fb31[_0x10811f(0x141)]);}),_0x327f29;}async['getExtByRelate'](_0x51f570,_0x136f89){const _0x3a400f=_0x2d0fc1,_0x388d9b=new Map();if(!_0x51f570[_0x3a400f(0x14a)])return _0x388d9b;const _0x4d01a5=await this[_0x3a400f(0x148)]['find']({'where':{'relateId':(0x0,typeorm_1['In'])(_0x51f570),'relateType':_0x136f89}});return _0x4d01a5[_0x3a400f(0x12b)](_0x26e364=>{_0x388d9b['set'](_0x26e364['relateId'],_0x26e364);}),_0x388d9b;}async[_0x2d0fc1(0x133)](_0x1972cb,_0x582d4c){const _0x5dfe02=_0x2d0fc1,_0x526bff=new Map();if(!_0x1972cb['length'])return _0x526bff;const _0x43991c=await this[_0x5dfe02(0x148)][_0x5dfe02(0x132)]({'where':{'relateId':(0x0,typeorm_1['In'])(_0x1972cb),'relateType':_0x582d4c}});return _0x43991c[_0x5dfe02(0x12b)](_0x28940a=>{const _0x2114e7=_0x5dfe02;_0x526bff[_0x2114e7(0x155)](_0x28940a['relateId']+_0x28940a[_0x2114e7(0x143)],_0x28940a);}),_0x526bff;}async[_0x2d0fc1(0x125)](_0x12b8cc,_0x5bddd0){const _0x4979f8=_0x2d0fc1;try{const _0x4fd1c0=_0x12b8cc[_0x4979f8(0x139)]['id'],_0x4c3c6e={'userId':_0x4fd1c0,'relateId':_0x5bddd0[_0x4979f8(0x127)],'relateType':_0x5bddd0['relateType']};_0x5bddd0[_0x4979f8(0x143)]&&(_0x4c3c6e[_0x4979f8(0x143)]=_0x5bddd0['model']);const _0x10b414=await this[_0x4979f8(0x135)][_0x4979f8(0x158)]({'where':_0x4c3c6e});return await this[_0x4979f8(0x15b)]['transaction'](async()=>{const _0x5a5d00=_0x4979f8;if(_0x10b414&&_0x10b414[_0x5a5d00(0x141)]===_0x5bddd0[_0x5a5d00(0x141)])await this[_0x5a5d00(0x135)]['delete']({'id':_0x10b414['id']});else{const _0x26d45e={..._0x5bddd0,'userId':_0x4fd1c0,'relateId':_0x5bddd0[_0x5a5d00(0x127)],'relateType':_0x5bddd0[_0x5a5d00(0x154)],'id':_0x10b414?_0x10b414['id']:null};await this[_0x5a5d00(0x135)][_0x5a5d00(0x152)](_0x26d45e);}let _0x40de3b=await this[_0x5a5d00(0x148)][_0x5a5d00(0x158)]({'where':_0x4c3c6e});!_0x40de3b&&(_0x40de3b=new aiLogExt_entity_1[(_0x5a5d00(0x124))](),_0x40de3b[_0x5a5d00(0x127)]=_0x5bddd0[_0x5a5d00(0x127)],_0x40de3b[_0x5a5d00(0x154)]=_0x5bddd0[_0x5a5d00(0x154)],_0x40de3b[_0x5a5d00(0x12d)]=0x0,_0x40de3b[_0x5a5d00(0x143)]=_0x5bddd0[_0x5a5d00(0x143)]),_0x10b414&&_0x10b414[_0x5a5d00(0x141)]===_0x5bddd0[_0x5a5d00(0x141)]?_0x5bddd0[_0x5a5d00(0x141)]===_0x5a5d00(0x125)?_0x40de3b[_0x5a5d00(0x12d)]=_0x40de3b[_0x5a5d00(0x12d)]-0x1:_0x40de3b[_0x5a5d00(0x12d)]=_0x40de3b[_0x5a5d00(0x12d)]+0x1:_0x5bddd0[_0x5a5d00(0x141)]===_0x5a5d00(0x125)?_0x40de3b[_0x5a5d00(0x12d)]=_0x40de3b['agreeNum']+Math['round'](Math[_0x5a5d00(0x123)]()*0x14):_0x40de3b[_0x5a5d00(0x12d)]=_0x40de3b['agreeNum']-0x1,_0x40de3b[_0x5a5d00(0x12d)]=_0x40de3b[_0x5a5d00(0x12d)]<0x0?0x0:_0x40de3b[_0x5a5d00(0x12d)],await this[_0x5a5d00(0x148)]['save'](_0x40de3b);}),!![];}catch(_0x2ba9ac){throw new common_1[(_0x4979f8(0x138))](_0x2ba9ac[_0x4979f8(0x144)],common_1[_0x4979f8(0x14f)]['BAD_REQUEST']);}}async[_0x2d0fc1(0x13a)](_0x5c7c82,_0x58914c){const _0x2a58bd=_0x2d0fc1,_0x4cb581=await this[_0x2a58bd(0x148)][_0x2a58bd(0x158)]({'where':{'relateId':_0x58914c,'relateType':_0x5c7c82}});return _0x4cb581;}async[_0x2d0fc1(0x137)](_0x30c114,_0x512fbb,_0x17b5a0){const _0xa1edf8=_0x2d0fc1,_0xc2806a=await this[_0xa1edf8(0x148)]['findOne']({'where':{'model':_0x17b5a0,'relateId':_0x512fbb,'relateType':_0x30c114}});return _0xc2806a;}async[_0x2d0fc1(0x14b)](_0x146f28,_0x3faa7e){const _0x4829c7=_0x2d0fc1;let _0x4707c3=await this[_0x4829c7(0x148)]['findOne']({'where':{'relateId':_0x146f28,'relateType':_0x3faa7e}});!_0x4707c3&&(_0x4707c3=new aiLogExt_entity_1['AiLogExtEntity'](),_0x4707c3[_0x4829c7(0x127)]=_0x146f28,_0x4707c3['relateType']=_0x3faa7e),_0x4707c3[_0x4829c7(0x146)]=_0x4707c3[_0x4829c7(0x146)]+Math[_0x4829c7(0x140)](Math['random']()*0x14),await this[_0x4829c7(0x148)][_0x4829c7(0x152)](_0x4707c3);}async[_0x2d0fc1(0x145)](_0x4f28dd,_0x247219){const _0x49dab7=_0x2d0fc1;let _0x2a8a73=await this['aiLogExtEntity'][_0x49dab7(0x158)]({'where':{'relateId':_0x247219,'relateType':_0x4f28dd}});!_0x2a8a73&&(_0x2a8a73=new aiLogExt_entity_1['AiLogExtEntity'](),_0x2a8a73[_0x49dab7(0x127)]=_0x247219,_0x2a8a73['relateType']=_0x4f28dd),_0x2a8a73[_0x49dab7(0x13c)]=_0x2a8a73['visitNum']+Math[_0x49dab7(0x140)](Math[_0x49dab7(0x123)]()*0x14),await this[_0x49dab7(0x148)]['save'](_0x2a8a73);}};AiLogService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x2d0fc1(0x11d)])(aiLogExt_entity_1['AiLogExtEntity'])),__param(0x1,(0x0,typeorm_2[_0x2d0fc1(0x11d)])(aiAgreeLog_entity_1[_0x2d0fc1(0x13b)])),__metadata(_0x2d0fc1(0x11f),[typeorm_1[_0x2d0fc1(0x129)],typeorm_1[_0x2d0fc1(0x129)],typeorm_1[_0x2d0fc1(0x15a)]])],AiLogService),exports['AiLogService']=AiLogService;