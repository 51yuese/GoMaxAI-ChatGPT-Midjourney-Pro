'use strict';const _0x30f69e=_0x5a8c;function _0x6dbf(){const _0x2f1bcc=['BAD_REQUEST','relateType','typeorm','user','message','connection','decorate','HttpStatus','action','visitNum','812sAWYHg','delete','defineProperty','1838862zNnxkN','2127012VoDSVJ','forEach','aiAgreeLogEntity','50YrBFBk','round','__decorate','AiLogService','find','6GwhGzf','play','object','Injectable','5882472NuLpnh','agreeNum','202408aclUFX','playNum','getExtByRelate','length','@nestjs/common','set','Repository','increaseVisit','__param','getByRelateId','getAgreeMap','getAgreeByRelateId','save','aiLogExtEntity','./aiLogExt.entity','@nestjs/typeorm','./aiAgreeLog.entity','__esModule','41598Girprh','InjectRepository','findOne','2396779cikCry','random','9TniEUX','AiLogExtEntity','getOwnPropertyDescriptor','6053170xLkgBg','relateId','Connection','function','metadata','design:paramtypes','agree','transaction'];_0x6dbf=function(){return _0x2f1bcc;};return _0x6dbf();}(function(_0x5a7b11,_0x1d47b2){const _0x9093aa=_0x5a8c,_0xca4c4e=_0x5a7b11();while(!![]){try{const _0x238685=-parseInt(_0x9093aa(0xd6))/0x1*(-parseInt(_0x9093aa(0xd0))/0x2)+parseInt(_0x9093aa(0xc7))/0x3+-parseInt(_0x9093aa(0xc8))/0x4+-parseInt(_0x9093aa(0xb2))/0x5+parseInt(_0x9093aa(0xaa))/0x6*(parseInt(_0x9093aa(0xc4))/0x7)+-parseInt(_0x9093aa(0xd4))/0x8*(parseInt(_0x9093aa(0xaf))/0x9)+parseInt(_0x9093aa(0xcb))/0xa*(parseInt(_0x9093aa(0xad))/0xb);if(_0x238685===_0x1d47b2)break;else _0xca4c4e['push'](_0xca4c4e['shift']());}catch(_0x4d7096){_0xca4c4e['push'](_0xca4c4e['shift']());}}}(_0x6dbf,0x9b4fb));function _0x5a8c(_0x1fc25e,_0x4ec8d4){const _0x6dbfeb=_0x6dbf();return _0x5a8c=function(_0x5a8c14,_0x53687c){_0x5a8c14=_0x5a8c14-0xa3;let _0x528d34=_0x6dbfeb[_0x5a8c14];return _0x528d34;},_0x5a8c(_0x1fc25e,_0x4ec8d4);}var __decorate=this&&this[_0x30f69e(0xcd)]||function(_0x1e7fb0,_0x4ba751,_0xd9d9d,_0x2d6eaf){const _0xffa4e8=_0x30f69e;var _0x4145da=arguments[_0xffa4e8(0xd9)],_0x40485c=_0x4145da<0x3?_0x4ba751:_0x2d6eaf===null?_0x2d6eaf=Object[_0xffa4e8(0xb1)](_0x4ba751,_0xd9d9d):_0x2d6eaf,_0x363e7f;if(typeof Reflect===_0xffa4e8(0xd2)&&typeof Reflect[_0xffa4e8(0xc0)]===_0xffa4e8(0xb5))_0x40485c=Reflect[_0xffa4e8(0xc0)](_0x1e7fb0,_0x4ba751,_0xd9d9d,_0x2d6eaf);else{for(var _0x20df58=_0x1e7fb0[_0xffa4e8(0xd9)]-0x1;_0x20df58>=0x0;_0x20df58--)if(_0x363e7f=_0x1e7fb0[_0x20df58])_0x40485c=(_0x4145da<0x3?_0x363e7f(_0x40485c):_0x4145da>0x3?_0x363e7f(_0x4ba751,_0xd9d9d,_0x40485c):_0x363e7f(_0x4ba751,_0xd9d9d))||_0x40485c;}return _0x4145da>0x3&&_0x40485c&&Object[_0xffa4e8(0xc6)](_0x4ba751,_0xd9d9d,_0x40485c),_0x40485c;},__metadata=this&&this['__metadata']||function(_0x361601,_0xdf9f99){const _0x4c14c9=_0x30f69e;if(typeof Reflect===_0x4c14c9(0xd2)&&typeof Reflect[_0x4c14c9(0xb6)]==='function')return Reflect['metadata'](_0x361601,_0xdf9f99);},__param=this&&this[_0x30f69e(0xde)]||function(_0x2c5199,_0x540c4b){return function(_0xa3c2ff,_0x523232){_0x540c4b(_0xa3c2ff,_0x523232,_0x2c5199);};};Object[_0x30f69e(0xc6)](exports,_0x30f69e(0xa9),{'value':!![]}),exports[_0x30f69e(0xce)]=void 0x0;const typeorm_1=require(_0x30f69e(0xbc)),common_1=require(_0x30f69e(0xda)),typeorm_2=require(_0x30f69e(0xa7)),aiLogExt_entity_1=require(_0x30f69e(0xa6)),aiAgreeLog_entity_1=require(_0x30f69e(0xa8));let AiLogService=class AiLogService{constructor(_0x503fdc,_0x13a442,_0x2915ec){const _0x447462=_0x30f69e;this[_0x447462(0xa5)]=_0x503fdc,this[_0x447462(0xca)]=_0x13a442,this[_0x447462(0xbf)]=_0x2915ec;}async[_0x30f69e(0xa3)](_0x2ff5dc,_0x431f9d){const _0x3f8ecc=_0x30f69e,_0x513904=await this[_0x3f8ecc(0xca)][_0x3f8ecc(0xac)]({'where':{'relateId':_0x431f9d,'relateType':_0x2ff5dc}});return _0x513904;}async[_0x30f69e(0xe0)](_0x44420a,_0x41cb00,_0x32a25a){const _0x4f0613=_0x30f69e,_0x5b7b15=new Map();if(!_0x41cb00[_0x4f0613(0xd9)])return _0x5b7b15;const _0x2ad5e4=await this[_0x4f0613(0xca)][_0x4f0613(0xcf)]({'where':{'userId':_0x44420a,'relateType':_0x32a25a,'relateId':(0x0,typeorm_1['In'])(_0x41cb00)}});return _0x2ad5e4['forEach'](_0x4d0df0=>{const _0x4743d8=_0x4f0613;_0x5b7b15[_0x4743d8(0xdb)](_0x4d0df0['relateId'],_0x4d0df0[_0x4743d8(0xc2)]);}),_0x5b7b15;}async[_0x30f69e(0xd8)](_0x2e1be0,_0x1b949b){const _0x116af4=_0x30f69e,_0x1ce17c=new Map();if(!_0x2e1be0[_0x116af4(0xd9)])return _0x1ce17c;const _0x5f0323=await this[_0x116af4(0xa5)]['find']({'where':{'relateId':(0x0,typeorm_1['In'])(_0x2e1be0),'relateType':_0x1b949b}});return _0x5f0323[_0x116af4(0xc9)](_0x525b69=>{const _0x1de201=_0x116af4;_0x1ce17c[_0x1de201(0xdb)](_0x525b69[_0x1de201(0xb3)],_0x525b69);}),_0x1ce17c;}async['agree'](_0x3b5c86,_0x33737b){const _0x34af97=_0x30f69e;try{const _0x380992=_0x3b5c86[_0x34af97(0xbd)]['id'],_0x31433b=await this[_0x34af97(0xca)][_0x34af97(0xac)]({'where':{'userId':_0x380992,'relateId':_0x33737b[_0x34af97(0xb3)],'relateType':_0x33737b[_0x34af97(0xbb)]}});return await this['connection'][_0x34af97(0xb9)](async()=>{const _0x579119=_0x34af97;if(_0x31433b&&_0x31433b['action']===_0x33737b[_0x579119(0xc2)])await this[_0x579119(0xca)][_0x579119(0xc5)]({'id':_0x31433b['id']});else{const _0xd53ba6={..._0x33737b,'userId':_0x380992,'relateId':_0x33737b[_0x579119(0xb3)],'relateType':_0x33737b[_0x579119(0xbb)],'id':_0x31433b?_0x31433b['id']:null};await this[_0x579119(0xca)][_0x579119(0xa4)](_0xd53ba6);}let _0x350043=await this['aiLogExtEntity'][_0x579119(0xac)]({'where':{'relateId':_0x33737b[_0x579119(0xb3)]}});!_0x350043&&(_0x350043=new aiLogExt_entity_1[(_0x579119(0xb0))](),_0x350043[_0x579119(0xb3)]=_0x33737b[_0x579119(0xb3)],_0x350043['relateType']=_0x33737b[_0x579119(0xbb)],_0x350043['agreeNum']=0x0),_0x31433b&&_0x31433b['action']===_0x33737b[_0x579119(0xc2)]?_0x33737b['action']===_0x579119(0xb8)?_0x350043[_0x579119(0xd5)]=_0x350043[_0x579119(0xd5)]-0x1:_0x350043[_0x579119(0xd5)]=_0x350043['agreeNum']+0x1:_0x33737b[_0x579119(0xc2)]===_0x579119(0xb8)?_0x350043[_0x579119(0xd5)]=_0x350043[_0x579119(0xd5)]+Math[_0x579119(0xcc)](Math[_0x579119(0xae)]()*0x14):_0x350043[_0x579119(0xd5)]=_0x350043[_0x579119(0xd5)]-0x1,_0x350043[_0x579119(0xd5)]=_0x350043[_0x579119(0xd5)]<0x0?0x0:_0x350043[_0x579119(0xd5)],await this[_0x579119(0xa5)][_0x579119(0xa4)](_0x350043);}),!![];}catch(_0x40930a){throw new common_1['HttpException'](_0x40930a[_0x34af97(0xbe)],common_1[_0x34af97(0xc1)][_0x34af97(0xba)]);}}async[_0x30f69e(0xdf)](_0x8723b8,_0x4e43dd){const _0x373b6d=_0x30f69e,_0x47ad52=await this['aiLogExtEntity'][_0x373b6d(0xac)]({'where':{'relateId':_0x4e43dd,'relateType':_0x8723b8}});return _0x47ad52;}async[_0x30f69e(0xd1)](_0x3131be,_0x53f0b0){const _0xd0bfcb=_0x30f69e;let _0x2b8ed8=await this['aiLogExtEntity']['findOne']({'where':{'relateId':_0x3131be,'relateType':_0x53f0b0}});!_0x2b8ed8&&(_0x2b8ed8=new aiLogExt_entity_1[(_0xd0bfcb(0xb0))](),_0x2b8ed8['relateId']=_0x3131be,_0x2b8ed8[_0xd0bfcb(0xbb)]=_0x53f0b0),_0x2b8ed8[_0xd0bfcb(0xd7)]=_0x2b8ed8[_0xd0bfcb(0xd7)]+Math[_0xd0bfcb(0xcc)](Math['random']()*0x14),await this[_0xd0bfcb(0xa5)][_0xd0bfcb(0xa4)](_0x2b8ed8);}async[_0x30f69e(0xdd)](_0x363500,_0x2c114e){const _0x599fc9=_0x30f69e;let _0x1b5f8f=await this[_0x599fc9(0xa5)][_0x599fc9(0xac)]({'where':{'relateId':_0x2c114e,'relateType':_0x363500}});!_0x1b5f8f&&(_0x1b5f8f=new aiLogExt_entity_1[(_0x599fc9(0xb0))](),_0x1b5f8f[_0x599fc9(0xb3)]=_0x2c114e,_0x1b5f8f[_0x599fc9(0xbb)]=_0x363500),_0x1b5f8f[_0x599fc9(0xc3)]=_0x1b5f8f['visitNum']+Math[_0x599fc9(0xcc)](Math[_0x599fc9(0xae)]()*0x14),await this[_0x599fc9(0xa5)]['save'](_0x1b5f8f);}};AiLogService=__decorate([(0x0,common_1[_0x30f69e(0xd3)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(aiLogExt_entity_1[_0x30f69e(0xb0)])),__param(0x1,(0x0,typeorm_2[_0x30f69e(0xab)])(aiAgreeLog_entity_1['AiAgreeLogEntity'])),__metadata(_0x30f69e(0xb7),[typeorm_1[_0x30f69e(0xdc)],typeorm_1[_0x30f69e(0xdc)],typeorm_1[_0x30f69e(0xb4)]])],AiLogService),exports[_0x30f69e(0xce)]=AiLogService;