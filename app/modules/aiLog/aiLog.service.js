'use strict';const _0x1f77b0=_0x3325;(function(_0x93ae9,_0x4e958a){const _0xc5ec13=_0x3325,_0x26e118=_0x93ae9();while(!![]){try{const _0x29cfaa=parseInt(_0xc5ec13(0x1a6))/0x1*(parseInt(_0xc5ec13(0x1c0))/0x2)+parseInt(_0xc5ec13(0x1a9))/0x3+parseInt(_0xc5ec13(0x1be))/0x4*(parseInt(_0xc5ec13(0x1cb))/0x5)+-parseInt(_0xc5ec13(0x1dd))/0x6*(-parseInt(_0xc5ec13(0x1aa))/0x7)+-parseInt(_0xc5ec13(0x1d0))/0x8+-parseInt(_0xc5ec13(0x1b7))/0x9+parseInt(_0xc5ec13(0x1a0))/0xa*(-parseInt(_0xc5ec13(0x1d4))/0xb);if(_0x29cfaa===_0x4e958a)break;else _0x26e118['push'](_0x26e118['shift']());}catch(_0x61c36c){_0x26e118['push'](_0x26e118['shift']());}}}(_0x2c12,0xcfa48));function _0x3325(_0x333953,_0x37f811){const _0x2c1299=_0x2c12();return _0x3325=function(_0x33251c,_0x470cc8){_0x33251c=_0x33251c-0x19f;let _0xa0b3fc=_0x2c1299[_0x33251c];return _0xa0b3fc;},_0x3325(_0x333953,_0x37f811);}var __decorate=this&&this[_0x1f77b0(0x1b3)]||function(_0x67a9e8,_0x2d5917,_0x22c34c,_0x19d3c4){const _0x2e181d=_0x1f77b0;var _0x2617c3=arguments[_0x2e181d(0x1d2)],_0x45db2a=_0x2617c3<0x3?_0x2d5917:_0x19d3c4===null?_0x19d3c4=Object[_0x2e181d(0x1b5)](_0x2d5917,_0x22c34c):_0x19d3c4,_0x3eda2e;if(typeof Reflect==='object'&&typeof Reflect[_0x2e181d(0x1bd)]===_0x2e181d(0x1ca))_0x45db2a=Reflect[_0x2e181d(0x1bd)](_0x67a9e8,_0x2d5917,_0x22c34c,_0x19d3c4);else{for(var _0x5a5a77=_0x67a9e8[_0x2e181d(0x1d2)]-0x1;_0x5a5a77>=0x0;_0x5a5a77--)if(_0x3eda2e=_0x67a9e8[_0x5a5a77])_0x45db2a=(_0x2617c3<0x3?_0x3eda2e(_0x45db2a):_0x2617c3>0x3?_0x3eda2e(_0x2d5917,_0x22c34c,_0x45db2a):_0x3eda2e(_0x2d5917,_0x22c34c))||_0x45db2a;}return _0x2617c3>0x3&&_0x45db2a&&Object[_0x2e181d(0x1d5)](_0x2d5917,_0x22c34c,_0x45db2a),_0x45db2a;},__metadata=this&&this['__metadata']||function(_0x4a1c13,_0xd41237){const _0x37d31f=_0x1f77b0;if(typeof Reflect===_0x37d31f(0x1c1)&&typeof Reflect[_0x37d31f(0x1d3)]==='function')return Reflect[_0x37d31f(0x1d3)](_0x4a1c13,_0xd41237);},__param=this&&this[_0x1f77b0(0x1c8)]||function(_0x507eef,_0x26da1e){return function(_0x215497,_0x23f7cd){_0x26da1e(_0x215497,_0x23f7cd,_0x507eef);};};Object['defineProperty'](exports,_0x1f77b0(0x1a1),{'value':!![]}),exports[_0x1f77b0(0x1da)]=void 0x0;const typeorm_1=require(_0x1f77b0(0x1c5)),common_1=require(_0x1f77b0(0x1dc)),typeorm_2=require(_0x1f77b0(0x1d9)),aiLogExt_entity_1=require(_0x1f77b0(0x1cd)),aiAgreeLog_entity_1=require(_0x1f77b0(0x1a3));let AiLogService=class AiLogService{constructor(_0xbc6b30,_0x1024b2,_0x357e4b){const _0xfaa17c=_0x1f77b0;this['aiLogExtEntity']=_0xbc6b30,this['aiAgreeLogEntity']=_0x1024b2,this[_0xfaa17c(0x1ac)]=_0x357e4b;}async[_0x1f77b0(0x1b4)](_0x348221,_0x23ac0b){const _0x12bca3=_0x1f77b0,_0x458c48=await this[_0x12bca3(0x1d1)][_0x12bca3(0x1b0)]({'where':{'relateId':_0x23ac0b,'relateType':_0x348221}});return _0x458c48;}async[_0x1f77b0(0x1db)](_0x22c8a1,_0x3bd24c,_0x2c8a02){const _0x25da1f=_0x1f77b0,_0x4a92a3=new Map();if(!_0x3bd24c[_0x25da1f(0x1d2)])return _0x4a92a3;const _0x46f855=await this[_0x25da1f(0x1d1)][_0x25da1f(0x1af)]({'where':{'userId':_0x22c8a1,'relateType':_0x2c8a02,'relateId':(0x0,typeorm_1['In'])(_0x3bd24c)}});return _0x46f855['forEach'](_0x4f93c9=>{const _0x359046=_0x25da1f;_0x4a92a3[_0x359046(0x1ba)](_0x4f93c9[_0x359046(0x1c4)],_0x4f93c9[_0x359046(0x1c3)]);}),_0x4a92a3;}async[_0x1f77b0(0x1c6)](_0x16464f,_0x26c84a){const _0x2eff67=_0x1f77b0,_0x5ae76b=new Map();if(!_0x16464f[_0x2eff67(0x1d2)])return _0x5ae76b;const _0x686d9a=await this[_0x2eff67(0x1c2)][_0x2eff67(0x1af)]({'where':{'relateId':(0x0,typeorm_1['In'])(_0x16464f),'relateType':_0x26c84a}});return _0x686d9a[_0x2eff67(0x1d6)](_0x448dda=>{const _0x165e05=_0x2eff67;_0x5ae76b[_0x165e05(0x1ba)](_0x448dda['relateId'],_0x448dda);}),_0x5ae76b;}async[_0x1f77b0(0x1d7)](_0x414d48,_0x44d44f){const _0x58c203=_0x1f77b0;try{const _0x1fa10b=_0x414d48[_0x58c203(0x1bc)]['id'],_0x219458=await this['aiAgreeLogEntity'][_0x58c203(0x1b0)]({'where':{'userId':_0x1fa10b,'relateId':_0x44d44f[_0x58c203(0x1c4)],'relateType':_0x44d44f[_0x58c203(0x1b1)]}});return await this[_0x58c203(0x1ac)][_0x58c203(0x1bb)](async()=>{const _0x430730=_0x58c203;if(_0x219458&&_0x219458['action']===_0x44d44f[_0x430730(0x1c3)])await this[_0x430730(0x1d1)][_0x430730(0x1b2)]({'id':_0x219458['id']});else{const _0x360443={..._0x44d44f,'userId':_0x1fa10b,'relateId':_0x44d44f[_0x430730(0x1c4)],'relateType':_0x44d44f[_0x430730(0x1b1)],'id':_0x219458?_0x219458['id']:null};await this[_0x430730(0x1d1)][_0x430730(0x1b6)](_0x360443);}let _0x2d4c69=await this['aiLogExtEntity'][_0x430730(0x1b0)]({'where':{'relateId':_0x44d44f[_0x430730(0x1c4)]}});!_0x2d4c69&&(_0x2d4c69=new aiLogExt_entity_1['AiLogExtEntity'](),_0x2d4c69[_0x430730(0x1c4)]=_0x44d44f[_0x430730(0x1c4)],_0x2d4c69['relateType']=_0x44d44f[_0x430730(0x1b1)],_0x2d4c69[_0x430730(0x1ae)]=0x0),_0x219458&&_0x219458['action']===_0x44d44f[_0x430730(0x1c3)]?_0x44d44f['action']===_0x430730(0x1d7)?_0x2d4c69[_0x430730(0x1ae)]=_0x2d4c69['agreeNum']-0x1:_0x2d4c69[_0x430730(0x1ae)]=_0x2d4c69[_0x430730(0x1ae)]+0x1:_0x44d44f[_0x430730(0x1c3)]===_0x430730(0x1d7)?_0x2d4c69[_0x430730(0x1ae)]=_0x2d4c69[_0x430730(0x1ae)]+Math['round'](Math[_0x430730(0x1ad)]()*0x14):_0x2d4c69[_0x430730(0x1ae)]=_0x2d4c69[_0x430730(0x1ae)]-0x1,_0x2d4c69[_0x430730(0x1ae)]=_0x2d4c69[_0x430730(0x1ae)]<0x0?0x0:_0x2d4c69[_0x430730(0x1ae)],await this['aiLogExtEntity'][_0x430730(0x1b6)](_0x2d4c69);}),!![];}catch(_0x1eb987){throw new common_1[(_0x58c203(0x1cf))](_0x1eb987[_0x58c203(0x1ce)],common_1[_0x58c203(0x1a4)][_0x58c203(0x1ab)]);}}async[_0x1f77b0(0x1c7)](_0x4ad609,_0x4d7ed6){const _0x4e651d=_0x1f77b0,_0x9e6045=await this[_0x4e651d(0x1c2)]['findOne']({'where':{'relateId':_0x4d7ed6,'relateType':_0x4ad609}});return _0x9e6045;}async[_0x1f77b0(0x1a2)](_0x3424f0,_0x19c7d4){const _0x4d5237=_0x1f77b0;let _0x98b310=await this[_0x4d5237(0x1c2)][_0x4d5237(0x1b0)]({'where':{'relateId':_0x3424f0,'relateType':_0x19c7d4}});!_0x98b310&&(_0x98b310=new aiLogExt_entity_1[(_0x4d5237(0x1cc))](),_0x98b310[_0x4d5237(0x1c4)]=_0x3424f0,_0x98b310[_0x4d5237(0x1b1)]=_0x19c7d4),_0x98b310[_0x4d5237(0x1a7)]=_0x98b310[_0x4d5237(0x1a7)]+Math[_0x4d5237(0x1b8)](Math[_0x4d5237(0x1ad)]()*0x14),await this[_0x4d5237(0x1c2)][_0x4d5237(0x1b6)](_0x98b310);}async[_0x1f77b0(0x1d8)](_0x1c576f,_0x1a45e8){const _0x2a20eb=_0x1f77b0;let _0x3f3020=await this[_0x2a20eb(0x1c2)][_0x2a20eb(0x1b0)]({'where':{'relateId':_0x1a45e8,'relateType':_0x1c576f}});!_0x3f3020&&(_0x3f3020=new aiLogExt_entity_1['AiLogExtEntity'](),_0x3f3020['relateId']=_0x1a45e8,_0x3f3020[_0x2a20eb(0x1b1)]=_0x1c576f),_0x3f3020[_0x2a20eb(0x1a5)]=_0x3f3020[_0x2a20eb(0x1a5)]+Math[_0x2a20eb(0x1b8)](Math['random']()*0x14),await this['aiLogExtEntity'][_0x2a20eb(0x1b6)](_0x3f3020);}};AiLogService=__decorate([(0x0,common_1[_0x1f77b0(0x1c9)])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(aiLogExt_entity_1[_0x1f77b0(0x1cc)])),__param(0x1,(0x0,typeorm_2[_0x1f77b0(0x19f)])(aiAgreeLog_entity_1['AiAgreeLogEntity'])),__metadata(_0x1f77b0(0x1bf),[typeorm_1['Repository'],typeorm_1[_0x1f77b0(0x1b9)],typeorm_1[_0x1f77b0(0x1a8)]])],AiLogService),exports[_0x1f77b0(0x1da)]=AiLogService;function _0x2c12(){const _0x463d7d=['getOwnPropertyDescriptor','save','12047085oDiMsl','round','Repository','set','transaction','user','decorate','5756skCbFC','design:paramtypes','28584TYAiId','object','aiLogExtEntity','action','relateId','typeorm','getExtByRelate','getByRelateId','__param','Injectable','function','4805KfdrEo','AiLogExtEntity','./aiLogExt.entity','message','HttpException','8370392iMlHLz','aiAgreeLogEntity','length','metadata','14617119QjrsUx','defineProperty','forEach','agree','increaseVisit','@nestjs/typeorm','AiLogService','getAgreeMap','@nestjs/common','897378fLUwwL','InjectRepository','20BDtOuz','__esModule','play','./aiAgreeLog.entity','HttpStatus','visitNum','118roMhQu','playNum','Connection','4432872DrJTKO','63ArfESk','BAD_REQUEST','connection','random','agreeNum','find','findOne','relateType','delete','__decorate','getAgreeByRelateId'];_0x2c12=function(){return _0x463d7d;};return _0x2c12();}