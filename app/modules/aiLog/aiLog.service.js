'use strict';const _0x535ee9=_0x2dbd;(function(_0x3be6c1,_0x21ddce){const _0x256708=_0x2dbd,_0x40ab77=_0x3be6c1();while(!![]){try{const _0x1504d6=parseInt(_0x256708(0xc3))/0x1+parseInt(_0x256708(0xd5))/0x2+-parseInt(_0x256708(0xc6))/0x3*(-parseInt(_0x256708(0xe9))/0x4)+-parseInt(_0x256708(0xbf))/0x5+-parseInt(_0x256708(0xe2))/0x6*(parseInt(_0x256708(0xef))/0x7)+-parseInt(_0x256708(0xd0))/0x8+parseInt(_0x256708(0xb8))/0x9;if(_0x1504d6===_0x21ddce)break;else _0x40ab77['push'](_0x40ab77['shift']());}catch(_0x4fcb79){_0x40ab77['push'](_0x40ab77['shift']());}}}(_0x5bbc,0xf2644));var __decorate=this&&this['__decorate']||function(_0x2de573,_0x409149,_0x528242,_0x5c2d8a){const _0x31f254=_0x2dbd;var _0x536d93=arguments[_0x31f254(0xbd)],_0x569fee=_0x536d93<0x3?_0x409149:_0x5c2d8a===null?_0x5c2d8a=Object[_0x31f254(0xe6)](_0x409149,_0x528242):_0x5c2d8a,_0x56b34f;if(typeof Reflect==='object'&&typeof Reflect[_0x31f254(0xba)]==='function')_0x569fee=Reflect[_0x31f254(0xba)](_0x2de573,_0x409149,_0x528242,_0x5c2d8a);else{for(var _0x16a44c=_0x2de573[_0x31f254(0xbd)]-0x1;_0x16a44c>=0x0;_0x16a44c--)if(_0x56b34f=_0x2de573[_0x16a44c])_0x569fee=(_0x536d93<0x3?_0x56b34f(_0x569fee):_0x536d93>0x3?_0x56b34f(_0x409149,_0x528242,_0x569fee):_0x56b34f(_0x409149,_0x528242))||_0x569fee;}return _0x536d93>0x3&&_0x569fee&&Object[_0x31f254(0xdc)](_0x409149,_0x528242,_0x569fee),_0x569fee;},__metadata=this&&this['__metadata']||function(_0x27def6,_0x12c1c0){const _0x43105d=_0x2dbd;if(typeof Reflect===_0x43105d(0xd1)&&typeof Reflect['metadata']===_0x43105d(0xe0))return Reflect['metadata'](_0x27def6,_0x12c1c0);},__param=this&&this[_0x535ee9(0xd9)]||function(_0x491f1e,_0x553f8c){return function(_0x2e6763,_0x1866e8){_0x553f8c(_0x2e6763,_0x1866e8,_0x491f1e);};};function _0x2dbd(_0x43c89d,_0x4fbf75){const _0x5bbc26=_0x5bbc();return _0x2dbd=function(_0x2dbdc0,_0xc9cce1){_0x2dbdc0=_0x2dbdc0-0xb8;let _0x3eb7c4=_0x5bbc26[_0x2dbdc0];return _0x3eb7c4;},_0x2dbd(_0x43c89d,_0x4fbf75);}Object[_0x535ee9(0xdc)](exports,_0x535ee9(0xc0),{'value':!![]}),exports[_0x535ee9(0xee)]=void 0x0;const typeorm_1=require('typeorm'),common_1=require(_0x535ee9(0xc4)),typeorm_2=require('@nestjs/typeorm'),aiLogExt_entity_1=require(_0x535ee9(0xea)),aiAgreeLog_entity_1=require('./aiAgreeLog.entity');let AiLogService=class AiLogService{constructor(_0x168f8f,_0x4e4275,_0x3e8b00){const _0x28a730=_0x535ee9;this[_0x28a730(0xcd)]=_0x168f8f,this[_0x28a730(0xce)]=_0x4e4275,this['connection']=_0x3e8b00;}async[_0x535ee9(0xe7)](_0x5b596d,_0x5a4ffb){const _0x2b6608=_0x535ee9;return await this[_0x2b6608(0xd8)]['query'](_0x2b6608(0xbc)+_0x5b596d+_0x2b6608(0xed)+_0x5a4ffb+_0x2b6608(0xdd));}async[_0x535ee9(0xc5)](_0x5c57d8,_0x166395,_0x27cf5d){const _0x15c5db=_0x535ee9,_0x40d1ff=new Map();if(!_0x166395['length'])return _0x40d1ff;const _0x2c9029=await this['aiAgreeLogEntity'][_0x15c5db(0xda)]({'where':{'userId':_0x5c57d8,'relateType':_0x27cf5d,'relateId':(0x0,typeorm_1['In'])(_0x166395)}});return _0x2c9029['forEach'](_0x469869=>{const _0x58508b=_0x15c5db;_0x40d1ff[_0x58508b(0xe3)](_0x469869[_0x58508b(0xc1)],_0x469869[_0x58508b(0xd2)]);}),_0x40d1ff;}async[_0x535ee9(0xbb)](_0x11c229,_0x1ef1e7){const _0x3eba51=_0x535ee9,_0x24c8de=new Map();if(!_0x11c229[_0x3eba51(0xbd)])return _0x24c8de;const _0x1b88c3=await this[_0x3eba51(0xce)][_0x3eba51(0xda)]({'where':{'relateType':_0x1ef1e7,'relateId':(0x0,typeorm_1['In'])(_0x11c229)}});return _0x1b88c3['forEach'](_0x5399c9=>{const _0x2ea65b=_0x3eba51;_0x24c8de['set'](_0x5399c9[_0x2ea65b(0xc1)],_0x5399c9[_0x2ea65b(0xd2)]);}),_0x24c8de;}async[_0x535ee9(0xd7)](_0x333609,_0x330316){const _0x21d983=_0x535ee9,_0x433c77=new Map();if(!_0x333609[_0x21d983(0xbd)])return _0x433c77;const _0x51ce33=await this['aiLogExtEntity'][_0x21d983(0xda)]({'where':{'relateId':(0x0,typeorm_1['In'])(_0x333609),'relateType':_0x330316}});return _0x51ce33[_0x21d983(0xd4)](_0x522cb1=>{const _0xdb5ed3=_0x21d983;_0x433c77[_0xdb5ed3(0xe3)](_0x522cb1[_0xdb5ed3(0xc1)],_0x522cb1);}),_0x433c77;}async['agree'](_0x4749cd,_0x1af712){const _0x1e2b7d=_0x535ee9;try{const _0x6655d9=_0x4749cd[_0x1e2b7d(0xcc)]['id'],_0x280217=await this['aiAgreeLogEntity'][_0x1e2b7d(0xc7)]({'where':{'userId':_0x6655d9,'relateId':_0x1af712['relateId'],'relateType':_0x1af712[_0x1e2b7d(0xde)]}});return await this[_0x1e2b7d(0xd8)][_0x1e2b7d(0xf1)](async()=>{const _0x26432b=_0x1e2b7d;if(_0x280217&&_0x280217[_0x26432b(0xd2)]===_0x1af712[_0x26432b(0xd2)])await this['aiAgreeLogEntity']['delete']({'id':_0x280217['id']});else{const _0x49fa57={..._0x1af712,'userId':_0x6655d9,'relateId':_0x1af712['relateId'],'relateType':_0x1af712['relateType'],'id':_0x280217?_0x280217['id']:null};await this[_0x26432b(0xce)]['save'](_0x49fa57);}let _0x491161=await this['aiLogExtEntity'][_0x26432b(0xc7)]({'where':{'relateId':_0x1af712[_0x26432b(0xc1)]}});!_0x491161&&(_0x491161=new aiLogExt_entity_1[(_0x26432b(0xf0))](),_0x491161[_0x26432b(0xc1)]=_0x1af712[_0x26432b(0xc1)],_0x491161[_0x26432b(0xde)]=_0x1af712[_0x26432b(0xde)],_0x491161['agreeNum']=0x0),_0x280217&&_0x280217[_0x26432b(0xd2)]===_0x1af712[_0x26432b(0xd2)]?_0x1af712[_0x26432b(0xd2)]===_0x26432b(0xca)?_0x491161[_0x26432b(0xe4)]=_0x491161[_0x26432b(0xe4)]-0x1:_0x491161[_0x26432b(0xe4)]=_0x491161[_0x26432b(0xe4)]+0x1:_0x1af712['action']===_0x26432b(0xca)?_0x491161[_0x26432b(0xe4)]=_0x491161[_0x26432b(0xe4)]+Math[_0x26432b(0xc9)](Math['random']()*0x14):_0x491161[_0x26432b(0xe4)]=_0x491161[_0x26432b(0xe4)]-0x1,_0x491161[_0x26432b(0xe4)]=_0x491161[_0x26432b(0xe4)]<0x0?0x0:_0x491161[_0x26432b(0xe4)],await this[_0x26432b(0xcd)][_0x26432b(0xeb)](_0x491161);}),!![];}catch(_0x137348){throw new common_1[(_0x1e2b7d(0xec))](_0x137348[_0x1e2b7d(0xcb)],common_1[_0x1e2b7d(0xe5)][_0x1e2b7d(0xbe)]);}}async['getByRelateId'](_0x5a3c73,_0x549536){const _0x4b983c=_0x535ee9,_0x45d474=await this[_0x4b983c(0xcd)][_0x4b983c(0xc7)]({'where':{'relateId':_0x549536,'relateType':_0x5a3c73}});return _0x45d474;}async[_0x535ee9(0xcf)](_0x18d5e9,_0x5a242f){const _0x464ecc=_0x535ee9;let _0x5629bc=await this[_0x464ecc(0xcd)][_0x464ecc(0xc7)]({'where':{'relateId':_0x18d5e9,'relateType':_0x5a242f}});!_0x5629bc&&(_0x5629bc=new aiLogExt_entity_1[(_0x464ecc(0xf0))](),_0x5629bc[_0x464ecc(0xc1)]=_0x18d5e9,_0x5629bc[_0x464ecc(0xde)]=_0x5a242f),_0x5629bc[_0x464ecc(0xe8)]=_0x5629bc['playNum']+Math[_0x464ecc(0xc9)](Math[_0x464ecc(0xd6)]()*0x14),await this[_0x464ecc(0xcd)][_0x464ecc(0xeb)](_0x5629bc);}async[_0x535ee9(0xc2)](_0x1de44c,_0x183537){const _0x3ad3ae=_0x535ee9;let _0x4513fe=await this['aiLogExtEntity']['findOne']({'where':{'relateId':_0x183537,'relateType':_0x1de44c}});!_0x4513fe&&(_0x4513fe=new aiLogExt_entity_1['AiLogExtEntity'](),_0x4513fe[_0x3ad3ae(0xc1)]=_0x183537,_0x4513fe[_0x3ad3ae(0xde)]=_0x1de44c),_0x4513fe[_0x3ad3ae(0xc8)]=_0x4513fe['visitNum']+Math[_0x3ad3ae(0xc9)](Math['random']()*0x14),await this[_0x3ad3ae(0xcd)][_0x3ad3ae(0xeb)](_0x4513fe);}};AiLogService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(aiLogExt_entity_1[_0x535ee9(0xf0)])),__param(0x1,(0x0,typeorm_2[_0x535ee9(0xdf)])(aiAgreeLog_entity_1[_0x535ee9(0xe1)])),__metadata(_0x535ee9(0xd3),[typeorm_1[_0x535ee9(0xdb)],typeorm_1[_0x535ee9(0xdb)],typeorm_1[_0x535ee9(0xb9)]])],AiLogService),exports['AiLogService']=AiLogService;function _0x5bbc(){const _0x685cfc=['find','Repository','defineProperty','\x20\x20and\x20action=\x27agree\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','relateType','InjectRepository','function','AiAgreeLogEntity','348BejvZL','set','agreeNum','HttpStatus','getOwnPropertyDescriptor','getAgreeByRelateId','playNum','16ueXHHI','./aiLogExt.entity','save','HttpException','\x27\x20AND\x20relate_id=','AiLogService','20846tgdtXV','AiLogExtEntity','transaction','3734685hvhjvk','Connection','decorate','getAgreeCountMap','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20count(0)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ai_agree_log\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relate_type=\x27','length','BAD_REQUEST','3788425hHipNS','__esModule','relateId','increaseVisit','821115Eqpkiv','@nestjs/common','getAgreeMap','27882AbiFFa','findOne','visitNum','round','agree','message','user','aiLogExtEntity','aiAgreeLogEntity','play','6132160fTrfSS','object','action','design:paramtypes','forEach','2833018FMoVse','random','getExtByRelate','connection','__param'];_0x5bbc=function(){return _0x685cfc;};return _0x5bbc();}