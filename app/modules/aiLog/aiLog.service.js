'use strict';const _0x3c0f72=_0x561f;(function(_0x48e2b5,_0x1d39e1){const _0x399573=_0x561f,_0x51817c=_0x48e2b5();while(!![]){try{const _0x524804=parseInt(_0x399573(0x16d))/0x1*(-parseInt(_0x399573(0x178))/0x2)+parseInt(_0x399573(0x16b))/0x3+parseInt(_0x399573(0x183))/0x4*(-parseInt(_0x399573(0x15c))/0x5)+-parseInt(_0x399573(0x160))/0x6*(-parseInt(_0x399573(0x15b))/0x7)+parseInt(_0x399573(0x171))/0x8*(-parseInt(_0x399573(0x154))/0x9)+-parseInt(_0x399573(0x14d))/0xa*(parseInt(_0x399573(0x151))/0xb)+parseInt(_0x399573(0x17d))/0xc;if(_0x524804===_0x1d39e1)break;else _0x51817c['push'](_0x51817c['shift']());}catch(_0x373f4a){_0x51817c['push'](_0x51817c['shift']());}}}(_0x1e0d,0xc72cb));var __decorate=this&&this[_0x3c0f72(0x172)]||function(_0x1b5677,_0x5d83d1,_0x335083,_0x2daf22){const _0x57c1c5=_0x3c0f72;var _0x2c9e3e=arguments[_0x57c1c5(0x16f)],_0x388d0a=_0x2c9e3e<0x3?_0x5d83d1:_0x2daf22===null?_0x2daf22=Object[_0x57c1c5(0x162)](_0x5d83d1,_0x335083):_0x2daf22,_0x33fd23;if(typeof Reflect===_0x57c1c5(0x169)&&typeof Reflect[_0x57c1c5(0x161)]===_0x57c1c5(0x170))_0x388d0a=Reflect[_0x57c1c5(0x161)](_0x1b5677,_0x5d83d1,_0x335083,_0x2daf22);else{for(var _0x302154=_0x1b5677[_0x57c1c5(0x16f)]-0x1;_0x302154>=0x0;_0x302154--)if(_0x33fd23=_0x1b5677[_0x302154])_0x388d0a=(_0x2c9e3e<0x3?_0x33fd23(_0x388d0a):_0x2c9e3e>0x3?_0x33fd23(_0x5d83d1,_0x335083,_0x388d0a):_0x33fd23(_0x5d83d1,_0x335083))||_0x388d0a;}return _0x2c9e3e>0x3&&_0x388d0a&&Object['defineProperty'](_0x5d83d1,_0x335083,_0x388d0a),_0x388d0a;},__metadata=this&&this['__metadata']||function(_0x23842b,_0x2474e9){const _0x2e9b39=_0x3c0f72;if(typeof Reflect===_0x2e9b39(0x169)&&typeof Reflect[_0x2e9b39(0x158)]===_0x2e9b39(0x170))return Reflect[_0x2e9b39(0x158)](_0x23842b,_0x2474e9);},__param=this&&this['__param']||function(_0x59a2f1,_0x524e9f){return function(_0x2ae067,_0x5eb43c){_0x524e9f(_0x2ae067,_0x5eb43c,_0x59a2f1);};};Object[_0x3c0f72(0x181)](exports,_0x3c0f72(0x182),{'value':!![]}),exports[_0x3c0f72(0x177)]=void 0x0;function _0x561f(_0x5bd04,_0xc3d176){const _0x1e0df7=_0x1e0d();return _0x561f=function(_0x561f1c,_0xceced6){_0x561f1c=_0x561f1c-0x14b;let _0x56044f=_0x1e0df7[_0x561f1c];return _0x56044f;},_0x561f(_0x5bd04,_0xc3d176);}function _0x1e0d(){const _0xb1c0d3=['agree','visitNum','9uMmJUV','play','forEach','getAgreeByRelateId','metadata','typeorm','BAD_REQUEST','903ALXceO','315530rCDPjd','AiAgreeLogEntity','findOne','increaseVisit','23334yhfILn','decorate','getOwnPropertyDescriptor','find','transaction','action','connection','getAgreeMap','playNum','object','design:paramtypes','529668TRaXOO','set','1cdHsGZ','getAgreeCountMap','length','function','1096184gJRmCV','__decorate','agreeNum','Repository','save','aiLogExtEntity','AiLogService','87610KylvOu','./aiAgreeLog.entity','relateType','AiLogExtEntity','InjectRepository','9843096YYvSeF','query','relateId','getExtByRelate','defineProperty','__esModule','20xAWQkD','HttpStatus','random','round','Connection','\x20\x20and\x20action=\x27agree\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','169380GEWOen','message','\x27\x20AND\x20relate_id=','aiAgreeLogEntity','121fRfVNT'];_0x1e0d=function(){return _0xb1c0d3;};return _0x1e0d();}const typeorm_1=require(_0x3c0f72(0x159)),common_1=require('@nestjs/common'),typeorm_2=require('@nestjs/typeorm'),aiLogExt_entity_1=require('./aiLogExt.entity'),aiAgreeLog_entity_1=require(_0x3c0f72(0x179));let AiLogService=class AiLogService{constructor(_0x21fd76,_0x4b61e9,_0x189635){const _0x16a01a=_0x3c0f72;this['aiLogExtEntity']=_0x21fd76,this[_0x16a01a(0x150)]=_0x4b61e9,this['connection']=_0x189635;}async[_0x3c0f72(0x157)](_0x1a83e1,_0x259034){const _0x4fa4a2=_0x3c0f72;return await this[_0x4fa4a2(0x166)][_0x4fa4a2(0x17e)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20count(0)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ai_agree_log\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relate_type=\x27'+_0x1a83e1+_0x4fa4a2(0x14f)+_0x259034+_0x4fa4a2(0x14c));}async[_0x3c0f72(0x167)](_0x4e52d0,_0x537a26,_0x24659d){const _0x4fe20c=_0x3c0f72,_0x44dc1f=new Map();if(!_0x537a26[_0x4fe20c(0x16f)])return _0x44dc1f;const _0x25e522=await this[_0x4fe20c(0x150)][_0x4fe20c(0x163)]({'where':{'userId':_0x4e52d0,'relateType':_0x24659d,'relateId':(0x0,typeorm_1['In'])(_0x537a26)}});return _0x25e522[_0x4fe20c(0x156)](_0x238f1b=>{const _0x1fd3d6=_0x4fe20c;_0x44dc1f[_0x1fd3d6(0x16c)](_0x238f1b[_0x1fd3d6(0x17f)],_0x238f1b[_0x1fd3d6(0x165)]);}),_0x44dc1f;}async[_0x3c0f72(0x16e)](_0x4fea98,_0x4eecf0){const _0x474309=_0x3c0f72,_0x2bce39=new Map();if(!_0x4fea98[_0x474309(0x16f)])return _0x2bce39;const _0x702857=await this[_0x474309(0x150)][_0x474309(0x163)]({'where':{'relateType':_0x4eecf0,'relateId':(0x0,typeorm_1['In'])(_0x4fea98)}});return _0x702857['forEach'](_0x1c8722=>{const _0x35055f=_0x474309;_0x2bce39[_0x35055f(0x16c)](_0x1c8722[_0x35055f(0x17f)],_0x1c8722[_0x35055f(0x165)]);}),_0x2bce39;}async[_0x3c0f72(0x180)](_0x40c6d8,_0x2dc592){const _0x1691b6=_0x3c0f72,_0x535c4e=new Map();if(!_0x40c6d8[_0x1691b6(0x16f)])return _0x535c4e;const _0x58e5bc=await this[_0x1691b6(0x176)][_0x1691b6(0x163)]({'where':{'relateId':(0x0,typeorm_1['In'])(_0x40c6d8),'relateType':_0x2dc592}});return _0x58e5bc['forEach'](_0x408d9d=>{const _0x5ad88e=_0x1691b6;_0x535c4e[_0x5ad88e(0x16c)](_0x408d9d[_0x5ad88e(0x17f)],_0x408d9d);}),_0x535c4e;}async[_0x3c0f72(0x152)](_0x1083c6,_0x374d25){const _0x5a782a=_0x3c0f72;try{const _0x3ec4b6=_0x1083c6['user']['id'],_0x108dad=await this['aiAgreeLogEntity'][_0x5a782a(0x15e)]({'where':{'userId':_0x3ec4b6,'relateId':_0x374d25[_0x5a782a(0x17f)],'relateType':_0x374d25[_0x5a782a(0x17a)]}});return await this[_0x5a782a(0x166)][_0x5a782a(0x164)](async()=>{const _0x1e99e4=_0x5a782a;if(_0x108dad&&_0x108dad[_0x1e99e4(0x165)]===_0x374d25[_0x1e99e4(0x165)])await this[_0x1e99e4(0x150)]['delete']({'id':_0x108dad['id']});else{const _0x18f273={..._0x374d25,'userId':_0x3ec4b6,'relateId':_0x374d25[_0x1e99e4(0x17f)],'relateType':_0x374d25[_0x1e99e4(0x17a)],'id':_0x108dad?_0x108dad['id']:null};await this['aiAgreeLogEntity'][_0x1e99e4(0x175)](_0x18f273);}let _0x5b6cb1=await this[_0x1e99e4(0x176)][_0x1e99e4(0x15e)]({'where':{'relateId':_0x374d25['relateId']}});!_0x5b6cb1&&(_0x5b6cb1=new aiLogExt_entity_1[(_0x1e99e4(0x17b))](),_0x5b6cb1[_0x1e99e4(0x17f)]=_0x374d25[_0x1e99e4(0x17f)],_0x5b6cb1[_0x1e99e4(0x17a)]=_0x374d25['relateType'],_0x5b6cb1[_0x1e99e4(0x173)]=0x0),_0x108dad&&_0x108dad['action']===_0x374d25[_0x1e99e4(0x165)]?_0x374d25[_0x1e99e4(0x165)]===_0x1e99e4(0x152)?_0x5b6cb1[_0x1e99e4(0x173)]=_0x5b6cb1['agreeNum']-0x1:_0x5b6cb1[_0x1e99e4(0x173)]=_0x5b6cb1[_0x1e99e4(0x173)]+0x1:_0x374d25[_0x1e99e4(0x165)]===_0x1e99e4(0x152)?_0x5b6cb1[_0x1e99e4(0x173)]=_0x5b6cb1[_0x1e99e4(0x173)]+Math['round'](Math[_0x1e99e4(0x185)]()*0x14):_0x5b6cb1[_0x1e99e4(0x173)]=_0x5b6cb1[_0x1e99e4(0x173)]-0x1,_0x5b6cb1[_0x1e99e4(0x173)]=_0x5b6cb1[_0x1e99e4(0x173)]<0x0?0x0:_0x5b6cb1[_0x1e99e4(0x173)],await this['aiLogExtEntity'][_0x1e99e4(0x175)](_0x5b6cb1);}),!![];}catch(_0x42ea2d){throw new common_1['HttpException'](_0x42ea2d[_0x5a782a(0x14e)],common_1[_0x5a782a(0x184)][_0x5a782a(0x15a)]);}}async['getByRelateId'](_0x3700a5,_0x5f4eb9){const _0x56bc59=_0x3c0f72,_0x464eef=await this[_0x56bc59(0x176)]['findOne']({'where':{'relateId':_0x5f4eb9,'relateType':_0x3700a5}});return _0x464eef;}async[_0x3c0f72(0x155)](_0xba677e,_0x917794){const _0x56684e=_0x3c0f72;let _0x3233cf=await this[_0x56684e(0x176)][_0x56684e(0x15e)]({'where':{'relateId':_0xba677e,'relateType':_0x917794}});!_0x3233cf&&(_0x3233cf=new aiLogExt_entity_1[(_0x56684e(0x17b))](),_0x3233cf[_0x56684e(0x17f)]=_0xba677e,_0x3233cf[_0x56684e(0x17a)]=_0x917794),_0x3233cf[_0x56684e(0x168)]=_0x3233cf['playNum']+Math[_0x56684e(0x186)](Math[_0x56684e(0x185)]()*0x14),await this['aiLogExtEntity'][_0x56684e(0x175)](_0x3233cf);}async[_0x3c0f72(0x15f)](_0x2b2192,_0x4359db){const _0xe7bdf3=_0x3c0f72;let _0x9e1eba=await this['aiLogExtEntity']['findOne']({'where':{'relateId':_0x4359db,'relateType':_0x2b2192}});!_0x9e1eba&&(_0x9e1eba=new aiLogExt_entity_1[(_0xe7bdf3(0x17b))](),_0x9e1eba[_0xe7bdf3(0x17f)]=_0x4359db,_0x9e1eba['relateType']=_0x2b2192),_0x9e1eba['visitNum']=_0x9e1eba[_0xe7bdf3(0x153)]+Math[_0xe7bdf3(0x186)](Math[_0xe7bdf3(0x185)]()*0x14),await this['aiLogExtEntity'][_0xe7bdf3(0x175)](_0x9e1eba);}};AiLogService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2['InjectRepository'])(aiLogExt_entity_1[_0x3c0f72(0x17b)])),__param(0x1,(0x0,typeorm_2[_0x3c0f72(0x17c)])(aiAgreeLog_entity_1[_0x3c0f72(0x15d)])),__metadata(_0x3c0f72(0x16a),[typeorm_1[_0x3c0f72(0x174)],typeorm_1['Repository'],typeorm_1[_0x3c0f72(0x14b)]])],AiLogService),exports[_0x3c0f72(0x177)]=AiLogService;