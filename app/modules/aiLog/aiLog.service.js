'use strict';const _0x5db5ba=_0x5e97;(function(_0x59cecb,_0x494c07){const _0x50eb44=_0x5e97,_0x162e2e=_0x59cecb();while(!![]){try{const _0x6ccdd9=-parseInt(_0x50eb44(0xd2))/0x1+parseInt(_0x50eb44(0xbc))/0x2*(parseInt(_0x50eb44(0xd6))/0x3)+-parseInt(_0x50eb44(0xc0))/0x4*(parseInt(_0x50eb44(0xc9))/0x5)+-parseInt(_0x50eb44(0xd3))/0x6*(-parseInt(_0x50eb44(0xc3))/0x7)+-parseInt(_0x50eb44(0xd0))/0x8*(parseInt(_0x50eb44(0xdc))/0x9)+-parseInt(_0x50eb44(0xc8))/0xa+parseInt(_0x50eb44(0xcc))/0xb*(parseInt(_0x50eb44(0xe7))/0xc);if(_0x6ccdd9===_0x494c07)break;else _0x162e2e['push'](_0x162e2e['shift']());}catch(_0x2dbc57){_0x162e2e['push'](_0x162e2e['shift']());}}}(_0x4e74,0xc6fa4));function _0x5e97(_0x3ac3d9,_0x20a972){const _0x4e745c=_0x4e74();return _0x5e97=function(_0x5e979f,_0x309f84){_0x5e979f=_0x5e979f-0xbc;let _0x439f5c=_0x4e745c[_0x5e979f];return _0x439f5c;},_0x5e97(_0x3ac3d9,_0x20a972);}var __decorate=this&&this[_0x5db5ba(0xd8)]||function(_0x5801d3,_0x2e510d,_0x12da4c,_0x2f126f){const _0xdb9d36=_0x5db5ba;var _0x312217=arguments[_0xdb9d36(0xe3)],_0x1555e7=_0x312217<0x3?_0x2e510d:_0x2f126f===null?_0x2f126f=Object['getOwnPropertyDescriptor'](_0x2e510d,_0x12da4c):_0x2f126f,_0x2ccd09;if(typeof Reflect===_0xdb9d36(0xdb)&&typeof Reflect[_0xdb9d36(0xf3)]===_0xdb9d36(0xd4))_0x1555e7=Reflect[_0xdb9d36(0xf3)](_0x5801d3,_0x2e510d,_0x12da4c,_0x2f126f);else{for(var _0x5eb1d1=_0x5801d3[_0xdb9d36(0xe3)]-0x1;_0x5eb1d1>=0x0;_0x5eb1d1--)if(_0x2ccd09=_0x5801d3[_0x5eb1d1])_0x1555e7=(_0x312217<0x3?_0x2ccd09(_0x1555e7):_0x312217>0x3?_0x2ccd09(_0x2e510d,_0x12da4c,_0x1555e7):_0x2ccd09(_0x2e510d,_0x12da4c))||_0x1555e7;}return _0x312217>0x3&&_0x1555e7&&Object[_0xdb9d36(0xdd)](_0x2e510d,_0x12da4c,_0x1555e7),_0x1555e7;},__metadata=this&&this[_0x5db5ba(0xc4)]||function(_0x2031d8,_0x44d34c){const _0x280dbb=_0x5db5ba;if(typeof Reflect==='object'&&typeof Reflect['metadata']===_0x280dbb(0xd4))return Reflect[_0x280dbb(0xbe)](_0x2031d8,_0x44d34c);},__param=this&&this[_0x5db5ba(0xf4)]||function(_0x1b61d3,_0x4e757b){return function(_0x24588b,_0x42782e){_0x4e757b(_0x24588b,_0x42782e,_0x1b61d3);};};function _0x4e74(){const _0x2d5d8d=['agreeNum','AiLogService','692388nfegUE','getByRelateId','design:paramtypes','playNum','getAgreeByRelateId','connection','aiAgreeLogEntity','relateType','findOne','play','user','relateId','decorate','__param','Injectable','./aiLogExt.entity','76mGtyQW','AiLogExtEntity','metadata','InjectRepository','404428NSeowl','delete','typeorm','322FxIrxJ','__metadata','set','save','find','4838830WptpBe','20MxLBSS','action','Repository','242JVjPfN','./aiAgreeLog.entity','increaseVisit','aiLogExtEntity','40JZJJRA','message','1223905DUKWxB','42786CMlHiG','function','round','117234eFwqFV','HttpException','__decorate','@nestjs/typeorm','visitNum','object','279252uapsDP','defineProperty','Connection','@nestjs/common','forEach','agree','AiAgreeLogEntity','length','random'];_0x4e74=function(){return _0x2d5d8d;};return _0x4e74();}Object[_0x5db5ba(0xdd)](exports,'__esModule',{'value':!![]}),exports[_0x5db5ba(0xe6)]=void 0x0;const typeorm_1=require(_0x5db5ba(0xc2)),common_1=require(_0x5db5ba(0xdf)),typeorm_2=require(_0x5db5ba(0xd9)),aiLogExt_entity_1=require(_0x5db5ba(0xf6)),aiAgreeLog_entity_1=require(_0x5db5ba(0xcd));let AiLogService=class AiLogService{constructor(_0x58cff1,_0x3b33f8,_0x43d190){const _0x31fd=_0x5db5ba;this[_0x31fd(0xcf)]=_0x58cff1,this['aiAgreeLogEntity']=_0x3b33f8,this['connection']=_0x43d190;}async[_0x5db5ba(0xeb)](_0x24a0d0,_0x2c5a50){const _0x12eb81=_0x5db5ba,_0x4c6a69=await this[_0x12eb81(0xed)][_0x12eb81(0xef)]({'where':{'relateId':_0x2c5a50,'relateType':_0x24a0d0}});return _0x4c6a69;}async['getAgreeMap'](_0xff67d,_0x33047f,_0x26455c){const _0x343be2=_0x5db5ba,_0x268b99=new Map();if(!_0x33047f[_0x343be2(0xe3)])return _0x268b99;const _0x22a2da=await this['aiAgreeLogEntity'][_0x343be2(0xc7)]({'where':{'userId':_0xff67d,'relateType':_0x26455c,'relateId':(0x0,typeorm_1['In'])(_0x33047f)}});return _0x22a2da[_0x343be2(0xe0)](_0x2c6314=>{const _0x317b91=_0x343be2;_0x268b99[_0x317b91(0xc5)](_0x2c6314[_0x317b91(0xf2)],_0x2c6314['action']);}),_0x268b99;}async['getExtByRelate'](_0x50659a,_0x20fe9d){const _0x50d2c7=_0x5db5ba,_0x382d35=new Map();if(!_0x50659a['length'])return _0x382d35;const _0x20bdfc=await this[_0x50d2c7(0xcf)][_0x50d2c7(0xc7)]({'where':{'relateId':(0x0,typeorm_1['In'])(_0x50659a),'relateType':_0x20fe9d}});return _0x20bdfc['forEach'](_0x134929=>{const _0x1eaf33=_0x50d2c7;_0x382d35['set'](_0x134929[_0x1eaf33(0xf2)],_0x134929);}),_0x382d35;}async['agree'](_0x2a53d5,_0x549a1e){const _0x26c16a=_0x5db5ba;try{const _0x29866b=_0x2a53d5[_0x26c16a(0xf1)]['id'],_0x12c4a8=await this[_0x26c16a(0xed)][_0x26c16a(0xef)]({'where':{'userId':_0x29866b,'relateId':_0x549a1e[_0x26c16a(0xf2)],'relateType':_0x549a1e[_0x26c16a(0xee)]}});return await this[_0x26c16a(0xec)]['transaction'](async()=>{const _0x4d1f97=_0x26c16a;if(_0x12c4a8&&_0x12c4a8[_0x4d1f97(0xca)]===_0x549a1e['action'])await this[_0x4d1f97(0xed)][_0x4d1f97(0xc1)]({'id':_0x12c4a8['id']});else{const _0x326b08={..._0x549a1e,'userId':_0x29866b,'relateId':_0x549a1e[_0x4d1f97(0xf2)],'relateType':_0x549a1e[_0x4d1f97(0xee)],'id':_0x12c4a8?_0x12c4a8['id']:null};await this[_0x4d1f97(0xed)][_0x4d1f97(0xc6)](_0x326b08);}let _0x4c97b1=await this[_0x4d1f97(0xcf)][_0x4d1f97(0xef)]({'where':{'relateId':_0x549a1e[_0x4d1f97(0xf2)]}});!_0x4c97b1&&(_0x4c97b1=new aiLogExt_entity_1['AiLogExtEntity'](),_0x4c97b1[_0x4d1f97(0xf2)]=_0x549a1e[_0x4d1f97(0xf2)],_0x4c97b1[_0x4d1f97(0xee)]=_0x549a1e[_0x4d1f97(0xee)],_0x4c97b1[_0x4d1f97(0xe5)]=0x0),_0x12c4a8&&_0x12c4a8[_0x4d1f97(0xca)]===_0x549a1e['action']?_0x549a1e['action']===_0x4d1f97(0xe1)?_0x4c97b1[_0x4d1f97(0xe5)]=_0x4c97b1[_0x4d1f97(0xe5)]-0x1:_0x4c97b1[_0x4d1f97(0xe5)]=_0x4c97b1[_0x4d1f97(0xe5)]+0x1:_0x549a1e['action']==='agree'?_0x4c97b1['agreeNum']=_0x4c97b1['agreeNum']+Math[_0x4d1f97(0xd5)](Math[_0x4d1f97(0xe4)]()*0x14):_0x4c97b1[_0x4d1f97(0xe5)]=_0x4c97b1['agreeNum']-0x1,_0x4c97b1['agreeNum']=_0x4c97b1[_0x4d1f97(0xe5)]<0x0?0x0:_0x4c97b1[_0x4d1f97(0xe5)],await this[_0x4d1f97(0xcf)][_0x4d1f97(0xc6)](_0x4c97b1);}),!![];}catch(_0x38956f){throw new common_1[(_0x26c16a(0xd7))](_0x38956f[_0x26c16a(0xd1)],common_1['HttpStatus']['BAD_REQUEST']);}}async[_0x5db5ba(0xe8)](_0x216d9a,_0x8186d5){const _0x53c543=_0x5db5ba,_0x4851f4=await this[_0x53c543(0xcf)]['findOne']({'where':{'relateId':_0x8186d5,'relateType':_0x216d9a}});return _0x4851f4;}async[_0x5db5ba(0xf0)](_0x4e56fb,_0x3720ef){const _0x3e77f3=_0x5db5ba;let _0x679596=await this[_0x3e77f3(0xcf)][_0x3e77f3(0xef)]({'where':{'relateId':_0x4e56fb,'relateType':_0x3720ef}});!_0x679596&&(_0x679596=new aiLogExt_entity_1[(_0x3e77f3(0xbd))](),_0x679596[_0x3e77f3(0xf2)]=_0x4e56fb,_0x679596[_0x3e77f3(0xee)]=_0x3720ef),_0x679596['playNum']=_0x679596[_0x3e77f3(0xea)]+Math[_0x3e77f3(0xd5)](Math[_0x3e77f3(0xe4)]()*0x14),await this[_0x3e77f3(0xcf)][_0x3e77f3(0xc6)](_0x679596);}async[_0x5db5ba(0xce)](_0x24d7e0,_0x5e75cc){const _0x2fae24=_0x5db5ba;let _0x6fe83f=await this[_0x2fae24(0xcf)]['findOne']({'where':{'relateId':_0x5e75cc,'relateType':_0x24d7e0}});!_0x6fe83f&&(_0x6fe83f=new aiLogExt_entity_1[(_0x2fae24(0xbd))](),_0x6fe83f['relateId']=_0x5e75cc,_0x6fe83f[_0x2fae24(0xee)]=_0x24d7e0),_0x6fe83f['visitNum']=_0x6fe83f[_0x2fae24(0xda)]+Math[_0x2fae24(0xd5)](Math[_0x2fae24(0xe4)]()*0x14),await this[_0x2fae24(0xcf)]['save'](_0x6fe83f);}};AiLogService=__decorate([(0x0,common_1[_0x5db5ba(0xf5)])(),__param(0x0,(0x0,typeorm_2[_0x5db5ba(0xbf)])(aiLogExt_entity_1[_0x5db5ba(0xbd)])),__param(0x1,(0x0,typeorm_2[_0x5db5ba(0xbf)])(aiAgreeLog_entity_1[_0x5db5ba(0xe2)])),__metadata(_0x5db5ba(0xe9),[typeorm_1[_0x5db5ba(0xcb)],typeorm_1['Repository'],typeorm_1[_0x5db5ba(0xde)]])],AiLogService),exports[_0x5db5ba(0xe6)]=AiLogService;