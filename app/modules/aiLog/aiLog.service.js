'use strict';const _0x5963a1=_0x5509;(function(_0x52ae0c,_0x513084){const _0x4897ad=_0x5509,_0x20395=_0x52ae0c();while(!![]){try{const _0x55f8f7=parseInt(_0x4897ad(0x136))/0x1*(-parseInt(_0x4897ad(0x13e))/0x2)+-parseInt(_0x4897ad(0x127))/0x3*(parseInt(_0x4897ad(0x138))/0x4)+parseInt(_0x4897ad(0x10f))/0x5+parseInt(_0x4897ad(0x102))/0x6*(-parseInt(_0x4897ad(0x11d))/0x7)+parseInt(_0x4897ad(0x135))/0x8*(parseInt(_0x4897ad(0x11b))/0x9)+parseInt(_0x4897ad(0x137))/0xa+-parseInt(_0x4897ad(0x113))/0xb*(-parseInt(_0x4897ad(0x100))/0xc);if(_0x55f8f7===_0x513084)break;else _0x20395['push'](_0x20395['shift']());}catch(_0x383e42){_0x20395['push'](_0x20395['shift']());}}}(_0x5255,0xaed0e));var __decorate=this&&this[_0x5963a1(0x121)]||function(_0x466c46,_0x1ec2b,_0x57c26e,_0x1813d4){const _0x59ce85=_0x5963a1;var _0x1e4d77=arguments[_0x59ce85(0x11f)],_0x1fe2b4=_0x1e4d77<0x3?_0x1ec2b:_0x1813d4===null?_0x1813d4=Object[_0x59ce85(0x10d)](_0x1ec2b,_0x57c26e):_0x1813d4,_0x5c6bae;if(typeof Reflect===_0x59ce85(0x111)&&typeof Reflect[_0x59ce85(0x12f)]==='function')_0x1fe2b4=Reflect[_0x59ce85(0x12f)](_0x466c46,_0x1ec2b,_0x57c26e,_0x1813d4);else{for(var _0x2a92ff=_0x466c46[_0x59ce85(0x11f)]-0x1;_0x2a92ff>=0x0;_0x2a92ff--)if(_0x5c6bae=_0x466c46[_0x2a92ff])_0x1fe2b4=(_0x1e4d77<0x3?_0x5c6bae(_0x1fe2b4):_0x1e4d77>0x3?_0x5c6bae(_0x1ec2b,_0x57c26e,_0x1fe2b4):_0x5c6bae(_0x1ec2b,_0x57c26e))||_0x1fe2b4;}return _0x1e4d77>0x3&&_0x1fe2b4&&Object[_0x59ce85(0x10c)](_0x1ec2b,_0x57c26e,_0x1fe2b4),_0x1fe2b4;},__metadata=this&&this['__metadata']||function(_0x24da72,_0x51f385){const _0x24d922=_0x5963a1;if(typeof Reflect===_0x24d922(0x111)&&typeof Reflect[_0x24d922(0x139)]===_0x24d922(0x116))return Reflect[_0x24d922(0x139)](_0x24da72,_0x51f385);},__param=this&&this[_0x5963a1(0x130)]||function(_0x45e8cd,_0x11d3f3){return function(_0x4f21c1,_0x2805a6){_0x11d3f3(_0x4f21c1,_0x2805a6,_0x45e8cd);};};Object[_0x5963a1(0x10c)](exports,_0x5963a1(0x128),{'value':!![]}),exports['AiLogService']=void 0x0;function _0x5509(_0x43ae1a,_0x3d5b4f){const _0x525558=_0x5255();return _0x5509=function(_0x550917,_0x4378cd){_0x550917=_0x550917-0x100;let _0x3aabbb=_0x525558[_0x550917];return _0x3aabbb;},_0x5509(_0x43ae1a,_0x3d5b4f);}const typeorm_1=require(_0x5963a1(0x112)),common_1=require('@nestjs/common'),typeorm_2=require(_0x5963a1(0x123)),aiLogExt_entity_1=require(_0x5963a1(0x117)),aiAgreeLog_entity_1=require('./aiAgreeLog.entity');function _0x5255(){const _0x18f59e=['set','673158EZIYjG','getAgreeMap','message','play','query','design:paramtypes','agreeNum','Connection','visitNum','HttpException','defineProperty','getOwnPropertyDescriptor','delete','1483055bOWihA','playNum','object','typeorm','88qNGzgT','agree','AiAgreeLogEntity','function','./aiLogExt.entity','find','connection','save','13626XyGuuN','user','63cKycXj','round','length','getAgreeByRelateId','__decorate','InjectRepository','@nestjs/typeorm','relateType','getByRelateId','forEach','149463nOXXTb','__esModule','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20count(0)\x20as\x20count\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20FROM\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ai_agree_log\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20WHERE\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relate_type=\x27','getAgreeCountMap','\x27\x20AND\x20relate_id=','AiLogExtEntity','Repository','aiAgreeLogEntity','decorate','__param','transaction','aiLogExtEntity','HttpStatus','BAD_REQUEST','6416kHRatC','2267SUhDRz','2555700cRKeRk','28Dzcbqu','metadata','findOne','random','relateId','action','922cthvdD','\x20\x20and\x20action=\x27agree\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','2029812tBuSmk'];_0x5255=function(){return _0x18f59e;};return _0x5255();}let AiLogService=class AiLogService{constructor(_0x13c113,_0x1b0bbb,_0x12d26a){const _0x18ee34=_0x5963a1;this[_0x18ee34(0x132)]=_0x13c113,this[_0x18ee34(0x12e)]=_0x1b0bbb,this[_0x18ee34(0x119)]=_0x12d26a;}async[_0x5963a1(0x120)](_0x12c5a6,_0x3431e5){const _0x3978d6=_0x5963a1;return await this[_0x3978d6(0x119)][_0x3978d6(0x106)](_0x3978d6(0x129)+_0x12c5a6+_0x3978d6(0x12b)+_0x3431e5+_0x3978d6(0x13f));}async[_0x5963a1(0x103)](_0x56006b,_0x390caa,_0x53bfb7){const _0x561dc3=new Map();if(!_0x390caa['length'])return _0x561dc3;const _0x47849d=await this['aiAgreeLogEntity']['find']({'where':{'userId':_0x56006b,'relateType':_0x53bfb7,'relateId':(0x0,typeorm_1['In'])(_0x390caa)}});return _0x47849d['forEach'](_0x2ac677=>{const _0x3db423=_0x5509;_0x561dc3[_0x3db423(0x101)](_0x2ac677[_0x3db423(0x13c)],_0x2ac677[_0x3db423(0x13d)]);}),_0x561dc3;}async[_0x5963a1(0x12a)](_0x4bdbb7,_0x1fa980){const _0x36382e=_0x5963a1,_0x3a731e=new Map();if(!_0x4bdbb7[_0x36382e(0x11f)])return _0x3a731e;const _0x2c9753=await this[_0x36382e(0x12e)][_0x36382e(0x118)]({'where':{'relateType':_0x1fa980,'relateId':(0x0,typeorm_1['In'])(_0x4bdbb7)}});return _0x2c9753[_0x36382e(0x126)](_0x49d789=>{const _0x51df33=_0x36382e;_0x3a731e[_0x51df33(0x101)](_0x49d789[_0x51df33(0x13c)],_0x49d789[_0x51df33(0x13d)]);}),_0x3a731e;}async['getExtByRelate'](_0x5159a1,_0x189a24){const _0x36328a=_0x5963a1,_0x4251a7=new Map();if(!_0x5159a1['length'])return _0x4251a7;const _0x34bfcd=await this[_0x36328a(0x132)]['find']({'where':{'relateId':(0x0,typeorm_1['In'])(_0x5159a1),'relateType':_0x189a24}});return _0x34bfcd[_0x36328a(0x126)](_0x320923=>{const _0x5d60f9=_0x36328a;_0x4251a7[_0x5d60f9(0x101)](_0x320923[_0x5d60f9(0x13c)],_0x320923);}),_0x4251a7;}async[_0x5963a1(0x114)](_0x3236c4,_0x23886a){const _0xf6a014=_0x5963a1;try{const _0x3c08aa=_0x3236c4[_0xf6a014(0x11c)]['id'],_0x1e9d13=await this[_0xf6a014(0x12e)][_0xf6a014(0x13a)]({'where':{'userId':_0x3c08aa,'relateId':_0x23886a[_0xf6a014(0x13c)],'relateType':_0x23886a['relateType']}});return await this[_0xf6a014(0x119)][_0xf6a014(0x131)](async()=>{const _0x183eb1=_0xf6a014;if(_0x1e9d13&&_0x1e9d13[_0x183eb1(0x13d)]===_0x23886a[_0x183eb1(0x13d)])await this[_0x183eb1(0x12e)][_0x183eb1(0x10e)]({'id':_0x1e9d13['id']});else{const _0x4663b7={..._0x23886a,'userId':_0x3c08aa,'relateId':_0x23886a[_0x183eb1(0x13c)],'relateType':_0x23886a['relateType'],'id':_0x1e9d13?_0x1e9d13['id']:null};await this[_0x183eb1(0x12e)]['save'](_0x4663b7);}let _0x3cd57b=await this[_0x183eb1(0x132)][_0x183eb1(0x13a)]({'where':{'relateId':_0x23886a[_0x183eb1(0x13c)]}});!_0x3cd57b&&(_0x3cd57b=new aiLogExt_entity_1['AiLogExtEntity'](),_0x3cd57b[_0x183eb1(0x13c)]=_0x23886a[_0x183eb1(0x13c)],_0x3cd57b[_0x183eb1(0x124)]=_0x23886a[_0x183eb1(0x124)],_0x3cd57b[_0x183eb1(0x108)]=0x0),_0x1e9d13&&_0x1e9d13['action']===_0x23886a['action']?_0x23886a[_0x183eb1(0x13d)]===_0x183eb1(0x114)?_0x3cd57b[_0x183eb1(0x108)]=_0x3cd57b[_0x183eb1(0x108)]-0x1:_0x3cd57b[_0x183eb1(0x108)]=_0x3cd57b['agreeNum']+0x1:_0x23886a[_0x183eb1(0x13d)]===_0x183eb1(0x114)?_0x3cd57b[_0x183eb1(0x108)]=_0x3cd57b[_0x183eb1(0x108)]+Math[_0x183eb1(0x11e)](Math[_0x183eb1(0x13b)]()*0x14):_0x3cd57b[_0x183eb1(0x108)]=_0x3cd57b['agreeNum']-0x1,_0x3cd57b[_0x183eb1(0x108)]=_0x3cd57b['agreeNum']<0x0?0x0:_0x3cd57b['agreeNum'],await this[_0x183eb1(0x132)][_0x183eb1(0x11a)](_0x3cd57b);}),!![];}catch(_0x3e827a){throw new common_1[(_0xf6a014(0x10b))](_0x3e827a[_0xf6a014(0x104)],common_1[_0xf6a014(0x133)][_0xf6a014(0x134)]);}}async[_0x5963a1(0x125)](_0x452c90,_0x1094eb){const _0x29ebad=_0x5963a1,_0x246bbd=await this[_0x29ebad(0x132)][_0x29ebad(0x13a)]({'where':{'relateId':_0x1094eb,'relateType':_0x452c90}});return _0x246bbd;}async[_0x5963a1(0x105)](_0x5e128d,_0x89e20e){const _0x5132fe=_0x5963a1;let _0x5b8fd1=await this['aiLogExtEntity'][_0x5132fe(0x13a)]({'where':{'relateId':_0x5e128d,'relateType':_0x89e20e}});!_0x5b8fd1&&(_0x5b8fd1=new aiLogExt_entity_1[(_0x5132fe(0x12c))](),_0x5b8fd1['relateId']=_0x5e128d,_0x5b8fd1[_0x5132fe(0x124)]=_0x89e20e),_0x5b8fd1['playNum']=_0x5b8fd1[_0x5132fe(0x110)]+Math[_0x5132fe(0x11e)](Math['random']()*0x14),await this[_0x5132fe(0x132)]['save'](_0x5b8fd1);}async['increaseVisit'](_0x1a556d,_0x177d6b){const _0x21117e=_0x5963a1;let _0x5e01dd=await this[_0x21117e(0x132)][_0x21117e(0x13a)]({'where':{'relateId':_0x177d6b,'relateType':_0x1a556d}});!_0x5e01dd&&(_0x5e01dd=new aiLogExt_entity_1['AiLogExtEntity'](),_0x5e01dd[_0x21117e(0x13c)]=_0x177d6b,_0x5e01dd[_0x21117e(0x124)]=_0x1a556d),_0x5e01dd[_0x21117e(0x10a)]=_0x5e01dd[_0x21117e(0x10a)]+Math[_0x21117e(0x11e)](Math[_0x21117e(0x13b)]()*0x14),await this[_0x21117e(0x132)]['save'](_0x5e01dd);}};AiLogService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_2[_0x5963a1(0x122)])(aiLogExt_entity_1['AiLogExtEntity'])),__param(0x1,(0x0,typeorm_2[_0x5963a1(0x122)])(aiAgreeLog_entity_1[_0x5963a1(0x115)])),__metadata(_0x5963a1(0x107),[typeorm_1[_0x5963a1(0x12d)],typeorm_1[_0x5963a1(0x12d)],typeorm_1[_0x5963a1(0x109)]])],AiLogService),exports['AiLogService']=AiLogService;