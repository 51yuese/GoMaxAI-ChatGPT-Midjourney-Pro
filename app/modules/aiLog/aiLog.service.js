'use strict';const _0x45412d=_0x4e6e;(function(_0x11b58a,_0x9a6eab){const _0x5bf0b7=_0x4e6e,_0x32f7b6=_0x11b58a();while(!![]){try{const _0x328568=parseInt(_0x5bf0b7(0x184))/0x1*(-parseInt(_0x5bf0b7(0x177))/0x2)+-parseInt(_0x5bf0b7(0x182))/0x3*(-parseInt(_0x5bf0b7(0x165))/0x4)+parseInt(_0x5bf0b7(0x171))/0x5*(parseInt(_0x5bf0b7(0x194))/0x6)+-parseInt(_0x5bf0b7(0x193))/0x7*(parseInt(_0x5bf0b7(0x179))/0x8)+parseInt(_0x5bf0b7(0x164))/0x9+-parseInt(_0x5bf0b7(0x199))/0xa*(parseInt(_0x5bf0b7(0x18e))/0xb)+parseInt(_0x5bf0b7(0x181))/0xc*(parseInt(_0x5bf0b7(0x16b))/0xd);if(_0x328568===_0x9a6eab)break;else _0x32f7b6['push'](_0x32f7b6['shift']());}catch(_0x28417e){_0x32f7b6['push'](_0x32f7b6['shift']());}}}(_0x27e3,0x2088f));var __decorate=this&&this[_0x45412d(0x197)]||function(_0x2a0613,_0x4dfcc9,_0x69f2e1,_0x32bafb){const _0x44cc40=_0x45412d;var _0x19c310=arguments[_0x44cc40(0x196)],_0x222708=_0x19c310<0x3?_0x4dfcc9:_0x32bafb===null?_0x32bafb=Object[_0x44cc40(0x173)](_0x4dfcc9,_0x69f2e1):_0x32bafb,_0x53dbd8;if(typeof Reflect===_0x44cc40(0x167)&&typeof Reflect[_0x44cc40(0x168)]===_0x44cc40(0x16d))_0x222708=Reflect[_0x44cc40(0x168)](_0x2a0613,_0x4dfcc9,_0x69f2e1,_0x32bafb);else{for(var _0x48ce39=_0x2a0613[_0x44cc40(0x196)]-0x1;_0x48ce39>=0x0;_0x48ce39--)if(_0x53dbd8=_0x2a0613[_0x48ce39])_0x222708=(_0x19c310<0x3?_0x53dbd8(_0x222708):_0x19c310>0x3?_0x53dbd8(_0x4dfcc9,_0x69f2e1,_0x222708):_0x53dbd8(_0x4dfcc9,_0x69f2e1))||_0x222708;}return _0x19c310>0x3&&_0x222708&&Object[_0x44cc40(0x176)](_0x4dfcc9,_0x69f2e1,_0x222708),_0x222708;},__metadata=this&&this['__metadata']||function(_0x3c524a,_0x419c21){const _0x5c6f1c=_0x45412d;if(typeof Reflect===_0x5c6f1c(0x167)&&typeof Reflect[_0x5c6f1c(0x16c)]==='function')return Reflect[_0x5c6f1c(0x16c)](_0x3c524a,_0x419c21);},__param=this&&this[_0x45412d(0x17f)]||function(_0x1c4372,_0x47e1bf){return function(_0x4b6d05,_0x2e7b86){_0x47e1bf(_0x4b6d05,_0x2e7b86,_0x1c4372);};};Object[_0x45412d(0x176)](exports,_0x45412d(0x18b),{'value':!![]}),exports[_0x45412d(0x16a)]=void 0x0;function _0x4e6e(_0xe0a57,_0x2e05db){const _0x27e3e5=_0x27e3();return _0x4e6e=function(_0x4e6eab,_0x4adf1c){_0x4e6eab=_0x4e6eab-0x162;let _0x2479bb=_0x27e3e5[_0x4e6eab];return _0x2479bb;},_0x4e6e(_0xe0a57,_0x2e05db);}const typeorm_1=require(_0x45412d(0x186)),common_1=require(_0x45412d(0x170)),typeorm_2=require(_0x45412d(0x183)),aiLogExt_entity_1=require('./aiLogExt.entity'),aiAgreeLog_entity_1=require(_0x45412d(0x192));let AiLogService=class AiLogService{constructor(_0x3bfa8a,_0x3ea023,_0x5dfae0){const _0x29a6e1=_0x45412d;this['aiLogExtEntity']=_0x3bfa8a,this[_0x29a6e1(0x180)]=_0x3ea023,this['connection']=_0x5dfae0;}async[_0x45412d(0x17e)](_0x57a58f,_0x220c89){const _0x3e5dc3=_0x45412d,_0x5d1718=await this['aiAgreeLogEntity'][_0x3e5dc3(0x188)]({'where':{'relateId':_0x220c89,'relateType':_0x57a58f}});return _0x5d1718;}async[_0x45412d(0x17a)](_0x52abc1,_0x332131,_0x2efdb5){const _0x4e7162=_0x45412d,_0x524b50=new Map();if(!_0x332131[_0x4e7162(0x196)])return _0x524b50;const _0x285080=await this[_0x4e7162(0x180)][_0x4e7162(0x187)]({'where':{'userId':_0x52abc1,'relateType':_0x2efdb5,'relateId':(0x0,typeorm_1['In'])(_0x332131)}});return _0x285080['forEach'](_0xbe9429=>{const _0x3fd219=_0x4e7162;_0x524b50['set'](_0xbe9429[_0x3fd219(0x191)],_0xbe9429['action']);}),_0x524b50;}async[_0x45412d(0x17d)](_0x1c6b9d,_0x2ee3d4){const _0x164844=_0x45412d,_0x2c9bc1=new Map();if(!_0x1c6b9d[_0x164844(0x196)])return _0x2c9bc1;const _0x46435f=await this[_0x164844(0x18c)][_0x164844(0x187)]({'where':{'relateId':(0x0,typeorm_1['In'])(_0x1c6b9d),'relateType':_0x2ee3d4}});return _0x46435f[_0x164844(0x178)](_0x3c65d9=>{const _0x42c96d=_0x164844;_0x2c9bc1[_0x42c96d(0x174)](_0x3c65d9[_0x42c96d(0x191)],_0x3c65d9);}),_0x2c9bc1;}async[_0x45412d(0x18f)](_0x2aa9ec,_0x29ea66){const _0xdc64ca=_0x45412d;try{const _0x5649af=_0x2aa9ec['user']['id'],_0x2874c5=await this[_0xdc64ca(0x180)][_0xdc64ca(0x188)]({'where':{'userId':_0x5649af,'relateId':_0x29ea66['relateId'],'relateType':_0x29ea66[_0xdc64ca(0x198)]}});return await this['connection']['transaction'](async()=>{const _0x522831=_0xdc64ca;if(_0x2874c5&&_0x2874c5['action']===_0x29ea66['action'])await this[_0x522831(0x180)][_0x522831(0x17c)]({'id':_0x2874c5['id']});else{const _0x167c48={..._0x29ea66,'userId':_0x5649af,'relateId':_0x29ea66[_0x522831(0x191)],'relateType':_0x29ea66[_0x522831(0x198)],'id':_0x2874c5?_0x2874c5['id']:null};await this['aiAgreeLogEntity'][_0x522831(0x190)](_0x167c48);}let _0x40e6a8=await this[_0x522831(0x18c)][_0x522831(0x188)]({'where':{'relateId':_0x29ea66['relateId']}});!_0x40e6a8&&(_0x40e6a8=new aiLogExt_entity_1[(_0x522831(0x16f))](),_0x40e6a8[_0x522831(0x191)]=_0x29ea66[_0x522831(0x191)],_0x40e6a8['relateType']=_0x29ea66[_0x522831(0x198)],_0x40e6a8[_0x522831(0x169)]=0x0),_0x2874c5&&_0x2874c5['action']===_0x29ea66[_0x522831(0x162)]?_0x29ea66[_0x522831(0x162)]===_0x522831(0x18f)?_0x40e6a8[_0x522831(0x169)]=_0x40e6a8[_0x522831(0x169)]-0x1:_0x40e6a8['agreeNum']=_0x40e6a8[_0x522831(0x169)]+0x1:_0x29ea66[_0x522831(0x162)]===_0x522831(0x18f)?_0x40e6a8['agreeNum']=_0x40e6a8[_0x522831(0x169)]+Math[_0x522831(0x16e)](Math[_0x522831(0x185)]()*0x14):_0x40e6a8[_0x522831(0x169)]=_0x40e6a8[_0x522831(0x169)]-0x1,_0x40e6a8[_0x522831(0x169)]=_0x40e6a8['agreeNum']<0x0?0x0:_0x40e6a8[_0x522831(0x169)],await this[_0x522831(0x18c)][_0x522831(0x190)](_0x40e6a8);}),!![];}catch(_0x55d1f5){throw new common_1['HttpException'](_0x55d1f5['message'],common_1[_0xdc64ca(0x189)]['BAD_REQUEST']);}}async[_0x45412d(0x17b)](_0x87d13c,_0x163a84){const _0x6aebd4=_0x45412d,_0x56c998=await this[_0x6aebd4(0x18c)][_0x6aebd4(0x188)]({'where':{'relateId':_0x163a84,'relateType':_0x87d13c}});return _0x56c998;}async['play'](_0x109472,_0x2d02a6){const _0x223483=_0x45412d;let _0x60f485=await this[_0x223483(0x18c)][_0x223483(0x188)]({'where':{'relateId':_0x109472,'relateType':_0x2d02a6}});!_0x60f485&&(_0x60f485=new aiLogExt_entity_1[(_0x223483(0x16f))](),_0x60f485['relateId']=_0x109472,_0x60f485['relateType']=_0x2d02a6),_0x60f485[_0x223483(0x18a)]=_0x60f485[_0x223483(0x18a)]+Math['round'](Math[_0x223483(0x185)]()*0x14),await this[_0x223483(0x18c)][_0x223483(0x190)](_0x60f485);}async['increaseVisit'](_0x2441d0,_0x2fc9c5){const _0x23124b=_0x45412d;let _0x48d50e=await this[_0x23124b(0x18c)][_0x23124b(0x188)]({'where':{'relateId':_0x2fc9c5,'relateType':_0x2441d0}});!_0x48d50e&&(_0x48d50e=new aiLogExt_entity_1[(_0x23124b(0x16f))](),_0x48d50e[_0x23124b(0x191)]=_0x2fc9c5,_0x48d50e[_0x23124b(0x198)]=_0x2441d0),_0x48d50e[_0x23124b(0x166)]=_0x48d50e[_0x23124b(0x166)]+Math['round'](Math[_0x23124b(0x185)]()*0x14),await this[_0x23124b(0x18c)][_0x23124b(0x190)](_0x48d50e);}};AiLogService=__decorate([(0x0,common_1[_0x45412d(0x18d)])(),__param(0x0,(0x0,typeorm_2[_0x45412d(0x195)])(aiLogExt_entity_1['AiLogExtEntity'])),__param(0x1,(0x0,typeorm_2['InjectRepository'])(aiAgreeLog_entity_1['AiAgreeLogEntity'])),__metadata(_0x45412d(0x163),[typeorm_1[_0x45412d(0x175)],typeorm_1[_0x45412d(0x175)],typeorm_1[_0x45412d(0x172)]])],AiLogService),exports[_0x45412d(0x16a)]=AiLogService;function _0x27e3(){const _0x4f70c9=['@nestjs/common','957545zcNEEl','Connection','getOwnPropertyDescriptor','set','Repository','defineProperty','5650JsKweA','forEach','8YzucHO','getAgreeMap','getByRelateId','delete','getExtByRelate','getAgreeByRelateId','__param','aiAgreeLogEntity','168yTgKsF','96XvxdYo','@nestjs/typeorm','89aDffne','random','typeorm','find','findOne','HttpStatus','playNum','__esModule','aiLogExtEntity','Injectable','319MvOQLU','agree','save','relateId','./aiAgreeLog.entity','1208165iCZFpS','6LbWnzz','InjectRepository','length','__decorate','relateType','76840pzzgWY','action','design:paramtypes','1436112ySdbEq','19752dJgtRh','visitNum','object','decorate','agreeNum','AiLogService','251667UOkMgt','metadata','function','round','AiLogExtEntity'];_0x27e3=function(){return _0x4f70c9;};return _0x27e3();}