'use strict';const _0x2a689e=_0x1b56;(function(_0x183da1,_0x5a5e5c){const _0xfeda1f=_0x1b56,_0x16d730=_0x183da1();while(!![]){try{const _0x63a099=-parseInt(_0xfeda1f(0xe4))/0x1+parseInt(_0xfeda1f(0x109))/0x2+-parseInt(_0xfeda1f(0xe1))/0x3*(-parseInt(_0xfeda1f(0x112))/0x4)+-parseInt(_0xfeda1f(0x101))/0x5+-parseInt(_0xfeda1f(0x10c))/0x6*(-parseInt(_0xfeda1f(0xe8))/0x7)+-parseInt(_0xfeda1f(0xf6))/0x8+parseInt(_0xfeda1f(0xec))/0x9;if(_0x63a099===_0x5a5e5c)break;else _0x16d730['push'](_0x16d730['shift']());}catch(_0x29c887){_0x16d730['push'](_0x16d730['shift']());}}}(_0x3b0b,0xef1e8));var __decorate=this&&this[_0x2a689e(0x10e)]||function(_0x49766a,_0x17568e,_0x33b40a,_0x4f28b7){const _0x4b4040=_0x2a689e;var _0x30783b=arguments[_0x4b4040(0x119)],_0x2e33ef=_0x30783b<0x3?_0x17568e:_0x4f28b7===null?_0x4f28b7=Object[_0x4b4040(0x116)](_0x17568e,_0x33b40a):_0x4f28b7,_0x50e4bf;if(typeof Reflect==='object'&&typeof Reflect[_0x4b4040(0xe7)]===_0x4b4040(0xf3))_0x2e33ef=Reflect['decorate'](_0x49766a,_0x17568e,_0x33b40a,_0x4f28b7);else{for(var _0x3968fd=_0x49766a[_0x4b4040(0x119)]-0x1;_0x3968fd>=0x0;_0x3968fd--)if(_0x50e4bf=_0x49766a[_0x3968fd])_0x2e33ef=(_0x30783b<0x3?_0x50e4bf(_0x2e33ef):_0x30783b>0x3?_0x50e4bf(_0x17568e,_0x33b40a,_0x2e33ef):_0x50e4bf(_0x17568e,_0x33b40a))||_0x2e33ef;}return _0x30783b>0x3&&_0x2e33ef&&Object[_0x4b4040(0xe2)](_0x17568e,_0x33b40a,_0x2e33ef),_0x2e33ef;},__metadata=this&&this[_0x2a689e(0x110)]||function(_0x207f30,_0x10378e){const _0x2b2b4d=_0x2a689e;if(typeof Reflect===_0x2b2b4d(0x125)&&typeof Reflect[_0x2b2b4d(0xef)]===_0x2b2b4d(0xf3))return Reflect[_0x2b2b4d(0xef)](_0x207f30,_0x10378e);},__param=this&&this[_0x2a689e(0x113)]||function(_0x1d89a3,_0xf49f39){return function(_0x3708e7,_0x4616c8){_0xf49f39(_0x3708e7,_0x4616c8,_0x1d89a3);};};Object['defineProperty'](exports,_0x2a689e(0x114),{'value':!![]}),exports[_0x2a689e(0xe5)]=void 0x0;const common_1=require(_0x2a689e(0xee)),chatGroup_entity_1=require(_0x2a689e(0xf1)),typeorm_1=require(_0x2a689e(0x105)),typeorm_2=require(_0x2a689e(0xe6)),models_service_1=require(_0x2a689e(0xfd)),model_constant_1=require(_0x2a689e(0x10f));let ChatGroupService=class ChatGroupService{constructor(_0x415087,_0x1c9b71,_0x36d3f8){const _0x370ba2=_0x2a689e;this['chatGroupEntity']=_0x415087,this['modelsService']=_0x1c9b71,this[_0x370ba2(0x107)]=_0x36d3f8;}async['create'](_0x11e14d){const _0x74d62a=_0x2a689e,{id:_0x178d89}=_0x11e14d['user'],_0x57bcef={'title':_0x74d62a(0x120),'userId':_0x178d89,'modelType':model_constant_1[_0x74d62a(0xe9)][_0x74d62a(0x117)],'config':''},_0x5f1817=await this[_0x74d62a(0x126)][_0x74d62a(0xe3)](model_constant_1[_0x74d62a(0xe9)][_0x74d62a(0x117)]);_0x57bcef[_0x74d62a(0x124)]=JSON[_0x74d62a(0xeb)](_0x5f1817);const _0xc074da=await this[_0x74d62a(0x104)][_0x74d62a(0x128)](_0x57bcef);return _0xc074da;}async[_0x2a689e(0x102)](_0x4c4cfe,_0x5eca2d){const _0x2e1ac4=_0x2a689e;try{const {id:_0x4a92fe}=_0x5eca2d[_0x2e1ac4(0x11c)],_0x5424d7={'userId':_0x4a92fe,'isDelete':![]};_0x4c4cfe?_0x5424d7[_0x2e1ac4(0x115)]=_0x4c4cfe:_0x5424d7['modelType']=(0x0,typeorm_2['IsNull'])();const _0x3dc71b=await this[_0x2e1ac4(0x104)][_0x2e1ac4(0xf5)]({'where':_0x5424d7,'order':{'isSticky':_0x2e1ac4(0x11d),'id':_0x2e1ac4(0x11d)}});if(!_0x3dc71b[_0x2e1ac4(0x119)])return _0x3dc71b;const _0x2f4531=_0x3dc71b['map'](_0x1e9e82=>_0x1e9e82['id']),_0xc850=await this[_0x2e1ac4(0x107)][_0x2e1ac4(0x102)](_0x2e1ac4(0xf7)+_0x2f4531['join']()+_0x2e1ac4(0x11a)),_0x5e394b=new Map();_0xc850[_0x2e1ac4(0x10d)](_0x187906=>{const _0x434a41=_0x2e1ac4;_0x5e394b[_0x434a41(0x121)](_0x187906[_0x434a41(0xf9)],_0x187906[_0x434a41(0x123)]);});const _0x1889c1=_0x3dc71b[_0x2e1ac4(0xfe)](_0x5c8f38=>{return{..._0x5c8f38,'lastTime':_0x5e394b['get'](_0x5c8f38['id'])||null};});return _0x1889c1;}catch(_0x5211e6){console['log'](_0x2e1ac4(0x10b),_0x5211e6);}}async[_0x2a689e(0xea)](_0x5cf970,_0x17963f){const _0x36bf89=_0x2a689e,{title:_0x24889d,isSticky:_0x2a058c,groupId:_0x5cdece,config:_0xb259d,appType:_0x4266dc}=_0x5cf970,{id:_0x16902b}=_0x17963f[_0x36bf89(0x11c)],_0x5615a7=await this['chatGroupEntity']['findOne']({'where':{'id':_0x5cdece,'userId':_0x16902b}});if(!_0x5615a7)throw new common_1[(_0x36bf89(0xfa))](_0x36bf89(0xf8),common_1[_0x36bf89(0xfb)][_0x36bf89(0xff)]);const _0xedad27={};_0x24889d&&(_0xedad27[_0x36bf89(0xed)]=_0x24889d),typeof _0x2a058c!==_0x36bf89(0x11b)&&(_0xedad27[_0x36bf89(0xe0)]=_0x2a058c),_0xb259d&&(_0xedad27['config']=_0xb259d);const _0x49889f=await this[_0x36bf89(0x104)]['update']({'id':_0x5cdece},_0xedad27);if(_0x49889f[_0x36bf89(0x108)])return!![];else throw new common_1[(_0x36bf89(0xfa))](_0x36bf89(0x122),common_1[_0x36bf89(0xfb)]['BAD_REQUEST']);}async[_0x2a689e(0x10a)](_0x29489f,_0x247bdc){const _0x31ddd9=_0x2a689e,{groupId:_0xd0a292}=_0x29489f,{id:_0xe661f}=_0x247bdc[_0x31ddd9(0x11c)],_0x27fb3e=await this[_0x31ddd9(0x104)][_0x31ddd9(0xf2)]({'where':{'id':_0xd0a292,'userId':_0xe661f}});if(!_0x27fb3e)throw new common_1['HttpException']('非法操作、您在删除一个非法资源！',common_1[_0x31ddd9(0xfb)][_0x31ddd9(0xff)]);const _0x39f412=await this['chatGroupEntity']['update']({'id':_0xd0a292},{'isDelete':!![]});if(_0x39f412[_0x31ddd9(0x108)])return _0x31ddd9(0xf4);else throw new common_1[(_0x31ddd9(0xfa))]('删除失败！',common_1['HttpStatus']['BAD_REQUEST']);}async[_0x2a689e(0x111)](_0x1f9e7a){const _0xc3b3c=_0x2a689e,{id:_0x2b5f16}=_0x1f9e7a[_0xc3b3c(0x11c)],_0x36f5e0=await this[_0xc3b3c(0x104)][_0xc3b3c(0xea)]({'userId':_0x2b5f16,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x36f5e0[_0xc3b3c(0x108)])return _0xc3b3c(0xf4);else throw new common_1[(_0xc3b3c(0xfa))](_0xc3b3c(0x100),common_1['HttpStatus'][_0xc3b3c(0xff)]);}async[_0x2a689e(0x11e)](_0x356b86){const _0x52c1ac=_0x2a689e;if(!_0x356b86||_0x356b86===0x0)return null;return await this[_0x52c1ac(0x104)][_0x52c1ac(0xf2)]({'where':{'id':_0x356b86}});}};function _0x1b56(_0x3001cf,_0x5145c0){const _0x3b0bc7=_0x3b0b();return _0x1b56=function(_0x1b565a,_0x11ff5f){_0x1b565a=_0x1b565a-0xe0;let _0x3448a7=_0x3b0bc7[_0x1b565a];return _0x3448a7;},_0x1b56(_0x3001cf,_0x5145c0);}ChatGroupService=__decorate([(0x0,common_1[_0x2a689e(0x11f)])(),__param(0x0,(0x0,typeorm_1[_0x2a689e(0x127)])(chatGroup_entity_1[_0x2a689e(0x118)])),__metadata(_0x2a689e(0x106),[typeorm_2[_0x2a689e(0xfc)],models_service_1[_0x2a689e(0x103)],typeorm_2[_0x2a689e(0xf0)]])],ChatGroupService),exports[_0x2a689e(0xe5)]=ChatGroupService;function _0x3b0b(){const _0x189819=['ModelsService','chatGroupEntity','@nestjs/typeorm','design:paramtypes','connection','affected','958288wOTZXB','del','error:\x20','1337874oodluQ','forEach','__decorate','../../common/constants/model.constant','__metadata','delAll','38660WgFSwu','__param','__esModule','modelType','getOwnPropertyDescriptor','CHAT','ChatGroupEntity','length',')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20','undefined','user','DESC','getGroupInfoFromId','Injectable','新对话','set','更新对话失败！','lastTime','config','object','modelsService','InjectRepository','save','isSticky','507BUebYr','defineProperty','getModelByType','429311ciwbBu','ChatGroupService','typeorm','decorate','49XHRepr','EModelType','update','stringify','157698FQqlHn','title','@nestjs/common','metadata','Connection','./chatGroup.entity','findOne','function','删除成功','find','3988912YxQMMl','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20(','对话组编号和用户编号不匹配，请登录之后创建新的对话！','groupId','HttpException','HttpStatus','Repository','../models/models.service','map','BAD_REQUEST','删除失败！','8917735KFCpUW','query'];_0x3b0b=function(){return _0x189819;};return _0x3b0b();}