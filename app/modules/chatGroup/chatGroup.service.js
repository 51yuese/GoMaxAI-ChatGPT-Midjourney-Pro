'use strict';function _0x3905(){const _0x2b4494=['defineProperty','../chatgpt/entity/pptTask.entity','function','855415ANAWGB','2447192JwIbjR','update','DESC','mindTaskService','updatedAt','design:paramtypes','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20(','1200280nmYCHq','pptTaskEntity','map','Repository','get','connection','prompt','新对话','sort','del','IsNull','ChatGroupEntity','885038ynvPKK','411832GSnPVW','HttpException','history','ppt','MindTaskService','forEach','error:\x20','chatGroupEntity','modelsService','HttpStatus','getOwnPropertyDescriptor',')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','@nestjs/typeorm','297pmFuFm','BAD_REQUEST','clear','create','__esModule','mind','docsTaskEntity','CHAT','1109334UmijJs','userId','EPPTTaskType','getTime','../mindTask/mindTask.service','set','isSticky','config','lastTime','删除失败！','docs',')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20','object','__metadata','decorate','undefined','删除成功','query','非法操作、您在删除一个非法资源！','__decorate','EModelType','DocsTaskEntity','typeorm','user','metadata','log','save','@nestjs/common','findOne','clearhistory','PPTTaskEntity','ChatGroupService','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20(','name','modelType','../../common/constants/model.constant','find','length','../docsTask/entity/docsTask.entity','getList','groupId','Connection','InjectRepository','join','title','4487252zKIHDt','__param','ModelsService','push','24shqdVJ'];_0x3905=function(){return _0x2b4494;};return _0x3905();}const _0x586dd0=_0x5968;(function(_0x1bbab5,_0x4548c7){const _0x1d1170=_0x5968,_0x4b551b=_0x1bbab5();while(!![]){try{const _0x41cdd7=-parseInt(_0x1d1170(0x1cd))/0x1+-parseInt(_0x1d1170(0x219))/0x2+parseInt(_0x1d1170(0x1e3))/0x3+-parseInt(_0x1d1170(0x220))/0x4+-parseInt(_0x1d1170(0x218))/0x5*(-parseInt(_0x1d1170(0x214))/0x6)+parseInt(_0x1d1170(0x210))/0x7+parseInt(_0x1d1170(0x1ce))/0x8*(parseInt(_0x1d1170(0x1db))/0x9);if(_0x41cdd7===_0x4548c7)break;else _0x4b551b['push'](_0x4b551b['shift']());}catch(_0x1d1ff5){_0x4b551b['push'](_0x4b551b['shift']());}}}(_0x3905,0xf08a1));function _0x5968(_0x37f81b,_0x2a19bb){const _0x390522=_0x3905();return _0x5968=function(_0x596876,_0x5ae6f6){_0x596876=_0x596876-0x1c2;let _0x32569d=_0x390522[_0x596876];return _0x32569d;},_0x5968(_0x37f81b,_0x2a19bb);}var __decorate=this&&this[_0x586dd0(0x1f6)]||function(_0x22702a,_0x5239a9,_0x9ad2be,_0x5f2603){const _0x5321d3=_0x586dd0;var _0x10a87b=arguments[_0x5321d3(0x208)],_0x110ed9=_0x10a87b<0x3?_0x5239a9:_0x5f2603===null?_0x5f2603=Object[_0x5321d3(0x1d8)](_0x5239a9,_0x9ad2be):_0x5f2603,_0x4b07a9;if(typeof Reflect===_0x5321d3(0x1ef)&&typeof Reflect['decorate']===_0x5321d3(0x217))_0x110ed9=Reflect[_0x5321d3(0x1f1)](_0x22702a,_0x5239a9,_0x9ad2be,_0x5f2603);else{for(var _0x592725=_0x22702a['length']-0x1;_0x592725>=0x0;_0x592725--)if(_0x4b07a9=_0x22702a[_0x592725])_0x110ed9=(_0x10a87b<0x3?_0x4b07a9(_0x110ed9):_0x10a87b>0x3?_0x4b07a9(_0x5239a9,_0x9ad2be,_0x110ed9):_0x4b07a9(_0x5239a9,_0x9ad2be))||_0x110ed9;}return _0x10a87b>0x3&&_0x110ed9&&Object['defineProperty'](_0x5239a9,_0x9ad2be,_0x110ed9),_0x110ed9;},__metadata=this&&this[_0x586dd0(0x1f0)]||function(_0x4ca083,_0x463312){const _0x5982ad=_0x586dd0;if(typeof Reflect===_0x5982ad(0x1ef)&&typeof Reflect['metadata']===_0x5982ad(0x217))return Reflect[_0x5982ad(0x1fb)](_0x4ca083,_0x463312);},__param=this&&this[_0x586dd0(0x211)]||function(_0x3d02a4,_0x45e899){return function(_0x36b3f5,_0x660bc3){_0x45e899(_0x36b3f5,_0x660bc3,_0x3d02a4);};};Object[_0x586dd0(0x215)](exports,_0x586dd0(0x1df),{'value':!![]}),exports['ChatGroupService']=void 0x0;const common_1=require(_0x586dd0(0x1fe)),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require(_0x586dd0(0x1da)),typeorm_2=require(_0x586dd0(0x1f9)),models_service_1=require('../models/models.service'),model_constant_1=require(_0x586dd0(0x206)),mindTask_service_1=require(_0x586dd0(0x1e7)),pptTask_entity_1=require(_0x586dd0(0x216)),docsTask_entity_1=require(_0x586dd0(0x209)),ppt_constant_1=require('../../common/constants/ppt.constant');let ChatGroupService=class ChatGroupService{constructor(_0x5d5f49,_0xf2780d,_0x279d17,_0x480d1f,_0xbb8f95,_0x3750ab){const _0x939602=_0x586dd0;this[_0x939602(0x1d5)]=_0x5d5f49,this[_0x939602(0x1d6)]=_0xf2780d,this[_0x939602(0x21c)]=_0x279d17,this['pptTaskEntity']=_0x480d1f,this[_0x939602(0x1e1)]=_0xbb8f95,this[_0x939602(0x1c6)]=_0x3750ab;}async[_0x586dd0(0x1de)](_0x118767,_0x678d8c){const _0x2e7975=_0x586dd0,{title:title=_0x2e7975(0x1c8),model:_0x53ef56,modelType:modelType=model_constant_1[_0x2e7975(0x1f7)][_0x2e7975(0x1e2)]}=_0x678d8c,_0xa1063c={'title':title,'modelType':modelType,'userId':_0x118767['user']['id']},_0x2ede65=await this[_0x2e7975(0x1d6)]['getModelByType'](modelType,_0x53ef56);_0xa1063c[_0x2e7975(0x1ea)]=JSON['stringify'](_0x2ede65);const _0x215b96=await this[_0x2e7975(0x1d5)][_0x2e7975(0x1fd)](_0xa1063c);return _0x215b96;}async['get'](_0x1d0471,_0x3dae4e){const _0x5bd476=_0x586dd0;try{const _0x3fbddf={'userId':_0x3dae4e[_0x5bd476(0x1fa)]['id'],'id':_0x1d0471,'isDelete':![]},_0x1c94bd=await this['chatGroupEntity'][_0x5bd476(0x1ff)]({'where':_0x3fbddf});return _0x1c94bd;}catch(_0x20e647){console[_0x5bd476(0x1fc)](_0x5bd476(0x1d4),_0x20e647);}}async[_0x586dd0(0x1f4)](_0x8e1f46,_0x18e7a5){const _0x249987=_0x586dd0;try{const {id:_0x4daeb5}=_0x18e7a5[_0x249987(0x1fa)],_0x4215b2={'userId':_0x4daeb5,'isDelete':![]};_0x8e1f46?_0x4215b2[_0x249987(0x205)]=_0x8e1f46:_0x4215b2['modelType']=(0x0,typeorm_2[_0x249987(0x1cb)])();const _0x2f861b=await this[_0x249987(0x1d5)][_0x249987(0x207)]({'where':_0x4215b2,'order':{'isSticky':'DESC','id':_0x249987(0x21b)}});if(!_0x2f861b[_0x249987(0x208)])return _0x2f861b;const _0x377902=_0x2f861b['map'](_0x560b7b=>_0x560b7b['id']),_0x428a6a=await this[_0x249987(0x1c6)]['query'](_0x249987(0x203)+_0x377902['join']()+_0x249987(0x1ee)),_0x4b56d7=new Map();_0x428a6a['forEach'](_0x5d2a14=>{const _0x238b5b=_0x249987;_0x4b56d7[_0x238b5b(0x1e8)](_0x5d2a14[_0x238b5b(0x20b)],_0x5d2a14[_0x238b5b(0x1eb)]);});const _0x35c023=_0x2f861b[_0x249987(0x1c3)](_0x3559d6=>{const _0x3ae46d=_0x249987;return{..._0x3559d6,'lastTime':_0x4b56d7[_0x3ae46d(0x1c5)](_0x3559d6['id'])||null};});return _0x35c023;}catch(_0x92ab04){console[_0x249987(0x1fc)](_0x249987(0x1d4),_0x92ab04);}}async[_0x586dd0(0x21a)](_0x1b9a05,_0x13843a){const _0x5dd01a=_0x586dd0,{title:_0x4c4274,isSticky:_0x4c4693,groupId:_0x29b27a,config:_0x155a2c,appType:_0x389897}=_0x1b9a05,{id:_0x2c9069}=_0x13843a[_0x5dd01a(0x1fa)],_0x2765de=await this[_0x5dd01a(0x1d5)][_0x5dd01a(0x1ff)]({'where':{'id':_0x29b27a,'userId':_0x2c9069}});if(!_0x2765de)throw new common_1['HttpException']('对话组编号和用户编号不匹配，请登录之后创建新的对话！',common_1[_0x5dd01a(0x1d7)]['BAD_REQUEST']);const _0x1b6cba={};_0x4c4274&&(_0x1b6cba[_0x5dd01a(0x20f)]=_0x4c4274),typeof _0x4c4693!==_0x5dd01a(0x1f2)&&(_0x1b6cba[_0x5dd01a(0x1e9)]=_0x4c4693),_0x155a2c&&(_0x1b6cba['config']=_0x155a2c);const _0x5cb4f2=await this[_0x5dd01a(0x1d5)][_0x5dd01a(0x21a)]({'id':_0x29b27a},_0x1b6cba);if(_0x5cb4f2['affected'])return!![];else throw new common_1[(_0x5dd01a(0x1cf))]('更新对话失败！',common_1['HttpStatus']['BAD_REQUEST']);}async[_0x586dd0(0x1ca)](_0x4c73b0,_0x3ad052){const _0x556ec5=_0x586dd0,{groupId:_0x464d22}=_0x4c73b0,{id:_0x414df2}=_0x3ad052[_0x556ec5(0x1fa)],_0x1bd8e6=await this[_0x556ec5(0x1d5)][_0x556ec5(0x1ff)]({'where':{'id':_0x464d22,'userId':_0x414df2}});if(!_0x1bd8e6)throw new common_1[(_0x556ec5(0x1cf))](_0x556ec5(0x1f5),common_1[_0x556ec5(0x1d7)]['BAD_REQUEST']);const _0x123a95=await this['chatGroupEntity']['update']({'id':_0x464d22},{'isDelete':!![]});if(_0x123a95['affected'])return _0x556ec5(0x1f3);else throw new common_1[(_0x556ec5(0x1cf))](_0x556ec5(0x1ec),common_1[_0x556ec5(0x1d7)]['BAD_REQUEST']);}async['delAll'](_0x1a6cb4){const _0x1b6c07=_0x586dd0,{id:_0xf1abf9}=_0x1a6cb4[_0x1b6c07(0x1fa)],_0x3d56b2=await this[_0x1b6c07(0x1d5)]['update']({'userId':_0xf1abf9,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x3d56b2['affected'])return _0x1b6c07(0x1f3);else throw new common_1[(_0x1b6c07(0x1cf))](_0x1b6c07(0x1ec),common_1['HttpStatus'][_0x1b6c07(0x1dc)]);}async['getGroupInfoFromId'](_0x28698f){const _0x5b4f90=_0x586dd0;if(!_0x28698f||_0x28698f===0x0)return null;return await this[_0x5b4f90(0x1d5)][_0x5b4f90(0x1ff)]({'where':{'id':_0x28698f}});}async[_0x586dd0(0x1d0)](_0x4a8d0c,_0xb1707){const _0x490a4f=_0x586dd0;try{const {id:_0x233dd2}=_0xb1707[_0x490a4f(0x1fa)],_0x52a3d3={'userId':_0x233dd2,'isDelete':![]};_0x4a8d0c?_0x52a3d3['modelType']=(0x0,typeorm_2['In'])(_0x4a8d0c):_0x52a3d3[_0x490a4f(0x205)]=(0x0,typeorm_2[_0x490a4f(0x1cb)])();let _0x61f4bc=[];const _0x2d8cc0=await this[_0x490a4f(0x1d5)][_0x490a4f(0x207)]({'where':_0x52a3d3,'order':{'isSticky':_0x490a4f(0x21b),'id':_0x490a4f(0x21b)}});if(_0x2d8cc0[_0x490a4f(0x208)]){const _0xf20f9c=_0x2d8cc0[_0x490a4f(0x1c3)](_0x3443dc=>_0x3443dc['id']),_0xd619ce=await this[_0x490a4f(0x1c6)][_0x490a4f(0x1f4)](_0x490a4f(0x21f)+_0xf20f9c[_0x490a4f(0x20e)]()+_0x490a4f(0x1d9)),_0x9d68c5=new Map();_0xd619ce[_0x490a4f(0x1d3)](_0x4394ac=>{const _0x6a1e97=_0x490a4f;_0x9d68c5[_0x6a1e97(0x1e8)](_0x4394ac[_0x6a1e97(0x20b)],_0x4394ac['lastTime']);}),_0x61f4bc=_0x2d8cc0[_0x490a4f(0x1c3)](_0x3d0ba0=>{return{..._0x3d0ba0,'lastTime':_0x9d68c5['get'](_0x3d0ba0['id'])||null};});}const _0x1f1a78=await this[_0x490a4f(0x21c)][_0x490a4f(0x20a)](_0xb1707),_0x2581bb=await this['pptTaskEntity'][_0x490a4f(0x207)]({'where':{'userId':_0xb1707[_0x490a4f(0x1fa)]['id'],'type':ppt_constant_1[_0x490a4f(0x1e5)]['CREATE'],'delFlag':0x0},'order':{'updatedAt':_0x490a4f(0x21b)}}),_0x180dc1=await this[_0x490a4f(0x1e1)][_0x490a4f(0x207)]({'where':{'userId':_0xb1707[_0x490a4f(0x1fa)]['id'],'deleteFlag':0x0},'order':{'updatedAt':'DESC'}});return _0x61f4bc[_0x490a4f(0x213)](..._0x1f1a78[_0x490a4f(0x1c3)](_0x3a98a2=>{const _0x2a1e3a=_0x490a4f;return{'modelType':_0x2a1e3a(0x1e0),'id':_0x3a98a2['id'],'title':_0x3a98a2[_0x2a1e3a(0x204)]||_0x3a98a2[_0x2a1e3a(0x1c7)],'lastTime':_0x3a98a2[_0x2a1e3a(0x21d)],'userId':_0x3a98a2[_0x2a1e3a(0x1e4)],'updatedAt':_0x3a98a2['updatedAt']};})),_0x61f4bc[_0x490a4f(0x213)](..._0x2581bb[_0x490a4f(0x1c3)](_0x3bb16e=>{const _0x31d366=_0x490a4f;return{'modelType':_0x31d366(0x1d1),'id':_0x3bb16e['id'],'title':_0x3bb16e[_0x31d366(0x20f)],'lastTime':_0x3bb16e[_0x31d366(0x21d)],'userId':_0x3bb16e[_0x31d366(0x1e4)],'updatedAt':_0x3bb16e[_0x31d366(0x21d)]};})),_0x61f4bc[_0x490a4f(0x213)](..._0x180dc1[_0x490a4f(0x1c3)](_0x2d3a63=>{const _0x394e3a=_0x490a4f;return{'modelType':_0x394e3a(0x1ed),'id':_0x2d3a63['id'],'title':_0x2d3a63['name'],'lastTime':_0x2d3a63[_0x394e3a(0x21d)],'userId':_0x2d3a63[_0x394e3a(0x1e4)],'updatedAt':_0x2d3a63[_0x394e3a(0x21d)]};})),_0x61f4bc[_0x490a4f(0x1c9)]((_0x3bf247,_0x326c70)=>{const _0x108d18=_0x490a4f,_0x480cad=new Date(_0x3bf247['updatedAt'])['getTime'](),_0xe7beaa=new Date(_0x326c70[_0x108d18(0x21d)])[_0x108d18(0x1e6)]();return _0xe7beaa-_0x480cad;}),_0x61f4bc;}catch(_0x57a281){console[_0x490a4f(0x1fc)](_0x490a4f(0x1d4),_0x57a281);}}async[_0x586dd0(0x200)](_0x1847cd,_0x556617){const _0x2dc252=_0x586dd0;try{await this[_0x2dc252(0x1d5)][_0x2dc252(0x21a)]({'userId':_0x556617['user']['id'],'isDelete':![],'modelType':(0x0,typeorm_2['In'])(_0x1847cd)},{'isDelete':!![]}),await this[_0x2dc252(0x21c)][_0x2dc252(0x1dd)](_0x556617),await this[_0x2dc252(0x1c2)][_0x2dc252(0x21a)]({'userId':_0x556617['user']['id'],'type':ppt_constant_1[_0x2dc252(0x1e5)]['CREATE']},{'delFlag':0x1}),await this['docsTaskEntity'][_0x2dc252(0x21a)]({'userId':_0x556617[_0x2dc252(0x1fa)]['id']},{'deleteFlag':0x1});}catch(_0x29f55e){console[_0x2dc252(0x1fc)]('error:\x20',_0x29f55e);}}};ChatGroupService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1[_0x586dd0(0x20d)])(chatGroup_entity_1[_0x586dd0(0x1cc)])),__param(0x3,(0x0,typeorm_1[_0x586dd0(0x20d)])(pptTask_entity_1[_0x586dd0(0x201)])),__param(0x4,(0x0,typeorm_1[_0x586dd0(0x20d)])(docsTask_entity_1[_0x586dd0(0x1f8)])),__metadata(_0x586dd0(0x21e),[typeorm_2['Repository'],models_service_1[_0x586dd0(0x212)],mindTask_service_1[_0x586dd0(0x1d2)],typeorm_2['Repository'],typeorm_2[_0x586dd0(0x1c4)],typeorm_2[_0x586dd0(0x20c)]])],ChatGroupService),exports[_0x586dd0(0x202)]=ChatGroupService;