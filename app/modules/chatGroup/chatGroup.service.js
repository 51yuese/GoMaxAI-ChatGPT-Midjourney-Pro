'use strict';const _0x495a26=_0x4f4b;(function(_0x112ad2,_0x38fdb0){const _0x39d7b8=_0x4f4b,_0x2e196a=_0x112ad2();while(!![]){try{const _0x3c1456=parseInt(_0x39d7b8(0xf9))/0x1+-parseInt(_0x39d7b8(0x129))/0x2+parseInt(_0x39d7b8(0xf1))/0x3+-parseInt(_0x39d7b8(0x12f))/0x4*(parseInt(_0x39d7b8(0x10c))/0x5)+-parseInt(_0x39d7b8(0x109))/0x6*(parseInt(_0x39d7b8(0xf8))/0x7)+parseInt(_0x39d7b8(0x108))/0x8*(parseInt(_0x39d7b8(0x143))/0x9)+parseInt(_0x39d7b8(0xf7))/0xa;if(_0x3c1456===_0x38fdb0)break;else _0x2e196a['push'](_0x2e196a['shift']());}catch(_0x197cd){_0x2e196a['push'](_0x2e196a['shift']());}}}(_0x4282,0xa7c1e));function _0x4282(){const _0x378cfb=['222556KVBjVA','删除失败！','getModelByType','find','history','__param','isSticky','object','prompt','config','../mindTask/mindTask.service','../chatgpt/entity/pptTask.entity','userId','design:paramtypes','HttpException','connection','defineProperty','__esModule','EModelType',')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20','22716HROynB','./chatGroup.entity','删除成功','EPPTTaskType','docs','user','getOwnPropertyDescriptor','error:\x20','get','对话组编号和用户编号不匹配，请登录之后创建新的对话！','join','mind','../docsTask/entity/docsTask.entity','ppt','groupId','findOne','__metadata','662199JmfZtl','push','del','IsNull','query','clearhistory','16808290KvKCoP','1883ClLLlA','645435nHpOVm','clear','length','getList','updatedAt','function','pptTaskEntity','forEach','map','metadata','ModelsService','create','../models/models.service','chatGroupEntity','非法操作、您在删除一个非法资源！','3512HIKbud','23592uyooUW','name','log','60eyuBIv','PPTTaskEntity','modelsService','InjectRepository','delAll','title','DocsTaskEntity','modelType','save','affected','DESC','typeorm','CHAT','getTime','update','../../common/constants/ppt.constant','docsTaskEntity',')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20\x20\x20','mindTaskService','HttpStatus','\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20(','set','Connection','decorate','Repository','更新对话失败！','新对话','ChatGroupEntity','BAD_REQUEST','2485046dAmYtg','__decorate','CREATE','sort','lastTime','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20('];_0x4282=function(){return _0x378cfb;};return _0x4282();}function _0x4f4b(_0x340a89,_0x1480d7){const _0x4282b9=_0x4282();return _0x4f4b=function(_0x4f4bb9,_0xd04c3c){_0x4f4bb9=_0x4f4bb9-0xe3;let _0x2641de=_0x4282b9[_0x4f4bb9];return _0x2641de;},_0x4f4b(_0x340a89,_0x1480d7);}var __decorate=this&&this[_0x495a26(0x12a)]||function(_0x214c14,_0x5bfca1,_0x1daa7c,_0x369f2d){const _0x310e33=_0x495a26;var _0x196df7=arguments[_0x310e33(0xfb)],_0x2fc595=_0x196df7<0x3?_0x5bfca1:_0x369f2d===null?_0x369f2d=Object[_0x310e33(0xe6)](_0x5bfca1,_0x1daa7c):_0x369f2d,_0x2229a6;if(typeof Reflect===_0x310e33(0x136)&&typeof Reflect[_0x310e33(0x123)]==='function')_0x2fc595=Reflect[_0x310e33(0x123)](_0x214c14,_0x5bfca1,_0x1daa7c,_0x369f2d);else{for(var _0x4eab7b=_0x214c14[_0x310e33(0xfb)]-0x1;_0x4eab7b>=0x0;_0x4eab7b--)if(_0x2229a6=_0x214c14[_0x4eab7b])_0x2fc595=(_0x196df7<0x3?_0x2229a6(_0x2fc595):_0x196df7>0x3?_0x2229a6(_0x5bfca1,_0x1daa7c,_0x2fc595):_0x2229a6(_0x5bfca1,_0x1daa7c))||_0x2fc595;}return _0x196df7>0x3&&_0x2fc595&&Object[_0x310e33(0x13f)](_0x5bfca1,_0x1daa7c,_0x2fc595),_0x2fc595;},__metadata=this&&this[_0x495a26(0xf0)]||function(_0x4aad1f,_0x261709){const _0x3dcb9c=_0x495a26;if(typeof Reflect===_0x3dcb9c(0x136)&&typeof Reflect[_0x3dcb9c(0x102)]===_0x3dcb9c(0xfe))return Reflect[_0x3dcb9c(0x102)](_0x4aad1f,_0x261709);},__param=this&&this[_0x495a26(0x134)]||function(_0x127d66,_0x36338e){return function(_0x3dcaea,_0xefe39c){_0x36338e(_0x3dcaea,_0xefe39c,_0x127d66);};};Object[_0x495a26(0x13f)](exports,_0x495a26(0x140),{'value':!![]}),exports['ChatGroupService']=void 0x0;const common_1=require('@nestjs/common'),chatGroup_entity_1=require(_0x495a26(0x144)),typeorm_1=require('@nestjs/typeorm'),typeorm_2=require(_0x495a26(0x117)),models_service_1=require(_0x495a26(0x105)),model_constant_1=require('../../common/constants/model.constant'),mindTask_service_1=require(_0x495a26(0x139)),pptTask_entity_1=require(_0x495a26(0x13a)),docsTask_entity_1=require(_0x495a26(0xec)),ppt_constant_1=require(_0x495a26(0x11b));let ChatGroupService=class ChatGroupService{constructor(_0x322aca,_0x19a45f,_0x395afc,_0x364d8f,_0x15cc10,_0x2199a4){const _0x263a69=_0x495a26;this[_0x263a69(0x106)]=_0x322aca,this['modelsService']=_0x19a45f,this[_0x263a69(0x11e)]=_0x395afc,this['pptTaskEntity']=_0x364d8f,this['docsTaskEntity']=_0x15cc10,this['connection']=_0x2199a4;}async[_0x495a26(0x104)](_0xa0fe2c,_0x9dc3fc){const _0x1dfc31=_0x495a26,{title:title=_0x1dfc31(0x126),model:_0x7a617c,modelType:modelType=model_constant_1[_0x1dfc31(0x141)][_0x1dfc31(0x118)]}=_0x9dc3fc,_0x56aef2={'title':title,'modelType':modelType,'userId':_0xa0fe2c[_0x1dfc31(0xe5)]['id']},_0x1dc7ab=await this[_0x1dfc31(0x10e)][_0x1dfc31(0x131)](modelType,_0x7a617c);_0x56aef2[_0x1dfc31(0x138)]=JSON['stringify'](_0x1dc7ab);const _0x2b5459=await this[_0x1dfc31(0x106)][_0x1dfc31(0x114)](_0x56aef2);return _0x2b5459;}async[_0x495a26(0xe8)](_0x23dc4b,_0x3c3476){const _0x14ce14=_0x495a26;try{const _0x383a9e={'userId':_0x3c3476['user']['id'],'id':_0x23dc4b,'isDelete':![]},_0x5348dc=await this[_0x14ce14(0x106)][_0x14ce14(0xef)]({'where':_0x383a9e});return _0x5348dc;}catch(_0x4e2efd){console[_0x14ce14(0x10b)]('error:\x20',_0x4e2efd);}}async[_0x495a26(0xf5)](_0x1cd3d0,_0x4dab4a){const _0x10e880=_0x495a26;try{const {id:_0x193fe9}=_0x4dab4a['user'],_0x56004f={'userId':_0x193fe9,'isDelete':![]};_0x1cd3d0?_0x56004f[_0x10e880(0x113)]=_0x1cd3d0:_0x56004f[_0x10e880(0x113)]=(0x0,typeorm_2['IsNull'])();const _0x322e8d=await this[_0x10e880(0x106)]['find']({'where':_0x56004f,'order':{'isSticky':_0x10e880(0x116),'id':_0x10e880(0x116)}});if(!_0x322e8d[_0x10e880(0xfb)])return _0x322e8d;const _0x589871=_0x322e8d['map'](_0x59c3e3=>_0x59c3e3['id']),_0x1fb24c=await this['connection'][_0x10e880(0xf5)](_0x10e880(0x120)+_0x589871[_0x10e880(0xea)]()+_0x10e880(0x142)),_0xca4492=new Map();_0x1fb24c[_0x10e880(0x100)](_0x12c666=>{const _0x46e94b=_0x10e880;_0xca4492[_0x46e94b(0x121)](_0x12c666[_0x46e94b(0xee)],_0x12c666[_0x46e94b(0x12d)]);});const _0xf973aa=_0x322e8d[_0x10e880(0x101)](_0x8ce78c=>{const _0x1f8b5f=_0x10e880;return{..._0x8ce78c,'lastTime':_0xca4492[_0x1f8b5f(0xe8)](_0x8ce78c['id'])||null};});return _0xf973aa;}catch(_0x31933b){console[_0x10e880(0x10b)]('error:\x20',_0x31933b);}}async[_0x495a26(0x11a)](_0x45f2fd,_0x364492){const _0x5346a3=_0x495a26,{title:_0x16d7af,isSticky:_0x4ddefd,groupId:_0x18f205,config:_0x2fb60e,appType:_0x196db0}=_0x45f2fd,{id:_0x2a526f}=_0x364492['user'],_0x55a2d3=await this['chatGroupEntity'][_0x5346a3(0xef)]({'where':{'id':_0x18f205,'userId':_0x2a526f}});if(!_0x55a2d3)throw new common_1['HttpException'](_0x5346a3(0xe9),common_1[_0x5346a3(0x11f)]['BAD_REQUEST']);const _0x407a52={};_0x16d7af&&(_0x407a52[_0x5346a3(0x111)]=_0x16d7af),typeof _0x4ddefd!=='undefined'&&(_0x407a52[_0x5346a3(0x135)]=_0x4ddefd),_0x2fb60e&&(_0x407a52[_0x5346a3(0x138)]=_0x2fb60e);const _0xcd960e=await this[_0x5346a3(0x106)][_0x5346a3(0x11a)]({'id':_0x18f205},_0x407a52);if(_0xcd960e['affected'])return!![];else throw new common_1['HttpException'](_0x5346a3(0x125),common_1['HttpStatus'][_0x5346a3(0x128)]);}async[_0x495a26(0xf3)](_0x1a26c3,_0x21e52c){const _0x3a1aa6=_0x495a26,{groupId:_0x576e76}=_0x1a26c3,{id:_0x301482}=_0x21e52c[_0x3a1aa6(0xe5)],_0x1c9bbb=await this['chatGroupEntity'][_0x3a1aa6(0xef)]({'where':{'id':_0x576e76,'userId':_0x301482}});if(!_0x1c9bbb)throw new common_1[(_0x3a1aa6(0x13d))](_0x3a1aa6(0x107),common_1[_0x3a1aa6(0x11f)]['BAD_REQUEST']);const _0x3d8b02=await this[_0x3a1aa6(0x106)]['update']({'id':_0x576e76},{'isDelete':!![]});if(_0x3d8b02['affected'])return'删除成功';else throw new common_1[(_0x3a1aa6(0x13d))](_0x3a1aa6(0x130),common_1[_0x3a1aa6(0x11f)][_0x3a1aa6(0x128)]);}async[_0x495a26(0x110)](_0x5638e6){const _0x19f026=_0x495a26,{id:_0x17d6bd}=_0x5638e6[_0x19f026(0xe5)],_0x349bb2=await this['chatGroupEntity'][_0x19f026(0x11a)]({'userId':_0x17d6bd,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x349bb2[_0x19f026(0x115)])return _0x19f026(0x145);else throw new common_1[(_0x19f026(0x13d))](_0x19f026(0x130),common_1[_0x19f026(0x11f)][_0x19f026(0x128)]);}async['getGroupInfoFromId'](_0x28ead3){const _0xd5435a=_0x495a26;if(!_0x28ead3||_0x28ead3===0x0)return null;return await this[_0xd5435a(0x106)][_0xd5435a(0xef)]({'where':{'id':_0x28ead3}});}async[_0x495a26(0x133)](_0xbd518,_0x5b0f70){const _0x33d6f0=_0x495a26;try{const {id:_0x270db5}=_0x5b0f70[_0x33d6f0(0xe5)],_0x329c44={'userId':_0x270db5,'isDelete':![]};_0xbd518?_0x329c44[_0x33d6f0(0x113)]=(0x0,typeorm_2['In'])(_0xbd518):_0x329c44[_0x33d6f0(0x113)]=(0x0,typeorm_2[_0x33d6f0(0xf4)])();let _0x588cd5=[];const _0x4e0900=await this[_0x33d6f0(0x106)]['find']({'where':_0x329c44,'order':{'isSticky':'DESC','id':_0x33d6f0(0x116)}});if(_0x4e0900[_0x33d6f0(0xfb)]){const _0x4c2103=_0x4e0900['map'](_0x17a0e1=>_0x17a0e1['id']),_0x523b3c=await this[_0x33d6f0(0x13e)][_0x33d6f0(0xf5)](_0x33d6f0(0x12e)+_0x4c2103['join']()+_0x33d6f0(0x11d)),_0x48e5d3=new Map();_0x523b3c['forEach'](_0x3f8900=>{const _0x5db059=_0x33d6f0;_0x48e5d3[_0x5db059(0x121)](_0x3f8900[_0x5db059(0xee)],_0x3f8900[_0x5db059(0x12d)]);}),_0x588cd5=_0x4e0900[_0x33d6f0(0x101)](_0x3259cc=>{const _0x21ac23=_0x33d6f0;return{..._0x3259cc,'lastTime':_0x48e5d3[_0x21ac23(0xe8)](_0x3259cc['id'])||null};});}const _0x298350=await this['mindTaskService'][_0x33d6f0(0xfc)](_0x5b0f70),_0x258a58=await this['pptTaskEntity'][_0x33d6f0(0x132)]({'where':{'userId':_0x5b0f70[_0x33d6f0(0xe5)]['id'],'type':ppt_constant_1[_0x33d6f0(0xe3)][_0x33d6f0(0x12b)],'delFlag':0x0},'order':{'updatedAt':'DESC'}}),_0x2666da=await this['docsTaskEntity'][_0x33d6f0(0x132)]({'where':{'userId':_0x5b0f70['user']['id'],'deleteFlag':0x0},'order':{'updatedAt':'DESC'}});return _0x588cd5[_0x33d6f0(0xf2)](..._0x298350[_0x33d6f0(0x101)](_0xad96c5=>{const _0x49115e=_0x33d6f0;return{'modelType':_0x49115e(0xeb),'id':_0xad96c5['id'],'title':_0xad96c5['name']||_0xad96c5[_0x49115e(0x137)],'lastTime':_0xad96c5[_0x49115e(0xfd)],'userId':_0xad96c5[_0x49115e(0x13b)],'updatedAt':_0xad96c5[_0x49115e(0xfd)]};})),_0x588cd5[_0x33d6f0(0xf2)](..._0x258a58['map'](_0x51eb53=>{const _0xb48a46=_0x33d6f0;return{'modelType':_0xb48a46(0xed),'id':_0x51eb53['id'],'title':_0x51eb53[_0xb48a46(0x111)],'lastTime':_0x51eb53[_0xb48a46(0xfd)],'userId':_0x51eb53[_0xb48a46(0x13b)],'updatedAt':_0x51eb53[_0xb48a46(0xfd)]};})),_0x588cd5[_0x33d6f0(0xf2)](..._0x2666da['map'](_0x205d02=>{const _0x186a1d=_0x33d6f0;return{'modelType':_0x186a1d(0xe4),'id':_0x205d02['id'],'title':_0x205d02[_0x186a1d(0x10a)],'lastTime':_0x205d02[_0x186a1d(0xfd)],'userId':_0x205d02['userId'],'updatedAt':_0x205d02['updatedAt']};})),_0x588cd5[_0x33d6f0(0x12c)]((_0x5e7259,_0x2aaff0)=>{const _0x30a38f=_0x33d6f0,_0x41a35e=new Date(_0x5e7259[_0x30a38f(0xfd)])['getTime'](),_0x422ebb=new Date(_0x2aaff0[_0x30a38f(0xfd)])[_0x30a38f(0x119)]();return _0x422ebb-_0x41a35e;}),_0x588cd5;}catch(_0x164d93){console[_0x33d6f0(0x10b)](_0x33d6f0(0xe7),_0x164d93);}}async[_0x495a26(0xf6)](_0x5f490e,_0x248c29){const _0x281e52=_0x495a26;try{await this[_0x281e52(0x106)]['update']({'userId':_0x248c29[_0x281e52(0xe5)]['id'],'isDelete':![],'modelType':(0x0,typeorm_2['In'])(_0x5f490e)},{'isDelete':!![]}),await this[_0x281e52(0x11e)][_0x281e52(0xfa)](_0x248c29),await this[_0x281e52(0xff)][_0x281e52(0x11a)]({'userId':_0x248c29[_0x281e52(0xe5)]['id'],'type':ppt_constant_1['EPPTTaskType'][_0x281e52(0x12b)]},{'delFlag':0x1}),await this[_0x281e52(0x11c)]['update']({'userId':_0x248c29[_0x281e52(0xe5)]['id']},{'deleteFlag':0x1});}catch(_0x2ad611){console[_0x281e52(0x10b)](_0x281e52(0xe7),_0x2ad611);}}};ChatGroupService=__decorate([(0x0,common_1['Injectable'])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1[_0x495a26(0x127)])),__param(0x3,(0x0,typeorm_1[_0x495a26(0x10f)])(pptTask_entity_1[_0x495a26(0x10d)])),__param(0x4,(0x0,typeorm_1['InjectRepository'])(docsTask_entity_1[_0x495a26(0x112)])),__metadata(_0x495a26(0x13c),[typeorm_2[_0x495a26(0x124)],models_service_1[_0x495a26(0x103)],mindTask_service_1['MindTaskService'],typeorm_2[_0x495a26(0x124)],typeorm_2[_0x495a26(0x124)],typeorm_2[_0x495a26(0x122)]])],ChatGroupService),exports['ChatGroupService']=ChatGroupService;