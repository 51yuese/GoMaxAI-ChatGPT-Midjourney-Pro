'use strict';const _0x2c53f4=_0x2bbb;function _0x2bbb(_0x1d93ad,_0x59ead9){const _0x3d8541=_0x3d85();return _0x2bbb=function(_0x2bbb28,_0x116666){_0x2bbb28=_0x2bbb28-0x140;let _0x5cb44b=_0x3d8541[_0x2bbb28];return _0x5cb44b;},_0x2bbb(_0x1d93ad,_0x59ead9);}(function(_0x38e3c2,_0x50c371){const _0x48ecdc=_0x2bbb,_0x3abc5a=_0x38e3c2();while(!![]){try{const _0x1ca5a4=-parseInt(_0x48ecdc(0x181))/0x1*(parseInt(_0x48ecdc(0x160))/0x2)+-parseInt(_0x48ecdc(0x141))/0x3+-parseInt(_0x48ecdc(0x166))/0x4*(parseInt(_0x48ecdc(0x159))/0x5)+parseInt(_0x48ecdc(0x158))/0x6+parseInt(_0x48ecdc(0x163))/0x7*(parseInt(_0x48ecdc(0x161))/0x8)+-parseInt(_0x48ecdc(0x180))/0x9+parseInt(_0x48ecdc(0x145))/0xa;if(_0x1ca5a4===_0x50c371)break;else _0x3abc5a['push'](_0x3abc5a['shift']());}catch(_0x3079d3){_0x3abc5a['push'](_0x3abc5a['shift']());}}}(_0x3d85,0xcf149));var __decorate=this&&this['__decorate']||function(_0x27619e,_0x583483,_0x55b88a,_0x1562f0){const _0x2ab4dc=_0x2bbb;var _0x1ff192=arguments['length'],_0x2b34df=_0x1ff192<0x3?_0x583483:_0x1562f0===null?_0x1562f0=Object[_0x2ab4dc(0x147)](_0x583483,_0x55b88a):_0x1562f0,_0x15f84e;if(typeof Reflect==='object'&&typeof Reflect[_0x2ab4dc(0x14c)]==='function')_0x2b34df=Reflect[_0x2ab4dc(0x14c)](_0x27619e,_0x583483,_0x55b88a,_0x1562f0);else{for(var _0x113a6a=_0x27619e[_0x2ab4dc(0x17a)]-0x1;_0x113a6a>=0x0;_0x113a6a--)if(_0x15f84e=_0x27619e[_0x113a6a])_0x2b34df=(_0x1ff192<0x3?_0x15f84e(_0x2b34df):_0x1ff192>0x3?_0x15f84e(_0x583483,_0x55b88a,_0x2b34df):_0x15f84e(_0x583483,_0x55b88a))||_0x2b34df;}return _0x1ff192>0x3&&_0x2b34df&&Object[_0x2ab4dc(0x170)](_0x583483,_0x55b88a,_0x2b34df),_0x2b34df;},__metadata=this&&this[_0x2c53f4(0x15e)]||function(_0x127a54,_0x9179dc){const _0x37b90c=_0x2c53f4;if(typeof Reflect===_0x37b90c(0x17d)&&typeof Reflect['metadata']===_0x37b90c(0x175))return Reflect['metadata'](_0x127a54,_0x9179dc);},__param=this&&this[_0x2c53f4(0x15f)]||function(_0x2c8263,_0x2e8f6d){return function(_0x499ba5,_0x566db4){_0x2e8f6d(_0x499ba5,_0x566db4,_0x2c8263);};};function _0x3d85(){const _0x2ac849=['2732Tqfajn','5583464dwqSRY','log','7CYbbFD','create','HttpStatus','564VCQtoT','typeorm','IsNull','lastTime','chatGroupEntity','getGroupInfoFromId','error:\x20','BAD_REQUEST','save','新对话','defineProperty','modelType','非法操作、您在删除一个非法资源！','../../common/constants/model.constant','query','function','config','@nestjs/typeorm','删除失败！','connection','length','user','set','object','update','ChatGroupService','6644133lpknLE','449BjjHmJ','Connection','forEach','4532859rxlIbe','map','join','更新对话失败！','21721310agDifq','groupId','getOwnPropertyDescriptor','design:paramtypes','getModelByType','DESC','get','decorate','对话组编号和用户编号不匹配，请登录之后创建新的对话！','modelsService','delAll','ChatGroupEntity','@nestjs/common','Injectable','HttpException',')\x20GROUP\x20BY\x20groupId\x0a\x20\x20\x20\x20\x20\x20','findOne','删除成功','isSticky','6108234SIdHzC','6290huRfHE','find','affected','undefined','title','__metadata','__param'];_0x3d85=function(){return _0x2ac849;};return _0x3d85();}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x2c53f4(0x17f)]=void 0x0;const common_1=require(_0x2c53f4(0x151)),chatGroup_entity_1=require('./chatGroup.entity'),typeorm_1=require(_0x2c53f4(0x177)),typeorm_2=require(_0x2c53f4(0x167)),models_service_1=require('../models/models.service'),model_constant_1=require(_0x2c53f4(0x173));let ChatGroupService=class ChatGroupService{constructor(_0x43ff8a,_0x1dbbbd,_0xd250cb){const _0x440655=_0x2c53f4;this[_0x440655(0x16a)]=_0x43ff8a,this['modelsService']=_0x1dbbbd,this[_0x440655(0x179)]=_0xd250cb;}async[_0x2c53f4(0x164)](_0x114d1e,_0x8258e7){const _0x29370d=_0x2c53f4,{title:title=_0x29370d(0x16f),model:_0x3911f8,modelType:modelType=model_constant_1['EModelType']['CHAT']}=_0x8258e7,_0x137cd7={'title':title,'modelType':modelType,'userId':_0x114d1e['user']['id']},_0x51fbf4=await this[_0x29370d(0x14e)][_0x29370d(0x149)](modelType,_0x3911f8);_0x137cd7[_0x29370d(0x176)]=JSON['stringify'](_0x51fbf4);const _0xdb3baf=await this['chatGroupEntity'][_0x29370d(0x16e)](_0x137cd7);return _0xdb3baf;}async['query'](_0x471c6f,_0x48d019){const _0x2e071a=_0x2c53f4;try{const {id:_0x56e264}=_0x48d019['user'],_0x3ad120={'userId':_0x56e264,'isDelete':![]};_0x471c6f?_0x3ad120[_0x2e071a(0x171)]=_0x471c6f:_0x3ad120[_0x2e071a(0x171)]=(0x0,typeorm_2[_0x2e071a(0x168)])();const _0x415f0c=await this[_0x2e071a(0x16a)][_0x2e071a(0x15a)]({'where':_0x3ad120,'order':{'isSticky':_0x2e071a(0x14a),'id':_0x2e071a(0x14a)}});if(!_0x415f0c['length'])return _0x415f0c;const _0x497e4b=_0x415f0c[_0x2e071a(0x142)](_0x10b3ea=>_0x10b3ea['id']),_0x4a9d62=await this[_0x2e071a(0x179)][_0x2e071a(0x174)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x20groupId,\x20MAX(createdAt)\x20AS\x20lastTime\x20\x20FROM\x20chatlog\x20WHERE\x20groupId\x20IN\x20('+_0x497e4b[_0x2e071a(0x143)]()+_0x2e071a(0x154)),_0x2b56bd=new Map();_0x4a9d62[_0x2e071a(0x140)](_0x44d9ed=>{const _0x4dfb7c=_0x2e071a;_0x2b56bd[_0x4dfb7c(0x17c)](_0x44d9ed[_0x4dfb7c(0x146)],_0x44d9ed[_0x4dfb7c(0x169)]);});const _0xc7c56=_0x415f0c[_0x2e071a(0x142)](_0x13e42e=>{const _0xd0bb81=_0x2e071a;return{..._0x13e42e,'lastTime':_0x2b56bd[_0xd0bb81(0x14b)](_0x13e42e['id'])||null};});return _0xc7c56;}catch(_0x3aea56){console[_0x2e071a(0x162)](_0x2e071a(0x16c),_0x3aea56);}}async[_0x2c53f4(0x17e)](_0x14fc8d,_0x6014cf){const _0x41cda6=_0x2c53f4,{title:_0x54a78e,isSticky:_0xb26c0b,groupId:_0x3574bc,config:_0x5d8b1a,appType:_0x557c84}=_0x14fc8d,{id:_0x18e100}=_0x6014cf[_0x41cda6(0x17b)],_0x5b383d=await this[_0x41cda6(0x16a)]['findOne']({'where':{'id':_0x3574bc,'userId':_0x18e100}});if(!_0x5b383d)throw new common_1[(_0x41cda6(0x153))](_0x41cda6(0x14d),common_1[_0x41cda6(0x165)]['BAD_REQUEST']);const _0x7410a4={};_0x54a78e&&(_0x7410a4[_0x41cda6(0x15d)]=_0x54a78e),typeof _0xb26c0b!==_0x41cda6(0x15c)&&(_0x7410a4[_0x41cda6(0x157)]=_0xb26c0b),_0x5d8b1a&&(_0x7410a4[_0x41cda6(0x176)]=_0x5d8b1a);const _0xb7bd8e=await this['chatGroupEntity']['update']({'id':_0x3574bc},_0x7410a4);if(_0xb7bd8e[_0x41cda6(0x15b)])return!![];else throw new common_1[(_0x41cda6(0x153))](_0x41cda6(0x144),common_1[_0x41cda6(0x165)]['BAD_REQUEST']);}async['del'](_0x24cb57,_0x5b0916){const _0x3520a4=_0x2c53f4,{groupId:_0xfd2d2e}=_0x24cb57,{id:_0x17ce27}=_0x5b0916[_0x3520a4(0x17b)],_0x1cfd34=await this[_0x3520a4(0x16a)][_0x3520a4(0x155)]({'where':{'id':_0xfd2d2e,'userId':_0x17ce27}});if(!_0x1cfd34)throw new common_1['HttpException'](_0x3520a4(0x172),common_1[_0x3520a4(0x165)][_0x3520a4(0x16d)]);const _0x27f4f3=await this[_0x3520a4(0x16a)][_0x3520a4(0x17e)]({'id':_0xfd2d2e},{'isDelete':!![]});if(_0x27f4f3[_0x3520a4(0x15b)])return _0x3520a4(0x156);else throw new common_1[(_0x3520a4(0x153))]('删除失败！',common_1[_0x3520a4(0x165)][_0x3520a4(0x16d)]);}async[_0x2c53f4(0x14f)](_0x1813e2){const _0x25e6a8=_0x2c53f4,{id:_0x25e16a}=_0x1813e2['user'],_0x9ea0d0=await this['chatGroupEntity'][_0x25e6a8(0x17e)]({'userId':_0x25e16a,'isSticky':![],'isDelete':![]},{'isDelete':!![]});if(_0x9ea0d0[_0x25e6a8(0x15b)])return _0x25e6a8(0x156);else throw new common_1[(_0x25e6a8(0x153))](_0x25e6a8(0x178),common_1['HttpStatus'][_0x25e6a8(0x16d)]);}async[_0x2c53f4(0x16b)](_0x478838){const _0x318ede=_0x2c53f4;if(!_0x478838||_0x478838===0x0)return null;return await this['chatGroupEntity'][_0x318ede(0x155)]({'where':{'id':_0x478838}});}};ChatGroupService=__decorate([(0x0,common_1[_0x2c53f4(0x152)])(),__param(0x0,(0x0,typeorm_1['InjectRepository'])(chatGroup_entity_1[_0x2c53f4(0x150)])),__metadata(_0x2c53f4(0x148),[typeorm_2['Repository'],models_service_1['ModelsService'],typeorm_2[_0x2c53f4(0x182)]])],ChatGroupService),exports['ChatGroupService']=ChatGroupService;