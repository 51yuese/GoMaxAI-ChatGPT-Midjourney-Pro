'use strict';const _0x3f1893=_0x34d3;(function(_0x1b9c86,_0x5221ad){const _0x24a3f3=_0x34d3,_0x22ea95=_0x1b9c86();while(!![]){try{const _0x1adb53=parseInt(_0x24a3f3(0xfe))/0x1+-parseInt(_0x24a3f3(0x112))/0x2+-parseInt(_0x24a3f3(0x109))/0x3+-parseInt(_0x24a3f3(0x10e))/0x4*(parseInt(_0x24a3f3(0x127))/0x5)+-parseInt(_0x24a3f3(0x131))/0x6+-parseInt(_0x24a3f3(0x10b))/0x7*(parseInt(_0x24a3f3(0xff))/0x8)+-parseInt(_0x24a3f3(0x103))/0x9*(-parseInt(_0x24a3f3(0x113))/0xa);if(_0x1adb53===_0x5221ad)break;else _0x22ea95['push'](_0x22ea95['shift']());}catch(_0x56f7e7){_0x22ea95['push'](_0x22ea95['shift']());}}}(_0x282e,0x84b53));function _0x34d3(_0x441cc1,_0x122417){const _0x282ed9=_0x282e();return _0x34d3=function(_0x34d3c8,_0x2dad34){_0x34d3c8=_0x34d3c8-0xfd;let _0x537dc4=_0x282ed9[_0x34d3c8];return _0x537dc4;},_0x34d3(_0x441cc1,_0x122417);}var __decorate=this&&this[_0x3f1893(0x10d)]||function(_0x3fc55a,_0x348532,_0x460bed,_0x103b95){const _0x3e863f=_0x3f1893;var _0x586894=arguments[_0x3e863f(0x126)],_0x3e5ce5=_0x586894<0x3?_0x348532:_0x103b95===null?_0x103b95=Object['getOwnPropertyDescriptor'](_0x348532,_0x460bed):_0x103b95,_0x5f5b7f;if(typeof Reflect===_0x3e863f(0x110)&&typeof Reflect[_0x3e863f(0x121)]===_0x3e863f(0x136))_0x3e5ce5=Reflect[_0x3e863f(0x121)](_0x3fc55a,_0x348532,_0x460bed,_0x103b95);else{for(var _0x4bc093=_0x3fc55a['length']-0x1;_0x4bc093>=0x0;_0x4bc093--)if(_0x5f5b7f=_0x3fc55a[_0x4bc093])_0x3e5ce5=(_0x586894<0x3?_0x5f5b7f(_0x3e5ce5):_0x586894>0x3?_0x5f5b7f(_0x348532,_0x460bed,_0x3e5ce5):_0x5f5b7f(_0x348532,_0x460bed))||_0x3e5ce5;}return _0x586894>0x3&&_0x3e5ce5&&Object[_0x3e863f(0x12c)](_0x348532,_0x460bed,_0x3e5ce5),_0x3e5ce5;},__metadata=this&&this['__metadata']||function(_0x20bacc,_0x2311eb){const _0x4c9d8b=_0x3f1893;if(typeof Reflect===_0x4c9d8b(0x110)&&typeof Reflect[_0x4c9d8b(0x10c)]===_0x4c9d8b(0x136))return Reflect[_0x4c9d8b(0x10c)](_0x20bacc,_0x2311eb);};function _0x282e(){const _0x5d495c=['AuthGuard','decorate','__esModule','nestjs-cls','JWT_SECRET','redisCacheService','length','63645lrJHWB','fingerprint','log','design:paramtypes','user','defineProperty','../../modules/redisCache/redisCache.service','@nestjs/passport','canActivate','err:\x20','3578310IDnPGT','authorization','validateToken','Injectable','visitor','function','AuthService','UNAUTHORIZED','HttpStatus','verify','875606RlPFxJ','4255640wmWpKi','role','RedisCacheService','ModuleRef','27081378QZZuzf','JwtAuthGuard','jsonwebtoken','extractToken','亲爱的用户,请登录后继续操作,我们正在等您的到来！','saasId','2390139OWogQb','@nestjs/core','7INsLmJ','metadata','__decorate','320ToOOcO','@nestjs/common','object','slice','795408MvcGdd','10waNexq','headers','Bearer','split','moduleRef','ClsService','HttpException','clsService','authService','checkTokenAuth','getRequest','../../modules/auth/auth.service','handleRequest'];_0x282e=function(){return _0x5d495c;};return _0x282e();}Object[_0x3f1893(0x12c)](exports,_0x3f1893(0x122),{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const redisCache_service_1=require(_0x3f1893(0x12d)),common_1=require(_0x3f1893(0x10f)),passport_1=require(_0x3f1893(0x12e)),jwt=require(_0x3f1893(0x105)),core_1=require(_0x3f1893(0x10a)),auth_service_1=require(_0x3f1893(0x11e)),nestjs_cls_1=require(_0x3f1893(0x123)),utils_1=require('../utils');let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x3f1893(0x120)])('jwt'){constructor(_0x1b90cf,_0x3c8034,_0x164bf2,_0x434e24){const _0x39c869=_0x3f1893;super(),this[_0x39c869(0x125)]=_0x1b90cf,this[_0x39c869(0x117)]=_0x3c8034,this[_0x39c869(0x11a)]=_0x164bf2,this[_0x39c869(0x11b)]=_0x434e24;}async[_0x3f1893(0x12f)](_0x46088c){const _0x405bf7=_0x3f1893;!this['redisCacheService']&&(this[_0x405bf7(0x125)]=this[_0x405bf7(0x117)]['get'](redisCache_service_1[_0x405bf7(0x101)],{'strict':![]}));const _0x50a125=_0x46088c['switchToHttp']()[_0x405bf7(0x11d)](),_0x203e49=this[_0x405bf7(0x106)](_0x50a125);_0x50a125[_0x405bf7(0x12b)]=this[_0x405bf7(0x133)](_0x203e49);if(_0x50a125[_0x405bf7(0x12b)][_0x405bf7(0x100)]===_0x405bf7(0x135))throw new common_1[(_0x405bf7(0x119))](_0x405bf7(0x107),common_1[_0x405bf7(0x139)][_0x405bf7(0x138)]);return await this[_0x405bf7(0x125)][_0x405bf7(0x11c)](_0x203e49,_0x50a125),!![];}[_0x3f1893(0x106)](_0x31c353){const _0x5e63f0=_0x3f1893;if(!_0x31c353[_0x5e63f0(0x114)][_0x5e63f0(0x132)]){if(_0x31c353[_0x5e63f0(0x114)][_0x5e63f0(0x128)]){let _0x583c79=_0x31c353[_0x5e63f0(0x114)][_0x5e63f0(0x128)];return _0x583c79>0x7fffffff&&(_0x583c79=_0x583c79['toString']()[_0x5e63f0(0x111)](-0x9),_0x583c79=Number(String(Number(_0x583c79))),console[_0x5e63f0(0x129)]('id:\x20',_0x583c79)),this[_0x5e63f0(0x11b)]['createTokenFromFingerprint'](_0x583c79);}return null;}const _0x274181=_0x31c353[_0x5e63f0(0x114)][_0x5e63f0(0x132)][_0x5e63f0(0x116)]('\x20');if(_0x274181[_0x5e63f0(0x126)]!==0x2||_0x274181[0x0]!==_0x5e63f0(0x115))return null;return _0x274181[0x1];}[_0x3f1893(0x133)](_0x31c04b){const _0x5378d1=_0x3f1893;try{const _0xd57b68=(0x0,utils_1['getReqSaasId'])(this[_0x5378d1(0x11a)]),_0x478736=jwt[_0x5378d1(0xfd)](_0x31c04b,process['env'][_0x5378d1(0x124)]);if(_0x478736?.[_0x5378d1(0x108)]!==_0xd57b68)throw new common_1[(_0x5378d1(0x119))]('亲爱的用户,请登录后继续操作,我们正在等您的到来！',common_1[_0x5378d1(0x139)][_0x5378d1(0x138)]);return _0x478736;}catch(_0x43f34e){throw new common_1[(_0x5378d1(0x119))](_0x5378d1(0x107),common_1['HttpStatus'][_0x5378d1(0x138)]);}}[_0x3f1893(0x11f)](_0x57243f,_0x3d4824,_0x3de376){const _0x122cbb=_0x3f1893;if(_0x57243f||!_0x3d4824){console[_0x122cbb(0x129)](_0x122cbb(0x130),_0x57243f);throw _0x57243f||new common_1['UnauthorizedException']();}return _0x3d4824;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x3f1893(0x134)])(),__metadata(_0x3f1893(0x12a),[redisCache_service_1['RedisCacheService'],core_1[_0x3f1893(0x102)],nestjs_cls_1[_0x3f1893(0x118)],auth_service_1[_0x3f1893(0x137)]])],JwtAuthGuard),exports[_0x3f1893(0x104)]=JwtAuthGuard;