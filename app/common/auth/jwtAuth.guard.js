'use strict';function _0x26aa(_0x512e03,_0x114279){const _0x282cac=_0x282c();return _0x26aa=function(_0x26aaeb,_0x5f00db){_0x26aaeb=_0x26aaeb-0x7c;let _0x3e0110=_0x282cac[_0x26aaeb];return _0x3e0110;},_0x26aa(_0x512e03,_0x114279);}const _0x41147d=_0x26aa;(function(_0x52cb1a,_0x44baa0){const _0x83eac7=_0x26aa,_0x116fec=_0x52cb1a();while(!![]){try{const _0x18e0d3=-parseInt(_0x83eac7(0x9d))/0x1+-parseInt(_0x83eac7(0x9f))/0x2+-parseInt(_0x83eac7(0xb2))/0x3+-parseInt(_0x83eac7(0xa9))/0x4*(-parseInt(_0x83eac7(0x91))/0x5)+parseInt(_0x83eac7(0x81))/0x6+-parseInt(_0x83eac7(0x84))/0x7*(parseInt(_0x83eac7(0xa7))/0x8)+parseInt(_0x83eac7(0x86))/0x9*(parseInt(_0x83eac7(0xb7))/0xa);if(_0x18e0d3===_0x44baa0)break;else _0x116fec['push'](_0x116fec['shift']());}catch(_0x414de2){_0x116fec['push'](_0x116fec['shift']());}}}(_0x282c,0x1bb5a));var __decorate=this&&this[_0x41147d(0x8d)]||function(_0x38ec66,_0x381512,_0x2935ff,_0x488327){const _0x15238e=_0x41147d;var _0x30e9c9=arguments[_0x15238e(0x9b)],_0x2f6829=_0x30e9c9<0x3?_0x381512:_0x488327===null?_0x488327=Object['getOwnPropertyDescriptor'](_0x381512,_0x2935ff):_0x488327,_0x4d56b6;if(typeof Reflect===_0x15238e(0xa0)&&typeof Reflect[_0x15238e(0xb4)]===_0x15238e(0xae))_0x2f6829=Reflect['decorate'](_0x38ec66,_0x381512,_0x2935ff,_0x488327);else{for(var _0x2d0214=_0x38ec66[_0x15238e(0x9b)]-0x1;_0x2d0214>=0x0;_0x2d0214--)if(_0x4d56b6=_0x38ec66[_0x2d0214])_0x2f6829=(_0x30e9c9<0x3?_0x4d56b6(_0x2f6829):_0x30e9c9>0x3?_0x4d56b6(_0x381512,_0x2935ff,_0x2f6829):_0x4d56b6(_0x381512,_0x2935ff))||_0x2f6829;}return _0x30e9c9>0x3&&_0x2f6829&&Object[_0x15238e(0x8a)](_0x381512,_0x2935ff,_0x2f6829),_0x2f6829;},__metadata=this&&this[_0x41147d(0x9e)]||function(_0x1da894,_0x22ff07){const _0xd23559=_0x41147d;if(typeof Reflect===_0xd23559(0xa0)&&typeof Reflect[_0xd23559(0xa3)]===_0xd23559(0xae))return Reflect[_0xd23559(0xa3)](_0x1da894,_0x22ff07);};Object[_0x41147d(0x8a)](exports,_0x41147d(0x98),{'value':!![]}),exports[_0x41147d(0x85)]=void 0x0;const redisCache_service_1=require(_0x41147d(0xb3)),common_1=require(_0x41147d(0x83)),passport_1=require('@nestjs/passport'),jwt=require(_0x41147d(0x80)),core_1=require('@nestjs/core'),auth_service_1=require('../../modules/auth/auth.service'),nestjs_cls_1=require(_0x41147d(0x99)),utils_1=require(_0x41147d(0x7e));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x41147d(0x94)])(_0x41147d(0xa4)){constructor(_0x49bbca,_0x5211c5,_0x1b6228,_0x4505c9){const _0x598889=_0x41147d;super(),this['redisCacheService']=_0x49bbca,this['moduleRef']=_0x5211c5,this['clsService']=_0x1b6228,this[_0x598889(0x8c)]=_0x4505c9;}async[_0x41147d(0xb6)](_0x512c2b){const _0xff04a3=_0x41147d;!this[_0xff04a3(0x96)]&&(this[_0xff04a3(0x96)]=this[_0xff04a3(0x97)][_0xff04a3(0xaf)](redisCache_service_1[_0xff04a3(0xad)],{'strict':![]}));const _0x35aff5=_0x512c2b[_0xff04a3(0x9c)]()[_0xff04a3(0xb1)](),_0x47c631=this[_0xff04a3(0x8e)](_0x35aff5);_0x35aff5[_0xff04a3(0x7f)]=this[_0xff04a3(0x88)](_0x47c631);if(_0x35aff5[_0xff04a3(0x7f)]['role']===_0xff04a3(0xa2))throw new common_1[(_0xff04a3(0xab))](_0xff04a3(0xa8),common_1[_0xff04a3(0xa6)][_0xff04a3(0x93)]);return await this[_0xff04a3(0x96)]['checkTokenAuth'](_0x47c631,_0x35aff5),!![];}[_0x41147d(0x8e)](_0x12b3e7){const _0x337ccf=_0x41147d;if(!_0x12b3e7[_0x337ccf(0x8f)]['authorization']){if(_0x12b3e7[_0x337ccf(0x8f)][_0x337ccf(0x89)]){let _0xaeeb91=_0x12b3e7['headers'][_0x337ccf(0x89)];return _0xaeeb91>0x7fffffff&&(_0xaeeb91=_0xaeeb91[_0x337ccf(0x82)]()[_0x337ccf(0xa1)](-0x9),_0xaeeb91=Number(String(Number(_0xaeeb91))),console['log'](_0x337ccf(0xb5),_0xaeeb91)),this['authService']['createTokenFromFingerprint'](_0xaeeb91);}return null;}const _0x272487=_0x12b3e7[_0x337ccf(0x8f)][_0x337ccf(0x92)]['split']('\x20');if(_0x272487[_0x337ccf(0x9b)]!==0x2||_0x272487[0x0]!==_0x337ccf(0xaa))return null;return _0x272487[0x1];}['validateToken'](_0x4c847e){const _0x1bd5eb=_0x41147d;try{const _0x4f7d82=(0x0,utils_1[_0x1bd5eb(0x8b)])(this[_0x1bd5eb(0x87)]),_0x465f3d=jwt[_0x1bd5eb(0x7c)](_0x4c847e,process[_0x1bd5eb(0x90)][_0x1bd5eb(0xb0)]);if(_0x465f3d?.['saasId']!==_0x4f7d82)throw new common_1[(_0x1bd5eb(0xab))](_0x1bd5eb(0xa8),common_1[_0x1bd5eb(0xa6)][_0x1bd5eb(0x93)]);return _0x465f3d;}catch(_0x7695ff){throw new common_1['HttpException'](_0x1bd5eb(0xa8),common_1[_0x1bd5eb(0xa6)][_0x1bd5eb(0x93)]);}}['handleRequest'](_0xed94f2,_0x3bfd51,_0x5111b5){const _0x42c511=_0x41147d;if(_0xed94f2||!_0x3bfd51){console[_0x42c511(0x7d)]('err:\x20',_0xed94f2);throw _0xed94f2||new common_1[(_0x42c511(0xac))]();}return _0x3bfd51;}};function _0x282c(){const _0x15c5c7=['HttpStatus','40RXgyzP','亲爱的用户,请登录后继续操作,我们正在等您的到来！','180536RykLio','Bearer','HttpException','UnauthorizedException','RedisCacheService','function','get','JWT_SECRET','getRequest','451413EYOJQY','../../modules/redisCache/redisCache.service','decorate','id:\x20','canActivate','4359070aRzsUy','verify','log','../utils','user','jsonwebtoken','1100538bEsYcW','toString','@nestjs/common','294490uhgAbl','JwtAuthGuard','9VZPygG','clsService','validateToken','fingerprint','defineProperty','getReqSaasId','authService','__decorate','extractToken','headers','env','10isBqZI','authorization','UNAUTHORIZED','AuthGuard','design:paramtypes','redisCacheService','moduleRef','__esModule','nestjs-cls','Injectable','length','switchToHttp','173977wXgBNR','__metadata','122604DKaKNk','object','slice','visitor','metadata','jwt','ClsService'];_0x282c=function(){return _0x15c5c7;};return _0x282c();}JwtAuthGuard=__decorate([(0x0,common_1[_0x41147d(0x9a)])(),__metadata(_0x41147d(0x95),[redisCache_service_1[_0x41147d(0xad)],core_1['ModuleRef'],nestjs_cls_1[_0x41147d(0xa5)],auth_service_1['AuthService']])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;