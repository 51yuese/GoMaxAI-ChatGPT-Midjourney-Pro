'use strict';const _0x4606e8=_0x2916;(function(_0x88af28,_0x2c8d70){const _0x31f9cd=_0x2916,_0x2910a4=_0x88af28();while(!![]){try{const _0x275c48=-parseInt(_0x31f9cd(0x1b5))/0x1+-parseInt(_0x31f9cd(0x1bf))/0x2+parseInt(_0x31f9cd(0x1c1))/0x3+parseInt(_0x31f9cd(0x1b9))/0x4+-parseInt(_0x31f9cd(0x19d))/0x5*(parseInt(_0x31f9cd(0x1a4))/0x6)+parseInt(_0x31f9cd(0x1af))/0x7*(-parseInt(_0x31f9cd(0x1ab))/0x8)+parseInt(_0x31f9cd(0x1b3))/0x9;if(_0x275c48===_0x2c8d70)break;else _0x2910a4['push'](_0x2910a4['shift']());}catch(_0x5c9320){_0x2910a4['push'](_0x2910a4['shift']());}}}(_0x4e9b,0x958e2));var __decorate=this&&this['__decorate']||function(_0x5be80c,_0x57c1eb,_0x240c42,_0x207804){const _0x360fce=_0x2916;var _0x169431=arguments[_0x360fce(0x1c2)],_0x41ad32=_0x169431<0x3?_0x57c1eb:_0x207804===null?_0x207804=Object['getOwnPropertyDescriptor'](_0x57c1eb,_0x240c42):_0x207804,_0x42b1bd;if(typeof Reflect==='object'&&typeof Reflect['decorate']===_0x360fce(0x1b4))_0x41ad32=Reflect[_0x360fce(0x19b)](_0x5be80c,_0x57c1eb,_0x240c42,_0x207804);else{for(var _0x3000d3=_0x5be80c[_0x360fce(0x1c2)]-0x1;_0x3000d3>=0x0;_0x3000d3--)if(_0x42b1bd=_0x5be80c[_0x3000d3])_0x41ad32=(_0x169431<0x3?_0x42b1bd(_0x41ad32):_0x169431>0x3?_0x42b1bd(_0x57c1eb,_0x240c42,_0x41ad32):_0x42b1bd(_0x57c1eb,_0x240c42))||_0x41ad32;}return _0x169431>0x3&&_0x41ad32&&Object[_0x360fce(0x1ac)](_0x57c1eb,_0x240c42,_0x41ad32),_0x41ad32;},__metadata=this&&this[_0x4606e8(0x1a5)]||function(_0x134465,_0x2999f4){const _0x518d8d=_0x4606e8;if(typeof Reflect===_0x518d8d(0x1a9)&&typeof Reflect[_0x518d8d(0x1bb)]==='function')return Reflect[_0x518d8d(0x1bb)](_0x134465,_0x2999f4);};function _0x2916(_0x1ed34b,_0x2b864c){const _0x4e9bba=_0x4e9b();return _0x2916=function(_0x29165d,_0x23d49e){_0x29165d=_0x29165d-0x198;let _0x55d151=_0x4e9bba[_0x29165d];return _0x55d151;},_0x2916(_0x1ed34b,_0x2b864c);}Object['defineProperty'](exports,'__esModule',{'value':!![]}),exports[_0x4606e8(0x19a)]=void 0x0;function _0x4e9b(){const _0x495115=['451138XoPLcD','../../modules/redisCache/redisCache.service','switchToHttp','Bearer','2120752RPrEbm','亲爱的用户,请登录后继续操作,我们正在等您的到来！','metadata','validateToken','clsService','authService','2127938BtaazC','slice','1922451pCauho','length','canActivate','authorization','JWT_SECRET','AuthGuard','ModuleRef','user','id:\x20','../../modules/auth/auth.service','fingerprint','get','ClsService','../utils','nestjs-cls','verify','design:paramtypes','HttpStatus','split','handleRequest','log','JwtAuthGuard','decorate','RedisCacheService','5TmaNHP','env','HttpException','AuthService','toString','headers','extractToken','3070026IvliSh','__metadata','createTokenFromFingerprint','moduleRef','@nestjs/passport','object','UNAUTHORIZED','7480904jyoTaO','defineProperty','getRequest','redisCacheService','7jQQOHT','jwt','@nestjs/core','saasId','21631176cEECJe','function'];_0x4e9b=function(){return _0x495115;};return _0x4e9b();}const redisCache_service_1=require(_0x4606e8(0x1b6)),common_1=require('@nestjs/common'),passport_1=require(_0x4606e8(0x1a8)),jwt=require('jsonwebtoken'),core_1=require(_0x4606e8(0x1b1)),auth_service_1=require(_0x4606e8(0x1ca)),nestjs_cls_1=require(_0x4606e8(0x1cf)),utils_1=require(_0x4606e8(0x1ce));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x4606e8(0x1c6)])(_0x4606e8(0x1b0)){constructor(_0xf9e89b,_0x149861,_0x137600,_0x1a774e){const _0x2cfb91=_0x4606e8;super(),this['redisCacheService']=_0xf9e89b,this[_0x2cfb91(0x1a7)]=_0x149861,this[_0x2cfb91(0x1bd)]=_0x137600,this['authService']=_0x1a774e;}async[_0x4606e8(0x1c3)](_0x5c26cc){const _0x31ac54=_0x4606e8;!this[_0x31ac54(0x1ae)]&&(this['redisCacheService']=this[_0x31ac54(0x1a7)][_0x31ac54(0x1cc)](redisCache_service_1[_0x31ac54(0x19c)],{'strict':![]}));const _0x31857b=_0x5c26cc[_0x31ac54(0x1b7)]()[_0x31ac54(0x1ad)](),_0x19eddd=this[_0x31ac54(0x1a3)](_0x31857b);_0x31857b[_0x31ac54(0x1c8)]=this['validateToken'](_0x19eddd);if(_0x31857b[_0x31ac54(0x1c8)]['role']==='visitor')throw new common_1[(_0x31ac54(0x19f))](_0x31ac54(0x1ba),common_1[_0x31ac54(0x1d2)][_0x31ac54(0x1aa)]);return await this[_0x31ac54(0x1ae)]['checkTokenAuth'](_0x19eddd,_0x31857b),!![];}['extractToken'](_0x3bbcd5){const _0x243d90=_0x4606e8;if(!_0x3bbcd5['headers']['authorization']){if(_0x3bbcd5[_0x243d90(0x1a2)][_0x243d90(0x1cb)]){let _0x4d8414=_0x3bbcd5[_0x243d90(0x1a2)][_0x243d90(0x1cb)];return _0x4d8414>0x7fffffff&&(_0x4d8414=_0x4d8414[_0x243d90(0x1a1)]()[_0x243d90(0x1c0)](-0x9),_0x4d8414=Number(String(Number(_0x4d8414))),console[_0x243d90(0x199)](_0x243d90(0x1c9),_0x4d8414)),this[_0x243d90(0x1be)][_0x243d90(0x1a6)](_0x4d8414);}return null;}const _0x42b08b=_0x3bbcd5[_0x243d90(0x1a2)][_0x243d90(0x1c4)][_0x243d90(0x1d3)]('\x20');if(_0x42b08b['length']!==0x2||_0x42b08b[0x0]!==_0x243d90(0x1b8))return null;return _0x42b08b[0x1];}[_0x4606e8(0x1bc)](_0x553001){const _0x36bd15=_0x4606e8;try{const _0x499376=(0x0,utils_1['getReqSaasId'])(this[_0x36bd15(0x1bd)]),_0x29b54f=jwt[_0x36bd15(0x1d0)](_0x553001,process[_0x36bd15(0x19e)][_0x36bd15(0x1c5)]);if(_0x29b54f?.[_0x36bd15(0x1b2)]!==_0x499376)throw new common_1[(_0x36bd15(0x19f))](_0x36bd15(0x1ba),common_1[_0x36bd15(0x1d2)][_0x36bd15(0x1aa)]);return _0x29b54f;}catch(_0x47a367){throw new common_1['HttpException'](_0x36bd15(0x1ba),common_1['HttpStatus']['UNAUTHORIZED']);}}[_0x4606e8(0x198)](_0x5a3d29,_0x346300,_0x3dc01c){const _0x30fc4d=_0x4606e8;if(_0x5a3d29||!_0x346300){console[_0x30fc4d(0x199)]('err:\x20',_0x5a3d29);throw _0x5a3d29||new common_1['UnauthorizedException']();}return _0x346300;}};JwtAuthGuard=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x4606e8(0x1d1),[redisCache_service_1[_0x4606e8(0x19c)],core_1[_0x4606e8(0x1c7)],nestjs_cls_1[_0x4606e8(0x1cd)],auth_service_1[_0x4606e8(0x1a0)]])],JwtAuthGuard),exports[_0x4606e8(0x19a)]=JwtAuthGuard;