'use strict';const _0x4390a4=_0xb407;(function(_0x3e3f66,_0x2649b1){const _0x51fbde=_0xb407,_0x5d2b75=_0x3e3f66();while(!![]){try{const _0x4f33d4=parseInt(_0x51fbde(0xb9))/0x1+-parseInt(_0x51fbde(0xd6))/0x2*(parseInt(_0x51fbde(0xc5))/0x3)+parseInt(_0x51fbde(0xc3))/0x4+-parseInt(_0x51fbde(0xc9))/0x5*(parseInt(_0x51fbde(0xb1))/0x6)+parseInt(_0x51fbde(0xbd))/0x7+-parseInt(_0x51fbde(0xae))/0x8+parseInt(_0x51fbde(0xcf))/0x9;if(_0x4f33d4===_0x2649b1)break;else _0x5d2b75['push'](_0x5d2b75['shift']());}catch(_0x3ac7ec){_0x5d2b75['push'](_0x5d2b75['shift']());}}}(_0x18a9,0x7378f));function _0xb407(_0x41b543,_0x232d1b){const _0x18a938=_0x18a9();return _0xb407=function(_0xb407f,_0x5ca742){_0xb407f=_0xb407f-0xa8;let _0x4ebb7e=_0x18a938[_0xb407f];return _0x4ebb7e;},_0xb407(_0x41b543,_0x232d1b);}function _0x18a9(){const _0x5630f6=['__decorate','45wrQTHH','UnauthorizedException','jsonwebtoken','length','authService','moduleRef','5553747wWWArp','headers','toString','log','visitor','metadata','JWT_SECRET','12youUWe','defineProperty','fingerprint','nestjs-cls','checkTokenAuth','UNAUTHORIZED','__metadata','RedisCacheService','slice','id:\x20','saasId','switchToHttp','getOwnPropertyDescriptor','@nestjs/common','verify','亲爱的用户,请登录后继续操作,我们正在等您的到来！','design:paramtypes','clsService','extractToken','getReqSaasId','5972552fWrwFp','HttpException','AuthService','266538FfVeQh','../utils','redisCacheService','err:\x20','object','user','JwtAuthGuard','AuthGuard','162869oNDVBj','decorate','handleRequest','ModuleRef','6352185oPiDxk','../../modules/redisCache/redisCache.service','Bearer','HttpStatus','ClsService','@nestjs/core','1481744ackCRd','function','219246sduNWA','authorization','createTokenFromFingerprint'];_0x18a9=function(){return _0x5630f6;};return _0x18a9();}var __decorate=this&&this[_0x4390a4(0xc8)]||function(_0x17fcbf,_0x28d519,_0xba3442,_0x37db31){const _0x945ece=_0x4390a4;var _0xb281e3=arguments['length'],_0x5bfca3=_0xb281e3<0x3?_0x28d519:_0x37db31===null?_0x37db31=Object[_0x945ece(0xe2)](_0x28d519,_0xba3442):_0x37db31,_0x18b59c;if(typeof Reflect==='object'&&typeof Reflect[_0x945ece(0xba)]===_0x945ece(0xc4))_0x5bfca3=Reflect[_0x945ece(0xba)](_0x17fcbf,_0x28d519,_0xba3442,_0x37db31);else{for(var _0xc94447=_0x17fcbf[_0x945ece(0xcc)]-0x1;_0xc94447>=0x0;_0xc94447--)if(_0x18b59c=_0x17fcbf[_0xc94447])_0x5bfca3=(_0xb281e3<0x3?_0x18b59c(_0x5bfca3):_0xb281e3>0x3?_0x18b59c(_0x28d519,_0xba3442,_0x5bfca3):_0x18b59c(_0x28d519,_0xba3442))||_0x5bfca3;}return _0xb281e3>0x3&&_0x5bfca3&&Object['defineProperty'](_0x28d519,_0xba3442,_0x5bfca3),_0x5bfca3;},__metadata=this&&this[_0x4390a4(0xdc)]||function(_0x3e5f54,_0x28917b){const _0x48268a=_0x4390a4;if(typeof Reflect===_0x48268a(0xb5)&&typeof Reflect[_0x48268a(0xd4)]==='function')return Reflect[_0x48268a(0xd4)](_0x3e5f54,_0x28917b);};Object[_0x4390a4(0xd7)](exports,'__esModule',{'value':!![]}),exports[_0x4390a4(0xb7)]=void 0x0;const redisCache_service_1=require(_0x4390a4(0xbe)),common_1=require(_0x4390a4(0xe3)),passport_1=require('@nestjs/passport'),jwt=require(_0x4390a4(0xcb)),core_1=require(_0x4390a4(0xc2)),auth_service_1=require('../../modules/auth/auth.service'),nestjs_cls_1=require(_0x4390a4(0xd9)),utils_1=require(_0x4390a4(0xb2));let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x4390a4(0xb8)])('jwt'){constructor(_0x23e0c4,_0x3ee15f,_0x17f1db,_0x44d10b){const _0x2de4b2=_0x4390a4;super(),this[_0x2de4b2(0xb3)]=_0x23e0c4,this[_0x2de4b2(0xce)]=_0x3ee15f,this[_0x2de4b2(0xab)]=_0x17f1db,this[_0x2de4b2(0xcd)]=_0x44d10b;}async['canActivate'](_0x4e5316){const _0x1d6848=_0x4390a4;!this[_0x1d6848(0xb3)]&&(this[_0x1d6848(0xb3)]=this[_0x1d6848(0xce)]['get'](redisCache_service_1[_0x1d6848(0xdd)],{'strict':![]}));const _0x1d30e2=_0x4e5316[_0x1d6848(0xe1)]()['getRequest'](),_0x330f54=this[_0x1d6848(0xac)](_0x1d30e2);_0x1d30e2[_0x1d6848(0xb6)]=this['validateToken'](_0x330f54);if(_0x1d30e2[_0x1d6848(0xb6)]['role']===_0x1d6848(0xd3))throw new common_1['HttpException'](_0x1d6848(0xa9),common_1[_0x1d6848(0xc0)]['UNAUTHORIZED']);return await this[_0x1d6848(0xb3)][_0x1d6848(0xda)](_0x330f54,_0x1d30e2),!![];}[_0x4390a4(0xac)](_0x2e5096){const _0x331c24=_0x4390a4;if(!_0x2e5096[_0x331c24(0xd0)]['authorization']){if(_0x2e5096['headers'][_0x331c24(0xd8)]){let _0x5cdefe=_0x2e5096[_0x331c24(0xd0)]['fingerprint'];return _0x5cdefe>0x7fffffff&&(_0x5cdefe=_0x5cdefe[_0x331c24(0xd1)]()[_0x331c24(0xde)](-0x9),_0x5cdefe=Number(String(Number(_0x5cdefe))),console['log'](_0x331c24(0xdf),_0x5cdefe)),this[_0x331c24(0xcd)][_0x331c24(0xc7)](_0x5cdefe);}return null;}const _0x1b5526=_0x2e5096[_0x331c24(0xd0)][_0x331c24(0xc6)]['split']('\x20');if(_0x1b5526[_0x331c24(0xcc)]!==0x2||_0x1b5526[0x0]!==_0x331c24(0xbf))return null;return _0x1b5526[0x1];}['validateToken'](_0x2c5ea3){const _0x5def0f=_0x4390a4;try{const _0x26477c=(0x0,utils_1[_0x5def0f(0xad)])(this[_0x5def0f(0xab)]),_0x57180f=jwt[_0x5def0f(0xa8)](_0x2c5ea3,process['env'][_0x5def0f(0xd5)]);if(_0x57180f?.[_0x5def0f(0xe0)]!==_0x26477c)throw new common_1[(_0x5def0f(0xaf))](_0x5def0f(0xa9),common_1[_0x5def0f(0xc0)][_0x5def0f(0xdb)]);return _0x57180f;}catch(_0x37451d){throw new common_1['HttpException'](_0x5def0f(0xa9),common_1['HttpStatus'][_0x5def0f(0xdb)]);}}[_0x4390a4(0xbb)](_0x3985be,_0x5c51cb,_0x529b88){const _0x2d4d52=_0x4390a4;if(_0x3985be||!_0x5c51cb){console[_0x2d4d52(0xd2)](_0x2d4d52(0xb4),_0x3985be);throw _0x3985be||new common_1[(_0x2d4d52(0xca))]();}return _0x5c51cb;}};JwtAuthGuard=__decorate([(0x0,common_1['Injectable'])(),__metadata(_0x4390a4(0xaa),[redisCache_service_1[_0x4390a4(0xdd)],core_1[_0x4390a4(0xbc)],nestjs_cls_1[_0x4390a4(0xc1)],auth_service_1[_0x4390a4(0xb0)]])],JwtAuthGuard),exports[_0x4390a4(0xb7)]=JwtAuthGuard;