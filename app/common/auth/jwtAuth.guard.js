'use strict';function _0x10d2(){const _0x49a37b=['verify','role','Injectable','length','AuthGuard','authorization','UNAUTHORIZED','split','err:\x20','slice','toString','getRequest','design:paramtypes','object','validateToken','authService','__metadata','env','nestjs-cls','id:\x20','491478mJGxlq','headers','亲爱的用户,请登录后继续操作,我们正在等您的到来！','49UyGNex','visitor','RedisCacheService','3622861wRToJi','100836JqWpes','3176790YwtQvs','UnauthorizedException','424KqdPPF','jwt','getOwnPropertyDescriptor','getReqSaasId','clsService','defineProperty','handleRequest','HttpException','metadata','../../modules/auth/auth.service','checkTokenAuth','HttpStatus','redisCacheService','@nestjs/common','2985512UyqAhh','1278394yVoevA','user','14TsMbcx','moduleRef','JWT_SECRET','decorate','1132908tpooyO','50SCVTtE','../utils','createTokenFromFingerprint','log','ClsService','fingerprint','../../modules/redisCache/redisCache.service','Bearer','@nestjs/core','extractToken'];_0x10d2=function(){return _0x49a37b;};return _0x10d2();}const _0x53d3df=_0x26c3;(function(_0x717e23,_0x70bcb4){const _0x26e334=_0x26c3,_0x3cafa7=_0x717e23();while(!![]){try{const _0x1e95f8=parseInt(_0x26e334(0x146))/0x1+parseInt(_0x26e334(0x148))/0x2*(parseInt(_0x26e334(0x12d))/0x3)+-parseInt(_0x26e334(0x145))/0x4+-parseInt(_0x26e334(0x135))/0x5+-parseInt(_0x26e334(0x14c))/0x6*(parseInt(_0x26e334(0x130))/0x7)+parseInt(_0x26e334(0x137))/0x8*(-parseInt(_0x26e334(0x134))/0x9)+-parseInt(_0x26e334(0x14d))/0xa*(-parseInt(_0x26e334(0x133))/0xb);if(_0x1e95f8===_0x70bcb4)break;else _0x3cafa7['push'](_0x3cafa7['shift']());}catch(_0x3179f1){_0x3cafa7['push'](_0x3cafa7['shift']());}}}(_0x10d2,0xbd201));var __decorate=this&&this['__decorate']||function(_0x4af233,_0x3eb04c,_0x3b78f6,_0x344447){const _0x5ef274=_0x26c3;var _0x367f0c=arguments[_0x5ef274(0x11c)],_0x90b012=_0x367f0c<0x3?_0x3eb04c:_0x344447===null?_0x344447=Object[_0x5ef274(0x139)](_0x3eb04c,_0x3b78f6):_0x344447,_0x25775c;if(typeof Reflect===_0x5ef274(0x126)&&typeof Reflect['decorate']==='function')_0x90b012=Reflect[_0x5ef274(0x14b)](_0x4af233,_0x3eb04c,_0x3b78f6,_0x344447);else{for(var _0x453847=_0x4af233[_0x5ef274(0x11c)]-0x1;_0x453847>=0x0;_0x453847--)if(_0x25775c=_0x4af233[_0x453847])_0x90b012=(_0x367f0c<0x3?_0x25775c(_0x90b012):_0x367f0c>0x3?_0x25775c(_0x3eb04c,_0x3b78f6,_0x90b012):_0x25775c(_0x3eb04c,_0x3b78f6))||_0x90b012;}return _0x367f0c>0x3&&_0x90b012&&Object['defineProperty'](_0x3eb04c,_0x3b78f6,_0x90b012),_0x90b012;},__metadata=this&&this[_0x53d3df(0x129)]||function(_0x4e7723,_0x2c8b0b){const _0x14146a=_0x53d3df;if(typeof Reflect===_0x14146a(0x126)&&typeof Reflect[_0x14146a(0x13f)]==='function')return Reflect[_0x14146a(0x13f)](_0x4e7723,_0x2c8b0b);};Object[_0x53d3df(0x13c)](exports,'__esModule',{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const redisCache_service_1=require(_0x53d3df(0x153)),common_1=require(_0x53d3df(0x144)),passport_1=require('@nestjs/passport'),jwt=require('jsonwebtoken'),core_1=require(_0x53d3df(0x155)),auth_service_1=require(_0x53d3df(0x140)),nestjs_cls_1=require(_0x53d3df(0x12b)),utils_1=require(_0x53d3df(0x14e));function _0x26c3(_0x16764e,_0x211cdc){const _0x10d268=_0x10d2();return _0x26c3=function(_0x26c3bc,_0x507b17){_0x26c3bc=_0x26c3bc-0x11a;let _0x583eb4=_0x10d268[_0x26c3bc];return _0x583eb4;},_0x26c3(_0x16764e,_0x211cdc);}let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x53d3df(0x11d)])(_0x53d3df(0x138)){constructor(_0x31769e,_0x50a7ea,_0x3bc4f3,_0x502068){const _0xaf5bd4=_0x53d3df;super(),this[_0xaf5bd4(0x143)]=_0x31769e,this['moduleRef']=_0x50a7ea,this[_0xaf5bd4(0x13b)]=_0x3bc4f3,this[_0xaf5bd4(0x128)]=_0x502068;}async['canActivate'](_0x27e66b){const _0x170c64=_0x53d3df;!this[_0x170c64(0x143)]&&(this[_0x170c64(0x143)]=this[_0x170c64(0x149)]['get'](redisCache_service_1[_0x170c64(0x132)],{'strict':![]}));const _0x575961=_0x27e66b['switchToHttp']()[_0x170c64(0x124)](),_0x3cefc3=this[_0x170c64(0x156)](_0x575961);_0x575961[_0x170c64(0x147)]=this[_0x170c64(0x127)](_0x3cefc3);if(_0x575961[_0x170c64(0x147)][_0x170c64(0x11a)]===_0x170c64(0x131))throw new common_1[(_0x170c64(0x13e))](_0x170c64(0x12f),common_1[_0x170c64(0x142)][_0x170c64(0x11f)]);return await this[_0x170c64(0x143)][_0x170c64(0x141)](_0x3cefc3,_0x575961),!![];}['extractToken'](_0x5f4fc8){const _0x1b4b78=_0x53d3df;if(!_0x5f4fc8['headers'][_0x1b4b78(0x11e)]){if(_0x5f4fc8[_0x1b4b78(0x12e)][_0x1b4b78(0x152)]){let _0x1db9fd=_0x5f4fc8[_0x1b4b78(0x12e)][_0x1b4b78(0x152)];return _0x1db9fd>0x7fffffff&&(_0x1db9fd=_0x1db9fd[_0x1b4b78(0x123)]()[_0x1b4b78(0x122)](-0x9),_0x1db9fd=Number(String(Number(_0x1db9fd))),console['log'](_0x1b4b78(0x12c),_0x1db9fd)),this[_0x1b4b78(0x128)][_0x1b4b78(0x14f)](_0x1db9fd);}return null;}const _0x2c1793=_0x5f4fc8[_0x1b4b78(0x12e)][_0x1b4b78(0x11e)][_0x1b4b78(0x120)]('\x20');if(_0x2c1793[_0x1b4b78(0x11c)]!==0x2||_0x2c1793[0x0]!==_0x1b4b78(0x154))return null;return _0x2c1793[0x1];}['validateToken'](_0x5dd8ed){const _0x1b4ce6=_0x53d3df;try{const _0x3c69ad=(0x0,utils_1[_0x1b4ce6(0x13a)])(this[_0x1b4ce6(0x13b)]),_0x2270b3=jwt[_0x1b4ce6(0x157)](_0x5dd8ed,process[_0x1b4ce6(0x12a)][_0x1b4ce6(0x14a)]);if(_0x2270b3?.['saasId']!==_0x3c69ad)throw new common_1['HttpException'](_0x1b4ce6(0x12f),common_1[_0x1b4ce6(0x142)][_0x1b4ce6(0x11f)]);return _0x2270b3;}catch(_0x46790d){throw new common_1[(_0x1b4ce6(0x13e))](_0x1b4ce6(0x12f),common_1[_0x1b4ce6(0x142)][_0x1b4ce6(0x11f)]);}}[_0x53d3df(0x13d)](_0x4576be,_0x131dde,_0x2a8fe9){const _0x23dedc=_0x53d3df;if(_0x4576be||!_0x131dde){console[_0x23dedc(0x150)](_0x23dedc(0x121),_0x4576be);throw _0x4576be||new common_1[(_0x23dedc(0x136))]();}return _0x131dde;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x53d3df(0x11b)])(),__metadata(_0x53d3df(0x125),[redisCache_service_1['RedisCacheService'],core_1['ModuleRef'],nestjs_cls_1[_0x53d3df(0x151)],auth_service_1['AuthService']])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;