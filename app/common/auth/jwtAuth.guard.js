'use strict';const _0x3d97a6=_0x4ae3;function _0x4df2(){const _0xfa4462=['../../modules/auth/auth.service','RedisCacheService','length','fingerprint','split','jsonwebtoken','err:\x20','createTokenFromFingerprint','HttpStatus','user','3QaDLyr','12QAZARC','validateToken','clsService','id:\x20','@nestjs/passport','getReqSaasId','JWT_SECRET','moduleRef','54dgjMDK','role','defineProperty','HttpException','env','429655iSVgGl','733170AtqiSi','321708EHGycY','redisCacheService','get','slice','design:paramtypes','200280bYqOkC','676011nVncef','ModuleRef','jwt','visitor','UNAUTHORIZED','checkTokenAuth','metadata','saasId','@nestjs/core','headers','UnauthorizedException','object','3459335uFdqen','function','AuthService','log','verify','Injectable','132190dgLOMK','8SEHyKX','switchToHttp','toString','@nestjs/common','decorate','extractToken','authService','亲爱的用户,请登录后继续操作,我们正在等您的到来！','authorization'];_0x4df2=function(){return _0xfa4462;};return _0x4df2();}function _0x4ae3(_0x385f34,_0x1360cc){const _0x4df270=_0x4df2();return _0x4ae3=function(_0x4ae38e,_0x4908eb){_0x4ae38e=_0x4ae38e-0xec;let _0x472701=_0x4df270[_0x4ae38e];return _0x472701;},_0x4ae3(_0x385f34,_0x1360cc);}(function(_0x3f9314,_0x1a1d7a){const _0x2f076c=_0x4ae3,_0x605e0=_0x3f9314();while(!![]){try{const _0x5ec01f=parseInt(_0x2f076c(0x118))/0x1*(parseInt(_0x2f076c(0x104))/0x2)+-parseInt(_0x2f076c(0x127))/0x3+-parseInt(_0x2f076c(0x119))/0x4*(parseInt(_0x2f076c(0x126))/0x5)+-parseInt(_0x2f076c(0xec))/0x6+-parseInt(_0x2f076c(0xf2))/0x7*(-parseInt(_0x2f076c(0x105))/0x8)+parseInt(_0x2f076c(0x121))/0x9*(parseInt(_0x2f076c(0xf1))/0xa)+parseInt(_0x2f076c(0xfe))/0xb;if(_0x5ec01f===_0x1a1d7a)break;else _0x605e0['push'](_0x605e0['shift']());}catch(_0x4d419a){_0x605e0['push'](_0x605e0['shift']());}}}(_0x4df2,0x2a68e));var __decorate=this&&this['__decorate']||function(_0x4a1811,_0x3077a9,_0x1f9c9f,_0x1fb853){const _0x33766e=_0x4ae3;var _0x14d22f=arguments[_0x33766e(0x110)],_0x5858d7=_0x14d22f<0x3?_0x3077a9:_0x1fb853===null?_0x1fb853=Object['getOwnPropertyDescriptor'](_0x3077a9,_0x1f9c9f):_0x1fb853,_0x2e2dfc;if(typeof Reflect===_0x33766e(0xfd)&&typeof Reflect['decorate']==='function')_0x5858d7=Reflect[_0x33766e(0x109)](_0x4a1811,_0x3077a9,_0x1f9c9f,_0x1fb853);else{for(var _0x31cfd2=_0x4a1811['length']-0x1;_0x31cfd2>=0x0;_0x31cfd2--)if(_0x2e2dfc=_0x4a1811[_0x31cfd2])_0x5858d7=(_0x14d22f<0x3?_0x2e2dfc(_0x5858d7):_0x14d22f>0x3?_0x2e2dfc(_0x3077a9,_0x1f9c9f,_0x5858d7):_0x2e2dfc(_0x3077a9,_0x1f9c9f))||_0x5858d7;}return _0x14d22f>0x3&&_0x5858d7&&Object[_0x33766e(0x123)](_0x3077a9,_0x1f9c9f,_0x5858d7),_0x5858d7;},__metadata=this&&this['__metadata']||function(_0x27df46,_0x46c4ae){const _0x59a67f=_0x4ae3;if(typeof Reflect===_0x59a67f(0xfd)&&typeof Reflect[_0x59a67f(0xf8)]===_0x59a67f(0xff))return Reflect[_0x59a67f(0xf8)](_0x27df46,_0x46c4ae);};Object[_0x3d97a6(0x123)](exports,'__esModule',{'value':!![]}),exports['JwtAuthGuard']=void 0x0;const redisCache_service_1=require('../../modules/redisCache/redisCache.service'),common_1=require(_0x3d97a6(0x108)),passport_1=require(_0x3d97a6(0x11d)),jwt=require(_0x3d97a6(0x113)),core_1=require(_0x3d97a6(0xfa)),auth_service_1=require(_0x3d97a6(0x10e)),nestjs_cls_1=require('nestjs-cls'),utils_1=require('../utils');let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1['AuthGuard'])(_0x3d97a6(0xf4)){constructor(_0x50d176,_0x20119d,_0x4ed32c,_0x445c52){const _0x356cd7=_0x3d97a6;super(),this[_0x356cd7(0xed)]=_0x50d176,this[_0x356cd7(0x120)]=_0x20119d,this[_0x356cd7(0x11b)]=_0x4ed32c,this[_0x356cd7(0x10b)]=_0x445c52;}async['canActivate'](_0x498cf7){const _0xc72510=_0x3d97a6;!this[_0xc72510(0xed)]&&(this[_0xc72510(0xed)]=this[_0xc72510(0x120)][_0xc72510(0xee)](redisCache_service_1[_0xc72510(0x10f)],{'strict':![]}));const _0x580881=_0x498cf7[_0xc72510(0x106)]()['getRequest'](),_0x3c57bd=this[_0xc72510(0x10a)](_0x580881);_0x580881[_0xc72510(0x117)]=this['validateToken'](_0x3c57bd);if(_0x580881['user'][_0xc72510(0x122)]===_0xc72510(0xf5))throw new common_1[(_0xc72510(0x124))](_0xc72510(0x10c),common_1['HttpStatus']['UNAUTHORIZED']);return await this[_0xc72510(0xed)][_0xc72510(0xf7)](_0x3c57bd,_0x580881),!![];}[_0x3d97a6(0x10a)](_0x120215){const _0x212f4e=_0x3d97a6;if(!_0x120215[_0x212f4e(0xfb)][_0x212f4e(0x10d)]){if(_0x120215['headers'][_0x212f4e(0x111)]){let _0x32a378=_0x120215[_0x212f4e(0xfb)][_0x212f4e(0x111)];return _0x32a378>0x7fffffff&&(_0x32a378=_0x32a378[_0x212f4e(0x107)]()[_0x212f4e(0xef)](-0x9),_0x32a378=Number(String(Number(_0x32a378))),console['log'](_0x212f4e(0x11c),_0x32a378)),this[_0x212f4e(0x10b)][_0x212f4e(0x115)](_0x32a378);}return null;}const _0x4a1f8a=_0x120215[_0x212f4e(0xfb)][_0x212f4e(0x10d)][_0x212f4e(0x112)]('\x20');if(_0x4a1f8a[_0x212f4e(0x110)]!==0x2||_0x4a1f8a[0x0]!=='Bearer')return null;return _0x4a1f8a[0x1];}[_0x3d97a6(0x11a)](_0x40313e){const _0x17b0ed=_0x3d97a6;try{const _0x26d6b4=(0x0,utils_1[_0x17b0ed(0x11e)])(this[_0x17b0ed(0x11b)]),_0x3c6d81=jwt[_0x17b0ed(0x102)](_0x40313e,process[_0x17b0ed(0x125)][_0x17b0ed(0x11f)]);if(_0x3c6d81?.[_0x17b0ed(0xf9)]!==_0x26d6b4)throw new common_1[(_0x17b0ed(0x124))](_0x17b0ed(0x10c),common_1[_0x17b0ed(0x116)][_0x17b0ed(0xf6)]);return _0x3c6d81;}catch(_0x2b53b3){throw new common_1[(_0x17b0ed(0x124))](_0x17b0ed(0x10c),common_1['HttpStatus'][_0x17b0ed(0xf6)]);}}['handleRequest'](_0xcedf1f,_0x364184,_0x4f1c53){const _0xd60410=_0x3d97a6;if(_0xcedf1f||!_0x364184){console[_0xd60410(0x101)](_0xd60410(0x114),_0xcedf1f);throw _0xcedf1f||new common_1[(_0xd60410(0xfc))]();}return _0x364184;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x3d97a6(0x103)])(),__metadata(_0x3d97a6(0xf0),[redisCache_service_1[_0x3d97a6(0x10f)],core_1[_0x3d97a6(0xf3)],nestjs_cls_1['ClsService'],auth_service_1[_0x3d97a6(0x100)]])],JwtAuthGuard),exports['JwtAuthGuard']=JwtAuthGuard;