'use strict';const _0x34149a=_0x227a;(function(_0x132e11,_0x5126e1){const _0x3b8f66=_0x227a,_0x455641=_0x132e11();while(!![]){try{const _0x36de1e=-parseInt(_0x3b8f66(0x1d0))/0x1*(parseInt(_0x3b8f66(0x1f2))/0x2)+-parseInt(_0x3b8f66(0x1d5))/0x3+-parseInt(_0x3b8f66(0x1e4))/0x4*(parseInt(_0x3b8f66(0x1d6))/0x5)+-parseInt(_0x3b8f66(0x201))/0x6*(-parseInt(_0x3b8f66(0x1ce))/0x7)+-parseInt(_0x3b8f66(0x1f1))/0x8*(-parseInt(_0x3b8f66(0x1e3))/0x9)+parseInt(_0x3b8f66(0x1df))/0xa*(parseInt(_0x3b8f66(0x1ed))/0xb)+parseInt(_0x3b8f66(0x1eb))/0xc;if(_0x36de1e===_0x5126e1)break;else _0x455641['push'](_0x455641['shift']());}catch(_0x2b4de0){_0x455641['push'](_0x455641['shift']());}}}(_0x1df4,0x7945f));function _0x1df4(){const _0x493986=['user','Bearer','authService','ClsService','log','9579636EWypaT','ModuleRef','51029pjGITj','AuthGuard','handleRequest','JwtAuthGuard','8XUsYMJ','1934722hjEIrF','../../modules/auth/auth.service','AuthService','authorization','jwt','headers','metadata','HttpStatus','id:\x20','@nestjs/core','@nestjs/common','decorate','JWT_SECRET','verify','getOwnPropertyDescriptor','44616rzgtNB','亲爱的用户,请登录后继续操作,我们正在等您的到来！','saasId','design:paramtypes','function','jsonwebtoken','redisCacheService','slice','@nestjs/passport','role','RedisCacheService','canActivate','length','UnauthorizedException','406vrTEfh','fingerprint','1DCnTKN','moduleRef','clsService','nestjs-cls','getRequest','616902dicYWc','1964640cjpfnP','extractToken','getReqSaasId','toString','defineProperty','validateToken','../../modules/redisCache/redisCache.service','__metadata','Injectable','620DDurvk','object','UNAUTHORIZED','visitor','8445393oQsdlF','8PrxPfr','get'];_0x1df4=function(){return _0x493986;};return _0x1df4();}function _0x227a(_0x245d73,_0x35d1b2){const _0x1df44d=_0x1df4();return _0x227a=function(_0x227a5e,_0x1002a5){_0x227a5e=_0x227a5e-0x1c7;let _0x5d7574=_0x1df44d[_0x227a5e];return _0x5d7574;},_0x227a(_0x245d73,_0x35d1b2);}var __decorate=this&&this['__decorate']||function(_0x25aa46,_0x452c4c,_0xbf68cd,_0x3bdc22){const _0x226572=_0x227a;var _0x3dff6e=arguments[_0x226572(0x1cc)],_0x5c0f5d=_0x3dff6e<0x3?_0x452c4c:_0x3bdc22===null?_0x3bdc22=Object[_0x226572(0x200)](_0x452c4c,_0xbf68cd):_0x3bdc22,_0x452f86;if(typeof Reflect===_0x226572(0x1e0)&&typeof Reflect[_0x226572(0x1fd)]===_0x226572(0x205))_0x5c0f5d=Reflect[_0x226572(0x1fd)](_0x25aa46,_0x452c4c,_0xbf68cd,_0x3bdc22);else{for(var _0x215ac5=_0x25aa46[_0x226572(0x1cc)]-0x1;_0x215ac5>=0x0;_0x215ac5--)if(_0x452f86=_0x25aa46[_0x215ac5])_0x5c0f5d=(_0x3dff6e<0x3?_0x452f86(_0x5c0f5d):_0x3dff6e>0x3?_0x452f86(_0x452c4c,_0xbf68cd,_0x5c0f5d):_0x452f86(_0x452c4c,_0xbf68cd))||_0x5c0f5d;}return _0x3dff6e>0x3&&_0x5c0f5d&&Object[_0x226572(0x1da)](_0x452c4c,_0xbf68cd,_0x5c0f5d),_0x5c0f5d;},__metadata=this&&this[_0x34149a(0x1dd)]||function(_0xb311cf,_0x3e3abc){const _0x5c3848=_0x34149a;if(typeof Reflect===_0x5c3848(0x1e0)&&typeof Reflect['metadata']===_0x5c3848(0x205))return Reflect[_0x5c3848(0x1f8)](_0xb311cf,_0x3e3abc);};Object[_0x34149a(0x1da)](exports,'__esModule',{'value':!![]}),exports[_0x34149a(0x1f0)]=void 0x0;const redisCache_service_1=require(_0x34149a(0x1dc)),common_1=require(_0x34149a(0x1fc)),passport_1=require(_0x34149a(0x1c8)),jwt=require(_0x34149a(0x206)),core_1=require(_0x34149a(0x1fb)),auth_service_1=require(_0x34149a(0x1f3)),nestjs_cls_1=require(_0x34149a(0x1d3)),utils_1=require('../utils');let JwtAuthGuard=class JwtAuthGuard extends(0x0,passport_1[_0x34149a(0x1ee)])(_0x34149a(0x1f6)){constructor(_0x25bbf0,_0x39ad9,_0xcd4db7,_0x3d08dd){const _0x176a40=_0x34149a;super(),this['redisCacheService']=_0x25bbf0,this[_0x176a40(0x1d1)]=_0x39ad9,this[_0x176a40(0x1d2)]=_0xcd4db7,this[_0x176a40(0x1e8)]=_0x3d08dd;}async[_0x34149a(0x1cb)](_0x4bf24f){const _0x58a7c2=_0x34149a;!this[_0x58a7c2(0x207)]&&(this[_0x58a7c2(0x207)]=this[_0x58a7c2(0x1d1)][_0x58a7c2(0x1e5)](redisCache_service_1[_0x58a7c2(0x1ca)],{'strict':![]}));const _0x1de044=_0x4bf24f['switchToHttp']()[_0x58a7c2(0x1d4)](),_0x32dd90=this[_0x58a7c2(0x1d7)](_0x1de044);_0x1de044['user']=this[_0x58a7c2(0x1db)](_0x32dd90);if(_0x1de044[_0x58a7c2(0x1e6)][_0x58a7c2(0x1c9)]===_0x58a7c2(0x1e2))throw new common_1['HttpException'](_0x58a7c2(0x202),common_1[_0x58a7c2(0x1f9)][_0x58a7c2(0x1e1)]);return await this[_0x58a7c2(0x207)]['checkTokenAuth'](_0x32dd90,_0x1de044),!![];}[_0x34149a(0x1d7)](_0x2aea74){const _0x381060=_0x34149a;if(!_0x2aea74[_0x381060(0x1f7)][_0x381060(0x1f5)]){if(_0x2aea74[_0x381060(0x1f7)][_0x381060(0x1cf)]){let _0x42670c=_0x2aea74[_0x381060(0x1f7)][_0x381060(0x1cf)];return _0x42670c>0x7fffffff&&(_0x42670c=_0x42670c[_0x381060(0x1d9)]()[_0x381060(0x1c7)](-0x9),_0x42670c=Number(String(Number(_0x42670c))),console[_0x381060(0x1ea)](_0x381060(0x1fa),_0x42670c)),this[_0x381060(0x1e8)]['createTokenFromFingerprint'](_0x42670c);}return null;}const _0x303cf7=_0x2aea74[_0x381060(0x1f7)][_0x381060(0x1f5)]['split']('\x20');if(_0x303cf7['length']!==0x2||_0x303cf7[0x0]!==_0x381060(0x1e7))return null;return _0x303cf7[0x1];}['validateToken'](_0x5aeba1){const _0x364dd9=_0x34149a;try{const _0x5cb3ff=(0x0,utils_1[_0x364dd9(0x1d8)])(this[_0x364dd9(0x1d2)]),_0xc663df=jwt[_0x364dd9(0x1ff)](_0x5aeba1,process['env'][_0x364dd9(0x1fe)]);if(_0xc663df?.[_0x364dd9(0x203)]!==_0x5cb3ff)throw new common_1['HttpException']('亲爱的用户,请登录后继续操作,我们正在等您的到来！',common_1[_0x364dd9(0x1f9)]['UNAUTHORIZED']);return _0xc663df;}catch(_0x20f731){throw new common_1['HttpException'](_0x364dd9(0x202),common_1['HttpStatus'][_0x364dd9(0x1e1)]);}}[_0x34149a(0x1ef)](_0x3fec4d,_0x3fb8b1,_0x310563){const _0x1bc882=_0x34149a;if(_0x3fec4d||!_0x3fb8b1){console[_0x1bc882(0x1ea)]('err:\x20',_0x3fec4d);throw _0x3fec4d||new common_1[(_0x1bc882(0x1cd))]();}return _0x3fb8b1;}};JwtAuthGuard=__decorate([(0x0,common_1[_0x34149a(0x1de)])(),__metadata(_0x34149a(0x204),[redisCache_service_1[_0x34149a(0x1ca)],core_1[_0x34149a(0x1ec)],nestjs_cls_1[_0x34149a(0x1e9)],auth_service_1[_0x34149a(0x1f4)]])],JwtAuthGuard),exports[_0x34149a(0x1f0)]=JwtAuthGuard;