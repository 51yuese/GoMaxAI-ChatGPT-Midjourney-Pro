'use strict';const _0xace18b=_0x4dff;(function(_0x1580a9,_0x1f4219){const _0x83691d=_0x4dff,_0x216728=_0x1580a9();while(!![]){try{const _0x4e5dc6=-parseInt(_0x83691d(0xcb))/0x1+-parseInt(_0x83691d(0xd9))/0x2+parseInt(_0x83691d(0xc6))/0x3*(parseInt(_0x83691d(0xc2))/0x4)+parseInt(_0x83691d(0xc0))/0x5*(parseInt(_0x83691d(0xe5))/0x6)+-parseInt(_0x83691d(0x125))/0x7+-parseInt(_0x83691d(0xce))/0x8*(-parseInt(_0x83691d(0x10a))/0x9)+-parseInt(_0x83691d(0xdc))/0xa*(-parseInt(_0x83691d(0x100))/0xb);if(_0x4e5dc6===_0x1f4219)break;else _0x216728['push'](_0x216728['shift']());}catch(_0x4128e2){_0x216728['push'](_0x216728['shift']());}}}(_0x4eda,0x9b97e));function _0x4dff(_0x49e02b,_0xbdea94){const _0x4edaa8=_0x4eda();return _0x4dff=function(_0x4dff58,_0x3c59f1){_0x4dff58=_0x4dff58-0xbe;let _0x5b3bfa=_0x4edaa8[_0x4dff58];return _0x5b3bfa;},_0x4dff(_0x49e02b,_0xbdea94);}Object[_0xace18b(0xcf)](exports,_0xace18b(0xc1),{'value':!![]}),exports[_0xace18b(0x105)]=void 0x0;function _0x4eda(){const _0x344fc6=['from','WS_ERROR','wsProxyUrl','3yyibcs','heartbeatTask','getMsgById','opts','getMsgByparentId','185682lYWDiU','https://cdn.discordapp.com','reconnectionTask','224LKLafA','defineProperty','message','wsClient','eventemitter3','length','lastSequence','discord\x20wsClient\x20occurred\x20an\x20error:\x20','open','toString','wsClient\x20is\x20open!','2396260DhQHOX','session_id','nonce','1048090kTUMIV','handleMessageUpdate','matchRegionNonce','send','imgBaseUrl','./utils','/inpaint/api/get-image-info/0/0/','debug','nonce\x20is\x20none','2406AytypJ','emitEmbed','data','wsBaseUrl',',\x20error\x20reason:\x20','once','info','./msgMap','EventEmitter','readyState','arrayBuffer','emit','prompt','MidjourneyMsgMap','handleMessageCreate','heartbeat_interval','MESSAGE_UPDATE','formatComponents','handleMessage','channel_id','json','MESSAGE_DELETE','processingImage','close','parseInt','match','stringify','110iQcRDC','replace','parse','/inpaint','emitNonce','MidjourneyWs','image','connect','off','WS_CLOSE','237348eBmyKD','url','INTERACTION_IFRAME_MODAL_CREATE','MESSAGE_CREATE','msgMap','heartbeat','describe','assign','number','token','auth','INTERACTION_MODAL_CREATE','then','Mac\x20OS\x20X','wsClient\x20connect\x20successfully!','skipHeartbeat','READY','random','handleMessageDelete','OPEN','waitReady','set','addEventListener','split','discord\x20wsClient\x20reconnect...','user','WS_OPEN','6450661fCxpvu','get','error','discordsaysUrl','640orGHYd','__esModule','4419244JGwVyw'];_0x4eda=function(){return _0x344fc6;};return _0x4eda();}const eventemitter3_1=require(_0xace18b(0xd2)),{WebSocket}=require('isomorphic-ws'),msgMap_1=require(_0xace18b(0xec)),utils_1=require(_0xace18b(0xe1));class MidjourneyWs extends eventemitter3_1[_0xace18b(0xed)]{constructor(_0x4af2ae){const _0x8fdfd5=_0xace18b;super(),this[_0x8fdfd5(0xc9)]=_0x4af2ae,this[_0x8fdfd5(0xd4)]=null,this[_0x8fdfd5(0xc7)]=null,this[_0x8fdfd5(0xcd)]=null,this[_0x8fdfd5(0x10e)]=new msgMap_1[(_0x8fdfd5(0xf2))](),this[_0x8fdfd5(0xd1)]=this[_0x8fdfd5(0x107)]();}['connect'](){const _0xaea84f=_0xace18b;if(!this[_0xaea84f(0xc9)][_0xaea84f(0xe8)])throw new Error('wsBaseUrl\x20can\x27t\x20be\x20empty');let _0x2aad23;!this['opts'][_0xaea84f(0xc5)]&&this[_0xaea84f(0xc9)][_0xaea84f(0xe8)]&&(_0x2aad23=new WebSocket(this[_0xaea84f(0xc9)][_0xaea84f(0xe8)]));if(!_0x2aad23)throw'ws创建失败';return _0x2aad23[_0xaea84f(0x120)](_0xaea84f(0xd6),()=>{const _0x391766=_0xaea84f;this['emit'](_0x391766(0x124)),this['opts']['debug']?.('MidjourneyWs',_0x391766(0x107))(_0x391766(0xd8)),this['reconnectionTask']&&(clearTimeout(this[_0x391766(0xcd)]),this['reconnectionTask']=null);}),_0x2aad23[_0xaea84f(0x120)](_0xaea84f(0xd0),this[_0xaea84f(0xd0)]['bind'](this)),_0x2aad23[_0xaea84f(0x120)]('error',_0x23a02d=>{const _0xb68380=_0xaea84f;this[_0xb68380(0xf0)](_0xb68380(0xc4),_0x23a02d[_0xb68380(0xd0)]),this['opts'][_0xb68380(0xe3)]?.('MidjourneyWs','connect')(_0xb68380(0xd5)+_0x23a02d['message']),this[_0xb68380(0xd1)]['close']();}),_0x2aad23['addEventListener'](_0xaea84f(0xfc),({code:_0x5c80d2,reason:_0x420125})=>{const _0xf8caab=_0xaea84f;this[_0xf8caab(0xf0)](_0xf8caab(0x109)),this[_0xf8caab(0xc9)]['debug']?.(_0xf8caab(0x105),'connect')('discord\x20wsClient\x20was\x20close,\x20error\x20code:\x20'+_0x5c80d2+_0xf8caab(0xe9)+_0x420125),_0x5c80d2===0xfa4?this[_0xf8caab(0xf0)]('READY',new Error(_0x420125)):this[_0xf8caab(0xcd)]=setTimeout(()=>{const _0x446774=_0xf8caab;this[_0x446774(0xc9)]['debug']?.('MidjourneyWs',_0x446774(0x107))(_0x446774(0x122)),this[_0x446774(0xc7)]&&typeof this[_0x446774(0xc7)]===_0x446774(0x112)&&(clearInterval(this[_0x446774(0xc7)]),this[_0x446774(0xc7)]=null),this[_0x446774(0xd1)]=this['connect']['call'](this);},0xfa0);}),_0x2aad23;}[_0xace18b(0x114)](){const _0x21e8da=_0xace18b;this['wsClient'][_0x21e8da(0xdf)](JSON[_0x21e8da(0xff)]({'op':0x2,'d':{'token':this[_0x21e8da(0xc9)][_0x21e8da(0x113)],'capabilities':0x3ffd,'properties':{'os':_0x21e8da(0x117),'browser':'Chrome','device':''},'compress':![]}}));}['heartbeat'](_0x3d1e6b){const _0x20c67f=_0xace18b,_0x36fda9=_0x3d1e6b*Math[_0x20c67f(0x11b)]();this[_0x20c67f(0xc7)]=setTimeout(()=>{const _0x4a1480=_0x20c67f;this[_0x4a1480(0xd1)][_0x4a1480(0xee)]===WebSocket[_0x4a1480(0x11d)]&&(this['wsClient']['send'](JSON['stringify']({'op':0x1,'d':this['lastSequence']})),this['heartbeat'](_0x3d1e6b));},_0x36fda9);}['message'](_0x1cd4fe){const _0x183ab8=_0xace18b,_0xf42188=JSON[_0x183ab8(0x102)](_0x1cd4fe[_0x183ab8(0xe7)]),_0x181c8a=_0xf42188['d'],_0x235f95=_0xf42188['t'],_0x56eb8f=_0xf42188['s'],_0x255495=_0xf42188['op'];_0x56eb8f&&(this['lastSequence']=_0x56eb8f);_0x255495===0xa&&(this[_0x183ab8(0x10f)](_0x181c8a[_0x183ab8(0xf4)]),this[_0x183ab8(0x114)]());_0x235f95===_0x183ab8(0x11a)&&(this[_0x183ab8(0xc9)][_0x183ab8(0xda)]=_0x181c8a['session_id'],this['opts'][_0x183ab8(0x123)]=_0x181c8a['user'],this[_0x183ab8(0xc9)]['debug']?.(_0x183ab8(0x105),_0x183ab8(0xd0))(_0x183ab8(0x118)),this[_0x183ab8(0xf0)](_0x183ab8(0x11a),_0x181c8a[_0x183ab8(0x123)]));if(_0x235f95==='MESSAGE_CREATE'||_0x235f95===_0x183ab8(0xf5)||_0x235f95===_0x183ab8(0xfa)||_0x235f95===_0x183ab8(0x10c)||_0x235f95===_0x183ab8(0x115))this[_0x183ab8(0xf7)](_0x235f95,_0x181c8a);_0x255495===0xb&&(!this[_0x183ab8(0xc9)][_0x183ab8(0x119)]&&this['opts']['debug']?.(_0x183ab8(0x105),_0x183ab8(0xd0))('discord\x20heartbeat\x20ack!'));}[_0xace18b(0xf7)](_0xbf813b,_0x4f9064){const _0x5332b8=_0xace18b;if(_0x4f9064[_0x5332b8(0xf8)]!==this[_0x5332b8(0xc9)][_0x5332b8(0xf8)])return;if(_0xbf813b===_0x5332b8(0x10d)||_0xbf813b===_0x5332b8(0x10c)||_0xbf813b===_0x5332b8(0x115))this[_0x5332b8(0xf3)](_0xbf813b,_0x4f9064);else{if(_0xbf813b===_0x5332b8(0xf5))this[_0x5332b8(0xdd)](_0x5332b8(0xf5),_0x4f9064);else this[_0x5332b8(0x11c)](_0x4f9064);}}[_0xace18b(0xf3)](_0x3e8ce4,_0x3d45d4){const _0x450b9e=_0xace18b;let {nonce:_0x2c1b41,id:_0x3a97dd,embeds:embeds=[],custom_id:_0x16dd36,content:_0x4c0e9a,attachments:attachments=[],components:_0x25c6d4}=_0x3d45d4;_0x2c1b41=_0x2c1b41||(0x0,utils_1[_0x450b9e(0xde)])(_0x4c0e9a);if(_0x2c1b41&&!attachments[_0x450b9e(0xd3)]){this[_0x450b9e(0x10e)]['updateMsgByNonce'](_0x3a97dd,_0x2c1b41);if(embeds[0x0]){const {color:_0x2c96ff}=embeds[0x0];switch(_0x2c96ff){case 0xff0000:this[_0x450b9e(0xe6)](_0x3a97dd,'MESSAGE_CREATE',embeds[0x0]);break;default:break;}}if(_0x3e8ce4===_0x450b9e(0x10c)&&_0x16dd36){_0x16dd36=_0x16dd36[_0x450b9e(0x121)]('::')[0x2];let _0x2f9756='';return fetch(this[_0x450b9e(0xc9)][_0x450b9e(0xbf)]+_0x450b9e(0xe2)+_0x16dd36)[_0x450b9e(0x116)](async _0x1775a2=>{const _0x20cfd4=_0x450b9e;if(_0x1775a2['ok']){const _0x45d70b=await _0x1775a2[_0x20cfd4(0xf9)]();_0x2f9756=_0x45d70b[_0x20cfd4(0xf1)];const _0x343f9f=await fetch(this[_0x20cfd4(0xc9)][_0x20cfd4(0xbf)]+_0x20cfd4(0x103)+_0x45d70b['image_url']?.[_0x20cfd4(0x101)](/^\./,''))[_0x20cfd4(0x116)](_0x252c95=>_0x252c95[_0x20cfd4(0xef)]())['then'](_0x4a857a=>Buffer[_0x20cfd4(0xc3)](_0x4a857a)[_0x20cfd4(0xd7)]('base64'));this[_0x20cfd4(0x104)](_0x2c1b41,_0x3e8ce4,{'custom_id':_0x16dd36,'varyRegionPrompt':_0x2f9756,'varyRegionImgBase64':_0x343f9f});}});}_0x3e8ce4===_0x450b9e(0x115)&&_0x16dd36&&_0x25c6d4[_0x450b9e(0xd3)]&&this[_0x450b9e(0x104)](_0x2c1b41,_0x3e8ce4,{'id':_0x3a97dd,'custom_id':_0x16dd36,'components':_0x25c6d4});}this['handleMessageUpdate'](_0x450b9e(0x10d),_0x3d45d4);}[_0xace18b(0xdd)](_0x1de5e8,_0x5bd65c){const _0x4a5b4b=_0xace18b,{content:_0x35db59,interaction:interaction={},nonce:_0x21e682,flags:_0x4a2a0c,attachments:_0x2473ed,components:components=[],embeds:embeds=[],id:_0x40620c}=_0x5bd65c;if(!_0x21e682){const {name:_0x3dff92}=interaction,_0x149599=this[_0x4a5b4b(0x10e)][_0x4a5b4b(0xc8)](_0x40620c);if(_0x149599&&_0x149599[_0x4a5b4b(0xdb)])switch(_0x3dff92){case'settings':this[_0x4a5b4b(0x104)](_0x149599[_0x4a5b4b(0xdb)],_0x1de5e8,{'id':_0x40620c,'flags':_0x4a2a0c,'components':(0x0,utils_1['formatComponents'])(components),'progress':0x64});return;case _0x4a5b4b(0xeb):embeds['at'](0x0)&&this[_0x4a5b4b(0x104)](_0x149599[_0x4a5b4b(0xdb)],_0x1de5e8,{'id':_0x40620c,'embed':embeds[0x0],'progress':0x64});return;case _0x4a5b4b(0x110):embeds['at'](0x0)&&this[_0x4a5b4b(0x104)](_0x149599[_0x4a5b4b(0xdb)],_0x1de5e8,{'flags':_0x4a2a0c,'url':embeds[0x0][_0x4a5b4b(0x106)][_0x4a5b4b(0x10b)],'timestamp':_0x5bd65c['timestamp'],'components':(0x0,utils_1[_0x4a5b4b(0xf6)])(components),'id':_0x40620c,'embed':embeds[0x0],'progress':0x64});return;}}_0x35db59&&this[_0x4a5b4b(0xfb)](_0x1de5e8,_0x5bd65c);}[_0xace18b(0x11c)]({id:_0x3ebec8}){const _0x5b16c5=_0xace18b;this[_0x5b16c5(0x104)](_0x3ebec8,_0x5b16c5(0xfa),{'id':_0x3ebec8},!![]);}[_0xace18b(0xfb)](_0x4ac606,_0x39eac6){const _0x1fc8d5=_0xace18b,{content:_0x249e83,id:_0x4c1833,attachments:attachments=[],flags:_0x3e3435,components:components=[],nonce:_0x4ddecd,timestamp:_0x31a03e,message_reference:message_reference={}}=_0x39eac6,{message_id:_0x5c6176}=message_reference,_0x185b58=this[_0x1fc8d5(0x10e)][_0x1fc8d5(0xc8)](_0x4c1833)||this['msgMap'][_0x1fc8d5(0xca)](_0x5c6176)||this['msgMap']['getMsgByContent'](_0x249e83);if(!_0x185b58?.[_0x1fc8d5(0xdb)]){console['error'](_0x1fc8d5(0xe4));return;}let _0x568d22=attachments['at'](0x0)?.['url'];if(_0x568d22&&this[_0x1fc8d5(0xc9)][_0x1fc8d5(0xe0)])_0x568d22=_0x568d22[_0x1fc8d5(0x101)](_0x1fc8d5(0xcc),this['opts'][_0x1fc8d5(0xe0)]);const _0x3eed26=_0x249e83?.[_0x1fc8d5(0xfe)](/\((\d+?)%\)\s\(\w+?\)/)?.[0x1],_0x2c9798=!_0x4ddecd&&attachments[_0x1fc8d5(0xd3)]&&components['length']&&_0x4ac606==='MESSAGE_CREATE',_0x113ef5=_0x2c9798?0x64:_0x3eed26?Number[_0x1fc8d5(0xfd)](_0x3eed26):0x0,_0x23d284=_0x185b58?.['id']!==_0x4c1833?_0x185b58?.['id']:undefined,_0x4e5ca2=JSON[_0x1fc8d5(0x102)](JSON[_0x1fc8d5(0xff)]({'id':_0x4c1833,'url':_0x568d22,'originId':_0x23d284,'attachments':attachments,'content':_0x249e83[_0x1fc8d5(0x101)](/^\*\*regionNonce:\s\d+?,\s/,'**'),'parentId':_0x5c6176,'flags':_0x3e3435,'components':(0x0,utils_1[_0x1fc8d5(0xf6)])(components),'progress':_0x113ef5,'timestamp':_0x31a03e}));this[_0x1fc8d5(0x104)](_0x185b58[_0x1fc8d5(0xdb)],_0x4ac606,_0x4e5ca2);}['emitNonce'](_0x15a47d,_0x882aef,_0x5c92c2,_0x589fc9=![]){const _0x45804b=_0xace18b,_0x275c59=this[_0x45804b(0x10e)][_0x45804b(0x126)](_0x15a47d)||this[_0x45804b(0x10e)]['getMsgById'](_0x15a47d)||this['msgMap']['getMsgByOriginId'](_0x15a47d);_0x275c59&&_0x275c59[_0x45804b(0xdb)]&&this[_0x45804b(0xf0)](_0x275c59[_0x45804b(0xdb)],_0x882aef,_0x589fc9?_0x5c92c2:Object[_0x45804b(0x111)]({},_0x275c59,_0x5c92c2));}[_0xace18b(0xe6)](_0x499d68,_0x188d02,_0x5b82e4){const _0x315f88=_0xace18b,_0x3bb2b5=this[_0x315f88(0x10e)]['getMsgById'](_0x499d68);if(!_0x3bb2b5||!_0x3bb2b5[_0x315f88(0xdb)])return;_0x3bb2b5['embed']=_0x5b82e4,this['emitNonce'](_0x3bb2b5[_0x315f88(0xdb)],_0x188d02,_0x3bb2b5);}[_0xace18b(0x11e)](){return new Promise((_0x3b9ec2,_0x134c94)=>{const _0x154ea5=_0x4dff;this[_0x154ea5(0xea)]('READY',_0x24a321=>_0x24a321 instanceof Error?_0x134c94(_0x24a321):_0x3b9ec2(_0x24a321));});}['waitMessage']({nonce:_0x19a138,parentId:_0x2717aa,cb:_0x4ebb4b}){const _0x92a518=_0xace18b;this['msgMap'][_0x92a518(0x11f)](_0x19a138,{'id':'','nonce':_0x19a138});const _0x3d333a=_0x2717aa&&this['msgMap']['getMsgById'](_0x2717aa);return new Promise((_0x196317,_0x5a4f2c)=>{const _0x40b4e1=_0x92a518;_0x3d333a&&_0x3d333a[_0x40b4e1(0xdb)]&&this[_0x40b4e1(0xea)](_0x3d333a[_0x40b4e1(0xdb)],(_0x14e7f1,_0x4e5bbe)=>{const _0x19e2ee=_0x40b4e1;_0x4ebb4b?.(_0x14e7f1,_0x4e5bbe),this['off'](_0x3d333a[_0x19e2ee(0xdb)]);}),this['on'](_0x19a138,(_0x15034f,_0x21658a)=>{const _0x36ea26=_0x40b4e1;_0x4ebb4b?.(_0x15034f,_0x21658a);if(_0x15034f===_0x36ea26(0xfa)&&_0x21658a['id']){const _0x3d6458=this['msgMap']['getMsgByOriginId'](_0x21658a['id']);_0x3d6458&&this['off'](_0x19a138)&&_0x196317(_0x3d6458);return;}if(_0x15034f===_0x36ea26(0x10c)||_0x15034f===_0x36ea26(0x115)){this[_0x36ea26(0x108)](_0x19a138);return;}this[_0x36ea26(0x10e)]['set'](_0x19a138,_0x21658a),_0x21658a[_0x36ea26(0xbe)]&&(this[_0x36ea26(0x108)](_0x19a138),_0x5a4f2c(_0x21658a['error']));});});}}exports[_0xace18b(0x105)]=MidjourneyWs;